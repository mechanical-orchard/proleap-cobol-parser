000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    TMKCS506.                                         00040000
000500 AUTHOR.        M. FURLICK - STRATAGEM                            00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  4/94.                                             00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000*----------------------------------------------------------------*00100000
001100*    E506 - CREATE NOTIFICATION/TROUBLE.                         *00110000
001200*                                                                *00120000
001300*    THIS PROGRAM IS USED TO ADD NOTIFICATION/TROUBLE            *00130000
001400*    INFORMATION.                                                *00140000
001500*                                                                *00150000
001600*----------------------------------------------------------------*00160000
001700                                                                  00170000
001100******************************************************************00171000
001200* 03/12/2010 MICHAEL J. WATTS                                    *00172001
001200*            MADE CHANGES FOR EFC2 PROJECT (WR382136)            *00173001
002600*----------------------------------------------------------------*00173101
001300*    CHANGES                                                     *00174201
001300*     MADE BY: PRITHIVIRAJ SUBRAMANIAN (COGNIZANT)               *00174301
001300*     DATE:    10/06/2014                                        *00174401
001300*                                                                *00174501
001300*      CHANGES THRU OUT THE PROGRAM TO INCREASE THE SIZE OF PO#  *00174601
001300*      FROM 7 DIGITS TO 8 DIGITS. TAGGED WITH *PS 10/06/2014     *00174702
001100******************************************************************00179000
263627*----------------------------------------------------------------*00179106
263627* CHANGED 11/04/2021    BY JIM HUNTER      WR: CHG0263627         00179206
263627* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00179306
263627* MAKING THE CALL DYNAMIC VS STATIC.                              00179406
263627*----------------------------------------------------------------*00179506
CICS  * CHANGED 11/09/2022    BY JIM HUNTER      WR: CHG0278008         00179607
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00179707
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00179807
CICS  *-----------------------------------------------------------------00179907
      * CHANGED 02/14/2023    BY JEAN KURK       WR: CHG0281369         00180008
      * REMOVED COPYBOOK FOR UPC CHECK DIGIT ROUTINE                    00180108
      *-----------------------------------------------------------------00180308
001800                                                                  00181000
001900 ENVIRONMENT DIVISION.                                            00190000
002000                                                                  00200000
002100 DATA DIVISION.                                                   00210000
002200                                                                  00220000
002300                                                                  00230000
002400 WORKING-STORAGE SECTION.                                         00240000
002500 01  PC-PROGRAM-CONSTANTS.                                        00250000
002600     05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'TMKCS506'.  00260000
002700     05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'TM506A  '.  00270000
002800     05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'TMKM506 '.  00280000
002900     05  PC-LIST-QUEUE-SEQ        PIC  9(01)  VALUE 1.            00290000
003000     05  PC-SEL-QUEUE-SEQ         PIC  9(01)  VALUE 2.            00300000
003100     05  PC-APPL-MAP              PIC S9(04)  VALUE  +1           00310000
003200                                              COMP.               00320000
003300     05  PC-MAX-RETRIES           PIC S9(04)  VALUE  +3           00330000
003400                                              COMP.               00340000
003500     05  PC-MAX-MSG-VAR           PIC S9(04)  VALUE  +1           00350000
003600                                              COMP.               00360000
003700     05  PC-INTER-APPL-CODES.                                     00370000
003800         10  PC-INTER-APPL-CRIT-SPEC                              00380000
003900                                  PIC  X(01)  VALUE '1'.          00390000
004000         10  PC-INTER-APPL-RCPT-ITEM                              00400000
004100                                  PIC  X(01)  VALUE '2'.          00410000
004200         10  PC-INTER-APPL-REDIST PIC  X(01)  VALUE '3'.          00420000
004300         10  PC-INTER-APPL-LIST   PIC  X(01)  VALUE '5'.          00430000
004400         10  PC-INTER-APPL-PACK   PIC  X(01)  VALUE '6'.          00440000
004500         10  PC-INTER-APPL-PACK-UPD                               00450000
004600                                  PIC  X(01)  VALUE '7'.          00460000
004700     05  PC-MSG-VAR-SYMBOLIC      PIC  X(04)  VALUE '&VAR'.       00470000
004800     05  PC-TMKCS520              PIC  X(08)  VALUE  'TMKCS520'.  00480000
004900     05  PC-PERIOD                PIC  X(01)  VALUE '.'.          00490000
005000     05  PC-A                     PIC  X(01)  VALUE 'A'.          00500000
005100     05  PC-B                     PIC  X(01)  VALUE 'B'.          00510000
005200     05  PC-D                     PIC  X(01)  VALUE 'D'.          00520000
005300     05  PC-V                     PIC  X(01)  VALUE 'V'.          00530000
005400     05  PC-I                     PIC  X(01)  VALUE 'I'.          00540000
005500     05  PC-N                     PIC  X(01)  VALUE 'N'.          00550000
005600     05  PC-Y                     PIC  X(01)  VALUE 'Y'.          00560000
005700     05  PC-M                     PIC  X(01)  VALUE 'M'.          00570000
005800     05  PC-ACTIVE-STATUS         PIC  X(01)  VALUE 'A'.          00580000
005900     05  PC-VERIFIED-STATUS       PIC  X(02)  VALUE 'VE'.         00590000
006000     05  PC-3                     PIC  9(01)  VALUE 3.            00600000
006100     05  PC-DB2-DUMMY-DATE        PIC  X(26)  VALUE               00610000
006200         '9999-09-09-09.09.09.000000'.                            00620000
006300     05  PC-DB2-DEFAULT-TMST      PIC  X(26)  VALUE               00630000
006400         '9999-09-09-09.09.09.999999'.                            00640000
006410     05  PC-801                   PIC S9(04)  VALUE  +801         00641000
006420                                              COMP.               00642000
006430     05  PC-802                   PIC S9(04)  VALUE  +802         00643000
006440                                              COMP.               00644000
006430     05  PC-804                   PIC S9(04)  VALUE  +804         00644100
006440                                              COMP.               00644200
006430     05  PC-805                   PIC S9(04)  VALUE  +805         00644300
006440                                              COMP.               00644400
006430     05  PC-806                   PIC S9(04)  VALUE  +806         00644500
006440                                              COMP.               00644600
006450     05  PC-997                   PIC S9(04)  VALUE  +997         00644700
006460                                              COMP.               00644800
006470     05  PC-998                   PIC S9(04)  VALUE  +998         00644900
006480                                              COMP.               00645000
006490     05  PC-999                   PIC S9(04)  VALUE  +999         00646000
006500                                              COMP.               00647000
006600     EJECT                                                        00648000
006700 01  PC-TSYMSG-NUMBERS.                                           00649000
006800         10  PC-TSYMSG-00004      PIC  9(05)  VALUE  00004.       00650000
006900         10  PC-TSYMSG-00005      PIC  9(05)  VALUE  00005.       00660000
007000         10  PC-TSYMSG-00007      PIC  9(05)  VALUE  00007.       00670000
007100         10  PC-TSYMSG-00008      PIC  9(05)  VALUE  00008.       00680000
007200         10  PC-TSYMSG-00010      PIC  9(05)  VALUE  00010.       00690000
007300         10  PC-TSYMSG-00016      PIC  9(05)  VALUE  00016.       00700000
007400         10  PC-TSYMSG-00034      PIC  9(05)  VALUE  00034.       00710000
007500         10  PC-TSYMSG-00057      PIC  9(05)  VALUE  00057.       00720000
007600         10  PC-TSYMSG-00059      PIC  9(05)  VALUE  00059.       00730000
007700         10  PC-TSYMSG-00069      PIC  9(05)  VALUE  00069.       00740000
007800         10  PC-TSYMSG-00070      PIC  9(05)  VALUE  00070.       00750000
007900         10  PC-TSYMSG-00073      PIC  9(05)  VALUE  00073.       00760000
008000         10  PC-TSYMSG-00095      PIC  9(05)  VALUE  00095.       00770000
008100         10  PC-TSYMSG-00100      PIC  9(05)  VALUE  00100.       00780000
008200         10  PC-TSYMSG-00115      PIC  9(05)  VALUE  00115.       00790000
008300         10  PC-TSYMSG-00117      PIC  9(05)  VALUE  00117.       00800000
008400         10  PC-TSYMSG-00124      PIC  9(05)  VALUE  00124.       00810000
008500         10  PC-TSYMSG-00148      PIC  9(05)  VALUE  00148.       00820000
008600         10  PC-TSYMSG-00302      PIC  9(05)  VALUE  00302.       00830000
008700         10  PC-TSYMSG-00316      PIC  9(05)  VALUE  00316.       00840000
008800         10  PC-TSYMSG-00388      PIC  9(05)  VALUE  00388.       00850000
008900         10  PC-TSYMSG-00410      PIC  9(05)  VALUE  00410.       00860000
009000         10  PC-TSYMSG-00474      PIC  9(05)  VALUE  00474.       00870000
009100         10  PC-TSYMSG-00547      PIC  9(05)  VALUE  00547.       00880000
009200         10  PC-TSYMSG-00548      PIC  9(05)  VALUE  00548.       00890000
009300         10  PC-TSYMSG-00551      PIC  9(05)  VALUE  00551.       00900000
009400         10  PC-TSYMSG-00686      PIC  9(05)  VALUE  00686.       00910000
009500         10  PC-TSYMSG-00687      PIC  9(05)  VALUE  00687.       00920000
009600         10  PC-TSYMSG-00688      PIC  9(05)  VALUE  00688.       00930000
009700         10  PC-TSYMSG-00738      PIC  9(05)  VALUE  00738.       00940000
009800         10  PC-TSYMSG-00815      PIC  9(05)  VALUE  00815.       00950000
009900                                                                  00960000
010000         10  PC-TSYMSG-01245      PIC  9(05)  VALUE  01245.       00970000
010100*      'PO NUMBER AND RECEIVER REQUIRED'.                         00980000
010200                                                                  00990000
010300         10  PC-TSYMSG-01246      PIC  9(05)  VALUE  01246.       01000000
010400*      'CAN NOT CREATE TROUBLE MANUALLY FOR THIS TROUBLE REASON'. 01010000
010500                                                                  01020000
010600         10  PC-TSYMSG-01247      PIC  9(05)  VALUE  01247.       01030000
010700*      'LINE DOES NOT EXIST ON THE SPECIFIED PO'.                 01040000
010800                                                                  01050000
010900         10  PC-TSYMSG-01249      PIC  9(05)  VALUE  01249.       01060000
011000*      'RECEIVER NOT FOUND FOR SPECIFIED LOCATION'.               01070000
011100                                                                  01080000
011200         10  PC-TSYMSG-01250      PIC  9(05)  VALUE  01250.       01090000
011300*      'CANNOT CREATE TROUBLE - RECEIVER IS VERIFIED'.            01100000
011400                                                                  01110000
011500         10  PC-TSYMSG-01251      PIC  9(05)  VALUE  01251.       01120000
011600*      'CANNOT CREATE TROUBLE - PO LINE IS VERIFIED'.             01130000
011700                                                                  01140000
011800         10  PC-TSYMSG-01252      PIC  9(05)  VALUE  01252.       01150000
011900*      'INVALID TROUBLE REASON TYPE'.                             01160000
012000                                                                  01170000
012100         10  PC-TSYMSG-01253      PIC  9(05)  VALUE  01253.       01180000
012200*      'LINE NBR NOT NEEDED WHEN CREATING PO LEVEL TRBL'.         01190000
012300                                                                  01200000
012400         10  PC-TSYMSG-01254      PIC  9(05)  VALUE  01254.       01210000
012500*      'REQUESTED TRBL ALREADY EXISTS FOR PO OR PO LINE'.         01220000
012600                                                                  01230000
012700         10  PC-TSYMSG-01255      PIC  9(05)  VALUE  01255.       01240000
012800*      'LINE DOES NOT EXIST ON THE SPECIFIED RECEIVER'.           01250000
012900                                                                  01260000
013000         10  PC-TSYMSG-01294      PIC  9(05)  VALUE  01294.       01270000
013100*      'CANNOT CREATE TRBL - REASON AND LINE STATUS DO NOT MATCH' 01280000
013200                                                                  01290000
013300         10  PC-TSYMSG-01640      PIC  9(05)  VALUE  01640.       01300000
013400*      'OFFSITE STORAGE TROUBLE CANNOT BE CREATED FOR AN ARRIVED  01310000
013500*      'RECEIVER'                                                 01320000
013600                                                                  01330000
013700         10  PC-TSYMSG-01641      PIC  9(05)  VALUE  01641.       01340000
013800*      'STORAGE AT THE DC TROUBLE CANNOT BE CREATED FOR AN        01350000
013900*       ENROUTE RECEIVER'                                         01360000
014000                                                                  01370000
014100         10  PC-TSYMSG-01672      PIC  9(05)  VALUE  01672.       01380000
014200*      'STORAGE TROUBLE ALREADY EXISTS FOR THIS RECEIVER'         01390000
014300                                                                  01400000
014400         10  PC-TSYMSG-02614      PIC  9(05)  VALUE  02614.       01410000
014500*      'CANNOT CREATE TROUBLE HERE - GO TO TROUBLE CRIT SPEC'     01420000
014600                                                                  01430000
014700         10  PC-TSYMSG-99901      PIC  9(05)  VALUE  99901.       01440000
014800                                                                  01450000
014900         10  PC-TSYMSG-12345      PIC  9(05)  VALUE  00057.       01460000
015000         10  PC-TSYMSG-02188      PIC  9(05)  VALUE  02188.       01470000
015100         10  PC-TSYMSG-02189      PIC  9(05)  VALUE  02189.       01480000
015200         10  PC-TSYMSG-02190      PIC  9(05)  VALUE  02190.       01490000
                                                                        01500000
015000         10  PC-TSYMSG-03220      PIC  9(05)  VALUE  03220.       01510000
013400*  'PREPACK FALSE AUDIT CANNOT BE CREATED FOR NON-PREPACK REC     01520000
015100         10  PC-TSYMSG-03221      PIC  9(05)  VALUE  03221.       01521000
013400*  BLK/CSE FALSE AUDIT CANNOT BE CREATED FOR NON-BLK/CSE REC      01522000
015200         10  PC-TSYMSG-03222      PIC  9(05)  VALUE  03222.       01523000
013400*      'PBS FALSE AUDIT CANNOT BE CREATED FOR NON-PBS RECEIVER    01524000
015300                                                                  01525000
015400     EJECT                                                        01526000
015500 01  PS-PROGRAM-SWITCHES.                                         01527000
015600     05  PS-ERROR-SW              PIC  X(01)  VALUE  'N'.         01528000
015700         88  PS-ERROR                         VALUE  'Y'.         01529000
015800         88  PS-WARNING                       VALUE  'W'.         01530000
015900         88  PS-NO-ERROR                      VALUE  'N'.         01540000
016000     05  PS-SOFT-ABORT-SW         PIC  X(01)  VALUE  'N'.         01550000
016100         88  PS-SOFT-ABORT                    VALUE  'Y'.         01560000
016200     05  PS-RSN-CDE-ENTERED-SW    PIC  X(01)  VALUE  'N'.         01570000
016300         88  PS-RSN-CDE-ENTERED               VALUE  'Y'.         01580000
016400     05  PS-RSN-DESC-ENTERED-SW   PIC  X(01)  VALUE  'N'.         01590000
016500         88  PS-RSN-DESC-ENTERED              VALUE  'Y'.         01600000
016600     05  PS-END-SEL-ITEMS-QUEUE-SW PIC X(01)  VALUE  'N'.         01610000
016700         88  PS-END-SEL-ITEMS-QUEUE           VALUE  'Y'.         01620000
016800         88  PS-NOT-END-SEL-ITEMS-QUEUE       VALUE  'N'.         01630000
016900     05  PS-FIRST-TIME-SW         PIC X(01)   VALUE  'Y'.         01640000
017000         88  PS-FIRST-TIME                    VALUE  'Y'.         01650000
017100         88  PS-NOT-FIRST-TIME                VALUE  'N'.         01660000
017200     05  PS-UNRSLVD-STORTRBL-SW   PIC X(01)   VALUE  'N'.         01670000
017300         88  PS-UNRSLVD-STORTRBL-FND          VALUE  'Y'.         01680000
017400         88  PS-UNRSLVD-STORTRBL-NOTFND       VALUE  'N'.         01690000
017500*                                                                 01700000
017600 01  PV-PROGRAM-VARIABLES.                                        01710000
017700     05  PV-CICS-RESPONSE         PIC S9(04)  VALUE +0            01720000
017800                                              COMP SYNC.          01730000
017900     05  PV-CICS-RESP             PIC S9(04)  VALUE +0            01740000
018000                                              COMP SYNC.          01750000
018100     05  PV-RETRY-COUNTER         PIC S9(04)  VALUE +0            01760000
018200                                              COMP SYNC.          01770000
018300     05  PV-MSG-VAR-CNT           PIC S9(04)  VALUE +0            01780000
018400                                              COMP SYNC.          01790000
018500     05  PV-DB2-COUNT             PIC S9(09)  VALUE +0            01800000
018600                                              COMP SYNC.          01810000
018700     05  PV-NULL-IND              PIC S9(04)  VALUE +0            01820000
018800                                              COMP SYNC.          01830000
018900     05  PV-STRING-POINTER        PIC S9(04)  VALUE +0            01840000
019000                                              COMP SYNC.          01850000
019100     05  PV-REASON-CHECKER            PIC S9(4) VALUE ZERO        01860000
019200                                                COMP SYNC.        01870000
019300         88  PV-VERIFIED-ADJUSTMENT   VALUES +600 THRU +625.      01880000
019400                                                                  01890000
019500     05  PV-TRBL-RSN-CDE              PIC  9(4) VALUE ZERO.       01900000
019600     05  PV-TRBL-SHT-DESC-LOW     PIC X(10).                      01910000
019700     05  PV-TRBL-SHT-DESC-HIGH    PIC X(10).                      01920000
019900*PS 10/06/2014 CHANGES STARTS                                     01921004
019800     05  PV-DISPLAY-PO-X          PIC  X(08).                     01930005
019800     05  PV-DISPLAY-PO.                                           01940004
019900         10  PV-PO-NBR            PIC  9(08).                     01941001
019900*PS 10/06/2014 CHANGES ENDS                                       01942002
020000         10  FILLER               PIC  X(01)  VALUE '-'.          01950000
020100         10  PV-REC-SEQ-NBR       PIC  9(04).                     01960000
020200     05  PV-WORK-TMST.                                            01970000
020300         10  PV-WT-CCYY                 PIC  X(04)  VALUE '9999'. 01980000
020400         10  FILLER                     PIC  X(01)  VALUE '-'.    01990000
020500         10  PV-WT-MO                   PIC  X(02)  VALUE '09'.   02000000
020600         10  FILLER                     PIC  X(01)  VALUE '-'.    02010000
020700         10  PV-WT-DA                   PIC  X(02)  VALUE '09'.   02020000
020800         10  FILLER                     PIC  X(01)  VALUE '-'.    02030000
020900         10  PV-WT-HH                   PIC  X(02)  VALUE '99'.   02040000
021000         10  FILLER                     PIC  X(01)  VALUE '.'.    02050000
021100         10  PV-WT-MM                   PIC  X(02)  VALUE '99'.   02060000
021200         10  FILLER                     PIC  X(01)  VALUE '.'.    02070000
021300         10  PV-WT-SS                   PIC  X(02)  VALUE '99'.   02080000
021400         10  FILLER                     PIC  X(01)  VALUE '.'.    02090000
021500         10  FILLER                     PIC  X(06)  VALUE ZERO.   02100000
021600     05  PV-SCREEN-DISPLAY-DATE.                                  02110000
021700         10  PV-SD-MO                   PIC  X(02).               02120000
021800         10  FILLER                     PIC  X(01)   VALUE '/'.   02130000
021900         10  PV-SD-DA                   PIC  X(02).               02140000
022000         10  FILLER                     PIC  X(01)   VALUE '/'.   02150000
022100         10  PV-SD-YR                   PIC  X(02).               02160000
022200     05  PV-SCREEN-DISPLAY-TIME.                                  02170000
022300         10  PV-SD-HH                   PIC  X(02).               02180000
022400         10  FILLER                     PIC  X(01)   VALUE ':'.   02190000
022500         10  PV-SD-MM                   PIC  X(02).               02200000
022600         10  FILLER                     PIC  X(01)   VALUE ':'.   02210000
022700         10  PV-SD-SS                   PIC  X(02).               02220000
022800     05  PV-SAVE-ASC-SEL-SUB            PIC S9(04)   COMP.        02230000
022900     05  PV-SAVE-ASC-SEL-ITEM           PIC S9(04)   COMP.        02240000
023000     05  PV-SEL-QUEUE-ITEM              PIC S9(4) COMP VALUE +1.  02250000
023100     05  PV-DUMMY-PO                    PIC S9(9) COMP VALUE +0.  02260000
023200     05  PV-LINE-NBR                    PIC S9(9) COMP VALUE +0.  02270000
023300     05  PV-PREPK-ID                    PIC S9(4) COMP VALUE +0.  02280000
023310     05  PV-UNPACK-OPER-UNT-ID          PIC  9(4)    VALUE ZERO.  02290000
023400                                                                  02300000
023500*----------------------------------------------------------------*02310000
023600*    MAP LAYOUT                                                  *02320000
023700*----------------------------------------------------------------*02330000
023800     COPY TMKM506.                                                02340000
023900                                                                  02350000
024000*----------------------------------------------------------------*02360000
024100*    TEMP STORAGE QUEUE LAYOUT FOR SELECTION INPUT QUEUE.        *02370000
024200*----------------------------------------------------------------*02380000
024300     COPY RCWS013.                                                02390000
024400                                                                  02400000
024500     COPY RCWS801.                                                02410000
024600                                                                  02420000
024700*----------------------------------------------------------------*02430000
024800*    LOGISTICS LOCATION DOMAIN MODULE (XLKUT071)                 *02440000
024900*----------------------------------------------------------------*02450000
025000     COPY XLWS071.                                                02460000
025100                                                                  02470000
024700*----------------------------------------------------------------*02480000
024800*    COMMAREA FOR TMKCS520.                                      *02490000
024900*----------------------------------------------------------------*02500000
025000     COPY TMWS500.                                                02510000
025100                                                                  02511000
025200*----------------------------------------------------------------*02512000
025300*    ATTRIBUTE SETTINGS COPYBOOK.                                *02513000
025400*----------------------------------------------------------------*02514000
025500     COPY DPWS015.                                                02515000
025600                                                                  02516000
025700*----------------------------------------------------------------*02517000
025800*    FUNCTION KEYS COPYBOOK                                      *02518000
025900*----------------------------------------------------------------*02519000
026000     COPY DPWS016.                                                02520000
026100                                                                  02530000
026700*----------------------------------------------------------------*02590000
026800*    DATE/TIME COPYBOOK                                          *02600000
026900*----------------------------------------------------------------*02610000
027000     COPY DPWS017.                                                02620000
027100                                                                  02630000
027200*----------------------------------------------------------------*02640000
027300*  THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT     *02650000
027400*  SUB-ROUTINE (DPKUT100).                                       *02660000
027500*----------------------------------------------------------------*02670000
027600     COPY DPWS010I.                                               02680000
027700                                                                  02690000
027800*----------------------------------------------------------------*02700000
027900*  THE CALLING PARAMETER LIST (DPWS030) FOR THE CICS ARCHITECTURE*02710000
028000*  APPLICATION PROGRAMMING INTERFACE MODULE.                     *02720007
028100*----------------------------------------------------------------*02730000
028200     COPY DPWS030.                                                02740000
CICS       COPY DPWS930.                                                02741007
028300                                                                  02750000
028400*----------------------------------------------------------------*02760000
028500*    STANDARD COMMAREA.                                          *02770000
028600*----------------------------------------------------------------*02780000
028700     COPY DPWS020.                                                02790000
028800     05  TMKCS506-APPL REDEFINES DP020-VARIABLE-COMMAREA.         02800000
028900                                                                  02810000
029000*----------------------------------------------------------------*02820000
029100*    INTER-APPLICATION COMMAREA.                                 *02830000
029200*----------------------------------------------------------------*02840000
029300         10  INTER-APPL-COMM-AREA PIC X(200).                     02850000
029400     COPY PCWS000.                                                02860000
029500     COPY TMWS001.                                                02870000
029600     COPY RCWS800.                                                02880000
029700                                                                  02890000
029800*----------------------------------------------------------------*02900000
029900*    SPECIFIC COMMMAREA.                                         *02910000
030000*----------------------------------------------------------------*02920000
030100         10  ASC-SPECIFIC-COMMAREA.                               02930000
030200             15  ASC-KEY-NOTIF-NBR               PIC S9(09)       02940000
030300                                                 COMP.            02950000
030400             15  ASC-KEY-PO-NBR                  PIC S9(09)       02960000
030500                                                 COMP.            02970000
030600             15  ASC-KEY-PO-LNE-NBR              PIC S9(09)       02980000
030700                                                 COMP.            02990000
030800             15  ASC-KEY-DRV-LNE-NBR             PIC S9(09)       03000000
030900                                                 COMP.            03010000
031000             15  ASC-KEY-PREPK-ID                PIC S9(04)       03020000
031100                                                 COMP.            03030000
031200             15  ASC-KEY-REC-SEQ-NBR             PIC S9(09)       03040000
031300                                                 COMP.            03050000
031400             15  ASC-KEY-OPER-UNT-ID             PIC S9(04)       03060000
031500                                                 COMP.            03070000
031600             15  ASC-KEY-FCLTY-ID                PIC S9(04)       03080000
031700                                                 COMP.            03090000
031800             15  ASC-SCREEN-ENTERABLE-FIELDS.                     03100000
031900                 20  ASC-TEXT1                   PIC X(50).       03110000
032000                 20  ASC-TEXT2                   PIC X(50).       03120000
032100                 20  ASC-TEXT3                   PIC X(50).       03130000
032200                 20  ASC-TEXT4                   PIC X(50).       03140000
032300                 20  ASC-TEXT5                   PIC X(50).       03150000
032400                 20  ASC-TRBL-RSN-CDE-X.                          03160000
032500                     25  ASC-TRBL-RSN-CDE        PIC 9(03).       03170000
032600                 20  ASC-TRBL-SHT-DESC           PIC X(10).       03180000
032700                 20  ASC-TRBL-LONG-DESC          PIC X(20).       03190000
032800                 20  FILLER                      PIC X(07).       03200000
032900             15  ASC-ENT-ID                      PIC S9(09) COMP. 03210000
033000             15  ASC-DEPT-NBR                    PIC X(03).       03220000
033100             15  ASC-FCLTY-NME                   PIC X(25).       03230000
033200             15  ASC-FCLTY-AREA-ID               PIC X(06).       03240000
033300             15  ASC-VENDOR-NAME                 PIC X(30).       03250000
033400             15  ASC-TRBL-LVL-IND                PIC X(01).       03260000
033500                 88  ASC-PO-LEVEL-TRBL           VALUE 'P'.       03270000
033600                 88  ASC-PACK-LEVEL-TRBL         VALUE 'M'.       03280000
033700                 88  ASC-LINE-LEVEL-TRBL         VALUE 'L'        03290000
033800                                                       'S'        03300000
033900                                                       'X'.       03310000
034000             15  ASC-CONFIRM-REQUIRED-IND        PIC X(01).       03320000
034100                 88  ASC-CONFIRM-REQUIRED-ONE    VALUE 'C'.       03330000
034200                 88  ASC-CONFIRM-REQUIRED-MULTI  VALUE 'M'.       03340000
034300                 88  ASC-NO-CONFIRM-REQUIRED     VALUE 'N'.       03350000
034400             15  ASC-DONE-PROCESSING-SW          PIC X(01).       03360000
034500                 88  ASC-DONE-PROCESSING         VALUE 'D'.       03370000
034600                 88  ASC-NOT-DONE-PROCESSING     VALUE 'N'.       03380000
034700             15  ASC-TRBL-RSN-CDE-SW             PIC X(01).       03390000
034800                 88  ASC-TRBL-RSN-CDE-ERROR      VALUE 'Y'.       03400000
034900                 88  ASC-TRBL-RSN-CDE-OK         VALUE 'N'.       03410000
035000             15  ASC-TRBL-RSN-DESC-SW            PIC X(01).       03420000
035100                 88  ASC-TRBL-RSN-DESC-ERROR     VALUE 'Y'.       03430000
035200                 88  ASC-TRBL-RSN-DESC-OK        VALUE 'N'.       03440000
035300             15  ASC-PREPACK-ID-SW               PIC X(01).       03450000
035400                 88  ASC-A-PREPACK-ID-EXISTS     VALUE 'Y'.       03460000
035500                 88  ASC-NO-PREPACK-ID           VALUE 'N'.       03470000
035600                                                                  03480000
035700             15  ASC-INT-APPL-FORMAT-IND         PIC X(01).       03490000
035800                 88  ASC-INTER-APPL-CRIT-SPEC    VALUE '1'.       03500000
035900                 88  ASC-INTER-APPL-RCPT-ITEM    VALUE '2'.       03510000
036000                 88  ASC-INTER-APPL-REDIST       VALUE '3'.       03520000
036100                 88  ASC-INTER-APPL-LIST         VALUE '5'.       03530000
036200                 88  ASC-INTER-APPL-PACK         VALUE '6'.       03540000
036300                 88  ASC-INTER-APPL-PACK-UPD     VALUE '7'.       03550000
036400             15  ASC-USE-SELECTION-QUEUE-IND     PIC X(01).       03560000
036500                 88  ASC-USE-SELECTION-QUEUE     VALUE 'Y'.       03570000
036600             15  ASC-LIST-QUEUE-NAME.                             03580000
036700                 20  ASC-LIST-TERM-ID            PIC X(4).        03590000
036800                 20  ASC-LIST-TASK-NUMBER        PIC S9(5)        03600000
036900                                                     COMP-3.      03610000
037000                 20  ASC-LIST-SEQ                PIC 9.           03620000
037100             15  ASC-SEL-QUEUE-NAME              PIC X(08).       03630000
037200             15  ASC-SEL-QUEUE-NAME-IN           PIC X(08).       03640000
037300             15  ASC-SEL-QUEUE-NAME-OUT.                          03650000
037400                 20  ASC-SEL-TERM-ID             PIC X(4).        03660000
037500                 20  ASC-SEL-TASK-NUMBER         PIC S9(5)        03670000
037600                                                       COMP-3.    03680000
037700                 20  ASC-SEL-SEQ                 PIC 9.           03690000
037800             15  ASC-NUMBER-OF-TS-ITEMS    PIC S9(05)  COMP-3.    03700000
037900             15  ASC-NUMBER-OF-SELECTED-ITEMS                     03710000
038000                                           PIC S9(09)  COMP-3.    03720000
038100             15  ASC-SEL-SUB               PIC S9(04)  COMP.      03730000
038200             15  ASC-SEL-ITEM              PIC S9(04)  COMP.      03740000
038300                                                                  03750000
038400             15  ASC-HOLD-INTER-APPL       PIC  X(200).           03760000
038500         10  FILLER                        PIC  X(200).           03770000
038600/                                                                 03780000
038700*----------------------------------------------------------------*03790000
038800*    ABEND PROCESSING COPYBOOK.                                  *03800000
038900*----------------------------------------------------------------*03810000
039000     COPY DPWS013.                                                03820000
039100                                                                  03830000
039900*----------------------------------------------------------------*03840000
040000*    DB2 AREA FOR FACILITY AREA TABLE                             03850000
040100*----------------------------------------------------------------*03860000
040200     EXEC SQL                                                     03870000
040300          INCLUDE TFLAREA                                         03880000
040400     END-EXEC.                                                    03890000
040500                                                                  03900000
040600*----------------------------------------------------------------*03910000
040700*    DB2 AREA FOR ENTITY NAME TABLE                               03920000
040800*----------------------------------------------------------------*03930000
040900     EXEC SQL                                                     03940000
041000          INCLUDE TENTNME                                         03950000
041100     END-EXEC.                                                    03960000
041200                                                                  03970000
041300*----------------------------------------------------------------*03980000
041400*    DB2 AREA FOR PURCHASE HEADER TABLE                           03990000
041500*----------------------------------------------------------------*04000000
041600     EXEC SQL                                                     04010000
041700          INCLUDE TPURCHS                                         04020000
041800     END-EXEC.                                                    04030000
041900                                                                  04040000
042000*----------------------------------------------------------------*04050000
042100*    DB2 AREA FOR PURCHASE ITEM TABLE                             04060000
042200*----------------------------------------------------------------*04070000
042300     EXEC SQL                                                     04080000
042400          INCLUDE TPURITM                                         04090000
042500     END-EXEC.                                                    04100000
042600                                                                  04110000
042700*----------------------------------------------------------------*04120000
042800*    DB2 AREA FOR RECEIVER TABLE                                  04130000
042900*----------------------------------------------------------------*04140000
043000     EXEC SQL                                                     04150000
043100          INCLUDE TRECEIV                                         04160000
043200     END-EXEC.                                                    04170000
043300                                                                  04180000
043400*----------------------------------------------------------------*04190000
043500*    DB2 AREA FOR RECEIPT ITEM TABLE                              04200000
043600*----------------------------------------------------------------*04210000
043700     EXEC SQL                                                     04220000
043800          INCLUDE TRECITM                                         04230000
043900     END-EXEC.                                                    04240000
044000                                                                  04250000
044100*----------------------------------------------------------------*04260000
044200*    DB2 AREA FOR TROUBLE NOTIFICATION                            04270000
044300*----------------------------------------------------------------*04280000
044400     EXEC SQL                                                     04290000
044500          INCLUDE TTRBNTF                                         04300000
044600     END-EXEC.                                                    04310000
044700                                                                  04320000
044800*----------------------------------------------------------------*04330000
044900*    DB2 AREA FOR TROUBLE DETAIL                                  04340000
045000*----------------------------------------------------------------*04350000
045100     EXEC SQL                                                     04360000
045200          INCLUDE TTRBDTL                                         04370000
045300     END-EXEC.                                                    04380000
045400                                                                  04390000
045500*----------------------------------------------------------------*04400000
045600*    DB2 AREA FOR TROUBLE REASON                                  04410000
045700*----------------------------------------------------------------*04420000
045800     EXEC SQL                                                     04430000
045900          INCLUDE TTRBRSN                                         04440000
046000     END-EXEC.                                                    04450000
046100                                                                  04460000
046200*----------------------------------------------------------------*04470000
046300*    DB2 AREA FOR COMMUNICATIONS                                  04480000
046400*----------------------------------------------------------------*04490000
046500     EXEC SQL                                                     04500000
046600          INCLUDE SQLCA                                           04510000
046700     END-EXEC.                                                    04520000
046800/                                                                 04530000
046900*----------------------------------------------------------------*04540000
047000*----------------------------------------------------------------*04550000
047100 LINKAGE SECTION.                                                 04560000
047200 01  DFHCOMMAREA.                                                 04570000
047300     05  FILLER                         OCCURS  1 TO 4072 TIMES   04580000
047400                                        DEPENDING ON EIBCALEN.    04590000
047500         10  FILLER                     PIC X.                    04600000
047600                                                                  04610000
047700                                                                  04620000
047800 PROCEDURE DIVISION.                                              04630000
047900**-------------------------------------------------------------** 04640000
048000** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 04650000
048100** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 04660000
048200** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 04670000
048300**                                                             ** 04680000
048400** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 04690000
048500** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 04700000
048600**-------------------------------------------------------------** 04710000
048700                                                                  04720000
048800 0000-MAIN-MODULE.                                                04730000
048900                                                                  04740000
049000     INITIALIZE DP030-CICS-API-FIELDS.                            04750000
049100     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04760000
049200     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04770000
049300     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04780000
049400                                                                  04790000
049500     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04800000
049600     MOVE LENGTH OF TM506AI        TO DP030-MAP-LENGTH (1).       04810000
049700     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04820000
049800     PERFORM 0001-CALL-CICS-ARCH-API.                             04830000
049900                                                                  04840000
050000     PERFORM 1000-CONTROL-PROCESSING.                             04850000
050100                                                                  04860000
050200     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04870000
050300     PERFORM 0001-CALL-CICS-ARCH-API.                             04880000
050400                                                                  04890000
050500 0001-CALL-CICS-ARCH-API.                                         04900000
050600                                                                  04910000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04920007
050800                                    DFHCOMMAREA                   04930007
050900                                    DP030-CICS-API-FIELDS         04940007
051000                                    DP020-STANDARD-COMMAREA       04950007
051100                                    TM506AI.                      04960007
051200                                                                  04970000
051300     IF  DP030-RC-CALL-SUCCESSFUL                                 04980000
051400         CONTINUE                                                 04990000
051500     ELSE                                                         05000000
051600         SET DP013-NO-ROLLBACK                                    05010000
051700             DP013-XCTL-DISPLAY-RESTART                           05020000
051800             DP013-CICS-ABEND      TO TRUE                        05030000
051900         MOVE 'BEFORE 0000-MAIN-MODULE'                           05040000
052000                                   TO DP013-PARAGRAPH             05050000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O05051007
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05052007
052300         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05080000
052400         PERFORM DP013-0000-PROCESS-ABEND                         05090000
052500     END-IF.                                                      05100000
052600/                                                                 05110000
052700*----------------------------------------------------------------*05120000
052800*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *05130000
052900*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *05140000
053000*----------------------------------------------------------------*05150000
053100                                                                  05160000
053200 1000-CONTROL-PROCESSING.                                         05170000
053300                                                                  05180000
053400     EVALUATE TRUE                                                05190000
053500         WHEN DP020-NEXT-ACT-INITIAL                              05200000
053600              PERFORM 1100-FIND-OBJECT-KEYS                       05210000
053700              IF  PS-ERROR                                        05220000
053800                  CONTINUE                                        05230000
053900              ELSE                                                05240000
054000                  PERFORM 1200-MOVE-AND-EDIT-COMMAREA             05250000
054100                  IF  PS-ERROR                                    05260000
054200                      CONTINUE                                    05270000
054300                  ELSE                                            05280000
054400                      PERFORM 4000-BUILD-INITIAL-PANEL            05290000
054500                      PERFORM 3200-RESET-ATTRIBUTES               05300000
054600                      PERFORM 4400-MOVE-COMMAREA-TO-SCREEN        05310000
054700                      SET DP030-SET-CURSOR-APPL-1 TO TRUE         05320000
054800                      MOVE -1          TO  ATRBRSNL               05330000
054900                      IF  SQLCODE = +100                          05340000
055000                          SET DP020-NEXT-ACT-APPL-ERROR TO TRUE   05350000
055100                          MOVE PC-TSYMSG-00148                    05360000
055200                                       TO  DP020-MSG-NUMBER       05370000
055300                          SET DP020-MSG-FATAL TO TRUE             05380000
055400                      END-IF                                      05390000
055500                  END-IF                                          05400000
055600              END-IF                                              05410000
055700                                                                  05420000
055800         WHEN DP020-NEXT-ACT-READ-MAP                             05430000
055900              PERFORM 2000-PROCESS-PANEL                          05440000
056000                                                                  05450000
056100         WHEN DP020-NEXT-ACT-RETURN                               05460000
056200              MOVE ASC-HOLD-INTER-APPL                            05470000
056300                                   TO  INTER-APPL-COMM-AREA       05480000
056400*JPL          PERFORM 3000-EDIT-DATA-IN-COMMAREA                  05490000
056500              PERFORM 1200-MOVE-AND-EDIT-COMMAREA                 05500000
056600              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                05510000
056700                                                                  05520000
056800         WHEN OTHER                                               05530000
056900              SET DP013-LOGIC-ABEND TO TRUE                       05540000
057000              SET DP013-NO-ROLLBACK TO TRUE                       05550000
057100              MOVE '1000-CONTROL-PROCESSING'                      05560000
057200                                   TO  DP013-PARAGRAPH            05570000
057300              MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'  05580000
057400                                   TO  DP013-MESSAGE-TEXT(1)      05590000
057500              MOVE DP020-NEXT-APPL-ACTIVITY                       05600000
057600                                   TO  DP013-MESSAGE-TEXT(2)      05610000
057700              PERFORM DP013-0000-PROCESS-ABEND                    05620000
057800     END-EVALUATE.                                                05630000
057900                                                                  05640000
058000*----------------------------------------------------------------*05650000
058100*  DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE    *05660000
058200*  INTER-APPLICATION FORMAT CODE.                                *05670000
058300*----------------------------------------------------------------*05680000
058400 1100-FIND-OBJECT-KEYS.                                           05690000
058500                                                                  05700000
058600     INITIALIZE ASC-SPECIFIC-COMMAREA.                            05710000
058700                                                                  05720000
058800     MOVE EIBTRMID TO ASC-LIST-TERM-ID                            05730000
058900                      ASC-SEL-TERM-ID.                            05740000
059000     MOVE DP020-SRC-TASK-NUMBER TO ASC-LIST-TASK-NUMBER           05750000
059100                                   ASC-SEL-TASK-NUMBER.           05760000
059200     MOVE PC-LIST-QUEUE-SEQ TO ASC-LIST-SEQ.                      05770000
059300     MOVE PC-SEL-QUEUE-SEQ  TO ASC-SEL-SEQ.                       05780000
059400                                                                  05790000
059500     SET ASC-NO-CONFIRM-REQUIRED    TO TRUE.                      05800000
059600     MOVE DP020-INT-APPL-FORMAT-IND TO ASC-INT-APPL-FORMAT-IND.   05810000
059700                                                                  05820000
059800     EVALUATE DP020-INT-APPL-FORMAT-IND                           05830000
059900         WHEN PC-INTER-APPL-CRIT-SPEC                             05840000
060000*PS 10/10/2014 STARTS                                             05850004
060000              MOVE TM001-PO-NBR-N  TO  PV-DISPLAY-PO-X            05850104
060000              MOVE PV-DISPLAY-PO-X TO  ASC-KEY-PO-NBR             05851004
060000*PS 10/10/2014 ENDS                                               05852004
060100              MOVE TM001-PO-LINE-NBR-N                            05860000
060200                                   TO  ASC-KEY-PO-LNE-NBR         05870000
060300              MOVE TM001-RCVR-SEQ-NBR-N                           05880000
060400                                   TO  ASC-KEY-REC-SEQ-NBR        05890000
060500              MOVE TM001-OPER-UNT-ID-N                            05900000
060600                                   TO  ASC-KEY-OPER-UNT-ID        05910000
060700              MOVE TM001-FCLTY-ID-N                               05920000
060800                                   TO  ASC-KEY-FCLTY-ID           05930000
060900              IF (ASC-KEY-OPER-UNT-ID NOT GREATER THAN ZERO       05940000
061000              OR  ASC-KEY-FCLTY-ID    NOT GREATER THAN ZERO)      05950000
061100                  MOVE PC-TSYMSG-00148 TO  DP020-MSG-NUMBER       05960000
061200                  SET DP020-MSG-FATAL                             05970000
061300                      DP020-NEXT-ACT-APPL-ERROR                   05980000
061400                                   TO TRUE                        05990000
061500              END-IF                                              06000000
061600                                                                  06010000
061700         WHEN PC-INTER-APPL-RCPT-ITEM                             06020000
061800         WHEN PC-INTER-APPL-REDIST                                06030000
061900              MOVE PC000-PO-NBR-N  TO  ASC-KEY-PO-NBR             06040000
062000              MOVE PC000-LINE-NBR-N                               06050000
062100                                   TO  ASC-KEY-PO-LNE-NBR         06060000
062200              MOVE PC000-REC-SEQ-NBR-N                            06070000
062300                                   TO  ASC-KEY-REC-SEQ-NBR        06080000
062400              MOVE PC000-OPERATING-UNIT-ID                        06090000
062500                                   TO  ASC-KEY-OPER-UNT-ID        06100000
062600              MOVE PC000-FACILITY-ID                              06110000
062700                                   TO  ASC-KEY-FCLTY-ID           06120000
062800              IF (ASC-KEY-OPER-UNT-ID NOT GREATER THAN ZERO       06130000
062900              OR  ASC-KEY-FCLTY-ID    NOT GREATER THAN ZERO)      06140000
063000                  MOVE PC-TSYMSG-00148 TO  DP020-MSG-NUMBER       06150000
063100                  SET DP020-MSG-FATAL                             06160000
063200                      DP020-NEXT-ACT-APPL-ERROR                   06170000
063300                                   TO TRUE                        06180000
063400              END-IF                                              06190000
063500                                                                  06200000
063600         WHEN PC-INTER-APPL-LIST                                  06210000
063700              SET ASC-USE-SELECTION-QUEUE TO TRUE                 06220000
063800              MOVE PC000-NUMBER-OF-SELECTED-ITEMS                 06230000
063900                                   TO ASC-NUMBER-OF-SELECTED-ITEMS06240000
064000              MOVE PC000-NUMBER-OF-TS-ITEMS                       06250000
064100                                   TO  ASC-NUMBER-OF-TS-ITEMS     06260000
064200              MOVE PC000-SEL-QUEUE-NAME                           06270000
064300                                   TO  ASC-SEL-QUEUE-NAME         06280000
064400              MOVE PC000-OPERATING-UNIT-ID                        06290000
064500                                   TO  ASC-KEY-OPER-UNT-ID        06300000
064600              MOVE PC000-FACILITY-ID                              06310000
064700                                   TO  ASC-KEY-FCLTY-ID           06320000
064800              PERFORM 1120-PREPARE-LIST-ENTRY                     06330000
064900                                                                  06340000
065000         WHEN PC-INTER-APPL-PACK                                  06350000
065100             IF RC800-NUMBER-OF-SELECTED-ITEMS = ZERO             06360000
065200                 SET DP020-MSG-FATAL                              06370000
065300                     DP020-NEXT-ACT-APPL-ERROR                    06380000
065400                     PS-ERROR              TO TRUE                06390000
065500                 MOVE PC-TSYMSG-02189      TO DP020-MSG-NUMBER    06400000
065600             ELSE                                                 06410000
065700                 MOVE RC800-REC-NBR-N      TO ASC-KEY-PO-NBR      06420000
065800                 MOVE RC800-REC-SEQ-NBR-N  TO ASC-KEY-REC-SEQ-NBR 06430000
065900                 MOVE RC800-OPER-UNIT-ID   TO ASC-KEY-OPER-UNT-ID 06440000
066000                 MOVE RC800-FACILITY-ID    TO ASC-KEY-FCLTY-ID    06450000
066100                                                                  06460000
066200                 SET ASC-USE-SELECTION-QUEUE TO TRUE              06470000
066300                                                                  06480000
066400                 MOVE RC800-NUMBER-OF-SELECTED-ITEMS              06490000
066500                   TO   ASC-NUMBER-OF-SELECTED-ITEMS              06500000
066600                 MOVE RC800-NUMBER-OF-TS-ITEMS                    06510000
066700                   TO   ASC-NUMBER-OF-TS-ITEMS                    06520000
066800                 MOVE RC800-SEL-QUEUE-NAME                        06530000
066900                   TO   ASC-SEL-QUEUE-NAME-IN                     06540000
067000                 MOVE RC801-MAX-ITEMS TO ASC-SEL-SUB              06550000
067100                 MOVE ZEROES          TO ASC-SEL-ITEM             06560000
067200                 PERFORM 2150-GET-NEXT-PK-RECORD                  06570000
067300           END-IF                                                 06580000
067400                                                                  06590000
067500         WHEN PC-INTER-APPL-PACK-UPD                              06600000
067600             IF RC800-NUMBER-OF-SELECTED-ITEMS = ZERO             06610000
067700                 SET DP020-MSG-FATAL                              06620000
067800                     DP020-NEXT-ACT-APPL-ERROR                    06630000
067900                     PS-ERROR              TO TRUE                06640000
068000                 MOVE PC-TSYMSG-02189      TO DP020-MSG-NUMBER    06650000
068100             ELSE                                                 06660000
068200                 MOVE RC800-REC-NBR-N      TO ASC-KEY-PO-NBR      06670000
068300                 MOVE RC800-REC-SEQ-NBR-N  TO ASC-KEY-REC-SEQ-NBR 06680000
068400                 MOVE RC800-OPER-UNIT-ID   TO ASC-KEY-OPER-UNT-ID 06690000
068500                 MOVE RC800-FACILITY-ID    TO ASC-KEY-FCLTY-ID    06700000
068600                                                                  06710000
068700                 SET ASC-USE-SELECTION-QUEUE TO TRUE              06720000
068800                                                                  06730000
068900                 MOVE RC800-NUMBER-OF-SELECTED-ITEMS              06740000
069000                   TO   ASC-NUMBER-OF-SELECTED-ITEMS              06750000
069100                 MOVE RC800-NUMBER-OF-TS-ITEMS                    06760000
069200                   TO   ASC-NUMBER-OF-TS-ITEMS                    06770000
069300                 MOVE RC800-SEL-QUEUE-NAME                        06780000
069400                   TO   ASC-SEL-QUEUE-NAME-IN                     06790000
069500                 MOVE RC800-LINE-NBR-N                            06800000
069600                   TO ASC-KEY-PO-LNE-NBR                          06810000
069700                 MOVE RC800-PACK-ID                               06820000
069800                   TO ASC-KEY-PREPK-ID                            06830000
069900                 SET RC801-INQ (1)                                06840000
070000                   TO TRUE                                        06850000
070100           END-IF                                                 06860000
070200                                                                  06870000
070300         WHEN OTHER                                               06880000
070400              MOVE PC-TSYMSG-00148 TO  DP020-MSG-NUMBER           06890000
070500              SET DP020-MSG-FATAL                                 06900000
070600                  DP020-NEXT-ACT-APPL-ERROR                       06910000
070700                                   TO TRUE                        06920000
070800     END-EVALUATE.                                                06930000
070900                                                                  06940000
071000*----------------------------------------------------------------*06950000
071100* ENTRY IS FROM A LIST.  GET THE MESSAGE NUMBER FROM THE TEMP    *06960000
071200* STORAGE QUEUE PASSED FROM THE LIST.                            *06970000
071300*----------------------------------------------------------------*06980000
071400                                                                  06990000
071500 1120-PREPARE-LIST-ENTRY.                                         07000000
071600                                                                  07010000
071700     MOVE RC013-MAX-ITEMS          TO ASC-SEL-SUB.                07020000
071800     MOVE ZERO                     TO ASC-SEL-ITEM.               07030000
071900     PERFORM 2110-GET-NEXT-LINE.                                  07040000
072000/                                                                 07050000
072100*----------------------------------------------------------------*07060000
072200* MOVE THE INTER-APPL COMMAREA TO A HOLD AREA AND PERFORM EDITS  *07070000
072300* ON DATA PASSED IN THE COMMAREA.                                *07080000
072400*----------------------------------------------------------------*07090000
072500                                                                  07100000
072600 1200-MOVE-AND-EDIT-COMMAREA.                                     07110000
072700                                                                  07120000
072800     MOVE INTER-APPL-COMM-AREA TO  ASC-HOLD-INTER-APPL.           07130000
072900                                                                  07140000
073000     IF ASC-KEY-OPER-UNT-ID EQUAL ZEROES                          07150000
073100         OR ASC-KEY-FCLTY-ID EQUAL ZEROES                         07160000
073200             SET DP020-NEXT-ACT-APPL-ERROR                        07170000
073300                 PS-ERROR                  TO  TRUE               07180000
073400             MOVE PC-TSYMSG-00815                                 07190000
073500                              TO  DP020-MSG-NUMBER                07200000
073600             SET DP020-MSG-FATAL TO TRUE                          07210000
073700     ELSE                                                         07220000
073800         IF ASC-KEY-PO-NBR EQUAL ZEROES                           07230000
073900             OR ASC-KEY-REC-SEQ-NBR EQUAL ZEROES                  07240000
074000                 SET DP020-NEXT-ACT-APPL-ERROR                    07250000
074100                     PS-ERROR                                     07260000
074200                     DP020-MSG-FATAL TO TRUE                      07270000
074300                 MOVE PC-TSYMSG-01245                             07280000
074400                                     TO  DP020-MSG-NUMBER         07290000
074500         END-IF                                                   07300000
074600     END-IF.                                                      07310000
074700                                                                  07320000
074800     IF PS-NO-ERROR                                               07330000
074900         INITIALIZE PV-DB2-COUNT                                  07340000
075000         PERFORM 1300-COUNT-TRECEIV                               07350000
075100         IF PV-DB2-COUNT = 0                                      07360000
075200             SET DP020-NEXT-ACT-APPL-ERROR                        07370000
075300                 PS-ERROR                                         07380000
075400                 DP020-MSG-FATAL  TO TRUE                         07390000
075500                 MOVE PC-TSYMSG-01249 TO DP020-MSG-NUMBER         07400000
075600         END-IF                                                   07410000
075700     END-IF.                                                      07420000
075800                                                                  07430000
075900*GET PREPACK ID.                                                  07440000
076000     IF PS-NO-ERROR                                               07450000
076100         SET ASC-NO-PREPACK-ID TO TRUE                            07460000
076200         INITIALIZE PV-DB2-COUNT                                  07470000
076300         PERFORM 1310-COUNT-PREPACK                               07480000
076400         IF PV-DB2-COUNT > 0                                      07490000
076500           AND ASC-KEY-PO-LNE-NBR > 0                             07500000
076600             PERFORM 1320-DETERMINE-PREPACK-ID                    07510000
076700             SET ASC-A-PREPACK-ID-EXISTS TO TRUE                  07520000
076800         ELSE                                                     07530000
076900             MOVE ZEROES TO ASC-KEY-DRV-LNE-NBR                   07540000
077000                            ASC-KEY-PREPK-ID                      07550000
077100         END-IF                                                   07560000
077200     END-IF.                                                      07570000
077300                                                                  07580000
077400*----------------------------------------------------------------*07590000
077500*    CHECK TO SEE IF THE RECEIVER EXISTS.  FETCH THE RECEIVER    *07600000
077600*    STATUS CODE TO DETERMINE IF THE RECEIVER HAS BEEN VERIFIED. *07610000
077700*----------------------------------------------------------------*07620000
077800                                                                  07630000
077900 1300-COUNT-TRECEIV.                                              07640000
078000                                                                  07650000
078100     INITIALIZE DCLTRECEIV.                                       07660000
078200                                                                  07670000
078300     EXEC SQL                                                     07680000
078400         SELECT                                                   07690000
078500                 COUNT (*)                                        07700000
078600         INTO                                                     07710000
078700                :PV-DB2-COUNT                                     07720000
078800         FROM                                                     07730000
078900                 TRECEIV                                          07740000
079000         WHERE                                                    07750000
079100                 OPER_UNT_ID        =  :ASC-KEY-OPER-UNT-ID       07760000
079200          AND    FCLTY_ID           =  :ASC-KEY-FCLTY-ID          07770000
079300          AND    ORD_NBR            =  :ASC-KEY-PO-NBR            07780000
079400          AND    REC_SEQ_NBR        =  :ASC-KEY-REC-SEQ-NBR       07790000
079500          AND    VER_STATUS_CDE     =  :PC-ACTIVE-STATUS          07800000
079600     END-EXEC.                                                    07810000
079700                                                                  07820000
079800     EVALUATE TRUE                                                07830000
079900         WHEN SQLCODE = ZERO                                      07840000
080000         WHEN SQLCODE = -305                                      07850000
080100         WHEN SQLCODE = +100                                      07860000
080200              CONTINUE                                            07870000
080300         WHEN SQLCODE = -904                                      07880000
080400         WHEN SQLCODE = -913                                      07890000
080500              PERFORM 9900-SOFT-ABORT                             07900000
080600         WHEN SQLWARN0 NOT = SPACES                               07910000
080700         WHEN SQLCODE NOT EQUAL ZERO                              07920000
080800              MOVE '1300-COUNT-TRECEIV'                           07930000
080900                                   TO DP013-PARAGRAPH             07940000
081000              MOVE 'SELECT RECEIVER INFORMATION'                  07950000
081100                                   TO DP013-MESSAGE-TEXT (1)      07960000
081200              MOVE SQLCA           TO DP013-SQLCA                 07970000
081300              MOVE 'TRECEIV'       TO DP013-DB2-TABLE-NAME (1)    07980000
081400              SET DP013-DB2-ABEND                                 07990000
081500                 DP013-XCTL-DISPLAY-RESTART                       08000000
081600                                   TO TRUE                        08010000
081700              PERFORM DP013-0000-PROCESS-ABEND                    08020000
081800     END-EVALUATE.                                                08030000
081900                                                                  08040000
082000 1310-COUNT-PREPACK.                                              08050000
082100                                                                  08060000
082200     EXEC SQL                                                     08070000
082300         SELECT COUNT(*)                                          08080000
082400           INTO :PV-DB2-COUNT                                     08090000
082500           FROM TRECEIV                                           08100000
082600          WHERE OPER_UNT_ID         = :ASC-KEY-OPER-UNT-ID        08110000
082700            AND FCLTY_ID            = :ASC-KEY-FCLTY-ID           08120000
082800            AND ORD_NBR             = :ASC-KEY-PO-NBR             08130000
082900            AND REC_SEQ_NBR         = :ASC-KEY-REC-SEQ-NBR        08140000
083000            AND VER_STATUS_CDE      = :PC-A                       08150000
083100            AND PKGNG_CDE          IN ('M', 'I')                  08160000
083200     END-EXEC.                                                    08170000
083300                                                                  08180000
083400     EVALUATE TRUE                                                08190000
083500       WHEN SQLCODE = ZERO                                        08200000
083600       WHEN SQLCODE = -305                                        08210000
083700       WHEN SQLCODE = +100                                        08220000
083800           CONTINUE                                               08230000
083900                                                                  08240000
084000       WHEN SQLCODE = -904                                        08250000
084100       WHEN SQLCODE = -913                                        08260000
084200           PERFORM 9900-SOFT-ABORT                                08270000
084300                                                                  08280000
084400       WHEN SQLWARN0 NOT = SPACES                                 08290000
084500       WHEN SQLCODE  NOT = ZERO                                   08300000
084600           MOVE '1310-COUNT-PREPACK'   TO DP013-PARAGRAPH         08310000
084700           MOVE 'COUNT RECEIVER PACKS' TO DP013-MESSAGE-TEXT (1)  08320000
084800           MOVE SQLCA     TO DP013-SQLCA                          08330000
084900           MOVE 'TRECEIV' TO DP013-DB2-TABLE-NAME (1)             08340000
085000           SET DP013-DB2-ABEND                                    08350000
085100               DP013-XCTL-DISPLAY-RESTART TO TRUE                 08360000
085200           PERFORM DP013-0000-PROCESS-ABEND                       08370000
085300     END-EVALUATE.                                                08380000
085400                                                                  08390000
085500 1320-DETERMINE-PREPACK-ID.                                       08400000
085600                                                                  08410000
085700     EXEC SQL                                                     08420000
085800         SELECT DISTINCT                                          08430000
085900                ORD_NBR                                           08440000
086000              , ORD_LNE_NBR                                       08450000
086100              , COALESCE(PREPK_ID, T_PURITM.PO_PREPK_ID)          08460000
086200           INTO :PV-DUMMY-PO                                      08470000
086300              , :PV-LINE-NBR                                      08480000
086400              , :PV-PREPK-ID                                      08490000
086500           FROM TRECITM                                           08500000
086600                FULL JOIN (SELECT DISTINCT PO_NBR,PO_PREPK_ID     08510000
086700                      FROM TPURITM                                08520000
086800                      WHERE PO_NBR       = :ASC-KEY-PO-NBR        08530000
086900                      AND APP_PO_LNE_NBR = :ASC-KEY-PO-LNE-NBR    08540000
087000                      AND VER_STATUS_CDE = :PC-A)                 08550000
087100                      AS T_PURITM                                 08560000
087200                      ON T_PURITM.PO_NBR = ORD_NBR                08570000
087300          WHERE OPER_UNT_ID         = :ASC-KEY-OPER-UNT-ID        08580000
087400            AND FCLTY_ID            = :ASC-KEY-FCLTY-ID           08590000
087500            AND ORD_NBR             = :ASC-KEY-PO-NBR             08600000
087600            AND ORD_LNE_NBR         = :ASC-KEY-PO-LNE-NBR         08610000
087700            AND REC_SEQ_NBR         = :ASC-KEY-REC-SEQ-NBR        08620000
087800            AND VER_STATUS_CDE      = :PC-A                       08630000
087900     END-EXEC.                                                    08640000
088000                                                                  08650000
088100     EVALUATE TRUE                                                08660000
088200       WHEN SQLCODE = ZERO                                        08670000
088300           MOVE PV-LINE-NBR TO ASC-KEY-PO-LNE-NBR                 08680000
088400                               ASC-KEY-DRV-LNE-NBR                08690000
088500           MOVE PV-PREPK-ID TO ASC-KEY-PREPK-ID                   08700000
088600                                                                  08710000
088700       WHEN SQLCODE = -305                                        08720000
088800       WHEN SQLCODE = +100                                        08730000
088900           CONTINUE                                               08740000
089000                                                                  08750000
089100       WHEN SQLCODE = -904                                        08760000
089200       WHEN SQLCODE = -913                                        08770000
089300           PERFORM 9900-SOFT-ABORT                                08780000
089400                                                                  08790000
089500       WHEN SQLWARN0 NOT = SPACES                                 08800000
089600       WHEN SQLCODE  NOT = ZERO                                   08810000
089700           MOVE '1320-DETERMINE-PREPACK-ID' TO DP013-PARAGRAPH    08820000
089800           MOVE 'RETRIEVE PREPACK ID' TO DP013-MESSAGE-TEXT (1)   08830000
089900           MOVE SQLCA     TO DP013-SQLCA                          08840000
090000           MOVE 'TRECITM' TO DP013-DB2-TABLE-NAME (1)             08850000
090100           MOVE 'TPURITM' TO DP013-DB2-TABLE-NAME (2)             08860000
090200           SET DP013-DB2-ABEND                                    08870000
090300               DP013-XCTL-DISPLAY-RESTART TO TRUE                 08880000
090400           PERFORM DP013-0000-PROCESS-ABEND                       08890000
090500     END-EVALUATE.                                                08900000
090600                                                                  08910000
090700*----------------------------------------------------------------*08920000
090800* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *08930000
090900* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *08940000
091000* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *08950000
091100* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *08960000
091200* FUNCTION KEYS CAN GET THIS FAR.                                *08970000
091300*----------------------------------------------------------------*08980000
091400                                                                  08990000
091500 2000-PROCESS-PANEL.                                              09000000
091600                                                                  09010000
091700     MOVE ASC-HOLD-INTER-APPL TO INTER-APPL-COMM-AREA.            09020000
091800                                                                  09030000
091900     EVALUATE TRUE                                                09040000
092000                                                                  09050000
092100         WHEN DP020-SRC-AID = DP016-CLEAR                         09060000
092200              SET ASC-NO-CONFIRM-REQUIRED TO TRUE                 09070000
092300              PERFORM 3000-EDIT-DATA-IN-COMMAREA                  09080000
092400              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                09090000
092500                                                                  09100000
092600         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     09110000
092700              SET ASC-NO-CONFIRM-REQUIRED TO TRUE                 09120000
092800              SET DP030-DONT-ERASE                                09130000
092900                  DP030-SEND-DATAONLY (PC-APPL-MAP)               09140000
093000                                   TO TRUE                        09150000
093100              INITIALIZE ASC-SCREEN-ENTERABLE-FIELDS              09160000
093200              IF ASC-USE-SELECTION-QUEUE                          09170000
093300                  IF ASC-INTER-APPL-LIST                          09180000
093400                      MOVE RC013-MAX-ITEMS TO ASC-SEL-SUB         09190000
093500                      MOVE ZERO            TO ASC-SEL-ITEM        09200000
093600                      PERFORM 2110-GET-NEXT-LINE                  09210000
093700                  END-IF                                          09220000
093800              END-IF                                              09230000
093900              PERFORM 4000-BUILD-INITIAL-PANEL                    09240000
094000              PERFORM 3200-RESET-ATTRIBUTES                       09250000
094100              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                09260000
094200              MOVE -1                  TO  ATRBRSNL               09270000
094300                                                                  09280000
094400         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             09290000
094500             SET ASC-NO-CONFIRM-REQUIRED TO TRUE                  09300000
094600             IF ASC-USE-SELECTION-QUEUE                           09310000
094700                 IF ASC-INTER-APPL-PACK   OR                      09320000
094800                    ASC-INTER-APPL-PACK-UPD                       09330000
094900                     PERFORM 2150-GET-NEXT-PK-RECORD              09340000
095000                 ELSE                                             09350000
095100                     PERFORM 2110-GET-NEXT-LINE                   09360000
095200                 END-IF                                           09370000
095300                 PERFORM 4000-BUILD-INITIAL-PANEL                 09380000
095400                 PERFORM 3200-RESET-ATTRIBUTES                    09390000
095500                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             09400000
095600                 MOVE -1                 TO  ATRBRSNL             09410000
095700             ELSE                                                 09420000
095800*                --- BOTTOM OF LIST ---                           09430000
095900                 MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER         09440000
096000                 SET DP020-MSG-INFORMATIONAL TO TRUE              09450000
096100             END-IF                                               09460000
096200                                                                  09470000
096300         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             09480000
096400             SET ASC-NO-CONFIRM-REQUIRED TO TRUE                  09490000
096500             IF ASC-USE-SELECTION-QUEUE                           09500000
096600                 IF ASC-INTER-APPL-PACK  OR                       09510000
096700                    ASC-INTER-APPL-PACK-UPD                       09520000
096800                     PERFORM 2160-GET-PREV-PK-RECORD              09530000
096900                 ELSE                                             09540000
097000                     PERFORM 2120-GET-PREV-LINE                   09550000
097100                 END-IF                                           09560000
097200                 PERFORM 4000-BUILD-INITIAL-PANEL                 09570000
097300                 PERFORM 3200-RESET-ATTRIBUTES                    09580000
097400                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             09590000
097500                 MOVE -1                 TO  ATRBRSNL             09600000
097600             ELSE                                                 09610000
097700*                --- TOP OF LIST ---                              09620000
097800                 MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER         09630000
097900                 SET DP020-MSG-INFORMATIONAL TO TRUE              09640000
098000             END-IF                                               09650000
098100                                                                  09660000
098200         WHEN OTHER                                               09670000
098300              PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                09680000
098400              IF NOT (DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)      09690000
098500                OR DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID))        09700000
098600                  PERFORM 3000-EDIT-DATA-IN-COMMAREA              09710000
098700              END-IF                                              09720000
098800              IF PS-NO-ERROR                                      09730000
098900                  SET DP030-CONTINUE-GO TO TRUE                   09740000
099000                  PERFORM 2100-CHECK-FUNCTION-KEY                 09750000
099100              ELSE                                                09760000
099200                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            09770000
099300                  SET DP030-OVERRIDE-GO TO TRUE                   09780000
099400              END-IF                                              09790000
099500     END-EVALUATE.                                                09800000
099600                                                                  09810000
099700*----------------------------------------------------------------*09820000
099800* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED       *09830000
099900* FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED   *09840000
100000* FROM THE CICS ARCHITECTURE API.                                *09850000
100100*----------------------------------------------------------------*09860000
100200                                                                  09870000
100300 2100-CHECK-FUNCTION-KEY.                                         09880000
100400                                                                  09890000
100500     EVALUATE TRUE                                                09900000
100600         WHEN DP020-SRC-AID = DP016-ENTER                         09910000
100700              SET ASC-NO-CONFIRM-REQUIRED TO TRUE                 09920000
100800              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                09930000
100900**** CREATE SINGLE TROUBLE                                        09940000
101000         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              09950000
101100              SET ASC-NO-CONFIRM-REQUIRED                         09960000
101200                  DP030-CONTINUE-GO TO TRUE                       09970000
101300* 11/13/97  CONFIRMATION FOR SINGLE TROUBLE NO LONGER REQUIRED    09980000
101400*             MUST CONFIRM BEFORE UPDATE                          09990000
101500* 11/13/97    MOVE PC-TSYMSG-00004 TO DP020-MSG-NUMBER            10000000
101600* 11/13/97    SET DP020-MSG-INFORMATIONAL                         10010000
101700* 11/13/97        ASC-CONFIRM-REQUIRED-ONE TO TRUE                10020000
101800              PERFORM 5000-BEGIN-CREATE-PROCESS                   10030000
101900              IF  PS-NO-ERROR                                     10040000
102000*                 UPDATE SUCCESSFUL                               10050000
102100                  MOVE PC-TSYMSG-00059                            10060000
102200                               TO DP020-MSG-NUMBER                10070000
102300                  SET DP020-MSG-INFORMATIONAL                     10080000
102400                      ASC-NO-CONFIRM-REQUIRED                     10090000
102500                      ASC-DONE-PROCESSING TO TRUE                 10100000
102600              ELSE                                                10110000
102700                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            10120000
102800              END-IF                                              10130000
102900**** CREATE MULTI TROUBLE                                         10140000
103000         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              10150000
103100*** VALIDATE TEXT FIELD                                           10160000
103200             IF ASC-TEXT1 = SPACES                                10170000
103300                 SET PS-ERROR                                     10180000
103400                     DP020-MSG-FATAL  TO TRUE                     10190000
103500                 MOVE PC-TSYMSG-00007 TO DP020-MSG-NUMBER         10200000
103600                 MOVE DP015-UNP-ALP-BRT-OFF TO ATEXT1A            10210000
103700                 MOVE DP015-RED             TO ATEXT1C            10220000
103800                 MOVE DP015-REVERSE         TO ATEXT1H            10230000
103900                 MOVE -1                    TO ATEXT1L            10240000
104000             ELSE                                                 10250000
104100                 SET ASC-CONFIRM-REQUIRED-MULTI TO TRUE           10260000
104200             END-IF                                               10270000
104300                                                                  10280000
104400             IF PS-NO-ERROR AND ASC-CONFIRM-REQUIRED-MULTI        10290000
104500                 MOVE PC-TSYMSG-00004 TO DP020-MSG-NUMBER         10300000
104600                 SET DP020-MSG-INFORMATIONAL TO TRUE              10310000
104700             ELSE                                                 10320000
104800                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             10330000
104900             END-IF                                               10340000
105000                                                                  10350000
105100*** PF14 = PACK DETAIL LIST (RCKCS801)                            10360000
105200         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              10370000
105300             IF ASC-KEY-PO-LNE-NBR = 0                            10380000
105400               AND ASC-KEY-PREPK-ID = 0                           10390000
105500                  MOVE PC-TSYMSG-02188 TO DP020-MSG-NUMBER        10400000
105600                  SET PS-ERROR                                    10410000
105700                      DP030-OVERRIDE-GO                           10420000
105800                      DP020-MSG-FATAL  TO TRUE                    10430000
105900             ELSE                                                 10440000
106000                 PERFORM 6000-PREPARE-SEL-QUEUE                   10450000
106100                 PERFORM 6100-FORMAT-COMMAREA                     10460000
106200             END-IF                                               10470000
106300                                                                  10480000
106400*** PF15 = STORE DISTRO BY PACK (RCKCS805)                        10490000
106500         WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)              10500000
106600             IF ASC-KEY-PO-LNE-NBR = 0                            10510000
106700               AND ASC-KEY-PREPK-ID = 0                           10520000
106800                  MOVE PC-TSYMSG-02188 TO DP020-MSG-NUMBER        10530000
106900                  SET PS-ERROR                                    10540000
107000                      DP030-OVERRIDE-GO                           10550000
107100                      DP020-MSG-FATAL  TO TRUE                    10560000
107200             ELSE                                                 10570000
107300                 PERFORM 6000-PREPARE-SEL-QUEUE                   10580000
107400                 PERFORM 6100-FORMAT-COMMAREA                     10590000
107500             END-IF                                               10600000
107600                                                                  10610000
107700         WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                    10620000
107800              IF  ASC-NO-CONFIRM-REQUIRED                         10630000
107900                  MOVE PC-TSYMSG-00016 TO DP020-MSG-NUMBER        10640000
108000                  SET PS-ERROR                                    10650000
108100                      DP020-MSG-FATAL  TO TRUE                    10660000
108200              ELSE                                                10670000
108300                  SET DP030-CONTINUE-GO TO TRUE                   10680000
108400                  IF ASC-CONFIRM-REQUIRED-MULTI                   10690000
108500                      PERFORM 5100-BEGIN-MULTI-CREATE             10700000
108600******            ELSE                                            10710000
108700* 11/13/97  CONFIRMATION FOR SINGLE TROUBLE NO LONGER REQUIRED    10720000
108800* 11/13/97            IF ASC-CONFIRM-REQUIRED-ONE                 10730000
108900******                    PERFORM 5000-BEGIN-CREATE-PROCESS       10740000
109000******                END-IF                                      10750000
109100                  END-IF                                          10760000
109200                  IF  PS-NO-ERROR                                 10770000
109300*                     UPDATE SUCCESSFUL                           10780000
109400                      MOVE PC-TSYMSG-00059                        10790000
109500                                   TO DP020-MSG-NUMBER            10800000
109600                      SET DP020-MSG-INFORMATIONAL                 10810000
109700                          ASC-NO-CONFIRM-REQUIRED                 10820000
109800                          ASC-DONE-PROCESSING                     10830000
109900                                   TO TRUE                        10840000
110000                  ELSE                                            10850000
110100                      PERFORM 4400-MOVE-COMMAREA-TO-SCREEN        10860000
110200                  END-IF                                          10870000
110300              END-IF                                              10880000
110400                                                                  10890000
110500         WHEN OTHER                                               10900000
110600              SET DP013-NO-ROLLBACK                               10910000
110700                  DP013-XCTL-DISPLAY-RESTART                      10920000
110800                  DP013-CICS-ABEND  TO TRUE                       10930000
110900              MOVE '2000-PROCESS-PANEL'                           10940000
111000                                   TO DP013-PARAGRAPH             10950000
111100              MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'     10960000
111200                                   TO DP013-MESSAGE-TEXT (1)      10970000
111300              PERFORM DP013-0000-PROCESS-ABEND                    10980000
111400     END-EVALUATE.                                                10990000
111500                                                                  11000000
111600*----------------------------------------------------------------*11010000
111700*    RETRIEVE THE NEXT KEY FOR PROCESSING.                       *11020000
111800*----------------------------------------------------------------*11030000
111900                                                                  11040000
112000 2110-GET-NEXT-LINE.                                              11050000
112100                                                                  11060000
112200     ADD +1                        TO  ASC-SEL-SUB.               11070000
112300     IF  ASC-SEL-SUB > RC013-MAX-ITEMS                            11080000
112400         ADD +1                    TO  ASC-SEL-ITEM               11090000
112500         MOVE +1                   TO  ASC-SEL-SUB                11100000
112600     END-IF.                                                      11110000
112700                                                                  11120000
112800     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                11130000
112900         PERFORM 9100-READ-SEL-QUEUE                              11140000
113000         IF  RC013-ITEM (ASC-SEL-SUB) > ZERO                      11150000
113100             MOVE RC013-PO-NBR(ASC-SEL-SUB)                       11160000
113200                                   TO  ASC-KEY-PO-NBR             11170000
113300             MOVE RC013-PKSL-LNE-NBR-N(ASC-SEL-SUB)               11180000
113400                                   TO  ASC-KEY-PO-LNE-NBR         11190000
113500             MOVE RC013-REC-SEQ-NBR(ASC-SEL-SUB)                  11200000
113600                                   TO  ASC-KEY-REC-SEQ-NBR        11210000
113700             SET RC013-INQ (ASC-SEL-SUB)                          11220000
113800                                   TO  TRUE                       11230000
113900             PERFORM 9200-REWRITE-SEL-QUEUE                       11240000
114000         ELSE                                                     11250000
114100             SUBTRACT +1 FROM ASC-SEL-SUB                         11260000
114200*            --- BOTTOM OF LIST ---                               11270000
114300             MOVE PC-TSYMSG-00070  TO  DP020-MSG-NUMBER           11280000
114400             SET DP020-MSG-INFORMATIONAL                          11290000
114500                                   TO  TRUE                       11300000
114600         END-IF                                                   11310000
114700     ELSE                                                         11320000
114800         SUBTRACT +1 FROM ASC-SEL-ITEM                            11330000
114900         MOVE RC013-MAX-ITEMS      TO  ASC-SEL-SUB                11340000
115000         MOVE PC-TSYMSG-00070      TO  DP020-MSG-NUMBER           11350000
115100         SET DP020-MSG-INFORMATIONAL                              11360000
115200                                   TO  TRUE                       11370000
115300     END-IF.                                                      11380000
115400                                                                  11390000
115500*----------------------------------------------------------------*11400000
115600*  GET THE MESSAGE NUMBER (KEY) OF THE PREVIOUS SELECTED         *11410000
115700*  OBJECT FROM THE SELECTED-ITEMS TEMP. STORAGE QUEUE.           *11420000
115800*----------------------------------------------------------------*11430000
115900                                                                  11440000
116000 2120-GET-PREV-LINE.                                              11450000
116100                                                                  11460000
116200     SUBTRACT +1 FROM ASC-SEL-SUB.                                11470000
116300     IF  ASC-SEL-SUB < +1                                         11480000
116400         SUBTRACT +1 FROM ASC-SEL-ITEM                            11490000
116500         MOVE RC013-MAX-ITEMS      TO ASC-SEL-SUB                 11500000
116600     END-IF.                                                      11510000
116700                                                                  11520000
116800     IF  ASC-SEL-ITEM > ZERO                                      11530000
116900         PERFORM 9100-READ-SEL-QUEUE                              11540000
117000         MOVE RC013-PO-NBR(ASC-SEL-SUB)                           11550000
117100                                   TO  ASC-KEY-PO-NBR             11560000
117200         MOVE RC013-PKSL-LNE-NBR-N(ASC-SEL-SUB)                   11570000
117300                                   TO  ASC-KEY-PO-LNE-NBR         11580000
117400         MOVE RC013-REC-SEQ-NBR(ASC-SEL-SUB)                      11590000
117500                                   TO  ASC-KEY-REC-SEQ-NBR        11600000
117600         SET RC013-INQ (ASC-SEL-SUB)                              11610000
117700                                   TO  TRUE                       11620000
117800     ELSE                                                         11630000
117900         MOVE +1                   TO ASC-SEL-ITEM                11640000
118000                                      ASC-SEL-SUB                 11650000
118100*        --- TOP OF LIST ---                                      11660000
118200         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            11670000
118300         SET DP020-MSG-INFORMATIONAL                              11680000
118400                                   TO TRUE                        11690000
118500     END-IF.                                                      11700000
118600                                                                  11710000
118700******************************************************************11720000
118800* GET THE KEYS OF THE NEXT SELECTED OBJECT FROM THE              *11730000
118900* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *11740000
119000******************************************************************11750000
119100 2150-GET-NEXT-PK-RECORD.                                         11760000
119200                                                                  11770000
119300     IF ASC-INTER-APPL-PACK-UPD                                   11780000
119400*--- BOTTOM OF LIST ---                                           11790000
119500             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             11800000
119600             SET DP020-MSG-INFORMATIONAL TO TRUE                  11810000
119700     ELSE                                                         11820000
119800        ADD +1 TO ASC-SEL-SUB                                     11830000
119900                                                                  11840000
120000        IF ASC-SEL-SUB > RC801-MAX-ITEMS                          11850000
120100           ADD  +1 TO ASC-SEL-ITEM                                11860000
120200           MOVE +1 TO ASC-SEL-SUB                                 11870000
120300        END-IF                                                    11880000
120400                                                                  11890000
120500        IF ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS              11900000
120600            PERFORM 9150-READ-SEL-QUEUE                           11910000
120700            IF RC801-ITEM (ASC-SEL-SUB) > ZERO                    11920000
120800                MOVE RC801-REC-LNE-NBR (ASC-SEL-SUB)              11930000
120900                  TO ASC-KEY-PO-LNE-NBR                           11940000
121000                MOVE RC801-PACK-ID (ASC-SEL-SUB)                  11950000
121100                  TO ASC-KEY-PREPK-ID                             11960000
121200                SET RC801-INQ (ASC-SEL-SUB) TO TRUE               11970000
121300                PERFORM 9250-REWRITE-LIST-QUEUE                   11980000
121400            ELSE                                                  11990000
121500                SUBTRACT +1 FROM ASC-SEL-SUB                      12000000
121600*--- BOTTOM OF LIST ---                                           12010000
121700                MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER          12020000
121800                SET DP020-MSG-INFORMATIONAL TO TRUE               12030000
121900            END-IF                                                12040000
122000        ELSE                                                      12050000
122100            SUBTRACT +1 FROM ASC-SEL-ITEM                         12060000
122200            MOVE RC801-MAX-ITEMS TO ASC-SEL-SUB                   12070000
122300            MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER              12080000
122400            SET DP020-MSG-INFORMATIONAL TO TRUE                   12090000
122500        END-IF.                                                   12100000
122600                                                                  12110000
122700******************************************************************12120000
122800* GET THE KEYS OF THE PREVIOUS SELECTED OBJECT FROM THE          *12130000
122900* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *12140000
123000******************************************************************12150000
123100 2160-GET-PREV-PK-RECORD.                                         12160000
123200                                                                  12170000
123300     SUBTRACT +1 FROM ASC-SEL-SUB.                                12180000
123400                                                                  12190000
123500     IF ASC-SEL-SUB < +1                                          12200000
123600         SUBTRACT +1 FROM ASC-SEL-ITEM                            12210000
123700         MOVE RC801-MAX-ITEMS TO ASC-SEL-SUB                      12220000
123800     END-IF.                                                      12230000
123900                                                                  12240000
124000     IF ASC-SEL-ITEM > ZERO                                       12250000
124100         PERFORM 9150-READ-SEL-QUEUE                              12260000
124200         MOVE RC801-REC-LNE-NBR (ASC-SEL-SUB)                     12270000
124300           TO ASC-KEY-PO-LNE-NBR                                  12280000
124400         MOVE RC801-PACK-ID (ASC-SEL-SUB)                         12290000
124500           TO ASC-KEY-PREPK-ID                                    12300000
124600     ELSE                                                         12310000
124700         MOVE +1 TO ASC-SEL-ITEM                                  12320000
124800                    ASC-SEL-SUB                                   12330000
124900*--- TOP OF LIST ---                                              12340000
125000         MOVE PC-TSYMSG-00069        TO DP020-MSG-NUMBER          12350000
125100         SET DP020-MSG-INFORMATIONAL TO TRUE                      12360000
125200     END-IF.                                                      12370000
125300                                                                  12380000
125400*----------------------------------------------------------------*12390000
125500* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS   *12400000
125600* IN THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN   *12410000
125700* THE APPLICATION-SPECIFIC COMMAERA, NOT ON THE SCREEN.          *12420000
125800*----------------------------------------------------------------*12430000
125900                                                                  12440000
126000 2200-MOVE-SCREEN-TO-COMMAREA.                                    12450000
126100                                                                  12460000
126200     IF  ATRBRSNL > ZERO                                          12470000
126300         MOVE ATRBRSNI             TO  ASC-TRBL-RSN-CDE-X         12480000
126400         SET PS-RSN-CDE-ENTERED    TO  TRUE                       12490000
126500     ELSE                                                         12500000
126600         IF  ATRBRSNF = DP015-ERASE-EOF                           12510000
126700             SET ASC-TRBL-RSN-CDE-OK                              12520000
126800                                   TO  TRUE                       12530000
126900             MOVE SPACE            TO  ASC-TRBL-RSN-CDE-X         12540000
127000         END-IF                                                   12550000
127100     END-IF.                                                      12560000
127200                                                                  12570000
127300     IF  ATRBDESL > ZERO                                          12580000
127400         MOVE ATRBDESI             TO  ASC-TRBL-SHT-DESC          12590000
127500         SET PS-RSN-DESC-ENTERED   TO  TRUE                       12600000
127600     ELSE                                                         12610000
127700         IF  ATRBDESF = DP015-ERASE-EOF                           12620000
127800             MOVE SPACE            TO  ASC-TRBL-SHT-DESC          12630000
127900             SET ASC-TRBL-RSN-DESC-OK                             12640000
128000                                   TO  TRUE                       12650000
128100         END-IF                                                   12660000
128200     END-IF.                                                      12670000
128300                                                                  12680000
128400     IF  ATEXT1L > ZERO                                           12690000
128500         MOVE ATEXT1I              TO  ASC-TEXT1                  12700000
128600     ELSE                                                         12710000
128700         IF  ATEXT1F  = DP015-ERASE-EOF                           12720000
128800             MOVE SPACE            TO  ASC-TEXT1                  12730000
128900         END-IF                                                   12740000
129000     END-IF.                                                      12750000
129100                                                                  12760000
129200     IF  ATEXT2L > ZERO                                           12770000
129300         MOVE ATEXT2I              TO  ASC-TEXT2                  12780000
129400     ELSE                                                         12790000
129500         IF  ATEXT2F  = DP015-ERASE-EOF                           12800000
129600             MOVE SPACE            TO  ASC-TEXT2                  12810000
129700         END-IF                                                   12820000
129800     END-IF.                                                      12830000
129900                                                                  12840000
130000     IF  ATEXT3L > ZERO                                           12850000
130100         MOVE ATEXT3I              TO  ASC-TEXT3                  12860000
130200     ELSE                                                         12870000
130300         IF  ATEXT3F  = DP015-ERASE-EOF                           12880000
130400             MOVE SPACE            TO  ASC-TEXT3                  12890000
130500         END-IF                                                   12900000
130600     END-IF.                                                      12910000
130700                                                                  12920000
130800     IF  ATEXT4L > ZERO                                           12930000
130900         MOVE ATEXT4I              TO  ASC-TEXT4                  12940000
131000     ELSE                                                         12950000
131100         IF  ATEXT4F  = DP015-ERASE-EOF                           12960000
131200             MOVE SPACE            TO  ASC-TEXT4                  12970000
131300         END-IF                                                   12980000
131400     END-IF.                                                      12990000
131500                                                                  13000000
131600     IF  ATEXT5L > ZERO                                           13010000
131700         MOVE ATEXT5I              TO  ASC-TEXT5                  13020000
131800     ELSE                                                         13030000
131900         IF  ATEXT5F  = DP015-ERASE-EOF                           13040000
132000             MOVE SPACE            TO  ASC-TEXT5                  13050000
132100         END-IF                                                   13060000
132200     END-IF.                                                      13070000
132300/                                                                 13080000
132400*----------------------------------------------------------------*13090000
132500* PERFORM EDITS ON EACH FIELD ENTERED BY THE USER.  IF AN ERROR  *13100000
132600* IS FOUND, THE CURSOR IS POSITIONED AT THAT FIELD AND AN        *13110000
132700* APPROPRIATE ERROR MESSAGE IS DISPLAYED.                        *13120000
132800*----------------------------------------------------------------*13130000
132900                                                                  13140000
133000 3000-EDIT-DATA-IN-COMMAREA.                                      13150000
133100                                                                  13160000
133200     PERFORM 3200-RESET-ATTRIBUTES.                               13170000
133300                                                                  13180000
133400     IF  ASC-TEXT1 NOT GREATER THAN SPACES                        13190000
133500         SET PS-ERROR              TO  TRUE                       13200000
133600         SET DP020-MSG-FATAL       TO  TRUE                       13210000
133700         MOVE PC-TSYMSG-00005      TO  DP020-MSG-NUMBER           13220000
133800         MOVE DP015-UNP-ALP-BRT-OFF                               13230000
133900                                   TO  ATEXT1A                    13240000
134000         MOVE DP015-RED            TO  ATEXT1C                    13250000
134100         MOVE DP015-REVERSE        TO  ATEXT1H                    13260000
134200         MOVE -1                   TO  ATEXT1L                    13270000
134300     END-IF.                                                      13280000
134400                                                                  13290000
134500     IF (PS-RSN-CDE-ENTERED                                       13300000
134600     OR  ASC-TRBL-RSN-CDE-ERROR)                                  13310000
134700         PERFORM 3010-VALIDATE-REASON-CODE                        13320000
134800     ELSE                                                         13330000
134900         IF (PS-RSN-DESC-ENTERED                                  13340000
135000         OR  ASC-TRBL-RSN-DESC-ERROR)                             13350000
135100             PERFORM 3020-GET-REASON-CODE                         13360000
135200         END-IF                                                   13370000
135300     END-IF.                                                      13380000
                                                                        13390000
           IF ASC-TRBL-RSN-CDE = PC-804                                 13400000
                              OR PC-805                                 13410000
                              OR PC-806                                 13420000
              PERFORM 7020-GET-TRECEIV-PKGNG-CDE.                       13430000
                                                                        13440000
      * CAN ONLY CREATE A PREPACK FALSE AUDIT WHEN THE RECEIVER IS      13450000
      * PREPACK                                                         13460000
135500     IF  PS-ERROR                                                 13470000
135600         CONTINUE                                                 13480000
           ELSE                                                         13490000
               IF ASC-TRBL-RSN-CDE = PC-804                             13500000
                  IF (RECEIV-PKGNG-CDE = 'I'  OR                        13510000
                      RECEIV-PKGNG-CDE = 'M')                           13520000
                     CONTINUE                                           13530000
                  ELSE                                                  13531000
142820               SET DP020-MSG-FATAL                                13532000
142830                   PS-ERROR            TO  TRUE                   13533000
142840               MOVE -1                 TO  ATRBRSNL               13534000
142860               MOVE PC-TSYMSG-03220    TO  DP020-MSG-NUMBER       13535000
                  END-IF                                                13536000
               END-IF                                                   13537000
           END-IF.                                                      13538000
                                                                        13539000
      * CAN ONLY CREATE A BLK/CSE FALSE AUDIT WHEN THE RECEIVER IS      13539100
      * BULK OR CASEPACK                                                13539200
135500     IF  PS-ERROR                                                 13539300
135600         CONTINUE                                                 13539400
           ELSE                                                         13539500
               IF ASC-TRBL-RSN-CDE = PC-805                             13539600
                  IF (RECEIV-PKGNG-CDE = 'B' OR                         13539700
                      RECEIV-PKGNG-CDE = 'C' OR                         13539800
                      RECEIV-PKGNG-CDE = 'S')                           13539900
                     CONTINUE                                           13540000
                  ELSE                                                  13540100
                     SET DP020-MSG-FATAL                                13540200
                         PS-ERROR            TO  TRUE                   13540300
142840               MOVE -1                 TO  ATRBRSNL               13540400
142860               MOVE PC-TSYMSG-03222    TO  DP020-MSG-NUMBER       13540500
                  END-IF                                                13540600
               END-IF                                                   13540700
           END-IF.                                                      13540800
                                                                        13540900
      *  IF PBS - FALSE AUDIT NOTIFY CREATED, MUST BE PBS RECEIVER      13541000
135500     IF  PS-ERROR                                                 13541100
135600         CONTINUE                                                 13541200
           ELSE                                                         13541300
               IF ASC-TRBL-RSN-CDE = PC-806                             13541400
                  IF RECEIV-PACK-BY-ST-IND NOT = 'Y'                    13541500
142820               SET DP020-MSG-FATAL                                13541600
142830                   PS-ERROR            TO  TRUE                   13541700
142840               MOVE -1                 TO  ATRBRSNL               13541800
142860               MOVE PC-TSYMSG-03221    TO  DP020-MSG-NUMBER       13541900
                  END-IF                                                13542000
               END-IF                                                   13542100
           END-IF.                                                      13542200
135400                                                                  13542300
135500     IF  PS-ERROR                                                 13542400
135600         CONTINUE                                                 13542500
135700     ELSE                                                         13542600
135800         IF (ASC-TRBL-RSN-CDE GREATER THAN SPACES                 13542700
135900         AND ASC-TRBL-SHT-DESC GREATER THAN SPACES)               13542800
136000             CONTINUE                                             13542900
136100         ELSE                                                     13543000
136200             SET PS-ERROR          TO  TRUE                       13544000
136300             SET DP020-MSG-FATAL   TO  TRUE                       13545000
136400             MOVE PC-TSYMSG-00005  TO  DP020-MSG-NUMBER           13546000
136500             MOVE DP015-UNP-ALP-BRT-OFF                           13547000
136600                                   TO  ATRBRSNA                   13548000
136700                                       ATRBDESA                   13549000
136800             MOVE DP015-RED        TO  ATRBRSNC                   13550000
136900                                       ATRBDESC                   13560000
137000             MOVE DP015-REVERSE    TO  ATRBRSNH                   13570000
137100                                       ATRBDESH                   13580000
137200             MOVE -1               TO  ATRBRSNL                   13590000
137300         END-IF                                                   13600000
137400     END-IF.                                                      13610000
137500                                                                  13620000
137600     IF  PS-ERROR                                                 13630000
137700         CONTINUE                                                 13640000
137800     ELSE                                                         13650000
137900         IF (ASC-KEY-PO-LNE-NBR = ZERO                            13660000
138000         AND ASC-LINE-LEVEL-TRBL)                                 13670000
138100             SET PS-ERROR          TO  TRUE                       13680000
138200             SET DP020-MSG-FATAL   TO  TRUE                       13690000
138300             MOVE PC-TSYMSG-00738  TO  DP020-MSG-NUMBER           13700000
138400             MOVE DP015-UNP-ALP-BRT-OFF                           13710000
138500                                   TO  ATRBRSNA                   13720000
138600             MOVE DP015-RED        TO  ATRBRSNC                   13730000
138700             MOVE DP015-REVERSE    TO  ATRBRSNH                   13740000
138800             MOVE -1               TO  ATRBRSNL                   13750000
138900         END-IF                                                   13760000
139000     END-IF.                                                      13770000
139100                                                                  13780000
139200     IF PS-ERROR                                                  13790000
139300         CONTINUE                                                 13800000
139400     ELSE                                                         13810000
139500         IF (ASC-KEY-PREPK-ID = ZERO                              13820000
139600           AND ASC-PACK-LEVEL-TRBL)                               13830000
139700             SET PS-ERROR          TO  TRUE                       13840000
139800             SET DP020-MSG-FATAL   TO  TRUE                       13850000
139900             MOVE PC-TSYMSG-00057  TO  DP020-MSG-NUMBER           13860000
140000             MOVE DP015-UNP-ALP-BRT-OFF                           13870000
140100                                   TO  ATRBRSNA                   13880000
140200             MOVE DP015-RED        TO  ATRBRSNC                   13890000
140300             MOVE DP015-REVERSE    TO  ATRBRSNH                   13900000
140400             MOVE -1               TO  ATRBRSNL                   13910000
140500         END-IF                                                   13920000
140600     END-IF.                                                      13930000
140700                                                                  13940000
140800     IF  PS-ERROR                                                 13950000
140900         CONTINUE                                                 13960000
141000     ELSE                                                         13970000
141100         IF (ASC-KEY-PO-LNE-NBR > ZERO                            13980000
141200         AND ASC-PO-LEVEL-TRBL)                                   13990000
141300             SET PS-ERROR          TO  TRUE                       14000000
141400             SET DP020-MSG-FATAL   TO  TRUE                       14010000
141500             MOVE PC-TSYMSG-01253  TO  DP020-MSG-NUMBER           14020000
141600             MOVE DP015-UNP-ALP-BRT-OFF                           14030000
141700                                   TO  ATRBRSNA                   14040000
141800             MOVE DP015-RED        TO  ATRBRSNC                   14050000
141900             MOVE DP015-REVERSE    TO  ATRBRSNH                   14060000
142000             MOVE -1               TO  ATRBRSNL                   14070000
142100         END-IF                                                   14080000
142200     END-IF.                                                      14090000
142300                                                                  14100000
142400     IF  PS-NO-ERROR                                              14110000
142500         EVALUATE TRUE                                            14120000
142600             WHEN ASC-PO-LEVEL-TRBL                               14130000
142700                 PERFORM 3040-FETCH-TRECEIV                       14140000
142800                 IF  RECEIV-STATUS-CDE = PC-VERIFIED-STATUS       14150000
152000                    IF (ASC-TRBL-RSN-CDE   = PC-802 OR            14160000
152000                        ASC-TRBL-RSN-CDE = PC-804 OR              14170000
152000                        ASC-TRBL-RSN-CDE = PC-805 OR              14180000
152000                        ASC-TRBL-RSN-CDE = PC-806)                14190000
                             CONTINUE                                   14200000
                           ELSE                                         14210000
142820                        SET DP020-MSG-FATAL                       14220000
142830                            PS-ERROR  TO  TRUE                    14230000
142840                        MOVE -1       TO  ATRBRSNL                14240000
142850                        MOVE PC-TSYMSG-01250                      14250000
142860                                       TO  DP020-MSG-NUMBER       14260000
                           END-IF                                       14270000
142870                 ELSE                                             14280000
142880                     IF ASC-TRBL-RSN-CDE = PC-997                 14281000
142890                                 OR PC-998 OR PC-999              14282000
142900                         PERFORM                                  14283000
143000                              3004-CHK4-UNRSLVD-STORTRBL          14284000
143100                         IF PS-UNRSLVD-STORTRBL-NOTFND            14285000
143200                             PERFORM                              14286000
143300                                  3003-CHK-TROUBLE-REASON         14287000
143400                         ELSE                                     14288000
143500                             SET DP020-MSG-FATAL                  14289000
143600                                 PS-ERROR  TO  TRUE               14290000
143700                             MOVE -1       TO  ATRBRSNL           14300000
143800*** MSG-'STORAGE TROUBLE ALREADY EXISTS FOR THIS RECEIVER'        14310000
143900                             MOVE PC-TSYMSG-01672                 14320000
144000                                    TO  DP020-MSG-NUMBER          14330000
144100                         END-IF                                   14340000
144200                     END-IF                                       14350000
144300                 END-IF                                           14360000
144400                                                                  14370000
144500             WHEN ASC-PACK-LEVEL-TRBL                             14380000
144600                 EVALUATE TRUE                                    14390000
144700                   WHEN ASC-TRBL-RSN-CDE = 263                    14400000
144800                       PERFORM 3005-CHECK-PACK-STATUS             14410000
144900                   WHEN OTHER                                     14420000
145000                       PERFORM 3002-DOES-LINE-EXIST               14430000
145100                 END-EVALUATE                                     14440000
145200                                                                  14450000
145300             WHEN ASC-LINE-LEVEL-TRBL                             14460000
145400                 EVALUATE TRUE                                    14470000
145500                 WHEN ASC-TRBL-RSN-CDE = 528 OR 529 OR 535        14480000
145600                     PERFORM 3001-CHECK-LINE-STATUS               14490000
145700                 WHEN ASC-TRBL-RSN-CDE = 530 OR 531 OR 150        14500000
145800                     CONTINUE                                     14510000
145900                 WHEN OTHER                                       14520000
146000                     PERFORM 3002-DOES-LINE-EXIST                 14530000
146100                 END-EVALUATE                                     14540000
146200                                                                  14550000
146300     WHEN OTHER                                                   14560000
146400         SET DP020-MSG-FATAL                                      14570000
146500         PS-ERROR            TO  TRUE                             14580000
146600         MOVE -1                 TO  ATRBRSNL                     14590000
146700         MOVE PC-TSYMSG-01252    TO  DP020-MSG-NUMBER             14600000
146800         END-EVALUATE                                             14610000
146900     END-IF.                                                      14620000
147000                                                                  14630000
147100     SET DP030-SET-CURSOR-APPL-1   TO  TRUE.                      14640000
147200     IF  NOT PS-ERROR                                             14650000
147300         MOVE -1                   TO  ATRBRSNL                   14660000
147400     END-IF.                                                      14670000
147500                                                                  14680000
147600 3001-CHECK-LINE-STATUS.                                          14690000
147700                                                                  14700000
147800     PERFORM 7000-SELECT-TPURITM-STATUS                           14710000
147900                                                                  14720000
148000     IF SQLCODE = +100                                            14730000
148100         SET DP020-MSG-FATAL                                      14740000
148200         PS-ERROR    TO  TRUE                                     14750000
148300         MOVE -1     TO  ATRBRSNL                                 14760000
148400         MOVE PC-TSYMSG-01247                                     14770000
148500                     TO  DP020-MSG-NUMBER                         14780000
148600     ELSE                                                         14790000
148700         EVALUATE ASC-TRBL-RSN-CDE                                14800000
148800             WHEN 528                                             14810000
148900                 IF PURITM-STATUS-CDE = 'CA'                      14820000
149000                     CONTINUE                                     14830000
149100                 ELSE                                             14840000
149200                     SET DP020-MSG-FATAL                          14850000
149300                     PS-ERROR    TO  TRUE                         14860000
149400                     MOVE -1     TO  ATRBRSNL                     14870000
149500                     MOVE PC-TSYMSG-01294                         14880000
149600                                 TO  DP020-MSG-NUMBER             14890000
149700                 END-IF                                           14900000
149800             WHEN 529                                             14910000
149900                 IF PURITM-STATUS-CDE = 'CM'                      14920000
150000                     CONTINUE                                     14930000
150100                 ELSE                                             14940000
150200                     SET DP020-MSG-FATAL                          14950000
150300                     PS-ERROR    TO  TRUE                         14960000
150400                     MOVE -1     TO  ATRBRSNL                     14970000
150500                     MOVE PC-TSYMSG-01294                         14980000
150600                                 TO  DP020-MSG-NUMBER             14990000
150700                 END-IF                                           15000000
150800             WHEN 535                                             15010000
150900                 IF PURITM-STATUS-CDE = 'RV'                      15020000
151000                     CONTINUE                                     15030000
151100                 ELSE                                             15040000
151200                     SET DP020-MSG-FATAL                          15050000
151300                     PS-ERROR    TO  TRUE                         15060000
151400                     MOVE -1     TO  ATRBRSNL                     15070000
151500                     MOVE PC-TSYMSG-01294                         15080000
151510                                 TO  DP020-MSG-NUMBER             15090000
151520                 END-IF                                           15100000
151530         END-EVALUATE                                             15110000
151540     END-IF.                                                      15120000
151550                                                                  15130000
151560 3002-DOES-LINE-EXIST.                                            15140000
151570                                                                  15150000
151580     PERFORM 3050-FETCH-TPURITM.                                  15151000
151590                                                                  15152000
151600     IF  PV-DB2-COUNT > 0                                         15153000
151700         PERFORM 3060-FETCH-TRECITM                               15154000
151800         IF SQLCODE = ZERO                                        15155000
151900             IF RECITM-STATUS-CDE = PC-VERIFIED-STATUS            15156000
152000                IF (ASC-TRBL-RSN-CDE = PC-801 OR                  15157000
152000                    ASC-TRBL-RSN-CDE = PC-804 OR                  15158000
152000                    ASC-TRBL-RSN-CDE = PC-805 OR                  15159000
152000                    ASC-TRBL-RSN-CDE = PC-806)                    15160000
                          CONTINUE                                      15170000
                      ELSE                                              15180000
152100                    SET DP020-MSG-FATAL                           15190000
152200                    PS-ERROR    TO  TRUE                          15200000
152300                    MOVE -1     TO  ATRBRSNL                      15210000
152400                    MOVE PC-TSYMSG-01251                          15220000
152500                             TO  DP020-MSG-NUMBER                 15230000
152600                END-IF                                            15240000
152600             END-IF                                               15250000
152700         ELSE                                                     15260000
152800             SET DP020-MSG-FATAL                                  15270000
152900             PS-ERROR        TO  TRUE                             15280000
153000             MOVE -1         TO  ATRBRSNL                         15290000
153100             MOVE PC-TSYMSG-01255                                 15300000
153200                             TO  DP020-MSG-NUMBER                 15310000
153300         END-IF                                                   15320000
153400     ELSE                                                         15330000
153500         SET DP020-MSG-FATAL                                      15340000
153600         PS-ERROR        TO  TRUE                                 15350000
153700         MOVE -1             TO  ATRBRSNL                         15360000
153800         MOVE PC-TSYMSG-01247                                     15370000
153900                         TO  DP020-MSG-NUMBER                     15380000
154000     END-IF.                                                      15390000
154100                                                                  15400000
154200*----------------------------------------------------------------*15410000
154300*    CHECK FOR TROUBLE REASON 997 & 998 - STORAGE OFFSITE (997)  *15420000
154400*    AND  STORAGE - OFF AND ON  (998) WHEN THE RECEIVER IS       *15430000
154500*    ENROUTE.                                                    *15440000
154600*    TROUBLE REASON 999 - STORAGE - ON-SITE IF THE RECEIVER HAS  *15450000
154700*    ARRIVED.                                                    *15460000
154800*----------------------------------------------------------------*15470000
154900 3003-CHK-TROUBLE-REASON.                                         15480000
155000     EVALUATE TRUE                                                15490000
155100     WHEN  ASC-TRBL-RSN-CDE = 997 OR 998                          15500000
155200         IF (RECEIV-REC-TMST  = PC-DB2-DEFAULT-TMST)              15510000
155300             CONTINUE                                             15520000
155400         ELSE                                                     15530000
155500             SET DP020-MSG-FATAL                                  15540000
155600                        PS-ERROR  TO  TRUE                        15550000
155700             MOVE -1       TO  ATRBRSNL                           15560000
155800             MOVE PC-TSYMSG-01640 TO  DP020-MSG-NUMBER            15570000
155900         END-IF                                                   15580000
156000     WHEN ASC-TRBL-RSN-CDE = 999                                  15590000
156100         IF  (RECEIV-REC-TMST NOT EQUAL PC-DB2-DEFAULT-TMST)      15600000
156200              CONTINUE                                            15610000
156300         ELSE                                                     15620000
156400             SET DP020-MSG-FATAL                                  15630000
156500                        PS-ERROR  TO  TRUE                        15640000
156600             MOVE -1       TO  ATRBRSNL                           15650000
156700             MOVE PC-TSYMSG-01641  TO  DP020-MSG-NUMBER           15660000
156800         END-IF.                                                  15670000
156900                                                                  15680000
157000 3004-CHK4-UNRSLVD-STORTRBL.                                      15690000
157100     SET PS-UNRSLVD-STORTRBL-NOTFND TO TRUE.                      15700000
157200     INITIALIZE PV-DB2-COUNT                                      15710000
157300     PERFORM                                                      15720000
157400         WITH TEST AFTER                                          15730000
157500         VARYING PV-RETRY-COUNTER                                 15740000
157600         FROM 1 BY 1                                              15750000
157700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15760000
157800            OR  (SQLCODE = +0)                                    15770000
157900            OR  (SQLCODE = +100))                                 15780000
158000                                                                  15790000
158100         EXEC SQL                                                 15800000
158200             SELECT COUNT(*)                                      15810000
158300               INTO :PV-DB2-COUNT                                 15820000
158400               FROM TTRBNTF                                       15830000
158500              WHERE PO_NBR            = :ASC-KEY-PO-NBR           15840000
158600                AND REC_SEQ_NBR       = :ASC-KEY-REC-SEQ-NBR      15850000
158700                AND RESOLVED_IND  IN (:PC-N, :PC-I)               15860000
158800                AND TRBL_RSN_CDE  IN (:PC-997, :PC-998, :PC-999)  15870000
158900         END-EXEC                                                 15880000
159000                                                                  15890000
159100         EVALUATE TRUE                                            15900000
159200             WHEN SQLCODE  = +0                                   15910000
159300             WHEN SQLCODE  = +100                                 15920000
159400             WHEN SQLCODE  = -904                                 15930000
159500             WHEN SQLCODE  = -913                                 15940000
159600                 CONTINUE                                         15950000
159700             WHEN SQLWARN0 NOT = SPACE                            15960000
159800             WHEN SQLCODE  <  +0                                  15970000
159900             WHEN SQLCODE  >  +0                                  15980000
160000                 MOVE '3004-CHK4-UNRSLVD-STORTRBL'                15990000
160100                                   TO DP013-PARAGRAPH             16000000
160200                 MOVE 'COUNT ON TTRBNTF'                          16010000
160300                                   TO DP013-MESSAGE-TEXT (1)      16020000
160400                 MOVE SQLCA        TO DP013-SQLCA                 16030000
160500                 MOVE 'TTRBNTF'    TO DP013-DB2-TABLE-NAME (1)    16040000
160600                 SET DP013-DB2-ABEND TO TRUE                      16050000
160700                 SET DP013-XCTL-DISPLAY-RESTART TO TRUE           16060000
160800                 PERFORM DP013-0000-PROCESS-ABEND                 16070000
160900         END-EVALUATE                                             16080000
161000     END-PERFORM.                                                 16090000
161100                                                                  16100000
161200     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         16110000
161300         AND (SQLCODE = -904 OR -913)                             16120000
161400         MOVE '3004-CHK4-UNRSLVD-STORTRBL'                        16130000
161500                              TO DP013-PARAGRAPH                  16140000
161600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO'            16150000
161700                              TO DP013-MESSAGE-TEXT (1)           16160000
161800         MOVE 'SELECT ON TTRBNTF'                                 16170000
161900                              TO DP013-MESSAGE-TEXT (2)           16180000
162000         MOVE SQLCA        TO DP013-SQLCA                         16190000
162100         MOVE 'TTRBNTF'    TO DP013-DB2-TABLE-NAME (1)            16200000
162200         SET DP013-DB2-ABEND TO TRUE                              16210000
162300         SET DP013-XCTL-DISPLAY-RESTART TO TRUE                   16220000
162400         PERFORM DP013-0000-PROCESS-ABEND                         16230000
162500     END-IF.                                                      16240000
162600                                                                  16250000
162700     IF PV-DB2-COUNT = 0                                          16260000
162800         SET PS-UNRSLVD-STORTRBL-NOTFND TO TRUE                   16270000
162900     ELSE                                                         16280000
163000         SET PS-UNRSLVD-STORTRBL-FND    TO TRUE                   16290000
163100     END-IF.                                                      16300000
163200                                                                  16310000
163300 3005-CHECK-PACK-STATUS.                                          16320000
163400                                                                  16330000
163500     PERFORM 3055-FETCH-TPURITM.                                  16340000
163600                                                                  16350000
163700     IF PV-DB2-COUNT > 0                                          16360000
163800         PERFORM 3060-FETCH-TRECITM                               16370000
163900         IF SQLCODE = ZERO                                        16380000
164000             IF RECITM-STATUS-CDE = PC-VERIFIED-STATUS            16390000
152000                IF (ASC-TRBL-RSN-CDE   = PC-801 OR                16400000
152000                      ASC-TRBL-RSN-CDE = PC-804 OR                16401000
152000                      ASC-TRBL-RSN-CDE = PC-805 OR                16402000
152000                      ASC-TRBL-RSN-CDE = PC-806)                  16403000
                          CONTINUE                                      16404000
                      ELSE                                              16405000
164200                   SET DP020-MSG-FATAL                            16406000
164300                     PS-ERROR           TO TRUE                   16407000
164400                   MOVE -1              TO ATRBRSNL               16408000
164500                   MOVE PC-TSYMSG-01251 TO DP020-MSG-NUMBER       16409000
164600                END-IF                                            16410000
164600             END-IF                                               16420000
164700         ELSE                                                     16430000
164800             SET DP020-MSG-FATAL                                  16440000
164900                 PS-ERROR         TO TRUE                         16450000
165000             MOVE -1              TO ATRBRSNL                     16460000
165100             MOVE PC-TSYMSG-01255 TO DP020-MSG-NUMBER             16470000
165200         END-IF                                                   16480000
165300     ELSE                                                         16490000
165400         SET DP020-MSG-FATAL                                      16500000
165500             PS-ERROR         TO TRUE                             16510000
165600         MOVE -1              TO ATRBRSNL                         16520000
165700         MOVE PC-TSYMSG-01247 TO DP020-MSG-NUMBER                 16530000
165800     END-IF.                                                      16540000
165900                                                                  16550000
166000*----------------------------------------------------------------*16560000
166100*    FIRST, ENSURE THE REASON CODE ENTERED IS NUMERIC.  NEXT,    *16570000
166200*    SEE IF IT EXISTS ON THE TTRBRSN TABLE.                      *16580000
166300*----------------------------------------------------------------*16590000
166400                                                                  16600000
166500 3010-VALIDATE-REASON-CODE.                                       16610000
166600**ADDED LOGIC TO GET AND CHECK E-BUS-IND WHEN A 402 OR 403 OR 404 16620000
166600**RSN-CDE IS FOUND (WR38216)                                      16630000
166600                                                                  16640000
166700     MOVE ASC-TRBL-RSN-CDE-X       TO  DP010I-UNEDITED-FIELD.     16650000
166800     MOVE PC-3                     TO  DP010I-MAXIMUM-DIGITS.     16660000
166900     MOVE ZERO                     TO  DP010I-MAXIMUM-DECIMALS.   16670000
167000     SET DP010I-NEGATIVE-NOT-ALLOWED                              16680000
167100                                   TO  TRUE.                      16690000
263627     CALL DP010I-NUMERIC-EDIT-ROUTINE                             16701006
263627          USING DP010I-NUMERIC-EDIT-AREA.                         16702006
167300                                                                  16710000
167400     IF  DP010I-ERROR-DETECTED                                    16720000
167500         SET DP020-MSG-FATAL                                      16730000
167600             ASC-TRBL-RSN-CDE-ERROR                               16740000
167700             PS-ERROR              TO  TRUE                       16750000
167800         MOVE PC-TSYMSG-00008      TO  DP020-MSG-NUMBER           16760000
167900         MOVE DP015-UNP-ALP-BRT-OFF                               16770000
168000                                   TO  ATRBRSNA                   16780000
168100         MOVE DP015-RED            TO  ATRBRSNC                   16790000
168200         MOVE DP015-REVERSE        TO  ATRBRSNH                   16800000
168300         MOVE -1                   TO  ATRBRSNL                   16810000
168400     ELSE                                                         16820000
168500         MOVE DP010I-NUMERIC-FIELD TO  ASC-TRBL-RSN-CDE           16830000
168600                                       PV-TRBL-RSN-CDE            16840000
168700         MOVE PV-TRBL-RSN-CDE      TO  TRBRSN-TRBL-RSN-CDE        16850000
168800         PERFORM 3011-SELECT-TTRBRSN-BY-CODE                      16860000
168900         IF ASC-TRBL-RSN-CDE-ERROR                                16870000
169000             CONTINUE                                             16880000
169100         ELSE                                                     16890000
169200             IF TRBRSN-ALLOW-CRE-BY-IND EQUAL 'M'                 16900000
169300                 MOVE TRBRSN-TRBL-RSN-CDE                         16910000
169400                                       TO PV-REASON-CHECKER       16920000
169500                 IF PV-VERIFIED-ADJUSTMENT                        16930000
169600                     SET ASC-TRBL-RSN-CDE-ERROR                   16940000
169700                         PS-ERROR     TO TRUE                     16950000
169800                     MOVE PC-TSYMSG-01246                         16960000
169900                                     TO  DP020-MSG-NUMBER         16970000
170000                     MOVE DP015-UNP-ALP-BRT-OFF                   16980000
170100                                      TO ATRBRSNA                 16990000
170200                     MOVE DP015-RED   TO  ATRBRSNC                17000000
170300                     MOVE DP015-REVERSE TO ATRBRSNH               17010000
170400                     MOVE -1          TO  ATRBRSNL                17020000
170500                 ELSE                                             17030000
170600                     CONTINUE                                     17040000
170700             ELSE                                                 17050000
170800                 SET ASC-TRBL-RSN-CDE-ERROR                       17060000
170900                     PS-ERROR         TO TRUE                     17070000
171000                 MOVE PC-TSYMSG-01246 TO DP020-MSG-NUMBER         17080000
171100                 MOVE DP015-UNP-ALP-BRT-OFF                       17090000
171200                                      TO  ATRBRSNA                17100000
171300                 MOVE DP015-RED       TO  ATRBRSNC                17110000
171400                 MOVE DP015-REVERSE   TO  ATRBRSNH                17120000
171500                 MOVE -1              TO  ATRBRSNL                17130000
171600             END-IF                                               17140000
171700         END-IF                                                   17150000
171800     END-IF.                                                      17160000
171900                                                                  17170000
172000*  CHECK WEB TROUBLES AGAINST E-COMMERECE WAREHOUSE               17180000
                                                                        17190000
172100     PERFORM 3022-RETRIVE-EBUS-IND.                               17200000
                                                                        17210000
172200     IF ((ASC-TRBL-RSN-CDE = 402 OR 403 OR 404)                   17220000
172300         AND (XL071-E-BUS-IND NOT = 'Y'                           17230000
206700               OR XL071-LOC-TYP-CDE NOT = 'DC'))                  17230100
172310             SET ASC-TRBL-RSN-CDE-ERROR                           17230200
172320                 PS-ERROR                  TO TRUE                17230300
172330             SET DP020-MSG-FATAL           TO TRUE                17230400
172340             MOVE PC-TSYMSG-02614                                 17230500
172350                              TO DP020-MSG-NUMBER                 17230600
172360             MOVE DP015-UNP-ALP-BRT-OFF    TO ATRBRSNA            17230700
172370             MOVE DP015-RED                TO ATRBRSNC            17230800
172380             MOVE DP015-REVERSE            TO ATRBRSNH            17230900
172381             MOVE -1                       TO ATRBRSNL            17231000
172382     END-IF.                                                      17232000
172383                                                                  17233000
172384/                                                                 17234000
172385 3011-SELECT-TTRBRSN-BY-CODE.                                     17235000
172386                                                                  17236000
172387     EXEC SQL                                                     17237000
172388          SELECT                                                  17238000
172389                 TRBL_SHT_DESC                                    17239000
172390               , TRBL_LONG_DESC                                   17239100
172400               , ALLOW_CRE_BY_IND                                 17239200
172500               , TRBL_LVL_IND                                     17239300
172600         INTO                                                     17239400
172700                :ASC-TRBL-SHT-DESC                                17239500
172800               ,:ASC-TRBL-LONG-DESC                               17239600
172900               ,:TRBRSN-ALLOW-CRE-BY-IND                          17239700
173000               ,:ASC-TRBL-LVL-IND                                 17239800
173100         FROM                                                     17239900
173200                 TTRBRSN                                          17240000
173300         WHERE                                                    17250000
173400                 TRBL_RSN_CDE       =  :TRBRSN-TRBL-RSN-CDE       17260000
173500     END-EXEC.                                                    17270000
173600                                                                  17280000
173700     EVALUATE TRUE                                                17290000
173800         WHEN SQLCODE = ZERO                                      17300000
173900              SET ASC-TRBL-RSN-CDE-OK TO TRUE                     17310000
174000         WHEN SQLCODE = +100                                      17320000
174100              SET ASC-TRBL-RSN-CDE-ERROR                          17330000
174200                  PS-ERROR         TO TRUE                        17340000
174300              MOVE PC-TSYMSG-00148 TO  DP020-MSG-NUMBER           17350000
174400              MOVE DP015-UNP-ALP-BRT-OFF                          17360000
174500                                   TO  ATRBRSNA                   17370000
174600              MOVE DP015-RED       TO  ATRBRSNC                   17380000
174700              MOVE DP015-REVERSE   TO  ATRBRSNH                   17390000
174800              MOVE -1              TO  ATRBRSNL                   17400000
174900         WHEN SQLCODE = -904                                      17410000
175000         WHEN SQLCODE = -913                                      17420000
175100              PERFORM 9900-SOFT-ABORT                             17430000
175200         WHEN SQLWARN0 NOT = SPACES                               17440000
175300         WHEN SQLCODE NOT EQUAL ZERO                              17450000
175400              MOVE '3011-SELECT-TTRBRSN-BY-CODE'                  17460000
175500                                   TO DP013-PARAGRAPH             17470000
175600              MOVE 'SELECT TTRBRSN BY TROUBLE CODE'               17480000
175700                                   TO DP013-MESSAGE-TEXT (1)      17490000
175800              MOVE SQLCA           TO DP013-SQLCA                 17500000
175900              MOVE 'TTRBRSN'       TO DP013-DB2-TABLE-NAME (1)    17510000
176000              SET DP013-DB2-ABEND                                 17520000
176100                 DP013-XCTL-DISPLAY-RESTART                       17530000
176200                                   TO TRUE                        17540000
176300              PERFORM DP013-0000-PROCESS-ABEND                    17550000
176400     END-EVALUATE.                                                17560000
176500/                                                                 17570000
176600*----------------------------------------------------------------*17580000
176700*    FIRST, SET UP THE HOST VARIABLE. NEXT, SEE IF WE GET A      *17590000
176800*    UNIQUE HIT ON THE TTRBRSN TABLE.                            *17600000
176900*----------------------------------------------------------------*17610000
177000                                                                  17620000
177100 3020-GET-REASON-CODE.                                            17630000
177200                                                                  17640000
177300     MOVE  ASC-TRBL-SHT-DESC       TO  PV-TRBL-SHT-DESC-LOW       17650000
177400                                       PV-TRBL-SHT-DESC-HIGH.     17660000
177500     INSPECT PV-TRBL-SHT-DESC-LOW  CONVERTING '*' TO ' '.         17670000
177600     INSPECT PV-TRBL-SHT-DESC-HIGH CONVERTING '*' TO '9'.         17680000
177700     PERFORM 3021-SELECT-TTRBRSN-BY-DESC.                         17690000
177800                                                                  17700000
177900 3021-SELECT-TTRBRSN-BY-DESC.                                     17710000
178000                                                                  17720000
178100     EXEC SQL                                                     17730000
178200          SELECT                                                  17740000
178300                 TRBL_RSN_CDE                                     17750000
178400               , TRBL_SHT_DESC                                    17760000
178500               , TRBL_LONG_DESC                                   17770000
178600               , TRBL_LVL_IND                                     17780000
178700         INTO                                                     17790000
178800                :TRBRSN-TRBL-RSN-CDE                              17800000
178900               ,:ASC-TRBL-SHT-DESC                                17810000
179000               ,:ASC-TRBL-LONG-DESC                               17820000
179100               ,:ASC-TRBL-LVL-IND                                 17830000
179200         FROM                                                     17840000
179300                 TTRBRSN                                          17850000
179400         WHERE                                                    17860000
179500                 TRBL_SHT_DESC  BETWEEN :PV-TRBL-SHT-DESC-LOW     17870000
179600                                  AND   :PV-TRBL-SHT-DESC-HIGH    17880000
179700          AND    ALLOW_CRE_BY_IND   =  :PC-M                      17890000
179800     END-EXEC.                                                    17900000
179900                                                                  17910000
180000     EVALUATE TRUE                                                17920000
180100         WHEN SQLCODE = ZERO                                      17930000
180200              SET ASC-TRBL-RSN-DESC-OK TO TRUE                    17940000
180300              MOVE TRBRSN-TRBL-RSN-CDE TO ASC-TRBL-RSN-CDE        17950000
180400         WHEN SQLCODE = +100                                      17960000
180500              SET ASC-TRBL-RSN-DESC-ERROR                         17970000
180600                  PS-ERROR         TO TRUE                        17980000
180700              MOVE PC-TSYMSG-00148 TO DP020-MSG-NUMBER            17990000
180800         WHEN SQLCODE = -811                                      18000000
180900              SET PS-ERROR         TO TRUE                        18010000
181000              MOVE 'NNNNN-N-REASON TEXT NOT UNIQUE ENOUGH'        18020000
181100                                   TO DP020-MSG-MESSAGE           18030000
181200         WHEN SQLCODE = -904                                      18040000
181300         WHEN SQLCODE = -913                                      18050000
181400              PERFORM 9900-SOFT-ABORT                             18060000
181500         WHEN SQLWARN0 NOT = SPACES                               18070000
181600         WHEN SQLCODE NOT EQUAL ZERO                              18080000
181700              MOVE '3021-SELECT-TTRBRSN-BY-DESC'                  18090000
181800                                   TO DP013-PARAGRAPH             18100000
181900              MOVE 'SELECT TTRBRSN BY SHORT DESCRIPTION'          18110000
182000                                   TO DP013-MESSAGE-TEXT (1)      18120000
182100              MOVE SQLCA           TO DP013-SQLCA                 18130000
182200              MOVE 'TTRBRSN'       TO DP013-DB2-TABLE-NAME (1)    18140000
182300              SET DP013-DB2-ABEND                                 18150000
182400                 DP013-XCTL-DISPLAY-RESTART                       18160000
182500                                   TO TRUE                        18170000
182600              PERFORM DP013-0000-PROCESS-ABEND                    18180000
182700     END-EVALUATE.                                                18190000
182800/                                                                 18200000
204800*----------------------------------------------------------------*18210000
204900*    GET THE E_BUS_IND ON XTL_LOC TABLE FOR OPER-UNIT-ID        * 18220000
205000*----------------------------------------------------------------*18230000
205100                                                                  18240000
205200 3022-RETRIVE-EBUS-IND.                                           18250000
205300**ADDED FOR (WR38216)                                             18260000
205300                                                                  18270000
205400     INITIALIZE XL071-COMMAREA-REC.                               18280000
205500                                                                  18281000
205600     MOVE ASC-KEY-OPER-UNT-ID   TO PV-UNPACK-OPER-UNT-ID.         18282000
205700     MOVE PV-UNPACK-OPER-UNT-ID TO XL071-LOCATION-NUMBER.         18283000
205800                                                                  18284000
205900     CALL XL071-LOCATION-MODULE USING DFHEIBLK                    18285000
206000                                      XL071-COMMAREA              18286000
206100                                      XL071-COMMAREA-REC.         18287000
206200                                                                  18288000
206300     EVALUATE TRUE                                                18289000
206400         WHEN XL071-NO-ERRORS                                     18289100
206500             CONTINUE                                             18289200
206600         WHEN XL071-LOC-NOT-FOUND                                 18289300
206700              MOVE 'N' TO XL071-E-BUS-IND                         18289400
206700              MOVE 'XX' TO XL071-LOC-TYP-CDE                      18289500
206800         WHEN XL071-SQLCODE-N = -904                              18289600
206900         WHEN XL071-SQLCODE-N = -913                              18289700
206700              MOVE 'N' TO XL071-E-BUS-IND                         18289800
206700              MOVE 'XX' TO XL071-LOC-TYP-CDE                      18289900
207000              PERFORM 9900-SOFT-ABORT                             18290000
207100         WHEN XL071-BAD-DB2-RETURN                                18290100
207200              MOVE '3022-RETRIVE-EBUS-IND'                        18290200
207300                                   TO DP013-PARAGRAPH             18290300
207400              MOVE 'GET THE E_BUS_IND ON XTL'                     18290400
207500                                   TO DP013-MESSAGE-TEXT (1)      18290500
207600              MOVE SQLCA           TO DP013-SQLCA                 18290600
207700              MOVE 'XLT_LOC'       TO DP013-DB2-TABLE-NAME (1)    18290700
207800              SET DP013-DB2-ABEND                                 18290800
207900                 DP013-XCTL-DISPLAY-RESTART                       18290900
208000                                   TO TRUE                        18291000
208100              PERFORM DP013-0000-PROCESS-ABEND                    18291100
208600     END-EVALUATE.                                                18291200
204700/                                                                 18291300
182900*----------------------------------------------------------------*18291400
183000*    CHECK TO SEE IF THE RECEIVER EXISTS.  FETCH THE RECEIVER    *18291500
183100*    STATUS CODE TO DETERMINE IF THE RECEIVER HAS BEEN VERIFIED. *18291600
183200*----------------------------------------------------------------*18291700
183300                                                                  18291800
183400 3040-FETCH-TRECEIV.                                              18291900
183500                                                                  18292000
183600     INITIALIZE DCLTRECEIV.                                       18293000
183700                                                                  18294000
183800     EXEC SQL                                                     18295000
183900         SELECT                                                   18296000
184000                 STATUS_CDE                                       18297000
184100              ,  REC_TMST                                         18298000
184200         INTO                                                     18299000
184300                :RECEIV-STATUS-CDE                                18300000
184400              , :RECEIV-REC-TMST                                  18310000
184500         FROM                                                     18320000
184600                 TRECEIV                                          18330000
184700         WHERE                                                    18340000
184800                 OPER_UNT_ID        =  :ASC-KEY-OPER-UNT-ID       18350000
184900          AND    FCLTY_ID           =  :ASC-KEY-FCLTY-ID          18360000
185000          AND    ORD_NBR            =  :ASC-KEY-PO-NBR            18370000
185100          AND    REC_SEQ_NBR        =  :ASC-KEY-REC-SEQ-NBR       18380000
185200          AND    VER_STATUS_CDE     =  :PC-ACTIVE-STATUS          18390000
185300     END-EXEC.                                                    18400000
185400                                                                  18410000
185500     EVALUATE TRUE                                                18420000
185600         WHEN SQLCODE = ZERO                                      18430000
185700              CONTINUE                                            18440000
185800         WHEN SQLCODE = +100                                      18450000
185900              SET PS-ERROR         TO TRUE                        18460000
                                                                        18470000
186000             MOVE PC-TSYMSG-01249 TO DP020-MSG-NUMBER             18480000
                                                                        18490000
186100         WHEN SQLCODE = -904                                      18500000
186200         WHEN SQLCODE = -913                                      18510000
186300              PERFORM 9900-SOFT-ABORT                             18520000
186400         WHEN SQLWARN0 NOT = SPACES                               18530000
186500         WHEN SQLCODE NOT EQUAL ZERO                              18540000
186600              MOVE '3040-FETCH-TRECEIV'                           18550000
186700                                   TO DP013-PARAGRAPH             18560000
186800              MOVE 'SELECT RECEIVER INFORMATION'                  18570000
186900                                   TO DP013-MESSAGE-TEXT (1)      18580000
187000              MOVE SQLCA           TO DP013-SQLCA                 18590000
187100              MOVE 'TRECEIV'       TO DP013-DB2-TABLE-NAME (1)    18600000
187200              SET DP013-DB2-ABEND                                 18610000
187300                 DP013-XCTL-DISPLAY-RESTART                       18620000
187400                                   TO TRUE                        18630000
187500              PERFORM DP013-0000-PROCESS-ABEND                    18640000
187600     END-EVALUATE.                                                18650000
187700/                                                                 18660000
187800*----------------------------------------------------------------*18670000
187900*    CHECK TO SEE IF THE SPECIFIED LINE EXISTS FOR THIS PO.      *18680000
188000*----------------------------------------------------------------*18690000
188100                                                                  18700000
188200 3050-FETCH-TPURITM.                                              18710000
188300                                                                  18720000
188400     INITIALIZE PV-DB2-COUNT.                                     18730000
188500                                                                  18740000
188600     EXEC SQL                                                     18750000
188700         SELECT                                                   18760000
188800                 COUNT(*)                                         18770000
188900         INTO                                                     18780000
189000                :PV-DB2-COUNT                                     18790000
189100         FROM                                                     18800000
189200                 TPURITM                                          18810000
189300         WHERE                                                    18820000
189400                 PO_NBR             =  :ASC-KEY-PO-NBR            18830000
189500          AND    APP_PO_LNE_NBR     =  :ASC-KEY-PO-LNE-NBR        18840000
189600     END-EXEC.                                                    18850000
189700                                                                  18860000
189800     EVALUATE TRUE                                                18870000
189900         WHEN SQLCODE = ZERO                                      18880000
190000         WHEN SQLCODE = +100                                      18890000
190100         WHEN SQLCODE = -305                                      18900000
190200              CONTINUE                                            18910000
190300         WHEN SQLCODE = -904                                      18920000
190400         WHEN SQLCODE = -913                                      18930000
190500              PERFORM 9900-SOFT-ABORT                             18940000
190600         WHEN SQLWARN0 NOT = SPACES                               18950000
190700         WHEN SQLCODE NOT EQUAL ZERO                              18960000
190800              MOVE '3050-FETCH-TPURITM'                           18970000
190900                                   TO DP013-PARAGRAPH             18980000
191000              MOVE 'SELECT PURCHASE ORDER LINE INFORMATION'       18990000
191100                                   TO DP013-MESSAGE-TEXT (1)      19000000
191200              MOVE SQLCA           TO DP013-SQLCA                 19010000
191300              MOVE 'TPURITM'       TO DP013-DB2-TABLE-NAME (1)    19020000
191400              SET DP013-DB2-ABEND                                 19030000
191500                 DP013-XCTL-DISPLAY-RESTART                       19040000
191600                                   TO TRUE                        19050000
191700              PERFORM DP013-0000-PROCESS-ABEND                    19060000
191800     END-EVALUATE.                                                19070000
191900/                                                                 19080000
192000*----------------------------------------------------------------*19090000
192100*    CHECK TO SEE IF THE SPECIFIED LINE EXISTS FOR THIS PO.      *19100000
192200*----------------------------------------------------------------*19110000
192300 3055-FETCH-TPURITM.                                              19120000
192400                                                                  19130000
192500     INITIALIZE PV-DB2-COUNT.                                     19140000
192600                                                                  19150000
192700     EXEC SQL                                                     19160000
192800         SELECT  COUNT(*)                                         19170000
192900           INTO  :PV-DB2-COUNT                                    19180000
193000           FROM  TPURITM                                          19190000
193100          WHERE  PO_NBR          = :ASC-KEY-PO-NBR                19200000
193200            AND  APP_PO_LNE_NBR  = :ASC-KEY-PO-LNE-NBR            19210000
193300     END-EXEC.                                                    19220000
193400                                                                  19230000
193500     EVALUATE TRUE                                                19240000
193600       WHEN SQLCODE = ZERO                                        19250000
193700       WHEN SQLCODE = +100                                        19260000
193800       WHEN SQLCODE = -305                                        19270000
193900           CONTINUE                                               19280000
194000                                                                  19290000
194100       WHEN SQLCODE = -904                                        19300000
194200       WHEN SQLCODE = -913                                        19310000
194300           PERFORM 9900-SOFT-ABORT                                19320000
194400                                                                  19330000
194500       WHEN SQLWARN0 NOT = SPACES                                 19340000
194600       WHEN SQLCODE NOT EQUAL ZERO                                19350000
194700           MOVE '3055-FETCH-TPURITM' TO DP013-PARAGRAPH           19360000
194800           MOVE 'SELECT PURCHASE ORDER LINE INFORMATION'          19370000
194900                                     TO DP013-MESSAGE-TEXT (1)    19380000
195000           MOVE SQLCA                TO DP013-SQLCA               19390000
195100           MOVE 'TPURITM'            TO DP013-DB2-TABLE-NAME (1)  19400000
195200           SET DP013-XCTL-DISPLAY-RESTART                         19410000
195300               DP013-DB2-ABEND       TO TRUE                      19420000
195400           PERFORM DP013-0000-PROCESS-ABEND                       19430000
195500     END-EVALUATE.                                                19440000
195600                                                                  19450000
195700*----------------------------------------------------------------*19460000
195800*    FETCH THE RECEIPT ITEM FOR A SPECIFIED PO LINE TO CHECK     *19470000
195900*    IF IT HAS BEEN VERIFIED.                                    *19480000
196000*----------------------------------------------------------------*19490000
196100                                                                  19500000
196200 3060-FETCH-TRECITM.                                              19510000
196300                                                                  19520000
196400     INITIALIZE DCLTRECITM.                                       19530000
196500                                                                  19540000
196600     EXEC SQL                                                     19550000
196700         SELECT                                                   19560000
196800                 STATUS_CDE                                       19570000
196900         INTO                                                     19580000
197000                :RECITM-STATUS-CDE                                19590000
197100         FROM                                                     19600000
197200                 TRECITM                                          19610000
197300         WHERE                                                    19620000
197400                 OPER_UNT_ID        =  :ASC-KEY-OPER-UNT-ID       19630000
197500          AND    FCLTY_ID           =  :ASC-KEY-FCLTY-ID          19640000
197600          AND    ORD_NBR            =  :ASC-KEY-PO-NBR            19650000
197700          AND    ORD_LNE_NBR        =  :ASC-KEY-PO-LNE-NBR        19660000
197800          AND    REC_SEQ_NBR        =  :ASC-KEY-REC-SEQ-NBR       19670000
197900          AND    VER_STATUS_CDE     =  :PC-ACTIVE-STATUS          19680000
198000     END-EXEC.                                                    19690000
198100                                                                  19700000
198200     EVALUATE TRUE                                                19710000
198300         WHEN SQLCODE = ZERO                                      19720000
198400         WHEN SQLCODE = +100                                      19730000
198500              CONTINUE                                            19740000
198600         WHEN SQLCODE = -904                                      19750000
198700         WHEN SQLCODE = -913                                      19760000
198800              PERFORM 9900-SOFT-ABORT                             19770000
198900         WHEN SQLWARN0 NOT = SPACES                               19780000
199000         WHEN SQLCODE NOT EQUAL ZERO                              19790000
199100              MOVE '3060-FETCH-TRECITM'                           19800000
199200                                   TO DP013-PARAGRAPH             19810000
199300              MOVE 'SELECT RECEIPT ITEM INFORMATION'              19820000
199400                                   TO DP013-MESSAGE-TEXT (1)      19830000
199500              MOVE SQLCA           TO DP013-SQLCA                 19840000
199600              MOVE 'TRECITM'       TO DP013-DB2-TABLE-NAME (1)    19850000
199700              SET DP013-DB2-ABEND                                 19860000
199800                 DP013-XCTL-DISPLAY-RESTART                       19870000
199900                                   TO TRUE                        19880000
200000              PERFORM DP013-0000-PROCESS-ABEND                    19890000
200100     END-EVALUATE.                                                19900000
200200/                                                                 19910000
200300*----------------------------------------------------------------*19920000
200400*    RESET THE DATA ENTERABLE FIELDS ATTRIBUTE, HIGHLIGHT, AND   *19930000
200500*    COLOR BYTES.                                                *19940000
200600*----------------------------------------------------------------*19950000
200700                                                                  19960000
200800 3200-RESET-ATTRIBUTES.                                           19970000
200900                                                                  19980000
201000     MOVE DP015-UNP-ALP-NOR-OFF    TO ATRBRSNA                    19990000
201100                                      ATRBDESA                    20000000
201200                                      ATEXT1A                     20010000
201300                                      ATEXT2A                     20020000
201400                                      ATEXT3A                     20030000
201500                                      ATEXT4A                     20040000
201600                                      ATEXT5A.                    20050000
201700                                                                  20060000
201800     MOVE DP015-GREEN              TO ATRBRSNC                    20070000
201900                                      ATRBDESC                    20080000
202000                                      ATEXT1C                     20090000
202100                                      ATEXT2C                     20100000
202200                                      ATEXT3C                     20110000
202300                                      ATEXT4C                     20120000
202400                                      ATEXT5C.                    20130000
202500                                                                  20140000
202600     MOVE DP015-UNDERLINE          TO ATRBRSNH                    20150000
202700                                      ATRBDESH                    20160000
202800                                      ATEXT1H                     20170000
202900                                      ATEXT2H                     20180000
203000                                      ATEXT3H                     20190000
203100                                      ATEXT4H                     20200000
203200                                      ATEXT5H.                    20210000
203300/                                                                 20220000
203400*----------------------------------------------------------------*20230000
203500*    VALIDATE THE QUEUE WAS PASSED AND DISPLAY FOR THE FIRST     *20240000
203600*    ENTRY.                                                      *20250000
203700*----------------------------------------------------------------*20260000
203800                                                                  20270000
203900 4000-BUILD-INITIAL-PANEL.                                        20280000
204000                                                                  20290000
204100     INITIALIZE ASC-SCREEN-ENTERABLE-FIELDS.                      20300000
204200     PERFORM 4100-GET-FACILITY-NAME.                              20310000
204300                                                                  20320000
-04500     PERFORM 4110-GET-VENDOR-NAME.                                20330000
204600     SET DP030-SET-CURSOR-APPL-1   TO  TRUE.                      20340000
204700/                                                                 20350000
204800*----------------------------------------------------------------*20360000
204900*    GET THE FACILITY NAME FOR THE SCREEN.                       *20370000
205000*----------------------------------------------------------------*20380000
205100                                                                  20390000
205200 4100-GET-FACILITY-NAME.                                          20400000
205300                                                                  20410000
205400     INITIALIZE XL071-COMMAREA-REC.                               20420000
205500                                                                  20430000
205600     MOVE ASC-KEY-OPER-UNT-ID   TO PV-UNPACK-OPER-UNT-ID.         20440000
205700     MOVE PV-UNPACK-OPER-UNT-ID TO XL071-LOCATION-NUMBER.         20450000
205800                                                                  20460000
205900     CALL XL071-LOCATION-MODULE USING DFHEIBLK                    20470000
206000                                      XL071-COMMAREA              20480000
206100                                      XL071-COMMAREA-REC.         20490000
206200                                                                  20500000
206300     EVALUATE TRUE                                                20510000
206400         WHEN XL071-NO-ERRORS                                     20520000
206500             MOVE XL071-LOC-NM         TO ASC-FCLTY-NME           20530000
206600         WHEN XL071-LOC-NOT-FOUND                                 20540000
206700              MOVE 'FACILITY NOT FOUND' TO ASC-FCLTY-NME          20550000
206800         WHEN XL071-SQLCODE-N = -904                              20560000
206900         WHEN XL071-SQLCODE-N = -913                              20570000
207000              PERFORM 9900-SOFT-ABORT                             20580000
207100         WHEN XL071-BAD-DB2-RETURN                                20590000
207200              MOVE '4100-GET-FACILITY-NAME'                       20600000
207300                                   TO DP013-PARAGRAPH             20610000
207400              MOVE 'SELECT THE FACILITY NAME'                     20620000
207500                                   TO DP013-MESSAGE-TEXT (1)      20630000
207600              MOVE SQLCA           TO DP013-SQLCA                 20640000
207700              MOVE 'XLT_LOC'       TO DP013-DB2-TABLE-NAME (1)    20650000
207800              SET DP013-DB2-ABEND                                 20660000
207900                 DP013-XCTL-DISPLAY-RESTART                       20670000
208000                                   TO TRUE                        20680000
208100              PERFORM DP013-0000-PROCESS-ABEND                    20690000
208600     END-EVALUATE.                                                20700000
208700/                                                                 20710000
208800*----------------------------------------------------------------*20720000
208900*    GET THE VENDOR NAME FOR THE SCREEN.                         *20730000
209000*----------------------------------------------------------------*20740000
209100                                                                  20750000
209200 4110-GET-VENDOR-NAME.                                            20760000
209300                                                                  20770000
209400     EXEC SQL                                                     20780000
209500          SELECT                                                  20790000
209600                 B.ENT_NAME_DESC                                  20800000
209700               , A.DEPT_NBR                                       20810000
209800         INTO                                                     20820000
209900                :ASC-VENDOR-NAME                                  20830000
210000               ,:ASC-DEPT-NBR                                     20840000
210100         FROM                                                     20850000
210200                 TPURCHS A                                        20860000
210300               , TENTNME B                                        20870000
210400         WHERE                                                    20880000
210500                 A.PO_NBR           =  :ASC-KEY-PO-NBR            20890000
210600          AND    A.VER_STATUS_CDE   =  :PC-A                      20900000
210700          AND    A.ENT_ID           =  B.ENT_ID                   20910000
                AND    B.TYPE_CDE         = '01'                        20920000
210900     END-EXEC.                                                    20930000
211000                                                                  20940000
211100     EVALUATE TRUE                                                20950000
211200         WHEN SQLCODE = ZERO                                      20960000
211300              CONTINUE                                            20970000
211400         WHEN SQLCODE = +100                                      20980000
211500              MOVE 'VENDOR NOT FOUND' TO ASC-VENDOR-NAME          20990000
211600         WHEN SQLCODE = -904                                      21000000
211700         WHEN SQLCODE = -913                                      21010000
211800              PERFORM 9900-SOFT-ABORT                             21020000
211900         WHEN SQLWARN0 NOT = SPACES                               21030000
212000         WHEN SQLCODE NOT EQUAL ZERO                              21040000
212100              MOVE '4110-GET-VENDOR-NAME'                         21050000
212200                                   TO DP013-PARAGRAPH             21060000
212300              MOVE 'SELECT VEND NAME'                             21070000
212400                                   TO DP013-MESSAGE-TEXT (1)      21080000
212500              MOVE SQLCA           TO DP013-SQLCA                 21090000
212600              MOVE 'TPURCHS'       TO DP013-DB2-TABLE-NAME (1)    21100000
212700              MOVE 'TENTNME'       TO DP013-DB2-TABLE-NAME (2)    21110000
212800              SET DP013-DB2-ABEND                                 21120000
212900                 DP013-XCTL-DISPLAY-RESTART                       21130000
213000                                   TO TRUE                        21140000
213100              PERFORM DP013-0000-PROCESS-ABEND                    21150000
213200     END-EVALUATE.                                                21160000
213300/                                                                 21170000
213400*----------------------------------------------------------------*21180000
213500*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *21190000
213600*----------------------------------------------------------------*21200000
213700                                                                  21210000
213800 4400-MOVE-COMMAREA-TO-SCREEN.                                    21220000
213900                                                                  21230000
214000     IF  PS-SOFT-ABORT                                            21240000
214100         MOVE PC-TSYMSG-00551      TO  DP020-MSG-NUMBER           21250000
214200     END-IF.                                                      21260000
214300                                                                  21270000
214400     MOVE ASC-FCLTY-NME            TO  AFCLTNMO.                  21280000
214500     MOVE ASC-VENDOR-NAME          TO  AVENDNMO.                  21290000
214600                                                                  21300000
214700     MOVE ASC-KEY-PO-NBR           TO  PV-PO-NBR.                 21310000
214800     MOVE ASC-KEY-REC-SEQ-NBR      TO  PV-REC-SEQ-NBR.            21320000
214900     MOVE PV-DISPLAY-PO            TO  APORECO.                   21330000
215000                                                                  21340000
215100***  IF ASC-KEY-PREPK-ID > ZEROES                                 21350000
215200***      MOVE ZEROES               TO  APOLINEO                   21360000
215300***      MOVE ASC-KEY-PREPK-ID     TO  APOPACKO                   21370000
215400***  ELSE                                                         21380000
215500         MOVE ASC-KEY-PO-LNE-NBR   TO  APOLINEO                   21390000
215600         MOVE ASC-KEY-PREPK-ID     TO  APOPACKO                   21400000
215700***  END-IF.                                                      21410000
215800                                                                  21420000
215900     MOVE ASC-TRBL-RSN-CDE         TO  ATRBRSNO.                  21430000
216000     MOVE ASC-TRBL-SHT-DESC        TO  ATRBDESO.                  21440000
216100     MOVE ASC-TRBL-LONG-DESC       TO  ATRBLTXO.                  21450000
216200                                                                  21460000
216300     MOVE ASC-TEXT1                TO  ATEXT1O.                   21470000
216400     MOVE ASC-TEXT2                TO  ATEXT2O.                   21480000
216500     MOVE ASC-TEXT3                TO  ATEXT3O.                   21490000
216600     MOVE ASC-TEXT4                TO  ATEXT4O.                   21500000
216700     MOVE ASC-TEXT5                TO  ATEXT5O.                   21510000
216800/                                                                 21520000
216900*----------------------------------------------------------------*21530000
217000*    FIRST, PREPARE AND INSERT THE NOTIFICATION ROW, NEXT        *21540000
217100*    PREPARE AND INSERT THE TROUBLE DETAIL ROW.                  *21550000
217200*----------------------------------------------------------------*21560000
217300                                                                  21570000
217400 5000-BEGIN-CREATE-PROCESS.                                       21580000
217500                                                                  21590000
217600     INITIALIZE TM500-FIELDS.                                     21600000
217700     SET TM500-ADD-DETAILS                                        21610000
217800         TM500-CREATE-MANUAL       TO  TRUE.                      21620000
217900                                                                  21630000
218000     MOVE ASC-KEY-NOTIF-NBR        TO  TM500-NOTIF-NBR.           21640000
218100     MOVE ASC-KEY-OPER-UNT-ID      TO  TM500-OPER-UNT-ID.         21650000
218200     MOVE ASC-KEY-FCLTY-ID         TO  TM500-FCLTY-ID.            21660000
218300                                                                  21670000
218400     MOVE ASC-KEY-PO-NBR           TO  TM500-PO-NBR.              21680000
218500     MOVE ASC-KEY-PREPK-ID         TO  TM500-PREPK-ID.            21690000
218600                                                                  21700000
218700     IF ASC-PO-LEVEL-TRBL                                         21710000
218800         SET TM500-PO-LEVEL        TO  TRUE                       21720000
218900         MOVE ZERO                 TO  TM500-PO-LNE-NBR           21730000
219000     ELSE                                                         21740000
219100         IF ASC-PACK-LEVEL-TRBL                                   21750000
219200             SET TM500-PACK-LEVEL  TO  TRUE                       21760000
219300             MOVE ZERO             TO  TM500-PO-LNE-NBR           21770000
219400         ELSE                                                     21780000
219500             SET TM500-LINE-LEVEL  TO  TRUE                       21790000
219600             MOVE ZERO             TO  TM500-PREPK-ID             21800000
219700             MOVE ASC-KEY-PO-LNE-NBR TO TM500-PO-LNE-NBR          21810000
219800         END-IF                                                   21820000
219900     END-IF                                                       21830000
220000                                                                  21840000
220100     MOVE ASC-KEY-REC-SEQ-NBR      TO  TM500-REC-SEQ-NBR.         21850000
220200     MOVE ASC-TRBL-RSN-CDE         TO  TM500-TRBL-RSN-CDE.        21860000
220300                                                                  21870000
220400     MOVE DP020-USERID             TO  TM500-CRE-UID              21880000
220500                                       TM500-NOTIF-UID.           21890000
220600                                                                  21900000
220700     STRING ASC-TEXT1                                             21910000
220800            ASC-TEXT2                                             21920000
220900            ASC-TEXT3                                             21930000
221000            ASC-TEXT4                                             21940000
221100            ASC-TEXT5 DELIMITED BY SIZE                           21950000
221200                                 INTO  TM500-FREEFORM-TEXT.       21960000
221300                                                                  21970000
221400     PERFORM 5060-LINK-TO-UPDATE.                                 21980000
221500     IF TM500-CALL-SUCCESSFUL         OR                          21990000
221600         TM500-TPURCHS-SELECT-NOT-FND OR                          22000000
221700         TM500-TTRBNTF-UPDATE-NOT-FND OR                          22010000
221800         TM500-DIDNT-ALLOC-DUE-TO-TRBL                            22020000
221900         CONTINUE                                                 22030000
222000     ELSE                                                         22040000
222100         IF  TM500-DUPLICATE-TROUBLE                              22050000
222200             SET DP020-MSG-FATAL                                  22060000
222300                 PS-ERROR          TO  TRUE                       22070000
222400             MOVE PC-TSYMSG-01254  TO  DP020-MSG-NUMBER           22080000
222500             MOVE DP015-UNP-ALP-BRT-OFF                           22090000
222600                                   TO  ATRBRSNA                   22100000
222700             MOVE DP015-RED        TO  ATRBRSNC                   22110000
222800             MOVE DP015-REVERSE    TO  ATRBRSNH                   22120000
222900             MOVE -1               TO  ATRBRSNL                   22130000
223000         ELSE                                                     22140000
223100             PERFORM 5070-FORMAT-ERROR                            22150000
223200         END-IF                                                   22160000
223300     END-IF.                                                      22170000
223400                                                                  22180000
223500 5060-LINK-TO-UPDATE.                                             22190000
223600                                                                  22200000
223700     EXEC CICS LINK                                               22210000
223800          PROGRAM (PC-TMKCS520)                                   22220000
223900          COMMAREA(TM500-FIELDS)                                  22230000
224000          RESP    (PV-CICS-RESP)                                  22240000
224100     END-EXEC.                                                    22250000
224200                                                                  22260000
224300     IF  PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)               22270000
224400         SET DP013-LOGIC-ABEND                                    22280000
224500             DP013-NO-ROLLBACK     TO TRUE                        22290000
224600         MOVE '5060-LINK-TO-UPDATE'                               22300000
224700                                   TO DP013-PARAGRAPH             22310000
224800         MOVE 'ATTEMPTING TO LINK TO CENTRAL PROCESSING'          22320000
224900                                   TO DP013-MESSAGE-TEXT (1)      22330000
225000         PERFORM DP013-0000-PROCESS-ABEND                         22340000
225100     END-IF.                                                      22350000
225200                                                                  22360000
225300 5070-FORMAT-ERROR.                                               22370000
225400                                                                  22380000
225500     SET PS-ERROR                                                 22390000
225600         DP020-MSG-FATAL           TO  TRUE.                      22400000
225700     STRING 'NNNNN-E-'                                            22410000
225800            TM500-RETURN-MSG                                      22420000
225900            '-'                                                   22430000
226000            TM500-RETURN-CODE                                     22440000
226100            ', SQLCODE='                                          22450000
226200            TM500-SQLCODE DELIMITED BY SIZE                       22460000
226300                                 INTO  DP020-MSG-MESSAGE.         22470000
226400 5100-BEGIN-MULTI-CREATE.                                         22480000
226500     INITIALIZE TM500-FIELDS.                                     22490000
226600     SET TM500-CREATE-MANUAL                                      22500000
226700         TM500-ADD-DETAILS TO TRUE.                               22510000
226800                                                                  22520000
226900     MOVE RC013-MAX-ITEMS   TO ASC-SEL-SUB                        22530000
227000                               PV-SAVE-ASC-SEL-SUB.               22540000
227100     MOVE ZERO              TO ASC-SEL-ITEM                       22550000
227200                               PV-SAVE-ASC-SEL-ITEM.              22560000
227300     SET PS-NOT-END-SEL-ITEMS-QUEUE TO TRUE.                      22570000
227400     PERFORM 5110-MULTI-CREATE                                    22580000
227500         UNTIL PS-END-SEL-ITEMS-QUEUE OR PS-ERROR.                22590000
227600     MOVE PV-SAVE-ASC-SEL-SUB  TO ASC-SEL-SUB.                    22600000
227700     MOVE PV-SAVE-ASC-SEL-ITEM TO ASC-SEL-ITEM.                   22610000
227800                                                                  22620000
227900                                                                  22630000
228000 5110-MULTI-CREATE.                                               22640000
228100     ADD +1                        TO  ASC-SEL-SUB.               22650000
228200     IF  ASC-SEL-SUB > RC013-MAX-ITEMS                            22660000
228300         ADD +1                    TO  ASC-SEL-ITEM               22670000
228400         MOVE +1                   TO  ASC-SEL-SUB                22680000
228500         IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS            22690000
228600             IF PS-FIRST-TIME                                     22700000
228700                 INITIALIZE RC013-SELECTED-ITEM-ARRAY             22710000
228800                 PERFORM 9100-READ-SEL-QUEUE                      22720000
228900             ELSE                                                 22730000
229000                 SUBTRACT +1 FROM ASC-SEL-ITEM                    22740000
229100                 PERFORM 9200-REWRITE-SEL-QUEUE                   22750000
229200                 ADD +1      TO   ASC-SEL-ITEM                    22760000
229300                 INITIALIZE RC013-SELECTED-ITEM-ARRAY             22770000
229400                 PERFORM 9100-READ-SEL-QUEUE                      22780000
229500             END-IF                                               22790000
229600         ELSE                                                     22800000
229700             INITIALIZE RC013-SELECTED-ITEM-ARRAY                 22810000
229800             SET PS-END-SEL-ITEMS-QUEUE TO TRUE                   22820000
229900         END-IF                                                   22830000
230000     END-IF.                                                      22840000
230100                                                                  22850000
230200     IF RC013-ITEM (ASC-SEL-SUB) > ZERO                           22860000
230300         IF PS-FIRST-TIME                                         22870000
230400             SET PS-NOT-FIRST-TIME TO TRUE                        22880000
230500         END-IF                                                   22890000
230600                                                                  22900000
230700         MOVE RC013-PO-NBR(ASC-SEL-SUB) TO TM500-PO-NBR           22910000
230800                                                                  22920000
230900         IF ASC-PO-LEVEL-TRBL                                     22930000
231000             SET TM500-PO-LEVEL TO TRUE                           22940000
231100             MOVE ZERO          TO TM500-PO-LNE-NBR               22950000
231200         ELSE                                                     22960000
231300             IF ASC-PACK-LEVEL-TRBL                               22970000
231400                 SET TM500-PACK-LEVEL TO TRUE                     22980000
231500                 MOVE RC013-PKSL-LNE-NBR-N(ASC-SEL-SUB)           22990000
231600                                      TO TM500-PO-LNE-NBR         23000000
231700                 INITIALIZE PV-DB2-COUNT                          23010000
231800                 PERFORM 7010-RETRIEVE-DIFFERENT-PACK             23020000
231900                 IF PV-DB2-COUNT = 0                              23030000
232000                     SET DP020-NEXT-ACT-APPL-ERROR                23040000
232100                         PS-ERROR                                 23050000
232200                         DP020-MSG-FATAL  TO TRUE                 23060000
232300                     MOVE PC-TSYMSG-02190 TO DP020-MSG-NUMBER     23070000
232400                 ELSE                                             23080000
232500                     PERFORM 7011-RETRIEVE-PACK-ID                23090000
232600                 END-IF                                           23100000
232700             ELSE                                                 23110000
232800                 SET TM500-LINE-LEVEL TO TRUE                     23120000
232900                 MOVE ZERO            TO TM500-PREPK-ID           23130000
233000                 MOVE RC013-PKSL-LNE-NBR-N(ASC-SEL-SUB)           23140000
233100                                      TO TM500-PO-LNE-NBR         23150000
233200             END-IF                                               23160000
233300         END-IF                                                   23170000
233400                                                                  23180000
233500         MOVE RC013-REC-SEQ-NBR(ASC-SEL-SUB)                      23190000
233600                                   TO  TM500-REC-SEQ-NBR          23200000
233700         MOVE RC013-OPER-UNT-ID(ASC-SEL-SUB)                      23210000
233800                                   TO  TM500-OPER-UNT-ID          23220000
233900         MOVE RC013-FCLTY-ID(ASC-SEL-SUB)                         23230000
234000                                   TO  TM500-FCLTY-ID             23240000
234100         SET RC013-UPD (ASC-SEL-SUB) TO TRUE                      23250000
234200                                                                  23260000
234300         IF ASC-PACK-LEVEL-TRBL                                   23270000
234400             MOVE ZERO             TO TM500-PO-LNE-NBR            23280000
234500             MOVE RC013-PKSL-LNE-NBR-N(ASC-SEL-SUB)               23290000
234600                                   TO TM500-PO-LNE-NBR            23300000
234700             INITIALIZE PV-DB2-COUNT                              23310000
234800             PERFORM 7010-RETRIEVE-DIFFERENT-PACK                 23320000
234900         END-IF                                                   23330000
235000                                                                  23340000
235100         MOVE DP020-USERID         TO  TM500-NOTIF-UID            23350000
235200                                       TM500-CRE-UID              23360000
235300         MOVE ASC-TRBL-RSN-CDE     TO  TM500-TRBL-RSN-CDE         23370000
235400                                                                  23380000
235500         STRING ASC-TEXT1                                         23390000
235600                ASC-TEXT2                                         23400000
235700                ASC-TEXT3                                         23410000
235800                ASC-TEXT4                                         23420000
235900                ASC-TEXT5 DELIMITED BY SIZE                       23430000
236000                          INTO TM500-FREEFORM-TEXT                23440000
236100                                                                  23450000
236200         PERFORM 5060-LINK-TO-UPDATE                              23460000
236300         IF TM500-CALL-SUCCESSFUL         OR                      23470000
236400             TM500-TPURCHS-SELECT-NOT-FND OR                      23480000
236500             TM500-TTRBNTF-UPDATE-NOT-FND OR                      23490000
236600             TM500-DIDNT-ALLOC-DUE-TO-TRBL                        23500000
236700             CONTINUE                                             23510000
236800         ELSE                                                     23520000
236900             IF  TM500-DUPLICATE-TROUBLE                          23530000
237000                 SET DP020-MSG-FATAL                              23540000
237100                     PS-ERROR          TO  TRUE                   23550000
237200                 MOVE PC-TSYMSG-01254  TO  DP020-MSG-NUMBER       23560000
237300                 MOVE DP015-UNP-ALP-BRT-OFF                       23570000
237400                                       TO  ATRBRSNA               23580000
237500                 MOVE DP015-RED        TO  ATRBRSNC               23590000
237600                 MOVE DP015-REVERSE    TO  ATRBRSNH               23600000
237700                 MOVE -1               TO  ATRBRSNL               23610000
237800             ELSE                                                 23620000
237900                 PERFORM 5070-FORMAT-ERROR                        23630000
238000             END-IF                                               23640000
238100         END-IF                                                   23650000
238200     ELSE                                                         23660000
238300         SET PS-END-SEL-ITEMS-QUEUE TO TRUE                       23670000
238400     END-IF.                                                      23680000
238500/                                                                 23690000
238600******************************************************************23700000
238700* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *23710000
238800* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *23720000
238900* FOR THE SELECTED ITEMS QUEUE.                                  *23730000
239000*                                                                *23740000
239100* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *23750000
239200* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *23760000
239300* THE ARRAY IS FULL.                                             *23770000
239400* NOTE: FOR THIS PGM, ONLY ONE SELECTION PASSED TO NEXT PGM.     *23780000
239500******************************************************************23790000
239600 6000-PREPARE-SEL-QUEUE.                                          23800000
239700                                                                  23810000
239800     PERFORM 6005-DELETE-SEL-QUEUE.                               23820000
239900                                                                  23830000
240000     MOVE +1                  TO RC801-SELECTED-ITEMS.            23840000
240100     INITIALIZE RC801-SELECTED-ITEM-ARRAY.                        23850000
240200     SET RC801-IDX            TO 1.                               23860000
240300     MOVE +1                  TO RC801-ITEM (1).                  23870000
240400     MOVE SPACE               TO RC801-ACTION-SW (1).             23880000
240500     MOVE ASC-KEY-DRV-LNE-NBR TO RC801-REC-LNE-NBR (1).           23890000
240600     MOVE ASC-KEY-PREPK-ID    TO RC801-PACK-ID (1).               23900000
240700                                                                  23910000
240800     PERFORM 6010-WRITE-SEL-QUEUE.                                23920000
240900                                                                  23930000
241000******************************************************************23940000
241100 6005-DELETE-SEL-QUEUE.                                           23950000
241200                                                                  23960000
241300     EXEC CICS DELETEQ TS                                         23970000
241400               QUEUE (ASC-SEL-QUEUE-NAME-OUT)                     23980000
241500               RESP  (PV-CICS-RESP)                               23990000
241600     END-EXEC.                                                    24000000
241700                                                                  24010000
241800     IF ((PV-CICS-RESP = DFHRESP (NORMAL))                        24020000
241900       OR (PV-CICS-RESP = DFHRESP (QIDERR)))                      24030000
242000         CONTINUE                                                 24040000
242100     ELSE                                                         24050000
242200         SET DP013-CICS-ABEND                                     24060000
242300             DP013-NO-ROLLBACK        TO TRUE                     24070000
242400         MOVE '6005-DELETE-SEL-QUEUE' TO DP013-PARAGRAPH          24080000
242500         MOVE 'UNSUCCESSFUL SEL ITEMS TEMP STORAGE QUEUE DELETE'  24090000
242600                                      TO DP013-MESSAGE-TEXT (1)   24100000
242700         PERFORM DP013-0000-PROCESS-ABEND                         24110000
242800     END-IF.                                                      24120000
242900                                                                  24130000
243000******************************************************************24140000
243100 6010-WRITE-SEL-QUEUE.                                            24150000
243200                                                                  24160000
243300     MOVE +1 TO RC801-SELECTED-ITEMS.                             24170000
243400                                                                  24180000
243500     EXEC CICS WRITEQ TS                                          24190000
243600               QUEUE (ASC-SEL-QUEUE-NAME-OUT)                     24200000
243700               FROM  (RC801-PREPACK-SELECT-RECORD)                24210000
243800               ITEM  (PV-SEL-QUEUE-ITEM)                          24220000
243900               RESP  (PV-CICS-RESP)                               24230000
244000     END-EXEC.                                                    24240000
244100                                                                  24250000
244200     IF PV-CICS-RESP NOT = DFHRESP (NORMAL)                       24260000
244300         SET DP013-CICS-ABEND                                     24270000
244400             DP013-NO-ROLLBACK       TO TRUE                      24280000
244500         MOVE '6010-WRITE-SEL-QUEUE' TO DP013-PARAGRAPH           24290000
244600         MOVE 'UNSUCCESSFUL SEL ITEMS TEMP STORAGE QUEUE WRITE'   24300000
244700                                     TO DP013-MESSAGE-TEXT (1)    24310000
244800         PERFORM DP013-0000-PROCESS-ABEND                         24320000
244900     END-IF.                                                      24330000
245000                                                                  24340000
245100******************************************************************24350000
245200 6100-FORMAT-COMMAREA.                                            24360000
245300                                                                  24370000
245400     MOVE ASC-KEY-PO-NBR       TO RC800-REC-NBR-N.                24380000
245500     MOVE ASC-KEY-REC-SEQ-NBR  TO RC800-REC-SEQ-NBR-N.            24390000
245600*JPL MOVE ASC-KEY-PO-LNE-NBR   TO RC800-LINE-NBR-N.               24400000
245700     MOVE ASC-KEY-DRV-LNE-NBR  TO RC800-LINE-NBR-N.               24410000
245800     MOVE ASC-KEY-OPER-UNT-ID  TO RC800-OPER-UNIT-ID.             24420000
245900     MOVE ASC-KEY-FCLTY-ID     TO RC800-FACILITY-ID.              24430000
246000     MOVE ASC-KEY-PREPK-ID     TO RC800-PACK-ID.                  24440000
246100                                                                  24450000
246200     MOVE ASC-SEL-QUEUE-NAME-OUT                                  24460000
246300                               TO RC800-SEL-QUEUE-NAME.           24470000
246400     MOVE +1                   TO RC800-NUMBER-OF-SELECTED-ITEMS. 24480000
246500     MOVE +1                   TO RC800-NUMBER-OF-TS-ITEMS.       24490000
246600                                                                  24500000
246700******************************************************************24510000
246800 7000-SELECT-TPURITM-STATUS.                                      24520000
246900                                                                  24530000
247000     EXEC SQL                                                     24540000
247100         SELECT                                                   24550000
247200             STATUS_CDE                                           24560000
247300         INTO                                                     24570000
247400            :PURITM-STATUS-CDE                                    24580000
247500         FROM TPURITM                                             24590000
247600         WHERE   PO_NBR             =  :ASC-KEY-PO-NBR            24600000
247700          AND    APP_PO_LNE_NBR     =  :ASC-KEY-PO-LNE-NBR        24610000
247800          AND    VER_STATUS_CDE     =  :PC-A                      24620000
247900     END-EXEC.                                                    24630000
248000                                                                  24640000
248100     EVALUATE TRUE                                                24650000
248200         WHEN SQLCODE = ZERO                                      24660000
248300         WHEN SQLCODE = +100                                      24670000
248400              CONTINUE                                            24680000
248500         WHEN SQLCODE = -904                                      24690000
248600         WHEN SQLCODE = -913                                      24700000
248700              PERFORM 9900-SOFT-ABORT                             24710000
248800         WHEN SQLWARN0 NOT = SPACES                               24720000
248900         WHEN SQLCODE NOT EQUAL ZERO                              24730000
249000              MOVE '7000-SELECT-TPURITM-STATUS'                   24740000
249100                                   TO DP013-PARAGRAPH             24750000
249200              MOVE 'SELECT PURCHASE ORDER LINE INFORMATION'       24760000
249300                                   TO DP013-MESSAGE-TEXT (1)      24770000
249400              MOVE SQLCA           TO DP013-SQLCA                 24780000
249500              MOVE 'TPURITM'       TO DP013-DB2-TABLE-NAME (1)    24790000
249600              SET DP013-DB2-ABEND                                 24800000
249700                 DP013-XCTL-DISPLAY-RESTART                       24810000
249800                                   TO TRUE                        24820000
249900              PERFORM DP013-0000-PROCESS-ABEND                    24830000
250000     END-EVALUATE.                                                24840000
250100                                                                  24850000
250200 7010-RETRIEVE-DIFFERENT-PACK.                                    24860000
250300                                                                  24870000
250400     EXEC SQL                                                     24880000
250500         SELECT COUNT(*)                                          24890000
250600           INTO :PV-DB2-COUNT                                     24900000
250700           FROM TRECEIV                                           24910000
250800          WHERE OPER_UNT_ID         = :TM500-OPER-UNT-ID          24920000
250900            AND FCLTY_ID            = :TM500-FCLTY-ID             24930000
251000            AND ORD_NBR             = :TM500-PO-NBR               24940000
251100            AND REC_SEQ_NBR         = :TM500-REC-SEQ-NBR          24950000
251200            AND VER_STATUS_CDE      = :PC-A                       24960000
251300            AND PKGNG_CDE          IN ('M', 'I')                  24970000
251400     END-EXEC.                                                    24980000
251500                                                                  24990000
251600     EVALUATE TRUE                                                25000000
251700       WHEN SQLCODE = ZERO                                        25010000
251800       WHEN SQLCODE = -305                                        25020000
251900       WHEN SQLCODE = +100                                        25030000
252000           CONTINUE                                               25040000
252100                                                                  25050000
252200       WHEN SQLCODE = -904                                        25060000
252300       WHEN SQLCODE = -913                                        25070000
252400           PERFORM 9900-SOFT-ABORT                                25080000
252500                                                                  25090000
252600       WHEN SQLWARN0 NOT = SPACES                                 25100000
252700       WHEN SQLCODE  NOT = ZERO                                   25110000
252800           MOVE '7010-RETRIEVE-DIFFERENT-PACK' TO DP013-PARAGRAPH 25120000
252900           MOVE 'COUNT RECEIVER PACKS' TO DP013-MESSAGE-TEXT (1)  25130000
253000           MOVE SQLCA     TO DP013-SQLCA                          25140000
253100           MOVE 'TRECEIV' TO DP013-DB2-TABLE-NAME (1)             25150000
253200           SET DP013-DB2-ABEND                                    25160000
253300               DP013-XCTL-DISPLAY-RESTART TO TRUE                 25170000
253400           PERFORM DP013-0000-PROCESS-ABEND                       25180000
253500     END-EVALUATE.                                                25190000
253600                                                                  25200000
253700 7011-RETRIEVE-PACK-ID.                                           25210000
253800                                                                  25220000
253900     EXEC SQL                                                     25230000
254000         SELECT PREPK_ID                                          25240000
254100           INTO :TM500-PREPK-ID                                   25250000
254200           FROM TRECEIV A                                         25260000
254300              , TRECITM B                                         25270000
254400          WHERE A.OPER_UNT_ID       = :TM500-OPER-UNT-ID          25280000
254500            AND A.FCLTY_ID          = :TM500-FCLTY-ID             25290000
254600            AND A.ORD_NBR           = :TM500-PO-NBR               25300000
254700            AND B.ORD_LNE_NBR       = :TM500-PO-LNE-NBR           25310000
254800            AND A.REC_SEQ_NBR       = :TM500-REC-SEQ-NBR          25320000
254900            AND A.VER_STATUS_CDE    = :PC-A                       25330000
255000     END-EXEC.                                                    25340000
255100                                                                  25350000
255200     EVALUATE TRUE                                                25360000
255300       WHEN SQLCODE = ZERO                                        25370000
255400       WHEN SQLCODE = +100                                        25380000
255500           CONTINUE                                               25390000
255600                                                                  25400000
255700       WHEN SQLCODE = -904                                        25410000
255800       WHEN SQLCODE = -913                                        25420000
255900           PERFORM 9900-SOFT-ABORT                                25430000
256000                                                                  25440000
256100       WHEN SQLWARN0 NOT = SPACES                                 25450000
256200       WHEN SQLCODE  NOT = ZERO                                   25460000
256300           MOVE '7011-RETRIEVE-PACK-ID' TO DP013-PARAGRAPH        25470000
256400           MOVE 'RETRIEVE PACK ID' TO DP013-MESSAGE-TEXT (1)      25480000
256500           MOVE SQLCA     TO DP013-SQLCA                          25490000
256600           MOVE 'TRECITM' TO DP013-DB2-TABLE-NAME (1)             25500000
256700           MOVE 'TRECEIV' TO DP013-DB2-TABLE-NAME (2)             25510000
256800           SET DP013-DB2-ABEND                                    25520000
256900               DP013-XCTL-DISPLAY-RESTART TO TRUE                 25530000
257000           PERFORM DP013-0000-PROCESS-ABEND                       25540000
257100     END-EVALUATE.                                                25550000
257200                                                                  25560000
285900*----------------------------------------------------------------*25570000
285900*IF THE TROUBLE CODED ENTERED IS 804, 805, OR 806 (VARIOUS FALSE  25580000
      * AUDIT NOTIFIES, NEED TO GET THE RECEIVER PKGNG CODE TO VALIDATE 25590000
      * THAT THE USER IS PUTTING IN THE CORRECT NOTIFY IN BASED ON THE  25600000
      * RECEIVER PACKAGING CODE.                                        25610000
285900*----------------------------------------------------------------*25620000
286000 7020-GET-TRECEIV-PKGNG-CDE.                                      25630000
286100                                                                  25640000
286200     EXEC SQL                                                     25650000
286300          SELECT DISTINCT                                         25660000
286400                 PKGNG_CDE                                        25670000
286400                ,PACK_BY_ST_IND                                   25680000
286500            INTO :RECEIV-PKGNG-CDE                                25690000
286400                ,:RECEIV-PACK-BY-ST-IND                           25700000
286600            FROM TRECEIV                                          25710000
286900           WHERE ORD_NBR           = :ASC-KEY-PO-NBR              25720000
282800             AND REC_SEQ_NBR       = :ASC-KEY-REC-SEQ-NBR         25721000
282900             AND VER_STATUS_CDE    = :PC-ACTIVE-STATUS            25722000
283000             AND OPER_UNT_ID       = :ASC-KEY-OPER-UNT-ID         25723000
283100             AND FCLTY_ID          = :ASC-KEY-FCLTY-ID            25724000
287800     END-EXEC.                                                    25725000
287900                                                                  25726000
288000     EVALUATE TRUE                                                25727000
288100         WHEN SQLCODE = +0                                        25728000
288200         WHEN SQLCODE = +100                                      25729000
288300              CONTINUE                                            25730000
288400         WHEN SQLCODE = -904                                      25730100
288500         WHEN SQLCODE = -911                                      25730200
288600         WHEN SQLCODE = -913                                      25730300
288700              PERFORM 9900-SOFT-ABORT                             25730400
288800                                                                  25730500
288900         WHEN SQLWARN0 NOT = SPACES                               25730600
289000         WHEN SQLCODE < +0                                        25730700
289100         WHEN SQLCODE > +0                                        25730800
289200              MOVE '7020-GET-TRECEIV-PKGNG-CDE'                   25730900
289200                                     TO DP013-PARAGRAPH           25731000
289300              MOVE 'UNSUCCESSFUL SELECT ON TRECEIV'               25731100
289400                               TO DP013-MESSAGE-TEXT (1)          25731200
289500              MOVE SQLCA       TO DP013-SQLCA                     25731300
289600              MOVE 'TRECEIV '  TO DP013-DB2-TABLE-NAME (1)        25731400
289700              SET DP013-DB2-ABEND                                 25731500
289800                  DP013-XCTL-DISPLAY-RESTART TO TRUE              25731600
289900              PERFORM DP013-0000-PROCESS-ABEND                    25731700
290000     END-EVALUATE.                                                25731800
290100                                                                  25731900
257300*----------------------------------------------------------------*25732000
257400* RECORD IN THE SELECTION TEMP STORAGE QUEUE THE FACT THAT THIS  *25733000
257500* OBJECT WAS UPDATED.                                            *25734000
257600*----------------------------------------------------------------*25735000
257700                                                                  25736000
257800 9000-UPDATE-SELECTION-QUEUE.                                     25737000
257900                                                                  25738000
258000     PERFORM 9100-READ-SEL-QUEUE.                                 25739000
258100     SET RC013-UPD (ASC-SEL-SUB) TO TRUE.                         25740000
258200     PERFORM 9200-REWRITE-SEL-QUEUE.                              25750000
258300/                                                                 25760000
258400*----------------------------------------------------------------*25770000
258500* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *25780000
258600*----------------------------------------------------------------*25790000
258700                                                                  25800000
258800 9100-READ-SEL-QUEUE.                                             25810000
258900                                                                  25820000
259000     EXEC CICS                                                    25830000
259100         READQ TS                                                 25840000
259200             QUEUE (ASC-SEL-QUEUE-NAME)                           25850000
259300             INTO  (RC013-DC-SELECT-RECORD)                       25860000
259400             ITEM  (ASC-SEL-ITEM)                                 25870000
259500             RESP  (PV-CICS-RESPONSE)                             25880000
259600     END-EXEC.                                                    25890000
259700                                                                  25900000
259800     IF  PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL)                   25910000
259900         CONTINUE                                                 25920000
260000     ELSE                                                         25930000
260100         SET DP013-LOGIC-ABEND                                    25940000
260200             DP013-NO-ROLLBACK     TO TRUE                        25950000
260300         MOVE '9100-READ-SEL-QUEUE'                               25960000
260400                                   TO DP013-PARAGRAPH             25970000
260500         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   25980000
260600                                   TO DP013-MESSAGE-TEXT (1)      25990000
260700         PERFORM DP013-0000-PROCESS-ABEND                         26000000
260800     END-IF.                                                      26010000
260900                                                                  26020000
261000*----------------------------------------------------------------*26030000
261100* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *26040000
261200*----------------------------------------------------------------*26050000
261300                                                                  26060000
261400 9200-REWRITE-SEL-QUEUE.                                          26070000
261500                                                                  26080000
261600     EXEC CICS                                                    26090000
261700          WRITEQ TS                                               26100000
261800              QUEUE  (ASC-SEL-QUEUE-NAME)                         26110000
261900              FROM   (RC013-DC-SELECT-RECORD)                     26120000
262000              ITEM   (ASC-SEL-ITEM)                               26130000
262100              RESP   (PV-CICS-RESPONSE)                           26140000
262200              REWRITE                                             26150000
262300     END-EXEC.                                                    26160000
262400                                                                  26170000
262500     IF  PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)               26180000
262600         SET DP013-CICS-ABEND                                     26190000
262700             DP013-NO-ROLLBACK     TO TRUE                        26200000
262800         MOVE '9200-REWRITE-SEL-QUEUE'                            26210000
262900                                   TO DP013-PARAGRAPH             26220000
263000         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   26230000
263100                                   TO DP013-MESSAGE-TEXT (1)      26240000
263200         PERFORM DP013-0000-PROCESS-ABEND                         26250000
263300     END-IF.                                                      26260000
263400                                                                  26270000
263500******************************************************************26280000
263600* READ AN ITEM FROM THE INPUT SELECTED ITEMS TEMP STORAGE QUEUE. *26290000
263700******************************************************************26300000
263800 9150-READ-SEL-QUEUE.                                             26310000
263900                                                                  26320000
264000     EXEC CICS                                                    26330000
264100         READQ TS                                                 26340000
264200             QUEUE (ASC-SEL-QUEUE-NAME-IN)                        26350000
264300             INTO  (RC801-PREPACK-SELECT-RECORD)                  26360000
264400             ITEM  (ASC-SEL-ITEM)                                 26370000
264500             RESP  (PV-CICS-RESP)                                 26380000
264600     END-EXEC.                                                    26390000
264700                                                                  26400000
264800     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        26410000
264900         CONTINUE                                                 26420000
265000     ELSE                                                         26430000
265100         SET DP013-LOGIC-ABEND                                    26440000
265200             DP013-NO-ROLLBACK      TO TRUE                       26450000
265300         MOVE '9150-READ-SEL-QUEUE' TO DP013-PARAGRAPH            26460000
265400         MOVE 'ATTEMPTING TO READ TO LIST SELECTIONS TS QUEUE'    26470000
265500                                    TO DP013-MESSAGE-TEXT (1)     26480000
265600         PERFORM DP013-0000-PROCESS-ABEND                         26490000
265700     END-IF.                                                      26500000
265800                                                                  26510000
265900******************************************************************26520000
266000* UPDATE AN ITEM IN THE INPUT SELECTED ITEMS TEMP STORAGE QUEUE. *26530000
266100******************************************************************26540000
266200 9250-REWRITE-LIST-QUEUE.                                         26550000
266300                                                                  26560000
266400     EXEC CICS                                                    26570000
266500          WRITEQ TS                                               26580000
266600              QUEUE   (ASC-SEL-QUEUE-NAME-IN)                     26590000
266700              FROM    (RC801-PREPACK-SELECT-RECORD)               26600000
266800              ITEM    (ASC-SEL-ITEM)                              26610000
266900              RESP    (PV-CICS-RESP)                              26620000
267000              REWRITE                                             26630000
267100     END-EXEC.                                                    26640000
267200                                                                  26650000
267300     IF PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                    26660000
267400         SET DP013-CICS-ABEND                                     26670000
267500             DP013-NO-ROLLBACK          TO TRUE                   26680000
267600         MOVE '9250-REWRITE-LIST-QUEUE' TO DP013-PARAGRAPH        26690000
267700         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   26700000
267800                                        TO DP013-MESSAGE-TEXT (1) 26710000
267900         PERFORM DP013-0000-PROCESS-ABEND                         26720000
268000     END-IF.                                                      26730000
268100                                                                  26740000
268200*----------------------------------------------------------------*26750000
268300*    THE DB2 RESOURCE IS NOT AVAILABLE, SET THE ERROR MESSAGE    *26760000
268400*    AND THE ERROR SWITCHES.                                     *26770000
268500*----------------------------------------------------------------*26780000
268600                                                                  26790000
268700 9900-SOFT-ABORT.                                                 26800000
268800                                                                  26810000
268900     SET PS-ERROR                                                 26820000
269000         PS-SOFT-ABORT           TO  TRUE.                        26830000
269100     SET DP020-MSG-FATAL         TO  TRUE.                        26840000
269200     MOVE PC-TSYMSG-00551        TO  DP020-MSG-NUMBER.            26850000
269300/                                                                 26860000
269400*----------------------------------------------------------------*26870000
269500*    DATE/TIME SUBROUTINE.                                       *26880000
269600*----------------------------------------------------------------*26890000
269700                                                                  26900000
269800     COPY DPPD017.                                                26910000
269900/                                                                 26920000
270000*----------------------------------------------------------------*26930000
270100*    ABEND PROCESSOR MODULE                                      *26940000
270200*----------------------------------------------------------------*26950000
270300                                                                  26960000
270400     COPY DPPD013.                                                26970000
