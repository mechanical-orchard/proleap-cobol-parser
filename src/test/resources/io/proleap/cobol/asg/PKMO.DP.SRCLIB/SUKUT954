000100 IDENTIFICATION DIVISION.                                         00010000
000200 TITLE 'READ IN FILE - PARSE USING UNSTRING COMMAND '             00020000
000300                                                                  00030000
000400 PROGRAM-ID.             SUKUT954.                                00040000
000500 AUTHOR.                 DENISE HAHN.                             00050000
000600 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00060000
000700 DATE-WRITTEN            NOVENBER, 2012.                          00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000                                                                  00100000
001100 ENVIRONMENT DIVISION.                                            00110000
001200                                                                  00120000
001300 CONFIGURATION SECTION.                                           00130000
001400                                                                  00140000
001500 SOURCE-COMPUTER.        IBM-3090.                                00150000
001600 OBJECT-COMPUTER.        IBM-3090.                                00160000
001700                                                                  00170000
001800 INPUT-OUTPUT SECTION.                                            00180000
001900                                                                  00190000
002000 FILE-CONTROL.                                                    00200000
002100                                                                  00210000
002200                                                                  00220000
002210     SELECT SU-DIVERT-FILE-IN           ASSIGN TO IN01.           00221000
002211     SELECT SU-DIVERT-FILE-OUT          ASSIGN TO OUT01.          00221100
002212                                                                  00221200
002213 DATA DIVISION.                                                   00221300
002214 FILE SECTION.                                                    00221400
002215                                                                  00221500
002216                                                                  00221600
002217 FD  SU-DIVERT-FILE-IN                                            00221700
002218     RECORDING MODE IS F                                          00221800
002219     LABEL RECORDS ARE STANDARD                                   00221900
002220     BLOCK CONTAINS 0 RECORDS.                                    00222000
002230 01  SU-DIVERT-RECORD-IN              PIC X(400).                 00223000
002240                                                                  00224000
002250 FD  SU-DIVERT-FILE-OUT                                           00225000
002260     RECORDING MODE IS F                                          00226000
002270     LABEL RECORDS ARE STANDARD                                   00227000
002280     BLOCK CONTAINS 0 RECORDS.                                    00228000
002290 01  SU-DIVERT-RECORD-OUT.                                        00229000
002291     05  SU-SML-NUMBER                PIC X(20).                  00229100
002292     05  SU-FILLER-1                  PIC X(01).                  00229200
002293     05  SU-DOOR-ID                   PIC X(04).                  00229314
002294     05  SU-FILLER-2                  PIC X(01).                  00229400
002295     05  SU-DIVERT-NBR                PIC 9(03).                  00229514
002296     05  SU-FILLER-3                  PIC X(01).                  00229600
002299     05  SU-DIVERT-DATE               PIC X(10).                  00229900
002300     05  SU-FILLER-5                  PIC X(01).                  00230000
002310     05  SU-DIVERT-TIME               PIC X(08).                  00231000
002320     05  SU-FILLER-6                  PIC X(03).                  00232000
002330                                                                  00233000
002340                                                                  00234000
002350                                                                  00235000
002360 WORKING-STORAGE SECTION.                                         00236000
002370 01  PS-SWITCHES.                                                 00237000
002380     05  PS-EOF-INPUT-SW              PIC X(01) VALUE 'N'.        00238000
002390         88 PS-NOT-EOF-INPUT                    VALUE 'N'.        00239000
002400         88 PS-EOF-INPUT                        VALUE 'Y'.        00240000
002500                                                                  00250000
002600 01  PV-VARIABLES.                                                00260000
002700     05  PV-INPUT-COUNT               PIC  9(09) VALUE ZEROES.    00270000
002800     05  PV-OUTPUT-COUNT              PIC  9(09) VALUE ZEROES.    00280000
002810     05  PV-ERROR-COUNT               PIC  9(09) VALUE ZEROES.    00281019
002820     05  PV-ZERO-SML-COUNT            PIC  9(09) VALUE ZEROES.    00282021
002830     05  PV-9999-SML-COUNT            PIC  9(09) VALUE ZEROES.    00283021
002840     05  PV-FLAT-COUNT                PIC  9(09) VALUE ZEROES.    00284025
002841     05  PV-INVALID-DOOR-COUNT        PIC  9(09) VALUE ZEROES.    00284125
002850     05  PV-0041-SML-COUNT            PIC  9(09) VALUE ZEROES.    00285023
002900                                                                  00290000
002910     05  PV-TIMESTAMP                 PIC  X(23) VALUE SPACES.    00291000
002911     05  PV-TIMESTAMP-R REDEFINES PV-TIMESTAMP.                   00291114
002912         10  PV-DIVERT-DATE           PIC  X(10).                 00291214
002913         10  FILLER                   PIC  X(01).                 00291314
002914         10  PV-DIVERT-TIME           PIC  X(08).                 00291414
002915         10  FILLER                   PIC  X(04).                 00291514
002920     05  PV-SML-NUMBER                PIC  X(20) VALUE SPACES.    00292000
002921     05  PV-SML-NUMBER-R REDEFINES PV-SML-NUMBER.                 00292106
002922         10  PV-SML-1-4               PIC  X(04).                 00292207
002923             88  PV-VALID-SML  VALUE '0041',  '0042'.             00292324
002924         10  FILLER                   PIC  X(16).                 00292407
002930     05  PV-INT-LOGICAL-DEST          PIC  X(03) VALUE SPACES.    00293000
002940     05  PV-SCANNER-ID                PIC  X(03) VALUE SPACES.    00294000
002950     05  PV-PHYSICAL-DEST             PIC  X(03) VALUE SPACES.    00295001
002960     05  PV-ACT-LOGICAL-DEST          PIC  X(03) VALUE SPACES.    00296014
002961     05  PV-ACT-LOGICAL-DEST-R REDEFINES PV-ACT-LOGICAL-DEST.     00296109
002962         10  PV-LOG-1                 PIC  X(01).                 00296210
002963             88 PV-VALID-DOOR                                     00296313
002964                             VALUE  '1', '2', '3', '4', '5',      00296413
002965                                    '6', '7', '8', '9', '0'.      00296513
002966         10  PV-FILLER                PIC  X(02).                 00296614
002970     05  PV-CNTL-DEST                 PIC  9(03) VALUE ZEROES.    00297016
002980     05  PV-FIRST-TIME                PIC  X(23) VALUE SPACES.    00298000
002990     05  PV-LAST-TIME                 PIC  X(23) VALUE SPACES.    00299000
002991     05  PV-DISPATCH-STATUS           PIC  X(06) VALUE SPACES.    00299100
002992     05  PV-DISPOSE-STATUS            PIC  X(06) VALUE SPACES.    00299200
002993     05  PV-DISPOSE-BIT               PIC  9(06) VALUE ZEROES.    00299319
002994     05  PV-BIT-STATUS                PIC  X(03) VALUE SPACES.    00299400
002995                                                                  00299500
003000     05  PV-HDG-PLANNED               PIC X(07).                  00300000
003100     05  PV-HDG-PLAN-DEST             PIC X(11).                  00310000
003200     05  PV-HDG-ACTUAL                PIC X(06).                  00320000
003300     05  PV-HDG-ACT-DEST              PIC X(11).                  00330000
003310     05  PV-HDG-ACT-STATUS            PIC X(06).                  00331000
003320     05  PV-HDG-DATE                  PIC X(04).                  00332000
003330     05  PV-HDG-TIME                  PIC X(04).                  00333000
003340                                                                  00334000
003350     05  PV-UNSTRING-DELIMITER-1      PIC  X(01)  VALUE SPACE.    00335000
003360                                                                  00336000
003370 PROCEDURE DIVISION.                                              00337000
003380     PERFORM 1000-INITIALIZE.                                     00338000
003390     PERFORM 2000-PROCESS UNTIL PS-EOF-INPUT.                     00339000
003400     PERFORM 9000-EOJ.                                            00340000
003500     GOBACK.                                                      00350000
003600                                                                  00360000
003700 1000-INITIALIZE.                                                 00370000
003800                                                                  00380000
003900     OPEN INPUT  SU-DIVERT-FILE-IN                                00390000
004000          OUTPUT SU-DIVERT-FILE-OUT.                              00400000
004100                                                                  00410000
004200     PERFORM 1200-READ-INPUT.                                     00420000
004300                                                                  00430000
004400 1200-READ-INPUT.                                                 00440000
004500                                                                  00450000
004600     READ SU-DIVERT-FILE-IN                                       00460000
004700     AT END                                                       00470000
004800         SET PS-EOF-INPUT   TO TRUE                               00480000
004900     NOT AT END                                                   00490000
005000         ADD 1              TO PV-INPUT-COUNT                     00500000
005100     END-READ.                                                    00510000
005200                                                                  00520000
005300 2000-PROCESS.                                                    00530000
005400                                                                  00540000
005500     MOVE  SPACES  TO  SU-FILLER-1                                00550000
005600                       SU-FILLER-2                                00560000
005700                       SU-FILLER-3                                00570000
005900                       SU-FILLER-5                                00590000
006000                       SU-FILLER-6                                00600000
006100                                                                  00610000
006200     UNSTRING SU-DIVERT-RECORD-IN                                 00620000
006300             DELIMITED BY ALL ','                                 00630000
006400                           INTO                                   00640002
006500                                PV-TIMESTAMP                      00650000
006510                                PV-SML-NUMBER                     00651000
006520                                PV-INT-LOGICAL-DEST               00652000
006600                                PV-SCANNER-ID                     00660000
006700                                PV-PHYSICAL-DEST                  00670000
006800                                PV-ACT-LOGICAL-DEST               00680000
006900                                PV-CNTL-DEST                      00690000
007000                                PV-FIRST-TIME                     00700000
007100                                PV-LAST-TIME                      00710000
007200                                PV-DISPATCH-STATUS                00720000
007300                                PV-DISPOSE-STATUS                 00730000
007400                                PV-DISPOSE-BIT                    00740000
007500                                PV-BIT-STATUS.                    00750000
007800                                                                  00780000
007820     IF  PV-SML-NUMBER       =  '00000000000000000000'            00782021
007821         ADD  1  TO  PV-ZERO-SML-COUNT                            00782121
007822     ELSE                                                         00782221
007825     IF  PV-SML-NUMBER       =  '99999999999999999999'            00782521
007826         ADD  1  TO  PV-9999-SML-COUNT                            00782621
007827     ELSE                                                         00782721
007829     IF  NOT  PV-VALID-SML                                        00782924
007831         ADD  1  TO  PV-0041-SML-COUNT                            00783124
007832     ELSE                                                         00783224
007833     IF  NOT  PV-VALID-DOOR                                       00783321
007834         ADD  1  TO  PV-INVALID-DOOR-COUNT                        00783421
007840     ELSE                                                         00784003
007841     IF  PV-INT-LOGICAL-DEST  = 'FLA'                             00784125
007842         ADD  1  TO  PV-FLAT-COUNT                                00784225
007843     ELSE                                                         00784325
007844     IF  PV-DISPOSE-BIT  >  0                                     00784419
007845         DISPLAY    PV-TIMESTAMP        '*'                       00784519
007846                    PV-SML-NUMBER       '*'                       00784619
007847                    PV-INT-LOGICAL-DEST '*'                       00784719
007848                    PV-SCANNER-ID       '*'                       00784819
007849                    PV-PHYSICAL-DEST    '*'                       00784919
007850                    PV-ACT-LOGICAL-DEST '*'                       00785019
007851                    PV-CNTL-DEST        '*'                       00785119
007852                    PV-FIRST-TIME       '*'                       00785219
007853                    PV-LAST-TIME        '*'                       00785319
007854                    PV-DISPATCH-STATUS  '*'                       00785419
007855                    PV-DISPOSE-STATUS   '*'                       00785519
007856                    PV-DISPOSE-BIT      '*'                       00785619
007857                    PV-BIT-STATUS                                 00785719
007858         ADD  1  TO  PV-ERROR-COUNT                               00785819
007859     ELSE                                                         00785919
007860         MOVE  PV-SML-NUMBER   TO  SU-SML-NUMBER                  00786019
007861         STRING 'D'                                               00786119
007862                PV-ACT-LOGICAL-DEST                               00786219
007863                DELIMITED BY SIZE                                 00786319
007864                             INTO  SU-DOOR-ID                     00786419
007865         MOVE  PV-CNTL-DEST    TO  SU-DIVERT-NBR                  00786519
007866         MOVE  PV-DIVERT-DATE  TO  SU-DIVERT-DATE                 00786619
007867         MOVE  PV-DIVERT-TIME  TO  SU-DIVERT-TIME                 00786719
007868****     DISPLAY SU-DIVERT-RECORD-OUT                             00786820
007870                                                                  00787017
007900         PERFORM 8000-WRITE-EXTRACT-RECORD                        00790018
008000                                                                  00800000
008100         ADD  1  TO  PV-OUTPUT-COUNT                              00810003
008110     END-IF                                                       00811019
008111     END-IF                                                       00811121
008112     END-IF                                                       00811221
008113     END-IF                                                       00811325
008114     END-IF                                                       00811425
008120     END-IF.                                                      00812019
008200                                                                  00820000
008300     PERFORM 1200-READ-INPUT.                                     00830000
008400                                                                  00840000
008500                                                                  00850000
008600 8000-WRITE-EXTRACT-RECORD.                                       00860000
008700     WRITE SU-DIVERT-RECORD-OUT.                                  00870000
008800                                                                  00880000
008900/                                                                 00890000
009000 9000-EOJ.                                                        00900000
009100                                                                  00910000
009200     CLOSE SU-DIVERT-FILE-IN                                      00920000
009300           SU-DIVERT-FILE-OUT.                                    00930000
009400                                                                  00940000
009500     DISPLAY 'SUKUT954'.                                          00950000
009600     DISPLAY 'INPUT COUNT    - ' PV-INPUT-COUNT.                  00960021
009601     DISPLAY ' '                                                  00960122
009602     DISPLAY 'ZERO SML COUNT - ' PV-ZERO-SML-COUNT.               00960221
009603     DISPLAY '9S SML COUNT   - ' PV-9999-SML-COUNT.               00960321
009604     DISPLAY 'NOT 0041 SML   - ' PV-0041-SML-COUNT.               00960421
009605     DISPLAY 'FLAT COUNT     - ' PV-FLAT-COUNT.                   00960525
009606     DISPLAY 'INVALID DOOR   - ' PV-INVALID-DOOR-COUNT.           00960625
009610     DISPLAY 'ERROR COUNT    - ' PV-ERROR-COUNT.                  00961022
009620     DISPLAY ' '                                                  00962022
009700     DISPLAY 'OUTPUT COUNT   - ' PV-OUTPUT-COUNT.                 00970022
009800                                                                  00980000
