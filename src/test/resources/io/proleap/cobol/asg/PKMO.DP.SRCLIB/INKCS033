      *-----------------------*                                                 
       IDENTIFICATION DIVISION.                                                 
      *-----------------------*                                                 
       PROGRAM-ID.    INKCS033.                                                 
       AUTHOR.        SCOTT JACKSON.                                            
       INSTALLATION.  KOHLS DEPARTMENT STORES.                                  
       DATE-WRITTEN.  10-01-99.                                                 
       DATE-COMPILED.                                                           
      *----------------------------------------------------------------*        
      *    I033 - ADD 'SHEET INVENTORY' SHEET                          *        
      *                                                                *        
      *    THIS PROGRAM ALLOWS THE USER TO ADD A 'SHEET INVENTORY'     *        
      *    SHEET.  FOR EACH LINE ON THE SHEET, A LINE IS ENTERED ON    *        
      *    THE SCREEN.  EACH LINE CORRESPONDS TO A ROW ON THE          *        
      *    INVENTORY ENTRY TABLE - TINENTY. 'SHEET INVENTORY' ROWS     *        
      *    CAN BE IDENTIFIED BY A 'SHEET_TYPE_CDE' OF 'K'.             *        
      *                                                                *        
      *    SHEETS CAN BE ADDED ANYTIME UP UNTIL A FLAG HAS BEEN        *        
      *    SET ON THE INVENTORY PARAMETER TABLE (TINVPAR).THE          *        
      *    CRITERIA SELECTION PROGRAM, INKCS030, DETERMINES WHETHER    *        
      *    THE FLAG HAS BEEN SET (INVPAR.SHEET_INV_CPLD_IND)           *        
      *    AND PASSES THE RESULTS VIA A SWITCH IN THE INTER-APPL       *        
      *    COMMAREA.                                                   *        
      *                                                                *        
      *    EACH LINE IS ASSIGNED A SEQUENTIAL LINE NUMBER, BEGINNING   *        
      *    WITH 1, AS IT IS STORED IN THE TABLE. A MAXIMUM OF 25       *        
      *    ENTRIES/LINES CAN BE ADDED FOR EACH 'SHEET'.                *        
      *    FOR EACH LINE, A SKU AND QUANTITY ARE ENTERED. CLEARANCE    *        
      *    SKU'S (CODE '30') WILL REQUIRE ENTRY OF UNIT RETAIL         *        
      *                                                                         
      *                                                                         
      *----------------------------------------------------------------*        
      *   'REGIONAL CLEARANCE PRICING' (RCP) PROCESSING                *        
      *   ---------------------------------------------                *        
      *    FOR EACH ENTRY OF A UPC OR SKU ONLINE, THE ITEM NUMBER IS   *        
      *    RETRIEVED FROM TSK. AN ENTRY IS AN RCP ITEM IF COLUMN       *        
      *    TSK.REGN_PRIC_IND CONTAINS A 'Y'. THE ITEM NUMBER IS USED   *        
      *    TO LINK TSK & TUPCPLS. IF THE SKU WAS AN RCP ITEM, THEN THE *        
      *    STORE-SPECIFIC ROW ON TUPCPLS IS USED TO DETERMINE COST AND *        
      *    RETAIL FOR SKU. IF NO ROW IS FOUND FOR THE PARTICULAR STORE *        
      *    THEN THE STORE 000 ROW PRICING IS TO BE USED FOR THIS LINE. *        
      *                                                                *        
      *  THE STORE PRICE MUST BE ENTERED FOR THE FOLLOWING CONDITIONS..*        
      *    - IF A SKU WAS ENTERED AND IT IS A CLEARANCE SKU (STAT '30')*        
      *    - THE SKU SEQUENCE NUMBER IS '000' OR '999'                 *        
      *    - INTERNAL UPC WITH A SEQUENCE NBR OF '000' OR '999'        *        
      *                                                                *        
      *    THE RETAIL WILL BE RETRIEVED FROM TUPCPLS. THE FIRST        *        
      *    ATTEMPT WILL LOOK FOR A STORE-SPECIFIC PRICE AND IF NO ROW  *        
      *    ROW IS FOUND, THE PRICE WILL BE RETRIEVED FOR STORE '000'   *        
      *    ROW. IF THE SKU ENTERED WAS RENUMBERED BEFORE               *        
      *    INVENTORY TOOK PLACE, THE RENUMBERED SKU IS USED TO         *        
      *    DETERMINE THE RETAIL. PRICES ARE DISPLAYED  ONLY            *        
      *    AFTER ALL EDITS HAVE BEEN PASSED.                           *        
      *----------------------------------------------------------------*        
      * 03/04/2000  SCOTT JACKSON      CHG ID:SMJ                      *        
      *    ONLINE ABENDS (-913) OCCUR UPON ENTRY TO SHEET MAINTENANCE  *        
      *    IF TINVPAR IS WAS BEING UPDATED BY BATCH PROCESSES. 'SOFT'  *        
      *    ABEND TO USER WITH 'RESOURCE UNAVAILABLE' ON INITIAL READ . *        
      *----------------------------------------------------------------*        
IN2001* 09/06/2000  SCOTT JACKSON      CHG ID:IN2001                  *         
IN2001*  AN ITEM IN RCP STATUS MAY BE RETURNED TO NON-RCP STATUS      *         
IN2001*  PRIOR TO PROCESSING ALL OF THE STORE'S DATA. THEREFORE USING *         
IN2001*  TSK.REGN_PRICE_IND AS THE IND TO OBTAINING CURRENT PRICE MAY *         
IN2001*  BE INCORRECT AND UNRELIABLE BASED ON WHEN DATA IS PROCESSED. *         
IN2001*  TUPCPLS WILL BE USED SOLELY IN DETERMINING AN ITEM'S STATUS. *         
IN2001*  CHECK STORE 000 ROW 1ST (IF STATUS = '25' OR '30' CHECK FOR  *         
IN2001*  STORE-SPECIFIC ROW). USE STORE 000 PRICING IF NO STORE ROW.  *         
IN2001*  IF STATUS <> '25' THEN STORE-SPECIFIC ROW WILL NOT BE CHECKED*         
      *----------------------------------------------------------------*        
IN2002* 01/25/2002  SCOTT JACKSON      CHG ID:IN2002                  *         
IN2002*  A SKU SEQUENCE NUMBER OF '999' OR '000' NEED TO BE TREATED   *         
IN2002*  DIFFERENTLY FOR PURPOSES OF FLAGGING SKU'S AS INVALID.       *         
IN2002*  A SEQUENCE NUMBER OF '000' WILL ALLOW RECORDS TO BE CREATED  *         
IN2002*  (USER MUST ENTER PRICE) AND PASS THROUGH THE BATCH EDITS.    *         
IN2002*  A SEQUENCE NUMBER OF '999' IS CONSIDERED INVALID AND WILL NOT*         
IN2002*  PASS THE EDIT CHECKS IN THIS PROGRAM. THESE ARE NOT ALLOWED  *         
IN2002*  AND WILL NOT PASS THROUGH TO THE BATCH PROCESS.              *         
      *---------------------------------------------------------------*         
23511C* 05/21/2002 CAROL WOJCIECHOWSKI CHG ID:23511C                  *         
23511C*  DISPLAY THE PRICE FOR A YELLOW TICKET SKU WHEN THE           *         
23511C*  UPC_STAT_CHG_DTE IS EQUAL TO THE UNT_RTL_CHG_DTE             *         
W21732*---------------------------------------------------------------*         
W21732* 10/28/2002 IGSI                CHG ID:W21732                  *         
W21732* ACCEPT NON-INTELLIGENT SKU IN PLACE OF THE CURRENT DEPT/CLASS/*         
W21732* SEQ NUMBER.                                                   *         
C21732*----------------------------------------------------------------*        
24029 * 24029    01-28-2003  DEPT/CLASS 254/48 IS INVALID; HOWEVER, THE         
24029 *                      MODULE IS ALLOWING ENTRY WITHOUT AN ERROR.         
24029 *                      WHY?     - ROD JANSSEN                             
C21732*----------------------------------------------------------------*        
C21732*    CHANGE BY S JACKSON  3/17/03                                *        
C21732*    USE DPKUT041 - NEW SKU COMPLIANT UPC LOOKUP MODULE                   
W24521*    ALLOW RETAIL OVERIDE OF YELLOW-TICKET MERCHANDISE FOR DC/RTV*        
W24521*----------------------------------------------------------------*        
JAN04 *    CHANGE BY S JACKSON  1/20/04         CHANGE ID : JAN04      *        
W25248*    ISSUE FOUND WHERE A CLEARANCE ITEM WAS BEING PROMPTED FOR A *        
W25248*    RETAIL, ALLOWED ENTRY, THEN PROMPTING FOR ENTRY AGAIN. THIS *        
W25248*    OCCURED WITH AN RCP STORE-SPECIFIC ROW. SET THE FLAG TO     *        
W25248*    POPULATE THE SCREEN RETAIL WITH 'YELLOW' TICKET PRICING AND *        
JAN04 *    NOT TO REQ ENTRY OF CLEARANCE RETAIL IF FIRST MKDN (YELLOW) *        
      *----------------------------------------------------------------*        
W26600*  W26600  07/  /2004  PHYSICAL INVENTORY STORE EXPANSION                 
W26600*                      ALSO DISPLAYED STORE NAME WITH THE                 
W26600*                      LOCATION ID (STORE NUMBER)                         
W26600*                      M JOHNSON                                          
W26600*                                                                         
      *----------------------------------------------------------------*        
W26006*  W26006  02/24/2005  REMOVE REFERENCES TO OBSOLETE STORE TABLE.         
W26006*                      ERIN SEARL                                         
W28545*  W28545   08-22-2005  ROD JANSSEN THE NEW TRANSFER PROCESS              
W28545*----------------------------------------------------------------*        
W28545*  W28545  02/06/2006  CAPTURING AND REPORTING UPC FOR INVENTORY.         
W28545*                      JOHN SELWITSCHKA                                   
J28545*  W28545  05-30-2006  USE THE PRICING MODULE, INPD400, TO LOOK           
J28545*                      UP PRICE AND VALIDATE SKU OR UPC.                  
J28545*                      ALSO, TINVPAR/TINCNTL ARE USED TO GET              
J28545*                      THE PROPER INV-ID AND STORE.                       
J28545*                      -JAN BLAZICH                                       
W28582*  W28582  07-31-2007  AFTER LOOKING UP RETAIL WITH UPC, IF DUMMY         
W28582*                      UPC GET DATA FROM ATTRIBUTES.                      
W28545*                      -JOHN SELWITSCHKA                                  
      *  W33304  05-01-2008  HOLDING INVENTORY LEDGER OPEN ACROSS               
      *                      PERIODS INVENTORY SHORTAGE REPORTING               
      *                      -JILL LIN                                          
SR3403*  SR3403  03-27-2012  AMT FIELD EXPANSIONS FOR LARGE RETAIL              
SR3403*                      PROJECT                                            
SR3403*                      -JALAJ KUMAR                                       
      *****************************************************************         
263126* CHANGED 10/25/2021    BY JIM HUNTER      WR: CHG0263126                 
263126* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263126* MAKING THE CALL DYNAMIC VS STATIC.                                      
263126*----------------------------------------------------------------*        
004000* CHANGED 11/03/2022    BY BOB MCASEY      WR: CHG0277188                 
004100* ADDED THE DPKCS930 COPYBOOK. CHANGED THE PARAMETERS FOR CALLING         
004200* THE CICS ARCHITECTURE API.                                              
004300*---------------------------------------------------------------*         
      * CHANGED 02/14/2023    BY JEAN KURK       WR: CHG0281369                 
      * REMOVE COPYBOOK FOR THE UPC CHECK DIGIT ROUTINE                         
      *---------------------------------------------------------------*         
                                                                                
                                                                                
                                                                                
       ENVIRONMENT DIVISION.                                                    
                                                                                
                                                                                
                                                                                
       DATA DIVISION.                                                           
                                                                                
                                                                                
       WORKING-STORAGE SECTION.                                                 
                                                                                
       01  PC-PROGRAM-CONSTANTS.                                                
           05  PC-CURRENT-MAP-NAME     PIC  X(08) VALUE 'IN033A  '.             
           05  PC-CURRENT-MAPSET-NAME  PIC  X(08) VALUE 'INKM033 '.             
           05  PC-CURRENT-PROGRAM-NAME PIC  X(08) VALUE 'INKCS033'.             
           05  PC-CALENDAR-ROUTINE     PIC  X(08) VALUE 'DPKUT500'.             
           05  PC-LINES-PER-PANEL      PIC S9(04) VALUE +25   COMP SYNC.        
           05  PC-CLEARANCE-SKU-STATUS PIC  X(02) VALUE '30'.                   
IN2001     05  PC-MIXED-STATUS         PIC  X(02) VALUE '25'.                   
           05  PC-RENUMBERED-SKU-STAT98                                         
                                       PIC  X(02) VALUE '98'.                   
           05  PC-MDSELV-CDE           PIC  X(03) VALUE 'SCL'.                  
           05  PC-OPERCO-NBR           PIC  X(02) VALUE '03'.                   
           05  PC-APLSYS-CDE           PIC  X(02) VALUE 'IN'.                   
W24521     05  PC-DC                   PIC  X(02) VALUE 'DC'.                   
W24521     05  PC-RTV                  PIC  X(02) VALUE 'RV'.                   
           05  PC-ITM-UNIT-PR-MAX-DIGITS                                        
                                       PIC S9(04) VALUE +5.                     
           05  PC-MAX-QTY              PIC  9(04) VALUE 9999.                   
           05  PC-MIN-PRICE            PIC  9(05)V99                            
                                                  VALUE .01.                    
SR3403     05  PC-MAX-PRICE            PIC  9(05)V99                            
SR3403                                            VALUE 99999.99.               
           05  PC-STORE-000            PIC S9(04) COMP        VALUE +0.         
           05  PC-KEYED-SHEET-ENTRY    PIC  X(01) VALUE 'K'.                    
           05  PC-TSYMSG-NUMBERS.                                               
               10  PC-TSYMSG-00005     PIC  9(05) VALUE 00005.                  
               10  PC-TSYMSG-00007     PIC  9(05) VALUE 00007.                  
               10  PC-TSYMSG-00008     PIC  9(05) VALUE 00008.                  
               10  PC-TSYMSG-00010     PIC  9(05) VALUE 00010.                  
               10  PC-TSYMSG-00137     PIC  9(05) VALUE 00137.                  
               10  PC-TSYMSG-00343     PIC  9(05) VALUE 00343.                  
NEW            10  PC-TSYMSG-00375     PIC  9(05) VALUE 00375.                  
               10  PC-TSYMSG-00413     PIC  9(05) VALUE 00413.                  
W28545         10  PC-TSYMSG-00453     PIC  9(05) VALUE 00453.                  
               10  PC-TSYMSG-00551     PIC  9(05) VALUE 00551.                  
               10  PC-TSYMSG-00552     PIC  9(05) VALUE 00552.                  
               10  PC-TSYMSG-00560     PIC  9(05) VALUE 00560.                  
SMJ            10  PC-TSYMSG-01063     PIC  9(05) VALUE 01063.                  
               10  PC-TSYMSG-02143     PIC  9(05) VALUE 02143.                  
               10  PC-TSYMSG-02144     PIC  9(05) VALUE 02144.                  
               10  PC-TSYMSG-02145     PIC  9(05) VALUE 02145.                  
IN2002         10  PC-TSYMSG-02891     PIC  9(05) VALUE 02891.                  
                                                                                
                                                                                
       01  PS-PROGRAM-SUBSCRIPTS.                                               
           05  PS-SUB                  PIC S9(04) VALUE +0    COMP SYNC.        
           05  PS-SUB2                 PIC S9(04) VALUE +0    COMP SYNC.        
      *                                                                         
       01  PS-PROGRAM-SWITCHES.                                                 
           05  PS-ERROR-SW             PIC  X     VALUE  'N'.                   
               88  PS-ERROR                       VALUE  'Y'.                   
               88  PS-NO-ERROR                    VALUE  'N'.                   
           05  PS-ERRORS-IN-LINE-SW    PIC  X     VALUE  'N'.                   
               88  PS-ERRORS-IN-LINE              VALUE  'Y'.                   
               88  PS-NO-ERRORS-IN-LINE           VALUE  'N'.                   
           05  PS-DATA-ENTERED-SW      PIC  X     VALUE  'N'.                   
               88  PS-DATA-ENTERED                VALUE  'Y'.                   
               88  PS-NO-DATA-ENTERED             VALUE  'N'.                   
           05  PS-INVALID-SKU-SW       PIC X      VALUE  'N'.                   
               88  PS-VALID-SKU                   VALUE  'Y'.                   
               88  PS-INVALID-SKU                 VALUE  'N'.                   
W28545     05  PS-INVALID-UPC-SW       PIC X      VALUE  'N'.                   
W28545         88  PS-VALID-UPC                   VALUE  'Y'.                   
W28545         88  PS-INVALID-UPC                 VALUE  'N'.                   
           05  PS-DONE-RENUMBERING-SW  PIC X      VALUE  'N'.                   
               88  PS-DONE-RENUMBERING            VALUE  'Y'.                   
               88  PS-NOT-DONE-RENUMBERING        VALUE  'N'.                   
           05  PS-ADD-SUCCESSFUL-SW    PIC X      VALUE  'Y'.                   
               88 PS-ADD-SUCCESSFUL               VALUE  'Y'.                   
               88 PS-ADD-NOT-SUCCESSFUL           VALUE  'N'.                   
           05  PS-GOT-LAST-PRICE-SW    PIC X.                                   
               88  PS-GOT-LAST-PRICE-FROM-SCREEN                                
                                                  VALUE 'S'.                    
J28545         88  PS-GOT-LAST-PRICE-FROM-INPD400                               
                                                  VALUE 'T'.                    
               88  PS-DIDNT-GET-LAST-PRICE        VALUE 'N'.                    
SMJ        05  PS-INVPAR-SW            PIC  X     VALUE  'N'.                   
SMJ            88  PS-UNAVAILABLE-RESOURCE        VALUE  'Y'.                   
SMJ            88  PS-INVPAR-PROCESSED            VALUE  'N'.                   
      *                                                                         
W28545 01  WS-EDIT-UPC-SKU-TABLE.                                               
W28545     05  WS-EDIT-ELEMENTS        OCCURS 15 TIMES.                         
W28545         10  WS-EDIT-BYTE        PIC X(01).                               
W28545                                                                          
       01  PV-PROGRAM-VARIABLES.                                                
W21732     05  PV-DUMMY-SKU            PIC X(08).                               
W28545     05  PV-BYTE-SUB             PIC S9(05) COMP VALUE ZEROS.             
W28545     05  PV-BYTE-COUNT           PIC S9(15) COMP VALUE ZEROS.             
W28545     05  PV-BYTE-ACCUM           PIC S9(15) COMP VALUE ZEROS.             
W28545     05  PV-EDIT-UPC-SKU         PIC X(15).                               
W28545     05  PV-EDIT-UPC-SKU-NUM REDEFINES                                    
W28545         PV-EDIT-UPC-SKU         PIC 9(15).                               
W28545     05  PV-SKU-POS              PIC S9(04) COMP VALUE ZEROS.             
W28545     05  PV-UPC-POS              PIC S9(04) COMP VALUE ZEROS.             
           05  PV-CICS-RESPONSE        PIC S9(04) VALUE +0    COMP SYNC.        
           05  PV-STAT-CHNGD-DATE-YYYYMMDD                                      
                                       PIC  X(08).                              
           05  PV-ACTL-INV-DTE-DB2.                                             
               10 PV-ACTL-DB2-INV-YYYY PIC  X(04) VALUE SPACES.                 
               10 FILLER               PIC  X(01) VALUE '-'.                    
               10 PV-ACTL-DB2-INV-MM   PIC  X(02).                              
               10 FILLER               PIC  X(01) VALUE '-'.                    
               10 PV-ACTL-DB2-INV-DD   PIC  X(02).                              
                                                                                
           05  PV-ACTL-INV-DTE-COMP.                                            
               10 PV-COMP-INV-YYYY     PIC  X(04) VALUE SPACES.                 
               10 PV-COMP-INV-MM       PIC  X(02).                              
               10 PV-COMP-INV-DD       PIC  X(02).                              
           05  PV-MAJ-CL-NBR.                                                   
               10 PV-MAJ-CL-NBR-1      PIC  X     VALUE SPACES.                 
               10 PV-MAJ-CL-NBR-2      PIC  X     VALUE SPACES.                 
           05  PV-SUB-CL-NBR.                                                   
               10 PV-SUB-CL-NBR-1      PIC  X     VALUE SPACES.                 
               10 PV-SUB-CL-NBR-2-3    PIC  X(02) VALUE SPACES.                 
W21732     05  PV-DATE                 PIC  X(10).                              
W21732     05  PV-YYMMDD-DATE          PIC  X(6).                               
W21732     05  FILLER                  REDEFINES                                
W21732         PV-YYMMDD-DATE.                                                  
W21732         10  PV-YYMMDD-YY        PIC  X(02).                              
W21732         10  PV-YYMMDD-MMDD.                                              
W21732             15 PV-YYMMDD-MM     PIC  X(02).                              
W21732             15 PV-YYMMDD-DD     PIC  X(02).                              
JKB        05  PV-INV-ID               PIC S9(9)    COMP.                       
                                                                                
W21732     05  PV-MMDDYY-DATE.                                                  
W21732         10  PV-MMDDYY-MMDD      PIC  X(04).                              
W21732         10  PV-MMDDYY-YY        PIC  X(02).                              
J28545     05  PV-IN400-ROW.                                                    
J28545         10  PV-IN400-UPC-STAT-CDE   PIC X(02)    VALUE SPACES.           
J28545         10  PV-IN400-UNT-RTL-AMT    PIC S9(7)V99 VALUE +0 COMP-3.        
J28545         10  PV-IN400-MITGPL-QTY     PIC S9(9)    VALUE +0 COMP-3.        
                                                                                
       01  PV-DB2-KEY-AREA.                                                     
W26600     05  PV-DB2-STORE-NBR-X        PIC  X(04).                            
           05  PV-DB2-STORE-NBR-RED REDEFINES                                   
W26600         PV-DB2-STORE-NBR-X        PIC  9(04).                            
           05  PV-DB2-STORE-NBR          PIC S9(04)  COMP.                      
W28545     05  PV-DB2-TYPE-CDE           PIC X(01).                             
           05  PV-SHEET-NBR-X            PIC  X(06).                            
           05  PV-SHEET-NBR-RED     REDEFINES                                   
               PV-SHEET-NBR-X            PIC  9(06).                            
           05  PV-SHEET-NBR              PIC S9(09)  COMP.                      
           05  PV-DB2-UPC-NBR            PIC S9(15)       COMP-3.               
           05  PV-DB2-ITEM-NMBR          PIC S9(15)       COMP-3.               
W21732     05  PV-DB2-SKU-SEQ-NBR        PIC  X(08).                            
W21732     05  PV-DB2-SKU-SEQ-NBR-N    REDEFINES                                
W21732         PV-DB2-SKU-SEQ-NBR        PIC  9(08).                            
SR3403     05  PV-GROUP-UNIT-RTL         PIC  9(05)V99 VALUE ZEROES.            
SR3403     05  PV-ITEM-RETAIL            PIC  9(05)V99 VALUE ZEROES.            
           05  PV-EXTD-RTL-AMT           PIC  9(10)V99 VALUE ZEROES.            
                                                                                
       01  PV-PLND-INV-TMST            PIC  X(26) VALUE SPACES.                 
                                                                                
       01  PV-PLND-INV-TIMESTAMP.                                               
           10  PV-PLND-INV-DTE         PIC  X(10) VALUE SPACES.                 
           10  PV-DASH                 PIC  X(01) VALUE '-'.                    
           10  PV-PLND-DTE-HOUR        PIC  X(02) VALUE '23'.                   
           10  PV-SEPARATOR            PIC  X(01) VALUE '.'.                    
           10  PV-PLND-DTE-MINUTE      PIC  X(02) VALUE '59'.                   
           10  PV-SEPARATOR            PIC  X(01) VALUE '.'.                    
           10  PV-PLND-DTE-SECOND      PIC  X(02) VALUE '59'.                   
           10  PV-SEPARATOR            PIC  X(01) VALUE '.'.                    
           10  PV-PLND-DTE-MSEC        PIC  X(06) VALUE '999999'.               
                                                                                
W28545 01  PV-RENUMBERED-SKU.                                                   
W28545     10  PV-RSKU-NBR             PIC  X(08).                              
                                                                                
       EJECT                                                                    
      *----------------------------------------------------------------*        
      *    MAP LAYOUT                                                  *        
      *----------------------------------------------------------------*        
                                                                                
           COPY INKM033.                                                        
                                                                                
       01  MR-OCCURS-LAYOUT          REDEFINES  IN033AO.                        
W28545     05  FILLER                PIC X(90).                                 
           05  MR-DETAIL-LINE OCCURS 25 TIMES.                                  
W21732         10  MR-SKUL           PIC S9(04) COMP.                           
W21732         10  MR-SKUA           PIC  X(01).                                
W21732         10  MR-SKUF           REDEFINES                                  
W21732             MR-SKUA           PIC  X(01).                                
W21732         10  MR-SKUC           PIC  X(01).                                
W21732         10  MR-SKUH           PIC  X(01).                                
W28545*        10  MR-SKU            PIC  X(08).                                
W28545         10  MR-SKU.                                                      
W28545             15                PIC  X(07).                                
W28545             15  MR-SKU-8      PIC  X(08).                                
W28545         10  MR-UPC            REDEFINES                                  
W28545             MR-SKU            PIC  X(15).                                
               10  MR-QTYL           PIC S9(04) COMP.                           
               10  MR-QTYA           PIC  X(01).                                
               10  MR-QTYF           REDEFINES                                  
                   MR-QTYA           PIC  X(01).                                
               10  MR-QTYC           PIC  X(01).                                
               10  MR-QTYH           PIC  X(01).                                
               10  MR-QTY-X.                                                    
SR3403             15  MR-QTY        PIC  Z(2)9.                                
                   15  MR-QTY-RED REDEFINES                                     
SR3403                 MR-QTY        PIC  9(03).                                
               10  MR-PRCEL          PIC S9(04) COMP.                           
               10  MR-PRCEA          PIC  X(01).                                
               10  MR-PRCEF          REDEFINES                                  
                   MR-PRCEA          PIC  X(01).                                
               10  MR-PRCEC          PIC  X(01).                                
               10  MR-PRCEH          PIC  X(01).                                
               10  MR-PRCE-X.                                                   
SR3403             15  MR-PRCE       PIC  Z(05).99.                             
               10  MR-EXTDL          PIC S9(04) COMP.                           
               10  MR-EXTDA          PIC  X(01).                                
               10  MR-EXTDF          REDEFINES                                  
                   MR-EXTDA          PIC  X(01).                                
               10  MR-EXTDC          PIC  X(01).                                
               10  MR-EXTDH          PIC  X(01).                                
               10  MR-EXTD-X.                                                   
W28545*            15  MR-EXTD       PIC  ZZ,ZZZ,ZZZ.99.                        
W28545             15  MR-EXTD       PIC  ZZZZZ.99.                             
           05  MR-TOTAL-LINES.                                                  
               10  MR-TOTAL-RETAIL.                                             
                   15  MR-TRTLL          PIC S9(04) COMP.                       
                   15  MR-TRTLA          PIC  X(01).                            
                   15  MR-TRTLF          REDEFINES                              
                       MR-TRTLA          PIC  X(01).                            
                   15  MR-TRTLC          PIC  X(01).                            
                   15  MR-TRTLH          PIC  X(01).                            
                   15  MR-TRTL-X.                                               
                       20  MR-TRTL       PIC  Z,ZZZ,ZZZ,ZZZ.99.                 
               10  MR-TOTAL-QTY.                                                
                   15  MR-TQTYL           PIC S9(04) COMP.                      
                   15  MR-TQTYA           PIC  X(01).                           
                   15  MR-TQTYF           REDEFINES                             
                       MR-TQTYA           PIC  X(01).                           
                   15  MR-TQTYC           PIC  X(01).                           
                   15  MR-TQTYH           PIC  X(01).                           
                   15  MR-TQTY-X.                                               
                       20  MR-TQTY        PIC  ZZ,ZZZ,ZZ9.                      
               10  MR-TOTAL-EXTD-RTL.                                           
                   15  MR-TEXTDL         PIC S9(04) COMP.                       
                   15  MR-TEXTDA         PIC  X(01).                            
                   15  MR-TEXTDF         REDEFINES                              
                       MR-TEXTDA         PIC  X(01).                            
                   15  MR-TEXTDC         PIC  X(01).                            
                   15  MR-TEXTDH         PIC  X(01).                            
                   15  MR-TEXTD-X.                                              
                       20  MR-TEXTD      PIC  Z,ZZZ,ZZZ,ZZZ.99.                 
           EJECT                                                                
      *----------------------------------------------------------------*        
      *    COPY BOOK FOR NUMERIC EDIT SUBROUTINE (DPKUT100) PARAMETER  *        
      *    LIST.                                                       *        
      *----------------------------------------------------------------*        
                                                                                
           COPY DPWS010I.                                                       
                                                                                
      *----------------------------------------------------------------*        
      *    ATTRIBUTE SETTINGS COPYBOOK.                                *        
      *----------------------------------------------------------------*        
                                                                                
           COPY DPWS015.                                                        
                                                                                
      *----------------------------------------------------------------*        
      *    FUNCTION KEYS COPYBOOK                                      *        
      *----------------------------------------------------------------*        
                                                                                
           COPY DPWS016.                                                        
                                                                                
      *----------------------------------------------------------------*        
      *    COPY BOOK FOR CURRENT SYSTEM DATE/TIME PROCEDURE DIVISION   *        
      *    ROUTINE                                                              
      *----------------------------------------------------------------*        
                                                                                
           COPY DPWS017.                                                        
                                                                                
      *----------------------------------------------------------------*        
      *    COPY BOOK FOR CALENDAR SUBROUTINE (DPKUT500)                         
      *----------------------------------------------------------------*        
                                                                                
           COPY DPWS500.                                                        
                                                                                
       EJECT                                                                    
      *****************************************************************         
      * PARAMETERS FOR CALLING CICS ARCHITECTURE API (DPKCS030).                
      *****************************************************************         
           COPY DPWS030.                                                        
1122RM     COPY DPWS930.                                                        
       EJECT                                                                    
      *****************************************************************         
      *    STANDARD COMMAREA.                                                   
      *****************************************************************         
                                                                                
           COPY DPWS020.                                                        
           05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                        
                                                                                
      *****************************************************************         
      *    INTER-APPLICATION COMMAREA.                                          
      *****************************************************************         
                                                                                
               10  INTER-APPL-COMM-AREA PIC X(200).                             
           COPY INWS030.                                                        
      *****************************************************************         
      *    SPECIFIC COMMMAREA FOR INKCS033.                                     
      *****************************************************************         
               10  ASC-SPECIFIC-COMMAREA.                                       
                 12  ASC-FIELDS-FROM-INTERAPPL-COMM.                            
W26600             15  ASC-KEY-STORE-NBR-X         PIC  X(04).                  
                   15  ASC-KEY-SHEET-NBR-X.                                     
                       20  ASC-KEY-SHEET-NBR       PIC  9(06).                  
W28545             15  ASC-KEY-TYPE-CDE           PIC X(01).                    
W28545                 88  ASC-TYPE-ALL-SHEETS    VALUE '*'.                    
W28545                 88  ASC-TYPE-TFR-SHEETS    VALUE 'T'.                    
W28545                 88  ASC-TYPE-MANI-SHEETS   VALUE 'M'.                    
W28545                 88  ASC-TYPE-ENTRD-SHEETS  VALUE 'K'.                    
W28545             15  ASC-TYPE-CDE-DESC              PIC X(25).                
W28545                 88  ASC-DESC-ALL-SHEETS                                  
W28545                     VALUE 'ALL SHEETS'.                                  
W28545                 88  ASC-DESC-TFR-SHEETS                                  
W28545                     VALUE 'TRANSFER STORE SHEETS'.                       
W28545                 88  ASC-DESC-MANI-SHEETS                                 
W28545                     VALUE 'MANIFEST TRAILER SHEETS'.                     
W28545                 88  ASC-DESC-ENTRD-SHEETS                                
W28545                     VALUE 'USER ENTERED SHEETS'.                         
                   15  ASC-STORE-NAME              PIC  X(25).                  
                   15  ASC-ACTL-INV-DTE-YYYYMMDD   PIC  X(08).                  
                                                                                
                 12  ASC-ITEM-ARRAY.                                            
                   15  ASC-MAP-DETAIL-LINE         OCCURS 25 TIMES.             
W21732                 20  ASC-SKU-SEQ-NBR         PIC  X(08).                  
W21732                 20  ASC-SKU-SEQ-NBR-N       REDEFINES                    
W21732                     ASC-SKU-SEQ-NBR         PIC  9(08).                  
W28545                 20  ASC-UPC-NBR-X           PIC  X(15).                  
W28545                 20  ASC-UPC-NBR             REDEFINES                    
W28545                     ASC-UPC-NBR-X           PIC  9(15).                  
W28545                 20  FILLER                  REDEFINES                    
W28545                     ASC-UPC-NBR-X.                                       
W28545                     25  FILLER              PIC  X(02).                  
W28545                     25  ASC-UPC-1-2         PIC  X(02).                  
W28545                         88  ASC-UPC-INTERNAL       VALUE '04'.           
W28545                     25  ASC-UPC-3-4         PIC  X(02).                  
W28545                     25  ASC-UPC-SKU         PIC  X(08).                  
W28545                     25  ASC-UPC-CHECK-DIGIT PIC  9.                      
                       20  ASC-INV-QTY-X           PIC  X(04).                  
                       20  ASC-INV-QTY             REDEFINES                    
                           ASC-INV-QTY-X           PIC  9(04).                  
SR3403                 20  ASC-ITM-UNIT-PR-AMT-X   PIC  X(08).                  
SR3403                 20  ASC-ITM-UNIT-PR-AMT-X-FMT                            
SR3403                                             REDEFINES                    
SR3403                     ASC-ITM-UNIT-PR-AMT-X   PIC  Z(5).99.                
SR3403                 20  ASC-ITM-UNIT-PR-AMT     PIC  9(5)V99.                
W28545                 20  ASC-ITM-EXTD-PR-AMT-X   PIC  X(08).                  
W28545                 20  ASC-ITM-EXTD-PR-AMT-X-FMT                            
W28545                                             REDEFINES                    
W28545                     ASC-ITM-EXTD-PR-AMT-X   PIC  Z(05).99.               
W28545                 20  ASC-ITM-EXTD-PR-AMT     PIC  9(05)V99.               
                       20  ASC-SKU-ENTERED-SW      PIC  X.                      
                           88 ASC-SKU-ENTERED             VALUE 'Y'.            
                           88 ASC-SKU-NOT-ENTERED         VALUE 'N'.            
W28545                 20  ASC-UPC-ENTERED-SW      PIC  X.                      
W28545                     88 ASC-UPC-ENTERED             VALUE 'Y'.            
W28545                     88 ASC-UPC-NOT-ENTERED         VALUE 'N'.            
                       20  ASC-GET-PRICE-SW        PIC X.                       
                           88  ASC-GET-PRICE-FROM-SCREEN  VALUE 'S'.            
J28545                     88  ASC-GET-PRICE-FROM-INPD400 VALUE 'T'.            
J28545                     88  ASC-GOT-INPD400-PRICE      VALUE 'O'.            
                           88  ASC-DONT-GET-PRICE         VALUE 'N'.            
W24521**                   88  ASC-ALLOW-RETAIL-CHANGE    VALUE 'E'.            
                 12  ASC-TOTAL-FIELDS.                                          
                   15  ASC-TOTAL-RTL-AMT-X         PIC  X(12).                  
                   15  ASC-TOTAL-RTL-AMT-X-FMT     REDEFINES                    
                       ASC-TOTAL-RTL-AMT-X         PIC  Z(09).99.               
                   15  ASC-TOTAL-RTL-AMT           PIC  9(09)V99.               
                                                                                
                   15  ASC-TOTAL-QTY-AMT-X         PIC  X(08).                  
                   15  ASC-TOTAL-QTY-AMT-X-FMT     REDEFINES                    
                       ASC-TOTAL-QTY-AMT-X         PIC  Z(7)9.                  
                   15  ASC-TOTAL-QTY-AMT           PIC  9(08).                  
                                                                                
                   15  ASC-TOTAL-EXTD-RTL-X        PIC  X(12).                  
                   15  ASC-TOTAL-EXTD-RTL-X-FMT    REDEFINES                    
                       ASC-TOTAL-EXTD-RTL-X        PIC  Z(09).99.               
                   15  ASC-TOTAL-EXTD-RTL          PIC  9(09)V99.               
W28545*        10  FILLER                          PIC  X(1433).                
SR3403         10  FILLER                          PIC  X(1209).                
                                                                                
J28545     COPY INWS400.                                                        
      *----------------------------------------------------------------*        
      *    ABEND PROCESSING COPYBOOK.                                  *        
      *----------------------------------------------------------------*        
                                                                                
           COPY DPWS013.                                                        
                                                                                
      *    DB2 AREA FOR TMITGPL (VSM - GROUP PRICING TABLE)                     
                                                                                
                                                                                
      *    DB2 AREA FOR TINVPAR (INVENTORY PARAMETERS TABLE)                    
                                                                                
           EXEC SQL                                                             
                INCLUDE TINVPAR                                                 
           END-EXEC.                                                            
                                                                                
           EXEC SQL                                                             
                INCLUDE TINCNTL                                                 
           END-EXEC.                                                            
                                                                                
      *    DB2 AREA FOR TINENTY (INVENTORY SHEET ENTRY TABLE)                   
                                                                                
           EXEC SQL                                                             
                INCLUDE TINENTY                                                 
           END-EXEC.                                                            
                                                                                
      *---------------------------------------------------------------*         
      * CURSOR USED TO CHECK FOR THE EXISTENCE OF A SHEET BEING ADDED.*         
      *---------------------------------------------------------------*         
                                                                                
           EXEC SQL                                                             
                DECLARE LINE-NBR-CSR CURSOR FOR                                 
                SELECT LNE_NBR                                                  
                FROM   TINENTY                                                  
                WHERE  STR_NBR   = :PV-DB2-STORE-NBR AND                        
                       SHEET_NBR = :PV-SHEET-NBR                                
W28545            AND  SHEET_TYP_CDE = :PV-DB2-TYPE-CDE                         
                ORDER BY LNE_NBR                                                
           END-EXEC.                                                            
                                                                                
      *    DB2 AREA FOR COMMUNICATIONS                                          
                                                                                
           EXEC SQL                                                             
                INCLUDE SQLCA                                                   
           END-EXEC.                                                            
                                                                                
       EJECT                                                                    
       LINKAGE SECTION.                                                         
                                                                                
       01  DFHCOMMAREA.                                                         
           05  FILLER                         OCCURS  1 TO 4072 TIMES           
                                              DEPENDING ON EIBCALEN.            
               10  FILLER                     PIC  X(01).                       
                                                                                
                                                                                
       PROCEDURE DIVISION.                                                      
                                                                                
      *---------------------------------------------------------------*         
      *  THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM.  *         
      *  THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API   *         
      *  MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.             *         
      *                                                               *         
      *  THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE   *         
      *  LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.        *         
      *---------------------------------------------------------------*         
                                                                                
       0000-MAIN-MODULE.                                                        
           INITIALIZE DP030-CICS-API-FIELDS.                                    
           MOVE +1                       TO DP030-NUMBER-OF-MAPS.               
           MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.                  
           MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).                 
           SET DP030-RECEIVE-APPL-MAP    TO TRUE.                               
           MOVE LENGTH OF IN033AI        TO DP030-MAP-LENGTH (1).               
           MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).             
           PERFORM 0001-CALL-CICS-ARCH-API.                                     
      *                                                                         
           PERFORM 1000-CONTROL-PROCESSING                                      
      *                                                                         
           MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).             
           PERFORM 0001-CALL-CICS-ARCH-API.                                     
                                                                                
                                                                                
       0001-CALL-CICS-ARCH-API.                                                 
                                                                                
1122RM*    CALL 'DPKCS030' USING DFHEIBLK                                       
1122RM     CALL DP930-CICS-ARCH-API                                             
1122RM                     USING DFHEIBLK                                       
                                 DFHCOMMAREA                                    
                                 DP030-CICS-API-FIELDS                          
                                 DP020-STANDARD-COMMAREA                        
                                 IN033AI.                                       
      *                                                                         
           IF  DP030-RC-CALL-SUCCESSFUL                                         
               CONTINUE                                                         
           ELSE                                                                 
               SET DP013-NO-ROLLBACK                                            
                   DP013-XCTL-DISPLAY-RESTART                                   
                   DP013-CICS-ABEND      TO TRUE                                
               MOVE 'BEFORE 0000-MAIN-MODULE'                                   
                                         TO DP013-PARAGRAPH                     
1122RM*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX        
1122RM*             'T LINE'             TO DP013-MESSAGE-TEXT (2)              
1122RM         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
1122RM-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
               MOVE DP030-RETURN-CODE                                           
                                         TO DP013-MESSAGE-TEXT (3)              
               PERFORM DP013-0000-PROCESS-ABEND                                 
           END-IF.                                                              
       EJECT                                                                    
      *----------------------------------------------------------------*        
      *    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *        
      *    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *        
      *----------------------------------------------------------------*        
                                                                                
       1000-CONTROL-PROCESSING.                                                 
                                                                                
           EVALUATE TRUE                                                        
               WHEN DP020-NEXT-ACT-INITIAL                                      
                   INITIALIZE ASC-SPECIFIC-COMMAREA                             
                   PERFORM 1100-PROCESS-INTER-APPL-COMM                         
                   IF DP020-NEXT-ACT-APPL-ERROR                                 
                       CONTINUE                                                 
                   ELSE                                                         
                       PERFORM 4000-BUILD-INITIAL-PANEL                         
                       PERFORM 3480-READ-TINVPAR                                
                   END-IF                                                       
                                                                                
               WHEN DP020-NEXT-ACT-READ-MAP                                     
                   INITIALIZE ASC-TOTAL-FIELDS                                  
                       PERFORM 3480-READ-TINVPAR                                
SMJ                IF  PS-INVPAR-PROCESSED                                      
                       PERFORM 2000-PROCESS-PANEL                               
SMJ                END-IF                                                       
                                                                                
               WHEN DP020-NEXT-ACT-RETURN                                       
                   INITIALIZE ASC-TOTAL-FIELDS                                  
                   PERFORM 3480-READ-TINVPAR                                    
SMJ                IF  PS-INVPAR-PROCESSED                                      
                       PERFORM 3000-EDIT-DATA-IN-COMMAREA                       
                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     
                           VARYING PS-SUB FROM 1 BY 1                           
                             UNTIL PS-SUB > PC-LINES-PER-PANEL                  
                       PERFORM 4450-MOVE-COMM-TOTS-TO-SCREEN                    
SMJ                END-IF                                                       
               WHEN OTHER                                                       
                   SET DP013-LOGIC-ABEND                                        
                       DP013-NO-ROLLBACK TO TRUE                                
                   MOVE '1000-CONTROL-PROCESSING'                               
                                         TO DP013-PARAGRAPH                     
                   MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'           
                                         TO DP013-MESSAGE-TEXT(1)               
                   MOVE DP020-NEXT-APPL-ACTIVITY                                
                                         TO DP013-MESSAGE-TEXT(2)               
                   PERFORM DP013-0000-PROCESS-ABEND                             
           END-EVALUATE.                                                        
                                                                                
SMJ        IF  PS-UNAVAILABLE-RESOURCE                                          
SMJ           SET DP030-OVERRIDE-APPL-ERROR                                     
SMJ               DP020-MSG-WARNING    TO TRUE                                  
SMJ   *      ---- SYSTEM UNAVAILABLE, TRY AGAIN LATER ---                       
SMJ           MOVE PC-TSYMSG-01063  TO DP020-MSG-NUMBER                         
SMJ           SET DP030-SET-CURSOR-APPL-1    TO TRUE                            
SMJ        END-IF.                                                              
                                                                                
                                                                                
      *----------------------------------------------------------------*        
      *                                                                *        
      *                                                                *        
      *----------------------------------------------------------------*        
       1100-PROCESS-INTER-APPL-COMM.                                            
           IF IN030-SHEET-INV-COMPLETED                                         
               SET DP020-NEXT-ACT-APPL-ERROR                                    
                   DP020-MSG-FATAL           TO TRUE                            
      *        ---- STORE IS NOT AVAILABLE FOR SHEET ENTRY ----                 
               MOVE PC-TSYMSG-00560 TO DP020-MSG-NUMBER                         
           ELSE                                                                 
               MOVE IN030-SHEET-NBR TO PV-SHEET-NBR-RED                         
               IF PV-SHEET-NBR-RED  NOT NUMERIC                                 
                   SET DP020-NEXT-ACT-APPL-ERROR                                
                       DP020-MSG-FATAL           TO TRUE                        
      *            ---- ASTERISK NOT PERMITTED FOR SELECTED FUNCTION ---        
                   MOVE PC-TSYMSG-00137 TO DP020-MSG-NUMBER                     
               ELSE                                                             
W28545             MOVE IN030-STR-NBR     TO PV-DB2-STORE-NBR                   
W28545             MOVE IN030-SHEET-NBR   TO PV-SHEET-NBR                       
W28545             IF IN030-TYPE-ALL-SHEETS                                     
W28545                 SET DP020-NEXT-ACT-APPL-ERROR                            
W28545                     DP020-MSG-FATAL    TO TRUE                           
W28545                 MOVE PC-TSYMSG-00137   TO DP020-MSG-NUMBER               
W28545             ELSE                                                         
W28545                 MOVE IN030-TYPE-CDE    TO PV-DB2-TYPE-CDE                
W28545                 PERFORM 4100-CHECK-IF-SHEET-EXISTS                       
W28545             END-IF                                                       
W28545         END-IF                                                           
           END-IF.                                                              
                                                                                
      *----------------------------------------------------------------*        
      * FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*        
      * SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*        
      * EDITS.                                                         *        
      *----------------------------------------------------------------*        
                                                                                
       2000-PROCESS-PANEL.                                                      
                                                                                
           EVALUATE TRUE                                                        
               WHEN DP020-SRC-AID = DP016-CLEAR                                 
                   INITIALIZE ASC-TOTAL-FIELDS                                  
                   PERFORM 3000-EDIT-DATA-IN-COMMAREA                           
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
                       VARYING PS-SUB FROM 1 BY 1                               
                         UNTIL PS-SUB > PC-LINES-PER-PANEL                      
                   PERFORM 4450-MOVE-COMM-TOTS-TO-SCREEN                        
                                                                                
               WHEN DP020-FK-REFRESH(DP020-SRC-AID)                             
                   INITIALIZE ASC-ITEM-ARRAY                                    
                   PERFORM 4000-BUILD-INITIAL-PANEL                             
                                                                                
               WHEN OTHER                                                       
                   PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                         
                       VARYING PS-SUB FROM 1 BY 1                               
                         UNTIL PS-SUB > PC-LINES-PER-PANEL                      
                   INITIALIZE ASC-TOTAL-FIELDS                                  
                   PERFORM 3000-EDIT-DATA-IN-COMMAREA                           
                   IF  PS-NO-ERROR                                              
                       PERFORM 2100-CHECK-FUNCTION-KEY                          
                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     
                           VARYING PS-SUB FROM 1 BY 1                           
                             UNTIL PS-SUB > PC-LINES-PER-PANEL                  
                       PERFORM 4450-MOVE-COMM-TOTS-TO-SCREEN                    
                   END-IF                                                       
                   IF  PS-NO-ERROR                                              
                       CONTINUE                                                 
                   ELSE                                                         
                       SET DP030-OVERRIDE-GO TO TRUE                            
                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     
                           VARYING PS-SUB FROM 1 BY 1                           
                             UNTIL PS-SUB > PC-LINES-PER-PANEL                  
                       PERFORM 4450-MOVE-COMM-TOTS-TO-SCREEN                    
                   END-IF                                                       
           END-EVALUATE.                                                        
       EJECT                                                                    
      *----------------------------------------------------------------*        
      *  ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED      *        
      *  FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED  *        
      *  FROM THE CICS ARCHITECTURE API.                               *        
      *----------------------------------------------------------------*        
                                                                                
       2100-CHECK-FUNCTION-KEY.                                                 
                                                                                
           EVALUATE TRUE                                                        
                                                                                
               WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)                      
                   PERFORM 5000-ADD-SHEET                                       
                   IF PS-ADD-SUCCESSFUL                                         
      *                *------------------------------------------------        
      *                * IF A SHEET HAS BEEN SUCCESSFULLY ADDED, THE            
      *                * SPECIFICATION SCREEN IS RETURNED WITH THE              
      *                * APPROPRIATE MESSAGE. THIS IS ACCOMPLISHED BY           
      *                * EMULATING THE SETTING OF PF3.                          
      *                *------------------------------------------------        
                       SET DP020-FK-RETURN (DP020-SRC-AID) TO TRUE              
      *                ---- INENTY SHEET SUCCESSFULLY ADDED ----                
                       MOVE PC-TSYMSG-02143         TO DP020-MSG-NUMBER         
                       MOVE ASC-KEY-SHEET-NBR-X     TO DP020-MSG-TEXT           
                       SET  DP020-MSG-INFORMATIONAL TO TRUE                     
                   END-IF                                                       
                                                                                
               WHEN DP020-SRC-AID = DP016-ENTER                                 
                   CONTINUE                                                     
                                                                                
               WHEN OTHER                                                       
                   SET DP013-NO-ROLLBACK                                        
                       DP013-XCTL-DISPLAY-RESTART                               
                       DP013-CICS-ABEND  TO TRUE                                
                   MOVE '2100-CHECK-FUNCTION-KEY'                               
                                         TO DP013-PARAGRAPH                     
                   MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'              
                                         TO DP013-MESSAGE-TEXT (1)              
                   PERFORM DP013-0000-PROCESS-ABEND                             
           END-EVALUATE.                                                        
       EJECT                                                                    
      *----------------------------------------------------------------*        
      * MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*        
      * THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *        
      * APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *        
      *----------------------------------------------------------------*        
                                                                                
       2200-MOVE-SCREEN-TO-COMMAREA.                                            
W21732     IF  MR-SKUL (PS-SUB) > ZERO                                          
W28545*        MOVE MR-SKU (PS-SUB)     TO ASC-SKU-SEQ-NBR (PS-SUB)             
W28545*        IF ASC-SKU-SEQ-NBR (PS-SUB) > SPACE                              
W28545*            SET ASC-SKU-ENTERED     (PS-SUB) TO TRUE                     
W28545*        ELSE                                                             
W28545*            SET ASC-SKU-NOT-ENTERED (PS-SUB) TO TRUE                     
W28545*        END-IF                                                           
W28545         MOVE 1               TO PV-BYTE-SUB                              
W28545         MOVE ZEROS           TO PV-BYTE-COUNT                            
W28545                                 PV-SKU-POS                               
W28545         MOVE SPACES          TO WS-EDIT-UPC-SKU-TABLE                    
W28545         MOVE MR-SKU (PS-SUB) TO WS-EDIT-UPC-SKU-TABLE                    
W28545         PERFORM 3600-EDIT-UPC-SKU                                        
W28545           VARYING PV-BYTE-SUB FROM 1 BY 1                                
W28545             UNTIL PV-BYTE-SUB IS GREATER THAN 15                         
W28545         INSPECT MR-SKU (PS-SUB) REPLACING LEADING SPACES BY ZEROS        
W28545         INSPECT MR-SKU (PS-SUB) TALLYING PV-SKU-POS FOR LEADING          
W28545             ZEROS                                                        
W28545         ADD 1 TO PV-SKU-POS                                              
W28545         IF PV-BYTE-COUNT IS GREATER THAN 8                               
W28545             MOVE MR-SKU (PS-SUB) (PV-SKU-POS:PV-BYTE-COUNT)              
W28545                                    TO ASC-UPC-NBR-X   (PS-SUB)           
W28545             MOVE ALL '0'           TO ASC-SKU-SEQ-NBR (PS-SUB)           
W28545             SET ASC-UPC-ENTERED     (PS-SUB) TO TRUE                     
W28545             SET ASC-SKU-NOT-ENTERED (PS-SUB) TO TRUE                     
W28545         ELSE                                                             
W28545             MOVE MR-SKU (PS-SUB) (PV-SKU-POS:PV-BYTE-COUNT)              
W28545                                    TO ASC-SKU-SEQ-NBR (PS-SUB)           
W28545             MOVE ALL '0'           TO ASC-UPC-NBR-X   (PS-SUB)           
W28545             SET ASC-SKU-ENTERED     (PS-SUB) TO TRUE                     
W28545             SET ASC-UPC-NOT-ENTERED (PS-SUB) TO TRUE                     
W28545         END-IF                                                           
W21732     ELSE                                                                 
W21732         IF  MR-SKUF (PS-SUB) = DP015-ERASE-EOF                           
W21732             MOVE SPACE           TO ASC-SKU-SEQ-NBR (PS-SUB)             
W28545                                     ASC-UPC-NBR-X   (PS-SUB)             
W21732             SET ASC-SKU-NOT-ENTERED (PS-SUB)                             
W28545                 ASC-UPC-NOT-ENTERED (PS-SUB)                             
W21732                                  TO TRUE                                 
W21732         END-IF                                                           
W21732     END-IF.                                                              
                                                                                
           IF  MR-QTYL (PS-SUB) > ZERO                                          
               MOVE MR-QTY-X (PS-SUB)   TO ASC-INV-QTY-X (PS-SUB)               
           ELSE                                                                 
               IF  MR-QTYF (PS-SUB) = DP015-ERASE-EOF                           
                   MOVE SPACE           TO ASC-INV-QTY-X (PS-SUB)               
               END-IF                                                           
           END-IF.                                                              
                                                                                
           IF  MR-PRCEL (PS-SUB) > ZERO                                         
               MOVE MR-PRCE-X (PS-SUB)                                          
                               TO ASC-ITM-UNIT-PR-AMT-X (PS-SUB)                
           ELSE                                                                 
               IF  MR-PRCEF (PS-SUB) = DP015-ERASE-EOF                          
                   MOVE SPACE  TO ASC-ITM-UNIT-PR-AMT-X (PS-SUB)                
               END-IF                                                           
           END-IF.                                                              
                                                                                
           IF  MR-EXTDL (PS-SUB) > ZERO                                         
               MOVE MR-EXTD-X (PS-SUB)                                          
                               TO ASC-ITM-EXTD-PR-AMT-X (PS-SUB)                
           ELSE                                                                 
               IF  MR-EXTDF (PS-SUB) = DP015-ERASE-EOF                          
                   MOVE SPACE  TO ASC-ITM-EXTD-PR-AMT-X (PS-SUB)                
               END-IF                                                           
           END-IF.                                                              
                                                                                
           IF  MR-TRTLL > ZERO                                                  
               MOVE MR-TRTL-X             TO ASC-TOTAL-RTL-AMT-X                
           ELSE                                                                 
               IF  MR-TRTLF  = DP015-ERASE-EOF                                  
                   MOVE SPACE             TO ASC-TOTAL-RTL-AMT-X                
               END-IF                                                           
           END-IF.                                                              
                                                                                
           IF  MR-TQTYL > ZERO                                                  
               MOVE MR-TQTY-X             TO ASC-TOTAL-QTY-AMT-X                
           ELSE                                                                 
               IF  MR-TQTYF   = DP015-ERASE-EOF                                 
                   MOVE SPACE             TO ASC-TOTAL-QTY-AMT-X                
               END-IF                                                           
           END-IF.                                                              
                                                                                
           IF  MR-TEXTDL > ZERO                                                 
               MOVE MR-TEXTD-X            TO ASC-TOTAL-EXTD-RTL-X               
           ELSE                                                                 
               IF  MR-TEXTDF = DP015-ERASE-EOF                                  
                   MOVE SPACE             TO ASC-TOTAL-EXTD-RTL-X               
               END-IF                                                           
           END-IF.                                                              
                                                                                
                                                                                
      *----------------------------------------------------------------*        
      * PERFORM EDITS ON EACH FIELD ENTERED BY THE USER.  IF AN ERROR  *        
      * IS FOUND THE CURSOR IS POSITIONED AT THAT FIELD AND AN         *        
      * APPROPRIATE ERROR MESSAGE IS DISPLAYED.                        *        
      *----------------------------------------------------------------*        
                                                                                
       3000-EDIT-DATA-IN-COMMAREA.                                              
                                                                                
           MOVE ZEROES TO PV-EXTD-RTL-AMT.                                      
                                                                                
           PERFORM 3220-ELIMINATE-EMPTY-LINES.                                  
                                                                                
           MOVE ASC-KEY-STORE-NBR-X   TO PV-DB2-STORE-NBR-X.                    
           MOVE PV-DB2-STORE-NBR-RED  TO PV-DB2-STORE-NBR.                      
           MOVE ASC-KEY-SHEET-NBR     TO PV-SHEET-NBR-X.                        
           MOVE PV-SHEET-NBR-X        TO PV-SHEET-NBR.                          
W28545     MOVE ASC-KEY-TYPE-CDE      TO PV-DB2-TYPE-CDE.                       
                                                                                
           PERFORM VARYING PS-SUB FROM PC-LINES-PER-PANEL BY -1                 
                     UNTIL PS-SUB < 1                                           
J28545         PERFORM 3225-RESET-ATTRIBUTES                                    
               IF ASC-SKU-ENTERED (PS-SUB)                                      
W28545         OR ASC-UPC-ENTERED (PS-SUB)                                      
J28545             PERFORM 3250-EDIT-MAP-DETAIL-FIELDS                          
               END-IF                                                           
           END-PERFORM.                                                         
                                                                                
                                                                                
           IF PS-NO-DATA-ENTERED                                                
               SET  PS-ERROR                                                    
                    DP020-MSG-FATAL        TO TRUE                              
      *        ---- PLEASE ENTER A VALID SKU OR UPC ----                        
               MOVE PC-TSYMSG-00413        TO DP020-MSG-NUMBER                  
W21732         MOVE -1                     TO MR-SKUL (1)                       
               SET DP030-SET-CURSOR-APPL-1 TO TRUE                              
           ELSE                                                                 
               IF PS-NO-ERROR                                                   
W21732             MOVE -1 TO MR-SKUL (1)                                       
                   SET DP030-SET-CURSOR-APPL-1 TO TRUE                          
               END-IF                                                           
           END-IF.                                                              
                                                                                
                                                                                
      *----------------------------------------------------------------*        
      * IF THE UPC AND THE DEPARTMENT PORTION OF THE SKU ARE EMPTY,    *        
      * REMOVE THE ENTIRE LINE AND MOVE THE SUBSEQUENT LINES UP TO     *        
      * CLOSE THE GAP.                                                 *        
      *----------------------------------------------------------------*        
                                                                                
       3220-ELIMINATE-EMPTY-LINES.                                              
                                                                                
           MOVE +1 TO PS-SUB2.                                                  
           PERFORM VARYING PS-SUB FROM 1 BY 1                                   
                     UNTIL PS-SUB > PC-LINES-PER-PANEL                          
               IF ASC-SKU-ENTERED (PS-SUB)                                      
W28545         OR ASC-UPC-ENTERED (PS-SUB)                                      
                   MOVE ASC-MAP-DETAIL-LINE (PS-SUB)                            
                     TO ASC-MAP-DETAIL-LINE (PS-SUB2)                           
                   IF ASC-SKU-NOT-ENTERED (PS-SUB2)                             
W21732                 MOVE SPACE TO ASC-SKU-SEQ-NBR     (PS-SUB2)              
                   END-IF                                                       
W28545             IF ASC-UPC-NOT-ENTERED (PS-SUB2)                             
W28545                 MOVE SPACE TO ASC-UPC-NBR-X       (PS-SUB2)              
W28545             END-IF                                                       
                   ADD +1 TO PS-SUB2                                            
                   SET PS-DATA-ENTERED TO TRUE                                  
               END-IF                                                           
           END-PERFORM.                                                         
                                                                                
           PERFORM VARYING PS-SUB2 FROM PS-SUB2 BY 1                            
                     UNTIL PS-SUB2 > PC-LINES-PER-PANEL                         
               INITIALIZE ASC-MAP-DETAIL-LINE     (PS-SUB2)                     
           END-PERFORM.                                                         
                                                                                
      *                                                                         
J28545 3225-RESET-ATTRIBUTES.                                                   
                                                                                
W21732     MOVE DP015-UNP-NUM-NOR-OFF    TO MR-SKUA  (PS-SUB)                   
                                            MR-QTYA  (PS-SUB).                  
W21732     MOVE DP015-GREEN              TO MR-SKUC  (PS-SUB)                   
                                            MR-QTYC  (PS-SUB).                  
W21732     MOVE DP015-UNDERLINE          TO MR-SKUH  (PS-SUB)                   
                                            MR-QTYH  (PS-SUB).                  
                                                                                
           MOVE DP015-PRO-NOR-OFF        TO MR-PRCEA (PS-SUB).                  
           MOVE DP015-BLUE               TO MR-PRCEC (PS-SUB).                  
           MOVE DP015-HL-OFF             TO MR-PRCEH (PS-SUB).                  
     **                                                                         
           MOVE DP015-PRO-NOR-OFF        TO MR-EXTDA (PS-SUB).                  
           MOVE DP015-BLUE               TO MR-EXTDC (PS-SUB).                  
           MOVE DP015-HL-OFF             TO MR-EXTDH (PS-SUB).                  
                                                                                
                                                                                
J28545 3250-EDIT-MAP-DETAIL-FIELDS.                                             
                                                                                
      *    *------------------------------------------------------------        
      *    * EDIT THE QUANTITY                                                  
      *    *------------------------------------------------------------        
                                                                                
           SET PS-NO-ERRORS-IN-LINE                                             
W28545         PS-VALID-UPC                                                     
               PS-VALID-SKU         TO TRUE.                                    
IN2001                                                                          
J28545     INITIALIZE PV-IN400-UPC-STAT-CDE                                     
J28545                PV-IN400-UNT-RTL-AMT                                      
J28545                PV-IN400-MITGPL-QTY.                                      
                                                                                
           IF ASC-INV-QTY-X (PS-SUB) = SPACE                                    
               SET PS-ERROR                                                     
                   PS-ERRORS-IN-LINE                                            
                   DP020-MSG-FATAL         TO TRUE                              
      *        ---- REQUIRED FIELD ----                                         
               MOVE ZEROES                 TO ASC-INV-QTY (PS-SUB)              
               MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER                  
               MOVE DP015-UNP-NUM-BRT-OFF  TO MR-QTYA (PS-SUB)                  
               MOVE DP015-RED              TO MR-QTYC (PS-SUB)                  
               MOVE DP015-REVERSE          TO MR-QTYH (PS-SUB)                  
               MOVE -1                     TO MR-QTYL (PS-SUB)                  
               SET DP030-SET-CURSOR-APPL-1 TO TRUE                              
           ELSE                                                                 
               MOVE ASC-INV-QTY-X (PS-SUB) TO DP010I-UNEDITED-FIELD             
               MOVE LENGTH OF ASC-INV-QTY (PS-SUB)                              
                                           TO DP010I-MAXIMUM-DIGITS             
               MOVE ZERO                   TO DP010I-MAXIMUM-DECIMALS           
               SET  DP010I-NEGATIVE-NOT-ALLOWED                                 
                                           TO TRUE                              
263126         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263126              USING DP010I-NUMERIC-EDIT-AREA                              
                                                                                
               IF DP010I-ERROR-DETECTED                                         
                   SET  PS-ERROR                                                
                        PS-ERRORS-IN-LINE                                       
                        DP020-MSG-FATAL        TO TRUE                          
      *            ---- MUST BE NUMERIC ----                                    
                   MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER              
                   MOVE DP015-UNP-NUM-BRT-OFF  TO MR-QTYA (PS-SUB)              
                   MOVE DP015-RED              TO MR-QTYC (PS-SUB)              
                   MOVE DP015-REVERSE          TO MR-QTYH (PS-SUB)              
                   MOVE -1                     TO MR-QTYL (PS-SUB)              
                   SET DP030-SET-CURSOR-APPL-1 TO TRUE                          
               ELSE                                                             
                   MOVE DP010I-NUMERIC-FIELD   TO ASC-INV-QTY (PS-SUB)          
                   IF ASC-INV-QTY (PS-SUB) = ZERO                               
                       SET  PS-ERROR                                            
                            PS-ERRORS-IN-LINE                                   
                            DP020-MSG-FATAL    TO TRUE                          
      *                ---- CANNOT BE ZERO ----                                 
                       MOVE PC-TSYMSG-00010    TO DP020-MSG-NUMBER              
                       MOVE DP015-UNP-NUM-BRT-OFF                               
                                               TO MR-QTYA (PS-SUB)              
                       MOVE DP015-RED          TO MR-QTYC (PS-SUB)              
                       MOVE DP015-REVERSE      TO MR-QTYH (PS-SUB)              
                       MOVE -1                 TO MR-QTYL (PS-SUB)              
                       SET DP030-SET-CURSOR-APPL-1                              
                                               TO TRUE                          
                   ELSE                                                         
                       IF ASC-INV-QTY (PS-SUB) > PC-MAX-QTY                     
                           SET  PS-ERROR                                        
                                PS-ERRORS-IN-LINE                               
                                DP020-MSG-FATAL    TO TRUE                      
      *                    -- CANNOT EXCEED 9999 UNITS PER LINE --              
                           MOVE PC-TSYMSG-02144    TO DP020-MSG-NUMBER          
                           MOVE DP015-UNP-NUM-BRT-OFF                           
                                                   TO MR-QTYA (PS-SUB)          
                           MOVE DP015-RED          TO MR-QTYC (PS-SUB)          
                           MOVE DP015-REVERSE      TO MR-QTYH (PS-SUB)          
                           MOVE -1                 TO MR-QTYL (PS-SUB)          
                           SET DP030-SET-CURSOR-APPL-1                          
                                                   TO TRUE                      
                       END-IF                                                   
                   END-IF                                                       
               END-IF                                                           
           END-IF.                                                              
                                                                                
      *    *------------------------------------------------------------        
      *    * EDIT THE SKU OR UPC                                                
      *    *------------------------------------------------------------        
                                                                                
           MOVE ASC-GET-PRICE-SW  (PS-SUB) TO PS-GOT-LAST-PRICE-SW.             
           SET ASC-DONT-GET-PRICE (PS-SUB) TO TRUE.                             
                                                                                
           IF ASC-SKU-ENTERED (PS-SUB)                                          
J28545         PERFORM 3300-EDIT-SKU                                            
               IF PS-VALID-SKU                                                  
J28545             PERFORM 3325-VALIDATE-SKU                                    
               END-IF                                                           
W28545     ELSE                                                                 
J28545         PERFORM 3400-EDIT-UPC                                            
J28545         IF PS-VALID-UPC                                                  
J28545             PERFORM 3425-VALIDATE-UPC                                    
J28545         END-IF                                                           
           END-IF.                                                              
                                                                                
J28545     IF ASC-GET-PRICE-FROM-SCREEN  (PS-SUB)                               
J28545         MOVE ZEROES TO PV-ITEM-RETAIL                                    
J28545         PERFORM 3275-PROCESS-CLEARANCE-ITEM                              
J28545     ELSE                                                                 
J28545         IF ASC-GOT-INPD400-PRICE (PS-SUB)                                
J28545             CONTINUE                                                     
J28545         ELSE                                                             
J28545             IF ASC-GET-PRICE-FROM-INPD400 (PS-SUB)                       
J28545                 IF IN400-PRC-STATUS-OUT =                                
J28545                             PC-CLEARANCE-SKU-STATUS                      
J28545                     PERFORM 3275-PROCESS-CLEARANCE-ITEM                  
                       END-IF                                                   
J28545             END-IF                                                       
J28545         END-IF                                                           
J28545     END-IF.                                                              
J28545     PERFORM 3500-CALC-EXTD-RTL.                                          
       EJECT                                                                    
23511C*------------------------------------------------------------             
23511C* THIS PARAGRAPH WAS MOVED FROM WITHIN 3250-EDIT-MAP-DETAIL-FIELDS        
23511C* TO CHECK THE DATES TO DECIDE IF THE PRICE SHOULD BE DISPLAYED           
23511C* OR THE USER SHOULD ENTER THE PRICE                                      
W24521* DC AND RTV LOCATION ARE GIVEN THE ABILITY TO UPDATE THE RETAIL          
W24521* AMOUNT FOR 'YELLOW-TICKET' (INITIAL MARKDOWN) CLEARANCE ITEMS           
W24521*------------------------------------------------------------             
      *                                                                         
J28545*----------------------------------------------------------------         
J28545 3265-PROCESS-CLEARANCE-DATES.                                            
J28545     IF IN400-PRC-UPC-CHG-DTE-OUT =                                       
J28545                      IN400-PRC-STAT-CHG-DTE-OUT                          
J28545*       YELLOW TICKET ITEM - SCREEN ENTRY OF PRICE OPTIONAL               
W24521*       FOR DC OR RTV LOCATION TYPES (INITIAL MARKDOWNS)                  
W24521        IF IN030-STORE-TYPE-CODE = (PC-DC OR PC-RTV)                      
W24521            SET ASC-GET-PRICE-FROM-SCREEN (PS-SUB) TO TRUE                
W24521            IF ASC-ITM-UNIT-PR-AMT-X-FMT (PS-SUB) NOT EQUAL SPACES        
J28545                IF ASC-ITM-UNIT-PR-AMT (PS-SUB) NOT EQUAL                 
J28545                        IN400-PRC-UNIT-RTL-OUT                            
J28545                  MOVE IN400-PRC-STATUS-OUT TO                            
J28545                                        PV-IN400-UPC-STAT-CDE             
W24521                  MOVE ASC-ITM-UNIT-PR-AMT (PS-SUB) TO                    
J28545                                        PV-IN400-UNT-RTL-AMT              
J28545                             ASC-ITM-UNIT-PR-AMT-X-FMT (PS-SUB)           
W24521                                        PV-ITEM-RETAIL                    
J28545                  MOVE IN400-PRC-MITGPL-QTY TO                            
J28545                                  PV-IN400-MITGPL-QTY                     
J28545                END-IF                                                    
W24521            ELSE                                                          
J28545                MOVE IN400-PRC-STATUS-OUT TO                              
J28545                                  PV-IN400-UPC-STAT-CDE                   
J28545                MOVE IN400-PRC-UNIT-RTL-OUT                               
J28545                    TO PV-IN400-UNT-RTL-AMT                               
W24521                       PV-ITEM-RETAIL                                     
W24521                       ASC-ITM-UNIT-PR-AMT-X-FMT (PS-SUB)                 
W24521                       ASC-ITM-UNIT-PR-AMT       (PS-SUB)                 
J28545                MOVE IN400-PRC-MITGPL-QTY TO PV-IN400-MITGPL-QTY          
W24521            END-IF                                                        
W24521*           ALLOW 'YELLOW-TICKET' CLEARANCE RETAIL TO BE UPDATED          
W24521            MOVE DP015-UNP-NUM-NOR-OFF    TO MR-PRCEA (PS-SUB)            
W24521            MOVE DP015-GREEN              TO MR-PRCEC (PS-SUB)            
W24521            MOVE DP015-UNDERLINE          TO MR-PRCEH (PS-SUB)            
W24521        ELSE                                                              
JAN04 *         IN030-STORE-TYPE-CODE <> (PC-DC OR PC-RTV)                      
J28545          IF PS-GOT-LAST-PRICE-FROM-SCREEN                                
JAN04               SET ASC-GET-PRICE-FROM-SCREEN (PS-SUB) TO TRUE              
J28545          ELSE                                                            
JAN04 *?            SET ASC-GET-PRICE-FROM-SCREEN (PS-SUB) TO TRUE              
J28545              MOVE IN400-PRC-STATUS-OUT TO PV-IN400-UPC-STAT-CDE          
J28545              MOVE IN400-PRC-UNIT-RTL-OUT                                 
J28545                  TO PV-IN400-UNT-RTL-AMT                                 
23511C                     PV-ITEM-RETAIL                                       
23511C                     ASC-ITM-UNIT-PR-AMT-X-FMT (PS-SUB)                   
23511C                     ASC-ITM-UNIT-PR-AMT   (PS-SUB)                       
J28545              MOVE IN400-PRC-MITGPL-QTY TO PV-IN400-MITGPL-QTY            
J28545          END-IF                                                          
W24521        END-IF                                                            
23511C      ELSE                                                                
J28545*         RED TICKET ITEM - SCREEN ENTRY OF PRICE REQUIRED                
23511C          SET ASC-GET-PRICE-FROM-SCREEN (PS-SUB) TO TRUE                  
23511C      END-IF.                                                             
      *                                                                         
IN2001*------------------------------------------------------------             
J28545* THIS PARAGRAPH WAS MOVED FROM WITHIN 3250-EDIT-MAP-DETAIL-FIELDS        
IN2001* TO ACCOUNT FOR RE-ANALYSIS OF CLEARANCE ITEMS (IF ROW WAS               
IN2001* FOUND TO BE A MIXED ('25') STATUS).                                     
IN2001* THIS WILL BE EXECUTED AT LEAST ONCE FROM THE INITIAL REVIEW OF          
IN2001* SWITCH THAT WAS SET FROM THE INPD400 ROW. IF THE STORE-SPECIFIC         
IN2001* ROW IS CALLED AND FOUND TO BE A CLEARANCE STATUS, THIS MUST BE          
IN2001* RE-EVALUATED.                                                           
IN2001*------------------------------------------------------------             
J28545 3275-PROCESS-CLEARANCE-ITEM.                                             
                                                                                
J28545     IF PS-GOT-LAST-PRICE-FROM-INPD400                                    
               MOVE SPACE TO ASC-ITM-UNIT-PR-AMT-X (PS-SUB)                     
           END-IF                                                               
           IF ASC-ITM-UNIT-PR-AMT-X (PS-SUB) = SPACE                            
               IF PS-NO-ERRORS-IN-LINE                                          
                   SET DP020-MSG-FATAL         TO TRUE                          
      *            ---- REQUIRED FIELD ----                                     
                   MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER              
                   MOVE -1                     TO MR-PRCEL (PS-SUB)             
                   SET DP030-SET-CURSOR-APPL-1 TO TRUE                          
               END-IF                                                           
               SET PS-ERROR                    TO TRUE                          
               MOVE DP015-UNP-NUM-BRT-OFF      TO MR-PRCEA (PS-SUB)             
               MOVE DP015-RED                  TO MR-PRCEC (PS-SUB)             
               MOVE DP015-REVERSE              TO MR-PRCEH (PS-SUB)             
           ELSE                                                                 
               MOVE ASC-ITM-UNIT-PR-AMT-X (PS-SUB)                              
                                          TO DP010I-UNEDITED-FIELD              
               MOVE PC-ITM-UNIT-PR-MAX-DIGITS                                   
                                          TO DP010I-MAXIMUM-DIGITS              
               MOVE 2                     TO DP010I-MAXIMUM-DECIMALS            
               SET  DP010I-NEGATIVE-NOT-ALLOWED  TO TRUE                        
263126         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263126              USING DP010I-NUMERIC-EDIT-AREA                              
                                                                                
               IF DP010I-ERROR-DETECTED                                         
                   IF PS-NO-ERRORS-IN-LINE                                      
                       SET DP020-MSG-FATAL      TO TRUE                         
J28545*                ---- MUST BE NUMERIC, NON-NEGATIVE, ----                 
      *                ---- AND WITHIN SIZE CONSTRAINT      ----                
                       MOVE PC-TSYMSG-00343     TO DP020-MSG-NUMBER             
                       MOVE -1                  TO MR-PRCEL (PS-SUB)            
                       SET DP030-SET-CURSOR-APPL-1  TO TRUE                     
                   END-IF                                                       
                   SET  PS-ERROR                TO TRUE                         
                   MOVE DP015-UNP-NUM-BRT-OFF   TO MR-PRCEA (PS-SUB)            
                   MOVE DP015-RED               TO MR-PRCEC (PS-SUB)            
                   MOVE DP015-REVERSE           TO MR-PRCEH (PS-SUB)            
               ELSE                                                             
                   MOVE DP010I-NUMERIC-FIELD                                    
                               TO ASC-ITM-UNIT-PR-AMT-X-FMT (PS-SUB)            
                                  ASC-ITM-UNIT-PR-AMT       (PS-SUB)            
                   IF DP010I-NUMERIC-FIELD  = ZERO                              
                       IF PS-NO-ERRORS-IN-LINE                                  
                           SET  DP020-MSG-FATAL TO TRUE                         
      *                    ---- CANNOT BE ZERO ----                             
                           MOVE PC-TSYMSG-00010 TO DP020-MSG-NUMBER             
                           MOVE -1              TO MR-PRCEL (PS-SUB)            
                           SET DP030-SET-CURSOR-APPL-1 TO TRUE                  
                       END-IF                                                   
                       SET  PS-ERROR            TO TRUE                         
                       MOVE DP015-UNP-NUM-BRT-OFF   TO MR-PRCEA (PS-SUB)        
                       MOVE DP015-RED               TO MR-PRCEC (PS-SUB)        
                       MOVE DP015-REVERSE           TO MR-PRCEH (PS-SUB)        
                   ELSE                                                         
                       IF ASC-ITM-UNIT-PR-AMT (PS-SUB)    < PC-MIN-PRICE        
                       OR ASC-ITM-UNIT-PR-AMT (PS-SUB)    > PC-MAX-PRICE        
                           IF PS-NO-ERRORS-IN-LINE                              
                           SET  DP020-MSG-FATAL TO TRUE                         
      *                    -- UNIT PRICE MUST BE BETWEEN .01 --                 
      *                    -- AND 99999.99                   --                 
                               MOVE PC-TSYMSG-02145 TO DP020-MSG-NUMBER         
                               MOVE -1              TO MR-PRCEL (PS-SUB)        
                               SET DP030-SET-CURSOR-APPL-1 TO TRUE              
                           END-IF                                               
                               SET  PS-ERROR        TO TRUE                     
                               MOVE DP015-UNP-NUM-BRT-OFF                       
                                                    TO MR-PRCEA (PS-SUB)        
                               MOVE DP015-RED       TO MR-PRCEC (PS-SUB)        
                               MOVE DP015-REVERSE   TO MR-PRCEH (PS-SUB)        
                       ELSE                                                     
                           MOVE DP015-UNP-NUM-NOR-OFF                           
                                                TO MR-PRCEA (PS-SUB)            
                           MOVE DP015-GREEN     TO MR-PRCEC (PS-SUB)            
                           MOVE DP015-UNDERLINE TO MR-PRCEH (PS-SUB)            
                           MOVE ASC-ITM-UNIT-PR-AMT  (PS-SUB) TO                
                                PV-ITEM-RETAIL                                  
                                ASC-ITM-UNIT-PR-AMT-X-FMT (PS-SUB)              
                                ASC-ITM-UNIT-PR-AMT       (PS-SUB)              
                       END-IF                                                   
                   END-IF                                                       
               END-IF                                                           
           END-IF.                                                              
                                                                                
J28545*                                                                         
J28545 3300-EDIT-SKU.                                                           
                                                                                
      *    *------------------------------------------------------------        
W21732*    * EDIT THE SKU NUMBER.                                               
      *    *------------------------------------------------------------        
                                                                                
           IF ASC-SKU-SEQ-NBR (PS-SUB) > SPACE                                  
               MOVE ASC-SKU-SEQ-NBR (PS-SUB) TO DP010I-UNEDITED-FIELD           
               MOVE LENGTH OF ASC-SKU-SEQ-NBR (PS-SUB)                          
                                         TO DP010I-MAXIMUM-DIGITS               
               MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS             
               SET  DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                         
263126         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263126              USING DP010I-NUMERIC-EDIT-AREA                              
                                                                                
               IF DP010I-ERROR-DETECTED                                         
                       SET  PS-ERROR                                            
                            PS-INVALID-SKU                                      
                            DP020-MSG-FATAL        TO TRUE                      
J28545*                ---- MUST BE NUMERIC ----                                
                       MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER          
W21732                 MOVE DP015-UNP-NUM-BRT-OFF  TO MR-SKUA  (PS-SUB)         
W21732                 MOVE DP015-RED              TO MR-SKUC  (PS-SUB)         
W21732                 MOVE DP015-REVERSE          TO MR-SKUH  (PS-SUB)         
W21732                 MOVE -1                     TO MR-SKUL  (PS-SUB)         
                       SET DP030-SET-CURSOR-APPL-1 TO TRUE                      
               ELSE                                                             
                   MOVE DP010I-NUM-FIELD-11-DIG-6-DEC                           
                                           TO ASC-SKU-SEQ-NBR-N (PS-SUB)        
               END-IF                                                           
           END-IF.                                                              
                                                                                
                                                                                
                                                                                
      *-----------------------------------------------------------------        
      * IF THE SKU HAS A SEQUENCE NUMBER OF '000' OR '999', VALIDATE   *        
      * THE DEPARTMENT AND CLASS AGAINST TMDSEAR.  IF NOT, LOOK UP     *        
W21732* THE SKU ON TSKXREF.IF IT IS NOT FOUND, IT IS INVALID.IF THE SKU*        
      * WAS RENUMBERED ON OR BEFORE THE ACTUAL INVENTORY DATE, THE     *        
      * RENUMBERED SKU IS OBTAINED SO THAT ITS ITEM NUMBER CAN BE USED *        
      * LATER TO RETRIEVE THE CUTOFF PRICE.                            *        
      *----------------------------------------------------------------*        
                                                                                
J28545 3325-VALIDATE-SKU.                                                       
                                                                                
J28545                                                                          
J28545     MOVE ASC-SKU-SEQ-NBR (PS-SUB)  TO IN400-PV-SKU-IN                    
J28545     MOVE INVPAR-PLND-INV-DTE       TO IN400-PV-EFF-DTE-IN                
J28545     MOVE INVPAR-LOC-NBR            TO IN400-PV-LOC-IN-NUM                
J28545     SET IN400-PV-SKU-LOOKUP        TO TRUE                               
J28545     PERFORM IN400-LOOKUP-RETAIL.                                         
J28545                                                                          
J28545     IF IN400-PRC-SKU-OUT > 0                                             
J28545         MOVE IN400-PRC-SKU-OUT     TO ASC-SKU-SEQ-NBR(PS-SUB)            
J28545     END-IF.                                                              
J28545                                                                          
J28545     MOVE IN400-PRC-SKU-OUT         TO PV-DUMMY-SKU                       
J28545     IF IN400-PV-DUMMY-SKU                                                
J28545         IF PV-DUMMY-SKU (6:3) = '000'                                    
J28545             EVALUATE TRUE                                                
J28545               WHEN IN400-PV-FOUND                                        
J28545                   SET ASC-GET-PRICE-FROM-SCREEN (PS-SUB) TO TRUE         
J28545                   MOVE ZEROS              TO PV-ITEM-RETAIL              
J28545               WHEN IN400-PV-NOT-FOUND                                    
J28545                                                                          
J28545                   SET PS-ERROR                                           
J28545                       PS-ERRORS-IN-LINE                                  
J28545                       DP020-MSG-FATAL     TO TRUE                        
J28545*   * ---- INVALID ENTRY ----                                             
J28545                   MOVE PC-TSYMSG-00005    TO DP020-MSG-NUMBER            
J28545                   MOVE DP015-UNP-NUM-BRT-OFF TO MR-SKUA (PS-SUB)         
J28545                   MOVE DP015-RED          TO MR-SKUC  (PS-SUB)           
J28545                   MOVE DP015-REVERSE      TO MR-SKUH  (PS-SUB)           
J28545                   MOVE -1                 TO MR-SKUL  (PS-SUB)           
24029                    SET DP030-SET-CURSOR-APPL-1 TO TRUE                    
                     WHEN OTHER                                                 
                         SET PS-ERROR                                           
                            DP020-MSG-WARNING TO TRUE                           
      *     ---- WAIT 15 SECONDS, THEN RETRY ----                               
                         MOVE PC-TSYMSG-00551 TO DP020-MSG-NUMBER               
                   END-EVALUATE                                                 
IN2002         ELSE                                                             
W21732             IF PV-DUMMY-SKU (6:3) = '999'                                
|     *                SET PS-INVALID-SKU TO TRUE                               
                       SET ASC-GET-PRICE-FROM-SCREEN (PS-SUB) TO TRUE           
J28545                 MOVE ZEROS                TO PV-ITEM-RETAIL              
|                      SET  PS-ERROR                                            
|                           PS-ERRORS-IN-LINE                                   
|                           DP020-MSG-FATAL    TO TRUE                          
W21732*     ---- SKU  SEQ CANNOT BE 999 ---                                     
|                      MOVE PC-TSYMSG-02891    TO DP020-MSG-NUMBER              
W21732                 MOVE DP015-UNP-NUM-BRT-OFF                               
W21732                                     TO MR-SKUA  (PS-SUB)                 
W21732                 MOVE DP015-RED          TO MR-SKUC  (PS-SUB)             
W21732                 MOVE DP015-REVERSE      TO MR-SKUH  (PS-SUB)             
W21732                 MOVE -1                 TO MR-SKUL  (PS-SUB)             
|                      SET DP030-SET-CURSOR-APPL-1                              
IN2002                                         TO TRUE                          
J28545             END-IF                                                       
J28545         END-IF                                                           
J28545     END-IF.                                                              
J28545                                                                          
J28545     IF NOT IN400-PV-DUMMY-SKU                                            
J28545         EVALUATE TRUE                                                    
J28545                                                                          
J28545             WHEN IN400-PV-FOUND                                          
J28545                 IF IN400-PRC-STATUS-OUT = PC-CLEARANCE-SKU-STATUS        
J28545                     PERFORM 3265-PROCESS-CLEARANCE-DATES                 
J28545                     IF ASC-GET-PRICE-FROM-SCREEN (PS-SUB)                
J28545                         MOVE ZEROES TO PV-ITEM-RETAIL                    
J28545                     END-IF                                               
                       ELSE                                                     
J28545                     SET ASC-GET-PRICE-FROM-INPD400 (PS-SUB)              
J28545                                  TO TRUE                                 
J28545                     MOVE IN400-PRC-SKU-OUT TO                            
J28545                                  ASC-SKU-SEQ-NBR(PS-SUB)                 
J28545                                  PV-DB2-SKU-SEQ-NBR                      
J28545                     MOVE IN400-PRC-STATUS-OUT TO                         
J28545                            PV-IN400-UPC-STAT-CDE                         
J28545                     MOVE IN400-PRC-UNIT-RTL-OUT  TO                      
J28545                            PV-IN400-UNT-RTL-AMT                          
J28545                            PV-ITEM-RETAIL                                
J28545                            ASC-ITM-UNIT-PR-AMT-X-FMT (PS-SUB)            
J28545                            ASC-ITM-UNIT-PR-AMT   (PS-SUB)                
J28545                     MOVE IN400-PRC-MITGPL-QTY TO                         
J28545                            PV-IN400-MITGPL-QTY                           
J28545                     PERFORM 3359-CHECK-GROUP-PRICING                     
J28545                 END-IF                                                   
J28545                                                                          
J28545             WHEN IN400-PV-NOT-FOUND                                      
      *   *    --- SKU NOT FOUND                                                
                       SET PS-ERROR                                             
                           PS-ERRORS-IN-LINE                                    
                           DP020-MSG-FATAL         TO TRUE                      
      *   *    ---- INVALID ENTRY ----                                          
                       MOVE PC-TSYMSG-00005        TO DP020-MSG-NUMBER          
W21732                 MOVE DP015-UNP-NUM-BRT-OFF  TO MR-SKUA  (PS-SUB)         
W21732                 MOVE DP015-RED              TO MR-SKUC  (PS-SUB)         
W21732                 MOVE DP015-REVERSE          TO MR-SKUH  (PS-SUB)         
W21732                 MOVE -1                     TO MR-SKUL  (PS-SUB)         
                       SET DP030-SET-CURSOR-APPL-1 TO TRUE                      
                   WHEN OTHER                                                   
                         SET  PS-ERROR                                          
                              DP020-MSG-WARNING TO TRUE                         
      *                ---- WAIT 15 SECONDS, THEN RETRY ----                    
                       MOVE PC-TSYMSG-00551 TO DP020-MSG-NUMBER                 
J28545                                                                          
               END-EVALUATE                                                     
           END-IF.                                                              
                                                                                
       3359-CHECK-GROUP-PRICING.                                                
      *                                                                         
J28545     IF IN400-PRC-MITGPL-QTY NOT EQUAL 0                                  
J28545     AND IN400-PRC-GP-AMT > ZERO                                          
J28545         COMPUTE ASC-ITM-UNIT-PR-AMT (PS-SUB) = IN400-PRC-GP-AMT          
J28545                               / IN400-PRC-MITGPL-QTY                     
J28545         MOVE ASC-ITM-UNIT-PR-AMT (PS-SUB)                                
                   TO ASC-ITM-UNIT-PR-AMT-X-FMT (PS-SUB)                        
                      PV-ITEM-RETAIL                                            
           END-IF.                                                              
      *                                                                         
      *                                                                         
J28545 3400-EDIT-UPC.                                                           
W28545*    ---- UPC ENTERED ----                                                
W28545     MOVE ASC-UPC-NBR-X (PS-SUB)    TO DP010I-UNEDITED-FIELD              
W28545     MOVE LENGTH OF ASC-UPC-NBR-X (PS-SUB)                                
W28545                                    TO DP010I-MAXIMUM-DIGITS              
W28545     MOVE ZERO                      TO DP010I-MAXIMUM-DECIMALS            
W28545     SET  DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                             
263126     CALL DP010I-NUMERIC-EDIT-ROUTINE                                     
263126          USING DP010I-NUMERIC-EDIT-AREA                                  
W28545                                                                          
W28545     IF DP010I-ERROR-DETECTED                                             
W28545         SET PS-ERROR                                                     
J28545             PS-INVALID-UPC                                               
W28545             DP020-MSG-FATAL             TO TRUE                          
W28545*        ---- MUST BE NUMERIC ----                                        
W28545         MOVE PC-TSYMSG-00008            TO DP020-MSG-NUMBER              
W28545         MOVE DP015-UNP-NUM-BRT-OFF      TO MR-SKUA (PS-SUB)              
W28545         MOVE DP015-RED                  TO MR-SKUC (PS-SUB)              
W28545         MOVE DP015-REVERSE              TO MR-SKUH (PS-SUB)              
W28545         MOVE -1                         TO MR-SKUL (PS-SUB)              
W28545         SET DP030-SET-CURSOR-APPL-1 TO TRUE                              
W28545     ELSE                                                                 
W28545         MOVE DP010I-NUM-FIELD-15-DIG-2-DEC                               
W28545                                   TO ASC-UPC-NBR (PS-SUB)                
W28545         IF ASC-UPC-NBR (PS-SUB) = ZERO                                   
W28545             SET PS-ERROR                                                 
W28545                 DP020-MSG-FATAL         TO TRUE                          
W28545*            ---- CANNOT BE ZERO ----                                     
W28545             MOVE PC-TSYMSG-00010        TO DP020-MSG-NUMBER              
W28545             MOVE DP015-UNP-NUM-BRT-OFF                                   
W28545                                     TO MR-SKUA (PS-SUB)                  
W28545             MOVE DP015-RED              TO MR-SKUC (PS-SUB)              
W28545             MOVE DP015-REVERSE          TO MR-SKUH (PS-SUB)              
W28545             MOVE -1                     TO MR-SKUL (PS-SUB)              
W28545             SET DP030-SET-CURSOR-APPL-1 TO TRUE                          
W28545         END-IF                                                           
W28545     END-IF.                                                              
J28545                                                                          
W28545*----------------------------------------------------------------*        
W28545* FOR ALL UPC'S, NO LONGER VALIDATE THE CHECK DIGIT.                      
W28545* IF THE UPC IS AN INTERNAL UPC WITH A SEQUENCE NUMBER OF '000'  *        
W28545* OR '999' IN THE EMBEDDED SKU, VALIDATE THE DEPARTMENT AND               
W28545* CLASS AGAINST TMDSEAR. IF NOT, CONVERT THE UPC TO A SKU.                
W28545*----------------------------------------------------------------*        
W28545                                                                          
J28545 3425-VALIDATE-UPC.                                                       
W28545                                                                          
J28545     MOVE ASC-UPC-NBR-X (PS-SUB)    TO IN400-PV-UPC-NBR-IN                
J28545     MOVE INVPAR-PLND-INV-DTE       TO IN400-PV-EFF-DTE-IN                
J28545     MOVE INVPAR-LOC-NBR            TO IN400-PV-LOC-IN-NUM                
J28545     SET IN400-PV-UPC-NBR-LOOKUP        TO TRUE                           
J28545     PERFORM IN400-LOOKUP-RETAIL.                                         
J28545                                                                          
J28545     MOVE IN400-PRC-SKU-OUT         TO PV-DUMMY-SKU                       
W28545                                                                          
W28545     IF ASC-UPC-INTERNAL    (PS-SUB) AND                                  
W28582*        PV-DUMMY-SKU (6:3) = '000' OR '999'                              
W28582         IN400-PV-DUMMY-UPC                                               
W28545         EVALUATE TRUE                                                    
J28545             WHEN IN400-PV-FOUND                                          
W28545                 SET ASC-GET-PRICE-FROM-SCREEN (PS-SUB)                   
W28545                                                       TO TRUE            
W28582                 MOVE IN400-ATT-SKU-OUT TO                                
W28582                                  ASC-SKU-SEQ-NBR (PS-SUB)                
W28582                 MOVE IN400-ATT-ITM-NBR-OUT TO PV-DB2-ITEM-NMBR           
J28545             WHEN IN400-PV-NOT-FOUND                                      
W28545                 SET PS-ERROR                                             
W28545                     PS-ERRORS-IN-LINE                                    
W28545                     DP020-MSG-FATAL                                      
W28545                     DP030-SET-CURSOR-APPL-1 TO TRUE                      
W28545*                     ---- INVALID ENTRY ----                             
W28545                 MOVE PC-TSYMSG-00005                                     
W28545                                             TO DP020-MSG-NUMBER          
W28545                 MOVE DP015-UNP-NUM-BRT-OFF                               
W28545                                             TO MR-SKUA (PS-SUB)          
W28545                 MOVE DP015-RED                                           
W28545                                             TO MR-SKUC (PS-SUB)          
W28545                 MOVE DP015-REVERSE                                       
W28545                                             TO MR-SKUH (PS-SUB)          
W28545                 MOVE -1                     TO MR-SKUL (PS-SUB)          
W28545             WHEN OTHER                                                   
W28545                 SET  PS-ERROR                                            
W28545                      DP020-MSG-WARNING TO TRUE                           
W28545*                     ---- WAIT 15 SECONDS, THEN RETRY ----               
W28545                 MOVE PC-TSYMSG-00551                                     
W28545                                          TO DP020-MSG-NUMBER             
W28545         END-EVALUATE                                                     
W28545     ELSE                                                                 
W28545         MOVE ASC-UPC-NBR (PS-SUB) TO PV-DB2-UPC-NBR                      
J28545         EVALUATE TRUE                                                    
J28545             WHEN IN400-PV-FOUND                                          
J28545                 IF IN400-PRC-STATUS-OUT = PC-CLEARANCE-SKU-STATUS        
J28545                     PERFORM 3265-PROCESS-CLEARANCE-DATES                 
23511C                     IF ASC-GET-PRICE-FROM-SCREEN (PS-SUB)                
23511C                         MOVE ZEROES TO PV-ITEM-RETAIL                    
J28545                     END-IF                                               
J28545                 ELSE                                                     
J28545                     SET ASC-GET-PRICE-FROM-INPD400 (PS-SUB)              
                                  TO TRUE                                       
J28545                     MOVE IN400-PRC-STATUS-OUT TO                         
J28545                            PV-IN400-UPC-STAT-CDE                         
J28545                     MOVE IN400-PRC-UNIT-RTL-OUT TO                       
J28545                            PV-IN400-UNT-RTL-AMT                          
J28545                            PV-ITEM-RETAIL                                
J28545                            ASC-ITM-UNIT-PR-AMT-X-FMT (PS-SUB)            
J28545                            ASC-ITM-UNIT-PR-AMT (PS-SUB)                  
J28545                     MOVE IN400-PRC-MITGPL-QTY                            
J28545                            TO  PV-IN400-MITGPL-QTY                       
J28545                     PERFORM 3359-CHECK-GROUP-PRICING                     
J28545                 END-IF                                                   
J28545                                                                          
J28545                 MOVE IN400-PRC-SKU-OUT TO                                
J28545                                  ASC-SKU-SEQ-NBR (PS-SUB)                
J28545                 MOVE IN400-PRC-ITM-NBR-OUT TO PV-DB2-ITEM-NMBR           
J28545             WHEN IN400-PV-NOT-FOUND                                      
W28545                 SET     PS-ERROR                                         
W28545                 PS-ERRORS-IN-LINE                                        
W28545                 DP020-MSG-FATAL                TO TRUE                   
W28545*           ---- INVALID ENTRY ----                                       
W28545                 MOVE PC-TSYMSG-00005                                     
W28545                                   TO DP020-MSG-NUMBER                    
W28545                 MOVE DP015-UNP-NUM-BRT-OFF                               
W28545                                   TO MR-SKUA (PS-SUB)                    
W28545                 MOVE DP015-RED     TO MR-SKUC (PS-SUB)                   
W28545                 MOVE DP015-REVERSE                                       
W28545                                   TO MR-SKUH (PS-SUB)                    
W28545                 MOVE -1            TO MR-SKUL (PS-SUB)                   
W28545                 SET DP030-SET-CURSOR-APPL-1 TO TRUE                      
W28545             WHEN OTHER                                                   
W28545                 SET     PS-ERROR                                         
W28545                 DP020-MSG-WARNING TO TRUE                                
W28545*                ---- WAIT 15 SECONDS, THEN RETRY ----                    
W28545                 MOVE PC-TSYMSG-00551                                     
W28545                                    TO DP020-MSG-NUMBER                   
W28545         END-EVALUATE                                                     
J28545     END-IF.                                                              
W28545                                                                          
W28545                                                                          
J28545*-----------------------------------------------------------------        
J28545* EDIT THE  SKU NUMBER FOR NUMERIC DATA.                                  
J28545*-----------------------------------------------------------------        
                                                                                
       3480-READ-TINVPAR.                                                       
                                                                                
W26600     MOVE ASC-KEY-STORE-NBR-X   TO PV-DB2-STORE-NBR-X.                    
W26600     MOVE PV-DB2-STORE-NBR-RED  TO PV-DB2-STORE-NBR.                      
JKB        MOVE IN030-INV-ID          TO PV-INV-ID.                             
                                                                                
           EXEC SQL                                                             
W28545       SELECT A.PLND_INV_DTE                                              
W28545             ,A.LOC_NBR                                                   
             INTO  :INVPAR-PLND-INV-DTE                                         
W26600            ,:INVPAR-LOC-NBR                                              
W28545       FROM   TINVPAR A                                                   
W28545             ,TINCNTL B                                                   
W28545     WHERE A.INV_ID  = B.INV_ID                                           
W28545       AND A.INV_ID  = :PV-INV-ID                                         
W28545       AND B.ACTV_IND = 'Y'                                               
W28545       AND A.LOC_NBR = :PV-DB2-STORE-NBR                                  
W28545       AND A.ACTL_FIN_BK_DTE = '9999-09-09'                               
W33304       AND A.LOC_INV_STAT_CDE = 'IN'                                      
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = 0                                                 
W26600*            MOVE INVPAR-STORE-NBR      TO PV-DB2-STORE-NBR               
                   MOVE INVPAR-PLND-INV-DTE   TO PV-PLND-INV-DTE                
                   MOVE PV-PLND-INV-TIMESTAMP TO PV-PLND-INV-TMST               
SMJ            WHEN SQLCODE = -913                                              
SMJ            WHEN SQLCODE = -904                                              
SMJ            WHEN SQLCODE = -911                                              
SMJ                SET  PS-ERROR                                                
SMJ                     PS-UNAVAILABLE-RESOURCE  TO TRUE                        
               WHEN SQLCODE = +100                                              
               WHEN SQLWARN NOT = SPACE                                         
               WHEN SQLCODE NOT = ZERO                                          
                   MOVE '3480-READ-TINVPAR'                                     
                                     TO DP013-PARAGRAPH                         
                   MOVE 'RETRIEVE STORE PLANNED INV DATE'                       
                                     TO DP013-MESSAGE-TEXT(1)                   
                   MOVE SQLCA        TO DP013-SQLCA                             
                   MOVE 'TINVPAR'    TO DP013-DB2-TABLE-NAME (1)                
                   SET DP013-DB2-ABEND                                          
                       DP013-XCTL-DISPLAY-RESTART TO TRUE                       
                   PERFORM DP013-0000-PROCESS-ABEND                             
           END-EVALUATE.                                                        
                                                                                
                                                                                
      ******************************************************************        
      * CALCULATE TOTALS FOR RETAIL, QUANTITY AND EXTENDED RETAIL               
      ******************************************************************        
      *                                                                         
       3500-CALC-EXTD-RTL.                                                      
      *                                                                         
J28545     IF ASC-ITM-UNIT-PR-AMT-X (PS-SUB) > SPACES                           
J28545         COMPUTE PV-EXTD-RTL-AMT EQUAL                                    
J28545             (ASC-INV-QTY (PS-SUB) * PV-ITEM-RETAIL)                      
                                                                                
J28545         MOVE PV-EXTD-RTL-AMT TO                                          
J28545                              ASC-ITM-EXTD-PR-AMT       (PS-SUB)          
J28545                              ASC-ITM-EXTD-PR-AMT-X-FMT (PS-SUB)          
      * ADD TO TOTAL FIELDS                                                     
J28545         ADD PV-ITEM-RETAIL       TO  ASC-TOTAL-RTL-AMT                   
J28545         ADD ASC-INV-QTY (PS-SUB) TO  ASC-TOTAL-QTY-AMT                   
J28545         ADD PV-EXTD-RTL-AMT      TO  ASC-TOTAL-EXTD-RTL                  
J28545         MOVE ASC-TOTAL-RTL-AMT   TO  ASC-TOTAL-RTL-AMT-X-FMT             
J28545         MOVE ASC-TOTAL-QTY-AMT   TO  ASC-TOTAL-QTY-AMT-X-FMT             
J28545         MOVE ASC-TOTAL-EXTD-RTL  TO  ASC-TOTAL-EXTD-RTL-X-FMT            
J28545     ELSE                                                                 
J28545         IF DP020-MSG-NUMBER NOT EQUAL PC-TSYMSG-00005                    
J28545             SET ASC-GET-PRICE-FROM-SCREEN (PS-SUB)                       
J28545                 DP020-MSG-FATAL                                          
J28545                 DP030-SET-CURSOR-APPL-1                                  
J28545                                             TO TRUE                      
J28545*            ---- REQUIRED FIELD ----                                     
J28545             MOVE PC-TSYMSG-00007            TO DP020-MSG-NUMBER          
J28545             MOVE -1                         TO MR-PRCEL (PS-SUB)         
J28545             MOVE DP015-UNP-NUM-BRT-OFF      TO MR-PRCEA (PS-SUB)         
J28545             MOVE DP015-RED                  TO MR-PRCEC (PS-SUB)         
J28545             MOVE DP015-REVERSE              TO MR-PRCEH (PS-SUB)         
J28545         END-IF                                                           
J28545     END-IF.                                                              
                                                                                
                                                                                
                                                                                
W28545*----------------------------------------------------------------*        
W28545* 3600-EDIT THE UPC OR SKU.                                               
W28545*    THE ROUTINE COUNTS THE NUMBER OF BYTES THE USER ENTERED. THE         
W28545* RESULT IS USED TO DETERMINE IF THE USER HAD ENTERED A SKU OR AN         
W28545* UPC.     (DEFINITIIONS - SKU 8 BYTES, UPC 9 TO 15 BYTES)                
W28545*----------------------------------------------------------------*        
W28545 3600-EDIT-UPC-SKU.                                                       
W28545                                                                          
W28545     IF WS-EDIT-BYTE (PV-BYTE-SUB) IS EQUAL TO SPACE                      
W28545         CONTINUE                                                         
W28545     ELSE                                                                 
W28545         IF (WS-EDIT-BYTE (PV-BYTE-SUB) IS EQUAL TO ZERO AND              
W28545             PV-BYTE-COUNT IS EQUAL TO ZEROS)                             
W28545             CONTINUE                                                     
W28545         ELSE                                                             
W28545             ADD 1           TO PV-BYTE-COUNT                             
W28545         END-IF                                                           
W28545     END-IF.                                                              
W28545                                                                          
W28545                                                                          
      *----------------------------------------------------------------*        
      * POSITION THE CURSOR FOR THE INITIAL PANEL.                              
      *----------------------------------------------------------------*        
                                                                                
       4000-BUILD-INITIAL-PANEL.                                                
                                                                                
           SET DP030-SET-CURSOR-APPL-1 TO TRUE.                                 
           MOVE LOW-VALUES TO IN033AO.                                          
W21732     MOVE -1 TO MR-SKUL(1).                                               
W28545                                                                          
W28545     MOVE ASC-TYPE-CDE-DESC   TO ATYPDSCO.                                
W28545                                                                          
W26600     STRING                                                               
W26600       ASC-KEY-STORE-NBR-X SPACE '-' SPACE                                
W26600       ASC-STORE-NAME                                                     
W26600       DELIMITED BY SIZE      INTO ASTNAMEO.                              
W28545                                                                          
           MOVE ASC-KEY-SHEET-NBR-X TO ASHEETO.                                 
           MOVE ZEROES              TO PV-EXTD-RTL-AMT.                         
                                                                                
      *----------------------------------------------------------------*        
      * CHECK IF THE SHEET THAT IS BEING ADDED ALREADY EXISTS. IF SO,  *        
      * RETURN AN ERROR ON THE SELECTION SCREEN. IF NOT, SAVE THE      *        
      * NECESSARY INTER-APPL COMMAREA FIELDS IN THE ASC AND PROCEED    *        
      * WITH THE ADD.                                                           
      *----------------------------------------------------------------*        
                                                                                
       4100-CHECK-IF-SHEET-EXISTS.                                              
                                                                                
           PERFORM 4110-OPEN-CURSOR.                                            
                                                                                
           PERFORM 4120-FETCH.                                                  
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = 0                                                 
                   SET DP020-NEXT-ACT-APPL-ERROR                                
                       DP020-MSG-FATAL           TO TRUE                        
      *            ---- SHEET HAS ALREADY BEEN ADDED ----                       
                   MOVE PC-TSYMSG-00552 TO DP020-MSG-NUMBER                     
                   MOVE IN030-SHEET-NBR TO DP020-MSG-TEXT                       
      * SHEET DOES NOT YET EXIST  (MOVE INFO TO SCREEN)                         
               WHEN SQLCODE = +100                                              
                   MOVE IN030-STORE-NAME       TO ASC-STORE-NAME                
      *                                                                         
                   MOVE IN030-STR-NBR          TO PV-DB2-STORE-NBR              
                   MOVE PV-DB2-STORE-NBR       TO PV-DB2-STORE-NBR-RED          
                   MOVE PV-DB2-STORE-NBR-X     TO ASC-KEY-STORE-NBR-X           
      *                                                                         
                   MOVE IN030-SHEET-NBR        TO PV-SHEET-NBR                  
                   MOVE PV-SHEET-NBR           TO PV-SHEET-NBR-RED              
                   MOVE PV-SHEET-NBR-X         TO ASC-KEY-SHEET-NBR-X           
                                                                                
W28545             MOVE IN030-TYPE-CDE         TO ASC-KEY-TYPE-CDE              
W28545             MOVE IN030-TYPE-CDE-DESC    TO ASC-TYPE-CDE-DESC             
W28545                                                                          
                   MOVE IN030-DB2-ACTL-INV-DTE TO PV-ACTL-INV-DTE-DB2           
                   MOVE PV-ACTL-DB2-INV-YYYY   TO PV-COMP-INV-YYYY              
                   MOVE PV-ACTL-DB2-INV-MM     TO PV-COMP-INV-MM                
                   MOVE PV-ACTL-DB2-INV-DD     TO PV-COMP-INV-DD                
                   MOVE PV-ACTL-INV-DTE-COMP   TO                               
                                               ASC-ACTL-INV-DTE-YYYYMMDD        
               WHEN OTHER                                                       
                   SET DP020-NEXT-ACT-APPL-ERROR                                
                       DP020-MSG-WARNING         TO TRUE                        
      *             ---- WAIT 15 SECONDS, THEN RETRY ----                       
                   MOVE PC-TSYMSG-00551 TO DP020-MSG-NUMBER                     
           END-EVALUATE.                                                        
                                                                                
           PERFORM 4130-CLOSE-CURSOR.                                           
       EJECT                                                                    
       4110-OPEN-CURSOR.                                                        
                                                                                
           EXEC SQL                                                             
                OPEN LINE-NBR-CSR                                               
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                    CONTINUE                                                    
               WHEN SQLWARN0 NOT EQUAL SPACE                                    
               WHEN SQLCODE NOT EQUAL ZERO                                      
                    MOVE '4110-OPEN-CURSOR'                                     
                                 TO  DP013-PARAGRAPH                            
                    MOVE 'OPEN SHEET INVENTORY LINE-NBR CURSOR'                 
                                 TO  DP013-MESSAGE-TEXT (1)                     
                    MOVE SQLCA   TO  DP013-SQLCA                                
                    SET DP013-DB2-ABEND                                         
                                 TO  TRUE                                       
                    PERFORM DP013-0000-PROCESS-ABEND                            
           END-EVALUATE.                                                        
                                                                                
                                                                                
       4120-FETCH.                                                              
                                                                                
           EXEC SQL                                                             
                FETCH LINE-NBR-CSR                                              
                INTO  :INENTY-LNE-NBR                                           
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
               WHEN SQLCODE = +100                                              
               WHEN SQLCODE = -904                                              
               WHEN SQLCODE = -913                                              
                   CONTINUE                                                     
               WHEN SQLWARN0 NOT = SPACE                                        
               WHEN SQLCODE  NOT = ZERO                                         
                   MOVE '4120-FETCH-CURSOR'                                     
                                TO  DP013-PARAGRAPH                             
                   MOVE 'FETCH SHEET INVENTORY LINE-NBR CURSOR'                 
                                TO  DP013-MESSAGE-TEXT (1)                      
                   MOVE SQLCA   TO  DP013-SQLCA                                 
                   SET DP013-DB2-ABEND                                          
                                TO  TRUE                                        
                   PERFORM DP013-0000-PROCESS-ABEND                             
           END-EVALUATE.                                                        
                                                                                
                                                                                
       4130-CLOSE-CURSOR.                                                       
                                                                                
           EXEC SQL                                                             
               CLOSE LINE-NBR-CSR                                               
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                    CONTINUE                                                    
               WHEN SQLWARN0 NOT = SPACE                                        
               WHEN SQLCODE  NOT = ZERO                                         
                    MOVE '4130-CLOSE-CURSOR'                                    
                                 TO  DP013-PARAGRAPH                            
                    MOVE 'CLOSE SHEET INVENTORY LINE-NBR CURSOR'                
                                 TO  DP013-MESSAGE-TEXT (1)                     
                    MOVE SQLCA   TO  DP013-SQLCA                                
                    SET DP013-DB2-ABEND                                         
                                 TO  TRUE                                       
                    PERFORM DP013-0000-PROCESS-ABEND                            
           END-EVALUATE.                                                        
       EJECT                                                                    
      *----------------------------------------------------------------*        
      *    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *        
      *----------------------------------------------------------------*        
                                                                                
       4400-MOVE-COMMAREA-TO-SCREEN.                                            
                                                                                
W28545     MOVE ASC-TYPE-CDE-DESC   TO ATYPDSCO.                                
W28545                                                                          
W26600*    MOVE ASC-STORE-NAME      TO ASTNAMEO.                                
W26600     STRING                                                               
W26600       ASC-KEY-STORE-NBR-X SPACE '-' SPACE                                
W26600       ASC-STORE-NAME                                                     
W26600       DELIMITED BY SIZE      INTO ASTNAMEO.                              
           MOVE ASC-KEY-SHEET-NBR-X TO ASHEETO.                                 
                                                                                
           IF ASC-SKU-ENTERED (PS-SUB)                                          
W21732         MOVE ASC-SKU-SEQ-NBR     (PS-SUB)  TO MR-SKU   (PS-SUB)          
           ELSE                                                                 
W28545*        MOVE SPACE                         TO MR-SKU   (PS-SUB)          
W28545         IF ASC-UPC-ENTERED (PS-SUB)                                      
W28545             MOVE ZERO                      TO PV-UPC-POS                 
W28545             INSPECT ASC-UPC-NBR-X (PS-SUB) TALLYING                      
W28545                 PV-UPC-POS FOR LEADING ZEROS                             
W28545             ADD 1                          TO PV-UPC-POS                 
W28545             MOVE ASC-UPC-NBR-X    (PS-SUB) (PV-UPC-POS:)                 
W28545                                            TO MR-UPC   (PS-SUB)          
W28545         ELSE                                                             
W28545             MOVE SPACE                     TO MR-SKU   (PS-SUB)          
W28545         END-IF                                                           
           END-IF.                                                              
                                                                                
           IF ASC-INV-QTY (PS-SUB) IS NUMERIC                                   
               MOVE ASC-INV-QTY   (PS-SUB) TO MR-QTY   (PS-SUB)                 
           ELSE                                                                 
               MOVE ASC-INV-QTY-X (PS-SUB) TO MR-QTY-X (PS-SUB)                 
           END-IF.                                                              
                                                                                
           MOVE ASC-ITM-UNIT-PR-AMT-X-FMT (PS-SUB)                              
J28545                                     TO MR-PRCE-X (PS-SUB)                
                                                                                
J28545     IF ASC-ITM-EXTD-PR-AMT (PS-SUB) > ZERO                               
               MOVE ASC-ITM-EXTD-PR-AMT (PS-SUB)                                
                                       TO MR-EXTD       (PS-SUB)                
           ELSE                                                                 
               MOVE ASC-ITM-EXTD-PR-AMT-X (PS-SUB)                              
                                           TO MR-EXTD-X (PS-SUB)                
           END-IF.                                                              
       EJECT                                                                    
      *----------------------------------------------------------------*        
      *    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *        
      *----------------------------------------------------------------*        
                                                                                
       4450-MOVE-COMM-TOTS-TO-SCREEN.                                           
                                                                                
           MOVE ASC-TOTAL-RTL-AMT-X-FMT  TO MR-TRTL.                            
                                                                                
           MOVE ASC-TOTAL-QTY-AMT-X-FMT  TO MR-TQTY.                            
                                                                                
           MOVE ASC-TOTAL-EXTD-RTL-X-FMT TO MR-TEXTD.                           
                                                                                
       EJECT                                                                    
      *----------------------------------------------------------------*        
      * ADD A 'SHEET INVENTORY' SHEET. THE SHEET CONSISTS OF           *        
      * MULTIPLE LINES. EACH LINE CORRESPONDS TO A ROW IN THE TABLE.   *        
      *----------------------------------------------------------------*        
                                                                                
       5000-ADD-SHEET.                                                          
                                                                                
           INITIALIZE INENTY-LNE-NBR.                                           
           MOVE PV-DB2-STORE-NBR   TO INENTY-STR-NBR.                           
           MOVE PV-SHEET-NBR       TO INENTY-SHEET-NBR.                         
W28545     MOVE PV-DB2-TYPE-CDE    TO INENTY-SHEET-TYP-CDE.                     
           PERFORM 5025-ADD-A-LINE                                              
               VARYING PS-SUB FROM 1 BY 1                                       
                 UNTIL PS-SUB > PC-LINES-PER-PANEL OR                           
                       PS-ADD-NOT-SUCCESSFUL.                                   
                                                                                
                                                                                
       5025-ADD-A-LINE.                                                         
                                                                                
W21732     IF ASC-SKU-SEQ-NBR (PS-SUB) > SPACE                                  
               COMPUTE INENTY-LNE-NBR                                           
                     = INENTY-LNE-NBR                                           
                     + 1                                                        
W21732         MOVE ASC-SKU-SEQ-NBR     (PS-SUB)                                
W21732                                        TO INENTY-SKU-NBR                 
W28545         IF ASC-UPC-ENTERED       (PS-SUB)                                
W28545             MOVE ASC-UPC-NBR     (PS-SUB)                                
W28545                                        TO INENTY-UPC-NBR                 
W28545         ELSE                                                             
W28545             MOVE ZEROES                TO INENTY-UPC-NBR                 
W28545         END-IF                                                           
                                                                                
               MOVE ASC-INV-QTY         (PS-SUB)                                
                                              TO INENTY-INV-QTY                 
               MOVE ASC-ITM-UNIT-PR-AMT (PS-SUB)                                
                                              TO INENTY-UNT-RTL-AMT             
               COMPUTE INENTY-EXTD-RTL-AMT                                      
                     = INENTY-INV-QTY                                           
                     * INENTY-UNT-RTL-AMT                                       
               MOVE DP020-USERID              TO                                
                                               INENTY-LAST-UPD-BY-USR-ID        
W28545         MOVE ASC-KEY-TYPE-CDE          TO INENTY-SHEET-TYP-CDE           
W28545*        MOVE ZEROES                    TO INENTY-UPC-NBR                 
               PERFORM 5100-INSERT-LINE                                         
               IF SQLCODE NOT = 0                                               
                   EXEC CICS                                                    
                       SYNCPOINT                                                
                           ROLLBACK                                             
                   END-EXEC                                                     
                   SET PS-ADD-NOT-SUCCESSFUL                                    
                       DP020-MSG-WARNING TO TRUE                                
      *            ---- WAIT 15 SECONDS, THEN RETRY ----                        
                   MOVE PC-TSYMSG-00551  TO DP020-MSG-NUMBER                    
               END-IF                                                           
           END-IF.                                                              
                                                                                
                                                                                
      *----------------------------------------------------------------*        
      * INSERT A ROW INTO THE TINENTY TABLE                            *        
      *----------------------------------------------------------------*        
                                                                                
       5100-INSERT-LINE.                                                        
                                                                                
           EXEC SQL                                                             
               INSERT INTO TINENTY                                              
                    (STR_NBR                                                    
                  ,  SHEET_TYP_CDE                                              
                  ,  SHEET_NBR                                                  
                  ,  LNE_NBR                                                    
W21732            ,  SKU_NBR                                                    
---->             ,  UPC_NBR                                                    
                  ,  INV_QTY                                                    
                  ,  UNT_RTL_AMT                                                
                  ,  EXTD_RTL_AMT                                               
                  ,  LAST_UPD_TMST                                              
                  ,  LAST_UPD_BY_USR_ID)                                        
               VALUES                                                           
                   (:INENTY-STR-NBR                                             
                  , :INENTY-SHEET-TYP-CDE                                       
                  , :INENTY-SHEET-NBR                                           
                  , :INENTY-LNE-NBR                                             
W21732            , :INENTY-SKU-NBR                                             
                  , :INENTY-UPC-NBR                                             
                  , :INENTY-INV-QTY                                             
                  , :INENTY-UNT-RTL-AMT                                         
                  , :INENTY-EXTD-RTL-AMT                                        
                  , CURRENT TIMESTAMP                                           
                  , :INENTY-LAST-UPD-BY-USR-ID)                                 
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
               WHEN SQLCODE = -904                                              
               WHEN SQLCODE = -913                                              
                   CONTINUE                                                     
               WHEN SQLWARN0 NOT = SPACES                                       
               WHEN SQLCODE  NOT = ZERO                                         
                   MOVE '5100-INSERT-LINE'                                      
                                     TO DP013-PARAGRAPH                         
                   MOVE 'INSERT A ROW INTO THE SHEET INVENTORY ENTRY            
      -                 'TABLE'      TO DP013-MESSAGE-TEXT(1)                   
                   MOVE SQLCA        TO DP013-SQLCA                             
                   MOVE 'TINENTY'    TO DP013-DB2-TABLE-NAME (1)                
                   SET DP013-DB2-ABEND                                          
                       DP013-XCTL-DISPLAY-RESTART TO TRUE                       
                   PERFORM DP013-0000-PROCESS-ABEND                             
           END-EVALUATE.                                                        
       EJECT                                                                    
      *----------------------------------------------------------------*        
      *    CURRENT SYSTEM DATE/TIME MODULE                                      
      *----------------------------------------------------------------*        
                                                                                
           COPY DPPD017.                                                        
                                                                                
      *----------------------------------------------------------------*        
      *    ABEND PROCESSOR MODULE                                      *        
      *----------------------------------------------------------------*        
                                                                                
           COPY DPPD013.                                                        
J28545     COPY INPD400.                                                        
