451110*----------------------------------------------------------------*00010001
451110*  APPD021 - PROCEDURE DIVISION COPYBOOK FOR SEPHORA AT KOHLS    *00020001
451110*                                                                *00021001
451110*  THIS IS USED WITH COPYBOOK APWS021                            *00022001
451110*                                                                *00023001
451110*  TABLES THAT NEED TO BE INCLUDED IN THE PROGRAM:               *00023101
451110*         VNT_VND_CPBL  VNT00001  VN-VENDOR CAPABILITY           *00023211
451110*         TMDSEAR                 MD-MERCHANDISE AREA            *00023311
451110*                                                                *00023513
451110*  IN INITIALIZATION:                                            *00024004
451110*     LOAD THE PROGRAM NAME INTO SA-PROGRAM-NAME                 *00024104
451110*     PERFORM S100-GET-SEPHORA-DEPT TO LOAD THE 'SEPHORA AT'     *00024204
451110*                 KOHLS' DEPT NUMBERS INTO A TABLE               *00025004
451110*                                                                *00026001
451110*  IN ORDER TO DETERMINE IF A PO BELONGS TO 'SEPHORA AT KOHLS',  *00027001
451110*     THE ENT-ID AND DEPT-NBR ARE NEEDED FOR THE PO.  THESE CAN  *00028014
451110*     BE FOUND ON THE TPURCHS TABLE, IF NOT ALREADY IN PROGRAM   *00028114
451110*          LOAD ENT_ID TO PV-ENT-ID                              *00028214
451110*          LOAD DEPT_NBR TO PV-DEPT-NBR                          *00028314
451110*     PERFORM S500-CHECK-FOR-SEPHORA                             *00029002
451110*                                                                *00029102
451110*  THERE ARE 4 POSSIBLE RESULTS THAT CAN BE USED:                *00029210
451110*      PS-NOT-SEPHORA      - THE PO IS NOT FOR SEPHORA           *00029308
451110*      PS-SEPHORA-AT-KOHLS - THE PO IS FOR SEPHORA, AND THE DEPT *00029608
451110*                            IS 'SEPHORA AT KOHLS'               *00029708
451110*      PS-SEPHORA-OTHER    - THE PO IS FOR SEPHORA, BUT THE DEPT *00029810
451110*                            IS NOT 'SEPHORA AT KOHLS'           *00029910
451110*      PS-SEPHORA-ALL      - THE PO IS FOR SEPHORA, ANY DEPT     *00030010
451110*                                                                *00040008
502396*---------------------------------------------------------------- 50238000
502397*   S100-GET-SEPHORA-DEPT                                         50239001
502398*   GET THE DEPARTMENTS THAT ARE ASSOCIATED WITH                  50239100
502399*   'SEPHORA AT KOHLS'.  THESE ARE DIFFERENT THAN REGULAR         50239200
502400*   SEPHORA VENDORS FOR MERCHANDISE IN OTHER DEPARTMENTS          50239300
502401*---------------------------------------------------------------- 50239400
502402 S100-GET-SEPHORA-DEPT.                                           50239501
502403                                                                  50239600
502404     SET SA-IDX TO 1.                                             50239706
502405     PERFORM S200-OPEN-DEPT-CSR.                                  50239801
502406     PERFORM S300-FETCH-DEPT-CSR UNTIL                            50239901
502407                                PS-DEPT-END-YES OR                50240000
502408                                SA-IDX > 25.                      50240106
502409       IF SA-IDX > 25                                             50240206
502410          SET SA-TABLE-OVERFLOW           TO TRUE                 50240305
502411          MOVE 'S100-GET-SEPHORA-DEPT'    TO SA-PARAGRAPH-NAME    50240405
502412          MOVE 'DEPT ARRAY EXCEEDS LIMIT' TO SA-MESSAGE           50240504
502413          PERFORM S999-ABEND                                      50240603
502414       END-IF                                                     50240700
502415     PERFORM S400-CLOSE-DEPT-CSR.                                 50240801
502420                                                                  50240900
502421*---------------------------------------------------------------  50241000
502422*   S200-OPEN-DEPT-CSR                                            50242001
502422*   OPENS THE CURSOR THAT WILL GET THE 'SEPHORA AT KOHLS' DEPTS   50242102
502423*---------------------------------------------------------------  50242202
502424 S200-OPEN-DEPT-CSR.                                              50242302
502425                                                                  50242402
502426     EXEC SQL                                                     50242502
502427         OPEN SEPHORA_DEPT_CSR                                    50242602
502428     END-EXEC.                                                    50242702
502429                                                                  50242802
502430     EVALUATE TRUE                                                50242902
502431         WHEN SQLCODE = ZERO                                      50243002
502432              CONTINUE                                            50243102
502433                                                                  50243202
502434         WHEN SQLCODE = +100                                      50243302
502435             MOVE 'S200-OPEN-DEPT-CSR'                            50243403
502436                                TO SA-PARAGRAPH-NAME              50243504
502437             MOVE 'NO SEPHORA AT KOHLS DEPTS'                     50243602
502438                                 TO SA-DB2-OPERATION              50243704
502439             MOVE 'TMDSEAR'      TO SA-DB2-TABLE-1                50243804
502440             MOVE SPACES         TO SA-DB2-TABLE-2                50243904
502441             PERFORM S998-DB2-ABEND                               50244003
502447                                                                  50244102
502448         WHEN SQLWARN0 NOT = SPACES                               50244202
502449         WHEN SQLCODE  NOT = ZERO                                 50244302
502450             MOVE 'S200-OPEN-DEPT-CSR'                            50244403
502451                                TO SA-PARAGRAPH-NAME              50244504
502452             MOVE 'UNSUCCESSFUL OPEN ON SEPHORA_DEPT_CSR'         50244602
502453                                TO SA-DB2-OPERATION               50244704
502454             MOVE 'TMDSEAR'     TO SA-DB2-TABLE-1                 50244804
502455             MOVE SPACES        TO SA-DB2-TABLE-2                 50244904
502456             PERFORM S998-DB2-ABEND                               50245003
502457     END-EVALUATE.                                                50245102
502458                                                                  50245202
502459                                                                  50245302
502460*---------------------------------------------------------------- 50245402
502461*   S300-FETCH-DEPT-CSR                                           50245502
502422*   RETRIEVE THE 'SEPHORA AT KOHLS' DEPTS AND LOAD INTO TABLE     50245602
502462*---------------------------------------------------------------- 50245702
502463  S300-FETCH-DEPT-CSR.                                            50245802
502464                                                                  50245902
502465     EXEC SQL                                                     50246002
502466         FETCH SEPHORA_DEPT_CSR                                   50246102
502467         INTO :MDSEAR-DEPT-NBR                                    50246202
502468     END-EXEC.                                                    50246302
502469                                                                  50246402
502470     EVALUATE TRUE                                                50246502
502471         WHEN SQLCODE = +100                                      50246602
502472           SET PS-DEPT-END-YES    TO TRUE                         50246702
502473         WHEN SQLCODE = ZERO                                      50246802
502474           MOVE MDSEAR-DEPT-NBR TO PV-SEPHORA-DEPT(SA-IDX)        50246906
502475           SET SA-IDX UP BY 1                                     50247006
502476         WHEN SQLWARN0 NOT = SPACES                               50247102
502477         WHEN SQLCODE  NOT = ZERO                                 50247202
502478           MOVE 'S300-FETCH-DEPT-CSR'                             50247303
502479                               TO SA-PARAGRAPH-NAME               50247404
502480           MOVE                                                   50247502
502481             'UNSUCCESSFUL FETCH WITH SEPHORA_DEPT_CSR'           50247602
502482                               TO SA-DB2-OPERATION                50247704
502483           MOVE 'TMDSEAR'      TO SA-DB2-TABLE-1                  50247804
502484           MOVE SPACES         TO SA-DB2-TABLE-2                  50247904
502485           PERFORM S998-DB2-ABEND                                 50248003
502486     END-EVALUATE.                                                50248102
502487                                                                  50248202
502488*---------------------------------------------------------------- 50248302
502489*   S400-CLOSE-DEPT-CSR                                           50248402
502422*   CLOSES THE CURSOR THAT GOT THE 'SEPHORA AT KOHLS' DEPTS       50248502
502490*---------------------------------------------------------------- 50248602
502491  S400-CLOSE-DEPT-CSR.                                            50248702
502492                                                                  50248802
502493     EXEC SQL                                                     50248902
502494         CLOSE SEPHORA_DEPT_CSR                                   50249002
502495     END-EXEC.                                                    50249102
502496                                                                  50249202
502497     EVALUATE TRUE                                                50249302
502498         WHEN SQLCODE = ZERO                                      50249402
502499              CONTINUE                                            50249502
502500                                                                  50249602
502501         WHEN SQLWARN0 NOT = SPACES                               50249702
502502         WHEN SQLCODE  NOT = ZERO                                 50249802
502503             MOVE 'S400-CLOSE-DEPT-CSR'                           50249903
502504                                 TO SA-PARAGRAPH-NAME             50250004
502505             MOVE 'UNSUCCESSFUL CLOSE ON SEPHORA_DEPT_CSR'        50250102
502506                                 TO SA-DB2-OPERATION              50250204
502507             MOVE 'TMDSEAR'      TO SA-DB2-TABLE-1                50250304
502508             MOVE SPACES         TO SA-DB2-TABLE-2                50250404
502509             PERFORM S998-DB2-ABEND                               50250503
502510     END-EVALUATE.                                                50250602
502511                                                                  50250702
451110*----------------------------------------------------------------*50250802
451120* S500-CHECK-FOR-SEPHORA                                         *50250902
451120*    CHECK TO SEE IF THE VENDOR IS FOR 'SEPHORA AT KOHLS'        *50251002
451130*    NOTE:  THERE ARE SOME INVOICES FOR SEPHORA THAT ARE NOT     *50251102
451140*           PART OF 'SEPHORA AT KOHLS' WHICH DO NOT HAVE ANY     *50251202
451150*           SPECIAL SEPHORA PROCESSING                           *50251302
451170*----------------------------------------------------------------*50253002
451180 S500-CHECK-FOR-SEPHORA.                                          50254002
451183                                                                  50255002
451184     SET PS-NOT-SEPHORA           TO TRUE.                        50256008
451190                                                                  50258002
451191     EXEC SQL                                                     50259002
451192         SELECT VND_CPBL_CDE                                      50260002
451195           INTO :VNT00001-VND-CPBL-CDE                            50270002
451198           FROM VNT_VND_CPBL                                      50280002
451201          WHERE ENT_ID            = :PV-ENT-ID                    50290002
451202            AND VND_CPBL_CDE      = 'SBS'                         50300002
451203            AND EFF_BEG_DTE       <= CURRENT DATE                 50310002
451204            AND EFF_END_DTE       >= CURRENT DATE                 50320002
451206     END-EXEC.                                                    50330002
451207                                                                  50340002
451208     EVALUATE TRUE                                                50350002
451209         WHEN SQLCODE = ZERO                                      50360002
451209             SET PS-SEPHORA-OTHER TO TRUE                         50370012
126930             PERFORM S600-SET-SEPHORA-SW                          50390002
451211         WHEN SQLCODE = +100                                      50410002
451212             CONTINUE                                             50420002
451214         WHEN OTHER                                               50430002
451215             MOVE 'S500-CHECK-FOR-SEPHORA'                        50440003
451216                                          TO SA-PARAGRAPH-NAME    50450004
451217             MOVE 'UNSUCCESSFUL SELECT'   TO SA-DB2-OPERATION     50460004
451218             MOVE 'VNT_VND_CPBL'          TO SA-DB2-TABLE-1       50470004
451221             PERFORM S998-DB2-ABEND                               50480003
451222     END-EVALUATE.                                                50490002
502200                                                                  50500002
502310*---------------------------------------------------------------- 50510002
502320*  S600-SET-SEPHORA-SW                                            50520002
502330*---------------------------------------------------------------- 50530002
502340 S600-SET-SEPHORA-SW.                                             50540002
502350                                                                  50550002
502360     SET SA-IDX TO 1.                                             50560006
502370     SEARCH PV-SEPHORA-ENTRIES                                    50570002
502380       VARYING SA-IDX                                             50580006
502390*       AT END                                                    50590008
502391*          CONTINUE                                               50600008
502392        WHEN PV-SEPHORA-DEPT(SA-IDX) = PV-DEPT-NBR                50610007
502393            SET PS-SEPHORA-AT-KOHLS TO TRUE                       50620008
502394     END-SEARCH.                                                  50630002
502395                                                                  50640002
506500*----------------------------------------------------------------*50641005
506500*  S998-DB2-ABEND - DISPLAY ERROR MSGS FOR DB2 ERRORS            *50642005
506500*----------------------------------------------------------------*50650003
506600 S998-DB2-ABEND.                                                  50660003
506700                                                                  50670003
502410     SET SA-DB2-ERROR TO TRUE.                                    50680005
506900     DISPLAY SA-ABEND-LIT.                                        50690004
507100     DISPLAY SA-PROGRAM-LIT.                                      50701004
507200     DISPLAY SA-PARAGRAPH-LIT.                                    50720004
507200     DISPLAY SA-DB2-ERROR-LIT.                                    50721004
507300     DISPLAY SA-DB2-OPERATION-LIT.                                50730004
507400     DISPLAY SA-DB2-TABLE-1.                                      50740004
507500     DISPLAY SA-DB2-TABLE-2.                                      50750004
508300     CALL 'ILBOABN0' USING SA-ABEND-CODE.                         50830005
508310                                                                  50830105
506500*----------------------------------------------------------------*50831005
506500*  S999-ABEND - DISPLAY ERROR MSGS FOR NON-DB2 ERRORS            *50832005
509900*----------------------------------------------------------------*50840003
510000 S999-ABEND.                                                      50850003
510100                                                                  50860003
510300     DISPLAY SA-ABEND-LIT.                                        50880004
510400     DISPLAY SA-PROGRAM-LIT.                                      50890004
510500     DISPLAY SA-PARAGRAPH-LIT.                                    50900004
510600     DISPLAY SA-MESSAGE-LINE.                                     50910004
510700     CALL 'ILBOABN0' USING SA-ABEND-CODE.                         50920005
