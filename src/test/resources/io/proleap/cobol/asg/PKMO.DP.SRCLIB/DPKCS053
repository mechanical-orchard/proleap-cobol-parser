000100*-----------------------*                                         00010042
000200 IDENTIFICATION DIVISION.                                         00020042
000300*-----------------------*                                         00030042
000400 PROGRAM-ID.    DPKCS053.                                         00040042
000500 AUTHOR.        CHERI MASTEL - COMPUWARE.                         00050042
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060042
000700 DATE-WRITTEN.  05-17-96.                                         00070042
000800 DATE-COMPILED.                                                   00080042
000900*----------------------------------------------------------------*00090042
001000*    Z053 - UPDATE PHYSICAL UNIT.                                *00100042
001100*                                                                *00110042
001200*    THIS PROGRAM ALLOWS THE USER TO UPDATE A PHYSICAL UNIT,     *00120042
001300*    ON THE DB2 TABLE TPHYUNT.                                   *00130042
001400*                                                                *00140042
001500*    * LOCATION (STORE AND FACILITY) MUST BE ENTERED.            *00150042
001600*      LOCATION EDITS ------------------------------------------ *00160042
001700*      - STORE NUMBER MUST BE ON TABLE 'XIT_LOC'.                *00170051
001800*      - FACILITY MUST BE NUMERIC.                               *00180042
001900*    * IP ADDRESS RANGE (BEGIN AND END) AND/OR                   *00190042
002000*      VTAM (LINE AND UNIT) MUST ALSO BE ENTERED.                *00200042
002100*      IP ADDRESS RANGE EDITS (IF ENTERED) --------------------- *00210042
002200*      - IP ADDRESS OCTETS MUST BE NUMERIC AND EACH OCTET'S      *00220042
002300*        VALUE MUST BE 000-255 INCLUSIVE.                        *00230042
002400*      - THE ENDING IP ADDRESS MUST BE GREATER THAN OR           *00240042
002500*        EQUAL TO THE BEGINNING IP ADDRESS.                      *00250042
002600*      VTAM EDITS (IF ENTERED) --------------------------------- *00260042
002700*      - LINE MUST BE 2 POSITIONS.                               *00270042
002800*      - UNIT MUST BE 2 POSITIONS AND A VALID HEX VALUE.         *00280042
002900*----------------------------------------------------------------*00290042
      *    12/22/03  TKMA464   MADE CHANGES FOR EXPANDING LOCATION     *00291050
      *                        FROM 3 TO 5 DIGITS.                     *00292050
      *----------------------------------------------------------------*00293050
262023*  CHANGED 09/28/2021    BY JIM HUNTER      WR: CHG0262023      * 00294055
262023*  CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE  * 00295055
262023*  MAKING THE CALL DYNAMIC VS STATIC                            * 00296055
262023*---------------------------------------------------------------* 00297055
003000                                                                  00300042
003100                                                                  00310042
003200 ENVIRONMENT DIVISION.                                            00320042
003300                                                                  00330042
003400                                                                  00340042
003500 DATA DIVISION.                                                   00350042
003600                                                                  00360042
003700                                                                  00370042
003800 WORKING-STORAGE SECTION.                                         00380042
003900                                                                  00390042
004000 01  DK-DB2-KEYS.                                                 00400042
004100     15  DK-OPERATING-COMPANY           PIC  X(02)  VALUE SPACE.  00410042
004500     15  DK-LOC-NBR                     PIC S9(04)  VALUE ZERO    00450051
004600                                                    COMP.         00460042
004700     15  DK-FCLTY.                                                00470042
004800         20  DK-FCLTY-N                 PIC  9(03)  VALUE ZERO.   00480042
004900     15  DK-FCLTY-X                     PIC  X(03)  VALUE SPACE.  00490042
005000     15  DK-FCLTY-N4-COMP               PIC S9(04)  VALUE ZERO    00500042
005100                                                    COMP.         00510042
005200     15  DK-VTAM.                                                 00520042
005300         20  DK-LNE-ADDR-NBR            PIC  X(02)  VALUE SPACE.  00530042
005400         20  DK-PHYUNT-ADDR-NBR         PIC  X(02)  VALUE SPACE.  00540042
005500     15  DK-IP-ADDR-BEG                 PIC  X(15)  VALUE SPACE.  00550042
005600     15  DK-IP-ADDR-END                 PIC  X(15)  VALUE SPACE.  00560042
005700                                                                  00570042
005800 01  PC-PROGRAM-CONSTANTS.                                        00580042
005900     05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'DP053A  '.  00590042
006000     05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'DPKM053 '.  00600042
006100     05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'DPKCS053'.  00610042
006200     05  PC-MAX-RETRIES           PIC S9(04)  VALUE  +3           00620042
006300                                              COMP.               00630042
006400     05  PC-DOT                   PIC  X(01)  VALUE  '.'.         00640042
006500     05  PC-OPERATING-COMPANY     PIC  X(02)  VALUE  '03'.        00650042
006600     05  PC-INT-APPL-FORMAT-IND.                                  00660044
006700         10  PC-INT-APPL-LIST     PIC  X(01)  VALUE  'L'.         00670044
006800         10  PC-INT-APPL-UPD      PIC  X(01)  VALUE  'U'.         00680044
006900     05  PC-TSYMSG-NUMBERS.                                       00690044
007000         10  PC-TSYMSG-00005      PIC  9(05)  VALUE  00005.       00700044
007100         10  PC-TSYMSG-00007      PIC  9(05)  VALUE  00007.       00710044
007200         10  PC-TSYMSG-00008      PIC  9(05)  VALUE  00008.       00720042
007300         10  PC-TSYMSG-00017      PIC  9(05)  VALUE  00017.       00730042
007400         10  PC-TSYMSG-00052      PIC  9(05)  VALUE  00052.       00740042
007500         10  PC-TSYMSG-00059      PIC  9(05)  VALUE  00059.       00750042
007600         10  PC-TSYMSG-00068      PIC  9(05)  VALUE  00068.       00760042
007700         10  PC-TSYMSG-00069      PIC  9(05)  VALUE  00069.       00770042
007800         10  PC-TSYMSG-00070      PIC  9(05)  VALUE  00070.       00780042
007900         10  PC-TSYMSG-00148      PIC  9(05)  VALUE  00148.       00790042
008000         10  PC-TSYMSG-00223      PIC  9(05)  VALUE  00223.       00800042
008100         10  PC-TSYMSG-00224      PIC  9(05)  VALUE  00224.       00810042
008200         10  PC-TSYMSG-00388      PIC  9(05)  VALUE  00388.       00820042
008300         10  PC-TSYMSG-01176      PIC  9(05)  VALUE  01176.       00830042
008400         10  PC-TSYMSG-01177      PIC  9(05)  VALUE  01177.       00840042
008500         10  PC-TSYMSG-01282      PIC  9(05)  VALUE  01282.       00850042
008600         10  PC-TSYMSG-01283      PIC  9(05)  VALUE  01283.       00860042
008700         10  PC-TSYMSG-01285      PIC  9(05)  VALUE  01285.       00870042
008800     05  PC-VALID-OCTET-MIN       PIC  X(03)  VALUE  '000'.       00880042
008900     05  PC-VALID-OCTET-MAX       PIC  X(03)  VALUE  '255'.       00890042
009000     05  PC-VALIDATE-PHYU1        PIC  X(01)  VALUE  SPACE.       00900042
009100         88  PC-VALID-HEX-CHAR1               VALUE  '0', '1',    00910042
009200                                                     '2', '3',    00920042
009300                                                     '4', '5',    00930042
009400                                                     '6', '7',    00940042
009500                                                     '8', '9',    00950042
009600                                                     'A', 'B',    00960042
009700                                                     'C', 'D',    00970042
009800                                                     'E', 'F'.    00980042
009900     05  PC-VALIDATE-PHYU2        PIC  X(01)  VALUE  SPACE.       00990042
010000         88  PC-VALID-HEX-CHAR2               VALUE  '0', '1',    01000042
010100                                                     '2', '3',    01010042
010200                                                     '4', '5',    01020042
010300                                                     '6', '7',    01030042
010400                                                     '8', '9',    01040042
010500                                                     'A', 'B',    01050042
010600                                                     'C', 'D',    01060042
010700                                                     'E', 'F'.    01070042
010800     05  PC-LAST-ACTION.                                          01080042
010900         10  PC-LAST-ACTION-DEL   PIC  X(03)  VALUE  'DEL'.       01090042
011000         10  PC-LAST-ACTION-UPD   PIC  X(03)  VALUE  'UPD'.       01100042
011100         10  PC-LAST-ACTION-INQ   PIC  X(03)  VALUE  'INQ'.       01110042
011200         10  PC-LAST-ACTION-ERR   PIC  X(03)  VALUE  'ERR'.       01120042
011300                                                                  01130042
011400 01  PM-PROGRAM-MESSAGES.                                         01140042
011500     05  PM-ABEND-INFO-A.                                         01150042
011600         10  FILLER                PIC X(15)   VALUE              01160042
011700                                   'DP020-SRC-AID: '.             01170042
011800         10  PM-A-SRC-AID          PIC X(02)   VALUE  SPACE.      01180042
011900         10  FILLER                PIC X(19)   VALUE              01190042
012000                                   '. DP020-FK-ACTION: '.         01200042
012100         10  PM-A-FK-ACTION        PIC X(01)   VALUE  SPACE.      01210042
012200         10  FILLER                PIC X(22)   VALUE              01220042
012300                                   '. DP020-FK-DISPN-IND: '.      01230042
012400         10  PM-A-FK-DISPN         PIC X(01)   VALUE  SPACE.      01240042
012500         10  FILLER                PIC X(01)   VALUE '.'.         01250042
012600         10  FILLER                PIC X(19)   VALUE SPACE.       01260042
012700                                                                  01270042
012800     05  PM-ABEND-KEYFIELDS.                                      01280042
012900         10  FILLER                PIC X(14)   VALUE              01290042
013000                                   'LNE-ADDR-NBR: '.              01300042
013100         10  PM-ABEND-KEYFIELD1    PIC X(02)   VALUE  SPACE.      01310042
013200         10  FILLER                PIC X(02)   VALUE  ', '.       01320042
013300         10  FILLER                PIC X(17)   VALUE              01330042
013400                                   'PHYUNT-ADDR-NBR: '.           01340042
013500         10  PM-ABEND-KEYFIELD2    PIC X(02)   VALUE  SPACE.      01350042
013600         10  FILLER                PIC X(01)   VALUE  '.'.        01360042
013700                                                                  01370042
013800     05  PM-ABEND-RANGES.                                         01380042
013900         10  FILLER                PIC X(17)   VALUE              01390042
014000                                   'BEG-RNG-IP-ADDR: '.           01400042
014100         10  PM-ABEND-RANGE-B      PIC X(15)   VALUE  SPACE.      01410042
014200         10  FILLER                PIC X(02)   VALUE  ', '.       01420042
014300         10  FILLER                PIC X(17)   VALUE              01430042
014400                                   'END-RNG-IP-ADDR: '.           01440042
014500         10  PM-ABEND-RANGE-E      PIC X(15)   VALUE  SPACE.      01450042
014600         10  FILLER                PIC X(01)   VALUE  '.'.        01460042
014700                                                                  01470042
014800 01  PS-PROGRAM-SWITCHES.                                         01480042
014900     05  PS-ERROR-SW              PIC  X(01)  VALUE  'N'.         01490042
015000         88  PS-ERROR                         VALUE  'Y'.         01500042
015100         88  PS-NO-ERROR                      VALUE  'N'.         01510042
015200                                                                  01520042
015300 01  PV-PROGRAM-VARIABLES.                                        01530042
015400     05  PV-CICS-RESPONSE         PIC S9(04)  VALUE +0            01540042
015500                                              COMP SYNC.          01550042
015600     05  PV-RETRY-COUNTER         PIC S9(04)  VALUE +0            01560042
015700                                              COMP SYNC.          01570042
015800     05  PV-MSG-VAR-CNT           PIC S9(04)  VALUE +0            01580042
015900                                              COMP SYNC.          01590042
016000     05  PV-COUNT-OVERLAP-IP-ADDR PIC S9(09)  VALUE +0            01600042
016100                                              COMP SYNC.          01610042
016200     05  PV-COUNT-DUPLICATE-VTAM  PIC S9(09)  VALUE +0            01620042
016300                                              COMP SYNC.          01630042
016400                                                                  01640042
016500**--------------------------------------------------------------**01650042
016600** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **01660042
016700** SUB-ROUTINE (DPKUT100).                                      **01670042
016800**--------------------------------------------------------------**01680042
016900     COPY DPWS010I.                                               01690042
017000                                                                  01700042
017100                                                                  01710042
017200*---------------------------------------------------------------**01720042
017300*  THE LAYOUT FOR THE TEMPORARY STORAGE QUEUE CONTAINING        **01730042
017400*  SELECTED LIST ITEMS TO BE PROCESSED BY THIS PROGRAM.         **01740042
017500*---------------------------------------------------------------**01750042
017600     COPY DPWS252.                                                01760042
017700                                                                  01770042
017800                                                                  01780042
017900*----------------------------------------------------------------*01790042
018000*    MAP LAYOUT                                                  *01800042
018100*----------------------------------------------------------------*01810042
018200     COPY DPKM053.                                                01820042
018300                                                                  01830042
018400*----------------------------------------------------------------*01840042
018500*    ATTRIBUTE SETTINGS COPYBOOK.                                *01850042
018600*----------------------------------------------------------------*01860042
018700     COPY DPWS015.                                                01870042
018800                                                                  01880042
018900*----------------------------------------------------------------*01890042
019000*    FUNCTION KEYS COPYBOOK                                      *01900042
019100*----------------------------------------------------------------*01910042
019200     COPY DPWS016.                                                01920042
019300                                                                  01930042
      *----------------------------------------------------------------*01940057
      *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.           *01950057
      *----------------------------------------------------------------*01960057
                                                                        01970056
           COPY DPWS030.                                                01971056
           COPY DPWS930.                                                01972056
019800                                                                  01980042
019900***************************************************************** 01990042
020000*    ARCHITECTURE COMMAREAS: 4072 MAX LENGTH TOTAL                02000042
020100*    * GLOBAL COMMAREA:      1265 BYTES, COPY BOOK DPWS020        02010042
020200*    * INTER-APPLICATION:     200 BYTES, TEMPORARY!               02020042
020300*    * APPLICATION SPECIFIC: 2865 BYTES MAX                       02030042
020400***************************************************************** 02040042
020500                                                                  02050042
020600***************************************************************** 02060042
020700*    STANDARD COMMAREA.                                           02070042
020800***************************************************************** 02080042
020900     COPY DPWS020.                                                02090042
021000     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02100042
021100                                                                  02110042
021200***************************************************************** 02120042
021300*    INTER-APPLICATION COMMAREA.                                  02130042
021400***************************************************************** 02140042
021500         10  INTER-APPL-COMM-AREA PIC X(200).                     02150042
021600     COPY DPWS250.                                                02160042
021700     COPY DPWS251.                                                02170042
021800                                                                  02180042
021900***************************************************************** 02190042
022000*    SPECIFIC COMMMAREA FOR DPKCS053.                             02200042
022100***************************************************************** 02210042
022200         10  ASC-SPECIFIC-COMMAREA.                               02220042
022300*            **************************************************** 02230042
022400*            * SCREEN FIELDS:                                     02240042
022500*            **************************************************** 02250042
022600             15  ASC-SCREEN.                                      02260042
022700                 20  ASC-LOCATION.                                02270042
022800                     25  ASC-LOC-X.                               02280051
022900                         30  ASC-LOC-NBR     PIC  9(05).          02290051
023000                     25  ASC-FCLTY.                               02300042
023100                         30  ASC-FCLTY-N     PIC  9(04).          02310042
023200                 20  ASC-VTAM.                                    02320042
023300                     25  ASC-LINE.                                02330042
023400                         30  ASC-LINE1       PIC  X(01).          02340042
023500                         30  ASC-LINE2       PIC  X(01).          02350042
023600                     25  ASC-PHYSICAL-UNIT.                       02360042
023700                         30  ASC-PHYSICAL-UNIT1                   02370042
023800                                             PIC  X(01).          02380042
023900                         30  ASC-PHYSICAL-UNIT2                   02390042
024000                                             PIC  X(01).          02400042
024100                 20  ASC-IP-ADDR-RANGE.                           02410042
024200                     25  ASC-IP-ADDR-BEGIN.                       02420042
024300                         30  ASC-IP-ADDR-B-OCTET1.                02430042
024400                             35  ASC-IP-ADDR-B-OCTET1-N           02440042
024500                                             PIC  9(03).          02450042
024600                         30  ASC-IP-ADDR-B-DOT1                   02460042
024700                                             PIC  X(01).          02470042
024800                         30  ASC-IP-ADDR-B-OCTET2.                02480042
024900                             35  ASC-IP-ADDR-B-OCTET2-N           02490042
025000                                             PIC  9(03).          02500042
025100                         30  ASC-IP-ADDR-B-DOT2                   02510042
025200                                             PIC  X(01).          02520042
025300                         30  ASC-IP-ADDR-B-OCTET3.                02530042
025400                             35  ASC-IP-ADDR-B-OCTET3-N           02540042
025500                                             PIC  9(03).          02550042
025600                         30  ASC-IP-ADDR-B-DOT3                   02560042
025700                                             PIC  X(01).          02570042
025800                         30  ASC-IP-ADDR-B-OCTET4.                02580042
025900                             35  ASC-IP-ADDR-B-OCTET4-N           02590042
026000                                             PIC  9(03).          02600042
026100                     25  ASC-IP-ADDR-END.                         02610042
026200                         30  ASC-IP-ADDR-E-OCTET1.                02620042
026300                             35  ASC-IP-ADDR-E-OCTET1-N           02630042
026400                                             PIC  9(03).          02640042
026500                         30  ASC-IP-ADDR-E-DOT1                   02650042
026600                                             PIC  X(01).          02660042
026700                         30  ASC-IP-ADDR-E-OCTET2.                02670042
026800                             35  ASC-IP-ADDR-E-OCTET2-N           02680042
026900                                             PIC  9(03).          02690042
027000                         30  ASC-IP-ADDR-E-DOT2                   02700042
027100                                             PIC  X(01).          02710042
027200                         30  ASC-IP-ADDR-E-OCTET3.                02720042
027300                             35  ASC-IP-ADDR-E-OCTET3-N           02730042
027400                                             PIC  9(03).          02740042
027500                         30  ASC-IP-ADDR-E-DOT3                   02750042
027600                                             PIC  X(01).          02760042
027700                         30  ASC-IP-ADDR-E-OCTET4.                02770042
027800                             35  ASC-IP-ADDR-E-OCTET4-N           02780042
027900                                             PIC  9(03).          02790042
028000*            **************************************************** 02800042
028100*            * CURRENT RECORD, BEFORE UPDATES:                    02810042
028200*            **************************************************** 02820042
028300             15  ASC-DKC-CURRENT-ROW-DB2-KEYS.                    02830042
028400                 20  ASC-DKC-OPERATING-COMPANY                    02840042
028500                                             PIC  X(02).          02850042
028900                 20  ASC-DKC-LOC-NBR         PIC S9(04)     COMP. 02890051
029000                 20  ASC-DKC-FCLTY.                               02900042
029100                     25  ASC-DKC-FCLTY-N                          02910042
029200                                             PIC  9(03).          02920042
029300                 20  ASC-DKC-FCLTY-X         PIC  X(03).          02930042
029400                 20  ASC-DKC-FCLTY-N4-COMP                        02940042
029500                                             PIC S9(04)     COMP. 02950042
029600                 20  ASC-DKC-VTAM.                                02960042
029700                     25  ASC-DKC-LNE-ADDR-NBR                     02970042
029800                                             PIC  X(02).          02980042
029900                     25  ASC-DKC-PHYUNT-ADDR-NBR                  02990042
030000                                             PIC  X(02).          03000042
030100                 20  ASC-DKC-IP-ADDR-BEG     PIC  X(15).          03010042
030200                 20  ASC-DKC-IP-ADDR-END     PIC  X(15).          03020042
030300                                                                  03030042
030400*            **************************************************** 03040042
030500*            *   TEMPORARY STORAGE QUEUE                          03050042
030600*            **************************************************** 03060042
030700             15  ASC-TSQ.                                         03070042
030800                 20  ASC-USE-SELECTION-QUEUE-IND                  03080042
030900                                           PIC  X(01).            03090042
031000                     88  ASC-USE-SELECTION-QUEUE       VALUE 'Y'. 03100042
031100                 20  ASC-SEL-QUEUE-NAME    PIC  X(08).            03110042
031200                 20  ASC-NUMBER-OF-TS-ITEMS                       03120042
031300                                           PIC S9(05)  COMP-3.    03130042
031400                 20  ASC-NUMBER-OF-SELECTED-ITEMS                 03140042
031500                                           PIC S9(09)  COMP-3.    03150042
031600                 20  ASC-SEL-SUB           PIC S9(04)  COMP.      03160042
031700                 20  ASC-SEL-ITEM          PIC S9(04)  COMP.      03170042
031900                                                                  03190042
032000*----------------------------------------------------------------*03200042
032100*    ABEND PROCESSING COPYBOOK.                                  *03210042
032200*----------------------------------------------------------------*03220042
032300     COPY DPWS013.                                                03230042
032400                                                                  03240042
032500******************************************************************03250042
032600*    DB2 AREA AND COBOL DECLARATIONS FOR TABLE:                  *03260042
032700*    XIT_LOC (LOCATION TABLE)                                    *03270051
032800******************************************************************03280042
032900     EXEC SQL                                                     03290042
033000          INCLUDE XIT00000                                        03300051
033100     END-EXEC.                                                    03310042
033200                                                                  03320042
033300******************************************************************03330042
033400*    DB2 AREA AND COBOL DECLARATIONS FOR TABLE:                  *03340042
033500*    TPHYUNT (PHYSICAL UNIT TABLE)                               *03350042
033600******************************************************************03360042
033700     EXEC SQL                                                     03370042
033800          INCLUDE TPHYUNT                                         03380042
033900     END-EXEC.                                                    03390042
034000                                                                  03400042
034100******************************************************************03410042
034200*    DB2 AREA FOR COMMUNICATIONS:                                *03420042
034300******************************************************************03430042
034400     EXEC SQL                                                     03440042
034500          INCLUDE SQLCA                                           03450042
034600     END-EXEC.                                                    03460042
034700                                                                  03470042
034800                                                                  03480042
034900 LINKAGE SECTION.                                                 03490042
035000                                                                  03500042
035100 01  DFHCOMMAREA.                                                 03510042
035200     05  FILLER                         OCCURS  1 TO 4072 TIMES   03520042
035300                                        DEPENDING ON EIBCALEN.    03530042
035400         10  FILLER                     PIC  X(01).               03540042
035500                                                                  03550042
035600                                                                  03560042
035700 PROCEDURE DIVISION.                                              03570042
035800***************************************************************** 03580042
035900** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 03590042
036000** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 03600042
036100** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 03610042
036200**                                                             ** 03620042
036300** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 03630042
036400** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 03640042
036500***************************************************************** 03650042
036600 0000-MAIN-MODULE.                                                03660042
036700     INITIALIZE DP030-CICS-API-FIELDS.                            03670042
036800     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03680042
036900     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03690042
037000     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03700042
037100     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03710042
037200     MOVE LENGTH OF DP053AI        TO DP030-MAP-LENGTH (1).       03720042
037300     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03730042
037400     PERFORM 0001-CALL-CICS-ARCH-API.                             03740042
037500                                                                  03750042
037600     PERFORM 1000-CONTROL-PROCESSING                              03760042
037700                                                                  03770042
037800     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03780042
037900     PERFORM 0001-CALL-CICS-ARCH-API.                             03790042
038000                                                                  03800042
038100 0001-CALL-CICS-ARCH-API.                                         03810042
038200     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03820058
038300                                    DFHCOMMAREA                   03830058
038400                                    DP030-CICS-API-FIELDS         03840058
038500                                    DP020-STANDARD-COMMAREA       03850058
038600                                    DP053AI.                      03860058
038700                                                                  03870042
038800     IF  DP030-RC-CALL-SUCCESSFUL                                 03880042
038900         CONTINUE                                                 03890042
039000     ELSE                                                         03900042
039100         SET DP013-NO-ROLLBACK                                    03910042
039200             DP013-XCTL-DISPLAY-RESTART                           03920042
039300             DP013-CICS-ABEND      TO TRUE                        03930042
039400         MOVE 'BEFORE 0000-MAIN-MODULE'                           03940042
039500                                   TO DP013-PARAGRAPH             03950042
039600         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O03960059
039700-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      03970059
039800         MOVE DP030-RETURN-CODE                                   03980042
039900                                   TO DP013-MESSAGE-TEXT (3)      03990042
040000         PERFORM DP013-0000-PROCESS-ABEND                         04000042
040100     END-IF.                                                      04010042
040200                                                                  04020042
040300*----------------------------------------------------------------*04030042
040400*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *04040042
040500*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *04050042
040600*----------------------------------------------------------------*04060042
040700 1000-CONTROL-PROCESSING.                                         04070042
040800                                                                  04080042
040900     EVALUATE TRUE                                                04090042
041000         WHEN DP020-NEXT-ACT-INITIAL                              04100042
041100*            *****************************************************04110042
041200*            * NEXT ACT: INITIAL                                 *04120042
041300*            *****************************************************04130042
041400             PERFORM 1100-FIND-OBJECT-KEYS                        04140042
041500              IF  PS-ERROR                                        04150042
041600                  CONTINUE                                        04160042
041700              ELSE                                                04170042
041800                  PERFORM 4000-BUILD-INITIAL-PANEL                04180042
041900                  IF  SQLCODE = +100                              04190042
042000                      SET DP020-NEXT-ACT-APPL-ERROR TO TRUE       04200042
042100*                     ---- DATA DOES NOT EXIST                    04210042
042200                      MOVE PC-TSYMSG-00148                        04220042
042300                                   TO DP020-MSG-NUMBER            04230042
042400                      SET DP020-MSG-INFORMATIONAL TO TRUE         04240042
042500                  END-IF                                          04250042
042600              END-IF                                              04260042
042700                                                                  04270042
042800         WHEN DP020-NEXT-ACT-READ-MAP                             04280042
042900*            *****************************************************04290042
043000*            * NEXT ACT: READ MAP                                *04300042
043100*            *****************************************************04310042
043200             PERFORM 2000-PROCESS-PANEL                           04320042
043300                                                                  04330042
043400         WHEN DP020-NEXT-ACT-RETURN                               04340042
043500*            *****************************************************04350042
043600*            * NEXT ACT: RETURN                                  *04360042
043700*            *****************************************************04370042
043800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04380042
043900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04390042
044000                                                                  04400042
044100         WHEN OTHER                                               04410042
044200*            *****************************************************04420042
044300*            * NEXT ACT: OTHER (UNDEFINED)                       *04430042
044400*            *****************************************************04440042
044500             SET DP013-LOGIC-ABEND                                04450042
044600                 DP013-NO-ROLLBACK TO TRUE                        04460042
044700             MOVE '1000-CONTROL-PROCESSING'                       04470042
044800                                   TO DP013-PARAGRAPH             04480042
044900             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   04490042
045000                                   TO DP013-MESSAGE-TEXT(1)       04500042
045100             MOVE DP020-NEXT-APPL-ACTIVITY                        04510042
045200                                   TO DP013-MESSAGE-TEXT(2)       04520042
045300             PERFORM DP013-0000-PROCESS-ABEND                     04530042
045400     END-EVALUATE.                                                04540042
045500                                                                  04550042
045600                                                                  04560042
045700******************************************************************04570042
045800** DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE   **04580042
045900** INTER-APPLICATION FORMAT CODE.                               **04590042
046000** FOR THIS PROGRAM, ENTRY WILL ALWAYS BE FROM THE "LIST" -OR-  **04600044
046100** THE "UPDATE".                                                **04610044
046200******************************************************************04620042
046300 1100-FIND-OBJECT-KEYS.                                           04630042
046400                                                                  04640044
046500     EVALUATE DP020-INT-APPL-FORMAT-IND                           04650044
046600         WHEN PC-INT-APPL-UPD                                     04660045
046700*            *---------------------------------------------------*04670044
046800*            * UPDATE. (SUBSEQUENT UPDATE ON THIS SAME ITEM)     *04680044
046900*            *---------------------------------------------------*04690044
047000             CONTINUE                                             04700044
047100                                                                  04710044
047200         WHEN OTHER                                               04720044
047300*            *---------------------------------------------------*04730044
047400*            * DEFAULT IS "LIST".                                *04740044
047500*            * (ENTERED THIS PROGRAM FROM THE LIST PGM)          *04750044
047600*            *---------------------------------------------------*04760044
047700             SET ASC-USE-SELECTION-QUEUE TO TRUE                  04770044
047800             MOVE DP251-NUMBER-OF-SELECTED-ITEMS                  04780044
047900                                 TO ASC-NUMBER-OF-SELECTED-ITEMS  04790044
048000             MOVE DP251-NUMBER-OF-TS-ITEMS                        04800044
048100                                 TO ASC-NUMBER-OF-TS-ITEMS        04810044
048200             MOVE DP251-SEL-QUEUE-NAME                            04820044
048300                                 TO ASC-SEL-QUEUE-NAME            04830044
048400             PERFORM 1120-PREPARE-LIST-ENTRY                      04840044
048500                                                                  04850044
048600     END-EVALUATE.                                                04860044
048700                                                                  04870042
048800                                                                  04880042
048900*----------------------------------------------------------------*04890042
049000* ENTRY IS FROM A LIST.  GET THE PHYSICAL UNIT FROM THE TEMP     *04900042
049100* STORAGE QUEUE PASSED FROM THE LIST PROGRAM.                    *04910042
049200*----------------------------------------------------------------*04920042
049300 1120-PREPARE-LIST-ENTRY.                                         04930042
049400     MOVE DP252-MAX-ITEMS          TO ASC-SEL-SUB.                04940042
049500     MOVE ZERO                     TO ASC-SEL-ITEM.               04950042
049600     PERFORM 2120-GET-NEXT-FROM-TS-QUEUE.                         04960042
049700                                                                  04970042
049800*----------------------------------------------------------------*04980042
049900* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*04990042
050000* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*05000042
050100* EDITS.                                                         *05010042
050200*----------------------------------------------------------------*05020042
050300 2000-PROCESS-PANEL.                                              05030042
050400                                                                  05040042
050500     EVALUATE TRUE                                                05050042
050600                                                                  05060042
050700         WHEN DP020-SRC-AID = DP016-CLEAR                         05070042
050800*            *****************************************************05080042
050900*            * PFKEY ACTION: CLEAR                         <ESC> *05090042
051000*            *   <CLEAR> ("ESC" KEY)                             *05100042
051100*            *                                                   *05110042
051200*            * PRESENT SCREEN AS IT WAS AT THE TIME OF THE LAST  *05120042
051300*            * <ENTER>, INCLUDING ANY ERROR MESSAGES.            *05130042
051400*            *****************************************************05140042
051500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05150042
051600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05160042
051700                                                                  05170042
051800         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     05180042
051900*            *****************************************************05190042
052000*            * PFKEY ACTION: REFRESH                             *05200042
052100*            *                                                   *05210042
052200*            * PRESENT SCREEN AS FOLLOWS:                        *05220042
052300*            * - BRING BACK WHAT WAS LAST SAVED.                 *05230042
052400*            * - SHOW SCREEN AS ORIGINALLY PRESENTED WITH DATA   *05240042
052500*            *   FROM DATABASE, AS SELECTED ON "LIST").          *05250042
052600*            *****************************************************05260042
052700*            INITIALIZE ASC-SPECIFIC-COMMAREA                     05270042
052800             INITIALIZE ASC-SCREEN                                05280042
052900             PERFORM 1100-FIND-OBJECT-KEYS                        05290042
053000             PERFORM 4000-BUILD-INITIAL-PANEL                     05300042
053100             PERFORM 3200-RESET-ATTRIBUTES                        05310042
053200                                                                  05320042
053300         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             05330042
053400*        *-------------------------------------------------------*05340042
053500*        *   GET NEXT SELECTION FROM TS QUEUE                    *05350042
053600*        *-------------------------------------------------------*05360042
053700             IF  ASC-USE-SELECTION-QUEUE                          05370042
053800                 INITIALIZE DCLTPHYUNT                            05380042
053900*                INITIALIZE ASC-SPECIFIC-COMMAREA                 05390042
054000                 INITIALIZE ASC-SCREEN                            05400042
054100                 PERFORM 2120-GET-NEXT-FROM-TS-QUEUE              05410042
054200                 PERFORM 4000-BUILD-INITIAL-PANEL                 05420042
054300                 PERFORM 3200-RESET-ATTRIBUTES                    05430042
054400             ELSE                                                 05440042
054500*                ---- BOTTOM OF LIST                              05450042
054600                 MOVE PC-TSYMSG-00070                             05460042
054700                                   TO DP020-MSG-NUMBER            05470042
054800                 SET DP020-MSG-INFORMATIONAL                      05480042
054900                                   TO TRUE                        05490042
055000             END-IF                                               05500042
055100*                                                                 05510042
055200         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             05520042
055300*        *-------------------------------------------------------*05530042
055400*        *   GET PREV SELECTION FROM TS QUEUE                    *05540042
055500*        *-------------------------------------------------------*05550042
055600             IF  ASC-USE-SELECTION-QUEUE                          05560042
055700                 INITIALIZE DCLTPHYUNT                            05570042
055800*                INITIALIZE ASC-SPECIFIC-COMMAREA                 05580042
055900                 INITIALIZE ASC-SCREEN                            05590042
056000                 PERFORM 2130-GET-PREV-FROM-TS-QUEUE              05600042
056100                 PERFORM 4000-BUILD-INITIAL-PANEL                 05610042
056200                 PERFORM 3200-RESET-ATTRIBUTES                    05620042
056300             ELSE                                                 05630042
056400*                ---- TOP OF LIST                                 05640042
056500                 MOVE PC-TSYMSG-00069                             05650042
056600                                   TO DP020-MSG-NUMBER            05660042
056700                 SET DP020-MSG-INFORMATIONAL                      05670042
056800                                   TO TRUE                        05680042
056900             END-IF                                               05690042
057000*                                                                 05700042
057100         WHEN OTHER                                               05710042
057200*            *****************************************************05720042
057300*            * PFKEY ACTION: OTHER (APPLICATION SPECIFIC)        *05730042
057400*            *****************************************************05740042
057500             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 05750042
057600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05760042
057700             IF  PS-NO-ERROR                                      05770042
057800                 PERFORM 2100-CHECK-FUNCTION-KEY                  05780042
057900                 SET DP030-CONTINUE-GO TO TRUE                    05790042
058000             ELSE                                                 05800042
058100                 SET DP030-OVERRIDE-GO TO TRUE                    05810042
058200             END-IF                                               05820042
058300     END-EVALUATE.                                                05830042
058400                                                                  05840042
058500                                                                  05850042
058600******************************************************************05860042
058700** ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **05870042
058800** FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **05880042
058900** FROM THE CICS ARCHITECTURE API.                              **05890042
059000******************************************************************05900042
059100 2100-CHECK-FUNCTION-KEY.                                         05910042
059200     EVALUATE TRUE                                                05920042
059300                                                                  05930042
059400         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              05940042
059500*            *****************************************************05950042
059600*            * APPLICATION-SPECIFIC PFKEY: LOCAL 01:  UPDATE     *05960042
059700*            *****************************************************05970042
059800             SET DP030-CONTINUE-GO TO TRUE                        05980042
059900             PERFORM 5000-POPULATE-PHYUNT-FIELDS                  05990042
060000             PERFORM 5100-UPDATE-ROW-ON-TABLE                     06000042
060100             IF PS-ERROR                                          06010042
060200                 CONTINUE                                         06020042
060300             ELSE                                                 06030042
060400*                ---- UPDATES SUCCESSFUL                          06040042
060500                 MOVE PC-INT-APPL-UPD  TO                         06050045
060600                                       DP020-INT-APPL-FORMAT-IND  06060044
060700                 MOVE PC-TSYMSG-00059  TO DP020-MSG-NUMBER        06070044
060800                 SET DP020-MSG-INFORMATIONAL                      06080042
060900                                       TO TRUE                    06090042
061000                 PERFORM 5200-UPDATE-SELECTION-QUEUE              06100042
061100             END-IF                                               06110042
061200                                                                  06120042
061300         WHEN DP020-SRC-AID = DP016-ENTER                         06130042
061400*            *****************************************************06140042
061500*            * APPLICATION-SPECIFIC PFKEY: <ENTER>               *06150042
061600*            *   EDIT DATA AND PRESENT IT ON THE SCREEN          *06160042
061700*            *****************************************************06170042
061800             CONTINUE                                             06180042
061900                                                                  06190042
062000         WHEN OTHER                                               06200042
062100*            *****************************************************06210042
062200*            * APPLICATION-SPECIFIC PFKEY: "OTHER" (UNDEFINED)   *06220042
062300*            *****************************************************06230042
062400             SET DP013-NO-ROLLBACK                                06240042
062500                 DP013-XCTL-DISPLAY-RESTART                       06250042
062600                 DP013-CICS-ABEND  TO TRUE                        06260042
062700             MOVE '2100-CHECK-FUNCTION-KEY'                       06270042
062800                                   TO DP013-PARAGRAPH             06280042
062900             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      06290042
063000                                   TO DP013-MESSAGE-TEXT (1)      06300042
063100             MOVE 'OR CODE MISSING FROM THIS PROGRAM TO PROCESS:' 06310042
063200                                   TO DP013-MESSAGE-TEXT (2)      06320042
063300             MOVE DP020-SRC-AID    TO PM-A-SRC-AID                06330042
063400             MOVE DP020-FK-ACTION (DP020-SRC-AID)                 06340042
063500                                   TO PM-A-FK-ACTION              06350042
063600             MOVE DP020-FK-DISPN-IND (DP020-SRC-AID)              06360042
063700                                   TO PM-A-FK-DISPN               06370042
063800             MOVE PM-ABEND-INFO-A  TO DP013-MESSAGE-TEXT (3)      06380042
063900             MOVE 'REVIEW PFKEYS SETUP FOR THIS MNEMONIC.'        06390042
064000                                   TO DP013-MESSAGE-TEXT (4)      06400042
064100             PERFORM DP013-0000-PROCESS-ABEND                     06410042
064200     END-EVALUATE.                                                06420042
064300                                                                  06430042
064400******************************************************************06440042
064500** GET NEXT DATA KEY FROM THE TEMPORARY STORAGE QUEUE OF        **06450042
064600** SELECTED ITEMS (SELECTED BY THE USER IN THE LIST PROGRAM).   **06460042
064700******************************************************************06470042
064800 2120-GET-NEXT-FROM-TS-QUEUE.                                     06480042
064900     ADD +1                        TO ASC-SEL-SUB.                06490042
065000     IF  ASC-SEL-SUB > DP252-MAX-ITEMS                            06500042
065100         ADD +1                    TO ASC-SEL-ITEM                06510042
065200         MOVE +1                   TO ASC-SEL-SUB                 06520042
065300     END-IF.                                                      06530042
065400     IF  ASC-SEL-ITEM <= ASC-NUMBER-OF-TS-ITEMS                   06540042
065500         PERFORM 9100-READ-SEL-QUEUE                              06550042
065600         IF  DP252-ITEM (ASC-SEL-SUB) > ZERO                      06560042
065700             PERFORM 2140-MOVE-SEL-QUEUE-TO-ASC                   06570042
065800             IF (DP252-ACTION-SW (ASC-SEL-SUB) NOT EQUAL          06580042
065900                                               PC-LAST-ACTION-DEL 06590042
066000             AND DP252-ACTION-SW (ASC-SEL-SUB) NOT EQUAL          06600042
066100                                               PC-LAST-ACTION-UPD 06610042
066200             AND DP252-ACTION-SW (ASC-SEL-SUB) NOT EQUAL          06620042
066300                                               PC-LAST-ACTION-INQ 06630042
066400             AND DP252-ACTION-SW (ASC-SEL-SUB) NOT EQUAL          06640042
066500                                               PC-LAST-ACTION-ERR)06650042
066600                 SET DP252-INQ (ASC-SEL-SUB)                      06660042
066700                                   TO TRUE                        06670042
066800             END-IF                                               06680042
066900             PERFORM 9200-REWRITE-SEL-QUEUE                       06690042
067000         ELSE                                                     06700042
067100             SUBTRACT +1 FROM ASC-SEL-SUB                         06710042
067200*            ---- BOTTOM OF LIST                                  06720042
067300             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            06730042
067400             SET DP020-MSG-INFORMATIONAL                          06740042
067500                                   TO TRUE                        06750042
067600         END-IF                                                   06760042
067700     ELSE                                                         06770042
067800         SUBTRACT +1 FROM ASC-SEL-ITEM                            06780042
067900         MOVE DP252-MAX-ITEMS      TO ASC-SEL-SUB                 06790042
068000*        ---- BOTTOM OF LIST                                      06800042
068100         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            06810042
068200         SET DP020-MSG-INFORMATIONAL                              06820042
068300                                   TO TRUE                        06830042
068400     END-IF.                                                      06840042
068500                                                                  06850042
068600                                                                  06860042
068700******************************************************************06870042
068800** GET PREV STMT ISRT KEY FROM THE TEMPORARY STORAGE QUEUE OF   **06880042
068900** SELECTED ITEMS (SELECTED BY THE USER IN THE LIST PROGRAM).   **06890042
069000******************************************************************06900042
069100 2130-GET-PREV-FROM-TS-QUEUE.                                     06910042
069200     SUBTRACT +1 FROM ASC-SEL-SUB.                                06920042
069300     IF  ASC-SEL-SUB < +1                                         06930042
069400         SUBTRACT +1 FROM ASC-SEL-ITEM                            06940042
069500         MOVE DP252-MAX-ITEMS      TO ASC-SEL-SUB                 06950042
069600     END-IF.                                                      06960042
069700*                                                                 06970042
069800     IF  ASC-SEL-ITEM > ZERO                                      06980042
069900         PERFORM 9100-READ-SEL-QUEUE                              06990042
070000         PERFORM 2140-MOVE-SEL-QUEUE-TO-ASC                       07000042
070100     ELSE                                                         07010042
070200         MOVE +1                   TO ASC-SEL-ITEM                07020042
070300                                      ASC-SEL-SUB                 07030042
070400*        ---- TOP OF LIST                                         07040042
070500         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            07050042
070600         SET DP020-MSG-INFORMATIONAL                              07060042
070700                                   TO TRUE                        07070042
070800     END-IF.                                                      07080042
070900                                                                  07090042
071000                                                                  07100042
071100******************************************************************07110042
071200*  MOVE FIELDS FROM THE TEMPORARY STORAGE QUEUE OF SELECTED ITEMS*07120042
071300*  TO THE APPLICATION SPECIFIC COMMAREA FOR PROCESSING,          *07130042
071400*  TO THE DATAKEY AREA FOR DB2 TABLE ACCESS, AND                 *07140042
071500*  TO THE DATAKEY-CURRENT AREA FOR ADDITIONAL DB2 TABLE ACCESS.  *07150042
071600******************************************************************07160042
071700 2140-MOVE-SEL-QUEUE-TO-ASC.                                      07170042
071800     MOVE DP252-LOCATION-NBR (ASC-SEL-SUB)                        07180052
071900                                   TO ASC-LOC-NBR                 07190051
072100                                      DK-LOC-NBR                  07210051
072300                                      ASC-DKC-LOC-NBR.            07230051
072700     MOVE DP252-FCLTY-N (ASC-SEL-SUB)                             07270042
072800                                   TO ASC-FCLTY-N                 07280042
072900                                      DK-FCLTY-N                  07290042
073000                                      DK-FCLTY-N4-COMP            07300042
073100                                      ASC-DKC-FCLTY-N             07310042
073200                                      ASC-DKC-FCLTY-N4-COMP.      07320042
073300     MOVE DP252-FCLTY (ASC-SEL-SUB)                               07330042
073400                                   TO DK-FCLTY-X                  07340042
073500                                      ASC-DKC-FCLTY-X.            07350042
073600     MOVE DP252-LNE-ADDR-NBR (ASC-SEL-SUB)                        07360042
073700                                   TO ASC-LINE                    07370042
073800                                      DK-LNE-ADDR-NBR             07380042
073900                                      ASC-DKC-LNE-ADDR-NBR.       07390042
074000     MOVE DP252-PHYSICAL-UNIT (ASC-SEL-SUB)                       07400042
074100                                   TO ASC-PHYSICAL-UNIT           07410042
074200                                      DK-PHYUNT-ADDR-NBR          07420042
074300                                      ASC-DKC-PHYUNT-ADDR-NBR.    07430042
074400     MOVE DP252-IP-ADDR-BEG (ASC-SEL-SUB)                         07440042
074500                                   TO ASC-IP-ADDR-BEGIN           07450042
074600                                      DK-IP-ADDR-BEG              07460042
074700                                      ASC-DKC-IP-ADDR-BEG.        07470042
074800     MOVE DP252-IP-ADDR-END (ASC-SEL-SUB)                         07480042
074900                                   TO ASC-IP-ADDR-END             07490042
075000                                      DK-IP-ADDR-END              07500042
075100                                      ASC-DKC-IP-ADDR-END.        07510042
075200                                                                  07520042
075300                                                                  07530042
075400*----------------------------------------------------------------*07540042
075500* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*07550042
075600* THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *07560042
075700* APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *07570042
075800*----------------------------------------------------------------*07580042
075900 2200-MOVE-SCREEN-TO-COMMAREA.                                    07590042
076000*    *************************************************************07600042
076100*    * LOCATION: STORE                                           *07610042
076200*    *************************************************************07620042
076300     IF  ASTORL > ZERO                                            07630042
076400         MOVE ASTORI               TO ASC-LOC-X                   07640051
076500     ELSE                                                         07650042
076600         IF  ASTORF = DP015-ERASE-EOF                             07660042
076700             MOVE SPACE            TO ASC-LOC-X                   07670051
076800         END-IF                                                   07680042
076900     END-IF.                                                      07690042
077000                                                                  07700042
077100*    *************************************************************07710042
077200*    * LOCATION: FACILITY                                        *07720042
077300*    *************************************************************07730042
077400     IF  AFCLTL > ZERO                                            07740042
077500         MOVE AFCLTI               TO ASC-FCLTY                   07750042
077600     ELSE                                                         07760042
077700         IF  AFCLTF = DP015-ERASE-EOF                             07770042
077800             MOVE SPACE            TO ASC-FCLTY                   07780042
077900         END-IF                                                   07790042
078000     END-IF.                                                      07800042
078100                                                                  07810042
078200*    *************************************************************07820042
078300*    * VTAM:     LINE                                            *07830042
078400*    *************************************************************07840042
078500     IF  ALINEL > ZERO                                            07850042
078600         MOVE ALINEI               TO ASC-LINE                    07860042
078700     ELSE                                                         07870042
078800         IF  ALINEF = DP015-ERASE-EOF                             07880042
078900             MOVE SPACE            TO ASC-LINE                    07890042
079000         END-IF                                                   07900042
079100     END-IF.                                                      07910042
079200                                                                  07920042
079300*    *************************************************************07930042
079400*    * VTAM:     UNIT                                            *07940042
079500*    *************************************************************07950042
079600     IF  APHYUL > ZERO                                            07960042
079700         MOVE APHYUI               TO ASC-PHYSICAL-UNIT           07970042
079800     ELSE                                                         07980042
079900         IF  APHYUF = DP015-ERASE-EOF                             07990042
080000             MOVE SPACE            TO ASC-PHYSICAL-UNIT           08000042
080100         END-IF                                                   08010042
080200     END-IF.                                                      08020042
080300                                                                  08030042
080400*    *************************************************************08040042
080500*    * IP ADDRESS RANGE: BEGINNING OF RANGE                      *08050042
080600*    *************************************************************08060042
080700     IF  AIPB1L > ZERO                                            08070042
080800         MOVE AIPB1I               TO ASC-IP-ADDR-B-OCTET1        08080042
080900     ELSE                                                         08090042
081000         IF  AIPB1F = DP015-ERASE-EOF                             08100042
081100             MOVE SPACE            TO ASC-IP-ADDR-B-OCTET1        08110042
081200         END-IF                                                   08120042
081300     END-IF.                                                      08130042
081400                                                                  08140042
081500     IF  AIPB2L > ZERO                                            08150042
081600         MOVE AIPB2I               TO ASC-IP-ADDR-B-OCTET2        08160042
081700     ELSE                                                         08170042
081800         IF  AIPB2F = DP015-ERASE-EOF                             08180042
081900             MOVE SPACE            TO ASC-IP-ADDR-B-OCTET2        08190042
082000         END-IF                                                   08200042
082100     END-IF.                                                      08210042
082200                                                                  08220042
082300     IF  AIPB3L > ZERO                                            08230042
082400         MOVE AIPB3I               TO ASC-IP-ADDR-B-OCTET3        08240042
082500     ELSE                                                         08250042
082600         IF  AIPB3F = DP015-ERASE-EOF                             08260042
082700             MOVE SPACE            TO ASC-IP-ADDR-B-OCTET3        08270042
082800         END-IF                                                   08280042
082900     END-IF.                                                      08290042
083000                                                                  08300042
083100     IF  AIPB4L > ZERO                                            08310042
083200         MOVE AIPB4I               TO ASC-IP-ADDR-B-OCTET4        08320042
083300     ELSE                                                         08330042
083400         IF  AIPB4F = DP015-ERASE-EOF                             08340042
083500             MOVE SPACE            TO ASC-IP-ADDR-B-OCTET4        08350042
083600         END-IF                                                   08360042
083700     END-IF.                                                      08370042
083800                                                                  08380042
083900*    *************************************************************08390042
084000*    * IP ADDRESS RANGE: END OF RANGE                            *08400042
084100*    *************************************************************08410042
084200     IF  AIPE1L > ZERO                                            08420042
084300         MOVE AIPE1I               TO ASC-IP-ADDR-E-OCTET1        08430042
084400     ELSE                                                         08440042
084500         IF  AIPE1F = DP015-ERASE-EOF                             08450042
084600             MOVE SPACE            TO ASC-IP-ADDR-E-OCTET1        08460042
084700         END-IF                                                   08470042
084800     END-IF.                                                      08480042
084900                                                                  08490042
085000     IF  AIPE2L > ZERO                                            08500042
085100         MOVE AIPE2I               TO ASC-IP-ADDR-E-OCTET2        08510042
085200     ELSE                                                         08520042
085300         IF  AIPE2F = DP015-ERASE-EOF                             08530042
085400             MOVE SPACE            TO ASC-IP-ADDR-E-OCTET2        08540042
085500         END-IF                                                   08550042
085600     END-IF.                                                      08560042
085700                                                                  08570042
085800     IF  AIPE3L > ZERO                                            08580042
085900         MOVE AIPE3I               TO ASC-IP-ADDR-E-OCTET3        08590042
086000     ELSE                                                         08600042
086100         IF  AIPE3F = DP015-ERASE-EOF                             08610042
086200             MOVE SPACE            TO ASC-IP-ADDR-E-OCTET3        08620042
086300         END-IF                                                   08630042
086400     END-IF.                                                      08640042
086500                                                                  08650042
086600     IF  AIPE4L > ZERO                                            08660042
086700         MOVE AIPE4I               TO ASC-IP-ADDR-E-OCTET4        08670042
086800     ELSE                                                         08680042
086900         IF  AIPE4F = DP015-ERASE-EOF                             08690042
087000             MOVE SPACE            TO ASC-IP-ADDR-E-OCTET4        08700042
087100         END-IF                                                   08710042
087200     END-IF.                                                      08720042
087300                                                                  08730042
087400*----------------------------------------------------------------*08740042
087500* PERFORM EDITS ON EACH FIELD ENTERED BY THE USER.  IF AN ERROR  *08750042
087600* IS FOUND THE CURSOR IS POSITIONED AT THAT FIELD AND AN         *08760042
087700* APPROPRIATE ERROR MESSAGE IS DISPLAYED.                        *08770042
087800*----------------------------------------------------------------*08780042
087900 3000-EDIT-DATA-IN-COMMAREA.                                      08790042
088000     PERFORM 3200-RESET-ATTRIBUTES.                               08800042
088100     PERFORM 3220-INDIVIDUAL-FIELD-EDITS.                         08810042
088200                                                                  08820042
088300     IF  PS-NO-ERROR                                              08830042
088400         PERFORM 3300-CROSSCHECK-FIELD-EDITS                      08840042
088500     END-IF.                                                      08850042
088600                                                                  08860042
088700     IF  PS-NO-ERROR                                              08870042
088800         PERFORM 3400-CROSSCHECK-TABLE-EDITS                      08880042
088900     END-IF.                                                      08890042
089000                                                                  08900042
089100     IF  PS-NO-ERROR                                              08910042
089200         MOVE -1 TO ASTORL                                        08920042
089300         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      08930042
089400     END-IF.                                                      08940042
089500                                                                  08950042
089600                                                                  08960042
089700*----------------------------------------------------------------*08970042
089800*    RESET ATTRIBUTE BYTES FOR EACH FIELD ON SCREEN.             *08980042
089900*    - PROTECTION                                                *08990042
090000*    - COLOR                                                     *09000042
090100*    - HIGHLIGHT                                                 *09010042
090200*----------------------------------------------------------------*09020042
090300 3200-RESET-ATTRIBUTES.                                           09030042
090400     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTORA                      09040042
090500                                      AFCLTA                      09050042
090600                                      ALINEA                      09060042
090700                                      APHYUA                      09070042
090800                                      AIPB1A                      09080042
090900                                      AIPB2A                      09090042
091000                                      AIPB3A                      09100042
091100                                      AIPB4A                      09110042
091200                                      AIPE1A                      09120042
091300                                      AIPE2A                      09130042
091400                                      AIPE3A                      09140042
091500                                      AIPE4A.                     09150042
091600     MOVE DP015-GREEN              TO ASTORC                      09160042
091700                                      AFCLTC                      09170042
091800                                      ALINEC                      09180042
091900                                      APHYUC                      09190042
092000                                      AIPB1C                      09200042
092100                                      AIPB2C                      09210042
092200                                      AIPB3C                      09220042
092300                                      AIPB4C                      09230042
092400                                      AIPE1C                      09240042
092500                                      AIPE2C                      09250042
092600                                      AIPE3C                      09260042
092700                                      AIPE4C.                     09270042
092800     MOVE DP015-UNDERLINE          TO ASTORH                      09280042
092900                                      AFCLTH                      09290042
093000                                      ALINEH                      09300042
093100                                      APHYUH                      09310042
093200                                      AIPB1H                      09320042
093300                                      AIPB2H                      09330042
093400                                      AIPB3H                      09340042
093500                                      AIPB4H                      09350042
093600                                      AIPE1H                      09360042
093700                                      AIPE2H                      09370042
093800                                      AIPE3H                      09380042
093900                                      AIPE4H.                     09390042
094000                                                                  09400042
094100                                                                  09410042
094200*----------------------------------------------------------------*09420042
094300*    BASIC FIELD EDITS                                           *09430042
094400*    *****************                                           *09440042
094500*                                                                *09450042
094600*    FIELDS ARE EDITED IN REVERSE ORDER OF HOW THEY APPEAR ON    *09460042
094700*    THE SCREEN.  IN THIS WAY, FOR EACH ERROR ENCOUNTERED, THE   *09470042
094800*    ERROR MESSAGE AND CURSOR POSITIONING WILL OVERLAY ANY       *09480042
094900*    PREVIOUS ERROR MESSAGE AND CURSOR POSITIONING, UNTIL THE    *09490042
095000*    ERROR MESSAGE AND CURSOR POSITIONING ARE SET FOR THE FIRST  *09500042
095100*    ERROR ENCOUNTERED ON THE SCREEN.                            *09510042
095200*                                                                *09520042
095300*    WHEN ALL FIELDS HAVE PASSED THEIR EDITS, THE CROSSCHECK     *09530042
095400*    EDITS ARE PERFORMED ON THE VALUES STORED IN THE "TABLE"     *09540042
095500*    FORMAT PORTION OF THE COMMAREA.                             *09550042
095600*                                                                *09560042
095700*    EDITS:                                                      *09570042
095800*    * LOCATION (STORE AND FACILITY) MUST BE ENTERED.            *09580042
095900*      LOCATION EDITS ------------------------------------------ *09590042
096000*      - STORE NUMBER MUST BE ON TABLE 'XIT_LOC'.                *09600051
096100*      - FACILITY MUST BE NUMERIC.                               *09610042
096200*    * IP ADDRESS RANGE (BEGIN AND END) AND/OR                   *09620042
096300*      VTAM (LINE AND UNIT) MUST ALSO BE ENTERED.                *09630042
096400*      IP ADDRESS RANGE EDITS (IF ENTERED) --------------------- *09640042
096500*      - IP ADDRESS OCTETS MUST BE NUMERIC AND EACH OCTET'S      *09650042
096600*        VALUE MUST BE 000-255 INCLUSIVE.                        *09660042
096700*      - THE ENDING IP ADDRESS MUST BE GREATER THAN OR           *09670042
096800*        EQUAL TO THE BEGINNING IP ADDRESS.                      *09680042
096900*      VTAM EDITS (IF ENTERED) --------------------------------- *09690042
097000*      - LINE MUST BE 2 POSITIONS.                               *09700042
097100*      - UNIT MUST BE 2 POSITIONS AND A VALID HEX VALUE.         *09710042
097200*----------------------------------------------------------------*09720042
097300 3220-INDIVIDUAL-FIELD-EDITS.                                     09730042
097400*    *************************************************************09740042
097500*    * IP ADDRESS RANGE: END OF RANGE, OCTET4                    *09750042
097600*    *************************************************************09760042
097700     IF  ASC-IP-ADDR-E-OCTET4 = SPACE                             09770042
097800         CONTINUE                                                 09780042
097900     ELSE                                                         09790042
098000         MOVE ASC-IP-ADDR-E-OCTET4 TO DP010I-UNEDITED-FIELD       09800042
098100         MOVE LENGTH OF ASC-IP-ADDR-E-OCTET4                      09810042
098200                                  TO DP010I-MAXIMUM-DIGITS        09820042
098300         MOVE ZERO                TO DP010I-MAXIMUM-DECIMALS      09830042
098400         SET DP010I-NEGATIVE-NOT-ALLOWED                          09840042
098500                                  TO TRUE                         09850042
262023         CALL DP010I-NUMERIC-EDIT-ROUTINE                         09861055
262023              USING DP010I-NUMERIC-EDIT-AREA                      09862055
098700         IF  DP010I-ERROR-DETECTED                                09870042
098800             SET PS-ERROR         TO TRUE                         09880042
098900             SET DP020-MSG-FATAL  TO TRUE                         09890042
099000*            ---- MUST BE NUMERIC                                 09900042
099100             MOVE PC-TSYMSG-00008 TO DP020-MSG-NUMBER             09910042
099200             MOVE DP015-UNP-ALP-BRT-OFF                           09920042
099300                                  TO AIPE4A                       09930042
099400             MOVE DP015-RED       TO AIPE4C                       09940042
099500             MOVE DP015-REVERSE   TO AIPE4H                       09950042
099600             MOVE -1              TO AIPE4L                       09960042
099700             SET DP030-SET-CURSOR-APPL-1                          09970042
099800                                  TO TRUE                         09980042
099900         ELSE                                                     09990042
100000             IF ASC-IP-ADDR-E-OCTET4 < PC-VALID-OCTET-MIN         10000042
100100             OR ASC-IP-ADDR-E-OCTET4 > PC-VALID-OCTET-MAX         10010042
100200*                ---- MUST BE VALID VALUE, 000 - 255 INCLUSIVE    10020042
100300                 SET PS-ERROR         TO TRUE                     10030042
100400                 MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER         10040042
100500                 MOVE DP015-UNP-ALP-BRT-OFF                       10050042
100600                                      TO AIPE4A                   10060042
100700                 MOVE DP015-RED       TO AIPE4C                   10070042
100800                 MOVE DP015-REVERSE   TO AIPE4H                   10080042
100900                 MOVE -1              TO AIPE4L                   10090042
101000                 SET DP030-SET-CURSOR-APPL-1                      10100042
101100                                      TO TRUE                     10110042
101200             ELSE                                                 10120042
101300                 CONTINUE                                         10130042
101400         END-IF                                                   10140042
101500     END-IF.                                                      10150042
101600                                                                  10160042
101700                                                                  10170042
101800*    *************************************************************10180042
101900*    * IP ADDRESS RANGE: END OF RANGE, OCTET3                    *10190042
102000*    *************************************************************10200042
102100     IF  ASC-IP-ADDR-E-OCTET3 = SPACE                             10210042
102200         CONTINUE                                                 10220042
102300     ELSE                                                         10230042
102400         MOVE ASC-IP-ADDR-E-OCTET3 TO DP010I-UNEDITED-FIELD       10240042
102500         MOVE LENGTH OF ASC-IP-ADDR-E-OCTET3                      10250042
102600                                  TO DP010I-MAXIMUM-DIGITS        10260042
102700         MOVE ZERO                TO DP010I-MAXIMUM-DECIMALS      10270042
102800         SET DP010I-NEGATIVE-NOT-ALLOWED                          10280042
102900                                  TO TRUE                         10290042
262023         CALL DP010I-NUMERIC-EDIT-ROUTINE                         10301055
262023              USING DP010I-NUMERIC-EDIT-AREA                      10302055
103100         IF  DP010I-ERROR-DETECTED                                10310042
103200             SET PS-ERROR         TO TRUE                         10320042
103300             SET DP020-MSG-FATAL  TO TRUE                         10330042
103400*            ---- MUST BE NUMERIC                                 10340042
103500             MOVE PC-TSYMSG-00008 TO DP020-MSG-NUMBER             10350042
103600             MOVE DP015-UNP-ALP-BRT-OFF                           10360042
103700                                  TO AIPE3A                       10370042
103800             MOVE DP015-RED       TO AIPE3C                       10380042
103900             MOVE DP015-REVERSE   TO AIPE3H                       10390042
104000             MOVE -1              TO AIPE3L                       10400042
104100             SET DP030-SET-CURSOR-APPL-1                          10410042
104200                                  TO TRUE                         10420042
104300         ELSE                                                     10430042
104400             IF ASC-IP-ADDR-E-OCTET3 < PC-VALID-OCTET-MIN         10440042
104500             OR ASC-IP-ADDR-E-OCTET3 > PC-VALID-OCTET-MAX         10450042
104600                 SET PS-ERROR         TO TRUE                     10460042
104700                 SET DP020-MSG-FATAL  TO TRUE                     10470042
104800*                ---- MUST BE VALID VALUE, 000 - 255 INCLUSIVE    10480042
104900                 MOVE PC-TSYMSG-01285 TO DP020-MSG-NUMBER         10490042
105000                 MOVE DP015-UNP-ALP-BRT-OFF                       10500042
105100                                      TO AIPE3A                   10510042
105200                 MOVE DP015-RED       TO AIPE3C                   10520042
105300                 MOVE DP015-REVERSE   TO AIPE3H                   10530042
105400                 MOVE -1              TO AIPE3L                   10540042
105500                 SET DP030-SET-CURSOR-APPL-1                      10550042
105600                                      TO TRUE                     10560042
105700             ELSE                                                 10570042
105800                 CONTINUE                                         10580042
105900         END-IF                                                   10590042
106000     END-IF.                                                      10600042
106100                                                                  10610042
106200                                                                  10620042
106300*    *************************************************************10630042
106400*    * IP ADDRESS RANGE: END OF RANGE, OCTET2                    *10640042
106500*    *************************************************************10650042
106600     IF  ASC-IP-ADDR-E-OCTET2 = SPACE                             10660042
106700         CONTINUE                                                 10670042
106800     ELSE                                                         10680042
106900         MOVE ASC-IP-ADDR-E-OCTET2 TO DP010I-UNEDITED-FIELD       10690042
107000         MOVE LENGTH OF ASC-IP-ADDR-E-OCTET2                      10700042
107100                                  TO DP010I-MAXIMUM-DIGITS        10710042
107200         MOVE ZERO                TO DP010I-MAXIMUM-DECIMALS      10720042
107300         SET DP010I-NEGATIVE-NOT-ALLOWED                          10730042
107400                                  TO TRUE                         10740042
262023         CALL DP010I-NUMERIC-EDIT-ROUTINE                         10751055
262023              USING DP010I-NUMERIC-EDIT-AREA                      10752055
107600         IF  DP010I-ERROR-DETECTED                                10760042
107700             SET PS-ERROR         TO TRUE                         10770042
107800             SET DP020-MSG-FATAL  TO TRUE                         10780042
107900*            ---- MUST BE NUMERIC                                 10790042
108000             MOVE PC-TSYMSG-00008 TO DP020-MSG-NUMBER             10800042
108100             MOVE DP015-UNP-ALP-BRT-OFF                           10810042
108200                                  TO AIPE2A                       10820042
108300             MOVE DP015-RED       TO AIPE2C                       10830042
108400             MOVE DP015-REVERSE   TO AIPE2H                       10840042
108500             MOVE -1              TO AIPE2L                       10850042
108600             SET DP030-SET-CURSOR-APPL-1                          10860042
108700                                  TO TRUE                         10870042
108800         ELSE                                                     10880042
108900             IF ASC-IP-ADDR-E-OCTET2 < PC-VALID-OCTET-MIN         10890042
109000             OR ASC-IP-ADDR-E-OCTET2 > PC-VALID-OCTET-MAX         10900042
109100                 SET PS-ERROR         TO TRUE                     10910042
109200                 SET DP020-MSG-FATAL  TO TRUE                     10920042
109300*                ---- MUST BE VALID VALUE, 000 - 255 INCLUSIVE    10930042
109400                 MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER         10940042
109500                 MOVE DP015-UNP-ALP-BRT-OFF                       10950042
109600                                      TO AIPE2A                   10960042
109700                 MOVE DP015-RED       TO AIPE2C                   10970042
109800                 MOVE DP015-REVERSE   TO AIPE2H                   10980042
109900                 MOVE -1              TO AIPE2L                   10990042
110000                 SET DP030-SET-CURSOR-APPL-1                      11000042
110100                                      TO TRUE                     11010042
110200             ELSE                                                 11020042
110300                 CONTINUE                                         11030042
110400         END-IF                                                   11040042
110500     END-IF.                                                      11050042
110600                                                                  11060042
110700                                                                  11070042
110800                                                                  11080042
110900*    *************************************************************11090042
111000*    * IP ADDRESS RANGE: END OF RANGE, OCTET1                    *11100042
111100*    *************************************************************11110042
111200     IF  ASC-IP-ADDR-E-OCTET1 = SPACE                             11120042
111300         CONTINUE                                                 11130042
111400     ELSE                                                         11140042
111500         MOVE ASC-IP-ADDR-E-OCTET1 TO DP010I-UNEDITED-FIELD       11150042
111600         MOVE LENGTH OF ASC-IP-ADDR-E-OCTET1                      11160042
111700                                  TO DP010I-MAXIMUM-DIGITS        11170042
111800         MOVE ZERO                TO DP010I-MAXIMUM-DECIMALS      11180042
111900         SET DP010I-NEGATIVE-NOT-ALLOWED                          11190042
112000                                  TO TRUE                         11200042
262023         CALL DP010I-NUMERIC-EDIT-ROUTINE                         11211055
262023              USING DP010I-NUMERIC-EDIT-AREA                      11212055
112200         IF  DP010I-ERROR-DETECTED                                11220042
112300             SET PS-ERROR         TO TRUE                         11230042
112400             SET DP020-MSG-FATAL  TO TRUE                         11240042
112500*            ---- MUST BE NUMERIC                                 11250042
112600             MOVE PC-TSYMSG-00008 TO DP020-MSG-NUMBER             11260042
112700             MOVE DP015-UNP-ALP-BRT-OFF                           11270042
112800                                  TO AIPE1A                       11280042
112900             MOVE DP015-RED       TO AIPE1C                       11290042
113000             MOVE DP015-REVERSE   TO AIPE1H                       11300042
113100             MOVE -1              TO AIPE1L                       11310042
113200             SET DP030-SET-CURSOR-APPL-1                          11320042
113300                                  TO TRUE                         11330042
113400         ELSE                                                     11340042
113500             IF ASC-IP-ADDR-E-OCTET1 < PC-VALID-OCTET-MIN         11350042
113600             OR ASC-IP-ADDR-E-OCTET1 > PC-VALID-OCTET-MAX         11360042
113700                 SET PS-ERROR         TO TRUE                     11370042
113800                 SET DP020-MSG-FATAL  TO TRUE                     11380042
113900*                ---- MUST BE VALID VALUE, 000 - 255 INCLUSIVE    11390042
114000                 MOVE PC-TSYMSG-01285 TO DP020-MSG-NUMBER         11400042
114100                 MOVE DP015-UNP-ALP-BRT-OFF                       11410042
114200                                      TO AIPE1A                   11420042
114300                 MOVE DP015-RED       TO AIPE1C                   11430042
114400                 MOVE DP015-REVERSE   TO AIPE1H                   11440042
114500                 MOVE -1              TO AIPE1L                   11450042
114600                 SET DP030-SET-CURSOR-APPL-1                      11460042
114700                                      TO TRUE                     11470042
114800             ELSE                                                 11480042
114900                 CONTINUE                                         11490042
115000         END-IF                                                   11500042
115100     END-IF.                                                      11510042
115200                                                                  11520042
115300                                                                  11530042
115400*----------------------------------------------------------------*11540042
115500* THIS IS A CROSS-CHECK EDIT, BUT TO THE USER OF THIS SCREEN,    *11550042
115600* THIS IS PROBABLY PERCEIVED AS ONE FIELD...                     *11560042
115700* IF ONE OCTET OF AN IP ADDRESS IS ENTERED, ALL OCTETS MUST      *11570042
115800*    BE ENTERED (IE: THE FULL IP ADDRESS MUST BE ENTERED).       *11580042
115900*----------------------------------------------------------------*11590042
116000     IF  ASC-IP-ADDR-E-OCTET1 = SPACE                             11600042
116100     AND ASC-IP-ADDR-E-OCTET2 = SPACE                             11610042
116200     AND ASC-IP-ADDR-E-OCTET3 = SPACE                             11620042
116300     AND ASC-IP-ADDR-E-OCTET4 = SPACE                             11630042
116400         CONTINUE                                                 11640042
116500     ELSE                                                         11650042
116600         IF  ASC-IP-ADDR-E-OCTET1 = SPACE                         11660042
116700         OR  ASC-IP-ADDR-E-OCTET2 = SPACE                         11670042
116800         OR  ASC-IP-ADDR-E-OCTET3 = SPACE                         11680042
116900         OR  ASC-IP-ADDR-E-OCTET4 = SPACE                         11690042
117000             SET PS-ERROR         TO TRUE                         11700042
117100             SET DP020-MSG-FATAL  TO TRUE                         11710042
117200*            ---- INVALID VALUE                                   11720042
117300             MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER             11730042
117400             MOVE DP015-UNP-ALP-BRT-OFF                           11740042
117500                                  TO AIPE1A                       11750042
117600                                     AIPE2A                       11760042
117700                                     AIPE3A                       11770042
117800                                     AIPE4A                       11780042
117900             MOVE DP015-RED       TO AIPE1C                       11790042
118000                                     AIPE2C                       11800042
118100                                     AIPE3C                       11810042
118200                                     AIPE4C                       11820042
118300             MOVE DP015-REVERSE   TO AIPE1H                       11830042
118400                                     AIPE2H                       11840042
118500                                     AIPE3H                       11850042
118600                                     AIPE4H                       11860042
118700             SET DP030-SET-CURSOR-APPL-1                          11870042
118800                                  TO TRUE                         11880042
118900             IF  ASC-IP-ADDR-E-OCTET4 = SPACE                     11890042
119000                 MOVE -1          TO AIPE4L                       11900042
119100             END-IF                                               11910042
119200             IF  ASC-IP-ADDR-E-OCTET3 = SPACE                     11920042
119300                 MOVE -1          TO AIPE3L                       11930042
119400             END-IF                                               11940042
119500             IF  ASC-IP-ADDR-E-OCTET2 = SPACE                     11950042
119600                 MOVE -1          TO AIPE2L                       11960042
119700             END-IF                                               11970042
119800             IF  ASC-IP-ADDR-E-OCTET1 = SPACE                     11980042
119900                 MOVE -1          TO AIPE1L                       11990042
120000             END-IF                                               12000042
120100         ELSE                                                     12010042
120200*            *****************************************************12020042
120300*            * ALL OCTETS POPULATED, SO ADD THE DOTS IN-BETWEEN  *12030042
120400*            *****************************************************12040042
120500             MOVE PC-DOT          TO  ASC-IP-ADDR-E-DOT1          12050042
120600                                      ASC-IP-ADDR-E-DOT2          12060042
120700                                      ASC-IP-ADDR-E-DOT3          12070042
120800         END-IF                                                   12080042
120900     END-IF.                                                      12090042
121000                                                                  12100042
121100                                                                  12110042
121200*    *************************************************************12120042
121300*    * IP ADDRESS RANGE: BEGINNING OF RANGE, OCTET4              *12130042
121400*    *************************************************************12140042
121500     IF  ASC-IP-ADDR-B-OCTET4 = SPACE                             12150042
121600         CONTINUE                                                 12160042
121700     ELSE                                                         12170042
121800         MOVE ASC-IP-ADDR-B-OCTET4 TO DP010I-UNEDITED-FIELD       12180042
121900         MOVE LENGTH OF ASC-IP-ADDR-B-OCTET4                      12190042
122000                                  TO DP010I-MAXIMUM-DIGITS        12200042
122100         MOVE ZERO                TO DP010I-MAXIMUM-DECIMALS      12210042
122200         SET DP010I-NEGATIVE-NOT-ALLOWED                          12220042
122300                                  TO TRUE                         12230042
262023         CALL DP010I-NUMERIC-EDIT-ROUTINE                         12241055
262023              USING DP010I-NUMERIC-EDIT-AREA                      12242055
122500         IF  DP010I-ERROR-DETECTED                                12250042
122600             SET PS-ERROR         TO TRUE                         12260042
122700             SET DP020-MSG-FATAL  TO TRUE                         12270042
122800*            ---- MUST BE NUMERIC                                 12280042
122900             MOVE PC-TSYMSG-00008 TO DP020-MSG-NUMBER             12290042
123000             MOVE DP015-UNP-ALP-BRT-OFF                           12300042
123100                                  TO AIPB4A                       12310042
123200             MOVE DP015-RED       TO AIPB4C                       12320042
123300             MOVE DP015-REVERSE   TO AIPB4H                       12330042
123400             MOVE -1              TO AIPB4L                       12340042
123500             SET DP030-SET-CURSOR-APPL-1                          12350042
123600                                  TO TRUE                         12360042
123700         ELSE                                                     12370042
123800             IF ASC-IP-ADDR-B-OCTET4 < PC-VALID-OCTET-MIN         12380042
123900             OR ASC-IP-ADDR-B-OCTET4 > PC-VALID-OCTET-MAX         12390042
124000                 SET PS-ERROR         TO TRUE                     12400042
124100                 SET DP020-MSG-FATAL  TO TRUE                     12410042
124200*                ---- MUST BE VALID VALUE, 000 - 255 INCLUSIVE    12420042
124300                 MOVE PC-TSYMSG-01285 TO DP020-MSG-NUMBER         12430042
124400                 MOVE DP015-UNP-ALP-BRT-OFF                       12440042
124500                                      TO AIPB4A                   12450042
124600                 MOVE DP015-RED       TO AIPB4C                   12460042
124700                 MOVE DP015-REVERSE   TO AIPB4H                   12470042
124800                 MOVE -1              TO AIPB4L                   12480042
124900                 SET DP030-SET-CURSOR-APPL-1                      12490042
125000                                      TO TRUE                     12500042
125100             ELSE                                                 12510042
125200                 CONTINUE                                         12520042
125300         END-IF                                                   12530042
125400     END-IF.                                                      12540042
125500                                                                  12550042
125600                                                                  12560042
125700*    *************************************************************12570042
125800*    * IP ADDRESS RANGE: BEGINNING OF RANGE, OCTET3              *12580042
125900*    *************************************************************12590042
126000     IF  ASC-IP-ADDR-B-OCTET3 = SPACE                             12600042
126100         CONTINUE                                                 12610042
126200     ELSE                                                         12620042
126300         MOVE ASC-IP-ADDR-B-OCTET3 TO DP010I-UNEDITED-FIELD       12630042
126400         MOVE LENGTH OF ASC-IP-ADDR-B-OCTET3                      12640042
126500                                  TO DP010I-MAXIMUM-DIGITS        12650042
126600         MOVE ZERO                TO DP010I-MAXIMUM-DECIMALS      12660042
126700         SET DP010I-NEGATIVE-NOT-ALLOWED                          12670042
126800                                  TO TRUE                         12680042
262023         CALL DP010I-NUMERIC-EDIT-ROUTINE                         12691055
262023              USING DP010I-NUMERIC-EDIT-AREA                      12692055
127000         IF  DP010I-ERROR-DETECTED                                12700042
127100             SET PS-ERROR         TO TRUE                         12710042
127200             SET DP020-MSG-FATAL  TO TRUE                         12720042
127300*            ---- MUST BE NUMERIC                                 12730042
127400             MOVE PC-TSYMSG-00008 TO DP020-MSG-NUMBER             12740042
127500             MOVE DP015-UNP-ALP-BRT-OFF                           12750042
127600                                  TO AIPB3A                       12760042
127700             MOVE DP015-RED       TO AIPB3C                       12770042
127800             MOVE DP015-REVERSE   TO AIPB3H                       12780042
127900             MOVE -1              TO AIPB3L                       12790042
128000             SET DP030-SET-CURSOR-APPL-1                          12800042
128100                                  TO TRUE                         12810042
128200         ELSE                                                     12820042
128300             IF ASC-IP-ADDR-B-OCTET3 < PC-VALID-OCTET-MIN         12830042
128400             OR ASC-IP-ADDR-B-OCTET3 > PC-VALID-OCTET-MAX         12840042
128500                 SET PS-ERROR         TO TRUE                     12850042
128600                 SET DP020-MSG-FATAL  TO TRUE                     12860042
128700*                ---- MUST BE VALID VALUE, 000 - 255 INCLUSIVE    12870042
128800                 MOVE PC-TSYMSG-01285 TO DP020-MSG-NUMBER         12880042
128900                 MOVE DP015-UNP-ALP-BRT-OFF                       12890042
129000                                      TO AIPB3A                   12900042
129100                 MOVE DP015-RED       TO AIPB3C                   12910042
129200                 MOVE DP015-REVERSE   TO AIPB3H                   12920042
129300                 MOVE -1              TO AIPB3L                   12930042
129400                 SET DP030-SET-CURSOR-APPL-1                      12940042
129500                                      TO TRUE                     12950042
129600             ELSE                                                 12960042
129700                 CONTINUE                                         12970042
129800         END-IF                                                   12980042
129900     END-IF.                                                      12990042
130000                                                                  13000042
130100                                                                  13010042
130200*    *************************************************************13020042
130300*    * IP ADDRESS RANGE: BEGINNING OF RANGE, OCTET2              *13030042
130400*    *************************************************************13040042
130500     IF  ASC-IP-ADDR-B-OCTET2 = SPACE                             13050042
130600         CONTINUE                                                 13060042
130700     ELSE                                                         13070042
130800         MOVE ASC-IP-ADDR-B-OCTET2 TO DP010I-UNEDITED-FIELD       13080042
130900         MOVE LENGTH OF ASC-IP-ADDR-B-OCTET2                      13090042
131000                                  TO DP010I-MAXIMUM-DIGITS        13100042
131100         MOVE ZERO                TO DP010I-MAXIMUM-DECIMALS      13110042
131200         SET DP010I-NEGATIVE-NOT-ALLOWED                          13120042
131300                                  TO TRUE                         13130042
262023         CALL DP010I-NUMERIC-EDIT-ROUTINE                         13141055
262023              USING DP010I-NUMERIC-EDIT-AREA                      13142055
131500         IF  DP010I-ERROR-DETECTED                                13150042
131600             SET PS-ERROR         TO TRUE                         13160042
131700             SET DP020-MSG-FATAL  TO TRUE                         13170042
131800*            ---- MUST BE NUMERIC                                 13180042
131900             MOVE PC-TSYMSG-00008 TO DP020-MSG-NUMBER             13190042
132000             MOVE DP015-UNP-ALP-BRT-OFF                           13200042
132100                                  TO AIPB2A                       13210042
132200             MOVE DP015-RED       TO AIPB2C                       13220042
132300             MOVE DP015-REVERSE   TO AIPB2H                       13230042
132400             MOVE -1              TO AIPB2L                       13240042
132500             SET DP030-SET-CURSOR-APPL-1                          13250042
132600                                  TO TRUE                         13260042
132700         ELSE                                                     13270042
132800             IF ASC-IP-ADDR-B-OCTET2 < PC-VALID-OCTET-MIN         13280042
132900             OR ASC-IP-ADDR-B-OCTET2 > PC-VALID-OCTET-MAX         13290042
133000                 SET PS-ERROR         TO TRUE                     13300042
133100                 SET DP020-MSG-FATAL  TO TRUE                     13310042
133200*                ---- MUST BE VALID VALUE, 000 - 255 INCLUSIVE    13320042
133300                 MOVE PC-TSYMSG-01285 TO DP020-MSG-NUMBER         13330042
133400                 MOVE DP015-UNP-ALP-BRT-OFF                       13340042
133500                                      TO AIPB2A                   13350042
133600                 MOVE DP015-RED       TO AIPB2C                   13360042
133700                 MOVE DP015-REVERSE   TO AIPB2H                   13370042
133800                 MOVE -1              TO AIPB2L                   13380042
133900                 SET DP030-SET-CURSOR-APPL-1                      13390042
134000                                      TO TRUE                     13400042
134100             ELSE                                                 13410042
134200                 CONTINUE                                         13420042
134300         END-IF                                                   13430042
134400     END-IF.                                                      13440042
134500                                                                  13450042
134600                                                                  13460042
134700*    *************************************************************13470042
134800*    * IP ADDRESS RANGE: BEGINNING OF RANGE, OCTET1              *13480042
134900*    *************************************************************13490042
135000     IF  ASC-IP-ADDR-B-OCTET1 = SPACE                             13500042
135100         CONTINUE                                                 13510042
135200     ELSE                                                         13520042
135300         MOVE ASC-IP-ADDR-B-OCTET1 TO DP010I-UNEDITED-FIELD       13530042
135400         MOVE LENGTH OF ASC-IP-ADDR-B-OCTET1                      13540042
135500                                  TO DP010I-MAXIMUM-DIGITS        13550042
135600         MOVE ZERO                TO DP010I-MAXIMUM-DECIMALS      13560042
135700         SET DP010I-NEGATIVE-NOT-ALLOWED                          13570042
135800                                  TO TRUE                         13580042
262023         CALL DP010I-NUMERIC-EDIT-ROUTINE                         13591055
262023              USING DP010I-NUMERIC-EDIT-AREA                      13592055
136000         IF  DP010I-ERROR-DETECTED                                13600042
136100             SET PS-ERROR         TO TRUE                         13610042
136200             SET DP020-MSG-FATAL  TO TRUE                         13620042
136300*            ---- MUST BE NUMERIC                                 13630042
136400             MOVE PC-TSYMSG-00008 TO DP020-MSG-NUMBER             13640042
136500             MOVE DP015-UNP-ALP-BRT-OFF                           13650042
136600                                  TO AIPB1A                       13660042
136700             MOVE DP015-RED       TO AIPB1C                       13670042
136800             MOVE DP015-REVERSE   TO AIPB1H                       13680042
136900             MOVE -1              TO AIPB1L                       13690042
137000             SET DP030-SET-CURSOR-APPL-1                          13700042
137100                                  TO TRUE                         13710042
137200         ELSE                                                     13720042
137300             IF ASC-IP-ADDR-B-OCTET1 < PC-VALID-OCTET-MIN         13730042
137400             OR ASC-IP-ADDR-B-OCTET1 > PC-VALID-OCTET-MAX         13740042
137500                 SET PS-ERROR         TO TRUE                     13750042
137600                 SET DP020-MSG-FATAL  TO TRUE                     13760042
137700*                ---- MUST BE VALID VALUE, 000 - 255 INCLUSIVE    13770042
137800                 MOVE PC-TSYMSG-01285 TO DP020-MSG-NUMBER         13780042
137900                 MOVE DP015-UNP-ALP-BRT-OFF                       13790042
138000                                      TO AIPB1A                   13800042
138100                 MOVE DP015-RED       TO AIPB1C                   13810042
138200                 MOVE DP015-REVERSE   TO AIPB1H                   13820042
138300                 MOVE -1              TO AIPB1L                   13830042
138400                 SET DP030-SET-CURSOR-APPL-1                      13840042
138500                                      TO TRUE                     13850042
138600             ELSE                                                 13860042
138700                 CONTINUE                                         13870042
138800         END-IF                                                   13880042
138900     END-IF.                                                      13890042
139000                                                                  13900042
139100                                                                  13910042
139200*----------------------------------------------------------------*13920042
139300* THIS IS A CROSS-CHECK EDIT, BUT TO THE USER OF THIS SCREEN,    *13930042
139400* THIS IS PROBABLY PERCEIVED AS ONE FIELD...                     *13940042
139500* IF ONE OCTET OF AN IP ADDRESS IS ENTERED, ALL OCTETS MUST      *13950042
139600*    BE ENTERED (IE: THE FULL IP ADDRESS MUST BE ENTERED).       *13960042
139700*----------------------------------------------------------------*13970042
139800     IF  ASC-IP-ADDR-B-OCTET1 = SPACE                             13980042
139900     AND ASC-IP-ADDR-B-OCTET2 = SPACE                             13990042
140000     AND ASC-IP-ADDR-B-OCTET3 = SPACE                             14000042
140100     AND ASC-IP-ADDR-B-OCTET4 = SPACE                             14010042
140200         CONTINUE                                                 14020042
140300     ELSE                                                         14030042
140400         IF  ASC-IP-ADDR-B-OCTET1 = SPACE                         14040042
140500         OR  ASC-IP-ADDR-B-OCTET2 = SPACE                         14050042
140600         OR  ASC-IP-ADDR-B-OCTET3 = SPACE                         14060042
140700         OR  ASC-IP-ADDR-B-OCTET4 = SPACE                         14070042
140800             SET PS-ERROR         TO TRUE                         14080042
140900             SET DP020-MSG-FATAL  TO TRUE                         14090042
141000*            ---- INVALID VALUE                                   14100042
141100             MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER             14110042
141200             MOVE DP015-UNP-ALP-BRT-OFF                           14120042
141300                                  TO AIPB1A                       14130042
141400                                     AIPB2A                       14140042
141500                                     AIPB3A                       14150042
141600                                     AIPB4A                       14160042
141700             MOVE DP015-RED       TO AIPB1C                       14170042
141800                                     AIPB2C                       14180042
141900                                     AIPB3C                       14190042
142000                                     AIPB4C                       14200042
142100             MOVE DP015-REVERSE   TO AIPB1H                       14210042
142200                                     AIPB2H                       14220042
142300                                     AIPB3H                       14230042
142400                                     AIPB4H                       14240042
142500             SET DP030-SET-CURSOR-APPL-1                          14250042
142600                                  TO TRUE                         14260042
142700             IF  ASC-IP-ADDR-B-OCTET4 = SPACE                     14270042
142800                 MOVE -1          TO AIPB4L                       14280042
142900             END-IF                                               14290042
143000             IF  ASC-IP-ADDR-B-OCTET3 = SPACE                     14300042
143100                 MOVE -1          TO AIPB3L                       14310042
143200             END-IF                                               14320042
143300             IF  ASC-IP-ADDR-B-OCTET2 = SPACE                     14330042
143400                 MOVE -1          TO AIPB2L                       14340042
143500             END-IF                                               14350042
143600             IF  ASC-IP-ADDR-B-OCTET1 = SPACE                     14360042
143700                 MOVE -1          TO AIPB1L                       14370042
143800             END-IF                                               14380042
143900         ELSE                                                     14390042
144000*            *****************************************************14400042
144100*            * ALL OCTETS POPULATED, SO ADD THE DOTS IN-BETWEEN  *14410042
144200*            *****************************************************14420042
144300             MOVE PC-DOT          TO  ASC-IP-ADDR-B-DOT1          14430042
144400                                      ASC-IP-ADDR-B-DOT2          14440042
144500                                      ASC-IP-ADDR-B-DOT3          14450042
144600         END-IF                                                   14460042
144700     END-IF.                                                      14470042
144800                                                                  14480042
144900                                                                  14490042
145000*    *************************************************************14500042
145100*    * VTAM:     UNIT                                            *14510042
145200*    *************************************************************14520042
145300     IF ASC-PHYSICAL-UNIT  =  SPACE                               14530042
145400         CONTINUE                                                 14540042
145500     ELSE                                                         14550042
145600         MOVE ASC-PHYSICAL-UNIT1  TO  PC-VALIDATE-PHYU1           14560042
145700         MOVE ASC-PHYSICAL-UNIT2  TO  PC-VALIDATE-PHYU2           14570042
145800         IF  PC-VALID-HEX-CHAR1                                   14580042
145900         AND PC-VALID-HEX-CHAR2                                   14590042
146000             CONTINUE                                             14600042
146100         ELSE                                                     14610042
146200             SET PS-ERROR         TO TRUE                         14620042
146300             SET DP020-MSG-FATAL  TO TRUE                         14630042
146400*            ---- EACH CHARACTER MUST BE 0-9 OR A-F               14640042
146500             MOVE PC-TSYMSG-01282 TO DP020-MSG-NUMBER             14650042
146600             MOVE DP015-UNP-ALP-BRT-OFF                           14660042
146700                                  TO APHYUA                       14670042
146800             MOVE DP015-RED       TO APHYUC                       14680042
146900             MOVE DP015-REVERSE   TO APHYUH                       14690042
147000             MOVE -1              TO APHYUL                       14700042
147100             SET DP030-SET-CURSOR-APPL-1                          14710042
147200                                  TO TRUE                         14720042
147300         END-IF                                                   14730042
147400     END-IF.                                                      14740042
147500                                                                  14750042
147600*    *************************************************************14760042
147700*    * VTAM:     LINE                                            *14770042
147800*    *************************************************************14780042
147900     IF ASC-LINE  =  SPACE                                        14790042
148000         CONTINUE                                                 14800042
148100     ELSE                                                         14810042
148200         IF  ASC-LINE1  =  SPACE                                  14820042
148300         OR  ASC-LINE2  =  SPACE                                  14830042
148400             SET PS-ERROR         TO TRUE                         14840042
148500             SET DP020-MSG-FATAL  TO TRUE                         14850042
148600*            ---- ENTRY MUST BE 2 POSITIONS                       14860042
148700             MOVE PC-TSYMSG-01283 TO DP020-MSG-NUMBER             14870042
148800             MOVE DP015-UNP-ALP-BRT-OFF                           14880042
148900                                  TO ALINEA                       14890042
149000             MOVE DP015-RED       TO ALINEC                       14900042
149100             MOVE DP015-REVERSE   TO ALINEH                       14910042
149200             MOVE -1              TO ALINEL                       14920042
149300             SET DP030-SET-CURSOR-APPL-1                          14930042
149400                                  TO TRUE                         14940042
149500         END-IF                                                   14950042
149600     END-IF.                                                      14960042
149700                                                                  14970042
149800*    *************************************************************14980042
149900*    * LOCATION: FACILITY                                        *14990042
150000*    *************************************************************15000042
150100     IF  ASC-FCLTY  =  SPACE                                      15010042
150200     OR  ASC-FCLTY  =  ZEROES                                     15020042
150300         SET PS-ERROR         TO TRUE                             15030042
150400         SET DP020-MSG-FATAL  TO TRUE                             15040042
150500*        ---- REQUIRED ENTRY                                      15050042
150600         MOVE PC-TSYMSG-00007 TO DP020-MSG-NUMBER                 15060042
150700         MOVE DP015-UNP-ALP-BRT-OFF                               15070042
150800                              TO AFCLTA                           15080042
150900         MOVE DP015-RED       TO AFCLTC                           15090042
151000         MOVE DP015-REVERSE   TO AFCLTH                           15100042
151100         MOVE -1              TO AFCLTL                           15110042
151200         SET DP030-SET-CURSOR-APPL-1                              15120042
151300                              TO TRUE                             15130042
151400     ELSE                                                         15140042
151500         MOVE ASC-FCLTY           TO DP010I-UNEDITED-FIELD        15150042
151600         MOVE LENGTH OF ASC-FCLTY TO DP010I-MAXIMUM-DIGITS        15160042
151700         MOVE ZERO                TO DP010I-MAXIMUM-DECIMALS      15170042
151800         SET DP010I-NEGATIVE-NOT-ALLOWED                          15180042
151900                                  TO TRUE                         15190042
262023         CALL DP010I-NUMERIC-EDIT-ROUTINE                         15201055
262023              USING DP010I-NUMERIC-EDIT-AREA                      15202055
152100         IF  DP010I-ERROR-DETECTED                                15210042
152200             SET PS-ERROR         TO TRUE                         15220042
152300             SET DP020-MSG-FATAL  TO TRUE                         15230042
152400*            ---- MUST BE NUMERIC                                 15240042
152500             MOVE PC-TSYMSG-00008 TO DP020-MSG-NUMBER             15250042
152600             MOVE DP015-UNP-ALP-BRT-OFF                           15260042
152700                                  TO AFCLTA                       15270042
152800             MOVE DP015-RED       TO AFCLTC                       15280042
152900             MOVE DP015-REVERSE   TO AFCLTH                       15290042
153000             MOVE -1              TO AFCLTL                       15300042
153100             SET DP030-SET-CURSOR-APPL-1                          15310042
153200                                  TO TRUE                         15320042
153300         ELSE                                                     15330042
153400             MOVE DP010I-NUMERIC-FIELD                            15340042
153500                                  TO ASC-FCLTY-N                  15350042
153600         END-IF                                                   15360042
153700     END-IF.                                                      15370042
153800                                                                  15380042
153900                                                                  15390042
154000*    *************************************************************15400042
154100*    * LOCATION: STORE                                           *15410042
154200*    *************************************************************15420042
154300     IF  ASC-LOC-X = SPACE                                        15430051
154400     OR  ASC-LOC-X  =  ZEROES                                     15440051
154500         SET PS-ERROR              TO TRUE                        15450042
154600         SET DP020-MSG-FATAL       TO TRUE                        15460042
154700*        ---- REQUIRED FIELD -----                                15470042
154800         MOVE PC-TSYMSG-00007      TO DP020-MSG-NUMBER            15480042
154900         MOVE DP015-UNP-ALP-BRT-OFF                               15490042
155000                                   TO ASTORA                      15500042
155100         MOVE DP015-RED            TO ASTORC                      15510042
155200         MOVE DP015-REVERSE        TO ASTORH                      15520042
155300         MOVE -1                   TO ASTORL                      15530042
155400         SET DP030-SET-CURSOR-APPL-1                              15540042
155500                                   TO TRUE                        15550042
155600     ELSE                                                         15560042
155700         PERFORM 3221-VERIFY-STORE-NUMERIC                        15570042
155800         IF  PS-ERROR                                             15580042
155900             CONTINUE                                             15590042
156000         ELSE                                                     15600042
156100             MOVE ZERO TO SQLCODE                                 15610042
156200             MOVE PC-OPERATING-COMPANY TO DK-OPERATING-COMPANY    15620042
156300             MOVE ASC-LOC-NBR          TO DK-LOC-NBR              15630051
156400             PERFORM 3222-VERIFY-STORE-EXISTS                     15640042
156500             IF SQLCODE = +100                                    15650042
156600                 SET PS-ERROR                                     15660042
156700                     DP020-MSG-FATAL   TO TRUE                    15670042
156800*                ---- STORE  DOESN'T EXIST ----                   15680042
156900                 MOVE PC-TSYMSG-00017  TO DP020-MSG-NUMBER        15690042
157000                 MOVE DP015-UNP-ALP-BRT-OFF                       15700042
157100                                       TO ASTORA                  15710042
157200                 MOVE DP015-RED        TO ASTORC                  15720042
157300                 MOVE DP015-REVERSE    TO ASTORH                  15730042
157400                 MOVE -1               TO ASTORL                  15740042
157500                 SET DP030-SET-CURSOR-APPL-1                      15750042
157600                                       TO TRUE                    15760042
157700             END-IF                                               15770042
157800         END-IF                                                   15780042
157900     END-IF.                                                      15790042
158000                                                                  15800042
158100*----------------------------------------------------------------*15810042
158200* CALL THE NUMERIC EDIT ROUTINE TO VERIFY STORE ENTRY IS NUMERIC.*15820042
158300*----------------------------------------------------------------*15830042
158400 3221-VERIFY-STORE-NUMERIC.                                       15840042
158500     MOVE ASC-LOC-X           TO DP010I-UNEDITED-FIELD.           15850051
158600     MOVE LENGTH OF ASC-LOC-X TO DP010I-MAXIMUM-DIGITS.           15860051
158700     MOVE ZERO                TO DP010I-MAXIMUM-DECIMALS.         15870042
158800     SET DP010I-NEGATIVE-NOT-ALLOWED                              15880042
158900                              TO TRUE.                            15890042
262023     CALL DP010I-NUMERIC-EDIT-ROUTINE                             15901055
262023          USING DP010I-NUMERIC-EDIT-AREA.                         15902055
159100     IF  DP010I-ERROR-DETECTED                                    15910042
159200         SET PS-ERROR         TO TRUE                             15920042
159300         SET DP020-MSG-FATAL  TO TRUE                             15930042
159400*        ---- MUST BE NUMERIC                                     15940042
159500         MOVE PC-TSYMSG-00008 TO DP020-MSG-NUMBER                 15950042
159600         MOVE DP015-UNP-ALP-BRT-OFF                               15960042
159700                              TO ASTORA                           15970042
159800         MOVE DP015-RED       TO ASTORC                           15980042
159900         MOVE DP015-REVERSE   TO ASTORH                           15990042
160000         MOVE -1              TO ASTORL                           16000042
160100         SET DP030-SET-CURSOR-APPL-1                              16010042
160200                              TO TRUE                             16020042
160300     ELSE                                                         16030042
160400         MOVE DP010I-NUMERIC-FIELD                                16040042
160500                              TO ASC-LOC-NBR                      16050051
160600                                 DK-LOC-NBR                       16060051
160700     END-IF.                                                      16070042
160800                                                                  16080042
160900                                                                  16090042
161000*----------------------------------------------------------------*16100042
161100* SELECT STORE FROM TABLE TO VERIFY STORE EXISTS.                *16110042
161200*----------------------------------------------------------------*16120042
161300 3222-VERIFY-STORE-EXISTS.                                        16130042
161400     EXEC SQL                                                     16140042
161500          SELECT LOC_NBR                                          16150051
161600           INTO  :XIT00000-LOC-NBR                                16160051
161700           FROM  XIT_LOC                                          16170051
161900           WHERE LOC_NBR = :DK-LOC-NBR                            16190051
162000     END-EXEC.                                                    16200042
162100                                                                  16210042
162200                                                                  16220042
162300*----------------------------------------------------------------*16230042
162400*    CROSS-CHECK EDITS TO OTHER FIELDS ENTERED ON THE SCREEN     *16240042
162500*    *****************                                           *16250042
162600*                                                                *16260042
162700* IP ADDRESS RANGE CROSS-CHECK EDITS:                            *16270042
162800* 1) IF ONE IP ADDRESS IS ENTERED, BOTH MUST BE ENTERED.         *16280042
162900* 2) THE ENDING IP ADDRESS MUST BE GREATER THAN OR               *16290042
163000*      EQUAL TO THE BEGINNING IP ADDRESS.                        *16300042
163100*                                                                *16310042
163200* VTAM CROSS-CHECK EDITS:                                        *16320042
163300* 1) IF LINE IS ENTERED, UNIT MUST ALSO BE ENTERED;              *16330042
163400* 2) IF UNIT IS ENTERED, LINE MUST ALSO BE ENTERED.              *16340042
163500*                                                                *16350042
163600* VTAM / ADDRESS CROSS-CHECK EDITS:                              *16360042
163700* 1) EITHER VTAM -OR- ADDRESS RANGE MUST BE ENTERED.             *16370042
163800* 2) BOTH VTAM -AND- ADDRESS RANGE MAY BE ENTERED.               *16380042
163900*                                                                *16390042
164000*----------------------------------------------------------------*16400042
164100 3300-CROSSCHECK-FIELD-EDITS.                                     16410042
164200*    *************************************************************16420042
164300*    * CROSSCHECK: IP ADDRESS RANGE (ALL OCTETS)                 *16430042
164400*    *************************************************************16440042
164500     IF  (ASC-IP-ADDR-BEGIN = SPACES)                             16450042
164600     AND (ASC-IP-ADDR-END   = SPACES)                             16460042
164700         CONTINUE                                                 16470042
164800     ELSE                                                         16480042
164900         IF (ASC-IP-ADDR-BEGIN = SPACES)                          16490042
165000         OR (ASC-IP-ADDR-END   = SPACES)                          16500042
165100             SET PS-ERROR                                         16510042
165200                 DP020-MSG-FATAL  TO TRUE                         16520042
165300*            ---- REQUIRED, DUE TO ANOTHER FIELD ENTERED          16530042
165400             MOVE PC-TSYMSG-01177 TO DP020-MSG-NUMBER             16540042
165500             MOVE DP015-UNP-ALP-BRT-OFF                           16550042
165600                                  TO AIPB1A                       16560042
165700                                     AIPB2A                       16570042
165800                                     AIPB3A                       16580042
165900                                     AIPB4A                       16590042
166000                                     AIPE1A                       16600042
166100                                     AIPE2A                       16610042
166200                                     AIPE3A                       16620042
166300                                     AIPE4A                       16630042
166400             MOVE DP015-RED       TO AIPB1C                       16640042
166500                                     AIPB2C                       16650042
166600                                     AIPB3C                       16660042
166700                                     AIPB4C                       16670042
166800                                     AIPE1C                       16680042
166900                                     AIPE2C                       16690042
167000                                     AIPE3C                       16700042
167100                                     AIPE4C                       16710042
167200             MOVE DP015-REVERSE   TO AIPB1H                       16720042
167300                                     AIPB2H                       16730042
167400                                     AIPB3H                       16740042
167500                                     AIPB4H                       16750042
167600                                     AIPE1H                       16760042
167700                                     AIPE2H                       16770042
167800                                     AIPE3H                       16780042
167900                                     AIPE4H                       16790042
168000             MOVE -1              TO AIPB1L                       16800042
168100             SET DP030-SET-CURSOR-APPL-1                          16810042
168200                                  TO TRUE                         16820042
168300         ELSE                                                     16830042
168400             IF  ASC-IP-ADDR-BEGIN > ASC-IP-ADDR-END              16840042
168500                 SET PS-ERROR              TO TRUE                16850042
168600                 SET DP020-MSG-FATAL       TO TRUE                16860042
168700*                ---- END OF RANGE PRECEDED START OF RANGE        16870042
168800                 MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER         16880042
168900                 MOVE DP015-UNP-ALP-BRT-OFF                       16890042
169000                                      TO AIPB1A                   16900042
169100                                         AIPB2A                   16910042
169200                                         AIPB3A                   16920042
169300                                         AIPB4A                   16930042
169400                                         AIPE1A                   16940042
169500                                         AIPE2A                   16950042
169600                                         AIPE3A                   16960042
169700                                         AIPE4A                   16970042
169800                 MOVE DP015-RED       TO AIPB1C                   16980042
169900                                         AIPB2C                   16990042
170000                                         AIPB3C                   17000042
170100                                         AIPB4C                   17010042
170200                                         AIPE1C                   17020042
170300                                         AIPE2C                   17030042
170400                                         AIPE3C                   17040042
170500                                         AIPE4C                   17050042
170600                 MOVE DP015-REVERSE   TO AIPB1H                   17060042
170700                                         AIPB2H                   17070042
170800                                         AIPB3H                   17080042
170900                                         AIPB4H                   17090042
171000                                         AIPE1H                   17100042
171100                                         AIPE2H                   17110042
171200                                         AIPE3H                   17120042
171300                                         AIPE4H                   17130042
171400                 MOVE -1              TO AIPB1L                   17140042
171500                 SET DP030-SET-CURSOR-APPL-1                      17150042
171600                                      TO TRUE                     17160042
171700             END-IF                                               17170042
171800         END-IF                                                   17180042
171900     END-IF.                                                      17190042
172000                                                                  17200042
172100                                                                  17210042
172200*    *************************************************************17220042
172300*    * CROSSCHECK: VTAM (LINE AND UNIT)                          *17230042
172400*    *************************************************************17240042
172500     IF  (ASC-PHYSICAL-UNIT = SPACE   AND                         17250042
172600          ASC-LINE  =  SPACE)                                     17260042
172700         CONTINUE                                                 17270042
172800     ELSE                                                         17280042
172900         IF  ASC-PHYSICAL-UNIT = SPACE                            17290042
173000             SET PS-ERROR         TO TRUE                         17300042
173100             SET DP020-MSG-FATAL  TO TRUE                         17310042
173200*            ---- REQUIRED, DUE TO ANOTHER FIELD ENTERED          17320042
173300             MOVE PC-TSYMSG-01177 TO DP020-MSG-NUMBER             17330042
173400             MOVE DP015-UNP-ALP-BRT-OFF                           17340042
173500                                  TO ALINEA                       17350042
173600                                     APHYUA                       17360042
173700             MOVE DP015-RED       TO ALINEC                       17370042
173800                                     APHYUC                       17380042
173900             MOVE DP015-REVERSE   TO ALINEH                       17390042
174000                                     APHYUH                       17400042
174100             MOVE -1              TO APHYUL                       17410042
174200             SET DP030-SET-CURSOR-APPL-1                          17420042
174300                                  TO TRUE                         17430042
174400         ELSE                                                     17440042
174500             IF  ASC-LINE  = SPACE                                17450042
174600                 SET PS-ERROR         TO TRUE                     17460042
174700                 SET DP020-MSG-FATAL  TO TRUE                     17470042
174800*                ---- REQUIRED, DUE TO ANOTHER FIELD ENTERED      17480042
174900                 MOVE PC-TSYMSG-01177 TO DP020-MSG-NUMBER         17490042
175000                 MOVE DP015-UNP-ALP-BRT-OFF                       17500042
175100                                      TO ALINEA                   17510042
175200                                         APHYUA                   17520042
175300                 MOVE DP015-RED       TO ALINEC                   17530042
175400                                         APHYUC                   17540042
175500                 MOVE DP015-REVERSE   TO ALINEH                   17550042
175600                                         APHYUH                   17560042
175700                 MOVE -1              TO ALINEL                   17570042
175800                 SET DP030-SET-CURSOR-APPL-1                      17580042
175900                                      TO TRUE                     17590042
176000             END-IF                                               17600042
176100         END-IF                                                   17610042
176200     END-IF.                                                      17620042
176300                                                                  17630042
176400                                                                  17640042
176500*    *************************************************************17650042
176600*    * CROSSCHECK: VTAM -AND- IP ADDRESS RANGE                   *17660042
176700*    *************************************************************17670042
176800     IF  (ASC-PHYSICAL-UNIT     = SPACE   AND                     17680042
176900          ASC-LINE              = SPACE   AND                     17690042
177000          ASC-IP-ADDR-B-OCTET1  = SPACE   AND                     17700042
177100          ASC-IP-ADDR-B-OCTET2  = SPACE   AND                     17710042
177200          ASC-IP-ADDR-B-OCTET3  = SPACE   AND                     17720042
177300          ASC-IP-ADDR-B-OCTET4  = SPACE   AND                     17730042
177400          ASC-IP-ADDR-E-OCTET1  = SPACE   AND                     17740042
177500          ASC-IP-ADDR-E-OCTET2  = SPACE   AND                     17750042
177600          ASC-IP-ADDR-E-OCTET3  = SPACE   AND                     17760042
177700          ASC-IP-ADDR-E-OCTET4  = SPACE)                          17770042
177800         SET PS-ERROR         TO TRUE                             17780042
177900         SET DP020-MSG-FATAL  TO TRUE                             17790042
178000*        ---- REQUIRED, DUE TO ANOTHER FIELD ENTERED              17800042
178100         MOVE PC-TSYMSG-01177 TO DP020-MSG-NUMBER                 17810042
178200         MOVE DP015-UNP-ALP-BRT-OFF                               17820042
178300                              TO ALINEA                           17830042
178400                                 APHYUA                           17840042
178500                                 AIPB1A                           17850042
178600                                 AIPB2A                           17860042
178700                                 AIPB3A                           17870042
178800                                 AIPB4A                           17880042
178900                                 AIPE1A                           17890042
179000                                 AIPE2A                           17900042
179100                                 AIPE3A                           17910042
179200                                 AIPE4A                           17920042
179300         MOVE DP015-RED       TO ALINEC                           17930042
179400                                 APHYUC                           17940042
179500                                 AIPB1C                           17950042
179600                                 AIPB2C                           17960042
179700                                 AIPB3C                           17970042
179800                                 AIPB4C                           17980042
179900                                 AIPE1C                           17990042
180000                                 AIPE2C                           18000042
180100                                 AIPE3C                           18010042
180200                                 AIPE4C                           18020042
180300         MOVE DP015-REVERSE   TO ALINEH                           18030042
180400                                 APHYUH                           18040042
180500                                 AIPB1H                           18050042
180600                                 AIPB2H                           18060042
180700                                 AIPB3H                           18070042
180800                                 AIPB4H                           18080042
180900                                 AIPE1H                           18090042
181000                                 AIPE2H                           18100042
181100                                 AIPE3H                           18110042
181200                                 AIPE4H                           18120042
181300         MOVE -1              TO ALINEL                           18130042
181400         SET DP030-SET-CURSOR-APPL-1                              18140042
181500                              TO TRUE                             18150042
181600     END-IF.                                                      18160042
181700                                                                  18170042
181800                                                                  18180042
181900*----------------------------------------------------------------*18190042
182000*    CROSS-CHECK EDITS TO THE DB2 TABLE                          *18200042
182100*    *****************                                           *18210042
182200*                                                                *18220042
182300* IP ADDRESS RANGE CROSS-CHECK EDITS:                            *18230042
182400*    COMPARE WITH RANGE(S) ALREADY ON THE TABLE;                 *18240042
182500*    OVERLAP NOT ALLOWED.                                        *18250042
182600*                                                                *18260042
182700* VTAM CROSS-CHECK EDITS:                                        *18270042
182800*    COMPARE WITH LINE/UNIT COMBINATIONS ALREADY ON THE TABLE;   *18280042
182900*    DUPLICATE NOT ALLOWED -EXCEPT- FOR SPACES.                  *18290042
183000*                                                                *18300042
183100*----------------------------------------------------------------*18310042
183200 3400-CROSSCHECK-TABLE-EDITS.                                     18320042
183300                                                                  18330042
183400     MOVE ASC-IP-ADDR-BEGIN  TO  DK-IP-ADDR-BEG.                  18340042
183500     MOVE ASC-IP-ADDR-END    TO  DK-IP-ADDR-END.                  18350042
183600     MOVE +0                 TO  PV-COUNT-OVERLAP-IP-ADDR.        18360042
183700     IF  (ASC-IP-ADDR-BEGIN = SPACES)                             18370042
183800     AND (ASC-IP-ADDR-END   = SPACES)                             18380042
183900*        *********************************************************18390042
184000*        * NO ENTRY IN THESE OPTIONAL FIELDS                     *18400042
184100*        *********************************************************18410042
184200         CONTINUE                                                 18420042
184300     ELSE                                                         18430042
184400         PERFORM 3410-CHECK-FOR-OVERLAP                           18440042
184500         IF PV-COUNT-OVERLAP-IP-ADDR > ZERO                       18450042
184600             SET PS-ERROR                                         18460042
184700                 DP020-MSG-FATAL  TO TRUE                         18470042
184800*            ---- ADD WOULD RESULT IN AN OVERLAPPING IP ADDR RANGE18480042
184900             MOVE PC-TSYMSG-01176 TO DP020-MSG-NUMBER             18490042
185000             MOVE DP015-UNP-ALP-BRT-OFF                           18500042
185100                                  TO AIPB1A                       18510042
185200                                     AIPB2A                       18520042
185300                                     AIPB3A                       18530042
185400                                     AIPB4A                       18540042
185500                                     AIPE1A                       18550042
185600                                     AIPE2A                       18560042
185700                                     AIPE3A                       18570042
185800                                     AIPE4A                       18580042
185900             MOVE DP015-RED       TO AIPB1C                       18590042
186000                                     AIPB2C                       18600042
186100                                     AIPB3C                       18610042
186200                                     AIPB4C                       18620042
186300                                     AIPE1C                       18630042
186400                                     AIPE2C                       18640042
186500                                     AIPE3C                       18650042
186600                                     AIPE4C                       18660042
186700             MOVE DP015-REVERSE   TO AIPB1H                       18670042
186800                                     AIPB2H                       18680042
186900                                     AIPB3H                       18690042
187000                                     AIPB4H                       18700042
187100                                     AIPE1H                       18710042
187200                                     AIPE2H                       18720042
187300                                     AIPE3H                       18730042
187400                                     AIPE4H                       18740042
187500             MOVE -1              TO AIPB1L                       18750042
187600             SET DP030-SET-CURSOR-APPL-1                          18760042
187700                                  TO TRUE                         18770042
187800         END-IF                                                   18780042
187900     END-IF.                                                      18790042
188000                                                                  18800042
188100                                                                  18810042
188200     MOVE ASC-LINE           TO  DK-LNE-ADDR-NBR.                 18820042
188300     MOVE ASC-PHYSICAL-UNIT  TO  DK-PHYUNT-ADDR-NBR.              18830042
188400     MOVE +0                 TO  PV-COUNT-DUPLICATE-VTAM.         18840042
188500     IF  ASC-LINE          = SPACES                               18850042
188600     AND ASC-PHYSICAL-UNIT = SPACES                               18860042
188700*        *********************************************************18870042
188800*        * NO ENTRY IN THESE OPTIONAL FIELDS                     *18880042
188900*        *********************************************************18890042
189000         CONTINUE                                                 18900042
189100     ELSE                                                         18910042
189200         PERFORM 3420-CHECK-FOR-DUPLICATE                         18920042
189300         IF PV-COUNT-DUPLICATE-VTAM  > ZERO                       18930042
189400             SET PS-ERROR                                         18940042
189500                 DP020-MSG-FATAL  TO TRUE                         18950042
189600*            ---- ADD WOULD RESULT IN A DUPLICATE VTAM            18960042
189700             MOVE PC-TSYMSG-01176 TO DP020-MSG-NUMBER             18970042
189800             MOVE DP015-UNP-ALP-BRT-OFF                           18980042
189900                                  TO ALINEA                       18990042
190000                                     APHYUA                       19000042
190100             MOVE DP015-RED       TO ALINEC                       19010042
190200                                     APHYUC                       19020042
190300             MOVE DP015-REVERSE   TO ALINEH                       19030042
190400                                     APHYUH                       19040042
190500             MOVE -1              TO ALINEL                       19050042
190600             SET DP030-SET-CURSOR-APPL-1                          19060042
190700                                  TO TRUE                         19070042
190800         END-IF                                                   19080042
190900     END-IF.                                                      19090042
191000                                                                  19100042
191100                                                                  19110042
191200*----------------------------------------------------------------*19120042
191300* CHECK ENTERED DATA AGAINST EXISTING ROWS FOR POSSIBLE "BEWTEEN"*19130042
191400* OVERLAPPING IP ADDRESS RANGE(S) -OR- DUPLICATE VTAM (LINE/UNIT).19140042
191500*----------------------------------------------------------------*19150042
191600 3410-CHECK-FOR-OVERLAP.                                          19160042
191700                                                                  19170042
191800     MOVE PC-OPERATING-COMPANY     TO  ASC-DKC-OPERATING-COMPANY. 19180042
191900                                                                  19190042
192000     PERFORM                                                      19200042
192100         WITH TEST AFTER                                          19210042
192200         VARYING PV-RETRY-COUNTER                                 19220042
192300         FROM 1 BY 1                                              19230042
192400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               19240042
192500                   OR (SQLCODE = ZERO))                           19250042
192600         EXEC SQL                                                 19260042
192700             SELECT                                               19270042
192800                 COUNT(*)                                         19280042
192900             INTO                                                 19290042
193000                 :PV-COUNT-OVERLAP-IP-ADDR                        19300042
193100             FROM   TPHYUNT                                       19310042
193200             WHERE                                                19320042
193300*                  *---------------------------------------------*19330042
193400*                  * 1. OVERLAP CONDITION EXISTS ON A ROW...     *19340042
193500*                  *---------------------------------------------*19350042
193600                   (END_RNG_IP_ADDR  >= :DK-IP-ADDR-BEG  AND      19360042
193700                    BEG_RNG_IP_ADDR  <= :DK-IP-ADDR-END)          19370042
193800               AND                                                19380042
193900*                  *---------------------------------------------*19390042
194000*                  * 2. ...WHICH IS NOT THE SAME ROW SELECTED    *19400042
194100*                  *    FOR UPDATE                               *19410042
194200*                  *---------------------------------------------*19420042
194300                   (LNE_ADDR_NBR    <> :ASC-DKC-LNE-ADDR-NBR   AND19430042
194400                    PHYUNT_ADDR_NBR <> :ASC-DKC-PHYUNT-ADDR-NBR   19440042
194500                                                               AND19450042
194600                    LOC_NBR         <> :ASC-DKC-LOC-NBR        AND19460051
194700                    FCLTY_ID        <> :ASC-DKC-FCLTY-N4-COMP  AND19470042
194800                    BEG_RNG_IP_ADDR <> :ASC-DKC-IP-ADDR-BEG    AND19480042
194900                    END_RNG_IP_ADDR <> :ASC-DKC-IP-ADDR-END)      19490042
195000         END-EXEC                                                 19500042
195100                                                                  19510042
195200                                                                  19520042
195300         EVALUATE TRUE                                            19530042
195400             WHEN SQLCODE = ZERO                                  19540042
195500             WHEN SQLCODE = +100                                  19550042
195600             WHEN SQLCODE = -904                                  19560042
195700             WHEN SQLCODE = -913                                  19570042
195800                 CONTINUE                                         19580042
195900             WHEN SQLWARN0 NOT = SPACES                           19590042
196000             WHEN SQLCODE < ZERO                                  19600042
196100             WHEN SQLCODE > ZERO                                  19610042
196200                 MOVE '3410-CHECK-FOR-OVERLAP'                    19620042
196300                                   TO DP013-PARAGRAPH             19630042
196400                 MOVE 'SELECT / COUNT FAILED FOR:'                19640042
196500                                   TO DP013-MESSAGE-TEXT(1)       19650042
196600                 MOVE DK-IP-ADDR-BEG                              19660042
196700                                   TO PM-ABEND-RANGE-B            19670042
196800                 MOVE DK-IP-ADDR-END                              19680042
196900                                   TO PM-ABEND-RANGE-E            19690042
197000                 MOVE PM-ABEND-RANGES                             19700042
197100                                   TO DP013-MESSAGE-TEXT(2)       19710042
197200                 MOVE SQLCA        TO DP013-SQLCA                 19720042
197300                 MOVE 'TPHYUNT'    TO DP013-DB2-TABLE-NAME (1)    19730042
197400                 SET DP013-DB2-ABEND                              19740042
197500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           19750042
197600                 PERFORM DP013-0000-PROCESS-ABEND                 19760042
197700         END-EVALUATE                                             19770042
197800     END-PERFORM.                                                 19780042
197900                                                                  19790042
198000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        19800042
198100         MOVE '3410-CHECK-FOR-OVERLAP'                            19810042
198200                                   TO DP013-PARAGRAPH             19820042
198300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT A PHY19830042
198400-             'SICAL UNIT'         TO DP013-MESSAGE-TEXT (1)      19840042
198500         MOVE SQLCA                TO DP013-SQLCA                 19850042
198600         MOVE 'TPHYUNT '           TO DP013-DB2-TABLE-NAME (1)    19860042
198700         SET DP013-DB2-ABEND                                      19870042
198800             DP013-XCTL-DISPLAY-RESTART                           19880042
198900                                   TO TRUE                        19890042
199000         PERFORM DP013-0000-PROCESS-ABEND                         19900042
199100     END-IF.                                                      19910042
199200                                                                  19920042
199300                                                                  19930042
199400*----------------------------------------------------------------*19940042
199500* CHECK ENTERED DATA AGAINST EXISTING ROWS FOR POSSIBLE          *19950042
199600* DUPLICATE VTAM (LINE/UNIT).                                    *19960042
199700*----------------------------------------------------------------*19970042
199800 3420-CHECK-FOR-DUPLICATE.                                        19980042
199900                                                                  19990042
200000     MOVE PC-OPERATING-COMPANY     TO  ASC-DKC-OPERATING-COMPANY. 20000042
200100                                                                  20010042
200200     PERFORM                                                      20020042
200300         WITH TEST AFTER                                          20030042
200400         VARYING PV-RETRY-COUNTER                                 20040042
200500         FROM 1 BY 1                                              20050042
200600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               20060042
200700                   OR (SQLCODE = ZERO))                           20070042
200800         EXEC SQL                                                 20080042
200900             SELECT COUNT(*)                                      20090042
201000             INTO   :PV-COUNT-DUPLICATE-VTAM                      20100042
201100             FROM   TPHYUNT                                       20110042
201200             WHERE                                                20120042
201300*                  *---------------------------------------------*20130042
201400*                  * 1. DUPLICATE CONDITION EXISTS ON A ROW...   *20140042
201500*                  *---------------------------------------------*20150042
201600                   (LNE_ADDR_NBR      =  :DK-LNE-ADDR-NBR AND     20160042
201700                    PHYUNT_ADDR_NBR   =  :DK-PHYUNT-ADDR-NBR)     20170042
201800               AND                                                20180042
201900*                  *---------------------------------------------*20190042
202000*                  * 2. ...WHICH IS NOT THE SAME ROW SELECTED    *20200042
202100*                  *    FOR UPDATE                               *20210042
202200*                  *---------------------------------------------*20220042
202300                   (LNE_ADDR_NBR    <> :ASC-DKC-LNE-ADDR-NBR   AND20230042
202400                    PHYUNT_ADDR_NBR <> :ASC-DKC-PHYUNT-ADDR-NBR   20240042
202500                                                               AND20250042
202600                    LOC_NBR         <> :ASC-DKC-LOC-NBR        AND20260051
202700                    FCLTY_ID        <> :ASC-DKC-FCLTY-N4-COMP  AND20270042
202800                    BEG_RNG_IP_ADDR <> :ASC-DKC-IP-ADDR-BEG    AND20280042
202900                    END_RNG_IP_ADDR <> :ASC-DKC-IP-ADDR-END)      20290042
203000         END-EXEC                                                 20300042
203100                                                                  20310042
203200         EVALUATE TRUE                                            20320042
203300             WHEN SQLCODE = ZERO                                  20330042
203400             WHEN SQLCODE = +100                                  20340042
203500             WHEN SQLCODE = -904                                  20350042
203600             WHEN SQLCODE = -913                                  20360042
203700             WHEN SQLCODE = -913                                  20370042
203800                 CONTINUE                                         20380042
203900             WHEN SQLWARN0 NOT = SPACES                           20390042
204000             WHEN SQLCODE < ZERO                                  20400042
204100             WHEN SQLCODE > ZERO                                  20410042
204200                 MOVE '3420-CHECK-FOR-DUPLICATE'                  20420042
204300                                   TO DP013-PARAGRAPH             20430042
204400                 MOVE 'SELECT / COUNT FAILED FOR:'                20440042
204500                                   TO DP013-MESSAGE-TEXT(1)       20450042
204600                 MOVE DK-LNE-ADDR-NBR                             20460042
204700                                   TO PM-ABEND-KEYFIELD1          20470042
204800                 MOVE DK-PHYUNT-ADDR-NBR                          20480042
204900                                   TO PM-ABEND-KEYFIELD2          20490042
205000                 MOVE PM-ABEND-KEYFIELDS                          20500042
205100                                   TO DP013-MESSAGE-TEXT(2)       20510042
205200                 MOVE SQLCA        TO DP013-SQLCA                 20520042
205300                 MOVE 'TPHYUNT'    TO DP013-DB2-TABLE-NAME (1)    20530042
205400                 SET DP013-DB2-ABEND                              20540042
205500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           20550042
205600                 PERFORM DP013-0000-PROCESS-ABEND                 20560042
205700         END-EVALUATE                                             20570042
205800     END-PERFORM.                                                 20580042
205900                                                                  20590042
206000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        20600042
206100         MOVE '3420-CHECK-FOR-DUPLICATE'                          20610042
206200                                   TO DP013-PARAGRAPH             20620042
206300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT A PHY20630042
206400-             'SICAL UNIT'         TO DP013-MESSAGE-TEXT (1)      20640042
206500         MOVE SQLCA                TO DP013-SQLCA                 20650042
206600         MOVE 'TPHYUNT '           TO DP013-DB2-TABLE-NAME (1)    20660042
206700         SET DP013-DB2-ABEND                                      20670042
206800             DP013-XCTL-DISPLAY-RESTART                           20680042
206900                                   TO TRUE                        20690042
207000         PERFORM DP013-0000-PROCESS-ABEND                         20700042
207100     END-IF.                                                      20710042
207200                                                                  20720042
207300                                                                  20730042
207400*----------------------------------------------------------------*20740042
207500*    VALIDATE THE QUEUE WAS PASSED AND DISPLAY FOR THE FIRST     *20750042
207600*    ENTRY:                                                      *20760042
207700*    PRESENT DATA SELECTED IN LIST PROGRAM, ON THE SCREEN FOR    *20770042
207800*    THE PERSON TO UPDATE IT.                                    *20780042
207900*    1- GET DATA KEYS PASSED IN TS QUEUE FROM LIST PROGRAM;      *20790042
208000*       THEIR VALUES ARE PRESENTLY STORED IN THE APPLICATION     *20800042
208100*       SPECIFIC COMMAREA.                                       *20810042
208200*    2- GET DATA FROM DB2 TABLE, USING DATA KEYS.                *20820042
208300*    3- POPULATE SCREEN VARIABLES WITH DATA FROM DB2 TABLE.      *20830042
208400*    (NOTE: IN THIS APPLICATION, ALL NEEDED DATA FIELDS ARE      *20840042
208500*           PASSED FROM THE LIST PROGRAM; ACCESS DB2 TABLE AT    *20850042
208600*           THIS TIME JUST TO VERIFY ALL KEY CONSTRUCTS.)        *20860042
208700*----------------------------------------------------------------*20870042
208800 4000-BUILD-INITIAL-PANEL.                                        20880042
208900                                                                  20890042
209000     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       20900042
209100     MOVE -1                       TO ASTORL.                     20910042
209200                                                                  20920042
209300     MOVE PC-OPERATING-COMPANY     TO DK-OPERATING-COMPANY.       20930042
209400     MOVE ASC-LOC-NBR              TO DK-LOC-NBR.                 20940051
209700     MOVE ASC-FCLTY-N              TO DK-FCLTY-N                  20970042
209800                                      DK-FCLTY-N4-COMP.           20980042
209900     MOVE ASC-FCLTY                TO DK-FCLTY-X.                 20990042
210000     MOVE ASC-LINE                 TO DK-LNE-ADDR-NBR.            21000042
210100     MOVE ASC-PHYSICAL-UNIT        TO DK-PHYUNT-ADDR-NBR.         21010042
210200     MOVE ASC-IP-ADDR-BEGIN        TO DK-IP-ADDR-BEG.             21020042
210300     MOVE ASC-IP-ADDR-END          TO DK-IP-ADDR-END.             21030042
210400                                                                  21040042
210500     PERFORM 4100-GET-OBJECT-TO-DISPLAY.                          21050042
210600     IF  SQLCODE = ZERO                                           21060042
210800         MOVE PHYUNT-LNE-ADDR-NBR      TO ASC-LINE                21080042
210900         MOVE PHYUNT-PHYUNT-ADDR-NBR   TO ASC-PHYSICAL-UNIT       21090042
211000         MOVE PHYUNT-LOC-NBR           TO ASC-LOC-NBR             21101051
211200         MOVE PHYUNT-FCLTY-ID          TO ASC-FCLTY-N             21120042
211300         MOVE PHYUNT-BEG-RNG-IP-ADDR   TO ASC-IP-ADDR-BEGIN       21130042
211400         MOVE PHYUNT-END-RNG-IP-ADDR   TO ASC-IP-ADDR-END         21140042
211500         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     21150042
211600     END-IF.                                                      21160042
211700                                                                  21170042
211800                                                                  21180042
211900*----------------------------------------------------------------*21190042
212000*    GET PHYSICAL UNIT ROW FROM TABLE TPHYUNT TO DISPLAY.        *21200042
212100*----------------------------------------------------------------*21210042
212200 4100-GET-OBJECT-TO-DISPLAY.                                      21220042
212300     PERFORM                                                      21230042
212400         WITH TEST AFTER                                          21240042
212500         VARYING PV-RETRY-COUNTER                                 21250042
212600         FROM 1 BY 1                                              21260042
212700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               21270042
212800                   OR (SQLCODE = ZERO)                            21280042
212900                   OR (SQLCODE = +100))                           21290042
213000                                                                  21300042
213100         EXEC SQL                                                 21310042
213200             SELECT LNE_ADDR_NBR,                                 21320042
213300                    PHYUNT_ADDR_NBR,                              21330042
213400                    STR_NBR,                                      21340042
213500                    OPER_UNT_NBR,                                 21350042
213600                    FCLTY_ID,                                     21360042
213700                    BEG_RNG_IP_ADDR,                              21370042
213800                    END_RNG_IP_ADDR,                              21380051
                          LOC_NBR                                       21381051
213900             INTO   :PHYUNT-LNE-ADDR-NBR,                         21390042
214000                    :PHYUNT-PHYUNT-ADDR-NBR,                      21400042
214100                    :PHYUNT-STR-NBR,                              21410042
214200                    :PHYUNT-OPER-UNT-NBR,                         21420042
214300                    :PHYUNT-FCLTY-ID,                             21430042
214400                    :PHYUNT-BEG-RNG-IP-ADDR,                      21440042
214500                    :PHYUNT-END-RNG-IP-ADDR,                      21450051
                          :PHYUNT-LOC-NBR                               21451051
214600             FROM   TPHYUNT                                       21460042
214700             WHERE (LNE_ADDR_NBR    = :DK-LNE-ADDR-NBR     AND    21470042
214800                    PHYUNT_ADDR_NBR = :DK-PHYUNT-ADDR-NBR  AND    21480042
214900                    LOC_NBR         = :DK-LOC-NBR          AND    21490051
215100                    FCLTY_ID        = :DK-FCLTY-N4-COMP    AND    21510042
215200                    BEG_RNG_IP_ADDR = :DK-IP-ADDR-BEG      AND    21520042
215300                    END_RNG_IP_ADDR = :DK-IP-ADDR-END)            21530042
215400         END-EXEC                                                 21540042
215500                                                                  21550042
215600         EVALUATE TRUE                                            21560042
215700             WHEN SQLCODE = ZERO                                  21570042
215800             WHEN SQLCODE = +100                                  21580042
215900             WHEN SQLCODE = -904                                  21590042
216000             WHEN SQLCODE = -913                                  21600042
216100                 CONTINUE                                         21610042
216200             WHEN SQLWARN0 NOT = SPACES                           21620042
216300             WHEN SQLCODE < ZERO                                  21630042
216400             WHEN SQLCODE > ZERO                                  21640042
216500                 MOVE '4100-GET-OBJECT-TO-DISPLAY'                21650042
216600                                   TO DP013-PARAGRAPH             21660042
216700                 MOVE 'SELECT FAILED FOR:'                        21670042
216800                                   TO DP013-MESSAGE-TEXT (1)      21680042
216900                 MOVE SQLCA        TO DP013-SQLCA                 21690042
217000                 MOVE 'TPHYUNT'    TO DP013-DB2-TABLE-NAME (1)    21700042
217100                 SET DP013-DB2-ABEND                              21710042
217200                     DP013-XCTL-DISPLAY-RESTART                   21720042
217300                                   TO TRUE                        21730042
217400                 PERFORM DP013-0000-PROCESS-ABEND                 21740042
217500         END-EVALUATE                                             21750042
217600     END-PERFORM.                                                 21760042
217700                                                                  21770042
217800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        21780042
217900         MOVE '4100-GET-OBJECT-TO-DISPLAY'                        21790042
218000                                   TO DP013-PARAGRAPH             21800042
218100         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     21810042
218200                                   TO DP013-MESSAGE-TEXT (1)      21820042
218300         MOVE 'PHYSICAL UNIT'      TO DP013-MESSAGE-TEXT (2)      21830042
218400         MOVE SQLCA                TO DP013-SQLCA                 21840042
218500         MOVE 'TPHYUNT'            TO DP013-DB2-TABLE-NAME (1)    21850042
218600         SET DP013-DB2-ABEND                                      21860042
218700             DP013-XCTL-DISPLAY-RESTART                           21870042
218800                                   TO TRUE                        21880042
218900         PERFORM DP013-0000-PROCESS-ABEND                         21890042
219000     END-IF.                                                      21900042
219100                                                                  21910042
219200                                                                  21920042
219300*----------------------------------------------------------------*21930042
219400*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *21940042
219500*----------------------------------------------------------------*21950042
219600 4400-MOVE-COMMAREA-TO-SCREEN.                                    21960042
219700     MOVE ASC-LOC-X                TO ASTORO.                     21970051
219800     MOVE ASC-FCLTY                TO AFCLTO.                     21980042
219900     MOVE ASC-LINE                 TO ALINEO.                     21990042
220000     MOVE ASC-PHYSICAL-UNIT        TO APHYUO.                     22000042
220100     MOVE ASC-IP-ADDR-B-OCTET1     TO AIPB1O.                     22010042
220200     MOVE ASC-IP-ADDR-B-OCTET2     TO AIPB2O.                     22020042
220300     MOVE ASC-IP-ADDR-B-OCTET3     TO AIPB3O.                     22030042
220400     MOVE ASC-IP-ADDR-B-OCTET4     TO AIPB4O.                     22040042
220500     MOVE ASC-IP-ADDR-E-OCTET1     TO AIPE1O.                     22050042
220600     MOVE ASC-IP-ADDR-E-OCTET2     TO AIPE2O.                     22060042
220700     MOVE ASC-IP-ADDR-E-OCTET3     TO AIPE3O.                     22070042
220800     MOVE ASC-IP-ADDR-E-OCTET4     TO AIPE4O.                     22080042
220900                                                                  22090042
221000                                                                  22100042
221100*----------------------------------------------------------------*22110042
221200* APPLY THE CHANGES TO THE "PHYSICAL UNIT" TO THE DB2 TABLE.     *22120042
221300*----------------------------------------------------------------*22130042
221400 5000-POPULATE-PHYUNT-FIELDS.                                     22140042
221500     MOVE PC-OPERATING-COMPANY     TO PHYUNT-OPERCO-NBR.          22150042
221600     MOVE ASC-LINE                 TO PHYUNT-LNE-ADDR-NBR.        22160042
221700     MOVE ASC-PHYSICAL-UNIT        TO PHYUNT-PHYUNT-ADDR-NBR.     22170042
221800     MOVE ASC-LOC-X(3:3)           TO PHYUNT-STR-NBR.             22180051
221900     MOVE ASC-LOC-NBR              TO PHYUNT-OPER-UNT-NBR.        22190051
222000     MOVE ASC-FCLTY-N              TO PHYUNT-FCLTY-ID.            22200042
222100     MOVE ASC-IP-ADDR-BEGIN        TO PHYUNT-BEG-RNG-IP-ADDR.     22210042
222200     MOVE ASC-IP-ADDR-END          TO PHYUNT-END-RNG-IP-ADDR.     22220042
           MOVE ASC-LOC-NBR              TO PHYUNT-LOC-NBR.             22221051
222300                                                                  22230042
222400                                                                  22240042
222500*----------------------------------------------------------------*22250042
222600* UPDATE A ROW ON THE TPHYUNT TABLE.                             *22260042
222700*----------------------------------------------------------------*22270042
222800 5100-UPDATE-ROW-ON-TABLE.                                        22280042
222900     PERFORM                                                      22290042
223000         WITH TEST AFTER                                          22300042
223100         VARYING PV-RETRY-COUNTER                                 22310042
223200         FROM 1 BY 1                                              22320042
223300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               22330042
223400                   OR (SQLCODE = ZERO))                           22340042
223500         EXEC SQL                                                 22350042
223600             UPDATE TPHYUNT                                       22360042
223700                SET OPERCO_NBR      = :PHYUNT-OPERCO-NBR,         22370042
223800                    LNE_ADDR_NBR    = :PHYUNT-LNE-ADDR-NBR,       22380042
223900                    PHYUNT_ADDR_NBR = :PHYUNT-PHYUNT-ADDR-NBR,    22390042
224000                    STR_NBR         = :PHYUNT-STR-NBR,            22400042
224100                    OPER_UNT_NBR    = :PHYUNT-OPER-UNT-NBR,       22410042
224200                    FCLTY_ID        = :PHYUNT-FCLTY-ID,           22420042
224300                    BEG_RNG_IP_ADDR = :PHYUNT-BEG-RNG-IP-ADDR,    22430042
224400                    END_RNG_IP_ADDR = :PHYUNT-END-RNG-IP-ADDR,    22440053
224100                    LOC_NBR         = :PHYUNT-LOC-NBR             22441053
224500             WHERE (LNE_ADDR_NBR    = :ASC-DKC-LNE-ADDR-NBR  AND  22450042
224600                    PHYUNT_ADDR_NBR = :ASC-DKC-PHYUNT-ADDR-NBR    22460042
224700                                                              AND 22470042
224800                    LOC_NBR         = :ASC-DKC-LOC-NBR        AND 22480051
224900                    FCLTY_ID        = :ASC-DKC-FCLTY-N4-COMP  AND 22490042
225000                    BEG_RNG_IP_ADDR = :ASC-DKC-IP-ADDR-BEG    AND 22500042
225100                    END_RNG_IP_ADDR = :ASC-DKC-IP-ADDR-END)       22510042
225200         END-EXEC                                                 22520042
225300                                                                  22530042
225400                                                                  22540042
225500         EVALUATE TRUE                                            22550042
225600             WHEN SQLCODE = ZERO                                  22560046
225700*----------------------------------------------------------------*22570046
225800*            UPDATE "CURRENT DATA KEY"                           *22580046
225900*----------------------------------------------------------------*22590046
226000                MOVE PHYUNT-LNE-ADDR-NBR TO ASC-DKC-LNE-ADDR-NBR  22600047
226100                MOVE PHYUNT-PHYUNT-ADDR-NBR                       22610046
226200                                         TO                       22620046
226300                                         ASC-DKC-PHYUNT-ADDR-NBR  22630046
226400                MOVE PHYUNT-LOC-NBR      TO ASC-DKC-LOC-NBR       22640051
226500                MOVE PHYUNT-FCLTY-ID     TO ASC-DKC-FCLTY-N4-COMP 22650046
226600                MOVE PHYUNT-BEG-RNG-IP-ADDR                       22660046
226700                                         TO ASC-DKC-IP-ADDR-BEG   22670046
226800                MOVE PHYUNT-END-RNG-IP-ADDR                       22680046
226900                                         TO ASC-DKC-IP-ADDR-END   22690046
227000             WHEN SQLCODE = -904                                  22700042
227100             WHEN SQLCODE = -913                                  22710042
227200                 CONTINUE                                         22720042
227300             WHEN SQLCODE = +100                                  22730046
227400                 MOVE '5100-UPDATE-ROW-ON-TABLE'                  22740042
227500                                   TO DP013-PARAGRAPH             22750042
227600                 MOVE 'UPDATE OF ROW ON THE PHYSICAL UNIT TABLE'  22760042
227700                                   TO DP013-MESSAGE-TEXT(1)       22770042
227800                 MOVE 'FAILED; ROW NOT FOUND:'                    22780046
227900                                   TO DP013-MESSAGE-TEXT(2)       22790042
228000                 MOVE ASC-DKC-LNE-ADDR-NBR                        22800046
228100                                   TO PM-ABEND-KEYFIELD1          22810042
228200                 MOVE ASC-DKC-PHYUNT-ADDR-NBR                     22820046
228300                                   TO PM-ABEND-KEYFIELD2          22830042
228400                 MOVE PM-ABEND-KEYFIELDS                          22840042
228500                                   TO DP013-MESSAGE-TEXT(3)       22850042
228600                 MOVE ASC-DKC-IP-ADDR-BEG                         22860046
228700                                   TO PM-ABEND-RANGE-B            22870042
228800                 MOVE ASC-DKC-IP-ADDR-END                         22880046
228900                                   TO PM-ABEND-RANGE-E            22890042
229000                 MOVE PM-ABEND-RANGES                             22900042
229100                                   TO DP013-MESSAGE-TEXT(4)       22910042
229200                 MOVE SQLCA        TO DP013-SQLCA                 22920042
229300                 MOVE 'TPHYUNT'    TO DP013-DB2-TABLE-NAME (1)    22930042
229400                 SET DP013-DB2-ABEND                              22940042
229500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           22950042
229600                 PERFORM DP013-0000-PROCESS-ABEND                 22960042
229700             WHEN SQLWARN0 NOT = SPACES                           22970046
229800             WHEN SQLCODE < ZERO                                  22980046
229900             WHEN SQLCODE > ZERO                                  22990046
230000                 MOVE '5100-UPDATE-ROW-ON-TABLE'                  23000046
230100                                   TO DP013-PARAGRAPH             23010046
230200                 MOVE 'UPDATE OF ROW ON THE PHYSICAL UNIT TABLE'  23020046
230300                                   TO DP013-MESSAGE-TEXT(1)       23030046
230400                 MOVE 'FAILED FOR: '                              23040046
230500                                   TO DP013-MESSAGE-TEXT(2)       23050046
230600                 MOVE PHYUNT-LNE-ADDR-NBR                         23060046
230700                                   TO PM-ABEND-KEYFIELD1          23070046
230800                 MOVE PHYUNT-PHYUNT-ADDR-NBR                      23080046
230900                                   TO PM-ABEND-KEYFIELD2          23090046
231000                 MOVE PM-ABEND-KEYFIELDS                          23100046
231100                                   TO DP013-MESSAGE-TEXT(3)       23110046
231200                 MOVE PHYUNT-BEG-RNG-IP-ADDR                      23120046
231300                                   TO PM-ABEND-RANGE-B            23130046
231400                 MOVE PHYUNT-END-RNG-IP-ADDR                      23140046
231500                                   TO PM-ABEND-RANGE-E            23150046
231600                 MOVE PM-ABEND-RANGES                             23160046
231700                                   TO DP013-MESSAGE-TEXT(4)       23170046
231800                 MOVE SQLCA        TO DP013-SQLCA                 23180046
231900                 MOVE 'TPHYUNT'    TO DP013-DB2-TABLE-NAME (1)    23190046
232000                 SET DP013-DB2-ABEND                              23200046
232100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           23210046
232200                 PERFORM DP013-0000-PROCESS-ABEND                 23220046
232300         END-EVALUATE                                             23230046
232400     END-PERFORM.                                                 23240042
232500                                                                  23250042
232600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        23260042
232700         MOVE '5100-UPDATE-ROW-ON-TABLE'                          23270042
232800                                   TO DP013-PARAGRAPH             23280042
232900         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO UPDATE THIS 23290042
233000-             'PHYSICAL UNIT'      TO DP013-MESSAGE-TEXT (1)      23300042
233100         MOVE SQLCA                TO DP013-SQLCA                 23310042
233200         MOVE 'TPHYUNT '           TO DP013-DB2-TABLE-NAME (1)    23320042
233300         SET DP013-DB2-ABEND                                      23330042
233400             DP013-XCTL-DISPLAY-RESTART                           23340042
233500                                   TO TRUE                        23350042
233600         PERFORM DP013-0000-PROCESS-ABEND                         23360042
233700     END-IF.                                                      23370042
233800                                                                  23380042
233900                                                                  23390042
234000*----------------------------------------------------------------*23400042
234100* RECORD IN THE SELECTION TEMP STORAGE QUEUE THE FACT THAT THIS  *23410042
234200* OBJECT WAS PROCESSED: UPDATE.                                  *23420042
234300*----------------------------------------------------------------*23430042
234400 5200-UPDATE-SELECTION-QUEUE.                                     23440042
234500     PERFORM 9100-READ-SEL-QUEUE.                                 23450042
234600                                                                  23460042
234700     SET DP252-UPD (ASC-SEL-SUB) TO TRUE.                         23470042
234800                                                                  23480042
234900     PERFORM 9200-REWRITE-SEL-QUEUE.                              23490042
235000                                                                  23500042
235100                                                                  23510042
235200*----------------------------------------------------------------*23520042
235300* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *23530042
235400*----------------------------------------------------------------*23540042
235500 9100-READ-SEL-QUEUE.                                             23550042
235600     EXEC CICS                                                    23560042
235700         READQ TS                                                 23570042
235800             QUEUE (ASC-SEL-QUEUE-NAME)                           23580042
235900             INTO  (DP252-PHYS-UNIT-SEL-REC)                      23590042
236000             ITEM  (ASC-SEL-ITEM)                                 23600042
236100             RESP  (PV-CICS-RESPONSE)                             23610042
236200     END-EXEC.                                                    23620042
236300                                                                  23630042
236400     IF  PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL)                   23640042
236500         CONTINUE                                                 23650042
236600     ELSE                                                         23660042
236700         SET DP013-LOGIC-ABEND                                    23670042
236800             DP013-NO-ROLLBACK     TO TRUE                        23680042
236900         MOVE '9100-READ-SEL-QUEUE'                               23690042
237000                                   TO DP013-PARAGRAPH             23700042
237100         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   23710042
237200                                   TO DP013-MESSAGE-TEXT (1)      23720042
237300         PERFORM DP013-0000-PROCESS-ABEND                         23730042
237400     END-IF.                                                      23740042
237500                                                                  23750042
237600                                                                  23760042
237700*----------------------------------------------------------------*23770042
237800* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *23780042
237900*----------------------------------------------------------------*23790042
238000 9200-REWRITE-SEL-QUEUE.                                          23800042
238100     EXEC CICS                                                    23810042
238200          WRITEQ TS                                               23820042
238300              QUEUE  (ASC-SEL-QUEUE-NAME)                         23830042
238400              FROM   (DP252-PHYS-UNIT-SEL-REC)                    23840042
238500              ITEM   (ASC-SEL-ITEM)                               23850042
238600              RESP   (PV-CICS-RESPONSE)                           23860042
238700              REWRITE                                             23870042
238800     END-EXEC.                                                    23880042
238900                                                                  23890042
239000     IF  PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)               23900042
239100         SET DP013-CICS-ABEND                                     23910042
239200             DP013-NO-ROLLBACK     TO TRUE                        23920042
239300         MOVE '9200-REWRITE-SEL-QUEUE'                            23930042
239400                                   TO DP013-PARAGRAPH             23940042
239500         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   23950042
239600                                   TO DP013-MESSAGE-TEXT (1)      23960042
239700         PERFORM DP013-0000-PROCESS-ABEND                         23970042
239800     END-IF.                                                      23980042
239900                                                                  23990042
240000                                                                  24000042
240100*----------------------------------------------------------------*24010042
240200*    ABEND PROCESSOR MODULE                                      *24020042
240300*----------------------------------------------------------------*24030042
240400     COPY DPPD013.                                                24040042
