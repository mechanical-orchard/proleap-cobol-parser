000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    XSKUP045.                                         00020000
000300 AUTHOR.        BARB ERTL.                                        00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  10/29/2002.                                       00050000
000600 DATE-COMPILED.                                                   00060000
000700******************************************************************00070000
000800**  WH_ATTRIBUTES MESSAGE TO POPULATE XST_LOC                     00080000
000900******************************************************************00090000
001000**THIS IS A CALLED MODULE FOR LOCATION TABLES.  THIS PROGRAM      00100000
001100**     WILL PERFORM UPDATES/INSERTS/DELETES FOR THE XST_LOC TABLE.00110006
001200**     IT DOES THE FOLLOWING WITH THESE RETURN CODES:             00120006
001300**     0000 - END PROGRAM                                         00130000
001400**    -0530 - END PROGRAM                                         00140000
001500**    -0803 - END PROGRAM                                         00150000
001600**    -0911 - RETRY INSERT UP TO 5 TIMES AND THEN END PROGRAM     00160000
001700******************************************************************00170000
001800 ENVIRONMENT DIVISION.                                            00180000
001900 CONFIGURATION SECTION.                                           00190000
002000 SOURCE-COMPUTER.  IBM-3090.                                      00200000
002100 OBJECT-COMPUTER.  IBM-3090.                                      00210000
002200 DATA DIVISION.                                                   00220000
002300                                                                  00230000
002400 WORKING-STORAGE SECTION.                                         00240000
002500******************************************************************00250000
002600**PROGRAM SWITCHES                                                00260000
002700******************************************************************00270000
002800 01  PS-PROGRAM-SWITCHES.                                         00280000
002900     05  PS-PROCESS-CONTINUE-SW      PIC X(01)  VALUE 'Y'.        00290000
003000         88  PS-PROCESS-CONTINUE                VALUE 'Y'.        00300000
003100         88  PS-PROCESS-COMPLETE                VALUE 'N'.        00310000
003200******************************************************************00320000
003300**PROGRAM CONSTANTS                                               00330000
003400******************************************************************00340000
003500 01  PC-PROGRAM-CONSTANTS.                                        00350000
003600     05  PC-RETRY-MAX                PIC 9(01)  VALUE 5.          00360000
003700******************************************************************00370000
003800**PROGRAM VARIABLES                                               00380000
003900******************************************************************00390000
004000 01  PV-PROGRAM-VARIABLES.                                        00400000
004100     05  PV-RETRY-COUNTER               PIC  9(01)  VALUE ZEROS.  00410000
004200******************************************************************00420000
004300**COPYBOOKS                                                       00430000
004400******************************************************************00440000
004500***DB2 MESSAGE AREA                                               00450000
004600     COPY SQLCA2.                                                 00460008
004700***MESSAGE COPYBOOK                                               00470000
004800     COPY HORD100.                                                00480008
004900******************************************************************00490000
005000**TABLE INCLUSIONS                                                00500000
005100******************************************************************00510000
005200***DB2 COMMUNICATIONS AREA                                        00520000
005300     EXEC SQL                                                     00530000
005400          INCLUDE SQLCA                                           00540000
005500     END-EXEC.                                                    00550000
005600* ------------------------------------------------------------- * 00560000
005700*  SQL AND COBOL DECLARATIONS FOR LOCATION TABLE (XST_LOC)        00570004
005800* ------------------------------------------------------------- * 00580000
005900     EXEC SQL                                                     00590000
006000         INCLUDE XST00001                                         00600000
006100     END-EXEC.                                                    00610000
006200                                                                  00620000
006300 LINKAGE SECTION.                                                 00630000
006400******************************************************************00640000
006500**LINKAGE VARIABLES                                               00650000
006600******************************************************************00660000
006700 01  LV-LINKAGE-VARIABLES.                                        00670002
006800     05  LV-HORD100-RECORD               PIC X(500).              00680002
006900     05  LV-RETURN-CODE                  PIC S9(04).              00690002
007000                                                                  00700002
007100 PROCEDURE DIVISION USING LV-LINKAGE-VARIABLES.                   00710002
007200******************************************************************00720000
007300 0000-MAINLINE.                                                   00730000
007400                                                                  00740000
007500      PERFORM 1000-INITIALIZATION.                                00750000
007600      PERFORM 2000-PROCESS-MESSAGE.                               00760000
007700      PERFORM 9999-WRAPUP.                                        00770000
007800                                                                  00780000
007900***************************************************************** 00790000
008000**INITIALIZATION AREA - ALL MOVES TO UPDATE/INSERT                00800000
008100***************************************************************** 00810000
008200 1000-INITIALIZATION.                                             00820000
008300                                                                  00830000
008400     INITIALIZE PV-RETRY-COUNTER.                                 00840000
008500     SET PS-PROCESS-CONTINUE TO TRUE.                             00850007
008600                                                                  00860000
008700     MOVE LV-HORD100-RECORD          TO HORD100-RECORD.           00870000
008800                                                                  00880000
008900     INITIALIZE DCLXST00001.                                      00890000
009000                                                                  00900000
009100     MOVE HO100-WHATTR-WH            TO XST00001-LOC-NBR.         00910000
009200     MOVE HO100-WHATTR-LOC-TYP-CDE   TO XST00001-LOC-TYP-CDE.     00920000
009300     MOVE HO100-WHATTR-NM-5-ABBR     TO XST00001-LOC-5-ABBR-NM.   00930000
009400     MOVE HO100-WHATTR-NM-10-ABBR    TO XST00001-LOC-10-ABBR-NM.  00940001
009500     MOVE HO100-WHATTR-OPN-DTE       TO XST00001-OPN-DTE.         00950000
009600     MOVE HO100-WHATTR-CLO-DTE       TO XST00001-CLO-DTE.         00960000
009700     MOVE HO100-WHATTR-E-BUS-LOC-IND TO XST00001-E-BUS-IND.       00970000
009800     MOVE HO100-WHATTR-DST-IND       TO XST00001-DST-IND.         00980000
009900     MOVE HO100-WHATTR-OCPNC-DTE     TO XST00001-OCPNC-DTE.       00990000
010000                                                                  01000000
010100***************************************************************** 01010000
010200**MAIN PROGRAM LOGIC - READS ACTION TYPE ON HORD100 RECORD        01020000
010300***************************************************************** 01030000
010400 2000-PROCESS-MESSAGE.                                            01040000
010500                                                                  01050000
010600     EVALUATE TRUE                                                01060000
010700        WHEN HO100-ACTN-TYP-INSERT                                01070000
010800        WHEN HO100-ACTN-TYP-UPDATE                                01080000
010900            PERFORM 2200-UPDATE-DATA                              01090000
011000                                                                  01100000
011100        WHEN HO100-ACTN-TYP-DELETE                                01110000
011200             CONTINUE                                             01120000
011300     END-EVALUATE.                                                01130000
011400                                                                  01140000
011500******************************************************************01150000
011600**UPDATE ACTION TYPE                                              01160000
011700******************************************************************01170000
011800 2200-UPDATE-DATA.                                                01180000
011900                                                                  01190000
012000     PERFORM                                                      01200000
012100         WITH TEST AFTER                                          01210000
012200         VARYING PV-RETRY-COUNTER                                 01220000
012300         FROM 1 BY 1                                              01230000
012400         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    01240000
012500            OR SQLCODE = 0                                        01250000
012600            OR PS-PROCESS-COMPLETE                                01260000
012700                                                                  01270000
012800        EXEC SQL                                                  01280000
012900          UPDATE XST_LOC                                          01290000
013000          SET LOC_TYP_CDE        = : XST00001-LOC-TYP-CDE         01300000
013100             ,LOC_5_ABBR_NM      = : XST00001-LOC-5-ABBR-NM       01310000
013200             ,LOC_10_ABBR_NM     = : XST00001-LOC-10-ABBR-NM      01320000
013300             ,OPN_DTE            = : XST00001-OPN-DTE             01330000
013400             ,CLO_DTE            = : XST00001-CLO-DTE             01340000
013500             ,E_BUS_IND          = : XST00001-E-BUS-IND           01350000
013600             ,DST_IND            = : XST00001-DST-IND             01360000
013700             ,OCPNC_DTE          = : XST00001-OCPNC-DTE           01370000
013800             ,LAST_UPD_TMST      = CURRENT TIMESTAMP              01380000
013900              WHERE  (LOC_NBR = : XST00001-LOC-NBR)               01390000
014000           END-EXEC                                               01400000
014100                                                                  01410000
014200         EVALUATE TRUE                                            01420000
014300             WHEN SQLCODE = -911                                  01430000
014400             WHEN SQLCODE = -913                                  01440000
014500             WHEN SQLCODE = 0                                     01450000
014600                 CONTINUE                                         01460000
014700             WHEN SQLWARN0 NOT = SPACE                            01470000
014800             WHEN SQLCODE NOT =  ZERO                             01480000
014900                 SET PS-PROCESS-COMPLETE TO TRUE                  01490000
015000         END-EVALUATE                                             01500000
015100     END-PERFORM.                                                 01510000
015200                                                                  01520000
015300     SET PS-PROCESS-COMPLETE     TO TRUE.                         01530000
015400                                                                  01540000
015500******************************************************************01550000
015600**PASS SQLCODE TO CALLING AND EXIT PROGRAM                        01560000
015700******************************************************************01570000
015800 9999-WRAPUP.                                                     01580000
015900                                                                  01590000
016000     MOVE SQLCODE       TO LV-RETURN-CODE.                        01600000
016100                                                                  01610000
016200     EXIT PROGRAM.                                                01620000
