000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             TMKUT005.                                00050000
000600 AUTHOR.                 TAMARA KOLTUN.                           00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN            9-10-96.                                 00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100*----------------------------------------------------------------*00110000
001200* THIS PROGRAM ATTACHES THE REASON CODE DESCRIPTION TO EACH OF   *00120001
001300* THE TROUBLE REPORT RECORDS.                                    *00130001
001310*----------------------------------------------------------------*00131000
001320                                                                  00132000
001330******************************************************************00133000
001340 ENVIRONMENT DIVISION.                                            00134000
001350******************************************************************00135000
001360                                                                  00136000
001370 CONFIGURATION SECTION.                                           00137000
001380                                                                  00138000
001390 SOURCE-COMPUTER.        IBM-3090.                                00139000
001400 OBJECT-COMPUTER.        IBM-3090.                                00140000
001500                                                                  00150000
001600 INPUT-OUTPUT SECTION.                                            00160000
001700                                                                  00170000
001800 FILE-CONTROL.                                                    00180000
001900                                                                  00190000
002000      SELECT EXTRACT-TROUBLE-FILE   ASSIGN TO IO01.               00200000
002100                                                                  00210000
002200******************************************************************00220000
002300 DATA DIVISION.                                                   00230000
002400******************************************************************00240000
002500                                                                  00250000
002600 FILE SECTION.                                                    00260000
002700 FD  EXTRACT-TROUBLE-FILE                                         00270000
002800     LABEL RECORDS ARE STANDARD                                   00280000
002900     BLOCK CONTAINS 0 RECORDS                                     00290000
003000     RECORDING MODE IS F                                          00300000
003100     RECORD CONTAINS 400 CHARACTERS                               00310000
003200     DATA RECORD IS TE-TROUBLE-EXTRACT-RECORD.                    00320000
003300                                                                  00330000
003400 01  TE-TROUBLE-EXTRACT-RECORD       PIC X(400).                  00340000
003500*------------------------------------------------------*          00350000
003600 WORKING-STORAGE SECTION.                                         00360000
003700*------------------------------------------------------*          00370000
003800 01 PC-PROGRAM-CONSTANTS.                                         00380000
003900    05 PC-PROGRAM-NAME               PIC X(08) VALUE 'TMKUT005'.  00390000
004000    05 PC-NOT-FOUND                  PIC X(15) VALUE              00400000
004100                                              '** NOT FOUND **'.  00410000
004200 01 DK-DATABASE-KEYS.                                             00430000
004300    05 DK-REASON-CDE                 PIC S9(4)     VALUE 0 COMP.  00430100
004301 01 PC-PROGRAM-VARIABLES.                                         00430200
004302    05 PV-PARA-NAME                  PIC X(30)     VALUE SPACE.   00430300
004303    05 PV-ABEND-CODE                 PIC 9(04)     VALUE 0.       00430400
004304    05 PV-ABEND-PARA-NAME            PIC X(30)     VALUE SPACE.   00430500
004305    05 PV-DB2-OPERATION-MSG-1        PIC X(40)     VALUE SPACE.   00430600
004306    05 PV-DB2-TABLE-NAME             PIC X(12)     VALUE SPACE.   00430700
004307    05 PV-SQLCODE                    PIC Z(8)9-.                  00430800
004308    05 PV-PARAGRAPH-NAME             PIC X(30)     VALUE SPACE.   00430900
004309    05 PV-START-EXTRACT              PIC X(10)     VALUE SPACE.   00431000
004310    05 PV-END-EXTRACT                PIC X(10)     VALUE SPACE.   00432000
004320    05 PV-REASON-CDE-SAVE            PIC S9(4)     VALUE 0 COMP.  00433000
004330    05 PV-TRBL-RSN-CDE-DESC          PIC X(20)     VALUE SPACE.   00434000
004340    05 PV-TRBL-RSN-NOTIF-CDE         PIC X(01)     VALUE SPACE.   00434100
004350 01 PS-PROGRAM-SWITCHES.                                          00435000
004360    05 PS-END-OF-FILE-SW             PIC X(01)     VALUE SPACE.   00436000
004370       88 PS-EOF                     VALUE 'Y'.                   00437000
004380       88 PS-NOT-EOF                 VALUE 'N'.                   00438000
004390    05 PS-REASON-CDE-FOUND-SW        PIC X(01)     VALUE SPACE.   00439000
004400       88 PS-REASON-CDE-FOUND        VALUE 'Y'.                   00440000
004500       88 PS-REASON-CDE-NOT-FOUND    VALUE 'N'.                   00450000
004600                                                                  00460000
004700     COPY TMRD001.                                                00470000
004800                                                                  00480000
004900*** DB2 MESSAGE AREAS ****                                        00490000
005000     COPY DPWS004.                                                00500000
005100*                                                                 00510000
005200     EXEC SQL                                                     00520000
005300          INCLUDE SQLCA                                           00530000
005400     END-EXEC.                                                    00540000
005500                                                                  00550000
005600     EXEC SQL                                                     00560000
005700          INCLUDE TTRBRSN                                         00570000
005800     END-EXEC.                                                    00580000
005900                                                                  00590000
006000********************************************************          00600000
006100 PROCEDURE DIVISION.                                              00610000
006200********************************************************          00620000
006300 0000-MAIN.                                                       00630000
006400     PERFORM 1000-INITIALIZATION         THRU 1000-EXIT.          00640000
006500     PERFORM 2000-PROCESS-INPUT-FILE     THRU 2000-EXIT           00650000
006600                            UNTIL PS-EOF.                         00660000
006700     CLOSE  EXTRACT-TROUBLE-FILE.                                 00670000
006800 0000-EXIT.  STOP RUN.                                            00680000
006900                                                                  00690000
007000 1000-INITIALIZATION.                                             00700000
007100      OPEN I-O    EXTRACT-TROUBLE-FILE.                           00710000
007200**** SCIPPING THE HEADER RECORD.                                  00720000
007300      READ EXTRACT-TROUBLE-FILE  INTO                             00730000
007400                                  TM001-TROUBLE-EXT-RECORD        00740000
007500          AT END                                                  00750000
007600             SET PS-EOF TO TRUE                                   00760000
007700      END-READ.                                                   00770000
007800                                                                  00780000
007900 1000-EXIT.  EXIT.                                                00790000
008000                                                                  00800000
008100 2000-PROCESS-INPUT-FILE.                                         00810000
008200      INITIALIZE TM001-TROUBLE-EXT-RECORD.                        00820000
008300      READ EXTRACT-TROUBLE-FILE  INTO                             00830000
008400                                  TM001-TROUBLE-EXT-RECORD        00840000
008500         AT END                                                   00850000
008600            SET PS-EOF TO TRUE                                    00860000
008700         NOT AT END                                               00870000
008800           PERFORM 2100-UPDATE-INPUT-FILE THRU 2100-EXIT          00880000
008900      END-READ.                                                   00890000
009000 2000-EXIT. EXIT.                                                 00900000
009100                                                                  00910000
009200 2100-UPDATE-INPUT-FILE.                                          00920000
009300                                                                  00930000
009400      IF TM001-TRBL-RSN-CDE       IS NOT = DK-REASON-CDE          00940000
009500         MOVE TM001-TRBL-RSN-CDE          TO DK-REASON-CDE        00950000
009600         PERFORM 2110-GET-TTRBRSN-ROW     THRU 2110-EXIT          00960000
009700         EVALUATE TRUE                                            00970000
009800             WHEN PS-REASON-CDE-FOUND                             00980000
009900                MOVE TRBRSN-NOTIF-IND      TO                     00990000
009910                                          TM001-TRBL-RSN-NOTIF-CDE00991000
009920                                          PV-TRBL-RSN-NOTIF-CDE   01000000
009930                MOVE TRBRSN-TRBL-LONG-DESC TO                     01001000
009940                                          TM001-TRBL-RSN-CDE-DESC 01002000
009950                                          PV-TRBL-RSN-CDE-DESC    01003000
009960                MOVE TRBRSN-TRBL-RSN-CDE  TO PV-REASON-CDE-SAVE   01010000
009970             WHEN PS-REASON-CDE-NOT-FOUND                         01020000
009980                MOVE PC-NOT-FOUND         TO                      01030000
009990                                          TM001-TRBL-RSN-NOTIF-CDE01030100
010000                                          PV-TRBL-RSN-NOTIF-CDE   01030200
010100                MOVE PC-NOT-FOUND         TO                      01031000
010200                                          TM001-TRBL-RSN-CDE-DESC 01040000
010300                                          PV-TRBL-RSN-CDE-DESC    01050000
010400         END-EVALUATE                                             01051000
010500      ELSE                                                        01060000
010600        MOVE PV-TRBL-RSN-NOTIF-CDE        TO                      01061000
010610                                          TM001-TRBL-RSN-NOTIF-CDE01062000
010620        MOVE PV-TRBL-RSN-CDE-DESC         TO                      01070000
010630                                          TM001-TRBL-RSN-CDE-DESC 01071000
010640      END-IF.                                                     01080000
010690      REWRITE TE-TROUBLE-EXTRACT-RECORD FROM                      01100000
010700                                  TM001-TROUBLE-EXT-RECORD.       01110000
010800 2100-EXIT.  EXIT.                                                01120000
010900                                                                  01130000
011000 2110-GET-TTRBRSN-ROW.                                            01140000
011100      EXEC SQL                                                    01150000
011200                SELECT                                            01160000
011300                      NOTIF_IND                                   01161000
011400                     ,TRBL_LONG_DESC                              01170000
011500                INTO :TRBRSN-NOTIF-IND                            01180000
011600                    ,:TRBRSN-TRBL-LONG-DESC                       01181000
011700                FROM TTRBRSN                                      01190000
011800                WHERE  TRBL_RSN_CDE = :DK-REASON-CDE              01200000
011900       END-EXEC.                                                  01220000
012000                                                                  01230000
012100       EVALUATE TRUE                                              01240000
012200            WHEN SQLCODE = ZERO                                   01250000
012300                SET PS-REASON-CDE-FOUND      TO TRUE              01260000
012400            WHEN SQLCODE = +100                                   01270000
012500                SET  PS-REASON-CDE-NOT-FOUND TO TRUE              01280000
012600            WHEN OTHER                                            01290000
012700               MOVE '2110-GET-TTRBRSN-ROW  ' TO PV-ABEND-PARA-NAME01300000
012800                MOVE 'SELECT TTRBRSN ROW'                         01310000
012900                                         TO PV-DB2-OPERATION-MSG-101320000
013000                MOVE 'TTRBRSN'           TO PV-DB2-TABLE-NAME     01330000
013100                PERFORM 9998-SQL-ABEND   THRU 9998-EXIT           01340000
013200        END-EVALUATE.                                             01350000
013300                                                                  01360000
013400 2110-EXIT.  EXIT.                                                01370000
013500                                                                  01380000
013600 9998-SQL-ABEND.                                                  01390000
013700     MOVE SQLCODE     TO PV-SQLCODE.                              01400000
013800     DISPLAY '** ABEND           ** = SQLABEND'.                  01410000
013900     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          01420000
014000     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        01430000
014100     DISPLAY '** TABLE AFFECTED  ** = ' PV-DB2-TABLE-NAME.        01440000
014200     DISPLAY '** OPERATION       ** = ' PV-DB2-OPERATION-MSG-1.   01450000
014300     DISPLAY '** SQLCODE         ** = ' PV-SQLCODE.               01460000
014400     COPY DPPD004.                                                01470000
014500     MOVE +4013                  TO PV-ABEND-CODE.                01480000
014600     CALL 'ILBOABN0'   USING PV-ABEND-CODE.                       01490000
014700 9998-EXIT.  EXIT.                                                01500000
014800                                                                  01510000
