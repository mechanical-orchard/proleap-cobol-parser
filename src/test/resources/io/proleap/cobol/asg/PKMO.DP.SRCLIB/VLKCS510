000100*-----------------------*                                         03/19/93
000200 IDENTIFICATION DIVISION.                                         VLKCS503
000300*-----------------------*                                            LV011
000400 PROGRAM-ID.    VLKCS510.                                            CL**1
000500 AUTHOR.        MARY SARDINA - KOHLS.                                   *1
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                             CL**1
000700 DATE-WRITTEN.  08-28-96.                                            CL**1
000800 DATE-COMPILED.                                                      CL**1
000900                                                                     CL**1
001000*---------------------------------------------------------------*    CL**1
001100*    V510 - PRETICKET REQUEST DETAIL INQUIRY SCREENS            *    CL**1
001200*                                                               *    CL**1
001300*    THIS PROGRAM WILL DISPLAY COMMENTS THAT HAVE BEEN ENTERED  *    CL**1
001400*    BY THE VL TICKET STAFF.                                    *    CL**1
001900*                                                               *    CL**1
002000*---------------------------------------------------------------*    CL**1
263627* CHANGED 11/05/2021    BY JIM HUNTER      WR: CHG0263627                 
263627* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263627* MAKING THE CALL DYNAMIC VS STATIC.                                      
263627*----------------------------------------------------------------*        
CICS  * CHANGED 11/11/2022    BY JIM HUNTER      WR: CHG0278236                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  *****************************************************************         
002100                                                                     CL**1
002200 ENVIRONMENT DIVISION.                                               CL**1
002300                                                                     CL**1
002400 DATA DIVISION.                                                      CL**1
002500                                                                     CL**1
002600 WORKING-STORAGE SECTION.                                            CL**1
002700                                                                     CL**1
002800 01  DK-DB2-KEY-FIELDS.                                                 *1
002900     05  DK-PO-REQ-NBR                  PIC S9(09) COMP.                *1
003000                                                                     CL**1
003010 01  PC-PROGRAM-CONSTANTS.                                           CL**1
003020     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE            CL**1
003030                                                    'VL510A  '.      CL**1
003100     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE            CL**1
003200                                                    'VLKM510 '.      CL**1
003300     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE            CL**1
003400                                                    'VLKCS510'.      CL**1
003500     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.         CL**1
003600     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.         CL**1
003700     05  PC-DTL-QUEUE-SEQ               PIC  9(01)  VALUE 3.         CL**1
003800     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.       CL**1
003900     05  PC-LIST-FORMAT                 PIC  X(01)  VALUE '2'.       CL**1
004000     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +12        CL**1
004100                                                    COMP SYNC.       CL**1
004200     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2         CL**1
004300                                                    COMP SYNC.       CL**1
004400     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE            CL**1
004500                                                    +1000000         CL**1
004600                                                    COMP-3.          CL**1
004700     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5         CL**1
004800                                                    COMP SYNC.       CL**1
004900     05  PC-MAX-RETRIES                 PIC S9(3)    VALUE 3         CL**1
005000                                                     COMP-3.         CL**1
005100                                                                     CL**1
005200 01  PC-TSYMSG-NUMBERS.                                              CL**1
005300     05  PC-TSYMSG-00008                PIC 9(5)    VALUE 00008.     CL**1
005400     05  PC-TSYMSG-00050                PIC 9(5)    VALUE 00050.     CL**1
005500     05  PC-TSYMSG-00059                PIC 9(5)    VALUE 00059.     CL**7
005600     05  PC-TSYMSG-00069                PIC 9(5)    VALUE 00069.     CL**7
005700     05  PC-TSYMSG-00070                PIC 9(5)    VALUE 00070.     CL**1
005800     05  PC-TSYMSG-00101                PIC 9(5)    VALUE 00101.     CL**1
005900     05  PC-TSYMSG-00148                PIC 9(5)    VALUE 00148.     CL**1
006000     05  PC-TSYMSG-00279                PIC 9(5)    VALUE 00279.     CL**6
006100     05  PC-TSYMSG-00302                PIC 9(5)    VALUE 00302.     CL**1
006200                                                                     CL**1
006300 01  PS-PROGRAM-SUBSCRIPTS.                                          CL**1
006400     05  PS-SUB                         PIC S9(04)   VALUE +0        CL**1
006500                                                     COMP SYNC.      CL**1
006600                                                                     CL**1
006700 01  PS-PROGRAM-SWITCHES.                                            CL**1
006800     05  PS-ERROR-SW                    PIC X(01)    VALUE 'Y'.      CL**1
006900         88  PS-NO-ERROR                             VALUE 'Y'.      CL**1
007000         88  PS-ERROR                                VALUE 'N'.      CL**1
007100     05  PS-COMMAREA-SW                 PIC X(01)    VALUE 'N'.      CL**1
007200         88  PS-COMMAREA-VALID                       VALUE 'Y'.      CL**1
007300         88  PS-COMMAREA-NOT-VALID                   VALUE 'N'.      CL**1
007400     05  PS-LIST-END-SW                 PIC X(01)    VALUE 'N'.      CL**1
007500         88  PS-LIST-END                             VALUE 'Y'.      CL**1
007600         88  PS-NO-LIST-END                          VALUE 'N'.      CL**1
007601     05  PS-RSN-QUEUE-SW                PIC X(01)   VALUE 'N'.      CL* *1
007602         88  PS-RSN-QUEUE-WRITTEN                   VALUE 'Y'.      CL* *1
007610         88  PS-RSN-QUEUE-NOT-WRITTEN               VALUE 'N'.      CL* *1
007700     EJECT                                                           CL**1
007800 01  PV-PROGRAM-VARIABLES.                                           CL**1
007801     05  PV-SUB                         PIC S9(04)  VALUE +0      VLKCS510
007810                                                    COMP SYNC.    VLKCS510
007900     05  PV-REMAINDER                   PIC S9(04)   VALUE +0        CL**1
008000                                                     COMP SYNC.      CL**1
008001     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      VLKCS510
008010                                                    COMP SYNC.    VLKCS510
008100     05  PV-READ-COUNT                  PIC S9(09)   VALUE +0        CL**1
008200                                                     COMP-3.         CL**1
008201     05  PV-ITEM                        PIC S9(04)  VALUE +0      VLKCS510
008210                                                    COMP SYNC.    VLKCS510
008300     05  PV-TOP-ITEM                    PIC S9(09)   VALUE +0        CL**1
008400                                                     COMP-3.         CL**1
008401     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      VLKCS510
008410                                                    COMP-3.       VLKCS510
008500     05  PV-BOTTOM-ITEM                 PIC S9(09)   VALUE +0        CL**1
008600                                                     COMP-3.         CL**1
008700     05  PV-BLOCK-NUMBER                PIC S9(04)   VALUE +0        CL**1
008800                                                     COMP SYNC.      CL**1
008900     05  PV-CICS-RESP                   PIC S9(04)   VALUE +0        CL**1
009000                                                     COMP SYNC.      CL**1
009100     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)   VALUE +0        CL**1
009200                                                     COMP SYNC.      CL**1
009300     05  PV-LIST-ITEM-NUMBER            PIC S9(04)   VALUE +0        CL**1
009400                                                     COMP SYNC.      CL**1
009500     05  PV-SQL-SUB                     PIC S9(4)    COMP.           CL**1
009501                                                                        *1
009510     05  PV-SEQ-NBR-CNT                 PIC S9(04) VALUE ZERO.          *1
009511                                                                        *1
009512     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      DPKCS036
009520                                                    COMP SYNC.    DPKCS036
009600                                                                        *1
009700 01  PV-DB2-CRITERIA-AREA.                                           CL**1
009800     15  PV-DB2-MESSAGE-NUMBER          PIC S9(05)  VALUE ZERO       CL**1
009900                                                    COMP-3.          CL**1
010000                                                                     CL**1
010100 EJECT                                                               CL**1
010200*---------------------------------------------------------------*    CL**1
010300*    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API           *    CL**1
010400*---------------------------------------------------------------*    CL**1
010500                                                                     CL**1
010600     COPY DPWS030.                                                   CL*11
CICS       COPY DPWS930.                                                   CL*11
010700 EJECT                                                               CL**1
010800*---------------------------------------------------------------*    CL**1
010900*    STANDARD COMMAREA.                                         *    CL**1
011000*---------------------------------------------------------------*    CL**1
011100                                                                     CL**1
011200     COPY DPWS020.                                                   CL**1
011300     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                   CL**1
011400                                                                     CL**1
011500*---------------------------------------------------------------*    CL**1
011600*    INTER-APPLICATION COMMAREA.                                *    CL**1
011700*---------------------------------------------------------------*    CL**1
011800                                                                     CL**1
011900         10  INTER-APPL-COMM-AREA       PIC X(200).                  CL**1
012000     COPY VLWS005.                                                   CL*11
012200*---------------------------------------------------------------*    CL**1
012300*    SPECIFIC COMMMAREA FOR VLKCS510.                           *    CL**1
012400*---------------------------------------------------------------*    CL**1
012500         10  ASC-SPECIFIC-COMMAREA.                                  CL**1
012600             15  ASC-LIST-KEYS.                                      CL**1
012710                 20  ASC-CMNT-CRER-ID                PIC  X(08).          
012720                 20  ASC-PO-REQ-NBR                  PIC  S9(9)           
012730                                                          COMP.           
012900                 20  ASC-KEY-SYSTEM-ID               PIC  X(02).     CL**1
013000                 20  ASC-KEY-MESSAGE-TEXT            PIC  X(70).     CL**1
013100             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                   CL**1
013101                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  VLKCS510
013102                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   VLKCS510
013110                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   VLKCS510
013200                 20  ASC-ITEM-ARRAY.                                 CL**1
013300                                                                     CL**1
013400                     25  ASC-ITEM-ENTRIES OCCURS 12 TIMES.           CL**1
013500                         30  ASC-LIST-ITEM-NUMBER    PIC S9(09)      CL**1
013600                                                     COMP-3.         CL**1
013700                         30  ASC-SEQ-NBR             PIC S9(04).     CL**1
013720                         30  ASC-PRE-TKT-CMNT-DESC   PIC X(50).      CL**1
013800                                                                     CL**1
013900             15  ASC-BLK-SUB                         PIC S9(04)      CL**1
014000                                                         COMP        CL**1
014100                                                         SYNC.       CL**1
014200             15  ASC-ITEM-SUB                        PIC S9(04)      CL**1
014300                                                         COMP        CL**1
014400                                                         SYNC.       CL**1
014500             15  ASC-SEL-SUB                         PIC S9(04)      CL**1
014600                                                         COMP.       CL**1
014700             15  ASC-SEL-ITEM                        PIC S9(04)      CL**1
014800                                                         COMP.       CL**1
014900             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)      CL**1
015000                                                         COMP-3.     CL**1
015100             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)      CL**1
015200                                                         COMP-3.     CL**1
015300             15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(05)      CL**1
015400                                                         COMP-3.     CL**1
015500             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)      CL**1
015600                                                         COMP-3.     CL**1
015700             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)      CL**1
015800                                                         COMP-3.     CL**1
015900             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)      CL**1
016000                                                         COMP-3.     CL**1
016100             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)      CL**1
016200                                                         COMP        CL**1
016300                                                         SYNC.       CL**1
016400             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)      CL**1
016500                                                         COMP-3.     CL**1
016600             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)      CL**1
016700                                                         COMP-3.     CL**1
016701             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  VLKCS510
016702                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   VLKCS510
016710                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   VLKCS510
016800             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).     CL**1
016900                 88  ASC-ITEMS-LEFT-ON-DB              VALUE 'Y'.    CL**1
017000                 88  ASC-NO-ITEMS-LEFT-ON-DB           VALUE 'N'.    CL**1
017100             15  ASC-USE-SELECTION-QUEUE-IND         PIC  X(01).     CL**1
017200                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'.    CL**1
017300             15  ASC-DESC-LINE-IND                   PIC  X(01).     CL**1
017400                 88  ASC-DESC-LINE-DONE                VALUE 'Y'.    CL**1
017500             15  ASC-CORR-LINE-IND                   PIC  X(01).     CL**1
017600                 88  ASC-CORR-LINE-DONE                VALUE 'Y'.    CL**1
017700             15  ASC-LIST-QUEUE-NAME.                                CL**1
017800                 20  ASC-LIST-TERM-ID                PIC  X(04).     CL**1
017900                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)      CL**1
018000                                                         COMP-3.     CL**1
018100                 20  ASC-LIST-SEQ                    PIC  9(01).     CL**1
018200             15  ASC-SEL-QUEUE-NAME.                                 CL**1
018300                 20  ASC-SEL-TERM-ID                 PIC  X(04).     CL**1
018400                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)      CL**1
018500                                                          COMP-3.    CL**1
018600                 20  ASC-SEL-SEQ                     PIC  9(01).     CL**1
018700             15  ASC-DTL-QUEUE-NAME.                                 CL**1
018800                 20  ASC-DTL-TERM-ID                 PIC  X(04).     CL**1
018900                 20  ASC-DTL-TASK-NUMBER             PIC S9(05)      CL**1
019000                                                         COMP-3.     CL**1
019100                 20  ASC-DTL-SEQ                     PIC  9(01).     CL**1
019200                                                                     CL**1
019300             15  ASC-START-ITEM-REQUEST.                             CL**1
019400                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).     CL**1
019500                                                                     CL**1
019600     EJECT                                                           CL**1
019601******************************************************************VLKCS510
019602**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **VLKCS510
019603**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **VLKCS510
019604**  APPLICATION-SPECIFIC COMMAREA.                              **VLKCS510
019605******************************************************************VLKCS510
019606 01  LQW-LIST-QUEUE-WORK-AREA.                                    VLKCS510
019607     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  VLKCS510
019608     05  LQW-ITEM-ENTRIES               OCCURS 12 TIMES           VLKCS510
019609                                        INDEXED BY LQW-IDX.       VLKCS510
019610         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       VLKCS510
019615         10  LQW-SEQ-NBR                PIC S9(04).                     88
019616         10  LQW-PRE-TKT-CMNT-DESC      PIC  X(50).                     *2
019620                                                                  VLKCS510
019650                                                                     CL**1
019692                                                                     CL**1
019700*---------------------------------------------------------------*    CL**1
019800*    MESSAGE SELECTION TSQ B QUEUE RECORD LAYOUT.               *    CL**1
019900*---------------------------------------------------------------*    CL**1
020000                                                                     CL**1
020100     COPY VLWS001.                                                      11
020200                                                                     CL**1
020300     EJECT                                                           CL**1
020400*---------------------------------------------------------------*    CL**1
020500*    ABEND PROCESSING COPYBOOK.                                 *    CL**1
020600*---------------------------------------------------------------*    CL**1
020700                                                                     CL**1
020800     COPY DPWS013.                                                   CL**1
020900                                                                     CL**1
021000     EJECT                                                           CL**1
021100*---------------------------------------------------------------*    CL**1
021200*    ATTRIBUTE SETTINGS COPYBOOK.                               *    CL**1
021300*---------------------------------------------------------------*    CL**1
021400                                                                     CL**1
021500     COPY DPWS015.                                                   CL**1
021600                                                                     CL**1
021700*---------------------------------------------------------------*    CL**1
021800*    FUNCTION KEYS COPYBOOK.                                    *    CL**1
021900*---------------------------------------------------------------*    CL**1
022000                                                                     CL**1
022100     COPY DPWS016.                                                   CL**1
022200                                                                     CL**1
022300*---------------------------------------------------------------*    CL**1
022400*    NUMERIC EDIT LAYOUT.                                       *    CL**1
022500*---------------------------------------------------------------*    CL**1
022600                                                                     CL**1
022700     COPY DPWS010I.                                                  CL**1
022800                                                                     CL**1
022900*---------------------------------------------------------------*    CL**1
023000*    MAP LAYOUT                                                 *    CL**1
023100*---------------------------------------------------------------*    CL**1
023200                                                                     CL**1
023300     COPY VLKM510.                                                   CL**1
023400                                                                     CL**1
023500 01  MR-OCCURS-LAYOUT          REDEFINES  VL510AO.                   CL**1
023600     05  FILLER                PIC X(42).                               *1
023700     05  MR-SCROLL-AREA OCCURS 12 TIMES.                             CL**1
024210         10  MR-TEXTL          PIC S9(04) COMP.                      CL**1
024220         10  MR-TEXTA          PIC  X(01).                           CL**1
024230         10  MR-TEXTC          PIC  X(01).                           CL**1
024240         10  MR-TEXTH          PIC  X(01).                           CL**1
024250         10  MR-TEXT           PIC  X(50).                           CL**1
024300                                                                     CL**1
028200*****************************************************************    CL**1
      * DB2 AREA FOR THE SQL COMMUNICATION AREA                       *         
028200*****************************************************************    CL**1
028210     EXEC SQL                                                           36
028220          INCLUDE SQLCA                                                 36
028230     END-EXEC.                                                          36
024300                                                                     CL**1
028200*****************************************************************    CL**1
      * DB2 AREA FOR THE PRETICKET REQUEST TABLE                      *         
028200*****************************************************************    CL**1
024301     EXEC SQL                                                     VLKCS510
024310          INCLUDE TPTKREQ                                         VLKCS510
024400     END-EXEC.                                                    VLKCS510
024300                                                                     CL**1
028200*****************************************************************    CL**1
      * DB2 AREA FOR THE PRETICKET SHIPMENT TABLE                     *         
028200*****************************************************************    CL**1
024301     EXEC SQL                                                     VLKCS510
024310          INCLUDE TPTKSHP                                         VLKCS510
024400     END-EXEC.                                                    VLKCS510
024300                                                                     CL**1
028200*****************************************************************    CL**1
      * DB2 AREA FOR THE PRETICKET REQUEST/SHIPMENT ASSOCATION TABLE  *         
028200*****************************************************************    CL**1
024301     EXEC SQL                                                     VLKCS510
024310          INCLUDE TREQSHP                                         VLKCS510
024400     END-EXEC.                                                    VLKCS510
024300                                                                     CL**1
028200*****************************************************************    CL**1
      * DB2 AREA FOR THE PRETICKET COMMENT TABLE                      *         
028200*****************************************************************    CL**1
024301     EXEC SQL                                                     VLKCS510
024310          INCLUDE TPTKCMT                                         VLKCS510
024400     END-EXEC.                                                    VLKCS510
024500                                                                     CL**1
026300                                                                     CL**1
028200*****************************************************************    CL**1
      * COMMENT CURSOR DECLARATION                                    *         
028200*****************************************************************    CL**1
026301     EXEC SQL                                                             
026302          DECLARE COMMENT-CSR CURSOR                                      
026303          FOR SELECT                                                      
                      A.SEQ_NBR                                                 
026307              , A.PRE_TKT_CMNT_DESC                                       
026310              , A.CMNT_CRER_ID                                            
026310              , A.CMNT_TYP_CDE                                            
026311          FROM                                                            
026312                TPTKCMT A                                                 
026312              , TPTKREQ B                                                 
026313          WHERE                                                           
026314                 B.PO_REQ_NBR   = :DK-PO-REQ-NBR                          
                   AND A.CMNT_ID      =  B.CMNT_ID                              
                   AND A.CMNT_TYP_CDE = 'R'                                     
026303          GROUP BY                                                        
026306                A.SEQ_NBR                                                 
026307              , A.PRE_TKT_CMNT_DESC                                       
026310              , A.CMNT_CRER_ID                                            
026310              , A.CMNT_TYP_CDE                                            
                                                                                
                UNION ALL                                                       
                                                                                
                    SELECT                                                      
                      A.SEQ_NBR                                                 
026307              , A.PRE_TKT_CMNT_DESC                                       
026310              , A.CMNT_CRER_ID                                            
026310              , A.CMNT_TYP_CDE                                            
026311          FROM                                                            
026312                TPTKCMT A                                                 
026312              , TREQSHP C                                                 
026312              , TPTKSHP D                                                 
026313          WHERE                                                           
026314              C.PO_REQ_NBR   = :DK-PO-REQ-NBR                             
                AND C.SHIPT_NBR    = D.SHIPT_NBR                                
                AND A.CMNT_ID      =  D.CMNT_ID                                 
                AND A.CMNT_TYP_CDE = 'S'                                        
026303          GROUP BY                                                        
026306                A.SEQ_NBR                                                 
026307              , A.PRE_TKT_CMNT_DESC                                       
026310              , A.CMNT_CRER_ID                                            
026310              , A.CMNT_TYP_CDE                                            
026303          ORDER BY 4,1                                                    
026315     END-EXEC.                                                            
028300 EJECT                                                               CL**1
028400 LINKAGE SECTION.                                                    CL**1
028500                                                                     CL**1
028600 01  DFHCOMMAREA.                                                    CL**1
028700     05  FILLER                         OCCURS  1 TO 4072 TIMES      CL**1
028800                                        DEPENDING ON EIBCALEN.       CL**1
028900         10  FILLER                     PIC X.                       CL**1
029000                                                                     CL**1
029100 EJECT                                                               CL**1
029200 PROCEDURE DIVISION.                                                 CL**1
029300                                                                     CL**1
029400 0000-MAIN-MODULE.                                                   CL**1
029500                                                                     CL**1
029600     INITIALIZE DP030-CICS-API-FIELDS.                               CL**1
029700     MOVE +1                      TO DP030-NUMBER-OF-MAPS.           CL**1
029800     MOVE PC-CURRENT-MAPSET-NAME  TO DP030-MAPSET-NAME.              CL**1
029900     MOVE PC-CURRENT-MAP-NAME     TO DP030-MAP-NAME (1).             CL**1
030000     SET DP030-RECEIVE-APPL-MAP   TO TRUE.                           CL**1
030100     MOVE LENGTH OF VL510AI       TO DP030-MAP-LENGTH (1).           CL**2
030200     MOVE 'PROGRAM ENTRY CALL'    TO DP013-MESSAGE-TEXT (1).         CL**1
030300     PERFORM 0001-CALL-CICS-ARCH-API.                                CL**1
030400                                                                     CL**1
030500     PERFORM 1000-CONTROL-PROCESSING.                                CL**1
030600                                                                     CL**1
030700     MOVE 'PROGRAM EXIT CALL'     TO DP013-MESSAGE-TEXT (1).         CL**1
030800     PERFORM 0001-CALL-CICS-ARCH-API.                                CL**1
030900                                                                     CL**1
031000*----------------------------------------------------------------*   CL**3
031100*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *   CL**3
031200*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *   CL**3
031300*----------------------------------------------------------------*   CL**3
031400                                                                     CL**3
031500 0001-CALL-CICS-ARCH-API.                                            CL**1
031600                                                                     CL**1
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                              
031800                                    DFHCOMMAREA                           
031900                                    DP030-CICS-API-FIELDS                 
032000                                    DP020-STANDARD-COMMAREA               
032100                                    VL510AI.                              
032200                                                                     CL**1
032300     IF  DP030-RC-CALL-SUCCESSFUL                                    CL**1
032400         CONTINUE                                                    CL**1
032500     ELSE                                                            CL**1
032600         SET DP013-NO-ROLLBACK TO TRUE                               CL**1
032700         SET DP013-XCTL-DISPLAY-RESTART TO TRUE                      CL**1
032800         SET DP013-CICS-ABEND TO TRUE                                CL**1
032900         MOVE 'BEFORE 0000-MAIN-MODULE' TO DP013-PARAGRAPH           CL**1
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
033200         MOVE DP030-RETURN-CODE                                      CL**1
033300                               TO DP013-MESSAGE-TEXT (3)             CL**1
033400         PERFORM DP013-0000-PROCESS-ABEND                            CL**1
033500     END-IF.                                                         CL**1
033600                                                                     CL**1
033700*----------------------------------------------------------------*   CL**1
033800* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *   CL**1
033900* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *   CL**1
034000*                                                                *   CL**1
034100* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *   CL**1
034200*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *   CL**1
034300*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *   CL**1
034400*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *   CL**1
034500*----------------------------------------------------------------*   CL**1
034600                                                                     CL**1
034700 1000-CONTROL-PROCESSING.                                            CL**1
034800                                                                     CL**1
034900     EVALUATE TRUE                                                   CL**1
035000         WHEN DP020-NEXT-ACT-INITIAL                                 CL**1
035100             MOVE EIBTRMID          TO ASC-LIST-TERM-ID              CL**1
035110                                       ASC-DTL-TERM-ID               CL**1
035200             MOVE DP020-SRC-TASK-NUMBER                              CL**1
035300                                    TO ASC-LIST-TASK-NUMBER             *1
035310                                       ASC-DTL-TASK-NUMBER           CL**1
035400             MOVE PC-DTL-QUEUE-SEQ  TO ASC-DTL-SEQ                      *1
035420             MOVE PC-LIST-QUEUE-SEQ TO ASC-LIST-SEQ                     *1
035500             PERFORM 1100-PROCESS-INTER-APPL-COMM                    CL**1
035600***-----$TEMPLATE NOTE$-------------------------------------------   CL**1
035700*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,   CL**1
035800*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO     CL**1
035900*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.   CL**1
036000***---------------------------------------------------------------   CL**1
036100             IF  PS-COMMAREA-NOT-VALID                               CL**1
036200***              MOVE PC-TSYMSG-99901                                CL**1
036300***                            TO  DP020-MSG-NUMBER                  CL**1
036400***              SET DP020-MSG-FATAL                                 CL**1
036500***                            TO  TRUE                              CL**1
036600                 SET DP020-NEXT-ACT-APPL-ERROR                       CL**1
036700                               TO  TRUE                              CL**1
036800             ELSE                                                    CL**1
036900*                PERFORM 2050-DELETE-DETAIL-QUEUE                    CL**1
037000                 PERFORM 4000-BUILD-INITIAL-PANEL                    CL**1
037100             END-IF                                                  CL**1
037200                                                                     CL**1
037300         WHEN DP020-NEXT-ACT-READ-MAP                                CL**1
037400             MOVE ASC-ITEM-AT-TOP-OF-PANEL                           CL**1
037500                               TO PV-TOP-ITEM                        CL**1
037600             PERFORM 2000-PROCESS-PANEL                              CL**1
037700                                                                     CL**1
037800         WHEN DP020-NEXT-ACT-RETURN                                  CL**1
037900             MOVE ASC-ITEM-AT-TOP-OF-PANEL                           CL**1
038000                               TO PV-TOP-ITEM                        CL**1
038100             MOVE ZERO         TO ASC-ITEM-AT-TOP-OF-PANEL           CL**1
038200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                    CL**1
038300                                                                     CL**1
038400         WHEN OTHER                                                  CL**1
038500             SET DP013-LOGIC-ABEND TO TRUE                           CL**1
038600             SET DP013-NO-ROLLBACK TO TRUE                           CL**1
038700             MOVE '1000-CONTROL-PROCESSING'                          CL**1
038800                               TO  DP013-PARAGRAPH                   CL**1
038900             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'       CL**1
039000                               TO  DP013-MESSAGE-TEXT(1)             CL**1
039100             PERFORM DP013-0000-PROCESS-ABEND                        CL**1
039200     END-EVALUATE.                                                   CL**1
039300                                                                     CL**1
039400 EJECT                                                               CL**1
039500*----------------------------------------------------------------*   CL**1
039600* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *   CL**1
039700* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *   CL**1
039800*----------------------------------------------------------------*   CL**1
039900                                                                     CL**1
040000 1100-PROCESS-INTER-APPL-COMM.                                       CL**1
040100                                                                     CL**1
040200     SET PS-COMMAREA-VALID     TO TRUE.                              CL**1
040400     MOVE SPACE                TO ASC-START-ITEM-REQUEST.            CL**1
040500     EVALUATE DP020-INT-APPL-FORMAT-IND                              CL**1
040600         WHEN PC-CRIT-SPEC-FORMAT                                    CL**1
040700             IF VL005-PO-REQ-NBR > ZERO                                 *1
040702                 MOVE VL005-PO-REQ-NBR TO DK-PO-REQ-NBR                   
040703                                         ASC-PO-REQ-NBR                   
041100             ELSE                                                    CL**1
041200                 MOVE PC-TSYMSG-00148                                CL**1
041300                               TO DP020-MSG-NUMBER                   CL**1
041400                 SET DP020-MSG-FATAL TO TRUE                         CL**1
041500                 SET DP020-NEXT-ACT-APPL-ERROR TO TRUE               CL**1
041600             END-IF                                                  CL**1
041700         WHEN PC-LIST-FORMAT                                         CL**1
041800             SET ASC-USE-SELECTION-QUEUE TO TRUE                     CL**1
041900             MOVE VL005-NUMBER-OF-TS-ITEMS                           CL**1
042000                               TO ASC-NUMBER-OF-TS-ITEMS             CL**1
042100             MOVE VL005-SEL-QUEUE-NAME                               CL**1
042200                               TO ASC-SEL-QUEUE-NAME                 CL**1
042300             PERFORM 1120-PREPARE-LIST-ENTRY                         CL**1
042310*            MOVE VL001-MAX-ITEMS TO ASC-SEL-SUB                        *1
042320*            MOVE ZERO            TO ASC-SEL-ITEM                       *1
042330                                                                        *1
042400         WHEN OTHER                                                  CL**1
042500             IF  DP020-NAV-KEY-DATA > SPACE                          CL**1
042600                 PERFORM 1110-EDIT-NAV-KEY                           CL**1
042700             ELSE                                                    CL**1
042800                 MOVE PC-TSYMSG-00148                                CL**1
042900                               TO DP020-MSG-NUMBER                   CL**1
043000                 SET DP020-MSG-FATAL TO TRUE                         CL**1
043100                 SET DP020-NEXT-ACT-APPL-ERROR TO TRUE               CL**1
043200             END-IF                                                  CL**1
043300     END-EVALUATE.                                                   CL**1
043400                                                                     CL**1
043500*----------------------------------------------------------------*   CL**1
043600*    EDIT THE KEY ENTERED BY THE USER INTO THE KEY FIELD OF THE  *   CL**1
043700*    COMMAND LINE.  A VALID MESSAGE NUMBER IS THE ONLY KEY       *   CL**1
043800*    ACCEPTED.                                                   *   CL**1
043900*----------------------------------------------------------------*   CL**1
044000                                                                     CL**1
044100 1110-EDIT-NAV-KEY.                                                  CL**1
044200                                                                     CL**1
044300     MOVE DP020-NAV-KEY-DATA TO DP010I-UNEDITED-FIELD.               CL**1
044400     MOVE PC-MSG-NUMBER-LENGTH     TO DP010I-MAXIMUM-DIGITS.         CL**1
044500     MOVE ZERO                TO DP010I-MAXIMUM-DECIMALS.            CL**1
044600     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                        CL**1
263627     CALL DP010I-NUMERIC-EDIT-ROUTINE                                     
263627          USING DP010I-NUMERIC-EDIT-AREA.                                 
044800     IF  DP010I-ERROR-DETECTED                                       CL**1
044900         SET PS-ERROR TO TRUE                                        CL**1
045000         SET DP020-MSG-FATAL TO TRUE                                 CL**1
045100         MOVE PC-TSYMSG-00302 TO DP020-MSG-NUMBER                    CL**1
045200         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                       CL**1
045300     ELSE                                                            CL**1
045400         MOVE DP010I-NUMERIC-FIELD   TO ASC-SEQ-NBR                     *1
045500                                (ASC-BLK-SUB ASC-ITEM-SUB)              *1
045600     END-IF.                                                         CL**1
045700                                                                     CL**1
045800*----------------------------------------------------------------*   CL**1
045900*    GET READY TO START AT THE FIRST ITEM ON THE LIST.           *   CL**1
046000*----------------------------------------------------------------*   CL**1
046100                                                                     CL**1
046200 1120-PREPARE-LIST-ENTRY.                                            CL**1
046300     MOVE VL001-MAX-ITEMS TO ASC-SEL-SUB.                            CL**1
046500     MOVE +1              TO ASC-SEL-ITEM.                           CL**1
046501     MOVE +0              TO PV-ITEM-IN-USE.                            *1
046503*    PERFORM 9100-READ-SEL-QUEUE.                                         
046510*    IF PV-CICS-RESP = 0                                                  
046600*        PERFORM 2140-GET-NEXT-MESSAGE                                  *1
046610*    ELSE                                                                 
046620*        CONTINUE                                                         
046630*    END-IF.                                                              
046700 EJECT                                                               CL**1
046800*----------------------------------------------------------------*   CL**1
046900*    RECEIVE THE MAP AND PERFORM THE APPROPRIATE PARAGRAPH BASED *   CL**1
047000*    ON WHAT FUNCTION KEY WAS SELECTED.                          *   CL**1
047100*----------------------------------------------------------------*   CL**1
047200                                                                     CL**1
047300 2000-PROCESS-PANEL.                                                 CL**1
047400                                                                     CL**1
047500     EVALUATE TRUE                                                   CL**1
047600         WHEN DP020-SRC-AID = DP016-CLEAR                            CL**1
047700             MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                   CL**1
047800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                    CL**1
047900             PERFORM 3200-RESET-ATTRIBUTES                           CL**1
048000                                                                     CL**1
048100         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                       CL**1
048200             MOVE ASC-PO-REQ-NBR                                        *1
048300                               TO  DK-PO-REQ-NBR                        *1
048400             PERFORM 2050-DELETE-DETAIL-QUEUE                        CL**1
048500             PERFORM 4000-BUILD-INITIAL-PANEL                        CL**1
048600             PERFORM 3200-RESET-ATTRIBUTES                           CL**1
048700                                                                     CL**1
048800         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)                CL**1
048900             IF  ASC-USE-SELECTION-QUEUE                             CL**1
049000                 PERFORM 2140-GET-NEXT-MESSAGE                       CL**1
049100                 IF PS-LIST-END                                      CL**1
049200                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            CL**1
049300                     SET PS-NO-LIST-END TO TRUE                      CL**1
049400                 ELSE                                                CL**1
049500                     PERFORM 2050-DELETE-DETAIL-QUEUE                CL**1
049600                     PERFORM 4000-BUILD-INITIAL-PANEL                CL**1
049700                 END-IF                                              CL**1
049800                 PERFORM 3200-RESET-ATTRIBUTES                       CL**1
049900             ELSE                                                    CL**1
050000                 MOVE PC-TSYMSG-00070                                CL**1
050100                                  TO DP020-MSG-NUMBER                CL**1
050200                 SET DP020-MSG-INFORMATIONAL TO TRUE                 CL**1
050300             END-IF                                                  CL**1
050400                                                                     CL**1
050500         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)                CL**1
050600             IF  ASC-USE-SELECTION-QUEUE                             CL**1
050700                 PERFORM 2150-GET-PREV-MESSAGE                       CL**1
050800                 IF PS-LIST-END                                      CL**1
050900                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            CL**1
051000                     SET PS-NO-LIST-END TO TRUE                      CL**1
051100                 ELSE                                                CL**1
051200                     PERFORM 2050-DELETE-DETAIL-QUEUE                CL**1
051300                     PERFORM 4000-BUILD-INITIAL-PANEL                CL**1
051400                 END-IF                                              CL**1
051500                 PERFORM 3200-RESET-ATTRIBUTES                       CL**1
051600             ELSE                                                    CL**1
051700                 MOVE PC-TSYMSG-00069                                CL**1
051800                                  TO DP020-MSG-NUMBER                CL**1
051900                 SET DP020-MSG-INFORMATIONAL TO TRUE                 CL**1
052000             END-IF                                                  CL**1
052001         WHEN OTHER                                                  CL**1
052002             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                         
052003             PERFORM 3000-EDIT-DATA-IN-COMMAREA                           
052004             IF PS-NO-ERROR                                               
052005                 SET DP030-CONTINUE-GO                                    
052006                               TO TRUE                                    
052007                 PERFORM 2100-CHECK-FUNCTION-KEY                          
052008             ELSE                                                         
052009                 SET DP030-OVERRIDE-GO                                    
052010                                 TO TRUE                                  
052011             END-IF                                                       
052012     END-EVALUATE.                                                   CL**1
052020 2100-CHECK-FUNCTION-KEY.                                                 
052100                                                                     CL**1
052110     EVALUATE TRUE                                                   CL**1
052200         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                     CL**1
052300             MOVE +1 TO PV-TOP-ITEM                                  CL**1
052400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                    CL**1
052500             PERFORM 3200-RESET-ATTRIBUTES                           CL**1
052600                                                                     CL**1
052700         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                      CL**1
052710             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                       88
052800             PERFORM 2110-BROWSE-BACKWARD                            CL**1
052900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                    CL**1
053000             PERFORM 3200-RESET-ATTRIBUTES                           CL**1
053100                                                                     CL**1
053200         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                      CL**1
053210             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                       88
053300             PERFORM 2120-BROWSE-FORWARD                             CL**1
053400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                    CL**1
053500             PERFORM 3200-RESET-ATTRIBUTES                           CL**1
053600                                                                     CL**1
053700         WHEN DP020-SRC-AID = DP016-ENTER                            CL**1
053710             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                       88
053800             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                      CL**1
053900             IF  PS-ERROR                                            CL**1
054000                 CONTINUE                                            CL**1
054100             ELSE                                                    CL**1
054200                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                CL**1
054300                 PERFORM 3200-RESET-ATTRIBUTES                       CL**1
054400             END-IF                                                  CL**1
054500                                                                     CL**1
054600         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)                 CL**7
054601             MOVE +0          TO PV-ITEM-IN-USE                         *1
054602             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                       88
054610             PERFORM 5000-PREPARE-SEL-QUEUE                             15
054620             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                    CL**1
054700*            PERFORM 6000-UPDATE-SYSTEM-MESSAGE                      CL**7
054800*            --- UPDATES SUCCESSFUL ---                              CL**7
054900             MOVE PC-TSYMSG-00059 TO DP020-MSG-NUMBER                CL**7
055000             SET DP020-MSG-INFORMATIONAL TO TRUE                     CL**7
055100                                                                     CL**7
055200         WHEN OTHER                                                  CL**1
055300             SET DP013-NO-ROLLBACK TO TRUE                           CL**1
055400             SET DP013-XCTL-DISPLAY-RESTART TO TRUE                  CL**1
055500             SET DP013-CICS-ABEND TO TRUE                            CL**1
055600             MOVE '2100-CHECK-FUNCTION-KEY' TO DP013-PARAGRAPH       CL**1
055700             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'         CL**1
055800                                   TO DP013-MESSAGE-TEXT (1)         CL**1
055900             PERFORM DP013-0000-PROCESS-ABEND                        CL**1
056000                                                                     CL**1
056100     END-EVALUATE.                                                   CL**1
056200 EJECT                                                               CL**1
056300*----------------------------------------------------------------*   CL**1
056400*    DELETE THE TEMPORARY STORAGE QUEUE.                         *   CL**1
056500*----------------------------------------------------------------*   CL**1
056600                                                                     CL**1
056700 2050-DELETE-DETAIL-QUEUE.                                           CL**1
056800                                                                     CL**1
056900     EXEC CICS                                                       CL**1
057000         DELETEQ TS                                                  CL**1
057100             QUEUE (ASC-SEL-QUEUE-NAME)                              CL**1
057200             RESP  (PV-CICS-RESP)                                    CL**1
057300     END-EXEC.                                                       CL**1
057400                                                                     CL**1
057500     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                          CL**1
057600        (PV-CICS-RESP = DFHRESP(QIDERR))                             CL**1
057700         CONTINUE                                                    CL**1
057800     ELSE                                                            CL**1
057900         SET DP013-CICS-ABEND TO TRUE                                CL**1
058000         SET DP013-NO-ROLLBACK TO TRUE                               CL**1
058100                                                                     CL**1
058200         MOVE '2050-DELETE-DETAIL-QUEUE' TO DP013-PARAGRAPH          CL**1
058300         MOVE 'ERROR TRYING TO DELETE DETAIL TEMP STORAGE QUEUE'     CL**1
058400                        TO DP013-MESSAGE-TEXT (1)                    CL**1
058500         PERFORM DP013-0000-PROCESS-ABEND                            CL**1
058600     END-IF.                                                         CL**1
058700                                                                     CL**1
058800*    MOVE +0 TO ASC-HIGHEST-BLOCK-WRITTEN.                           CL**1
058900 EJECT                                                               CL**1
059000*----------------------------------------------------------------*   CL**1
059100*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *   CL**1
059200*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *   CL**1
059300*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *   CL**1
059400*    MESSAGE.                                                    *   CL**1
059500*----------------------------------------------------------------*   CL**1
059600                                                                     CL**1
059700 2110-BROWSE-BACKWARD.                                               CL**1
059800                                                                     CL**1
059900     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL       CL**1
060000         GIVING PV-TOP-ITEM.                                         CL**1
060100                                                                     CL**1
060200     IF  PV-TOP-ITEM < +1                                            CL**1
060300         MOVE +1              TO PV-TOP-ITEM                         CL**1
060400*        -- TOP OF LIST --                                           CL**1
060500         MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER                    CL**1
060600         SET DP020-MSG-INFORMATIONAL TO TRUE                         CL**1
060700     END-IF.                                                         CL**1
060800                                                                     CL**1
060900 EJECT                                                               CL**1
061000                                                                     CL**1
061100*----------------------------------------------------------------*   CL**1
061200*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *   CL**1
061300*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *   CL**1
061400*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *   CL**1
061500*----------------------------------------------------------------*   CL**1
061600                                                                     CL**1
061700 2120-BROWSE-FORWARD.                                                CL**1
061800                                                                     CL**1
061900     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL                 CL**1
062000         GIVING PV-TOP-ITEM.                                         CL**1
062100     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                      CL**1
062200         MOVE ASC-ITEM-AT-TOP-OF-PANEL                               CL**1
062300                                   TO PV-TOP-ITEM                    CL**1
062400*        -- BOTTOM OF LIST --                                        CL**1
062500         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER               CL**1
062600         SET DP020-MSG-INFORMATIONAL                                 CL**1
062700                                   TO TRUE                           CL**1
062800     ELSE                                                            CL**1
062900         COMPUTE PV-BOTTOM-ITEM =                                    CL**1
063000             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                    CL**1
063100         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ               CL**1
063200*            -- BOTTOM OF LIST --                                    CL**1
063300             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER               CL**1
063400             SET DP020-MSG-INFORMATIONAL                             CL**1
063500                                   TO TRUE                           CL**1
063600         END-IF                                                      CL**1
063700     END-IF.                                                         CL**1
063800 EJECT                                                               CL**1
063900*----------------------------------------------------------------*   CL**1
064000*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *   CL**1
064100*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *   CL**1
064200*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *   CL**1
064300*    RATHER THAN HITTING PF8 TO PAGE FORWARD TO THAT POINT.      *   CL**1
064400*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *   CL**1
064500*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *   CL**1
064600*----------------------------------------------------------------*   CL**1
064700                                                                     CL**1
064800 2130-CHECK-FOR-JUMP-BROWSE.                                         CL**1
064900                                                                     CL**1
065000     IF ASTRTITL > ZERO                                              CL**1
065100         MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST         CL**1
065200     ELSE                                                            CL**1
065300         IF ASTRTITF = DP015-ERASE-EOF                               CL**1
065400             INITIALIZE ASC-START-ITEM-REQUEST                       CL**1
065500         END-IF                                                      CL**1
065600     END-IF.                                                         CL**1
065700                                                                     CL**1
065800     SET PS-NO-ERROR               TO TRUE.                          CL**1
065900     IF (ASC-START-ITEM-REQUEST = SPACE)                             CL**1
066000         MOVE ASC-ITEM-AT-TOP-OF-PANEL                               CL**1
066100                                   TO PV-TOP-ITEM                    CL**1
066200     ELSE                                                            CL**1
066300         MOVE ASC-START-ITEM-REQUEST                                 CL**1
066400                                   TO DP010I-UNEDITED-FIELD          CL**1
066500         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS          CL**1
066600         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS        CL**1
066700         SET DP010I-NEGATIVE-NOT-ALLOWED                             CL**1
066800                                   TO TRUE                           CL**1
263627         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263627              USING DP010I-NUMERIC-EDIT-AREA                              
067000                                                                     CL**1
067100         IF  NOT DP010I-ERROR-DETECTED                               CL**1
067200             MOVE DP010I-NUMERIC-FIELD                               CL**1
067300                                   TO  ASC-START-ITEM-REQUEST-N      CL**1
067400             IF  ASC-START-ITEM-REQUEST-N > ZERO                     CL**1
067500                 IF  ASC-START-ITEM-REQUEST-N >                      CL**1
067600                                          ASC-NUMBER-OF-ITEMS-READ   CL**1
067700                     MOVE SPACE TO ASC-START-ITEM-REQUEST            CL**1
067800                     COMPUTE PV-TOP-ITEM =                           CL**1
067900                             ASC-NUMBER-OF-ITEMS-READ                CL**1
068000                             - PC-ITEMS-PER-PANEL + 1                CL**1
068100                     IF  PV-TOP-ITEM < +1                            CL**1
068200                         MOVE +1   TO PV-TOP-ITEM                    CL**1
068300                         MOVE PC-TSYMSG-00070                        CL**1
068400                                   TO DP020-MSG-NUMBER               CL**1
068500                         SET DP020-MSG-INFORMATIONAL                 CL**1
068600                                   TO TRUE                           CL**1
068700                     END-IF                                          CL**1
068800                 ELSE                                                CL**1
068900                     MOVE ASC-START-ITEM-REQUEST-N                   CL**1
069000                                   TO PV-TOP-ITEM                    CL**1
069100                     MOVE SPACE    TO ASC-START-ITEM-REQUEST         CL**1
069200                     COMPUTE PV-BOTTOM-ITEM =                        CL**1
069300                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1        CL**1
069400                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ   CL**1
069500*                        -- BOTTOM OF LIST --                        CL**1
069600                         MOVE PC-TSYMSG-00070                        CL**1
069700                                   TO DP020-MSG-NUMBER               CL**1
069800                         SET DP020-MSG-INFORMATIONAL                 CL**1
069900                                   TO TRUE                           CL**1
070000                     END-IF                                          CL**1
070100                 END-IF                                              CL**1
070200             ELSE                                                    CL**1
070300*                --- VALUE OUT OF RANGE ----                         CL**1
070400                 MOVE PC-TSYMSG-00101                                CL**1
070500                                   TO DP020-MSG-NUMBER               CL**1
070600                 MOVE -1           TO ASTRTITL                       CL**1
070700                 SET DP030-SET-CURSOR-APPL-1                         CL**1
070800                                   TO TRUE                           CL**1
070900                 MOVE DP015-REVERSE                                  CL**1
071000                                   TO ASTRTITH                       CL**1
071100                 MOVE DP015-RED    TO ASTRTITC                       CL**1
071200                 MOVE DP015-UNP-NUM-BRT-MDT                          CL**1
071300                                   TO ASTRTITA                       CL**1
071400                 SET DP020-MSG-FATAL                                 CL**1
071500                                   TO TRUE                           CL**1
071600                 SET PS-ERROR      TO TRUE                           CL**1
071700             END-IF                                                  CL**1
071800                                                                     CL**1
071900         ELSE                                                        CL**1
072000             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER               CL**1
072100             MOVE -1               TO ASTRTITL                       CL**1
072200             SET DP030-SET-CURSOR-APPL-1 TO TRUE                     CL**1
072300             MOVE DP015-REVERSE    TO ASTRTITH                       CL**1
072400             MOVE DP015-RED        TO ASTRTITC                       CL**1
072500             MOVE DP015-UNP-NUM-BRT-MDT                              CL**1
072600                                   TO ASTRTITA                       CL**1
072700             SET DP020-MSG-FATAL   TO TRUE                           CL**1
072800             SET PS-ERROR          TO TRUE                           CL**1
072900         END-IF                                                      CL**1
073000     END-IF.                                                         CL**1
073100 EJECT                                                               CL**1
073200                                                                     CL**1
073300*----------------------------------------------------------------*   CL**1
073400*    GET THE NEXT MESSAGE IF A LIST OF MESSAGES IS BEING         *   CL**1
073500*    PROCESSED.                                                  *   CL**1
073600*----------------------------------------------------------------*   CL**1
073700                                                                     CL**1
073800 2140-GET-NEXT-MESSAGE.                                              CL**1
073900                                                                     CL**1
074000     ADD +1                       TO ASC-SEL-SUB.                    CL**1
074100     IF  ASC-SEL-SUB > VL001-MAX-ITEMS                               CL**1
074200         ADD +1                   TO ASC-SEL-ITEM                    CL**1
074300         MOVE +1                  TO ASC-SEL-SUB                     CL**1
074400     END-IF.                                                         CL**1
074500     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                   CL**1
074600         PERFORM 9100-READ-SEL-QUEUE                                 CL**1
074700         IF  VL001-ITEM (ASC-SEL-SUB) > ZERO                         CL**1
075003             MOVE VL001-PO-REQ-NBR     (VL001-IDX)                        
075005                                      TO ASC-PO-REQ-NBR                   
075006             MOVE VL001-SEQ-NBR (VL001-IDX) TO ASC-SEQ-NBR                
075007                                (ASC-BLK-SUB ASC-ITEM-SUB)              *1
075008             MOVE VL001-PRE-TKT-CMNT-DESC (VL001-IDX)                     
075009                                  TO ASC-PRE-TKT-CMNT-DESC                
075010                                (ASC-BLK-SUB ASC-ITEM-SUB)              *1
075011             MOVE VL001-CMNT-CRER-ID (VL001-IDX)                          
075020                                  TO ASC-CMNT-CRER-ID                     
075200             PERFORM 9200-REWRITE-SEL-QUEUE                             *1
075300         ELSE                                                        CL**1
075400             SUBTRACT +1 FROM ASC-SEL-SUB                            CL**1
075500             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER                CL**1
075600             SET DP020-MSG-INFORMATIONAL TO TRUE                     CL**1
075700             SET PS-LIST-END             TO TRUE                     CL**1
075800         END-IF                                                      CL**1
075900     ELSE                                                            CL**1
076000         SUBTRACT +1 FROM ASC-SEL-ITEM                               CL**1
076100         MOVE VL001-MAX-ITEMS     TO ASC-SEL-SUB                     CL**1
076200         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER                CL**1
076300         SET DP020-MSG-INFORMATIONAL TO TRUE                         CL**1
076400         SET PS-LIST-END             TO TRUE                         CL**1
076500     END-IF.                                                         CL**1
076510 2150-UPDATE-MESSAGE.                                                   *1
076520                                                                     CL**1
076530     ADD +1                       TO ASC-SEL-SUB.                    CL**1
076540     IF  ASC-SEL-SUB > VL001-MAX-ITEMS                               CL**1
076550         ADD +1                   TO ASC-SEL-ITEM                    CL**1
076560         MOVE +1                  TO ASC-SEL-SUB                     CL**1
076570     END-IF.                                                         CL**1
076580     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                   CL**1
076590         PERFORM 9100-READ-SEL-QUEUE                                 CL**1
076591         IF  VL001-ITEM (ASC-SEL-SUB) > ZERO                         CL**1
076592             MOVE VL001-PO-REQ-NBR     (VL001-IDX)                        
076593                                      TO ASC-PO-REQ-NBR                   
076594             MOVE VL001-SEQ-NBR (VL001-IDX) TO ASC-SEQ-NBR                
076595                                (ASC-BLK-SUB ASC-ITEM-SUB)              *1
076596             MOVE VL001-PRE-TKT-CMNT-DESC (VL001-IDX)                     
076597                                  TO ASC-PRE-TKT-CMNT-DESC                
076598                                (ASC-BLK-SUB ASC-ITEM-SUB)              *1
076599             MOVE VL001-CMNT-CRER-ID (VL001-IDX)                          
076600                                  TO ASC-CMNT-CRER-ID                     
076601             PERFORM 9200-REWRITE-SEL-QUEUE                             *1
076602         ELSE                                                        CL**1
076603             SUBTRACT +1 FROM ASC-SEL-SUB                            CL**1
076604             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER                CL**1
076605             SET DP020-MSG-INFORMATIONAL TO TRUE                     CL**1
076606             SET PS-LIST-END             TO TRUE                     CL**1
076607         END-IF                                                      CL**1
076608     ELSE                                                            CL**1
076609         SUBTRACT +1 FROM ASC-SEL-ITEM                               CL**1
076610         MOVE VL001-MAX-ITEMS     TO ASC-SEL-SUB                     CL**1
076611         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER                CL**1
076612         SET DP020-MSG-INFORMATIONAL TO TRUE                         CL**1
076613         SET PS-LIST-END             TO TRUE                         CL**1
076614     END-IF.                                                         CL**1
076620                                                                     CL**1
076700*----------------------------------------------------------------*   CL**1
076800*    GET THE PREVIOUS MESSAGE IF A LIST OF MESSAGES IS BEING     *   CL**1
076900*    PROCESSED.                                                  *   CL**1
077000*----------------------------------------------------------------*   CL**1
077100                                                                     CL**1
077200 2150-GET-PREV-MESSAGE.                                              CL**1
077300                                                                     CL**1
077400     SUBTRACT +1 FROM ASC-SEL-SUB.                                   CL**1
077500     IF  ASC-SEL-SUB < +1                                            CL**1
077600         SUBTRACT +1 FROM ASC-SEL-ITEM                               CL**1
077700         MOVE VL001-MAX-ITEMS     TO ASC-SEL-SUB                     CL**1
077800     END-IF.                                                         CL**1
077900                                                                     CL**1
078000     IF  ASC-SEL-ITEM > ZERO                                         CL**1
078100         PERFORM 9100-READ-SEL-QUEUE                                 CL**1
078200         MOVE VL001-SEQ-NBR  (ASC-SEL-SUB)                              *1
078300                                  TO ASC-SEQ-NBR                        *1
078310                                (ASC-BLK-SUB ASC-ITEM-SUB)              *1
078400                                                                        *1
078500     ELSE                                                            CL**1
078600         MOVE +1                  TO ASC-SEL-ITEM                    CL**1
078700                                     ASC-SEL-SUB                     CL**1
078800         MOVE PC-TSYMSG-00069     TO DP020-MSG-NUMBER                CL**1
078900         SET DP020-MSG-INFORMATIONAL TO TRUE                         CL**1
079000         SET PS-LIST-END             TO TRUE                         CL**1
079100     END-IF.                                                         CL**1
079200                                                                     CL**1
079201******************************************************************DPKCS036
079202** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **DPKCS036
079203** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **DPKCS036
079204******************************************************************DPKCS036
079205 3000-EDIT-DATA-IN-COMMAREA.                                      DPKCS036
079206     SET PS-NO-ERROR               TO TRUE.                       DPKCS036
079207     PERFORM 3200-RESET-ATTRIBUTES.                               DPKCS036
079208     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     DPKCS036
079209**                                                                DPKCS036
079210* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              DPKCS036
079211* EDITTING IS DONE FROM THE BOTTOM UP.                            DPKCS036
079212**                                                                DPKCS036
079213     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       DPKCS036
079214         ASC-ITEMS-DISPLAYED - 1.                                 DPKCS036
079215     PERFORM 3100-SET-SUBSCRIPTS.                                 DPKCS036
079216*    PERFORM 3300-EDIT-SELECTIONS                                 DPKCS036
079217*        VARYING PV-SUB                                           DPKCS036
079218*        FROM PV-SUB BY -1                                        DPKCS036
079219*        UNTIL PV-SUB < +1                                        DPKCS036
079220*                                                                 DPKCS036
079221*    IF  PS-NO-ERROR                                              DPKCS036
079222*        PERFORM 3400-CHECK-RANGE-SEQUENCE                        DPKCS036
079223*    END-IF.                                                      DPKCS036
079224*                                                                 DPKCS036
079225*    IF  ((PS-NO-ERROR)                                           DPKCS036
079226*      AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   DPKCS036
079227*      AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    DPKCS036
079228*            PERFORM 3500-MARK-RANGE-AS-SELECTED                  DPKCS036
079230*    END-IF.                                                      DPKCS036
079300 EJECT                                                               CL**1
079400*----------------------------------------------------------------*   CL**1
079500*    RESET ATTRIBUTES.                                           *   CL**1
079600*----------------------------------------------------------------*   CL**1
079700                                                                     CL**1
079800 3200-RESET-ATTRIBUTES.                                              CL**1
079900                                                                     CL**1
080000     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                      CL**1
080100     MOVE DP015-GREEN              TO ASTRTITC.                      CL**1
080200     MOVE DP015-UNDERLINE          TO ASTRTITH.                      CL**1
080300     MOVE -1                       TO ASTRTITL.                      CL**1
080400     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                          CL**1
080500*                                                                    CL**1
080501******************************************************************VLKCS510
080502** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **VLKCS510
080503** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **VLKCS510
080504******************************************************************VLKCS510
080505 2200-MOVE-SCREEN-TO-COMMAREA.                                    VLKCS510
080506                                                                  VLKCS510
080507     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             VLKCS510
080508     MOVE +1                       TO PV-SUB.                     VLKCS510
080509                                                                  VLKCS510
080510     PERFORM 3100-SET-SUBSCRIPTS.                                 VLKCS510
080511     IF  ASTRTITL > ZERO                                          VLKCS510
080512         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          VLKCS510
080513     ELSE                                                         VLKCS510
080514         IF  ASTRTITF = DP015-ERASE-EOF                           VLKCS510
080515             INITIALIZE ASC-START-ITEM-REQUEST                    VLKCS510
080516         END-IF                                                   VLKCS510
080517     END-IF.                                                      VLKCS510
080518     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          VLKCS510
080519         VARYING PV-SUB                                           VLKCS510
080520         FROM 1 BY 1                                              VLKCS510
080521         UNTIL PV-SUB > PC-ITEMS-PER-PANEL.                             88
080522*        UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      VLKCS510
080524                                                                  VLKCS510
080525******************************************************************VLKCS510
080526** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**VLKCS510
080527******************************************************************VLKCS510
080528 2210-MOVE-LINES-TO-COMMAREA.                                     VLKCS510
080529                                                                  VLKCS510
080530     IF  MR-TEXTL (PV-SUB) > ZERO                                       88
080531         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             VLKCS510
080532         MOVE MR-TEXT (PV-SUB) TO                                       88
080533                                ASC-PRE-TKT-CMNT-DESC                   88
080534                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      VLKCS510
080535         ADD +1                TO  PV-SEQ-NBR-CNT                       *1
080536         ADD +1                TO  ASC-NUMBER-OF-ITEMS-READ             *1
080537         ADD PV-SEQ-NBR-CNT    TO ASC-SEQ-NBR                             
080538                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      VLKCS510
080539         MOVE ASC-NUMBER-OF-ITEMS-READ TO                                 
080540                   ASC-LIST-ITEM-NUMBER                                   
080541                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      VLKCS510
080542     ELSE                                                         VLKCS510
080543         IF  MR-TEXTA   (PV-SUB) = DP015-ERASE-EOF                VLKCS510
080544                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     VLKCS510
080545                 MOVE SPACE TO                                          88
080546                                ASC-PRE-TKT-CMNT-DESC                   88
080547                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      VLKCS510
080548         END-IF                                                   VLKCS510
080549     END-IF.                                                      VLKCS510
080550     ADD +1                        TO ASC-ITEM-SUB.               VLKCS510
080551     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        VLKCS510
080552         ADD +1                    TO ASC-BLK-SUB                 VLKCS510
080553         MOVE +1                   TO ASC-ITEM-SUB                VLKCS510
080554     END-IF.                                                      VLKCS510
080560                                                                  VLKCS510
080600 EJECT                                                               CL**1
080601                                                                  VLKCS510
080602******************************************************************VLKCS510
080603** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **VLKCS510
080604** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **VLKCS510
080605******************************************************************VLKCS510
080700                                                                     CL**1
080701*----------------------------------------------------------------*VLKCS510
080702*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *VLKCS510
080703*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*VLKCS510
080704*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *VLKCS510
080705*                                                                *VLKCS510
080706*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *VLKCS510
080707*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *VLKCS510
080708*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *VLKCS510
080709*    US IN THE 2ND BLOCK OF THE ARRAY.                           *VLKCS510
080710*----------------------------------------------------------------*VLKCS510
080711 3100-SET-SUBSCRIPTS.                                             VLKCS510
080712                                                                  VLKCS510
080713     COMPUTE ASC-ITEM-SUB =                                       VLKCS510
080714         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        VLKCS510
080715                                                                  VLKCS510
080716     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         VLKCS510
080717         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            VLKCS510
080718                                                                  VLKCS510
080719         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               VLKCS510
080720     ELSE                                                         VLKCS510
080721         MOVE +1                     TO ASC-BLK-SUB               VLKCS510
080722     END-IF.                                                      VLKCS510
080792                                                                  VLKCS510
080800*----------------------------------------------------------------*   CL**1
080900*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *   CL**1
081000*    INITIALIZE ALL COUNTERS AND FLAGS.                          *   CL**1
081100*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *   CL**1
081200*    DISPLAY THE PANEL TO USER.                                  *   CL**1
081300*----------------------------------------------------------------*   CL**1
081400                                                                     CL**1
081500 4000-BUILD-INITIAL-PANEL.                                           CL**1
081600                                                                     CL**1
081700     INITIALIZE                  ASC-BLOCK-ENTRIES (1)               CL**1
081800                                 ASC-BLOCK-ENTRIES (2).              CL**1
081900     MOVE +1                 TO  ASC-BLK-SUB.                        CL**1
082200                                                                     CL**1
082300     MOVE +0                 TO  ASC-ITEM-SUB                        CL**1
082400                                 ASC-NUMBER-OF-ITEMS-READ            CL**1
082500                                 ASC-NUMBER-OF-SELECTED-ITEMS        CL**1
082600                                 ASC-HIGHEST-BLOCK-WRITTEN           CL**1
082700                                 ASC-START-OF-SELECTED-RANGE         CL**1
082800                                 ASC-END-OF-SELECTED-RANGE           CL**1
082900                                 ASC-ITEM-AT-TOP-OF-PANEL.           CL**1
083000                                                                     CL**1
083900                                                                     CL**1
083910     PERFORM 4010-OPEN-CURSOR.                                            
083920     PERFORM 4300-READ-ITEMS-FROM-DB.                                     
083930     PERFORM 4020-CLOSE-CURSOR.                                           
084000     MOVE +1                 TO  PV-TOP-ITEM.                        CL**1
084100     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                             CL**1
084200         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                       CL**1
084300         SET DP020-MSG-FATAL   TO  TRUE                              CL**1
084400         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER                  CL**1
084500     ELSE                                                            CL**1
084600         MOVE -1             TO ASTRTITL                             CL**1
084700         SET DP030-SET-CURSOR-APPL-1 TO TRUE                         CL**1
084800         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                        CL**1
084900     END-IF.                                                         CL**1
085000 EJECT                                                               CL**1
085001*----------------------------------------------------------------*VLKCS510
085002* OPEN THE TPTKCMT CURSOR. *                                     *      36
085003*                                                                * PKCS036
085006*----------------------------------------------------------------*VLKCS510
085007                                                                  VLKCS510
085008 4010-OPEN-CURSOR.                                                VLKCS510
085009     PERFORM                                                      VLKCS510
085010         WITH TEST AFTER                                          VLKCS510
085011         VARYING PV-RETRY-COUNTER                                 VLKCS510
085012         FROM 1 BY 1                                              VLKCS510
085013         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               VLKCS510
085014             OR (SQLCODE = ZERO))                                 VLKCS510
085015                                                                          
085019         EXEC SQL                                                         
085020             OPEN COMMENT-CSR                                             
085021         END-EXEC                                                         
085037                                                                  VLKCS510
085038         EVALUATE TRUE                                            VLKCS510
085039             WHEN SQLCODE = ZERO                                  VLKCS510
085040             WHEN SQLCODE = -904                                  VLKCS510
085041             WHEN SQLCODE = -913                                  VLKCS510
085042                 CONTINUE                                         VLKCS510
085043             WHEN SQLWARN0 NOT = SPACES                           VLKCS510
085044             WHEN SQLCODE < ZERO                                  VLKCS510
085045             WHEN SQLCODE > ZERO                                  VLKCS510
085046                 MOVE '4010-OPEN-CURSOR'                          VLKCS510
085047                                   TO DP013-PARAGRAPH             VLKCS510
085048                 MOVE 'OPEN COMMENTS CSR - '                            36
085049                                   TO DP013-MESSAGE-TEXT (1)      VLKCS510
085050                 MOVE SQLCA        TO DP013-SQLCA                 VLKCS510
085051                 MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)    VLKCS510
085052                 SET DP013-DB2-ABEND                              VLKCS510
085053                     DP013-XCTL-DISPLAY-RESTART TO TRUE           VLKCS510
085054                 PERFORM DP013-0000-PROCESS-ABEND                 VLKCS510
085055         END-EVALUATE                                             VLKCS510
085056     END-PERFORM.                                                 VLKCS510
085057*                                                                 VLKCS510
085058     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        VLKCS510
085059         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             VLKCS510
085060         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   VLKCS510
085061                                   TO DP013-MESSAGE-TEXT (1)      VLKCS510
085062         MOVE SQLCA                TO DP013-SQLCA                 VLKCS510
085063         MOVE 'TSYMSG  '           TO DP013-DB2-TABLE-NAME (1)    VLKCS510
085064         SET DP013-DB2-ABEND                                      VLKCS510
085065             DP013-XCTL-DISPLAY-RESTART                           VLKCS510
085066                                   TO TRUE                        VLKCS510
085067         PERFORM DP013-0000-PROCESS-ABEND                         VLKCS510
085068     END-IF.                                                      VLKCS510
085069                                                                  VLKCS510
085070 EJECT                                                            VLKCS510
085071*----------------------------------------------------------------*VLKCS510
085072* CLOSE THE TPTKCMT CURSOR.                                      *VLKCS510
085073*                                                                *VLKCS510
085076*----------------------------------------------------------------*VLKCS510
085077                                                                  VLKCS510
085078 4020-CLOSE-CURSOR.                                               VLKCS510
085081     EXEC SQL                                                             
085082         CLOSE COMMENT-CSR                                                
085083     END-EXEC                                                     VLKCS510
085084                                                                  VLKCS510
085095*                                                                 VLKCS510
085096     EVALUATE TRUE                                                VLKCS510
085097         WHEN SQLCODE = ZERO                                      VLKCS510
085098             CONTINUE                                             VLKCS510
085099         WHEN SQLWARN0 NOT = SPACES                               VLKCS510
085100         WHEN SQLCODE < ZERO                                      VLKCS510
085101         WHEN SQLCODE > ZERO                                      VLKCS510
085102             MOVE '4020-CLOSE-CURSOR'                             VLKCS510
085103                               TO DP013-PARAGRAPH                 VLKCS510
085104             MOVE 'CLOSE REQUEST COMMENT CURSOR'                  VLKCS510
085105                               TO DP013-MESSAGE-TEXT (1)          VLKCS510
085106             MOVE SQLCA        TO DP013-SQLCA                     VLKCS510
085107             MOVE 'TPTKCMT '   TO DP013-DB2-TABLE-NAME (1)        VLKCS510
085108             SET DP013-DB2-ABEND                                  VLKCS510
085109                 DP013-XCTL-DISPLAY-RESTART TO TRUE               VLKCS510
085110             PERFORM DP013-0000-PROCESS-ABEND                     VLKCS510
085111     END-EVALUATE.                                                VLKCS510
085112                                                                  VLKCS510
085181                                                                  VLKCS510
085182 EJECT                                                            VLKCS510
085183*----------------------------------------------------------------*VLKCS510
085184*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *VLKCS510
085185*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *VLKCS510
085186*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *VLKCS510
085187*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *VLKCS510
085188*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *VLKCS510
085189*                                                                *VLKCS510
085190*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *VLKCS510
085191*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *VLKCS510
085192*    UPON INITIALIZATION.                                        *VLKCS510
085193*----------------------------------------------------------------*VLKCS510
085194                                                                  VLKCS510
085195 4300-READ-ITEMS-FROM-DB.                                         VLKCS510
085196     SET ASC-ITEMS-LEFT-ON-DB TO TRUE                             VLKCS510
085197     PERFORM                                                      VLKCS510
085198         VARYING PV-READ-COUNT                                    VLKCS510
085199         FROM 1 BY 1                                              VLKCS510
085200         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    VLKCS510
085201            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         VLKCS510
085202                                                                  VLKCS510
085203         PERFORM 4310-FETCH                                       VLKCS510
085204                                                                  VLKCS510
085205         IF  ASC-ITEMS-LEFT-ON-DB                                 VLKCS510
085206             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                VLKCS510
085207                 ADD +1            TO ASC-ITEM-SUB                VLKCS510
085208             ELSE                                                 VLKCS510
085209                 ADD +1            TO ASC-BLK-SUB                 VLKCS510
085210                 MOVE +1           TO ASC-ITEM-SUB                VLKCS510
085211                                                                  VLKCS510
085212                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         VLKCS510
085213                     MOVE +1       TO ASC-BLK-SUB                 VLKCS510
085214                     SET ASC-BLOCK-MODIFIED (1)                   VLKCS510
085215                                   TO TRUE                        VLKCS510
085216                     PERFORM 5100-WRITE-TEMP-STORAGE              VLKCS510
085217                     MOVE ASC-BLOCK-ENTRIES                       VLKCS510
085218                               (PC-MAX-BLOCKS-IN-ARRAY)           VLKCS510
085219                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) VLKCS510
085220                     ADD +1        TO ASC-BLK-SUB                 VLKCS510
085221                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   VLKCS510
085222                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      VLKCS510
085223                                   TO TRUE                        VLKCS510
085224                 END-IF                                           VLKCS510
085225             END-IF                                               VLKCS510
085226             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    VLKCS510
085227             MOVE ASC-NUMBER-OF-ITEMS-READ                        VLKCS510
085228                                   TO ASC-LIST-ITEM-NUMBER        VLKCS510
085229                                      (ASC-BLK-SUB ASC-ITEM-SUB)  VLKCS510
085230             MOVE PTKCMT-SEQ-NBR   TO ASC-SEQ-NBR                 VLKCS510
085231                                       (ASC-BLK-SUB ASC-ITEM-SUB) VLKCS510
085238             MOVE PTKCMT-PRE-TKT-CMNT-DESC                        VLKCS510
085239                               TO  ASC-PRE-TKT-CMNT-DESC          VLKCS510
085240                                       (ASC-BLK-SUB ASC-ITEM-SUB) VLKCS510
085241         END-IF                                                   VLKCS510
085242     END-PERFORM.                                                 VLKCS510
085243                                                                  VLKCS510
085244     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          VLKCS510
085245         MOVE +1               TO ASC-BLK-SUB                     VLKCS510
085246         PERFORM 5100-WRITE-TEMP-STORAGE                          VLKCS510
085247         ADD +1                TO ASC-BLK-SUB                     VLKCS510
085248         PERFORM 5100-WRITE-TEMP-STORAGE                          VLKCS510
085249                                                                  VLKCS510
085250         MOVE 1                TO ASC-BLK-SUB                     VLKCS510
085251                                  PV-BLOCK-NUMBER                 VLKCS510
085252         PERFORM 4410-READ-TEMP-STORAGE                           VLKCS510
085253         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             VLKCS510
085254             MOVE 2            TO ASC-BLK-SUB                     VLKCS510
085255                                  PV-BLOCK-NUMBER                 VLKCS510
085256             PERFORM 4410-READ-TEMP-STORAGE                       VLKCS510
085257         END-IF                                                   VLKCS510
085258     END-IF.                                                      VLKCS510
085259 EJECT                                                            VLKCS510
085260*----------------------------------------------------------------*VLKCS510
085261*    FETCH THE MESSAGE CURSOR.                                   *VLKCS510
085262*----------------------------------------------------------------*VLKCS510
085263                                                                  VLKCS510
085264 4310-FETCH.                                                      VLKCS510
085265                                                                  VLKCS510
085268     EXEC SQL                                                     VLKCS510
085269         FETCH COMMENT-CSR                                              36
                 INTO :PTKCMT-SEQ-NBR                                           
085273              , :PTKCMT-PRE-TKT-CMNT-DESC                                 
085274              , :PTKCMT-CMNT-CRER-ID                                      
085274              , :PTKCMT-CMNT-TYP-CDE                                      
085279     END-EXEC                                                     VLKCS510
085280                                                                  VLKCS510
085301                                                                  VLKCS510
085302     EVALUATE TRUE                                                VLKCS510
085303         WHEN SQLCODE = ZERO                                      VLKCS510
085305            SET ASC-ITEMS-LEFT-ON-DB TO TRUE                            *1
085306         WHEN SQLCODE = +100                                      VLKCS510
085307              CONTINUE                                            VLKCS510
085308         WHEN SQLWARN0 NOT = SPACE                                VLKCS510
085309         WHEN SQLCODE NOT = ZERO                                  VLKCS510
085310              MOVE '4310-FETCH-CURSOR'                            VLKCS510
085311                               TO DP013-PARAGRAPH                 VLKCS510
085312              MOVE 'FETCH REQUEST COMMENTS CURSOR'                VLKCS510
085313                               TO DP013-MESSAGE-TEXT (1)          VLKCS510
085314              MOVE SQLCA       TO DP013-SQLCA                     VLKCS510
085315              SET DP013-DB2-ABEND                                 VLKCS510
085316                               TO TRUE                            VLKCS510
085317              PERFORM DP013-0000-PROCESS-ABEND                    VLKCS510
085318     END-EVALUATE.                                                VLKCS510
085319                                                                  VLKCS510
085320     IF  SQLCODE EQUAL +100                                       VLKCS510
085321         SET ASC-NO-ITEMS-LEFT-ON-DB                              VLKCS510
085322                                   TO TRUE                        VLKCS510
085330     END-IF.                                                      VLKCS510
085400                                                                  VLKCS510
090100                                                                     CL**1
090200 EJECT                                                               CL**1
090300*----------------------------------------------------------------*   CL**1
090400*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *   CL**1
090500*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *   CL**1
090600*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *   CL**1
090700*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *   CL**1
090800*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *   CL**1
090900*                                                                *   CL**1
091000*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *   CL**1
091100*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *   CL**1
091200*    UPON INITIALIZATION.                                        *   CL**1
091300*----------------------------------------------------------------*   CL**1
091400                                                                     CL**1
091500 4301-READ-ITEMS-FROM-DB.                                            CL**1
091600                                                                     CL**1
096800                                                                     CL**1
096900     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                             CL**1
097000         MOVE SPACES                                                      
097300                                                                        *1
097310                               TO   ASC-PRE-TKT-CMNT-DESC               *1
097400                                           (ASC-BLK-SUB              CL**1
097500                                            ASC-ITEM-SUB)            CL**1
097600     END-IF.                                                         CL**1
097700                                                                     CL**1
097800     MOVE +1                       TO  ASC-BLK-SUB.                  CL**1
097900     PERFORM 5100-WRITE-TEMP-STORAGE.                                CL**1
098000     ADD +1                        TO  ASC-BLK-SUB.                  CL**1
098100     PERFORM 5100-WRITE-TEMP-STORAGE.                                CL**1
098200                                                                     CL**1
098300     MOVE 1                        TO  ASC-BLK-SUB                   CL**1
098400                                       PV-BLOCK-NUMBER.              CL**1
098500     PERFORM 4410-READ-TEMP-STORAGE.                                 CL**1
098600     IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1                    CL**1
098700         MOVE 2                    TO  ASC-BLK-SUB                   CL**1
098800                                       PV-BLOCK-NUMBER               CL**1
098900         PERFORM 4410-READ-TEMP-STORAGE                              CL**1
099000     END-IF.                                                         CL**1
099100 EJECT                                                               CL**1
104800 EJECT                                                               CL**1
104900*----------------------------------------------------------------*   CL**1
105000*    GET THE CORRECT SUBSCRIPTS FOR PLACING THE TEXT LINE.       *   CL**1
105100*----------------------------------------------------------------*   CL**1
105200                                                                     CL**1
105300 4320-GET-SUB.                                                       CL**1
105400                                                                     CL**1
105500     IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                           CL**1
105600         ADD +1            TO  ASC-ITEM-SUB                          CL**1
105700     ELSE                                                            CL**1
105800         ADD +1            TO  ASC-BLK-SUB                           CL**1
105900         MOVE +1           TO  ASC-ITEM-SUB                          CL**1
106000                                                                     CL**1
106100         IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY                    CL**1
106200             MOVE +1       TO  ASC-BLK-SUB                           CL**1
106300             PERFORM 5100-WRITE-TEMP-STORAGE                         CL**1
106400             MOVE ASC-BLOCK-ENTRIES                                  CL**1
106500                       (PC-MAX-BLOCKS-IN-ARRAY)                      CL**1
106600             TO   ASC-BLOCK-ENTRIES(ASC-BLK-SUB)                     CL**1
106700             ADD +1        TO  ASC-BLK-SUB                           CL**1
106800             INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)              CL**1
106900         END-IF                                                      CL**1
107000     END-IF.                                                         CL**1
107100                                                                     CL**1
107200     ADD +1            TO ASC-NUMBER-OF-ITEMS-READ.                  CL**1
107300     MOVE ASC-NUMBER-OF-ITEMS-READ TO ASC-LIST-ITEM-NUMBER           CL**1
107400                                      (ASC-BLK-SUB                   CL**1
107500                                       ASC-ITEM-SUB).                CL**1
107600                                                                     CL**1
107700*----------------------------------------------------------------*   CL**1
107800*    FORMAT THE MAP AND DETERMINE THE CURSOR POSITION.           *   CL**1
107900*----------------------------------------------------------------*   CL**1
108000                                                                     CL**1
108100 4400-MOVE-COMMAREA-TO-SCREEN.                                       CL**1
108200                                                                     CL**1
108600                                                                     CL**1
108700     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))                CL**1
108800         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))             CL**1
108900         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))             CL**1
108901             MOVE +1    TO ASC-BLK-SUB                            VLKCS510
108902             PERFORM 5100-WRITE-TEMP-STORAGE                      VLKCS510
108910             ADD +1     TO ASC-BLK-SUB                            VLKCS510
109000             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                CL**1
109100                 GIVING PV-BLOCK-NUMBER                              CL**1
109200                 REMAINDER PV-REMAINDER                              CL**1
109300             IF  PV-REMAINDER > ZERO                                 CL**1
109400                 ADD +1 TO PV-BLOCK-NUMBER                           CL**1
109500             END-IF                                                  CL**1
109600             MOVE +1    TO ASC-BLK-SUB                               CL**1
109700             PERFORM 4410-READ-TEMP-STORAGE                          CL**1
109800             ADD +1     TO ASC-BLK-SUB                               CL**1
109900                           PV-BLOCK-NUMBER                           CL**1
110000             PERFORM 4410-READ-TEMP-STORAGE                          CL**1
110100     END-IF.                                                         CL**1
110200     MOVE +1                       TO ASC-BLK-SUB.                   CL**1
110300     COMPUTE ASC-ITEM-SUB =                                          CL**1
110400         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))                 CL**1
110500         + PC-ITEMS-PER-PANEL).                                      CL**1
110600                                                                     CL**1
110700     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                           CL**1
110800         ADD +1   TO ASC-BLK-SUB                                     CL**1
110900         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB               CL**1
111000     END-IF.                                                         CL**1
111100                                                                     CL**1
111200     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                              CL**1
111300         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                   CL**1
111400     PERFORM 4420-FORMAT-LIST-LINES                                  CL**1
111500         VARYING PV-SUB                                              CL**1
111600         FROM PC-ITEMS-PER-PANEL BY -1                               CL**1
111700         UNTIL PV-SUB < +1.                                          CL**1
111800                                                                     CL**1
111900     COMPUTE ASC-ITEMS-DISPLAYED =                                   CL**1
112000         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).             CL**1
112100     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL       CL**1
112200                                      ASTRTITO.                      CL**1
112300     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                       CL**1
112400     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                       CL**1
112500                                                                     CL**1
112600     IF  DP020-MSG-NUMBER-X = SPACE                                  CL**5
112700         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ     CL**5
112800*            --- MORE ITEMS TO DISPLAY ----                          CL**5
112900             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER               CL**5
113000             SET DP020-MSG-INFORMATIONAL TO TRUE                     CL**5
113100         END-IF                                                      CL**5
113200     END-IF.                                                         CL**5
113300                                                                     CL**5
113400*----------------------------------------------------------------*   CL**1
113500*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *   CL**1
113600*----------------------------------------------------------------*   CL**1
113700                                                                     CL**1
113800 4410-READ-TEMP-STORAGE.                                             CL**1
113900                                                                     CL**1
114000     EXEC CICS                                                       CL**1
114100         READQ TS                                                    CL**1
114200             QUEUE (ASC-LIST-QUEUE-NAME)                                *1
114300             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))                  CL**1
114400             ITEM  (PV-BLOCK-NUMBER)                                 CL**1
114500             RESP  (PV-CICS-RESP)                                    CL**1
114600     END-EXEC.                                                       CL**1
114700                                                                     CL**1
114800     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                          CL**1
114900       OR (PV-CICS-RESP = DFHRESP (ITEMERR))                            *1
114910       OR (PV-CICS-RESP = DFHRESP (QIDERR)))                            *1
115000         CONTINUE                                                    CL**1
115100     ELSE                                                            CL**1
115200         SET DP013-CICS-ABEND TO  TRUE                               CL**1
115300         SET DP013-NO-ROLLBACK TO  TRUE                              CL**1
115400         MOVE '4410-READ-TEMP-STORAGE'                               CL**1
115500                               TO  DP013-PARAGRAPH                   CL**1
115600         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'         CL**1
115700                               TO  DP013-MESSAGE-TEXT(1)             CL**1
115800         PERFORM DP013-0000-PROCESS-ABEND                            CL**1
115900     END-IF.                                                         CL**1
116000                                                                     CL**1
116100*    SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.                CL**1
116200                                                                     CL**1
116300     IF (PV-CICS-RESP = DFHRESP (ITEMERR)                            CL**1
116301     OR  PV-CICS-RESP = DFHRESP (QIDERR))                               *1
116400         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)                  CL**1
116500     END-IF.                                                         CL**1
116600 EJECT                                                               CL**1
116700*----------------------------------------------------------------*   CL**1
116800*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *   CL**1
116900*----------------------------------------------------------------*   CL**1
117000                                                                     CL**1
117100 4420-FORMAT-LIST-LINES.                                             CL**1
117200                                                                     CL**1
117300     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ         CL**1
117400         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                   CL**1
117500         MOVE SPACE              TO MR-TEXT (PV-SUB)                 CL**1
117600     ELSE                                                            CL**1
117700         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL              CL**1
117810             MOVE ASC-PRE-TKT-CMNT-DESC                                 *1
117820                        (ASC-BLK-SUB ASC-ITEM-SUB)                      *1
117900                                 TO MR-TEXT (PV-SUB)                 CL**1
117910*            ADD +1 TO ASC-SEQ-NBR                                        
117920*                       (ASC-BLK-SUB ASC-ITEM-SUB)                      *1
117930*            ADD +1 TO ASC-NUMBER-OF-ITEMS-READ                           
117940*            MOVE ASC-NUMBER-OF-ITEMS-READ                                
117950*                               TO ASC-LIST-ITEM-NUMBER                   
117960*                                  (ASC-BLK-SUB ASC-ITEM-SUB)           *1
118000         END-IF                                                      CL**1
118100     END-IF.                                                         CL**1
118200     SUBTRACT +1 FROM ASC-ITEM-SUB.                                  CL**1
118300     IF  ASC-ITEM-SUB < + 1                                          CL**1
118400         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                     CL**1
118500         MOVE +1                 TO ASC-BLK-SUB                      CL**1
118600     END-IF.                                                         CL**1
118700                                                                     CL**1
118701*----------------------------------------------------------------*VLKCS510
118702* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *VLKCS510
118703* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *VLKCS510
118704* FOR THE SELECTED ITEMS QUEUE.                                  *VLKCS510
118705*                                                                *VLKCS510
118706* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *VLKCS510
118707* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *VLKCS510
118708* THE ARRAY IS FULL.                                             *VLKCS510
118709*----------------------------------------------------------------*VLKCS510
118710 5000-PREPARE-SEL-QUEUE.                                          VLKCS510
118711                                                                  VLKCS510
118712     MOVE +1                   TO  ASC-BLK-SUB.                   VLKCS510
118713     PERFORM 5100-WRITE-TEMP-STORAGE.                             VLKCS510
118714     ADD +1                    TO  ASC-BLK-SUB.                   VLKCS510
118715     PERFORM 5100-WRITE-TEMP-STORAGE.                             VLKCS510
118716                                                                  VLKCS510
118717     MOVE ASC-SEL-QUEUE-NAME   TO                                   *    8
118718                  VL005-SEL-QUEUE-NAME                               CL**1
118720                                                                          
118721     PERFORM 2050-DELETE-DETAIL-QUEUE.                                  88
118722                                                                  VLKCS510
118723     SET ASC-UPDATE-TSQ        TO  TRUE.                          VLKCS510
118725     SET VL001-IDX             TO  1.                             VLKCS510
118726     MOVE ZERO                 TO VL005-NUMBER-OF-TS-ITEMS.             88
118727     INITIALIZE VL001-SELECTED-ITEM-ARRAY.                        VLKCS510
118728                                                                  VLKCS510
118729     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           VLKCS510
118730             VARYING PV-ITEM                                      VLKCS510
118731             FROM 1 BY 1                                          VLKCS510
118732             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     VLKCS510
118733                                                                  VLKCS510
118734     IF  VL001-IDX > 1                                            VLKCS510
118735         PERFORM 5205-WRITE-SEL-QUEUE                             VLKCS510
118736         ADD +1                TO VL005-NUMBER-OF-TS-ITEMS              88
118737     END-IF.                                                      VLKCS510
118738                                                                  VLKCS510
118739*    IF PS-RSN-QUEUE-NOT-WRITTEN                                          
118740*        PERFORM 5205-WRITE-SEL-QUEUE                             VLKCS510
118741*        MOVE 1 TO VL005-NUMBER-OF-RSN-TS-ITEMS                           
118750*    END-IF.                                                      VLKCS510
118800*----------------------------------------------------------------*   CL**1
118900*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *   CL**1
119000*----------------------------------------------------------------*   CL**1
119100                                                                     CL**1
119101******************************************************************VLKCS510
119102** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **VLKCS510
119103** SPECIFIC COMMAREA.                                           **VLKCS510
119104******************************************************************VLKCS510
119105 5105-REWRITE-ASC-LISTQ.                                          VLKCS510
119106                                                                  VLKCS510
119107     EXEC CICS                                                    VLKCS510
119108         WRITEQ TS                                                VLKCS510
119109             QUEUE (ASC-LIST-QUEUE-NAME)                          VLKCS510
119110             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               VLKCS510
119111             ITEM  (PV-BLOCK-NUMBER)                              VLKCS510
119112             REWRITE                                              VLKCS510
119113             RESP  (PV-CICS-RESP)                                 VLKCS510
119114     END-EXEC.                                                    VLKCS510
119115                                                                  VLKCS510
119116     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           VLKCS510
119117         CONTINUE                                                 VLKCS510
119118     ELSE                                                         VLKCS510
119119         SET DP013-CICS-ABEND            TO TRUE                  VLKCS510
119120         SET DP013-NO-ROLLBACK           TO TRUE                  VLKCS510
119121         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       VLKCS510
119122         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     VLKCS510
119123                                         TO DP013-MESSAGE-TEXT(1) VLKCS510
119124         PERFORM DP013-0000-PROCESS-ABEND                         VLKCS510
119125     END-IF.                                                      VLKCS510
119126******************************************************************VLKCS510
119127** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **VLKCS510
119128** SPECIFIC COMMAREA.                                           **VLKCS510
119129******************************************************************VLKCS510
119130 5110-WRITE-ASC-LISTQ.                                            VLKCS510
119131                                                                  VLKCS510
119132     EXEC CICS                                                    VLKCS510
119133         WRITEQ TS                                                VLKCS510
119134             QUEUE (ASC-LIST-QUEUE-NAME)                          VLKCS510
119135             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               VLKCS510
119136             ITEM  (PV-BLOCK-NUMBER)                              VLKCS510
119137             RESP  (PV-CICS-RESP)                                 VLKCS510
119138     END-EXEC.                                                    VLKCS510
119139     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      VLKCS510
119140         SET DP013-CICS-ABEND      TO TRUE                        VLKCS510
119141         SET DP013-NO-ROLLBACK     TO TRUE                        VLKCS510
119142         MOVE '5110-WRITE-ASC-LISTQ'                              VLKCS510
119143                                   TO DP013-PARAGRAPH             VLKCS510
119144         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           VLKCS510
119145                                   TO DP013-MESSAGE-TEXT(1)       VLKCS510
119146         PERFORM DP013-0000-PROCESS-ABEND                         VLKCS510
119147     END-IF.                                                      VLKCS510
119148                                                                  VLKCS510
119149                                                                  VLKCS510
119150 5100-WRITE-TEMP-STORAGE.                                         VLKCS510
119151                                                                  VLKCS510
119152     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     VLKCS510
119153                                   TO PV-LIST-ITEM-NUMBER.        VLKCS510
119154     COMPUTE PV-BLOCK-NUMBER =                                    VLKCS510
119155         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    VLKCS510
119156                                                                  VLKCS510
119157     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             VLKCS510
119158     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             VLKCS510
119159         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      VLKCS510
119160             PERFORM 5105-REWRITE-ASC-LISTQ                       VLKCS510
119161         END-IF                                                   VLKCS510
119162     ELSE                                                         VLKCS510
119163         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       VLKCS510
119164         ASC-HIGHEST-BLOCK-WRITTEN + 1                            VLKCS510
119165         PERFORM 5110-WRITE-ASC-LISTQ                             VLKCS510
119166         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   VLKCS510
119167     END-IF.                                                      VLKCS510
119168                                                                  VLKCS510
119170     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             VLKCS510
119171 5120-DELETE-ASC-LISTQ.                                           VLKCS510
119172                                                                  VLKCS510
119173     EXEC CICS                                                    VLKCS510
119174          DELETEQ TS                                              VLKCS510
119175             QUEUE (ASC-LIST-QUEUE-NAME)                          VLKCS510
119176             RESP  (PV-CICS-RESP)                                 VLKCS510
119177     END-EXEC.                                                    VLKCS510
119178                                                                  VLKCS510
119179     IF (PV-CICS-RESP = DFHRESP (NORMAL)                          VLKCS510
119180     OR  PV-CICS-RESP = DFHRESP (QIDERR))                         VLKCS510
119181         CONTINUE                                                 VLKCS510
119182     ELSE                                                         VLKCS510
119183         SET DP013-CICS-ABEND      TO TRUE                        VLKCS510
119184         SET DP013-NO-ROLLBACK     TO TRUE                        VLKCS510
119185         MOVE '5120-DELETE-ASC-LISTQ'                             VLKCS510
119186                                   TO DP013-PARAGRAPH             VLKCS510
119187         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           VLKCS510
119188                                   TO DP013-MESSAGE-TEXT(1)       VLKCS510
119189         PERFORM DP013-0000-PROCESS-ABEND                         VLKCS510
119190     END-IF.                                                      VLKCS510
119191                                                                  VLKCS510
119200*5100-WRITE-TEMP-STORAGE.                                            CL**1
119300*                                                                    CL**1
119400*    MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                        CL**1
119500*                              TO  PV-LIST-ITEM-NUMBER.              CL**1
119600*    COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                              CL**1
119700*        ASC-HIGHEST-BLOCK-WRITTEN + 1.                              CL**1
119800*                                                                    CL**1
119900*    EXEC CICS                                                       CL**1
120000*        WRITEQ TS                                                   CL**1
120100*            QUEUE (ASC-DTL-QUEUE-NAME)                              CL**1
120200*            FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))                  CL**1
120300*            ITEM  (PV-HIGHEST-BLOCK-WRITTEN)                        CL**1
120400*            RESP  (PV-CICS-RESP)                                    CL**1
120500*    END-EXEC.                                                       CL**1
120600*                                                                    CL**1
120700*    IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                         CL**1
120800*        SET DP013-CICS-ABEND                                        CL**1
120900*                      TO  TRUE                                      CL**1
121000*        SET DP013-NO-ROLLBACK                                       CL**1
121100*                      TO  TRUE                                      CL**1
121200*        MOVE '5100-WRITE-TEMP-STORAGE'                              CL**1
121300*                      TO  DP013-PARAGRAPH                           CL**1
121400*        MOVE 'ATTEMPTING TO WRITE TEMP STORAGE LIST BLOCK'          CL**1
121500**                     TO  DP013-MESSAGE-TEXT(1)                     CL**1
121600**       PERFORM DP013-0000-PROCESS-ABEND                            CL**1
121700*    END-IF.                                                         CL**1
121800*    ADD +1            TO  ASC-HIGHEST-BLOCK-WRITTEN.                CL**1
121900                                                                     CL**1
122000 EJECT                                                               CL**1
122001                                                                  VLKCS510
122002*----------------------------------------------------------------*VLKCS510
122003* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *VLKCS510
122004* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *VLKCS510
122005*----------------------------------------------------------------*VLKCS510
122006 5200-FILL-SEL-QUEUE-RECORD.                                      VLKCS510
122007                                                                  VLKCS510
122008     PERFORM 6112-READ-LIST-QUEUE.                                VLKCS510
122009                                                                  VLKCS510
122010     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       VLKCS510
122011         PERFORM                                                  VLKCS510
122012         VARYING LQW-IDX                                          VLKCS510
122013         FROM 1 BY 1                                              VLKCS510
122014         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            VLKCS510
122015           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          VLKCS510
122016                                                                  VLKCS510
122018            MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)                         88
122019                              TO VL001-ITEM (VL001-IDX)                 88
122020                 MOVE LQW-SEQ-NBR           (LQW-IDX)                   84
122021                           TO VL001-SEQ-NBR (VL001-IDX)                 *6
122022                 MOVE LQW-PRE-TKT-CMNT-DESC (LQW-IDX)                   *2
122023                    TO VL001-PRE-TKT-CMNT-DESC (VL001-IDX)              *6
122024                 ADD +1 TO VL005-NUMBER-OF-SELECTED-ITEMS                 
122025                 SET VL001-IDX UP BY 1                            VLKCS510
122026                 IF  VL001-IDX > VL001-MAX-ITEMS                  VLKCS510
122027                     PERFORM 5205-WRITE-SEL-QUEUE                 VLKCS510
122028                     ADD +1   TO VL005-NUMBER-OF-TS-ITEMS               88
122029                     INITIALIZE VL001-SELECTED-ITEM-ARRAY         VLKCS510
122030                     SET VL001-IDX TO  1                          VLKCS510
122031                 END-IF                                           VLKCS510
122032*            END-IF                                               VLKCS510
122033         END-PERFORM                                              VLKCS510
122034     END-IF.                                                      VLKCS510
122035                                                                  VLKCS510
122036*----------------------------------------------------------------*VLKCS510
122037*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *VLKCS510
122038*----------------------------------------------------------------*VLKCS510
122039 5205-WRITE-SEL-QUEUE.                                            VLKCS510
122040                                                                  VLKCS510
122041     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            VLKCS510
122042                                   TO VL001-SELECTED-ITEMS              88
122043                                      VL005-NUMBER-OF-RSN-CODES.        *2
122044                                                                  VLKCS510
122045     EXEC CICS                                                    VLKCS510
122046          WRITEQ TS                                               VLKCS510
122047              QUEUE (ASC-SEL-QUEUE-NAME)                          VLKCS510
122048              FROM (VL001-COMMENTS-SEL-REC)                             *1
122049              ITEM  (PV-ITEM)                                           88
122050              RESP  (PV-CICS-RESP)                                VLKCS510
122051     END-EXEC.                                                    VLKCS510
122052                                                                  VLKCS510
122053     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          VLKCS510
122054         SET PS-RSN-QUEUE-WRITTEN  TO TRUE                               1
122055     ELSE                                                         VLKCS510
122056         SET DP013-CICS-ABEND      TO TRUE                        VLKCS510
122057         SET DP013-NO-ROLLBACK     TO TRUE                        VLKCS510
122058         MOVE '5205-WRITE-SEL-QUEUE'                              VLKCS510
122059                                   TO DP013-PARAGRAPH             VLKCS510
122060         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          VLKCS510
122061                                   TO DP013-MESSAGE-TEXT(1)       VLKCS510
122062         PERFORM DP013-0000-PROCESS-ABEND                         VLKCS510
122063     END-IF.                                                      VLKCS510
122070                                                                  VLKCS510
122100                                                                     CL**8
122200*----------------------------------------------------------------*   CL**7
122300* APPLY THE CHANGES TO THE MESSAGE TO THE DB2 TABLE.             *   CL**7
122400*----------------------------------------------------------------*   CL**7
122500                                                                     CL**8
122600 6000-UPDATE-SYSTEM-MESSAGE.                                         CL**7
122700                                                                     CL**8
123100     IF  ASC-USE-SELECTION-QUEUE                                     CL**7
123200         PERFORM 6200-UPDATE-SELECTION-QUEUE                         CL**7
123300     END-IF.                                                         CL**7
123400                                                                     CL**8
128700                                                                     CL**8
128800*----------------------------------------------------------------*   CL**7
128900* RECORD IN THE SELECTION TEMP STORAGE QUEUE THE FACT THAT THIS  *   CL**7
129000* OBJECT WAS UDPATED.                                            *   CL**7
129100*----------------------------------------------------------------*   CL**7
129200                                                                     CL**8
129300 6200-UPDATE-SELECTION-QUEUE.                                        CL**7
129400                                                                     CL**8
129500     PERFORM 9100-READ-SEL-QUEUE.                                    CL**7
129700     PERFORM 9200-REWRITE-SEL-QUEUE.                                 CL*10
129800                                                                     CL**8
129900 EJECT                                                               CL**7
130000                                                                     CL**8
130100*----------------------------------------------------------------*   CL**1
130200* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *   CL**1
130300*----------------------------------------------------------------*   CL**1
130400                                                                     CL**1
130401                                                                  VLKCS510
130402*----------------------------------------------------------------*VLKCS510
130403*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*VLKCS510
130404*----------------------------------------------------------------*VLKCS510
130405 6112-READ-LIST-QUEUE.                                            VLKCS510
130406                                                                  VLKCS510
130407     EXEC CICS                                                    VLKCS510
130408         READQ TS                                                 VLKCS510
130409             QUEUE (ASC-LIST-QUEUE-NAME)                          VLKCS510
130410             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     VLKCS510
130411             ITEM  (PV-ITEM)                                      VLKCS510
130412             RESP  (PV-CICS-RESP)                                 VLKCS510
130413     END-EXEC.                                                    VLKCS510
130414                                                                  VLKCS510
130415     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          VLKCS510
130416         CONTINUE                                                 VLKCS510
130417     ELSE                                                         VLKCS510
130418         SET DP013-CICS-ABEND        TO TRUE                      VLKCS510
130419         SET DP013-NO-ROLLBACK       TO TRUE                      VLKCS510
130420         MOVE '6112-F AD-LIST-QUEUE' TO DP013-PARAGRAPH           VLKCS510
130421         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    VLKCS510
130422                                     TO DP013-MESSAGE-TEXT(1)     VLKCS510
130423         PERFORM DP013-0000-PROCESS-ABEND                         VLKCS510
130424     END-IF.                                                      VLKCS510
130430                                                                     CL**1
130500 9100-READ-SEL-QUEUE.                                                CL**1
130600                                                                     CL**8
130700     EXEC CICS                                                       CL**1
130800         READQ TS                                                    CL**1
130900             QUEUE (ASC-SEL-QUEUE-NAME)                              CL**1
131000             INTO  (VL001-COMMENTS-SEL-REC)                             *1
131100             ITEM  (ASC-SEL-ITEM)                                    CL**1
131200             RESP  (PV-CICS-RESP)                                    CL**1
131300     END-EXEC.                                                       CL**1
131400                                                                     CL**1
131500     IF (PV-CICS-RESP EQUAL DFHRESP(NORMAL)                          CL**1
131510     OR  PV-CICS-RESP EQUAL DFHRESP(QIDERR)                          CL**1
131520     OR  PV-CICS-RESP EQUAL DFHRESP(ITEMERR))                        CL**1
131600         CONTINUE                                                    CL**1
131700     ELSE                                                            CL**1
131800         SET DP013-LOGIC-ABEND                                       CL**1
131900             DP013-NO-ROLLBACK     TO TRUE                           CL**1
132000         MOVE '9100-READ-SEL-QUEUE'                                  CL**1
132100                                   TO DP013-PARAGRAPH                CL**1
132200         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'      CL**1
132300                                   TO DP013-MESSAGE-TEXT (1)         CL**1
132400         PERFORM DP013-0000-PROCESS-ABEND                            CL**1
132500     END-IF.                                                         CL**1
132600                                                                     CL**8
132700*----------------------------------------------------------------*   CL**1
132800* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *   CL**1
132900*----------------------------------------------------------------*   CL**1
133000                                                                     CL**8
133100 9200-REWRITE-SEL-QUEUE.                                             CL**1
133200                                                                     CL**8
133300     EXEC CICS                                                       CL**1
133400          WRITEQ TS                                                  CL**1
133500              QUEUE  (ASC-SEL-QUEUE-NAME)                            CL**1
133600              FROM   (VL001-COMMENTS-SEL-REC)                           *1
133700              ITEM   (ASC-SEL-ITEM)                                  CL**1
133800              RESP   (PV-CICS-RESP)                                  CL**1
133900              REWRITE                                                CL**1
134000     END-EXEC.                                                       CL**1
134100                                                                     CL**1
134200     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                      CL**1
134300         SET DP013-CICS-ABEND                                        CL**1
134400             DP013-NO-ROLLBACK     TO TRUE                           CL**1
134500         MOVE '9200-REWRITE-SEL-QUEUE'                               CL**1
134600                                   TO DP013-PARAGRAPH                CL**1
134700         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'      CL**1
134800                                   TO DP013-MESSAGE-TEXT (1)         CL**1
134900         PERFORM DP013-0000-PROCESS-ABEND                            CL**1
135000     END-IF.                                                         CL**1
135100                                                                     CL**1
135200 EJECT                                                               CL**1
135300                                                                     CL**8
135400*----------------------------------------------------------------*   CL**1
135500*    ABEND PROCESSOR MODULE                                      *   CL**1
135600*----------------------------------------------------------------*   CL**1
135700                                                                     CL**1
135800     COPY DPPD013.                                                   CL**1
