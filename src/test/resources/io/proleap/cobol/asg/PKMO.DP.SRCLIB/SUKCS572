000100 TITLE 'STORE TRAILER CLASS LIST SUMMARY'.                        00010002
000200 IDENTIFICATION DIVISION.                                         00020002
000300 PROGRAM-ID.    SUKCS572.                                         00030002
000400 AUTHOR.        DENNIS STEFFEN.                                   00040002
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050002
000600 DATE-WRITTEN.  SPRING 2002.                                      00060002
000700 DATE-COMPILED.                                                   00070002
263968*---------------------------------------------------------------* 00071006
263968* CHANGED 11/15/2021    BY JIM HUNTER      WR: CHG0263968         00072006
263968* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00073006
263968* MAKING THE CALL DYNAMIC VS STATIC.                              00074006
001130*                                                                 00074107
001110* CHANGED 01/09/2023    BY JEAN KURK       WR: CHG0278099         00074207
001120* CHANGE CALL OF DPKCS030 TO BE DYNAMIC                           00074307
263968*---------------------------------------------------------------* 00075006
000800 ENVIRONMENT DIVISION.                                            00080002
000900 DATA DIVISION.                                                   00090002
001000                                                                  00100002
001100 WORKING-STORAGE SECTION.                                         00110002
001200                                                                  00120002
001300 01  DK-DB2-KEYS.                                                 00130002
001400     05  DK-TRIP-OCRNC-ID             PIC S9(9) COMP VALUE ZERO.  00140002
001500     05  DK-DEPT-NBR                PIC S9(04)  COMP-3 VALUE ZERO.00150002
001600     05  DK-OTBND-TRIP-ID             PIC S9(9) COMP VALUE ZERO.  00160002
001700     05  DK-STATUS-CODE-1             PIC X(02) VALUE SPACE.      00170002
001800     05  DK-STATUS-CODE-2             PIC X(02) VALUE SPACE.      00180002
001900     05  DK-STATUS-CODE-3             PIC X(02) VALUE SPACE.      00190002
002000     05  DK-STATUS-CODE-4             PIC X(02) VALUE SPACE.      00200002
002100     05  DK-FROM-DATE                 PIC X(10) VALUE SPACE.      00210002
002200     05  DK-TO-DATE                   PIC X(10) VALUE SPACE.      00220002
002210     05  DK-MAJ-CL-NBR                PIC S9(4) COMP-3.           00221003
002300                                                                  00230002
002400 01  PC-PROGRAM-CONSTANTS.                                        00240002
002500     05  PC-INTER-APPL-CODES.                                     00250002
002600         10  PC-INTER-APPL-CRIT-SPEC    PIC  X(01)  VALUE '1'.    00260002
002700         10  PC-INTER-APPL-LIST         PIC  X(01)  VALUE '2'.    00270002
002800     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00280002
002900                                                    'SU572A  '.   00290002
003000     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00300002
003100                                                    'SUKM572 '.   00310002
003200     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00320002
003300                                                    'SUKCS572'.   00330002
003400     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00340002
003500     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00350002
003600     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00360002
003700     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +10     00370002
003800                                                    COMP SYNC.    00380002
003900     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00390002
004000                                                    COMP SYNC.    00400002
004100     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00410002
004200                                                    +1000000      00420002
004300                                                    COMP-3.       00430002
004400     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00440002
004500                                                    COMP SYNC.    00450002
004600     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    00460002
004700     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00470002
004800     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00480002
004900     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00490002
005000     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00500002
005100*                                                                 00510002
005200     05  PC-TSYMSG-NUMBERS.                                       00520002
005300         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00530002
005400         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00540002
005500         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00550002
005600         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00560002
005700         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00570002
005800         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00580002
005900         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00590002
006000         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00600002
006100         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00610002
006200         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00620002
006300         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00630002
006400         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00640002
006500         10  PC-TSYMSG-00148            PIC  9(05)  VALUE 00148.  00650002
006600         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00660002
006700         10  PC-TSYMSG-00551            PIC  9(05)  VALUE 00551.  00670002
006800         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  00680002
006900*                                                                 00690002
007000 01  PS-PROGRAM-SWITCHES.                                         00700002
007100     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'N'.    00710002
007200         88  PS-NO-ERROR                            VALUE 'N'.    00720002
007300         88  PS-ERROR                               VALUE 'Y'.    00730002
007400     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00740002
007500         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00750002
007600         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00760002
007700     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    00770002
007800         88  PS-DONE                                VALUE 'Y'.    00780002
007900         88  PS-NOT-DONE                            VALUE 'N'.    00790002
008000     05  PS-NEXT-SCREEN-SW            PIC  X    VALUE 'N'.        00800002
008100         88  PS-NO-NEXT-SCREEN                  VALUE 'N'.        00810002
008200         88  PS-NEXT-SCREEN                     VALUE 'Y'.        00820002
008300     05  PS-LIST-END-SW               PIC X(01)  VALUE 'N'.       00830000
008400         88  PS-LIST-END                         VALUE 'Y'.       00840000
008500         88  PS-NO-LIST-END                      VALUE 'N'.       00850000
008600*                                                                 00860002
008700 01  PV-PROGRAM-VARIABLES.                                        00870002
008800     05  PV-SUB                         PIC S9(04)  VALUE +0      00880002
008900                                                    COMP SYNC.    00890002
009000     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00900002
009100                                                    COMP SYNC.    00910002
009200     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      00920002
009300                                                    COMP-3.       00930002
009400     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      00940002
009500                                                    COMP-3.       00950002
009600     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      00960002
009700                                                    COMP-3.       00970002
009800     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      00980002
009900                                                    COMP-3.       00990002
010000     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01000002
010100                                                    COMP-3.       01010002
010200     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01020002
010300                                                    COMP-3.       01030002
010400     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01040002
010500                                                    COMP-3.       01050002
010600     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01060002
010700                                                    COMP SYNC.    01070002
010800     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01080002
010900                                                    COMP SYNC.    01090002
011000     05  PV-ITEM                        PIC S9(04)  VALUE +0      01100002
011100                                                    COMP SYNC.    01110002
011200     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01120002
011300                                                    COMP SYNC.    01130002
011400     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01140002
011500                                                    COMP SYNC.    01150002
011600     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01160002
011700                                                    COMP SYNC.    01170002
011800     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01180002
011900                                                    COMP SYNC.    01190002
012000     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01200002
012100                                                    COMP SYNC.    01210002
012200     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01220002
012300                                                    COMP SYNC.    01230002
012400     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01240002
012500                                                    COMP SYNC.    01250002
012600     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01260002
012700                                                    COMP SYNC.    01270002
012800     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01280002
012900                                                    COMP SYNC.    01290002
013000     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01300002
013100                                                    COMP SYNC.    01310002
013200     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01320002
013300                                                    COMP SYNC.    01330002
013400     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01340002
013500                                                    COMP SYNC.    01350002
013600     05  PV-DB2-DATE.                                             01360002
013700         10  PV-DB2-MM                PIC XX VALUE ZERO.          01370002
013800         10  FILLER                   PIC X VALUE '/'.            01380002
013900         10  PV-DB2-DD                PIC XX VALUE ZERO.          01390002
014000         10  FILLER                   PIC X VALUE '/'.            01400002
014100         10  PV-DB2-YY                PIC XX VALUE ZERO.          01410002
014200     05  PV-DATE                      PIC X(10) VALUE SPACES.     01420002
014300     05  PV-TIME                      PIC X(08) VALUE SPACES.     01430002
014400     05  PV-DB2-COUNT                 PIC S9(8) COMP VALUE ZERO.  01440002
014500                                                                  01450002
014600     05  PV-DPKUT038                  PIC X(08)  VALUE 'DPKUT038'.01460002
014700     05  PV-DPKUT038-CA-LENGTH        PIC S9(04) VALUE +1237      01470002
014800                                                 COMP.            01480002
014900     05  PV-DPKUT038-CICS-RESP        PIC S9(04) VALUE +0         01490002
015000                                                 COMP SYNC.       01500002
015100     05  PV-DPKUT038-DATE             PIC X(06)  VALUE SPACES.    01510002
015200     05  PV-DPKUT038-DATE-R REDEFINES PV-DPKUT038-DATE.           01520002
015300         10 PV-DPKUT038-YY               PIC  X(02).              01530002
015400         10 PV-DPKUT038-MM               PIC  X(02).              01540002
015500         10 PV-DPKUT038-DD               PIC  X(02).              01550002
015600     05  PV-DPKUT038-MJR-CL.                                      01560002
015700         10 PV-DPKUT038-MJR-CL-N         PIC  9(02) VALUE ZEROES. 01570002
015800*                                                                 01580002
015900     05  PV-CURRENT-DATE                 PIC X(10)  VALUE SPACES. 01590002
016000     05  PV-CURRENT-DATE-R REDEFINES     PV-CURRENT-DATE.         01600002
016100         10 PV-CURRENT-CC                PIC  9(02).              01610002
016200         10 PV-CURRENT-YY                PIC  9(02).              01620002
016300         10 FILLER                       PIC  X(01).              01630002
016400         10 PV-CURRENT-MM                PIC  9(02).              01640002
016500         10 FILLER                       PIC  X(01).              01650002
016600         10 PV-CURRENT-DD                PIC  9(02).              01660002
016700     05  PV-CURRENT-TIME                 PIC X(08)  VALUE SPACES. 01670002
016800     05  PV-CURRENT-TIME-R REDEFINES     PV-CURRENT-TIME.         01680002
016900         10 PV-CURRENT-HR                PIC  9(02).              01690002
017000         10 FILLER                       PIC  X(01).              01700002
017100         10 PV-CURRENT-MN                PIC  9(02).              01710002
017200         10 FILLER                       PIC  X(03).              01720002
017300     05  PV-DEPT-NUMBER.                                          01730002
017400         10  PV-DEPT-NUMBER-N            PIC 9(03) VALUE ZERO.    01740002
017500     05  PV-CL-NBR                       PIC  X(02) VALUE SPACES. 01750002
017600*                                                                 01760002
017700                                                                  01770002
017800******************************************************************01780002
017900**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01790002
018000**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **01800002
018100**  APPLICATION-SPECIFIC COMMAREA.                              **01810002
018200******************************************************************01820002
018300 01  LQW-LIST-QUEUE-WORK-AREA.                                    01830002
018400     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01840002
018500     05  LQW-ITEM-ENTRIES               OCCURS 10 TIMES           01850002
018600                                        INDEXED BY LQW-IDX.       01860002
018700         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01870002
018800         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01880002
018900         10  LQW-SELECTED-SW          PIC  X(01).                 01890002
019000             88  LQW-SELECT                         VALUE 'S'.    01900002
019100             88  LQW-DESELECT                       VALUE ' '.    01910002
019200         10  LQW-ACTION               PIC X(03).                  01920002
019300         10  LQW-AREA                 PIC 9(03).                  01930002
019400         10  LQW-AREA-DESC            PIC X(25).                  01940002
019500         10  LQW-CARTONS              PIC S9(07) COMP-3.          01950002
019600         10  LQW-UNITS                PIC S9(07) COMP-3.          01960002
019700         10  LQW-SKU-COUNT            PIC S9(07) COMP-3.          01970002
019800         10  LQW-AD                   PIC X(01).                  01980002
019900                                                                  01990002
020000/                                                                 02000002
020100*---------------------------------------------------------------* 02010002
020200*  RECORD LAYOUT FOR THE MESSAGE SELECTION TEMP STORAGE QUEUE.  * 02020002
020300*---------------------------------------------------------------* 02030002
020400                                                                  02040002
020500     COPY SUWS013.                                                02050005
020600                                                                  02060002
020700/                                                                 02070002
020800*---------------------------------------------------------------* 02080002
020900*    MAP LAYOUT                                                 * 02090002
021000*---------------------------------------------------------------* 02100002
021100                                                                  02110002
021200     COPY SUKM572.                                                02120002
021300*                                                                 02130002
021400 01  MR-OCCURS-LAYOUT                   REDEFINES  SU572AO.       02140002
021500     05  FILLER                         PIC X(276).               02150002
021600     05  MR-SCROLL-AREA                 OCCURS 10 TIMES.          02160002
021700         10  MR-SELECTL                 PIC S9(04) COMP.          02170002
021800         10  MR-SELECTA                 PIC  X(01).               02180002
021900         10  MR-SELECTC                 PIC  X(01).               02190002
022000         10  MR-SELECTH                 PIC  X(01).               02200002
022100         10  MR-SELECTI                 PIC  X(01).               02210002
022200                                                                  02220002
022300         10  MR-ACTIONL                 PIC S9(04) COMP.          02230002
022400         10  MR-ACTIONA                 PIC  X(01).               02240002
022500         10  MR-ACTIONC                 PIC  X(01).               02250002
022600         10  MR-ACTIONH                 PIC  X(01).               02260002
022700         10  MR-ACTION                  PIC  X(03).               02270002
022800                                                                  02280002
022900         10  MR-AREA-L                  PIC S9(04) COMP.          02290002
023000         10  MR-AREA-A                  PIC  X(01).               02300002
023100         10  MR-AREA-C                  PIC  X(01).               02310002
023200         10  MR-AREA-H                  PIC  X(01).               02320002
023300         10  MR-AREA                    PIC  X(03).               02330002
023400                                                                  02340002
023500         10  MR-AREA-DESC-L             PIC S9(04) COMP.          02350002
023600         10  MR-AREA-DESC-A             PIC  X(01).               02360002
023700         10  MR-AREA-DESC-C             PIC  X(01).               02370002
023800         10  MR-AREA-DESC-H             PIC  X(01).               02380002
023900         10  MR-AREA-DESC               PIC  X(25).               02390002
024000                                                                  02400002
024100         10  MR-CARTONS-L               PIC S9(04) COMP.          02410002
024200         10  MR-CARTONS-A               PIC  X(01).               02420002
024300         10  MR-CARTONS-C               PIC  X(01).               02430002
024400         10  MR-CARTONS-H               PIC  X(01).               02440002
024500         10  MR-CARTONS                 PIC  ZZZ,ZZZ.             02450002
024600                                                                  02460002
024700         10  MR-UNITS-L                 PIC S9(04) COMP.          02470002
024800         10  MR-UNITS-A                 PIC  X(01).               02480002
024900         10  MR-UNITS-C                 PIC  X(01).               02490002
025000         10  MR-UNITS-H                 PIC  X(01).               02500002
025100         10  MR-UNITS                   PIC  ZZZ,ZZZ.             02510002
025200                                                                  02520002
025300         10  MR-SKU-COUNT-L             PIC S9(04) COMP.          02530002
025400         10  MR-SKU-COUNT-A             PIC  X(01).               02540002
025500         10  MR-SKU-COUNT-C             PIC  X(01).               02550002
025600         10  MR-SKU-COUNT-H             PIC  X(01).               02560002
025700         10  MR-SKU-COUNT               PIC  ZZZ,ZZZ.             02570002
025800                                                                  02580002
025900         10  MR-AD-L                    PIC S9(04) COMP.          02590002
026000         10  MR-AD-A                    PIC  X(01).               02600002
026100         10  MR-AD-C                    PIC  X(01).               02610002
026200         10  MR-AD-H                    PIC  X(01).               02620002
026300         10  MR-AD                      PIC  X(01).               02630002
026400     05  FILLER                         PIC X(023).               02640002
026500/                                                                 02650002
026600*---------------------------------------------------------------* 02660002
026700*    ATTRIBUTE SETTINGS                                           02670002
026800*---------------------------------------------------------------* 02680002
026900                                                                  02690002
027000     COPY DPWS015.                                                02700005
027100                                                                  02710002
027200*---------------------------------------------------------------* 02720002
027300*    FUNCTION KEYS                                                02730002
027400*---------------------------------------------------------------* 02740002
027500                                                                  02750002
027600     COPY DPWS016.                                                02760005
027700                                                                  02770002
027800*---------------------------------------------------------------* 02780002
027900*    NUMERIC EDIT LAYOUT.                                       * 02790002
028000*---------------------------------------------------------------* 02800002
028100                                                                  02810002
028200     COPY DPWS010I.                                               02820005
028300/                                                                 02830002
028400*---------------------------------------------------------------* 02840002
028500*    PARAMETERS FOR CALLING CICS ARCHITECTURE API               * 02850007
028600*---------------------------------------------------------------* 02860002
028700                                                                  02870002
028800     COPY DPWS030.                                                02880005
028800     COPY DPWS930.                                                02881007
028900                                                                  02890002
029000*   CLASS MODULE COMMAREA                                         02900002
029100     COPY DPWS003.                                                02910005
029200/                                                                 02920002
029300*---------------------------------------------------------------* 02930002
029400*    STANDARD COMMAREA.                                         * 02940002
029500*---------------------------------------------------------------* 02950002
029600                                                                  02960002
029700     COPY DPWS020.                                                02970005
029800     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02980002
029900                                                                  02990002
030000*---------------------------------------------------------------* 03000002
030100* INTER-APPLICATION COMMAREA.                                   * 03010002
030200*   DPWS054 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 03020002
030300*             SPEC SCREEN.                                      * 03030002
030400*   DPWS056 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 03040002
030500*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 03050002
030600*---------------------------------------------------------------* 03060002
030700                                                                  03070002
030800         10  INTER-APPL-COMM-AREA       PIC X(200).               03080002
030900                                                                  03090002
031000*  INPUT FROM CRIT SPEC SCREEN, SUKCS566                          03100002
031100     COPY SUWS011.                                                03110002
031200                                                                  03120002
031300*  OUTPUT TO LIST SCREEN, SUKCS568                                03130002
031400     COPY SUWS012.                                                03140002
031500*---------------------------------------------------------------* 03150002
031600*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03160002
031700*---------------------------------------------------------------* 03170002
031800         10  ASC-SPECIFIC-COMMAREA.                               03180002
031900             15  ASC-INT-APPL-FORMAT-IND    PIC  X(01).           03190002
032000             15  ASC-LIST-KEYS.                                   03200002
032100                 20  ASC-KEY-TRIP-ID        PIC S9(09) COMP.      03210002
032200             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03220002
032300                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03230002
032400                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03240002
032500                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03250002
032600                                                                  03260002
032700                 20  ASC-ITEM-ARRAY.                              03270002
032800                     25  ASC-ITEM-ENTRIES OCCURS 10 TIMES.        03280002
032900                         30  ASC-LIST-ITEM-NUMBER                 03290002
033000                                                     PIC S9(09)   03300002
033100                                                     COMP-3.      03310002
033200                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03320002
033300                             88  ASC-VALID-SELECT    VALUE ' '    03330002
033400                                                           'S'    03340002
033500                                                           'B'    03350002
033600                                                           'E'.   03360002
033700                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03370002
033800                             88  ASC-TEMP-SELECT     VALUE 'S'.   03380002
033900                             88  ASC-TEMP-BEGIN      VALUE 'B'.   03390002
034000                             88  ASC-TEMP-END        VALUE 'E'.   03400002
034100                         30  ASC-SELECTED-SW         PIC  X(01).  03410002
034200                             88  ASC-NO-SELECT       VALUE ' '.   03420002
034300                             88  ASC-SELECT          VALUE 'S'.   03430002
034400                             88  ASC-BEGIN           VALUE 'B'.   03440002
034500                             88  ASC-END             VALUE 'E'.   03450002
034600                         30  ASC-ACTION              PIC  X(03).  03460002
034700                         30  ASC-CLASS     PIC 9(03).             03470002
034800                         30  ASC-CLASS-DESC PIC X(25).            03480002
034900                         30  ASC-CART-QTY  PIC S9(07) COMP-3.     03490002
035000                         30  ASC-UNT-QTY   PIC S9(07) COMP-3.     03500002
035100                         30  ASC-SKU-COUNT PIC S9(07) COMP-3.     03510002
035200                         30  ASC-AD        PIC X(01).             03520002
035300                                                                  03530002
035400                                                                  03540002
035500             15  ASC-BLK-SUB          PIC S9(04) COMP SYNC.       03550002
035600             15  ASC-ITEM-SUB         PIC S9(04) COMP SYNC.       03560002
035700             15  ASC-NUMBER-OF-ITEMS-READ      PIC S9(09) COMP-3. 03570002
035800             15  ASC-NUMBER-OF-SELECTED-ITEMS  PIC S9(09) COMP-3. 03580002
035900             15  ASC-ITEMS-DISPLAYED           PIC S9(03) COMP-3. 03590002
036000             15  ASC-ITEM-AT-TOP-OF-PANEL      PIC S9(09) COMP-3. 03600002
036100             15  ASC-ITEM-AT-BOT-OF-PANEL      PIC S9(09) COMP-3. 03610002
036200             15  ASC-HIGHEST-BLOCK-WRITTEN     PIC S9(04) COMP    03620002
036300                                                          SYNC.   03630002
036400             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03640002
036500                                                          COMP-3. 03650002
036600             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03660002
036700                                                          COMP-3. 03670002
036800             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03680002
036900                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   03690002
037000                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   03700002
037100             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  03710002
037200                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   03720002
037300                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   03730002
037400             15  ASC-LIST-QUEUE-NAME.                             03740002
037500                 20  ASC-LIST-TERM-ID                PIC  X(04).  03750002
037600                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   03760002
037700                                                          COMP-3. 03770002
037800                 20  ASC-LIST-SEQ                    PIC  9(01).  03780002
037900             15  ASC-SEL-QUEUE-NAME.                              03790002
038000                 20  ASC-SEL-TERM-ID                 PIC  X(04).  03800002
038100                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   03810002
038200                                                          COMP-3. 03820002
038300                 20  ASC-SEL-SEQ                     PIC  9(01).  03830002
038400                                                                  03840002
038500             15  ASC-USE-SELECTION-QUEUE-IND                      03850002
038600                                                 PIC  X(01).      03860002
038700                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 03870002
038800             15  ASC-NUMBER-OF-TS-ITEMS    PIC S9(05)  COMP-3.    03880002
038900             15  ASC-SEL-SUB               PIC S9(04)  COMP.      03890002
039000             15  ASC-SEL-ITEM              PIC S9(04)  COMP.      03900002
039100             15  ASC-START-ITEM-REQUEST.                          03910002
039200                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  03920002
039300                                                                  03930002
039400                                                                  03940002
039500             15  ASC-DEPT-NBR         PIC S9(04) COMP-3.          03950002
039600             15  ASC-CURR-OPER-UNT-ID PIC S9(04) COMP.            03960002
039700             15  ASC-SERVICE-DC-NAME  PIC X(20).                  03970002
039800             15  ASC-STR-NAME         PIC X(25).                  03980002
039900             15  ASC-DEPT-NAME        PIC X(25).                  03990002
040000             15  ASC-STR-NBR          PIC S9(04) COMP.            04000002
040100             15  ASC-TRLR-SRL-NBR     PIC S9(09) COMP.            04010002
040200             15  ASC-TRIP-OCRNC-ID    PIC S9(09) COMP.            04020002
040300             15  ASC-SCAC             PIC X(04).                  04030002
040400             15  ASC-TRLR-ID          PIC X(12).                  04040002
040500             15  ASC-TRIP-STAT-DESC   PIC X(10).                  04050002
040600             15  ASC-TOTAL-CARTONS    PIC S9(07) COMP-3.          04060002
040700             15  ASC-TOTAL-UNITS      PIC S9(07) COMP-3.          04070002
040800             15  ASC-SUMMARY-DATE     PIC X(10).                  04080002
040900             15  ASC-SUMMARY-TIME     PIC X(08).                  04090002
041000             15  ASC-SCREEN-SEQUENCE  PIC X(01).                  04100002
041100                 88  ASC-DEPT-SEQ                VALUE 'D'.       04110002
041200                 88  ASC-UNIT-SEQ                VALUE 'U'.       04120002
041300             15  ASC-SEQ-DESC         PIC X(20).                  04130002
041400/                                                                 04140002
041500*    ABEND PROCESSING                                             04150002
041600                                                                  04160002
041700     COPY DPWS013.                                                04170005
041800/                                                                 04180002
041900     EXEC SQL                                                     04190002
042000          INCLUDE TSUOBTR                                         04200002
042100     END-EXEC.                                                    04210002
042200                                                                  04220002
042700*    MAJOR CLASS SUMMARY                                          04270002
042800     EXEC SQL                                                     04280002
042900          INCLUDE SUT00010                                        04290002
043000     END-EXEC.                                                    04300002
043100                                                                  04310002
043200*    MAJOR CLASS AD DATE                                          04320002
043300     EXEC SQL                                                     04330002
043400          INCLUDE SUT00011                                        04340002
043500     END-EXEC.                                                    04350002
043600/                                                                 04360002
043700*    DOMAIN BUSINESS AREA                                         04370002
043800     EXEC SQL                                                     04380002
043900          INCLUDE XLT00000                                        04390002
044000     END-EXEC.                                                    04400002
044100                                                                  04410002
044200*    DOMAIN BUSINESS GROUP                                        04420002
044300     EXEC SQL                                                     04430002
044400          INCLUDE XLT00001                                        04440002
044500     END-EXEC.                                                    04450002
044100                                                                  04451005
044200*    DOMAIN LOCATION TABLE                                        04452005
044300     EXEC SQL                                                     04453005
044400          INCLUDE XLT00010                                        04454005
044500     END-EXEC.                                                    04455005
044600                                                                  04460005
044700     EXEC SQL                                                     04470002
044800         DECLARE CLASS-CSR CURSOR FOR                             04480002
044900            SELECT                                                04490002
045000                 MAJ.MAJ_CL_NBR                                   04500002
045100               , MAJ.UNT_QTY                                      04510002
045200               , MAJ.SKU_QTY                                      04520002
045300               , MAJ.CART_QTY                                     04530002
045400         FROM SUT_MAJ_CL_SUM MAJ                                  04540002
045500         WHERE                                                    04550002
045600              MAJ.TRIP_OCRNC_ID = :DK-TRIP-OCRNC-ID               04560002
045700         AND  MAJ.DEPT_NBR      = :DK-DEPT-NBR                    04570002
045800         ORDER BY                                                 04580002
045900              MAJ.MAJ_CL_NBR                                      04590002
046000     END-EXEC.                                                    04600002
046100                                                                  04610002
046200     EXEC SQL                                                     04620002
046300         DECLARE UNIT-CSR CURSOR FOR                              04630002
046400            SELECT                                                04640002
046500                 MAJ.MAJ_CL_NBR                                   04650002
046600               , MAJ.UNT_QTY                                      04660002
046700               , MAJ.SKU_QTY                                      04670002
046800               , MAJ.CART_QTY                                     04680002
046900         FROM SUT_MAJ_CL_SUM MAJ                                  04690002
047000         WHERE                                                    04700002
047100              MAJ.TRIP_OCRNC_ID = :DK-TRIP-OCRNC-ID               04710002
047200         AND  MAJ.DEPT_NBR      = :DK-DEPT-NBR                    04720002
047300         ORDER BY                                                 04730002
047400              MAJ.UNT_QTY DESC                                    04740002
047500         ,    MAJ.MAJ_CL_NBR                                      04750002
047600     END-EXEC.                                                    04760002
047700                                                                  04770002
047900*---------------------------------------------------------------* 04790002
048000*    DB2 AREA FOR COMMUNICATIONS                                * 04800002
048100*---------------------------------------------------------------* 04810002
048200     EXEC SQL                                                     04820002
048300          INCLUDE SQLCA                                           04830002
048400     END-EXEC.                                                    04840002
048500                                                                  04850002
048100*---------------------------------------------------------------* 04860005
048700 LINKAGE SECTION.                                                 04870002
048800                                                                  04880002
048900 01  DFHCOMMAREA.                                                 04890002
049000     05  FILLER                         OCCURS  1 TO 4072 TIMES   04900002
049100                                        DEPENDING ON EIBCALEN.    04910002
049200         10  FILLER                     PIC X.                    04920002
049300                                                                  04930002
049500 PROCEDURE DIVISION.                                              04950002
049600******************************************************************04960002
049700**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **04970002
049800**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **04980002
049900**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **04990002
050000******************************************************************05000002
050100 0000-MAIN-MODULE.                                                05010002
050200     INITIALIZE DP030-CICS-API-FIELDS.                            05020002
050300     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       05030002
050400     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          05040002
050500     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         05050002
050600     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       05060002
050700     MOVE LENGTH OF SU572AI        TO DP030-MAP-LENGTH (1).       05070002
050800     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05080002
050900     PERFORM 0001-CALL-CICS-ARCH-API.                             05090002
051000*                                                                 05100002
051100     PERFORM 1000-CONTROL-PROCESSING                              05110002
051200*                                                                 05120002
051300     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05130002
051400     PERFORM 0001-CALL-CICS-ARCH-API.                             05140002
051500                                                                  05150002
051600******************************************************************05160002
051700**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **05170002
051800**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **05180002
051900******************************************************************05190002
052000 0001-CALL-CICS-ARCH-API.                                         05200002
052100*    CALL 'DPKCS030' USING DFHEIBLK                               05210007
052100     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      05211007
052200                           DFHCOMMAREA                            05220002
052300                           DP030-CICS-API-FIELDS                  05230002
052400                           DP020-STANDARD-COMMAREA                05240002
052500                           SU572AI.                               05250002
052600*                                                                 05260002
052700     IF  DP030-RC-CALL-SUCCESSFUL                                 05270002
052800         CONTINUE                                                 05280002
052900     ELSE                                                         05290002
053000         SET DP013-NO-ROLLBACK                                    05300002
053100             DP013-XCTL-DISPLAY-RESTART                           05310002
053200             DP013-CICS-ABEND      TO TRUE                        05320002
053300         MOVE '0001-CALL-CICS-ARCH-API'                           05330002
053400                                   TO DP013-PARAGRAPH             05340002
053500*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX05350007
053600*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      05360007
053500         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL. RETURN-CODE O05361007
053600-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05362007
053700         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05370002
053800         PERFORM DP013-0000-PROCESS-ABEND                         05380002
053900     END-IF.                                                      05390002
054000*----------------------------------------------------------------*05400002
054100* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *05410002
054200* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *05420002
054300*                                                                *05430002
054400* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *05440002
054500*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *05450002
054600*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *05460002
054700*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *05470002
054800*----------------------------------------------------------------*05480002
054900                                                                  05490002
055000 1000-CONTROL-PROCESSING.                                         05500002
055100                                                                  05510002
055200     EVALUATE TRUE                                                05520002
055300         WHEN DP020-NEXT-ACT-INITIAL                              05530002
055400             INITIALIZE ASC-SPECIFIC-COMMAREA                     05540002
055500             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            05550002
055600                                      ASC-SEL-TERM-ID             05560002
055700             MOVE DP020-SRC-TASK-NUMBER                           05570002
055800                                   TO ASC-LIST-TASK-NUMBER        05580002
055900                                      ASC-SEL-TASK-NUMBER         05590002
056000             MOVE PC-LIST-QUEUE-SEQ                               05600002
056100                                   TO ASC-LIST-SEQ                05610002
056200             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 05620002
056300             SET PS-COMMAREA-VALID TO TRUE                        05630002
056400                                                                  05640002
056500             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05650002
056600                                                                  05660002
056700             IF  PS-ERROR                                         05670002
056800                 CONTINUE                                         05680002
056900             ELSE                                                 05690002
057000                 PERFORM 4000-BUILD-INITIAL-PANEL                 05700002
057100*                PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             05710002
057200             END-IF                                               05720002
057300                                                                  05730002
057400***-----$TEMPLATE NOTE$-------------------------------------------05740002
057500*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,05750002
057600*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  05760002
057700*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.05770002
057800***---------------------------------------------------------------05780002
057900             IF  PS-COMMAREA-NOT-VALID                            05790002
058000***              MOVE PC-TSYMSG-99901                             05800002
058100***                                TO DP020-MSG-NUMBER            05810002
058200***              SET DP020-MSG-FATAL                              05820002
058300***                                TO TRUE                        05830002
058400                 SET DP020-NEXT-ACT-APPL-ERROR                    05840002
058500                                   TO TRUE                        05850002
058600**           ELSE                                                 05860002
058700**               PERFORM 4000-BUILD-INITIAL-PANEL                 05870002
058800             END-IF                                               05880002
058900                                                                  05890002
059000         WHEN DP020-NEXT-ACT-READ-MAP                             05900002
059100             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05910002
059200                                   TO PV-TOP-ITEM                 05920002
059300             PERFORM 2000-PROCESS-PANEL                           05930002
059400                                                                  05940002
059500         WHEN DP020-NEXT-ACT-RETURN                               05950002
059600             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05960002
059700                                   TO PV-TOP-ITEM                 05970002
059800             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05980002
059900             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 05990002
060000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06000002
060100                                                                  06010002
060200*            MOVE ASC-CURR-OPER-UNT-ID TO SU011-CURR-OPER-UNT-ID  06020002
060300*            PERFORM 2050-DELETE-LIST-QUEUE                       06030002
060400*            PERFORM 4000-BUILD-INITIAL-PANEL                     06040002
060500                                                                  06050002
060600                                                                  06060002
060700         WHEN OTHER                                               06070002
060800             SET DP013-LOGIC-ABEND TO TRUE                        06080002
060900             SET DP013-NO-ROLLBACK TO TRUE                        06090002
061000             MOVE '1000-CONTROL-PROCESSING'                       06100002
061100                                   TO DP013-PARAGRAPH             06110002
061200             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    06120002
061300                                   TO DP013-MESSAGE-TEXT(1)       06130002
061400             PERFORM DP013-0000-PROCESS-ABEND                     06140002
061500     END-EVALUATE.                                                06150002
061600                                                                  06160002
061700 EJECT                                                            06170002
061800*----------------------------------------------------------------*06180002
061900* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *06190002
062000* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *06200002
062100*----------------------------------------------------------------*06210002
062200                                                                  06220002
062300 1100-PROCESS-INTER-APPL-COMM.                                    06230002
062400                                                                  06240002
062500     SET PS-COMMAREA-VALID         TO TRUE.                       06250002
062600     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     06260002
062700     MOVE DP020-INT-APPL-FORMAT-IND TO ASC-INT-APPL-FORMAT-IND    06270002
062800     EVALUATE DP020-INT-APPL-FORMAT-IND                           06280002
062900                                                                  06290002
063000         WHEN PC-INTER-APPL-LIST                                  06300002
063100             SET ASC-USE-SELECTION-QUEUE TO TRUE                  06310002
063200             MOVE SU012-NUMBER-OF-SELECTED-ITEMS                  06320002
063300                                   TO ASC-NUMBER-OF-SELECTED-ITEMS06330002
063400             MOVE SU012-NUMBER-OF-TS-ITEMS                        06340002
063500                                    TO ASC-NUMBER-OF-TS-ITEMS     06350002
063600             MOVE SU012-SEL-QUEUE-NAME                            06360002
063700                                    TO ASC-SEL-QUEUE-NAME         06370002
063800             MOVE SU012-STR-NBR   TO ASC-STR-NBR                  06380002
063900             MOVE SU012-STR-NAME  TO ASC-STR-NAME                 06390002
064000             MOVE SU012-SUMMARY-DATE TO ASC-SUMMARY-DATE          06400002
064100             MOVE SU012-SUMMARY-TIME TO ASC-SUMMARY-TIME          06410002
064200             PERFORM 1101-SCREEN-SEQUENCE                         06420002
064300                                                                  06430002
064400             PERFORM 1120-PREPARE-LIST-ENTRY                      06440002
064500                                                                  06450002
064600         WHEN OTHER                                               06460002
064700             MOVE PC-TSYMSG-00148                                 06470002
064800                                     TO DP020-MSG-NUMBER          06480002
064900             SET DP020-MSG-FATAL                                  06490002
065000                 DP020-NEXT-ACT-APPL-ERROR                        06500002
065100                                     TO TRUE                      06510002
065200     END-EVALUATE.                                                06520002
065300 1101-SCREEN-SEQUENCE.                                            06530002
065400     EVALUATE TRUE                                                06540002
065500         WHEN SU012-DEPT-SEQ                                      06550002
065600             MOVE 'CLASS SEQUENCE'      TO ASC-SEQ-DESC           06560002
065700                                                                  06570002
065800         WHEN SU012-UNIT-SEQ                                      06580002
065900             MOVE 'UNIT SEQUENCE'       TO ASC-SEQ-DESC           06590002
066000         WHEN OTHER                                               06600002
066100             SET SU012-DEPT-SEQ         TO TRUE                   06610002
066200             MOVE 'CLASS SEQUENCE'      TO ASC-SEQ-DESC           06620002
066300     END-EVALUATE.                                                06630002
066400     MOVE SU012-SCREEN-SEQUENCE    TO ASC-SCREEN-SEQUENCE.        06640002
066500/                                                                 06650002
066600 1120-PREPARE-LIST-ENTRY.                                         06660002
066700     MOVE SU013-MAX-ITEMS          TO ASC-SEL-SUB.                06670002
066800     MOVE ZERO                     TO ASC-SEL-ITEM.               06680002
066900     PERFORM 2110-GET-NEXT-MESSAGE.                               06690002
067000/                                                                 06700002
067100 2110-GET-NEXT-MESSAGE.                                           06710002
067200     ADD +1                        TO ASC-SEL-SUB.                06720002
067300     IF  ASC-SEL-SUB > SU013-MAX-ITEMS                            06730002
067400         ADD +1                    TO ASC-SEL-ITEM                06740002
067500         MOVE +1                   TO ASC-SEL-SUB                 06750002
067600     END-IF.                                                      06760002
067700     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                06770002
067800         PERFORM 9100-READ-SEL-QUEUE                              06780002
067900         IF  SU013-ITEM (ASC-SEL-SUB) > ZERO                      06790002
068000             MOVE SU013-TRIP-OCRNC-ID (ASC-SEL-SUB)               06800002
068100                                   TO ASC-TRIP-OCRNC-ID           06810002
068200             MOVE SU013-TRLR-SRL-NBR (ASC-SEL-SUB)                06820002
068300                                   TO ASC-TRLR-SRL-NBR            06830002
068400             MOVE SU013-SCAC (ASC-SEL-SUB)                        06840002
068500                                   TO ASC-SCAC                    06850002
068600             MOVE SU013-TRLR-ID (ASC-SEL-SUB)                     06860002
068700                                   TO ASC-TRLR-ID                 06870002
068800                                                                  06880002
068900             MOVE SU013-TRIP-ID (ASC-SEL-SUB)                     06890002
069000                                   TO DK-OTBND-TRIP-ID            06900002
069100                                                                  06910002
069200             MOVE SU013-TRIP-STAT-DESC (ASC-SEL-SUB)              06920002
069300                                   TO ASC-TRIP-STAT-DESC          06930002
069400             MOVE SU013-CARTON-CNT (ASC-SEL-SUB)                  06940002
069500                                   TO ASC-TOTAL-CARTONS           06950002
069600             MOVE SU013-UNIT-COUNT (ASC-SEL-SUB)                  06960002
069700                                   TO ASC-TOTAL-UNITS             06970002
069800             MOVE SU013-DEPT-NBR   (ASC-SEL-SUB)                  06980002
069900                                   TO ASC-DEPT-NBR                06990002
070000                                      PV-DEPT-NUMBER-N            07000002
070100                                      DK-DEPT-NBR                 07010002
070200             MOVE SU013-DEPT-NAME (ASC-SEL-SUB)                   07020002
070300                                   TO ASC-DEPT-NAME               07030002
070400                                                                  07040002
070500*  FIND DEPT NAME HERE USING XLKUT004 PGM                         07050002
070600*            PERFORM 7000-SELECT-SERVICING-DC                     07060002
070700             MOVE SU012-SERVICING-DC  TO ASC-SERVICE-DC-NAME      07070002
070800                                         AOPERO                   07080002
070900                                                                  07090002
071000*            PERFORM 7001-CONVERT-DATES                           07100002
071100             MOVE ASC-SUMMARY-DATE TO ASUMDTEO                    07110002
071200             MOVE ASC-SUMMARY-TIME TO ASUMTMEO                    07120002
071300                                                                  07130002
071400             SET SU013-INQ (ASC-SEL-SUB)                          07140002
071500                                   TO TRUE                        07150002
071600             PERFORM 9200-REWRITE-LIST-QUEUE                      07160002
071700         ELSE                                                     07170002
071800             SUBTRACT +1 FROM ASC-SEL-SUB                         07180002
071900*            --- BOTTOM OF LIST ---                               07190002
072000             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            07200002
072100             SET DP020-MSG-INFORMATIONAL                          07210002
072200                 PS-LIST-END       TO TRUE                        07220002
072300         END-IF                                                   07230002
072400     ELSE                                                         07240002
072500         SUBTRACT +1 FROM ASC-SEL-ITEM                            07250002
072600         MOVE SU013-MAX-ITEMS      TO ASC-SEL-SUB                 07260002
072700         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            07270002
072800         SET DP020-MSG-INFORMATIONAL                              07280002
072900             PS-LIST-END           TO TRUE                        07290002
073000     END-IF.                                                      07300002
073100                                                                  07310002
073200 2120-GET-PREV-MESSAGE.                                           07320002
073300     SUBTRACT +1                 FROM ASC-SEL-SUB.                07330002
073400     IF  ASC-SEL-SUB < +1                                         07340002
073500         SUBTRACT +1 FROM ASC-SEL-ITEM                            07350002
073600         MOVE SU013-MAX-ITEMS      TO ASC-SEL-SUB                 07360002
073700     END-IF.                                                      07370002
073800                                                                  07380002
073900     IF  ASC-SEL-SUB > SU013-MAX-ITEMS                            07390002
074000         ADD +1                    TO ASC-SEL-ITEM                07400002
074100         MOVE +1                   TO ASC-SEL-SUB                 07410002
074200     END-IF.                                                      07420002
074300                                                                  07430002
074400     IF  ASC-SEL-ITEM  > ZERO                                     07440002
074500         PERFORM 9100-READ-SEL-QUEUE                              07450002
102500         IF  SU013-ITEM (ASC-SEL-SUB) > ZERO                      10250000
102600             MOVE SU013-TRIP-OCRNC-ID (ASC-SEL-SUB)               10260002
102700                                   TO ASC-TRIP-OCRNC-ID           10270002
102800             MOVE SU013-TRLR-SRL-NBR (ASC-SEL-SUB)                10280002
102900                                   TO ASC-TRLR-SRL-NBR            10290002
103000             MOVE SU013-SCAC (ASC-SEL-SUB)                        10300002
103100                                   TO ASC-SCAC                    10310002
103200             MOVE SU013-TRLR-ID (ASC-SEL-SUB)                     10320002
103300                                   TO ASC-TRLR-ID                 10330002
103400                                                                  10340002
103500             MOVE SU013-TRIP-ID (ASC-SEL-SUB)                     10350002
103600                                   TO DK-OTBND-TRIP-ID            10360002
103700                                                                  10370002
103800             MOVE SU013-TRIP-STAT-DESC (ASC-SEL-SUB)              10380002
103900                                   TO ASC-TRIP-STAT-DESC          10390002
104000             MOVE SU013-CARTON-CNT (ASC-SEL-SUB)                  10400002
104100                                   TO ASC-TOTAL-CARTONS           10410002
104200             MOVE SU013-UNIT-COUNT (ASC-SEL-SUB)                  10420002
104300                                   TO ASC-TOTAL-UNITS             10430002
104400             MOVE SU013-DEPT-NBR   (ASC-SEL-SUB)                  10440002
104500                                   TO ASC-DEPT-NBR                10450002
104600                                      PV-DEPT-NUMBER-N            10460002
104700                                      DK-DEPT-NBR                 10470002
104800             MOVE SU013-DEPT-NAME (ASC-SEL-SUB)                   10480002
104900                                   TO ASC-DEPT-NAME               10490002
105000                                                                  10500002
105100*  FIND DEPT NAME HERE USING XLKUT004 PGM                         10510002
105200*            PERFORM 7000-SELECT-SERVICING-DC                     10520002
105300             MOVE SU012-SERVICING-DC  TO ASC-SERVICE-DC-NAME      10530002
105400                                         AOPERO                   10540002
105500                                                                  10550002
105600*            PERFORM 7001-CONVERT-DATES                           10560002
105700             MOVE ASC-SUMMARY-DATE TO ASUMDTEO                    10570002
105800             MOVE ASC-SUMMARY-TIME TO ASUMTMEO                    10580002
105900                                                                  10590002
106000             SET SU013-INQ (ASC-SEL-SUB)                          10600002
106100                                   TO TRUE                        10610002
106200             PERFORM 9200-REWRITE-LIST-QUEUE                      10620002
106300         ELSE                                                     10630002
106400             MOVE +1               TO ASC-SEL-ITEM                10640002
106500                                      ASC-SEL-SUB                 10650002
106600*            --- TOP OF LIST ---                                  10660002
106700             MOVE PC-TSYMSG-00069  TO DP020-MSG-NUMBER            10670002
106800             SET DP020-MSG-INFORMATIONAL                          10680002
106900                 PS-LIST-END       TO TRUE                        10690002
107000         END-IF                                                   10700002
107100     END-IF.                                                      10710002
107200*----------------------------------------------------------------*10720002
107300* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *10730002
107400* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *10740002
107500* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *10750002
107600* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *10760002
107700* FUNCTION KEYS CAN GET THIS FAR.                                *10770002
107800*----------------------------------------------------------------*10780002
107900                                                                  10790002
108000 2000-PROCESS-PANEL.                                              10800002
108100     SET PS-NEXT-SCREEN TO TRUE.                                  10810002
108200     EVALUATE TRUE                                                10820002
108300         WHEN DP020-SRC-AID = DP016-CLEAR                         10830002
108400             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    10840002
108500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   10850002
108600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10860002
108700                                                                  10870002
108800         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    10880002
108900             PERFORM 2050-DELETE-LIST-QUEUE                       10890002
109000             MOVE ASC-TRIP-OCRNC-ID TO DK-TRIP-OCRNC-ID           10900002
109100             MOVE ASC-DEPT-NBR      TO DK-DEPT-NBR                10910002
109200                                       PV-DEPT-NUMBER-N           10920002
109300             PERFORM 4000-BUILD-INITIAL-PANEL                     10930002
109400                                                                  10940002
109500         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    10950002
109600             PERFORM 2140-DESELECT-ALL-ITEMS                      10960002
109700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10970002
109800                                                                  10980002
109900         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  10990002
110000             PERFORM 2150-SELECT-ALL-ITEMS                        11000002
110100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11010002
110200                                                                  11020002
110300         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             11030002
110301             IF  ASC-USE-SELECTION-QUEUE                          11030102
110302                 PERFORM 2110-GET-NEXT-MESSAGE                    11030200
110303                 IF PS-LIST-END                                   11030300
110304                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         11030400
110400                     SET PS-NO-LIST-END TO TRUE                   11040000
110500                 ELSE                                             11050000
110600                     PERFORM 2050-DELETE-LIST-QUEUE               11060000
110700*                    PERFORM 3200-RESET-ATTRIBUTES                11070004
110800                     PERFORM 4000-BUILD-INITIAL-PANEL             11080000
110900                 END-IF                                           11090000
111000             ELSE                                                 11100002
111100*                --- BOTTOM OF LIST ---                           11110002
111200                 MOVE PC-TSYMSG-00070                             11120002
111300                                   TO DP020-MSG-NUMBER            11130002
111310                 SET DP020-MSG-INFORMATIONAL                      11131002
111400                     PS-LIST-END      TO TRUE                     11140000
111500             END-IF                                               11150002
111600                                                                  11160002
111700         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             11170002
111800                                                                  11180002
111900             EVALUATE TRUE                                        11190002
112000                 WHEN PS-LIST-END                                 11200000
112800*                    --- TOP OF LIST ---                          11280000
113000                     MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER11300000
113100                     SET DP020-MSG-INFORMATIONAL                  11310000
136000                         DP030-SET-CURSOR-APPL-1                  13600000
136100                                   TO TRUE                        13610000
203600                     MOVE -1       TO MR-SELECTL (1)              20360000
203601                 WHEN ASC-SEL-ITEM = ZERO                         20360102
203602                     MOVE PC-TSYMSG-00069  TO DP020-MSG-NUMBER    20360200
203603                     SET DP020-MSG-INFORMATIONAL                  20360300
203604                         DP030-SET-CURSOR-APPL-1                  20360400
203605                                   TO TRUE                        20360500
203606                     MOVE -1       TO MR-SELECTL (1)              20360600
203607                 WHEN ASC-SEL-ITEM >  ZERO                        20360702
203608                     PERFORM 2120-GET-PREV-MESSAGE                20360800
203609                     IF ASC-SEL-ITEM >  ZERO                      20360902
203610                         PERFORM 2050-DELETE-LIST-QUEUE           20361000
203611*                        PERFORM 3200-RESET-ATTRIBUTES            20361104
203612                         PERFORM 4000-BUILD-INITIAL-PANEL         20361200
203613                     ELSE                                         20361302
203614                         MOVE PC-TSYMSG-00069                     20361400
203615                                           TO DP020-MSG-NUMBER    20361502
203616                         SET DP020-MSG-INFORMATIONAL              20361600
203617                             DP030-SET-CURSOR-APPL-1              20361700
203618                                           TO TRUE                20361800
203619                         MOVE -1   TO MR-SELECTL (1)              20361900
203620                     END-IF                                       20362002
203621             END-EVALUATE                                         20362100
203622                                                                  20362200
203623                                                                  20362302
203624         WHEN OTHER                                               20362402
203625             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 20362502
203626             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   20362602
203627             IF  PS-NO-ERROR                                      20362702
203628                 SET DP030-CONTINUE-GO                            20362802
203629                                 TO TRUE                          20362902
203630                 PERFORM 2100-CHECK-FUNCTION-KEY                  20363002
203640             ELSE                                                 20364002
203650                 SET DP030-OVERRIDE-GO                            20365002
203660                                 TO TRUE                          20366002
203670             END-IF                                               20367002
203680     END-EVALUATE.                                                20368002
203690 EJECT                                                            20369002
203700*----------------------------------------------------------------*20370002
203800*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *20380002
203900*----------------------------------------------------------------*20390002
204000 2050-DELETE-LIST-QUEUE.                                          20400002
204100                                                                  20410002
204200     EXEC CICS                                                    20420002
204300         DELETEQ TS                                               20430002
204400             QUEUE (ASC-LIST-QUEUE-NAME)                          20440002
204500             RESP  (PV-CICS-RESP)                                 20450002
204600     END-EXEC.                                                    20460002
204700                                                                  20470002
204800     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       20480002
204900        (PV-CICS-RESP = DFHRESP(QIDERR))                          20490002
205000         CONTINUE                                                 20500002
205100     ELSE                                                         20510002
205200         SET DP013-CICS-ABEND      TO TRUE                        20520002
205300         SET DP013-NO-ROLLBACK     TO TRUE                        20530002
205400                                                                  20540002
205500         MOVE '2050-DELETE-LIST-QUEUE'                            20550002
205600                                   TO DP013-PARAGRAPH             20560002
205700         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    20570002
205800                                   TO DP013-MESSAGE-TEXT (1)      20580002
205900         PERFORM DP013-0000-PROCESS-ABEND                         20590002
206000     END-IF.                                                      20600002
206100                                                                  20610002
206200     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  20620002
206300/                                                                 20630002
206400*----------------------------------------------------------------*20640002
206500* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*20650002
206600* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *20660002
206700* CICS ARCHITECTURE API.                                         *20670002
206800*----------------------------------------------------------------*20680002
206900 2100-CHECK-FUNCTION-KEY.                                         20690002
207000     SET PS-NEXT-SCREEN TO TRUE.                                  20700002
207100     EVALUATE TRUE                                                20710002
207200         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              20720002
207300             PERFORM 2050-DELETE-LIST-QUEUE                       20730002
207400             SET ASC-UNIT-SEQ                                     20740002
207500                 SU012-UNIT-SEQ TO TRUE                           20750002
207600             MOVE ASC-DEPT-NBR      TO DK-DEPT-NBR                20760002
207700                                       PV-DEPT-NUMBER-N           20770002
207800             PERFORM 1101-SCREEN-SEQUENCE                         20780002
207900             PERFORM 4000-BUILD-INITIAL-PANEL                     20790002
208000                                                                  20800002
208100         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              20810002
208200             PERFORM 2050-DELETE-LIST-QUEUE                       20820002
208300             SET ASC-DEPT-SEQ                                     20830002
208400                 SU012-DEPT-SEQ TO TRUE                           20840002
208500             MOVE ASC-DEPT-NBR      TO DK-DEPT-NBR                20850002
208600                                       PV-DEPT-NUMBER-N           20860002
208700             PERFORM 1101-SCREEN-SEQUENCE                         20870002
208800             PERFORM 4000-BUILD-INITIAL-PANEL                     20880002
208900                                                                  20890002
209000         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  20900002
209100             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              20910002
209200                 INITIALIZE SU012-INTER-APPL-COMMAREA             20920002
209300                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                20930002
209400                                TO SU012-NUMBER-OF-SELECTED-ITEMS 20940002
209500                 MOVE ASC-STR-NBR  TO SU012-STR-NBR               20950002
209600                 MOVE ASC-STR-NAME TO SU012-STR-NAME              20960002
209700                 MOVE ASC-DEPT-NAME TO SU012-DEPARTMENT-NAME      20970002
209800                 PERFORM 5000-PREPARE-SEL-QUEUE                   20980002
209900             ELSE                                                 20990002
210000                 SET DP030-OVERRIDE-GO                            21000002
210100                                   TO TRUE                        21010002
210200                 MOVE PC-TSYMSG-00057                             21020002
210300                                   TO DP020-MSG-NUMBER            21030002
210400                 SET DP020-MSG-WARNING                            21040002
210500                                   TO TRUE                        21050002
210600             END-IF                                               21060002
210700                                                                  21070002
210800         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  21080002
210900             MOVE +1               TO PV-TOP-ITEM                 21090002
211000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 21100002
211100                                                                  21110002
211200         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   21120002
211300             PERFORM 2110-BROWSE-BACKWARD                         21130002
211400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 21140002
211500                                                                  21150002
211600         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   21160002
211700             PERFORM 2120-BROWSE-FORWARD                          21170002
211800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 21180002
211900                                                                  21190002
212000         WHEN DP020-SRC-AID = DP016-ENTER                         21200002
212100*            PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   21210004
212200             IF  PS-ERROR                                         21220002
212300                 CONTINUE                                         21230002
212400             ELSE                                                 21240002
208500                 MOVE ASC-DEPT-NBR  TO DK-DEPT-NBR                21241004
208600                                       PV-DEPT-NUMBER-N           21242004
212500                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             21250002
212600             END-IF                                               21260002
212700                                                                  21270002
212800         WHEN OTHER                                               21280002
212900             SET DP013-NO-ROLLBACK                                21290002
213000                 DP013-XCTL-DISPLAY-RESTART                       21300002
213100                 DP013-CICS-ABEND  TO TRUE                        21310002
213200             MOVE '2100-CHECK-FUNCTION-KEY'                       21320002
213300                                   TO DP013-PARAGRAPH             21330002
213400             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      21340002
213500                                   TO DP013-MESSAGE-TEXT (1)      21350002
213600             PERFORM DP013-0000-PROCESS-ABEND                     21360002
213700     END-EVALUATE.                                                21370002
213800*                                                                 21380002
213900*----------------------------------------------------------------*21390002
214000*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *21400002
214100*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *21410002
214200*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *21420002
214300*    MESSAGE.                                                    *21430002
214400*----------------------------------------------------------------*21440002
214500                                                                  21450002
214600 2110-BROWSE-BACKWARD.                                            21460002
214700     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    21470002
214800         GIVING PV-TOP-ITEM.                                      21480002
214900*                                                                 21490002
215000     IF  ((PV-TOP-ITEM < +1)                                      21500002
215100       OR (PV-TOP-ITEM = +1))                                     21510002
215200         MOVE +1                   TO PV-TOP-ITEM                 21520002
215300*        -- TOP OF LIST --                                        21530002
215400         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            21540002
215500         SET DP020-MSG-INFORMATIONAL                              21550002
215600             PS-LIST-END           TO TRUE                        21560002
215700     END-IF.                                                      21570002
215800                                                                  21580002
215900 EJECT                                                            21590002
216000*----------------------------------------------------------------*21600002
216100*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *21610002
216200*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *21620002
216300*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *21630002
216400*----------------------------------------------------------------*21640002
216500                                                                  21650002
216600 2120-BROWSE-FORWARD.                                             21660002
216700                                                                  21670002
216800     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              21680002
216900         GIVING PV-TOP-ITEM.                                      21690002
217000     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   21700002
217100         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            21710002
217200                                   TO PV-TOP-ITEM                 21720002
217300*        -- BOTTOM OF LIST --                                     21730002
217400         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            21740002
217500         SET DP020-MSG-INFORMATIONAL                              21750002
217600                                   TO TRUE                        21760002
217700     ELSE                                                         21770002
217800         COMPUTE PV-BOTTOM-ITEM =                                 21780002
217900             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 21790002
218000         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            21800002
218100*            -- BOTTOM OF LIST --                                 21810002
218200             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            21820002
218300             SET DP020-MSG-INFORMATIONAL                          21830002
218400                                   TO TRUE                        21840002
218500         END-IF                                                   21850002
218600     END-IF.                                                      21860002
218700 EJECT                                                            21870002
218800*----------------------------------------------------------------*21880002
218900*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *21890002
219000*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *21900002
219100*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *21910002
219200*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *21920002
219300*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *21930002
219400*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *21940002
219500*----------------------------------------------------------------*21950002
219600                                                                  21960002
219700 2130-CHECK-FOR-JUMP-BROWSE.                                      21970002
219800     SET PS-NO-ERROR               TO TRUE.                       21980002
219900     IF (ASC-START-ITEM-REQUEST = SPACE)                          21990002
220000         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            22000002
220100                                   TO PV-TOP-ITEM                 22010002
220200     ELSE                                                         22020002
220300         MOVE ASC-START-ITEM-REQUEST                              22030002
220400                                   TO DP010I-UNEDITED-FIELD       22040002
220500         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       22050002
220600         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     22060002
220700         SET DP010I-NEGATIVE-NOT-ALLOWED                          22070002
220800                                   TO TRUE                        22080002
263968         CALL DP010I-NUMERIC-EDIT-ROUTINE                         22091006
263968              USING DP010I-NUMERIC-EDIT-AREA                      22092006
221000                                                                  22100002
221100         IF  NOT DP010I-ERROR-DETECTED                            22110002
221200             MOVE DP010I-NUMERIC-FIELD                            22120002
221300                                   TO  ASC-START-ITEM-REQUEST-N   22130002
221400             IF  ASC-START-ITEM-REQUEST-N > ZERO                  22140002
221500                 IF  ASC-START-ITEM-REQUEST-N >                   22150002
221600                                          ASC-NUMBER-OF-ITEMS-READ22160002
221700                     MOVE SPACE TO ASC-START-ITEM-REQUEST         22170002
221800                     COMPUTE PV-TOP-ITEM =                        22180002
221900                             ASC-NUMBER-OF-ITEMS-READ             22190002
222000                             - PC-ITEMS-PER-PANEL + 1             22200002
222100                     IF  PV-TOP-ITEM < +1                         22210002
222200                         MOVE +1   TO PV-TOP-ITEM                 22220002
222300                         MOVE PC-TSYMSG-00070                     22230002
222400                                   TO DP020-MSG-NUMBER            22240002
222500                         SET DP020-MSG-INFORMATIONAL              22250002
222600                                   TO TRUE                        22260002
222700                     END-IF                                       22270002
222800                 ELSE                                             22280002
222900                     MOVE ASC-START-ITEM-REQUEST-N                22290002
223000                                   TO PV-TOP-ITEM                 22300002
223100                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      22310002
223200                     COMPUTE PV-BOTTOM-ITEM =                     22320002
223300                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     22330002
223400                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ22340002
223500*                        -- BOTTOM OF LIST --                     22350002
223600                         MOVE PC-TSYMSG-00070                     22360002
223700                                   TO DP020-MSG-NUMBER            22370002
223800                         SET DP020-MSG-INFORMATIONAL              22380002
223900                                   TO TRUE                        22390002
224000                     END-IF                                       22400002
224100                 END-IF                                           22410002
224200             ELSE                                                 22420002
224300*                --- VALUE OUT OF RANGE ----                      22430002
224400                 MOVE PC-TSYMSG-00101                             22440002
224500                                   TO DP020-MSG-NUMBER            22450002
224600                 MOVE -1           TO ASTRTITL                    22460002
224700                 SET DP030-SET-CURSOR-APPL-1                      22470002
224800                                   TO TRUE                        22480002
224900                 MOVE DP015-REVERSE                               22490002
225000                                   TO ASTRTITH                    22500002
225100                 MOVE DP015-RED    TO ASTRTITC                    22510002
225200                 MOVE DP015-UNP-NUM-BRT-MDT                       22520002
225300                                   TO ASTRTITA                    22530002
225400                 SET DP020-MSG-FATAL                              22540002
225500                                   TO TRUE                        22550002
225600                 SET PS-ERROR      TO TRUE                        22560002
225700             END-IF                                               22570002
225800                                                                  22580002
225900         ELSE                                                     22590002
226000             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            22600002
226100             MOVE -1               TO ASTRTITL                    22610002
226200             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  22620002
226300             MOVE DP015-REVERSE    TO ASTRTITH                    22630002
226400             MOVE DP015-RED        TO ASTRTITC                    22640002
226500             MOVE DP015-UNP-NUM-BRT-MDT                           22650002
226600                                   TO ASTRTITA                    22660002
226700             SET DP020-MSG-FATAL   TO TRUE                        22670002
226800             SET PS-ERROR          TO TRUE                        22680002
226900         END-IF                                                   22690002
227000     END-IF.                                                      22700002
227100 EJECT                                                            22710002
227200*----------------------------------------------------------------*22720002
227300*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *22730002
227400*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *22740002
227500*----------------------------------------------------------------*22750002
227600 2140-DESELECT-ALL-ITEMS.                                         22760002
227700     MOVE +1                       TO ASC-BLK-SUB.                22770002
227800                                                                  22780002
227900     PERFORM 2141-CLEAR-SELECTED-INDS                             22790002
228000         VARYING ASC-ITEM-SUB                                     22800002
228100         FROM 1 BY 1                                              22810002
228200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 22820002
228300                                                                  22830002
228400     ADD +1                        TO ASC-BLK-SUB.                22840002
228500                                                                  22850002
228600     PERFORM 2141-CLEAR-SELECTED-INDS                             22860002
228700         VARYING ASC-ITEM-SUB                                     22870002
228800         FROM 1 BY 1                                              22880002
228900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 22890002
229000                                                                  22900002
229100     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               22910002
229200                                   TO PV-LIST-ITEM-NUMBER.        22920002
229300                                                                  22930002
229400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            22940002
229500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    22950002
229600                                                                  22960002
229700     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     22970002
229800        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      22980002
229900         MOVE +1                   TO ASC-BLK-SUB                 22990002
230000                                                                  23000002
230100         PERFORM 5100-WRITE-TEMP-STORAGE                          23010002
230200                                                                  23020002
230300         MOVE +1                   TO PV-BLOCK-NUMBER             23030002
230400                                                                  23040002
230500         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         23050002
230600             PV-FIRST-BLOCK-IN-ARRAY - 1                          23060002
230700                                                                  23070002
230800         PERFORM                                                  23080002
230900             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       23090002
231000                                                                  23100002
231100             PERFORM 4410-READ-TEMP-STORAGE                       23110002
231200                                                                  23120002
231300             PERFORM 2141-CLEAR-SELECTED-INDS                     23130002
231400                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 23140002
231500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          23150002
231600                                                                  23160002
231700             PERFORM 5100-WRITE-TEMP-STORAGE                      23170002
231800                                                                  23180002
231900             ADD +1                TO PV-BLOCK-NUMBER             23190002
232000                                                                  23200002
232100         END-PERFORM                                              23210002
232200                                                                  23220002
232300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         23230002
232400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     23240002
232500                                                                  23250002
232600         PERFORM                                                  23260002
232700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       23270002
232800                   ASC-HIGHEST-BLOCK-WRITTEN                      23280002
232900                                                                  23290002
233000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          23300002
233100                                   TO PV-BLOCK-NUMBER             23310002
233200                                                                  23320002
233300             PERFORM 4410-READ-TEMP-STORAGE                       23330002
233400                                                                  23340002
233500             PERFORM 2141-CLEAR-SELECTED-INDS                     23350002
233600                 VARYING ASC-ITEM-SUB                             23360002
233700                 FROM 1 BY 1                                      23370002
233800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          23380002
233900                                                                  23390002
234000             PERFORM 5100-WRITE-TEMP-STORAGE                      23400002
234100                                                                  23410002
234200             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      23420002
234300                                                                  23430002
234400         END-PERFORM                                              23440002
234500                                                                  23450002
234600         MOVE PV-FIRST-BLOCK-IN-ARRAY                             23460002
234700                                   TO PV-BLOCK-NUMBER             23470002
234800                                                                  23480002
234900         PERFORM 4410-READ-TEMP-STORAGE                           23490002
235000     END-IF.                                                      23500002
235100                                                                  23510002
235200                                                                  23520002
235300     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 23530002
235400     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.23540002
235500     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  23550002
235600                                                                  23560002
235700     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        23570002
235800                                                                  23580002
235900 EJECT                                                            23590002
236000*----------------------------------------------------------------*23600002
236100*    MARK EACH ITEM AS BEING NOT SELECTED.                       *23610002
236200*----------------------------------------------------------------*23620002
236300                                                                  23630002
236400 2141-CLEAR-SELECTED-INDS.                                        23640002
236500                                                                  23650002
236600     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           23660002
236700             NOT EQUAL ZERO                                       23670002
236800         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          23680002
236900             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          23690002
237000                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    23700002
237100                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  23710002
237200                                   TO TRUE                        23720002
237300         END-IF                                                   23730002
237400     END-IF.                                                      23740002
237500                                                                  23750002
237600/                                                                 23760002
237700*----------------------------------------------------------------*23770002
237800*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *23780002
237900*  FOR ALL ITEMS.                                                *23790002
238000*----------------------------------------------------------------*23800002
238100                                                                  23810002
238200 2150-SELECT-ALL-ITEMS.                                           23820002
238300                                                                  23830002
238400     MOVE +1                       TO ASC-BLK-SUB.                23840002
238500                                                                  23850002
238600     PERFORM 2151-SET-SELECTED-INDS                               23860002
238700         VARYING ASC-ITEM-SUB                                     23870002
238800         FROM 1 BY 1                                              23880002
238900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 23890002
239000                                                                  23900002
239100     ADD +1                        TO ASC-BLK-SUB.                23910002
239200                                                                  23920002
239300     PERFORM 2151-SET-SELECTED-INDS                               23930002
239400         VARYING ASC-ITEM-SUB                                     23940002
239500         FROM 1 BY 1                                              23950002
239600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 23960002
239700                                                                  23970002
239800     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               23980002
239900                                   TO PV-LIST-ITEM-NUMBER.        23990002
240000                                                                  24000002
240100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            24010002
240200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    24020002
240300                                                                  24030002
240400     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     24040002
240500        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    24050002
240600         MOVE +1                   TO ASC-BLK-SUB                 24060002
240700                                                                  24070002
240800         PERFORM 5100-WRITE-TEMP-STORAGE                          24080002
240900                                                                  24090002
241000         MOVE +1                   TO PV-BLOCK-NUMBER             24100002
241100                                                                  24110002
241200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         24120002
241300             PV-FIRST-BLOCK-IN-ARRAY - 1                          24130002
241400                                                                  24140002
241500         PERFORM                                                  24150002
241600             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       24160002
241700                                                                  24170002
241800             PERFORM 4410-READ-TEMP-STORAGE                       24180002
241900                                                                  24190002
242000             PERFORM 2151-SET-SELECTED-INDS                       24200002
242100                 VARYING ASC-ITEM-SUB                             24210002
242200                 FROM 1 BY 1                                      24220002
242300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          24230002
242400                                                                  24240002
242500             PERFORM 5100-WRITE-TEMP-STORAGE                      24250002
242600                                                                  24260002
242700             ADD +1                TO PV-BLOCK-NUMBER             24270002
242800                                                                  24280002
242900         END-PERFORM                                              24290002
243000                                                                  24300002
243100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         24310002
243200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     24320002
243300                                                                  24330002
243400         PERFORM                                                  24340002
243500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       24350002
243600                   ASC-HIGHEST-BLOCK-WRITTEN                      24360002
243700                                                                  24370002
243800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          24380002
243900                                   TO PV-BLOCK-NUMBER             24390002
244000                                                                  24400002
244100             PERFORM 4410-READ-TEMP-STORAGE                       24410002
244200                                                                  24420002
244300             PERFORM 2151-SET-SELECTED-INDS                       24430002
244400                 VARYING ASC-ITEM-SUB                             24440002
244500                 FROM 1 BY 1                                      24450002
244600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          24460002
244700                                                                  24470002
244800             PERFORM 5100-WRITE-TEMP-STORAGE                      24480002
244900                                                                  24490002
245000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      24500002
245100                                                                  24510002
245200         END-PERFORM                                              24520002
245300                                                                  24530002
245400         MOVE PV-FIRST-BLOCK-IN-ARRAY                             24540002
245500                                   TO PV-BLOCK-NUMBER             24550002
245600                                                                  24560002
245700         PERFORM 4410-READ-TEMP-STORAGE                           24570002
245800     END-IF.                                                      24580002
245900                                                                  24590002
246000                                                                  24600002
246100     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             24610002
246200                       ASC-NUMBER-OF-SELECTED-ITEMS.              24620002
246300                                                                  24630002
246400     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        24640002
246500                                                                  24650002
246600 EJECT                                                            24660002
246700*----------------------------------------------------------------*24670002
246800*    MARK EACH ITEM AS BEING SELECTED.                           *24680002
246900*----------------------------------------------------------------*24690002
247000                                                                  24700002
247100 2151-SET-SELECTED-INDS.                                          24710002
247200                                                                  24720002
247300     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           24730002
247400             NOT EQUAL ZERO                                       24740002
247500         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             24750002
247600             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             24760002
247700                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        24770002
247800                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  24780002
247900                               TO  TRUE                           24790002
248000         END-IF                                                   24800002
248100     END-IF.                                                      24810002
248200******************************************************************24820002
248300** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **24830002
248400** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **24840002
248500******************************************************************24850002
248600 2200-MOVE-SCREEN-TO-COMMAREA.                                    24860002
248700                                                                  24870002
248800     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             24880002
248900     MOVE +1                       TO PV-SUB.                     24890002
249000*                                                                 24900002
249100     PERFORM 3100-SET-SUBSCRIPTS.                                 24910002
249200     IF  ASTRTITL > ZERO                                          24920002
249300         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          24930002
249400     ELSE                                                         24940002
249500         IF  ASTRTITF = DP015-ERASE-EOF                           24950002
249600             INITIALIZE ASC-START-ITEM-REQUEST                    24960002
249700         END-IF                                                   24970002
249800     END-IF.                                                      24980002
249900     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          24990002
250000         VARYING PV-SUB                                           25000002
250100         FROM 1 BY 1                                              25010002
250200         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      25020002
250300******************************************************************25030002
250400** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**25040002
250500******************************************************************25050002
250600 2210-MOVE-LINES-TO-COMMAREA.                                     25060002
250700     IF  MR-SELECTL (PV-SUB) > ZERO                               25070002
250800         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             25080002
250900         MOVE MR-SELECTI (PV-SUB)                                 25090002
251000                                   TO ASC-TEMP-SELECTED-SW        25100002
251100                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      25110002
251200     ELSE                                                         25120002
251300         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                25130002
251400                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     25140002
251500                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        25150002
251600                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      25160002
251700         END-IF                                                   25170002
251800     END-IF.                                                      25180002
251900     ADD +1                        TO ASC-ITEM-SUB.               25190002
252000     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        25200002
252100         ADD +1                    TO ASC-BLK-SUB                 25210002
252200         MOVE +1                   TO ASC-ITEM-SUB                25220002
252300     END-IF.                                                      25230002
252400******************************************************************25240002
252500** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **25250002
252600** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **25260002
252700******************************************************************25270002
252800 3000-EDIT-DATA-IN-COMMAREA.                                      25280002
252900     SET PS-NO-ERROR               TO TRUE.                       25290002
253000*    PERFORM 3200-RESET-ATTRIBUTES.                               25300004
253100     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     25310002
253200**                                                                25320002
253300* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              25330002
253400* EDITTING IS DONE FROM THE BOTTOM UP.                            25340002
253500**                                                                25350002
253600     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       25360002
253700         ASC-ITEMS-DISPLAYED - 1.                                 25370002
253800     PERFORM 3100-SET-SUBSCRIPTS.                                 25380002
253900     PERFORM 3300-EDIT-SELECTIONS                                 25390002
254000         VARYING PV-SUB                                           25400002
254100         FROM PV-SUB BY -1                                        25410002
254200         UNTIL PV-SUB < +1                                        25420002
254300*                                                                 25430002
254400     IF  PS-NO-ERROR                                              25440002
254500         PERFORM 3400-CHECK-RANGE-SEQUENCE                        25450002
254600     END-IF.                                                      25460002
254700*                                                                 25470002
254800     IF  ((PS-NO-ERROR)                                           25480002
254900       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   25490002
255000       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    25500002
255100             PERFORM 3500-MARK-RANGE-AS-SELECTED                  25510002
255200     END-IF.                                                      25520002
255300 EJECT                                                            25530002
255400*----------------------------------------------------------------*25540002
255500*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *25550002
255600*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*25560002
255700*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *25570002
255800*                                                                *25580002
255900*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *25590002
256000*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *25600002
256100*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *25610002
256200*    US IN THE 2ND BLOCK OF THE ARRAY.                           *25620002
256300*----------------------------------------------------------------*25630002
256400                                                                  25640002
256500 3100-SET-SUBSCRIPTS.                                             25650002
256600                                                                  25660002
256700     COMPUTE ASC-ITEM-SUB =                                       25670002
256800         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        25680002
256900                                                                  25690002
257000     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         25700002
257100         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            25710002
257200                                                                  25720002
257300         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               25730002
257400     ELSE                                                         25740002
257500         MOVE +1                     TO ASC-BLK-SUB               25750002
257600     END-IF.                                                      25760002
257700******************************************************************25770002
257800** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **25780002
257900******************************************************************25790002
258000                                                                  25800002
258100*3200-RESET-ATTRIBUTES.                                           25810004
258200*    MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   25820004
258300*    MOVE DP015-GREEN              TO ASTRTITC.                   25830004
258400*    MOVE DP015-UNDERLINE          TO ASTRTITH.                   25840004
258500*                                                                 25850002
258600*    PERFORM                                                      25860004
258700*        VARYING PV-SUB                                           25870004
258800*        FROM 1 BY 1                                              25880004
258900*        UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        25890004
259000*        MOVE DP015-UNP-ALP-NOR-OFF                               25900004
259100*                                  TO MR-SELECTA (PV-SUB)         25910004
259200*        MOVE DP015-ASK-NOR-OFF    TO MR-AREA-A (PV-SUB)          25920004
259300*                                     MR-AREA-DESC-A (PV-SUB)     25930004
259400*                                     MR-CARTONS-A (PV-SUB)       25940004
259500*                                     MR-UNITS-A (PV-SUB)         25950004
259600*                                     MR-SKU-COUNT-A (PV-SUB)     25960004
259700*                                     MR-AD-A (PV-SUB)            25970004
259800*        MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         25980004
259900*        MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         25990004
260000*    END-PERFORM.                                                 26000004
260100******************************************************************26010002
260200** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **26020002
260300** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **26030002
260400** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **26040002
260500** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **26050002
260600******************************************************************26060002
260700 3300-EDIT-SELECTIONS.                                            26070002
260800     EVALUATE TRUE                                                26080002
260900         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     26090002
261000             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         26100002
261100                 CONTINUE                                         26110002
261200         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         26120002
261300             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        26130002
261400                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   26140002
261500                 MOVE ASC-TEMP-SELECTED-SW                        26150002
261600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  26160002
261700                                TO ASC-SELECTED-SW                26170002
261800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  26180002
261900             END-IF                                               26190002
262000         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     26200002
262100                 = SPACE                                          26210002
262200             EVALUATE TRUE                                        26220002
262300                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       26230002
262400                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS26240002
262500                     MOVE SPACE TO ASC-SELECTED-SW                26250002
262600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  26260002
262700                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        26270002
262800                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    26280002
262900                     MOVE SPACE TO ASC-SELECTED-SW                26290002
263000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  26300002
263100                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          26310002
263200                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      26320002
263300                     MOVE SPACE TO ASC-SELECTED-SW                26330002
263400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  26340002
263500             END-EVALUATE                                         26350002
263600         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           26360002
263700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            26370002
263800                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    26380002
263900             END-IF                                               26390002
264000             PERFORM 3310-EDIT-RANGE                              26400002
264100         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             26410002
264200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            26420002
264300                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    26430002
264400             END-IF                                               26440002
264500             PERFORM 3310-EDIT-RANGE                              26450002
264600         WHEN OTHER                                               26460002
264700             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           26470002
264800             SET DP020-MSG-FATAL    TO TRUE                       26480002
264900*            MOVE -1                TO MR-SELECTL (PV-SUB)        26490004
265000             SET DP030-SET-CURSOR-TRAILER                         26500004
265100                                    TO TRUE                       26510002
265200             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        26520002
265300             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        26530002
265400             SET PS-ERROR TO TRUE                                 26540002
265500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            26550002
265600                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     26560002
265700                 MOVE SPACE         TO ASC-SELECTED-SW            26570002
265800                                        (ASC-BLK-SUB ASC-ITEM-SUB)26580002
265900             END-IF                                               26590002
266000     END-EVALUATE.                                                26600002
266100                                                                  26610002
266200     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 26620002
266300     SUBTRACT +1 FROM ASC-ITEM-SUB.                               26630002
266400     IF  ASC-ITEM-SUB < 1                                         26640002
266500         SUBTRACT +1 FROM ASC-BLK-SUB                             26650002
266600         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                26660002
266700     END-IF.                                                      26670002
266800                                                                  26680002
266900******************************************************************26690002
267000** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **26700002
267100** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **26710002
267200** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**26720002
267300** THE ENDING.                                                  **26730002
267400******************************************************************26740002
267500 3310-EDIT-RANGE.                                                 26750002
267600     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                26760002
267700         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   26770002
267800             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)26780002
267900                                   TO ASC-SELECTED-SW             26790002
268000                                        (ASC-BLK-SUB ASC-ITEM-SUB)26800002
268100             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 26810002
268200         ELSE                                                     26820002
268300             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     26830002
268400                 CONTINUE                                         26840002
268500             ELSE                                                 26850002
268600*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        26860002
268700                 MOVE PC-TSYMSG-00054                             26870002
268800                                   TO DP020-MSG-NUMBER            26880002
268900                 SET DP020-MSG-FATAL                              26890002
269000                                   TO TRUE                        26900002
269100*                MOVE -1           TO MR-SELECTL (PV-SUB)         26910004
269200                 SET DP030-SET-CURSOR-TRAILER                     26920004
269300                                   TO TRUE                        26930002
269400                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         26940002
269500                 MOVE DP015-UNDERLINE                             26950002
269600                                   TO MR-SELECTH (PV-SUB)         26960002
269700                 SET PS-ERROR      TO TRUE                        26970002
269800             END-IF                                               26980002
269900         END-IF                                                   26990002
270000     ELSE                                                         27000002
270100         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     27010002
270200             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 27020002
270300                                   TO ASC-SELECTED-SW             27030002
270400                                     (ASC-BLK-SUB ASC-ITEM-SUB)   27040002
270500             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   27050002
270600         ELSE                                                     27060002
270700             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       27070002
270800                 CONTINUE                                         27080002
270900             ELSE                                                 27090002
271000*                -- ONLY ONE END-OF-RANGE ALLOWED --              27100002
271100                 MOVE PC-TSYMSG-00055                             27110002
271200                                   TO DP020-MSG-NUMBER            27120002
271300                 SET DP020-MSG-FATAL                              27130002
271400                                   TO TRUE                        27140002
271500*                MOVE -1           TO MR-SELECTL (PV-SUB)         27150004
271600                 SET DP030-SET-CURSOR-TRAILER                     27160004
271700                                   TO TRUE                        27170002
271800                 SET PS-ERROR      TO TRUE                        27180002
271900             END-IF                                               27190002
272000         END-IF                                                   27200002
272100     END-IF.                                                      27210002
272200*                                                                 27220002
272300******************************************************************27230002
272400** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **27240002
272500** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **27250002
272600******************************************************************27260002
272700 3400-CHECK-RANGE-SEQUENCE.                                       27270002
272800     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       27280002
272900       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      27290002
273000       AND  ASC-START-OF-SELECTED-RANGE >                         27300002
273100                                         ASC-END-OF-SELECTED-RANGE27310002
273200*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                27320002
273300         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 27330002
273400         SET DP020-MSG-FATAL TO TRUE                              27340002
273500         SET PS-ERROR TO TRUE                                     27350002
273600         PERFORM 3410-POSITION-AT-ERROR                           27360002
273700     END-IF.                                                      27370002
273800******************************************************************27380002
273900** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **27390002
274000** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **27400002
274100** SHOULD BE POSITIONED ON A RANGE ERROR.                       **27410002
274200******************************************************************27420002
274300 3410-POSITION-AT-ERROR.                                          27430002
274400     SET DP030-SET-CURSOR-APPL-1                                  27440002
274500                                   TO TRUE.                       27450002
274600     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 27460002
274700                    - PV-TOP-ITEM + 1.                            27470002
274800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      27480002
274900         CONTINUE                                                 27490002
275000     ELSE                                                         27500002
275100         MOVE -1                   TO MR-SELECTL (PV-SUB)         27510004
275200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         27520002
275300         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         27530002
275400     END-IF.                                                      27540002
275500*                                                                 27550002
275600     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   27560002
275700                    - PV-TOP-ITEM + 1.                            27570002
275800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      27580002
275900         CONTINUE                                                 27590002
276000     ELSE                                                         27600002
276100         MOVE -1                   TO MR-SELECTL (PV-SUB)         27610002
276200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         27620002
276300         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         27630002
276400     END-IF.                                                      27640002
276500 EJECT                                                            27650002
276600*----------------------------------------------------------------*27660002
276700*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *27670002
276800*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *27680002
276900*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *27690002
277000*----------------------------------------------------------------*27700002
277100                                                                  27710002
277200 3500-MARK-RANGE-AS-SELECTED.                                     27720002
277300     MOVE +1                       TO  ASC-BLK-SUB.               27730002
277400     PERFORM 3510-MARK-SELECTED-INDS                              27740002
277500         VARYING ASC-ITEM-SUB                                     27750002
277600         FROM 1 BY 1                                              27760002
277700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 27770002
277800                                                                  27780002
277900     ADD +1                        TO ASC-BLK-SUB.                27790002
278000     PERFORM 3510-MARK-SELECTED-INDS                              27800002
278100         VARYING ASC-ITEM-SUB                                     27810002
278200         FROM 1 BY 1                                              27820002
278300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 27830002
278400                                                                  27840002
278500     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               27850002
278600                                   TO  PV-LIST-ITEM-NUMBER.       27860002
278700     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            27870002
278800         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         27880002
278900               PC-ITEMS-PER-PANEL).                               27890002
279000                                                                  27900002
279100     MOVE ASC-START-OF-SELECTED-RANGE                             27910002
279200                                   TO PV-START-OF-SELECTED-RANGE. 27920002
279300     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            27930002
279400         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  27940002
279500               PC-ITEMS-PER-PANEL).                               27950002
279600                                                                  27960002
279700     MOVE ASC-END-OF-SELECTED-RANGE                               27970002
279800                                   TO  PV-END-OF-SELECTED-RANGE.  27980002
279900     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             27990002
280000         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    28000002
280100               PC-ITEMS-PER-PANEL).                               28010002
280200     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             28020002
280300         PV-FIRST-BLOCK-IN-ARRAY + 1.                             28030002
280400                                                                  28040002
280500     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    28050002
280600        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        28060002
280700         MOVE +1                   TO ASC-BLK-SUB                 28070002
280800         PERFORM 5100-WRITE-TEMP-STORAGE                          28080002
280900         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         28090002
281000             PV-FIRST-BLOCK-IN-ARRAY - 1                          28100002
281100                                                                  28110002
281200         PERFORM                                                  28120002
281300             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      28130002
281400                   PV-PREV-BLOCK-IN-ARRAY                         28140002
281500             MOVE PV-FIRST-BLOCK-IN-RANGE                         28150002
281600                                   TO PV-BLOCK-NUMBER             28160002
281700             PERFORM 4410-READ-TEMP-STORAGE                       28170002
281800             PERFORM 3510-MARK-SELECTED-INDS                      28180002
281900                 VARYING ASC-ITEM-SUB                             28190002
282000                 FROM 1 BY 1                                      28200002
282100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          28210002
282200             PERFORM 5100-WRITE-TEMP-STORAGE                      28220002
282300             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     28230002
282400         END-PERFORM                                              28240002
282500                                                                  28250002
282600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         28260002
282700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     28270002
282800         PERFORM                                                  28280002
282900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       28290002
283000                   PV-LAST-BLOCK-IN-RANGE                         28300002
283100             MOVE PV-NEXT-BLOCK-IN-ARRAY                          28310002
283200                                   TO PV-BLOCK-NUMBER             28320002
283300             PERFORM 4410-READ-TEMP-STORAGE                       28330002
283400             PERFORM 3510-MARK-SELECTED-INDS                      28340002
283500                 VARYING ASC-ITEM-SUB                             28350002
283600                 FROM 1 BY 1                                      28360002
283700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          28370002
283800             PERFORM 5100-WRITE-TEMP-STORAGE                      28380002
283900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      28390002
284000         END-PERFORM                                              28400002
284100                                                                  28410002
284200         MOVE PV-FIRST-BLOCK-IN-ARRAY                             28420002
284300                                   TO PV-BLOCK-NUMBER             28430002
284400         PERFORM 4410-READ-TEMP-STORAGE                           28440002
284500     END-IF.                                                      28450002
284600                                                                  28460002
284700     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 28470002
284800                                      ASC-END-OF-SELECTED-RANGE.  28480002
284900                                                                  28490002
285000/                                                                 28500002
285100*----------------------------------------------------------------*28510002
285200* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *28520002
285300*----------------------------------------------------------------*28530002
285400                                                                  28540002
285500 3510-MARK-SELECTED-INDS.                                         28550002
285600                                                                  28560002
285700     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         28570002
285800                                ASC-ITEM-SUB) >                   28580002
285900         ASC-START-OF-SELECTED-RANGE)                             28590002
286000     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         28600002
286100                                ASC-ITEM-SUB) =                   28610002
286200         ASC-START-OF-SELECTED-RANGE)                             28620002
286300                                                                  28630002
286400         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     28640002
286500                                    ASC-ITEM-SUB) <               28650002
286600             ASC-END-OF-SELECTED-RANGE)                           28660002
286700         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     28670002
286800                                    ASC-ITEM-SUB) =               28680002
286900             ASC-END-OF-SELECTED-RANGE)                           28690002
287000                                                                  28700002
287100             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          28710002
287200                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   28720002
287300                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   28730002
287400                               TO TRUE                            28740002
287500                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              28750002
287600                               TO TRUE                            28760002
287700                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    28770002
287800             END-IF                                               28780002
287900         END-IF                                                   28790002
288000     END-IF.                                                      28800002
288100                                                                  28810002
288200 EJECT                                                            28820002
288300*----------------------------------------------------------------*28830002
288400*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *28840002
288500*    INITIALIZE ALL COUNTERS AND FLAGS.                          *28850002
288600*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *28860002
288700*    DISPLAY THE PANEL TO USER.                                  *28870002
288800*----------------------------------------------------------------*28880002
288900                                                                  28890002
289000 4000-BUILD-INITIAL-PANEL.                                        28900002
289100                                                                  28910002
289200     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            28920002
289300                                 ASC-BLOCK-ENTRIES (2).           28930002
289400     MOVE +1                 TO ASC-BLK-SUB.                      28940002
289500     SET ASC-ITEMS-LEFT-ON-DB                                     28950002
289600                             TO TRUE.                             28960002
289700                                                                  28970002
289800     MOVE ZERO               TO ASC-ITEM-SUB                      28980002
289900                                ASC-NUMBER-OF-ITEMS-READ          28990002
290000                                ASC-NUMBER-OF-SELECTED-ITEMS      29000002
290100                                ASC-HIGHEST-BLOCK-WRITTEN         29010002
290200                                ASC-START-OF-SELECTED-RANGE       29020002
290300                                ASC-END-OF-SELECTED-RANGE         29030002
290400                                ASC-ITEM-AT-TOP-OF-PANEL.         29040002
290500                                                                  29050002
290600     PERFORM 4100-PREPARE-CURSOR                                  29060002
290700                                                                  29070002
290800     PERFORM 4010-OPEN-CURSOR.                                    29080002
290900                                                                  29090002
291000     PERFORM 4300-READ-ITEMS-FROM-DB.                             29100002
291100                                                                  29110002
291200     PERFORM 4020-CLOSE-CURSOR.                                   29120002
291300                                                                  29130002
291400     MOVE +1                   TO  PV-TOP-ITEM.                   29140002
291500     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          29150002
291600         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    29160002
291700         SET DP020-MSG-FATAL   TO  TRUE                           29170002
291800         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               29180002
291900     ELSE                                                         29190002
292000*        MOVE -1               TO MR-SELECTL (1)                  29200004
292100         SET DP030-SET-CURSOR-TRAILER                             29210004
292200                               TO TRUE                            29220002
292300         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     29230002
292400     END-IF.                                                      29240002
292500/                                                                 29250002
292600 4010-OPEN-CURSOR.                                                29260002
292700                                                                  29270002
292800     EVALUATE TRUE                                                29280002
292900         WHEN ASC-DEPT-SEQ                                        29290002
293000             MOVE 'CURSOR:  DEPT CSR'                             29300002
293100                                   TO DP013-MESSAGE-TEXT (2)      29310002
293200             EXEC SQL                                             29320002
293300                 OPEN CLASS-CSR                                   29330002
293400             END-EXEC                                             29340002
293500                                                                  29350002
293600         WHEN ASC-UNIT-SEQ                                        29360002
293700             MOVE 'CURSOR:  UNIT CSR'                             29370002
293800                                   TO DP013-MESSAGE-TEXT (2)      29380002
293900             EXEC SQL                                             29390002
294000                 OPEN UNIT-CSR                                    29400002
294100             END-EXEC                                             29410002
294200                                                                  29420002
294300         WHEN OTHER                                               29430002
294400             MOVE 'CURSOR:  DEPT CSR'                             29440002
294500                                   TO DP013-MESSAGE-TEXT (2)      29450002
294600             EXEC SQL                                             29460002
294700                 OPEN CLASS-CSR                                   29470002
294800             END-EXEC                                             29480002
294900                                                                  29490002
295000                                                                  29500002
295100     END-EVALUATE                                                 29510002
295200                                                                  29520002
295300     EVALUATE TRUE                                                29530002
295400         WHEN SQLCODE = ZERO                                      29540002
295500             CONTINUE                                             29550002
295600         WHEN SQLCODE = -904                                      29560002
295700         WHEN SQLCODE = -911                                      29570002
295800         WHEN SQLCODE = -913                                      29580002
295900             PERFORM 9900-SOFT-ABORT                              29590002
296000         WHEN SQLWARN0 NOT = SPACES                               29600002
296100         WHEN SQLCODE < ZERO                                      29610002
296200         WHEN SQLCODE > ZERO                                      29620002
296300             MOVE '4010-OPEN-CURSOR'                              29630002
296400                                   TO DP013-PARAGRAPH             29640002
296500             MOVE 'OPEN TRAILER STATUS CURSOR - '                 29650002
296600                                   TO DP013-MESSAGE-TEXT (1)      29660002
296700             MOVE SQLCA        TO DP013-SQLCA                     29670002
296800             MOVE 'TSUOBTR '   TO DP013-DB2-TABLE-NAME (1)        29680002
296900             MOVE 'TSUOBTS '   TO DP013-DB2-TABLE-NAME (2)        29690002
297000             SET DP013-DB2-ABEND                                  29700002
297100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               29710002
297200             PERFORM DP013-0000-PROCESS-ABEND                     29720002
297300     END-EVALUATE.                                                29730002
297400/                                                                 29740002
297500 4020-CLOSE-CURSOR.                                               29750002
297600     EVALUATE TRUE                                                29760002
297700         WHEN ASC-DEPT-SEQ                                        29770002
297800             EXEC SQL                                             29780002
297900                 CLOSE CLASS-CSR                                  29790002
298000             END-EXEC                                             29800002
298100         WHEN ASC-UNIT-SEQ                                        29810002
298200             EXEC SQL                                             29820002
298300                 CLOSE UNIT-CSR                                   29830002
298400             END-EXEC                                             29840002
298500         WHEN OTHER                                               29850002
298600             EXEC SQL                                             29860002
298700                 CLOSE CLASS-CSR                                  29870002
298800             END-EXEC                                             29880002
298900     END-EVALUATE.                                                29890002
299000*                                                                 29900002
299100     EVALUATE TRUE                                                29910002
299200         WHEN SQLCODE = ZERO                                      29920002
299300             CONTINUE                                             29930002
299400         WHEN SQLCODE = -904                                      29940002
299500         WHEN SQLCODE = -911                                      29950002
299600         WHEN SQLCODE = -913                                      29960002
299700             PERFORM 9900-SOFT-ABORT                              29970002
299800         WHEN SQLWARN0 NOT = SPACES                               29980002
299900         WHEN SQLCODE < ZERO                                      29990002
300000         WHEN SQLCODE > ZERO                                      30000002
300100             MOVE '4020-CLOSE-CURSOR'                             30010002
300200                               TO DP013-PARAGRAPH                 30020002
300300             MOVE 'CLOSE CURSOR '                                 30030002
300400                               TO DP013-MESSAGE-TEXT (1)          30040002
300500             MOVE SQLCA        TO DP013-SQLCA                     30050002
300600             MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)        30060002
300700             SET DP013-DB2-ABEND                                  30070002
300800                 DP013-XCTL-DISPLAY-RESTART TO TRUE               30080002
300900             PERFORM DP013-0000-PROCESS-ABEND                     30090002
301000     END-EVALUATE.                                                30100002
301100/                                                                 30110002
301200*----------------------------------------------------------------*30120002
301300*    SET UP THE HOST VARIABLES.                                  *30130002
301400*----------------------------------------------------------------*30140002
301500                                                                  30150002
301600 4100-PREPARE-CURSOR.                                             30160002
301700                                                                  30170002
301800     MOVE ASC-TRIP-OCRNC-ID  TO DK-TRIP-OCRNC-ID                  30180002
301900     MOVE ASC-DEPT-NBR       TO DK-DEPT-NBR                       30190002
302000                                                                  30200002
302100     EVALUATE TRUE                                                30210002
302200         WHEN SU012-DEPT-SEQ                                      30220002
302300             SET ASC-DEPT-SEQ         TO TRUE                     30230002
302400         WHEN SU012-UNIT-SEQ                                      30240002
302500             SET ASC-UNIT-SEQ         TO TRUE                     30250002
302600         WHEN OTHER                                               30260002
302700             SET ASC-DEPT-SEQ         TO TRUE                     30270002
302800     END-EVALUATE.                                                30280002
302900                                                                  30290002
303000/                                                                 30300002
303100*----------------------------------------------------------------*30310002
303200*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *30320002
303300*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *30330002
303400*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *30340002
303500*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *30350002
303600*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *30360002
303700*                                                                *30370002
303800*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *30380002
303900*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *30390002
304000*    UPON INITIALIZATION.                                        *30400002
304100*----------------------------------------------------------------*30410002
304200                                                                  30420002
304300 4300-READ-ITEMS-FROM-DB.                                         30430002
304400                                                                  30440002
304500     PERFORM                                                      30450002
304600         VARYING PV-READ-COUNT                                    30460002
304700         FROM 1 BY 1                                              30470002
304800         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    30480002
304900            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         30490002
305000                                                                  30500002
305100         PERFORM 4310-FETCH                                       30510002
305200                                                                  30520002
305300         IF  ASC-ITEMS-LEFT-ON-DB                                 30530002
305400             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                30540002
305500                 ADD +1            TO ASC-ITEM-SUB                30550002
305600             ELSE                                                 30560002
305700                 ADD +1            TO ASC-BLK-SUB                 30570002
305800                 MOVE +1           TO ASC-ITEM-SUB                30580002
305900                                                                  30590002
306000                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         30600002
306100                     MOVE +1       TO ASC-BLK-SUB                 30610002
306200                     SET ASC-BLOCK-MODIFIED (1)                   30620002
306300                                   TO TRUE                        30630002
306400                     PERFORM 5100-WRITE-TEMP-STORAGE              30640002
306500                     MOVE ASC-BLOCK-ENTRIES                       30650002
306600                               (PC-MAX-BLOCKS-IN-ARRAY)           30660002
306700                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 30670002
306800                     ADD +1        TO ASC-BLK-SUB                 30680002
306900                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   30690002
307000                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      30700002
307100                                   TO TRUE                        30710002
307200                 END-IF                                           30720002
307300             END-IF                                               30730002
307400             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    30740002
307500             PERFORM 4300A-MOVE-TO-COMMAREA                       30750002
307600         END-IF                                                   30760002
307700     END-PERFORM.                                                 30770002
307800                                                                  30780002
307900     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          30790002
308000         MOVE +1               TO ASC-BLK-SUB                     30800002
308100         PERFORM 5100-WRITE-TEMP-STORAGE                          30810002
308200         ADD +1                TO ASC-BLK-SUB                     30820002
308300         PERFORM 5100-WRITE-TEMP-STORAGE                          30830002
308400                                                                  30840002
308500         MOVE 1                TO ASC-BLK-SUB                     30850002
308600                                  PV-BLOCK-NUMBER                 30860002
308700         PERFORM 4410-READ-TEMP-STORAGE                           30870002
308800         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             30880002
308900             MOVE 2            TO ASC-BLK-SUB                     30890002
309000                                  PV-BLOCK-NUMBER                 30900002
309100             PERFORM 4410-READ-TEMP-STORAGE                       30910002
309200         END-IF                                                   30920002
309300     END-IF.                                                      30930002
309400/                                                                 30940002
309500 4300A-MOVE-TO-COMMAREA.                                          30950002
309600                                                                  30960002
309700     MOVE ASC-NUMBER-OF-ITEMS-READ    TO ASC-LIST-ITEM-NUMBER     30970002
309800                                        (ASC-BLK-SUB ASC-ITEM-SUB)30980002
309900                                                                  30990002
310000     MOVE SUT00010-MAJ-CL-NBR         TO ASC-CLASS                31000002
310100                                        (ASC-BLK-SUB ASC-ITEM-SUB)31010002
310200                                         PV-DPKUT038-MJR-CL-N     31020002
310300                                                                  31030002
310400     PERFORM 4300D-MAJ-CLASS-NAME.                                31040002
310500                                                                  31050002
310600     MOVE SUT00010-UNT-QTY            TO ASC-UNT-QTY              31060002
310700                                        (ASC-BLK-SUB ASC-ITEM-SUB)31070002
310800     MOVE SUT00010-SKU-QTY            TO ASC-SKU-COUNT            31080002
310900                                        (ASC-BLK-SUB ASC-ITEM-SUB)31090002
311000     MOVE SUT00010-CART-QTY           TO ASC-CART-QTY             31100002
311100                                        (ASC-BLK-SUB ASC-ITEM-SUB)31110002
311200                                                                  31120002
311300     PERFORM 4300C-AD-DATES.                                      31130002
311400     IF PV-DB2-COUNT > ZERO                                       31140002
311500         MOVE 'Y'           TO ASC-AD (ASC-BLK-SUB ASC-ITEM-SUB)  31150002
311600     END-IF.                                                      31160002
311700                                                                  31170002
311800 4300C-AD-DATES.                                                  31180002
311900                                                                  31190002
311920     MOVE SUT00010-MAJ-CL-NBR         TO DK-MAJ-CL-NBR.           31192003
312000                                                                  31200002
312100     EXEC SQL                                                     31210002
312200         SELECT COUNT (*)                                         31220002
312300         INTO                                                     31230002
312400           :PV-DB2-COUNT                                          31240002
312500         FROM                                                     31250002
312600           SUT_MAJ_CL_AD_DTE A                                    31260002
312700         WHERE                                                    31270002
312800           A.TRIP_OCRNC_ID       = :DK-TRIP-OCRNC-ID              31280002
312900         AND                                                      31290002
312901           A.MAJ_CL_NBR          = :DK-MAJ-CL-NBR                 31290103
312910         AND                                                      31291003
313000           (DATE(A.AD_EVNT_DTE) >= (CURRENT DATE - 5 DAYS))       31300002
313100           AND                                                    31310002
313200           (DATE(A.AD_EVNT_DTE) <= (CURRENT DATE + 5 DAYS))       31320002
313300     END-EXEC.                                                    31330002
313400                                                                  31340002
313500     EVALUATE TRUE                                                31350002
313600         WHEN SQLCODE = ZERO                                      31360002
313700         WHEN SQLCODE = +100                                      31370002
313800              CONTINUE                                            31380002
313900         WHEN SQLCODE = -904                                      31390002
314000         WHEN SQLCODE = -911                                      31400002
314100         WHEN SQLCODE = -913                                      31410002
314200             PERFORM 9900-SOFT-ABORT                              31420002
314300         WHEN SQLWARN0 NOT = SPACE                                31430002
314400         WHEN SQLCODE NOT = ZERO                                  31440002
314500              MOVE '4300C-AD-DATES'                               31450002
314600                               TO DP013-PARAGRAPH                 31460002
314700              MOVE 'SELECT '                                      31470002
314800                               TO DP013-MESSAGE-TEXT (1)          31480002
314900              MOVE SQLCA       TO DP013-SQLCA                     31490002
315000              SET DP013-DB2-ABEND                                 31500002
315100                               TO TRUE                            31510002
315200              PERFORM DP013-0000-PROCESS-ABEND                    31520002
315300     END-EVALUATE.                                                31530002
315400                                                                  31540002
315500 4300D-MAJ-CLASS-NAME.                                            31550002
315600                                                                  31560002
315700     EXEC SQL                                                     31570002
315800         SELECT  CURRENT DATE                                     31580002
315900                ,CURRENT TIME                                     31590002
316000           INTO  :PV-CURRENT-DATE                                 31600002
316100                ,:PV-CURRENT-TIME                                 31610002
316200           FROM  SYSIBM.SYSDUMMY1                                 31620002
316300     END-EXEC.                                                    31630002
316400                                                                  31640002
316500                                                                  31650002
316600     SET DP003-MCL-LOOKUP              TO TRUE.                   31660002
316700     SET DP003-DPT-LOOKUP              TO TRUE.                   31670002
316800     MOVE 'MP'                         TO DP003-SYSTEM-CODE.      31680002
316900     MOVE '03'                         TO DP003-OP-CO-NMBR.       31690002
317000     MOVE PV-CURRENT-YY                TO PV-DPKUT038-YY.         31700002
317100     MOVE PV-CURRENT-MM                TO PV-DPKUT038-MM.         31710002
317200     MOVE PV-CURRENT-DD                TO PV-DPKUT038-DD          31720002
317300     MOVE PV-DPKUT038-DATE             TO DP003-CURRENT-DATE      31730002
317400                                          DP003-EFF-DATE.         31740002
317500                                                                  31750002
317600     MOVE PV-DEPT-NUMBER               TO DP003-DPT-INPUT.        31760002
317700     MOVE PV-DPKUT038-MJR-CL           TO DP003-MCL-INPUT.        31770002
317800     MOVE ZERO                         TO DP003-MCL-INPUT (2:1).  31780002
317900                                                                  31790002
318000     EXEC CICS                                                    31800002
318100         LINK PROGRAM  (PV-DPKUT038)                              31810002
318200              COMMAREA (DP003-MBS-SUBROUTINE-FIELDS)              31820002
318300              LENGTH   (PV-DPKUT038-CA-LENGTH)                    31830002
318400              RESP     (PV-DPKUT038-CICS-RESP)                    31840002
318500     END-EXEC.                                                    31850002
318600                                                                  31860002
318700     EVALUATE TRUE                                                31870002
318800         WHEN PV-DPKUT038-CICS-RESP = DFHRESP (NORMAL)            31880002
318900           IF DP003-MCL-DESCRIPTION = SPACES OR LOW-VALUES        31890002
319000              MOVE 'UNKNOWN'       TO ASC-CLASS-DESC              31900002
319100                                        (ASC-BLK-SUB ASC-ITEM-SUB)31910002
319200           ELSE                                                   31920002
319300              MOVE DP003-MCL-DESCRIPTION TO ASC-CLASS-DESC        31930002
319400                                        (ASC-BLK-SUB ASC-ITEM-SUB)31940002
319500           END-IF                                                 31950002
319600         WHEN OTHER                                               31960002
319700              MOVE 'UNKNOWN'       TO ASC-CLASS-DESC              31970002
319800                                        (ASC-BLK-SUB ASC-ITEM-SUB)31980002
319900     END-EVALUATE.                                                31990002
320000                                                                  32000002
320100*----------------------------------------------------------------*32010002
320200*    FETCH THE MESSAGE CURSOR.                                   *32020002
320300*----------------------------------------------------------------*32030002
320400                                                                  32040002
320500 4310-FETCH.                                                      32050002
320600                                                                  32060002
320700     EVALUATE TRUE                                                32070002
320800         WHEN ASC-DEPT-SEQ                                        32080002
320900              EXEC SQL                                            32090002
321000              FETCH CLASS-CSR                                     32100002
321100              INTO                                                32110002
321200                 :SUT00010-MAJ-CL-NBR                             32120002
321300               , :SUT00010-UNT-QTY                                32130002
321400               , :SUT00010-SKU-QTY                                32140002
321500               , :SUT00010-CART-QTY                               32150002
321600              END-EXEC                                            32160002
321700         WHEN ASC-UNIT-SEQ                                        32170002
321800              EXEC SQL                                            32180002
321900              FETCH UNIT-CSR                                      32190002
322000              INTO                                                32200002
322100                 :SUT00010-MAJ-CL-NBR                             32210002
322200               , :SUT00010-UNT-QTY                                32220002
322300               , :SUT00010-SKU-QTY                                32230002
322400               , :SUT00010-CART-QTY                               32240002
322500              END-EXEC                                            32250002
322600         WHEN OTHER                                               32260002
322700              EXEC SQL                                            32270002
322800              FETCH CLASS-CSR                                     32280002
322900              INTO                                                32290002
323000                 :SUT00010-MAJ-CL-NBR                             32300002
323100               , :SUT00010-UNT-QTY                                32310002
323200               , :SUT00010-SKU-QTY                                32320002
323300               , :SUT00010-CART-QTY                               32330002
323400              END-EXEC                                            32340002
323500                                                                  32350002
323600     END-EVALUATE.                                                32360002
323700                                                                  32370002
323800     EVALUATE TRUE                                                32380002
323900         WHEN SQLCODE = ZERO                                      32390002
324000         WHEN SQLCODE = +100                                      32400002
324100              CONTINUE                                            32410002
324200         WHEN SQLCODE = -904                                      32420002
324300         WHEN SQLCODE = -911                                      32430002
324400         WHEN SQLCODE = -913                                      32440002
324500             PERFORM 9900-SOFT-ABORT                              32450002
324600         WHEN SQLWARN0 NOT = SPACE                                32460002
324700         WHEN SQLCODE NOT = ZERO                                  32470002
324800              MOVE '4310-FETCH-CURSOR'                            32480002
324900                               TO DP013-PARAGRAPH                 32490002
325000              MOVE 'FETCH MESSAGE CURSOR'                         32500002
325100                               TO DP013-MESSAGE-TEXT (1)          32510002
325200              MOVE SQLCA       TO DP013-SQLCA                     32520002
325300              SET DP013-DB2-ABEND                                 32530002
325400                               TO TRUE                            32540002
325500              PERFORM DP013-0000-PROCESS-ABEND                    32550002
325600     END-EVALUATE.                                                32560002
325700                                                                  32570002
325800     IF  SQLCODE EQUAL +100                                       32580002
325900         SET ASC-NO-ITEMS-LEFT-ON-DB                              32590002
326000                                   TO TRUE                        32600002
326100     END-IF.                                                      32610002
326200                                                                  32620002
326300 EJECT                                                            32630002
326400*----------------------------------------------------------------*32640002
326500* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *32650002
326600*----------------------------------------------------------------*32660002
326700                                                                  32670002
326800 4400-MOVE-COMMAREA-TO-SCREEN.                                    32680002
326900     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             32690002
327000         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          32700002
327100         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          32710002
327200             MOVE +1    TO ASC-BLK-SUB                            32720002
327300             PERFORM 5100-WRITE-TEMP-STORAGE                      32730002
327400             ADD +1     TO ASC-BLK-SUB                            32740002
327500             PERFORM 5100-WRITE-TEMP-STORAGE                      32750002
327600             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             32760002
327700                 GIVING PV-BLOCK-NUMBER                           32770002
327800                 REMAINDER PV-REMAINDER                           32780002
327900             IF  PV-REMAINDER > ZERO                              32790002
328000                 ADD +1 TO PV-BLOCK-NUMBER                        32800002
328100             END-IF                                               32810002
328200             MOVE +1    TO ASC-BLK-SUB                            32820002
328300             PERFORM 4410-READ-TEMP-STORAGE                       32830002
328400             ADD +1     TO ASC-BLK-SUB                            32840002
328500                           PV-BLOCK-NUMBER                        32850002
328600             PERFORM 4410-READ-TEMP-STORAGE                       32860002
328700     END-IF.                                                      32870002
328800     MOVE +1            TO ASC-BLK-SUB.                           32880002
328900     COMPUTE ASC-ITEM-SUB =                                       32890002
329000         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              32900002
329100         + PC-ITEMS-PER-PANEL).                                   32910002
329200*                                                                 32920002
329300     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        32930002
329400         ADD +1         TO ASC-BLK-SUB                            32940002
329500         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            32950002
329600     END-IF.                                                      32960002
329700*                                                                 32970002
329800     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           32980002
329900         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                32990002
330000*    PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        33000004
330100     PERFORM 4420-FORMAT-LIST-LINES                               33010002
330200         VARYING PV-SUB                                           33020002
330300         FROM PC-ITEMS-PER-PANEL BY -1                            33030002
330400         UNTIL PV-SUB < +1.                                       33040002
330500*                                                                 33050002
330600     COMPUTE ASC-ITEMS-DISPLAYED =                                33060002
330700         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          33070002
330800     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    33080002
330900                                      ASTRTITO.                   33090002
331000     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    33100002
331100     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    33110002
331200     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            33120002
331300                                   TO ASELITO.                    33130002
331400*                                                                 33140002
331500     IF  DP020-MSG-NUMBER-X = SPACE                               33150002
331600         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  33160002
331700*            --- MORE ITEMS TO DISPLAY ----                       33170002
331800             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            33180002
331900             SET DP020-MSG-INFORMATIONAL TO TRUE                  33190002
332000         END-IF                                                   33200002
332100     END-IF.                                                      33210002
332200                                                                  33220002
332300     MOVE ASC-STR-NBR                 TO ASTOREO                  33230002
332400     MOVE ASC-STR-NAME                TO ASTNMEO.                 33240002
332500*    MOVE ASC-DEPT-NAME               TO ADEPTDSO.                33250002
332600                                                                  33260002
332700     STRING PV-DEPT-NUMBER ' ' ASC-DEPT-NAME                      33270002
332800                     DELIMITED BY SIZE                            33280002
332900                     INTO ADEPTDSO                                33290002
333000                                                                  33300002
333100     MOVE ASC-SEQ-DESC                TO ASEQO.                   33310002
333200     MOVE ASC-SCAC                    TO ASCACO.                  33320002
333300     MOVE ASC-TRLR-SRL-NBR            TO ASERIALO                 33330002
333400     MOVE ASC-TRLR-ID                 TO ATRLRO.                  33340002
333500     MOVE ASC-TRIP-STAT-DESC          TO ASTATUSO.                33350002
333600     MOVE ASC-TOTAL-CARTONS           TO ACTNSO.                  33360002
333700     MOVE ASC-TOTAL-UNITS             TO AUNITSO.                 33370002
333800     MOVE ASC-SERVICE-DC-NAME         TO AOPERO                   33380002
333900     MOVE ASC-SUMMARY-DATE            TO ASUMDTEO.                33390002
334000     MOVE ASC-SUMMARY-TIME            TO ASUMTMEO.                33400002
334100                                                                  33410002
334200*----------------------------------------------------------------*33420002
334300*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *33430002
334400*----------------------------------------------------------------*33440002
334500                                                                  33450002
334600 4410-READ-TEMP-STORAGE.                                          33460002
334700                                                                  33470002
334800     EXEC CICS                                                    33480002
334900         READQ TS                                                 33490002
335000             QUEUE (ASC-LIST-QUEUE-NAME)                          33500002
335100             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               33510002
335200             ITEM  (PV-BLOCK-NUMBER)                              33520002
335300             RESP  (PV-CICS-RESP)                                 33530002
335400     END-EXEC.                                                    33540002
335500                                                                  33550002
335600     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       33560002
335700       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     33570002
335800         CONTINUE                                                 33580002
335900     ELSE                                                         33590002
336000         SET DP013-CICS-ABEND     TO TRUE                         33600002
336100         SET DP013-NO-ROLLBACK    TO TRUE                         33610002
336200         MOVE '4410-READ-TEMP-STORAGE'                            33620002
336300                                  TO DP013-PARAGRAPH              33630002
336400         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      33640002
336500                                  TO DP013-MESSAGE-TEXT(1)        33650002
336600         PERFORM DP013-0000-PROCESS-ABEND                         33660002
336700     END-IF.                                                      33670002
336800                                                                  33680002
336900     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             33690002
337000*                                                                 33700002
337100     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         33710002
337200         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               33720002
337300     END-IF.                                                      33730002
337400 EJECT                                                            33740002
337500*----------------------------------------------------------------*33750002
337600*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *33760002
337700*----------------------------------------------------------------*33770002
337800                                                                  33780002
337900 4420-FORMAT-LIST-LINES.                                          33790002
338000     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      33800002
338100         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                33810002
338200         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           33820002
338300                                    MR-AREA-A (PV-SUB)            33830002
338400                                    MR-AREA-DESC-A (PV-SUB)       33840002
338500                                    MR-CARTONS-A (PV-SUB)         33850002
338600                                    MR-UNITS-A (PV-SUB)           33860002
338700                                    MR-SKU-COUNT-A (PV-SUB)       33870002
338800                                    MR-AD-A (PV-SUB)              33880002
338900         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           33890002
339000         MOVE SPACE              TO MR-SELECTI (PV-SUB)           33900002
339100                                    MR-ACTION (PV-SUB)            33910002
339200     ELSE                                                         33920002
339300         PERFORM 4420A-FILL-SCREEN                                33930002
339400*                                                                 33940002
339500         IF  DP030-SET-CURSOR-TRAILER                             33950002
339600             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)33960002
339700                 > SPACE)                                         33970002
339800               OR (PV-SUB = 1))                                   33980002
339900                SET DP030-SET-CURSOR-TRAILER TO TRUE              33990004
340000*               MOVE -1          TO MR-SELECTL (PV-SUB)           34000004
340100             END-IF                                               34010002
340200         END-IF                                                   34020002
340300*                                                                 34030002
340400         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           34040002
340500             MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)           34050002
340600                                 TO MR-ACTION (PV-SUB)            34060002
340700         END-IF                                                   34070002
340800     END-IF.                                                      34080002
340900     SUBTRACT +1 FROM ASC-ITEM-SUB                                34090002
341000     IF  ASC-ITEM-SUB < + 1                                       34100002
341100         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  34110002
341200         MOVE +1                 TO ASC-BLK-SUB                   34120002
341300     END-IF.                                                      34130002
341400                                                                  34140002
341500 4420A-FILL-SCREEN.                                               34150002
341600     IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)          34160002
341700                                                   > SPACE        34170002
341800         MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     34180002
341900                                 TO MR-SELECTI (PV-SUB)           34190002
342000     ELSE                                                         34200002
342100         MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)          34210002
342200                                 TO MR-SELECTI (PV-SUB)           34220002
342300     END-IF                                                       34230002
342400                                                                  34240002
342500                                                                  34250002
342600     MOVE ASC-CLASS(ASC-BLK-SUB ASC-ITEM-SUB)                     34260002
342700                                      TO MR-AREA (PV-SUB)         34270002
342800     MOVE ASC-CLASS-DESC(ASC-BLK-SUB ASC-ITEM-SUB)                34280002
342900                                      TO MR-AREA-DESC (PV-SUB)    34290002
343000                                                                  34300002
343100     MOVE ASC-CART-QTY(ASC-BLK-SUB ASC-ITEM-SUB)                  34310002
343200                                      TO MR-CARTONS(PV-SUB).      34320002
343300     MOVE ASC-UNT-QTY(ASC-BLK-SUB ASC-ITEM-SUB)                   34330002
343400                                      TO MR-UNITS(PV-SUB).        34340002
343500     MOVE ASC-SKU-COUNT(ASC-BLK-SUB ASC-ITEM-SUB)                 34350002
343600                                      TO MR-SKU-COUNT(PV-SUB).    34360002
343700     MOVE ASC-AD(ASC-BLK-SUB ASC-ITEM-SUB)                        34370002
343800                                      TO MR-AD(PV-SUB).           34380002
343900                                                                  34390002
344000                                                                  34400002
344100                                                                  34410002
344200******************************************************************34420002
344300** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **34430002
344400** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **34440002
344500** ISSUE A WARNING.                                             **34450002
344600******************************************************************34460002
344700 4430-CHECK-FOR-BEGIN-AND-END.                                    34470002
344800     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       34480002
344900         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     34490002
345000*            -- NO END-OF-RANGE SPECFIED ---                      34500002
345100             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            34510002
345200             SET DP020-MSG-WARNING TO TRUE                        34520002
345300             PERFORM 4431-POSITION-AT-WARNING                     34530002
345400         END-IF                                                   34540002
345500     ELSE                                                         34550002
345600         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     34560002
345700*            -- NO BEGINNING-OF-RANGE SPECFIED ---                34570002
345800             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            34580002
345900             SET DP020-MSG-WARNING TO TRUE                        34590002
346000             PERFORM 4431-POSITION-AT-WARNING                     34600002
346100         END-IF                                                   34610002
346200     END-IF.                                                      34620002
346300******************************************************************34630002
346400** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **34640002
346500** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **34650002
346600** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **34660002
346700** POSITION THE CURSOR THERE.                                   **34670002
346800******************************************************************34680002
346900 4431-POSITION-AT-WARNING.                                        34690002
347000     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 34700002
347100                    - PV-TOP-ITEM + 1.                            34710002
347200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      34720002
347300         CONTINUE                                                 34730002
347400     ELSE                                                         34740002
347500         SET DP030-SET-CURSOR-APPL-1                              34750002
347600                                   TO TRUE                        34760002
347700         MOVE -1                   TO MR-SELECTL (PV-SUB)         34770004
347800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         34780004
347900         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         34790004
348000     END-IF.                                                      34800002
348100*                                                                 34810002
348200     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   34820002
348300                    - PV-TOP-ITEM + 1.                            34830002
348400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      34840002
348500         CONTINUE                                                 34850002
348600     ELSE                                                         34860002
348700         SET DP030-SET-CURSOR-APPL-1                              34870002
348800                                   TO TRUE                        34880002
348900         MOVE -1                   TO MR-SELECTL (PV-SUB)         34890002
349000         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         34900002
349100         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         34910002
349200     END-IF.                                                      34920002
349300 EJECT                                                            34930002
349400*----------------------------------------------------------------*34940002
349500* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *34950002
349600* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *34960002
349700* FOR THE SELECTED ITEMS QUEUE.                                  *34970002
349800*                                                                *34980002
349900* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *34990002
350000* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *35000002
350100* THE ARRAY IS FULL.                                             *35010002
350200*----------------------------------------------------------------*35020002
350300                                                                  35030002
350400 5000-PREPARE-SEL-QUEUE.                                          35040002
350500                                                                  35050002
350600     MOVE +1                   TO  ASC-BLK-SUB.                   35060002
350700     PERFORM 5100-WRITE-TEMP-STORAGE.                             35070002
350800     ADD +1                    TO  ASC-BLK-SUB.                   35080002
350900     PERFORM 5100-WRITE-TEMP-STORAGE.                             35090002
351000                                                                  35100002
351100     MOVE ASC-SEL-QUEUE-NAME   TO  SU012-SEL-QUEUE-NAME.          35110002
351200     PERFORM 6010-DELETE-SEL-QUEUE.                               35120002
351300                                                                  35130002
351400     SET ASC-UPDATE-TSQ        TO  TRUE.                          35140002
351500                                                                  35150002
351600     SET SU013-IDX             TO  1.                             35160002
351700     MOVE ZERO                 TO SU012-NUMBER-OF-TS-ITEMS.       35170002
351800     INITIALIZE SU013-SELECTED-ITEM-ARRAY.                        35180002
351900                                                                  35190002
352000     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           35200002
352100             VARYING PV-ITEM                                      35210002
352200             FROM 1 BY 1                                          35220002
352300             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     35230002
352400                                                                  35240002
352500     IF  SU013-IDX > 1                                            35250002
352600         PERFORM 5205-WRITE-SEL-QUEUE                             35260002
352700         ADD +1                TO SU012-NUMBER-OF-TS-ITEMS        35270002
352800     END-IF.                                                      35280002
352900 EJECT                                                            35290002
353000*----------------------------------------------------------------*35300002
353100*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *35310002
353200*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *35320002
353300*----------------------------------------------------------------*35330002
353400                                                                  35340002
353500 5100-WRITE-TEMP-STORAGE.                                         35350002
353600     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     35360002
353700                                   TO PV-LIST-ITEM-NUMBER.        35370002
353800     COMPUTE PV-BLOCK-NUMBER =                                    35380002
353900         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    35390002
354000                                                                  35400002
354100     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             35410002
354200     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             35420002
354300         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      35430002
354400             PERFORM 5105-REWRITE-ASC-LISTQ                       35440002
354500         END-IF                                                   35450002
354600     ELSE                                                         35460002
354700         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       35470002
354800         ASC-HIGHEST-BLOCK-WRITTEN + 1                            35480002
354900         PERFORM 5110-WRITE-ASC-LISTQ                             35490002
355000         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   35500002
355100     END-IF.                                                      35510002
355200                                                                  35520002
355300     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             35530002
355400******************************************************************35540002
355500** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **35550002
355600** SPECIFIC COMMAREA.                                           **35560002
355700******************************************************************35570002
355800 5105-REWRITE-ASC-LISTQ.                                          35580002
355900     EXEC CICS                                                    35590002
356000         WRITEQ TS                                                35600002
356100             QUEUE (ASC-LIST-QUEUE-NAME)                          35610002
356200             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               35620002
356300             ITEM  (PV-BLOCK-NUMBER)                              35630002
356400             REWRITE                                              35640002
356500             RESP  (PV-CICS-RESP)                                 35650002
356600     END-EXEC.                                                    35660002
356700                                                                  35670002
356800     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           35680002
356900         CONTINUE                                                 35690002
357000     ELSE                                                         35700002
357100         SET DP013-CICS-ABEND            TO TRUE                  35710002
357200         SET DP013-NO-ROLLBACK           TO TRUE                  35720002
357300         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       35730002
357400         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     35740002
357500                                         TO DP013-MESSAGE-TEXT(1) 35750002
357600         PERFORM DP013-0000-PROCESS-ABEND                         35760002
357700     END-IF.                                                      35770002
357800                                                                  35780002
357900******************************************************************35790002
358000** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **35800002
358100** SPECIFIC COMMAREA.                                           **35810002
358200******************************************************************35820002
358300 5110-WRITE-ASC-LISTQ.                                            35830002
358400     EXEC CICS                                                    35840002
358500         WRITEQ TS                                                35850002
358600             QUEUE (ASC-LIST-QUEUE-NAME)                          35860002
358700             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               35870002
358800             ITEM  (PV-BLOCK-NUMBER)                              35880002
358900             RESP  (PV-CICS-RESP)                                 35890002
359000     END-EXEC.                                                    35900002
359100     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      35910002
359200         SET DP013-CICS-ABEND      TO TRUE                        35920002
359300         SET DP013-NO-ROLLBACK     TO TRUE                        35930002
359400         MOVE '5110-WRITE-ASC-LISTQ'                              35940002
359500                                   TO DP013-PARAGRAPH             35950002
359600         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           35960002
359700                                   TO DP013-MESSAGE-TEXT(1)       35970002
359800         PERFORM DP013-0000-PROCESS-ABEND                         35980002
359900     END-IF.                                                      35990002
360000 EJECT                                                            36000002
360100*----------------------------------------------------------------*36010002
360200* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *36020002
360300* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *36030002
360400*----------------------------------------------------------------*36040002
360500                                                                  36050002
360600 5200-FILL-SEL-QUEUE-RECORD.                                      36060002
360700                                                                  36070002
360800     PERFORM 6112-READ-LIST-QUEUE.                                36080002
360900                                                                  36090002
361000     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       36100002
361100         PERFORM                                                  36110002
361200         VARYING LQW-IDX                                          36120002
361300         FROM 1 BY 1                                              36130002
361400         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            36140002
361500           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          36150002
361600                                                                  36160002
361700             IF  LQW-SELECT (LQW-IDX)                             36170002
361800                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              36180002
361900                                   TO SU013-ITEM (SU013-IDX)      36190002
362000                 MOVE SPACE        TO SU013-ACTION-SW (SU013-IDX) 36200002
362100*              LOAD SELECTIONS TO SEL-QUEUE                       36210002
362200                 MOVE LQW-AREA (LQW-IDX)                          36220002
362300                                      TO SU013-DEPT-NBR           36230002
362400                                         (SU013-IDX)              36240002
362500                                         PV-DEPT-NUMBER-N         36250002
362600                 MOVE LQW-AD(LQW-IDX)                             36260002
362700                                      TO SU013-AD-MDSE-IND        36270002
362800                                         (SU013-IDX)              36280002
362900                                                                  36290002
363000                 SET SU013-IDX UP BY 1                            36300002
363100                 IF  SU013-IDX > SU013-MAX-ITEMS                  36310002
363200                     PERFORM 5205-WRITE-SEL-QUEUE                 36320002
363300                     ADD +1        TO SU012-NUMBER-OF-TS-ITEMS    36330002
363400                     INITIALIZE SU013-SELECTED-ITEM-ARRAY         36340002
363500                     SET SU013-IDX TO  1                          36350002
363600                 END-IF                                           36360002
363700             END-IF                                               36370002
363800         END-PERFORM                                              36380002
363900     END-IF.                                                      36390002
364000                                                                  36400002
364100*----------------------------------------------------------------*36410002
364200*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *36420002
364300*----------------------------------------------------------------*36430002
364400                                                                  36440002
364500 5205-WRITE-SEL-QUEUE.                                            36450002
364600                                                                  36460002
364700     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            36470002
364800                                   TO SU013-SELECTED-ITEMS.       36480002
364900                                                                  36490002
365000     EXEC CICS                                                    36500002
365100          WRITEQ TS                                               36510002
365200              QUEUE (ASC-SEL-QUEUE-NAME)                          36520002
365300              FROM  (SU013-SELECT-RECORD)                         36530002
365400              ITEM  (PV-SEL-QUEUE-ITEM)                           36540002
365500              RESP  (PV-CICS-RESP)                                36550002
365600     END-EXEC.                                                    36560002
365700                                                                  36570002
365800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          36580002
365900         CONTINUE                                                 36590002
366000     ELSE                                                         36600002
366100         SET DP013-CICS-ABEND      TO TRUE                        36610002
366200         SET DP013-NO-ROLLBACK     TO TRUE                        36620002
366300         MOVE '5205-WRITE-SEL-QUEUE'                              36630002
366400                                   TO DP013-PARAGRAPH             36640002
366500         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          36650002
366600                                   TO DP013-MESSAGE-TEXT(1)       36660002
366700         PERFORM DP013-0000-PROCESS-ABEND                         36670002
366800     END-IF.                                                      36680002
366900 EJECT                                                            36690002
367000******************************************************************36700002
367100** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **36710002
367200** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **36720002
367300** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **36730002
367400** THE USER.                                                    **36740002
367500******************************************************************36750002
367600 6000-REFRESH-PANEL-FROM-TEMP.                                    36760002
367700     IF  ASC-UPDATE-TSQ                                           36770002
367800         SET ASC-NO-TSQ-UPDATE TO TRUE                            36780002
367900         MOVE ZERO                 TO PV-SAVE-ITEM                36790002
368000                                      PV-SEL-QUEUE-ITEM           36800002
368100         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        36810002
368200                                   TO PV-HOLD-SELECTED-ITEMS      36820002
368300         MOVE +1                   TO PV-ITEMS-PROCESSED          36830002
368400         PERFORM 6100-UPDATE-TSQ                                  36840002
368500             UNTIL PV-ITEMS-PROCESSED >                           36850002
368600                                     PV-HOLD-SELECTED-ITEMS       36860002
368700         PERFORM 6010-DELETE-SEL-QUEUE                            36870002
368800         INITIALIZE ASC-BLOCK-ENTRIES (1)                         36880002
368900                    ASC-BLOCK-ENTRIES (2)                         36890002
369000     END-IF.                                                      36900002
369100                                                                  36910002
369200*----------------------------------------------------------------*36920002
369300*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *36930002
369400*----------------------------------------------------------------*36940002
369500 6010-DELETE-SEL-QUEUE.                                           36950002
369600                                                                  36960002
369700     EXEC CICS                                                    36970002
369800         DELETEQ TS                                               36980002
369900             QUEUE (ASC-SEL-QUEUE-NAME)                           36990002
370000             RESP  (PV-CICS-RESP)                                 37000002
370100     END-EXEC.                                                    37010002
370200*                                                                 37020002
370300     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      37030002
370400        (PV-CICS-RESP = DFHRESP(QIDERR)))                         37040002
370500         CONTINUE                                                 37050002
370600     ELSE                                                         37060002
370700         SET DP013-CICS-ABEND TO TRUE                             37070002
370800         SET DP013-NO-ROLLBACK TO TRUE                            37080002
370900         MOVE '6010-DELETE-SEL-QUEUE'                             37090002
371000                        TO DP013-PARAGRAPH                        37100002
371100         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         37110002
371200                        TO DP013-MESSAGE-TEXT (1)                 37120002
371300         PERFORM DP013-0000-PROCESS-ABEND                         37130002
371400     END-IF.                                                      37140002
371500                                                                  37150002
371600*----------------------------------------------------------------*37160002
371700*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *37170002
371800*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *37180002
371900*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *37190002
372000*    THE TEMP QUEUE.                                             *37200002
372100*----------------------------------------------------------------*37210002
372200                                                                  37220002
372300 6100-UPDATE-TSQ.                                                 37230002
372400                                                                  37240002
372500     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             37250002
372600     PERFORM 6105-READ-SEL-QUEUE.                                 37260002
372700     PERFORM                                                      37270002
372800         VARYING SU013-IDX                                        37280002
372900         FROM 1 BY 1                                              37290002
373000         UNTIL ((PV-ITEMS-PROCESSED >                             37300002
373100                              PV-HOLD-SELECTED-ITEMS)             37310002
373200         OR (SU013-IDX GREATER THAN SU013-MAX-ITEMS))             37320002
373300         IF  SU013-ACTION-SW (SU013-IDX) > SPACE                  37330002
373400             PERFORM 6110-PROCESS-ITEMS                           37340002
373500         END-IF                                                   37350002
373600         ADD +1                TO PV-ITEMS-PROCESSED              37360002
373700     END-PERFORM.                                                 37370002
373800     PERFORM 6111-WRITE-LIST-QUEUE.                               37380002
373900*----------------------------------------------------------------*37390002
374000*    READ THE LIST QUEUE RECORD.                                 *37400002
374100*----------------------------------------------------------------*37410002
374200                                                                  37420002
374300 6105-READ-SEL-QUEUE.                                             37430002
374400                                                                  37440002
374500     EXEC CICS                                                    37450002
374600          READQ TS                                                37460002
374700              QUEUE (ASC-SEL-QUEUE-NAME)                          37470002
374800              INTO  (SU013-SELECT-RECORD)                         37480002
374900              ITEM  (PV-SEL-QUEUE-ITEM)                           37490002
375000              RESP  (PV-CICS-RESP)                                37500002
375100     END-EXEC.                                                    37510002
375200*                                                                 37520002
375300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          37530002
375400         CONTINUE                                                 37540002
375500     ELSE                                                         37550002
375600         SET DP013-CICS-ABEND      TO  TRUE                       37560002
375700         SET DP013-NO-ROLLBACK     TO  TRUE                       37570002
375800         MOVE '6105-READ-SEL-QUEUE'                               37580002
375900                                   TO  DP013-PARAGRAPH            37590002
376000         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           37600002
376100                                   TO  DP013-MESSAGE-TEXT(1)      37610002
376200         PERFORM DP013-0000-PROCESS-ABEND                         37620002
376300     END-IF.                                                      37630002
376400 EJECT                                                            37640002
376500*----------------------------------------------------------------*37650002
376600*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*37660002
376700*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*37670002
376800*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *37680002
376900*----------------------------------------------------------------*37690002
377000                                                                  37700002
377100 6110-PROCESS-ITEMS.                                              37710002
377200                                                                  37720002
377300     COMPUTE PV-ITEM = 1 + ((SU013-ITEM (SU013-IDX) - 1)          37730002
377400                     / PC-ITEMS-PER-PANEL).                       37740002
377500                                                                  37750002
377600     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           37760002
377700         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          37770002
377800             PERFORM 6111-WRITE-LIST-QUEUE                        37780002
377900         END-IF                                                   37790002
378000         MOVE PV-ITEM          TO PV-SAVE-ITEM                    37800002
378100                                                                  37810002
378200         PERFORM 6112-READ-LIST-QUEUE                             37820002
378300         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               37830002
378400             CONTINUE                                             37840002
378500         END-IF                                                   37850002
378600     END-IF.                                                      37860002
378700                                                                  37870002
378800     COMPUTE PV-SUB = (SU013-ITEM (SU013-IDX)                     37880002
378900                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              37890002
379000     SET LQW-DESELECT (PV-SUB) TO    TRUE                         37900002
379100     MOVE LQW-SELECTED-SW (PV-SUB)                                37910002
379200                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  37920002
379300     EVALUATE TRUE                                                37930002
379400         WHEN SU013-INQ (SU013-IDX)                               37940002
379500              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             37950002
379600                                                                  37960002
379700         WHEN SU013-UPD (SU013-IDX)                               37970002
379800              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             37980002
379900                                                                  37990002
380000         WHEN SU013-DEL (SU013-IDX)                               38000002
380100              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             38010002
380200                                                                  38020002
380300         WHEN SU013-ERR (SU013-IDX)                               38030002
380400              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             38040002
380500     END-EVALUATE.                                                38050002
380600                                                                  38060002
380700     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                38070002
380800                                                                  38080002
380900*----------------------------------------------------------------*38090002
381000*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *38100002
381100*----------------------------------------------------------------*38110002
381200                                                                  38120002
381300 6111-WRITE-LIST-QUEUE.                                           38130002
381400                                                                  38140002
381500     EXEC CICS                                                    38150002
381600         WRITEQ TS                                                38160002
381700             QUEUE (ASC-LIST-QUEUE-NAME)                          38170002
381800             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     38180002
381900             ITEM  (PV-SAVE-ITEM)                                 38190002
382000             REWRITE                                              38200002
382100             RESP  (PV-CICS-RESP)                                 38210002
382200     END-EXEC.                                                    38220002
382300*                                                                 38230002
382400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          38240002
382500         CONTINUE                                                 38250002
382600     ELSE                                                         38260002
382700         SET DP013-CICS-ABEND  TO  TRUE                           38270002
382800         SET DP013-NO-ROLLBACK TO  TRUE                           38280002
382900         MOVE '6111-WRITE-LIST-QUEUE'                             38290002
383000                               TO  DP013-PARAGRAPH                38300002
383100         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  38310002
383200                               TO  DP013-MESSAGE-TEXT(1)          38320002
383300         PERFORM DP013-0000-PROCESS-ABEND                         38330002
383400     END-IF.                                                      38340002
383500                                                                  38350002
383600 EJECT                                                            38360002
383700*----------------------------------------------------------------*38370002
383800*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*38380002
383900*----------------------------------------------------------------*38390002
384000                                                                  38400002
384100 6112-READ-LIST-QUEUE.                                            38410002
384200                                                                  38420002
384300     EXEC CICS                                                    38430002
384400         READQ TS                                                 38440002
384500             QUEUE (ASC-LIST-QUEUE-NAME)                          38450002
384600             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     38460002
384700             ITEM  (PV-ITEM)                                      38470002
384800             RESP  (PV-CICS-RESP)                                 38480002
384900     END-EXEC.                                                    38490002
385000*                                                                 38500002
385100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          38510002
385200         CONTINUE                                                 38520002
385300     ELSE                                                         38530002
385400         SET DP013-CICS-ABEND        TO TRUE                      38540002
385500         SET DP013-NO-ROLLBACK       TO TRUE                      38550002
385600         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           38560002
385700         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    38570002
385800                                     TO DP013-MESSAGE-TEXT(1)     38580002
385900         PERFORM DP013-0000-PROCESS-ABEND                         38590002
386000     END-IF.                                                      38600002
386100/                                                                 38610002
386200 7000-SELECT-SERVICING-DC.                                        38620002
386300                                                                  38630002
386400     EXEC SQL                                                     38640002
386500         SELECT  STR.LOC_NM                                       38650005
386600             ,   STR.LOC_NBR                                      38660005
386700         INTO                                                     38670002
386800                :XLT00010-LOC-NM                                  38680005
386900             ,  :XLT00010-LOC-NBR                                 38690005
387000         FROM  TSUOBTR OBTR                                       38700002
387100             , XLT_LOC STR                                        38710005
387200         WHERE OBTR.ORGN_OPER_UNT_ID  =   STR.LOC_NBR             38720005
387300         AND   OBTR.OTBND_TRIP_ID     =  :DK-OTBND-TRIP-ID        38730002
387400     END-EXEC.                                                    38740002
387500                                                                  38750002
387600     EVALUATE TRUE                                                38760002
387700         WHEN SQLCODE = ZERO                                      38770002
387800              MOVE XLT00010-LOC-NM    TO  ASC-SERVICE-DC-NAME     38780005
387900         WHEN SQLCODE = +100                                      38790002
388000              MOVE SPACES              TO XLT00010-LOC-NM         38800005
388100                                          ASC-SERVICE-DC-NAME     38810002
388200         WHEN SQLCODE = -904                                      38820002
388300         WHEN SQLCODE = -911                                      38830002
388400         WHEN SQLCODE = -913                                      38840002
388500             PERFORM 9900-SOFT-ABORT                              38850002
388600         WHEN SQLWARN0 NOT = SPACE                                38860002
388700         WHEN SQLCODE NOT = ZERO                                  38870002
388800              MOVE '7000-SELECT-SERVICING-DC'                     38880002
388900                               TO DP013-PARAGRAPH                 38890002
389000              MOVE 'SELECT'    TO DP013-MESSAGE-TEXT (1)          38900002
389100              MOVE SQLCA       TO DP013-SQLCA                     38910002
389200              SET DP013-DB2-ABEND                                 38920002
389300                               TO TRUE                            38930002
389400              PERFORM DP013-0000-PROCESS-ABEND                    38940002
389500     END-EVALUATE.                                                38950002
389600                                                                  38960002
389700 7001-CONVERT-DATES.                                              38970002
389800                                                                  38980002
389900     MOVE SU013-SUMMARY-TIME (ASC-SEL-SUB)                        38990002
390000                                   TO PV-TIME                     39000002
390100     MOVE SU013-SUMMARY-DATE (ASC-SEL-SUB)                        39010002
390200                                   TO PV-DATE                     39020002
390300                                                                  39030002
390400     EXEC SQL                                                     39040002
390500      SELECT                                                      39050002
390600         CHAR ( DATE (:PV-DATE),USA)                              39060002
390700     ,   CHAR ( TIME (:PV-TIME),JIS)                              39070002
390800      INTO                                                        39080002
390900         :ASC-SUMMARY-DATE                                        39090002
391000     ,   :ASC-SUMMARY-TIME                                        39100002
391100     FROM SYSIBM.SYSDUMMY1                                        39110002
391200     END-EXEC.                                                    39120002
391300                                                                  39130002
391400     EVALUATE TRUE                                                39140002
391500         WHEN SQLCODE = ZERO                                      39150002
391600             CONTINUE                                             39160002
391700         WHEN SQLCODE = -180                                      39170002
391800              MOVE SPACES      TO ASC-SUMMARY-DATE                39180002
391900                                  ASC-SUMMARY-TIME                39190002
392000         WHEN SQLCODE = -904                                      39200002
392100         WHEN SQLCODE = -911                                      39210002
392200         WHEN SQLCODE = -913                                      39220002
392300             PERFORM 9900-SOFT-ABORT                              39230002
392400         WHEN SQLWARN0 NOT = SPACE                                39240002
392500         WHEN SQLCODE NOT = ZERO                                  39250002
392600              MOVE '7001-CONVERT-DATES'                           39260002
392700                               TO DP013-PARAGRAPH                 39270002
392800              MOVE 'SELECT'    TO DP013-MESSAGE-TEXT (1)          39280002
392900              MOVE SQLCA       TO DP013-SQLCA                     39290002
393000              SET DP013-DB2-ABEND                                 39300002
393100                               TO TRUE                            39310002
393200              PERFORM DP013-0000-PROCESS-ABEND                    39320002
393300     END-EVALUATE.                                                39330002
393400/                                                                 39340002
393500 9100-READ-SEL-QUEUE.                                             39350002
393600     EXEC CICS                                                    39360002
393700         READQ TS                                                 39370002
393800             QUEUE (ASC-SEL-QUEUE-NAME)                           39380002
393900             INTO  (SU013-SELECT-RECORD)                          39390002
394000             ITEM  (ASC-SEL-ITEM)                                 39400002
394100             RESP  (PV-CICS-RESP)                                 39410002
394200     END-EXEC.                                                    39420002
394300                                                                  39430002
394400     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       39440002
394500         CONTINUE                                                 39450002
394600     ELSE                                                         39460002
394700         SET DP013-LOGIC-ABEND                                    39470002
394800             DP013-NO-ROLLBACK     TO TRUE                        39480002
394900         MOVE '9100-READ-SEL-QUEUE'                               39490002
395000                                   TO DP013-PARAGRAPH             39500002
395100         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   39510002
395200                                   TO DP013-MESSAGE-TEXT (1)      39520002
395300         PERFORM DP013-0000-PROCESS-ABEND                         39530002
395400     END-IF.                                                      39540002
395500/                                                                 39550002
395600*-----------------------------------------------------------      39560002
395700* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.        39570002
395800*-----------------------------------------------------------      39580002
395900 9200-REWRITE-LIST-QUEUE.                                         39590002
396000           EXEC CICS                                              39600002
396100                WRITEQ TS                                         39610002
396200                    QUEUE  (ASC-SEL-QUEUE-NAME)                   39620002
396300                    FROM   (SU013-SELECT-RECORD)                  39630002
396400                    ITEM   (ASC-SEL-ITEM)                         39640002
396500                    RESP   (PV-CICS-RESP)                         39650002
396600                    REWRITE                                       39660002
396700           END-EXEC.                                              39670002
396800                                                                  39680002
396900     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   39690002
397000         SET DP013-CICS-ABEND                                     39700002
397100             DP013-NO-ROLLBACK     TO TRUE                        39710002
397200         MOVE '9200-REWRITE-LIST-QUEUE'                           39720002
397300                                         TO DP013-PARAGRAPH       39730002
397400         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   39740002
397500                                         TO DP013-MESSAGE-TEXT (1)39750002
397600         PERFORM DP013-0000-PROCESS-ABEND                         39760002
397700     END-IF.                                                      39770002
397800                                                                  39780002
397900 9900-SOFT-ABORT.                                                 39790002
398000     SET PS-ERROR         TO TRUE.                                39800002
398100     SET DP020-MSG-FATAL  TO TRUE.                                39810002
398200     MOVE 'THROUGH SOFT-ABORT PARA'                               39820002
398300                            TO DP013-MESSAGE-TEXT (1)             39830002
398400     MOVE PC-TSYMSG-00551 TO DP020-MSG-NUMBER.                    39840002
398500     IF PS-NO-NEXT-SCREEN                                         39850002
398600         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    39860002
398700     END-IF.                                                      39870002
398800                                                                  39880002
398900     MOVE 'PROGRAM EXIT CALL' TO DP013-MESSAGE-TEXT (1).          39890002
399000     PERFORM 0001-CALL-CICS-ARCH-API.                             39900002
399100                                                                  39910002
399200 EJECT                                                            39920002
399300*----------------------------------------------------------------*39930002
399400*    ABEND PROCESSOR MODULE                                      *39940002
399500*----------------------------------------------------------------*39950002
399600                                                                  39960002
399700     COPY DPPD013.                                                39970005
