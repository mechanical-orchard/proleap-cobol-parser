000100 IDENTIFICATION DIVISION.                                         00010001
000200 TITLE 'MANIFESTING - CRIT SPEC FOR SCAN ON-OFF TRAILERS'.        00020007
000210                                                                  00021003
000300 PROGRAM-ID.             PCKRF878.                                00030001
000400 AUTHOR.                 DENNIS STEFFEN.                          00040001
000500 INSTALLATION.           KOHLS.                                   00050001
000600 DATE-WRITTEN.           MAY, 2001.                               00060001
000700 DATE-COMPILED.                                                   00070001
000800                                                                  00080001
001200 ENVIRONMENT DIVISION.                                            00120001
001300 DATA DIVISION.                                                   00130001
001400                                                                  00140001
001500 WORKING-STORAGE SECTION.                                         00150001
001600                                                                  00160001
001700 01  PC-PROGRAM-CONSTANTS.                                        00170001
001800     05  PC-TRANID                    PIC X(04) VALUE 'E878'.     00180001
001900     05  PC-CURRENT-PROGRAM-NAME      PIC X(08) VALUE 'PCKRF878'. 00190001
002000     05  PC-RAND-PGM                  PIC X(08) VALUE 'DPKUT902'. 00200001
002100     05  PC-DUMMY-TIMESTAMP           PIC X(26) VALUE             00210001
002200            '9999-09-09-09.09.09.999999'.                         00220001
002300     05  PC-LOW-TIMESTAMP             PIC X(26) VALUE             00230001
002400            '0001-01-01-00.00.00.000000'.                         00240001
002500                                                                  00250001
002600                                                                  00260001
002700* ERROR MESSAGES                                                 *00270001
002800     05  PC-UNRECOGNIZED-PF-KEY-MSG   PIC X(19) VALUE             00280001
002900                                           'UNRECOGNIZED PF KEY'. 00290001
003000     05  PC-ENTER-THROUGH-MENU-MSG    PIC X(19) VALUE             00300001
003100                                           'ENTER THROUGH MENU '. 00310001
003200     05  PC-TRANS-UNAVAILABLE-MSG     PIC X(19) VALUE             00320001
003300                                           'TRANS NOT AVAILABLE'. 00330001
003400     05  PC-WRONG-FACILITY            PIC X(19) VALUE             00340001
003500                                           'WRG FCLTY - F2 CONF'. 00350001
003600                                                                  00360001
003700 01  PS-PROGRAM-SWITCHES.                                         00370001
003800     05  PS-ERROR-SW                  PIC X(01)  VALUE 'N'.       00380001
003900         88  PS-ERRORS-YES                        VALUE 'Y'.      00390001
004000         88  PS-ERRORS-NO                         VALUE 'N'.      00400001
004100     05  PS-XCTL-SW                   PIC X(04)   VALUE SPACES.   00410001
004200         88  PS-XCTL-E871                       VALUE 'E871'.     00420001
004300         88  PS-XCTL-E873                       VALUE 'E873'.     00430001
004400         88  PS-XCTL-E877                       VALUE 'E877'.     00440001
004500     05  PS-VALID-INPUT-SW            PIC X(01) VALUE 'N'.        00450001
004600         88  PS-VALID-INPUT                       VALUE 'Y'.      00460001
004700         88  PS-INVALID-INPUT                     VALUE 'N'.      00470001
004800     05  PS-TRLR-OPEN-SW              PIC X(04) VALUE SPACES.     00480001
004900         88  PS-TRLR-OPEN-THIS-DOOR             VALUE 'THIS'.     00490001
005000         88  PS-TRLR-OPEN-DIFF-DOOR             VALUE 'DIFF'.     00500001
005100     05  PC-STORE-DOOR-CSR-SW         PIC X(01) VALUE 'N'.        00510001
005200         88  PS-END-STORE-DOOR-CSR              VALUE 'Y'.        00520001
005300         88  PS-NOT-END-STORE-DOOR-CSR          VALUE 'N'.        00530001
005400     05  PS-DOOR-DEST-EDIT-SW         PIC X(01) VALUE 'Y'.        00540001
005500         88  PS-SKIP-DOOR-DEST-EDITS            VALUE 'N'.        00550001
005600         88  PS-DO-DOOR-DEST-EDITS              VALUE 'Y'.        00560001
005700     05  PS-DIVERT-DOOR-SW            PIC X(01) VALUE 'Y'.        00570001
005800         88  PS-DIVERT-DOOR-YES                 VALUE 'Y'.        00580001
005900         88  PS-DIVERT-DOOR-NO                  VALUE 'N'.        00590001
006000     05  PS-SERIAL-SW                 PIC X(01) VALUE 'N'.        00600001
006100         88  PS-SERIAL-NO                       VALUE 'N'.        00610001
006200         88  PS-SERIAL-YES                      VALUE 'Y'.        00620001
006300     05  PS-ACTIVE-TRIP-SW            PIC X(01) VALUE 'N'.        00630001
006400         88  PS-ACTIVE-TRIP-EXISTS              VALUE 'Y'.        00640001
006500         88  PS-NO-ACTIVE-TRIP-EXISTS           VALUE 'N'.        00650001
006600                                                                  00660001
006700 01  PV-PROGRAM-VARIABLES.                                        00670001
006710     05  PV-CURRENT-TRIP-ID           PIC S9(09) COMP.            00671011
006800     05  PV-DOOR-COUNT                PIC S9(03) COMP-3.          00680001
006900     05  PV-DB2-COUNT                 PIC S9(03) COMP-3.          00690001
007000     05  PV-TRIP-STAT-DESC            PIC X(10)  VALUE SPACES.    00700001
007100     05  PV-COMMAREA-LENGTH           PIC S9(04)  VALUE +0        00710001
007200                                                     COMP SYNC.   00720001
007300     05  PV-MESSAGE-AREA              PIC  X(19)  VALUE SPACE.    00730001
007400     05  PV-CICS-RESPONSE             PIC S9(09)  VALUE ZEROS     00740001
007500                                                     COMP SYNC.   00750001
007600     05  PV-TRANSFER-PROGRAM          PIC  X(08)  VALUE SPACE.    00760001
007700                                                                  00770001
007800 01  PV-LOG-MSG.                                                  00780001
007900     05  FILLER                       PIC X(12) VALUE             00790001
008000         ' E878 ERROR '.                                          00800001
008100     05  FILLER                       PIC X(06) VALUE             00810001
008200         'USER= '.                                                00820001
008300     05  PV-USER-ID                   PIC X(08) VALUE SPACES.     00830001
008400     05  FILLER                       PIC X(10) VALUE             00840001
008500         ' SQLCODE= '.                                            00850001
008600     05  PV-SQLCODE                   PIC -9(03).                 00860001
008700     05  FILLER                       PIC X(06) VALUE             00870001
008800         ' ERR= '.                                                00880001
008900     05  PV-ERROR-NBR                 PIC 9(03) VALUE ZERO.       00890001
009000     05  FILLER                       PIC X(07) VALUE             00900001
009100         ' DOOR= '.                                               00910001
009200     05  PV-DISPLAY-DOOR              PIC X(04) VALUE ZEROES.     00920001
009300/                                                                 00930001
009400 01  PV-EDITING-FIELDS.                                           00940001
009500     05  PV-SCREEN-SERIAL-NBR         PIC X(09).                  00950001
009600     05  PV-SCREEN-ACTION             PIC X(01).                  00960001
009700                                                                  00970001
009800/                                                                 00980001
009900 01  CA-COMMAREA.                                                 00990001
010000     COPY PCWS233.                                                01000001
010100     05  CA-PRIVATE-COMMAREA          PIC X(100).                 01010001
010200     05  CA-REDEFINED-COMMAREA REDEFINES CA-PRIVATE-COMMAREA.     01020001
010300         10  CA-CURR-DOOR             PIC X(04).                  01030001
010400         10  CA-CURR-DEST             PIC 9(04).                  01040001
010500         10  CA-CURR-SERIAL-NBR       PIC 9(09).                  01050001
010600/                                                                 01060001
010700*  MAP LAYOUT                                                     01070001
010800     COPY PCKM878.                                                01080001
010900                                                                  01090001
011000* HELP SCREEN COMMAREA                                            01100001
011100     COPY PCWS192.                                                01110001
011200* HELP SCREEN WORK AREA                                           01120001
011300     COPY PCWS188.                                                01130001
011400/                                                                 01140001
011500     COPY DPWS010I.                                               01150001
011600*  KOHL'S STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST   01160001
011700     COPY DPWS015.                                                01170001
011800                                                                  01180001
011900*  KOHL'S STANDARD ATTENTION IDENTIFIER LIST                      01190001
012000     COPY DFHAID.                                                 01200001
012100                                                                  01210001
012200*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA.               01220001
012300     COPY DPWS013.                                                01230001
012400/                                                                 01240001
012500*    DC DOOR MASTER                                               01250001
012600                                                                  01260001
012700*    TRAILER ID MASTER                                            01270001
012800     EXEC SQL                                                     01280001
012900         INCLUDE TCNTRID                                          01290001
013000     END-EXEC.                                                    01300001
013100                                                                  01310001
013200*    OUTBOUND TRAILER TRIP                                        01320001
013300     EXEC SQL                                                     01330001
013400         INCLUDE TSUOBTR                                          01340001
013500     END-EXEC.                                                    01350001
013600                                                                  01360001
013700*    OUTBOUND TRAILER TRIP STATUS                                 01370001
013800     EXEC SQL                                                     01380001
013900         INCLUDE TSUOBTS                                          01390001
014000     END-EXEC.                                                    01400001
014100                                                                  01410001
014200*    OUTBOUND TRAILER TRIP STATUS CODES                           01420001
014300     EXEC SQL                                                     01430001
014400         INCLUDE TSUOBSC                                          01440001
014500     END-EXEC.                                                    01450001
014600                                                                  01460001
014700/                                                                 01470001
014800*    LIST ALL DOORS THAT SERVICE A STORE.  A STORE SHOULD ONLY    01480001
014900*    BE ASSIGNED TO ONE DOOR BUT A DOOR CAN SERVE MULTIPLE STORES 01490001
015000*    ALTHOUGH IT USUALLY SERVES ONLY ONE.                         01500001
015100                                                                  01510001
015200     EXEC SQL                                                     01520001
015300         INCLUDE SQLCA                                            01530001
015400     END-EXEC.                                                    01540001
015500                                                                  01550001
015600 LINKAGE SECTION.                                                 01560001
015700 01  DFHCOMMAREA.                                                 01570001
015800     05  FILLER                         OCCURS  1 TO 4072 TIMES   01580001
015900                                      DEPENDING ON EIBCALEN.      01590001
016000         10  FILLER                   PIC X.                      01600001
016100/                                                                 01610001
016200 PROCEDURE DIVISION.                                              01620001
016300 0000-PROGRAM-MAINLINE.                                           01630001
016400                                                                  01640001
016500     INITIALIZE CA-COMMAREA                                       01650001
016600     MOVE DFHCOMMAREA                 TO CA-COMMAREA              01660001
016700                                                                  01670001
016800     EVALUATE TRUE                                                01680001
016900         WHEN EIBCALEN = ZERO                                     01690001
017000             MOVE PC-ENTER-THROUGH-MENU-MSG                       01700001
017100                                      TO PV-MESSAGE-AREA          01710001
017200             PERFORM 8110-RETURN                                  01720001
017300                                                                  01730001
017400         WHEN EIBTRNID = 'E870'                                   01740001
017500         WHEN EIBTRNID = 'E874'                                   01750001
017600*            RETURNING FROM OPEN TRAILER SCREEN                   01760001
017700             SET PC233-PROCESS-SCREEN TO TRUE                     01770001
017800             MOVE PC233-DOOR-ID       TO ADOORO                   01780001
017900             MOVE PC233-STR-NBR       TO ADESTO                   01790001
018000             MOVE PC233-SERIAL-NBR    TO ASERIALO                 01800001
018100             MOVE PC233-OWNER-SCAC-ID TO ASCACO                   01810001
018200             MOVE PC233-TRIP-ID       TO ATRIPO                   01820001
018300             MOVE PC233-ERROR-TRLR-STATUS                         01830001
018400                                      TO ASTATUSO                 01840001
018500             MOVE 'PCKRF869'          TO PC233-MENU-PROGRAM       01850001
018600             PERFORM 8000-SEND-MAP                                01860001
018700             PERFORM 8100-RETURN-TRANID                           01870001
018800                                                                  01880001
018900         WHEN EIBTRNID = 'Z278'                                   01890001
019000*            RETURNING FROM F1 HELP INFO SCREEN                   01900001
019100             MOVE DFHCOMMAREA         TO PC192-COMMAREA           01910001
019200             MOVE PC192-HOST-SAVE-AREA                            01920001
019300                                      TO CA-COMMAREA              01930001
019400             SET PC233-PROCESS-SCREEN TO TRUE                     01940001
019500             MOVE PC192-HOST-SAVE-MAP TO PC878AO                  01950001
019600             PERFORM 8000-SEND-MAP                                01960001
019700             PERFORM 8100-RETURN-TRANID                           01970001
019800                                                                  01980001
019900         WHEN PC233-INITIALIZE-SCREEN                             01990001
020000         WHEN EIBAID = DFHCLEAR                                   02000001
020100             SET PC233-PROCESS-SCREEN TO TRUE                     02010001
020200             PERFORM 1000-INITIALIZE                              02020001
020300             PERFORM 8000-SEND-MAP                                02030001
020400             PERFORM 8100-RETURN-TRANID                           02040001
020500                                                                  02050001
020600         WHEN EIBAID = DFHPF3                                     02060001
020700             MOVE PC233-MENU-PROGRAM  TO PV-TRANSFER-PROGRAM      02070001
020800             PERFORM 8200-XCTL                                    02080001
020900                                                                  02090001
021000         WHEN EIBAID = DFHPF4                                     02100001
021100*            EDIT AND PROCEED TO PCKRF879                         02110001
021200             PERFORM 8020-RECEIVE-MAP                             02120001
021300             PERFORM 2100-EDIT-INPUT                              02130001
021400             IF PS-ERRORS-NO                                      02140001
021500                 PERFORM 2205-GET-TRAILER-INFO                    02150001
021600             END-IF                                               02160001
021700             IF PS-ERRORS-NO                                      02170001
021800                 PERFORM 2200-F4-EDITS                            02180001
021900             END-IF                                               02190001
022000             IF PS-ERRORS-NO                                      02200001
022100                 MOVE 'PCKRF879'  TO PV-TRANSFER-PROGRAM          02210001
022200                 PERFORM 8200-XCTL                                02220001
022300             ELSE                                                 02230001
022400                 IF PS-XCTL-E871                                  02240001
022500                     PERFORM 8210-XCTL-ERROR-SCREEN               02250001
022600                 ELSE                                             02260001
022700                     PERFORM 8010-SEND-DATA-ONLY                  02270001
022800                     PERFORM 8100-RETURN-TRANID                   02280001
022900                 END-IF                                           02290001
023000             END-IF                                               02300001
023100                                                                  02310001
023200         WHEN EIBAID = DFHPF5                                     02320001
023300             MOVE 'PCKRF870'          TO PV-TRANSFER-PROGRAM      02330001
023400                                         PC233-ROOT-PROGRAM       02340001
023500             SET PC233-PROCESS-SCREEN TO TRUE                     02350001
023600             PERFORM 8200-XCTL                                    02360001
023700                                                                  02370001
023800         WHEN EIBAID = DFHENTER                                   02380001
023900*            EDIT ONLY                                            02390001
024000             PERFORM 8020-RECEIVE-MAP                             02400001
024100             PERFORM 2100-EDIT-INPUT                              02410001
024200             IF PS-ERRORS-NO                                      02420001
024300                 PERFORM 2205-GET-TRAILER-INFO                    02430001
024400             END-IF                                               02440001
024500                                                                  02450001
024600             IF PS-ERRORS-YES                                     02460001
024700                 IF PS-XCTL-E871                                  02470001
024800                     PERFORM 8210-XCTL-ERROR-SCREEN               02480001
024900                 ELSE                                             02490001
025000                     PERFORM 8010-SEND-DATA-ONLY                  02500001
025100                     PERFORM 8100-RETURN-TRANID                   02510001
025200                 END-IF                                           02520001
025300             ELSE                                                 02530001
025310                 MOVE -1              TO ACTIONL                  02531005
025600                 PERFORM 8010-SEND-DATA-ONLY                      02560001
025700                 PERFORM 8100-RETURN-TRANID                       02570001
025800             END-IF                                               02580001
025900                                                                  02590001
025901         WHEN EIBAID = DFHPF8                                     02590104
025902             MOVE 'PCKRF880'          TO PV-TRANSFER-PROGRAM      02590204
025903             PERFORM 8200-XCTL                                    02590304
025910                                                                  02591004
025920         WHEN EIBAID = DFHPF9                                     02592004
025930             MOVE 'PCKRF743'          TO PV-TRANSFER-PROGRAM      02593004
025940             PERFORM 8200-XCTL                                    02594004
025950                                                                  02595004
026000         WHEN EIBAID = DFHPF1                                     02600001
026100             PERFORM 8020-RECEIVE-MAP                             02610001
026200             MOVE PC878AO             TO PC192-HOST-SAVE-MAP      02620001
026300             PERFORM 1200-HELP-SCREEN                             02630001
026400                                                                  02640001
026500         WHEN OTHER                                               02650001
026600             PERFORM 8020-RECEIVE-MAP                             02660001
026700             MOVE PC-UNRECOGNIZED-PF-KEY-MSG                      02670001
026800                                      TO AMSGLNO                  02680001
026900             PERFORM 8000-SEND-MAP                                02690001
027000             PERFORM 8100-RETURN-TRANID                           02700001
027100     END-EVALUATE.                                                02710001
027200                                                                  02720001
027300     GOBACK.                                                      02730001
027400                                                                  02740001
027500 1000-INITIALIZE.                                                 02750001
027600                                                                  02760001
027900     INITIALIZE CA-REDEFINED-COMMAREA                             02790001
028000                PC233-DOOR-ID                                     02800001
028100                PC233-TRIP-ID                                     02810001
028200                PC233-SERIAL-NBR                                  02820001
028300                PC233-STR-NBR                                     02830001
028400                PC233-OWNER-SCAC-ID                               02840001
028500                PC233-CARTON                                      02850001
028600                PC233-TRAILER                                     02860001
028700                PC233-ERROR-FIELDS                                02870001
028800     SET PC233-SCAN-ON-CONTAINER      TO TRUE                     02880006
028900     MOVE PC233-MENU-PROGRAM          TO PV-TRANSFER-PROGRAM      02890001
029000                                                                  02900001
029100     MOVE PC-TRANID                   TO PC233-TRAN-ID            02910001
029200                                                                  02920001
029300     MOVE PC233-USER-ID               TO PV-USER-ID.              02930001
029400                                                                  02940001
029500                                                                  02950001
029600 1200-HELP-SCREEN.                                                02960001
029700     MOVE 'DPKRF278'                  TO PV-TRANSFER-PROGRAM      02970001
029800     MOVE PC-CURRENT-PROGRAM-NAME     TO PC192-PROGRAM-NAME       02980001
029900     COPY PCPD188.                                                02990001
030000     MOVE PC188-DISPLAY-DATE          TO PC192-DISPLAY-DATE.      03000001
030100     MOVE CA-COMMAREA                 TO PC192-HOST-SAVE-AREA     03010001
030200     PERFORM 8220-XCTL-TO-HELP.                                   03020001
030300                                                                  03030001
030400/                                                                 03040001
030500 2100-EDIT-INPUT.                                                 03050001
030600                                                                  03060001
030700     SET PS-ERRORS-NO                 TO TRUE                     03070001
030800     MOVE SPACES                      TO AMSGLNO                  03080001
030900                                                                  03090001
031000     IF ASERIALA = DP015-ERASE-EOF                                03100001
031100         MOVE ZEROES                  TO PV-SCREEN-SERIAL-NBR     03110001
031200     ELSE                                                         03120001
031300         MOVE ASERIALI                TO PV-SCREEN-SERIAL-NBR     03130001
031400     END-IF                                                       03140001
031500                                                                  03150001
031600     IF ACTIONA = DP015-ERASE-EOF                                 03160001
031700         MOVE SPACE                   TO PV-SCREEN-ACTION         03170001
031800     ELSE                                                         03180001
031900         MOVE ACTIONI                 TO PV-SCREEN-ACTION         03190001
032000     END-IF                                                       03200001
032100                                                                  03210001
032200     IF PV-SCREEN-ACTION = 'N' OR 'F'                             03220006
032300         MOVE PV-SCREEN-ACTION        TO PC233-SCAN-ON-OFF-IND    03230006
032310         IF PV-SCREEN-ACTION = 'N'                                03231008
032312             MOVE 'F4-SCN ON  F5-OPEN'                            03231210
032313                                      TO AMSGLNO                  03231308
032314         ELSE                                                     03231408
032316             MOVE 'F4-SCN OFF F5-OPEN'                            03231610
032317                                      TO AMSGLNO                  03231710
032320         END-IF                                                   03232008
032400     ELSE                                                         03240001
032500         SET PS-ERRORS-YES            TO TRUE                     03250001
032600         MOVE '  INVALID ENTRY    '                               03260001
032700                                      TO AMSGLNO                  03270001
032800         MOVE -1                      TO ACTIONL                  03280001
032900     END-IF.                                                      03290001
033000                                                                  03300001
033100     PERFORM 2110-PRE-EDITS                                       03310001
033200*    (VALIDATE NUMERIC FIELDS AND LOAD CA-CURR FIELDS)            03320001
033300                                                                  03330001
033400                                                                  03340001
033500     IF PS-ERRORS-NO                                              03350001
033600         IF PC233-SERIAL-NBR = ZERO                               03360001
033700             SET PS-ERRORS-YES        TO TRUE                     03370001
033800             MOVE '  SER NBR REQUIRED '                           03380001
033900                                      TO AMSGLNO                  03390001
034000         END-IF                                                   03400001
034100     END-IF.                                                      03410001
034200                                                                  03420001
034300                                                                  03430001
034400 2110-PRE-EDITS.                                                  03440001
034500     MOVE PV-SCREEN-SERIAL-NBR        TO DP010I-UNEDITED-FIELD    03450001
034600     MOVE LENGTH OF PV-SCREEN-SERIAL-NBR                          03460001
034700                                      TO DP010I-MAXIMUM-DIGITS    03470001
034800     MOVE ZERO                        TO DP010I-MAXIMUM-DECIMALS  03480001
034900     SET DP010I-NEGATIVE-NOT-ALLOWED  TO TRUE                     03490001
035010     CALL DP010I-NUMERIC-EDIT-ROUTINE                             03501013
035020                         USING DP010I-NUMERIC-EDIT-AREA           03502013
035100     IF DP010I-ERROR-DETECTED                                     03510001
035200         SET PS-ERRORS-YES            TO TRUE                     03520001
035300                                                                  03530001
035400         MOVE 'SER NBR NOT NUMERIC '                              03540001
035500                                      TO AMSGLNO                  03550001
035600     ELSE                                                         03560001
035700         MOVE DP010I-NUMERIC-FIELD    TO CA-CURR-SERIAL-NBR       03570001
035800                                         PC233-SERIAL-NBR         03580001
035900     END-IF.                                                      03590001
036000/                                                                 03600001
036100 2200-F4-EDITS.                                                   03610001
036200     IF CA-CURR-SERIAL-NBR > ZERO                                 03620001
036300         PERFORM 7010-CHECK-IF-TRLR-OPEN                          03630001
036400         IF SUOBTS-TRIP-STAT-CDE = 'DO'                           03640001
036500             CONTINUE                                             03650001
036600         ELSE                                                     03660001
036700             SET PS-ERRORS-YES                                    03670001
036800                 PS-XCTL-E871         TO TRUE                     03680001
036900             MOVE 12                  TO PC233-PGM-MSG-NBR        03690001
037000         END-IF                                                   03700001
037100     END-IF.                                                      03710001
037200                                                                  03720001
037300                                                                  03730001
037400                                                                  03740001
037500*  THIS MIGHT HAVE THE SAME RESULT AS PARA 2235-                  03750001
037600     IF PS-ERRORS-NO AND PS-ACTIVE-TRIP-EXISTS                    03760001
037700         PERFORM 2240-IS-TRAILER-CLOSED                           03770001
037800     END-IF.                                                      03780001
037900                                                                  03790001
038000 2205-GET-TRAILER-INFO.                                           03800001
038001                                                                  03800111
038010     PERFORM 6800-GET-MOST-RECENT-TRIP.                           03801011
038020                                                                  03802011
038100     PERFORM 7000-SELECT-TRAILER-INFO.                            03810001
038110                                                                  03811011
038200     IF PS-ACTIVE-TRIP-EXISTS                                     03820001
038300         MOVE SUOBTS-OTBND-TRIP-ID    TO ATRIPO                   03830001
038400                                         PC233-TRIP-ID            03840001
038500                                         PC233-ERROR-TRIP-ID      03850001
038600         MOVE CNTRID-SCAC-CDE         TO ASCACO                   03860001
038700                                         PC233-OWNER-SCAC-ID      03870001
038800                                         PC233-ERROR-SCAC-ID      03880001
038900         MOVE CNTRID-TRLR-ID          TO PC233-TRAILER            03890001
039000                                         PC233-ERROR-TRLR-ID      03900001
039100                                         ATRLRO                   03910001
039200         MOVE SUOBTS-DOOR-ID          TO ADOORO                   03920001
039300                                         PC233-DOOR-ID            03930001
039400         MOVE SUOBTR-DEST-OPER-UNT-ID TO ADESTO                   03940001
039500                                         PC233-STR-NBR            03950001
039600         MOVE SUOBSC-STAT-SHRT-DESC   TO ASTATUSO                 03960001
039700                                         PC233-ERROR-TRLR-STATUS  03970001
039710         MOVE PC233-SERIAL-NBR        TO PC233-ERROR-SRL-NBR      03971004
039800     ELSE                                                         03980001
039900         MOVE ' INACTIVE TRLR     '   TO AMSGLNO                  03990001
040000         MOVE ZERO                    TO ATRIPO                   04000001
040100                                         PC233-TRIP-ID            04010001
040200                                         PC233-ERROR-TRIP-ID      04020001
040300                                         ADESTO                   04030001
040400                                         PC233-STR-NBR            04040001
040500         MOVE ALL '?'                 TO ASCACO                   04050001
040600                                         PC233-OWNER-SCAC-ID      04060001
040700                                         PC233-ERROR-SCAC-ID      04070001
040800                                         ADOORO                   04080001
040900                                         PC233-DOOR-ID            04090001
041000                                         PC233-TRAILER            04100001
041100                                         ATRLRO                   04110001
041200                                         PC233-ERROR-TRLR-ID      04120001
041300                                         PC233-ERROR-TRLR-STATUS  04130001
041400                                         ASTATUSO                 04140001
041500     END-IF.                                                      04150001
041600                                                                  04160001
041700/                                                                 04170001
041800 2240-IS-TRAILER-CLOSED.                                          04180001
041900                                                                  04190001
042000* SWITCH IS SET IN PARA 2205-GET-TRAILER-INFO                     04200001
042100     IF PS-ACTIVE-TRIP-EXISTS                                     04210001
042200         EVALUATE TRUE                                            04220001
042300         WHEN SUOBTS-TRIP-STAT-CDE = 'DC'                         04230001
042400             SET PS-ERRORS-YES        TO TRUE                     04240001
042500                                                                  04250001
042600             MOVE SUOBTS-OTBND-TRIP-ID                            04260001
042700                                      TO ATRIPO                   04270001
042800                                         PC233-TRIP-ID            04280001
042900                                         PC233-ERROR-TRIP-ID      04290001
043000             MOVE 'TRLR ALREADY CLOSED'                           04300001
043100                                      TO AMSGLNO                  04310001
043200         WHEN SUOBTS-TRIP-STAT-CDE = 'DO'                         04320001
043300             MOVE SUOBTS-OTBND-TRIP-ID                            04330001
043400                                      TO ATRIPO                   04340001
043500                                         PC233-TRIP-ID            04350001
043600                                         PC233-ERROR-TRIP-ID      04360001
043700         END-EVALUATE                                             04370001
043800     END-IF.                                                      04380001
043900                                                                  04390001
044000/                                                                 04400001
044100 6800-GET-MOST-RECENT-TRIP.                                       04410011
044200                                                                  04420001
044300     INITIALIZE PV-CURRENT-TRIP-ID.                               04430011
045000                                                                  04500001
045100     EXEC SQL                                                     04510001
045200       SELECT                                                     04520001
045300           OBTS.OTBND_TRIP_ID                                     04530001
045830       INTO                                                       04583004
045840           :PV-CURRENT-TRIP-ID                                    04584011
046000       FROM TSUOBTS OBTS                                          04600004
046100       ,    TSUOBTR OBTR                                          04610004
046200       ,    TCNTRID TRID                                          04620004
046400       WHERE                                                      04640004
046500           OBTR.ORGN_OPER_UNT_ID    = :PC233-OPER-UNT-ID          04650004
046600       AND OBTR.TRLR_SRL_NBR        = :PC233-SERIAL-NBR           04660004
046700       AND OBTR.TRIP_ACTV_CDE       = 'A'                         04670004
046800       AND OBTR.TRLR_SRL_NBR        = TRID.TRLR_SRL_NBR           04680004
046900       AND OBTS.OTBND_TRIP_ID       = OBTR.OTBND_TRIP_ID          04690004
047100       AND OBTS.TRIP_STAT_CDE      IN ('DO','AO')                 04710011
047200       AND OBTS.OTBND_STAT_TMST =                                 04720004
047300           (SELECT MAX(OBTS1.OTBND_STAT_TMST)                     04730004
047400               FROM TSUOBTS OBTS1                                 04740004
047500               WHERE                                              04750004
047600               OBTS1.OTBND_TRIP_ID = OBTS.OTBND_TRIP_ID)          04760004
047700                                                                  04770004
047800     END-EXEC.                                                    04780004
047900                                                                  04790004
048000     EVALUATE TRUE                                                04800004
048100         WHEN SQLCODE = ZERO                                      04810004
048200             SET PS-ACTIVE-TRIP-EXISTS                            04820004
048300                                      TO TRUE                     04830004
048400         WHEN SQLCODE = +100                                      04840004
048500             SET PS-ERRORS-YES                                    04850004
048600                 PS-NO-ACTIVE-TRIP-EXISTS                         04860004
048700                                      TO TRUE                     04870004
048800         WHEN SQLCODE = -904                                      04880004
048900         WHEN SQLCODE = -913                                      04890004
049000         WHEN SQLCODE = -911                                      04900004
049100             MOVE 1                   TO PV-ERROR-NBR             04910004
049200             PERFORM 9903-WRITE-CICS-LOG                          04920004
049300             PERFORM 9000-SOFT-ABORT                              04930004
049400         WHEN SQLWARN0 NOT = SPACES                               04940004
049500         WHEN SQLCODE NOT EQUAL ZERO                              04950004
049600             MOVE 2                   TO PV-ERROR-NBR             04960004
049700                                         PC233-ERROR-NBR          04970004
049800             PERFORM 9903-WRITE-CICS-LOG                          04980004
049900             MOVE '6800-GET-MOST-RECENT-TRIP'                     04990011
050000                                      TO PC233-PARAGRAPH          05000004
050100             MOVE 'PCKRF878 - CHECK TRLR AT ANOTHER DOOR'         05010004
050200                                      TO PC233-MESSAGE-TEXT(1)    05020004
050300             MOVE SQLCA               TO PC233-SQLCA              05030004
050400             MOVE 'TSUOBTS'           TO PC233-DB2-TABLE-NAME(1)  05040004
050500             MOVE 'TSUOBTR'           TO PC233-DB2-TABLE-NAME(2)  05050004
050600             SET PC233-ABEND          TO TRUE                     05060004
050700             MOVE 99                  TO PC233-PGM-MSG-NBR        05070004
050800             PERFORM 8210-XCTL-ERROR-SCREEN                       05080004
050900     END-EVALUATE.                                                05090004
051000/                                                                 05100004
051020 7000-SELECT-TRAILER-INFO.                                        05102011
051030                                                                  05103011
051040     INITIALIZE SUOBTS-OTBND-TRIP-ID                              05104011
051050                CNTRID-SCAC-CDE                                   05105011
051060                CNTRID-TRLR-ID                                    05106011
051070                SUOBTS-TRIP-STAT-CDE                              05107011
051080                SUOBTS-DOOR-ID                                    05108011
051090                SUOBTR-DEST-OPER-UNT-ID                           05109011
051091                SUOBSC-STAT-SHRT-DESC                             05109111
051092                                                                  05109211
051093     EXEC SQL                                                     05109311
051094       SELECT                                                     05109411
051095           OBTS.OTBND_TRIP_ID                                     05109511
051096       ,   TRID.SCAC_CDE                                          05109611
051097       ,   TRID.TRLR_ID                                           05109711
051098       ,   OBTS.TRIP_STAT_CDE                                     05109811
051099       ,   OBTS.DOOR_ID                                           05109911
051100       ,   OBTR.DEST_OPER_UNT_ID                                  05110011
051101       ,   OBSC.STAT_SHRT_DESC                                    05110111
051102                                                                  05110211
051103       INTO                                                       05110311
051104           :SUOBTS-OTBND-TRIP-ID                                  05110411
051105       ,   :CNTRID-SCAC-CDE                                       05110511
051106       ,   :CNTRID-TRLR-ID                                        05110611
051107       ,   :SUOBTS-TRIP-STAT-CDE                                  05110711
051108       ,   :SUOBTS-DOOR-ID                                        05110811
051109       ,   :SUOBTR-DEST-OPER-UNT-ID                               05110911
051110       ,   :SUOBSC-STAT-SHRT-DESC                                 05111011
051111       FROM TSUOBTS OBTS                                          05111111
051112       ,    TSUOBTR OBTR                                          05111211
051113       ,    TCNTRID TRID                                          05111311
051114       ,    TSUOBSC OBSC                                          05111411
051115       WHERE                                                      05111511
051116           OBTR.ORGN_OPER_UNT_ID    = :PC233-OPER-UNT-ID          05111611
051117       AND OBTR.TRLR_SRL_NBR        = :PC233-SERIAL-NBR           05111711
051118       AND OBTR.TRIP_ACTV_CDE       = 'A'                         05111811
051119       AND OBTR.TRLR_SRL_NBR        = TRID.TRLR_SRL_NBR           05111911
051120       AND OBTS.OTBND_TRIP_ID       = :PV-CURRENT-TRIP-ID         05112012
051121       AND OBTS.OTBND_TRIP_ID       = OBTR.OTBND_TRIP_ID          05112111
051122       AND OBSC.TRIP_STAT_CDE       = OBTS.TRIP_STAT_CDE          05112211
051123                                                                  05112311
051124       AND OBTS.OTBND_STAT_TMST =                                 05112411
051125           (SELECT MAX(OBTS1.OTBND_STAT_TMST)                     05112511
051126               FROM TSUOBTS OBTS1                                 05112611
051127               WHERE                                              05112711
051128               OBTS1.OTBND_TRIP_ID = OBTS.OTBND_TRIP_ID)          05112811
051129                                                                  05112911
051130     END-EXEC.                                                    05113011
051131                                                                  05113111
051132     EVALUATE TRUE                                                05113211
051133         WHEN SQLCODE = ZERO                                      05113311
051134             SET PS-ACTIVE-TRIP-EXISTS                            05113411
051135                                      TO TRUE                     05113511
051136         WHEN SQLCODE = +100                                      05113611
051137             SET PS-ERRORS-YES                                    05113711
051138                 PS-NO-ACTIVE-TRIP-EXISTS                         05113811
051139                                      TO TRUE                     05113911
051140         WHEN SQLCODE = -904                                      05114011
051141         WHEN SQLCODE = -913                                      05114111
051142         WHEN SQLCODE = -911                                      05114211
051143             MOVE 1                   TO PV-ERROR-NBR             05114311
051144             PERFORM 9903-WRITE-CICS-LOG                          05114411
051145             PERFORM 9000-SOFT-ABORT                              05114511
051146         WHEN SQLWARN0 NOT = SPACES                               05114611
051147         WHEN SQLCODE NOT EQUAL ZERO                              05114711
051148             MOVE 2                   TO PV-ERROR-NBR             05114811
051149                                         PC233-ERROR-NBR          05114911
051150             PERFORM 9903-WRITE-CICS-LOG                          05115011
051151             MOVE '7000-SELECT-TRAILER-INFO'                      05115111
051152                                      TO PC233-PARAGRAPH          05115211
051153             MOVE 'PCKRF878 - CHECK TRLR AT ANOTHER DOOR'         05115311
051154                                      TO PC233-MESSAGE-TEXT(1)    05115411
051155             MOVE SQLCA               TO PC233-SQLCA              05115511
051156             MOVE 'TSUOBTS'           TO PC233-DB2-TABLE-NAME(1)  05115611
051157             MOVE 'TSUOBTR'           TO PC233-DB2-TABLE-NAME(2)  05115711
051158             SET PC233-ABEND          TO TRUE                     05115811
051159             MOVE 99                  TO PC233-PGM-MSG-NBR        05115911
051160             PERFORM 8210-XCTL-ERROR-SCREEN                       05116011
051161     END-EVALUATE.                                                05116111
051162/                                                                 05116211
051170 7010-CHECK-IF-TRLR-OPEN.                                         05117011
051200                                                                  05120004
051300     EXEC SQL                                                     05130004
051400         SELECT OBTS.TRIP_STAT_CDE                                05140004
051500         INTO :SUOBTS-TRIP-STAT-CDE                               05150004
051600         FROM TSUOBTS OBTS                                        05160004
051700         ,    TSUOBTR OBTR                                        05170004
051800         WHERE                                                    05180004
051900             OBTR.OTBND_TRIP_ID       = OBTS.OTBND_TRIP_ID        05190004
052000         AND OBTR.OTBND_TRIP_ID       = :PC233-TRIP-ID            05200004
052100         AND OBTS.OTBND_STAT_TMST     =                           05210004
052200         (                                                        05220004
052300          SELECT                                                  05230004
052400            MAX(OBTS1.OTBND_STAT_TMST)                            05240004
052500            FROM TSUOBTS OBTS1                                    05250004
052600            WHERE OBTS.OTBND_TRIP_ID = OBTS1.OTBND_TRIP_ID        05260004
052700         )                                                        05270004
052800     END-EXEC.                                                    05280004
052900                                                                  05290004
053000     EVALUATE TRUE                                                05300004
053100         WHEN SQLCODE = ZERO                                      05310004
053200         WHEN SQLCODE = +100                                      05320004
053300         WHEN SQLCODE = -811                                      05330004
053400             CONTINUE                                             05340004
053500         WHEN SQLCODE = -904                                      05350004
053600         WHEN SQLCODE = -913                                      05360004
053700         WHEN SQLCODE = -911                                      05370004
053800             MOVE 3                   TO PV-ERROR-NBR             05380004
053900             PERFORM 9903-WRITE-CICS-LOG                          05390004
054000             PERFORM 9000-SOFT-ABORT                              05400004
054100         WHEN SQLWARN0 NOT = SPACES                               05410004
054200         WHEN SQLCODE NOT EQUAL ZERO                              05420004
054300             MOVE 4                   TO PV-ERROR-NBR             05430004
054400                                         PC233-ERROR-NBR          05440004
054500             PERFORM 9903-WRITE-CICS-LOG                          05450004
054600             MOVE '7010-CHECK-IF-TRLR-OPEN'                       05460004
054700                                      TO PC233-PARAGRAPH          05470004
054800             MOVE 'PCKRF878 - CHECK IF TRLR IS OPEN'              05480004
054900                                      TO PC233-MESSAGE-TEXT(1)    05490004
055000             MOVE SQLCA               TO PC233-SQLCA              05500004
055100             MOVE 'TSUOBTS'           TO PC233-DB2-TABLE-NAME(1)  05510004
055200             SET PC233-ABEND          TO TRUE                     05520004
055300             MOVE 99                  TO PC233-PGM-MSG-NBR        05530004
055400             PERFORM 8210-XCTL-ERROR-SCREEN                       05540004
055500     END-EVALUATE.                                                05550004
055600/                                                                 05560004
055700 8000-SEND-MAP.                                                   05570004
055800                                                                  05580004
055900     IF ACTIONL = -1                                              05590004
056000         CONTINUE                                                 05600004
056100     ELSE                                                         05610004
056200         MOVE -1                      TO ASERIALL                 05620004
056300     END-IF                                                       05630004
056400                                                                  05640004
056500     EXEC CICS                                                    05650004
056600         SEND MAP       ('PC878A')                                05660004
056700              MAPSET    ('PCKM878')                               05670004
056800              ERASE                                               05680004
056900              CURSOR                                              05690004
057000              RESP      (PV-CICS-RESPONSE)                        05700004
057100     END-EXEC.                                                    05710004
057200                                                                  05720004
057300     EVALUATE TRUE                                                05730004
057400         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 05740004
057500             CONTINUE                                             05750004
057600         WHEN OTHER                                               05760004
057700             MOVE '8000-SEND-MAP'     TO DP013-PARAGRAPH          05770004
057800             MOVE 'PCKRF878 - UNABLE TO SEND MAP'                 05780004
057900                                      TO DP013-MESSAGE-TEXT (1)   05790004
058000             SET DP013-CICS-ABEND                                 05800004
058100                 DP013-ROLLBACK       TO TRUE                     05810004
058200             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               05820004
058300     END-EVALUATE.                                                05830004
058400                                                                  05840004
058500 8010-SEND-DATA-ONLY.                                             05850004
058600                                                                  05860004
058700     IF ACTIONL = -1                                              05870004
058800         CONTINUE                                                 05880004
058900     ELSE                                                         05890004
059000         MOVE -1                      TO ASERIALL                 05900004
059100     END-IF                                                       05910004
059200                                                                  05920004
059300     EXEC CICS                                                    05930004
059400         SEND MAP       ('PC878A')                                05940004
059500              MAPSET    ('PCKM878')                               05950004
059600              CURSOR                                              05960004
059700              DATAONLY                                            05970004
059800              RESP      (PV-CICS-RESPONSE)                        05980004
059900     END-EXEC.                                                    05990004
060000                                                                  06000004
060100     EVALUATE TRUE                                                06010004
060200         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 06020004
060300             CONTINUE                                             06030004
060400         WHEN OTHER                                               06040004
060500             MOVE '8010-SEND-DATA-ONLY'                           06050004
060600                                      TO DP013-PARAGRAPH          06060004
060700             MOVE 'PCKRF878 - UNABLE TO SEND DATA'                06070004
060800                                      TO DP013-MESSAGE-TEXT (1)   06080004
060900             SET DP013-CICS-ABEND                                 06090004
061000                 DP013-ROLLBACK       TO TRUE                     06100004
061100             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               06110004
061200     END-EVALUATE.                                                06120004
061300                                                                  06130004
061400 8020-RECEIVE-MAP.                                                06140004
061500                                                                  06150004
061600     EXEC CICS                                                    06160004
061700         RECEIVE MAP    ('PC878A')                                06170004
061800                 MAPSET ('PCKM878')                               06180004
061900                 RESP   (PV-CICS-RESPONSE)                        06190004
062000     END-EXEC.                                                    06200004
062100                                                                  06210004
062200     EVALUATE TRUE                                                06220004
062300         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 06230004
062400             CONTINUE                                             06240004
062500         WHEN PV-CICS-RESPONSE = DFHRESP (MAPFAIL)                06250004
062600             CONTINUE                                             06260004
062700         WHEN OTHER                                               06270004
062800            MOVE '8020-RECEIVE-MAP'   TO DP013-PARAGRAPH          06280004
062900            MOVE 'PCKRF878 - UNABLE TO RECEIVE MAP'               06290004
063000                                      TO DP013-MESSAGE-TEXT (1)   06300004
063100            SET DP013-LOGIC-ABEND     TO TRUE                     06310004
063200            SET DP013-ROLLBACK        TO TRUE                     06320004
063300            PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                06330004
063400     END-EVALUATE.                                                06340004
063500                                                                  06350004
063600 8100-RETURN-TRANID.                                              06360004
063700                                                                  06370004
063800     MOVE LENGTH OF CA-COMMAREA       TO PV-COMMAREA-LENGTH       06380004
063900     EXEC CICS                                                    06390004
064000         RETURN TRANSID  (PC-TRANID)                              06400004
064100                COMMAREA (CA-COMMAREA)                            06410004
064200                LENGTH   (PV-COMMAREA-LENGTH)                     06420004
064300                RESP     (PV-CICS-RESPONSE)                       06430004
064400     END-EXEC.                                                    06440004
064500                                                                  06450004
064600     EVALUATE TRUE                                                06460004
064700         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 06470004
064800             CONTINUE                                             06480004
064900         WHEN OTHER                                               06490004
065000             MOVE '8100-RETURN-TRANIND'                           06500004
065100                                      TO DP013-PARAGRAPH          06510004
065200             MOVE 'PCKRF878 - UNABLE TO RETURN TO TRANID'         06520004
065300                 TO DP013-MESSAGE-TEXT (1)                        06530004
065400             SET DP013-CICS-ABEND     TO TRUE                     06540004
065500             SET DP013-ROLLBACK       TO TRUE                     06550004
065600             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               06560004
065700     END-EVALUATE.                                                06570004
065800                                                                  06580004
065900 8110-RETURN.                                                     06590004
066000                                                                  06600004
066100     EXEC CICS                                                    06610004
066200         SEND FROM (PV-MESSAGE-AREA)                              06620004
066300              LENGTH (19)                                         06630004
066400              ERASE                                               06640004
066500     END-EXEC.                                                    06650004
066600                                                                  06660004
066700     EXEC CICS                                                    06670004
066800         RETURN                                                   06680004
066900     END-EXEC.                                                    06690004
067000                                                                  06700004
067100 8200-XCTL.                                                       06710004
067200     SET PC233-INITIALIZE-SCREEN      TO TRUE.                    06720004
067300     MOVE PC-CURRENT-PROGRAM-NAME     TO PC233-LAST-PROGRAM.      06730004
067400     MOVE LENGTH OF CA-COMMAREA       TO PV-COMMAREA-LENGTH       06740004
067500                                                                  06750004
067600     EXEC CICS                                                    06760004
067700         XCTL  PROGRAM   (PV-TRANSFER-PROGRAM)                    06770004
067800               COMMAREA  (CA-COMMAREA)                            06780004
067900               LENGTH    (PV-COMMAREA-LENGTH)                     06790004
068000               RESP      (PV-CICS-RESPONSE)                       06800004
068100     END-EXEC.                                                    06810004
068200                                                                  06820004
068300     EVALUATE TRUE                                                06830004
068400         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 06840004
068500             CONTINUE                                             06850004
068600         WHEN OTHER                                               06860004
068700             MOVE '8200-XCTL'                                     06870004
068800                                      TO DP013-PARAGRAPH          06880004
068900             MOVE 'PCKRF878 - UNABLE TO XCTL TO PROGRAM: '        06890004
069000                                      TO DP013-MESSAGE-TEXT (1)   06900004
069100             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   06910004
069200             SET DP013-CICS-ABEND                                 06920004
069300                 DP013-ROLLBACK       TO TRUE                     06930004
069400             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               06940004
069500             MOVE PC-TRANS-UNAVAILABLE-MSG                        06950004
069600                                      TO AMSGLNO                  06960004
069700             SET PC233-PROCESS-SCREEN TO TRUE                     06970004
069800             PERFORM 8000-SEND-MAP                                06980004
069900             PERFORM 8100-RETURN-TRANID                           06990004
070000     END-EVALUATE.                                                07000004
070100                                                                  07010004
070200 8210-XCTL-ERROR-SCREEN.                                          07020004
070300     IF NOT PC233-ABEND                                           07030004
070400         SET PC233-INITIALIZE-SCREEN  TO TRUE                     07040004
070500     END-IF                                                       07050004
070600     IF PC233-PGM-MSG-NBR = ZERO                                  07060004
070700         MOVE 2                       TO PC233-PGM-MSG-NBR        07070004
070800     END-IF                                                       07080004
070900                                                                  07090004
071000     MOVE DFHEIBLK                    TO PC233-DFHEIBLK.          07100004
071100     MOVE PC-CURRENT-PROGRAM-NAME     TO PC233-LAST-PROGRAM.      07110004
071200     MOVE LENGTH OF CA-COMMAREA       TO PV-COMMAREA-LENGTH       07120004
071300     MOVE 'PCKRF871'                  TO PV-TRANSFER-PROGRAM      07130004
071400                                                                  07140004
071500     EXEC CICS                                                    07150004
071600         XCTL  PROGRAM   (PV-TRANSFER-PROGRAM)                    07160004
071700               COMMAREA  (CA-COMMAREA)                            07170004
071800               LENGTH    (PV-COMMAREA-LENGTH)                     07180004
071900               RESP      (PV-CICS-RESPONSE)                       07190004
072000     END-EXEC.                                                    07200004
072100                                                                  07210004
072200     EVALUATE TRUE                                                07220004
072300         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 07230004
072400             CONTINUE                                             07240004
072500         WHEN OTHER                                               07250004
072600             MOVE '8200-XCTL'                                     07260004
072700                                      TO DP013-PARAGRAPH          07270004
072800             MOVE 'PCKRF878 - UNABLE TO XCTL TO PROGRAM: '        07280004
072900                                      TO DP013-MESSAGE-TEXT (1)   07290004
073000             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   07300004
073100             SET DP013-CICS-ABEND                                 07310004
073200                 DP013-ROLLBACK       TO TRUE                     07320004
073300             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               07330004
073400             MOVE PC-TRANS-UNAVAILABLE-MSG                        07340004
073500                                      TO AMSGLNO                  07350004
073600             SET PC233-PROCESS-SCREEN TO TRUE                     07360004
073700             PERFORM 8000-SEND-MAP                                07370004
073800             PERFORM 8100-RETURN-TRANID                           07380004
073900     END-EVALUATE.                                                07390004
074000                                                                  07400004
074100*                                                                 07410004
074200 8220-XCTL-TO-HELP.                                               07420004
074300                                                                  07430004
074400     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH       07440004
074500                                                                  07450004
074600     EXEC CICS                                                    07460004
074700         XCTL                                                     07470004
074800             PROGRAM   (PV-TRANSFER-PROGRAM)                      07480004
074900             COMMAREA  (PC192-COMMAREA)                           07490004
075000             LENGTH    (PV-COMMAREA-LENGTH)                       07500004
075100             RESP      (PV-CICS-RESPONSE)                         07510004
075200     END-EXEC.                                                    07520004
075300                                                                  07530004
075400     EVALUATE TRUE                                                07540004
075500         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 07550004
075600              CONTINUE                                            07560004
075700         WHEN OTHER                                               07570004
075800             MOVE '8220-XCTL-TO-HELP' TO DP013-PARAGRAPH          07580004
075900             MOVE 'PCKRF878 - UNABLE TO XCTL TO PROGRAM: '        07590004
076000                                      TO DP013-MESSAGE-TEXT (1)   07600004
076100             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   07610004
076200             SET DP013-CICS-ABEND                                 07620004
076300                 DP013-ROLLBACK       TO TRUE                     07630004
076400             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               07640004
076500             MOVE PC-TRANS-UNAVAILABLE-MSG                        07650004
076600                                      TO AMSGLNO                  07660004
076700             SET PC233-PROCESS-SCREEN TO TRUE                     07670004
076800             PERFORM 8000-SEND-MAP                                07680004
076900             PERFORM 8100-RETURN-TRANID                           07690004
077000     END-EVALUATE.                                                07700004
077100/                                                                 07710004
077200 9000-SOFT-ABORT.                                                 07720004
077300                                                                  07730004
077400     EXEC CICS                                                    07740004
077500         SYNCPOINT ROLLBACK                                       07750004
077600     END-EXEC                                                     07760004
077700                                                                  07770004
077800     MOVE 1                           TO PC233-PGM-MSG-NBR        07780004
077900     MOVE SQLCODE                     TO PC233-SQLCODE            07790004
078000     PERFORM 8210-XCTL-ERROR-SCREEN.                              07800004
078100                                                                  07810004
078200                                                                  07820004
078300 9903-WRITE-CICS-LOG.                                             07830004
078400                                                                  07840004
078500     MOVE SQLCODE                     TO PV-SQLCODE               07850004
078600     MOVE PC233-DOOR-ID               TO PV-DISPLAY-DOOR          07860004
078700     MOVE PC233-USER-ID               TO PV-USER-ID               07870004
078800                                                                  07880004
078900     EXEC CICS                                                    07890004
079000         WRITEQ TD                                                07900004
079100             QUEUE  ('CSSL')                                      07910004
079200             FROM   (PV-LOG-MSG)                                  07920004
079300             RESP   (PV-CICS-RESPONSE)                            07930004
079400     END-EXEC.                                                    07940004
079500                                                                  07950004
079600 9999-WRITE-MESSAGE-TO-CICS-LOG.                                  07960004
079700                                                                  07970004
079800     MOVE PC-CURRENT-PROGRAM-NAME     TO DP013-PROGRAM.           07980004
079900     MOVE DFHEIBLK                    TO DP013-DFHEIBLK.          07990004
080000     INITIALIZE DP013-SRC-TASK-NUMBER                             08000004
080100                DP013-STACK.                                      08010004
080200     SET DP013-LINK-RETURN            TO TRUE.                    08020004
080300                                                                  08030004
080400     EXEC CICS                                                    08040004
080500         LINK                                                     08050004
080600             PROGRAM   (DP013-NAME)                               08060004
080700             COMMAREA  (DP013-PARAMETERS)                         08070004
080800             LENGTH    (DP013-LENGTH)                             08080004
080900     END-EXEC.                                                    08090004
