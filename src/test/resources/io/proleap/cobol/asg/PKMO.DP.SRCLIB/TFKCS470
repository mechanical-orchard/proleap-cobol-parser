      ******************************************************************00010000
      *   CHECK TO SEE IF THIS TRANSACTION WAS TRIGGERED BY THE MQ      00020000
      *   LISTENER.  IF SO, WRITE MESSAGE TO REMOTE QUEUE INSTEAD OF    00030000
      *   TEMPORARY STORAGE QUEUE.                                      00040000
      ******************************************************************00050000
       IDENTIFICATION DIVISION.                                         00060000
      ******************************************************************00070000
                                                                        00080000
       PROGRAM-ID.       TFKCS470.                                      00090001
       AUTHOR.           WILLIAM B. BURT.                               00100000
       INSTALLATION.     KOHLS.                                         00110000
       DATE-WRITTEN      AUGUST, 1996.                                  00120000
       DATE-COMPILED.                                                   00130000
                                                                        00140000
      ******************************************************************00150000
      * THIS PROGRAM RECEIVES FROM AND SENDS DATA STREAMS TO A TELXON   00160000
      * PORTABLE TELE-TRANSACTION COMPUTER (PTC).  THE RECEIVED DATA    00170000
      * IS A REQUEST TO POST DISCREPANCY DATA AND SELECT DETAIL DATA.   00180000
      * THE TRANSMIT DATA IS THE RESPONSE TO THAT REQUEST.              00190000
      ******************************************************************00200000
      *  DATE 01/15/01                                                  00210000
      *  ADD CODE FOR 2ND LISTNER                                       00220000
      *  MADE BY: STEVEN NOWAK            WR/IR #:                      00230000
      ******************************************************************00240000
      *  1/20/2003 - RAY GRAF                                           00241000
      *   PROCESS NONINTELLIGENT SKU.                                   00242000
      ******************************************************************00243000
      * 10/13/2004 - DAVE WELLER          WR/IR #:27349                 00244000
      *   STORE EXPANSION                                               00245000
      ******************************************************************00246000
021605* 02/16/2005 - DAVE WELLER          WR/IR #:27349                 00247000
021605*   STANDARDIZE TFWS007 USAGE                                     00248000
021605******************************************************************00249000
SR3403*  DATE:03/07/2012 JALAJ KUMAR               WR#SR3403            00249100
SR3403*  RECOMPILED THE PROGRAM FOR CHANGES DONE IN TFRD018 COPYBOOK    00249200
SR3403*  AS A PART OF LARGE RETAIL PROJECT                              00249300
SR3403******************************************************************00249400
SR3403*  DATE:04/18/2012 THOMAS HANSON             WR#SR3403            00249501
SR3403*  CREATED TFKCS470 CLONED FROM TFKCS411 SINCE EXISTING KMWS      00249601
SR3403*  IS NOT COMPATIBLE WITH THE LARGE PRICE CHANGES AT THE STORES.  00249701
SR3403*  TRANSACTION P470 REPLACES P411 WITHIN THE RF TRANSFERS SYSTEM. 00249801
SR3403******************************************************************00249901
                                                                        00250001
      ******************************************************************00250101
       ENVIRONMENT DIVISION.                                            00250201
      ******************************************************************00250301
                                                                        00250401
      ******************************************************************00251000
       DATA DIVISION.                                                   00260000
      ******************************************************************00270000
                                                                        00280000
      ******************************************************************00290000
       WORKING-STORAGE SECTION.                                         00300000
      ******************************************************************00310000
                                                                        00320000
      *                                                                 00330000
      *  LISTENER QUEUE NAMES                                           00340000
      *                                                                 00350000
           COPY RFWS001.                                                00360000
                                                                        00370000
      *                                                                 00380000
      *  RECORD LAYOUT BEING TRANSMITTED FROM THE PTC                   00390000
      *                                                                 00400000
           COPY TFRD070.                                                00410001
                                                                        00420000
      *                                                                 00430000
      *  RECORD LAYOUT BEING TRANSMITTED TO THE PTC                     00440000
      *                                                                 00450000
           COPY TFRD071.                                                00460001
                                                                        00470000
      *                                                                 00480000
      *  NISKU WORK AREA                                                00490000
      *                                                                 00500000
           COPY ISWS006.                                                00510000
                                                                        00520000
      *                                                                 00530000
      *  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA                00540000
      *                                                                 00550000
           COPY DPWS013.                                                00560000
                                                                        00570000
      *                                                                 00580000
      *  RECORD LAYOUT FOR SYSTEM MESSAGES FILE USED FOR CICS MESSAGES  00590000
      *                                                                 00600000
           COPY DPRD507I.                                               00610000
                                                                        00620000
      *                                                                 00630000
      *  FORMATS CICS SYSTEM MESSAGES FOR NON-ARCHITECTURE PROGRAMS     00640000
      *                                                                 00650000
           COPY DPWS011.                                                00660000
                                                                        00670000
      *                                                                 00680000
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TRANSFER TABLE     00690000
      *                                                                 00700000
           EXEC SQL                                                     00710000
               INCLUDE TTFMSTR                                          00720000
           END-EXEC.                                                    00730000
                                                                        00740000
      *                                                                 00750000
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TRANSFER ITEM TABLE00760000
      *                                                                 00770000
           EXEC SQL                                                     00780000
               INCLUDE TTFITEM                                          00790000
           END-EXEC.                                                    00800000
                                                                        00810000
      *                                                                 00820000
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TRANSFER ITEM      00830000
      *  RECEIPT TABLE                                                  00840000
      *                                                                 00850000
           EXEC SQL                                                     00860000
               INCLUDE TTFITRC                                          00870000
           END-EXEC.                                                    00880000
                                                                        00890000
      *                                                                 00900000
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TRANSFER ITEM TABLE00910000
      *                                                                 00920000
           EXEC SQL                                                     00930000
               INCLUDE TTFDSCP                                          00940000
           END-EXEC.                                                    00950000
                                                                        00960000
      *                                                                 00970000
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TRANSFER RECEIPT   00980000
      *  TABLE                                                          00990000
      *                                                                 01000000
           EXEC SQL                                                     01010000
               INCLUDE TTFRCPT                                          01020000
           END-EXEC.                                                    01030000
                                                                        01031000
      *                                                                 01032000
      *  SKU CROSS REFERENCE TABLE                                      01033000
      *                                                                 01034000
           EXEC SQL                                                     01035000
               INCLUDE TSKXREF                                          01036000
           END-EXEC.                                                    01037000
                                                                        01038000
      *                                                                 01039000
      *  COMMUNICATIONS AREA FOR DB2                                    01040000
      *                                                                 01050000
           EXEC SQL                                                     01060000
               INCLUDE SQLCA                                            01070000
           END-EXEC.                                                    01080000
                                                                        01090000
       01  WS-MQCONN               PIC X(8)  VALUE 'CSQCCONN'.          01100000
       01  WS-MQOPEN               PIC X(8)  VALUE 'CSQCOPEN'.          01110000
       01  WS-MQINQ                PIC X(8)  VALUE 'CSQCINQ'.           01120000
       01  WS-MQGET                PIC X(8)  VALUE 'CSQCGET'.           01130000
       01  WS-MQPUT1               PIC X(8)  VALUE 'CSQCPUT1'.          01140000
       01  WS-MQPUT                PIC X(8)  VALUE 'CSQCPUT'.           01150000
       01  WS-MQBACK               PIC X(8)  VALUE 'CSQCBACK'.          01160000
       01  WS-MQCMIT               PIC X(8)  VALUE 'CSQCCOMM'.          01170000
       01  WS-MQCLOSE              PIC X(8)  VALUE 'CSQCCLOS'.          01180000
       01  WS-MQDISC               PIC X(8)  VALUE 'CSQCDISC'.          01190000
                                                                        01200000
      *    API CONTROL BLOCKS                                           01210000
                                                                        01220000
       01  MQM-OBJECT-DESCRIPTOR.                                       01230000
           COPY CMQODV.                                                 01240000
       01  MQM-MESSAGE-DESCRIPTOR.                                      01250000
           COPY CMQMDV.                                                 01260000
       01  MQM-GET-MESSAGE-OPTIONS.                                     01270000
           COPY CMQGMOV.                                                01280000
       01  MQM-PUT-MESSAGE-OPTIONS.                                     01290000
           COPY CMQPMOV.                                                01300000
                                                                        01310000
      *    MQV CONTAINS CONSTANTS (FOR FILLING IN THE CONTROL BLOCKS)   01320000
      *    AND RETURN CODES (FOR TESTING THE RESULT OF A CALL)          01330000
                                                                        01340000
       01  MQM-CONSTANTS.                                               01350000
           COPY CMQV.                                                   01360000
      *                                                                 01370000
      **---------------------------------------------------------------*01380000
      **  VARIABLES REQUIRED FOR THE USE OF THE LOG MESSAGE ROUTINE    *01390000
      **  (EPPD000)                                                    *01400000
      **---------------------------------------------------------------*01410000
                                                                        01420000
           COPY EPWS000.                                                01430000
021605     COPY TFWS007.                                                01440000
                                                                        01450000
       01  DK-DB2-KEYS.                                                 01460000
           05  DK-XFER-DKEY-ID                 PIC S9(09)  VALUE ZEROS  01470000
                                                           COMP SYNC.   01480000
      *                                                                 01490000
       01  PC-PROGRAM-CONSTANTS.                                        01500000
           05  PC-NO                           PIC  X(01)  VALUE 'N'.   01510000
           05  PC-ROW-NOT-FOUND                PIC S9(04)  VALUE +100   01520000
                                                           COMP SYNC.   01530000
           05  PC-MAX-RTL-TBL-OCCURS           PIC S9(04)  VALUE +191   01540000
                                                           COMP SYNC.   01550000
           05  PC-MAX-NON-RTL-TBL-OCCURS       PIC S9(04)  VALUE +87    01560000
                                                           COMP SYNC.   01570000
           05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        01580000
               'TFKCS470'.                                              01590001
021605*    COPY TFWS007                                                 01600000
                                                                        01610000
           05  PC-TSYMSG-NUMBERS.                                       01620000
      *  RESOURCE IS UNAVAILABLE; PLEASE TRY AGAIN LATER                01630000
               10  PC-TSYMSG-01063             PIC  9(05)  VALUE  01063.01640000
      *  DATA IS UNAVAILABLE; PLEASE CONTACT THE IS HELP DESK           01650000
               10  PC-TSYMSG-01064             PIC  9(05)  VALUE  01064.01660000
      *  TRANSFER &VAR HAS BEEN RESET                                   01670000
               10  PC-TSYMSG-01582             PIC  9(05)  VALUE  01582.01680000
                                                                        01690000
       01  PH-PROGRAM-HOLD-VARIABLES.                                   01700000
           05  PH-COMPLETION-CODE          PIC  S9(09) BINARY.          01710000
           05  PH-REASON                   PIC  S9(09) BINARY.          01720000
      *                                                                 01730000
       01  PS-PROGRAM-SWITCHES.                                         01740000
           05  PS-DISCREPANCY-IND              PIC  X(01)  VALUE 'N'.   01750000
               88  PS-NO-DISCREPANCY                       VALUE 'N'.   01760000
               88  PS-DISCREPANCY                          VALUE 'Y'.   01770000
           05  PS-END-OF-RTL-DATA-IND          PIC  X(01)  VALUE 'N'.   01780000
               88  PS-MORE-RTL-DATA                        VALUE 'N'.   01790000
               88  PS-END-OF-RTL-DATA                      VALUE 'Y'.   01800000
           05  PS-END-OF-NON-RTL-DATA-IND      PIC  X(01)  VALUE 'N'.   01810000
               88  PS-MORE-NON-RTL-DATA                    VALUE 'N'.   01820000
               88  PS-END-OF-NON-RTL-DATA                  VALUE 'Y'.   01830000
           05  PS-MQPUT-SUCCESSFUL-IND         PIC  X(01)  VALUE 'N'.   01840000
               88 PS-MQPUT-SUCCESSFUL                      VALUE 'Y'.   01850000
      *                                                                 01860000
       01  PV-PROGRAM-VARIABLES.                                        01870000
           05  PV-QMGR-NAME            PIC X(04) VALUE SPACES.          01880000
               88  PV-PROD-QMGR-NAME             VALUE 'QKSP'.          01890000
               88  PV-TEST-QMGR-NAME             VALUE 'QKST'.          01900000
               88  PV-QA-QMGR-NAME               VALUE 'QKSQ'.          01910000
           05  PV-QM-NAME              PIC X(48).                       01920000
           05  PV-HCONN                PIC S9(9) BINARY VALUE 0.        01930000
           05  PV-OPEN-OPTIONS         PIC S9(9) BINARY VALUE 0.        01940000
           05  PV-COMPLETION-CODE      PIC S9(9) BINARY VALUE 0.        01950000
           05  PV-REASON               PIC S9(9) BINARY VALUE 0.        01960000
           05  PV-CON-REASON           PIC S9(9) BINARY VALUE 0.        01970000
           05  PV-PQ-HANDLE            PIC S9(9) BINARY VALUE 0.        01980000
           05  PV-FMT-OPEN-OUTPUT-HNDL PIC S9(9) BINARY VALUE 0.        01990000
           05  PV-ERROR-MESSAGE        PIC X(48)  VALUE SPACES.         02000000
           05  PV-DATA-LENGTH          PIC S9(9) BINARY.                02010000
           05  PV-MSGBUFFER            PIC X(1000000) VALUE SPACES.     02020000
                                                                        02030000
           05  PV-NULL-IND                     PIC S9(04)  VALUE ZEROS  02040000
                                                           COMP SYNC.   02050000
           05  PV-DISPLAY-XFER-DKEY-ID         PIC  9(09)  VALUE ZEROS. 02060000
           05  PV-DISPLAY-XFER-LNE-NBR         PIC  9(04)  VALUE ZEROS. 02070000
           05  PV-DISPLAY-XFER-DOC-NBR-X.                               02080000
               10  PV-DISPLAY-FR-STR-NBR       PIC  9(05)  VALUE ZEROS. 02090000
               10  FILLER                      PIC  X(01)  VALUE '-'.   02100000
               10  PV-DISPLAY-XFER-SEQ-NBR     PIC  9(06)  VALUE ZEROS. 02110000
           05  PV-ITM-DTL-SUB                  PIC  9(04)  VALUE ZEROS. 02120000
           05  PV-COMMON-DATA-LENGTH           PIC  9(03)  VALUE ZEROS. 02130000
           05  PV-TBL-LENGTH                   PIC  9(03)  VALUE ZEROS. 02140000
           05  PV-TOT-REC-LENGTH               PIC  9(04)  VALUE ZEROS. 02150000
           05  PV-FIXED-DATA-LENGTH            PIC  9(02)  VALUE ZEROS. 02160000
           05  PV-ITEM-NBR                     PIC S9(04)  VALUE ZEROS  02170000
                                                           COMP SYNC.   02180000
           05  PV-TSQ-LENGTH                   PIC S9(04)  VALUE ZEROS  02190000
                                                           COMP SYNC.   02200000
           05  PV-TSQ-NAME                     PIC  X(08)  VALUE SPACES.02210000
                                                                        02220000
           05  PV-TCPIPPRQ-RECORD1.                                     02230000
               10  PV-NEXT-RECORD              PIC  9(08)  VALUE ZEROS. 02240000
               10  PV-TOTAL-RECORDS            PIC  9(08)  VALUE ZEROS. 02250000
               10  FILLER                      PIC X(4104) VALUE SPACE. 02260000
           05  PV-TCPIPPRQ-RECORD2.                                     02270000
               10  PV-CURRENT-RECORD           PIC  9(08)  VALUE ZEROS. 02280000
               10  FILLER                      PIC X(4112) VALUE SPACE. 02290000
           05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  02300000
                                                           COMP SYNC.   02310000
                                                                        02320000
      *                                                                 02330000
      *  SQL DB2 RETAIL ITEM DETAIL CURSOR DECLARATION                  02340000
      *                                                                 02350000
           EXEC SQL                                                     02360000
               DECLARE RTL_ITM_DTL_CSR CURSOR FOR                       02370000
                   SELECT  XFER_LNE_NBR,                                02380000
                           XFER_PRIC_AMT,                               02390000
                           XFER_QTY,                                    02400000
                           RNBR_SKU_IND,                                02410000
                           SCN_UPC_NBR,                                 02420000
                           DEPT,                                        02430000
                           CLASS,                                       02440000
                           SUBCLASS                                     02450000
                     FROM  TTFITEM A,                                   02460000
                           TSKXREF B                                    02461000
                    WHERE  XFER_DKEY_ID  =  :DK-XFER-DKEY-ID            02462000
                      AND  A.ITM_NBR     =  B.ITM_NBR                   02463000
                 ORDER BY  XFER_LNE_NBR                                 02464000
                 WITH UR                                                02465000
           END-EXEC.                                                    02466000
                                                                        02467000
      *                                                                 02468000
      *  SQL DB2 NON-RETAIL ITEM DETAIL CURSOR DECLARATION              02469000
      *                                                                 02470000
           EXEC SQL                                                     02480000
               DECLARE NONRTL_ITM_DTL_CSR CURSOR FOR                    02490000
                   SELECT  XFER_LNE_NBR,                                02500000
                           NRTL_1ST_LNE_DESC,                           02510000
                           NRTL_2ND_LNE_DESC,                           02520000
                           XFER_QTY                                     02530000
                     FROM  TTFITEM                                      02540000
                    WHERE  (XFER_DKEY_ID  =  :DK-XFER-DKEY-ID)          02550000
                 ORDER BY  XFER_LNE_NBR                                 02560000
                 WITH UR                                                02570000
           END-EXEC.                                                    02580000
      *                                                                 02590000
      ******************************************************************02600000
       PROCEDURE DIVISION.                                              02610000
      ******************************************************************02620000
       0000-PROGRAM-MAINLINE.                                           02630000
           INITIALIZE TF071-XFER-TO-PTC-RECORD.                         02640001
                                                                        02650000
           PERFORM 1000-RETRIEVE-TEXT.                                  02660000
                                                                        02670000
           PERFORM 2000-PROCESS-PTC-REQUEST.                            02680000
                                                                        02690000
           GOBACK.                                                      02700000
      *                                                                 02710000
       1000-RETRIEVE-TEXT.                                              02720000
           EXEC CICS                                                    02730000
               RETRIEVE                                                 02740000
                   INTO  (TF070-XFER-FROM-PTC-RECORD)                   02750001
                   RESP  (PV-CICS-RESPONSE)                             02760000
           END-EXEC.                                                    02770000
                                                                        02780000
           EVALUATE TRUE                                                02790000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 02800000
                   CONTINUE                                             02810000
               WHEN OTHER                                               02820000
                   MOVE '1000-RETRIEVE-TEXT'                            02830000
                                   TO DP013-PARAGRAPH                   02840000
                   MOVE 'UNABLE TO RECEIVE TEXT'                        02850000
                                   TO DP013-MESSAGE-TEXT (1)            02860000
                   MOVE  TF070-XFER-FROM-PTC-RECORD                     02870001
                                   TO DP013-MESSAGE-TEXT (2)            02880000
                   SET DP013-CICS-ABEND                                 02890000
                       DP013-NO-ROLLBACK                                02900000
                                   TO TRUE                              02910000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      02920000
                   SET  DP011-MSG-FATAL                                 02930000
                                   TO TRUE                              02940000
                   MOVE PC-TSYMSG-01064                                 02950000
                                   TO DP011-MSG-NUMBER                  02960000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      02970000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   02980000
           END-EVALUATE.                                                02990000
                                                                        03000000
                                                                        03010000
           MOVE TF070-LISTENER-CODE                                     03020001
                                   TO PV-QUEUE-PARM.                    03030000
                                                                        03040000
           IF  PV-VALID-PARM                                            03050000
               MOVE PV-QUEUE-NAME(PV-QUEUE-PARM-N)                      03060000
                                   TO PV-TSQ-NAME                       03061000
                                                                        03062000
           ELSE                                                         03063000
               MOVE '1000-RETRIEVE-TEXT'                                03064000
                                   TO DP013-PARAGRAPH                   03065000
               MOVE 'INVALID PARM VALUE'                                03066000
                                   TO DP013-MESSAGE-TEXT (1)            03067000
               MOVE 'PARM VALUE = '                                     03068000
                                   TO DP013-MESSAGE-TEXT (2)            03069000
               MOVE TF070-LISTENER-CODE                                 03070001
                                   TO DP013-MESSAGE-TEXT (3)            03080000
                                                                        03090000
               SET DP013-LOGIC-ABEND                                    03100000
                   DP013-NO-ROLLBACK                                    03110000
                                   TO TRUE                              03120000
                                                                        03130000
               PERFORM 9999-WRITE-CICS-LOG-MSG                          03140000
                                                                        03150000
               SET  DP011-MSG-FATAL                                     03160000
                                   TO TRUE                              03170000
                                                                        03180000
               MOVE PC-TSYMSG-01064                                     03190000
                                   TO DP011-MSG-NUMBER                  03200000
                                                                        03210000
               PERFORM 9000-FMT-ERR-MSG-TO-PTC                          03220000
               PERFORM 8000-SEND-DATA-TO-LISTENER                       03230000
           END-IF.                                                      03240000
                                                                        03250000
                                                                        03260000
      ******************************************************************03270000
      *    DETERMINE WHAT TYPE OF ACTION WAS REQUESTED.                 03280000
      ******************************************************************03290000
       2000-PROCESS-PTC-REQUEST.                                        03300000
                                                                        03310000
           SET  TF071-XFER-NOT-RESET                                    03320001
                TF071-DTL-CHK-NOT-REQ                                   03330001
                TF071-NO-MORE-DATA                                      03340001
                                   TO  TRUE.                            03350000
                                                                        03360000
           PERFORM 7000-SELECT-MAX-RCPT-TMST.                           03370000
                                                                        03380000
           IF PV-NULL-IND NEGATIVE                                      03390000
               PERFORM 7700-SELECT-SEAL-DATA                            03400000
               MOVE TFMSTR-FR-STR-NBR                                   03410000
                                   TO PV-DISPLAY-FR-STR-NBR             03411000
               MOVE TFMSTR-XFER-SEQ-NBR                                 03412000
                                   TO PV-DISPLAY-XFER-SEQ-NBR           03413000
               MOVE PV-DISPLAY-XFER-DOC-NBR-X                           03414000
                                   TO DP011-MSG-TEXT                    03415000
               SET  DP011-MSG-FATAL                                     03416000
                    TF071-XFER-RESET                                    03417001
                                   TO TRUE                              03418000
               MOVE PC-TSYMSG-01582                                     03419000
                                   TO DP011-MSG-NUMBER                  03420000
               PERFORM 9000-FMT-ERR-MSG-TO-PTC                          03430000
               PERFORM 8000-SEND-DATA-TO-LISTENER                       03440000
           END-IF.                                                      03450000
                                                                        03460000
           PERFORM 7100-UPDATE-XFER-RECEIPT.                            03470000
                                                                        03480000
           IF TF070-NBR-OF-OCCURS  =  ZEROS                             03490001
               PERFORM 2100-CHK-FOR-DISCREPANCYS                        03500000
           END-IF.                                                      03510000
                                                                        03520000
021605     IF TF070-XFER-TYP-CDE-X  =  TF007-NON-RETAIL                 03530001
               PERFORM 2200-PROCESS-NON-RTL-XFER                        03540000
           ELSE                                                         03550000
               PERFORM 2300-PROCESS-RTL-XFER                            03560000
           END-IF.                                                      03570000
                                                                        03580000
           PERFORM 8000-SEND-DATA-TO-LISTENER.                          03590000
      *                                                                 03600000
       2100-CHK-FOR-DISCREPANCYS.                                       03610000
           PERFORM 7700-SELECT-SEAL-DATA.                               03620000
                                                                        03630000
           IF (TFMSTR-LG-TTE-1ST-SEAL-ID  =  TF070-LG-TOTE-SEAL-1       03640001
                     AND                                                03650000
               TFMSTR-LG-TTE-2ND-SEAL-ID  =  TF070-LG-TOTE-SEAL-2)      03660001
               CONTINUE                                                 03670000
           ELSE                                                         03680000
               IF (TFMSTR-LG-TTE-1ST-SEAL-ID  =  TF070-LG-TOTE-SEAL-2   03690001
                         AND                                            03700000
                   TFMSTR-LG-TTE-2ND-SEAL-ID  =  TF070-LG-TOTE-SEAL-1)  03710001
                   CONTINUE                                             03720000
               ELSE                                                     03730000
                   SET  PS-DISCREPANCY                                  03740000
                                   TO  TRUE                             03750000
               END-IF                                                   03760000
           END-IF.                                                      03770000
                                                                        03780000
           EVALUATE TRUE                                                03790000
             WHEN TF070-SM-TOTE-BAG-SEAL NOT = TFMSTR-SM-TTE-BAG-SEAL-ID03800001
             WHEN TF070-TRAILER-NBR      NOT = TFMSTR-TRLR-NBR          03810001
             WHEN TF070-TRAILER-SEAL-NBR NOT = TFMSTR-TRLR-SEAL-ID      03820001
                 SET  PS-DISCREPANCY                                    03830000
                                   TO  TRUE                             03840000
           END-EVALUATE.                                                03850000
                                                                        03860000
           IF PS-DISCREPANCY                                            03870000
               PERFORM 7200-UPDATE-DISCREPANCY-ROW                      03880000
               IF SQLCODE = PC-ROW-NOT-FOUND                            03890000
                   PERFORM 7300-INSERT-DISCREPANCY-ROW                  03900000
               END-IF                                                   03910000
               SET  TF071-DTL-CHK-REQ                                   03920001
                                   TO  TRUE                             03930000
           END-IF.                                                      03940000
      *                                                                 03950000
       2200-PROCESS-NON-RTL-XFER.                                       03960000
           PERFORM 2210-OPEN-NONRTL-ITM-DTL-CSR.                        03970000
                                                                        03980000
           IF TF070-NBR-OF-OCCURS  NOT =  ZEROS                         03990001
               PERFORM 7400-FETCH-NONRTL-ITM-DTL-CSR                    04000000
                   WITH TEST AFTER                                      04010000
                   VARYING PV-ITM-DTL-SUB                               04020000
                   FROM    1 BY 1                                       04030000
                   UNTIL   PV-ITM-DTL-SUB  =  TF070-NBR-OF-OCCURS       04040001
           END-IF.                                                      04050000
                                                                        04060000
           PERFORM 7400-FETCH-NONRTL-ITM-DTL-CSR.                       04070000
                                                                        04080000
           PERFORM 2220-FILL-NON-RTL-TBL                                04090000
               VARYING NON-RTL-IDX                                      04100000
               FROM    1 BY 1                                           04110000
               UNTIL   (NON-RTL-IDX > PC-MAX-NON-RTL-TBL-OCCURS         04120000
                  OR    PS-END-OF-NON-RTL-DATA).                        04130000
                                                                        04140000
           IF PS-MORE-NON-RTL-DATA                                      04150000
               SET TF071-MORE-DATA TO  TRUE                             04160001
           END-IF.                                                      04170000
                                                                        04180000
           PERFORM 2230-CLOSE-NONRTL-ITM-DTL-CSR.                       04190000
      *                                                                 04200000
       2210-OPEN-NONRTL-ITM-DTL-CSR.                                    04210000
           EXEC SQL                                                     04220000
               OPEN NONRTL_ITM_DTL_CSR                                  04230000
           END-EXEC.                                                    04240000
                                                                        04250000
           EVALUATE SQLCODE                                             04260000
               WHEN ZERO                                                04270000
                   CONTINUE                                             04271000
               WHEN OTHER                                               04272000
                   MOVE '2210-OPEN-NONRTL-ITM-DTL-CSR'                  04273000
                                   TO DP013-PARAGRAPH                   04274000
                   MOVE 'OPEN THE NONRTL_ITM_DTL_CSR CURSOR'            04275000
                                   TO DP013-MESSAGE-TEXT (1)            04276000
                   MOVE SQLCA      TO DP013-SQLCA                       04277000
                   MOVE 'TTFITEM'  TO DP013-DB2-TABLE-NAME (1)          04278000
                   SET DP013-DB2-ABEND                                  04279000
                       DP013-ROLLBACK                                   04280000
                                   TO TRUE                              04290000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      04300000
                   SET  DP011-MSG-FATAL                                 04310000
                                   TO TRUE                              04320000
                   MOVE PC-TSYMSG-01064                                 04330000
                                   TO DP011-MSG-NUMBER                  04340000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      04350000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   04360000
           END-EVALUATE.                                                04370000
      *                                                                 04380000
       2220-FILL-NON-RTL-TBL.                                           04390000
           MOVE TFITEM-XFER-LNE-NBR                                     04400000
                                   TO TF071-NON-RTL-LINE-NBR            04410001
                                          (NON-RTL-IDX).                04420000
           MOVE TFITEM-XFER-QTY                                         04430000
                                   TO TF071-NON-RTL-XFER-QTY            04440001
                                          (NON-RTL-IDX).                04450000
           MOVE TFITEM-NRTL-1ST-LNE-DESC                                04460000
                                   TO TF071-ITM-DESC-LN1                04470001
                                          (NON-RTL-IDX).                04480000
           MOVE TFITEM-NRTL-2ND-LNE-DESC                                04490000
                                   TO TF071-ITM-DESC-LN2                04500001
                                          (NON-RTL-IDX).                04510000
           MOVE ZEROS              TO  TFITRC-RCVD-XFER-PRIC-AMT.       04520000
                                                                        04530000
           ADD 1                   TO TF071-NBR-OF-OCCURS.              04540001
                                                                        04550000
           PERFORM 7600-INSERT-ITM-RCPT.                                04560000
                                                                        04570000
           PERFORM 7400-FETCH-NONRTL-ITM-DTL-CSR.                       04580000
      *                                                                 04590000
       2230-CLOSE-NONRTL-ITM-DTL-CSR.                                   04600000
           EXEC SQL                                                     04610000
               CLOSE NONRTL_ITM_DTL_CSR                                 04620000
           END-EXEC.                                                    04630000
                                                                        04640000
           EVALUATE SQLCODE                                             04650000
               WHEN ZERO                                                04660000
                   CONTINUE                                             04670000
               WHEN OTHER                                               04680000
                   MOVE '2230-CLOSE-NONRTL-ITM-DTL-CSR'                 04690000
                                   TO DP013-PARAGRAPH                   04700000
                   MOVE 'CLOSE THE NONRTL_ITM_DTL_CSR CURSOR'           04710000
                                   TO DP013-MESSAGE-TEXT (1)            04720000
                   MOVE SQLCA      TO DP013-SQLCA                       04730000
                   MOVE 'TTFITEM'  TO DP013-DB2-TABLE-NAME (1)          04740000
                   SET DP013-DB2-ABEND                                  04750000
                       DP013-ROLLBACK                                   04760000
                                   TO TRUE                              04770000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      04780000
                   SET  DP011-MSG-FATAL                                 04790000
                                   TO TRUE                              04800000
                   MOVE PC-TSYMSG-01064                                 04810000
                                   TO DP011-MSG-NUMBER                  04820000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      04830000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   04840000
           END-EVALUATE.                                                04850000
      *                                                                 04860000
       2300-PROCESS-RTL-XFER.                                           04870000
           PERFORM 2310-OPEN-RTL-ITM-DTL-CSR.                           04880000
                                                                        04890000
           IF TF070-NBR-OF-OCCURS  NOT =  ZEROS                         04900001
               PERFORM 7500-FETCH-RTL-ITM-DTL-CSR                       04910000
                   WITH TEST AFTER                                      04920000
                   VARYING PV-ITM-DTL-SUB                               04930000
                   FROM    1 BY 1                                       04940000
                   UNTIL   PV-ITM-DTL-SUB  =  TF070-NBR-OF-OCCURS       04950001
           END-IF.                                                      04960000
                                                                        04970000
           PERFORM 7500-FETCH-RTL-ITM-DTL-CSR.                          04980000
                                                                        04990000
           PERFORM 2320-FILL-RTL-TBL                                    05000000
               VARYING RTL-IDX                                          05010000
               FROM    1 BY 1                                           05020000
               UNTIL   (RTL-IDX > PC-MAX-RTL-TBL-OCCURS                 05030000
                  OR    PS-END-OF-RTL-DATA).                            05040000
                                                                        05050000
           IF PS-MORE-RTL-DATA                                          05060000
               SET  TF071-MORE-DATA                                     05070001
                                   TO  TRUE                             05080000
           END-IF.                                                      05090000
                                                                        05100000
           PERFORM 2330-CLOSE-RTL-ITM-DTL-CSR.                          05110000
      *                                                                 05120000
       2310-OPEN-RTL-ITM-DTL-CSR.                                       05130000
           EXEC SQL                                                     05140000
               OPEN RTL_ITM_DTL_CSR                                     05150000
           END-EXEC.                                                    05160000
                                                                        05170000
           EVALUATE SQLCODE                                             05180000
               WHEN ZERO                                                05190000
                   CONTINUE                                             05200000
               WHEN OTHER                                               05210000
                   MOVE '2310-OPEN-RTL-ITM-DTL-CSR'                     05220000
                                   TO DP013-PARAGRAPH                   05230000
                   MOVE 'OPEN THE RTL_ITM_DTL_CSR CURSOR'               05240000
                                   TO DP013-MESSAGE-TEXT (1)            05250000
                   MOVE SQLCA      TO DP013-SQLCA                       05260000
                   MOVE 'TTFITEM'  TO DP013-DB2-TABLE-NAME (1)          05270000
                   SET DP013-DB2-ABEND                                  05280000
                       DP013-ROLLBACK                                   05290000
                                   TO TRUE                              05300000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      05310000
                   SET  DP011-MSG-FATAL                                 05320000
                                   TO TRUE                              05330000
                   MOVE PC-TSYMSG-01064                                 05340000
                                   TO DP011-MSG-NUMBER                  05350000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      05360000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   05370000
           END-EVALUATE.                                                05380000
      *                                                                 05390000
       2320-FILL-RTL-TBL.                                               05400000
           MOVE TFITEM-XFER-LNE-NBR                                     05410000
                                   TO TF071-RTL-LINE-NBR (RTL-IDX).     05420001
           COMPUTE TF071-TKT-PRICE (RTL-IDX)  =                         05430001
                TFITEM-XFER-PRIC-AMT  *  100.                           05440000
           MOVE TFITEM-XFER-QTY                                         05450000
                                   TO TF071-RTL-XFER-QTY (RTL-IDX).     05460001
           MOVE TFITEM-RNBR-SKU-IND                                     05470000
                                   TO TF071-SKU-RENUM-IND (RTL-IDX).    05480001
           MOVE TFITEM-XFER-PRIC-AMT                                    05490000
                                   TO TFITRC-RCVD-XFER-PRIC-AMT.        05500000
           MOVE TFITEM-SCN-UPC-NBR TO TF071-UPC-NBR (RTL-IDX).          05510001
           MOVE SKXREF-DEPT        TO TF071-DEPT (RTL-IDX).             05520001
           MOVE SKXREF-CLASS       TO TF071-CLASS (RTL-IDX).            05530001
           MOVE SKXREF-SUBCLASS    TO TF071-SUBCLASS (RTL-IDX).         05540001
                                                                        05550000
           ADD 1                   TO TF071-NBR-OF-OCCURS.              05560001
                                                                        05570000
           PERFORM 7600-INSERT-ITM-RCPT.                                05580000
                                                                        05590000
           PERFORM 7500-FETCH-RTL-ITM-DTL-CSR.                          05600000
      *                                                                 05610000
       2330-CLOSE-RTL-ITM-DTL-CSR.                                      05620000
           EXEC SQL                                                     05630000
               CLOSE RTL_ITM_DTL_CSR                                    05640000
           END-EXEC.                                                    05650000
                                                                        05660000
           EVALUATE SQLCODE                                             05670000
               WHEN ZERO                                                05680000
                   CONTINUE                                             05690000
               WHEN OTHER                                               05700000
                   MOVE '2330-CLOSE-RTL-ITM-DTL-CSR'                    05710000
                                   TO DP013-PARAGRAPH                   05720000
                   MOVE 'CLOSE THE RTL_ITM_DTL_CSR CURSOR'              05730000
                                   TO DP013-MESSAGE-TEXT (1)            05740000
                   MOVE SQLCA      TO DP013-SQLCA                       05750000
                   MOVE 'TTFITEM'  TO DP013-DB2-TABLE-NAME (1)          05760000
                   SET DP013-DB2-ABEND                                  05770000
                       DP013-ROLLBACK                                   05780000
                                   TO TRUE                              05790000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      05800000
                   SET  DP011-MSG-FATAL                                 05810000
                                   TO TRUE                              05820000
                   MOVE PC-TSYMSG-01064                                 05830000
                                   TO DP011-MSG-NUMBER                  05840000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      05850000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   05860000
           END-EVALUATE.                                                05870000
      *                                                                 05880000
       7000-SELECT-MAX-RCPT-TMST.                                       05890000
           MOVE TF070-XFER-DKEY    TO  DK-XFER-DKEY-ID.                 05900001
                                                                        05910000
           EXEC SQL                                                     05920000
               SELECT  MAX(RCV_XFER_BEG_TMST)                           05930000
                 INTO  :TFRCPT-RCV-XFER-BEG-TMST                        05940000
                           :PV-NULL-IND                                 05950000
                 FROM  TTFRCPT                                          05960000
                WHERE  (XFER_DKEY_ID       =  :DK-XFER-DKEY-ID          05970000
                  AND   RCV_XFER_BEG_TMST  =  RCV_XFER_END_TMST)        05980000
                WITH UR                                                 05990000
           END-EXEC.                                                    06000000
                                                                        06010000
           EVALUATE SQLCODE                                             06020000
               WHEN ZERO                                                06030000
                   CONTINUE                                             06031000
               WHEN -904                                                06032000
               WHEN -913                                                06033000
                   SET  DP011-MSG-FATAL                                 06034000
                                   TO TRUE                              06035000
                   MOVE PC-TSYMSG-01063                                 06036000
                                   TO DP011-MSG-NUMBER                  06037000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      06038000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   06039000
               WHEN OTHER                                               06040000
                   MOVE '7000-SELECT-MAX-RCPT-TMST'                     06050000
                                   TO DP013-PARAGRAPH                   06060000
                   MOVE 'SELECT MAX TIMESTAMP FOR XFER_DKEY_ID: '       06070000
                                   TO DP013-MESSAGE-TEXT (1)            06080000
                   MOVE DK-XFER-DKEY-ID                                 06090000
                                   TO PV-DISPLAY-XFER-DKEY-ID           06100000
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         06110000
                                   TO DP013-MESSAGE-TEXT (2)            06120000
                   MOVE SQLCA      TO DP013-SQLCA                       06130000
                   MOVE 'TTFRCPT'  TO DP013-DB2-TABLE-NAME (1)          06140000
                   SET DP013-DB2-ABEND                                  06150000
                       DP013-NO-ROLLBACK                                06160000
                                   TO TRUE                              06170000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      06180000
                   SET  DP011-MSG-FATAL                                 06190000
                                   TO TRUE                              06200000
                   MOVE PC-TSYMSG-01064                                 06210000
                                   TO DP011-MSG-NUMBER                  06220000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      06230000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   06240000
           END-EVALUATE.                                                06250000
      *                                                                 06260000
       7100-UPDATE-XFER-RECEIPT.                                        06270000
           EXEC SQL                                                     06280000
               UPDATE  TTFRCPT                                          06290000
                  SET  RCVR_INIT_1ST_NM   = :TF070-RECEIVED-BY-1ST-INIT,06300001
                       RCVR_LAST_NM       = :TF070-RECEIVED-BY-LAST-NAME06310001
                WHERE  (XFER_DKEY_ID      = :DK-XFER-DKEY-ID            06320000
                  AND   RCV_XFER_BEG_TMST = :TFRCPT-RCV-XFER-BEG-TMST)  06330000
           END-EXEC.                                                    06340000
                                                                        06350000
           EVALUATE SQLCODE                                             06360000
               WHEN ZERO                                                06370000
                   CONTINUE                                             06380000
               WHEN -904                                                06390000
               WHEN -913                                                06400000
                   SET  DP011-MSG-FATAL                                 06410000
                                   TO TRUE                              06420000
                   MOVE PC-TSYMSG-01063                                 06430000
                                   TO DP011-MSG-NUMBER                  06440000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      06450000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   06460000
               WHEN OTHER                                               06470000
                   MOVE '7100-UPDATE-XFER-RECEIPT'                      06480000
                                   TO DP013-PARAGRAPH                   06490000
                   MOVE 'UPDATE RECEIVED BY DATA FOR XFER_DKEY_ID/RCV_XF06500000
      -                 'ER_BEG_TMST: '                                 06510000
                                   TO DP013-MESSAGE-TEXT (1)            06520000
                   MOVE DK-XFER-DKEY-ID                                 06530000
                                   TO PV-DISPLAY-XFER-DKEY-ID           06540000
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         06550000
                                   TO DP013-MESSAGE-TEXT (2)            06560000
                   MOVE TFRCPT-RCV-XFER-BEG-TMST                        06570000
                                   TO DP013-MESSAGE-TEXT (3)            06580000
                   MOVE SQLCA      TO DP013-SQLCA                       06590000
                   MOVE 'TTFRCPT'  TO DP013-DB2-TABLE-NAME (1)          06600000
                   SET DP013-DB2-ABEND                                  06610000
                       DP013-NO-ROLLBACK                                06620000
                                   TO TRUE                              06630000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      06640000
                   SET  DP011-MSG-FATAL                                 06650000
                                   TO TRUE                              06660000
                   MOVE PC-TSYMSG-01064                                 06670000
                                   TO DP011-MSG-NUMBER                  06671000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      06672000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   06673000
           END-EVALUATE.                                                06674000
      *                                                                 06675000
       7200-UPDATE-DISCREPANCY-ROW.                                     06676000
           EXEC SQL                                                     06677000
               UPDATE  TTFDSCP                                          06678000
                  SET  LG_TTE_1ST_SEAL_ID  =  :TF070-LG-TOTE-SEAL-1,    06679001
                       LG_TTE_2ND_SEAL_ID  =  :TF070-LG-TOTE-SEAL-2,    06680001
                       SM_TTE_BG_SEAL_ID   =  :TF070-SM-TOTE-BAG-SEAL,  06690001
                       TRLR_NBR            =  :TF070-TRAILER-NBR,       06700001
                       TRLR_SEAL_ID        =  :TF070-TRAILER-SEAL-NBR   06710001
                WHERE  (XFER_DKEY_ID       =  :DK-XFER-DKEY-ID          06720000
                  AND   RCV_XFER_BEG_TMST  =  :TFRCPT-RCV-XFER-BEG-TMST)06730000
           END-EXEC.                                                    06740000
                                                                        06750000
           EVALUATE SQLCODE                                             06760000
               WHEN ZERO                                                06770000
                   CONTINUE                                             06780000
               WHEN +100                                                06790000
                   CONTINUE                                             06800000
               WHEN -904                                                06810000
               WHEN -913                                                06820000
                   SET  DP011-MSG-FATAL                                 06830000
                                   TO TRUE                              06840000
                   MOVE PC-TSYMSG-01063                                 06850000
                                   TO DP011-MSG-NUMBER                  06860000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      06870000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   06880000
               WHEN OTHER                                               06890000
                   MOVE '7200-UPDATE-DISCREPANCY-ROW'                   06900000
                                   TO DP013-PARAGRAPH                   06910000
                   MOVE 'UPDATE DISCREPANCY DATA FOR XFER_DKEY_ID/RCV_XF06920000
      -                 'ER_BEG_TMST: '                                 06930000
                                   TO DP013-MESSAGE-TEXT (1)            06940000
                   MOVE DK-XFER-DKEY-ID                                 06950000
                                   TO PV-DISPLAY-XFER-DKEY-ID           06960000
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         06970000
                                   TO DP013-MESSAGE-TEXT (2)            06980000
                   MOVE TFRCPT-RCV-XFER-BEG-TMST                        06990000
                                   TO DP013-MESSAGE-TEXT (3)            07000000
                   MOVE SQLCA      TO DP013-SQLCA                       07010000
                   MOVE 'TTFDSCP'  TO DP013-DB2-TABLE-NAME (1)          07020000
                   SET DP013-DB2-ABEND                                  07030000
                       DP013-ROLLBACK                                   07040000
                                   TO TRUE                              07050000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      07060000
                   SET  DP011-MSG-FATAL                                 07070000
                                   TO TRUE                              07080000
                   IF (SQLCODE = -904  OR  SQLCODE = -913)              07090000
                       MOVE PC-TSYMSG-01063                             07100000
                                   TO DP011-MSG-NUMBER                  07110000
                   ELSE                                                 07120000
                       MOVE PC-TSYMSG-01064                             07130000
                                   TO DP011-MSG-NUMBER                  07140000
                   END-IF                                               07150000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      07160000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   07170000
           END-EVALUATE.                                                07180000
      *                                                                 07190000
       7300-INSERT-DISCREPANCY-ROW.                                     07200000
           EXEC SQL                                                     07210000
               INSERT INTO TTFDSCP                                      07220000
                   (XFER_DKEY_ID,                                       07230000
                    RCV_XFER_BEG_TMST,                                  07240000
                    RCVD_AT_STR_NBR,                                    07250000
                    LG_TTE_1ST_SEAL_ID,                                 07260000
                    LG_TTE_2ND_SEAL_ID,                                 07270000
                    SM_TTE_BG_SEAL_ID,                                  07280000
                    TRLR_NBR,                                           07290000
                    TRLR_SEAL_ID)                                       07300000
               VALUES                                                   07310000
                   (:DK-XFER-DKEY-ID,                                   07320000
                    :TFRCPT-RCV-XFER-BEG-TMST,                          07330000
                    :TFDSCP-RCVD-AT-STR-NBR,                            07340000
                    :TF070-LG-TOTE-SEAL-1,                              07350001
                    :TF070-LG-TOTE-SEAL-2,                              07360001
                    :TF070-SM-TOTE-BAG-SEAL,                            07370001
                    :TF070-TRAILER-NBR,                                 07380001
                    :TF070-TRAILER-SEAL-NBR)                            07390001
           END-EXEC.                                                    07400000
                                                                        07410000
           EVALUATE SQLCODE                                             07420000
               WHEN ZERO                                                07430000
                   CONTINUE                                             07440000
               WHEN -904                                                07450000
               WHEN -913                                                07460000
                   SET  DP011-MSG-FATAL                                 07470000
                                   TO TRUE                              07480000
                   MOVE PC-TSYMSG-01063                                 07490000
                                   TO DP011-MSG-NUMBER                  07500000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      07510000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   07520000
               WHEN OTHER                                               07530000
                   MOVE '7300-INSERT-DISCREPANCY-ROW'                   07540000
                                   TO DP013-PARAGRAPH                   07550000
                   MOVE 'INSERT DISCREPANCY ROW FOR XFER_DKEY_ID/RCV_XFE07560000
      -                 'R_BEG_TMST: '                                  07570000
                                   TO DP013-MESSAGE-TEXT (1)            07580000
                   MOVE DK-XFER-DKEY-ID                                 07590000
                                   TO PV-DISPLAY-XFER-DKEY-ID           07600000
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         07610000
                                   TO DP013-MESSAGE-TEXT (2)            07620000
                   MOVE TFRCPT-RCV-XFER-BEG-TMST                        07630000
                                   TO DP013-MESSAGE-TEXT (3)            07640000
                   MOVE SQLCA      TO DP013-SQLCA                       07650000
                   MOVE 'TTFDSCP'  TO DP013-DB2-TABLE-NAME (1)          07660000
                   SET DP013-DB2-ABEND                                  07670000
                       DP013-ROLLBACK                                   07680000
                                   TO TRUE                              07681000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      07682000
                   SET  DP011-MSG-FATAL                                 07683000
                                   TO TRUE                              07684000
                   IF (SQLCODE = -904  OR  SQLCODE = -913)              07685000
                       MOVE PC-TSYMSG-01063                             07686000
                                   TO DP011-MSG-NUMBER                  07687000
                   ELSE                                                 07688000
                       MOVE PC-TSYMSG-01064                             07689000
                                   TO DP011-MSG-NUMBER                  07690000
                   END-IF                                               07700000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      07710000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   07720000
           END-EVALUATE.                                                07730000
      *                                                                 07740000
       7400-FETCH-NONRTL-ITM-DTL-CSR.                                   07750000
           INITIALIZE DCLTTFITEM.                                       07760000
                                                                        07770000
           EXEC SQL                                                     07780000
               FETCH  NONRTL_ITM_DTL_CSR                                07790000
                INTO  :TFITEM-XFER-LNE-NBR,                             07800000
                      :TFITEM-NRTL-1ST-LNE-DESC,                        07810000
                      :TFITEM-NRTL-2ND-LNE-DESC,                        07820000
                      :TFITEM-XFER-QTY                                  07830000
           END-EXEC.                                                    07840000
                                                                        07850000
           EVALUATE SQLCODE                                             07860000
               WHEN ZERO                                                07870000
                   CONTINUE                                             07880000
               WHEN +100                                                07890000
                   SET PS-END-OF-NON-RTL-DATA                           07900000
                                   TO TRUE                              07910000
               WHEN -904                                                07920000
               WHEN -913                                                07930000
                   SET  DP011-MSG-FATAL                                 07940000
                                   TO TRUE                              07950000
                   MOVE PC-TSYMSG-01063                                 07960000
                                   TO DP011-MSG-NUMBER                  07970000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      07980000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   07990000
               WHEN OTHER                                               08000000
                   MOVE '7400-FETCH-NONRTL-ITM-DTL-CSR'                 08010000
                                   TO DP013-PARAGRAPH                   08020000
                   MOVE 'FETCH NONRTL_ITM_DTL_CSR'                      08030000
                                   TO DP013-MESSAGE-TEXT (1)            08040000
                   MOVE SQLCA      TO DP013-SQLCA                       08050000
                   MOVE 'TTFITEM'  TO DP013-DB2-TABLE-NAME (1)          08060000
                   SET DP013-DB2-ABEND                                  08070000
                       DP013-ROLLBACK                                   08080000
                                   TO TRUE                              08090000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      08100000
                   SET  DP011-MSG-FATAL                                 08110000
                                   TO TRUE                              08120000
                   IF (SQLCODE = -904  OR  SQLCODE = -913)              08130000
                       MOVE PC-TSYMSG-01063                             08140000
                                   TO DP011-MSG-NUMBER                  08150000
                   ELSE                                                 08160000
                       MOVE PC-TSYMSG-01064                             08170000
                                   TO DP011-MSG-NUMBER                  08180000
                   END-IF                                               08190000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      08200000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   08210000
           END-EVALUATE.                                                08220000
      *                                                                 08230000
       7500-FETCH-RTL-ITM-DTL-CSR.                                      08240000
           INITIALIZE DCLTTFITEM.                                       08250000
                                                                        08260000
           EXEC SQL                                                     08270000
               FETCH  RTL_ITM_DTL_CSR                                   08280000
                INTO  :TFITEM-XFER-LNE-NBR,                             08290000
                      :TFITEM-XFER-PRIC-AMT,                            08300000
                      :TFITEM-XFER-QTY,                                 08310000
                      :TFITEM-RNBR-SKU-IND,                             08320000
                      :TFITEM-SCN-UPC-NBR,                              08330000
                      :SKXREF-DEPT,                                     08340000
                      :SKXREF-CLASS,                                    08350000
                      :SKXREF-SUBCLASS                                  08360000
           END-EXEC.                                                    08370000
                                                                        08380000
           EVALUATE SQLCODE                                             08390000
               WHEN ZERO                                                08400000
                   CONTINUE                                             08400100
               WHEN +100                                                08400200
                   SET PS-END-OF-RTL-DATA                               08400300
                                   TO TRUE                              08400400
               WHEN -904                                                08400500
               WHEN -913                                                08400600
                   SET  DP011-MSG-FATAL                                 08400700
                                   TO TRUE                              08400800
                   MOVE PC-TSYMSG-01063                                 08400900
                                   TO DP011-MSG-NUMBER                  08401000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      08402000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   08403000
               WHEN OTHER                                               08404000
                   MOVE '7500-FETCH-RTL-ITM-DTL-CSR'                    08405000
                                   TO DP013-PARAGRAPH                   08406000
                   MOVE 'FETCH RTL_ITM_DTL_CSR'                         08407000
                                   TO DP013-MESSAGE-TEXT (1)            08408000
                   MOVE SQLCA      TO DP013-SQLCA                       08409000
                   MOVE 'TTFITEM'  TO DP013-DB2-TABLE-NAME (1)          08410000
                   SET DP013-DB2-ABEND                                  08420000
                       DP013-ROLLBACK                                   08430000
                                   TO TRUE                              08440000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      08450000
                   SET  DP011-MSG-FATAL                                 08460000
                                   TO TRUE                              08470000
                   IF (SQLCODE = -904  OR  SQLCODE = -913)              08480000
                       MOVE PC-TSYMSG-01063                             08490000
                                   TO DP011-MSG-NUMBER                  08500000
                   ELSE                                                 08510000
                       MOVE PC-TSYMSG-01064                             08520000
                                   TO DP011-MSG-NUMBER                  08530000
                   END-IF                                               08540000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      08550000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   08560000
           END-EVALUATE.                                                08570000
      *                                                                 08580000
       7600-INSERT-ITM-RCPT.                                            08590000
           EXEC SQL                                                     08600000
               INSERT INTO TTFITRC                                      08610000
                   (XFER_DKEY_ID,                                       08620000
                    XFER_LNE_NBR,                                       08630000
                    XFER_LNE_SEQ_NBR,                                   08640000
                    XFER_RCPT_TMST,                                     08650000
                    RCVD_XFER_PRIC_AMT,                                 08660000
                    XFER_ITM_DSCRP_IND)                                 08670000
               VALUES                                                   08680000
                   (:DK-XFER-DKEY-ID,                                   08690000
                    :TFITEM-XFER-LNE-NBR,                               08700000
                    1,                                                  08710000
                    :TFRCPT-RCV-XFER-BEG-TMST,                          08720000
                    :TFITRC-RCVD-XFER-PRIC-AMT,                         08730000
                    :PC-NO)                                             08740000
           END-EXEC.                                                    08750000
                                                                        08760000
           EVALUATE SQLCODE                                             08770000
               WHEN ZERO                                                08780000
                   CONTINUE                                             08790000
               WHEN -904                                                08800000
               WHEN -913                                                08810000
                   SET  DP011-MSG-FATAL                                 08820000
                                   TO TRUE                              08830000
                   MOVE PC-TSYMSG-01063                                 08840000
                                   TO DP011-MSG-NUMBER                  08850000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      08860000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   08870000
               WHEN OTHER                                               08880000
                   MOVE '7600-INSERT-ITM-RCPT'                          08890000
                                   TO DP013-PARAGRAPH                   08900000
                   MOVE 'INSERT ITEM RECEIPT FOR XFER_DKEY_ID/XFER_LNE_N08910000
      -                 'BR/XFER_RCPT_TMST: '                           08920000
                                   TO DP013-MESSAGE-TEXT (1)            08930000
                   MOVE DK-XFER-DKEY-ID                                 08940000
                                   TO PV-DISPLAY-XFER-DKEY-ID           08950000
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         08960000
                                   TO DP013-MESSAGE-TEXT (2)            08970000
                   MOVE TFITEM-XFER-LNE-NBR                             08980000
                                   TO PV-DISPLAY-XFER-LNE-NBR           08990000
                   MOVE PV-DISPLAY-XFER-LNE-NBR                         09000000
                                   TO DP013-MESSAGE-TEXT (3)            09010000
                   MOVE TFRCPT-RCV-XFER-BEG-TMST                        09020000
                                   TO DP013-MESSAGE-TEXT (4)            09030000
                   MOVE SQLCA      TO DP013-SQLCA                       09040000
                   MOVE 'TTFITRC'  TO DP013-DB2-TABLE-NAME (1)          09050000
                   SET DP013-DB2-ABEND                                  09060000
                       DP013-ROLLBACK                                   09070000
                                   TO TRUE                              09080000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      09090000
                   SET  DP011-MSG-FATAL                                 09100000
                                   TO TRUE                              09110000
                   IF (SQLCODE = -904  OR  SQLCODE = -913)              09120000
                       MOVE PC-TSYMSG-01063                             09130000
                                   TO DP011-MSG-NUMBER                  09140000
                   ELSE                                                 09150000
                       MOVE PC-TSYMSG-01064                             09160000
                                   TO DP011-MSG-NUMBER                  09170000
                   END-IF                                               09180000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      09190000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   09200000
           END-EVALUATE.                                                09210000
      *                                                                 09220000
       7700-SELECT-SEAL-DATA.                                           09230000
           INITIALIZE DCLTTFMSTR.                                       09240000
                                                                        09250000
           EXEC SQL                                                     09260000
               SELECT  FR_STR_NBR,                                      09270000
                       XFER_SEQ_NBR,                                    09280000
                       LG_TTE_1ST_SEAL_ID,                              09290000
                       LG_TTE_2ND_SEAL_ID,                              09300000
                       SM_TTE_BAG_SEAL_ID,                              09310000
                       TRLR_NBR,                                        09320000
                       TRLR_SEAL_ID                                     09330000
                 INTO  :TFMSTR-FR-STR-NBR,                              09340000
                       :TFMSTR-XFER-SEQ-NBR,                            09350000
                       :TFMSTR-LG-TTE-1ST-SEAL-ID,                      09360000
                       :TFMSTR-LG-TTE-2ND-SEAL-ID,                      09370000
                       :TFMSTR-SM-TTE-BAG-SEAL-ID,                      09380000
                       :TFMSTR-TRLR-NBR,                                09390000
                       :TFMSTR-TRLR-SEAL-ID                             09400000
                 FROM  TTFMSTR                                          09410000
                WHERE  (XFER_DKEY_ID  =  :DK-XFER-DKEY-ID)              09420000
                WITH UR                                                 09430000
           END-EXEC.                                                    09440000
                                                                        09450000
           EVALUATE SQLCODE                                             09460000
               WHEN ZERO                                                09470000
                   CONTINUE                                             09480000
               WHEN -904                                                09490000
               WHEN -913                                                09500000
                   SET  DP011-MSG-FATAL                                 09510000
                                   TO TRUE                              09520000
                   MOVE PC-TSYMSG-01063                                 09530000
                                   TO DP011-MSG-NUMBER                  09540000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      09550000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   09560000
               WHEN OTHER                                               09570000
                   MOVE '7700-SELECT-SEAL-DATA'                         09580000
                                   TO DP013-PARAGRAPH                   09590000
                   MOVE 'SELECT TOTE/TRAILER SEAL DATA FOR XFER_DKEY_ID:09600000
      -                 ' '        TO DP013-MESSAGE-TEXT (1)            09610000
                   MOVE DK-XFER-DKEY-ID                                 09620000
                                   TO PV-DISPLAY-XFER-DKEY-ID           09630000
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         09640000
                                   TO DP013-MESSAGE-TEXT (2)            09650000
                   MOVE SQLCA      TO DP013-SQLCA                       09660000
                   MOVE 'TTFMSTR'  TO DP013-DB2-TABLE-NAME (1)          09670000
                   SET DP013-DB2-ABEND                                  09680000
                       DP013-ROLLBACK                                   09690000
                                   TO TRUE                              09700000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      09710000
                   SET  DP011-MSG-FATAL                                 09720000
                                   TO TRUE                              09730000
                   IF (SQLCODE = -904  OR  SQLCODE = -913)              09740000
                       MOVE PC-TSYMSG-01063                             09750000
                                   TO DP011-MSG-NUMBER                  09760000
                   ELSE                                                 09770000
                       MOVE PC-TSYMSG-01064                             09780000
                                   TO DP011-MSG-NUMBER                  09790000
                   END-IF                                               09800000
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      09810000
                   PERFORM 8000-SEND-DATA-TO-LISTENER                   09820000
           END-EVALUATE.                                                09830000
      *                                                                 09840000
      ******************************************************************09850000
      *  CONNECT TO SOCKET WHICH WAS GIVEN TO US BY THE AL/SYSTEMS PTC  09860000
      *  PROGRAM.  CONNECT THE PATH (SOCKET).                           09870000
      ******************************************************************09880000
       8000-SEND-DATA-TO-LISTENER.                                      09890000
           IF TF070-MQ-INDICATOR-Y                                      09900001
               PERFORM 8500-MQ-SETUP                                    09910000
               PERFORM 8510-MQ-SETUP-REMOTE                             09920000
               PERFORM 8520-PUT-QUEUE                                   09930000
               PERFORM 8600-CLOSE-PUT-Q                                 09940000
               PERFORM 8610-DISCONNECT-QMGR                             09950000
               PERFORM 9100-EXEC-CICS-RETURN                            09960000
           ELSE                                                         09970000
               PERFORM 8110-ENQ-TCPIPPRQ                                09980000
               PERFORM 8120-READQ-TCPIPPRQ-RECORD1                      09990000
               PERFORM 8130-READQ-TCPIPPRQ-RECORD2                      10000000
                                                                        10010000
      *MUST BE HERE                                                     10020000
               PERFORM 8140-REWRITE-TCPIPPRQ-NEXT-REC                   10030000
      *MUST BE HERE                                                     10040000
               ADD 1               TO PV-NEXT-RECORD                    10050000
                                                                        10060000
               IF PV-NEXT-RECORD > PV-TOTAL-RECORDS                     10070000
                   MOVE 3          TO PV-NEXT-RECORD                    10080000
               END-IF                                                   10090000
                                                                        10100000
               PERFORM 8150-REWRITE-TCPIPPRQ-RECORD1                    10110000
               PERFORM 8160-DEQ-TCPIPPRQ                                10120000
                                                                        10130000
               PERFORM 9100-EXEC-CICS-RETURN                            10140000
           END-IF.                                                      10150000
      *                                                                 10160000
      ******************************************************************10170000
       8110-ENQ-TCPIPPRQ.                                               10180000
           EXEC CICS                                                    10190000
               ENQ                                                      10200000
                   RESOURCE  (PV-TSQ-NAME)                              10210000
                   RESP      (PV-CICS-RESPONSE)                         10220000
           END-EXEC.                                                    10230000
                                                                        10240000
           EVALUATE TRUE                                                10250000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 10260000
                   CONTINUE                                             10270000
               WHEN OTHER                                               10280000
                   MOVE '8110-ENQ-TCPIPPRQ'                             10290000
                                   TO DP013-PARAGRAPH                   10300000
                   MOVE 'UNABLE TO ENQ THE FOLLOWING TEMPORARY STORAGE Q10310000
      -                 'UEUE: '                                        10320000
                                   TO DP013-MESSAGE-TEXT (1)            10330000
                   MOVE PV-TSQ-NAME                                     10340000
                                   TO DP013-MESSAGE-TEXT (2)            10350000
                   SET DP013-CICS-ABEND                                 10360000
                       DP013-NO-ROLLBACK                                10370000
                                   TO TRUE                              10371000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      10372000
                   PERFORM 9100-EXEC-CICS-RETURN                        10373000
           END-EVALUATE.                                                10374000
      *                                                                 10375000
      ******************************************************************10376000
       8120-READQ-TCPIPPRQ-RECORD1.                                     10377000
           MOVE LENGTH OF PV-TCPIPPRQ-RECORD1                           10378000
                                   TO PV-TSQ-LENGTH.                    10379000
                                                                        10380000
           EXEC CICS                                                    10390000
               READQ TS                                                 10400000
                   QUEUE   (PV-TSQ-NAME)                                10410000
                   INTO    (PV-TCPIPPRQ-RECORD1)                        10420000
                   LENGTH  (PV-TSQ-LENGTH)                              10430000
                   ITEM    (1)                                          10440000
                   RESP    (PV-CICS-RESPONSE)                           10450000
           END-EXEC.                                                    10460000
                                                                        10470000
           EVALUATE TRUE                                                10480000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 10490000
                   CONTINUE                                             10500000
               WHEN OTHER                                               10510000
                   MOVE '8120-READQ-TCPIPPRQ-RECORD1'                   10520000
                                   TO DP013-PARAGRAPH                   10530000
                   MOVE 'UNABLE TO READ THE FOLLOWING TEMPORARY STORAGE 10540000
      -                 'QUEUE: '                                       10550000
                                   TO DP013-MESSAGE-TEXT (1)            10560000
                   MOVE PV-TSQ-NAME                                     10570000
                                   TO DP013-MESSAGE-TEXT (2)            10580000
                   SET DP013-CICS-ABEND                                 10590000
                       DP013-NO-ROLLBACK                                10600000
                                   TO TRUE                              10610000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      10620000
                   PERFORM 9100-EXEC-CICS-RETURN                        10630000
           END-EVALUATE.                                                10640000
      *                                                                 10650000
      ******************************************************************10660000
       8130-READQ-TCPIPPRQ-RECORD2.                                     10670000
           MOVE LENGTH OF PV-TCPIPPRQ-RECORD2                           10680000
                                   TO PV-TSQ-LENGTH.                    10690000
                                                                        10700000
           EXEC CICS                                                    10710000
               READQ TS                                                 10720000
                   QUEUE   (PV-TSQ-NAME)                                10730000
                   INTO    (PV-TCPIPPRQ-RECORD2)                        10740000
                   LENGTH  (PV-TSQ-LENGTH)                              10750000
                   ITEM    (2)                                          10760000
                   RESP    (PV-CICS-RESPONSE)                           10770000
           END-EXEC.                                                    10780000
                                                                        10790000
           EVALUATE TRUE                                                10800000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 10810000
                   CONTINUE                                             10820000
               WHEN OTHER                                               10830000
                   MOVE '8130-READQ-TCPIPPRQ-RECORD2'                   10840000
                                   TO DP013-PARAGRAPH                   10850000
                   MOVE 'UNABLE TO READ THE FOLLOWING TEMPORARY STORAGE 10860000
      -                 'QUEUE: '                                       10870000
                                   TO DP013-MESSAGE-TEXT (1)            10880000
                   MOVE PV-TSQ-NAME                                     10890000
                                   TO DP013-MESSAGE-TEXT (2)            10900000
                   SET DP013-CICS-ABEND                                 10910000
                       DP013-NO-ROLLBACK                                10920000
                                   TO TRUE                              10930000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      10940000
                   PERFORM 9100-EXEC-CICS-RETURN                        10950000
           END-EVALUATE.                                                10960000
      *                                                                 10970000
      ******************************************************************10980000
       8140-REWRITE-TCPIPPRQ-NEXT-REC.                                  10990000
                                                                        11000000
           MOVE LENGTH OF TF071-XFER-TO-PTC-FIXED-DATA                  11010001
                                   TO  PV-FIXED-DATA-LENGTH.            11020000
                                                                        11030000
021605     IF TF070-XFER-TYP-CDE-X  =  TF007-NON-RETAIL                 11040001
               MOVE LENGTH OF TF071-NON-RTL-TBL                         11050001
                                   TO  PV-TBL-LENGTH                    11060000
           ELSE                                                         11070000
               MOVE LENGTH OF TF071-RTL-TBL                             11080001
                                   TO  PV-TBL-LENGTH                    11090000
           END-IF.                                                      11100000
                                                                        11110000
           COMPUTE PV-TOT-REC-LENGTH  =                                 11120000
                                                                        11130000
               (TF071-NBR-OF-OCCURS * PV-TBL-LENGTH)  +                 11140001
                PV-FIXED-DATA-LENGTH.                                   11150000
                                                                        11160000
           MOVE PV-TOT-REC-LENGTH  TO  TF071-TOT-REC-LENGTH.            11170001
           MOVE TF070-MATCHING-NBR-FIELD                                11180001
                                   TO  TF071-MATCHING-NBR-FIELD.        11190001
           MOVE PV-NEXT-RECORD     TO  PV-ITEM-NBR.                     11200000
                                                                        11210000
           EXEC CICS                                                    11220000
               WRITEQ TS                                                11230000
                   QUEUE   (PV-TSQ-NAME)                                11240000
                   FROM    (TF071-XFER-TO-PTC-RECORD)                   11250001
                   LENGTH  (PV-TSQ-LENGTH)                              11260000
                   ITEM    (PV-ITEM-NBR)                                11270000
                       REWRITE                                          11280000
                   RESP    (PV-CICS-RESPONSE)                           11290000
           END-EXEC.                                                    11300000
                                                                        11310000
           EVALUATE TRUE                                                11320000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 11330000
                   CONTINUE                                             11340000
               WHEN OTHER                                               11350000
                   MOVE '8140-REWRITE-TCPIPPRQ-NEXT-REC'                11360000
                                   TO DP013-PARAGRAPH                   11370000
                   MOVE 'UNABLE TO REWRITE THE FOLLOWING TEMPORARY STORA11380000
      -                 'STORAGE QUEUE: '                               11390000
                                   TO DP013-MESSAGE-TEXT (1)            11400000
                   MOVE PV-TSQ-NAME                                     11410000
                                   TO DP013-MESSAGE-TEXT (2)            11420000
                   SET DP013-CICS-ABEND                                 11430000
                       DP013-NO-ROLLBACK                                11440000
                                   TO TRUE                              11441000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      11442000
                   PERFORM 9100-EXEC-CICS-RETURN                        11443000
           END-EVALUATE.                                                11444000
      *                                                                 11445000
      ******************************************************************11446000
       8150-REWRITE-TCPIPPRQ-RECORD1.                                   11447000
           MOVE LENGTH OF PV-TCPIPPRQ-RECORD1                           11448000
                                   TO PV-TSQ-LENGTH.                    11449000
           MOVE +1                 TO PV-ITEM-NBR.                      11450000
                                                                        11460000
           EXEC CICS                                                    11470000
               WRITEQ TS                                                11480000
                   QUEUE   (PV-TSQ-NAME)                                11490000
                   FROM    (PV-TCPIPPRQ-RECORD1)                        11500000
                   LENGTH  (PV-TSQ-LENGTH)                              11510000
                   ITEM    (PV-ITEM-NBR)                                11520000
                       REWRITE                                          11530000
                   RESP    (PV-CICS-RESPONSE)                           11540000
           END-EXEC.                                                    11550000
                                                                        11560000
           EVALUATE TRUE                                                11570000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 11580000
                   CONTINUE                                             11590000
               WHEN OTHER                                               11600000
                   MOVE '8150-REWRITE-TCPIPPRQ-RECORD1'                 11610000
                                   TO DP013-PARAGRAPH                   11620000
                   MOVE 'UNABLE TO REWRITE A RECORD TO THE FOLLOWING'   11630000
                                   TO DP013-MESSAGE-TEXT (1)            11640000
                   MOVE 'TEMPORARY STORAGE QUEUE: '                     11650000
                                   TO DP013-MESSAGE-TEXT (2)            11660000
                   MOVE PV-TSQ-NAME                                     11670000
                                   TO DP013-MESSAGE-TEXT (3)            11680000
                   MOVE PV-TCPIPPRQ-RECORD1                             11690000
                                   TO DP013-MESSAGE-TEXT (4)            11700000
                   SET DP013-CICS-ABEND                                 11710000
                       DP013-NO-ROLLBACK                                11720000
                                   TO TRUE                              11730000
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      11740000
                   PERFORM 9100-EXEC-CICS-RETURN                        11750000
           END-EVALUATE.                                                11760000
      *                                                                 11770000
      ******************************************************************11780000
       8160-DEQ-TCPIPPRQ.                                               11790000
           EXEC CICS                                                    11800000
               DEQ                                                      11810000
                   RESOURCE  (PV-TSQ-NAME)                              11820000
                   RESP      (PV-CICS-RESPONSE)                         11830000
           END-EXEC.                                                    11840000
                                                                        11850000
           EVALUATE TRUE                                                11860000
               WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 11870000
                   CONTINUE                                             11880000
               WHEN OTHER                                               11890000
                   MOVE '8160-DEQ-TCPIPPRQ'                             11900000
                                   TO DP013-PARAGRAPH                   11910000
                   MOVE 'UNABLE TO DEQ THE FOLLOWING TEMPORARY STORAGE Q11920000
      -                 'UEUE: '                                        11930000
                                   TO DP013-MESSAGE-TEXT (1)            11940000
                   MOVE PV-TSQ-NAME                                     11950000
                                   TO DP013-MESSAGE-TEXT (2)            11960000
                   SET DP013-CICS-ABEND                                 11970000
                       DP013-NO-ROLLBACK                                11980000
                                   TO TRUE                              11990000
                 PERFORM 9999-WRITE-CICS-LOG-MSG                        12000000
                 PERFORM 9100-EXEC-CICS-RETURN                          12010000
           END-EVALUATE.                                                12020000
                                                                        12030000
       8500-MQ-SETUP.                                                   12040000
                                                                        12050000
      * DETERMINE THE SYSTEM                                            12060000
                                                                        12070000
           PERFORM EP000-0000-INITIALIZE.                               12080000
           IF EP000-PV-KOHLS-PROD-SYSTEM                                12090000
               SET PV-PROD-QMGR-NAME                                    12100000
                                   TO TRUE                              12110000
           ELSE                                                         12120000
               IF EP000-PV-KOHLS-QA-SYSTEM                              12130000
                   SET PV-QA-QMGR-NAME                                  12140000
                                   TO TRUE                              12141000
               ELSE                                                     12142000
                   SET PV-TEST-QMGR-NAME                                12143000
                                   TO TRUE                              12144000
               END-IF                                                   12145000
           END-IF.                                                      12146000
                                                                        12147000
      ***************************************************************   12148000
      *    CONNECT TO THE QUEUE MANAGER                                 12149000
      ***************************************************************   12150000
                                                                        12160000
           MOVE PV-QMGR-NAME       TO PV-QM-NAME.                       12170000
           CALL WS-MQCONN USING PV-QM-NAME                              12180000
                                PV-HCONN                                12190000
                                PV-COMPLETION-CODE                      12200000
                                PV-REASON.                              12210000
                                                                        12220000
      ***************************************************************   12230000
      *    IF CONNECTION FAILED THEN DISPLAY ERROR MESSAGE              12240000
      *    AND EXIT                                                     12250000
      ***************************************************************   12260000
                                                                        12270000
           MOVE PV-REASON          TO PV-CON-REASON.                    12280000
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   12290000
               MOVE 'MQCONN ERROR' TO PV-ERROR-MESSAGE                  12300000
               MOVE '8500-MQ-SETUP'                                     12310000
                                   TO DP013-PARAGRAPH                   12320000
               MOVE  PV-ERROR-MESSAGE                                   12330000
                                   TO DP013-MESSAGE-TEXT (1)            12340000
               MOVE  PV-COMPLETION-CODE                                 12350000
                                   TO DP013-MESSAGE-TEXT (2)            12360000
               MOVE  PV-REASON     TO DP013-MESSAGE-TEXT (3)            12370000
               SET DP013-CICS-ABEND                                     12380000
                   DP013-NO-ROLLBACK                                    12390000
                                   TO TRUE                              12400000
               PERFORM 9999-WRITE-CICS-LOG-MSG                          12410000
               PERFORM 9100-EXEC-CICS-RETURN                            12420000
           END-IF.                                                      12430000
                                                                        12440000
                                                                        12450000
       8510-MQ-SETUP-REMOTE.                                            12460000
      ***************************************************************   12470000
      *    OPEN THE RF.RESPONSE.Q QUEUE FOR OUTPUT.                     12480000
      *    THIS IS A REMOTE QUEUE.                                      12490000
      ***************************************************************   12500000
                                                                        12510000
           COMPUTE PV-OPEN-OPTIONS = MQOO-OUTPUT +                      12520000
                                     MQOO-FAIL-IF-QUIESCING.            12530000
                                                                        12540000
           MOVE TF070-REPLYTOQ     TO MQOD-OBJECTNAME.                  12550001
           MOVE TF070-REPLYTOQMGR  TO MQOD-OBJECTQMGRNAME.              12560001
                                                                        12570000
           CALL WS-MQOPEN USING PV-HCONN                                12580000
                                MQM-OBJECT-DESCRIPTOR                   12590000
                                PV-OPEN-OPTIONS                         12600000
                                PV-PQ-HANDLE                            12610000
                                PV-COMPLETION-CODE                      12620000
                                PV-REASON.                              12630000
                                                                        12640000
      ********************************************************          12650000
      *    IF OPEN FAILED THEN DISPLAY ERROR MESSAGE                    12660000
      *    AND EXIT.                                                    12670000
      ********************************************************          12680000
      *                                                                 12690000
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   12700000
               PERFORM 8600-CLOSE-PUT-Q                                 12710000
               PERFORM 8610-DISCONNECT-QMGR                             12720000
               MOVE 'MQOPEN WRITE Q'                                    12730000
                                   TO PV-ERROR-MESSAGE                  12740000
               MOVE '8510-MQ-SETUP-REMOTE'                              12750000
                                   TO DP013-PARAGRAPH                   12760000
               MOVE  PV-ERROR-MESSAGE                                   12770000
                                   TO DP013-MESSAGE-TEXT (1)            12780000
               MOVE  PV-COMPLETION-CODE                                 12790000
                                   TO DP013-MESSAGE-TEXT (2)            12800000
               MOVE  PV-REASON     TO DP013-MESSAGE-TEXT (3)            12810000
               SET DP013-CICS-ABEND                                     12820000
                   DP013-NO-ROLLBACK                                    12830000
                                   TO TRUE                              12831000
               PERFORM 9999-WRITE-CICS-LOG-MSG                          12832000
               PERFORM 9100-EXEC-CICS-RETURN                            12833000
           END-IF.                                                      12834000
           MOVE PV-PQ-HANDLE       TO PV-FMT-OPEN-OUTPUT-HNDL.          12835000
      *                                                                 12836000
      ******************************************************************12837000
       8520-PUT-QUEUE.                                                  12838000
           MOVE TF070-REPLYTOQMGR  TO MQOD-OBJECTQMGRNAME.              12839001
           MOVE TF070-REPLYTOQ     TO MQOD-OBJECTNAME.                  12840001
           MOVE TF070-MSGID        TO MQMD-CORRELID.                    12850001
           MOVE MQMI-NONE          TO MQMD-MSGID.                       12860000
           MOVE MQFMT-STRING       TO MQMD-FORMAT.                      12870000
           MOVE 5000               TO MQMD-EXPIRY.                      12880000
           MOVE LENGTH OF TF071-XFER-TO-PTC-RECORD                      12890001
                                   TO PV-DATA-LENGTH.                   12900000
           MOVE TF071-XFER-TO-PTC-RECORD                                12910001
                                   TO PV-MSGBUFFER.                     12920000
           MOVE MQPER-PERSISTENT   TO MQMD-PERSISTENCE.                 12930000
                                                                        12940000
           COMPUTE MQPMO-CONTEXT  =  PV-PQ-HANDLE.                      12950000
                                                                        12960000
                                                                        12970000
                                                                        12980000
           CALL WS-MQPUT USING PV-HCONN                                 12990000
                               PV-FMT-OPEN-OUTPUT-HNDL                  13000000
                               MQM-MESSAGE-DESCRIPTOR                   13010000
                               MQM-PUT-MESSAGE-OPTIONS                  13020000
                               PV-DATA-LENGTH                           13030000
                               PV-MSGBUFFER                             13040000
                               PV-COMPLETION-CODE                       13050000
                               PV-REASON.                               13060000
                                                                        13070000
      ***********************************************************       13080000
      *        IF PUT FAILED THEN DISPLAY ERROR MESSAGE                 13090000
      *        AND BREAK OUT OF LOOP                                    13100000
      ***********************************************************       13110000
                                                                        13120000
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   13130000
               MOVE PV-COMPLETION-CODE                                  13140000
                                   TO PH-COMPLETION-CODE                13150000
               MOVE PV-REASON      TO PH-REASON                         13160000
               PERFORM 8600-CLOSE-PUT-Q                                 13170000
               PERFORM 8610-DISCONNECT-QMGR                             13180000
               MOVE 'MQPUT ERR'    TO PV-ERROR-MESSAGE                  13190000
               MOVE '8520-PUT-QUEUE'                                    13200000
                                   TO DP013-PARAGRAPH                   13210000
               MOVE PV-ERROR-MESSAGE                                    13220000
                                   TO DP013-MESSAGE-TEXT (1)            13230000
               MOVE PH-COMPLETION-CODE                                  13240000
                                   TO DP013-MESSAGE-TEXT (2)            13250000
               MOVE PH-REASON      TO DP013-MESSAGE-TEXT (3)            13260000
               SET DP013-CICS-ABEND                                     13270000
                   DP013-NO-ROLLBACK                                    13280000
                                   TO TRUE                              13290000
               PERFORM 9999-WRITE-CICS-LOG-MSG                          13300000
               PERFORM 9100-EXEC-CICS-RETURN                            13310000
           ELSE                                                         13320000
               SET PS-MQPUT-SUCCESSFUL                                  13330000
                                   TO TRUE                              13340000
           END-IF.                                                      13350000
      *                                                                 13360000
      ******************************************************************13370000
       8600-CLOSE-PUT-Q.                                                13380000
           CALL WS-MQCLOSE USING PV-HCONN                               13390000
                                 PV-PQ-HANDLE                           13400000
                                 MQCO-NONE                              13410000
                                 PV-COMPLETION-CODE                     13420000
                                 PV-REASON.                             13430000
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   13440000
               MOVE 'MQCLOSE PQ HANDLE'                                 13450000
                                   TO PV-ERROR-MESSAGE                  13460000
               MOVE '8600-CLOSE-PUT-Q'                                  13470000
                                   TO DP013-PARAGRAPH                   13471000
               MOVE  PV-ERROR-MESSAGE                                   13472000
                                   TO DP013-MESSAGE-TEXT (1)            13473000
               MOVE  PV-COMPLETION-CODE                                 13474000
                                   TO DP013-MESSAGE-TEXT (2)            13475000
               MOVE  PV-REASON     TO DP013-MESSAGE-TEXT (3)            13476000
               SET DP013-CICS-ABEND                                     13477000
                   DP013-NO-ROLLBACK                                    13478000
                                   TO TRUE                              13479000
               PERFORM 9999-WRITE-CICS-LOG-MSG                          13480000
               PERFORM 9100-EXEC-CICS-RETURN                            13490000
           END-IF.                                                      13500000
      *                                                                 13510000
      ******************************************************************13520000
       8610-DISCONNECT-QMGR.                                            13530000
                                                                        13540000
           IF PV-CON-REASON IS NOT EQUAL TO MQRC-ALREADY-CONNECTED      13550000
              CALL WS-MQDISC USING PV-HCONN                             13560000
                                   PV-COMPLETION-CODE                   13570000
                                   PV-REASON                            13580000
              IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                13590000
                  MOVE 'MQDISC'    TO PV-ERROR-MESSAGE                  13600000
                  MOVE '8610-DISCONNECT'                                13610000
                                   TO DP013-PARAGRAPH                   13620000
                  MOVE PV-ERROR-MESSAGE                                 13630000
                                   TO DP013-MESSAGE-TEXT (1)            13640000
                  MOVE PV-COMPLETION-CODE                               13650000
                                   TO DP013-MESSAGE-TEXT (2)            13660000
                  MOVE PV-REASON   TO DP013-MESSAGE-TEXT (3)            13670000
                  SET DP013-CICS-ABEND                                  13680000
                      DP013-NO-ROLLBACK                                 13690000
                                   TO TRUE                              13700000
                  PERFORM 9999-WRITE-CICS-LOG-MSG                       13710000
                  PERFORM 9100-EXEC-CICS-RETURN                         13720000
              END-IF                                                    13730000
           END-IF.                                                      13740000
                                                                        13750000
      *                                                                 13760000
      ******************************************************************13770000
      *    LINK TO THE MESSAGE FORMAT SUB-ROUTINE FOR NON-CICS          13780000
      *    ARCHITECTURE PROGRAMS.  THIS MESSAGE IS PASSED IN THE DATA   13790000
      *    STREAM BEING SENT BACK TO THE PTC.                           13800000
      ******************************************************************13810000
       9000-FMT-ERR-MSG-TO-PTC.                                         13820000
           PERFORM DP011-0000-FORMAT-MSG-LINES.                         13830000
           MOVE DP011-MSG-LEVEL    TO  TF071-ERR-TYP-IND.               13840001
           MOVE DP011-MSG-TEXT     TO  TF071-ERR-MSG.                   13850001
      *                                                                 13860000
       9100-EXEC-CICS-RETURN.                                           13870000
           EXEC CICS                                                    13880000
               RETURN                                                   13890000
           END-EXEC.                                                    13900000
      *                                                                 13910000
       9999-WRITE-CICS-LOG-MSG.                                         13920000
           MOVE PC-CURRENT-PROGRAM-NAME                                 13930000
                                   TO  DP013-PROGRAM.                   13940000
           MOVE DFHEIBLK           TO  DP013-DFHEIBLK.                  13950000
                                                                        13960000
           INITIALIZE DP013-SRC-TASK-NUMBER                             13970000
                      DP013-STACK.                                      13980000
                                                                        13990000
           SET DP013-LINK-RETURN   TO  TRUE.                            14000000
                                                                        14010000
           EXEC CICS                                                    14020000
               LINK                                                     14030000
                   PROGRAM   (DP013-NAME)                               14040000
                   COMMAREA  (DP013-PARAMETERS)                         14050000
                   LENGTH    (DP013-LENGTH)                             14060000
           END-EXEC.                                                    14070000
                                                                        14080000
      *                                                                 14090000
      *    NON-CICS ARCHITECTURE SYSTEM MESSAGE FORMAT MODULE           14100000
      *                                                                 14110000
                                                                        14120000
           COPY DPPD011.                                                14130000
      *                                                                 14140000
      *    NON-CICS ARCHITECTURE ABEND ROUTINE CALL                     14150000
      *                                                                 14160000
                                                                        14170000
           COPY DPPD014.                                                14180000
                                                                        14190000
           COPY EPPD000.                                                14200000
