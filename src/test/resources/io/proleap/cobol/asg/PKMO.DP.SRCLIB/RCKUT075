000100*-----------------------------*                                   00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------------*                                   00030000
000400 PROGRAM-ID.    RCKUT075.                                         00040005
000500 AUTHOR.        JOHN HUTCHINSON                                   00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  4/24/2003.                                        00070000
000800*--------------------------------------------------------------*  00080000
000900*  THIS PROGRAM WILL READ THE RECEIPTS EXTRACT FILE CREATED BY *  00090000
001000*  RCKUT074, AND CREATE A NEW EXTRACT BASED ON INFORMATION IN  *  00100014
001100*  THE CONTROL CARD.                                           *  00110000
001200*                                                              *  00120000
001300*  CONTROL CARD WILL CONTAIN DATE/TYPE CODE FOR EXTRACT        *  00130000
001400*                                                              *  00140000
001500*  VALID DATE CODES ARE: AR=USE ARRIVED DATE                   *  00150000
001600*                        VE=USE VERIFIED DATE                  *  00160000
001700*                                                              *  00170000
001800*  VALID TYPE CODES ARE:  P=USE PERIOD NUMBER                  *  00180000
001900*                         Q=USE QUARTER NUMBER                 *  00190000
002000*--------------------------------------------------------------*  00200000
002100                                                                  00210000
002200                                                                  00220000
002300*-----------------------------*                                   00230000
002400 ENVIRONMENT DIVISION.                                            00240000
002500*-----------------------------*                                   00250000
002600                                                                  00260000
002700 INPUT-OUTPUT SECTION.                                            00270000
002800                                                                  00280000
002900 FILE-CONTROL.                                                    00290000
003000                                                                  00300000
003100     SELECT DATE-FILE          ASSIGN TO UT-S-IN01.               00310000
003200                                                                  00320000
003300     SELECT EXTRACT-FILE-IN    ASSIGN TO UT-S-IN02.               00330019
003400                                                                  00340000
003500     SELECT EXTRACT-FILE-OUT   ASSIGN TO UT-S-OUT01.              00350019
003600                                                                  00360000
003700                                                                  00370000
003800*-----------------------------*                                   00380000
003900 DATA DIVISION.                                                   00390000
004000*-----------------------------*                                   00400000
004100                                                                  00410000
004200 FILE SECTION.                                                    00420000
004300                                                                  00430000
004400 FD  DATE-FILE                                                    00440000
004500     RECORDING MODE IS F                                          00450000
004600     LABEL RECORDS ARE STANDARD                                   00460000
004700     RECORD CONTAINS 80                                           00470000
004800     BLOCK CONTAINS 0 RECORDS.                                    00480000
004900                                                                  00490000
005000 01  DATE-RECORD                 PIC X(80).                       00500000
005100                                                                  00510000
005200                                                                  00520004
005300* -------------------------------------------- *                  00530004
005400                                                                  00540000
005500                                                                  00550004
005600 FD  EXTRACT-FILE-IN                                              00560019
005700     RECORDING MODE IS F                                          00570000
005800     LABEL RECORDS ARE STANDARD                                   00580000
005900     RECORD CONTAINS 400                                          00590007
006000     BLOCK CONTAINS 0 RECORDS.                                    00600000
006100                                                                  00610000
006200 01  EXTRACT-RECORD              PIC X(400).                      00620007
006300                                                                  00630000
006400                                                                  00640004
006500* -------------------------------------------- *                  00650004
006600                                                                  00660004
006700                                                                  00670004
006800 FD  EXTRACT-FILE-OUT                                             00680019
006900     RECORDING MODE IS F                                          00690000
007000     LABEL RECORDS ARE STANDARD                                   00700000
007100     RECORD CONTAINS 400                                          00710007
007200     BLOCK CONTAINS 0 RECORDS.                                    00720001
007300                                                                  00730000
007400 01  NEW-EXTRACT-RECORD          PIC  X(400).                     00740007
007500                                                                  00750000
007600                                                                  00760000
007700*-----------------------------*                                   00770000
007800 WORKING-STORAGE SECTION.                                         00780000
007900*-----------------------------*                                   00790000
008000                                                                  00800008
008100 01  PS-PROGRAM-SWITCHES.                                         00810008
008200     05  PS-EXTRACT-SW           PIC  X(01) VALUE 'N'.            00820008
008300         88  PS-EXTRACT-EOF-YES             VALUE 'Y'.            00830009
008400         88  PS-EXTRACT-EOF-NO              VALUE 'Y'.            00840009
008500                                                                  00850015
008600 01  PV-PROGRAM-VARIABLES.                                        00860015
008700     05  PV-EXTRACT-READ         PIC  9(09) VALUE ZEROS.          00870015
008800     05  PV-EXTRACT-BYPASSED     PIC  9(09) VALUE ZEROS.          00880015
008900     05  PV-EXTRACT-WRITTEN      PIC  9(09) VALUE ZEROS.          00890015
009000     05  PV-DISPLAY-COUNT        PIC  ZZZ,ZZZ,ZZ9.                00900015
009100                                                                  00910008
009200 01  PV-ABEND-FIELDS.                                             00920000
009300     05  PV-ABEND-CODE           PIC S9(04) VALUE +0 COMP.        00930004
009400     05  PV-ABEND-PROGRAM        PIC  X(08) VALUE 'RCKUT075'.     00940005
009500     05  PV-ABEND-PARAGRAPH      PIC  X(50) VALUE SPACES.         00950004
009600     05  PV-ABEND-MESSAGE-1      PIC  X(60) VALUE SPACES.         00960004
009700     05  PV-ABEND-MESSAGE-2      PIC  X(60) VALUE SPACES.         00970004
009800                                                                  00980018
009900                                                                  00990018
010000 01  CC-CONTROL-CARD-PARAMETERS.                                  01000018
010100     05  CC-EXTRACT-DATE         PIC  X(02) VALUE SPACES.         01010018
010200         88  CC-VALID-DATE                  VALUE 'AR' 'VE' 'BT'. 01020018
010300         88  CC-ARRIVED-DATE-EXTRACT        VALUE 'AR'.           01030018
010400         88  CC-VERIFYD-DATE-EXTRACT        VALUE 'VE'.           01040018
010500         88  CC-BOTH-DATE-EXTRACT           VALUE 'BT'.           01050018
010600     05  FILLER                  PIC  X(01) VALUE SPACE.          01060018
010700     05  CC-EXTRACT-TYPE         PIC  X(01) VALUE SPACE.          01070018
010800         88  CC-VALID-TYPE                  VALUE 'P' 'Q'.        01080018
010900         88  CC-PERIOD-NUMBER               VALUE 'P'.            01090018
011000         88  CC-QUARTER-NUMBER              VALUE 'Q'.            01100018
011100     05  FILLER                  PIC  X(76) VALUE SPACE.          01110018
011200                                                                  01120018
011300                                                                  01130018
011400* -------------------------------------------------------------- *01140018
011500*    INPUT DATE RECORD                                           *01150018
011600* -------------------------------------------------------------- *01160018
011700                                                                  01170018
011800     COPY RCRD067.                                                01180018
011900                                                                  01190018
012000                                                                  01200018
012100* -------------------------------------------------------------- *01210018
012200*    COPYBOOK USED IN CREATING EXTRACT FILE.                     *01220018
012300* -------------------------------------------------------------- *01230018
012400                                                                  01240018
012500     COPY RCRD065.                                                01250000
012600                                                                  01260000
012700                                                                  01270000
012800*--------------------------*                                      01280003
012900 PROCEDURE DIVISION.                                              01290000
013000*--------------------------*                                      01300003
013100                                                                  01310000
013200     PERFORM 1000-INITIALIZATION.                                 01320000
013300                                                                  01330000
013400     PERFORM 2000-PROCESS-EXTRACTS                                01340000
013500       UNTIL PS-EXTRACT-EOF-YES.                                  01350010
013600                                                                  01360000
013700     CLOSE DATE-FILE                                              01370000
013800           EXTRACT-FILE-IN                                        01380019
013900           EXTRACT-FILE-OUT.                                      01390019
014000                                                                  01400000
014100     MOVE PV-EXTRACT-READ  TO  PV-DISPLAY-COUNT.                  01410009
014200                                                                  01420018
014300     DISPLAY 'NBR OF EXTRACT RECORDS READ    : ' PV-DISPLAY-COUNT.01430009
014400                                                                  01440002
014500     MOVE PV-EXTRACT-BYPASSED TO PV-DISPLAY-COUNT.                01450003
014600                                                                  01460002
014700     DISPLAY 'NBR OF EXTRACT RECORDS BYPASSED: ' PV-DISPLAY-COUNT.01470009
014800                                                                  01480002
014900     MOVE PV-EXTRACT-WRITTEN  TO PV-DISPLAY-COUNT.                01490003
015000                                                                  01500002
015100     DISPLAY 'NBR OF EXTRACT RECORDS WRITTEN : ' PV-DISPLAY-COUNT.01510009
015200     DISPLAY '                                      '.            01520000
015300     DISPLAY '--------------------------------------'.            01530000
015400                                                                  01540000
015500                                                                  01550009
015600 PROGRAM-EXIT.                                                    01560009
015700     GOBACK.                                                      01570000
015800                                                                  01580000
015900                                                                  01590000
016000*-------------------------------------------------------------    01600006
016100*-------------------------------------------------------------    01610006
016200                                                                  01620006
016300 1000-INITIALIZATION.                                             01630000
016400                                                                  01640000
016500     OPEN INPUT  DATE-FILE                                        01650000
016600                 EXTRACT-FILE-IN                                  01660019
016700         OUTPUT  EXTRACT-FILE-OUT.                                01670019
016800                                                                  01680000
016900     ACCEPT CC-CONTROL-CARD-PARAMETERS FROM SYSIN.                01690000
017000                                                                  01700000
017100     DISPLAY '--------------------------------------'.            01710000
017200     DISPLAY '-        PROGRAM - RCKUT075          -'.            01720005
017300     DISPLAY '--------------------------------------'.            01730000
017400     DISPLAY '                                      '.            01740000
017500                                                                  01750000
017600     DISPLAY 'CONTROL CARD SET-UP FOR THIS RUN IS:  '             01760000
017700             CC-CONTROL-CARD-PARAMETERS.                          01770000
017800                                                                  01780000
017900     PERFORM 1100-CHECK-CC-PARAMETERS.                            01790000
018000                                                                  01800000
018100     PERFORM 7000-READ-DATE.                                      01810000
018200                                                                  01820000
018300     PERFORM 7100-READ-EXTRACT.                                   01830000
018400                                                                  01840000
018500                                                                  01850000
018600*----------------------------------------------------------------*01860009
018700*    CHECK THAT A VALID DATE HAS BEEN REQUESTED ('AR' OR 'VE')   *01870009
018800*                                                                *01880009
018900*    'AR' - ARRIVAL DATE                                         *01890009
019000*    'VE' - VERIFIED DATE                                        *01900009
019100*----------------------------------------------------------------*01910009
019200                                                                  01920000
019300 1100-CHECK-CC-PARAMETERS.                                        01930000
019400                                                                  01940000
019500     MOVE '1100-CHECK-CC-PARAMETERS'   TO PV-ABEND-PARAGRAPH.     01950020
019600                                                                  01960020
019700     IF NOT CC-VALID-DATE                                         01970000
019800         DISPLAY '*---------------------------------------------*'01980003
019900         DISPLAY 'PROGRAM:  :         ' PV-ABEND-PROGRAM          01990000
020000         DISPLAY 'PARAGRAPH :         ' PV-ABEND-PARAGRAPH        02000000
020100         DISPLAY 'CONTROL PARAMETERS: ' CC-CONTROL-CARD-PARAMETERS02010000
020200         DISPLAY 'DATE INDICATOR "' CC-EXTRACT-DATE '" ID INVALID'02020000
020300         DISPLAY 'RUN ABORTED'                                    02030000
020400         DISPLAY '*---------------------------------------------*'02040003
020500         MOVE 4003  TO PV-ABEND-CODE                              02050000
020600         DISPLAY 'PV-ABEND-CODE = ' PV-ABEND-CODE                 02060000
020700         CALL 'ILBOABN0'   USING PV-ABEND-CODE                    02070000
020800     END-IF.                                                      02080000
020900                                                                  02090000
021000*----------------------------------------------------------------*02100009
021100*    CHECK THAT A VALID TYPE HAS BEEN REQUESTED ('P' OR 'Q')     *02110009
021200*                                                                *02120009
021300*    'P' - PERIOD                                                *02130009
021400*    'Q' - QUARTER                                               *02140009
021500*----------------------------------------------------------------*02150009
021600                                                                  02160000
021700     IF NOT CC-VALID-TYPE                                         02170000
021800         DISPLAY '*---------------------------------------------*'02180003
021900         DISPLAY 'PROGRAM:  :         ' PV-ABEND-PROGRAM          02190000
022000         DISPLAY 'PARAGRAPH :         ' PV-ABEND-PARAGRAPH        02200000
022100         DISPLAY 'CONTROL PARAMETERS: ' CC-CONTROL-CARD-PARAMETERS02210000
022200         DISPLAY 'TYPE INDICATOR "' CC-EXTRACT-TYPE '" IS INVALID'02220000
022300         DISPLAY 'RUN ABORTED'                                    02230000
022400         DISPLAY '*---------------------------------------------*'02240003
022500         MOVE 4003  TO PV-ABEND-CODE                              02250000
022600         DISPLAY 'PV-ABEND-CODE = ' PV-ABEND-CODE                 02260000
022700         CALL 'ILBOABN0'   USING PV-ABEND-CODE                    02270000
022800     END-IF.                                                      02280000
022900                                                                  02290000
023000                                                                  02300002
023100*-----------------------------------------------------------------02310002
023200*    EXTRACT RECORDS BASED ON CONTROL CARD.                       02320003
023300*                                                                 02330002
023400*    -  IF CONTROL CARD INDICATES ARRIVED-DATE & PERIOD           02340002
023500*          AND  EXTRACT-ARRIVE-PERIOD = DATE FILE PERIOD          02350009
023600*               WRITE NEW EXTRACT                                 02360009
023700*                                                                 02370002
023800*    -  IF CONTROL CARD INDICATES ARRIVED-DATE & QUARTER          02380002
023900*          AND  EXTRACT-ARRIVE-QUARTER = DATE FILE QUARTER        02390009
024000*               WRITE NEW EXTRACT                                 02400009
024100*                                                                 02410002
024200*    -  IF CONTROL CARD INDICATES VERIFIED-DATE & PERIOD          02420002
024300*          AND  EXTRACT-VERIFIED-PERIOD = DATE FILE PERIOD        02430009
024400*               WRITE NEW EXTRACT                                 02440009
024500*                                                                 02450002
024600*    -  IF CONTROL CARD INDICATES VERIFIED-DATE & QUARTER         02460002
024700*          AND  EXTRACT-VERIFIED-QUARTER = DATE FILE QUARTER      02470009
024800*               WRITE NEW EXTRACT                                 02480009
024900*-----------------------------------------------------------------02490002
025000                                                                  02500000
025100 2000-PROCESS-EXTRACTS.                                           02510000
025200                                                                  02520000
025300     MOVE '2000-PROCESS-EXTRACTS'  TO PV-ABEND-PARAGRAPH.         02530004
025400                                                                  02540000
025500     ADD 1  TO  PV-EXTRACT-READ.                                  02550009
025600                                                                  02560000
025700     EVALUATE TRUE                                                02570006
025800                                                                  02580006
025900       WHEN CC-ARRIVED-DATE-EXTRACT  AND  CC-PERIOD-NUMBER        02590009
026000                                                                  02600009
026100           IF RC065-ARRIVE-PERIOD-NBR  =  RC067-DATE-FISCAL-PERIOD02610016
026200               PERFORM 8000-WRITE-EXTRACT                         02620006
026300           ELSE                                                   02630022
026400               DISPLAY 'ARR PERIOD MISMATCH - '                   02640022
026500                       RC065-ARRIVE-PERIOD-NBR ' / '              02650022
026600                       RC067-DATE-FISCAL-PERIOD                   02660022
026700               ADD 1 TO PV-EXTRACT-BYPASSED                       02670022
026800           END-IF                                                 02680006
026900                                                                  02690006
027000       WHEN CC-ARRIVED-DATE-EXTRACT  AND  CC-QUARTER-NUMBER       02700009
027100                                                                  02710009
027200           IF RC065-ARRIVE-QTR-NBR  =  RC067-DATE-FISCAL-QUARTER  02720016
027300               PERFORM 8000-WRITE-EXTRACT                         02730006
027400           ELSE                                                   02740022
027500               DISPLAY 'ARR QUARTER MISMATCH - '                  02750022
027600                       RC065-ARRIVE-QTR-NBR ' / '                 02760022
027700                       RC067-DATE-FISCAL-QUARTER                  02770022
027800               ADD 1 TO PV-EXTRACT-BYPASSED                       02780022
027900           END-IF                                                 02790006
028000                                                                  02800006
028100       WHEN CC-VERIFYD-DATE-EXTRACT  AND  CC-PERIOD-NUMBER        02810009
028200                                                                  02820009
028300*JPL       IF RC065-VRFYD-PERIOD-NBR  =  RC067-DATE-FISCAL-PERIOD 02830025
028400               PERFORM 8000-WRITE-EXTRACT                         02840006
028500***        ELSE                                                   02850024
028600***            DISPLAY 'VER PERIOD MISMATCH - '                   02860024
028700***                    RC065-VRFYD-PERIOD-NBR ' / '               02870024
028800***                    RC067-DATE-FISCAL-PERIOD                   02880024
028900***            ADD 1 TO PV-EXTRACT-BYPASSED                       02890024
029000***        END-IF                                                 02900024
029100                                                                  02910006
029200       WHEN CC-VERIFYD-DATE-EXTRACT  AND  CC-QUARTER-NUMBER       02920009
029300                                                                  02930009
029400           IF RC065-VRFYD-QTR-NBR  =  RC067-DATE-FISCAL-QUARTER   02940016
029500               PERFORM 8000-WRITE-EXTRACT                         02950006
029600           END-IF                                                 02960006
029700                                                                  02970008
029800       WHEN CC-BOTH-DATE-EXTRACT     AND  CC-PERIOD-NUMBER        02980009
029900                                                                  02990009
030000           IF RC065-ARRIVE-PERIOD-NBR =                           03000016
030100              RC067-DATE-FISCAL-PERIOD       OR                   03010016
030200              RC065-VRFYD-PERIOD-NBR  =                           03020016
030300              RC067-DATE-FISCAL-PERIOD                            03030016
030400               PERFORM 8000-WRITE-EXTRACT                         03040008
030500           ELSE                                                   03050022
030600               DISPLAY 'BOTH PERIOD MISMATCH - '                  03060022
030700                       RC065-ARRIVE-PERIOD-NBR ' / '              03070022
030800                       RC065-VRFYD-PERIOD-NBR ' / '               03080022
030900                       RC067-DATE-FISCAL-PERIOD                   03090022
031000               ADD 1 TO PV-EXTRACT-BYPASSED                       03100022
031100           END-IF                                                 03110008
031200                                                                  03120008
031300       WHEN CC-BOTH-DATE-EXTRACT     AND  CC-QUARTER-NUMBER       03130009
031400                                                                  03140009
031500           IF RC065-ARRIVE-QTR-NBR =                              03150016
031600              RC067-DATE-FISCAL-QUARTER      OR                   03160016
031700              RC065-VRFYD-QTR-NBR  =                              03170016
031800              RC067-DATE-FISCAL-QUARTER                           03180016
031900               PERFORM 8000-WRITE-EXTRACT                         03190008
032000           ELSE                                                   03200022
032100               DISPLAY 'BOTH QUARTER MISMATCH - '                 03210022
032200                       RC065-ARRIVE-QTR-NBR ' / '                 03220022
032300                       RC065-VRFYD-QTR-NBR ' / '                  03230022
032400                       RC067-DATE-FISCAL-QUARTER                  03240022
032500               ADD 1 TO PV-EXTRACT-BYPASSED                       03250022
032600           END-IF                                                 03260008
032700                                                                  03270006
032800       WHEN OTHER                                                 03280006
032900           ADD  1  TO  PV-EXTRACT-BYPASSED                        03290006
033000                                                                  03300006
033100     END-EVALUATE.                                                03310006
033200                                                                  03320000
033300     PERFORM 7100-READ-EXTRACT.                                   03330000
033400                                                                  03340000
033500                                                                  03350003
033600* ------------------------------------------------------------- * 03360003
033700* ------------------------------------------------------------- * 03370003
033800                                                                  03380000
033900 7000-READ-DATE.                                                  03390000
034000                                                                  03400000
034100     MOVE '7000-READ-DATE'  TO PV-ABEND-PARAGRAPH.                03410020
034200                                                                  03420020
034300     READ DATE-FILE  INTO  RC067-DATE-RECORD                      03430016
034400         AT END                                                   03440012
034500             DISPLAY '*-----------------------------------------*'03450012
034600             DISPLAY 'PROGRAM:  :         ' PV-ABEND-PROGRAM      03460012
034700             DISPLAY 'PARAGRAPH :         ' PV-ABEND-PARAGRAPH    03470012
034800             DISPLAY ' '                                          03480012
034900             DISPLAY 'EMPTY DATE FILE     '                       03490012
035000             DISPLAY '*-----------------------------------------*'03500012
035100             MOVE 4003  TO PV-ABEND-CODE                          03510012
035200             DISPLAY 'PV-ABEND-CODE = ' PV-ABEND-CODE             03520012
035300             CALL 'ILBOABN0'   USING PV-ABEND-CODE                03530012
035400     END-READ.                                                    03540012
035500                                                                  03550000
035600     DISPLAY 'DATE RECORD SET-UP IS : ' RC067-DATE-RECORD.        03560016
035700                                                                  03570000
035800                                                                  03580000
035900* ------------------------------------------------------------- * 03590003
036000* ------------------------------------------------------------- * 03600003
036100                                                                  03610003
036200 7100-READ-EXTRACT.                                               03620000
036300                                                                  03630000
036400     MOVE '7100-READ-EXTRACT'   TO PV-ABEND-PARAGRAPH.            03640000
036500                                                                  03650000
036600     READ EXTRACT-FILE-IN INTO RC065-RCVR-EXTRACT-RECORD          03660019
036700         AT END                                                   03670000
036800            SET PS-EXTRACT-EOF-YES TO TRUE.                       03680010
036900                                                                  03690000
037000                                                                  03700000
037100* ------------------------------------------------------------- * 03710003
037200* ------------------------------------------------------------- * 03720003
037300                                                                  03730003
037400 8000-WRITE-EXTRACT.                                              03740000
037500                                                                  03750000
037600     MOVE '8000-WRITE-EXTRACT'  TO PV-ABEND-PARAGRAPH.            03760000
037700                                                                  03770000
037800     WRITE NEW-EXTRACT-RECORD FROM RC065-RCVR-EXTRACT-RECORD.     03780000
037900                                                                  03790000
038000     ADD  1  TO  PV-EXTRACT-WRITTEN.                              03800000
038100                                                                  03810000
038200                                                                  03820004
038300* -------------------------------------------------------------- *03830000
038400* -------------------------------------------------------------- *03840000
