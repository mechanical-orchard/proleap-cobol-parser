000100*                                                                 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300                                                                  00030000
000400 PROGRAM-ID.    DPKCS030.                                         00040000
000500                                                                  00050000
000600 AUTHOR.        CALVIN BUSH.                                      00060000
000700 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00070000
000800 DATE-WRITTEN.  03/19/93.                                         00080000
000900 DATE-COMPILED.                                                   00090000
001000******************************************************************00100000
001100**    CICS ARCHITECTURE APPLICATION PROGRAM INTERFACE (API)     **00110000
001200******************************************************************00120000
001300**                                                              **00130000
001400** THIS PROGRAM IS A CALLED SUBROUTINE TO BE USED BY ALL CICS   **00140000
001500** ARCHITECTURE PROGRAMS.  IT WILL BE CALLED AS THE FIRST THING **00150000
001600** AND LAST THING DONE IN THE APPLICATION PROGRAM.  ITS         **00160000
001700** PURPOSE IS TO REMOVE FROM THE APPLICATION ANY CODE UNIQUE    **00170000
001800** TO THE CICS ARCHITECTURE SUCH AS COMMAND FIELD PROCESSING AND**00180000
001900** FORMATTING OF THE SCREEN.  IT IS ALSO TO HELP SIMPLIFY MAP   **00190000
002000** HANDLING, SO ALL SEND AND RECEIVES ARE ALSO DONE HERE.       **00200000
002100**                                                              **00210000
002200** PROGRAMS USING THIS SUBROUTINE MUST NOT HAVE THE FIRST LINE  **00220000
002300** OR LAST 4 LINES OF THE SCREEN DEFINED IN THEIR MAPS -- THESE **00230000
002400** AREAS ARE RESERVED FOR ARCHITECTURE API PROCESSING.  IN ORDER**00240000
002500** TO MAKE COMMON PROCESSING POSSIBLE, ALL SCREENS WILL CONSIST **00250000
002600** OF 3 TO 8 SEPARATE MAPS.  TWO, THE HEADER AND TRAILER, ARE   **00260000
002700** PART OF THE ARCHITECTURE API AND ARE NOT CODED BY THE        **00270000
002800** APPLICATION.                                                 **00280000
002900**                                                              **00290000
003000** MAP SEND TYPE DEFAULTS ARE SET BY THIS PROGRAM DURING ENTRY  **00300000
003100** PROCESSING.  THESE DEFAULTS COULD THEN BE OVERRIDDEN BY THE  **00310000
003200** APPLICATION IF NECESSARY.  NOTE THAT DEFAULTS ARE ONLY SET   **00320000
003300** FOR THE FIRST APPLICATION MAP.  IF MORE THAN ONE APPLICATION **00330000
003400** MAP IS USED ALL SEND-TYPE MANIPULATION WILL HAVE TO BE DONE  **00340000
003500** BY THE APPLICATION PROGRAM.                                  **00350000
003600**                                                              **00360000
003700** SPECIFIC PROCESSING NOTES ARE INCLUDED IN THE PROCEDURE      **00370000
003800** DIVISION.                                                    **00380000
980824**   08/24/98  TKMA464  CONVERTED "START" TO "RETURN IMMEDIATE".**00381011
003900******************************************************************00390000
004000*                                                                 00400000
004100*                                                                 00410000
004200*                                                                 00420000
004300 ENVIRONMENT DIVISION.                                            00430000
004400*                                                                 00440000
004500*                                                                 00450000
004600*                                                                 00460000
004700 DATA DIVISION.                                                   00470000
004800*                                                                 00480000
004900*                                                                 00490000
005000 WORKING-STORAGE SECTION.                                         00500000
005100                                                                  00510000
005200 01  PC-PROGRAM-CONSTANTS.                                        00520000
005300     05  PC-MAXIMUM-COMMAREA-LENGTH                               00530000
005400                                 PIC S9(04)  VALUE +4072          00540000
005500                                             COMP SYNC.           00550000
005600     05  PC-NAVIGATOR-TRAN-ID    PIC  X(04)  VALUE 'Z008'.        00560000
005700     05  PC-STATIC-MAPSET-NAME   PIC  X(08)  VALUE 'DPKM030 '.    00570000
005800     05  PC-HEADER-MAP-NAME      PIC  X(08)  VALUE 'DP030A  '.    00580000
005900     05  PC-TRAILER-MAP-NAME     PIC  X(08)  VALUE 'DP030B  '.    00590000
006000     05  PC-MSG-VAR-IND          PIC  X(04)  VALUE '&VAR'.        00600000
006100     05  PC-FKEY-CONSTANTS.                                       00610000
006200         10  PC-FUNCTION-KEY-TAG-DATA.                            00620000
006300             15  FILLER              PIC X(36)    VALUE           00630000
006400                 'F1 F2 F3 F4 F5 F6 F7 F8 F9 F10F11F12'.          00640000
006500             15  FILLER              PIC X(36)    VALUE           00650000
006600                 'F13F14F15F16F17F18F19F20F21F22F23F24'.          00660000
006700         10  PC-FUNCTION-KEY-TAG-TABLE                            00670000
006800                                     REDEFINES                    00680000
006900                                     PC-FUNCTION-KEY-TAG-DATA.    00690000
007000             15  PC-FUNCTION-KEY-TAG                              00700000
007100                                     OCCURS 24 TIMES              00710000
007200                                     INDEXED BY PC-FK-TAG-INDEX   00720000
007300                                     PIC X(3).                    00730000
007400         10  PC-MAXIMUM-FKS-PER-LINE                              00740000
007500                                     PIC S9(4)    VALUE +12       00750000
007600                                     COMP SYNC.                   00760000
007700         10  PC-START-FK-DISPLAY-1-12                             00770000
007800                                 PIC S9(4)    VALUE +1            00780000
007900                                 COMP SYNC.                       00790000
008000         10  PC-START-FK-DISPLAY-13-24                            00800000
008100                                 PIC S9(4)    VALUE +13           00810000
008200                                 COMP SYNC.                       00820000
008300     05  PC-MAXIMUM-FUNCTION-KEYS                                 00830000
008400                                 PIC S9(4)    VALUE +24           00840000
008500                                 COMP SYNC.                       00850000
008600                                                                  00860000
008700     05  PC-SYSTEM-MESSAGE-NUMBERS.                               00870000
008800         10  PC-TSYMSG-00045         PIC  9(05) VALUE  00045.     00880000
008900         10  PC-TSYMSG-00618         PIC  9(05) VALUE  00618.     00890000
009000                                                                  00900000
009100 01  PS-PROGRAM-SWITCHES.                                         00910000
009200     05  PS-PROGRAM-ENTRY-SW            PIC  X(01)  VALUE 'Y'.    00920000
009300         88  PS-PROGRAM-ENTRY                       VALUE 'Y'.    00930000
009400         88  PS-PROGRAM-EXIT                        VALUE 'N'.    00940000
009500     05  PS-INSERT-CURSOR-SW            PIC  X(01)  VALUE 'N'.    00950000
009600         88  PS-INSERT-CURSOR                       VALUE 'Y'.    00960000
009700         88  PS-NO-INSERT-CURSOR                    VALUE 'N'.    00970000
009800     05  PS-SYS-SEND-TYPE-IND           PIC  X(01)  VALUE SPACE.  00980000
009900         88  PS-SYS-DONT-SEND                       VALUE ' '.    00990000
010000         88  PS-SYS-SEND-DATAONLY                   VALUE 'D'.    01000000
010100         88  PS-SYS-SEND-MAPONLY                    VALUE 'M'.    01010000
010200         88  PS-SYS-SEND-MAP-AND-DATA               VALUE 'B'.    01020000
010300     05  PS-SEND-TYPE-IND               PIC  X(01)  VALUE SPACE.  01030000
010400         88  PS-DONT-SEND                           VALUE ' '.    01040000
010500         88  PS-SEND-DATAONLY                       VALUE 'D'.    01050000
010600         88  PS-SEND-MAPONLY                        VALUE 'M'.    01060000
010700         88  PS-SEND-MAP-AND-DATA                   VALUE 'B'.    01070000
010800     05  PS-AID-KEY-CONVERTED-IND                                 01080000
010900                                 PIC X(1)         VALUE 'N'.      01090000
011000         88  PS-AID-KEY-CONVERTED                 VALUE 'Y'.      01100000
011100         88  PS-AID-KEY-NOT-CONVERTED             VALUE 'N'.      01110000
011200     05  PS-AID-RETURN-CODE      PIC 9(1)         VALUE 0.        01120000
011300         88  PS-AID-SUCCESSFUL-COMPLETION         VALUE 0.        01130000
011400         88  PS-AID-ERROR                         VALUE 1.        01140000
011500         88  PS-AID-INVALID                       VALUE 1.        01150000
011600                                                                  01160000
011700                                                                  01170000
011800 01  PV-PROGRAM-VARIABLES.                                        01180000
011900     05  PV-CICS-RESPONSE        PIC S9(08)  VALUE +0             01190000
012000                                             COMP SYNC.           01200000
012100     05  PV-STARTING-POSITION    PIC S9(04)  VALUE +0             01210000
012200                                             COMP SYNC.           01220000
012300     05  PV-MAP-START-BYTE       PIC S9(04)  VALUE +0             01230000
012400                                             COMP SYNC.           01240000
012410     05  PV-CHAR-POS             PIC S9(04)  VALUE +0             01241000
012420                                             COMP SYNC.           01242000
012430     05  PV-MAP-LENGTH           PIC S9(04)  VALUE +0             01243000
012440                                             COMP SYNC.           01244000
012450     05  PV-MSG-VAR-LENGTH       PIC S9(04)  VALUE +0             01245000
012460                                             COMP SYNC.           01246000
012470     05  PV-MSG-VAR-LEAD-SPACE   PIC S9(04)  VALUE +0             01247000
012480                                             COMP SYNC.           01248000
012500     05  PV-TALLY-CNT            PIC S9(04)  VALUE ZERO           01250003
012501                                             COMP SYNC.           01250103
012510     05  PV-SOURCE-AID-KEY       PIC  9(02)  VALUE ZERO.          01251002
012600     05  PV-CURRENT-MAPSET-NAME  PIC  X(08)  VALUE SPACE.         01260000
012700     05  PV-CURRENT-MAP-NAME     PIC  X(08)  VALUE SPACE.         01270000
012800     05  PV-MAP-DATA-AREA        PIC  X(3000) VALUE LOW-VALUES.   01280000
012900     05  PV-SCREEN-DATA-AREA     PIC  X(3000) VALUE LOW-VALUES.   01290000
013000     05  PV-NAVIGATION-MNEMONIC     PIC  X(08)   VALUE SPACES.    01300000
013100         88  PV-CLEAR-MNEMONIC                   VALUE 'CLR     ',01310000
013200                                                       'CLEAR   '.01320000
013300         88  PV-PF8-MNEMONIC                     VALUE 'F       ',01330000
013400                                                       'FO      ',01340000
013500                                                       'FOR     ',01350000
013600                                                       'FORWARD ',01360000
013700                                                       'D       ',01370000
013800                                                       'DO      ',01380000
013900                                                       'DOWN    ',01390000
014000                                                       'N       ',01400000
014100                                                       'NEXT    ',01410000
014200                                                       'NEXTPAGE'.01420000
014300         88  PV-PF7-MNEMONIC                     VALUE 'B       ',01430000
014400                                                       'BA      ',01440000
014500                                                       'BACK    ',01450000
014600                                                       'BACKWARD',01460000
014700                                                       'U       ',01470000
014800                                                       'UP      ',01480000
014900                                                       'LAST    ',01490000
015000                                                       'PREV    ',01500000
015100                                                       'PREVPAGE'.01510000
015200         88  PV-PF6-MNEMONIC                     VALUE '1ST-PAGE'.01520000
015300         88  PV-PF5-MNEMONIC                     VALUE 'REFRESH '.01530000
015400         88  PV-PF3-MNEMONIC                     VALUE 'END     ',01540000
015500                                                       'X       ',01550000
015600                                                       'EX      ',01560000
015700                                                       'EXIT    ',01570000
015800                                                       'RET     ',01580000
015900                                                       'RETURN  '.01590000
016000         88  PV-PA2-MNEMONIC                     VALUE 'PA2     '.01600000
016100     05  FILLER                      REDEFINES                    01610000
016200                                     PV-NAVIGATION-MNEMONIC.      01620000
016300         10  PV-NAVIGATION-MNEMONIC-1-2.                          01630000
016400             88  PV-FUNCTION-KEY-PF-LITERAL      VALUE 'PF'.      01640000
016500             15  PV-NAVIGATION-MNEMONIC-1                         01650000
016600                                     PIC  X(01).                  01660000
016700                 88  PV-FUNCTION-KEY-F-LITERAL   VALUE 'F'.       01670000
016800             15  PV-NAVIGATION-MNEMONIC-2                         01680000
016900                                     PIC  X(01).                  01690000
017000         10  PV-NAVIGATION-MNEMONIC-3-8.                          01700000
017100             15  PV-NAVIGATION-MNEMONIC-3                         01710000
017200                                     PIC  X(01).                  01720000
017300             15  PV-NAVIGATION-MNEMONIC-4-8.                      01730000
017400                 20  FILLER          PIC  X(01).                  01740000
017500                 20  PV-NAVIGATION-MNEMONIC-5-8                   01750000
017600                                     PIC  X(04).                  01760000
017700     05  FILLER                      REDEFINES                    01770000
017800                                     PV-NAVIGATION-MNEMONIC.      01780000
017900         10  PV-FK-NUMBER-1          PIC  9(01).                  01790000
018000         10  PV-NAVIGATION-MNEMONIC-2-8.                          01800000
018100             15  PV-NAVIGATION-MNEMONIC-2-3.                      01810000
018200                 20  PV-FK-NUMBER-2                               01820000
018300                                     PIC  9(01).                  01830000
018400                 20  PV-FK-NUMBER-3                               01840000
018500                                     PIC  9(1).                   01850000
018600             15  FILLER              PIC  X(05).                  01860000
018700     05  FILLER                      REDEFINES                    01870000
018800                                     PV-NAVIGATION-MNEMONIC.      01880000
018900         10  FILLER                  PIC  X(01).                  01890000
019000         10  PV-FK-NUMBER-2-3        PIC  9(02).                  01900000
019100         10  FILLER                  PIC  X(05).                  01910000
019200     05  FILLER                      REDEFINES                    01920000
019300                                     PV-NAVIGATION-MNEMONIC.      01930000
019400         10  PV-FK-NUMBER-1-2        PIC  9(02).                  01940000
019500         10  PV-NAVIGATION-MNEMONIC-3-4.                          01950000
019600             15  PV-FK-NUMBER-3-4    PIC  9(02).                  01960000
019700         10  FILLER                  PIC  X(04).                  01970000
019800     05  PV-MSG-VAR-SAVE             PIC  X(70)  VALUE SPACE.     01980000
019900     05  PV-MSG-REMAINDER            PIC  X(70)  VALUE SPACE.     01990000
020000     05  PV-MSG-VAR-IND              PIC  X(04)  VALUE SPACE.     02000000
020300     05  PV-MSG-STRING-PTR           PIC S9(04)  VALUE ZERO       02030000
020400                                                 COMP SYNC.       02040000
020500                                                                  02050000
020600******************************************************************02060000
020700*    LAYOUT USED TO GET THE SYSTEM DATE AND TIME                  02070000
020800******************************************************************02080000
020900 01  DT-DATE-TIME-VARIABLES.                                      02090000
021000     05  DT-ABSTIME                  PIC S9(15)  VALUE ZERO       02100000
021100                                                 COMP-3.          02110000
021200     05  DT-YEAR-BIN                 PIC S9(09)  VALUE ZERO       02120000
021300                                                 COMP SYNC.       02130000
021400     05  DT-FORMATTED-TIME           PIC  X(08)  VALUE SPACE.     02140000
021500     05  DT-FORMATTED-DATE           PIC  X(10)  VALUE SPACE.     02150000
021600     05  FILLER                      REDEFINES DT-FORMATTED-DATE. 02160000
021700         10  DT-FORMATTED-MMDDYY     PIC  X(08).                  02170000
021800         10  FILLER                  PIC  X(02).                  02180000
021900     05  FILLER                      REDEFINES DT-FORMATTED-DATE. 02190000
022000         10  FILLER                  PIC  X(06).                  02200000
022100         10  DT-FORMATTED-YYYY       PIC  9(04).                  02210000
022200                                                                  02220000
022300                                                                  02230000
022400 01  FKEY-FUNCTION-KEY-AREA.                                      02240000
022500     05  FKEY-FUNCTION-KEY-LINES.                                 02250000
022600         10  FKEY-FUNCTION-KEY-LINE-1                             02260000
022700                                 PIC X(78)    VALUE SPACES.       02270000
022800         10  FKEY-FUNCTION-KEY-LINE-2                             02280000
022900                                 PIC X(78)    VALUE SPACES.       02290000
023000     05  FILLER                  REDEFINES                        02300000
023100                                     FKEY-FUNCTION-KEY-LINES.     02310000
023200         10  FKEY-FUNCTION-KEY-DESCRIPTION                        02320000
023300                                 OCCURS 12 TIMES                  02330000
023400                                 INDEXED BY FKEY-INDEX.           02340000
023500             15  FKEY-FUNCTION-KEY-TAG-LITERAL                    02350000
023600                                 PIC X(3).                        02360000
023700             15  FILLER          PIC X(1).                        02370000
023800                 88  FKEY-FUNCTION-KEY-EQUAL-SIGN                 02380000
023900                                              VALUE '='.          02390000
024000             15  FKEY-FUNCTION-KEY-MNEMONIC                       02400000
024100                                 PIC X(8).                        02410000
024200             15  FILLER          PIC X(1).                        02420000
024300                                                                  02430000
024400                                                                  02440000
024500 EJECT                                                            02450000
024600******************************************************************02460000
024700*    STANDARD ATTENTION IDENTIFIER LIST                           02470000
024800******************************************************************02480000
024900                                                                  02490000
025000     COPY DFHAID.                                                 02500000
025100                                                                  02510000
025200******************************************************************02520000
025300*    MAP LAYOUT - TEMPLATES                                       02530000
025400******************************************************************02540000
025500                                                                  02550000
025600     COPY DPKM030.                                                02560000
025700******************************************************************02570000
025800*    STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST        02580000
025900******************************************************************02590000
026000                                                                  02600000
026100     COPY DPWS015.                                                02610000
026200                                                                  02620000
026300******************************************************************02630000
026400*    NAVIGATION PFKEY VALUE LIST (SIMILAR TO DFHAID)              02640000
026500******************************************************************02650000
026600                                                                  02660000
026700     COPY DPWS016.                                                02670000
026800                                                                  02680000
026900******************************************************************02690000
027000*    PARAMETER LIST USED TO CALL THE 'TRANSLATE AID' SUBROUTINE   02700000
027100******************************************************************02710000
027200                                                                  02720000
027300                                                                  02730000
027400******************************************************************02740000
027500*    SYSTEM MESSAGES COPYBOOK                                     02750000
027600******************************************************************02760000
027700                                                                  02770000
027800     COPY DPRD507I.                                               02780000
027900 EJECT                                                            02790000
028000*                                                                 02800000
028100*                                                                 02810000
028200 LINKAGE SECTION.                                                 02820000
028300*                                                                 02830000
028400 01  DFHCOMMAREA.                                                 02840000
028500     05  FILLER                 OCCURS 1 TO 4072 TIMES            02850000
028600                                DEPENDING ON EIBCALEN.            02860000
028700         10  FILLER             PIC  X(01).                       02870000
028800     COPY DPWS030.                                                02880000
028900     COPY DPWS021.                                                02890000
029000 01  LS-MAP-DATA-AREA           PIC  X(3000).                     02900000
029100*                                                                 02910000
029200*                                                                 02920000
029300 PROCEDURE DIVISION USING                                         02930000
029400                           DP030-CICS-API-FIELDS                  02940000
029500                           DP020-STANDARD-COMMAREA                02950000
029600                           LS-MAP-DATA-AREA.                      02960000
029700                                                                  02970000
029800******************************************************************02980000
029900**   DP020-SRC-RETURN-W-TRAN-ID WILL BE TRUE IF THIS PROGRAM WAS**02990000
030000**   SENT A STANDARD COMMAREA. IF NOT SET TRUE (MEANING OTHER   **03000000
030100**   THAN A STANDARD COMMAREA WAS SENT TO THIS PROGRAM) THIS    **03010000
030200**   PROGRAM WILL RETURN TO CICS.                               **03020000
030300******************************************************************03030000
030400 0000-MAINLINE.                                                   03040000
030500     SET DP030-RC-CALL-SUCCESSFUL TO TRUE.                        03050000
030600     IF  PS-PROGRAM-ENTRY                                         03060000
030700         PERFORM 1000-ENTRY-PROCESSING                            03070000
030800         SET PS-PROGRAM-EXIT TO TRUE                              03080000
030900     ELSE                                                         03090000
031000         PERFORM 4000-EXIT-PROCESSING                             03100000
031100         SET PS-PROGRAM-ENTRY TO TRUE                             03110000
031200     END-IF.                                                      03120000
031300     GOBACK.                                                      03130000
031400*                                                                 03140000
031500 EJECT                                                            03150000
031600                                                                  03160000
031700******************************************************************03170000
031800**  PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   **03180000
031900**  COURSE OF ACTION IS FOR THIS TRANSACTION.                   **03190000
032000******************************************************************03200000
032100 1000-ENTRY-PROCESSING.                                           03210000
032200     PERFORM 1100-CHECK-COMMAREA.                                 03220000
032300                                                                  03230000
032400     SET DP030-SET-CURSOR-TRAILER TO TRUE.                        03240000
032500     EVALUATE TRUE                                                03250000
032600         WHEN DP020-NEXT-ACT-INITIAL                              03260000
032700*  ENTERING PROGRAM FOR THE FIRST TIME                            03270000
032800             SET DP030-ERASE                 TO TRUE              03280000
032900             SET PS-SYS-SEND-MAP-AND-DATA    TO TRUE              03290000
033000             SET DP030-SEND-MAP-AND-DATA(1)  TO TRUE              03300000
033100             MOVE EIBTASKN            TO DP020-SRC-TASK-NUMBER    03310000
033200         WHEN DP020-NEXT-ACT-READ-MAP                             03320000
033300*  ENTERING PROGRAM IN PSEUDO-CONV. MODE AFTER MAP SENT           03330000
033400             SET DP030-SEND-DATAONLY(1)   TO TRUE                 03340000
033500             SET PS-SYS-SEND-DATAONLY         TO TRUE             03350000
033600             PERFORM 2000-PROCESS-MAP                             03360000
033700                                                                  03370000
033800         WHEN DP020-NEXT-ACT-RETURN                               03380000
033900* ENTERING PROGRAM WHEN RETURNING FROM ANOTHER                    03390000
034000             SET DP030-SEND-MAP-AND-DATA(1)  TO TRUE              03400000
034100             SET DP030-ERASE              TO TRUE                 03410000
034200             SET PS-SYS-SEND-MAP-AND-DATA     TO TRUE             03420000
034300                                                                  03430000
034400         WHEN DP020-NEXT-ACT-NAV-ERROR                            03440000
034500* ENTERING PROGRAM AFTER A NAVIGATION ERROR                       03450000
034600             SET PS-SYS-SEND-DATAONLY     TO TRUE                 03460000
034700             MOVE -1                  TO BNAVCMDL                 03470000
034800             IF DP020-NAV-MNEMONIC = SPACES                       03480000
034900                 MOVE SPACES          TO BNAVCMDO                 03490000
035000                 MOVE DP015-GREEN     TO BNAVCMDC                 03500000
035100                 MOVE DP015-UNDERLINE TO BNAVCMDH                 03510000
035200             ELSE                                                 03520000
035300                 MOVE DP015-RED       TO BNAVCMDC                 03530000
035400                 MOVE DP015-REVERSE   TO BNAVCMDH                 03540000
035500             END-IF                                               03550000
035600                                                                  03560000
035700             MOVE LOW-VALUES TO DP020-INTER-APPL-DATA-AREA        03570000
035800                                                                  03580000
035900             PERFORM 9000-DISPLAY-PANEL                           03590000
036000             SET DP020-SRC-RETURN-W-TRAN-ID TO TRUE               03600000
036100             PERFORM 9900-RETURN-TO-CICS                          03610000
036200                                                                  03620000
036300         WHEN DP020-NEXT-ACT-APPL-ERROR                           03630000
036400* ENTERING PROGRAM AFTER AN APPLICATION ERROR                     03640000
036500             IF  DP030-OVERRIDE-APPL-ERROR                        03650000
036600                 SET DP020-NEXT-ACT-READ-MAP                      03660000
036700                     DP030-RC-APPL-ERROR                          03670000
036800                     DP030-ERASE                                  03680000
036900                     DP030-SEND-MAP-AND-DATA(1)  TO TRUE          03690000
037000             ELSE                                                 03700000
037100                 SET PS-SYS-SEND-DATAONLY TO TRUE                 03710000
037200                 MOVE -1                  TO BNAVCMDL             03720000
037300                 PERFORM 9000-DISPLAY-PANEL                       03730000
037400                 SET DP020-SRC-RETURN-W-TRAN-ID TO TRUE           03740000
037500                 PERFORM 9900-RETURN-TO-CICS                      03750000
037600             END-IF                                               03760000
037700         WHEN OTHER                                               03770000
037800             SET DP030-RC-INVALID-NEXT-ACT TO TRUE                03780000
037900     END-EVALUATE.                                                03790000
038000                                                                  03800000
038100                                                                  03810000
038200 1100-CHECK-COMMAREA.                                             03820000
038300******************************************************************03830000
038400** CHECK FOR A COMMAREA UPON ENTRANCE INTO A CICS ARCHITECTURE    03840000
038500** PROGRAM.  PASSING CONTROL BETWEEN PROGRAMS IS DONE USING A     03850000
038600** 'START', HENCE THE NEED FOR THE 'RETRIEVE' COMMAND.            03860000
038700******************************************************************03870000
038800                                                                  03880000
038900     IF EIBCALEN = ZERO                                           03890000
039000         EXEC CICS                                                03900000
039100             RETRIEVE                                             03910000
039200                 INTO   (DP020-STANDARD-COMMAREA)                 03920000
039300                 LENGTH (PC-MAXIMUM-COMMAREA-LENGTH)              03930000
039400                 RESP   (PV-CICS-RESPONSE)                        03940000
039500         END-EXEC                                                 03950000
039600         EVALUATE PV-CICS-RESPONSE  ALSO  TRUE                    03960000
039700             WHEN DFHRESP(ENDDATA)  ALSO  ANY                     03970000
039800                 INITIALIZE DP020-STANDARD-COMMAREA               03980000
039900                 SET DP020-BAD-COMMAREA TO TRUE                   03990000
040000                 MOVE PC-MAXIMUM-COMMAREA-LENGTH TO               04000000
040100                           DP020-COMMAREA-LENGTH                  04010000
040200                 PERFORM 4100-START-NAVIGATOR                     04020000
040300             WHEN DFHRESP(NORMAL)   ALSO                          04030000
040400                                    (NOT DP020-GOOD-COMMAREA)     04040000
040500                 INITIALIZE DP020-STANDARD-COMMAREA               04050000
040600                 SET DP020-BAD-COMMAREA TO TRUE                   04060000
040700                 MOVE PC-MAXIMUM-COMMAREA-LENGTH TO               04070000
040800                           DP020-COMMAREA-LENGTH                  04080000
040900                 PERFORM 4100-START-NAVIGATOR                     04090000
041000             WHEN DFHRESP(NORMAL)   ALSO                          04100000
041100                                    (DP020-GOOD-COMMAREA)         04110000
041200                 SET DP020-SRC-RETURN-W-TRAN-ID TO TRUE           04120000
041300             WHEN OTHER                                           04130000
041400                 SET DP030-RC-NO-COMMAREA TO TRUE                 04140000
041500         END-EVALUATE                                             04150000
041600     ELSE                                                         04160000
041700         MOVE DFHCOMMAREA TO DP020-STANDARD-COMMAREA              04170000
041800         IF (NOT DP020-GOOD-COMMAREA)                             04180000
041900             INITIALIZE DP020-STANDARD-COMMAREA                   04190000
042000             SET DP020-BAD-COMMAREA TO TRUE                       04200000
042100             MOVE PC-MAXIMUM-COMMAREA-LENGTH TO                   04210000
042200                       DP020-COMMAREA-LENGTH                      04220000
042300             PERFORM 4100-START-NAVIGATOR                         04230000
042400         ELSE                                                     04240000
042500             SET DP020-SRC-RETURN-W-TRAN-ID TO TRUE               04250000
042600         END-IF                                                   04260000
042700     END-IF.                                                      04270000
042800                                                                  04280000
042900 EJECT                                                            04290000
043000******************************************************************04300000
043100**  IF A KEY OTHER THAN CLEAR OR PA2 WAS PRESSED, RECEIVE THE   **04310000
043200**  SCREEN (UNMAPPED SINCE WE ARE DEALING WITH MULTIPLE MAPS)   **04320000
043300**  THEN RECEIVE THE MAPS FROM THE RECEIVED DATA AREA.          **04330000
043400**  CHECK THE FUNCTION KEYS.  IF THE KEY NEEDS LOCAL PROCESSING **04340000
043500**  CONTROL WILL BE GIVEN BACK TO THE CALLING PROGRAM OTHERWISE **04350000
043600**  IT WILL BE ACTED UPON HERE.                                 **04360000
043700******************************************************************04370000
043800 2000-PROCESS-MAP.                                                04380000
043900     IF ((EIBAID NOT = DFHPA2)                                    04390000
044000         AND (EIBAID NOT = DFHPA3)                                04400000
044100         AND (EIBAID NOT = DFHCLEAR))                             04410000
044200         PERFORM 2300-GET-PANEL                                   04420000
044300         PERFORM 2200-PROCESS-COMMAND-FIELD                       04430000
044400     ELSE                                                         04440000
044500         MOVE LOW-VALUES TO DP030BO                               04450000
044600         PERFORM 2200-PROCESS-COMMAND-FIELD                       04460000
044700     END-IF.                                                      04470000
044800*                                                                 04480000
044900     PERFORM 2100-CHECK-LOCAL-FKEYS.                              04490000
045000******************************************************************04500000
045100**   TAKE THE APPROPRIATE COURSE OF ACTION BASED ON WHAT        **04510000
045200**   FUNCTION KEY THE USER HAS HIT.                             **04520000
045300**                                                              **04530000
045400**   MAY WANT TO CHECK FOR A PF LABEL OF SPACES.  THIS WILL     **04540000
045500**   BE ESPECIALLY IMPORTANT IF MULTIPLE MNEMONICS ARE ASSIGNED **04550000
045600**   TO A SINGLE PROGRAM AND IF THE DIFFERENT MNEMONICS USE     **04560000
045700**   DIFFERENT FUNCTION KEYS.                                   **04570000
045800**   NOTE ALSO THAT ANY GO-TO FUNCTION KEYS WILL START THE      **04580000
045900**  NAVIGATOR WITHOUT RETURNING TO THE CALLING PROGRAM.  ANY KEY**04590000
046000**  ASSOCIATED WITH A LOCALLY-PERFORMED FUNCTION WILL RETURN    **04600000
046100**  TO THE CALLING PROGRAM.                                     **04610000
046200******************************************************************04620000
046300 2100-CHECK-LOCAL-FKEYS.                                          04630000
046400                                                                  04640000
046500     EVALUATE TRUE                                                04650000
046600         WHEN DP020-FK-MNEMONIC (DP020-SRC-AID) = SPACE           04660000
046700*            -- INVALID FUNCTION KEY USED --                      04670000
046800             MOVE PC-TSYMSG-00045 TO DP020-MSG-NUMBER             04680000
046900             SET DP030-SET-CURSOR-ABSOLUTE TO TRUE                04690000
047000             MOVE EIBCPOSN        TO DP030-CURSOR-POSITION        04700000
047100             SET DP020-MSG-FATAL TO TRUE                          04710000
047200             PERFORM 9000-DISPLAY-PANEL                           04720000
047300             PERFORM 9900-RETURN-TO-CICS                          04730000
047400                                                                  04740000
047500         WHEN DP020-FK-GO-TO-TRAN(DP020-SRC-AID)                  04750000
047600             PERFORM 4100-START-NAVIGATOR                         04760000
047700                                                                  04770000
047800         WHEN DP020-FK-RETURN(DP020-SRC-AID)                      04780000
047900             PERFORM 4100-START-NAVIGATOR                         04790000
048000                                                                  04800000
048100         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     04810000
048200             SET DP030-ERASE TO TRUE                              04820000
048300             SET DP030-SEND-MAP-AND-DATA(1)  TO TRUE              04830000
048400             INITIALIZE DP020-NAV-MNEMONIC                        04840000
048500                        DP020-NAV-KEY-DATA                        04850000
048600                        BNAVCMDO                                  04860000
048700                        BNAVKEYO                                  04870000
048800                                                                  04880000
048900         WHEN DP020-SRC-AID = DP016-ENTER                         04890000
049000             IF  DP020-NAV-MNEMONIC > SPACE                       04900000
049100                 MOVE LOW-VALUES TO DP020-INTER-APPL-DATA-AREA    04910000
049200                 MOVE ZERO       TO DP020-MSG-NUMBER              04920000
049300                 PERFORM 4100-START-NAVIGATOR                     04930000
049400             END-IF                                               04940000
049500                                                                  04950000
049600         WHEN DP020-SRC-AID = DP016-PA2                           04960000
049700             SET DP030-SET-CURSOR-TRAILER  TO TRUE                04970000
049800             MOVE -1              TO BNAVKEYL                     04980000
049900             PERFORM 9110-GET-CURR-DATE-TIME                      04990000
050000             PERFORM 9200-LOAD-FK-LINES                           05000000
050100             PERFORM 9400-WRITE-PANEL                             05010000
050200             PERFORM 9900-RETURN-TO-CICS                          05020000
050300                                                                  05030000
050400         WHEN DP020-SRC-AID = DP016-PA3                           05040000
050500*            -- INVALID FUNCTION KEY USED --                      05050000
050600             MOVE PC-TSYMSG-00045 TO DP020-MSG-NUMBER             05060000
050700             SET DP020-MSG-FATAL TO TRUE                          05070000
050800             SET DP030-SET-CURSOR-TRAILER  TO TRUE                05080000
050900             MOVE -1              TO BNAVKEYL                     05090000
051000             PERFORM 9000-DISPLAY-PANEL                           05100000
051100             PERFORM 9900-RETURN-TO-CICS                          05110000
051200                                                                  05120000
051300         WHEN DP020-SRC-AID = DP016-CLEAR                         05130000
051400             INITIALIZE DP020-NAV-MNEMONIC                        05140000
051500                        DP020-NAV-KEY-DATA                        05150000
051600             SET PS-SYS-SEND-MAP-AND-DATA   TO TRUE               05160000
051700             SET DP030-SEND-MAP-AND-DATA(1) TO TRUE               05170000
051800         WHEN DP020-SRC-AID = DP016-PF1                           05180000
051900         WHEN DP020-SRC-AID = DP016-PF12                          05190000
052000*            -- HELP NOT AVAILABLE ---                            05200000
052100             MOVE PC-TSYMSG-00618 TO DP020-MSG-NUMBER             05210000
052200             SET DP030-SET-CURSOR-ABSOLUTE TO TRUE                05220000
052300             MOVE EIBCPOSN        TO DP030-CURSOR-POSITION        05230000
052400             SET DP020-MSG-INFORMATIONAL TO TRUE                  05240000
052500             PERFORM 9000-DISPLAY-PANEL                           05250000
052600             PERFORM 9900-RETURN-TO-CICS                          05260000
052700     END-EVALUATE.                                                05270000
052800******************************************************************05280000
052900** INTERROGATE THE COMMAND FIELD.  IF POSSIBLE, CONVERT THE     **05290000
053000** ENTERED COMMAND TO A FUNCTION KEY.  IF IT CAN BE CONVERTED,  **05300000
053100** SETUP THE COMMAREA AS IF THE FUNTION KEY WAS HIT RATHER THAN **05310000
053200** A MNEMONIC ENTERED.                                          **05320000
053300******************************************************************05330000
053400*                                                                 05340000
053500 2200-PROCESS-COMMAND-FIELD.                                      05350000
053600     IF  BNAVCMDL > ZERO                                          05360000
053700         MOVE BNAVCMDI              TO DP020-NAV-MNEMONIC         05370000
053800         MOVE DP015-GREEN           TO BNAVCMDC                   05380000
053900         MOVE DP015-UNDERLINE       TO BNAVCMDH                   05390000
054000         MOVE DP015-UNP-ALP-NOR-OFF TO BNAVCMDA                   05400000
054100     ELSE                                                         05410000
054200         IF  BNAVCMDA = DP015-ERASE-EOF                           05420000
054300             INITIALIZE DP020-NAV-MNEMONIC                        05430000
054400             MOVE DP015-GREEN       TO BNAVCMDC                   05440000
054500             MOVE DP015-UNDERLINE                                 05450000
054600                                    TO BNAVCMDH                   05460000
054700             MOVE DP015-UNP-ALP-NOR-OFF                           05470000
054800                                    TO BNAVCMDA                   05480000
054900         END-IF                                                   05490000
055000     END-IF.                                                      05500000
055100     IF  BNAVKEYL > ZERO                                          05510000
055200         MOVE BNAVKEYI     TO DP020-NAV-KEY-DATA                  05520000
055300     ELSE                                                         05530000
055400         IF  BNAVKEYA = DP015-ERASE-EOF                           05540000
055500             INITIALIZE DP020-NAV-KEY-DATA                        05550000
055600         END-IF                                                   05560000
055700     END-IF.                                                      05570000
055800*                                                                 05580000
055900     MOVE DP020-NAV-MNEMONIC   TO PV-NAVIGATION-MNEMONIC.         05590000
056000     PERFORM 2400-MNEMONIC-TO-AID.                                05600000
056100*                                                                 05610000
056200     MOVE PV-SOURCE-AID-KEY         TO DP020-SRC-AID              05620000
056300     IF ((PS-AID-KEY-CONVERTED)                                   05630000
056400             OR ((DP020-SRC-AID NOT = DP016-ENTER)                05640000
056500             AND (DP020-SRC-AID NOT = DP016-PA2)                  05650000
056600             AND (DP020-NAV-MNEMONIC NOT = SPACES)))              05660000
056700         INITIALIZE DP020-NAV-MNEMONIC                            05670000
056800                    BNAVCMDO                                      05680000
056900         MOVE DP015-GREEN           TO BNAVCMDC                   05690000
057000         MOVE DP015-UNDERLINE       TO BNAVCMDH                   05700000
057100         MOVE DP015-UNP-ALP-NOR-OFF TO BNAVCMDA                   05710000
057200     ELSE                                                         05720000
057300         IF  ((PS-AID-KEY-NOT-CONVERTED)                          05730000
057400             AND (DP020-SRC-AID = DP016-ENTER)                    05740000
057500             AND (DP020-NAV-MNEMONIC > SPACE))                    05750000
057600             PERFORM 2210-SEARCH-FK-LABELS                        05760000
057700         END-IF                                                   05770000
057800     END-IF.                                                      05780000
057900******************************************************************05790000
058000** CHECK TO SEE IF THE COMMAND ENTERED IN THE COMMAND FIELD IS  **05800000
058100** A FUNCTION KEY LABEL.  IF IT IS, SET UP THE COMMAREA AS IF   **05810000
058200** FUNCTION KEY WAS PRESSED.                                    **05820000
058300******************************************************************05830000
058400 2210-SEARCH-FK-LABELS.                                           05840000
058500     INITIALIZE PV-STARTING-POSITION.                             05850000
058600     INSPECT DP020-NAV-MNEMONIC                                   05860000
058700         TALLYING PV-STARTING-POSITION                            05870000
058800         FOR LEADING SPACE.                                       05880000
058900     ADD +1 TO PV-STARTING-POSITION                               05890000
059000*                                                                 05900000
059100     SET DP020-FK-INDEX TO 1.                                     05910000
059200     SEARCH DP020-FUNCTION-KEY                                    05920000
059300         WHEN DP020-NAV-MNEMONIC (PV-STARTING-POSITION:8)         05930000
059400                             = DP020-FK-MNEMONIC (DP020-FK-INDEX) 05940000
059500             SET DP020-SRC-AID TO DP020-FK-INDEX                  05950000
059600             INITIALIZE DP020-NAV-MNEMONIC                        05960000
059700                        BNAVCMDO                                  05970000
059800             MOVE DP015-GREEN           TO BNAVCMDC               05980000
059900             MOVE DP015-UNDERLINE       TO BNAVCMDH               05990000
060000             MOVE DP015-UNP-ALP-NOR-OFF TO BNAVCMDA               06000000
060100     END-SEARCH.                                                  06010000
060200******************************************************************06020000
060300** BECAUSE WE ARE DEALING WITH MULTIPLE MAPS, FIRST RECEIVE THE **06030000
060400** SCREEN AND THEN RECEIVE THE INDIVIDUAL MAPS FROM THAT DATA   **06040000
060500** AREA.  IF THERE ARE MULTIPLE APPLICATION MAPS, RECEIVE EACH  **06050000
060600** ONE AND CONCATENATE THE OUTPUT INTO THE LINKAGE SECTION      **06060000
060700** DATA AREA.                                                   **06070000
060800******************************************************************06080000
060900 2300-GET-PANEL.                                                  06090000
061000     MOVE LOW-VALUES TO PV-SCREEN-DATA-AREA                       06100000
061100                        PV-MAP-DATA-AREA                          06110000
061200                        DP030AO                                   06120000
061300                        DP030BO.                                  06130000
061400     PERFORM 2310-RECEIVE-SCREEN.                                 06140000
061500     MOVE DP030-MAPSET-NAME     TO PV-CURRENT-MAPSET-NAME.        06150000
061600     IF  DP030-DONT-RECEIVE-APPL-MAP                              06160000
061700         MOVE PV-SCREEN-DATA-AREA TO LS-MAP-DATA-AREA             06170000
061800     ELSE                                                         06180000
061900         PERFORM 2320-RECEIVE-APPL-MAPS                           06190000
062000             VARYING DP030-MAP-INDEX                              06200000
062100             FROM 1 BY 1                                          06210000
062200             UNTIL DP030-MAP-INDEX > DP030-NUMBER-OF-MAPS         06220000
062300     END-IF.                                                      06230000
062400     MOVE PC-STATIC-MAPSET-NAME TO PV-CURRENT-MAPSET-NAME.        06240000
062500     MOVE PC-TRAILER-MAP-NAME   TO PV-CURRENT-MAP-NAME.           06250000
062600     PERFORM 2325-RECEIVE-MAP.                                    06260000
062700     MOVE PV-MAP-DATA-AREA TO DP030BI.                            06270000
062800******************************************************************06280000
062900** THE SCREEN IS COMPRISED OF MULTIPLE MAPS: 1 HEADER, 1 - 6    **06290000
063000** APPLICATION MAPS AND 1 TRAILER.  TO RECEIVE THESE, THE 3270  **06300000
063100** DATA MUST BE RECEIVED AND THEN EACH INDIVIDUAL MAP IS        **06310000
063200** RECEIVED FROM THE DATA AREA.  APPLICATION MAPS ARE RECEIVED  **06320000
063300** AND PUT INTO THE LINKAGE SECTION DATA AREA.  IF MULTIPLE     **06330000
063400** MAPS ARE USED, THEY ARE CONCATENATED INTO THE LINKAGE SECTION**06340000
063500** DATA AREA.                                                   **06350000
063600******************************************************************06360000
063700 2310-RECEIVE-SCREEN.                                             06370000
063800     EXEC CICS                                                    06380000
063900          RECEIVE                                                 06390000
064000          INTO   (PV-SCREEN-DATA-AREA)                            06400000
064100          LENGTH (LENGTH OF PV-MAP-DATA-AREA)                     06410000
064200          RESP   (PV-CICS-RESPONSE)                               06420000
064300     END-EXEC.                                                    06430000
064400*                                                                 06440000
064500     IF  (PV-CICS-RESPONSE = DFHRESP(NORMAL)                      06450000
064600                          OR DFHRESP(MAPFAIL)                     06460000
064700                          OR DFHRESP(EOC))                        06470000
064800         CONTINUE                                                 06480000
064900     ELSE                                                         06490000
065000         SET DP030-RC-RECEIVE-SCREEN TO TRUE                      06500000
065100     END-IF.                                                      06510000
065200******************************************************************06520000
065300** RECEIVE THE APPLICATION MAPS FROM THE DATA AREA AND CONCAT-  **06530000
065400** ENATE INTO THE LINKAGE SECTION DATA AREA TO BE PASSED BACK   **06540000
065500** TO THE CALLING PROGRAM.                                      **06550000
065600******************************************************************06560000
065700 2320-RECEIVE-APPL-MAPS.                                          06570000
065800     IF  DP030-MAP-NAME (DP030-MAP-INDEX) = SPACE                 06580000
065900         SET DP020-MAP-INDEX    TO DP030-MAP-INDEX                06590000
066000         MOVE DP020-MAP-NAME (DP020-MAP-INDEX)                    06600000
066100                                TO DP030-MAP-NAME(DP030-MAP-INDEX)06610000
066200         MOVE DP020-MAP-LENGTH (DP020-MAP-INDEX)                  06620000
066300                                TO DP030-MAP-LENGTH               06630000
066400                                                 (DP030-MAP-INDEX)06640000
066500     END-IF.                                                      06650000
066600     MOVE DP030-MAP-NAME (DP030-MAP-INDEX)                        06660000
066700                                TO PV-CURRENT-MAP-NAME.           06670000
066800     PERFORM 2325-RECEIVE-MAP                                     06680000
066900*                                                                 06690000
067000**  CALCULATE POSITION OF DATA IN LS-MAP-DATA-AREA                06700000
067100*                                                                 06710000
067200     IF  DP030-MAP-INDEX = 1                                      06720000
067300         MOVE 1                  TO PV-MAP-START-BYTE             06730000
067400     ELSE                                                         06740000
067500         ADD DP030-MAP-LENGTH (DP030-MAP-INDEX - 1)               06750000
067600                                 TO PV-MAP-START-BYTE             06760000
067700     END-IF.                                                      06770000
067800     MOVE PV-MAP-DATA-AREA       TO LS-MAP-DATA-AREA              06780000
067900          (PV-MAP-START-BYTE:DP030-MAP-LENGTH(DP030-MAP-INDEX)).  06790000
068000*                                                                 06800000
068100*                                                                 06810000
068200 2325-RECEIVE-MAP.                                                06820000
068300     EXEC CICS                                                    06830000
068400         RECEIVE                                                  06840000
068500             MAP    (PV-CURRENT-MAP-NAME)                         06850000
068600             MAPSET (PV-CURRENT-MAPSET-NAME)                      06860000
068700             FROM   (PV-SCREEN-DATA-AREA)                         06870000
068800             INTO   (PV-MAP-DATA-AREA)                            06880000
068900             LENGTH (LENGTH OF PV-SCREEN-DATA-AREA)               06890000
069000             RESP   (PV-CICS-RESPONSE)                            06900000
069100     END-EXEC.                                                    06910000
069200*                                                                 06920000
069300     IF  (PV-CICS-RESPONSE = DFHRESP(NORMAL)                      06930000
069400                          OR DFHRESP(MAPFAIL))                    06940000
069500         CONTINUE                                                 06950000
069600     ELSE                                                         06960000
069700         SET DP030-RC-RECEIVE-MAP TO TRUE                         06970000
069800     END-IF.                                                      06980000
069900 2400-MNEMONIC-TO-AID.                                            06990000
070000                                                                  07000000
070100     PERFORM 2410-TRANSLATE-EIBAID.                               07010000
070200                                                                  07020000
070300     SET PS-AID-KEY-NOT-CONVERTED TO TRUE.                        07030000
070400                                                                  07040000
070500     IF ((PS-AID-SUCCESSFUL-COMPLETION)                           07050000
070600             AND (PV-SOURCE-AID-KEY = DP016-ENTER))               07060000
070700         PERFORM 2420-PARSE-NAVIGATION-COMMAND                    07070000
070800     END-IF.                                                      07080000
070900                                                                  07090000
071000*                                                                 07100000
071100*  MOVE THE PARAMETERS LIST, WITH RESPONSES INCLUDED, TO THE      07110000
071200*  LINKAGE SECTION, FOR PASSING BACK TO THE CALLING PROGRAM.      07120000
071300*                                                                 07130000
071400                                                                  07140000
071500                                                                  07150000
071600******************************************************************07160000
071700*  TRANSLATE THE PASSED EIBAID INTO A NUMERIC VALUE.  SET A      *07170000
071800*  RETURN CODE IF AN INVALID VALUE IS DETECTED.                  *07180000
071900******************************************************************07190000
072000                                                                  07200000
072100 2410-TRANSLATE-EIBAID.                                           07210000
072200                                                                  07220000
072300     EVALUATE TRUE                                                07230000
072400         WHEN EIBAID = DFHPF1                                     07240000
072500             MOVE DP016-PF1   TO PV-SOURCE-AID-KEY                07250000
072600         WHEN EIBAID = DFHPF2                                     07260000
072700             MOVE DP016-PF2   TO PV-SOURCE-AID-KEY                07270000
072800         WHEN EIBAID = DFHPF3                                     07280000
072900             MOVE DP016-PF3   TO PV-SOURCE-AID-KEY                07290000
073000         WHEN EIBAID = DFHPF4                                     07300000
073100             MOVE DP016-PF4   TO PV-SOURCE-AID-KEY                07310000
073200         WHEN EIBAID = DFHPF5                                     07320000
073300             MOVE DP016-PF5   TO PV-SOURCE-AID-KEY                07330000
073400         WHEN EIBAID = DFHPF6                                     07340000
073500             MOVE DP016-PF6   TO PV-SOURCE-AID-KEY                07350000
073600         WHEN EIBAID = DFHPF7                                     07360000
073700             MOVE DP016-PF7   TO PV-SOURCE-AID-KEY                07370000
073800         WHEN EIBAID = DFHPF8                                     07380000
073900             MOVE DP016-PF8   TO PV-SOURCE-AID-KEY                07390000
074000         WHEN EIBAID = DFHPF9                                     07400000
074100             MOVE DP016-PF9   TO PV-SOURCE-AID-KEY                07410000
074200         WHEN EIBAID = DFHPF10                                    07420000
074300             MOVE DP016-PF10  TO PV-SOURCE-AID-KEY                07430000
074400         WHEN EIBAID = DFHPF11                                    07440000
074500             MOVE DP016-PF11  TO PV-SOURCE-AID-KEY                07450000
074600         WHEN EIBAID = DFHPF12                                    07460000
074700             MOVE DP016-PF12  TO PV-SOURCE-AID-KEY                07470000
074800         WHEN EIBAID = DFHPF13                                    07480000
074900             MOVE DP016-PF13  TO PV-SOURCE-AID-KEY                07490000
075000         WHEN EIBAID = DFHPF14                                    07500000
075100             MOVE DP016-PF14  TO PV-SOURCE-AID-KEY                07510000
075200         WHEN EIBAID = DFHPF15                                    07520000
075300             MOVE DP016-PF15  TO PV-SOURCE-AID-KEY                07530000
075400         WHEN EIBAID = DFHPF16                                    07540000
075500             MOVE DP016-PF16  TO PV-SOURCE-AID-KEY                07550000
075600         WHEN EIBAID = DFHPF17                                    07560000
075700             MOVE DP016-PF17  TO PV-SOURCE-AID-KEY                07570000
075800         WHEN EIBAID = DFHPF18                                    07580000
075900             MOVE DP016-PF18  TO PV-SOURCE-AID-KEY                07590000
076000         WHEN EIBAID = DFHPF19                                    07600000
076100             MOVE DP016-PF19  TO PV-SOURCE-AID-KEY                07610000
076200         WHEN EIBAID = DFHPF20                                    07620000
076300             MOVE DP016-PF20  TO PV-SOURCE-AID-KEY                07630000
076400         WHEN EIBAID = DFHPF21                                    07640000
076500             MOVE DP016-PF21  TO PV-SOURCE-AID-KEY                07650000
076600         WHEN EIBAID = DFHPF22                                    07660000
076700             MOVE DP016-PF22  TO PV-SOURCE-AID-KEY                07670000
076800         WHEN EIBAID = DFHPF23                                    07680000
076900             MOVE DP016-PF23  TO PV-SOURCE-AID-KEY                07690000
077000         WHEN EIBAID = DFHPF24                                    07700000
077100             MOVE DP016-PF24  TO PV-SOURCE-AID-KEY                07710000
077200         WHEN EIBAID = DFHPA1                                     07720000
077300             MOVE DP016-PA1   TO PV-SOURCE-AID-KEY                07730000
077400         WHEN EIBAID = DFHPA2                                     07740000
077500             MOVE DP016-PA2   TO PV-SOURCE-AID-KEY                07750000
077600         WHEN EIBAID = DFHCLEAR                                   07760000
077700             MOVE DP016-CLEAR TO PV-SOURCE-AID-KEY                07770000
077800         WHEN EIBAID = DFHENTER                                   07780000
077900             MOVE DP016-ENTER TO PV-SOURCE-AID-KEY                07790000
078000         WHEN EIBAID = DFHPA3                                     07800000
078100             MOVE DP016-PA3   TO PV-SOURCE-AID-KEY                07810000
078200         WHEN OTHER                                               07820000
078300             INITIALIZE PV-SOURCE-AID-KEY                         07830000
078400             SET PS-AID-INVALID TO TRUE                           07840000
078500     END-EVALUATE.                                                07850000
078600                                                                  07860000
078700******************************************************************07870000
078800*  PARSE THE NAVIGATION COMMAND.  INTERROGATE FOR LITERALS THAT  *07880000
078900*  REPRESENT FUNCTION KEYS.  IF SUCH A LITERAL IS FOUND,         *07890000
079000*  CONVERT THE NUMERIC REPRESENTATION OF THE FUNCTION KEY TO     *07900000
079100*  THAT OF THE FUNCTION KEY IMPLIED BY THE NAVIGATION COMMAND.   *07910000
079200*  SET A SWITCH TO INDICATE THAT A CONVERSION HAS TAKEN PLACE.   *07920000
079300******************************************************************07930000
079400                                                                  07940000
079500 2420-PARSE-NAVIGATION-COMMAND.                                   07950000
079600     EVALUATE TRUE                                                07960000
079700         WHEN ((PV-NAVIGATION-MNEMONIC-1-2 NUMERIC)               07970000
079800                 AND (PV-FK-NUMBER-1-2 > ZERO)                    07980000
079900                 AND (PV-FK-NUMBER-1-2 NOT >                      07990000
080000                                      PC-MAXIMUM-FUNCTION-KEYS)   08000000
080100                 AND ((PV-NAVIGATION-MNEMONIC-3-8 = SPACES)       08010000
080200                 OR (PV-NAVIGATION-MNEMONIC-3-8 = LOW-VALUES)))   08020000
080300             MOVE PV-FK-NUMBER-1-2 TO PV-SOURCE-AID-KEY           08030000
080400             SET PS-AID-KEY-CONVERTED TO TRUE                     08040000
080500         WHEN ((PV-NAVIGATION-MNEMONIC-1 NUMERIC)                 08050000
080600                 AND (PV-FK-NUMBER-1 > ZERO)                      08060000
080700                 AND ((PV-NAVIGATION-MNEMONIC-2-8 = SPACES)       08070000
080800                 OR (PV-NAVIGATION-MNEMONIC-2-8 = LOW-VALUES)))   08080000
080900             MOVE PV-FK-NUMBER-1 TO PV-SOURCE-AID-KEY             08090000
081000             SET PS-AID-KEY-CONVERTED TO TRUE                     08100000
081100         WHEN PV-FUNCTION-KEY-F-LITERAL                           08110000
081200             IF ((PV-NAVIGATION-MNEMONIC-2-3 NUMERIC)             08120000
081300                     AND (PV-FK-NUMBER-2-3 > ZERO)                08130000
081400                     AND (PV-FK-NUMBER-2-3 NOT >                  08140000
081500                                      PC-MAXIMUM-FUNCTION-KEYS)   08150000
081600                     AND ((PV-NAVIGATION-MNEMONIC-4-8 = SPACES)   08160000
081700                     OR (PV-NAVIGATION-MNEMONIC-4-8 =             08170000
081800                                      LOW-VALUES)))               08180000
081900                 MOVE PV-FK-NUMBER-2-3 TO PV-SOURCE-AID-KEY       08190000
082000                 SET PS-AID-KEY-CONVERTED TO TRUE                 08200000
082100             ELSE                                                 08210000
082200                 IF ((PV-NAVIGATION-MNEMONIC-2 NUMERIC)           08220000
082300                         AND (PV-FK-NUMBER-2 > ZERO)              08230000
082400                         AND ((PV-NAVIGATION-MNEMONIC-3-8 =       08240000
082500                                                    SPACES)       08250000
082600                         OR (PV-NAVIGATION-MNEMONIC-3-8 =         08260000
082700                                                    LOW-VALUES))) 08270000
082800                     MOVE PV-FK-NUMBER-2 TO PV-SOURCE-AID-KEY     08280000
082900                     SET PS-AID-KEY-CONVERTED TO TRUE             08290000
083000                 ELSE                                             08300000
083100                     IF PV-PF8-MNEMONIC                           08310000
083200                         MOVE DP016-PF8   TO PV-SOURCE-AID-KEY    08320000
083300                         SET PS-AID-KEY-CONVERTED TO TRUE         08330000
083400                     END-IF                                       08340000
083500                 END-IF                                           08350000
083600             END-IF                                               08360000
083700         WHEN PV-FUNCTION-KEY-PF-LITERAL                          08370000
083800             IF ((PV-NAVIGATION-MNEMONIC-3-4 NUMERIC)             08380000
083900                     AND (PV-FK-NUMBER-3-4 > ZERO)                08390000
084000                     AND (PV-FK-NUMBER-3-4 NOT >                  08400000
084100                                      PC-MAXIMUM-FUNCTION-KEYS)   08410000
084200                     AND ((PV-NAVIGATION-MNEMONIC-5-8 = SPACES)   08420000
084300                     OR (PV-NAVIGATION-MNEMONIC-5-8 =             08430000
084400                                      LOW-VALUES)))               08440000
084500                 MOVE PV-FK-NUMBER-3-4 TO PV-SOURCE-AID-KEY       08450000
084600                 SET PS-AID-KEY-CONVERTED TO TRUE                 08460000
084700             ELSE                                                 08470000
084800                 IF ((PV-NAVIGATION-MNEMONIC-3 NUMERIC)           08480000
084900                         AND (PV-FK-NUMBER-3 > ZERO)              08490000
085000                         AND ((PV-NAVIGATION-MNEMONIC-4-8 =       08500000
085100                                                    SPACES)       08510000
085200                         OR (PV-NAVIGATION-MNEMONIC-4-8 =         08520000
085300                                                    LOW-VALUES))) 08530000
085400                     MOVE PV-FK-NUMBER-3 TO PV-SOURCE-AID-KEY     08540000
085500                     SET PS-AID-KEY-CONVERTED TO TRUE             08550000
085600                 END-IF                                           08560000
085700             END-IF                                               08570000
085800         WHEN PV-CLEAR-MNEMONIC                                   08580000
085900             MOVE DP016-CLEAR TO PV-SOURCE-AID-KEY                08590000
086000             SET PS-AID-KEY-CONVERTED TO TRUE                     08600000
086100         WHEN PV-PF8-MNEMONIC                                     08610000
086200             MOVE DP016-PF8   TO PV-SOURCE-AID-KEY                08620000
086300             SET PS-AID-KEY-CONVERTED TO TRUE                     08630000
086400         WHEN PV-PF7-MNEMONIC                                     08640000
086500             MOVE DP016-PF7   TO PV-SOURCE-AID-KEY                08650000
086600             SET PS-AID-KEY-CONVERTED TO TRUE                     08660000
086700         WHEN PV-PF6-MNEMONIC                                     08670000
086800             MOVE DP016-PF6   TO PV-SOURCE-AID-KEY                08680000
086900             SET PS-AID-KEY-CONVERTED TO TRUE                     08690000
087000         WHEN PV-PF5-MNEMONIC                                     08700000
087100             MOVE DP016-PF5   TO PV-SOURCE-AID-KEY                08710000
087200             SET PS-AID-KEY-CONVERTED TO TRUE                     08720000
087300         WHEN PV-PF3-MNEMONIC                                     08730000
087400             MOVE DP016-PF3   TO PV-SOURCE-AID-KEY                08740000
087500             SET PS-AID-KEY-CONVERTED TO TRUE                     08750000
087600         WHEN PV-PA2-MNEMONIC                                     08760000
087700             MOVE DP016-PA2   TO PV-SOURCE-AID-KEY                08770000
087800             SET PS-AID-KEY-CONVERTED TO TRUE                     08780000
087900     END-EVALUATE.                                                08790000
088000******************************************************************08800000
088100**  CHECK FOR PF3 ON EXIT IN CASE THE APPLICATION PROGRAM       **08810000
088200**  EXPLICITLY SET PF3 IN ORDER TO EMULATE THE PRESSING OF PF3. **08820000
088300**                                                              **08830000
088400******************************************************************08840000
088500*                                                                 08850000
088600 4000-EXIT-PROCESSING.                                            08860000
088700     IF  DP020-NEXT-ACT-APPL-ERROR                                08870000
088800         PERFORM 4100-START-NAVIGATOR                             08880000
088900     ELSE                                                         08890000
089000         IF  ((DP020-SRC-AID > ZERO)                              08900000
089100           AND ((DP020-FK-RETURN (DP020-SRC-AID))                 08910000
089200           OR (DP020-NEXT-ACT-APPL-ERROR)                         08920000
089300           OR ((DP020-FK-LOCAL-GOTO (DP020-SRC-AID))              08930000
089400               AND (DP030-CONTINUE-GO))                           08940000
089500           OR ((DP020-FK-DISPN-GO   (DP020-SRC-AID))              08950000
089600               AND (DP030-CONTINUE-GO))                           08960000
089700           OR ((DP020-FK-LOCAL-RETURN (DP020-SRC-AID))            08970000
089800               AND (DP030-CONTINUE-GO))                           08980000
089810           OR ((DP020-FK-DISPN-RETURN (DP020-SRC-AID))            08981000
089820               AND (DP030-CONTINUE-GO))))                         08982000
089830             PERFORM 4100-START-NAVIGATOR                         08983000
089840         ELSE                                                     08984000
089850             IF  DP020-NEXT-ACT-INITIAL                           08985000
089860                 INITIALIZE DP020-NAV-KEY-DATA                    08986000
089870                            DP020-NAV-MNEMONIC                    08987000
089880             END-IF                                               08988000
089890             PERFORM 9000-DISPLAY-PANEL                           08989000
089900             PERFORM 9900-RETURN-TO-CICS                          08990000
090000         END-IF                                                   09000000
090100     END-IF.                                                      09010000
090200 EJECT                                                            09020000
090300******************************************************************09030000
090400** START THE NAVIGATOR TO LEAVE THIS TRANSACTION                **09040000
090500******************************************************************09050000
090600*                                                                 09060000
090700 4100-START-NAVIGATOR.                                            09070000
090800     SET DP020-SRC-RETURN-W-O-TRAN-ID TO TRUE.                    09080000
090900                                                                  09090000
980824     EXEC CICS                                                    09171011
980824         RETURN IMMEDIATE                                         09172011
980824             TRANSID  (PC-NAVIGATOR-TRAN-ID)                      09173011
980824             COMMAREA (DP020-STANDARD-COMMAREA)                   09174011
980824             LENGTH   (DP020-COMMAREA-LENGTH)                     09175011
980824             RESP     (PV-CICS-RESPONSE)                          09177011
980824     END-EXEC.                                                    09178011
091800                                                                  09180000
091900     IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                    09190000
092000         SET DP030-RC-START-NAVIGATOR TO TRUE                     09200000
092100     ELSE                                                         09210000
092200         PERFORM 9900-RETURN-TO-CICS                              09220000
092300     END-IF.                                                      09230000
092400 EJECT                                                            09240000
092500******************************************************************09250000
092600** THIS MODULE WILL FORMAT THE DATA IN THE 'SYSTEM' (HEADER AND **09260000
092700** TRAILER MAPS) AND SEND THE SYSTEM AND APPLICATION MAPS.      **09270000
092800******************************************************************09280000
092900 9000-DISPLAY-PANEL.                                              09290000
093000     PERFORM 9100-FORMAT-TITLE-LINES.                             09300000
093100     PERFORM 9200-LOAD-FK-LINES.                                  09310000
093200     PERFORM 9300-FORMAT-MSG-LINES.                               09320000
093300     PERFORM 9400-WRITE-PANEL.                                    09330000
093400*                                                                 09340000
093500*                                                                 09350000
093600 9100-FORMAT-TITLE-LINES.                                         09360000
093700     PERFORM 9110-GET-CURR-DATE-TIME.                             09370000
093800     MOVE DT-FORMATTED-TIME             TO ATIMEO.                09380000
093900     MOVE DT-FORMATTED-DATE             TO ADATEO.                09390000
094000     MOVE DP020-PANEL-TITLE             TO ATITLEO.               09400000
094100     MOVE DP020-NETNAME                 TO ANETNAMO.              09410000
094200     MOVE DP020-SRC-MNEMONIC            TO AMNEMICO.              09420000
094300*                                                                 09430000
094400*                                                                 09440000
094500 9110-GET-CURR-DATE-TIME.                                         09450000
094600     EXEC CICS                                                    09460000
094700         ASKTIME                                                  09470000
094800             ABSTIME (DT-ABSTIME)                                 09480000
094900     END-EXEC.                                                    09490000
095000                                                                  09500000
095100     EXEC CICS                                                    09510000
095200         FORMATTIME                                               09520000
095300             ABSTIME (DT-ABSTIME)                                 09530000
095400             MMDDYY  (DT-FORMATTED-MMDDYY)                        09540000
095500             DATESEP                                              09550000
095600             TIME    (DT-FORMATTED-TIME)                          09560000
095700             TIMESEP                                              09570000
095800     END-EXEC.                                                    09580000
095900*                                                                 09590000
096000     EXEC CICS                                                    09600000
096100         FORMATTIME                                               09610000
096200             ABSTIME (DT-ABSTIME)                                 09620000
096300             YEAR    (DT-YEAR-BIN)                                09630000
096400     END-EXEC.                                                    09640000
096500     MOVE DT-YEAR-BIN   TO DT-FORMATTED-YYYY.                     09650000
096600*                                                                 09660000
096700*                                                                 09670000
096800 9200-LOAD-FK-LINES.                                              09680000
096900     INITIALIZE FKEY-FUNCTION-KEY-AREA.                           09690000
097000                                                                  09700000
097100     IF DP020-SRC-AID = DP016-PA2                                 09710000
097200         IF DP020-FK-DISPLAY-13-24                                09720000
097300             SET DP020-FK-DISPLAY-1-12 TO TRUE                    09730000
097400         ELSE                                                     09740000
097500             SET DP020-FK-DISPLAY-13-24 TO TRUE                   09750000
097600         END-IF                                                   09760000
097700     END-IF.                                                      09770000
097800                                                                  09780000
097900     IF  DP020-FK-DISPLAY-13-24                                   09790000
098000         SET PC-FK-TAG-INDEX                                      09800000
098100             DP020-FK-INDEX TO PC-START-FK-DISPLAY-13-24          09810000
098200     ELSE                                                         09820000
098300         SET PC-FK-TAG-INDEX                                      09830000
098400             DP020-FK-INDEX TO PC-START-FK-DISPLAY-1-12           09840000
098500     END-IF.                                                      09850000
098600                                                                  09860000
098700     PERFORM                                                      09870000
098800             VARYING FKEY-INDEX                                   09880000
098900             FROM 1 BY 1                                          09890000
099000             UNTIL FKEY-INDEX > PC-MAXIMUM-FKS-PER-LINE           09900000
099100         MOVE PC-FUNCTION-KEY-TAG (PC-FK-TAG-INDEX) TO            09910000
099200                  FKEY-FUNCTION-KEY-TAG-LITERAL (FKEY-INDEX)      09920000
099300         SET FKEY-FUNCTION-KEY-EQUAL-SIGN (FKEY-INDEX) TO         09930000
099400                  TRUE                                            09940000
099500         MOVE DP020-FK-MNEMONIC (DP020-FK-INDEX) TO               09950000
099600                  FKEY-FUNCTION-KEY-MNEMONIC (FKEY-INDEX)         09960000
099700         SET PC-FK-TAG-INDEX                                      09970000
099800             DP020-FK-INDEX UP BY 1                               09980000
099900     END-PERFORM.                                                 09990000
100000                                                                  10000000
100100     MOVE FKEY-FUNCTION-KEY-LINE-1 TO BFKLIN1O.                   10010000
100200     MOVE FKEY-FUNCTION-KEY-LINE-2 TO BFKLIN2O.                   10020000
100300                                                                  10030000
100400******************************************************************10040000
100500**                                                              **10050000
100600**  FORMAT THE MESSAGE LINE USING THE MESSAGE NUMBER AND        **10060000
100700**  SEVERITY LEVEL AS SET IN THE GLOBAL COMMAREA.               **10070000
100800**                                                              **10080000
100900******************************************************************10090000
101000 9300-FORMAT-MSG-LINES.                                           10100000
101100     IF  DP020-MSG-NUMBER-X IS NUMERIC                            10110000
101200         IF  DP020-MSG-NUMBER > ZERO                              10120000
101300             MOVE DP020-MSG-NUMBER  TO DP507I-MSG-NUMBER          10130000
101400             PERFORM 9310-FORMAT-SYS-MESSAGE                      10140000
101500         ELSE                                                     10150000
101600             IF  DP020-MSG-TEXT = SPACE                           10160000
101700                 MOVE SPACE     TO DP020-MSG-MESSAGE              10170000
101800             END-IF                                               10180000
101900         END-IF                                                   10190000
102000     END-IF.                                                      10200000
102100*                                                                 10210000
102200     MOVE DP020-MSG-MESSAGE     TO BMSGO.                         10220000
102300     MOVE DP015-PRO-BRT-OFF     TO BMSGA.                         10230000
102400     MOVE DP015-HL-OFF          TO BMSGH.                         10240000
102500     EVALUATE TRUE                                                10250000
102600         WHEN DP020-MSG-INFORMATIONAL                             10260000
102700             MOVE DP015-BLUE    TO BMSGC                          10270000
102800         WHEN DP020-MSG-WARNING                                   10280000
102900             MOVE DP015-YELLOW  TO BMSGC                          10290000
103000         WHEN DP020-MSG-FATAL                                     10300000
103100             MOVE DP015-RED     TO BMSGC                          10310000
103200     END-EVALUATE.                                                10320000
103300                                                                  10330000
103400     MOVE SPACE                 TO DP020-MSG-MESSAGE.             10340000
103500*                                                                 10350000
103600*                                                                 10360000
103700 9310-FORMAT-SYS-MESSAGE.                                         10370000
103800     PERFORM 9311-READ-SYSTEM-MESSAGE.                            10380000
103801     MOVE ZERO                 TO PV-CHAR-POS.                    10380101
103810     INSPECT DP507I-MSG-TEXT                                      10381001
103820         TALLYING PV-TALLY-CNT                                    10382002
103830         FOR ALL PC-MSG-VAR-IND.                                  10383001
103900     IF  PV-TALLY-CNT > ZERO                                      10390004
104000         PERFORM 9312-SUBSTITUTE-MSG-VAR                          10400000
104100     ELSE                                                         10410000
104200         MOVE DP507I-MSG-TEXT  TO DP020-MSG-TEXT                  10420000
104300     END-IF.                                                      10430000
104400     SET DP020-MSG-DASH-1                                         10440000
104500         DP020-MSG-DASH-2 TO TRUE.                                10450000
104600*                                                                 10460000
104700     EVALUATE TRUE                                                10470000
104800         WHEN DP020-MSG-INFORMATIONAL                             10480000
104900             MOVE 'I'           TO DP020-MSG-LEVEL                10490000
105000         WHEN DP020-MSG-WARNING                                   10500000
105100             MOVE 'W'           TO DP020-MSG-LEVEL                10510000
105200         WHEN DP020-MSG-FATAL                                     10520000
105300             MOVE 'E'           TO DP020-MSG-LEVEL                10530000
105400     END-EVALUATE.                                                10540000
105500*                                                                 10550000
105600******************************************************************10560000
105700**   READ A SYSTEM MESSAGE RECORD                               **10570000
105800******************************************************************10580000
105900 9311-READ-SYSTEM-MESSAGE.                                        10590000
106000     EXEC CICS READ                                               10600000
106100               DATASET ('DPSYSMSG')                               10610000
106200               RIDFLD  (DP507I-MSG-NUMBER)                        10620000
106300               INTO    (DP507I-MESSAGES-INPUT-RECORD)             10630000
106400               RESP    (PV-CICS-RESPONSE)                         10640000
106500     END-EXEC.                                                    10650000
106600*                                                                 10660000
106700     IF  PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                   10670000
106800         MOVE ' ** ABEND **   UNABLE TO TRANSLATE MESSAGE NUMBER' 10680000
106900                                TO DP507I-MSG-TEXT                10690000
107000     END-IF.                                                      10700000
107100                                                                  10710000
107200******************************************************************10720000
107300** THIS PARAGRAPH WILL SUBSTITUTE '&VAR' FOUND IN MESSAGE TEXT  **10730000
107400** WITH THE TEXT ENTERED IN DP020-MSG-TEXT.  FIRST UNSTRING THE **10740000
107500** THE SYSTEM MESSAGE TEXT UNTIL THE SYMBOLIC IS FOUND, THEN    **10750000
107600** PUT IN THE DATA FROM DP020-MSG-TEXT AND THEN TACK ON THE     **10760000
107700** REMAINDER OF THE SYSTEM MESSAGE.                             **10770000
107800******************************************************************10780000
107900 9312-SUBSTITUTE-MSG-VAR.                                         10790000
108000     MOVE +1             TO PV-MSG-VAR-LEAD-SPACE.                10800000
108100     MOVE DP020-MSG-TEXT TO PV-MSG-VAR-SAVE.                      10810000
108200     INITIALIZE DP020-MSG-TEXT                                    10820000
108300                PV-MSG-VAR-IND                                    10830000
108400                PV-MSG-STRING-PTR                                 10840005
108500                PV-MSG-REMAINDER.                                 10850000
108600*                                                                 10860000
108700     UNSTRING DP507I-MSG-TEXT DELIMITED BY PC-MSG-VAR-IND         10870000
108800         INTO DP020-MSG-TEXT                                      10880000
108900                 DELIMITER IN PV-MSG-VAR-IND                      10890000
109000                 COUNT     IN PV-MSG-STRING-PTR                   10900005
109100              PV-MSG-REMAINDER                                    10910000
109200     END-UNSTRING.                                                10920000
109300*                                                                 10930000
109400     IF  PV-MSG-STRING-PTR > ZERO                                 10940005
109500         ADD +1            TO PV-MSG-STRING-PTR                   10950005
109700     ELSE                                                         10970000
109800         MOVE +1           TO PV-MSG-STRING-PTR                   10980000
109900     END-IF.                                                      10990000
110000*                                                                 11000000
110100     IF  PV-MSG-VAR-SAVE > SPACE                                  11010000
110200         IF  PV-MSG-VAR-SAVE(1:1) > SPACE                         11020000
110300             CONTINUE                                             11030000
110400         ELSE                                                     11040000
110500             INSPECT PV-MSG-VAR-SAVE                              11050000
110600                 TALLYING PV-MSG-VAR-LEAD-SPACE                   11060000
110610                 FOR LEADING SPACE                                11061000
110620         END-IF                                                   11062000
110630     ELSE                                                         11063000
110640         MOVE '?'         TO PV-MSG-VAR-SAVE                      11064000
110650     END-IF.                                                      11065000
110660*==> FIND LAST NON-BLANK CHARACTER OF THE MSG VAR.                11066000
110670     MOVE LENGTH OF PV-MSG-VAR-SAVE                               11067000
110680                          TO PV-MSG-VAR-LENGTH.                   11068000
110690     PERFORM                                                      11069000
110691         VARYING PV-CHAR-POS                                      11069100
110692         FROM PV-MSG-VAR-LENGTH                                   11069200
110693         BY -1                                                    11069300
110694         UNTIL PV-CHAR-POS < 1                                    11069400
110695           OR PV-MSG-VAR-SAVE(PV-CHAR-POS:1) > SPACE              11069500
110696             CONTINUE                                             11069600
110697     END-PERFORM.                                                 11069700
110698     COMPUTE PV-MSG-VAR-LENGTH =                                  11069800
110699         PV-CHAR-POS - PV-MSG-VAR-LEAD-SPACE + 1.                 11069900
110700*                                                                 11070000
110703     IF  PV-MSG-STRING-PTR < LENGTH OF DP020-MSG-TEXT             11070307
110706         MOVE PV-MSG-VAR-SAVE                                     11070605
110707                   (PV-MSG-VAR-LEAD-SPACE:PV-MSG-VAR-LENGTH)      11070700
110708                           TO DP020-MSG-TEXT(PV-MSG-STRING-PTR:)  11070805
110709     END-IF.                                                      11070905
110710     ADD PV-MSG-VAR-LENGTH TO PV-MSG-STRING-PTR.                  11071000
110711     IF  PV-MSG-STRING-PTR < LENGTH OF DP020-MSG-TEXT             11071107
110714         MOVE PV-MSG-REMAINDER                                    11071405
110715                           TO DP020-MSG-TEXT(PV-MSG-STRING-PTR:)  11071505
110716     END-IF.                                                      11071605
110717 EJECT                                                            11071700
110718******************************************************************11071800
110719** THIS PARAGRAPH WILL SEND THE HEADER AND TRAILER 'SYSTEM' MAPS**11071900
110720** AND 1 TO 6 APPLICATION MAPS PASSED FROM THE CALLING PROGRAM. **11072000
110721** ERASE COMMANDS, IF NEEDED, ARE SENT BEFORE THE MAPS USING A  **11072100
110722** 'SEND CONTROL'.  THE HEADER MAP IS THEN SENT.  1 TO 6 APPLI- **11072200
110730** CATION MAPS ARE THEN SENT.  THE DSECT LAYOUT(S) MUST BE      **11073000
110740** PASSED, CONCATENATED, IN THE LINKAGE SECTION DATA AREA.      **11074000
110750** THE TRAILER MAP IS SENT.  IF ABSOLUTE CURSOR POSITIONING IS  **11075000
110760** TO BE USED, THAT IS DONE USING A 'SEND CONTROL' AND AN ALARM **11076000
110770** CAN BE SOUNDED, ALSO USING A 'SEND CONTROL'.                 **11077000
110780******************************************************************11078000
110790 9400-WRITE-PANEL.                                                11079000
110800     IF  DP030-ERASE                                              11080000
110900         EXEC CICS                                                11090000
111000             SEND CONTROL                                         11100000
111100                 ERASE                                            11110000
111200         END-EXEC                                                 11120000
111300         SET PS-SYS-SEND-MAP-AND-DATA TO TRUE                     11130000
111400     ELSE                                                         11140000
111500         IF  DP030-ERASE-UNPROT                                   11150000
111600             EXEC CICS                                            11160000
111700                 SEND CONTROL                                     11170000
111800                     ERASEAUP                                     11180000
111900             END-EXEC                                             11190000
112000         END-IF                                                   11200000
112100     END-IF.                                                      11210000
112200*                                                                 11220000
112300     SET PS-NO-INSERT-CURSOR     TO TRUE.                         11230000
112400     MOVE PC-STATIC-MAPSET-NAME  TO PV-CURRENT-MAPSET-NAME.       11240000
112500     MOVE PC-HEADER-MAP-NAME     TO PV-CURRENT-MAP-NAME.          11250000
112600     MOVE DP030AO                TO PV-MAP-DATA-AREA.             11260000
112700     MOVE LENGTH OF DP030AO      TO PV-MAP-LENGTH.                11270000
112800     MOVE PS-SYS-SEND-TYPE-IND   TO PS-SEND-TYPE-IND.             11280000
112900     PERFORM 9415-SEND-MAP.                                       11290000
113000*                                                                 11300000
113100     IF  DP020-SRC-AID = DP016-PA2                                11310000
113200                      OR DP016-PA3                                11320000
113300         CONTINUE                                                 11330000
113400     ELSE                                                         11340000
113500         MOVE DP030-MAPSET-NAME      TO PV-CURRENT-MAPSET-NAME    11350000
113600         PERFORM 9410-SEND-APPL-MAPS                              11360000
113700             VARYING DP030-MAP-INDEX                              11370000
113800             FROM 1 BY 1                                          11380000
113900             UNTIL DP030-MAP-INDEX > DP030-NUMBER-OF-MAPS         11390000
114000     END-IF.                                                      11400000
114100*                                                                 11410000
114200     IF  DP030-SET-CURSOR-TRAILER                                 11420000
114300         SET PS-INSERT-CURSOR TO TRUE                             11430000
114400         MOVE -1 TO BNAVCMDL                                      11440000
114500     ELSE                                                         11450000
114600         SET PS-NO-INSERT-CURSOR TO TRUE                          11460000
114700     END-IF.                                                      11470000
114800*                                                                 11480000
114900     MOVE PC-STATIC-MAPSET-NAME  TO PV-CURRENT-MAPSET-NAME.       11490000
115000     MOVE PC-TRAILER-MAP-NAME    TO PV-CURRENT-MAP-NAME.          11500000
115100     MOVE DP030BO                TO PV-MAP-DATA-AREA.             11510000
115200     MOVE LENGTH OF DP030BO      TO PV-MAP-LENGTH.                11520000
115300     MOVE PS-SYS-SEND-TYPE-IND   TO PS-SEND-TYPE-IND.             11530000
115400*                                                                 11540000
115500     PERFORM 9415-SEND-MAP.                                       11550000
115600     PERFORM 9420-SEND-PAGE.                                      11560000
115700     IF  DP030-SET-CURSOR-ABSOLUTE                                11570000
115800         EXEC CICS                                                11580000
115900             SEND CONTROL                                         11590000
116000                 CURSOR (DP030-CURSOR-POSITION)                   11600000
116100         END-EXEC                                                 11610000
116200     END-IF.                                                      11620000
116300*                                                                 11630000
116400     IF  DP030-SEND-ALARM                                         11640000
116500         EXEC CICS                                                11650000
116600             SEND CONTROL                                         11660000
116700                 ALARM                                            11670000
116800         END-EXEC                                                 11680000
116900     END-IF.                                                      11690000
117000*                                                                 11700000
117100******************************************************************11710000
117200** THIS MODULE SENDS THE APPLICATION MAP(S).  IF MULTIPLE       **11720000
117300** APPLICATION MAPS ARE BEING SENT, THE SYMBOLIC MAPS (DSECTS)  **11730000
117400** ARE CONCATENATED IN THE 'LS-MAP-DATA-AREA' AND HAVE TO BE    **11740000
117500** BROUGHT OUT AND PUT INTO PV-MAP-DATA-AREA ONE MAP AT A TIME  **11750000
117600** TO BE ACTED UPON BY THE SEND PARAGRAPH.                      **11760000
117700**                                                              **11770000
117800** IF A AN INVALID FUNCTION KEY WAS PRESSED (MNEMONIC = SPACE)  **11780000
117900** OR IF PA2 WAS PRESSED, NO APPLICATION MAPS WILL BE SENT.     **11790000
118000**                                                              **11800000
118100******************************************************************11810000
118200*                                                                 11820000
118300 9410-SEND-APPL-MAPS.                                             11830000
118400     SET DP020-MAP-INDEX         TO DP030-MAP-INDEX.              11840000
118500     MOVE DP030-MAP-NAME (DP030-MAP-INDEX)                        11850000
118600                                 TO PV-CURRENT-MAP-NAME.          11860000
118700     IF  DP030-NUMBER-OF-MAPS > 1                                 11870000
118800         IF  DP030-MAP-NAME (DP030-MAP-INDEX) > SPACE             11880000
118900             MOVE DP030-MAP-NAME (DP030-MAP-INDEX)                11890000
119000                                 TO DP020-MAP-NAME                11900000
119100                                                (DP020-MAP-INDEX) 11910000
119200             MOVE DP030-MAP-LENGTH (DP030-MAP-INDEX)              11920000
119300                                 TO DP020-MAP-LENGTH              11930000
119400                                                (DP020-MAP-INDEX) 11940000
119500         END-IF                                                   11950000
119600     END-IF.                                                      11960000
119700     MOVE DP030-SEND-TYPE-IND (DP030-MAP-INDEX)                   11970000
119800                                 TO PS-SEND-TYPE-IND.             11980000
119900     IF  DP030-MAP-INDEX = 1                                      11990000
120000         MOVE 1                  TO PV-MAP-START-BYTE             12000000
120100     ELSE                                                         12010000
120200         ADD DP030-MAP-LENGTH (DP030-MAP-INDEX - 1)               12020000
120300                                 TO PV-MAP-START-BYTE             12030000
120400     END-IF.                                                      12040000
120500     MOVE LS-MAP-DATA-AREA                                        12050000
120600          (PV-MAP-START-BYTE:DP030-MAP-LENGTH(DP030-MAP-INDEX))   12060000
120700                                 TO PV-MAP-DATA-AREA.             12070000
120800     MOVE DP030-MAP-LENGTH (DP030-MAP-INDEX)                      12080000
120900                                 TO PV-MAP-LENGTH.                12090000
121000     IF  (PS-DONT-SEND                                            12100000
121100       OR (DP020-SRC-AID > ZERO                                   12110000
121200       AND DP020-FK-MNEMONIC (DP020-SRC-AID) = SPACE)             12120000
121300       OR DP020-SRC-AID = DP016-PA2)                              12130000
121400         CONTINUE                                                 12140000
121500     ELSE                                                         12150000
121600         SET PS-NO-INSERT-CURSOR TO TRUE                          12160000
121700         IF  DP030-SET-CURSOR-TRAILER                             12170000
121800           OR  DP030-SET-CURSOR-ABSOLUTE                          12180000
121900             CONTINUE                                             12190000
122000         ELSE                                                     12200000
122100             EVALUATE DP030-MAP-INDEX ALSO TRUE                   12210000
122200             WHEN +1 ALSO DP030-SET-CURSOR-APPL-1                 12220000
122300                 SET PS-INSERT-CURSOR TO TRUE                     12230000
122400             WHEN +2 ALSO DP030-SET-CURSOR-APPL-2                 12240000
122500                 SET PS-INSERT-CURSOR TO TRUE                     12250000
122600             WHEN +3 ALSO DP030-SET-CURSOR-APPL-3                 12260000
122700                 SET PS-INSERT-CURSOR TO TRUE                     12270000
122800             WHEN +4 ALSO DP030-SET-CURSOR-APPL-4                 12280000
122900                 SET PS-INSERT-CURSOR TO TRUE                     12290000
123000             WHEN +5 ALSO DP030-SET-CURSOR-APPL-5                 12300000
123100                 SET PS-INSERT-CURSOR TO TRUE                     12310000
123200             WHEN +6 ALSO DP030-SET-CURSOR-APPL-6                 12320000
123300                 SET PS-INSERT-CURSOR TO TRUE                     12330000
123400             END-EVALUATE                                         12340000
123500         END-IF                                                   12350000
123600         PERFORM 9415-SEND-MAP                                    12360000
123700     END-IF.                                                      12370000
123800*                                                                 12380000
123900*                                                                 12390000
124000 9415-SEND-MAP.                                                   12400000
124100     EVALUATE TRUE                                                12410000
124200         WHEN PS-SEND-MAP-AND-DATA                                12420000
124300             IF  PS-INSERT-CURSOR                                 12430000
124400                 EXEC CICS                                        12440000
124500                     SEND                                         12450000
124600                         MAP    (PV-CURRENT-MAP-NAME)             12460000
124700                         MAPSET (PV-CURRENT-MAPSET-NAME)          12470000
124800                         FROM   (PV-MAP-DATA-AREA)                12480000
124900                         LENGTH (PV-MAP-LENGTH)                   12490000
125000                         ACCUM                                    12500000
125100                         FREEKB                                   12510000
125200                         CURSOR                                   12520000
125300                         FORMFEED                                 12530000
125400                         RESP   (PV-CICS-RESPONSE)                12540000
125500                 END-EXEC                                         12550000
125600                 IF  PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)       12560000
125700                     SET DP030-RC-SEND-BOTH-CURSOR TO TRUE        12570000
125800                 END-IF                                           12580000
125900             ELSE                                                 12590000
126000                 EXEC CICS                                        12600000
126100                     SEND                                         12610000
126200                         MAP    (PV-CURRENT-MAP-NAME)             12620000
126300                         MAPSET (PV-CURRENT-MAPSET-NAME)          12630000
126400                         FROM   (PV-MAP-DATA-AREA)                12640000
126500                         LENGTH (PV-MAP-LENGTH)                   12650000
126600                         ACCUM                                    12660000
126700                         FREEKB                                   12670000
126800                         FORMFEED                                 12680000
126900                         RESP   (PV-CICS-RESPONSE)                12690000
127000                 END-EXEC                                         12700000
127100                 IF  PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)       12710000
127200                     SET DP030-RC-SEND-BOTH TO TRUE               12720000
127300                 END-IF                                           12730000
127400             END-IF                                               12740000
127500         WHEN PS-SEND-DATAONLY                                    12750000
127600             IF  PS-INSERT-CURSOR                                 12760000
127700                 EXEC CICS                                        12770000
127800                     SEND                                         12780000
127900                         MAP    (PV-CURRENT-MAP-NAME)             12790000
128000                         MAPSET (PV-CURRENT-MAPSET-NAME)          12800000
128100                         FROM   (PV-MAP-DATA-AREA)                12810000
128200                         LENGTH (PV-MAP-LENGTH)                   12820000
128300                         DATAONLY                                 12830000
128400                         ACCUM                                    12840000
128500                         FREEKB                                   12850000
128600                         CURSOR                                   12860000
128700                         FORMFEED                                 12870000
128800                         RESP   (PV-CICS-RESPONSE)                12880000
128900                 END-EXEC                                         12890000
129000                 IF  PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)       12900000
129100                     SET DP030-RC-SEND-DATA-CURSOR TO TRUE        12910000
129200                 END-IF                                           12920000
129300             ELSE                                                 12930000
129400                 EXEC CICS                                        12940000
129500                     SEND                                         12950000
129600                         MAP    (PV-CURRENT-MAP-NAME)             12960000
129700                         MAPSET (PV-CURRENT-MAPSET-NAME)          12970000
129800                         FROM   (PV-MAP-DATA-AREA)                12980000
129900                         LENGTH (PV-MAP-LENGTH)                   12990000
130000                         DATAONLY                                 13000000
130100                         ACCUM                                    13010000
130200                         FREEKB                                   13020000
130300                         FORMFEED                                 13030000
130400                         RESP   (PV-CICS-RESPONSE)                13040000
130500                 END-EXEC                                         13050000
130600                 IF  PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)       13060000
130700                     SET DP030-RC-SEND-DATA TO TRUE               13070000
130800                 END-IF                                           13080000
130900             END-IF                                               13090000
131000         WHEN PS-SEND-MAPONLY                                     13100000
131100             IF  PS-INSERT-CURSOR                                 13110000
131200                 EXEC CICS                                        13120000
131300                     SEND                                         13130000
131400                         MAP    (PV-CURRENT-MAP-NAME)             13140000
131500                         MAPSET (PV-CURRENT-MAPSET-NAME)          13150000
131600                         MAPONLY                                  13160000
131700                         ACCUM                                    13170000
131800                         FREEKB                                   13180000
131900                         CURSOR                                   13190000
132000                         FORMFEED                                 13200000
132100                         RESP   (PV-CICS-RESPONSE)                13210000
132200                 END-EXEC                                         13220000
132300                 IF  PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)       13230000
132400                     SET DP030-RC-SEND-MAP-CURSOR TO TRUE         13240000
132500                 END-IF                                           13250000
132600             ELSE                                                 13260000
132700                 EXEC CICS                                        13270000
132800                     SEND                                         13280000
132900                         MAP    (PV-CURRENT-MAP-NAME)             13290000
133000                         MAPSET (PV-CURRENT-MAPSET-NAME)          13300000
133100                         MAPONLY                                  13310000
133200                         ACCUM                                    13320000
133300                         FREEKB                                   13330000
133400                         FORMFEED                                 13340000
133500                         RESP   (PV-CICS-RESPONSE)                13350000
133600                 END-EXEC                                         13360000
133700                 IF  PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)       13370000
133800                     SET DP030-RC-SEND-MAP TO TRUE                13380000
133900                 END-IF                                           13390000
134000             END-IF                                               13400000
134100     END-EVALUATE.                                                13410000
134200*                                                                 13420000
134300     SET DP020-NEXT-ACT-READ-MAP TO TRUE.                         13430000
134400*                                                                 13440000
134500*                                                                 13450000
134600 9420-SEND-PAGE.                                                  13460000
134700     EXEC CICS                                                    13470000
134800         SEND PAGE                                                13480000
134900              RESP   (PV-CICS-RESPONSE)                           13490000
135000     END-EXEC.                                                    13500000
135100*                                                                 13510000
135200     IF  PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                   13520000
135300         SET DP030-RC-SEND-PAGE TO TRUE                           13530000
135400     END-IF.                                                      13540000
135500                                                                  13550000
135600 EJECT                                                            13560000
135700******************************************************************13570000
135800*  A RETURN WILL BE ISSUED WITH OR WITHOUT A TRANSACTION ID,      13580000
135900*  DEPENDING ON THE SETTING OF A STANDARD COMMAREA SWITCH.  IF    13590000
136000*  ANY TRANSACTION IS STARTED ON THE SAME TERMINAL DURING THE     13600000
136100*  EXECUTION OF THE CURRENT TRANSACTION, THE SWITCH WILL BE SET   13610000
136200*  TO RETURN WITHOUT TRANSACTION ID TO TERMINATE THE CURRENT      13620000
136300*  TRANSACTION.                                                   13630000
136400******************************************************************13640000
136500                                                                  13650000
136600 9900-RETURN-TO-CICS.                                             13660000
136700     IF DP020-SRC-RETURN-W-TRAN-ID                                13670000
136800         EXEC CICS                                                13680000
136900             RETURN                                               13690000
137000                 TRANSID  (DP020-SRC-TRAN-ID)                     13700000
137100                 COMMAREA (DP020-STANDARD-COMMAREA)               13710000
137200                 LENGTH   (DP020-COMMAREA-LENGTH)                 13720000
137300         END-EXEC                                                 13730000
137400     ELSE                                                         13740000
137500         EXEC CICS                                                13750000
137600             RETURN                                               13760000
137700         END-EXEC                                                 13770000
137800     END-IF.                                                      13780000
137900*9900-EXIT.                                                       13790000
