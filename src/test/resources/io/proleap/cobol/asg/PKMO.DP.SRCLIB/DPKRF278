000100 IDENTIFICATION DIVISION.                                                 
000200                                                                          
000300 PROGRAM-ID.             DPKRF278.                                        
000400 AUTHOR.                 DENNIS STEFFEN.                                  
000500 INSTALLATION.           KOHLS.                                           
000600 DATE-WRITTEN            AUTUMN, 2000.                                    
000700 DATE-COMPILED.                                                           
000800                                                                          
000900* MANIFESTING PROJECT TRAN-ID = Z278                                      
001000* GENERIC HELP SCREEN SHOWING PROGRAM NAME AND COMPILE DATE               
001100* ACCESSED FROM CALLING PROGRAM VIA PF1                                   
001200                                                                          
001300 ENVIRONMENT DIVISION.                                                    
001400 DATA DIVISION.                                                           
001500                                                                          
001600 WORKING-STORAGE SECTION.                                                 
001700                                                                          
001800 01  PV-PROGRAM-VARIABLES.                                                
001900     05  PV-COMMAREA-LENGTH           PIC S9(04)  VALUE ZERO              
002000                                                     COMP SYNC.           
002100     05  PV-SYSID                     PIC X(04)  VALUE SPACE.             
002200     05  PV-MESSAGE-AREA              PIC X(19)  VALUE SPACE.             
002300     05  PV-CICS-RESPONSE             PIC S9(08) VALUE ZEROS              
002400                                                     COMP SYNC.           
002500                                                                          
002600 01  PC-PROGRAM-CONSTANTS.                                                
002700     05  PC-CURRENT-TRANID            PIC X(04)  VALUE 'Z278'.            
002800     05  PC-CURRENT-PROGRAM-NAME      PIC X(08)  VALUE 'DPKRF278'.        
002900                                                                          
002910*----------------------------------------------------------------*        
002920***  LAYOUT FOR THE TEMP ASSOC INFO SUBROUTINE                            
002930*----------------------------------------------------------------*        
002940     COPY XLWS067.                                                        
002950                                                                          
003000     COPY DPWS026.                                                        
003100     COPY DFHAID.                                                         
003200     COPY DPWS013.                                                        
003300                                                                          
003400     COPY DPKM278.                                                        
003500*  COMMAREA TO/FROM HOST PROGRAM                                          
003600     COPY PCWS192.                                                        
003700/                                                                         
004500 LINKAGE SECTION.                                                         
004600 01  DFHCOMMAREA.                                                         
004700     05  FILLER                         OCCURS  1 TO 1000 TIMES           
004800                                        DEPENDING ON EIBCALEN.            
004900         10  FILLER                     PIC X.                            
005000/                                                                         
005100 PROCEDURE DIVISION.                                                      
005200 0000-PROGRAM-MAINLINE.                                                   
005300     MOVE DFHCOMMAREA                TO PC192-COMMAREA.                   
005400     MOVE LOW-VALUES                 TO DP278AI.                          
005500                                                                          
005600     EVALUATE TRUE                                                        
005610         WHEN EIBTRNID NOT = 'Z278'                                       
005700         WHEN EIBCALEN = ZERO                                             
005800***      WHEN EIBAID = DFHCLEAR                                           
005900             PERFORM 1000-SETUP-SCREEN                                    
006000                                                                          
006100             PERFORM 8000-SEND-MAP                                        
006200             PERFORM 8200-RETURN-TRANID                                   
006300                                                                          
006400         WHEN OTHER                                                       
006500             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                        
006600     END-EVALUATE.                                                        
006700                                                                          
006800                                                                          
006900     GOBACK.                                                              
007000****************************************************************          
007100* 1000-SETUP-SCREEN                                                       
007200*    INITIAL SETUP OF AUDIT NUMBER AND STATUS                             
007300****************************************************************          
007400 1000-SETUP-SCREEN.                                                       
007500                                                                          
007600     MOVE PC192-PROGRAM-NAME          TO APGMO                            
007700     MOVE PC192-DISPLAY-DATE          TO ADATEO                           
007800                                                                          
007900     PERFORM DP026-0000-GET-LOGON-INFO.                                   
008000     MOVE DP026-LOCATION-NBR          TO AOPERO                           
008100     MOVE DP026-USERID                TO AUSERO.                          
008200     PERFORM 7000-USER-NAME.                                              
008300                                                                          
008400     STRING XL067-FIRST-NAME (1:1) ' '                                    
008500            XL067-LAST-NAME (1:17)                                        
008600         DELIMITED BY SIZE                                                
008700         INTO ANAMEO.                                                     
008800                                                                          
008900     COPY DPPD026.                                                        
009000/                                                                         
009100 2100-XCTL-TO-SELECTED-PROGRAM.                                           
009200                                                                          
009300     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH.              
009400                                                                          
009500     EXEC CICS                                                            
009600         XCTL                                                             
009700             PROGRAM   (PC192-PROGRAM-NAME)                               
009800             COMMAREA  (PC192-COMMAREA)                                   
009900             LENGTH    (PV-COMMAREA-LENGTH)                               
010000             RESP      (PV-CICS-RESPONSE)                                 
010100     END-EXEC.                                                            
010200                                                                          
010300     EVALUATE TRUE                                                        
010400         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                         
010500              CONTINUE                                                    
010600         WHEN OTHER                                                       
010700              MOVE '2100-XCTL-TO-SELECTED-PROGRAM'                        
010800                                      TO DP013-PARAGRAPH                  
010900              MOVE 'UNABLE TO XCTL THE FOLLOWING PROGRAM: '               
011000                                      TO DP013-MESSAGE-TEXT (1)           
011100              MOVE PC192-PROGRAM-NAME TO DP013-MESSAGE-TEXT (2)           
011200              SET DP013-CICS-ABEND    TO TRUE                             
011300              SET DP013-NO-ROLLBACK   TO TRUE                             
011400              PERFORM 9999-WRITE-CICS-LOG-MSG                             
011500              MOVE 'TRANS NOT AVAILABLE'                                  
011600                                      TO AMSG8O                           
011700              PERFORM 8100-SEND-DATA-ONLY                                 
011800              PERFORM 8200-RETURN-TRANID                                  
011900     END-EVALUATE.                                                        
012000                                                                          
013214 7000-USER-NAME.                                                          
013215                                                                          
013216     INITIALIZE XL067-USER-COMMAREA.                                      
013217                                                                          
013218     SET XL067-BY-USER-ID            TO TRUE.                             
013219     SET XL067-SELECT-KOHLS-USER     TO TRUE.                             
013220                                                                          
013221     MOVE DP026-USERID          TO XL067-KEY-USER-ID.                     
013222                                                                          
013223     CALL XL067-USER-PGM USING DFHEIBLK                                   
013224                               XL067-COMMAREA                             
013225                               XL067-USER-COMMAREA.                       
013226                                                                          
013227     EVALUATE TRUE                                                        
013228         WHEN XL067-SUCCESSFUL                                            
013229             CONTINUE                                                     
013230         WHEN OTHER                                                       
013231              DISPLAY '***********************************'               
013232              DISPLAY '****     SUKCS573  ABEND       ****'               
013233              DISPLAY '***********************************'               
013234              DISPLAY '**  PARAGRAPH 7000-USER-NAME     **'               
013235              DISPLAY '**  UNSUCCESSFUL CALL TO XLKUT067**'               
013236              DISPLAY '**  SEE PROD COPYBOOK XLWS067    **'               
013237              DISPLAY '**  XL067-RETURN-CODE:'  XL067-RETURN-CODE         
013238              DISPLAY '***********************************'               
013239              MOVE '7000-USER-NAME' TO DP013-PARAGRAPH                    
013240              MOVE 'SELECT INFO PROBLEM '                                 
013241                                    TO DP013-MESSAGE-TEXT (1)             
013243              MOVE 'XLT_USR '       TO DP013-DB2-TABLE-NAME (1)           
013244              SET DP013-DB2-ABEND                                         
013245                  DP013-NO-ROLLBACK                                       
013246                  DP013-XCTL-DISPLAY-RESTART                              
013247                                    TO TRUE                               
013249              PERFORM DP014-0000-PROCESS-ABEND                            
013250     END-EVALUATE.                                                        
013251                                                                          
013260                                                                          
013300******************************************************************        
013400*  8000-SEND-MAP                                                 *        
013500*  SEND THE REFRESHED MAP IMAGE TO THE SCREEN                    *        
013600******************************************************************        
013700 8000-SEND-MAP.                                                           
013800     EXEC CICS                                                            
013900         SEND                                                             
014000             MAP     ('DP278A')                                           
014100             MAPSET  ('DPKM278')                                          
014200             ERASE                                                        
014300             RESP    (PV-CICS-RESPONSE)                                   
014400     END-EXEC.                                                            
014500                                                                          
014600     EVALUATE TRUE                                                        
014700         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                         
014800             CONTINUE                                                     
014900         WHEN OTHER                                                       
015000             MOVE '8000-SEND-MAP'     TO DP013-PARAGRAPH                  
015100             MOVE 'UNABLE TO SEND MAP'                                    
015200                                      TO DP013-MESSAGE-TEXT (1)           
015300             SET DP013-CICS-ABEND     TO TRUE                             
015400             SET DP013-NO-ROLLBACK    TO TRUE                             
015500             PERFORM 9999-WRITE-CICS-LOG-MSG                              
015600     END-EVALUATE.                                                        
015700*                                                                         
015800 8100-SEND-DATA-ONLY.                                                     
015900                                                                          
016000     EXEC CICS                                                            
016100         SEND                                                             
016200             MAP       ('DP278A')                                         
016300             MAPSET    ('DPKM278')                                        
016400             CURSOR                                                       
016500             DATAONLY                                                     
016600             RESP      (PV-CICS-RESPONSE)                                 
016700     END-EXEC.                                                            
016800                                                                          
016900     EVALUATE TRUE                                                        
017000         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                         
017100             CONTINUE                                                     
017200         WHEN OTHER                                                       
017300             MOVE '8100-SEND-DATA-ONLY'                                   
017400                                      TO DP013-PARAGRAPH                  
017500             MOVE 'UNABLE TO SEND DATA'                                   
017600                                      TO DP013-MESSAGE-TEXT (1)           
017700             SET DP013-CICS-ABEND     TO TRUE                             
017800             SET DP013-NO-ROLLBACK    TO TRUE                             
017900             PERFORM 9999-WRITE-CICS-LOG-MSG                              
018000     END-EVALUATE.                                                        
018100*                                                                         
018200 8200-RETURN-TRANID.                                                      
018300     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH.              
018400                                                                          
018500     EXEC CICS                                                            
018600         RETURN                                                           
018700             TRANSID   (PC-CURRENT-TRANID)                                
018800             COMMAREA  (PC192-COMMAREA)                                   
018900             LENGTH    (PV-COMMAREA-LENGTH)                               
019000             RESP      (PV-CICS-RESPONSE)                                 
019100     END-EXEC.                                                            
019200                                                                          
019300     EVALUATE TRUE                                                        
019400         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                         
019500             CONTINUE                                                     
019600         WHEN OTHER                                                       
019700             MOVE '8200-RETURN-TRANID'                                    
019800                                      TO DP013-PARAGRAPH                  
019900             MOVE 'UNABLE TO RETURN   TO TRANID'                          
020000                                      TO DP013-MESSAGE-TEXT (1)           
020100             SET DP013-CICS-ABEND     TO TRUE                             
020200             SET DP013-NO-ROLLBACK    TO TRUE                             
020300             PERFORM 9999-WRITE-CICS-LOG-MSG                              
020400     END-EVALUATE.                                                        
020500*                                                                         
020600*                                                                         
020700 9999-WRITE-CICS-LOG-MSG.                                                 
020800     MOVE PC-CURRENT-PROGRAM-NAME     TO DP013-PROGRAM.                   
020900     MOVE DFHEIBLK                    TO DP013-DFHEIBLK.                  
021000     INITIALIZE DP013-SRC-TASK-NUMBER                                     
021100                DP013-STACK.                                              
021200     SET DP013-LINK-RETURN            TO TRUE.                            
021300                                                                          
021400     EXEC CICS                                                            
021500         LINK                                                             
021600             PROGRAM   (DP013-NAME)                                       
021700             COMMAREA  (DP013-PARAMETERS)                                 
021800             LENGTH    (DP013-LENGTH)                                     
021900     END-EXEC.                                                            
022000                                                                          
022100*----------------------------------------------------------------*        
022200*    ABEND PROCESSOR MODULE                                      *        
022300*----------------------------------------------------------------*        
022400                                                                          
022500     COPY DPPD014.                                                        
022600                                                                          
