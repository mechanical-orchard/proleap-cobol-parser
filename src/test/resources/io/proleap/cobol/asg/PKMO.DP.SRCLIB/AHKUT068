000100 IDENTIFICATION DIVISION.                                         00010001
000200 PROGRAM-ID.    AHKUT068.                                         00020002
000300 AUTHOR.        CHERI MASTEL.                                     00030001
000400 INSTALLATION.  KOHLS.                                            00040001
000500 DATE-WRITTEN   AUG, 1997.                                        00050001
000600 DATE-COMPILED.                                                   00060001
000700                                                                  00070001
000800* ************************************************************** *00080001
000900* * AHKUT068.  "ARCHIVE HISTORY" PROJECT.  EXTRACT PROGRAM.    * *00090002
001000* *                                                            * *00100001
001100* * PURPOSE:                                                   * *00110001
001200* * THIS PROGRAM CREATES AN EXTRACT FILE FROM: TTRBNTF.        * *00120001
001300* * THIS EXTRACT FILE CONSISTS OF ROWS ELIGIBLE TO BE:         * *00130001
001400* * 1) LOADED TO THE "ARCHIVE/HISTORY" VERSIONS OF THE TABLES. * *00140001
001500* * 2) DELETED FROM THE OPERATIONAL VERSIONS OF THE TABLES.    * *00150001
001600* *                                                            * *00160001
001700* * PROCESSING OVERVIEW:                                       * *00170001
001800* * THIS PROGRAM READS A "DRIVER" FILE. FOR EACH RECORD READ,  * *00180001
001900* * 1) INCREMENT COUNT OF RECORDS READ.                        * *00190001
002000* * 2) ATTEMPT TO FIND RELATED ROW(S) ON THE TABLE.            * *00200001
002100* *    2.A) IF NO MATCH(ES):                                   * *00210001
002200* *         2.A.1) PROCESSING CONTINUES                        * *00220001
002300* *         2.A.2) DO NOT PERFORM ERROR/REPORTING ROUTINES;    * *00230001
002400* *                THIS SYSTEM DOES NOT CLEANSE DATA NOR REPORT* *00240001
002500* *                ON UNCLEAN DATA.  IT SIMPLY MIGRATES        * *00250001
002600* *                CONDITIONS OCCURRING IN OPERATIONAL         * *00260001
002700* *                TABLES OVER TO THE ARCHIVE/HISTORY TABLES.  * *00270001
002800* *    2.B) IF MATCH(ES):                                      * *00280001
002900* *         2.B.1) INCREMENT COUNT OF ROW(S) FOUND.            * *00290001
003000* *         2.B.2) WRITE THESE ROW(S) TO THE EXTRACT FILE.     * *00300001
003100* *         2.B.3) INCREMENT COUNT OF RECORDS WRITTEN.         * *00310001
003200* *         2.B.4) DO NOT REMOVE THE ROW(S) FROM THE TABLE     * *00320001
003300* *                AT THIS TIME.  THEY WILL BE REMOVED IN OTHER* *00330001
003400* *                PROCESSING, AFTER HAVING BEEN LOADED TO THE * *00340001
003500* *                ARCHIVE/HISTORY TABLE.                      * *00350001
003600* * 3) EVERY NTH RECORD (IE: INITIAL SETTING 1000), REPORT     * *00360001
003700* *    RECORD COUNT AND CURRENT DATE/TIME.  THIS WILL ASSIST   * *00370001
003800* *    WITH RUN-TIME ESTIMATE OF TIME REMAINING TO COMPLETE.   * *00380001
003900* ************************************************************** *00390001
004000 ENVIRONMENT DIVISION.                                            00400001
004100 CONFIGURATION SECTION.                                           00410001
004200 SOURCE-COMPUTER.        IBM-3090.                                00420001
004300 OBJECT-COMPUTER.        IBM-3090.                                00430001
004400                                                                  00440001
004500 INPUT-OUTPUT SECTION.                                            00450001
004600 FILE-CONTROL.                                                    00460001
004700                                                                  00470001
004800     SELECT IN-DRIVER-FILE                ASSIGN TO IN01.         00480001
004900     SELECT OUT-EXTRACT-FILE              ASSIGN TO OUT01.        00490001
005000                                                                  00500001
005100******************************************************************00510001
005200 DATA DIVISION.                                                   00520001
005300 FILE SECTION.                                                    00530001
005400                                                                  00540001
005500 FD  IN-DRIVER-FILE                                               00550001
005600     RECORDING MODE IS F                                          00560001
005700     LABEL RECORDS ARE STANDARD                                   00570001
005800     BLOCK CONTAINS 0 RECORDS.                                    00580001
005900 01  IN-DRIVER-RECORD                PIC  X(004).                 00590001
006000                                                                  00600001
006100**** TTRBNTF:                                                     00610001
006200 FD  OUT-EXTRACT-FILE                                             00620001
006300     RECORDING MODE IS F                                          00630001
006400     LABEL RECORDS ARE STANDARD                                   00640001
006500     BLOCK CONTAINS 0 RECORDS.                                    00650001
006600 01  OUT-EXTRACT-RECORD              PIC  X(247).                 00660001
006700                                                                  00670001
006800                                                                  00680001
006900                                                                  00690001
007000 WORKING-STORAGE SECTION.                                         00700001
007100                                                                  00710001
007200 01  PC-PROGRAM-CONSTANTS.                                        00720001
007300     05  PC-CURRENT-PROGRAM-NAME     PIC X(08) VALUE 'AHKUT068'.  00730002
007400     05  PC-PGM-PROGRESS-DESC.                                    00740001
007500         10  PC-BEGINNING            PIC X(09) VALUE 'BEGINNING'. 00750001
007600         10  PC-CONTINUING           PIC X(10) VALUE              00760001
007700                                               'CONTINUING'.      00770001
007800         10  PC-ENDING               PIC X(06) VALUE 'ENDING'.    00780001
007900         10  PC-ABENDING             PIC X(08) VALUE 'ABENDING'.  00790001
008000     05  PC-ABEND-INFO.                                           00800001
008100         10  PC-ABEND                PIC X(11) VALUE              00810001
008200                                               '** ABEND **'.     00820001
008300         10  PC-ABEND-MSG-PARA       PIC X(15) VALUE              00830001
008400                                               '- PARA       : '. 00840001
008500         10  PC-ABEND-MSG-DISPLAY-PARA                            00850001
008600                                     PIC X(15) VALUE              00860001
008700                                               '  CALLED PARA: '. 00870001
008800         10  PC-ABEND-MSG-NUMBER     PIC X(15) VALUE              00880001
008900                                               '  FOR ABEND# : '. 00890001
009000         10  PC-ABEND-MSG-DESC       PIC X(15) VALUE              00900001
009100                                               '- ERROR IS   : '. 00910001
009200         10  PC-ABEND-MSG-INDENT-15  PIC X(15) VALUE SPACES.      00920001
009300         10  PC-ABEND-MSG-ACTION     PIC X(15) VALUE              00930001
009400                                               '- ACTION     : '. 00940001
009500     05  PC-HOW-OFTEN-TO-DISPLAY     PIC 9(9)  VALUE 5000.        00950001
009600                                                                  00960001
009700 01  PS-PROGRAM-SWITCHES.                                         00970001
009800     05  PS-IN-DRIVER-EOF-SW         PIC X(01) VALUE 'N'.         00980001
009900         88  PS-IN-DRIVER-EOF                  VALUE 'Y'.         00990001
010000         88  PS-IN-DRIVER-NOT-EOF              VALUE 'N'.         01000001
010100     05  PS-CURSOR-HAS-DATA-SW       PIC X(01) VALUE 'N'.         01010001
010200         88  PS-CURSOR-HAS-DATA                VALUE 'Y'.         01020001
010300         88  PS-CURSOR-HAS-NO-DATA             VALUE 'N'.         01030001
010400     05  PS-TABLE-LOOP-DONE-SW       PIC X(01) VALUE 'N'.         01040001
010500         88  PS-TABLE-LOOP-DONE                VALUE 'Y'.         01050001
010600         88  PS-TABLE-LOOP-NOT-DONE            VALUE 'N'.         01060001
010700                                                                  01070001
010800 01  PV-PROGRAM-VARIABLES.                                        01080001
010900     05  PV-PO-NBR-COMP              PIC S9(9) VALUE 0 COMP.      01090001
011000     05  PV-PO-NBR-NUM               PIC  9(9) VALUE 0.           01100001
011100     05  PV-IN-DRIVER-RECS-READ-CNT  PIC  9(9) VALUE 0.           01110001
011200     05  PV-RECS-WITH-MATCHES-CNT    PIC  9(9) VALUE 0.           01120001
011300     05  PV-TABLE-ROW-SELECT-CNT     PIC  9(9) VALUE 0.           01130001
011400     05  PV-EXTRACT-WRITTEN-CNT      PIC  9(9) VALUE 0.           01140001
011500                                                                  01150001
011600     05  PV-PARAGRAPH-NAME           PIC X(30) VALUE SPACES.      01160001
011700     05  PV-DB2-OPERATION-MSG-1      PIC X(79) VALUE SPACES.      01170001
011800     05  PV-DB2-TABLE-NAME           PIC X(18) VALUE SPACES.      01180001
011900     05  PV-DISPLAY-NTH-MULTIPLE     PIC 9(9)  VALUE 0.           01190001
012000     05  PV-DISPLAY-NTH-REMAINDER    PIC 9(9)  VALUE 0.           01200001
012100     05  PV-SQLCODE                  PIC +999  VALUE ZERO.        01210001
012200                                                                  01220001
012300     05  PV-TMST                     PIC X(26) VALUE SPACES.      01230001
012400     05  PV-TIMESTAMP-DETAIL                                      01240001
012500         REDEFINES                                                01250001
012600         PV-TMST.                                                 01260001
012700         10  PV-TIMESTAMP-19.                                     01270001
012800             15  PV-TMS-DATE.                                     01280001
012900                 20  PV-TMS-YEAR.                                 01290001
013000                     25  PV-TMS-CC   PIC X(02).                   01300001
013100                     25  PV-TMS-YY   PIC X(02).                   01310001
013200                 20  FILLER          PIC X(01).                   01320001
013300                 20  PV-TMS-MONTH    PIC X(02).                   01330001
013400                 20  FILLER          PIC X(01).                   01340001
013500                 20  PV-TMS-DAY      PIC X(02).                   01350001
013600             15  FILLER              PIC X(01).                   01360001
013700             15  PV-TMS-HOUR         PIC X(02).                   01370001
013800             15  FILLER              PIC X(01).                   01380001
013900             15  PV-TMS-MINUTE       PIC X(02).                   01390001
014000             15  FILLER              PIC X(01).                   01400001
014100             15  PV-TMS-SECOND       PIC X(02).                   01410001
014200         10  FILLER                  PIC X(01).                   01420001
014300         10  PV-TMS-MSECOND          PIC X(06).                   01430001
014400                                                                  01440001
014500 01  DM-DISPLAY-MESSAGE.                                          01450001
014600     05  DM-01-10.                                                01460001
014700         10  DM-PROGRAM              PIC X(08) VALUE SPACE.       01470001
014800         10  FILLER                  PIC X(02) VALUE ': '.        01480001
014900     05  DM-11-80.                                                01490001
015000         10  FILLER                  PIC X(37) VALUE              01500001
015100                        'SELECT ROWS MATCHING PO DRIVER FILE, '.  01510001
015200         10  FILLER                  PIC X(30) VALUE              01520001
015300                        'CREATING TTRBNTF EXTRACT FILE.'.         01530001
015400         10  FILLER                  PIC X(01) VALUE SPACE.       01540001
015500         10  FILLER                  PIC X(01) VALUE ALL '*'.     01550001
015600     05  DM-81-120.                                               01560001
015700         10  FILLER                  PIC X(40) VALUE ALL '*'.     01570001
015800                                                                  01580001
015900 01  DP-DISPLAY-PROGRESS-MSG.                                     01590001
016000     05  DP-PROGRAM                  PIC X(08) VALUE SPACE.       01600001
016100     05  FILLER                      PIC X(02) VALUE SPACE.       01610001
016200     05  DP-STATUS-DESCRIPTION       PIC X(10) VALUE SPACE.       01620001
016300     05  FILLER                      PIC X(04) VALUE ' AT '.      01630001
016400     05  DP-TIMESTAMP-19             PIC X(19) VALUE SPACE.       01640001
016500     05  FILLER                      PIC X(03) VALUE '.  '.       01650001
016600     05  FILLER                      PIC X(03) VALUE              01660001
016700                                         'IN:'.                   01670001
016800     05  DP-IN-CNT                   PIC ZZZ,ZZZ,ZZ9              01680001
016900                                               VALUE ZERO.        01690001
017000     05  FILLER                      PIC X(02) VALUE ', '.        01700001
017100*    05  FILLER                      PIC X(16) VALUE              01710001
017200*                                        'DRIVER W/ROW(S):'.      01720001
017300*    05  DP-MATCHES-FOUND-CNT        PIC ZZZ,ZZZ,ZZ9              01730001
017400*                                              VALUE ZERO.        01740001
017500*    05  FILLER                      PIC X(02) VALUE ', '.        01750001
017600     05  FILLER                      PIC X(14) VALUE              01760001
017700                                         'ROWS SELECTED:'.        01770001
017800     05  DP-ROWS-SELECTED-CNT        PIC ZZZ,ZZZ,ZZ9              01780001
017900                                               VALUE ZERO.        01790001
018000     05  FILLER                      PIC X(02) VALUE ', '.        01800001
018100     05  FILLER                      PIC X(04) VALUE              01810001
018200                                         'OUT:'.                  01820001
018300     05  DP-OUT-CNT                  PIC ZZZ,ZZZ,ZZ9              01830001
018400                                               VALUE ZERO.        01840001
018500     05  FILLER                      PIC X(01) VALUE '.'.         01850001
018600                                                                  01860001
018700 01  ABEND-CODE                      PIC S9(04)                   01870001
018800                                               VALUE ZEROES       01880001
018900                                               COMP SYNC.         01890001
019000                                                                  01900001
019100*---------------------------------------------------------------* 01910001
019200*  DB2 FORMATTED MESSAGE AREA                                     01920001
019300*---------------------------------------------------------------* 01930001
019400     COPY DPWS004.                                                01940001
019500                                                                  01950001
019600                                                                  01960001
019700*---------------------------------------------------------------* 01970001
019800*  AHRD002  - RECORD LAYOUT FOR PO DRIVER FILE, INPUT.          * 01980001
019900*---------------------------------------------------------------* 01990001
020000     COPY AHRD002.                                                02000001
020100                                                                  02010001
020200                                                                  02020001
020300*---------------------------------------------------------------* 02030001
020400*    DB2 AREA FOR TTRBNTF                                       * 02040001
020500*---------------------------------------------------------------* 02050001
020600     EXEC SQL                                                     02060001
020700          INCLUDE TTRBNTF                                         02070001
020800     END-EXEC.                                                    02080001
020900                                                                  02090001
021000*---------------------------------------------------------------* 02100001
021100*    DB2 AREA FOR COMMUNICATIONS                                * 02110001
021200*---------------------------------------------------------------* 02120001
021300     EXEC SQL                                                     02130001
021400          INCLUDE SQLCA                                           02140001
021500     END-EXEC.                                                    02150001
021600                                                                  02160001
021700*---------------------------------------------------------------* 02170001
021800*    DEFINE CURSOR FOR TTRBNTF :                                * 02180001
021900*    PULL ALL AVAILABLE COLUMNS, SO EXTRACT FILE WILL CONTAIN   * 02190001
022000*    ALL DATA TO POPULATE "ARCHIVE HISTORY" COPY OF THIS TABLE. * 02200001
022100*---------------------------------------------------------------* 02210001
022200     EXEC SQL                                                     02220001
022300          DECLARE TABLE-CURSOR CURSOR FOR                         02230001
022310           SELECT NOTIF_NBR                                       02231001
022320               ,  OPER_UNT_ID                                     02232001
022330               ,  FCLTY_ID                                        02233001
022340               ,  DEPT_NBR                                        02234001
022350               ,  ENT_ID                                          02235001
022360               ,  PO_NBR                                          02236001
022370               ,  PO_LNE_NBR                                      02237001
022380               ,  REC_SEQ_NBR                                     02238001
022390               ,  TRBL_RSN_CDE                                    02239001
022391               ,  NOTIF_TMST                                      02239101
022392               ,  NOTIF_UID                                       02239201
022393               ,  RESOLVED_IND                                    02239301
022394               ,  RESOLVED_TMST                                   02239401
022395               ,  RESOLVED_UID                                    02239501
022396               ,  ACKNOWLG_TMST                                   02239601
022397               ,  ACKNOWLG_UID                                    02239701
022398               ,  CNTCT_EXT                                       02239801
022399               ,  FCLTY_AREA_ID                                   02239901
022400               ,  SHIPT_ID                                        02240001
022401               ,  PKSL_SEQ_NBR                                    02240101
022402               ,  PKSL_LNE_NBR                                    02240201
022403               ,  WORK_ORD_SEQ_NBR                                02240301
022404               ,  WO_INSTR_SEQ_NBR                                02240401
022405               ,  OVER_SHT_PCT                                    02240501
022406               ,  LAST_DTL_CRE_TMST                               02240601
022407               ,  CRE_IND                                         02240701
022408               ,  PRORATE_IND                                     02240801
022409               ,  RTV_IND                                         02240901
022410               ,  RTV_RESPONSE_TMST                               02241001
022411               ,  PO_VER_NBR                                      02241101
022412               ,  PO_LNE_VER_NBR                                  02241201
022413               ,  PLN_SHIP_VER_NBR                                02241301
022414               ,  ERLY_LTE_DAY_QTY                                02241401
022415               ,  INITR_ID                                        02241501
022416               ,  RSPNB_RSLU_ID                                   02241601
022417               ,  PFMC_TRKG_ID                                    02241701
022418               ,  ACTVY_RSLU_CDE                                  02241801
022419               ,  INITR_ENT_ID                                    02241901
022420               ,  FOB_CDE                                         02242001
022421               ,  POE_CDE                                         02242101
022422               ,  PREPK_ID                                        02242201
022900           FROM   TTRBNTF                                         02290001
023000          WHERE  (PO_NBR = :PV-PO-NBR-COMP)                       02300001
023100            FOR  FETCH ONLY                                       02310001
023200           WITH  UR                                               02320001
023300     END-EXEC.                                                    02330001
023400                                                                  02340001
023500                                                                  02350001
023600 PROCEDURE DIVISION.                                              02360001
023700********************                                              02370001
023800                                                                  02380001
023900 0000-PROGRAM-MAINLINE.                                           02390001
024000                                                                  02400001
024100     PERFORM 1000-INITIALIZE.                                     02410001
024200                                                                  02420001
024300     SET PS-IN-DRIVER-NOT-EOF TO TRUE.                            02430001
024400     PERFORM 2000-PROCESS-DRIVER-FILE                             02440001
024500         UNTIL PS-IN-DRIVER-EOF.                                  02450001
024600                                                                  02460001
024700     PERFORM 6000-EOJ-ROUTINE.                                    02470001
024800     STOP RUN.                                                    02480001
024900                                                                  02490001
025000                                                                  02500001
025100* ************************************************************** *02510001
025200* * INITIALIZATIONS                                            * *02520001
025300* ************************************************************** *02530001
025400 1000-INITIALIZE.                                                 02540001
025500                                                                  02550001
025600     MOVE PC-CURRENT-PROGRAM-NAME TO DM-PROGRAM.                  02560001
025700     DISPLAY DM-DISPLAY-MESSAGE.                                  02570001
025800                                                                  02580001
025900     MOVE PC-BEGINNING              TO DP-STATUS-DESCRIPTION.     02590001
026000     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           02600001
026100                                                                  02610001
026200     PERFORM 9000-OPEN-IN-DRIVER-FILE.                            02620001
026300     PERFORM 9700-OPEN-OUT-EXTRACT-FILE.                          02630001
026400                                                                  02640001
026500                                                                  02650001
026600* ************************************************************** *02660001
026700* * 1) GET NEXT RECORD FROM DRIVER FILE, AND                   * *02670001
026800* *    1A- POPULATE KEY (WHERE CLAUSE) FOR TABLE CURSOR        * *02680001
026900* *    1B- OPEN TABLE CURSOR                                   * *02690001
027000* *    1C- LOOP THRU TABLE CURSOR TO EXTRACT ALL               * *02700001
027100* *        ROWS FOR THIS INPUT DRIVER RECORD                   * *02710001
027200* *    2) FOR EACH ROW,                                        * *02720001
027300* *       2A- INCREMENT COUNTS                                 * *02730001
027400* *       2B- WRITE EXTRACT RECORD                             * *02740001
027500* *    1D- CLOSE TABLE CURSOR                                  * *02750001
027600* ************************************************************** *02760001
027700 2000-PROCESS-DRIVER-FILE.                                        02770001
027800                                                                  02780001
027900     PERFORM 9050-READ-IN-DRIVER-FILE.                            02790001
028000     IF PS-IN-DRIVER-EOF                                          02800001
028100         CONTINUE                                                 02810001
028200     ELSE                                                         02820001
028300         MOVE AH002-PO-NBR TO         PV-PO-NBR-COMP              02830001
028400                                      PV-PO-NBR-NUM               02840001
028500         PERFORM 2100-CHECK-PGM-PROGRESS                          02850001
028600         SET PS-TABLE-LOOP-NOT-DONE   TO TRUE                     02860001
028700         SET PS-CURSOR-HAS-NO-DATA    TO TRUE                     02870001
028800         PERFORM 9100-OPEN-TABLE-CURSOR                           02880001
028900         PERFORM 3000-EXTRACT-ROWS-FROM-TABLE                     02890001
029000             UNTIL PS-TABLE-LOOP-DONE                             02900001
029100         PERFORM 9190-CLOSE-TABLE-CURSOR                          02910001
029200     END-IF.                                                      02920001
029300                                                                  02930001
029400                                                                  02940001
029500* ************************************************************** *02950001
029600* *    EVERY NTH RECORD (IE: INITIAL SETTING 1000), REPORT     * *02960001
029700* *    RECORD COUNT AND CURRENT DATE/TIME.  THIS WILL ASSIST   * *02970001
029800* *    WITH RUN-TIME ESTIMATE OF TIME REMAINING TO COMPLETE.   * *02980001
029900* ************************************************************** *02990001
030000 2100-CHECK-PGM-PROGRESS.                                         03000001
030100     DIVIDE    PV-IN-DRIVER-RECS-READ-CNT                         03010001
030200         BY        PC-HOW-OFTEN-TO-DISPLAY                        03020001
030300         GIVING    PV-DISPLAY-NTH-MULTIPLE                        03030001
030400         REMAINDER PV-DISPLAY-NTH-REMAINDER.                      03040001
030500                                                                  03050001
030600     IF PV-DISPLAY-NTH-REMAINDER = ZERO                           03060001
030700         MOVE PC-CONTINUING         TO DP-STATUS-DESCRIPTION      03070001
030800         PERFORM 6200-DISPLAY-PGM-PROGRESS                        03080001
030900     END-IF.                                                      03090001
031000                                                                  03100001
031100                                                                  03110001
031200* ************************************************************** *03120001
031300* * EXTRACT ROWS FROM TABLE, FOR THE CURRENT DRIVER RECORD     * *03130001
031400* ************************************************************** *03140001
031500 3000-EXTRACT-ROWS-FROM-TABLE.                                    03150001
031600     INITIALIZE DCLTTRBNTF.                                       03160001
031700     PERFORM 9150-FETCH-TABLE-CURSOR.                             03170001
031800     IF PS-TABLE-LOOP-DONE                                        03180001
031900         CONTINUE                                                 03190001
032000     ELSE                                                         03200001
032100         PERFORM 9750-WRITE-EXTRACT-RECORD                        03210001
032200     END-IF.                                                      03220001
032300                                                                  03230001
032400                                                                  03240001
032500* ************************************************************** *03250001
032600* * DISPLAY END OF RUN MESSAGE, CLOSE THE OUTPUT FILES         * *03260001
032700* ************************************************************** *03270001
032800 6000-EOJ-ROUTINE.                                                03280001
032900                                                                  03290001
033000     PERFORM 9090-CLOSE-IN-DRIVER-FILE.                           03300001
033100     PERFORM 9790-CLOSE-OUT-EXTRACT-FILE.                         03310001
033200                                                                  03320001
033300     MOVE PC-ENDING                 TO DP-STATUS-DESCRIPTION.     03330001
033400     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           03340001
033500                                                                  03350001
033600                                                                  03360001
033700* ************************************************************** *03370001
033800* * DISPLAY PROGRAM PROGRESS.                                  * *03380001
033900* ************************************************************** *03390001
034000 6200-DISPLAY-PGM-PROGRESS.                                       03400001
034100                                                                  03410001
034200     EXEC SQL                                                     03420001
034300          SET :PV-TMST = CURRENT TIMESTAMP                        03430001
034400     END-EXEC.                                                    03440001
034500                                                                  03450001
034600     MOVE PC-CURRENT-PROGRAM-NAME   TO DP-PROGRAM.                03460001
034700     MOVE PV-TIMESTAMP-19           TO DP-TIMESTAMP-19.           03470001
034800     MOVE PV-IN-DRIVER-RECS-READ-CNT                              03480001
034900                                    TO DP-IN-CNT.                 03490001
035000*    MOVE PV-RECS-WITH-MATCHES-CNT  TO DP-MATCHES-FOUND-CNT.      03500001
035100     MOVE PV-TABLE-ROW-SELECT-CNT   TO DP-ROWS-SELECTED-CNT.      03510001
035200     MOVE PV-EXTRACT-WRITTEN-CNT    TO DP-OUT-CNT.                03520001
035300                                                                  03530001
035400     DISPLAY DP-DISPLAY-PROGRESS-MSG.                             03540001
035500                                                                  03550001
035600                                                                  03560001
035700* ************************************************************** *03570001
035800* * FILE AND DB2 TABLE ACCESS PARAGRAPHS.                      * *03580001
035900* * 90XX- INPUT:  DRIVER FILE                                  * *03590001
036000* * 91XX- INPUT:  TABLE CURSOR                                 * *03600001
036100* * 97XX- OUTPUT: TABLE EXTRACT                                * *03610001
036200* ************************************************************** *03620001
036300                                                                  03630001
036400* ************************************************************** *03640001
036500* * OPEN  INPUT DRIVER FILE                                    * *03650001
036600* ************************************************************** *03660001
036700 9000-OPEN-IN-DRIVER-FILE.                                        03670001
036800     OPEN  INPUT  IN-DRIVER-FILE.                                 03680001
036900                                                                  03690001
037000                                                                  03700001
037100* ************************************************************** *03710001
037200* * READ  INPUT DRIVER FILE OF ELIGIBLE DATA TO EXTRACT        * *03720001
037300* ************************************************************** *03730001
037400 9050-READ-IN-DRIVER-FILE.                                        03740001
037500     READ IN-DRIVER-FILE                                          03750001
037600          INTO AH002-DRIVER-RECORD-LAYOUT                         03760001
037700          AT END                                                  03770001
037800              SET PS-IN-DRIVER-EOF TO TRUE.                       03780001
037900                                                                  03790001
038000     IF PS-IN-DRIVER-EOF                                          03800001
038100         CONTINUE                                                 03810001
038200     ELSE                                                         03820001
038300         ADD +1 TO PV-IN-DRIVER-RECS-READ-CNT                     03830001
038400     END-IF.                                                      03840001
038500                                                                  03850001
038600                                                                  03860001
038700* ************************************************************** *03870001
038800* * CLOSE INPUT DRIVER FILE                                    * *03880001
038900* ************************************************************** *03890001
039000 9090-CLOSE-IN-DRIVER-FILE.                                       03900001
039100     CLOSE IN-DRIVER-FILE.                                        03910001
039200                                                                  03920001
039300                                                                  03930001
039400* ************************************************************** *03940001
039500* * OPEN  TABLE CURSOR                                         * *03950001
039600* ************************************************************** *03960001
039700 9100-OPEN-TABLE-CURSOR.                                          03970001
039800     EXEC SQL                                                     03980001
039900          OPEN TABLE-CURSOR                                       03990001
040000     END-EXEC.                                                    04000001
040100                                                                  04010001
040200     EVALUATE TRUE                                                04020001
040300         WHEN SQLCODE = ZERO                                      04030001
040400              ADD +1 TO PV-RECS-WITH-MATCHES-CNT                  04040001
040500              SET PS-CURSOR-HAS-DATA TO TRUE                      04050001
040600         WHEN SQLCODE = +100                                      04060001
040700              SET PS-TABLE-LOOP-DONE TO TRUE                      04070001
040800         WHEN SQLWARN0 NOT EQUAL SPACE                            04080001
040900         WHEN SQLCODE  NOT EQUAL ZERO                             04090001
041000              MOVE '9100-OPEN-TABLE-CURSOR'                       04100001
041100                                 TO PV-PARAGRAPH-NAME             04110001
041200              MOVE 'OPEN TABLE CURSOR'                            04120001
041300                                 TO PV-DB2-OPERATION-MSG-1        04130001
041400              MOVE 'TTRBNTF'     TO PV-DB2-TABLE-NAME             04140001
041500              PERFORM 9999-DB2-ABEND                              04150001
041600     END-EVALUATE.                                                04160001
041700                                                                  04170001
041800                                                                  04180001
041900* ************************************************************** *04190001
042000* * FETCH TABLE CURSOR                                         * *04200001
042100* ************************************************************** *04210001
042200 9150-FETCH-TABLE-CURSOR.                                         04220001
042300     EXEC SQL                                                     04230001
042400         FETCH TABLE-CURSOR                                       04240001
042510          INTO  :TRBNTF-NOTIF-NBR                                 04251001
042520             ,  :TRBNTF-OPER-UNT-ID                               04252001
042530             ,  :TRBNTF-FCLTY-ID                                  04253001
042540             ,  :TRBNTF-DEPT-NBR                                  04254001
042550             ,  :TRBNTF-ENT-ID                                    04255001
042560             ,  :TRBNTF-PO-NBR                                    04256001
042570             ,  :TRBNTF-PO-LNE-NBR                                04257001
042580             ,  :TRBNTF-REC-SEQ-NBR                               04258001
042590             ,  :TRBNTF-TRBL-RSN-CDE                              04259001
042591             ,  :TRBNTF-NOTIF-TMST                                04259101
042592             ,  :TRBNTF-NOTIF-UID                                 04259201
042593             ,  :TRBNTF-RESOLVED-IND                              04259301
042594             ,  :TRBNTF-RESOLVED-TMST                             04259401
042595             ,  :TRBNTF-RESOLVED-UID                              04259501
042596             ,  :TRBNTF-ACKNOWLG-TMST                             04259601
042597             ,  :TRBNTF-ACKNOWLG-UID                              04259701
042598             ,  :TRBNTF-CNTCT-EXT                                 04259801
042599             ,  :TRBNTF-FCLTY-AREA-ID                             04259901
042600             ,  :TRBNTF-SHIPT-ID                                  04260001
042601             ,  :TRBNTF-PKSL-SEQ-NBR                              04260101
042602             ,  :TRBNTF-PKSL-LNE-NBR                              04260201
042603             ,  :TRBNTF-WORK-ORD-SEQ-NBR                          04260301
042604             ,  :TRBNTF-WO-INSTR-SEQ-NBR                          04260401
042605             ,  :TRBNTF-OVER-SHT-PCT                              04260501
042606             ,  :TRBNTF-LAST-DTL-CRE-TMST                         04260601
042607             ,  :TRBNTF-CRE-IND                                   04260701
042608             ,  :TRBNTF-PRORATE-IND                               04260801
042609             ,  :TRBNTF-RTV-IND                                   04260901
042610             ,  :TRBNTF-RTV-RESPONSE-TMST                         04261001
042611             ,  :TRBNTF-PO-VER-NBR                                04261101
042612             ,  :TRBNTF-PO-LNE-VER-NBR                            04261201
042613             ,  :TRBNTF-PLN-SHIP-VER-NBR                          04261301
042614             ,  :TRBNTF-ERLY-LTE-DAY-QTY                          04261401
042615             ,  :TRBNTF-INITR-ID                                  04261501
042616             ,  :TRBNTF-RSPNB-RSLU-ID                             04261601
042617             ,  :TRBNTF-PFMC-TRKG-ID                              04261701
042618             ,  :TRBNTF-ACTVY-RSLU-CDE                            04261801
042619             ,  :TRBNTF-INITR-ENT-ID                              04261901
042620             ,  :TRBNTF-FOB-CDE                                   04262001
042621             ,  :TRBNTF-POE-CDE                                   04262101
042622             ,  :TRBNTF-PREPK-ID                                  04262201
043000     END-EXEC.                                                    04300001
043100                                                                  04310001
043200     EVALUATE TRUE                                                04320001
043300         WHEN SQLCODE = ZERO                                      04330001
043400              ADD +1                 TO PV-TABLE-ROW-SELECT-CNT   04340001
043500              SET PS-CURSOR-HAS-DATA TO TRUE                      04350001
043600         WHEN SQLCODE = +100                                      04360001
043700              SET PS-TABLE-LOOP-DONE TO TRUE                      04370001
043800         WHEN SQLWARN0 NOT EQUAL SPACE                            04380001
043900         WHEN SQLCODE NOT EQUAL ZERO                              04390001
044000              MOVE '9150-FETCH-TABLE-CURSOR'                      04400001
044100                                 TO PV-PARAGRAPH-NAME             04410001
044200              MOVE 'FETCH TABLE CURSOR'                           04420001
044300                                 TO PV-DB2-OPERATION-MSG-1        04430001
044400              MOVE 'TTRBNTF'     TO PV-DB2-TABLE-NAME             04440001
044500              PERFORM 9999-DB2-ABEND                              04450001
044600     END-EVALUATE.                                                04460001
044700                                                                  04470001
044800                                                                  04480001
044900* ************************************************************** *04490001
045000* * CLOSE TABLE CURSOR                                         * *04500001
045100* ************************************************************** *04510001
045200 9190-CLOSE-TABLE-CURSOR.                                         04520001
045300     EXEC SQL                                                     04530001
045400          CLOSE TABLE-CURSOR                                      04540001
045500     END-EXEC.                                                    04550001
045600                                                                  04560001
045700     EVALUATE TRUE                                                04570001
045800         WHEN SQLCODE = ZERO                                      04580001
045900              CONTINUE                                            04590001
046000         WHEN SQLWARN0 NOT EQUAL SPACE                            04600001
046100         WHEN SQLCODE NOT EQUAL ZERO                              04610001
046200              MOVE '9190-CLOSE-TABLE-CURSOR'                      04620001
046300                                 TO PV-PARAGRAPH-NAME             04630001
046400              MOVE 'CLOSE TABLE CURSOR'                           04640001
046500                                 TO PV-DB2-OPERATION-MSG-1        04650001
046600              MOVE 'TTRBNTF'     TO PV-DB2-TABLE-NAME             04660001
046700              PERFORM 9999-DB2-ABEND                              04670001
046800     END-EVALUATE.                                                04680001
046900                                                                  04690001
047000                                                                  04700001
047100* ************************************************************** *04710001
047200* * OPEN OUTPUT EXTRACT FILE                                   * *04720001
047300* ************************************************************** *04730001
047400 9700-OPEN-OUT-EXTRACT-FILE.                                      04740001
047500     OPEN OUTPUT OUT-EXTRACT-FILE.                                04750001
047600                                                                  04760001
047700                                                                  04770001
047800* ************************************************************** *04780001
047900* * WRITE A RECORD TO THE TABLE EXTRACT FILE                   * *04790001
048000* ************************************************************** *04800001
048100 9750-WRITE-EXTRACT-RECORD.                                       04810001
048200     WRITE  OUT-EXTRACT-RECORD  FROM  DCLTTRBNTF.                 04820001
048300     ADD +1 TO PV-EXTRACT-WRITTEN-CNT.                            04830001
048400                                                                  04840001
048500                                                                  04850001
048600* ************************************************************** *04860001
048700* * CLOSE OUTPUT EXTRACT FILE                                  * *04870001
048800* ************************************************************** *04880001
048900 9790-CLOSE-OUT-EXTRACT-FILE.                                     04890001
049000     CLOSE OUT-EXTRACT-FILE.                                      04900001
049100                                                                  04910001
049200                                                                  04920001
049300* ************************************************************** *04930001
049400* * DISPLAY INFORMATION NEEDED FOR DEBUGGING/MAINTENANCE/SUPPORT *04940001
049500* * AND CALL THE ABEND PROCESSOR IN THE EVENT THAT AN          * *04950001
049600* * SQL ERROR OR WARNING CODE OCCURS.                          * *04960001
049700* ************************************************************** *04970001
049800 9999-DB2-ABEND.                                                  04980001
049900                                                                  04990001
050000     DISPLAY PC-CURRENT-PROGRAM-NAME                              05000001
050100             ' 9999-DB2-ABEND'.                                   05010001
050200     DISPLAY PC-CURRENT-PROGRAM-NAME                              05020001
050300             ' ** ABEND           **'.                            05030001
050400     DISPLAY PC-CURRENT-PROGRAM-NAME                              05040001
050500             ' ** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.       05050001
050600     DISPLAY PC-CURRENT-PROGRAM-NAME                              05060001
050700             ' ** TABLES AFFECTED ** = ' PV-DB2-TABLE-NAME.       05070001
050800     DISPLAY PC-CURRENT-PROGRAM-NAME                              05080001
050900             ' ** OPERATION       ** = ' PV-DB2-OPERATION-MSG-1.  05090001
051000                                                                  05100001
051100     DISPLAY PC-CURRENT-PROGRAM-NAME                              05110001
051200             ' ** SQLCODE         ** = ' SQLCODE.                 05120001
051300     MOVE SQLCODE TO PV-SQLCODE.                                  05130001
051400     DISPLAY PC-CURRENT-PROGRAM-NAME                              05140001
051500             ' ** PV-SQLCODE      ** = ' PV-SQLCODE '.'.          05150001
051600                                                                  05160001
051700     DISPLAY PC-CURRENT-PROGRAM-NAME                              05170001
051800             ' ** SQLWARN0        ** = ' SQLWARN0 '.'.            05180001
051900                                                                  05190001
052000                                                                  05200001
052100*----------------------------------------------------------------*05210001
052200* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *05220001
052300* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *05230001
052400* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *05240001
052500* FORMAT.                                                        *05250001
052600*----------------------------------------------------------------*05260001
052700     COPY DPPD004.                                                05270001
052800                                                                  05280001
052900     MOVE PC-ABENDING               TO DP-STATUS-DESCRIPTION.     05290001
053000     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           05300001
053100     PERFORM 9090-CLOSE-IN-DRIVER-FILE.                           05310001
053200     PERFORM 9790-CLOSE-OUT-EXTRACT-FILE.                         05320001
053300                                                                  05330001
053400*----------------------------------------------------------------*05340001
053500* CALL ABEND                                                     *05350001
053600*----------------------------------------------------------------*05360001
053700     MOVE +4013                  TO ABEND-CODE.                   05370001
053800     CALL 'ILBOABN0' USING ABEND-CODE.                            05380001
053900*                                                                 05390001
