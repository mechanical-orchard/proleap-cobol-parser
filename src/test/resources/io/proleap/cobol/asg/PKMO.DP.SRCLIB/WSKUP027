000100 IDENTIFICATION DIVISION.                                         00010000
000200 TITLE 'ASN XREF - PURGE'.                                        00020000
000300**************************************************************    00030000
000400*   THIS PROGRAM WILL PURGE THE ASN XREF TABLES:             *    00040000
000500*   WST_SHPMT_XREF_HDR & WST_SHPMT_XREF_DTL.                 *    00050000
000600*   THE HDRS & DTLS WILL BE WRITTEN TO GDG'S.                *    00060000
000700*   THE PURGE-TMST WILL BE CALCULATED.                       *    00070000
000800*   THE PURGE-TMST WILL BE USED TO LOCATE ANY                *    00080000
000900*   VERIFIED HDRS FROM THE XREF TABLE THAT FALL INTO         *    00090000
001000*   THE RANGE OF RCPT_TMST <= PURGE-TMST. THESE WILL BE      *    00100000
001100*   PURGED AND THE HDRS & DTLS DUMPED TO GDG'S.              *    00110000
001200*   THERE IS A CASCADE DELETE DEFINED BETWEEN THE HDR & DTL  *    00120011
001300*   TABLES.                                                  *    00130011
001400**************************************************************    00140000
001500 PROGRAM-ID.    WSKUP027.                                         00150005
001600 AUTHOR.        THERESE RAMSEYER.                                 00160000
001700 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00170000
001800 DATE-WRITTEN.  APRIL 2007.                                       00180000
001900 DATE-COMPILED.                                                   00190000
002000 ENVIRONMENT DIVISION.                                            00200000
002100 CONFIGURATION SECTION.                                           00210000
002200 SOURCE-COMPUTER. IBM-3090.                                       00220000
002300 OBJECT-COMPUTER. IBM-3090.                                       00230000
002400 INPUT-OUTPUT SECTION.                                            00240000
002500                                                                  00250000
002600 FILE-CONTROL.                                                    00260000
002700                                                                  00270000
002800     SELECT OUTPUT-HEADER-FILE                                    00280000
002900         ASSIGN                       TO OUT01.                   00290000
003000                                                                  00300000
003100     SELECT OUTPUT-DETAIL-FILE                                    00310000
003200         ASSIGN                       TO OUT02.                   00320000
003300                                                                  00330000
003400                                                                  00340000
003500 DATA DIVISION.                                                   00350000
003600 FILE SECTION.                                                    00360000
003700                                                                  00370000
003800 FD  OUTPUT-HEADER-FILE                                           00380000
003900     RECORDING MODE IS F                                          00390000
004000     LABEL RECORDS ARE STANDARD                                   00400000
004100     RECORD CONTAINS 200 CHARACTERS                               00410015
004200     BLOCK CONTAINS 0 RECORDS.                                    00420000
004300 01  OUTPUT-HEADER-RECORD            PIC  X(200).                 00430015
004400                                                                  00440000
004500 FD  OUTPUT-DETAIL-FILE                                           00450000
004600     RECORDING MODE IS F                                          00460000
004700     LABEL RECORDS ARE STANDARD                                   00470000
004800     RECORD CONTAINS 125 CHARACTERS                               00480015
004900     BLOCK CONTAINS 0 RECORDS.                                    00490000
005000 01  OUTPUT-DETAIL-RECORD            PIC  X(125).                 00500015
005100                                                                  00510000
005200                                                                  00520000
005300 WORKING-STORAGE SECTION.                                         00530000
005400 01  PV-PROGRAM-VARIABLES.                                        00540000
005500     05  PV-UNION-TYPE                PIC  X(01).                 00550000
005600     05  PV-NULL-IND                  PIC S9(4) VALUE ZERO        00560000
005700                                                COMP SYNC.        00570000
005800     05  PV-HOLD-PO-NBR               PIC  S9(9) COMP.            00580000
005900     05  PV-DAYS                      PIC  9(05) VALUE ZERO.      00590006
006000     05  PV-RETRY-COUNTER             PIC S9(04) VALUE +0         00600000
006100                                                COMP SYNC.        00610000
006200     05  PV-INPUT-TRIP-SIGNED         PIC  S9(9) COMP.            00620000
006300     05  PV-PURGE-TMST                PIC   X(26) VALUE SPACE.    00630000
006310     05  PV-PURGE-TMST2               PIC   X(26) VALUE SPACE.    00631016
006320     05  PV-PURGE-TMST3               PIC   X(26) VALUE SPACE.    00632016
006330     05  PV-PURGE-TMST4               PIC   X(26) VALUE SPACE.    00633027
006340     05  PV-PURGE-TMST5               PIC   X(26) VALUE SPACE.    00634027
006400                                                                  00640000
006500 01  ABEND-CODE                       PIC S9(04) VALUE +0         00650000
006600                                                 COMP SYNC.       00660000
006700 01  NI-NULL-INDICATORS.                                          00670000
006800       05  NI-OTBND-TRIP-IND          PIC S9(04) COMP VALUE +0.   00680000
006900                                                                  00690000
007000 01  PA-PROGRAM-ACCUMULATORS.                                     00700000
007100     05  PA-SUB-TOTALS.                                           00710000
007200         10 PA-DTLS-FOUND-THIS-SHPMT   PIC S9(09) VALUE +0 COMP-3.00720000
007300         10 PA-DTLS-WRIT-THIS-SHPMT    PIC S9(09) VALUE +0 COMP-3.00730000
007400     05  PA-GRAND-TOTALS.                                         00740000
007500         10 PA-TOT-HDRS-FOUND          PIC S9(09) VALUE +0 COMP-3.00750000
007600         10 PA-TOT-DTLS-FOUND          PIC S9(09) VALUE +0 COMP-3.00760000
007700         10 PA-TOT-HDRS-PURGED         PIC S9(09) VALUE +0 COMP-3.00770000
007800         10 PA-TOT-HDRS-WRIT           PIC S9(09) VALUE +0 COMP-3.00780000
007900         10 PA-TOT-DTLS-WRIT           PIC S9(09) VALUE +0 COMP-3.00790000
007910         10 PA-TOT-HDRS2-FOUND         PIC S9(09) VALUE +0 COMP-3.00791016
007920         10 PA-TOT-DTLS2-FOUND         PIC S9(09) VALUE +0 COMP-3.00792016
007930         10 PA-TOT-HDRS2-PURGED        PIC S9(09) VALUE +0 COMP-3.00793016
007940         10 PA-TOT-HDRS2-WRIT          PIC S9(09) VALUE +0 COMP-3.00794016
007950         10 PA-TOT-DTLS2-WRIT          PIC S9(09) VALUE +0 COMP-3.00795016
007960         10 PA-TOT-HDRS3-FOUND         PIC S9(09) VALUE +0 COMP-3.00796016
007970         10 PA-TOT-DTLS3-FOUND         PIC S9(09) VALUE +0 COMP-3.00797016
007980         10 PA-TOT-HDRS3-PURGED        PIC S9(09) VALUE +0 COMP-3.00798016
007990         10 PA-TOT-HDRS3-WRIT          PIC S9(09) VALUE +0 COMP-3.00799016
007991         10 PA-TOT-DTLS3-WRIT          PIC S9(09) VALUE +0 COMP-3.00799116
007992                                                                  00799231
007993         10 PA-TOT-HDRS4-FOUND         PIC S9(09) VALUE +0 COMP-3.00799331
007994         10 PA-TOT-DTLS4-FOUND         PIC S9(09) VALUE +0 COMP-3.00799431
007995         10 PA-TOT-HDRS4-PURGED        PIC S9(09) VALUE +0 COMP-3.00799531
007996         10 PA-TOT-HDRS4-WRIT          PIC S9(09) VALUE +0 COMP-3.00799631
007997         10 PA-TOT-DTLS4-WRIT          PIC S9(09) VALUE +0 COMP-3.00799731
007998         10 PA-TOT-HDRS5-FOUND         PIC S9(09) VALUE +0 COMP-3.00799831
007999         10 PA-TOT-DTLS5-FOUND         PIC S9(09) VALUE +0 COMP-3.00799931
008000         10 PA-TOT-HDRS5-PURGED        PIC S9(09) VALUE +0 COMP-3.00800031
008001         10 PA-TOT-HDRS5-WRIT          PIC S9(09) VALUE +0 COMP-3.00800131
008002         10 PA-TOT-DTLS5-WRIT          PIC S9(09) VALUE +0 COMP-3.00800231
008010                                                                  00801000
008100 01  PS-PROGRAM-SWITCHES.                                         00810000
008200     05  PS-END-OF-HDR-CSR-SW          PIC  X(01)    VALUE 'N'.   00820000
008300         88  PS-END-OF-HDR-CSR-YES                   VALUE 'Y'.   00830000
008400         88  PS-END-OF-HDR-CSR-NO                    VALUE 'N'.   00840000
008500     05  PS-END-OF-DTL-CSR-SW          PIC  X(01)    VALUE 'N'.   00850000
008600         88  PS-END-OF-DTL-CSR-YES                   VALUE 'Y'.   00860000
008700         88  PS-END-OF-DTL-CSR-NO                    VALUE 'N'.   00870000
008710     05  PS-END-OF-HDR2-CSR-SW         PIC  X(01)    VALUE 'N'.   00871016
008720         88  PS-END-OF-HDR2-CSR-YES                  VALUE 'Y'.   00872016
008730         88  PS-END-OF-HDR2-CSR-NO                   VALUE 'N'.   00873016
008740     05  PS-END-OF-HDR3-CSR-SW         PIC  X(01)    VALUE 'N'.   00874016
008750         88  PS-END-OF-HDR3-CSR-YES                  VALUE 'Y'.   00875016
008760         88  PS-END-OF-HDR3-CSR-NO                   VALUE 'N'.   00876016
008770     05  PS-END-OF-HDR4-CSR-SW         PIC  X(01)    VALUE 'N'.   00877030
008780         88  PS-END-OF-HDR4-CSR-YES                  VALUE 'Y'.   00878030
008790         88  PS-END-OF-HDR4-CSR-NO                   VALUE 'N'.   00879030
008791     05  PS-END-OF-HDR5-CSR-SW         PIC  X(01)    VALUE 'N'.   00879130
008792         88  PS-END-OF-HDR5-CSR-YES                  VALUE 'Y'.   00879230
008793         88  PS-END-OF-HDR5-CSR-NO                   VALUE 'N'.   00879330
008800                                                                  00880000
008900 01  PC-PROGRAM-CONSTANTS.                                        00890000
009000     05  PC-MAX-RETRIES              PIC S9(04) VALUE +3 COMP.    00900000
009100     05  PC-HIGH-NINES               PIC S9(04) VALUE +9999 COMP. 00910000
009200     05  PC-PROGRAM-NAME             PIC  X(08) VALUE 'WSKUP027'. 00920005
009300     05  PC-VERIFIED                 PIC  X(01) VALUE 'V'.        00930000
009400     05  PC-PRC-TYP-CDE              PIC  X(08) VALUE 'ASN     '. 00940000
009500     05  PC-DEFAULT-NINES            PIC  X(26) VALUE             00950000
009600                                     '9999-09-09-09.09.09.999999'.00960000
009700     05  PC-DEFAULT-TMST             PIC  X(26) VALUE             00970000
009800                                     '0001-01-01-01.01.01.000001'.00980000
009900                                                                  00990000
010000******************************************************************01000000
010100*  WST_SHPMT_XREF_HDR PURGE RECORD LAYOUT                         01010014
010200******************************************************************01020000
010300     COPY WSRD047.                                                01030014
010400                                                                  01040000
010401******************************************************************01040114
010402*  WST_SHPMT_XREF_DTL PURGE RECORD LAYOUT                         01040214
010403******************************************************************01040314
010404     COPY WSRD048.                                                01040414
010405                                                                  01040514
010410******************************************************************01041014
010420*  DB2 FORMATTED MESSAGE AREA                                     01042014
010430******************************************************************01043014
010440     COPY DPWS004.                                                01044014
010450                                                                  01045014
010500******************************************************************01050000
010600*  COMMUNICATIONS AREA FOR DB2                                    01060000
010700******************************************************************01070000
010800     EXEC SQL                                                     01080000
010900          INCLUDE SQLCA                                           01090000
011000     END-EXEC.                                                    01100000
011100                                                                  01110000
011200******************************************************************01120000
011300*  DB2 TABLE DECLARATION - HEADER SHIPMENT CROSS REFERENCE        01130000
011400*      (WST_SHPMT_XREF_HDR)                                       01140000
011500******************************************************************01150000
011600     EXEC SQL                                                     01160000
011700          INCLUDE WST00001                                        01170000
011800     END-EXEC.                                                    01180000
011900                                                                  01190000
012000******************************************************************01200000
012100*  DB2 TABLE DECLARATION - DETAIL SHIPMENT CROSS REFERENCE        01210000
012200*      (WST_SHPMT_XREF_DTL)                                       01220000
012300******************************************************************01230000
012400     EXEC SQL                                                     01240000
012500          INCLUDE WST00002                                        01250000
012600     END-EXEC.                                                    01260000
012700                                                                  01270000
012800******************************************************************01280000
012900*  DB2 TABLE DECLARATION - WMS INTEGRATION TYPE                   01290000
013000*      (WST_INTGRTN_TYP)                                          01300000
013100******************************************************************01310000
013200     EXEC SQL                                                     01320000
013300          INCLUDE WST00008                                        01330000
013400     END-EXEC.                                                    01340000
013500                                                                  01350000
013600******************************************************************01360000
013700*  DB2 TABLE DECLARATION - WMS ATTRIBUTE DEFINITION               01370000
013800*      (WST_ATTR_DEFN)                                            01380000
013900******************************************************************01390000
014000     EXEC SQL                                                     01400000
014100          INCLUDE WST00009                                        01410000
014200     END-EXEC.                                                    01420000
014300                                                                  01430000
014400******************************************************************01440000
014500*  DB2 TABLE DECLARATION - WMS ATTRIBUTE ELEMENT                  01450000
014600*      (WST_ATTR_ELEM)                                            01460000
014700******************************************************************01470000
014800     EXEC SQL                                                     01480000
014900          INCLUDE WST00010                                        01490000
015000     END-EXEC.                                                    01500000
015100                                                                  01510000
015110******************************************************************01511023
015120*  DB2 TABLE DECLARATION - INBOUND TRIP                           01512023
015130*      (TVHTRIP)                                                  01513023
015140******************************************************************01514023
015150     EXEC SQL                                                     01515023
015160          INCLUDE TVHTRIP                                         01516023
015170     END-EXEC.                                                    01517023
015180                                                                  01518023
015181******************************************************************01518129
015182*  DB2 TABLE DECLARATION - INBOUND TRIP STATUS                    01518229
015183*      (TTRIPST)                                                  01518329
015184******************************************************************01518429
015185     EXEC SQL                                                     01518529
015186          INCLUDE TTRIPST                                         01518629
015187     END-EXEC.                                                    01518729
015188                                                                  01518829
015189******************************************************************01518929
015190*  DB2 TABLE DECLARATION - INBOUND TRIP STATUS TYPE               01519029
015191*      (TTRSTYP)                                                  01519129
015192******************************************************************01519229
015193     EXEC SQL                                                     01519329
015194          INCLUDE TTRSTYP                                         01519429
015195     END-EXEC.                                                    01519529
015196                                                                  01519629
015197******************************************************************01519723
015198*  DB2 TABLE DECLARATION - OUTBOUND TRIP                          01519823
015199*      (TSUOBTR)                                                  01519923
015200******************************************************************01520023
015201     EXEC SQL                                                     01520123
015202          INCLUDE TSUOBTR                                         01520223
015203     END-EXEC.                                                    01520323
015204                                                                  01520423
015205******************************************************************01520529
015206*  DB2 TABLE DECLARATION - OUTBOUND TRIP STATUS                   01520629
015207*      (TSUOBTS)                                                  01520729
015208******************************************************************01520829
015209     EXEC SQL                                                     01520929
015210          INCLUDE TSUOBTS                                         01521029
015211     END-EXEC.                                                    01521129
015212                                                                  01521229
015220******************************************************************01522000
015300**  CURSOR DECLARATIONS                                         **01530000
015400******************************************************************01540000
015500     EXEC SQL                                                     01550000
015600          DECLARE HDR_CSR CURSOR WITH HOLD FOR                    01560000
015700           SELECT   EXT_SHP_ID                                    01570000
015800                   ,INTR_TRIP_ID                                  01580000
015900                   ,SOR_CDE                                       01590000
016000                   ,DMY_SEQ_NBR                                   01600000
016100                   ,DEST_LOC_NBR                                  01610000
016200                   ,DWNLD_CDE                                     01620000
016300                   ,RCPT_TMST                                     01630000
016400                   ,CRE_USR_ID                                    01640000
016500                   ,CRE_TMST                                      01650000
016600                   ,DWNLD_TMST                                    01660000
016700                   ,LAST_PRCG_TMST                                01670000
016800                   ,PRC_CDE                                       01680000
016900                   ,VER_NBR                                       01690000
017000           FROM  WST_SHPMT_XREF_HDR                               01700040
017100           WHERE RCPT_TMST    <= :PV-PURGE-TMST                   01710000
017200           AND   PRC_CDE       = :PC-VERIFIED                     01720000
017300           ORDER BY  EXT_SHP_ID          ASC                      01730000
017400     END-EXEC.                                                    01740000
017500                                                                  01750000
017600     EXEC SQL                                                     01760000
017700          DECLARE DTL_CSR CURSOR FOR                              01770000
017800           SELECT   EXT_SHP_ID                                    01780000
017900                   ,PO_NBR                                        01790000
018000                   ,PO_LNE_NBR                                    01800000
018100                   ,RCVR_SEQ_NBR                                  01810000
018200                   ,PREPK_ID                                      01820000
018300                   ,ASN_LVL_CDE                                   01830000
018400                   ,CRE_USR_ID                                    01840000
018500                   ,CRE_TMST                                      01850000
018600                   ,DWNLD_CDE                                     01860000
018700                   ,ACTV_CDE                                      01870000
018800           FROM  WST_SHPMT_XREF_DTL                               01880040
018900           WHERE EXT_SHP_ID    = :WS047-EXT-SHP-ID                01890014
019000           ORDER BY PO_NBR       ASC                              01900000
019100                   ,RCVR_SEQ_NBR ASC                              01910000
019200                   ,PREPK_ID     ASC                              01920000
019300                   ,PO_LNE_NBR   ASC                              01930000
019400     END-EXEC.                                                    01940000
019500                                                                  01950000
019510******************************************************************01951016
019520**  HEADER SELECTION OF DUMMY SHIPMENT WITHOUT PARENT           **01952016
019530******************************************************************01953016
019540     EXEC SQL                                                     01954016
019550          DECLARE HDR2_CSR CURSOR WITH HOLD FOR                   01955016
019560           SELECT   A.EXT_SHP_ID                                  01956016
019570                   ,A.INTR_TRIP_ID                                01957016
019580                   ,A.SOR_CDE                                     01958016
019590                   ,A.DMY_SEQ_NBR                                 01959016
019591                   ,A.DEST_LOC_NBR                                01959116
019592                   ,A.DWNLD_CDE                                   01959216
019593                   ,A.RCPT_TMST                                   01959316
019594                   ,A.CRE_USR_ID                                  01959416
019595                   ,A.CRE_TMST                                    01959516
019596                   ,A.DWNLD_TMST                                  01959616
019597                   ,A.LAST_PRCG_TMST                              01959716
019598                   ,A.PRC_CDE                                     01959816
019599                   ,A.VER_NBR                                     01959916
019600           FROM  WST_SHPMT_XREF_HDR A                             01960040
019601           WHERE A.CRE_TMST     <= :PV-PURGE-TMST2                01960116
019603             AND A.EXT_SHP_ID LIKE '%D%'                          01960316
019604             AND NOT SUBSTR(A.EXT_SHP_ID,1,10) IN                 01960416
019605                     (SELECT B.EXT_SHP_ID                         01960516
019606                        FROM WST_SHPMT_XREF_HDR B                 01960640
019607                       WHERE NOT B.EXT_SHP_ID LIKE '%D%')         01960716
019608           ORDER BY A.EXT_SHP_ID          ASC                     01960816
019609     END-EXEC.                                                    01960916
019610                                                                  01961016
019611******************************************************************01961116
019612**  CURSOR DECLARATIONS                                         **01961216
019613******************************************************************01961316
019614     EXEC SQL                                                     01961416
019615          DECLARE HDR3_CSR CURSOR WITH HOLD FOR                   01961516
019616           SELECT   A.EXT_SHP_ID                                  01961623
019617                   ,A.INTR_TRIP_ID                                01961723
019618                   ,A.SOR_CDE                                     01961823
019619                   ,A.DMY_SEQ_NBR                                 01961923
019620                   ,A.DEST_LOC_NBR                                01962023
019621                   ,A.DWNLD_CDE                                   01962123
019622                   ,A.RCPT_TMST                                   01962223
019623                   ,A.CRE_USR_ID                                  01962323
019624                   ,A.CRE_TMST                                    01962423
019625                   ,A.DWNLD_TMST                                  01962523
019626                   ,A.LAST_PRCG_TMST                              01962623
019627                   ,A.PRC_CDE                                     01962723
019628                   ,A.VER_NBR                                     01962823
019629           FROM  WST_SHPMT_XREF_HDR A                             01962940
019630           WHERE A.CRE_TMST     <= :PV-PURGE-TMST3                01963023
019631             AND A.SOR_CDE       = 'RC'                           01963123
019632              AND NOT A.INTR_TRIP_ID  IN                          01963223
019633                   (SELECT B.TRIP_ID                              01963323
019634                      FROM TVHTRIP B)                             01963423
019635           UNION                                                  01963523
019636           SELECT   C.EXT_SHP_ID                                  01963623
019637                   ,C.INTR_TRIP_ID                                01963723
019638                   ,C.SOR_CDE                                     01963823
019639                   ,C.DMY_SEQ_NBR                                 01963923
019640                   ,C.DEST_LOC_NBR                                01964023
019641                   ,C.DWNLD_CDE                                   01964123
019642                   ,C.RCPT_TMST                                   01964223
019643                   ,C.CRE_USR_ID                                  01964323
019644                   ,C.CRE_TMST                                    01964423
019645                   ,C.DWNLD_TMST                                  01964523
019646                   ,C.LAST_PRCG_TMST                              01964623
019647                   ,C.PRC_CDE                                     01964723
019648                   ,C.VER_NBR                                     01964823
019649           FROM  WST_SHPMT_XREF_HDR C                             01964940
019650           WHERE C.CRE_TMST     <= :PV-PURGE-TMST3                01965023
019651             AND C.SOR_CDE       = 'SH'                           01965123
019652              AND NOT C.INTR_TRIP_ID  IN                          01965223
019653                   (SELECT D.OTBND_TRIP_ID                        01965323
019654                      FROM TSUOBTR D)                             01965423
019655           ORDER BY  1                                            01965523
019656     END-EXEC.                                                    01965623
019657                                                                  01965723
019658******************************************************************01965825
019659**  CURSOR DECLARATIONS                                         **01965925
019660**  SELECT SHIPMENTS WITH DWNLD CODE - 'X'                      **01966025
019661**  TRIP WAS DELETE IN CICS                                     **01966125
019662******************************************************************01966225
019663     EXEC SQL                                                     01966325
019664          DECLARE HDR4_CSR CURSOR WITH HOLD FOR                   01966425
019665           SELECT   A.EXT_SHP_ID                                  01966525
019666                   ,A.INTR_TRIP_ID                                01966625
019667                   ,A.SOR_CDE                                     01966725
019668                   ,A.DMY_SEQ_NBR                                 01966825
019669                   ,A.DEST_LOC_NBR                                01966925
019670                   ,A.DWNLD_CDE                                   01967025
019671                   ,A.RCPT_TMST                                   01967125
019672                   ,A.CRE_USR_ID                                  01967225
019673                   ,A.CRE_TMST                                    01967325
019674                   ,A.DWNLD_TMST                                  01967425
019675                   ,A.LAST_PRCG_TMST                              01967525
019676                   ,A.PRC_CDE                                     01967625
019677                   ,A.VER_NBR                                     01967725
019678           FROM  WST_SHPMT_XREF_HDR A                             01967840
019679           WHERE A.CRE_TMST     <= :PV-PURGE-TMST4                01967925
019680             AND A.SOR_CDE       = 'RC'                           01968025
019681             AND A.DWNLD_CDE     = 'X'                            01968125
019704           ORDER BY  1                                            01970425
019705     END-EXEC.                                                    01970525
019706                                                                  01970625
019707******************************************************************01970725
019708**  CURSOR DECLARATIONS                                         **01970825
019709**  PURGE FOR COMPLETED TRIPS IN CICS                           **01970925
019710**        SH - STATUS SU, DR, AR                                **01971025
019711**        RC - STATUS DE, UN, DP, ET                            **01971125
019712******************************************************************01971225
019713     EXEC SQL                                                     01971325
019714          DECLARE HDR5_CSR CURSOR WITH HOLD FOR                   01971425
019715           SELECT   A.EXT_SHP_ID                                  01971525
019716                   ,A.INTR_TRIP_ID                                01971625
019717                   ,A.SOR_CDE                                     01971725
019718                   ,A.DMY_SEQ_NBR                                 01971825
019719                   ,A.DEST_LOC_NBR                                01971925
019720                   ,A.DWNLD_CDE                                   01972025
019721                   ,A.RCPT_TMST                                   01972125
019722                   ,A.CRE_USR_ID                                  01972225
019723                   ,A.CRE_TMST                                    01972325
019724                   ,A.DWNLD_TMST                                  01972425
019725                   ,A.LAST_PRCG_TMST                              01972525
019726                   ,A.PRC_CDE                                     01972625
019727                   ,A.VER_NBR                                     01972725
019728           FROM  WST_SHPMT_XREF_HDR A                             01972840
019729              ,  TTRIPST B                                        01972934
019730              ,  TTRSTYP C                                        01973034
019731           WHERE A.CRE_TMST     <= :PV-PURGE-TMST5                01973126
019732             AND A.SOR_CDE       = 'RC'                           01973226
019737             AND A.INTR_TRIP_ID  =  B.TRIP_ID                     01973726
019738             AND B.TRIP_STATUS_CDE  =  C.TRIP_STATUS_CDE          01973826
019739             AND C.PRTY_CDE IN                                    01973926
019740                 (SELECT MAX(D.PRTY_CDE)                          01974026
019741                    FROM TTRSTYP D                                01974134
019742                       , TTRIPST E                                01974234
019743                   WHERE B.TRIP_ID         =  E.TRIP_ID           01974326
019744                     AND E.TRIP_STATUS_CDE =  D.TRIP_STATUS_CDE)  01974426
019745             AND B.TRIP_STATUS_CDE  IN ('DE', 'UN', 'DP', 'ET' )  01974526
019747           UNION                                                  01974725
019748           SELECT   F.EXT_SHP_ID                                  01974826
019749                   ,F.INTR_TRIP_ID                                01974926
019750                   ,F.SOR_CDE                                     01975026
019751                   ,F.DMY_SEQ_NBR                                 01975126
019752                   ,F.DEST_LOC_NBR                                01975226
019753                   ,F.DWNLD_CDE                                   01975326
019754                   ,F.RCPT_TMST                                   01975426
019755                   ,F.CRE_USR_ID                                  01975526
019756                   ,F.CRE_TMST                                    01975626
019757                   ,F.DWNLD_TMST                                  01975726
019758                   ,F.LAST_PRCG_TMST                              01975826
019759                   ,F.PRC_CDE                                     01975926
019760                   ,F.VER_NBR                                     01976026
019761           FROM  WST_SHPMT_XREF_HDR F                             01976140
019762              ,  TSUOBTS G                                        01976235
019763           WHERE F.CRE_TMST     <= :PV-PURGE-TMST5                01976326
019764             AND F.SOR_CDE       = 'SH'                           01976426
019768             AND F.INTR_TRIP_ID  =  G.OTBND_TRIP_ID               01976826
019769             AND G.OTBND_STAT_TMST IN                             01976926
019770                 (SELECT MAX(H.OTBND_STAT_TMST)                   01977026
019771                    FROM TSUOBTS H                                01977135
019772                   WHERE G.OTBND_TRIP_ID =  H.OTBND_TRIP_ID)      01977226
019773             AND G.TRIP_STAT_CDE IN ('SU','DR','AR')              01977326
019774           ORDER BY  1                                            01977426
019775     END-EXEC.                                                    01977526
019776                                                                  01977626
019777                                                                  01977726
019778******************************************************************01977828
019779 LINKAGE SECTION.                                                 01977928
019780******************************************************************01978028
019790                                                                  01979028
019800******************************************************************01980028
019900 PROCEDURE DIVISION.                                              01990028
020000******************************************************************02000028
020300******************************************************************02030000
020400*  0000-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE PROGRAM.  *02040000
020500******************************************************************02050000
020600 0000-PROGRAM-MAINLINE.                                           02060000
020700     DISPLAY '************ START OF WSKUP027 ***************'     02070005
020800                                                                  02080037
020900     PERFORM 1000-INITIALIZE.                                     02090037
021000                                                                  02100038
021100     SET PS-END-OF-HDR-CSR-NO TO TRUE.                            02110038
021200     PERFORM 1200-OPEN-HDR-CSR.                                   02120038
021300     PERFORM 1300-FETCH-HDR-CSR.                                  02130038
021400                                                                  02140038
021500     IF PS-END-OF-HDR-CSR-NO                                      02150038
021600       PERFORM 1500-CONTINUE-PROCESSING                           02160038
021700     ELSE                                                         02170038
021800        DISPLAY ' '                                               02180038
021900        DISPLAY '** NO ERRORS OR SHIPMENTS PURGED DURING **'      02190038
022000        DISPLAY '*******  THIS RUN OF THE PROCESS   *******'      02200038
022100        DISPLAY ' '                                               02210038
022300     END-IF.                                                      02230038
022400                                                                  02240038
022410*                                                                 02241016
022420*** PURGE PROCESS FOR DUMMY WITHOUT PARENT                        02242016
022421*                                                                 02242116
022422     PERFORM 1010-INITIALIZE-DUMMY.                               02242238
022423                                                                  02242338
022424     SET PS-END-OF-HDR2-CSR-NO TO TRUE.                           02242438
022425     PERFORM 1210-OPEN-HDR2-CSR.                                  02242538
022426     PERFORM 1310-FETCH-HDR2-CSR.                                 02242638
022427                                                                  02242738
022428     IF PS-END-OF-HDR2-CSR-NO                                     02242838
022429       PERFORM 1510-CONTINUE-PROCESSING                           02242938
022430     ELSE                                                         02243038
022431        DISPLAY ' '                                               02243138
022432        DISPLAY '******* NO DUMMY SHIPMENTS TO PURGE ******'      02243238
022433        DISPLAY '*******  THIS RUN OF THE PROCESS   *******'      02243338
022434        DISPLAY ' '                                               02243438
022435     END-IF.                                                      02243538
022436                                                                  02243638
022461*                                                                 02246116
022462*** PURGE PROCESS FOR OLD SHIPMENTS                               02246216
022463*                                                                 02246316
022464     PERFORM 1020-INITIALIZE-OLD.                                 02246438
022465                                                                  02246538
022466     SET PS-END-OF-HDR3-CSR-NO TO TRUE.                           02246638
022467     PERFORM 1220-OPEN-HDR3-CSR.                                  02246738
022468     PERFORM 1320-FETCH-HDR3-CSR.                                 02246838
022469                                                                  02246938
022470     IF PS-END-OF-HDR3-CSR-NO                                     02247038
022471       PERFORM 1520-CONTINUE-PROCESSING                           02247138
022472     ELSE                                                         02247238
022473        DISPLAY ' '                                               02247338
022474        DISPLAY '******** NO OLD SHIPMENTS TO PURGE *******'      02247438
022475        DISPLAY '*******  THIS RUN OF THE PROCESS   *******'      02247538
022476        DISPLAY ' '                                               02247638
022477     END-IF.                                                      02247738
022478                                                                  02247838
022480*                                                                 02248025
022481*** PURGE PROCESS FOR SHIPMENTS - 'X' DOWNLOAD CODE (DELETED)     02248125
022482*                                                                 02248225
022483     PERFORM 1030-INITIALIZE-X.                                   02248325
022484                                                                  02248425
022485     SET PS-END-OF-HDR4-CSR-NO TO TRUE.                           02248525
022486     PERFORM 1230-OPEN-HDR4-CSR.                                  02248625
022487     PERFORM 1330-FETCH-HDR4-CSR.                                 02248725
022488                                                                  02248825
022489     IF PS-END-OF-HDR4-CSR-NO                                     02248925
022490       PERFORM 1530-CONTINUE-PROCESSING                           02249025
022491     ELSE                                                         02249125
022492        DISPLAY ' '                                               02249225
022493        DISPLAY '******** NO -X- SHIPMENTS TO PURGE *******'      02249325
022494        DISPLAY '*******  THIS RUN OF THE PROCESS   *******'      02249425
022495        DISPLAY ' '                                               02249525
022496     END-IF.                                                      02249625
022497                                                                  02249725
022498*                                                                 02249825
022499*** PURGE PROCESS FOR SHIPMENTS - COMPLETED TRIPS                 02249925
022500***       SH TRIPS - STATUS 'SU','DR','AR'                        02250025
022501***       RC TRIPS - STATUS 'DE','UN','DP','ET'                   02250125
022502*                                                                 02250225
022503     PERFORM 1040-INITIALIZE-CMPLTD.                              02250325
022504                                                                  02250425
022505     SET PS-END-OF-HDR5-CSR-NO TO TRUE.                           02250525
022506     PERFORM 1240-OPEN-HDR5-CSR.                                  02250625
022507     PERFORM 1340-FETCH-HDR5-CSR.                                 02250725
022508                                                                  02250825
022509     IF PS-END-OF-HDR5-CSR-NO                                     02250925
022510       PERFORM 1540-CONTINUE-PROCESSING                           02251025
022511     ELSE                                                         02251125
022512        DISPLAY ' '                                               02251225
022513        DISPLAY '********  NO SHIPMENTS TO PURGE  ******'         02251325
022514        DISPLAY '********   FOR COMPLETED TRIPS   ******'         02251425
022515        DISPLAY '******** THIS RUN OF THE PROCESS *******'        02251525
022516        DISPLAY ' '                                               02251625
022517     END-IF.                                                      02251725
022518                                                                  02251825
022519     PERFORM 8001-DISPLAY-SUMM-STATS.                             02251925
022520                                                                  02252025
022521     PERFORM 9001-CLOSE-FILES.                                    02252125
022522                                                                  02252225
022530     DISPLAY '************  END OF WSKUP027  ***************'     02253025
022600     STOP RUN.                                                    02260000
022700                                                                  02270000
022800******************************************************************02280000
022900* INIT DCLGENS                                                    02290000
023000* OPEN FILES                                                      02300000
023100* CALC PURGE TMST                                                 02310011
023200******************************************************************02320000
023300 1000-INITIALIZE.                                                 02330000
023400                                                                  02340000
023500     INITIALIZE WS047-SHPMT-XREF-HDR-REC                          02350014
023600                WS048-SHPMT-XREF-DTL-REC.                         02360014
023700                                                                  02370000
023800     INITIALIZE PV-PROGRAM-VARIABLES                              02380000
023900                PA-PROGRAM-ACCUMULATORS.                          02390000
024000                                                                  02400000
024100     OPEN OUTPUT OUTPUT-HEADER-FILE                               02410000
024200          OUTPUT OUTPUT-DETAIL-FILE.                              02420000
024300                                                                  02430000
024400     PERFORM 1050-CALC-PURGE-TMST.                                02440000
024500                                                                  02450000
024501******************************************************************02450116
024502* INITIALIZE BEFORE PURGING DUMMY WITHOUT PARENT                 *02450216
024503******************************************************************02450316
024510 1010-INITIALIZE-DUMMY.                                           02451016
024511                                                                  02451116
024512     INITIALIZE WS047-SHPMT-XREF-HDR-REC                          02451216
024513                WS048-SHPMT-XREF-DTL-REC.                         02451316
024514                                                                  02451416
024515     PERFORM                                                      02451516
024516       WITH TEST AFTER                                            02451616
024517       VARYING PV-RETRY-COUNTER FROM 1 BY 1                       02451716
024518       UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR              02451816
024519               SQLCODE = ZERO                                     02451916
024520                                                                  02452016
024521     EXEC SQL                                                     02452116
024522         SELECT INT(C.ATTR_ELEM_NBR)                              02452216
024523              , CURRENT TIMESTAMP - (C.ATTR_ELEM_NBR) DAYS        02452316
024524         INTO   :WST00010-ATTR-ELEM-NBR                           02452416
024525              , :PV-PURGE-TMST2                                   02452516
024526         FROM WST_INTGRTN_TYP   A                                 02452616
024527            , WST_ATTR_DEFN     B                                 02452716
024528            , WST_ATTR_ELEM     C                                 02452816
024529         WHERE A.APPL_FUNC_DESC     =  'ASNPURGE'                 02452916
024530         AND   A.INTGRTN_TYP_CDE    =  'ASNPURGE2'                02453016
024531         AND   A.INTGRTN_TYP_CDE    =  B.INTGRTN_TYP_CDE          02453116
024532         AND   B.ATTR_DEFN_SEQ_NBR  =  1                          02453216
024533         AND   B.INTGRTN_TYP_CDE    =  C.INTGRTN_TYP_CDE          02453316
024534         AND   C.ATTR_DEFN_SEQ_NBR  =  1                          02453416
024535     END-EXEC                                                     02453516
024536                                                                  02453616
024537        EVALUATE TRUE                                             02453716
024538            WHEN SQLCODE = ZERO                                   02453816
024539                MOVE WST00010-ATTR-ELEM-NBR TO PV-DAYS            02453916
024540                DISPLAY ' '                                       02454016
024541                DISPLAY '--- DUMMY ASN PURGE PARAMETERS ---'      02454116
024542                DISPLAY 'NBR OF DAYS FROM CURRENT TMST: '         02454216
024543                                                     PV-DAYS      02454316
024544                DISPLAY 'PURGE TMST:                    '         02454418
024545                                       PV-PURGE-TMST2             02454518
024546                DISPLAY ' '                                       02454618
024547                                                                  02454718
024548            WHEN SQLWARN0 NOT EQUAL SPACE                         02454818
024549            WHEN SQLCODE NOT EQUAL ZERO                           02454918
024550              DISPLAY '******************************************'02455018
024551              DISPLAY '** ABEND                                **'02455118
024552              DISPLAY '** PROGRAM = WSKUP027                   **'02455218
024553              DISPLAY '** PARAGRAPH = 1010-INITIALIZE-DUMMY    **'02455318
024554              DISPLAY '** SELECT FROM WST_INTGRTN_TYP,         **'02455418
024555              DISPLAY '**     WST_ATTR_DEFN, WST_ATTR_ELEM     **'02455518
024556              DISPLAY '******************************************'02455618
024557              PERFORM 9100-SQL-ABEND                              02455718
024558        END-EVALUATE                                              02455818
024559     END-PERFORM.                                                 02455918
024560                                                                  02456018
024561     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    02456118
024562         (SQLCODE NOT = ZERO)                                     02456218
024563        DISPLAY '********************************************'    02456318
024564        DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO     **'    02456418
024565        DISPLAY '** SELECT FROM WST_INTGRTN_TYP,           **'    02456518
024566        DISPLAY '**     WST_ATTR_DEFN, WST_ATTR_ELEM       **'    02456618
024567        DISPLAY '** PARAGRAPH = 1010-INITIALIZE-DUMMY      **'    02456718
024568        DISPLAY '********************************************'    02456818
024569      PERFORM 9100-SQL-ABEND                                      02456918
024570     END-IF.                                                      02457018
024571                                                                  02457118
024572                                                                  02457216
024573******************************************************************02457316
024574* INITIALIZE BEFORE PURGING OLD DATS                             *02457416
024575******************************************************************02457516
024576 1020-INITIALIZE-OLD.                                             02457616
024577                                                                  02457716
024578     INITIALIZE WS047-SHPMT-XREF-HDR-REC                          02457816
024579                WS048-SHPMT-XREF-DTL-REC.                         02457916
024580                                                                  02458016
024582     PERFORM                                                      02458216
024583       WITH TEST AFTER                                            02458316
024584       VARYING PV-RETRY-COUNTER FROM 1 BY 1                       02458416
024585       UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR              02458516
024586               SQLCODE = ZERO                                     02458616
024587                                                                  02458716
024588     EXEC SQL                                                     02458816
024589         SELECT INT(C.ATTR_ELEM_NBR)                              02458916
024590              , CURRENT TIMESTAMP - (C.ATTR_ELEM_NBR) DAYS        02459016
024591         INTO   :WST00010-ATTR-ELEM-NBR                           02459116
024592              , :PV-PURGE-TMST3                                   02459216
024593         FROM WST_INTGRTN_TYP   A                                 02459316
024594            , WST_ATTR_DEFN     B                                 02459416
024595            , WST_ATTR_ELEM     C                                 02459516
024596         WHERE A.APPL_FUNC_DESC     =  'ASNPURGE'                 02459616
024597         AND   A.INTGRTN_TYP_CDE    =  'ASNPURGE3'                02459716
024598         AND   A.INTGRTN_TYP_CDE    =  B.INTGRTN_TYP_CDE          02459816
024599         AND   B.ATTR_DEFN_SEQ_NBR  =  1                          02459916
024600         AND   B.INTGRTN_TYP_CDE    =  C.INTGRTN_TYP_CDE          02460016
024601         AND   C.ATTR_DEFN_SEQ_NBR  =  1                          02460116
024602     END-EXEC                                                     02460216
024603                                                                  02460316
024604        EVALUATE TRUE                                             02460416
024605            WHEN SQLCODE = ZERO                                   02460516
024606                MOVE WST00010-ATTR-ELEM-NBR TO PV-DAYS            02460616
024607                DISPLAY ' '                                       02460716
024608                DISPLAY '---- OLD ASN PURGE PARAMETERS ----'      02460816
024609                DISPLAY 'NBR OF DAYS FROM CURRENT TMST: '         02460916
024610                                                     PV-DAYS      02461016
024611                DISPLAY 'PURGE TMST:                    '         02461118
024612                                       PV-PURGE-TMST3             02461218
024613                DISPLAY ' '                                       02461318
024614                                                                  02461418
024615            WHEN SQLWARN0 NOT EQUAL SPACE                         02461518
024616            WHEN SQLCODE NOT EQUAL ZERO                           02461618
024617              DISPLAY '******************************************'02461718
024618              DISPLAY '** ABEND                                **'02461818
024619              DISPLAY '** PROGRAM = WSKUP027                   **'02461918
024620              DISPLAY '** PARAGRAPH = 1020-INITIALIZE-OLD      **'02462018
024621              DISPLAY '** SELECT FROM WST_INTGRTN_TYP,         **'02462118
024622              DISPLAY '**     WST_ATTR_DEFN, WST_ATTR_ELEM     **'02462218
024623              DISPLAY '******************************************'02462318
024624              PERFORM 9100-SQL-ABEND                              02462418
024625        END-EVALUATE                                              02462518
024626     END-PERFORM.                                                 02462618
024627                                                                  02462718
024628     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    02462818
024629         (SQLCODE NOT = ZERO)                                     02462918
024630        DISPLAY '********************************************'    02463018
024631        DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO     **'    02463118
024632        DISPLAY '** SELECT FROM WST_INTGRTN_TYP,           **'    02463218
024633        DISPLAY '**     WST_ATTR_DEFN, WST_ATTR_ELEM       **'    02463318
024634        DISPLAY '** PARAGRAPH = 1020-INITIALIZE-OLD        **'    02463418
024635        DISPLAY '********************************************'    02463518
024636      PERFORM 9100-SQL-ABEND                                      02463618
024637     END-IF.                                                      02463718
024638                                                                  02463818
024639                                                                  02463918
024640******************************************************************02464025
024641* INITIALIZE BEFORE PURGING X DOWNLOAD CODE - DELETE IN CICS     *02464125
024642******************************************************************02464225
024643 1030-INITIALIZE-X.                                               02464325
024644                                                                  02464425
024645     INITIALIZE WS047-SHPMT-XREF-HDR-REC                          02464525
024646                WS048-SHPMT-XREF-DTL-REC.                         02464625
024647                                                                  02464725
024648     PERFORM                                                      02464825
024649       WITH TEST AFTER                                            02464925
024650       VARYING PV-RETRY-COUNTER FROM 1 BY 1                       02465025
024651       UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR              02465125
024652               SQLCODE = ZERO                                     02465225
024653                                                                  02465325
024654     EXEC SQL                                                     02465425
024655         SELECT INT(C.ATTR_ELEM_NBR)                              02465525
024656              , CURRENT TIMESTAMP - (C.ATTR_ELEM_NBR) DAYS        02465625
024657         INTO   :WST00010-ATTR-ELEM-NBR                           02465725
024658              , :PV-PURGE-TMST4                                   02465825
024659         FROM WST_INTGRTN_TYP   A                                 02465925
024660            , WST_ATTR_DEFN     B                                 02466025
024661            , WST_ATTR_ELEM     C                                 02466125
024662         WHERE A.APPL_FUNC_DESC     =  'ASNPURGE'                 02466225
024663         AND   A.INTGRTN_TYP_CDE    =  'ASNPURGE4'                02466325
024664         AND   A.INTGRTN_TYP_CDE    =  B.INTGRTN_TYP_CDE          02466425
024665         AND   B.ATTR_DEFN_SEQ_NBR  =  1                          02466525
024666         AND   B.INTGRTN_TYP_CDE    =  C.INTGRTN_TYP_CDE          02466625
024667         AND   C.ATTR_DEFN_SEQ_NBR  =  1                          02466725
024668     END-EXEC                                                     02466825
024669                                                                  02466925
024670        EVALUATE TRUE                                             02467025
024671            WHEN SQLCODE = ZERO                                   02467125
024672                MOVE WST00010-ATTR-ELEM-NBR TO PV-DAYS            02467225
024673                DISPLAY ' '                                       02467325
024674                DISPLAY '-- X DWNLD CDE - DELETED IN CICS--'      02467425
024675                DISPLAY 'NBR OF DAYS FROM CURRENT TMST: '         02467525
024676                                                     PV-DAYS      02467625
024677                DISPLAY 'PURGE TMST:                    '         02467725
024678                                       PV-PURGE-TMST4             02467825
024679                DISPLAY ' '                                       02467925
024680                                                                  02468025
024681            WHEN SQLWARN0 NOT EQUAL SPACE                         02468125
024682            WHEN SQLCODE NOT EQUAL ZERO                           02468225
024683              DISPLAY '******************************************'02468325
024684              DISPLAY '** ABEND                                **'02468425
024685              DISPLAY '** PROGRAM = WSKUP027                   **'02468525
024686              DISPLAY '** PARAGRAPH = 1030-INITIALIZE-X        **'02468625
024687              DISPLAY '** SELECT FROM WST_INTGRTN_TYP,         **'02468725
024688              DISPLAY '**     WST_ATTR_DEFN, WST_ATTR_ELEM     **'02468825
024689              DISPLAY '******************************************'02468925
024690              PERFORM 9100-SQL-ABEND                              02469025
024691        END-EVALUATE                                              02469125
024692     END-PERFORM.                                                 02469225
024693                                                                  02469325
024694     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    02469425
024695         (SQLCODE NOT = ZERO)                                     02469525
024696        DISPLAY '********************************************'    02469625
024697        DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO     **'    02469725
024698        DISPLAY '** SELECT FROM WST_INTGRTN_TYP,           **'    02469825
024699        DISPLAY '**     WST_ATTR_DEFN, WST_ATTR_ELEM       **'    02469925
024700        DISPLAY '** PARAGRAPH = 1030-INITIALIZE-X          **'    02470025
024701        DISPLAY '********************************************'    02470125
024702      PERFORM 9100-SQL-ABEND                                      02470225
024703     END-IF.                                                      02470325
024704                                                                  02470425
024705                                                                  02470525
024706******************************************************************02470625
024707* INITIALIZE BEFORE PURGING TRIPS THAT ARE COMPLETED IN CICS     *02470725
024708******************************************************************02470825
024709 1040-INITIALIZE-CMPLTD.                                          02470925
024710                                                                  02471025
024711     INITIALIZE WS047-SHPMT-XREF-HDR-REC                          02471125
024712                WS048-SHPMT-XREF-DTL-REC.                         02471225
024713                                                                  02471325
024714     PERFORM                                                      02471425
024715       WITH TEST AFTER                                            02471525
024716       VARYING PV-RETRY-COUNTER FROM 1 BY 1                       02471625
024717       UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR              02471725
024718               SQLCODE = ZERO                                     02471825
024719                                                                  02471925
024720     EXEC SQL                                                     02472025
024721         SELECT INT(C.ATTR_ELEM_NBR)                              02472125
024722              , CURRENT TIMESTAMP - (C.ATTR_ELEM_NBR) DAYS        02472225
024723         INTO   :WST00010-ATTR-ELEM-NBR                           02472325
024724              , :PV-PURGE-TMST5                                   02472425
024725         FROM WST_INTGRTN_TYP   A                                 02472525
024726            , WST_ATTR_DEFN     B                                 02472625
024727            , WST_ATTR_ELEM     C                                 02472725
024728         WHERE A.APPL_FUNC_DESC     =  'ASNPURGE'                 02472825
024729         AND   A.INTGRTN_TYP_CDE    =  'ASNPURGE5'                02472925
024730         AND   A.INTGRTN_TYP_CDE    =  B.INTGRTN_TYP_CDE          02473025
024731         AND   B.ATTR_DEFN_SEQ_NBR  =  1                          02473125
024732         AND   B.INTGRTN_TYP_CDE    =  C.INTGRTN_TYP_CDE          02473225
024733         AND   C.ATTR_DEFN_SEQ_NBR  =  1                          02473325
024734     END-EXEC                                                     02473425
024735                                                                  02473525
024736        EVALUATE TRUE                                             02473625
024737            WHEN SQLCODE = ZERO                                   02473725
024738                MOVE WST00010-ATTR-ELEM-NBR TO PV-DAYS            02473825
024739                DISPLAY ' '                                       02473925
024740                DISPLAY '-- PURGE TRIPS COMPLETED IN CICS--'      02474025
024741                DISPLAY 'NBR OF DAYS FROM CURRENT TMST: '         02474125
024742                                                     PV-DAYS      02474225
024743                DISPLAY 'PURGE TMST:                    '         02474325
024744                                       PV-PURGE-TMST5             02474425
024745                DISPLAY ' '                                       02474525
024746                                                                  02474625
024747            WHEN SQLWARN0 NOT EQUAL SPACE                         02474725
024748            WHEN SQLCODE NOT EQUAL ZERO                           02474825
024749              DISPLAY '******************************************'02474925
024750              DISPLAY '** ABEND                                **'02475025
024751              DISPLAY '** PROGRAM = WSKUP027                   **'02475125
024752              DISPLAY '** PARAGRAPH = 1040-INITIALIZE-CMPLTD   **'02475225
024753              DISPLAY '** SELECT FROM WST_INTGRTN_TYP,         **'02475325
024754              DISPLAY '**     WST_ATTR_DEFN, WST_ATTR_ELEM     **'02475425
024755              DISPLAY '******************************************'02475525
024756              PERFORM 9100-SQL-ABEND                              02475625
024757        END-EVALUATE                                              02475725
024758     END-PERFORM.                                                 02475825
024759                                                                  02475925
024760     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    02476025
024761         (SQLCODE NOT = ZERO)                                     02476125
024762        DISPLAY '********************************************'    02476225
024763        DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO     **'    02476325
024764        DISPLAY '** SELECT FROM WST_INTGRTN_TYP,           **'    02476425
024765        DISPLAY '**     WST_ATTR_DEFN, WST_ATTR_ELEM       **'    02476525
024766        DISPLAY '** PARAGRAPH = 1040-INITIALIZE-CMPLTD     **'    02476625
024767        DISPLAY '********************************************'    02476725
024768      PERFORM 9100-SQL-ABEND                                      02476825
024769     END-IF.                                                      02476925
024770                                                                  02477025
024771                                                                  02477125
024772******************************************************************02477200
024780**  THIS WILL CALCULATE AND CREATE THE PURGE-TMST                 02478000
024800******************************************************************02480000
024900 1050-CALC-PURGE-TMST.                                            02490000
025000                                                                  02500000
025100     PERFORM                                                      02510000
025200       WITH TEST AFTER                                            02520000
025300       VARYING PV-RETRY-COUNTER FROM 1 BY 1                       02530000
025400       UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR              02540000
025500               SQLCODE = ZERO                                     02550000
025600                                                                  02560000
025700     EXEC SQL                                                     02570000
025800         SELECT INT(C.ATTR_ELEM_NBR)                              02580000
025900              , CURRENT TIMESTAMP - (C.ATTR_ELEM_NBR) DAYS        02590000
026000         INTO   :WST00010-ATTR-ELEM-NBR                           02600000
026100              , :PV-PURGE-TMST                                    02610000
026200         FROM WST_INTGRTN_TYP   A                                 02620000
026300            , WST_ATTR_DEFN     B                                 02630000
026400            , WST_ATTR_ELEM     C                                 02640000
026500         WHERE A.APPL_FUNC_DESC     =  'ASNPURGE'                 02650000
026600         AND   A.INTGRTN_TYP_CDE    =  'ASNPURGE'                 02660000
026700         AND   A.INTGRTN_TYP_CDE    =  B.INTGRTN_TYP_CDE          02670000
026800         AND   B.ATTR_DEFN_SEQ_NBR  =  1                          02680000
026900         AND   B.INTGRTN_TYP_CDE    =  C.INTGRTN_TYP_CDE          02690000
027000         AND   C.ATTR_DEFN_SEQ_NBR  =  1                          02700000
027100     END-EXEC                                                     02710000
027200                                                                  02720000
027300        EVALUATE TRUE                                             02730000
027400            WHEN SQLCODE = ZERO                                   02740000
027500                MOVE WST00010-ATTR-ELEM-NBR TO PV-DAYS            02750006
027600                DISPLAY ' '                                       02760000
027700                DISPLAY '------ ASN PURGE PARAMETERS-------'      02770000
027800                DISPLAY 'NBR OF DAYS FROM CURRENT TMST: '         02780000
027900                                                     PV-DAYS      02790006
028000                DISPLAY 'PURGE TMST:                    '         02800018
028010                                       PV-PURGE-TMST              02801018
028100                DISPLAY ' '                                       02810000
028200                                                                  02820000
028300            WHEN SQLWARN0 NOT EQUAL SPACE                         02830000
028400            WHEN SQLCODE NOT EQUAL ZERO                           02840000
028500              DISPLAY '******************************************'02850000
028600              DISPLAY '** ABEND                                **'02860000
028700              DISPLAY '** PROGRAM = WSKUP027                   **'02870005
028800              DISPLAY '** PARAGRAPH = 1050-CALC-PURGE-TMST     **'02880000
028900              DISPLAY '** SELECT FROM WST_INTGRTN_TYP,         **'02890000
029000              DISPLAY '**     WST_ATTR_DEFN, WST_ATTR_ELEM     **'02900000
029100              DISPLAY '******************************************'02910000
029200              PERFORM 9100-SQL-ABEND                              02920000
029300        END-EVALUATE                                              02930000
029400     END-PERFORM.                                                 02940000
029500                                                                  02950000
029600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    02960000
029700         (SQLCODE NOT = ZERO)                                     02970000
029800        DISPLAY '********************************************'    02980000
029900        DISPLAY '** MAX RETRIES EXCEEDED ATTEMPTING TO     **'    02990000
030000        DISPLAY '** SELECT FROM WST_INTGRTN_TYP,           **'    03000000
030100        DISPLAY '**     WST_ATTR_DEFN, WST_ATTR_ELEM       **'    03010000
030200        DISPLAY '** PARAGRAPH = 1050-CALC-PURGE-TMST       **'    03020000
030300        DISPLAY '********************************************'    03030000
030400      PERFORM 9100-SQL-ABEND                                      03040000
030500     END-IF.                                                      03050000
030600                                                                  03060000
030700******************************************************************03070000
030800* OPEN HDR_CSR                                                   *03080000
030900******************************************************************03090000
031000 1200-OPEN-HDR-CSR.                                               03100000
031200                                                                  03120000
031300     EXEC SQL                                                     03130000
031400          OPEN HDR_CSR                                            03140000
031500     END-EXEC                                                     03150000
031600                                                                  03160000
031700     EVALUATE TRUE                                                03170000
031800         WHEN SQLCODE = ZERO                                      03180000
031900             CONTINUE                                             03190000
032000         WHEN SQLWARN0 NOT EQUAL SPACE                            03200000
032100         WHEN SQLCODE NOT EQUAL ZERO                              03210000
032200             DISPLAY '**************************************'     03220000
032300             DISPLAY '** ABEND                            **'     03230000
032400             DISPLAY '** PROGRAM = WSKUP027               **'     03240005
032500             DISPLAY '** PARAGRAPH = 1200-OPEN-HDR-CSR    **'     03250000
032600             DISPLAY '** SELECT FROM WST_SHPMT_XREF_HDR   **'     03260000
032700             DISPLAY '** PURGE TMST:' PV-PURGE-TMST               03270000
032800             DISPLAY '**************************************'     03280000
032900             PERFORM 9100-SQL-ABEND                               03290000
033000     END-EVALUATE.                                                03300000
033100                                                                  03310000
033110******************************************************************03311016
033120* OPEN HDR2_CSR - DUMMY SHIPMENTS WITH NO PARENT                 *03312016
033130******************************************************************03313016
033140 1210-OPEN-HDR2-CSR.                                              03314016
033150                                                                  03315016
033160     EXEC SQL                                                     03316016
033170          OPEN HDR2_CSR                                           03317016
033180     END-EXEC                                                     03318016
033190                                                                  03319016
033191     EVALUATE TRUE                                                03319116
033192         WHEN SQLCODE = ZERO                                      03319216
033193             CONTINUE                                             03319316
033194         WHEN SQLWARN0 NOT EQUAL SPACE                            03319416
033195         WHEN SQLCODE NOT EQUAL ZERO                              03319516
033196             DISPLAY '**************************************'     03319616
033197             DISPLAY '** ABEND                            **'     03319716
033198             DISPLAY '** PROGRAM = WSKUP027               **'     03319816
033199             DISPLAY '** PARAGRAPH = 1210-OPEN-HDR2-CSR   **'     03319916
033200             DISPLAY '** SELECT FROM WST_SHPMT_XREF_HDR   **'     03320016
033201             DISPLAY '** PURGE TMST:' PV-PURGE-TMST2              03320116
033202             DISPLAY '**************************************'     03320216
033203             PERFORM 9100-SQL-ABEND                               03320316
033204     END-EVALUATE.                                                03320416
033205                                                                  03320516
033206******************************************************************03320616
033207* OPEN HDR3_CSR - OLD SHIPMENTS                                  *03320716
033208******************************************************************03320816
033209 1220-OPEN-HDR3-CSR.                                              03320916
033210                                                                  03321016
033211     EXEC SQL                                                     03321116
033212          OPEN HDR3_CSR                                           03321216
033213     END-EXEC                                                     03321316
033214                                                                  03321416
033215     EVALUATE TRUE                                                03321516
033216         WHEN SQLCODE = ZERO                                      03321616
033217             CONTINUE                                             03321716
033218         WHEN SQLWARN0 NOT EQUAL SPACE                            03321816
033219         WHEN SQLCODE NOT EQUAL ZERO                              03321916
033220             DISPLAY '**************************************'     03322016
033221             DISPLAY '** ABEND                            **'     03322116
033222             DISPLAY '** PROGRAM = WSKUP027               **'     03322216
033223             DISPLAY '** PARAGRAPH = 1220-OPEN-HDR3-CSR   **'     03322316
033224             DISPLAY '** SELECT FROM WST_SHPMT_XREF_HDR   **'     03322416
033225             DISPLAY '** PURGE TMST:' PV-PURGE-TMST3              03322516
033226             DISPLAY '**************************************'     03322616
033227             PERFORM 9100-SQL-ABEND                               03322716
033228     END-EVALUATE.                                                03322816
033229                                                                  03322916
033230******************************************************************03323031
033231* OPEN HDR4_CSR - X DOWNLOAD CDE - DELETED IN CICS               *03323131
033232******************************************************************03323231
033233 1230-OPEN-HDR4-CSR.                                              03323331
033234                                                                  03323431
033235     EXEC SQL                                                     03323531
033236          OPEN HDR4_CSR                                           03323631
033237     END-EXEC                                                     03323731
033238                                                                  03323831
033239     EVALUATE TRUE                                                03323931
033240         WHEN SQLCODE = ZERO                                      03324031
033241             CONTINUE                                             03324131
033242         WHEN SQLWARN0 NOT EQUAL SPACE                            03324231
033243         WHEN SQLCODE NOT EQUAL ZERO                              03324331
033244             DISPLAY '**************************************'     03324431
033245             DISPLAY '** ABEND                            **'     03324531
033246             DISPLAY '** PROGRAM = WSKUP027               **'     03324631
033247             DISPLAY '** PARAGRAPH = 1230-OPEN-HDR4-CSR   **'     03324731
033248             DISPLAY '** SELECT FROM WST_SHPMT_XREF_HDR   **'     03324831
033249             DISPLAY '** PURGE TMST:' PV-PURGE-TMST4              03324931
033250             DISPLAY '**************************************'     03325031
033251             PERFORM 9100-SQL-ABEND                               03325131
033252     END-EVALUATE.                                                03325231
033253                                                                  03325331
033254******************************************************************03325431
033255* OPEN HDR5_CSR - COMPLETED TRIPS IN CICS                        *03325531
033256******************************************************************03325631
033257 1240-OPEN-HDR5-CSR.                                              03325731
033258                                                                  03325831
033259     EXEC SQL                                                     03325931
033260          OPEN HDR5_CSR                                           03326031
033261     END-EXEC                                                     03326131
033262                                                                  03326231
033263     EVALUATE TRUE                                                03326331
033264         WHEN SQLCODE = ZERO                                      03326431
033265             CONTINUE                                             03326531
033266         WHEN SQLWARN0 NOT EQUAL SPACE                            03326631
033267         WHEN SQLCODE NOT EQUAL ZERO                              03326731
033268             DISPLAY '**************************************'     03326831
033269             DISPLAY '** ABEND                            **'     03326931
033270             DISPLAY '** PROGRAM = WSKUP027               **'     03327031
033271             DISPLAY '** PARAGRAPH = 1240-OPEN-HDR5-CSR   **'     03327131
033272             DISPLAY '** SELECT FROM WST_SHPMT_XREF_HDR   **'     03327231
033273             DISPLAY '** PURGE TMST:' PV-PURGE-TMST5              03327331
033274             DISPLAY '**************************************'     03327431
033275             PERFORM 9100-SQL-ABEND                               03327531
033276     END-EVALUATE.                                                03327631
033277                                                                  03327731
033278                                                                  03327831
033280******************************************************************03328000
033300* FETCH  HDR_CSR                                                 *03330000
033400******************************************************************03340000
033500 1300-FETCH-HDR-CSR.                                              03350000
033600                                                                  03360000
033700     INITIALIZE WS047-SHPMT-XREF-HDR-REC.                         03370014
033800                                                                  03380010
033900     EXEC SQL                                                     03390000
034000          FETCH HDR_CSR                                           03400000
034100          INTO                                                    03410000
034200                :WS047-EXT-SHP-ID                                 03420014
034300               ,:WS047-INTR-TRIP-ID                               03430014
034400               ,:WS047-SOR-CDE                                    03440014
034500               ,:WS047-DMY-SEQ-NBR                                03450014
034600               ,:WS047-DEST-LOC-NBR                               03460014
034700               ,:WS047-DWNLD-CDE                                  03470014
034800               ,:WS047-RCPT-TMST                                  03480014
034900               ,:WS047-CRE-USR-ID                                 03490014
035000               ,:WS047-CRE-TMST                                   03500014
035100               ,:WS047-DWNLD-TMST                                 03510014
035200               ,:WS047-LAST-PRCG-TMST                             03520014
035300               ,:WS047-PRC-CDE                                    03530014
035400               ,:WS047-VER-NBR                                    03540014
035500     END-EXEC                                                     03550000
035600                                                                  03560000
035700     EVALUATE TRUE                                                03570000
035800         WHEN SQLCODE = ZERO                                      03580000
035900              ADD +1 TO PA-TOT-HDRS-FOUND                         03590000
036000         WHEN SQLCODE = +100                                      03600000
036100              SET PS-END-OF-HDR-CSR-YES TO TRUE                   03610000
036200                                                                  03620000
036300         WHEN SQLWARN0 NOT EQUAL SPACE                            03630000
036400         WHEN SQLCODE NOT EQUAL ZERO                              03640000
036500         WHEN SQLCODE NOT EQUAL +100                              03650000
036600             DISPLAY '**************************************'     03660000
036700             DISPLAY '** ABEND                            **'     03670000
036800             DISPLAY '** PROGRAM = WSKUP027               **'     03680005
036900             DISPLAY '** PARAGRAPH = 1300-FETCH-HDR-CSR   **'     03690000
037000             DISPLAY '** PURGE TMST: ' PV-PURGE-TMST              03700000
037100             DISPLAY '**************************************'     03710000
037200             PERFORM 9100-SQL-ABEND                               03720000
037300     END-EVALUATE.                                                03730000
037400                                                                  03740000
037410******************************************************************03741016
037420* FETCH  HDR2_CSR - DUMMY SHIPMENTS WITH NO HEADER               *03742016
037430******************************************************************03743016
037440 1310-FETCH-HDR2-CSR.                                             03744016
037450                                                                  03745016
037460     INITIALIZE WS047-SHPMT-XREF-HDR-REC.                         03746016
037470                                                                  03747016
037480     EXEC SQL                                                     03748016
037490          FETCH HDR2_CSR                                          03749016
037491          INTO                                                    03749116
037492                :WS047-EXT-SHP-ID                                 03749216
037493               ,:WS047-INTR-TRIP-ID                               03749316
037494               ,:WS047-SOR-CDE                                    03749416
037495               ,:WS047-DMY-SEQ-NBR                                03749516
037496               ,:WS047-DEST-LOC-NBR                               03749616
037497               ,:WS047-DWNLD-CDE                                  03749716
037498               ,:WS047-RCPT-TMST                                  03749816
037499               ,:WS047-CRE-USR-ID                                 03749916
037500               ,:WS047-CRE-TMST                                   03750016
037501               ,:WS047-DWNLD-TMST                                 03750116
037502               ,:WS047-LAST-PRCG-TMST                             03750216
037503               ,:WS047-PRC-CDE                                    03750316
037504               ,:WS047-VER-NBR                                    03750416
037505     END-EXEC                                                     03750516
037506                                                                  03750616
037507     EVALUATE TRUE                                                03750716
037508         WHEN SQLCODE = ZERO                                      03750816
037509              ADD +1 TO PA-TOT-HDRS2-FOUND                        03750916
037510         WHEN SQLCODE = +100                                      03751016
037511              SET PS-END-OF-HDR2-CSR-YES TO TRUE                  03751116
037512                                                                  03751216
037513         WHEN SQLWARN0 NOT EQUAL SPACE                            03751316
037514         WHEN SQLCODE NOT EQUAL ZERO                              03751416
037515         WHEN SQLCODE NOT EQUAL +100                              03751516
037516             DISPLAY '**************************************'     03751616
037517             DISPLAY '** ABEND                            **'     03751716
037518             DISPLAY '** PROGRAM = WSKUP027               **'     03751816
037519             DISPLAY '** PARAGRAPH = 1310-FETCH-HDR2-CSR  **'     03751916
037520             DISPLAY '** PURGE TMST: ' PV-PURGE-TMST2             03752016
037521             DISPLAY '**************************************'     03752116
037522             PERFORM 9100-SQL-ABEND                               03752216
037523     END-EVALUATE.                                                03752316
037524                                                                  03752416
037525******************************************************************03752516
037526* FETCH  HDR3_CSR - OLD SHIPMENTS                                *03752616
037527******************************************************************03752716
037528 1320-FETCH-HDR3-CSR.                                             03752816
037529                                                                  03752916
037530     INITIALIZE WS047-SHPMT-XREF-HDR-REC.                         03753016
037531                                                                  03753116
037532     EXEC SQL                                                     03753216
037533          FETCH HDR3_CSR                                          03753316
037534          INTO                                                    03753416
037535                :WS047-EXT-SHP-ID                                 03753516
037536               ,:WS047-INTR-TRIP-ID                               03753616
037537               ,:WS047-SOR-CDE                                    03753716
037538               ,:WS047-DMY-SEQ-NBR                                03753816
037539               ,:WS047-DEST-LOC-NBR                               03753916
037540               ,:WS047-DWNLD-CDE                                  03754016
037541               ,:WS047-RCPT-TMST                                  03754116
037542               ,:WS047-CRE-USR-ID                                 03754216
037543               ,:WS047-CRE-TMST                                   03754316
037544               ,:WS047-DWNLD-TMST                                 03754416
037545               ,:WS047-LAST-PRCG-TMST                             03754516
037546               ,:WS047-PRC-CDE                                    03754616
037547               ,:WS047-VER-NBR                                    03754716
037548     END-EXEC                                                     03754816
037549                                                                  03754916
037550     EVALUATE TRUE                                                03755016
037551         WHEN SQLCODE = ZERO                                      03755116
037552              ADD +1 TO PA-TOT-HDRS3-FOUND                        03755216
037553         WHEN SQLCODE = +100                                      03755316
037554              SET PS-END-OF-HDR3-CSR-YES TO TRUE                  03755416
037555                                                                  03755516
037556         WHEN SQLWARN0 NOT EQUAL SPACE                            03755616
037557         WHEN SQLCODE NOT EQUAL ZERO                              03755716
037558         WHEN SQLCODE NOT EQUAL +100                              03755816
037559             DISPLAY '**************************************'     03755916
037560             DISPLAY '** ABEND                            **'     03756016
037561             DISPLAY '** PROGRAM = WSKUP027               **'     03756116
037562             DISPLAY '** PARAGRAPH = 1320-FETCH-HDR3-CSR  **'     03756216
037563             DISPLAY '** PURGE TMST: ' PV-PURGE-TMST3             03756316
037564             DISPLAY '**************************************'     03756416
037565             PERFORM 9100-SQL-ABEND                               03756516
037566     END-EVALUATE.                                                03756616
037567                                                                  03756716
037568******************************************************************03756831
037569* FETCH  HDR4_CSR - X DOWNLOAD - DELETED IN CICS                 *03756931
037570******************************************************************03757031
037571 1330-FETCH-HDR4-CSR.                                             03757131
037572                                                                  03757231
037573     INITIALIZE WS047-SHPMT-XREF-HDR-REC.                         03757331
037574                                                                  03757431
037575     EXEC SQL                                                     03757531
037576          FETCH HDR4_CSR                                          03757631
037577          INTO                                                    03757731
037578                :WS047-EXT-SHP-ID                                 03757831
037579               ,:WS047-INTR-TRIP-ID                               03757931
037580               ,:WS047-SOR-CDE                                    03758031
037581               ,:WS047-DMY-SEQ-NBR                                03758131
037582               ,:WS047-DEST-LOC-NBR                               03758231
037583               ,:WS047-DWNLD-CDE                                  03758331
037584               ,:WS047-RCPT-TMST                                  03758431
037585               ,:WS047-CRE-USR-ID                                 03758531
037586               ,:WS047-CRE-TMST                                   03758631
037587               ,:WS047-DWNLD-TMST                                 03758731
037588               ,:WS047-LAST-PRCG-TMST                             03758831
037589               ,:WS047-PRC-CDE                                    03758931
037590               ,:WS047-VER-NBR                                    03759031
037591     END-EXEC                                                     03759131
037592                                                                  03759231
037593     EVALUATE TRUE                                                03759331
037594         WHEN SQLCODE = ZERO                                      03759431
037595              ADD +1 TO PA-TOT-HDRS4-FOUND                        03759531
037596         WHEN SQLCODE = +100                                      03759631
037597              SET PS-END-OF-HDR4-CSR-YES TO TRUE                  03759731
037598                                                                  03759831
037599         WHEN SQLWARN0 NOT EQUAL SPACE                            03759931
037600         WHEN SQLCODE NOT EQUAL ZERO                              03760031
037601         WHEN SQLCODE NOT EQUAL +100                              03760131
037602             DISPLAY '**************************************'     03760231
037603             DISPLAY '** ABEND                            **'     03760331
037604             DISPLAY '** PROGRAM = WSKUP027               **'     03760431
037605             DISPLAY '** PARAGRAPH = 1330-FETCH-HDR4-CSR  **'     03760531
037606             DISPLAY '** PURGE TMST: ' PV-PURGE-TMST4             03760631
037607             DISPLAY '**************************************'     03760731
037608             PERFORM 9100-SQL-ABEND                               03760831
037609     END-EVALUATE.                                                03760931
037610                                                                  03761031
037611******************************************************************03761131
037612* FETCH  HDR5_CSR - COMPLETED TRIPS IN CICS                      *03761231
037613******************************************************************03761331
037614 1340-FETCH-HDR5-CSR.                                             03761431
037615                                                                  03761531
037616     INITIALIZE WS047-SHPMT-XREF-HDR-REC.                         03761631
037617                                                                  03761731
037618     EXEC SQL                                                     03761831
037619          FETCH HDR5_CSR                                          03761931
037620          INTO                                                    03762031
037621                :WS047-EXT-SHP-ID                                 03762131
037622               ,:WS047-INTR-TRIP-ID                               03762231
037623               ,:WS047-SOR-CDE                                    03762331
037624               ,:WS047-DMY-SEQ-NBR                                03762431
037625               ,:WS047-DEST-LOC-NBR                               03762531
037626               ,:WS047-DWNLD-CDE                                  03762631
037627               ,:WS047-RCPT-TMST                                  03762731
037628               ,:WS047-CRE-USR-ID                                 03762831
037629               ,:WS047-CRE-TMST                                   03762931
037630               ,:WS047-DWNLD-TMST                                 03763031
037631               ,:WS047-LAST-PRCG-TMST                             03763131
037632               ,:WS047-PRC-CDE                                    03763231
037633               ,:WS047-VER-NBR                                    03763331
037634     END-EXEC                                                     03763431
037635                                                                  03763531
037636     EVALUATE TRUE                                                03763631
037637         WHEN SQLCODE = ZERO                                      03763731
037638              ADD +1 TO PA-TOT-HDRS5-FOUND                        03763831
037639         WHEN SQLCODE = +100                                      03763931
037640              SET PS-END-OF-HDR5-CSR-YES TO TRUE                  03764031
037641                                                                  03764131
037642         WHEN SQLWARN0 NOT EQUAL SPACE                            03764231
037643         WHEN SQLCODE NOT EQUAL ZERO                              03764331
037644         WHEN SQLCODE NOT EQUAL +100                              03764431
037645             DISPLAY '**************************************'     03764531
037646             DISPLAY '** ABEND                            **'     03764631
037647             DISPLAY '** PROGRAM = WSKUP027               **'     03764731
037648             DISPLAY '** PARAGRAPH = 1340-FETCH-HDR5-CSR  **'     03764831
037649             DISPLAY '** PURGE TMST: ' PV-PURGE-TMST5             03764931
037650             DISPLAY '**************************************'     03765031
037651             PERFORM 9100-SQL-ABEND                               03765131
037652     END-EVALUATE.                                                03765231
037653                                                                  03765331
037654                                                                  03765431
037655******************************************************************03765531
037660* MAIN PROCESSING TO EOC                                          03766000
037700******************************************************************03770000
037800 1500-CONTINUE-PROCESSING.                                        03780000
037900                                                                  03790000
038000*PROCESS INPUT FILE                                               03800000
038100     PERFORM 2000-PURGE                                           03810000
038200       UNTIL PS-END-OF-HDR-CSR-YES.                               03820000
038300                                                                  03830000
038400     PERFORM 1600-CLOSE-HDR-CSR.                                  03840000
038500                                                                  03850000
038900                                                                  03890000
038910******************************************************************03891016
038920* PROCESSING - DUMMY SHIPMENTS NO PARENT                          03892016
038930******************************************************************03893016
038940 1510-CONTINUE-PROCESSING.                                        03894016
038950                                                                  03895016
038960*PROCESS INPUT FILE                                               03896016
038970     PERFORM 2010-PURGE                                           03897016
038980       UNTIL PS-END-OF-HDR2-CSR-YES.                              03898016
038990                                                                  03899016
038991     PERFORM 1610-CLOSE-HDR2-CSR.                                 03899116
038992                                                                  03899216
038996                                                                  03899616
038997******************************************************************03899716
038998* PROCESSING - OLD SHIPMENTS                                      03899816
038999******************************************************************03899916
039000 1520-CONTINUE-PROCESSING.                                        03900016
039001                                                                  03900116
039002*PROCESS INPUT FILE                                               03900216
039003     PERFORM 2020-PURGE                                           03900316
039004       UNTIL PS-END-OF-HDR3-CSR-YES.                              03900416
039005                                                                  03900516
039006     PERFORM 1620-CLOSE-HDR3-CSR.                                 03900616
039007                                                                  03900716
039011                                                                  03901116
039012******************************************************************03901231
039013* PROCESSING - X DOWNLOAD - DELETED IN CICS                       03901331
039014******************************************************************03901431
039015 1530-CONTINUE-PROCESSING.                                        03901531
039016                                                                  03901631
039017*PROCESS INPUT FILE                                               03901731
039018     PERFORM 2030-PURGE                                           03901831
039019       UNTIL PS-END-OF-HDR4-CSR-YES.                              03901931
039020                                                                  03902031
039021     PERFORM 1630-CLOSE-HDR4-CSR.                                 03902131
039022                                                                  03902231
039026                                                                  03902631
039027******************************************************************03902731
039028* PROCESSING - COMPLETED TRIPS IN CICS                            03902831
039029******************************************************************03902931
039030 1540-CONTINUE-PROCESSING.                                        03903031
039031                                                                  03903131
039032*PROCESS INPUT FILE                                               03903231
039033     PERFORM 2040-PURGE                                           03903331
039034       UNTIL PS-END-OF-HDR5-CSR-YES.                              03903431
039035                                                                  03903531
039036     PERFORM 1640-CLOSE-HDR5-CSR.                                 03903631
039037                                                                  03903731
039038                                                                  03903831
039040******************************************************************03904000
039100* CLOSE HDR_CSR                                                  *03910000
039200******************************************************************03920000
039300 1600-CLOSE-HDR-CSR.                                              03930000
039500                                                                  03950000
039600     EXEC SQL                                                     03960000
039700          CLOSE HDR_CSR                                           03970000
039800     END-EXEC                                                     03980000
039900                                                                  03990000
040000     EVALUATE TRUE                                                04000000
040100         WHEN SQLCODE = ZERO                                      04010000
040200             CONTINUE                                             04020000
040300         WHEN SQLWARN0 NOT EQUAL SPACE                            04030000
040400         WHEN SQLCODE NOT EQUAL ZERO                              04040000
040500             DISPLAY '**************************************'     04050000
040600             DISPLAY '** ABEND                            **'     04060000
040700             DISPLAY '** PROGRAM = WSKUP027               **'     04070005
040800             DISPLAY '** PARAGRAPH = 1600-CLOSE-HDR-CSR   **'     04080000
040900             DISPLAY '**************************************'     04090000
041000             PERFORM 9100-SQL-ABEND                               04100000
041100     END-EVALUATE.                                                04110000
041200                                                                  04120000
041210******************************************************************04121016
041220* CLOSE HDR2_CSR - DUMMY SHIPMENTS NO PARENT                     *04122016
041230******************************************************************04123016
041240 1610-CLOSE-HDR2-CSR.                                             04124016
041250                                                                  04125016
041260     EXEC SQL                                                     04126016
041270          CLOSE HDR2_CSR                                          04127016
041280     END-EXEC                                                     04128016
041290                                                                  04129016
041291     EVALUATE TRUE                                                04129116
041292         WHEN SQLCODE = ZERO                                      04129216
041293             CONTINUE                                             04129316
041294         WHEN SQLWARN0 NOT EQUAL SPACE                            04129416
041295         WHEN SQLCODE NOT EQUAL ZERO                              04129516
041296             DISPLAY '**************************************'     04129616
041297             DISPLAY '** ABEND                            **'     04129716
041298             DISPLAY '** PROGRAM = WSKUP027               **'     04129816
041299             DISPLAY '** PARAGRAPH = 1610-CLOSE-HDR2-CSR  **'     04129916
041300             DISPLAY '**************************************'     04130016
041301             PERFORM 9100-SQL-ABEND                               04130116
041302     END-EVALUATE.                                                04130216
041303                                                                  04130316
041304******************************************************************04130416
041305* CLOSE HDR3_CSR - OLD SHIPMENTS                                 *04130516
041306******************************************************************04130616
041307 1620-CLOSE-HDR3-CSR.                                             04130716
041308                                                                  04130816
041309     EXEC SQL                                                     04130916
041310          CLOSE HDR3_CSR                                          04131016
041311     END-EXEC                                                     04131116
041312                                                                  04131216
041313     EVALUATE TRUE                                                04131316
041314         WHEN SQLCODE = ZERO                                      04131416
041315             CONTINUE                                             04131516
041316         WHEN SQLWARN0 NOT EQUAL SPACE                            04131616
041317         WHEN SQLCODE NOT EQUAL ZERO                              04131716
041318             DISPLAY '**************************************'     04131816
041319             DISPLAY '** ABEND                            **'     04131916
041320             DISPLAY '** PROGRAM = WSKUP027               **'     04132016
041321             DISPLAY '** PARAGRAPH = 1620-CLOSE-HDR3-CSR  **'     04132116
041322             DISPLAY '**************************************'     04132216
041323             PERFORM 9100-SQL-ABEND                               04132316
041324     END-EVALUATE.                                                04132416
041325                                                                  04132516
041326******************************************************************04132631
041327* CLOSE HDR4_CSR - X DOWNLOAD - DELETED IN CICS                  *04132731
041328******************************************************************04132831
041329 1630-CLOSE-HDR4-CSR.                                             04132931
041330                                                                  04133031
041331     EXEC SQL                                                     04133131
041332          CLOSE HDR4_CSR                                          04133231
041333     END-EXEC                                                     04133331
041334                                                                  04133431
041335     EVALUATE TRUE                                                04133531
041336         WHEN SQLCODE = ZERO                                      04133631
041337             CONTINUE                                             04133731
041338         WHEN SQLWARN0 NOT EQUAL SPACE                            04133831
041339         WHEN SQLCODE NOT EQUAL ZERO                              04133931
041340             DISPLAY '**************************************'     04134031
041341             DISPLAY '** ABEND                            **'     04134131
041342             DISPLAY '** PROGRAM = WSKUP027               **'     04134231
041343             DISPLAY '** PARAGRAPH = 1630-CLOSE-HDR4-CSR  **'     04134331
041344             DISPLAY '**************************************'     04134431
041345             PERFORM 9100-SQL-ABEND                               04134531
041346     END-EVALUATE.                                                04134631
041347                                                                  04134731
041348******************************************************************04134831
041349* CLOSE HDR5_CSR - COMPLETED IN CICS                             *04134931
041350******************************************************************04135031
041351 1640-CLOSE-HDR5-CSR.                                             04135131
041352                                                                  04135231
041353     EXEC SQL                                                     04135331
041354          CLOSE HDR5_CSR                                          04135431
041355     END-EXEC                                                     04135531
041356                                                                  04135631
041357     EVALUATE TRUE                                                04135731
041358         WHEN SQLCODE = ZERO                                      04135831
041359             CONTINUE                                             04135931
041360         WHEN SQLWARN0 NOT EQUAL SPACE                            04136031
041361         WHEN SQLCODE NOT EQUAL ZERO                              04136131
041362             DISPLAY '**************************************'     04136231
041363             DISPLAY '** ABEND                            **'     04136331
041364             DISPLAY '** PROGRAM = WSKUP027               **'     04136431
041365             DISPLAY '** PARAGRAPH = 1640-CLOSE-HDR5-CSR  **'     04136531
041366             DISPLAY '**************************************'     04136631
041367             PERFORM 9100-SQL-ABEND                               04136731
041368     END-EVALUATE.                                                04136831
041369                                                                  04136931
041370******************************************************************04137000
041400*                                                                 04140000
041500******************************************************************04150000
041600 2000-PURGE.                                                      04160000
041700                                                                  04170000
041800*FIND THE DTLS ASSOCIATED WITH THE HDR SHPMT                      04180000
041900     PERFORM 2200-OPEN-DTL-CSR.                                   04190000
042000                                                                  04200000
042100     SET PS-END-OF-DTL-CSR-NO TO TRUE.                            04210000
042200     PERFORM 2300-FETCH-DTL-CSR                                   04220000
042300       UNTIL PS-END-OF-DTL-CSR-YES.                               04230000
042400     PERFORM 2400-CLOSE-DTL-CSR.                                  04240000
042500                                                                  04250000
042600     PERFORM 2800-CASCADE-DELETE.                                 04260000
042700                                                                  04270000
042800     PERFORM 6000-DB2-COMMIT.                                     04280000
042900                                                                  04290000
043000     PERFORM 8000-DISPLAY-SHPMT-STATS.                            04300007
043100                                                                  04310007
043200     INITIALIZE PA-SUB-TOTALS.                                    04320000
043300                                                                  04330000
043400     IF PS-END-OF-HDR-CSR-NO                                      04340000
043500        PERFORM 1300-FETCH-HDR-CSR                                04350000
043600     END-IF.                                                      04360000
043700                                                                  04370000
043710******************************************************************04371016
043720* PURGE FOR DUMMY SHIPMENTS - NO PARENT                           04372016
043730******************************************************************04373016
043740 2010-PURGE.                                                      04374016
043750                                                                  04375016
043760*FIND THE DTLS ASSOCIATED WITH THE HDR SHPMT                      04376016
043770     PERFORM 2200-OPEN-DTL-CSR.                                   04377016
043780                                                                  04378016
043790     SET PS-END-OF-DTL-CSR-NO TO TRUE.                            04379016
043791     PERFORM 2300-FETCH-DTL-CSR                                   04379116
043792       UNTIL PS-END-OF-DTL-CSR-YES.                               04379216
043793     PERFORM 2400-CLOSE-DTL-CSR.                                  04379316
043794                                                                  04379416
043795     PERFORM 2810-CASCADE-DELETE.                                 04379516
043796                                                                  04379616
043797     PERFORM 6000-DB2-COMMIT.                                     04379716
043798                                                                  04379816
043799     PERFORM 8000-DISPLAY-SHPMT-STATS.                            04379916
043800                                                                  04380016
043801     INITIALIZE PA-SUB-TOTALS.                                    04380116
043802                                                                  04380216
043803     IF PS-END-OF-HDR2-CSR-NO                                     04380316
043804        PERFORM 1310-FETCH-HDR2-CSR                               04380421
043805     END-IF.                                                      04380516
043806                                                                  04380616
043807                                                                  04380716
043808******************************************************************04380816
043809* PURGE FOR OLD SHIPMENTS                                         04380916
043810******************************************************************04381016
043811 2020-PURGE.                                                      04381116
043812                                                                  04381216
043813*FIND THE DTLS ASSOCIATED WITH THE HDR SHPMT                      04381316
043814     PERFORM 2200-OPEN-DTL-CSR.                                   04381416
043815                                                                  04381516
043816     SET PS-END-OF-DTL-CSR-NO TO TRUE.                            04381616
043817     PERFORM 2300-FETCH-DTL-CSR                                   04381716
043818       UNTIL PS-END-OF-DTL-CSR-YES.                               04381816
043819     PERFORM 2400-CLOSE-DTL-CSR.                                  04381916
043820                                                                  04382016
043821     PERFORM 2820-CASCADE-DELETE.                                 04382116
043822                                                                  04382216
043823     PERFORM 6000-DB2-COMMIT.                                     04382316
043824                                                                  04382416
043825     PERFORM 8000-DISPLAY-SHPMT-STATS.                            04382516
043826                                                                  04382616
043827     INITIALIZE PA-SUB-TOTALS.                                    04382716
043828                                                                  04382816
043829     IF PS-END-OF-HDR3-CSR-NO                                     04382916
043830        PERFORM 1320-FETCH-HDR3-CSR                               04383016
043831     END-IF.                                                      04383116
043832                                                                  04383216
043833                                                                  04383316
043834******************************************************************04383431
043835* PURGE FOR X DOWNLOAD - DELETED IN CICS                          04383531
043836******************************************************************04383631
043837 2030-PURGE.                                                      04383731
043838                                                                  04383831
043839*FIND THE DTLS ASSOCIATED WITH THE HDR SHPMT                      04383931
043840     PERFORM 2200-OPEN-DTL-CSR.                                   04384031
043841                                                                  04384131
043842     SET PS-END-OF-DTL-CSR-NO TO TRUE.                            04384231
043843     PERFORM 2300-FETCH-DTL-CSR                                   04384331
043844       UNTIL PS-END-OF-DTL-CSR-YES.                               04384431
043845     PERFORM 2400-CLOSE-DTL-CSR.                                  04384531
043846                                                                  04384631
043847     PERFORM 2830-CASCADE-DELETE.                                 04384731
043848                                                                  04384831
043849     PERFORM 6000-DB2-COMMIT.                                     04384931
043850                                                                  04385031
043851     PERFORM 8000-DISPLAY-SHPMT-STATS.                            04385131
043852                                                                  04385231
043853     INITIALIZE PA-SUB-TOTALS.                                    04385331
043854                                                                  04385431
043855     IF PS-END-OF-HDR4-CSR-NO                                     04385531
043856        PERFORM 1330-FETCH-HDR4-CSR                               04385631
043857     END-IF.                                                      04385731
043858                                                                  04385831
043859                                                                  04385931
043860******************************************************************04386031
043861* PURGE FOR COMPLETED TRIPS IN CICS                               04386131
043862******************************************************************04386231
043863 2040-PURGE.                                                      04386331
043864                                                                  04386431
043865*FIND THE DTLS ASSOCIATED WITH THE HDR SHPMT                      04386531
043866     PERFORM 2200-OPEN-DTL-CSR.                                   04386631
043867                                                                  04386731
043868     SET PS-END-OF-DTL-CSR-NO TO TRUE.                            04386831
043869     PERFORM 2300-FETCH-DTL-CSR                                   04386931
043870       UNTIL PS-END-OF-DTL-CSR-YES.                               04387031
043871     PERFORM 2400-CLOSE-DTL-CSR.                                  04387131
043872                                                                  04387231
043873     PERFORM 2840-CASCADE-DELETE.                                 04387331
043874                                                                  04387431
043875     PERFORM 6000-DB2-COMMIT.                                     04387531
043876                                                                  04387631
043877     PERFORM 8000-DISPLAY-SHPMT-STATS.                            04387731
043878                                                                  04387831
043879     INITIALIZE PA-SUB-TOTALS.                                    04387931
043880                                                                  04388031
043881     IF PS-END-OF-HDR5-CSR-NO                                     04388131
043882        PERFORM 1340-FETCH-HDR5-CSR                               04388231
043883     END-IF.                                                      04388331
043884                                                                  04388431
043885                                                                  04388531
043890******************************************************************04389000
043900* OPEN DTL_CSR                                                   *04390000
044000******************************************************************04400000
044100 2200-OPEN-DTL-CSR.                                               04410000
044200                                                                  04420000
044300                                                                  04430000
044400     EXEC SQL                                                     04440000
044500          OPEN DTL_CSR                                            04450000
044600     END-EXEC                                                     04460000
044700                                                                  04470000
044800     EVALUATE TRUE                                                04480000
044900         WHEN SQLCODE = ZERO                                      04490000
045000             CONTINUE                                             04500000
045100         WHEN SQLWARN0 NOT EQUAL SPACE                            04510000
045200         WHEN SQLCODE NOT EQUAL ZERO                              04520000
045300             DISPLAY '**************************************'     04530000
045400             DISPLAY '** ABEND                            **'     04540000
045500             DISPLAY '** PROGRAM = WSKUP027               **'     04550005
045600             DISPLAY '** PARAGRAPH = 2200-OPEN-DTL-CSR    **'     04560000
045700             DISPLAY '** SELECT FROM WST_SHPMT_XREF_DTL   **'     04570000
045800             DISPLAY '** PURGE TMST:' PV-PURGE-TMST               04580000
045810             DISPLAY '** DUMMY TMST:' PV-PURGE-TMST2              04581016
045820             DISPLAY '** OLD   TMST:' PV-PURGE-TMST3              04582016
045900             DISPLAY '**************************************'     04590000
046000             PERFORM 9100-SQL-ABEND                               04600000
046100     END-EVALUATE.                                                04610000
046200                                                                  04620000
046300******************************************************************04630000
046400* FETCH  DTL_CSR                                                 *04640000
046500******************************************************************04650000
046600 2300-FETCH-DTL-CSR.                                              04660000
046700                                                                  04670000
046800     INITIALIZE WS048-SHPMT-XREF-DTL-REC.                         04680014
046900                                                                  04690010
047000     EXEC SQL                                                     04700000
047100          FETCH DTL_CSR                                           04710000
047200          INTO                                                    04720000
047300                :WS048-EXT-SHP-ID                                 04730014
047400               ,:WS048-PO-NBR                                     04740014
047500               ,:WS048-PO-LNE-NBR                                 04750014
047600               ,:WS048-RCVR-SEQ-NBR                               04760014
047700               ,:WS048-PREPK-ID                                   04770014
047800               ,:WS048-ASN-LVL-CDE                                04780014
047900               ,:WS048-CRE-USR-ID                                 04790014
048000               ,:WS048-CRE-TMST                                   04800014
048100               ,:WS048-DWNLD-CDE                                  04810014
048200               ,:WS048-ACTV-CDE                                   04820014
048300     END-EXEC                                                     04830000
048400                                                                  04840000
048500     EVALUATE TRUE                                                04850000
048600         WHEN SQLCODE = ZERO                                      04860000
048700              ADD +1 TO PA-DTLS-FOUND-THIS-SHPMT                  04870000
048800                        PA-TOT-DTLS-FOUND                         04880000
048900                        PERFORM 2500-WRITE-DETAIL-REC             04890000
049000         WHEN SQLCODE = +100                                      04900000
049100              PERFORM 2600-WRITE-HEADER-REC                       04910000
049200              SET PS-END-OF-DTL-CSR-YES TO TRUE                   04920000
049300                                                                  04930000
049400         WHEN SQLWARN0 NOT EQUAL SPACE                            04940000
049500         WHEN SQLCODE NOT EQUAL ZERO                              04950000
049600         WHEN SQLCODE NOT EQUAL +100                              04960000
049700             DISPLAY '**************************************'     04970000
049800             DISPLAY '** ABEND                            **'     04980000
049900             DISPLAY '** PROGRAM = WSKUP027               **'     04990005
050000             DISPLAY '** PARAGRAPH = 2300-FETCH-DTL-CSR   **'     05000000
050100             DISPLAY '** PURGE TMST: ' PV-PURGE-TMST              05010000
050110             DISPLAY '** DUMMY TMST: ' PV-PURGE-TMST2             05011016
050120             DISPLAY '** OLD   TMST: ' PV-PURGE-TMST3             05012016
050200             DISPLAY '**************************************'     05020000
050300             PERFORM 9100-SQL-ABEND                               05030000
050400     END-EVALUATE.                                                05040000
050500                                                                  05050000
050600******************************************************************05060000
050700* CLOSE DTL_CSR                                                  *05070000
050800******************************************************************05080000
050900 2400-CLOSE-DTL-CSR.                                              05090000
051000                                                                  05100000
051100                                                                  05110000
051200     EXEC SQL                                                     05120000
051300          CLOSE DTL_CSR                                           05130000
051400     END-EXEC                                                     05140000
051500                                                                  05150000
051600     EVALUATE TRUE                                                05160000
051700         WHEN SQLCODE = ZERO                                      05170000
051800             CONTINUE                                             05180000
051900         WHEN SQLWARN0 NOT EQUAL SPACE                            05190000
052000         WHEN SQLCODE NOT EQUAL ZERO                              05200000
052100             DISPLAY '**************************************'     05210000
052200             DISPLAY '** ABEND                            **'     05220000
052300             DISPLAY '** PROGRAM = WSKUP027               **'     05230005
052400             DISPLAY '** PARAGRAPH = 1600-CLOSE-DTL-CSR   **'     05240000
052500             DISPLAY '**************************************'     05250000
052600             PERFORM 9100-SQL-ABEND                               05260000
052700     END-EVALUATE.                                                05270000
052800                                                                  05280000
052900******************************************************************05290000
053000**                                                                05300000
053100******************************************************************05310000
053200 2500-WRITE-DETAIL-REC.                                           05320000
053300                                                                  05330000
053400     INITIALIZE OUTPUT-DETAIL-RECORD.                             05340000
053500                                                                  05350000
053600     WRITE OUTPUT-DETAIL-RECORD                                   05360000
053700      FROM WS048-SHPMT-XREF-DTL-REC.                              05370014
053800                                                                  05380000
053900     ADD +1 TO PA-DTLS-WRIT-THIS-SHPMT                            05390000
054000               PA-TOT-DTLS-WRIT.                                  05400000
054100                                                                  05410000
054200******************************************************************05420000
054300**                                                                05430000
054400******************************************************************05440000
054500 2600-WRITE-HEADER-REC.                                           05450000
054600                                                                  05460000
054700     INITIALIZE OUTPUT-HEADER-RECORD.                             05470000
054800                                                                  05480000
054900     WRITE OUTPUT-HEADER-RECORD                                   05490000
055000      FROM WS047-SHPMT-XREF-HDR-REC.                              05500014
055100                                                                  05510000
055200     ADD +1 TO PA-TOT-HDRS-WRIT.                                  05520000
055300                                                                  05530000
055400******************************************************************05540000
055500**  PURGE RECORD FROM THE WST_SHPMT_XREF_HDR TABLE WHERE          05550000
055600**  THE EXT_SHP_ID MATCHES THE CURRENT OF THE HDR CURSOR.         05560000
055700**  THIS PROCESS WILL ALSO DELETE ALL THE CORRESPONDING DTLS      05570000
055800**  FROM WST_SHPMT_XREF_DTL BECAUSE OF THE CASCADE DELETE         05580000
055900**  RELATIONSHIP DEFINED IN DB2 BETWEEN THESE TWO TABLES.         05590000
056000******************************************************************05600000
056100 2800-CASCADE-DELETE.                                             05610000
056200                                                                  05620000
056300     EXEC SQL                                                     05630000
056400        DELETE                                                    05640000
056500          FROM WST_SHPMT_XREF_HDR                                 05650040
056600          WHERE  EXT_SHP_ID = :WS047-EXT-SHP-ID                   05660014
056700     END-EXEC                                                     05670000
056800                                                                  05680000
056900     EVALUATE TRUE                                                05690000
057000         WHEN SQLCODE = ZERO                                      05700000
057100             ADD SQLERRD(3) TO PA-TOT-HDRS-PURGED                 05710009
057200                                                                  05720000
057300         WHEN SQLCODE = +100                                      05730000
057400             CONTINUE                                             05740000
057500                                                                  05750000
057600         WHEN SQLWARN0 NOT EQUAL SPACE                            05760000
057700         WHEN SQLCODE NOT EQUAL ZERO                              05770000
057800         WHEN SQLCODE NOT EQUAL +100                              05780000
057900             DISPLAY '******************************************' 05790000
058000             DISPLAY '** ABEND                                **' 05800000
058100             DISPLAY '** PROGRAM = WSKUP027                   **' 05810005
058200             DISPLAY '** PARAGRAPH = 2800-CASCADE-DELETE      **' 05820000
058300             DISPLAY '** DELETE FROM WST_SHPMT_XREF_HDR &     **' 05830000
058400             DISPLAY '**             WST_SHPMT_XREF_DTL       **' 05840000
058500             DISPLAY '******************************************' 05850000
058600             PERFORM 9100-SQL-ABEND                               05860000
058700     END-EVALUATE.                                                05870000
058800                                                                  05880000
058810******************************************************************05881016
058820**  PURGE RECORD FROM THE WST_SHPMT_XREF_HDR TABLE WHERE          05882016
058830**  THE EXT_SHP_ID MATCHES THE CURRENT OF THE HDR CURSOR.         05883016
058840**  THIS PROCESS WILL ALSO DELETE ALL THE CORRESPONDING DTLS      05884016
058850**  FROM WST_SHPMT_XREF_DTL BECAUSE OF THE CASCADE DELETE         05885016
058860**  RELATIONSHIP DEFINED IN DB2 BETWEEN THESE TWO TABLES.         05886016
058861** DUMMY SHIPMENTS - NO HEADER                                    05886116
058870******************************************************************05887016
058880 2810-CASCADE-DELETE.                                             05888016
058890                                                                  05889016
058891     EXEC SQL                                                     05889116
058892        DELETE                                                    05889216
058893          FROM WST_SHPMT_XREF_HDR                                 05889340
058894          WHERE  EXT_SHP_ID = :WS047-EXT-SHP-ID                   05889416
058895     END-EXEC                                                     05889516
058896                                                                  05889616
058897     EVALUATE TRUE                                                05889716
058898         WHEN SQLCODE = ZERO                                      05889816
058899             ADD SQLERRD(3) TO PA-TOT-HDRS2-PURGED                05889916
058900                                                                  05890016
058901         WHEN SQLCODE = +100                                      05890116
058902             CONTINUE                                             05890216
058903                                                                  05890316
058904         WHEN SQLWARN0 NOT EQUAL SPACE                            05890416
058905         WHEN SQLCODE NOT EQUAL ZERO                              05890516
058906         WHEN SQLCODE NOT EQUAL +100                              05890616
058907             DISPLAY '******************************************' 05890716
058908             DISPLAY '** ABEND                                **' 05890816
058909             DISPLAY '** PROGRAM = WSKUP027                   **' 05890916
058910             DISPLAY '** PARAGRAPH = 2810-CASCADE-DELETE      **' 05891016
058911             DISPLAY '** DELETE FROM WST_SHPMT_XREF_HDR &     **' 05891116
058912             DISPLAY '**             WST_SHPMT_XREF_DTL       **' 05891216
058913             DISPLAY '******************************************' 05891316
058914             PERFORM 9100-SQL-ABEND                               05891416
058915     END-EVALUATE.                                                05891516
058916                                                                  05891616
058918******************************************************************05891816
058919**  PURGE RECORD FROM THE WST_SHPMT_XREF_HDR TABLE WHERE          05891916
058920**  THE EXT_SHP_ID MATCHES THE CURRENT OF THE HDR CURSOR.         05892016
058921**  THIS PROCESS WILL ALSO DELETE ALL THE CORRESPONDING DTLS      05892116
058922**  FROM WST_SHPMT_XREF_DTL BECAUSE OF THE CASCADE DELETE         05892216
058923**  RELATIONSHIP DEFINED IN DB2 BETWEEN THESE TWO TABLES.         05892316
058924** OLD SHIPMENTS                                                  05892416
058925******************************************************************05892516
058926 2820-CASCADE-DELETE.                                             05892616
058927                                                                  05892716
058928     EXEC SQL                                                     05892816
058929        DELETE                                                    05892916
058930          FROM WST_SHPMT_XREF_HDR                                 05893040
058931          WHERE  EXT_SHP_ID = :WS047-EXT-SHP-ID                   05893116
058932     END-EXEC                                                     05893216
058933                                                                  05893316
058934     EVALUATE TRUE                                                05893416
058935         WHEN SQLCODE = ZERO                                      05893516
058936             ADD SQLERRD(3) TO PA-TOT-HDRS3-PURGED                05893616
058937                                                                  05893716
058938         WHEN SQLCODE = +100                                      05893816
058939             CONTINUE                                             05893916
058940                                                                  05894016
058941         WHEN SQLWARN0 NOT EQUAL SPACE                            05894116
058942         WHEN SQLCODE NOT EQUAL ZERO                              05894216
058943         WHEN SQLCODE NOT EQUAL +100                              05894316
058944             DISPLAY '******************************************' 05894416
058945             DISPLAY '** ABEND                                **' 05894516
058946             DISPLAY '** PROGRAM = WSKUP027                   **' 05894616
058947             DISPLAY '** PARAGRAPH = 2820-CASCADE-DELETE      **' 05894716
058948             DISPLAY '** DELETE FROM WST_SHPMT_XREF_HDR &     **' 05894816
058949             DISPLAY '**             WST_SHPMT_XREF_DTL       **' 05894916
058950             DISPLAY '******************************************' 05895016
058951             PERFORM 9100-SQL-ABEND                               05895116
058952     END-EVALUATE.                                                05895216
058953                                                                  05895316
058954******************************************************************05895432
058955**  PURGE RECORD FROM THE WST_SHPMT_XREF_HDR TABLE WHERE          05895532
058956**  THE EXT_SHP_ID MATCHES THE CURRENT OF THE HDR CURSOR.         05895632
058957**  THIS PROCESS WILL ALSO DELETE ALL THE CORRESPONDING DTLS      05895732
058958**  FROM WST_SHPMT_XREF_DTL BECAUSE OF THE CASCADE DELETE         05895832
058959**  RELATIONSHIP DEFINED IN DB2 BETWEEN THESE TWO TABLES.         05895932
058960** X DOWNLOAD CODE - DELETED IN CICS                              05896032
058961******************************************************************05896132
058962 2830-CASCADE-DELETE.                                             05896232
058963                                                                  05896332
058964     EXEC SQL                                                     05896432
058965        DELETE                                                    05896532
058966          FROM WST_SHPMT_XREF_HDR                                 05896640
058967          WHERE  EXT_SHP_ID = :WS047-EXT-SHP-ID                   05896732
058968     END-EXEC                                                     05896832
058969                                                                  05896932
058970     EVALUATE TRUE                                                05897032
058971         WHEN SQLCODE = ZERO                                      05897132
058972             ADD SQLERRD(3) TO PA-TOT-HDRS4-PURGED                05897232
058973                                                                  05897332
058974         WHEN SQLCODE = +100                                      05897432
058975             CONTINUE                                             05897532
058976                                                                  05897632
058977         WHEN SQLWARN0 NOT EQUAL SPACE                            05897732
058978         WHEN SQLCODE NOT EQUAL ZERO                              05897832
058979         WHEN SQLCODE NOT EQUAL +100                              05897932
058980             DISPLAY '******************************************' 05898032
058981             DISPLAY '** ABEND                                **' 05898132
058982             DISPLAY '** PROGRAM = WSKUP027                   **' 05898232
058983             DISPLAY '** PARAGRAPH = 2830-CASCADE-DELETE      **' 05898332
058984             DISPLAY '** DELETE FROM WST_SHPMT_XREF_HDR &     **' 05898432
058985             DISPLAY '**             WST_SHPMT_XREF_DTL       **' 05898532
058986             DISPLAY '******************************************' 05898632
058987             PERFORM 9100-SQL-ABEND                               05898732
058988     END-EVALUATE.                                                05898832
058989                                                                  05898932
058990******************************************************************05899032
058991**  PURGE RECORD FROM THE WST_SHPMT_XREF_HDR TABLE WHERE          05899132
058992**  THE EXT_SHP_ID MATCHES THE CURRENT OF THE HDR CURSOR.         05899232
058993**  THIS PROCESS WILL ALSO DELETE ALL THE CORRESPONDING DTLS      05899332
058994**  FROM WST_SHPMT_XREF_DTL BECAUSE OF THE CASCADE DELETE         05899432
058995**  RELATIONSHIP DEFINED IN DB2 BETWEEN THESE TWO TABLES.         05899532
058996** COMPLETED ORDERS IN CICS                                       05899632
058997******************************************************************05899732
058998 2840-CASCADE-DELETE.                                             05899832
058999                                                                  05899932
059000     EXEC SQL                                                     05900032
059001        DELETE                                                    05900132
059002          FROM WST_SHPMT_XREF_HDR                                 05900240
059003          WHERE  EXT_SHP_ID = :WS047-EXT-SHP-ID                   05900332
059004     END-EXEC                                                     05900432
059005                                                                  05900532
059006     EVALUATE TRUE                                                05900632
059007         WHEN SQLCODE = ZERO                                      05900732
059008             ADD SQLERRD(3) TO PA-TOT-HDRS5-PURGED                05900832
059009                                                                  05900932
059010         WHEN SQLCODE = +100                                      05901032
059011             CONTINUE                                             05901132
059012                                                                  05901232
059013         WHEN SQLWARN0 NOT EQUAL SPACE                            05901332
059014         WHEN SQLCODE NOT EQUAL ZERO                              05901432
059015         WHEN SQLCODE NOT EQUAL +100                              05901532
059016             DISPLAY '******************************************' 05901632
059017             DISPLAY '** ABEND                                **' 05901732
059018             DISPLAY '** PROGRAM = WSKUP027                   **' 05901832
059019             DISPLAY '** PARAGRAPH = 2850-CASCADE-DELETE      **' 05901932
059020             DISPLAY '** DELETE FROM WST_SHPMT_XREF_HDR &     **' 05902032
059021             DISPLAY '**             WST_SHPMT_XREF_DTL       **' 05902132
059022             DISPLAY '******************************************' 05902232
059023             PERFORM 9100-SQL-ABEND                               05902332
059024     END-EVALUATE.                                                05902432
059025                                                                  05902532
059026******************************************************************05902600
059030*                                                                 05903000
059100******************************************************************05910000
059200 6000-DB2-COMMIT.                                                 05920000
059300                                                                  05930000
059400     EXEC SQL                                                     05940000
059500         COMMIT                                                   05950000
059600     END-EXEC.                                                    05960000
059700                                                                  05970000
059800     EVALUATE TRUE                                                05980000
059900         WHEN SQLCODE = ZERO                                      05990000
060000         WHEN SQLCODE = +100                                      06000000
060100             CONTINUE                                             06010000
060200                                                                  06020000
060300         WHEN SQLWARN0 NOT EQUAL SPACE                            06030000
060400         WHEN SQLCODE NOT EQUAL ZERO                              06040000
060500         WHEN SQLCODE NOT EQUAL +100                              06050000
060600             DISPLAY '**************************************'     06060000
060700             DISPLAY '** ABEND                            **'     06070000
060800             DISPLAY '** PROGRAM = WSKUP027               **'     06080005
060900             DISPLAY '** PARAGRAPH = 6000-DB2-COMMIT      **'     06090000
061000             DISPLAY '** DB2 COMMIT                       **'     06100000
061100             DISPLAY '** EXT_SHP_ID     : ' WS047-EXT-SHP-ID      06110014
061200             DISPLAY '**************************************'     06120000
061300             PERFORM 9100-SQL-ABEND                               06130000
061400     END-EVALUATE.                                                06140000
061500                                                                  06150000
061600***************************************************************** 06160000
061700* DISPLAY THE NBR OF DTLS FOR A SPECIFIC SHIPMENT                 06170011
061800******************************************************************06180000
061900 8000-DISPLAY-SHPMT-STATS.                                        06190000
062000                                                                  06200000
062100     DISPLAY '#'                                                  06210000
062200     DISPLAY 'SHIPMENT.....................:' WS047-EXT-SHP-ID    06220014
062300     DISPLAY 'DTLS FOUND THIS SHPMT....:'                         06230000
062400                                      PA-DTLS-FOUND-THIS-SHPMT    06240000
062500     DISPLAY 'DTLS WRIT THIS SHPMT.....:'                         06250000
062600                                       PA-DTLS-WRIT-THIS-SHPMT    06260000
062700     DISPLAY ' '.                                                 06270000
062800                                                                  06280000
062900***************************************************************** 06290000
063000* DISPLAY THE TOTAL NBRS OF HDRS & DTLS FOUND, PURGED & WRITTEN   06300011
063100******************************************************************06310000
063200 8001-DISPLAY-SUMM-STATS.                                         06320000
063300                                                                  06330000
063400     DISPLAY '**************************************'             06340000
063500     DISPLAY '***  WSKUP027 SUMMARY STATISTICS   ***'             06350005
063600     DISPLAY '**************************************'             06360000
063700     DISPLAY 'TOT HDRS FOUND     :' PA-TOT-HDRS-FOUND             06370000
064000     DISPLAY 'TOT HDRS PURGED    :' PA-TOT-HDRS-PURGED            06400000
064200     DISPLAY ' '                                                  06420000
064501     DISPLAY ' DUMMY SHIPMENTS WITH NO HEADER '                   06450116
064510     DISPLAY 'TOT HDRS FOUND     :' PA-TOT-HDRS2-FOUND            06451016
064540     DISPLAY 'TOT HDRS PURGED    :' PA-TOT-HDRS2-PURGED           06454016
064561     DISPLAY ' '                                                  06456116
064562     DISPLAY ' OLD SHIPMENTS PURGED '                             06456216
064563     DISPLAY 'TOT HDRS FOUND     :' PA-TOT-HDRS3-FOUND            06456316
064565     DISPLAY 'TOT HDRS PURGED    :' PA-TOT-HDRS3-PURGED           06456516
064567     DISPLAY ' '                                                  06456738
064568     DISPLAY ' X - DOWNLOAD CODE - DELETED IN CICS'               06456838
064569     DISPLAY 'TOT HDRS FOUND     :' PA-TOT-HDRS4-FOUND            06456938
064571     DISPLAY 'TOT HDRS PURGED    :' PA-TOT-HDRS4-PURGED           06457138
064573     DISPLAY ' '                                                  06457316
064575     DISPLAY ' COMPLETED IN CICS'                                 06457538
064576     DISPLAY 'TOT HDRS FOUND     :' PA-TOT-HDRS5-FOUND            06457638
064578     DISPLAY 'TOT HDRS PURGED    :' PA-TOT-HDRS5-PURGED           06457838
064580     DISPLAY ' '                                                  06458038
064581     DISPLAY ' '                                                  06458138
064583     DISPLAY 'TOT DTLS FOUND     :' PA-TOT-DTLS-FOUND             06458338
064584     DISPLAY ' '                                                  06458438
064585     DISPLAY ' '                                                  06458538
064586     DISPLAY 'TOT HDRS WRITTEN   :' PA-TOT-HDRS-WRIT              06458638
064587     DISPLAY 'TOT DTLS WRITTEN   :' PA-TOT-DTLS-WRIT              06458738
064590     DISPLAY ' '.                                                 06459016
064600                                                                  06460000
064700******************************************************************06470000
064800*                                                                 06480000
064900*                                                                 06490000
065000******************************************************************06500000
065100 9001-CLOSE-FILES.                                                06510000
065200                                                                  06520000
065300     CLOSE OUTPUT-HEADER-FILE                                     06530000
065400           OUTPUT-DETAIL-FILE.                                    06540000
065500                                                                  06550000
065600******************************************************************06560000
065700* PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    *06570000
065800* ERROR OR WARNING CODE OCCURS.                                  *06580000
065900******************************************************************06590000
066000 9100-SQL-ABEND.                                                  06600000
066100******************************************************************06610000
066200* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *06620000
066300* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *06630000
066400* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *06640000
066500* FORMAT.                                                        *06650000
066600******************************************************************06660000
066700                                                                  06670000
066800     COPY DPPD004.                                                06680000
066900                                                                  06690000
067000     MOVE +4013 TO ABEND-CODE.                                    06700000
067100     CALL 'ILBOABN0' USING ABEND-CODE.                            06710000
067200                                                                  06720000
067300******************************************************************06730000
067400**            E N D   O F   P R O G R A M                       **06740000
067500******************************************************************06750000
