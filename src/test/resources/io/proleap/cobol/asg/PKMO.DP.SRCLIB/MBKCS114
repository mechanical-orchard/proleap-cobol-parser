000100*                                                                 00010020
000200*                                                                 00020020
000300*                                                                 00030020
000400 IDENTIFICATION DIVISION.                                         00040020
000500                                                                  00050020
000600 PROGRAM-ID.    MBKCS114.                                         00060020
000700 AUTHOR.        MICHELLE WEBB.                                    00070020
000800 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00080020
000900 DATE-WRITTEN.  10-14-91.                                         00090020
001000 DATE-COMPILED.                                                   00100020
001100                                                                  00110020
001200***************************************************************** 00120020
001300*    GENERIC TEMPLATE PROGRAM                                     00130020
001400*                                                                 00140020
001500*    THIS TEMPLATE CONTAINS THE MINIMUM CODE REQUIRED FOR THE     00150020
001600*    CICS ARCHITECTURE. IT ASSUMES THAT A MAP WILL BE USED, BUT   00160020
001700*    ALL FILE I/O IS LEFT TO THE DESIGNER TO CODE.                00170020
001800*    COMMENT BLOCKS LIKE THIS ONE HAVE BEEN PLACED THROUGHOUT     00180020
001900*    THIS TEMPLATE PROGRAM TO GUIDE YOU THROUGH THE CUSTOMIZING   00190020
002000*    OF THIS PROGRAM FOR YOUR PURPOSES. PLEASE ROUTE ANY COMMENTS 00200020
002100*    CONCERNING THE USE OF THIS TEMPLATE TO THE SUPPORT PERSONNEL 00210020
002200*    FOR THE CICS ARCHITECTURE SYSTEM.                            00220020
002300*                                                                 00230020
002400***************************************************************** 00240020
002500*    06/20/94 - AJR WR2602                                        00250020
002600*    REMOVED THE GROUP OWNERSHIP ID.  ALL GROUP PRICED ITEMS WILL 00260020
002700*    BE OWNED AT THE LOW (GROUP EACH PRICE).                      00270020
002800***************************************************************** 00280020
002900*                                                                 00290020
003000***************************************************************** 00300020
003100*    06/13/95 - D.HOPPA - WR#3324                                 00310020
003200*    UPDATE THE SHRINK PERCENTAGE BASED ON THE FISCAL PERIOD      00320020
003300*    SPECIFIED (EITHER CURRENT OR PREVIOUS PERIOD).               00330020
003400***************************************************************** 00340020
003500*                                                                 00350020
003600***************************************************************** 00360020
003700*    06/13/95 - D.METZGER - WR#5701                               00370020
003800*    REMOVED DP060 LOGIC AND CHANGED PROGRAM TO DISPLAY SHRINK    00380020
003900*    PERCENT FOR THE CURRENT OPEN FISCAL PERIOD USING THE NEW     00390020
004000*    MLCNTL TABLE.                                                00400020
004100***************************************************************** 00410020
003500*                                                                 00420025
003600***************************************************************** 00430025
003700*    04/09/01 - P. KEBER - WR#9999                                00440025
003800*    REMOVED UPDATE ABILITY FOR ALL FIELDS EXCEPT PLANNED SHRINK  00450025
003900*    PERCENT.                                                     00460025
004100***************************************************************** 00470025
C14666*                                                                 00480055
C14666***************************************************************** 00490027
C14666*    07/10/12 - RAVIKUMAR GUNTHA - CRQ000000014666                00500066
C14666*    - REMOVED FIELDS 'EFFECTIVE FOR FISCAL PERIOD' AND           00510027
C14666*     'LAST CHANGED'.                                             00520063
C14666*    - MOVE PLANNED FREIGHT PERCENT UP ONE ROW.                   00530027
C14666*    - ADDED LOCATION TYPE AND B&M, ECOM HEADERS.                 00540027
C14666*    - ADDED PLANNED SHRINK PERCENT LABLE                         00550027
C14666*    - EXPANDED SHRINK PERCENT BY 1 POSITION AFTER DECIMAL AND    00560027
C14666*      ALLOW -VES AND ADDED ECOM PERCENT                          00570027
C14666*    - ADDED LAST CHANGE DATE FOR B&M AND ECOM                    00580027
C14666*    - ADDED LAST CHANGE USER FOR B&M AND ECOM                    00590027
C14666*    - CHANGES MADE TO UPDATE SHRINK PERCENT FROM CURRENT FISCAL  00591065
C14666*      MONTH THRU END OF YEAR INSTEAD OF ML OPEN MONTH THRU       00592065
C14666*      END OF YEAR                                                00593065
C14666***************************************************************** 00600027
262978* CHANGED 10/22/2021    BY JIM HUNTER      WR: CHG0262978         00601067
262978* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00602067
262978* MAKING THE CALL DYNAMIC VS STATIC.                              00603067
262978******************************************************************00604067
004200*                                                                 00610027
004300*                                                                 00620020
004400*                                                                 00630020
004500*                                                                 00640020
004600 ENVIRONMENT DIVISION.                                            00650020
004700*                                                                 00660020
004800*                                                                 00670020
004900*                                                                 00680020
005000 DATA DIVISION.                                                   00690020
005100*                                                                 00700020
005200*                                                                 00710020
005300 WORKING-STORAGE SECTION.                                         00720020
005400                                                                  00730020
005500 01  PC-PROGRAM-CONSTANTS.                                        00740020
005600     05  PC-CURR-YR-IND                 PIC X(01)    VALUE 'C'.   00750020
005700     05  PC-PREV-YR-IND                 PIC X(01)    VALUE 'P'.   00760020
005800     05  PC-NAVIGATOR-TRAN-ID           PIC X(04)    VALUE 'Z008'.00770020
005900     05  PC-MAXIMUM-COMMAREA-LENGTH     PIC S9(04)   VALUE +4072  00780020
006000                                                     COMP SYNC.   00790020
006100     05  PC-CURRENT-MAP-NAME            PIC X(08)    VALUE        00800020
006200     'MB114A  '.                                                  00810020
006300     05  PC-CURRENT-MAPSET-NAME         PIC X(08)    VALUE        00820020
006400     'MBKM114 '.                                                  00830020
006500     05  PC-CURRENT-PROGRAM-NAME        PIC X(08)    VALUE        00840020
006600     'MBKCS114'.                                                  00850020
006700     05  PC-TSQ-ADD-LENGTH              PIC S9(04)   VALUE 0      00860020
006800                                                     COMP SYNC.   00870020
006900     05  PC-TSQ-MAINT-LENGTH            PIC S9(04)   VALUE 0      00880020
007000                                                     COMP SYNC.   00890020
007100     05  PC-CENTURY-CUTOFF              PIC 9(02)    VALUE 80.    00900020
007200     05  PC-GMA-LEVEL-CD                PIC X(03)    VALUE 'GMA'. 00910020
007300     05  PC-DMA-LEVEL-CD                PIC X(03)    VALUE 'DMA'. 00920020
007400     05  PC-DEPT-LEVEL-CD               PIC X(03)    VALUE 'DPT'. 00930020
007500     05  PC-MAX-RETRIES                 PIC S9(3)    VALUE +3.    00940020
007600     05  PC-1                           PIC X(01)    VALUE '1'.   00950020
007700     05  PC-L                           PIC X(01)    VALUE 'L'.   00960020
007800     05  PC-H                           PIC X(01)    VALUE 'H'.   00970020
007900                                                                  00980020
008000     05  PC-TSYMSG-00000                PIC 9(05)    VALUE 00000. 00990020
008100     05  PC-TSYMSG-00005                PIC 9(05)    VALUE 00005. 01000020
008200     05  PC-TSYMSG-00007                PIC 9(05)    VALUE 00007. 01010020
008300     05  PC-TSYMSG-00008                PIC 9(05)    VALUE 00008. 01020020
008400     05  PC-TSYMSG-00045                PIC 9(05)    VALUE 00045. 01030020
008500     05  PC-TSYMSG-00046                PIC 9(05)    VALUE 00046. 01040020
008600     05  PC-TSYMSG-00059                PIC 9(05)    VALUE 00059. 01050020
008700     05  PC-TSYMSG-00070                PIC 9(05)    VALUE 00070. 01060020
008800     05  PC-TSYMSG-00122                PIC 9(05)    VALUE 00122. 01070020
008900     05  PC-TSYMSG-00150                PIC 9(05)    VALUE 00150. 01080020
009000     05  PC-TSYMSG-00151                PIC 9(05)    VALUE 00151. 01090020
009100     05  PC-TSYMSG-00152                PIC 9(05)    VALUE 00152. 01100020
009200     05  PC-TSYMSG-00153                PIC 9(05)    VALUE 00153. 01110020
009300     05  PC-TSYMSG-01054                PIC 9(05)    VALUE 01054. 01120020
009400     05  PC-TSYMSG-01679                PIC 9(05)    VALUE 01679. 01130020
009500     05  PC-TSYMSG-01682                PIC 9(05)    VALUE 01682. 01140020
009600     05  PC-TSYMSG-99901                PIC 9(05)    VALUE 99901. 01150020
009700                                                                  01160020
009800 01  PS-PROGRAM-SWITCHES.                                         01170020
009900     05  PS-MAP-SEND-TYPE               PIC X(01)    VALUE '1'.   01180020
010000         88  PS-SEND-MAP-N-DATA-FRSET                VALUE '1'.   01190020
010100         88  PS-SEND-MAP-N-DATA-FRSET-CPOSN          VALUE '2'.   01200020
010200         88  PS-SEND-DATA-ONLY-FRSET                 VALUE '3'.   01210020
010300         88  PS-SEND-DATA-ONLY                       VALUE '4'.   01220020
010400         88  PS-SEND-DATA-ONLY-ERASEAUP              VALUE '5'.   01230020
010500         88  PS-SEND-MAP-ONLY-FRSET                  VALUE '6'.   01240020
010600     05  PS-ERROR-SW                    PIC X(01)    VALUE 'N'.   01250020
010700         88  PS-ERROR                                VALUE 'Y'.   01260020
010800         88  PS-NO-ERROR                             VALUE 'N'.   01270020
010900     05  PS-INTER-APPL-SW               PIC X(01)    VALUE 'N'.   01280020
011000         88  PS-INTER-APPL-VALID                     VALUE 'Y'.   01290020
011100         88  PS-INTER-APPL-INVALID                   VALUE 'N'.   01300020
011200     05  PS-QUEUE-STATUS                PIC X(01)    VALUE 'Y'.   01310020
011300         88  PS-FULL-QUEUE                           VALUE 'Y'.   01320020
011400         88  PS-EMPTY-QUEUE                          VALUE 'N'.   01330020
011500     05  PS-ROW-FOUND-SW                PIC X(01)    VALUE 'Y'.   01340020
011600         88  PS-ROW-FOUND                            VALUE 'Y'.   01350020
011700         88  PS-ROW-NOT-FOUND                        VALUE 'N'.   01360020
011800                                                                  01370020
011900 01  PV-PROGRAM-VARIABLES.                                        01380020
012000     05  PV-CICS-RESPONSE               PIC S9(04)   VALUE +0     01390020
012100                                                     COMP SYNC.   01400020
012200     05  PV-NULL-IND                    PIC S9(04)   VALUE +0     01410020
012300                                                     COMP SYNC.   01420020
012400     05  PV-NULL-IND2                   PIC S9(04)   VALUE +0     01430020
012500                                                     COMP SYNC.   01440020
012600     05  PV-MSG-NUMBER-X                PIC X(05)    VALUE SPACES.01450020
012700     05  PV-MSG.                                                  01460020
012800         10  FILLER                     PIC X(15)    VALUE        01470020
012900             'ORIG FIS PER = '.                                   01480020
013000         10  PV-ORIG                    PIC X(2)     VALUE SPACES.01490020
013100         10  FILLER                     PIC X(15)    VALUE        01500020
013200             'SCRN FIS PER = '.                                   01510020
013300         10  PV-SCRN                    PIC X(2)     VALUE SPACES.01520020
013400     05  PV-SHRINK-FIS-PER              PIC X(02)    VALUE ZEROS. 01530020
013500                                                                  01540020
013600                                                                  01550020
013700     05  PV-TSQ-TEMP-LAYOUT             PIC X(2007).              01560020
013800     05  FILLER REDEFINES PV-TSQ-TEMP-LAYOUT.                     01570020
C14666         10  PV-DEPT-ADD-QUEUE          PIC X(253).               01580053
C14666         10  FILLER                     PIC X(1754).              01590053
014100                                                                  01600020
014200                                                                  01610020
014300     05  PV-RETRY-COUNTER               PIC S9(3)    VALUE 0.     01620020
014400     05  PV-CHANGE-DATE.                                          01630020
C14666         10  PV-CHANGE-CCYY.                                      01640028
C14666             15  PV-CHANGE-CENT         PIC 9(02)    VALUE 0.     01650028
C14666             15  PV-CHANGE-YY           PIC 9(02)    VALUE 0.     01660028
014700         10  PV-DASH1                   PIC X        VALUE '-'.   01670020
014800         10  PV-CHANGE-MM               PIC 9(02)    VALUE 0.     01680020
014900         10  PV-DASH1                   PIC X        VALUE '-'.   01690020
015000         10  PV-CHANGE-DD               PIC 9(02)    VALUE 0.     01700020
015100     05  PV-DISPLAY-PLAN-FRGT-PCT       PIC Z9.9.                 01710020
C14666     05  PV-DISPLAY-PLAN-SHNK-PCT       PIC --9.99.               01720027
015200     05  PV-PREV-FISCAL-MM              PIC 9(02)    VALUE 0.     01730020
015300     05  PV-SQL-SUB                     PIC S9(4)  COMP.          01740020
015400     05  PV-SUB                         PIC S9(4)  COMP.          01750020
015500     05  PV-WORK-DATE.                                            01760020
015600         10  PV-WD-MM                   PIC X(02).                01770020
015700         10  FILLER                     PIC X(01)    VALUE '/'.   01780020
015800         10  PV-WD-DD                   PIC X(02).                01790020
015900         10  FILLER                     PIC X(01)    VALUE '/'.   01800020
016000         10  PV-WD-YY                   PIC X(02).                01810020
C14666     05  PV-FORMAT-DATE.                                          01820027
C14666         10  PV-FORMAT-MM               PIC X(02).                01830027
C14666         10  FILLER                     PIC X(01)    VALUE '/'.   01840027
C14666         10  PV-FORMAT-DD               PIC X(02).                01850027
C14666         10  FILLER                     PIC X(01)    VALUE '/'.   01860027
C14666         10  PV-FORMAT-CCYY             PIC X(04).                01870027
C14666*           05  PV-WORK-DATE-CCYY.                                01880063
C14666*               10  PV-WD-CCYY                 PIC X(04).         01890063
C14666*               10  FILLER                     PIC X(06).         01900063
016400 EJECT                                                            01910020
016500                                                                  01920020
016600 01  DK-DATA-KEYS.                                                01930020
016700     05  DK-OPERCO-NBR                  PIC X(02)    VALUE SPACES.01940020
016800     05  DK-GMA-NBR                     PIC X(02)    VALUE SPACES.01950020
016900     05  DK-DMA-NBR                     PIC X(02)    VALUE SPACES.01960020
017000     05  DK-DEPT-NBR                    PIC X(03)    VALUE SPACES.01970020
017100     05  DK-MAJ-CL-NBR                  PIC X(02)    VALUE SPACES.01980020
017200     05  DK-SUB-CL-NBR                  PIC X(03)    VALUE SPACES.01990020
017300     05  DK-END-DATE                    PIC X(10)    VALUE SPACES.02000020
017400     05  DK-MDSELV-CDE                  PIC X(03)    VALUE SPACES.02010020
017500     05  DK-MDSEBG-NBR                  PIC X(03)    VALUE SPACES.02020020
017600     05  DK-DPTDIS-CDE                  PIC X(03)    VALUE SPACES.02030020
017700     05  DK-MDSEAR-DKEY                 PIC S9(06)V   COMP-3      02040020
017800                                                     VALUE 0.     02050020
017900                                                                  02060020
018000***************************************************************** 02070020
018100*    STANDARD COMMAREA.                                           02080020
018200***************************************************************** 02090020
018300                                                                  02100020
018400     COPY DPWS020.                                                02110021
018500     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02120020
018600                                                                  02130020
018700***************************************************************** 02140020
018800*    INTER-APPLICATION COMMAREA.                                  02150020
018900***************************************************************** 02160020
019000                                                                  02170020
019100         10  INTER-APPL-COMM-AREA       PIC X(200).               02180020
019200     COPY MBWS005.                                                02190021
019300                                                                  02200020
019400***************************************************************** 02210020
019500*    APPLICATION SPECIFIC COMMAREA FOR MBKCS114 - 2865 BYTES      02220020
019600***************************************************************** 02230020
019700         10  ASC-APPL-SPEC-COMMAREA.                              02240020
019800             15 ASC-WHERE-FROM                  PIC X.            02250020
019900                88  ASC-DEPT-MAINT                    VALUE 'M'.  02260020
020000                88  ASC-DEPT-ADD                      VALUE 'A'.  02270020
020100             15 ASC-TSQ-ITEM-NBR                PIC S9(04)        02280020
020200                                                    COMP SYNC.    02290020
020300             15 ASC-COMPANY-NO                  PIC X(2).         02300020
020400             15 ASC-GMA-NO                      PIC X(2).         02310020
020500             15 ASC-GMA-DESC                    PIC X(25).        02320020
020600             15 ASC-DMA-NO                      PIC X(2).         02330020
020700             15 ASC-DMA-DESC                    PIC X(25).        02340020
020800             15 ASC-DPT-NO                      PIC X(3).         02350020
020900             15 ASC-DPT-DESC                    PIC X(25).        02360020
021000             15 ASC-MDSEAR-LEVEL                PIC 9(01).        02370020
021100             15 ASC-AR-CHANGE-DATE.                               02380020
021200                20 ASC-AR-CHG-YY                PIC 9(02).        02390020
021300                20 ASC-AR-CHG-MM                PIC 9(02).        02400020
021400                20 ASC-AR-CHG-DD                PIC 9(02).        02410020
021500             15 ASC-DEPT-LST-CHG-DT.                              02420020
021600                20 ASC-DP-CHG-YY                PIC 9(02).        02430020
021700                20 ASC-DP-CHG-MM                PIC 9(02).        02440020
021800                20 ASC-DP-CHG-DD                PIC 9(02).        02450020
C14666             15 ASC-BM-LAST-CHG-DT.                               02460027
C14666                20 ASC-BM-LAST-CHG-CCYY         PIC 9(04).        02470027
C14666                20 ASC-BM-LAST-CHG-MM           PIC 9(02).        02480027
C14666                20 ASC-BM-LAST-CHG-DD           PIC 9(02).        02490034
C14666             15 ASC-ECOM-LAST-CHG-DT.                             02500027
C14666                20 ASC-ECOM-LAST-CHG-CCYY       PIC 9(04).        02510027
C14666                20 ASC-ECOM-LAST-CHG-MM         PIC 9(02).        02520027
C14666                20 ASC-ECOM-LAST-CHG-DD         PIC 9(02).        02530034
C14666             15 ASC-BM-LAST-CHG-USER            PIC X(08).        02540027
C14666             15 ASC-ECOM-LAST-CHG-USER          PIC X(08).        02550027
021900*                                                                 02560020
022000             15 ASC-ORIGINAL-FIELDS.                              02570020
022100                 20 ASC-ORIG-BUS-GROUP          PIC X(03).        02580020
022200                 20 ASC-ORIG-DISCNT-CD          PIC X(02).        02590020
022300                 20 ASC-ORIG-AR-DESCRIPTION     PIC X(14).        02600020
022400                 20 ASC-ORIG-CONSIGN-IND        PIC X.            02610020
022500                 20 ASC-ORIG-SKU-LVL-UPD-IND    PIC X.            02620020
022600                 20 ASC-ORIG-PLAN-FRGT-PCT      PIC X(4).         02630020
022700                 20 FILLER  REDEFINES                             02640020
022800                    ASC-ORIG-PLAN-FRGT-PCT.                       02650020
022900                    25  FILLER                  PIC X.            02660020
023000                    25 ASC-ORIG-PLAN-FRGT-PCTN  PIC V999.         02670020
023100                 20 ASC-ORIG-PLAN-FRGT-PCTX2    PIC X(4).         02680020
023200                 20 FILLER  REDEFINES                             02690020
023300                    ASC-ORIG-PLAN-FRGT-PCTX2.                     02700020
023400                    25  FILLER                  PIC X.            02710020
023500                    25 ASC-ORIG-PLAN-FRGT-PCTN2 PIC 99V9.         02720020
C14666                 20 ASC-ORIG-SHRINK-PCT         PIC SV9999.       02730027
C14666                 20 ASC-ORIG-ECOM-SHRINK-PCT    PIC SV9999.       02740027
C14666*                20 ASC-ORIG-SHRINK-FIS-PER     PIC X(02).        02750063
C14666*                20 ASC-ORIG-SHRINK-FIS-PER-N                     02760063
C14666*                   REDEFINES ASC-ORIG-SHRINK-FIS-PER             02770063
C14666*                                               PIC 9(02).        02780063
024100                 20 ASC-ORIG-DAYS-BEF-SHIP-NBR  PIC 9(03).        02790020
024200                 20 ASC-ORIG-DAYS-AFT-CLR-NBR   PIC 9(03).        02800020
024300                 20 ASC-ORIG-STR-ZN-ID          PIC X(05).        02810020
024400                 20 ASC-ORIG-STR-ZN-DESC        PIC X(20).        02820020
024500*                                                                 02830020
024600             15 ASC-MODIFIABLE-FIELDS.                            02840020
024700                 20 ASC-SCRN-BUS-GROUP          PIC X(03).        02850020
024800                 20 FILLER REDEFINES ASC-SCRN-BUS-GROUP.          02860020
024900                    25 ASC-SCRN-BUS-GROUP-N     PIC 9(03).        02870020
025000                 20 ASC-SCRN-BUS-GROUP-DESC     PIC X(25).        02880020
025100                                                                  02890020
025200                 20 ASC-SCRN-DISCNT-CD          PIC X(02).        02900020
025300                 20 FILLER REDEFINES ASC-SCRN-DISCNT-CD.          02910020
025400                    25 ASC-SCRN-DISCNT-CD-N     PIC 9(02).        02920020
025500                                                                  02930020
025600                 20 ASC-SCRN-AR-DESCRIPTION     PIC X(14).        02940020
025700                 20 ASC-SCRN-CONSIGN-IND        PIC X.            02950020
025800                 20 ASC-SCRN-SKU-LVL-UPD-IND    PIC X.            02960020
025900                                                                  02970020
026000                 20 ASC-SCRN-PLAN-FRGT-PCT      PIC X(4).         02980020
026100                 20 FILLER  REDEFINES                             02990020
026200                    ASC-SCRN-PLAN-FRGT-PCT.                       03000020
026300                    25  FILLER                  PIC X.            03010020
026400                    25 ASC-SCRN-PLAN-FRGT-PCTN  PIC V999.         03020020
026500                 20 ASC-SCRN-PLAN-FRGT-PCTX2    PIC X(4).         03030020
026600                 20 FILLER  REDEFINES                             03040020
026700                    ASC-SCRN-PLAN-FRGT-PCTX2.                     03050020
026800                    25  FILLER                  PIC X.            03060020
026900                    25 ASC-SCRN-PLAN-FRGT-PCTN2 PIC 99V9.         03070020
027000                 20 FILLER  REDEFINES                             03080020
027100                    ASC-SCRN-PLAN-FRGT-PCTX2.                     03090020
027200                    25  FILLER                  PIC X.            03100020
027300                    25  ASC-FREIGHT-PERCENT     PIC V999.         03110020
027400                                                                  03120020
C14666                 20  ASC-SCRN-SHRINK-PCT        PIC X(6).         03130043
027600                 20  FILLER REDEFINES                             03140020
027700                     ASC-SCRN-SHRINK-PCT.                         03150020
C14666                    25 FILLER                   PIC X(2).         03160037
C14666                    25 ASC-SCRN-SHRINK-PCTN     PIC SV9999.       03170037
C14666                 20 ASC-SCRN-SHRINK-PCTN2       PIC S99V99.       03180037
028100                 20 ASC-SHRINK-PERCENT  REDEFINES                 03190020
C14666                    ASC-SCRN-SHRINK-PCTN2       PIC SV9999.       03200037
C14666                 20 ASC-TEMP-PCT                PIC SV9999.       03210038
C14666                 20  ASC-SCRN-ECOM-SHRINK-PCT   PIC X(6).         03220037
C14666                 20  FILLER REDEFINES                             03230027
C14666                     ASC-SCRN-ECOM-SHRINK-PCT.                    03240027
C14666                    25 FILLER                   PIC X(2).         03250037
C14666                    25 ASC-SCRN-ECOM-SHRINK-PCTN                  03260027
C14666                                                PIC SV9999.       03270027
C14666                 20 ASC-SCRN-ECOM-SHRINK-PCTN2  PIC S99V99.       03280027
C14666                 20 ASC-ECOM-SHRINK-PERCENT  REDEFINES            03290027
C14666                    ASC-SCRN-ECOM-SHRINK-PCTN2  PIC SV9999.       03300034
C14666*                20 ASC-SCRN-SHRINK-FIS-PER     PIC X(02).        03310063
C14666*                20 ASC-SCRN-SHRINK-FIS-PER-N REDEFINES           03320063
C14666*                   ASC-SCRN-SHRINK-FIS-PER     PIC 9(02).        03330063
028600                 20 ASC-SCRN-DAYS-BEF-SHIP-NBR  PIC 9(03).        03340020
028700                 20 ASC-SCRN-DAYS-AFT-CLR-NBR   PIC 9(03).        03350020
028800                 20 ASC-SCRN-STR-ZN-ID          PIC X(05).        03360020
C14666                 20 ASC-SCRN-BM-SHNK-LST-CHG-DTE                  03370034
C14666                                                PIC X(10).        03380027
C14666                 20 ASC-SCRN-ECOM-SHNK-LST-CHG-DTE                03390034
C14666                                                PIC X(10).        03400027
C14666                 20 ASC-SCRN-BM-SHNK-LST-CHG-USR                  03410034
C14666                                                PIC X(08).        03420027
C14666                 20 ASC-SCRN-ECOM-SHNK-LST-CHG-USR                03430034
C14666                                                PIC X(08).        03440027
028900                                                                  03450020
029000             15 ASC-BUS-GRP-EDIT-FLAG           PIC X(01).        03460020
029100                88  ASC-BUS-GRP-NEED-EDIT       VALUE 'Y'.        03470020
029200                88  ASC-BUS-GRP-PASS-EDIT       VALUE 'N'.        03480020
029300             15 ASC-AR-DESC-EDIT-FLAG           PIC X(01).        03490020
029400                 88 ASC-AR-DESC-NEED-EDIT       VALUE 'Y'.        03500020
029500                 88 ASC-AR-DESC-PASS-EDIT       VALUE 'N'.        03510020
029600             15 ASC-DISCNT-CD-EDIT-FLAG         PIC X(01).        03520020
029700                 88 ASC-DISCNT-CD-NEED-EDIT     VALUE 'Y'.        03530020
029800                 88 ASC-DISCNT-CD-PASS-EDIT     VALUE 'N'.        03540020
029900*                                                                 03550020
030000             15 ASC-TEMP-QUEUE-NAME             PIC X(08).        03560020
030100             15 FILLER REDEFINES ASC-TEMP-QUEUE-NAME.             03570020
030200                 20  ASC-TERM-ID                PIC X(04).        03580020
030300                 20  ASC-TASK-ID                PIC S9(07)        03590020
030400                                                        COMP-3.   03600020
030500             15 ASC-TEMP-QUEUE-LENGTH           PIC S9(4) COMP.   03610020
030600             15 ASC-SEL-IDX                     PIC S9(4) COMP.   03620020
030700             15 ASC-MDSEAR-DKEY                 PIC S9(06)V       03630020
030800                                                COMP-3.           03640020
030900             15 ASC-SAVE-SELECTION-TABLE        PIC X(2007).      03650020
031000             15 FILLER REDEFINES ASC-SAVE-SELECTION-TABLE.        03660020
031100                 20 FILLER                      PIC X(03).        03670020
031200                 20 ASC-MAX-ITEMS               PIC 9(03).        03680020
031300                 20 FILLER                      PIC X(01).        03690020
031400                 20 ASC-ITEM-ARRAY OCCURS 100 TIMES.              03700020
031500                     25  ASC-ITEM               PIC S9(09)        03710020
031600                                                COMP-3.           03720020
031700                     25  ASC-KEY-DATA.                            03730020
031800                         30  ASC-GMA-NBR        PIC X(02).        03740020
031900                         30  ASC-DMA-NBR        PIC X(02).        03750020
032000                         30  ASC-DPT-NBR        PIC X(03).        03760020
032100                         30  ASC-MCL-NBR        PIC X(02).        03770020
032200                         30  ASC-SCL-NBR        PIC X(03).        03780020
032300                         30  ASC-MDSELV-CDE     PIC X(03).        03790020
032400                                                                  03800020
032500             15  ASC-SHRINK-WORK-AREA.                            03810020
032600                 20  FILLER                     PIC X(4).         03820020
032700                 20  ASC-SHRINK-YR-NBR          PIC X(4).         03830020
032800                 20  ASC-SHRINK-YR-NBR-N REDEFINES                03840020
032900                         ASC-SHRINK-YR-NBR      PIC 9(4).         03850020
033000                 20  FILLER                     PIC X(26).        03860020
033100                 20  FILLER  OCCURS  12.                          03870020
C14666                     25  ASC-SHRINK-PCT         PIC S99V99 COMP-3.03880036
033300                     25  ASC-SHRINK-PCTN                          03890020
033400                         REDEFINES ASC-SHRINK-PCT                 03900020
C14666                                                PIC SV9999 COMP-3.03910036
C14666                 20 FILLER                      PIC X(1).         03920029
C14666                 20 ASC-SHNK-PCT-CHG-DTE        PIC X(10).        03930029
C14666                 20 ASC-LAST-UPD-BY-USR         PIC X(8).         03940029
033600             15  ASC-SHRINK-SUB                 PIC S9(4) COMP.   03950020
033700             15  ASC-SHRINK-SWITCH              PIC X.            03960020
033800                 88  ASC-INSERT-SHRINK                 VALUE 'I'. 03970020
033900                 88  ASC-UPDATE-SHRINK                 VALUE 'U'. 03980020
034100             15  ASC-CAL-MN-NBR                 PIC X(02).        03990020
034200             15  ASC-CAL-MN-NBR-N REDEFINES                       04000020
034300                 ASC-CAL-MN-NBR                 PIC 9(02).        04010020
034400             15  ASC-FIS-MONTH-NM               PIC X(09).        04020020
034410             15  FILLER                         PIC X(354).       04030022
034600                                                                  04040020
034700                                                                  04050020
034800***************************************************************** 04060020
034900*    ABEND PROCESSING COPYBOOK.                                   04070020
035000***************************************************************** 04080020
035100                                                                  04090020
035200     COPY DPWS013.                                                04100021
035300                                                                  04110020
035400***************************************************************** 04120020
035500*    ATTRIBUTE SETTINGS COPYBOOK.                                 04130020
035600***************************************************************** 04140020
035700                                                                  04150020
035800     COPY DPWS015.                                                04160021
035900                                                                  04170020
036000***************************************************************** 04180020
036100*    CURRENT DATE AND TIME COPYBOOK.                              04190020
036200***************************************************************** 04200020
036300                                                                  04210020
036400     COPY DPWS017.                                                04220021
036500                                                                  04230020
036600***************************************************************** 04240020
036700*    TOGGLE FUNCTION KEY LINES COPYBOOK.                          04250020
036800***************************************************************** 04260020
036900                                                                  04270020
037000     COPY DPWS009.                                                04280021
037100                                                                  04290020
037200***************************************************************** 04300020
037300*    FUNCTION KEYS COPYBOOK.                                      04310020
037400***************************************************************** 04320020
037500                                                                  04330020
037600     COPY DPWS016.                                                04340021
037700                                                                  04350020
037800***************************************************************** 04360020
037900*    VARIABLE MESSAGE AREA.                                       04370020
038000***************************************************************** 04380020
038100                                                                  04390020
038200     COPY DPWS006.                                                04400021
038300                                                                  04410020
038400***************************************************************** 04420020
038500*    NUMERIC EDIT ROUTINE                                         04430020
038600***************************************************************** 04440020
038700                                                                  04450020
038800     COPY DPWS010I.                                               04460021
038900                                                                  04470020
039000***************************************************************** 04480020
039100*    MERCHANDISE AREA ADD TEMPORARY STORAGE QUEUE                 04490020
039200***************************************************************** 04500020
039300                                                                  04510020
039400     COPY MBWS104.                                                04520021
039500                                                                  04530020
039600***************************************************************** 04540020
039700*    DPKUT045 COPYBOOK.                                           04550020
039800*                                                                 04560020
039900*    DATA AREA NECESSARY TO INTERACT WITH SUB-ROUTINE DPKUT045    04570020
040000*                                                                 04580020
040100*    DPKUT045 IS A UTILITY ROUTINE THAT CONVERTS THE EIBAID       04590020
040200*    CHARACTER RECEIVED FROM THE TERMINAL INTO A INTEGER VALUE    04600020
040300*    FROM 1 TO 29. THIS INTEGER VALUE IS STORED IN DP020-SRC-AID  04610020
040400*    AND IS USED TO INTERROGATE THE DP020-FUNCTION-KEY-ARRAY      04620020
040500*    TABLE IN THE STANDARD COMMAREA TO DETERMINE WHAT TO DO NEXT. 04630020
040600*    IN ADDITION DPKUT045 WILL PARSE THE SCREEN INPUT COMMAND     04640020
040700*    FIELD AND CONVERT RECOGNIZED SCREEN MANIPULATION COMMANDS    04650020
040800*    INTO THE DP020-SRC-AID EQUIVALENT.                           04660020
040900***************************************************************** 04670020
041000                                                                  04680020
041100     COPY DPWS045.                                                04690021
041200                                                                  04700020
041300***************************************************************** 04710020
041400*    SYSTEM MESSAGES RECORD LAYOUT                                04720020
041500***************************************************************** 04730020
041600                                                                  04740020
041700     COPY DPRD507I.                                               04750021
041800                                                                  04760020
041900***************************************************************** 04770020
042000*    STANDARD ATTENTION IDENTIFIER LIST                           04780020
042100***************************************************************** 04790020
042200                                                                  04800020
042300     COPY DFHAID.                                                 04810020
042400                                                                  04820020
042500***************************************************************** 04830020
042600*    MAP LAYOUT                                                   04840020
042700***************************************************************** 04850020
042800                                                                  04860020
042900     COPY MBKM114.                                                04870020
043000                                                                  04880020
043100 01  MD-MAP-DATA-AREA REDEFINES MB114AO.                          04890020
043200***************************************************************** 04900020
043300*    FOR THE UTILITIES THAT RECEIVE AND SEND THE MAP TO THE       04910020
043400*    TERMINAL TO FUNCTION CORRECTLY, CHANGE THE PIC CLAUSE OF     04920020
043500*    THE FOLLOWING FILLER STATEMENT TO BE EQUAL TO THE TOTAL      04930020
043600*    LENGTH OF THE MAP COPYBOOK.                                  04940020
043700***************************************************************** 04950020
043800     05  FILLER                         PIC X(667).               04960020
043900 EJECT                                                            04970020
044000***************************************************************** 04980020
044100*    MERCHANDISE AREA DB2 TABLE DEFINITION                        04990020
044200***************************************************************** 05000020
044300                                                                  05010020
044400     EXEC SQL                                                     05020020
044500         INCLUDE TMDSEAR                                          05030020
044600     END-EXEC.                                                    05040020
044700***************************************************************** 05050020
044800*    MERCHANDISE DEPARTMENT DB2 TABLE DEFINITION                  05060020
044900***************************************************************** 05070020
045000                                                                  05080020
045100     EXEC SQL                                                     05090020
045200         INCLUDE TMDSEDP                                          05100020
045300     END-EXEC.                                                    05110020
045400***************************************************************** 05120020
045500*    DEPARTMENT SHRINK PERCENT DEFINITION                         05130020
045600***************************************************************** 05140020
045700                                                                  05150020
045800     EXEC SQL                                                     05160020
045900         INCLUDE TDPTSHK                                          05170020
046000     END-EXEC.                                                    05180020
046100***************************************************************** 05190020
046200*    MERCHANDISE BUSINESS GROUP DB2 TABLE DEF                     05200020
046300***************************************************************** 05210020
046400                                                                  05220020
046500     EXEC SQL                                                     05230020
046600         INCLUDE TMDSEBG                                          05240020
046700     END-EXEC.                                                    05250020
046800***************************************************************** 05260020
046900*    DEPARTMENT DISCOUNT DB2 TABLE DEFINITION                     05270020
047000***************************************************************** 05280020
047100                                                                  05290020
047200     EXEC SQL                                                     05300020
047300         INCLUDE TDPTDIS                                          05310020
047400     END-EXEC.                                                    05320020
047500***************************************************************** 05330020
047600*    STORE ZONE MASTER DB2 TABLE DEFINITION                       05340020
047700***************************************************************** 05350020
047800                                                                  05360020
047900     EXEC SQL                                                     05370020
048000         INCLUDE TSTRZN                                           05380020
048100     END-EXEC.                                                    05390020
048200***************************************************************** 05400020
048300*    DB2 AREA FOR THE MERCH LEDGER CONTROL TABLE                  05410020
048400***************************************************************** 05420020
048500                                                                  05430020
C14666*    EXEC SQL                                                     05440063
C14666*         INCLUDE TMLCNTL                                         05450063
C14666*    END-EXEC.                                                    05460063
048900***************************************************************** 05470020
049000*    DB2 AREA FOR THE MERCH LEDGER DATE TABLE                     05480020
049100***************************************************************** 05490020
049200                                                                  05500020
049300     EXEC SQL                                                     05510020
049400         INCLUDE TDTATTR                                          05520020
049500     END-EXEC.                                                    05530020
049600***************************************************************** 05540020
049700*    DB2 COMMUNICATION AREA                                       05550020
049800***************************************************************** 05560020
049900                                                                  05570020
050000     EXEC SQL                                                     05580020
050100         INCLUDE SQLCA                                            05590020
050200     END-EXEC.                                                    05600020
050300                                                                  05610020
050400                                                                  05620020
050500 LINKAGE SECTION.                                                 05630020
050600                                                                  05640020
050700 01  DFHCOMMAREA.                                                 05650020
050800     05  FILLER                       OCCURS 1 TO 4072 TIMES      05660020
050900                                      DEPENDING ON EIBCALEN.      05670020
051000         10  FILLER                   PIC X.                      05680020
051100 EJECT                                                            05690020
051200*                                                                 05700020
051300*                                                                 05710020
051400*                                                                 05720020
051500 PROCEDURE DIVISION.                                              05730020
051600                                                                  05740020
051700                                                                  05750020
051800                                                                  05760020
051900                                                                  05770020
052000 0000-MAIN-MODULE.                                                05780020
052100                                                                  05790020
052200******************************************************************05800020
052300*    PROCESS THIS TRANSACTION IF THE COMMAREA IS VALID.           05810020
052400*                                                                 05820020
052500************* DO NOT ALTER THIS PARAGRAPH ************************05830020
052600*                                                                 05840020
052700******************************************************************05850020
052800                                                                  05860020
052900     PERFORM DP015-0000-CHECK-COMMAREA.                           05870020
053000                                                                  05880020
053100******************************************************************05890020
053200*    DP020-SRC-RETURN-W-TRAN-ID WILL BE TRUE IF THIS PROGRAM WAS  05900020
053300*    SENT A STANDARD COMMAREA. IF NOT SET TRUE (MEANING OTHER     05910020
053400*    THAN A STANDARD COMMAREA WAS SENT TO THIS PROGRAM, THIS      05920020
053500*    PROGRAM WILL RETURN TO CICS.                                 05930020
053600******************************************************************05940020
053700     IF DP020-SRC-RETURN-W-TRAN-ID                                05950020
053800         PERFORM 1000-CONTROL-PROCESSING                          05960020
053900     END-IF.                                                      05970020
054000                                                                  05980020
054100     PERFORM DP003-0000-RETURN-TO-CICS.                           05990020
054200 EJECT                                                            06000020
054300 1000-CONTROL-PROCESSING.                                         06010020
054400                                                                  06020020
054500******************************************************************06030020
054600*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT    06040020
054700*    COURSE OF ACTION IS FOR THIS TRANSACTION.                    06050020
054800*                                                                 06060020
054900*                                                                 06070020
055000************* DO NOT ALTER THIS PARAGRAPH ************************06080020
055100*                                                                 06090020
055200******************************************************************06100020
055300                                                                  06110020
055400                                                                  06120020
055500     EVALUATE TRUE                                                06130020
055600                                                                  06140020
055700         WHEN DP020-NEXT-ACT-INITIAL                              06150020
055800             SET PS-SEND-MAP-N-DATA-FRSET TO TRUE                 06160020
055900                                                                  06170020
056000             PERFORM 1100-INITIALIZE-COMMAREA                     06180020
056100             PERFORM 4100-SAVE-INITIAL-INTERAPPL                  06190020
056200             IF PS-INTER-APPL-VALID                               06200020
056300                PERFORM 1500-DETERMINE-AND-READ-TSQ               06210020
056400                PERFORM 2000-BUILD-INITIAL-PANEL                  06220020
056500                PERFORM 2200-DISPLAY-PANEL                        06230020
056600             ELSE                                                 06240020
056700                PERFORM 9100-RETURN-TO-PREV-TRAN                  06250020
056800             END-IF                                               06260020
056900                                                                  06270020
057000         WHEN DP020-NEXT-ACT-READ-MAP                             06280020
057100             PERFORM 3000-PROCESS-MAP                             06290020
057200                                                                  06300020
057300         WHEN DP020-NEXT-ACT-RETURN                               06310020
057400             SET PS-SEND-MAP-N-DATA-FRSET TO TRUE                 06320020
057500             PERFORM 4200-UPDATE-INITIAL-INTERAPPL                06330020
057600             PERFORM 3300-EDIT-DATA-IN-COMMAREA                   06340020
057700             PERFORM 2200-DISPLAY-PANEL                           06350020
057800                                                                  06360020
057900         WHEN DP020-NEXT-ACT-ERROR                                06370020
058000                                                                  06380020
058100             MOVE DP020-MSG-NUMBER-X  TO PV-MSG-NUMBER-X          06390020
058200                                                                  06400020
058300             IF DP020-NAV-MNEMONIC = SPACES                       06410020
058400                 MOVE SPACES          TO ANAVCMDO                 06420020
058500                 MOVE DP015-GREEN     TO ANAVCMDC                 06430020
058600                 MOVE DP015-UNDERLINE TO ANAVCMDH                 06440020
058700             ELSE                                                 06450020
058800                 MOVE DP015-RED       TO ANAVCMDC                 06460020
058900                 MOVE DP015-REVERSE   TO ANAVCMDH                 06470020
059000             END-IF                                               06480020
059100                                                                  06490020
059200             MOVE LOW-VALUES TO DP020-INTER-APPL-DATA-AREA        06500020
059300                                                                  06510020
059400             PERFORM 3300-EDIT-DATA-IN-COMMAREA                   06520020
059500                                                                  06530020
059600             SET PS-ERROR                TO TRUE                  06540020
059700             SET PS-SEND-DATA-ONLY-FRSET TO TRUE                  06550020
059800                                                                  06560020
059900             MOVE PV-MSG-NUMBER-X     TO DP020-MSG-NUMBER-X       06570020
060000******************************************************************06580020
060100*    END OF CODE BLOCK DESIGNED TO SAVE MESSAGE FROM DPKCS008     06590020
060200******************************************************************06600020
060300             MOVE -1         TO ANAVCMDL                          06610020
060400                                                                  06620020
060500             PERFORM 2200-DISPLAY-PANEL                           06630020
060600                                                                  06640020
060700         WHEN OTHER                                               06650020
060800             SET DP013-LOGIC-ABEND TO TRUE                        06660020
060900             SET DP013-NO-ROLLBACK TO TRUE                        06670020
061000                                                                  06680020
061100             MOVE 'B100-CONTROL-PROCESSING' TO                    06690020
061200                  DP013-PARAGRAPH                                 06700020
061300             MOVE 'INVALID NEXT ACTION FOR ARCHITECTURE' TO       06710020
061400                     DP013-MESSAGE-TEXT(1)                        06720020
061500                                                                  06730020
061600             PERFORM DP013-0000-PROCESS-ABEND                     06740020
061700                                                                  06750020
061800     END-EVALUATE.                                                06760020
061900 EJECT                                                            06770020
062000 1100-INITIALIZE-COMMAREA.                                        06780020
062100                                                                  06790020
062200******************************************************************06800020
062300*                                                                 06810020
062400******************************************************************06820020
062500      INITIALIZE ASC-APPL-SPEC-COMMAREA.                          06830020
062600                                                                  06840020
062700 EJECT                                                            06850020
062800                                                                  06860020
062900 1500-DETERMINE-AND-READ-TSQ.                                     06870020
063000******************************************************************06880020
063100*                                                                 06890020
063200******************************************************************06900020
063300                                                                  06910020
063400     MOVE +1 TO ASC-TSQ-ITEM-NBR.                                 06920020
063500     MOVE 1 TO ASC-SEL-IDX.                                       06930020
063600                                                                  06940020
063700     PERFORM 9050-READ-TSQ.                                       06950020
063800                                                                  06960020
063900     IF ASC-DEPT-MAINT                                            06970020
064000                                                                  06980020
064100        MOVE PV-TSQ-TEMP-LAYOUT       TO ASC-SAVE-SELECTION-TABLE 06990020
064200        MOVE ASC-GMA-NBR(ASC-SEL-IDX) TO ASC-GMA-NO               07000020
064300        MOVE ASC-DMA-NBR(ASC-SEL-IDX) TO ASC-DMA-NO               07010020
064400        MOVE ASC-DPT-NBR(ASC-SEL-IDX) TO ASC-DPT-NO               07020020
064500                                                                  07030020
064600     ELSE                                                         07040020
064700                                                                  07050020
064800        MOVE PV-DEPT-ADD-QUEUE     TO MB104-MDSEAR-ADD-TSQUEUE    07060020
064900        MOVE MB104-CO-NUMBER       TO ASC-COMPANY-NO              07070020
065000        MOVE MB104-GMA-NUMBER      TO ASC-GMA-NO                  07080020
065100        MOVE MB104-GMA-DESCRIP     TO ASC-GMA-DESC                07090020
065200        MOVE MB104-DMA-NUMBER      TO ASC-DMA-NO                  07100020
065300        MOVE MB104-DMA-DESCRIP     TO ASC-DMA-DESC                07110020
065400        MOVE MB104-DEPT-NUMBER     TO ASC-DPT-NO                  07120020
065500        MOVE MB104-DEPT-DESCRIP    TO ASC-DPT-DESC                07130020
065600        MOVE MB104-MDSE-LEVEL      TO ASC-MDSEAR-LEVEL            07140020
065700                                                                  07150020
065800     END-IF.                                                      07160020
065900                                                                  07170020
066000                                                                  07180020
066100/                                                                 07190020
066200 1700-RESET-ATTRIBUTES.                                           07200020
066300******************************************************************07210020
066400*                                                                 07220020
066500******************************************************************07230020
066600     MOVE DP015-GREEN  TO ASHKPCTC.                               07240023
067600     MOVE DP015-UNDERLINE TO ASHKPCTH.                            07250023
C14666     MOVE DP015-GREEN     TO AESHPCTC.                            07260035
C14666     MOVE DP015-UNDERLINE TO AESHPCTH.                            07270035
068600                                                                  07280020
068700 2000-BUILD-INITIAL-PANEL.                                        07290020
068800                                                                  07300020
068900******************************************************************07310020
069000*                                                                 07320020
069100******************************************************************07330020
069200                                                                  07340020
069300     PERFORM DP017-0000-GET-CURR-DATE-TIME                        07350020
069400     SET DP017-EDITED-YMD-DATE-DASH-1                             07360020
069500         DP017-EDITED-YMD-DATE-DASH-2 TO TRUE                     07370020
069600     MOVE DP017-EDITED-DATE-YYYYMMDD TO  DK-END-DATE              07380020
069700                                                                  07390020
069800     IF ASC-DEPT-MAINT                                            07400020
069900                                                                  07410020
070000         MOVE ASC-COMPANY-NO    TO DK-OPERCO-NBR                  07420020
070100         MOVE ASC-GMA-NO        TO DK-GMA-NBR                     07430020
070200         MOVE ASC-DMA-NO        TO DK-DMA-NBR                     07440020
070300         MOVE ASC-DPT-NO        TO DK-DEPT-NBR                    07450020
070400         MOVE '000'             TO DK-MAJ-CL-NBR                  07460020
070500                                   DK-SUB-CL-NBR                  07470020
070600         MOVE PC-DEPT-LEVEL-CD  TO DK-MDSELV-CDE                  07480020
070700                                                                  07490020
070800         PERFORM 2100-RETRIEVE-DATA-FOR-PANEL                     07500020
070900         IF PS-ROW-NOT-FOUND                                      07510020
071000             STRING ' GMA ' DK-GMA-NBR                            07520020
071100                    ' DMA ' DK-DMA-NBR                            07530020
071200                    ' DPT ' DK-DEPT-NBR                           07540020
071300                    ' MCL ' DK-MAJ-CL-NBR                         07550020
071400                    ' SCL ' DK-SUB-CL-NBR                         07560020
071500                    ' LEV=' DK-MDSELV-CDE                         07570020
071600                    ' DTE ' DK-END-DATE                           07580020
071700                    DELIMITED BY SIZE                             07590020
071800                    INTO DP013-MESSAGE-TEXT(1)                    07600020
071900             MOVE SQLCA TO DP013-SQLCA                            07610020
072000             MOVE '2000-BUILD-INITIAL-PANEL' TO DP013-PARAGRAPH   07620020
072100             MOVE 'TMDSEAR' TO DP013-DB2-TABLE-NAME(1)            07630020
072200             MOVE 'TMDSEDP' TO DP013-DB2-TABLE-NAME(2)            07640020
072300             SET DP013-DB2-ABEND TO TRUE                          07650020
072400             SET DP013-NO-ROLLBACK TO TRUE                        07660020
072500             SET DP013-XCTL-DISPLAY-RESTART TO TRUE               07670020
072600             PERFORM DP013-0000-PROCESS-ABEND                     07680020
072700         END-IF                                                   07690020
072800                                                                  07700020
072900         MOVE MDSEDP-MDSEAR-DKEY    TO ASC-MDSEAR-DKEY            07710020
C14666*        MOVE MDSEDP-CHG-DTE        TO PV-CHANGE-DATE             07720063
C14666*        MOVE PV-CHANGE-MM          TO ASC-DP-CHG-MM              07730063
C14666*        MOVE PV-CHANGE-DD          TO ASC-DP-CHG-DD              07740063
C14666*        MOVE PV-CHANGE-YY          TO ASC-DP-CHG-YY              07750063
073400                                                                  07760020
073500         MOVE MDSEDP-MDSEBG-NBR     TO ASC-ORIG-BUS-GROUP         07770020
073600                                       ASC-SCRN-BUS-GROUP         07780020
073700         PERFORM 3400-VALIDATE-BUS-GROUP                          07790020
073800                                                                  07800020
073900         MOVE MDSEDP-DPTDIS-CDE     TO ASC-ORIG-DISCNT-CD         07810020
074000                                       ASC-SCRN-DISCNT-CD         07820020
074100                                                                  07830020
074200         MOVE MDSEDP-ARDEPT-CHG-DTE TO PV-CHANGE-DATE             07840020
074300         MOVE PV-CHANGE-MM          TO ASC-AR-CHG-MM              07850020
074400         MOVE PV-CHANGE-DD          TO ASC-AR-CHG-DD              07860020
074500         MOVE PV-CHANGE-YY          TO ASC-AR-CHG-YY              07870020
074600                                                                  07880020
074700         MOVE MDSEDP-ARDEPT-DESC    TO ASC-ORIG-AR-DESCRIPTION    07890020
074800                                       ASC-SCRN-AR-DESCRIPTION    07900020
074900         MOVE MDSEDP-CONS-IND       TO ASC-ORIG-CONSIGN-IND       07910020
075000                                       ASC-SCRN-CONSIGN-IND       07920020
075100         MOVE MDSEDP-DAYS-BEF-SHIP-NBR                            07930020
075200                                    TO ASC-ORIG-DAYS-BEF-SHIP-NBR 07940020
075300                                       ASC-SCRN-DAYS-BEF-SHIP-NBR 07950020
075400         MOVE MDSEDP-DAYS-AFT-CLR-NBR                             07960020
075500                                    TO ASC-ORIG-DAYS-AFT-CLR-NBR  07970020
075600                                       ASC-SCRN-DAYS-AFT-CLR-NBR  07980020
075700         MOVE MDSEDP-SKU-LVL-UPD-IND                              07990020
075800                                    TO ASC-ORIG-SKU-LVL-UPD-IND   08000020
075900                                       ASC-SCRN-SKU-LVL-UPD-IND   08010020
076000         MOVE MDSEDP-PLAN-FRGT-PCT  TO ASC-SCRN-PLAN-FRGT-PCTN    08020020
076100         MOVE ASC-SCRN-PLAN-FRGT-PCT TO ASC-SCRN-PLAN-FRGT-PCTX2  08030020
076200         MOVE ASC-SCRN-PLAN-FRGT-PCTN2                            08040020
076300                                    TO PV-DISPLAY-PLAN-FRGT-PCT   08050020
076400         MOVE PV-DISPLAY-PLAN-FRGT-PCT                            08060020
076500                                    TO ASC-SCRN-PLAN-FRGT-PCT     08070020
076600                                       ASC-ORIG-PLAN-FRGT-PCT     08080020
076700         MOVE MDSEDP-STR-ZN-ID      TO ASC-SCRN-STR-ZN-ID         08090020
076800                                       ASC-ORIG-STR-ZN-ID         08100020
076900         PERFORM 3470-VALIDATE-STR-ZN-ID                          08110020
077000                                                                  08120020
077100         PERFORM 2400-GET-MDSEAR-DESCRIPS                         08130020
077200     ELSE                                                         08140020
077300         INITIALIZE ASC-ORIG-BUS-GROUP                            08150020
077400                    ASC-SCRN-BUS-GROUP                            08160020
077500                    ASC-ORIG-DISCNT-CD                            08170020
077600                    ASC-SCRN-DISCNT-CD                            08180020
077700                    ASC-ORIG-AR-DESCRIPTION                       08190020
077800                    ASC-SCRN-AR-DESCRIPTION                       08200020
077900                    ASC-AR-CHANGE-DATE                            08210020
C14666*                   ASC-DEPT-LST-CHG-DT                           08220063
078100                    ASC-ORIG-CONSIGN-IND                          08230020
078200                    ASC-SCRN-CONSIGN-IND                          08240020
078300                    ASC-ORIG-DAYS-BEF-SHIP-NBR                    08250020
078400                    ASC-SCRN-DAYS-BEF-SHIP-NBR                    08260020
078500                    ASC-ORIG-DAYS-AFT-CLR-NBR                     08270020
078600                    ASC-SCRN-DAYS-AFT-CLR-NBR                     08280020
078700                    ASC-ORIG-SKU-LVL-UPD-IND                      08290020
078800                    ASC-SCRN-SKU-LVL-UPD-IND                      08300020
078900                    ASC-SCRN-BUS-GROUP-DESC                       08310020
079000                    ASC-SCRN-STR-ZN-ID                            08320020
079100                    ASC-ORIG-STR-ZN-ID                            08330020
079200         MOVE ' 0.0' TO ASC-ORIG-PLAN-FRGT-PCT                    08340020
079300                        ASC-SCRN-PLAN-FRGT-PCT                    08350020
079400         SET  ASC-BUS-GRP-NEED-EDIT                               08360020
079500              ASC-AR-DESC-NEED-EDIT                               08370020
079600              ASC-DISCNT-CD-NEED-EDIT TO TRUE                     08380020
079700         MOVE DP017-CURRENT-DATE-YMD TO ASC-AR-CHANGE-DATE        08390020
C14666*                                       ASC-DEPT-LST-CHG-DT       08400063
079900     END-IF.                                                      08410020
080000                                                                  08420020
080100     PERFORM 2170-GET-SHRINK-MONTH-INFO.                          08430051
080200                                                                  08440020
080300     PERFORM 1700-RESET-ATTRIBUTES.                               08450020
080400                                                                  08460020
080500/                                                                 08470020
080600 2100-RETRIEVE-DATA-FOR-PANEL.                                    08480020
080700                                                                  08490020
080800******************************************************************08500020
080900*                                                                 08510020
081000******************************************************************08520020
081100                                                                  08530020
081200     MOVE ZERO                 TO  MDSEDP-PLAN-FRGT-PCT.          08540020
081300                                                                  08550020
081400     PERFORM WITH TEST AFTER                                      08560020
081500         VARYING PV-RETRY-COUNTER                                 08570020
081600         FROM 1 BY 1                                              08580020
081700         UNTIL (( PV-RETRY-COUNTER > PC-MAX-RETRIES)              08590020
081800                 OR (SQLCODE = 0)                                 08600020
081900                 OR (SQLCODE = +100))                             08610020
082000                                                                  08620020
082100                                                                  08630020
082200         EXEC SQL                                                 08640020
082300             SELECT D.CHG_DTE,                                    08650020
082400                    D.MDSEBG_NBR,                                 08660020
082500                    D.DPTDIS_CDE,                                 08670020
082600                    D.ARDEPT_CHG_DTE,                             08680020
082700                    D.ARDEPT_DESC,                                08690020
082800                    D.MDSEAR_DKEY,                                08700020
082900                    D.CONS_IND,                                   08710020
083000                    D.PLAN_FRGT_PCT,                              08720020
083100                    D.SKU_LVL_UPD_IND,                            08730020
083200                    D.DAYS_BEF_SHIP_NBR,                          08740020
083300                    D.DAYS_AFT_CLR_NBR,                           08750020
083400                    D.STR_ZN_ID                                   08760020
083500             INTO :MDSEDP-CHG-DTE,                                08770020
083600                  :MDSEDP-MDSEBG-NBR,                             08780020
083700                  :MDSEDP-DPTDIS-CDE,                             08790020
083800                  :MDSEDP-ARDEPT-CHG-DTE,                         08800020
083900                  :MDSEDP-ARDEPT-DESC,                            08810020
084000                  :MDSEDP-MDSEAR-DKEY,                            08820020
084100                  :MDSEDP-CONS-IND,                               08830020
084200                  :MDSEDP-PLAN-FRGT-PCT      :PV-NULL-IND,        08840020
084300                  :MDSEDP-SKU-LVL-UPD-IND,                        08850020
084400                  :MDSEDP-DAYS-BEF-SHIP-NBR,                      08860020
084500                  :MDSEDP-DAYS-AFT-CLR-NBR,                       08870020
084600                  :MDSEDP-STR-ZN-ID                               08880020
084700             FROM   TMDSEAR A,                                    08890020
084800                    TMDSEDP D                                     08900020
084900             WHERE ((A.OPERCO_NBR    = :DK-OPERCO-NBR) AND        08910020
085000                    (A.GMA_NBR       = :DK-GMA-NBR)    AND        08920020
085100                    (A.DMA_NBR       = :DK-DMA-NBR)    AND        08930020
085200                    (A.DEPT_NBR      = :DK-DEPT-NBR)   AND        08940020
085300                    (A.MAJ_CL_NBR    = :DK-MAJ-CL-NBR) AND        08950020
085400                    (A.SUB_CL_NBR    = :DK-SUB-CL-NBR) AND        08960020
085500                    (A.MDSELV_CDE    = :DK-MDSELV-CDE) AND        08970020
085600                    (A.END_DTE > DATE (CURRENT TIMESTAMP))AND     08980020
085700                    (A.MDSEAR_DKEY = D.MDSEAR_DKEY))              08990020
085800         END-EXEC                                                 09000020
085900                                                                  09010020
086000         EVALUATE TRUE                                            09020020
086100             WHEN SQLCODE = ZERO                                  09030020
086200                 SET PS-ROW-FOUND TO TRUE                         09040020
086300             WHEN SQLCODE = -904                                  09050020
086400             WHEN SQLCODE = -913                                  09060020
086500                  CONTINUE                                        09070020
086600             WHEN SQLCODE = +100                                  09080020
086700                 SET PS-ROW-NOT-FOUND TO TRUE                     09090020
086800             WHEN SQLWARN0 NOT = SPACES                           09100020
086900             WHEN SQLCODE < 0                                     09110020
087000             WHEN SQLCODE > 0                                     09120020
087100                 STRING ' GMA ' DK-GMA-NBR                        09130020
087200                        ' DMA ' DK-DMA-NBR                        09140020
087300                        ' DPT ' DK-DEPT-NBR                       09150020
087400                        ' MCL ' DK-MAJ-CL-NBR                     09160020
087500                        ' SCL ' DK-SUB-CL-NBR                     09170020
087600                        ' LEV=' DK-MDSELV-CDE                     09180020
087700                        ' DTE ' DK-END-DATE                       09190020
087800                        DELIMITED BY SIZE                         09200020
087900                        INTO DP013-MESSAGE-TEXT(1)                09210020
088000                 MOVE SQLCA TO DP013-SQLCA                        09220020
088100                 MOVE '2100-RETREIVE-DATA-FOR-PANEL' TO           09230020
088200                     DP013-PARAGRAPH                              09240020
088300                 MOVE 'TMDSEAR' TO DP013-DB2-TABLE-NAME(1)        09250020
088400                 MOVE 'TMDSEDP' TO DP013-DB2-TABLE-NAME(2)        09260020
088500                 SET DP013-DB2-ABEND TO TRUE                      09270020
088600                 SET DP013-NO-ROLLBACK TO TRUE                    09280020
088700                 SET DP013-XCTL-DISPLAY-RESTART TO TRUE           09290020
088800                 PERFORM DP013-0000-PROCESS-ABEND                 09300020
088900         END-EVALUATE                                             09310020
089000     END-PERFORM.                                                 09320020
089100                                                                  09330020
089200                                                                  09340020
089300     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         09350020
089400         MOVE '2100-RETRIEVE-DATA-FOR-PANEL' TO                   09360020
089500                                     DP013-PARAGRAPH              09370020
089600         MOVE SQLCA TO DP013-SQLCA                                09380020
089700         STRING ' GMA ' DK-GMA-NBR                                09390020
089800                ' DMA ' DK-DMA-NBR                                09400020
089900                ' DPT ' DK-DEPT-NBR                               09410020
090000                ' MCL ' DK-MAJ-CL-NBR                             09420020
090100                ' SCL ' DK-SUB-CL-NBR                             09430020
090200                ' LEV=' DK-MDSELV-CDE                             09440020
090300                ' DTE ' DK-END-DATE                               09450020
090400                DELIMITED BY SIZE                                 09460020
090500                INTO DP013-MESSAGE-TEXT(1)                        09470020
090600         MOVE 'MAX NUMBER OF RETRIES EXCEEDED' TO                 09480020
090700                                     DP013-MESSAGE-TEXT(2)        09490020
090800         MOVE 'TMDSEAR' TO DP013-DB2-TABLE-NAME(1)                09500020
090900         MOVE 'TMDSEDP' TO DP013-DB2-TABLE-NAME(2)                09510020
091000         SET DP013-DB2-ABEND                                      09520020
091100             DP013-NO-ROLLBACK                                    09530020
091200             DP013-XCTL-DISPLAY-RESTART TO TRUE                   09540020
091300         PERFORM DP013-0000-PROCESS-ABEND                         09550020
091400     END-IF.                                                      09560020
091500                                                                  09570020
091600/                                                                 09580020
091700*----------------------------------------------------------------*09590020
091800*    LOAD CURRENT DATE IN THE WORK AREA. PERFORM THE DATE INCLUDE*09600020
091900*    TO LOAD THE FISCAL/CALENDAR MONTH TABLE.  USE THE FISCAL    *09610020
092000*    PERIOD NUMBER TO OBTAIN THE CORRECT SHRINK PERCENT.         *09620020
092100*                                                                *09630020
092200*    PERFORMED BY XXXX                                           *09640020
092300*----------------------------------------------------------------*09650020
092400                                                                  09660020
092500 2170-GET-SHRINK-MONTH-INFO.                                      09670020
092600                                                                  09680020
092700*** GET FISCAL MONTH INFO BASED ON LEDGER CONTROL TABLE           09690020
092800     PERFORM 2172-GET-FISCAL-MONTH-INFO.                          09700020
092900                                                                  09710020
093000*** MOVE TABLE VALUES TO TSQ FIELDS                               09720020
093100     MOVE DTATTR-FSCL-YR-NBR      TO  ASC-SHRINK-YR-NBR.          09730020
C14666*    MOVE MLCNTL-OPN-FSCL-MN-NBR  TO  ASC-SCRN-SHRINK-FIS-PER.    09740063
C14666*    MOVE DTATTR-FSCL-MN-NM       TO  ASC-FIS-MONTH-NM.           09750063
093400     MOVE DTATTR-CAL-MN-NBR       TO  ASC-CAL-MN-NBR              09760020
093500                                      ASC-SHRINK-SUB.             09770020
093600                                                                  09780020
093700*** GET SHRINK PERCENT BASED ON THE CALENDAR MONTH NUMBER         09790020
093800*** FOR THE CURRENT FISCAL MONTH                                  09800020
C14666     INITIALIZE DCLTDPTSHK.                                       09810032
C14666     MOVE 'N'                     TO  DPTSHK-E-BUS-IND.           09820032
093900     PERFORM 2174-GET-SHRINK-ROW.                                 09830020
094000                                                                  09840020
094100*** MOVE SHRINK DCLGEN TO ASC TABLE FOR MONTH SHRINK PCTS         09850020
094200     MOVE DCLTDPTSHK              TO  ASC-SHRINK-WORK-AREA.       09860020
094300                                                                  09870020
094400*** MOVE SHRINK VALUES TO TSQ FIELDS                              09880020
094500     MOVE ASC-SHRINK-PCT (ASC-SHRINK-SUB)                         09890020
C14666                                  TO PV-DISPLAY-PLAN-SHNK-PCT.    09900032
C14666     MOVE PV-DISPLAY-PLAN-SHNK-PCT                                09910032
094800                                  TO ASC-SCRN-SHRINK-PCT.         09920020
094900     MOVE ASC-SHRINK-PCTN(ASC-SHRINK-SUB)                         09930020
095000                                  TO ASC-ORIG-SHRINK-PCT.         09940020
C14666     MOVE ASC-SHNK-PCT-CHG-DTE    TO PV-CHANGE-DATE               09950036
C14666     MOVE PV-CHANGE-CCYY          TO ASC-BM-LAST-CHG-CCYY         09960037
C14666     MOVE PV-CHANGE-MM            TO ASC-BM-LAST-CHG-MM           09970037
C14666     MOVE PV-CHANGE-DD            TO ASC-BM-LAST-CHG-DD           09980037
C14666     MOVE ASC-LAST-UPD-BY-USR     TO ASC-BM-LAST-CHG-USER         09990037
C14666                                                                  10000036
C14666*    GET SHRINK PERCENT BASED ON THE CALENDAR MONTH NUMBER        10010032
C14666*    FOR THE CURRENT FISCAL MONTH                                 10020032
C14666                                                                  10030032
C14666     MOVE 'Y'                     TO DPTSHK-E-BUS-IND.            10040032
C14666                                                                  10050032
C14666     PERFORM 2174-GET-SHRINK-ROW.                                 10060032
C14666                                                                  10070032
C14666*    MOVE SHRINK DCLGEN TO ASC TABLE FOR MONTH SHRINK PCTS        10080032
C14666     MOVE DCLTDPTSHK              TO ASC-SHRINK-WORK-AREA.        10090032
C14666     MOVE ASC-SHRINK-PCT (ASC-SHRINK-SUB)                         10100032
C14666                                  TO PV-DISPLAY-PLAN-SHNK-PCT.    10110032
C14666     MOVE PV-DISPLAY-PLAN-SHNK-PCT                                10120032
C14666                                  TO ASC-SCRN-ECOM-SHRINK-PCT.    10130032
C14666     MOVE ASC-SHRINK-PCTN(ASC-SHRINK-SUB)                         10140032
C14666                                  TO ASC-ORIG-ECOM-SHRINK-PCT.    10150032
C14666     MOVE ASC-SHNK-PCT-CHG-DTE    TO PV-CHANGE-DATE               10160036
C14666     MOVE PV-CHANGE-CCYY          TO ASC-ECOM-LAST-CHG-CCYY       10170037
C14666     MOVE PV-CHANGE-MM            TO ASC-ECOM-LAST-CHG-MM         10180037
C14666     MOVE PV-CHANGE-DD            TO ASC-ECOM-LAST-CHG-DD         10190037
C14666     MOVE ASC-LAST-UPD-BY-USR     TO ASC-ECOM-LAST-CHG-USER.      10200037
095100                                                                  10210032
095200*----------------------------------------------------------------*10220020
C14666*    GET CALENDAR MONTH NUMBER, FISCAL YEAR BASED ON CURRENT DATE*10230063
095600*                                                                *10260020
095700*    PERFORMED BY 2170                                           *10270020
095800*----------------------------------------------------------------*10280020
095900                                                                  10290020
096000 2172-GET-FISCAL-MONTH-INFO.                                      10300020
096100                                                                  10310020
096200     PERFORM                                                      10320020
096300         WITH TEST AFTER                                          10330020
096400         VARYING PV-SQL-SUB                                       10340020
096500         FROM 1 BY 1                                              10350020
096600         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             10360020
096700            OR SQLCODE = 0                                        10370020
096800                                                                  10380020
096900         EXEC SQL                                                 10390020
C14666              SELECT CAL_MN_NBR                                   10400063
097300                    ,FSCL_YR_NBR                                  10430020
C14666              INTO  :DTATTR-CAL-MN-NBR                            10440063
097700                   ,:DTATTR-FSCL-YR-NBR                           10470020
C14666              FROM  TDTATTR                                       10480063
C14666              WHERE KY_DTE = CURRENT DATE                         10500064
098100         END-EXEC                                                 10510020
098200*                                                                 10520020
098300         EVALUATE TRUE                                            10530020
098400             WHEN SQLCODE = -904                                  10540020
098500             WHEN SQLCODE = -913                                  10550020
098600             WHEN SQLCODE = ZERO                                  10560020
098700                  CONTINUE                                        10570020
098800             WHEN SQLWARN0 NOT EQUAL SPACE                        10580020
098900             WHEN SQLCODE NOT EQUAL ZERO                          10590020
099000                  MOVE '2172-GET-FISCAL-MONTH-INFO'               10600020
099100                               TO  DP013-PARAGRAPH                10610020
099200                  MOVE 'SELECT TMLCNTL/TDTATTR'                   10620020
099300                               TO  DP013-MESSAGE-TEXT (1)         10630020
099400                  MOVE SQLCA   TO  DP013-SQLCA                    10640020
099500                  SET DP013-DB2-ABEND                             10650020
099600                               TO  TRUE                           10660020
099700                  PERFORM DP013-0000-PROCESS-ABEND                10670020
099800         END-EVALUATE                                             10680020
099900     END-PERFORM.                                                 10690020
100000                                                                  10700020
100100     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   10710020
100200         MOVE '2172-GET-FISCAL-MONTH-INFO'                        10720020
100300                               TO  DP013-PARAGRAPH                10730020
100400         MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                   10740020
100500                               TO  DP013-MESSAGE-TEXT (1)         10750020
100600         MOVE SQLCA            TO  DP013-SQLCA                    10760020
100700         SET DP013-DB2-ABEND   TO  TRUE                           10770020
100800         PERFORM DP013-0000-PROCESS-ABEND                         10780020
100900     END-IF.                                                      10790020
101000                                                                  10800020
101100*----------------------------------------------------------------*10810020
101200*    INITIALIZE THE DCLGEN AREA, LOAD THE KEY AND READ THE       *10820020
101300*    DEPARTMENT SHRINK TABLE.                                    *10830020
101400*                                                                *10840020
101500*    PERFORMED BY 2170                                           *10850020
101600*----------------------------------------------------------------*10860020
101700                                                                  10870020
101800 2174-GET-SHRINK-ROW.                                             10880020
101900                                                                  10890020
C14666*    INITIALIZE DCLTDPTSHK.                                       10900063
102100     MOVE ASC-MDSEAR-DKEY        TO  DPTSHK-MDSEAR-DKEY.          10910020
102200     MOVE ASC-SHRINK-YR-NBR      TO  DPTSHK-SHRINK-YR-NBR         10920020
102300                                                                  10930020
102400     PERFORM                                                      10940020
102500         WITH TEST AFTER                                          10950020
102600         VARYING PV-SQL-SUB                                       10960020
102700         FROM 1 BY 1                                              10970020
102800         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             10980020
102900            OR SQLCODE = 0                                        10990020
103000            OR SQLCODE = +100                                     11000020
103100                                                                  11010020
103200         EXEC SQL                                                 11020020
103300              SELECT                                              11030020
103400                     CHG_TMST                                     11040020
103500                   , JAN_SHRINK_PCT                               11050020
103600                   , FEB_SHRINK_PCT                               11060020
103700                   , MAR_SHRINK_PCT                               11070020
103800                   , APR_SHRINK_PCT                               11080020
103900                   , MAY_SHRINK_PCT                               11090020
104000                   , JUN_SHRINK_PCT                               11100020
104100                   , JUL_SHRINK_PCT                               11110020
104200                   , AUG_SHRINK_PCT                               11120020
104300                   , SEP_SHRINK_PCT                               11130020
104400                   , OCT_SHRINK_PCT                               11140020
104500                   , NOV_SHRINK_PCT                               11150020
104600                   , DEC_SHRINK_PCT                               11160020
C14666                   , SHNK_PCT_CHG_DTE                             11170032
C14666                   , LAST_UPD_BY_USR                              11180032
104700              INTO                                                11190020
104800                     :DPTSHK-CHG-TMST                             11200020
104900                   , :DPTSHK-JAN-SHRINK-PCT                       11210020
105000                   , :DPTSHK-FEB-SHRINK-PCT                       11220020
105100                   , :DPTSHK-MAR-SHRINK-PCT                       11230020
105200                   , :DPTSHK-APR-SHRINK-PCT                       11240020
105300                   , :DPTSHK-MAY-SHRINK-PCT                       11250020
105400                   , :DPTSHK-JUN-SHRINK-PCT                       11260020
105500                   , :DPTSHK-JUL-SHRINK-PCT                       11270020
105600                   , :DPTSHK-AUG-SHRINK-PCT                       11280020
105700                   , :DPTSHK-SEP-SHRINK-PCT                       11290020
105800                   , :DPTSHK-OCT-SHRINK-PCT                       11300020
105900                   , :DPTSHK-NOV-SHRINK-PCT                       11310020
106000                   , :DPTSHK-DEC-SHRINK-PCT                       11320020
C14666                   , :DPTSHK-SHNK-PCT-CHG-DTE                     11330032
C14666                   , :DPTSHK-LAST-UPD-BY-USR                      11340032
106100              FROM                                                11350020
106200                     TDPTSHK                                      11360020
106300              WHERE                                               11370020
106400                     MDSEAR_DKEY    = :DPTSHK-MDSEAR-DKEY         11380020
106500                AND  SHRINK_YR_NBR  = :DPTSHK-SHRINK-YR-NBR       11390020
C14666                AND  E_BUS_IND      = :DPTSHK-E-BUS-IND           11400032
106600         END-EXEC                                                 11410020
106700                                                                  11420020
106800         EVALUATE TRUE                                            11430020
106900             WHEN SQLCODE = ZERO                                  11440020
107000             WHEN SQLCODE = +100                                  11450020
107100             WHEN SQLCODE = -904                                  11460020
107200             WHEN SQLCODE = -913                                  11470020
107300                  CONTINUE                                        11480020
107400             WHEN SQLWARN0 NOT EQUAL SPACE                        11490020
107500             WHEN SQLCODE NOT EQUAL ZERO                          11500020
107600                  MOVE '2174-GET-SHRINK-ROW'                      11510020
107700                               TO  DP013-PARAGRAPH                11520020
107800                  MOVE 'READ DPTSHK'                              11530020
107900                               TO  DP013-MESSAGE-TEXT (1)         11540020
108000                  MOVE SQLCA   TO  DP013-SQLCA                    11550020
108100                  SET DP013-DB2-ABEND                             11560020
108200                               TO  TRUE                           11570020
108300                  PERFORM DP013-0000-PROCESS-ABEND                11580020
108400         END-EVALUATE                                             11590020
108500     END-PERFORM.                                                 11600020
108600                                                                  11610020
108700     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   11620020
108800         MOVE '2174-GET-SHRINK-ROW'                               11630020
108900                               TO  DP013-PARAGRAPH                11640020
109000         MOVE 'MAX RETRIES EXCEEDED FOR READ DPTSHK'              11650020
109100                               TO  DP013-MESSAGE-TEXT (1)         11660020
109200         MOVE SQLCA            TO  DP013-SQLCA                    11670020
109300         SET DP013-DB2-ABEND   TO  TRUE                           11680020
109400         PERFORM DP013-0000-PROCESS-ABEND                         11690020
109500     END-IF.                                                      11700020
109600                                                                  11710020
109700*----------------------------------------------------------------*11720020
109800*    INITIALIZE THE DCLGEN AREA, LOAD THE KEY AND READ THE       *11730020
109900*    DEPARTMENT SHRINK TABLE.                                    *11740020
110000*                                                                *11750020
110100*    PERFORMED BY 2175                                           *11760020
110200*----------------------------------------------------------------*11770020
110300                                                                  11780020
110400 2200-DISPLAY-PANEL.                                              11790020
110500                                                                  11800020
110600******************************************************************11810020
110700*    FILL THE MAP WITH THE NECESSARY DATA AND WRITE IT OUT.       11820020
110800*                                                                 11830020
110900******************************************************************11840020
111000                                                                  11850020
111100     PERFORM DP017-0000-GET-CURR-DATE-TIME.                       11860020
111200                                                                  11870020
111300     PERFORM DP002-0000-FORMAT-TITLE-LINES.                       11880020
111400     PERFORM 3300-MOVE-COMMAREA-TO-SCREEN.                        11890020
111500                                                                  11900020
111600                                                                  11910020
111700     PERFORM DP005-0000-FORMAT-MSG-LINES.                         11920020
111800                                                                  11930020
111900     IF (DP020-SRC-AID = DP016-PA2) OR                            11940020
112000        (PS-SEND-MAP-N-DATA-FRSET)                                11950020
112100         PERFORM DP009-0000-LOAD-FK-LINES                         11960020
112200     END-IF.                                                      11970020
112300                                                                  11980020
112400     IF PS-NO-ERROR                                               11990020
112500        MOVE -1 TO ASHKPCTL                                       12000024
112600     END-IF.                                                      12010020
112700                                                                  12020020
112800     PERFORM DP008-0000-WRITE-PANEL.                              12030020
112900                                                                  12040020
113000 EJECT                                                            12050020
113100                                                                  12060020
113200 2300-RETRIEVE-FOR-UPDATE.                                        12070020
113300                                                                  12080020
113400******************************************************************12090020
113500*                                                                 12100020
113600******************************************************************12110020
113700                                                                  12120020
113800     MOVE ZERO                 TO  MDSEDP-PLAN-FRGT-PCT.          12130020
113900                                                                  12140020
114000     PERFORM WITH TEST AFTER                                      12150020
114100         VARYING PV-RETRY-COUNTER                                 12160020
114200         FROM 1 BY 1                                              12170020
114300         UNTIL (( PV-RETRY-COUNTER > PC-MAX-RETRIES)              12180020
114400                 OR (SQLCODE = 0)                                 12190020
114500                 OR (SQLCODE = +100))                             12200020
114600                                                                  12210020
114700                                                                  12220020
114800         EXEC SQL                                                 12230020
114900             SELECT CHG_DTE,                                      12240020
115000                    MDSEBG_NBR,                                   12250020
115100                    DPTDIS_CDE,                                   12260020
115200                    ARDEPT_CHG_DTE,                               12270020
115300                    ARDEPT_DESC,                                  12280020
115400                    MDSEAR_DKEY,                                  12290020
115500                    CONS_IND,                                     12300020
115600                    PLAN_FRGT_PCT,                                12310020
115700                    SKU_LVL_UPD_IND,                              12320020
115800                    DAYS_BEF_SHIP_NBR,                            12330020
115900                    DAYS_AFT_CLR_NBR                              12340020
116000             INTO :MDSEDP-CHG-DTE,                                12350020
116100                  :MDSEDP-MDSEBG-NBR,                             12360020
116200                  :MDSEDP-DPTDIS-CDE,                             12370020
116300                  :MDSEDP-ARDEPT-CHG-DTE,                         12380020
116400                  :MDSEDP-ARDEPT-DESC,                            12390020
116500                  :MDSEDP-MDSEAR-DKEY,                            12400020
116600                  :MDSEDP-CONS-IND,                               12410020
116700                  :MDSEDP-PLAN-FRGT-PCT      :PV-NULL-IND,        12420020
116800                  :MDSEDP-SKU-LVL-UPD-IND,                        12430020
116900                  :MDSEDP-DAYS-BEF-SHIP-NBR,                      12440020
117000                  :MDSEDP-DAYS-AFT-CLR-NBR                        12450020
117100             FROM   TMDSEDP                                       12460020
117200             WHERE (MDSEAR_DKEY     = :DK-MDSEAR-DKEY)            12470020
117300         END-EXEC                                                 12480020
117400                                                                  12490020
117500         EVALUATE TRUE                                            12500020
117600             WHEN SQLCODE = ZERO                                  12510020
117700                 SET PS-ROW-FOUND TO TRUE                         12520020
117800             WHEN SQLCODE = -904                                  12530020
117900             WHEN SQLCODE = -913                                  12540020
118000                  CONTINUE                                        12550020
118100             WHEN SQLCODE = +100                                  12560020
118200             WHEN SQLWARN0 NOT = SPACES                           12570020
118300             WHEN SQLCODE < 0                                     12580020
118400             WHEN SQLCODE > 0                                     12590020
118500                 STRING ' GMA ' DK-GMA-NBR                        12600020
118600                        ' DMA ' DK-DMA-NBR                        12610020
118700                        ' DPT ' DK-DEPT-NBR                       12620020
118800                        ' MCL ' DK-MAJ-CL-NBR                     12630020
118900                        ' SCL ' DK-SUB-CL-NBR                     12640020
119000                        ' LEV=' DK-MDSELV-CDE                     12650020
119100                        ' DTE ' DK-END-DATE                       12660020
119200                        DELIMITED BY SIZE                         12670020
119300                        INTO DP013-MESSAGE-TEXT(1)                12680020
119400                 MOVE SQLCA TO DP013-SQLCA                        12690020
119500                 MOVE '2300-RETREIVE-FOR-UPDATE' TO               12700020
119600                     DP013-PARAGRAPH                              12710020
119700                 MOVE 'TMDSEAR' TO DP013-DB2-TABLE-NAME(1)        12720020
119800                 MOVE 'TMDSEDP' TO DP013-DB2-TABLE-NAME(2)        12730020
119900                 SET DP013-DB2-ABEND TO TRUE                      12740020
120000                 SET DP013-NO-ROLLBACK TO TRUE                    12750020
120100                 SET DP013-XCTL-DISPLAY-RESTART TO TRUE           12760020
120200                 PERFORM DP013-0000-PROCESS-ABEND                 12770020
120300         END-EVALUATE                                             12780020
120400     END-PERFORM.                                                 12790020
120500                                                                  12800020
120600                                                                  12810020
120700     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         12820020
120800         MOVE '2300-RETRIEVE-FOR-UPDATE' TO                       12830020
120900                                     DP013-PARAGRAPH              12840020
121000         MOVE SQLCA TO DP013-SQLCA                                12850020
121100         STRING ' GMA ' DK-GMA-NBR                                12860020
121200                ' DMA ' DK-DMA-NBR                                12870020
121300                ' DPT ' DK-DEPT-NBR                               12880020
121400                ' MCL ' DK-MAJ-CL-NBR                             12890020
121500                ' SCL ' DK-SUB-CL-NBR                             12900020
121600                ' LEV=' DK-MDSELV-CDE                             12910020
121700                ' DTE ' DK-END-DATE                               12920020
121800                DELIMITED BY SIZE                                 12930020
121900                INTO DP013-MESSAGE-TEXT(1)                        12940020
122000         MOVE 'MAX NUMBER OF RETRIES EXCEEDED' TO                 12950020
122100                                     DP013-MESSAGE-TEXT(2)        12960020
122200         MOVE 'TMDSEAR' TO DP013-DB2-TABLE-NAME(1)                12970020
122300         MOVE 'TMDSEDP' TO DP013-DB2-TABLE-NAME(2)                12980020
122400         SET DP013-DB2-ABEND                                      12990020
122500             DP013-NO-ROLLBACK                                    13000020
122600             DP013-XCTL-DISPLAY-RESTART TO TRUE                   13010020
122700         PERFORM DP013-0000-PROCESS-ABEND                         13020020
122800     END-IF.                                                      13030020
122900                                                                  13040020
123000                                                                  13050020
123100 EJECT                                                            13060020
123200                                                                  13070020
123300 2400-GET-MDSEAR-DESCRIPS.                                        13080020
123400                                                                  13090020
123500      MOVE ASC-COMPANY-NO    TO DK-OPERCO-NBR                     13100020
123600      MOVE ASC-GMA-NO        TO DK-GMA-NBR                        13110020
123700      MOVE '000'             TO DK-DMA-NBR                        13120020
123800                                DK-DEPT-NBR                       13130020
123900                                DK-MAJ-CL-NBR                     13140020
124000                                DK-SUB-CL-NBR                     13150020
124100      MOVE PC-GMA-LEVEL-CD   TO DK-MDSELV-CDE                     13160020
124200      PERFORM 9400-GET-MDSEAR                                     13170020
124300      MOVE MDSEAR-DESC       TO ASC-GMA-DESC                      13180020
124400                                                                  13190020
124500                                                                  13200020
124600      MOVE ASC-COMPANY-NO    TO DK-OPERCO-NBR                     13210020
124700      MOVE ASC-GMA-NO        TO DK-GMA-NBR                        13220020
124800      MOVE ASC-DMA-NO        TO DK-DMA-NBR                        13230020
124900      MOVE '000'             TO DK-DEPT-NBR                       13240020
125000                                DK-MAJ-CL-NBR                     13250020
125100                                DK-SUB-CL-NBR                     13260020
125200      MOVE PC-DMA-LEVEL-CD   TO DK-MDSELV-CDE                     13270020
125300      PERFORM 9400-GET-MDSEAR                                     13280020
125400      MOVE MDSEAR-DESC       TO ASC-DMA-DESC                      13290020
125500                                                                  13300020
125600                                                                  13310020
125700      MOVE ASC-COMPANY-NO    TO DK-OPERCO-NBR                     13320020
125800      MOVE ASC-GMA-NO        TO DK-GMA-NBR                        13330020
125900      MOVE ASC-DMA-NO        TO DK-DMA-NBR                        13340020
126000      MOVE ASC-DPT-NO        TO DK-DEPT-NBR                       13350020
126100      MOVE '000'             TO DK-MAJ-CL-NBR                     13360020
126200                                DK-SUB-CL-NBR                     13370020
126300      MOVE PC-DEPT-LEVEL-CD  TO DK-MDSELV-CDE                     13380020
126400      PERFORM 9400-GET-MDSEAR                                     13390020
126500      MOVE MDSEAR-DESC       TO ASC-DPT-DESC.                     13400020
126600                                                                  13410020
126700 3000-PROCESS-MAP.                                                13420020
126800                                                                  13430020
126900******************************************************************13440020
127000*                                                                 13450020
127100******************************************************************13460020
127200                                                                  13470020
127300     SET PS-SEND-DATA-ONLY-FRSET TO TRUE.                         13480020
127400                                                                  13490020
127500     PERFORM DP007-0000-GET-PANEL.                                13500020
127600                                                                  13510020
127700                                                                  13520020
127800     IF (DP020-SRC-AID NOT = DP016-PF5)   AND                     13530020
127900        (DP020-SRC-AID NOT = DP016-CLEAR)                         13540020
128000         PERFORM 3200-MOVE-SCREEN-TO-COMMAREA                     13550020
128100     END-IF.                                                      13560020
128200                                                                  13570020
128300     PERFORM 3100-CHECK-LOCAL-FKEYS.                              13580020
128400 EJECT                                                            13590020
128500                                                                  13600020
128600 3100-CHECK-LOCAL-FKEYS.                                          13610020
128700                                                                  13620020
128800******************************************************************13630020
128900*    TAKE THE APPROPRIATE COURSE OF ACTION BASED ON WHAT          13640020
129000*    FUNCTION KEY THE USER HAS HIT.                               13650020
129100*                                                                 13660020
129200*    MODIFY THE EVALUATE CLAUSE BELOW BY ADDING A WHEN  CLAUSE    13670020
129300*    FOR EACH AID KEY YOU PLAN ON HANDLING WITHIN THIS PROGRAM.   13680020
129400*    DO NOT MODIFY OR DELETE ANY OF THE EXISTING WHEN  CLAUSES.   13690020
129500*                                                                 13700020
129600******************************************************************13710020
129700                                                                  13720020
129800     EVALUATE TRUE                                                13730020
129900                                                                  13740020
130000         WHEN (DP020-FK-GO-TO-TRAN(DP020-SRC-AID)  OR             13750020
130100               DP020-FK-RETURN(DP020-SRC-AID))                    13760020
130200             PERFORM 4300-SETUP-INTER-APPL-COMM                   13770020
130300             PERFORM DP015-1000-START-NAVIGATOR                   13780020
130400                                                                  13790020
130500         WHEN (DP020-FK-EDIT-GOTO(DP020-SRC-AID))                 13800020
130600                                                                  13810020
130700             IF (DP020-SRC-AID = DP016-PF17)                      13820020
130800                                                                  13830020
130900                 PERFORM 3300-EDIT-DATA-IN-COMMAREA               13840020
131000                                                                  13850020
131100                 IF PS-NO-ERROR                                   13860020
131200                    PERFORM 4000-PREPARE-TSQ                      13870020
131300                    PERFORM 4300-SETUP-INTER-APPL-COMM            13880020
131400                    PERFORM DP015-1000-START-NAVIGATOR            13890020
131500                 ELSE                                             13900020
131600                    PERFORM 2200-DISPLAY-PANEL                    13910020
131700                 END-IF                                           13920020
131800             END-IF                                               13930020
131900                                                                  13940020
132000         WHEN DP020-FK-NEXT-SELECTION(DP020-SRC-AID)              13950020
132100             PERFORM 3250-GET-NEXT-SELECTION                      13960020
132200             PERFORM 2200-DISPLAY-PANEL                           13970020
132300                                                                  13980020
132400         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     13990020
132500             SET PS-SEND-MAP-N-DATA-FRSET TO TRUE                 14000020
132600             INITIALIZE ANAVCMDO ANAVKEYO                         14010020
132700                        DP020-NAV-KEY-DATA                        14020020
132800                        DP020-NAV-MNEMONIC                        14030020
132900             PERFORM 2000-BUILD-INITIAL-PANEL                     14040020
133000             PERFORM 2200-DISPLAY-PANEL                           14050020
133100                                                                  14060020
133200                                                                  14070020
133300         WHEN DP020-SRC-AID = DP016-ENTER                         14080020
133400                                                                  14090020
133500             IF (DP020-NAV-MNEMONIC = SPACES)     OR              14100020
133600                (DP020-NAV-MNEMONIC = LOW-VALUES)                 14110020
133700                 PERFORM 3300-EDIT-DATA-IN-COMMAREA               14120020
133800                 PERFORM 2200-DISPLAY-PANEL                       14130020
133900             ELSE                                                 14140020
134000                 PERFORM 4300-SETUP-INTER-APPL-COMM               14150020
134100                 PERFORM DP015-1000-START-NAVIGATOR               14160020
134200             END-IF                                               14170020
134300                                                                  14180020
134400                                                                  14190020
134500         WHEN DP020-SRC-AID = DP016-PF15                          14200020
134600             IF ASC-DEPT-MAINT                                    14210020
134700                 PERFORM 3300-EDIT-DATA-IN-COMMAREA               14220020
134800                 IF PS-NO-ERROR                                   14230020
134900                     PERFORM 4500-DETERMINE-UPDATE                14240020
135000                 END-IF                                           14250020
135100             ELSE                                                 14260020
135200                MOVE PC-TSYMSG-00151 TO DP020-MSG-NUMBER          14270020
135300                SET PS-ERROR                                      14280020
135400                    DP020-MSG-FATAL TO TRUE                       14290020
135500                MOVE -1 TO ANAVCMDL                               14300020
135600             END-IF                                               14310020
135700             PERFORM 2200-DISPLAY-PANEL                           14320020
135800                                                                  14330020
135900         WHEN DP020-SRC-AID = DP016-PA2                           14340020
136000             SET PS-SEND-DATA-ONLY TO TRUE                        14350020
136100                                                                  14360020
136200             MOVE -1 TO ANAVCMDL                                  14370020
136300                                                                  14380020
136400             PERFORM DP017-0000-GET-CURR-DATE-TIME                14390020
136500             PERFORM DP009-0000-LOAD-FK-LINES                     14400020
136600             PERFORM DP008-0000-WRITE-PANEL                       14410020
136700                                                                  14420020
136800         WHEN DP020-SRC-AID = DP016-CLEAR                         14430020
136900             SET PS-SEND-MAP-N-DATA-FRSET TO TRUE                 14440020
137000                                                                  14450020
137100             PERFORM 3300-EDIT-DATA-IN-COMMAREA                   14460020
137200             PERFORM 2200-DISPLAY-PANEL                           14470020
137300                                                                  14480020
137400         WHEN OTHER                                               14490020
137500*            -- INVALID FUNCTION KEY --                           14500020
137600             PERFORM 3300-EDIT-DATA-IN-COMMAREA                   14510020
137700             MOVE PC-TSYMSG-00045  TO DP020-MSG-NUMBER            14520020
137800             SET DP020-MSG-FATAL TO TRUE                          14530020
137900             PERFORM 2200-DISPLAY-PANEL                           14540020
138000                                                                  14550020
138100     END-EVALUATE.                                                14560020
138200 EJECT                                                            14570020
138300                                                                  14580020
138400 3200-MOVE-SCREEN-TO-COMMAREA.                                    14590020
138500                                                                  14600020
138600******************************************************************14610020
138700*                                                                 14620020
138800******************************************************************14630020
138900                                                                  14640020
139000     IF ABUSGPL > 0                                               14650020
139100        MOVE ABUSGPI   TO ASC-SCRN-BUS-GROUP                      14660020
139200        SET ASC-BUS-GRP-NEED-EDIT TO TRUE                         14670020
139300     ELSE                                                         14680020
139400        IF ABUSGPF = DP015-ERASE-EOF                              14690020
139500           MOVE SPACE TO ASC-SCRN-BUS-GROUP                       14700020
139600           SET ASC-BUS-GRP-NEED-EDIT TO TRUE                      14710020
139700        END-IF                                                    14720020
139800     END-IF.                                                      14730020
139900                                                                  14740020
140000     IF ADPTDISL > 0                                              14750020
140100        MOVE ADPTDISI   TO ASC-SCRN-DISCNT-CD                     14760020
140200        SET ASC-DISCNT-CD-NEED-EDIT TO TRUE                       14770020
140300     ELSE                                                         14780020
140400        IF ADPTDISF = DP015-ERASE-EOF                             14790020
140500           MOVE SPACE TO ASC-SCRN-DISCNT-CD                       14800020
140600           SET ASC-DISCNT-CD-NEED-EDIT TO TRUE                    14810020
140700        END-IF                                                    14820020
140800     END-IF.                                                      14830020
140900                                                                  14840020
141000     IF AARDESCL > 0                                              14850020
141100        MOVE AARDESCI   TO ASC-SCRN-AR-DESCRIPTION                14860020
141200        SET ASC-AR-DESC-NEED-EDIT TO TRUE                         14870020
141300     ELSE                                                         14880020
141400        IF AARDESCF = DP015-ERASE-EOF                             14890020
141500           MOVE SPACE TO ASC-SCRN-AR-DESCRIPTION                  14900020
141600           SET ASC-AR-DESC-NEED-EDIT TO TRUE                      14910020
141700        END-IF                                                    14920020
141800     END-IF.                                                      14930020
141900                                                                  14940020
142000     IF ACONSGNL > 0                                              14950020
142100        MOVE ACONSGNI   TO ASC-SCRN-CONSIGN-IND                   14960020
142200     ELSE                                                         14970020
142300        IF ACONSGNF = DP015-ERASE-EOF                             14980020
142400           MOVE SPACE TO ASC-SCRN-CONSIGN-IND                     14990020
142500        END-IF                                                    15000020
142600     END-IF.                                                      15010020
142700                                                                  15020020
142800     IF ASHPRPTL > 0                                              15030020
142900        MOVE ASHPRPTI   TO ASC-SCRN-DAYS-BEF-SHIP-NBR             15040020
143000     ELSE                                                         15050020
143100        IF ASHPRPTF = DP015-ERASE-EOF                             15060020
143200           MOVE ZERO TO ASC-SCRN-DAYS-BEF-SHIP-NBR                15070020
143300        END-IF                                                    15080020
143400     END-IF.                                                      15090020
143500                                                                  15100020
143600     IF ACLRRPTL > 0                                              15110020
143700        MOVE ACLRRPTI   TO ASC-SCRN-DAYS-AFT-CLR-NBR              15120020
143800     ELSE                                                         15130020
143900        IF ACLRRPTF = DP015-ERASE-EOF                             15140020
144000           MOVE ZERO TO ASC-SCRN-DAYS-AFT-CLR-NBR                 15150020
144100        END-IF                                                    15160020
144200     END-IF.                                                      15170020
144300                                                                  15180020
144400     IF ASKUINDL > 0                                              15190020
144500        MOVE ASKUINDI   TO ASC-SCRN-SKU-LVL-UPD-IND               15200020
144600     ELSE                                                         15210020
144700        IF ASKUINDF = DP015-ERASE-EOF                             15220020
144800           MOVE SPACE TO ASC-SCRN-SKU-LVL-UPD-IND                 15230020
144900        END-IF                                                    15240020
145000     END-IF.                                                      15250020
145100                                                                  15260020
145200     IF AFRTPCTL > 0                                              15270020
145300        MOVE AFRTPCTI   TO ASC-SCRN-PLAN-FRGT-PCT                 15280020
145400     ELSE                                                         15290020
145500        IF AFRTPCTF = DP015-ERASE-EOF                             15300020
145600           MOVE SPACE TO ASC-SCRN-PLAN-FRGT-PCT                   15310020
145700        END-IF                                                    15320020
145800     END-IF.                                                      15330020
145900                                                                  15340020
146000     IF ASHKPCTL > 0                                              15350020
146100        MOVE ASHKPCTI   TO ASC-SCRN-SHRINK-PCT                    15360020
146200     ELSE                                                         15370020
146300        IF ASHKPCTF = DP015-ERASE-EOF                             15380020
146400           MOVE SPACE TO ASC-SCRN-SHRINK-PCT                      15390020
146500        END-IF                                                    15400020
146600     END-IF.                                                      15410020
146700                                                                  15420020
C14666     IF AESHPCTL > 0                                              15430032
C14666        MOVE AESHPCTI   TO ASC-SCRN-ECOM-SHRINK-PCT               15440032
C14666     ELSE                                                         15450032
C14666        IF AESHPCTF = DP015-ERASE-EOF                             15460032
C14666           MOVE SPACE   TO ASC-SCRN-ECOM-SHRINK-PCT               15470032
C14666        END-IF                                                    15480032
C14666     END-IF.                                                      15490032
C14666                                                                  15500032
C14666*    IF ASHKFISL > 0                                              15510063
C14666*       MOVE ASHKFISI   TO ASC-SCRN-SHRINK-FIS-PER                15520063
C14666*    ELSE                                                         15530063
C14666*       IF ASHKFISF = DP015-ERASE-EOF                             15540063
C14666*          MOVE SPACE TO ASC-SCRN-SHRINK-FIS-PER                  15550063
C14666*       END-IF                                                    15560063
C14666*    END-IF.                                                      15570063
147500                                                                  15580020
147600     IF ASTRZNEL > 0                                              15590020
147700        MOVE ASTRZNEI   TO ASC-SCRN-STR-ZN-ID                     15600020
147800     ELSE                                                         15610020
147900        IF ASTRZNEF = DP015-ERASE-EOF                             15620020
148000           MOVE SPACE TO ASC-SCRN-STR-ZN-ID                       15630020
148100        END-IF                                                    15640020
148200     END-IF.                                                      15650020
148300                                                                  15660020
148400 EJECT                                                            15670020
148500                                                                  15680020
148600 3250-GET-NEXT-SELECTION.                                         15690020
148700******************************************************************15700020
148800*                                                                 15710020
148900******************************************************************15720020
149000     SET PS-SEND-MAP-N-DATA-FRSET TO TRUE.                        15730020
149100     ADD 1 TO ASC-SEL-IDX.                                        15740020
149200                                                                  15750020
149300     IF ASC-SEL-IDX > ASC-MAX-ITEMS                               15760020
149400        ADD +1 TO ASC-TSQ-ITEM-NBR                                15770020
149500        PERFORM 9050-READ-TSQ                                     15780020
149600        MOVE PV-TSQ-TEMP-LAYOUT    TO ASC-SAVE-SELECTION-TABLE    15790020
149700        MOVE 1 TO ASC-SEL-IDX                                     15800020
149800     END-IF.                                                      15810020
149900                                                                  15820020
150000     IF ASC-KEY-DATA (ASC-SEL-IDX) > SPACES                       15830020
150100         MOVE ASC-GMA-NBR(ASC-SEL-IDX)   TO ASC-GMA-NO            15840020
150200         MOVE ASC-DMA-NBR(ASC-SEL-IDX)  TO ASC-DMA-NO             15850020
150300         MOVE ASC-DPT-NBR(ASC-SEL-IDX)  TO ASC-DPT-NO             15860020
150400         PERFORM 2000-BUILD-INITIAL-PANEL                         15870020
150500     ELSE                                                         15880020
150600         SUBTRACT 1 FROM ASC-SEL-IDX                              15890020
150700         MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER                15900020
150800         SET DP020-MSG-INFORMATIONAL TO TRUE                      15910020
150900         SET PS-ERROR TO TRUE                                     15920020
151000         MOVE -1  TO ASHKPCTL                                     15930024
151100         PERFORM 1700-RESET-ATTRIBUTES                            15940020
151200     END-IF.                                                      15950020
151300                                                                  15960020
151400 3300-EDIT-DATA-IN-COMMAREA.                                      15970020
151500                                                                  15980020
151600******************************************************************15990020
151700*                                                                 16000020
151800******************************************************************16010020
151900                                                                  16020020
152000     PERFORM 1700-RESET-ATTRIBUTES.                               16030020
152100                                                                  16040020
152200     SET PS-NO-ERROR TO TRUE.                                     16050020
152300                                                                  16060020
152400     PERFORM 3440-VALIDATE-SHRINK-PCT.                            16070025
152500                                                                  16080020
C14666     PERFORM 3445-VALIDATE-ECOM-SHRINK-PCT.                       16090033
C14666                                                                  16100033
152600**   PERFORM 3435-VALIDATE-PLAN-FRGT-PCT.                         16110025
152700                                                                  16120020
152800                                                                  16130020
152900**   PERFORM 3425-VALIDATE-CONSIGN-IND.                           16140025
153000                                                                  16150020
153100**   PERFORM 3427-VALIDATE-RPT-DAYS.                              16160025
153200                                                                  16170020
153300**   PERFORM 3430-VALIDATE-SKU-LVL-UPD-IND.                       16180025
153400                                                                  16190020
153500**   PERFORM 3475-VALIDATE-AR-DESC.                               16200025
153600                                                                  16210020
153700**   IF ASC-DISCNT-CD-PASS-EDIT                                   16220025
153800**      CONTINUE                                                  16230025
153900**   ELSE                                                         16240025
154000**      PERFORM 3450-VALIDATE-DEPT-DISCNT                         16250025
154100**   END-IF.                                                      16260025
154200                                                                  16270020
154300**   IF ASC-BUS-GRP-PASS-EDIT                                     16280025
154400**      CONTINUE                                                  16290025
154500**   ELSE                                                         16300025
154600**      PERFORM 3400-VALIDATE-BUS-GROUP                           16310025
154700**   END-IF.                                                      16320025
154800                                                                  16330020
154900**   PERFORM 3470-VALIDATE-STR-ZN-ID.                             16340025
155000                                                                  16350020
155100     PERFORM 3300-MOVE-COMMAREA-TO-SCREEN.                        16360020
155200                                                                  16370020
155300 EJECT                                                            16380020
155400                                                                  16390020
155500 3300-MOVE-COMMAREA-TO-SCREEN.                                    16400020
155600                                                                  16410020
155700******************************************************************16420020
155800*                                                                 16430020
155900******************************************************************16440020
156000                                                                  16450020
156100     MOVE ASC-COMPANY-NO          TO AOPERCOO.                    16460020
156200     MOVE ASC-GMA-NO              TO AGMAO.                       16470020
156300     MOVE ASC-GMA-DESC            TO AGMADESO.                    16480020
156400     MOVE ASC-DMA-NO              TO ADMAO.                       16490020
156500     MOVE ASC-DMA-DESC            TO ADMADESO.                    16500020
156600     MOVE ASC-DPT-NO              TO ADPTO.                       16510020
156700     MOVE ASC-DPT-DESC            TO ADPTDESO.                    16520020
156800     MOVE ASC-SCRN-BUS-GROUP      TO ABUSGPO.                     16530020
156900     MOVE ASC-SCRN-BUS-GROUP-DESC TO ABGDESCO.                    16540020
157000     MOVE ASC-SCRN-DISCNT-CD      TO ADPTDISO.                    16550020
157100     MOVE ASC-SCRN-AR-DESCRIPTION TO AARDESCO.                    16560020
157200                                                                  16570020
157300     MOVE ASC-AR-CHG-MM           TO PV-WD-MM.                    16580020
157400     MOVE ASC-AR-CHG-DD           TO PV-WD-DD.                    16590020
157500     MOVE ASC-AR-CHG-YY           TO PV-WD-YY.                    16600020
157600     MOVE PV-WORK-DATE            TO AARCHGDO.                    16610020
157700                                                                  16620020
C14666*    MOVE ASC-DP-CHG-MM           TO PV-WD-MM.                    16630063
C14666*    MOVE ASC-DP-CHG-DD           TO PV-WD-DD.                    16640063
C14666*    MOVE ASC-DP-CHG-YY           TO PV-WD-YY.                    16650063
C14666*    MOVE PV-WORK-DATE            TO ADPCHGDO.                    16660063
158200                                                                  16670020
158300     MOVE ASC-SCRN-CONSIGN-IND    TO ACONSGNO.                    16680020
158400     MOVE ASC-SCRN-DAYS-BEF-SHIP-NBR                              16690020
158500                                  TO ASHPRPTO.                    16700020
158600     MOVE ASC-SCRN-DAYS-AFT-CLR-NBR                               16710020
158700                                  TO ACLRRPTO.                    16720020
158800     MOVE ASC-SCRN-SKU-LVL-UPD-IND                                16730020
158900                                  TO ASKUINDO.                    16740020
159000     MOVE ASC-SCRN-PLAN-FRGT-PCT  TO AFRTPCTO.                    16750020
159100     MOVE ASC-SCRN-SHRINK-PCT     TO ASHKPCTO.                    16760020
C14666     MOVE ASC-SCRN-ECOM-SHRINK-PCT                                16770032
C14666                                  TO AESHPCTO.                    16780032
C14666*    MOVE ASC-SCRN-SHRINK-FIS-PER TO ASHKFISO.                    16790063
C14666*    MOVE ASC-FIS-MONTH-NM        TO AFISMONO.                    16800063
C14666     IF DP020-PANEL-TITLE =                                       16810051
C14666           '  MERCHANDISE DEPARTMENT ADD  '                       16820051
C14666        MOVE SPACES               TO ASC-BM-LAST-CHG-USER         16830051
C14666                                     ASC-ECOM-LAST-CHG-USER       16840051
C14666                                     ASC-BM-LAST-CHG-DT           16850051
C14666                                     ASC-ECOM-LAST-CHG-DT         16860051
C14666                                     PV-FORMAT-DATE               16870051
C14666     END-IF                                                       16880051
C14666     MOVE ASC-BM-LAST-CHG-MM      TO PV-FORMAT-MM.                16890051
C14666     MOVE ASC-BM-LAST-CHG-DD      TO PV-FORMAT-DD.                16900051
C14666     MOVE ASC-BM-LAST-CHG-CCYY    TO PV-FORMAT-CCYY.              16910051
C14666     MOVE PV-FORMAT-DATE          TO ABMCHCDO.                    16920051
C14666     MOVE ASC-ECOM-LAST-CHG-MM    TO PV-FORMAT-MM.                16930051
C14666     MOVE ASC-ECOM-LAST-CHG-DD    TO PV-FORMAT-DD.                16940051
C14666     MOVE ASC-ECOM-LAST-CHG-CCYY  TO PV-FORMAT-CCYY.              16950051
C14666     MOVE PV-FORMAT-DATE          TO AECCHCDO.                    16960051
C14666     MOVE ASC-BM-LAST-CHG-USER    TO ABMCHGUO.                    16970051
C14666     MOVE ASC-ECOM-LAST-CHG-USER  TO AECCHGUO.                    16980051
159400     MOVE ASC-SCRN-STR-ZN-ID      TO ASTRZNEO.                    16990020
159500     MOVE ASC-ORIG-STR-ZN-DESC    TO AZNDESCO.                    17000020
159600                                                                  17010020
159700 EJECT                                                            17020020
159800                                                                  17030020
159900 3400-VALIDATE-BUS-GROUP.                                         17040020
160000******************************************************************17050020
160100*                                                                 17060020
160200******************************************************************17070020
160300                                                                  17080020
160400                                                                  17090020
160500     IF ASC-SCRN-BUS-GROUP = SPACES                               17100020
160600        INITIALIZE ABGDESCO                                       17110020
160700                   ASC-SCRN-BUS-GROUP-DESC                        17120020
160800     ELSE                                                         17130020
160900         MOVE ASC-SCRN-BUS-GROUP TO  DP010I-UNEDITED-FIELD        17140020
161000         MOVE +3                 TO  DP010I-MAXIMUM-DIGITS        17150020
161100         SET DP010I-NEGATIVE-ALLOWED TO TRUE                      17160020
262978         CALL DP010I-NUMERIC-EDIT-ROUTINE                         17171067
262978              USING DP010I-NUMERIC-EDIT-AREA                      17172067
161300         IF DP010I-ERROR-DETECTED                                 17180020
161400            SET PS-ERROR         TO TRUE                          17190020
161500            SET DP020-MSG-FATAL  TO TRUE                          17200020
161600            INITIALIZE              ABUSGPO                       17210020
161700                                    ABGDESCO                      17220020
161800                   ASC-SCRN-BUS-GROUP-DESC                        17230020
161900            MOVE DP015-RED       TO ABUSGPC                       17240020
162000            MOVE DP015-REVERSE   TO ABUSGPH                       17250020
162100            MOVE PC-TSYMSG-00008 TO DP020-MSG-NUMBER              17260020
162200            MOVE -1              TO ABUSGPL                       17270020
162300         ELSE                                                     17280020
162400            MOVE DP010I-NUMERIC-FIELD  TO ASC-SCRN-BUS-GROUP-N    17290020
162500                MOVE ASC-SCRN-BUS-GROUP    TO DK-MDSEBG-NBR       17300020
162600                PERFORM 9200-GET-BUS-GROUP                        17310020
162700                IF PS-ROW-NOT-FOUND                               17320020
162800                   SET PS-ERROR         TO TRUE                   17330020
162900                   SET DP020-MSG-FATAL  TO TRUE                   17340020
163000                   INITIALIZE              ABUSGPO                17350020
163100                   ASC-SCRN-BUS-GROUP-DESC                        17360020
163200                                    ABGDESCO                      17370020
163300                   MOVE DP015-RED       TO ABUSGPC                17380020
163400                   MOVE DP015-REVERSE   TO ABUSGPH                17390020
163500                   MOVE PC-TSYMSG-00152 TO DP020-MSG-NUMBER       17400020
163600                   MOVE -1              TO ABUSGPL                17410020
163700                ELSE                                              17420020
163800                   SET ASC-BUS-GRP-PASS-EDIT TO TRUE              17430020
C14666                   MOVE MDSEBG-MDSEBG-DESC                        17440027
C14666                                        TO ASC-SCRN-BUS-GROUP-DESC17450027
164000                END-IF                                            17460020
164100         END-IF                                                   17470020
164200     END-IF.                                                      17480020
164300                                                                  17490020
164400 3425-VALIDATE-CONSIGN-IND.                                       17500020
164500******************************************************************17510020
164600*                                                                 17520020
164700******************************************************************17530020
164800     IF ASC-SCRN-CONSIGN-IND EQUAL SPACES                         17540020
164900         SET PS-ERROR         TO TRUE                             17550020
165000         SET DP020-MSG-FATAL  TO TRUE                             17560020
165100         MOVE DP015-RED       TO ACONSGNC                         17570020
165200         MOVE DP015-REVERSE   TO ACONSGNH                         17580020
165300         MOVE PC-TSYMSG-00007 TO DP020-MSG-NUMBER                 17590020
165400         MOVE -1              TO ACONSGNL                         17600020
165500     ELSE                                                         17610020
165600       IF (ASC-SCRN-CONSIGN-IND NOT EQUAL 'Y') AND                17620020
165700          (ASC-SCRN-CONSIGN-IND NOT EQUAL 'N')                    17630020
165800         SET PS-ERROR         TO TRUE                             17640020
165900         SET DP020-MSG-FATAL  TO TRUE                             17650020
166000         MOVE DP015-RED       TO ACONSGNC                         17660020
166100         MOVE DP015-REVERSE   TO ACONSGNH                         17670020
166200         MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER                 17680020
166300         MOVE -1              TO ACONSGNL                         17690020
166400       END-IF                                                     17700020
166500     END-IF.                                                      17710020
166600                                                                  17720020
166700 3427-VALIDATE-RPT-DAYS.                                          17730020
166800******************************************************************17740020
166900*                                                                 17750020
167000*    ENSURE THE DAYS BEFORE SHIPMENT AND DAYS AFTER CLEARANCE     17760020
167100*    ARE NUMERIC                                                  17770020
167200*                                                                 17780020
167300******************************************************************17790020
167400                                                                  17800020
167500*** DAYS BEFORE SHIPMENT                                          17810020
167600         MOVE ASC-SCRN-DAYS-BEF-SHIP-NBR                          17820020
167700                                    TO  DP010I-UNEDITED-FIELD     17830020
167800         MOVE +3                    TO  DP010I-MAXIMUM-DIGITS     17840020
167900         MOVE +0                    TO  DP010I-MAXIMUM-DECIMALS   17850020
168000         SET DP010I-NEGATIVE-NOT-ALLOWED                          17860020
168100                                    TO  TRUE                      17870020
168200                                                                  17880020
262978         CALL DP010I-NUMERIC-EDIT-ROUTINE                         17891067
262978              USING DP010I-NUMERIC-EDIT-AREA                      17892067
168400         IF  DP010I-ERROR-DETECTED                                17900020
168500             SET PS-ERROR           TO TRUE                       17910020
168600             SET DP020-MSG-FATAL    TO TRUE                       17920020
168700             MOVE DP015-RED         TO ASHPRPTC                   17930020
168800             MOVE DP015-REVERSE     TO ASHPRPTH                   17940020
168900             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           17950020
169000             MOVE -1                TO ASHPRPTL                   17960020
169100         ELSE                                                     17970020
169200             MOVE DP010I-NUMERIC-FIELD                            17980020
169300                               TO  ASC-SCRN-DAYS-BEF-SHIP-NBR     17990020
169400         END-IF.                                                  18000020
169500                                                                  18010020
169600*** DAYS AFTER CLEARANCE                                          18020020
169700         MOVE ASC-SCRN-DAYS-AFT-CLR-NBR                           18030020
169800                                    TO  DP010I-UNEDITED-FIELD     18040020
169900         MOVE +3                    TO  DP010I-MAXIMUM-DIGITS     18050020
170000         MOVE +0                    TO  DP010I-MAXIMUM-DECIMALS   18060020
170100         SET DP010I-NEGATIVE-NOT-ALLOWED                          18070020
170200                                    TO  TRUE                      18080020
170300                                                                  18090020
262978         CALL DP010I-NUMERIC-EDIT-ROUTINE                         18101067
262978              USING DP010I-NUMERIC-EDIT-AREA                      18102067
170500         IF  DP010I-ERROR-DETECTED                                18110020
170600             SET PS-ERROR           TO TRUE                       18120020
170700             SET DP020-MSG-FATAL    TO TRUE                       18130020
170800             MOVE DP015-RED         TO ACLRRPTC                   18140020
170900             MOVE DP015-REVERSE     TO ACLRRPTH                   18150020
171000             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           18160020
171100             MOVE -1                TO ACLRRPTL                   18170020
171200         ELSE                                                     18180020
171300             MOVE DP010I-NUMERIC-FIELD                            18190020
171400                               TO  ASC-SCRN-DAYS-AFT-CLR-NBR      18200020
171500         END-IF.                                                  18210020
171600                                                                  18220020
171700 3430-VALIDATE-SKU-LVL-UPD-IND.                                   18230020
171800******************************************************************18240020
171900*                                                                 18250020
172000******************************************************************18260020
172100     IF ASC-SCRN-SKU-LVL-UPD-IND = SPACE                          18270020
172200         SET PS-ERROR         TO TRUE                             18280020
172300         SET DP020-MSG-FATAL  TO TRUE                             18290020
172400         MOVE DP015-RED       TO ASKUINDC                         18300020
172500         MOVE DP015-REVERSE   TO ASKUINDH                         18310020
172600         MOVE PC-TSYMSG-00007 TO DP020-MSG-NUMBER                 18320020
172700         MOVE -1              TO ASKUINDL                         18330020
172800     ELSE                                                         18340020
172900       IF (ASC-SCRN-SKU-LVL-UPD-IND NOT = 'Y') AND                18350020
173000          (ASC-SCRN-SKU-LVL-UPD-IND NOT = 'N')                    18360020
173100         SET PS-ERROR         TO TRUE                             18370020
173200         SET DP020-MSG-FATAL  TO TRUE                             18380020
173300         MOVE DP015-RED       TO ASKUINDC                         18390020
173400         MOVE DP015-REVERSE   TO ASKUINDH                         18400020
173500         MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER                 18410020
173600         MOVE -1              TO ASKUINDL                         18420020
173700       END-IF                                                     18430020
173800     END-IF.                                                      18440020
173900                                                                  18450020
174000 3435-VALIDATE-PLAN-FRGT-PCT.                                     18460020
174100******************************************************************18470020
174200*                                                                 18480020
174300*    ENSURE THE PLANNED FREIGHT PERCENT IS VALID.                 18490020
174400*                                                                 18500020
174500******************************************************************18510020
174600                                                                  18520020
174700         MOVE ASC-SCRN-PLAN-FRGT-PCT TO DP010I-UNEDITED-FIELD     18530020
174800         MOVE +4                    TO  DP010I-MAXIMUM-DIGITS     18540020
174900         MOVE +1                    TO  DP010I-MAXIMUM-DECIMALS   18550020
175000         SET DP010I-NEGATIVE-NOT-ALLOWED                          18560020
175100                                    TO  TRUE                      18570020
175200                                                                  18580020
262978         CALL DP010I-NUMERIC-EDIT-ROUTINE                         18591067
262978              USING DP010I-NUMERIC-EDIT-AREA                      18592067
175400         IF  DP010I-ERROR-DETECTED                                18600020
175500             SET PS-ERROR           TO TRUE                       18610020
175600             SET DP020-MSG-FATAL    TO TRUE                       18620020
175700             MOVE DP015-RED         TO AFRTPCTC                   18630020
175800             MOVE DP015-REVERSE     TO AFRTPCTH                   18640020
175900             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           18650020
176000             MOVE -1                TO AFRTPCTL                   18660020
176100         ELSE                                                     18670020
176200             MOVE DP010I-NUMERIC-FIELD                            18680020
176300                                    TO  ASC-SCRN-PLAN-FRGT-PCTN2  18690020
176400             MOVE ASC-SCRN-PLAN-FRGT-PCTN2                        18700020
176500                                    TO  PV-DISPLAY-PLAN-FRGT-PCT  18710020
176600             MOVE PV-DISPLAY-PLAN-FRGT-PCT                        18720020
176700                                    TO  ASC-SCRN-PLAN-FRGT-PCT    18730020
176800         END-IF.                                                  18740020
176900                                                                  18750020
177000 3440-VALIDATE-SHRINK-PCT.                                        18760020
177100******************************************************************18770020
177200*                                                                 18780020
177300*    ENSURE THE PLANNED SHRINK PERCENT IS VALID.                  18790020
177400*                                                                 18800020
177500******************************************************************18810020
177600                                                                  18820020
177700     MOVE ASC-SCRN-SHRINK-PCT   TO  DP010I-UNEDITED-FIELD.        18830020
C14666     MOVE +2                    TO  DP010I-MAXIMUM-DIGITS.        18840061
C14666     MOVE +2                    TO  DP010I-MAXIMUM-DECIMALS.      18850033
C14666     SET DP010I-NEGATIVE-ALLOWED                                  18860033
178100                                TO  TRUE.                         18870020
178200                                                                  18880020
262978     CALL DP010I-NUMERIC-EDIT-ROUTINE                             18891067
262978          USING DP010I-NUMERIC-EDIT-AREA.                         18892067
178400     IF  DP010I-ERROR-DETECTED                                    18900020
178500         SET PS-ERROR           TO TRUE                           18910020
178600         SET DP020-MSG-FATAL    TO TRUE                           18920020
178700         MOVE DP015-RED         TO ASHKPCTC                       18930020
178800         MOVE DP015-REVERSE     TO ASHKPCTH                       18940020
178900         MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER               18950020
179000         MOVE -1                TO ASHKPCTL                       18960020
179100     ELSE                                                         18970020
179200         MOVE DP010I-NUMERIC-FIELD                                18980020
179300                                TO  ASC-SCRN-SHRINK-PCTN2         18990020
179400         MOVE ASC-SCRN-SHRINK-PCTN2                               19000020
C14666                                TO  PV-DISPLAY-PLAN-SHNK-PCT      19010054
C14666         MOVE PV-DISPLAY-PLAN-SHNK-PCT                            19020054
179700                                TO  ASC-SCRN-SHRINK-PCT           19030020
179800     END-IF.                                                      19040020
179900                                                                  19050020
C14666 3445-VALIDATE-ECOM-SHRINK-PCT.                                   19060034
C14666******************************************************************19070033
C14666*                                                                 19080033
C14666*    ENSURE THE PLANNED ECOM SHRINK PERCENT IS VALID.             19090033
C14666*                                                                 19100033
C14666******************************************************************19110033
C14666                                                                  19120033
C14666     MOVE ASC-SCRN-ECOM-SHRINK-PCT                                19130033
C14666                                TO  DP010I-UNEDITED-FIELD.        19140033
C14666     MOVE +2                    TO  DP010I-MAXIMUM-DIGITS.        19150062
C14666     MOVE +2                    TO  DP010I-MAXIMUM-DECIMALS.      19160033
C14666     SET DP010I-NEGATIVE-ALLOWED                                  19170033
C14666                                TO  TRUE.                         19180033
C14666                                                                  19190033
262978     CALL DP010I-NUMERIC-EDIT-ROUTINE                             19201067
262978          USING DP010I-NUMERIC-EDIT-AREA.                         19202067
C14666     IF  DP010I-ERROR-DETECTED                                    19210033
C14666         SET PS-ERROR           TO TRUE                           19220033
C14666         SET DP020-MSG-FATAL    TO TRUE                           19230033
C14666         MOVE DP015-RED         TO AESHPCTC                       19240042
C14666         MOVE DP015-REVERSE     TO AESHPCTH                       19250042
C14666         MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER               19260033
C14666         MOVE -1                TO AESHPCTL                       19270042
C14666     ELSE                                                         19280033
C14666         MOVE DP010I-NUMERIC-FIELD                                19290033
C14666                                TO  ASC-SCRN-ECOM-SHRINK-PCTN2    19300033
C14666         MOVE ASC-SCRN-ECOM-SHRINK-PCTN2                          19310033
C14666                                TO  PV-DISPLAY-PLAN-SHNK-PCT      19320033
C14666         MOVE PV-DISPLAY-PLAN-SHNK-PCT                            19330033
C14666                                TO  ASC-SCRN-ECOM-SHRINK-PCT      19340033
C14666     END-IF.                                                      19350033
C14666                                                                  19360033
180000 3450-VALIDATE-DEPT-DISCNT.                                       19370033
180100******************************************************************19380020
180200*                                                                 19390020
180300******************************************************************19400020
180400                                                                  19410020
180500                                                                  19420020
180600     IF ASC-SCRN-DISCNT-CD = SPACES                               19430020
180700        SET PS-ERROR         TO TRUE                              19440020
180800        SET DP020-MSG-FATAL  TO TRUE                              19450020
180900        MOVE DP015-RED       TO ADPTDISC                          19460020
181000        MOVE DP015-REVERSE   TO ADPTDISH                          19470020
181100        MOVE PC-TSYMSG-00007 TO DP020-MSG-NUMBER                  19480020
181200        MOVE -1              TO ADPTDISL                          19490020
181300     ELSE                                                         19500020
181400         MOVE ASC-SCRN-DISCNT-CD TO  DP010I-UNEDITED-FIELD        19510020
181500         MOVE +2                 TO  DP010I-MAXIMUM-DIGITS        19520020
181600         SET DP010I-NEGATIVE-ALLOWED TO TRUE                      19530020
262978         CALL DP010I-NUMERIC-EDIT-ROUTINE                         19541067
262978              USING DP010I-NUMERIC-EDIT-AREA                      19542067
181800         IF DP010I-ERROR-DETECTED                                 19550020
181900            SET PS-ERROR         TO TRUE                          19560020
182000            SET DP020-MSG-FATAL  TO TRUE                          19570020
182100            MOVE DP015-RED       TO ADPTDISC                      19580020
182200            MOVE DP015-REVERSE   TO ADPTDISH                      19590020
182300            MOVE PC-TSYMSG-00008 TO DP020-MSG-NUMBER              19600020
182400            MOVE -1              TO ADPTDISL                      19610020
182500         ELSE                                                     19620020
182600            MOVE DP010I-NUMERIC-FIELD  TO ASC-SCRN-DISCNT-CD-N    19630020
182700                MOVE ASC-SCRN-DISCNT-CD    TO DK-DPTDIS-CDE       19640020
182800                PERFORM 9250-GET-DISCOUNT-CODE                    19650020
182900                IF PS-ROW-NOT-FOUND                               19660020
183000                   SET PS-ERROR         TO TRUE                   19670020
183100                   SET DP020-MSG-FATAL  TO TRUE                   19680020
183200                   MOVE DP015-RED       TO ADPTDISC               19690020
183300                   MOVE DP015-REVERSE   TO ADPTDISH               19700020
183400                   MOVE PC-TSYMSG-00153 TO DP020-MSG-NUMBER       19710020
183500                   MOVE -1              TO ADPTDISL               19720020
183600                ELSE                                              19730020
183700                   SET ASC-DISCNT-CD-PASS-EDIT TO TRUE            19740020
183800                END-IF                                            19750020
183900         END-IF                                                   19760020
184000     END-IF.                                                      19770020
184100                                                                  19780020
184200 3470-VALIDATE-STR-ZN-ID.                                         19790020
184300******************************************************************19800020
184400*    VALIDATE THE STORE ZONE ID ENTERED AGAINST THE STORE ZONE   *19810020
184500*    MASTER                                                       19820020
184600******************************************************************19830020
184700                                                                  19840020
184800     IF ASC-SCRN-STR-ZN-ID = SPACES                               19850020
184900        SET PS-ERROR         TO TRUE                              19860020
185000        SET DP020-MSG-FATAL  TO TRUE                              19870020
185100        MOVE DP015-RED       TO ASTRZNEC                          19880020
185200        MOVE DP015-REVERSE   TO ASTRZNEH                          19890020
185300        MOVE PC-TSYMSG-01682 TO DP020-MSG-NUMBER                  19900020
185400        MOVE -1              TO ASTRZNEL                          19910020
185500     ELSE                                                         19920020
185600        MOVE ASC-SCRN-STR-ZN-ID  TO STRZN-STR-ZN-ID               19930020
185700                                                                  19940020
185800         EXEC SQL                                                 19950020
185900             SELECT STR_ZN_DESC                                   19960020
186000             INTO :STRZN-STR-ZN-DESC                              19970020
186100             FROM TSTRZN                                          19980020
186200             WHERE STR_ZN_ID   = :STRZN-STR-ZN-ID                 19990020
186300         END-EXEC                                                 20000020
186400                                                                  20010020
186500         EVALUATE TRUE                                            20020020
186600             WHEN SQLCODE = ZERO                                  20030020
186700                 MOVE STRZN-STR-ZN-DESC                           20040020
186800                        TO  ASC-ORIG-STR-ZN-DESC                  20050020
186900             WHEN SQLCODE = -904                                  20060020
187000             WHEN SQLCODE = -913                                  20070020
187100                  CONTINUE                                        20080020
187200             WHEN SQLCODE = +100                                  20090020
187300                 SET PS-ERROR         TO TRUE                     20100020
187400                 SET DP020-MSG-FATAL  TO TRUE                     20110020
187500                 MOVE DP015-RED       TO ASTRZNEC                 20120020
187600                 MOVE DP015-REVERSE   TO ASTRZNEH                 20130020
187700                 MOVE PC-TSYMSG-01679 TO DP020-MSG-NUMBER         20140020
187800                 MOVE -1              TO ASTRZNEL                 20150020
187900             WHEN SQLWARN0 NOT = SPACES                           20160020
188000             WHEN SQLCODE < 0                                     20170020
188100             WHEN SQLCODE > 0                                     20180020
188200                 STRING ' STORE ZONE' DK-MDSEBG-NBR               20190020
188300                        DELIMITED BY SIZE                         20200020
188400                        INTO DP013-MESSAGE-TEXT(2)                20210020
188500                 MOVE SQLCA TO DP013-SQLCA                        20220020
188600                 MOVE '3470-VALIDATE-STR-ZN' TO                   20230020
188700                     DP013-PARAGRAPH                              20240020
188800                 MOVE 'TSTRZN ' TO DP013-DB2-TABLE-NAME(2)        20250020
188900                 SET DP013-DB2-ABEND TO TRUE                      20260020
189000                 SET DP013-NO-ROLLBACK TO TRUE                    20270020
189100                 SET DP013-XCTL-DISPLAY-RESTART TO TRUE           20280020
189200                 PERFORM DP013-0000-PROCESS-ABEND                 20290020
189300         END-EVALUATE                                             20300020
189400     END-IF.                                                      20310020
189500                                                                  20320020
189600***                                                               20330020
189700                                                                  20340020
189800 EJECT                                                            20350020
189900                                                                  20360020
190000 3475-VALIDATE-AR-DESC.                                           20370020
190100******************************************************************20380020
190200*                                                                 20390020
190300******************************************************************20400020
190400                                                                  20410020
190500     IF ASC-SCRN-AR-DESCRIPTION = SPACES                          20420020
190600        SET PS-ERROR         TO TRUE                              20430020
190700        SET DP020-MSG-FATAL  TO TRUE                              20440020
190800        MOVE DP015-RED       TO AARDESCC                          20450020
190900        MOVE DP015-REVERSE   TO AARDESCH                          20460020
191000        MOVE PC-TSYMSG-00007 TO DP020-MSG-NUMBER                  20470020
191100        MOVE -1              TO AARDESCL                          20480020
191200     END-IF.                                                      20490020
191300                                                                  20500020
191400 4000-PREPARE-TSQ.                                                20510020
191500******************************************************************20520020
191600*                                                                 20530020
191700******************************************************************20540020
191800     MOVE 1 TO ASC-TSQ-ITEM-NBR.                                  20550020
191900     PERFORM 9050-READ-TSQ.                                       20560020
192000                                                                  20570020
192100     MOVE PV-DEPT-ADD-QUEUE    TO MB104-MDSEAR-ADD-TSQUEUE.       20580020
192200     MOVE ASC-SCRN-BUS-GROUP   TO MB104-BUS-GROUP.                20590020
192300     MOVE ASC-SCRN-DISCNT-CD   TO MB104-DEPT-DISCOUNT.            20600020
192400     MOVE ASC-SCRN-AR-DESCRIPTION                                 20610020
192500                               TO MB104-AR-DESCRIP.               20620020
192600     MOVE ASC-SCRN-CONSIGN-IND TO MB104-CONSIGN-IND.              20630020
192700     MOVE ASC-SCRN-DAYS-BEF-SHIP-NBR                              20640020
192800                               TO MB104-DAYS-BEF-SHIP-NBR.        20650020
192900     MOVE ASC-SCRN-DAYS-AFT-CLR-NBR                               20660020
193000                               TO MB104-DAYS-AFT-CLR-NBR.         20670020
193100     MOVE ASC-SCRN-SKU-LVL-UPD-IND                                20680020
193200                               TO MB104-SKU-LVL-UPD-IND.          20690020
193300     MOVE ASC-FREIGHT-PERCENT  TO MB104-FREIGHT-PERCENT.          20700020
C14666     MOVE ASC-SHRINK-PERCENT   TO MB104-BM-SHRINK-PERCENT.        20710033
C14666     MOVE ASC-ECOM-SHRINK-PERCENT                                 20720033
C14666                               TO MB104-ECOM-SHRINK-PERCENT.      20730033
193500     MOVE ASC-SCRN-STR-ZN-ID   TO MB104-STR-ZN-ID.                20740020
193600     MOVE ASC-CAL-MN-NBR       TO MB104-CAL-MN-NBR.               20750020
193700     MOVE ASC-SHRINK-YR-NBR    TO MB104-SHNK-FSCL-YR-NBR.         20760020
193800                                                                  20770020
193900     INITIALIZE PV-TSQ-TEMP-LAYOUT.                               20780020
194000     MOVE MB104-MDSEAR-ADD-TSQUEUE TO PV-DEPT-ADD-QUEUE.          20790020
194100     PERFORM 9075-REWRITE-TSQ.                                    20800020
194200                                                                  20810020
194300 4100-SAVE-INITIAL-INTERAPPL.                                     20820020
194400                                                                  20830020
194500******************************************************************20840020
194600*    SAVE THE INTER-APPLICATION COMMAREA ON THE FIRST CYCLE       20850020
194700*    OF THIS TRANSACTION.                                         20860020
194800******************************************************************20870020
194900     IF (DP020-MB-MERCH-DEPT-SELECT) OR                           20880020
195000        (DP020-MB-MERCH-DEPT-LIST)                                20890020
195100        SET ASC-DEPT-MAINT TO TRUE                                20900020
195200        SET PS-INTER-APPL-VALID        TO TRUE                    20910020
195300        MOVE MB005-LIST-QUEUE-NAME     TO ASC-TEMP-QUEUE-NAME     20920020
195400        MOVE MB005-CO-NUMBER           TO ASC-COMPANY-NO          20930020
195500     ELSE                                                         20940020
195600       IF (DP020-MB-MERCH-AREA-ADD)                               20950020
195700          SET ASC-DEPT-ADD TO TRUE                                20960020
195800          SET PS-INTER-APPL-VALID      TO TRUE                    20970020
195900          MOVE MB005-LIST-QUEUE-NAME   TO ASC-TEMP-QUEUE-NAME     20980020
196000          MOVE MB005-CO-NUMBER           TO ASC-COMPANY-NO        20990020
196100       ELSE                                                       21000020
196200          MOVE PC-TSYMSG-99901 TO DP020-MSG-NUMBER                21010020
196300          SET DP020-MSG-FATAL  TO TRUE                            21020020
196400          SET PS-INTER-APPL-INVALID TO TRUE                       21030020
196500          MOVE -1 TO ANAVCMDL                                     21040020
196600       END-IF                                                     21050020
196700     END-IF.                                                      21060020
196800                                                                  21070020
196900 EJECT                                                            21080020
197000                                                                  21090020
197100 4200-UPDATE-INITIAL-INTERAPPL.                                   21100020
197200                                                                  21110020
197300******************************************************************21120020
197400*                                                                 21130020
197500******************************************************************21140020
197600 EJECT                                                            21150020
197700                                                                  21160020
197800 4300-SETUP-INTER-APPL-COMM.                                      21170020
197900                                                                  21180020
198000******************************************************************21190020
198100*                                                                 21200020
198200******************************************************************21210020
198300                                                                  21220020
198400     SET DP020-MB-MERCH-DEPT-MAINT TO TRUE                        21230020
198500     COMPUTE MB005-NUMBER-PROCESSED-ITEMS =                       21240020
198600        ((ASC-TSQ-ITEM-NBR - 1) * ASC-MAX-ITEMS) +                21250020
198700          ASC-SEL-IDX.                                            21260020
198800     MOVE ASC-TEMP-QUEUE-NAME   TO MB005-LIST-QUEUE-NAME.         21270020
198900     MOVE ASC-COMPANY-NO        TO MB005-CO-NUMBER.               21280020
199000     MOVE 'DPT'                 TO MB005-MDSEAR-LEVEL.            21290020
199100                                                                  21300020
199200 EJECT                                                            21310020
199300                                                                  21320020
199400 4500-DETERMINE-UPDATE.                                           21330020
199500                                                                  21340020
199600******************************************************************21350020
199700*                                                                 21360020
199800******************************************************************21370020
199900                                                                  21380020
200000     MOVE ASC-COMPANY-NO    TO DK-OPERCO-NBR.                     21390020
200100     MOVE ASC-GMA-NO        TO DK-GMA-NBR.                        21400020
200200     MOVE ASC-DMA-NO        TO DK-DMA-NBR.                        21410020
200300     MOVE ASC-DPT-NO        TO DK-DEPT-NBR.                       21420020
200400     MOVE '000'             TO DK-MAJ-CL-NBR                      21430020
200500                               DK-SUB-CL-NBR.                     21440020
200600     MOVE PC-DEPT-LEVEL-CD  TO DK-MDSELV-CDE.                     21450020
200700                                                                  21460020
200800     MOVE ASC-MDSEAR-DKEY TO DK-MDSEAR-DKEY.                      21470020
200900     PERFORM 2300-RETRIEVE-FOR-UPDATE.                            21480020
201000                                                                  21490020
201100     IF (ASC-ORIG-BUS-GROUP       = ASC-SCRN-BUS-GROUP)       AND 21500020
201200        (ASC-ORIG-DISCNT-CD       = ASC-SCRN-DISCNT-CD)       AND 21510020
201300        (ASC-ORIG-AR-DESCRIPTION  = ASC-SCRN-AR-DESCRIPTION)  AND 21520020
201400        (ASC-ORIG-CONSIGN-IND     = ASC-SCRN-CONSIGN-IND)     AND 21530020
201500        (ASC-ORIG-DAYS-BEF-SHIP-NBR =                             21540020
201600                                 ASC-SCRN-DAYS-BEF-SHIP-NBR)  AND 21550020
201700        (ASC-ORIG-DAYS-AFT-CLR-NBR =                              21560020
201800                                 ASC-SCRN-DAYS-AFT-CLR-NBR)   AND 21570020
201900        (ASC-ORIG-SKU-LVL-UPD-IND = ASC-SCRN-SKU-LVL-UPD-IND) AND 21580020
202000        (ASC-ORIG-PLAN-FRGT-PCTN  = ASC-SCRN-PLAN-FRGT-PCTN)  AND 21590020
202100        (ASC-ORIG-SHRINK-PCT      = ASC-SHRINK-PERCENT)       AND 21600020
C14666        (ASC-ORIG-ECOM-SHRINK-PCT = ASC-ECOM-SHRINK-PERCENT)  AND 21610033
C14666*       (ASC-ORIG-SHRINK-FIS-PER  = ASC-SCRN-SHRINK-FIS-PER)  AND 21620063
202300        (ASC-ORIG-STR-ZN-ID       = ASC-SCRN-STR-ZN-ID)           21630020
202400         SET PS-ERROR     TO TRUE                                 21640020
202500         SET DP020-MSG-FATAL TO TRUE                              21650020
202600         MOVE PC-TSYMSG-00046 TO DP020-MSG-NUMBER                 21660020
202700         MOVE -1 TO ANAVCMDL                                      21670020
202800     ELSE                                                         21680020
202900         PERFORM DP017-0000-GET-CURR-DATE-TIME                    21690020
203000         MOVE DP017-CURRENT-DATE-YMD TO ASC-DEPT-LST-CHG-DT       21700020
203100         MOVE ASC-DP-CHG-MM    TO PV-CHANGE-MM                    21710020
203200         MOVE ASC-DP-CHG-YY    TO PV-CHANGE-YY                    21720020
203300         MOVE ASC-DP-CHG-DD    TO PV-CHANGE-DD                    21730020
203400         IF PV-CHANGE-YY > PC-CENTURY-CUTOFF                      21740020
203500            MOVE 19 TO PV-CHANGE-CENT                             21750020
203600         ELSE                                                     21760020
203700            MOVE 20 TO PV-CHANGE-CENT                             21770020
203800         END-IF                                                   21780020
203900                                                                  21790020
204000         MOVE PV-CHANGE-DATE TO MDSEDP-CHG-DTE                    21800020
204100                                                                  21810020
204200         IF (ASC-ORIG-DISCNT-CD NOT = ASC-SCRN-DISCNT-CD) OR      21820020
204300            (ASC-ORIG-AR-DESCRIPTION NOT =                        21830020
204400                      ASC-SCRN-AR-DESCRIPTION)                    21840020
204500             MOVE DP017-CURRENT-DATE-YMD TO ASC-AR-CHANGE-DATE    21850020
204600         END-IF                                                   21860020
204700                                                                  21870020
204800         MOVE ASC-AR-CHG-MM  TO PV-CHANGE-MM                      21880020
204900         MOVE ASC-AR-CHG-DD  TO PV-CHANGE-DD                      21890020
205000         MOVE ASC-AR-CHG-YY  TO PV-CHANGE-YY                      21900020
205100         IF PV-CHANGE-YY > PC-CENTURY-CUTOFF                      21910020
205200            MOVE 19 TO PV-CHANGE-CENT                             21920020
205300         ELSE                                                     21930020
205400            MOVE 20 TO PV-CHANGE-CENT                             21940020
205500         END-IF                                                   21950020
205600                                                                  21960020
205700         MOVE PV-CHANGE-DATE TO MDSEDP-ARDEPT-CHG-DTE             21970020
205800                                                                  21980020
205900         MOVE ASC-SCRN-BUS-GROUP TO MDSEDP-MDSEBG-NBR             21990020
206000                                    ASC-ORIG-BUS-GROUP            22000020
206100         MOVE ASC-SCRN-DISCNT-CD TO MDSEDP-DPTDIS-CDE             22010020
206200                                    ASC-ORIG-DISCNT-CD            22020020
206300         MOVE ASC-SCRN-AR-DESCRIPTION TO MDSEDP-ARDEPT-DESC       22030020
206400                                    ASC-ORIG-AR-DESCRIPTION       22040020
206500         MOVE ASC-SCRN-CONSIGN-IND TO MDSEDP-CONS-IND             22050020
206600                                    ASC-ORIG-CONSIGN-IND          22060020
206700         MOVE ASC-SCRN-DAYS-BEF-SHIP-NBR                          22070020
206800                                   TO MDSEDP-DAYS-BEF-SHIP-NBR    22080020
206900                                      ASC-ORIG-DAYS-BEF-SHIP-NBR  22090020
207000         MOVE ASC-SCRN-DAYS-AFT-CLR-NBR                           22100020
207100                                   TO MDSEDP-DAYS-AFT-CLR-NBR     22110020
207200                                      ASC-ORIG-DAYS-AFT-CLR-NBR   22120020
207300         MOVE ASC-SCRN-SKU-LVL-UPD-IND                            22130020
207400                                   TO MDSEDP-SKU-LVL-UPD-IND      22140020
207500                                    ASC-ORIG-SKU-LVL-UPD-IND      22150020
207600         MOVE ASC-SCRN-PLAN-FRGT-PCTX2                            22160020
207700                                   TO ASC-SCRN-PLAN-FRGT-PCT      22170020
207800         MOVE ASC-SCRN-PLAN-FRGT-PCTN                             22180020
207900                                   TO MDSEDP-PLAN-FRGT-PCT        22190020
208000         MOVE ASC-SCRN-PLAN-FRGT-PCTN2                            22200020
208100                                   TO PV-DISPLAY-PLAN-FRGT-PCT    22210020
208200         MOVE PV-DISPLAY-PLAN-FRGT-PCT                            22220020
208300                                   TO ASC-SCRN-PLAN-FRGT-PCT      22230020
208400                                      ASC-ORIG-PLAN-FRGT-PCT      22240020
208500         MOVE ASC-SCRN-STR-ZN-ID   TO MDSEDP-STR-ZN-ID            22250020
208600                                                                  22260020
208700****     PERFORM 9300-UPDATE-DEPARTMENT                           22270023
C14666         IF ASC-SHRINK-PERCENT NOT = ASC-ORIG-SHRINK-PCT          22280041
C14666*            OR ASC-SCRN-SHRINK-FIS-PER NOT =                     22290063
C14666*               ASC-ORIG-SHRINK-FIS-PER)                          22300063
C14666                    INITIALIZE DCLTDPTSHK                         22310033
C14666                    MOVE 'N'          TO DPTSHK-E-BUS-IND         22320033
209100                    PERFORM 9500-UPDATE-SHRINK-PCT                22330020
209200         END-IF                                                   22340020
C14666         IF ASC-ECOM-SHRINK-PERCENT NOT =                         22350041
C14666                ASC-ORIG-ECOM-SHRINK-PCT                          22360033
C14666                    INITIALIZE DCLTDPTSHK                         22370033
C14666                    MOVE 'Y'          TO DPTSHK-E-BUS-IND         22380033
C14666                    PERFORM 9500-UPDATE-SHRINK-PCT                22390033
C14666         END-IF                                                   22400033
209300         PERFORM 9900-COMMIT                                      22410020
209400         PERFORM 3300-MOVE-COMMAREA-TO-SCREEN                     22420020
209500         IF SQLCODE = +000                                        22430020
209600             MOVE PC-TSYMSG-00059  TO DP020-MSG-NUMBER            22440020
209700             SET DP020-MSG-INFORMATIONAL TO TRUE                  22450020
209800         END-IF                                                   22460020
209900     END-IF.                                                      22470020
210000                                                                  22480020
210100 9050-READ-TSQ.                                                   22490020
210200******************************************************************22500020
210300*    READ TEMPORARY STORAGE QUEUE                                 22510020
210400******************************************************************22520020
210500                                                                  22530020
210600     IF  ASC-DEPT-ADD                                             22540020
210700         MOVE LENGTH OF MB104-MDSEAR-ADD-TSQUEUE                  22550020
210800                               TO  ASC-TEMP-QUEUE-LENGTH          22560020
210900     ELSE                                                         22570020
211000         MOVE LENGTH OF PV-TSQ-TEMP-LAYOUT                        22580020
211100                               TO  ASC-TEMP-QUEUE-LENGTH          22590020
211200     END-IF.                                                      22600020
211300     MOVE ASC-TEMP-QUEUE-LENGTH TO MB005-LIST-QUEUE-LENGTH.       22610020
211400                                                                  22620020
211500     EXEC CICS                                                    22630020
211600         READQ TS                                                 22640020
211700         QUEUE(ASC-TEMP-QUEUE-NAME)                               22650020
211800         INTO (PV-TSQ-TEMP-LAYOUT)                                22660020
211900         LENGTH(ASC-TEMP-QUEUE-LENGTH)                            22670020
212000         ITEM(ASC-TSQ-ITEM-NBR)                                   22680020
212100         RESP(PV-CICS-RESPONSE)                                   22690020
212200     END-EXEC.                                                    22700020
212300                                                                  22710020
212400     IF PV-CICS-RESPONSE =  DFHRESP(QZERO)                        22720020
212500        IF ASC-DEPT-ADD                                           22730020
212600            SET DP013-LOGIC-ABEND  TO TRUE                        22740020
212700            SET DP013-NO-ROLLBACK  TO TRUE                        22750020
212800            MOVE '9050-READ-TSQ'   TO DP013-PARAGRAPH             22760020
212900            MOVE 'RECEIVED ERROR MESSAGE WHILE READING TSQ' TO    22770020
213000                                      DP013-MESSAGE-TEXT(1)       22780020
213100            PERFORM DP013-0000-PROCESS-ABEND                      22790020
213200        ELSE                                                      22800020
213300            SET PS-EMPTY-QUEUE TO TRUE                            22810020
213400        END-IF                                                    22820020
213500     ELSE                                                         22830020
213600         IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                22840020
213700            SET DP013-LOGIC-ABEND  TO TRUE                        22850020
213800            SET DP013-NO-ROLLBACK  TO TRUE                        22860020
213900            MOVE '9050-READ-TSQ'   TO DP013-PARAGRAPH             22870020
214000            MOVE 'RECEIVED ERROR MESSAGE WHILE READING TSQ' TO    22880020
214100                                      DP013-MESSAGE-TEXT(1)       22890020
214200            PERFORM DP013-0000-PROCESS-ABEND                      22900020
214300         END-IF                                                   22910020
214400     END-IF.                                                      22920020
214500 EJECT                                                            22930020
214600                                                                  22940020
214700 9075-REWRITE-TSQ.                                                22950020
214800******************************************************************22960020
214900*    REWRITE TSQ                                                  22970020
215000******************************************************************22980020
215100     MOVE LENGTH OF MB104-MDSEAR-ADD-TSQUEUE                      22990020
215200                               TO  ASC-TEMP-QUEUE-LENGTH.         23000020
215300     EXEC CICS                                                    23010020
215400         WRITEQ TS                                                23020020
215500         QUEUE(ASC-TEMP-QUEUE-NAME)                               23030020
215600         FROM (PV-DEPT-ADD-QUEUE)                                 23040020
215700         LENGTH(ASC-TEMP-QUEUE-LENGTH)                            23050020
215800         ITEM(ASC-TSQ-ITEM-NBR) REWRITE                           23060020
215900         RESP(PV-CICS-RESPONSE)                                   23070020
216000     END-EXEC.                                                    23080020
216100     IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                    23090020
216200        SET DP013-LOGIC-ABEND  TO TRUE                            23100020
216300        SET DP013-NO-ROLLBACK  TO TRUE                            23110020
216400        MOVE '9075-REWRITE-TSQ'   TO DP013-PARAGRAPH              23120020
216500        MOVE 'RECEIVED ERROR MESSAGE WHILE REWRITING TSQ' TO      23130020
216600                                  DP013-MESSAGE-TEXT(1)           23140020
216700        PERFORM DP013-0000-PROCESS-ABEND                          23150020
216800     END-IF.                                                      23160020
216900 EJECT                                                            23170020
217000 9100-RETURN-TO-PREV-TRAN.                                        23180020
217100******************************************************************23190020
217200*                                                                 23200020
217300******************************************************************23210020
217400     MOVE DP016-PF3  TO DP020-SRC-AID.                            23220020
217500     PERFORM DP015-1000-START-NAVIGATOR.                          23230020
217600                                                                  23240020
217700 9200-GET-BUS-GROUP.                                              23250020
217800******************************************************************23260020
217900*                                                                 23270020
218000******************************************************************23280020
218100                                                                  23290020
218200     PERFORM WITH TEST AFTER                                      23300020
218300         VARYING PV-RETRY-COUNTER                                 23310020
218400         FROM 1 BY 1                                              23320020
218500         UNTIL (( PV-RETRY-COUNTER > PC-MAX-RETRIES)              23330020
218600                 OR (SQLCODE = 0)                                 23340020
218700                 OR (SQLCODE = +100))                             23350020
218800                                                                  23360020
218900                                                                  23370020
219000         EXEC SQL                                                 23380020
219100             SELECT MDSEBG_NBR,                                   23390020
219200                    MDSEBG_DESC                                   23400020
C14666             INTO :MDSEBG-MDSEBG-NBR,                             23410027
C14666                  :MDSEBG-MDSEBG-DESC                             23420027
219500             FROM TMDSEBG                                         23430020
219600             WHERE (MDSEBG_NBR  = :DK-MDSEBG-NBR)                 23440020
219700         END-EXEC                                                 23450020
219800                                                                  23460020
219900         EVALUATE TRUE                                            23470020
220000             WHEN SQLCODE = ZERO                                  23480020
220100                 SET PS-ROW-FOUND TO TRUE                         23490020
220200             WHEN SQLCODE = -904                                  23500020
220300             WHEN SQLCODE = -913                                  23510020
220400                  CONTINUE                                        23520020
220500             WHEN SQLCODE = +100                                  23530020
220600                 SET PS-ROW-NOT-FOUND TO TRUE                     23540020
220700             WHEN SQLWARN0 NOT = SPACES                           23550020
220800             WHEN SQLCODE < 0                                     23560020
220900             WHEN SQLCODE > 0                                     23570020
221000                 STRING ' BUS GROUP ' DK-MDSEBG-NBR               23580020
221100                        DELIMITED BY SIZE                         23590020
221200                        INTO DP013-MESSAGE-TEXT(2)                23600020
221300                 MOVE SQLCA TO DP013-SQLCA                        23610020
221400                 MOVE '9200-GET-BUS-GROUP' TO                     23620020
221500                     DP013-PARAGRAPH                              23630020
221600                 MOVE 'TMDSEBG' TO DP013-DB2-TABLE-NAME(2)        23640020
221700                 SET DP013-DB2-ABEND TO TRUE                      23650020
221800                 SET DP013-NO-ROLLBACK TO TRUE                    23660020
221900                 SET DP013-XCTL-DISPLAY-RESTART TO TRUE           23670020
222000                 PERFORM DP013-0000-PROCESS-ABEND                 23680020
222100         END-EVALUATE                                             23690020
222200     END-PERFORM.                                                 23700020
222300                                                                  23710020
222400                                                                  23720020
222500     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         23730020
222600         MOVE '9200-GET-BUS-GROUP' TO                             23740020
222700                                     DP013-PARAGRAPH              23750020
222800         STRING ' BUS GROUP ' DK-MDSEBG-NBR                       23760020
222900               DELIMITED BY SIZE                                  23770020
223000               INTO DP013-MESSAGE-TEXT(1)                         23780020
223100         MOVE 'MAX NUMBER OF RETRIES EXCEEDED' TO                 23790020
223200                                     DP013-MESSAGE-TEXT(2)        23800020
223300         MOVE SQLCA TO DP013-SQLCA                                23810020
223400         MOVE 'TMDSEBG' TO DP013-DB2-TABLE-NAME(1)                23820020
223500         SET DP013-DB2-ABEND                                      23830020
223600             DP013-NO-ROLLBACK                                    23840020
223700             DP013-XCTL-DISPLAY-RESTART TO TRUE                   23850020
223800         PERFORM DP013-0000-PROCESS-ABEND                         23860020
223900     END-IF.                                                      23870020
224000                                                                  23880020
224100                                                                  23890020
224200 EJECT                                                            23900020
224300                                                                  23910020
224400 9250-GET-DISCOUNT-CODE.                                          23920020
224500******************************************************************23930020
224600*                                                                 23940020
224700******************************************************************23950020
224800                                                                  23960020
224900     PERFORM WITH TEST AFTER                                      23970020
225000         VARYING PV-RETRY-COUNTER                                 23980020
225100         FROM 1 BY 1                                              23990020
225200         UNTIL (( PV-RETRY-COUNTER > PC-MAX-RETRIES)              24000020
225300                 OR (SQLCODE = 0)                                 24010020
225400                 OR (SQLCODE = +100))                             24020020
225500                                                                  24030020
225600                                                                  24040020
225700         EXEC SQL                                                 24050020
225800             SELECT DPTDIS_CDE                                    24060020
225900             INTO :DPTDIS-CDE                                     24070020
226000             FROM   TDPTDIS                                       24080020
226100             WHERE (DPTDIS_CDE  = :DK-DPTDIS-CDE)                 24090020
226200         END-EXEC                                                 24100020
226300                                                                  24110020
226400         EVALUATE TRUE                                            24120020
226500             WHEN SQLCODE = ZERO                                  24130020
226600                 SET PS-ROW-FOUND TO TRUE                         24140020
226700             WHEN SQLCODE = -904                                  24150020
226800             WHEN SQLCODE = -913                                  24160020
226900                  CONTINUE                                        24170020
227000             WHEN SQLCODE = +100                                  24180020
227100                 SET PS-ROW-NOT-FOUND TO TRUE                     24190020
227200             WHEN SQLWARN0 NOT = SPACES                           24200020
227300             WHEN SQLCODE < 0                                     24210020
227400             WHEN SQLCODE > 0                                     24220020
227500                 STRING ' DEPT DIS CODE ' DK-DPTDIS-CDE           24230020
227600                        DELIMITED BY SIZE                         24240020
227700                        INTO DP013-MESSAGE-TEXT(2)                24250020
227800                 MOVE SQLCA TO DP013-SQLCA                        24260020
227900                 MOVE '9250-GET-DISCOUNT-CODE' TO                 24270020
228000                     DP013-PARAGRAPH                              24280020
228100                 MOVE 'TDPTDIS' TO DP013-DB2-TABLE-NAME(2)        24290020
228200                 SET DP013-DB2-ABEND TO TRUE                      24300020
228300                 SET DP013-NO-ROLLBACK TO TRUE                    24310020
228400                 SET DP013-XCTL-DISPLAY-RESTART TO TRUE           24320020
228500                 PERFORM DP013-0000-PROCESS-ABEND                 24330020
228600         END-EVALUATE                                             24340020
228700     END-PERFORM.                                                 24350020
228800                                                                  24360020
228900                                                                  24370020
229000     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         24380020
229100         MOVE '9250-GET-DISCOUNT-CODE' TO                         24390020
229200                                     DP013-PARAGRAPH              24400020
229300         STRING ' DEPT DIS CODE ' DK-DPTDIS-CDE                   24410020
229400                DELIMITED BY SIZE                                 24420020
229500                                INTO DP013-MESSAGE-TEXT(1)        24430020
229600         MOVE 'MAX NUMBER OF RETRIES EXCEEDED' TO                 24440020
229700                                     DP013-MESSAGE-TEXT(2)        24450020
229800         MOVE SQLCA TO DP013-SQLCA                                24460020
229900         MOVE 'TDPTDIS' TO DP013-DB2-TABLE-NAME(1)                24470020
230000         SET DP013-DB2-ABEND                                      24480020
230100             DP013-NO-ROLLBACK                                    24490020
230200             DP013-XCTL-DISPLAY-RESTART TO TRUE                   24500020
230300         PERFORM DP013-0000-PROCESS-ABEND                         24510020
230400     END-IF.                                                      24520020
230500                                                                  24530020
230600                                                                  24540020
230700 EJECT                                                            24550020
230800 9300-UPDATE-DEPARTMENT.                                          24560020
230900                                                                  24570020
231000******************************************************************24580020
231100*                                                                 24590020
231200******************************************************************24600020
231300                                                                  24610020
231400     PERFORM WITH TEST AFTER                                      24620020
231500         VARYING PV-RETRY-COUNTER                                 24630020
231600         FROM 1 BY 1                                              24640020
231700         UNTIL (( PV-RETRY-COUNTER > PC-MAX-RETRIES)              24650020
231800                 OR (SQLCODE = 0)                                 24660020
231900                 OR (SQLCODE = +100))                             24670020
232000                                                                  24680020
232100         EXEC SQL                                                 24690020
232200             UPDATE TMDSEDP                                       24700020
232300                SET MDSEBG_NBR      = :MDSEDP-MDSEBG-NBR,         24710020
232400                    DPTDIS_CDE      = :MDSEDP-DPTDIS-CDE,         24720020
232500                    CONS_IND        = :MDSEDP-CONS-IND,           24730020
232600                    ARDEPT_CHG_DTE  = :MDSEDP-ARDEPT-CHG-DTE,     24740020
232700                    CHG_DTE         = :MDSEDP-CHG-DTE,            24750020
232800                    ARDEPT_DESC     = :MDSEDP-ARDEPT-DESC,        24760020
232900                    PLAN_FRGT_PCT   = :MDSEDP-PLAN-FRGT-PCT,      24770020
233000                    SKU_LVL_UPD_IND = :MDSEDP-SKU-LVL-UPD-IND,    24780020
233100                    DAYS_BEF_SHIP_NBR =                           24790020
233200                                      :MDSEDP-DAYS-BEF-SHIP-NBR,  24800020
233300                    DAYS_AFT_CLR_NBR =                            24810020
233400                                      :MDSEDP-DAYS-AFT-CLR-NBR,   24820020
233500                    STR_ZN_ID       = :MDSEDP-STR-ZN-ID           24830020
233600                WHERE (MDSEAR_DKEY  = :DK-MDSEAR-DKEY)            24840020
233700         END-EXEC                                                 24850020
233800                                                                  24860020
233900         EVALUATE TRUE                                            24870020
234000             WHEN SQLCODE = ZERO                                  24880020
234100                 SET PS-ROW-FOUND TO TRUE                         24890020
234200             WHEN SQLCODE = -904                                  24900020
234300             WHEN SQLCODE = -913                                  24910020
234400                 CONTINUE                                         24920020
234500             WHEN SQLWARN0 NOT = SPACES                           24930020
234600             WHEN SQLCODE < 0                                     24940020
234700             WHEN SQLCODE > 0                                     24950020
234800                 MOVE 'UPDATE TO DEPARTMENT DATABASE FAILED'      24960020
234900                          TO DP013-MESSAGE-TEXT(1)                24970020
235000                 MOVE SQLCA TO DP013-SQLCA                        24980020
235100                 MOVE '9300-UPDATE-DEPARTMENT' TO                 24990020
235200                     DP013-PARAGRAPH                              25000020
235300                 MOVE 'TMDSEDP' TO DP013-DB2-TABLE-NAME(1)        25010020
235400                 SET DP013-DB2-ABEND TO TRUE                      25020020
235500                 SET DP013-NO-ROLLBACK TO TRUE                    25030020
235600                 SET DP013-XCTL-DISPLAY-RESTART TO TRUE           25040020
235700                 PERFORM DP013-0000-PROCESS-ABEND                 25050020
235800         END-EVALUATE                                             25060020
235900     END-PERFORM.                                                 25070020
236000                                                                  25080020
236100     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         25090020
236200         MOVE '9300-UPDATE-DEPARTMENT' TO                         25100020
236300                                     DP013-PARAGRAPH              25110020
236400         STRING 'UPDATE EXCEEDED MAX RETRIES'                     25120020
236500                DELIMITED BY SIZE                                 25130020
236600                                INTO DP013-MESSAGE-TEXT(1)        25140020
236700         MOVE 'MAX NUMBER OF RETRIES EXCEEDED' TO                 25150020
236800                                     DP013-MESSAGE-TEXT(2)        25160020
236900         MOVE SQLCA TO DP013-SQLCA                                25170020
237000         MOVE 'TMDSEDP' TO DP013-DB2-TABLE-NAME(1)                25180020
237100         SET DP013-DB2-ABEND                                      25190020
237200             DP013-ROLLBACK                                       25200020
237300             DP013-XCTL-DISPLAY-RESTART TO TRUE                   25210020
237400         PERFORM DP013-0000-PROCESS-ABEND                         25220020
237500     END-IF.                                                      25230020
237600                                                                  25240020
237700 9400-GET-MDSEAR.                                                 25250020
237800                                                                  25260020
237900******************************************************************25270020
238000*                                                                 25280020
238100******************************************************************25290020
238200                                                                  25300020
238300     PERFORM WITH TEST AFTER                                      25310020
238400         VARYING PV-RETRY-COUNTER                                 25320020
238500         FROM 1 BY 1                                              25330020
238600         UNTIL (( PV-RETRY-COUNTER > PC-MAX-RETRIES)              25340020
238700                 OR (SQLCODE = 0)                                 25350020
238800                 OR (SQLCODE = +100))                             25360020
238900                                                                  25370020
239000                                                                  25380020
239100         EXEC SQL                                                 25390020
239200             SELECT GMA_NBR,                                      25400020
239300                    DMA_NBR,                                      25410020
239400                    DEPT_NBR,                                     25420020
239500                    MDSEAR_DESC                                   25430020
239600             INTO :MDSEAR-GMA-NBR,                                25440020
239700                  :MDSEAR-DMA-NBR,                                25450020
239800                  :MDSEAR-DEPT-NBR,                               25460020
239900                  :MDSEAR-DESC                                    25470020
240000             FROM   TMDSEAR                                       25480020
240100             WHERE ((OPERCO_NBR    = :DK-OPERCO-NBR) AND          25490020
240200                    (GMA_NBR       = :DK-GMA-NBR)    AND          25500020
240300                    (DMA_NBR       = :DK-DMA-NBR)    AND          25510020
240400                    (DEPT_NBR      = :DK-DEPT-NBR)   AND          25520020
240500                    (MAJ_CL_NBR    = :DK-MAJ-CL-NBR) AND          25530020
240600                    (SUB_CL_NBR    = :DK-SUB-CL-NBR) AND          25540020
240700                    (MDSELV_CDE    = :DK-MDSELV-CDE) AND          25550020
240800                    (END_DTE > DATE (CURRENT TIMESTAMP)))         25560020
240900         END-EXEC                                                 25570020
241000                                                                  25580020
241100         EVALUATE TRUE                                            25590020
241200             WHEN SQLCODE = ZERO                                  25600020
241300                 SET PS-ROW-FOUND TO TRUE                         25610020
241400             WHEN SQLCODE = -904                                  25620020
241500             WHEN SQLCODE = -913                                  25630020
241600                  CONTINUE                                        25640020
241700             WHEN SQLCODE = +100                                  25650020
241800             WHEN SQLWARN0 NOT = SPACES                           25660020
241900             WHEN SQLCODE < 0                                     25670020
242000             WHEN SQLCODE > 0                                     25680020
242100                 STRING ' GMA ' DK-GMA-NBR                        25690020
242200                        ' DMA ' DK-DMA-NBR                        25700020
242300                        ' DPT ' DK-DEPT-NBR                       25710020
242400                        ' MCL ' DK-MAJ-CL-NBR                     25720020
242500                        ' SCL ' DK-SUB-CL-NBR                     25730020
242600                        ' LEV=' DK-MDSELV-CDE                     25740020
242700                        ' DTE ' DK-END-DATE                       25750020
242800                        DELIMITED BY SIZE                         25760020
242900                        INTO DP013-MESSAGE-TEXT(1)                25770020
243000                 MOVE SQLCA TO DP013-SQLCA                        25780020
243100                 MOVE '9400-GET-MDSEAR' TO                        25790020
243200                     DP013-PARAGRAPH                              25800020
243300                 MOVE 'TMDSEAR' TO DP013-DB2-TABLE-NAME(1)        25810020
243400                 SET DP013-DB2-ABEND TO TRUE                      25820020
243500                 SET DP013-NO-ROLLBACK TO TRUE                    25830020
243600                 SET DP013-XCTL-DISPLAY-RESTART TO TRUE           25840020
243700                 PERFORM DP013-0000-PROCESS-ABEND                 25850020
243800         END-EVALUATE                                             25860020
243900     END-PERFORM.                                                 25870020
244000                                                                  25880020
244100                                                                  25890020
244200     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         25900020
244300         MOVE '9400-GET-MDSEAR' TO DP013-PARAGRAPH                25910020
244400         MOVE SQLCA TO DP013-SQLCA                                25920020
244500         STRING ' GMA ' DK-GMA-NBR                                25930020
244600                ' DMA ' DK-DMA-NBR                                25940020
244700                ' DPT ' DK-DEPT-NBR                               25950020
244800                ' MCL ' DK-MAJ-CL-NBR                             25960020
244900                ' SCL ' DK-SUB-CL-NBR                             25970020
245000                ' LEV=' DK-MDSELV-CDE                             25980020
245100                ' DTE ' DK-END-DATE                               25990020
245200                DELIMITED BY SIZE                                 26000020
245300                INTO DP013-MESSAGE-TEXT(1)                        26010020
245400         MOVE 'MAX NUMBER OF RETRIES EXCEEDED' TO                 26020020
245500                                     DP013-MESSAGE-TEXT(2)        26030020
245600         MOVE 'TMDSEAR' TO DP013-DB2-TABLE-NAME(1)                26040020
245700         SET DP013-DB2-ABEND                                      26050020
245800             DP013-NO-ROLLBACK                                    26060020
245900             DP013-XCTL-DISPLAY-RESTART TO TRUE                   26070020
246000         PERFORM DP013-0000-PROCESS-ABEND                         26080020
246100     END-IF.                                                      26090020
246200                                                                  26100020
246300/                                                                 26110020
246400 9500-UPDATE-SHRINK-PCT.                                          26120020
246500                                                                  26130020
246600******************************************************************26140020
246700*                                                                 26150020
246800*    DETERMINE WHETHER WE NEED TO UPDATE THE SHRINK PERCENT       26160020
246900*    OR INSERT A NEW ROW.                                         26170020
247000*                                                                 26180020
247100******************************************************************26190020
247200                                                                  26200020
C14666*    INITIALIZE DCLTDPTSHK.                                       26210063
247400     MOVE MDSEDP-MDSEAR-DKEY TO DPTSHK-MDSEAR-DKEY.               26220020
247500     MOVE ASC-SHRINK-YR-NBR  TO DPTSHK-SHRINK-YR-NBR.             26230020
247600                                                                  26240020
247700     PERFORM 9530-GET-SHRINK-ROW.                                 26250020
247800                                                                  26260020
247900     IF SQLCODE EQUAL ZERO                                        26270020
248000         SET ASC-UPDATE-SHRINK TO TRUE                            26280020
248100     ELSE                                                         26290020
248200         SET ASC-INSERT-SHRINK TO TRUE                            26300020
248300     END-IF.                                                      26310020
248400     MOVE DCLTDPTSHK TO ASC-SHRINK-WORK-AREA.                     26320020
248500                                                                  26330020
C14666     IF DPTSHK-E-BUS-IND = 'N'                                    26340038
C14666         MOVE ASC-SHRINK-PERCENT  TO ASC-TEMP-PCT                 26350038
C14666     ELSE                                                         26360038
C14666         MOVE ASC-ECOM-SHRINK-PERCENT                             26370038
C14666                                  TO ASC-TEMP-PCT                 26380038
C14666     END-IF.                                                      26390038
C14666                                                                  26400038
248600***  ALWAYS UPDATE SHRINK PERCENT FOR CALENDAR MONTH JANUARY      26410020
C14666     MOVE ASC-TEMP-PCT       TO  ASC-SHRINK-PCTN (1)              26420039
248800                                                                  26430020
248900***  ONLY UPDTE SHRINK PERCENT GOING FORWARD IF IT                26440020
249000***  IS NOT CALENDAR MONTH JANUARY (ASC-CAL-MN-NBR = 1)           26450020
249100     PERFORM VARYING PV-SUB                                       26460020
249200         FROM ASC-CAL-MN-NBR-N BY 1                               26470020
249300         UNTIL PV-SUB GREATER THAN 12                             26480020
249400            OR ASC-CAL-MN-NBR-N = 1                               26490020
249500                                                                  26500020
C14666         MOVE ASC-TEMP-PCT       TO  ASC-SHRINK-PCTN (PV-SUB)     26510039
249700                                                                  26520020
249800     END-PERFORM                                                  26530020
249900                                                                  26540020
250000     MOVE ASC-SHRINK-WORK-AREA TO  DCLTDPTSHK.                    26550020
C14666     MOVE DP020-USERID         TO  DPTSHK-LAST-UPD-BY-USR         26560038
250100                                                                  26570020
250200     IF  ASC-UPDATE-SHRINK                                        26580020
250300         PERFORM 9510-UPDATE-SHRINK                               26590020
250400     ELSE                                                         26600020
250500         PERFORM 9520-INSERT-SHRINK                               26610020
250600     END-IF.                                                      26620020
250700                                                                  26630020
C14666     IF DPTSHK-E-BUS-IND = 'N'                                    26640033
C14666         MOVE ASC-TEMP-PCT        TO ASC-ORIG-SHRINK-PCT          26650038
C14666         MOVE DP020-USERID        TO ASC-BM-LAST-CHG-USER         26660039
C14666         MOVE DP017-CURRENT-DATE-YYYYMMDD                         26670040
C14666                                  TO ASC-BM-LAST-CHG-DT           26680040
C14666     ELSE                                                         26690033
C14666         MOVE ASC-TEMP-PCT        TO ASC-ORIG-ECOM-SHRINK-PCT     26700038
C14666         MOVE DP020-USERID        TO ASC-ECOM-LAST-CHG-USER       26710039
C14666         MOVE DP017-CURRENT-DATE-YYYYMMDD                         26720040
C14666                                  TO ASC-ECOM-LAST-CHG-DT         26730040
C14666     END-IF.                                                      26740033
C14666*    MOVE ASC-SCRN-SHRINK-FIS-PER TO ASC-ORIG-SHRINK-FIS-PER.     26750063
251000                                                                  26760020
251100 9510-UPDATE-SHRINK.                                              26770020
251200                                                                  26780020
251300     PERFORM WITH TEST AFTER                                      26790020
251400         VARYING PV-RETRY-COUNTER                                 26800020
251500         FROM 1 BY 1                                              26810020
251600         UNTIL (( PV-RETRY-COUNTER > PC-MAX-RETRIES)              26820020
251700                 OR (SQLCODE = 0)                                 26830020
251800                 OR (SQLCODE = +100))                             26840020
251900                                                                  26850020
252000         EXEC SQL                                                 26860020
252100             UPDATE                                               26870020
252200                    TDPTSHK                                       26880020
252300                SET                                               26890020
252400                    CHG_TMST        =   CURRENT TIMESTAMP         26900020
252500                  , JAN_SHRINK_PCT  =  :DPTSHK-JAN-SHRINK-PCT     26910020
252600                  , FEB_SHRINK_PCT  =  :DPTSHK-FEB-SHRINK-PCT     26920020
252700                  , MAR_SHRINK_PCT  =  :DPTSHK-MAR-SHRINK-PCT     26930020
252800                  , APR_SHRINK_PCT  =  :DPTSHK-APR-SHRINK-PCT     26940020
252900                  , MAY_SHRINK_PCT  =  :DPTSHK-MAY-SHRINK-PCT     26950020
253000                  , JUN_SHRINK_PCT  =  :DPTSHK-JUN-SHRINK-PCT     26960020
253100                  , JUL_SHRINK_PCT  =  :DPTSHK-JUL-SHRINK-PCT     26970020
253200                  , AUG_SHRINK_PCT  =  :DPTSHK-AUG-SHRINK-PCT     26980020
253300                  , SEP_SHRINK_PCT  =  :DPTSHK-SEP-SHRINK-PCT     26990020
253400                  , OCT_SHRINK_PCT  =  :DPTSHK-OCT-SHRINK-PCT     27000020
253500                  , NOV_SHRINK_PCT  =  :DPTSHK-NOV-SHRINK-PCT     27010020
253600                  , DEC_SHRINK_PCT  =  :DPTSHK-DEC-SHRINK-PCT     27020020
C14666                  , SHNK_PCT_CHG_DTE =  CURRENT DATE              27030033
C14666                  , LAST_UPD_BY_USR  = :DPTSHK-LAST-UPD-BY-USR    27040033
253700              WHERE                                               27050020
253800                    MDSEAR_DKEY     =  :DK-MDSEAR-DKEY            27060020
253900                AND SHRINK_YR_NBR   =  :ASC-SHRINK-YR-NBR         27070020
C14666                AND E_BUS_IND       =  :DPTSHK-E-BUS-IND          27080033
254000         END-EXEC                                                 27090020
254100                                                                  27100020
254200         EVALUATE TRUE                                            27110020
254300             WHEN SQLCODE = ZERO                                  27120020
254400                 SET PS-ROW-FOUND TO TRUE                         27130020
254500             WHEN SQLCODE = -904                                  27140020
254600             WHEN SQLCODE = -913                                  27150020
254700                 CONTINUE                                         27160020
254800             WHEN SQLWARN0 NOT = SPACES                           27170020
254900             WHEN SQLCODE < 0                                     27180020
255000             WHEN SQLCODE > 0                                     27190020
255100                 MOVE 'UPDATE TO DEPARTMENT DATABASE FAILED'      27200020
255200                          TO DP013-MESSAGE-TEXT(1)                27210020
255300                 MOVE SQLCA TO DP013-SQLCA                        27220020
255400                 MOVE '9510-UPDATE-SHRINK' TO                     27230020
255500                     DP013-PARAGRAPH                              27240020
255600                 MOVE 'TDPTSHK' TO DP013-DB2-TABLE-NAME(1)        27250020
255700                 SET DP013-DB2-ABEND TO TRUE                      27260020
255800                 SET DP013-NO-ROLLBACK TO TRUE                    27270020
255900                 SET DP013-XCTL-DISPLAY-RESTART TO TRUE           27280020
256000                 PERFORM DP013-0000-PROCESS-ABEND                 27290020
256100         END-EVALUATE                                             27300020
256200     END-PERFORM.                                                 27310020
256300                                                                  27320020
256400     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         27330020
256500         MOVE '9510-UPDATE-SHRINK' TO                             27340020
256600                                     DP013-PARAGRAPH              27350020
256700         STRING 'UPDATE EXCEEDED MAX RETRIES'                     27360020
256800                DELIMITED BY SIZE                                 27370020
256900                                INTO DP013-MESSAGE-TEXT(1)        27380020
257000         MOVE 'MAX NUMBER OF RETRIES EXCEEDED' TO                 27390020
257100                                     DP013-MESSAGE-TEXT(2)        27400020
257200         MOVE SQLCA TO DP013-SQLCA                                27410020
257300         MOVE 'TMDSEDP' TO DP013-DB2-TABLE-NAME(1)                27420020
257400         SET DP013-DB2-ABEND                                      27430020
257500             DP013-ROLLBACK                                       27440020
257600             DP013-XCTL-DISPLAY-RESTART TO TRUE                   27450020
257700         PERFORM DP013-0000-PROCESS-ABEND                         27460020
257800     END-IF.                                                      27470020
257900                                                                  27480020
258000                                                                  27490020
258100 9520-INSERT-SHRINK.                                              27500020
258200                                                                  27510020
258300     PERFORM WITH TEST AFTER                                      27520020
258400         VARYING PV-RETRY-COUNTER                                 27530020
258500         FROM 1 BY 1                                              27540020
258600         UNTIL (( PV-RETRY-COUNTER > PC-MAX-RETRIES)              27550020
258700                 OR (SQLCODE = 0)                                 27560020
258800                 OR (SQLCODE = +100))                             27570020
258900                                                                  27580020
259000         EXEC SQL                                                 27590020
259100             INSERT INTO TDPTSHK                                  27600020
259200                (MDSEAR_DKEY                                      27610020
259300               , SHRINK_YR_NBR                                    27620020
259400               , CHG_TMST                                         27630020
259500               , JAN_SHRINK_PCT                                   27640020
259600               , FEB_SHRINK_PCT                                   27650020
259700               , MAR_SHRINK_PCT                                   27660020
259800               , APR_SHRINK_PCT                                   27670020
259900               , MAY_SHRINK_PCT                                   27680020
260000               , JUN_SHRINK_PCT                                   27690020
260100               , JUL_SHRINK_PCT                                   27700020
260200               , AUG_SHRINK_PCT                                   27710020
260300               , SEP_SHRINK_PCT                                   27720020
260400               , OCT_SHRINK_PCT                                   27730020
260500               , NOV_SHRINK_PCT                                   27740020
C14666               , DEC_SHRINK_PCT                                   27750033
C14666               , E_BUS_IND                                        27760033
C14666               , SHNK_PCT_CHG_DTE                                 27770033
C14666               , LAST_UPD_BY_USR)                                 27780033
260700             VALUES                                               27790020
260800                 (:DPTSHK-MDSEAR-DKEY                             27800020
260900               ,  :DPTSHK-SHRINK-YR-NBR                           27810020
261000               ,   CURRENT TIMESTAMP                              27820020
261100               ,  :DPTSHK-JAN-SHRINK-PCT                          27830020
261200               ,  :DPTSHK-FEB-SHRINK-PCT                          27840020
261300               ,  :DPTSHK-MAR-SHRINK-PCT                          27850020
261400               ,  :DPTSHK-APR-SHRINK-PCT                          27860020
261500               ,  :DPTSHK-MAY-SHRINK-PCT                          27870020
261600               ,  :DPTSHK-JUN-SHRINK-PCT                          27880020
261700               ,  :DPTSHK-JUL-SHRINK-PCT                          27890020
261800               ,  :DPTSHK-AUG-SHRINK-PCT                          27900020
261900               ,  :DPTSHK-SEP-SHRINK-PCT                          27910020
262000               ,  :DPTSHK-OCT-SHRINK-PCT                          27920020
262100               ,  :DPTSHK-NOV-SHRINK-PCT                          27930020
C14666               ,  :DPTSHK-DEC-SHRINK-PCT                          27940033
C14666               ,  :DPTSHK-E-BUS-IND                               27950033
C14666               ,   CURRENT DATE                                   27960033
C14666               ,  :DPTSHK-LAST-UPD-BY-USR)                        27970033
262300         END-EXEC                                                 27980020
262400                                                                  27990020
262500         EVALUATE TRUE                                            28000020
262600             WHEN SQLCODE = ZERO                                  28010020
262700                 SET PS-ROW-FOUND TO TRUE                         28020020
262800             WHEN SQLCODE = -904                                  28030020
262900             WHEN SQLCODE = -913                                  28040020
263000                  CONTINUE                                        28050020
263100             WHEN SQLWARN0 NOT = SPACES                           28060020
263200             WHEN SQLCODE < 0                                     28070020
263300             WHEN SQLCODE > 0                                     28080020
263400                 MOVE 'INSERT SHINK PERCENT ERROR'                28090020
263500                                     TO DP013-MESSAGE-TEXT(1)     28100020
263600                 MOVE SQLCA TO DP013-SQLCA                        28110020
263700                 MOVE '9520-INSERT-SHRINK'     TO                 28120020
263800                     DP013-PARAGRAPH                              28130020
263900                 MOVE 'TDPTSHK' TO DP013-DB2-TABLE-NAME(1)        28140020
264000                 SET DP013-DB2-ABEND TO TRUE                      28150020
264100                 SET DP013-ROLLBACK TO TRUE                       28160020
264200                 SET DP013-XCTL-DISPLAY-RESTART TO TRUE           28170020
264300                 PERFORM DP013-0000-PROCESS-ABEND                 28180020
264400         END-EVALUATE                                             28190020
264500     END-PERFORM.                                                 28200020
264600                                                                  28210020
264700                                                                  28220020
264800     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         28230020
264900         MOVE 'INSERT SHRINK PERCENT RETRIES EXCEEDED'            28240020
265000                             TO DP013-MESSAGE-TEXT(1)             28250020
265100         MOVE '9510-INSERT-SHRINK'     TO                         28260020
265200                                     DP013-PARAGRAPH              28270020
265300         MOVE 'MAX NUMBER OF RETRIES EXCEEDED' TO                 28280020
265400                                     DP013-MESSAGE-TEXT(2)        28290020
265500         MOVE SQLCA TO DP013-SQLCA                                28300020
265600         MOVE 'TDPTSHK' TO DP013-DB2-TABLE-NAME(1)                28310020
265700         SET DP013-DB2-ABEND                                      28320020
265800             DP013-ROLLBACK                                       28330020
265900             DP013-XCTL-DISPLAY-RESTART TO TRUE                   28340020
266000         PERFORM DP013-0000-PROCESS-ABEND                         28350020
266100     END-IF.                                                      28360020
266200 EJECT                                                            28370020
266300                                                                  28380020
266400 9530-GET-SHRINK-ROW.                                             28390020
266500                                                                  28400020
266600     PERFORM                                                      28410020
266700         WITH TEST AFTER                                          28420020
266800         VARYING PV-SQL-SUB                                       28430020
266900         FROM 1 BY 1                                              28440020
267000         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             28450020
267100            OR SQLCODE = 0                                        28460020
267200            OR SQLCODE = +100                                     28470020
267300                                                                  28480020
267400         EXEC SQL                                                 28490020
267500              SELECT                                              28500020
267600                     CHG_TMST                                     28510020
267700                   , JAN_SHRINK_PCT                               28520020
267800                   , FEB_SHRINK_PCT                               28530020
267900                   , MAR_SHRINK_PCT                               28540020
268000                   , APR_SHRINK_PCT                               28550020
268100                   , MAY_SHRINK_PCT                               28560020
268200                   , JUN_SHRINK_PCT                               28570020
268300                   , JUL_SHRINK_PCT                               28580020
268400                   , AUG_SHRINK_PCT                               28590020
268500                   , SEP_SHRINK_PCT                               28600020
268600                   , OCT_SHRINK_PCT                               28610020
268700                   , NOV_SHRINK_PCT                               28620020
268800                   , DEC_SHRINK_PCT                               28630020
C14666                   , SHNK_PCT_CHG_DTE                             28640033
C14666                   , LAST_UPD_BY_USR                              28650033
268900              INTO                                                28660020
269000                     :DPTSHK-CHG-TMST                             28670020
269100                   , :DPTSHK-JAN-SHRINK-PCT                       28680020
269200                   , :DPTSHK-FEB-SHRINK-PCT                       28690020
269300                   , :DPTSHK-MAR-SHRINK-PCT                       28700020
269400                   , :DPTSHK-APR-SHRINK-PCT                       28710020
269500                   , :DPTSHK-MAY-SHRINK-PCT                       28720020
269600                   , :DPTSHK-JUN-SHRINK-PCT                       28730020
269700                   , :DPTSHK-JUL-SHRINK-PCT                       28740020
269800                   , :DPTSHK-AUG-SHRINK-PCT                       28750020
269900                   , :DPTSHK-SEP-SHRINK-PCT                       28760020
270000                   , :DPTSHK-OCT-SHRINK-PCT                       28770020
270100                   , :DPTSHK-NOV-SHRINK-PCT                       28780020
270200                   , :DPTSHK-DEC-SHRINK-PCT                       28790020
C14666                   , :DPTSHK-SHNK-PCT-CHG-DTE                     28800033
C14666                   , :DPTSHK-LAST-UPD-BY-USR                      28810033
270300              FROM                                                28820020
270400                     TDPTSHK                                      28830020
270500              WHERE                                               28840020
270600                     MDSEAR_DKEY    = :DPTSHK-MDSEAR-DKEY         28850020
270700                AND  SHRINK_YR_NBR  = :DPTSHK-SHRINK-YR-NBR       28860020
C14666                AND  E_BUS_IND      = :DPTSHK-E-BUS-IND           28870033
270800         END-EXEC                                                 28880020
270900                                                                  28890020
271000         EVALUATE TRUE                                            28900020
271100             WHEN SQLCODE = ZERO                                  28910020
271200             WHEN SQLCODE = +100                                  28920020
271300             WHEN SQLCODE = -904                                  28930020
271400             WHEN SQLCODE = -913                                  28940020
271500                  CONTINUE                                        28950020
271600             WHEN SQLWARN0 NOT EQUAL SPACE                        28960020
271700             WHEN SQLCODE NOT EQUAL ZERO                          28970020
271800                  MOVE '9530-GET-SHRINK-ROW'                      28980020
271900                               TO  DP013-PARAGRAPH                28990020
272000                  MOVE 'READ DPTSHK'                              29000020
272100                               TO  DP013-MESSAGE-TEXT (1)         29010020
272200                  MOVE SQLCA   TO  DP013-SQLCA                    29020020
272300                  SET DP013-DB2-ABEND                             29030020
272400                               TO  TRUE                           29040020
272500                  PERFORM DP013-0000-PROCESS-ABEND                29050020
272600         END-EVALUATE                                             29060020
272700     END-PERFORM.                                                 29070020
272800                                                                  29080020
272900     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   29090020
273000         MOVE '9530-GET-SHRINK-ROW'                               29100020
273100                               TO  DP013-PARAGRAPH                29110020
273200         MOVE 'MAX RETRIES EXCEEDED FOR READ DPTSHK'              29120020
273300                               TO  DP013-MESSAGE-TEXT (1)         29130020
273400         MOVE SQLCA            TO  DP013-SQLCA                    29140020
273500         SET DP013-DB2-ABEND   TO  TRUE                           29150020
273600         PERFORM DP013-0000-PROCESS-ABEND                         29160020
273700     END-IF.                                                      29170020
273800                                                                  29180020
273900 EJECT                                                            29190020
274000 9900-COMMIT.                                                     29200020
274100     EXEC CICS                                                    29210020
274200         SYNCPOINT                                                29220020
274300     END-EXEC.                                                    29230020
274400                                                                  29240020
274500 EJECT                                                            29250020
274600                                                                  29260020
274700******************************************************************29270020
274800*    FILL IN SCREEN HEADER MODULE                                 29280020
274900******************************************************************29290020
275000                                                                  29300020
275100     COPY DPPD002.                                                29310021
275200 EJECT                                                            29320020
275300******************************************************************29330020
275400*    RETURN TO CICS MODULE                                        29340020
275500******************************************************************29350020
275600                                                                  29360020
275700     COPY DPPD003.                                                29370021
275800 EJECT                                                            29380020
275900******************************************************************29390020
276000*    FORMAT MESSAGE LINES MODULE                                  29400020
276100******************************************************************29410020
276200                                                                  29420020
276300     COPY DPPD005.                                                29430021
276400 EJECT                                                            29440020
276500******************************************************************29450020
276600*    GET PANEL MODULE                                             29460020
276700******************************************************************29470020
276800                                                                  29480020
276900     COPY DPPD007.                                                29490021
277000 EJECT                                                            29500020
277100******************************************************************29510020
277200*    WRITE PANEL MODULE                                           29520020
277300******************************************************************29530020
277400                                                                  29540020
277500     COPY DPPD008.                                                29550021
277600 EJECT                                                            29560020
277700******************************************************************29570020
277800*    TOGGLE THE FUNCTION KEY LINE MODULE                          29580020
277900******************************************************************29590020
278000                                                                  29600020
278100     COPY DPPD009.                                                29610021
278200 EJECT                                                            29620020
278300******************************************************************29630020
278400*    ABEND PROCESSOR MODULE                                       29640020
278500******************************************************************29650020
278600                                                                  29660020
278700     COPY DPPD013.                                                29670021
278800 EJECT                                                            29680020
278900******************************************************************29690020
279000*    CHECK COMMUNICATION AREA MODULE                              29700020
279100******************************************************************29710020
279200                                                                  29720020
279300     COPY DPPD015.                                                29730021
279400 EJECT                                                            29740020
279500******************************************************************29750020
279600*    UPDATE TIME AND DATE MODULE                                  29760020
279700******************************************************************29770020
279800                                                                  29780020
279900     COPY DPPD017.                                                29790021
