000100***************************************************************** 00010036
000200 IDENTIFICATION DIVISION.                                         00020036
000300***************************************************************** 00030036
000400                                                                  00040036
000500 PROGRAM-ID.             ARKUT075.                                00050046
000600 AUTHOR.                 CHERI PARMLEY.                           00060036
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070036
000800 DATE-WRITTEN            JANUARY 2017.                            00080046
000900 DATE-COMPILED.                                                   00090036
001000                                                                  00100036
001100***************************************************************** 00110036
001200*  PURPOSE:                                                       00120036
001300*  THIS PROGRAM WILL TOKENIZE THE SSN NUMBER FIELD AND ENCRYPT    00130046
001400*  THE ASSOCIATE ENTIRE NAME FROM THE INPUT FILE.                 00131046
001600*  PROTEGRITY MODULE WILL BE INVOKED TO DO THIS.                  00160046
001710*                                                                 00171046
001800*  INPUT FILES :   EMP-FILE                  DDNAME = INP01       00180047
001900*  OUTPUT FILES:   EMP-TOKEN-FILE            DDNAME = OUT01       00190047
002000*                                                                 00200036
002100***************************************************************** 00210036
002200*----------------------------------------------------------------*00220036
002300*                                                                *00230036
002400* DATE:        01/05/2017                                        *00240046
002500* WR/IR#:      CHG0168613                                        *00250066
002600* PROGRAMMER:  CHERI PARMLEY                                     *00260036
002700* DESCRIPTION: INITIAL VERSION                                   *00270036
002900*                                                                *00290036
003000*----------------------------------------------------------------*00300036
002300*                                                                *00230036
002400* DATE:        03/04/2019                                        *00240046
002500* WR/IR#:      CH00218977                                        *00250066
002600* PROGRAMMER:  BARB SCHULTZ                                      *00260036
002300* DESCRIPTION: THE EMPLOYEE NAME WAS NOT GETTING ENCRYPTED       *00230036
002300* CORRECTLY FOR LONG NAMES.  IT WAS GETTING TRUNCATED IN THE     *00230036
002300* PROTEGRITY ENCRYPTION STEP.  THE PV-OUTPUT-TEXT FIELD WAS      *00230036
002300* CHANGED FROM X(50) TO X(88).  PV-ACTUAL-LEN WAS ALSO CHANGED   *00230036
002300* FROM S9(02)V TO S9(03)V.                                       *00230036
002300*                                                                *00230036
002300*                                                                *00230036
003000*----------------------------------------------------------------*00300036
003100***************************************************************** 00310036
003200 ENVIRONMENT DIVISION.                                            00320036
003300***************************************************************** 00330036
003400                                                                  00340036
003500 CONFIGURATION SECTION.                                           00350036
003600                                                                  00360036
003700 SOURCE-COMPUTER.        IBM-3090.                                00370036
003800                                                                  00380036
003900 OBJECT-COMPUTER.        IBM-3090.                                00390036
004000                                                                  00400036
004100 INPUT-OUTPUT SECTION.                                            00410036
004200                                                                  00420036
004300 FILE-CONTROL.                                                    00430036
004400                                                                  00440036
004500     SELECT EMP-FILE                                              00450046
004600         ASSIGN TO INP01.                                         00460036
004700                                                                  00470036
004800     SELECT EMP-TOKEN-FILE                                        00480046
004900         ASSIGN TO OUT01.                                         00490046
005000                                                                  00500036
006900******************************************************************00690036
007000 DATA DIVISION.                                                   00700036
007100******************************************************************00710036
007200                                                                  00720036
007300 FILE SECTION.                                                    00730036
007400                                                                  00740036
007500 FD  EMP-FILE                                                     00750046
007600     RECORDING MODE IS F                                          00760036
007700     BLOCK CONTAINS 0 RECORDS                                     00770036
007800     LABEL RECORDS ARE STANDARD.                                  00780036
007900                                                                  00790036
008000 01  EMP-RECORD                  PIC X(200).                      00800063
008100                                                                  00810036
008200 FD  EMP-TOKEN-FILE                                               00820046
008300     RECORDING MODE IS F                                          00830036
008400     BLOCK CONTAINS 0 RECORDS                                     00840036
008500     LABEL RECORDS ARE STANDARD.                                  00850036
008600                                                                  00860036
008700 01  EMP-TOKEN-RECORD            PIC X(200).                      00870064
008800                                                                  00880036
013500******************************************************************01350036
013600 WORKING-STORAGE SECTION.                                         01360036
013700******************************************************************01370036
013800 01  FILLER                            PIC X(50)  VALUE           01380036
013900     ' *** WORKING STORAGE STARTS HERE FOR ARKUT075 *** '.        01390046
014000                                                                  01400036
014100 01  PS-PROGRAM-SWITCHES.                                         01410036
014200     05  PS-END-OF-FILE-SW          PIC X(01)  VALUE 'N'.         01420046
014300         88  PS-NOT-END-OF-FILE                VALUE 'N'.         01430046
014400         88  PS-END-OF-FILE                    VALUE 'Y'.         01440046
014500     05  PS-ACCT-SSN                PIC X(08)  VALUE SPACES.      01450046
014600         88  PS-ACCT-NBR                       VALUE 'ACCT NBR'.  01460046
014700         88  PS-SSN-NBR                        VALUE 'SSN NBR'.   01470046
008800     05  PS-ASSOC-DTL-SW            PIC X(04)  VALUE SPACES.              
009200         88  PS-ASSOC-ENTR-NM                  VALUE 'ENTR'.              
015400                                                                  01540036
015500 01  PC-CONSTANTS.                                                01550036
015600     05  PC-PROGRAM-NAME               PIC  X(08) VALUE           01560036
015700                                                 'ARKUT075'.      01570046
015800 01  PV-PROGRAM-VARIABLES.                                        01580036
015900     05  PV-READ-COUNT                 PIC  9(09) VALUE ZEROES.   01590047
016000     05  PV-WRITE-COUNT                PIC  9(09) VALUE ZEROES.   01600047
016700     05  PV-INPUT-LEN                  PIC  9(09) VALUE ZEROES.   01670046
016701     05  PV-OUTPUT-RECORD              PIC  X(200) VALUE SPACES.  01670164
010000     05  PV-PARAGRAPH-NAME             PIC  X(30) VALUE SPACES.           
010100     05  PV-OPERATION-MSG-1            PIC  X(40) VALUE SPACE.            
010200     05  PV-OPERATION-MSG-2            PIC  X(40) VALUE SPACE.            
010300     05  PV-INP-READ-COUNT             PIC  9(09) VALUE ZEROES.           
010400     05  PV-OUT-WRITE-COUNT            PIC  9(09) VALUE ZEROES.           
011000     05  PV-ASCII                      PIC  X(50).                        
011200     05  PV-IN-LENGTH                  PIC  9(09) VALUE ZEROES.           
BARB       05  PV-INPUT-TEXT                 PIC  X(88).                        
011400     05  PV-OUTPUT-TEXT                PIC  X(88) VALUE SPACES.           
011500     05  PV-DISP-ASSOC                 PIC  X(12) VALUE SPACES.           
019319     05  PV-ENC-TEXT             PIC  X(50)  VALUE SPACES.                
BARB       05  PV-ACTUAL-LEN           PIC S9(03)V  COMP-3 VALUE ZEROES.        
016800                                                                  01680036
016900 01  ABEND-CODE                        PIC S9(04) VALUE ZERO      01690050
016910                                                  COMP SYNC.      01691050
008300     88  ABEND-4008-CONVERSION-ERROR              VALUE +4008.            
017000                                                                  01700042
017100******************************************************************01710036
017200* RECORD LAYOUT FOR WORKDAY FILE - INPUT AND OUTPUT              *01720046
017300******************************************************************01730036
017400     COPY ARRD100.                                                01740046
017500                                                                  01750036
018700******************************************************************01870036
018800* LAYOUT THAT DEFINES THE PARAMETERS NEEDED TO INVOKE PROTEGRITY *01880036
018900* MODULE                                                         *01890036
019000******************************************************************01900036
019100     COPY PTYCCSIP.                                               01910036
019200                                                                  01920036
019300******************************************************************01930036
019400* LAYOUT THAT DEFINES THE WORKING VARIABLES TO INVOKE PROTEGRITY *01940036
019500* MODULE                                                         *01950036
019600******************************************************************01960036
019700     COPY DPWS031.                                                01970042
019800                                                                  01980036
016100******************************************************************        
016200* LAYOUT THAT DEFINES THE WORKING VARIABLES TO CONVERT FROM BASE64        
016300* TO BINARY & VICE VERSA                                                  
016400******************************************************************        
016500       COPY DPWS022.                                                      
019800                                                                  01980036
016100******************************************************************        
016200* LAYOUT THAT DEFINES THE WORKING VARIABLES TO CONVERT FROM EBCDIC        
016300* TO ASCII & VICE VERSA                                                   
016400******************************************************************        
016500       COPY DPWS053.                                                      
016600******************************************************************        
020000                                                                  02000036
020100 PROCEDURE DIVISION.                                              02010036
020200                                                                  02020036
020300 0000-MAINLINE-PARA.                                              02030036
020400                                                                  02040036
020500     PERFORM 1000-INITIALIZE.                                     02050036
020600                                                                  02060036
020700     PERFORM 2000-PROCESS-PARA                                    02070046
020800           UNTIL PS-END-OF-FILE.                                  02080046
020900                                                                  02090036
021900     PERFORM 9000-EOJ-ROUTINE.                                    02190036
022000                                                                  02200036
022100     STOP RUN.                                                    02210036
022200                                                                  02220036
022300******************************************************************02230036
022400* 1000-INITIALIZE                                                 02240036
022500*     INITIALIZE THE VARIABLES, OPEN THE INPUT AND OUTPUT FILES   02250036
022600*     AND READ THE INPUT FILE                                     02260036
022700******************************************************************02270036
022800 1000-INITIALIZE.                                                 02280036
022900                                                                  02290036
023000     DISPLAY 'PROGRAM - ' PC-PROGRAM-NAME.                        02300036
023100     INITIALIZE PV-PROGRAM-VARIABLES.                             02310036
023200     MOVE PC-PROGRAM-NAME               TO DP031-PROGRAM-NAME.    02320043
023300                                                                  02330036
023400     OPEN INPUT  EMP-FILE                                         02340046
023500          OUTPUT EMP-TOKEN-FILE.                                  02350046
024200                                                                  02420036
024300     PERFORM 2100-READ-FILE.                                      02430046
024400                                                                  02440036
025100******************************************************************02510036
025200* 2000-PROCESS-PARA                                               02520046
025300*   1. PROCESS THE RECORDS IN THE INPUT FILE                      02530046
025400*   2. CALL TOKENIZE PARA TO TOKENIZE SSN NUMBER                  02540046
025400*   3. CALL ENCRYPT  PARA TO ENCRYPT ASSOCIATE ENTIRE NM          02540046
025500*   4. WRITE OUTPUT RECORDS                                       02541046
025600******************************************************************02560036
025700 2000-PROCESS-PARA.                                               02570046
025800                                                                  02580036
025910     INITIALIZE PV-INPUT-LEN.                                     02591046
026000                                                                  02600036
026005     INSPECT FUNCTION REVERSE (AR100-SSN-NBR)                     02601955
026006            TALLYING PV-INPUT-LEN FOR LEADING SPACES.             02602055
026007     COMPUTE PV-INPUT-LEN = LENGTH OF AR100-SSN-NBR -             02602155
026008                                      PV-INPUT-LEN.               02602255
026009                                                                  02602355
026010     IF PV-INPUT-LEN NOT = 9                                      02602455
026011        CONTINUE                                                  02602555
026012     ELSE                                                         02602655
026013        SET PS-SSN-NBR TO TRUE                                    02602755
026014        PERFORM 2300-TOKENIZE-DATA                                02602855
026015     END-IF.                                                      02602946
026016                                                                  02603146
026000     IF AR100-EMP-NM             EQUAL SPACES                             
026100        CONTINUE                                                          
026200     ELSE                                                                 
026300        SET PS-ASSOC-ENTR-NM        TO  TRUE                              
              PERFORM 3200-PROTECT-EMPNAME                                      
026400*       PERFORM 2400-EBCDIC-ASCII                                         
026500*       PERFORM 2500-ENCRYPT-ASSOC-DTL                                    
026600*       PERFORM 2600-BINARY-BASE64                                        
026700        MOVE PV-OUTPUT-TEXT         TO AR100-EMP-NM                       
026800     END-IF.                                                              
026017     PERFORM 2200-WRITE-FILE.                                     02603246
026018     PERFORM 2100-READ-FILE.                                      02603346
026019                                                                  02604046
028900******************************************************************02890036
029000* 2100-READ-FILE                                                  02900046
029100*      READ THE RECORDS IN EMPLOYEE WORKDAY FILE                  02910046
029200******************************************************************02920036
029300 2100-READ-FILE.                                                  02930046
029400                                                                  02940036
029500     READ EMP-FILE INTO AR100-WD-EMPLOYEE-REC                     02950046
029600        AT END                                                    02960036
029700           SET PS-END-OF-FILE  TO TRUE                            02970046
029800        NOT AT END                                                02980036
029900           ADD 1               TO PV-READ-COUNT                   02990046
030000     END-READ.                                                    03000036
030100                                                                  03010036
030200******************************************************************03020036
030300* 2200-WRITE-FILE                                                 03030046
030400*      WRITE THE RECORDS TO OUTPUT                                03040036
030500******************************************************************03050036
030600 2200-WRITE-FILE.                                                 03060046
030700                                                                  03061064
030800     INITIALIZE PV-OUTPUT-RECORD.                                 03061165
030801     MOVE AR100-WD-EMPLOYEE-REC    TO PV-OUTPUT-RECORD.           03062064
030802                                                                  03070036
030803     WRITE EMP-TOKEN-RECORD FROM PV-OUTPUT-RECORD.                03080064
030900     ADD 1                       TO PV-WRITE-COUNT.               03090060
031000                                                                  03100036
031001******************************************************************03101046
031002* 2300-TOKENIZE-DATA                                              03102046
031003*    TOKENIZE SSN NUMBERS                                         03103046
031004******************************************************************03106046
031005 2300-TOKENIZE-DATA.                                              03107046
031006                                                                  03108046
031007     INITIALIZE CSI-PARAMETERS                                    03109046
031008                DP031-PROTEG-PGM-PARAMETERS.                      03109146
031009                                                                  03109246
031010     EVALUATE TRUE                                                03109346
031016        WHEN PS-SSN-NBR                                           03110055
031017          MOVE 'SSN-NBR'          TO DP031-FIELD                  03110155
031018          MOVE AR100-SSN-NBR      TO DP031-CLEAR-TEXT             03110346
031019          MOVE PV-INPUT-LEN       TO DP031-INPUT-LEN              03110446
031020          SET DP031-SSN           TO TRUE                         03110549
031021     END-EVALUATE.                                                03110646
031022                                                                  03110746
031023     SET CSI-ENCRYPT-FUNCTION     TO TRUE.                        03110846
031024     PERFORM DP031-0000-PROTG-TOKEN-DETOKEN.                      03111146
031025                                                                  03111246
031026     IF CSI-RETURN-CODE = ZERO                                    03111346
031031        MOVE DP031-CIPHER-TEXT TO AR100-SSN-NBR                   03111955
031033     ELSE                                                         03112155
031034        DISPLAY 'ISSUE IN RECORD# : ' PV-READ-COUNT               03112246
031035        PERFORM DP031-9999-ABEND                                  03112346
031036     END-IF.                                                      03112446
031037                                                                  03112560
030300******************************************************************        
030400* 2400-EBCDIC-ASCII.                                                      
030500*     CONVERT ASSOCIATE DETAILS FROM EBCDIC FORMAT TO ASCII FORMAT        
030600*     FOR BELOW FILEDS.                                                   
030700*     ENTIRE NAME                                                         
030800******************************************************************        
030900                                                                          
031000 2400-EBCDIC-ASCII.                                                       
031100                                                                          
031200     INITIALIZE DP053-EBCDIC-ASCII-PARMS                                  
031300                PV-ASCII                                                  
031500                PV-DISP-ASSOC                                             
031600                PV-IN-LENGTH.                                             
031700                                                                          
031800     EVALUATE TRUE                                                        
033300                                                                          
033400        WHEN PS-ASSOC-ENTR-NM                                             
033500           MOVE AR100-EMP-NM               TO DP053-INPUT-FIELD           
033700           MOVE 'ENTR-NAME'                TO PV-DISP-ASSOC               
033800                                                                          
034300     END-EVALUATE.                                                        
034400     INSPECT FUNCTION REVERSE(DP053-INPUT-FIELD)                          
034500             TALLYING PV-IN-LENGTH FOR LEADING SPACES.                    
034600     COMPUTE PV-IN-LENGTH = LENGTH OF DP053-INPUT-FIELD                   
034700                                    - PV-IN-LENGTH.                       
034800     SET  DP053-CT-EBCDIC-TO-ASCII  TO TRUE.                              
034900     MOVE PV-IN-LENGTH              TO DP053-FIELD-LENGTH.                
035000                                                                          
035100     CALL DP053-EBCDIC-ASCII-ROUTINE USING DP053-CONVERSION-TYPE          
035200                                           DP053-FIELD-LENGTH             
035300                                           DP053-INPUT-FIELD              
035400                                           DP053-OUTPUT-FIELD             
035500                                           DP053-RETURN-CODE.             
035600                                                                          
035700     IF DP053-RC-SUCCESSFUL                                               
035800        MOVE DP053-OUTPUT-FIELD     TO PV-ASCII                           
035900     ELSE                                                                 
036000        MOVE 'ERROR WHILE CONVERTING EBCDIC TO ASCII'                     
036100                                    TO PV-OPERATION-MSG-1                 
036200        MOVE '2400-EBCDIC-ASCII'    TO PV-PARAGRAPH-NAME                  
036300        DISPLAY 'RETURN-CODE            : ' DP053-RETURN-CODE             
036400        DISPLAY 'ABENDED RECORD NO.     : ' PV-READ-COUNT                 
036500        DISPLAY 'ASSOC-ID               : ' AR100-EMP-ID                  
045600        DISPLAY 'SENSITIVE FIELD        : ' PV-DISP-ASSOC                 
036700        DISPLAY 'INPUT-LENGTH           : ' PV-IN-LENGTH                  
036800        SET ABEND-4008-CONVERSION-ERROR TO TRUE                           
036900        PERFORM 9999-ABEND                                                
037000     END-IF.                                                              
037100                                                                          
037200******************************************************************        
037300* 2500-ENCRYPT-ASSOC-DTL                                                  
037400*     CALLS PROTEGRITY MODULE TO ENCRYPT THE BELOW FIELDS.                
037500*     ENTIRE NAME                                                         
037600*     RETURNED FIELDS WILL BE IN BINARY FORMAT.                           
037700******************************************************************        
037800                                                                          
037900 2500-ENCRYPT-ASSOC-DTL.                                                  
038000                                                                          
038100     INITIALIZE CSI-PARAMETERS                                            
038200                DP031-PROTEG-PGM-PARAMETERS.                              
038300     SET CSI-ENCRYPT-FUNCTION       TO TRUE.                              
038400     MOVE DP053-FIELD-LENGTH        TO CSI-CLEAR-TEXT-LENGTH.             
038500     MOVE PV-ASCII                  TO DP031-CLEAR-TEXT.                  
038600     MOVE PV-DISP-ASSOC             TO DP031-FIELD.                       
038700                                                                          
038800     EVALUATE TRUE                                                        
039300                                                                          
039500        WHEN PS-ASSOC-ENTR-NM                                             
039600           SET DP031-CUST-INFO      TO TRUE                               
039700           MOVE 66                  TO CSI-CIPHER-TEXT-LENGTH             
039700                                                                          
040200     END-EVALUATE.                                                        
040300     PERFORM DP031-1000-PROTG-ENCRYP-DECRYP.                              
040400                                                                          
040500     IF CSI-RETURN-CODE NOT = ZERO                                        
040600        MOVE 'ERROR WHILE CONVERTING TO BINARY'                           
040700                                      TO PV-OPERATION-MSG-1               
040800        MOVE '2500-ENCRYPT-ASSOC-DTL' TO PV-PARAGRAPH-NAME                
040900        DISPLAY 'RETURN-CODE         : ' DP053-RETURN-CODE                
041000        DISPLAY 'ABENDED RECORD NO.  : ' PV-READ-COUNT                    
041100        DISPLAY 'ASSOC-ID            : ' AR100-EMP-ID                     
041200        DISPLAY 'SENSITIVE FIELD     : ' PV-DISP-ASSOC                    
041300        DISPLAY 'INPUT-LENGTH        : ' PV-IN-LENGTH                     
041400        PERFORM DP031-9999-ABEND                                          
041500     END-IF.                                                              
041600                                                                          
041700******************************************************************        
041800* 2600-BINARY-BASE64                                                      
041900*     CONVERT BELOW FIELDS FROM BINARY TO BASE64 FORMAT.                  
042000*     LAST NAME,FIRST NAME,MIDDLE NAME,ENTIRE NAME,BIRTH DATE             
042100******************************************************************        
042200                                                                          
042300 2600-BINARY-BASE64.                                                      
042400                                                                          
042500     INITIALIZE DP022-PARMS                                               
042600                PV-INPUT-TEXT                                             
042700                PV-OUTPUT-TEXT.                                           
042800                                                                          
042900     MOVE DP031-CIPHER-TEXT         TO PV-INPUT-TEXT.                     
043000     MOVE CSI-CIPHER-TEXT-LENGTH    TO DP022-INLEN.                       
043100                                                                          
043200     EVALUATE TRUE                                                        
043700                                                                          
043800        WHEN PS-ASSOC-ENTR-NM                                             
043900           MOVE 88                  TO DP022-OUTLEN-IN                    
044000                                                                          
044300     END-EVALUATE.                                                        
044400                                                                          
044500     CALL  DP022-MGCXB2R  USING DP022-PARMS,                              
044600                                PV-INPUT-TEXT,                            
044700                                PV-OUTPUT-TEXT.                           
044800                                                                          
044900     IF RETURN-CODE NOT EQUAL 0                                           
045000        MOVE 'ERROR WHILE CONVERTING BINARY  TO BASE64'                   
045100                                    TO PV-OPERATION-MSG-1                 
045200        MOVE '2400-BINARY-BASE64'   TO PV-PARAGRAPH-NAME                  
045300        DISPLAY 'RETURN-CODE         : ' RETURN-CODE                      
045400        DISPLAY 'ABENDED RECORD NO.  : ' PV-READ-COUNT                    
045500        DISPLAY 'ASSOC-ID            : ' AR100-EMP-ID                     
045600        DISPLAY 'SENSITIVE FIELD     : ' PV-DISP-ASSOC                    
045700        DISPLAY 'INPUT-LENGTH        : ' PV-IN-LENGTH                     
045800        SET ABEND-4008-CONVERSION-ERROR    TO TRUE                        
045900        PERFORM 9999-ABEND                                                
046000     END-IF.                                                              
046100                                                                          
991809******************************************************************        
991810* ENCRYPT THE EMPL NAME TO BASE64                                *        
991811*****************************************************************A        
991812 3200-PROTECT-EMPNAME.                                                    
991813                                                                          
991814     INITIALIZE CSI-PARAMETERS                                            
991815                DP031-PROTEG-PGM-PARAMETERS.                              
991816                                                                          
991817     MOVE AR100-EMP-NM                 TO PV-ENC-TEXT.                    
991818     MOVE 'AR100-EMP-NM'               TO DP031-FIELD.                    
991819     SET DP031-CUST-INFO               TO TRUE.                           
991820     PERFORM 6100-ENCRYPT-TEXT.                                           
                                                                                
992071******************************************************************        
992072* 6100-ENCRYPT-TEXT                                                       
992073*      ENCRYPT THE DATA                                                   
992074******************************************************************        
992075 6100-ENCRYPT-TEXT.                                                       
992076                                                                          
992077     INITIALIZE PV-ACTUAL-LEN.                                            
992078                                                                          
992079     INSPECT FUNCTION REVERSE(PV-ENC-TEXT)                                
992080          TALLYING PV-ACTUAL-LEN  FOR LEADING SPACES.                     
992081     COMPUTE PV-ACTUAL-LEN  = 50 - PV-ACTUAL-LEN.                         
992082                                                                          
992083     PERFORM 6200-EBCDIC-ASCII.                                           
992084     PERFORM 6300-CALL-PROTEGRITY.                                        
992085     PERFORM 6400-BINARY-BASE64.                                          
992086                                                                          
992087******************************************************************        
992088* 6200-EBCDIC-ASCII                                                       
992089*      CONVERT EBCDIC TO ASCII                                            
992090******************************************************************        
992091 6200-EBCDIC-ASCII.                                                       
992092                                                                          
992093     INITIALIZE DP053-EBCDIC-ASCII-PARMS.                                 
992094                                                                          
992095     SET  DP053-CT-EBCDIC-TO-ASCII    TO TRUE.                            
992096     MOVE PV-ENC-TEXT           TO DP053-INPUT-FIELD.                     
992097     MOVE PV-ACTUAL-LEN         TO DP053-FIELD-LENGTH.                    
992098                                                                          
992099     CALL DP053-EBCDIC-ASCII-ROUTINE USING DP053-CONVERSION-TYPE          
992100                                           DP053-FIELD-LENGTH             
992101                                           DP053-INPUT-FIELD              
992102                                           DP053-OUTPUT-FIELD             
992103                                           DP053-RETURN-CODE.             
992104     IF DP053-RC-SUCCESSFUL                                               
992105        CONTINUE                                                          
992106     ELSE                                                                 
992107        DISPLAY 'ERROR WHILE CONVERTING EBCDIC TO ASCII'                  
992108        DISPLAY 'RETURN CODE        - ' DP053-RETURN-CODE                 
992109        DISPLAY 'INPUT LENGTH       - ' PV-ACTUAL-LEN                     
992110*       PERFORM 7010-DISPLAY-STATS                                        
992111        PERFORM 7010-DISPLAY-UNIQKEY                                      
992112        SET ABEND-4008-CONVERSION-ERROR TO TRUE                           
992113        PERFORM 9999-ABEND                                                
992114     END-IF.                                                              
992115                                                                          
992116******************************************************************        
992117* 6300-CALL-PROTEGRITY                                                    
992118*      CALL PROTEGRITY TO ENCRYPT THE NAME                                
992119******************************************************************        
992120 6300-CALL-PROTEGRITY.                                                    
992121                                                                          
992122     SET CSI-ENCRYPT-FUNCTION   TO TRUE.                                  
992123                                                                          
992124     MOVE DP053-OUTPUT-FIELD    TO DP031-CLEAR-TEXT.                      
992125     MOVE PV-ACTUAL-LEN         TO CSI-CLEAR-TEXT-LENGTH.                 
992126     MOVE LENGTH OF DP031-CIPHER-TEXT                                     
992127                                TO CSI-CIPHER-TEXT-LENGTH.                
992128     PERFORM DP031-1000-PROTG-ENCRYP-DECRYP.                              
992129     IF CSI-RETURN-CODE = 0                                               
992130        CONTINUE                                                          
992131     ELSE                                                                 
992132        DISPLAY ' '                                                       
992133        DISPLAY 'ERROR ON PROTEGRITY CALL' DP031-FIELD                    
992134        DISPLAY 'INPUT LENGTH    ' CSI-CLEAR-TEXT-LENGTH                  
992135        DISPLAY 'PROCESSING INCOMPLETE  *'                                
992136*       PERFORM 7010-DISPLAY-STATS                                        
992137        PERFORM 7010-DISPLAY-UNIQKEY                                      
992138        PERFORM DP031-9999-ABEND                                          
992139     END-IF.                                                              
992140                                                                          
992141******************************************************************        
992142* 6400-BINARY-BASE64                                                      
992143*      CONVERT BINARY TO BASE64                                           
992144******************************************************************        
992145 6400-BINARY-BASE64.                                                      
992146                                                                          
992147     INITIALIZE PV-INPUT-TEXT                                             
992148                PV-OUTPUT-TEXT.                                           
992149                                                                          
992150     MOVE DP031-CIPHER-TEXT      TO PV-INPUT-TEXT.                        
992151     MOVE CSI-CIPHER-TEXT-LENGTH TO DP022-INLEN.                          
992152     MOVE 120                    TO DP022-OUTLEN-IN.                      
992153                                                                          
992154     CALL DP022-MGCXB2R USING DP022-PARMS,                                
992155                              PV-INPUT-TEXT,                              
992156                              PV-OUTPUT-TEXT.                             
992157                                                                          
992158     IF RETURN-CODE EQUAL 0                                               
992159        CONTINUE                                                          
992160     ELSE                                                                 
992161        DISPLAY ' '                                                       
992162        DISPLAY 'ERROR WHILE CONVERTING TO BASE64'                        
992163        DISPLAY 'RC ' RETURN-CODE                                         
992164        DISPLAY 'PV-INPUT-TEXT ' PV-INPUT-TEXT                            
992165        DISPLAY 'INPUT-LEN  ' DP022-INLEN                                 
992166*       PERFORM 7010-DISPLAY-STATS                                        
992167        PERFORM 7010-DISPLAY-UNIQKEY                                      
992168        SET ABEND-4008-CONVERSION-ERROR TO TRUE                           
992169        PERFORM 9999-ABEND                                                
992170     END-IF.                                                              
992171                                                                          
992190******************************************************************        
992191* DISPLAY UNIQUE KEYS FOR DEBUG                                           
992192******************************************************************        
992193 7010-DISPLAY-UNIQKEY.                                                    
992194                                                                          
992195     DISPLAY 'DM - '  '******' AR100-EMP-ID          ' '                  
992199                               'ERROR WITH CONVERSION OF NAME '.          
992200                                                                          
050300******************************************************************05030036
050400* 9000-EOJ-ROUTINE                                                05040036
050500*      CLOSE THE INPUT AND OUTPUT FILES, DISPLAY THE MESSAGES     05050036
050600*      AND TERMINATE THE PROCESS.                                 05060036
050700******************************************************************05070036
050800 9000-EOJ-ROUTINE.                                                05080036
050900                                                                  05090036
051000     CLOSE EMP-FILE                                               05100046
051100           EMP-TOKEN-FILE.                                        05110046
051800                                                                  05180036
051900     IF PV-READ-COUNT = 0                                         05190046
052000        DISPLAY 'INPUT FILE IS EMPTY'                             05200046
052100     ELSE                                                         05200146
052200        DISPLAY 'RECORDS READ   : ' PV-READ-COUNT                 05201046
052300        DISPLAY 'RECORDS WRITTEN: ' PV-WRITE-COUNT                05202046
052310     END-IF.                                                      05210036
052400                                                                  05240036
049000******************************************************************        
049100* 9999-ABEND                                                              
049300******************************************************************        
049400                                                                          
049500 9999-ABEND.                                                              
049600     DISPLAY '** ABEND           **'.                                     
049700     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.                  
049800     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.                
049900     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.               
050000     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.               
050100     CALL 'ILBOABN0' USING ABEND-CODE.                                    
050200                                                                          
054500******************************************************************05450036
054600*      COPY MEMBER DPPD031 CONTAINS STATEMENTS NEEDED TO INVOKE   05460042
054700*      PROTEGRITY MODULE FOR PROTECTION/UNPROTECTION              05470048
054800******************************************************************05480036
054900      COPY DPPD031.                                               05490042
055000                                                                  05500036
055100******************************************************************05510036
