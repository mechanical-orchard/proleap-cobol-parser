000100******************************************************************00010077
000200 IDENTIFICATION DIVISION.                                         00020077
000300******************************************************************00030077
000400                                                                  00040077
000500 PROGRAM-ID.                VLKCS507.                             00050077
000600 AUTHOR.                    MICHAEL WALTERS.                      00060077
000700 INSTALLATION.              KOHLS DEPARTMENT STORES.              00070077
000800 DATE-WRITTEN.              06-03-96.                             00080077
000900 DATE-COMPILED.                                                   00090077
001000                                                                  00100077
001100******************************************************************00110077
001200*  CICS PROGRAM - VLKCS507 - V507                                *00120077
001300*                                                                *00130077
001400*       VL SYSTEM PRETICKET SHIPPING MAINTENANCE SCREEN          *00140077
001500*                                                                *00150077
001600*  THIS SCREEN WILL CREATE SHIPMENTS FOR PRETICKET REQUESTS      *00160077
001700******************************************************************00170077
263627*----------------------------------------------------------------*00171085
263627* CHANGED 11/05/2021    BY JIM HUNTER      WR: CHG0263627         00172085
263627* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00173085
263627* MAKING THE CALL DYNAMIC VS STATIC.                              00174085
263627*----------------------------------------------------------------*00175085
CICS  * CHANGED 11/11/2022    BY JIM HUNTER      WR: CHG0278236         00176086
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00177086
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00178086
CICS  ***************************************************************** 00179086
001800 ENVIRONMENT DIVISION.                                            00180077
001900                                                                  00190077
002000 DATA DIVISION.                                                   00200077
002100                                                                  00210077
002200 WORKING-STORAGE SECTION.                                         00220077
002300                                                                  00230077
002400 01  DK-DB2-KEYS.                                                 00240077
002700     15  DK-PO-REQ-NBR                  PIC S9(09) VALUE +0       00270077
002800                                                   COMP.          00280077
002900     15  DK-SHIPT-GRP-ID                PIC S9(09) VALUE +0       00290077
003000                                                   COMP.          00300077
003400     15  DK-COMMENT-SEQ                 PIC S9(09) VALUE +0       00340077
003500                                                   COMP.          00350077
003600                                                                  00360077
003700 01  PC-PROGRAM-CONSTANTS.                                        00370077
003800     05  PC-RETURN-FROM-MULT-SHIP       PIC X(01)   VALUE '1'.    00380077
003900     05  PC-RETURN-FROM-COMMENTS        PIC X(01)   VALUE '2'.    00390077
004000     05  PC-PRETICKET-FUNCTION-ID       PIC S9(04)  COMP          00400077
004100                                                    VALUE +5.     00410077
004500     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00450077
004600                                                    'VL507A  '.   00460077
004700     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00470077
004800                                                    'VLKM507 '.   00480077
004900     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00490077
005000                                                    'VLKCS507'.   00500077
005100     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00510077
005200     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00520077
005300     05  PC-SHIP-QUEUE-SEQ              PIC  9(01)  VALUE 3.      00530077
005400     05  PC-COMMENT-QUEUE-SEQ           PIC  9(01)  VALUE 4.      00540077
005600     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +4      00560077
005700                                                    COMP SYNC.    00570077
005800     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00580077
005900                                                    COMP SYNC.    00590077
006000     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00600077
006100                                                    +1000000      00610077
006200                                                    COMP-3.       00620077
006300     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00630077
006400                                                    COMP SYNC.    00640077
006500     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00650077
006600                                                    COMP-3.       00660077
007200     05  PC-DPKUT410                    PIC  X(08) VALUE          00720077
007300                                                   'DPKUT410'.    00730077
007400*                                                                 00740077
007500     05  PC-TSYMSG-NUMBERS.                                       00750077
007600         10  PC-TSYMSG-00004            PIC  9(05)  VALUE 00004.  00760077
007700         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00770077
007800         10  PC-TSYMSG-00007            PIC  9(05)  VALUE 00007.  00780077
007900         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00790077
008000         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00800077
008100         10  PC-TSYMSG-00059            PIC  9(05)  VALUE 00059.  00810077
008900         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00890077
009000         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00900077
009100         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00910077
009200         10  PC-TSYMSG-00115            PIC  9(05)  VALUE 00115.  00920077
009300         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00930077
009400         10  PC-TSYMSG-01339            PIC  9(05)  VALUE 01339.  00940077
009500         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  00950077
009600*                                                                 00960077
009700 01  PS-PROGRAM-SWITCHES.                                         00970077
009800     05  PS-SHIP-DEL-CURSOR-SW          PIC  X(01)  VALUE 'Y'.    00980077
009900         88  PS-EOC-SHIP-DEL                        VALUE 'Y'.    00990077
010000         88  PS-NOT-EOC-SHIP-DEL                    VALUE 'N'.    01000077
010100     05  PS-SHIPMENT-CURSOR-SW          PIC  X(01)  VALUE 'Y'.    01010077
010200         88  PS-EOC-SHIPMENT                        VALUE 'Y'.    01020077
010300         88  PS-NOT-EOC-SHIPMENT                    VALUE 'N'.    01030077
010400     05  PS-COMMENT-CURSOR-SW           PIC  X(01)  VALUE 'Y'.    01040077
010500         88  PS-EOC-COMMENT                         VALUE 'Y'.    01050077
010600         88  PS-NOT-EOC-COMMENT                     VALUE 'N'.    01060077
011000     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01100077
011100         88  PS-NO-ERROR                            VALUE 'Y'.    01110077
011200         88  PS-ERROR                               VALUE 'N'.    01120077
011300     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01130077
011400         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01140077
011500         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01150077
011600*                                                                 01160077
011700 01  PV-PROGRAM-VARIABLES.                                        01170077
011900     05  PV-DATE-ISO.                                             01190077
012000         10  PV-DATE-CC-ISO             PIC  X(02).               01200084
012100         10  PV-DATE-YY-ISO             PIC  X(02).               01210084
012200         10  PV-DATE-DASH1              PIC  X VALUE '-'.         01220077
012300         10  PV-DATE-MM-ISO             PIC  X(02).               01230084
012400         10  PV-DATE-DASH2              PIC  X VALUE '-'.         01240077
012500         10  PV-DATE-DD-ISO             PIC  X(02).               01250084
012600     05  PV-DATE-6BYTE.                                           01260077
012700         10  PV-DATE-YY-6BYTE           PIC  X(02).               01270084
012800         10  PV-DATE-MM-6BYTE           PIC  X(02).               01280084
012900         10  PV-DATE-DD-6BYTE           PIC  X(02).               01290084
013000     05  PV-DATE-USA.                                             01300077
013100         10  PV-DATE-MM-USA             PIC  X(02).               01310084
013200         10  PV-DATE-SLASH1             PIC  X VALUE '/'.         01320077
013300         10  PV-DATE-DD-USA             PIC  X(02).               01330084
013400         10  PV-DATE-SLASH2             PIC  X VALUE '/'.         01340077
013500         10  PV-DATE-CC-USA             PIC  X(02).               01350084
013600         10  PV-DATE-YY-USA             PIC  X(02).               01360084
013700                                                                  01370077
013800     05  PV-TIMESTAMP           PIC X(26).                        01380077
013900     05  PV-TIMESTAMP-SPLIT.                                      01390077
014000         10  PV-TMST-DATE       PIC X(10).                        01400077
014100         10  FILLER             PIC X(04).                        01410077
014200         10  PV-MINUTE          PIC X(02).                        01420077
014300         10  FILLER             PIC X(02).                        01430077
014400         10  PV-SECOND          PIC X(01).                        01440077
014500         10  FILLER             PIC X(01).                        01450077
014600         10  PV-NANOSEC-1-3     PIC X(03).                        01460077
014700         10  PV-NANOSEC-4-6     PIC X(03).                        01470077
014800                                                                  01480077
014900     05  PV-RANDOM-KEY          PIC 9(09).                        01490077
015000     05  FILLER REDEFINES PV-RANDOM-KEY.                          01500077
015100         10  PV-RND-NANOSEC-4-6 PIC X(03).                        01510077
015200         10  PV-RND-NANOSEC-1-3 PIC X(03).                        01520077
015300         10  PV-RND-MINUTE      PIC X(02).                        01530077
015400         10  PV-RND-SECOND      PIC X(01).                        01540077
015500                                                                  01550077
015700     05  PV-DISPLAY-COMP                PIC  9(09) VALUE ZERO.    01570077
015800     05  PV-WORK-DATE.                                            01580077
015900         10  PV-WORK-CC                 PIC XX.                   01590077
016000         10  PV-WORK-YY                 PIC XX.                   01600077
016100         10  FILLER                     PIC X.                    01610077
016200         10  PV-DISPLAY-DATE.                                     01620077
016300             15 PV-WORK-MM              PIC XX.                   01630077
016400             15 FILLER                  PIC X.                    01640077
016500             15 PV-WORK-DD              PIC XX.                   01650077
016600     05  PV-STATUS-CODE                 PIC X.                    01660077
017100     05  PV-READ-COUNT                  PIC S9(04)  VALUE +0      01710077
017200                                                    COMP SYNC.    01720077
017300     05  PV-SUB                         PIC S9(04)  VALUE +0      01730077
017400                                                    COMP SYNC.    01740077
017500     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01750077
017600                                                    COMP SYNC.    01760077
018100     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01810077
018200                                                    COMP-3.       01820077
018300     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01830077
018400                                                    COMP-3.       01840077
018500     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01850077
018600                                                    COMP-3.       01860077
018900     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01890077
019000                                                    COMP SYNC.    01900077
019100     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01910077
019200                                                    COMP SYNC.    01920077
019300     05  PV-ITEM                        PIC S9(04)  VALUE +0      01930077
019400                                                    COMP SYNC.    01940077
019500     05  PV-SHIP-ITEM                   PIC S9(04)  VALUE +0      01950077
019600                                                    COMP SYNC.    01960077
019700     05  PV-COMM-ITEM                   PIC S9(04)  VALUE +0      01970077
019800                                                    COMP SYNC.    01980077
019900     05  PV-SEL-ITEM                    PIC S9(04)  VALUE +0      01990077
020000                                                    COMP SYNC.    02000077
020300     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      02030077
020400                                                    COMP SYNC.    02040077
020500     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      02050077
020600                                                    COMP SYNC.    02060077
022300     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      02230077
022400                                                    COMP SYNC.    02240077
022500     05  PV-STATE-PROV                  PIC  X(20).               02250077
022600     05  PV-COUNTRY                     PIC  X(20).               02260077
022700     05  PV-DPKUT410-COMMAREA           PIC  X(01)   VALUE SPACES.02270077
022800                                                                  02280077
022900******************************************************************02290077
023000**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **02300077
023100**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **02310077
023200**  APPLICATION-SPECIFIC COMMAREA.                              **02320077
023300******************************************************************02330077
023400 01  LQW-LIST-QUEUE-WORK-AREA.                                    02340077
023500     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  02350077
023600     05  LQW-ITEM-ENTRIES               OCCURS 4 TIMES            02360077
023700                                        INDEXED BY LQW-IDX.       02370077
023800         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       02380077
023900         10  LQW-PO-NUMBER              PIC  9(09).               02390077
024000         10  LQW-PO-REQ-NBR             PIC S9(09)  COMP.         02400077
024100         10  LQW-REQUEST-DATE           PIC  X(10).               02410077
024200         10  LQW-PRINT-DATE             PIC  X(10).               02420077
024300         10  LQW-VENDOR-DUE-DATE        PIC  X(10).               02430077
024400                                                                  02440077
024500*---------------------------------------------------------------* 02450077
024600*  RECORD LAYOUT FOR THE REQUEST SELECTION TEMP STORAGE QUEUE.  * 02460077
024700*---------------------------------------------------------------* 02470077
024900     COPY VLWS003.                                                02490085
025000                                                                  02500077
025100*---------------------------------------------------------------* 02510077
025200*  RECORD LAYOUT FOR THE REQUEST COMMENT TEMP STORAGE QUEUE.    * 02520077
025300*---------------------------------------------------------------* 02530077
025500     COPY VLWS001.                                                02550085
025600                                                                  02560077
025700*---------------------------------------------------------------* 02570077
025800*  RECORD LAYOUT FOR THE MULTIPLE SHIPMENT TEMP STORAGE QUEUE.  * 02580077
025900*---------------------------------------------------------------* 02590077
026100     COPY VLWS004.                                                02610085
026200                                                                  02620077
026400*---------------------------------------------------------------* 02640077
026500*    MAP LAYOUT                                                 * 02650077
026600*---------------------------------------------------------------* 02660077
026800     COPY VLKM507.                                                02680077
026900*                                                                 02690077
027000 01  MR-OCCURS-LAYOUT                   REDEFINES  VL507AO.       02700077
027100     05  FILLER                         PIC X(42).                02710077
027200     05  MR-SCROLL-AREA                 OCCURS 04 TIMES.          02720077
027300         10  FILLER                     PIC  X(05).               02730077
027400         10  MR-PO-NUMBER.                                        02740077
027500             15  MR-PO-NUMBER-N         PIC  9(08).               02750077
027600                                                                  02760077
027700         10  FILLER                     PIC  X(05).               02770077
027800         10  MR-REQUEST-DATE            PIC  X(10).               02780077
027900                                                                  02790077
028000         10  FILLER                     PIC  X(05).               02800077
028100         10  MR-PRINT-DATE              PIC  X(10).               02810077
028200                                                                  02820077
028300         10  FILLER                     PIC  X(05).               02830077
028400         10  MR-VENDOR-DUE-DATE         PIC  X(10).               02840077
028500                                                                  02850077
028700*---------------------------------------------------------------* 02870077
028800*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02880077
028900*---------------------------------------------------------------* 02890077
029100     COPY DPWS015.                                                02910085
029200                                                                  02920077
029300*---------------------------------------------------------------* 02930077
029400*    FUNCTION KEYS COPYBOOK.                                    * 02940077
029500*---------------------------------------------------------------* 02950077
029700     COPY DPWS016.                                                02970085
029800                                                                  02980077
029900*---------------------------------------------------------------* 02990077
030000*    NUMERIC EDIT LAYOUT.                                       * 03000077
030100*---------------------------------------------------------------* 03010077
030300     COPY DPWS010I.                                               03030085
030200                                                                  03031084
030400*---------------------------------------------------------------* 03040077
030500*    WORKING STORAGE LAYOUT FOR THE TS QUEUE (FROM SHIPMENT     * 03050077
030600*    LIST SCREEN                                                * 03060077
030700*---------------------------------------------------------------* 03070077
030900     COPY VLWS012.                                                03090085
031000                                                                  03100084
031100*---------------------------------------------------------------* 03110077
031200*    WORKING STORAGE INCLUDE FOR THE CALENDAR ROUTINE           * 03120077
031300*---------------------------------------------------------------* 03130077
031500     COPY DPWS500.                                                03150085
031600                                                                  03160084
031700*---------------------------------------------------------------* 03170077
031800*    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API           * 03180086
031900*---------------------------------------------------------------* 03190077
032100     COPY DPWS030.                                                03210085
CICS       COPY DPWS930.                                                03211086
032200                                                                  03220084
032300*---------------------------------------------------------------* 03230077
032400*    STANDARD COMMAREA.                                         * 03240077
032500*---------------------------------------------------------------* 03250077
032700     COPY DPWS020.                                                03270085
032800     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03280077
032900                                                                  03290077
033000*---------------------------------------------------------------* 03300077
033100* INTER-APPLICATION COMMAREA.                                   * 03310077
033200*   VLWS002 - IS THE INPUT LAYOUT WHEN COMING FROM THE PRINTED  * 03320077
033300*             REQUEST LIST SCREEN                               * 03330077
033400*   VLWS011 - IS THE INPUT LAYOUT WHEN COMING FROM THE SHIPMENT * 03340077
033500*             MAINTANENCE CRIT SPEC OR LIST SCREENS             * 03350077
033600*   VLWS002 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 03360077
033700*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 03370077
033800*---------------------------------------------------------------* 03380077
033900                                                                  03390077
034000         10  INTER-APPL-COMM-AREA       PIC X(200).               03400077
034100     COPY VLWS002.                                                03410085
034200     COPY VLWS011.                                                03420085
034300*---------------------------------------------------------------* 03430077
034400*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03440077
034500*---------------------------------------------------------------* 03450077
034600         10  ASC-SPECIFIC-COMMAREA.                               03460077
034700             15  ASC-LIST-KEYS.                                   03470077
034900                 20  ASC-KEY-PO-NUMBER               PIC S9(09)   03490077
035000                                                     COMP.        03500077
035100                 20  ASC-KEY-ENT-ID                  PIC S9(09)   03510077
035200                                                     COMP.        03520077
035300                 20  ASC-KEY-VENDOR-NAME             PIC  X(30).  03530077
035400                 20  ASC-KEY-SHIPT-GRP-ID            PIC S9(09)   03540077
035500                                                          COMP.   03550077
035600                 20  ASC-KEY-CMNT-ID                 PIC S9(09)   03560077
035700                                                          COMP.   03570077
035800             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03580077
035900                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03590077
036000                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03600077
036100                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03610077
036200                                                                  03620077
036300                 20  ASC-ITEM-ARRAY.                              03630077
036400                     25  ASC-ITEM-ENTRIES OCCURS  4 TIMES.        03640077
036500                         30  ASC-LIST-ITEM-NUMBER                 03650077
036600                                                     PIC S9(09)   03660077
036700                                                     COMP-3.      03670077
036800                         30  ASC-PO-NUMBER           PIC  9(09).  03680077
036900                         30  ASC-PO-REQ-NBR          PIC S9(09)   03690077
037000                                                         COMP.    03700077
037100                         30  ASC-REQUEST-DATE        PIC X(10).   03710077
037200                         30  ASC-PRINT-DATE          PIC X(10).   03720077
037300                         30  ASC-VENDOR-DUE-DATE     PIC X(10).   03730077
037400                                                                  03740077
037500                                                                  03750077
037600             15  ASC-SCREEN-FIELDS.                               03760077
037700                 20 ASC-SCAC-CDE                     PIC  X(04).  03770077
037800                 20 ASC-SHIP-DATE                    PIC  X(10).  03780077
037900                 20 ASC-SHIP-METHOD                  PIC  X(10).  03790077
038000                 20 ASC-CARRIER-SHIP-NBR             PIC  X(18).  03800077
038100                 20 ASC-PACKAGE-COUNT.                            03810077
038200                     25 ASC-PACKAGE-COUNT-N          PIC  9(03).  03820077
038300                 20 ASC-ENT-ID                       PIC S9(09)   03830077
038400                                                         COMP.    03840077
038500                 20 ASC-VENDOR-NAME                  PIC  X(40).  03850077
038600                 20 ASC-ADDR-SEQ-NBR                 PIC S9(04)   03860077
038700                                                         COMP.    03870077
038800                 20  ASC-ADDR-LINE-TABLE.                         03880077
038900                     25  FILLER OCCURS 08 TIMES                   03890077
039000                         INDEXED BY ASC-ADDR-IDX.                 03900077
039100                         30  ASC-ADDR-LINE           PIC  X(40).  03910077
039200             15  ASC-CURRENT-DATE                    PIC  X(10).  03920077
039300             15  ASC-BLK-SUB                         PIC S9(04)   03930077
039400                                                          COMP    03940077
039500                                                          SYNC.   03950077
039600             15  ASC-ITEM-SUB                        PIC S9(04)   03960077
039700                                                          COMP    03970077
039800                                                          SYNC.   03980077
039900             15  ASC-SEL-SUB                         PIC S9(04)   03990077
040000                                                         COMP.    04000077
040100             15  ASC-SEL-ITEM                        PIC S9(04)   04010077
040200                                                         COMP.    04020077
040300             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   04030077
040400                                                          COMP-3. 04040077
040500             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   04050077
040600                                                          COMP-3. 04060077
040700             15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(09)   04070077
040800                                                          COMP-3. 04080077
040900             15  ASC-NUMBER-OF-SHIP-RECS             PIC S9(09)   04090077
041000                                                          COMP-3. 04100077
041100             15  ASC-NUMBER-OF-SHIP-TS-ITEMS         PIC S9(09)   04110077
041200                                                          COMP-3. 04120077
041300             15  ASC-NUMBER-OF-COMM-RECS             PIC S9(09)   04130077
041400                                                          COMP-3. 04140077
041500             15  ASC-NUMBER-OF-COMM-TS-ITEMS         PIC S9(09)   04150077
041600                                                          COMP-3. 04160077
041700             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   04170077
041800                                                          COMP-3. 04180077
041900             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   04190077
042000                                                          COMP-3. 04200077
042100             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   04210077
042200                                                          COMP-3. 04220077
042300             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   04230077
042400                                                          COMP    04240077
042500                                                          SYNC.   04250077
042600             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   04260077
042700                                                          COMP-3. 04270077
042800             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   04280077
042900                                                          COMP-3. 04290077
043000             15  ASC-FORMAT-INDICATOR                PIC X(01).   04300077
043100                 88  ASC-PRINT-LIST-FORMAT       VALUE  '1'.      04310077
043200                 88  ASC-CRIT-SPEC-FORMAT        VALUE  '2', '3'. 04320083
043300                 88  ASC-SHIP-LIST-FORMAT        VALUE  '4', '5'. 04330083
043400                 88  ASC-CREATE-SHIP-FORMAT      VALUE  '1'.      04340077
043500                 88  ASC-UPDATE-SHIP-FORMAT      VALUE  '2', '4'. 04350083
043600                 88  ASC-DELETE-SHIP-FORMAT      VALUE  '3', '5'. 04360083
043700             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  04370077
043800                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   04380077
043900                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   04390077
044000             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  04400077
044100                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   04410077
044200                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   04420077
044300             15  ASC-LIST-QUEUE-NAME.                             04430077
044400                 20  ASC-LIST-TERM-ID                PIC  X(04).  04440077
044500                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   04450077
044600                                                          COMP-3. 04460077
044700                 20  ASC-LIST-SEQ                    PIC  9(01).  04470077
044800             15  ASC-SEL-QUEUE-NAME.                              04480077
044900                 20  ASC-SEL-TERM-ID                 PIC  X(04).  04490077
045000                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   04500077
045100                                                          COMP-3. 04510077
045200                 20  ASC-SEL-SEQ                     PIC  9(01).  04520077
045300             15  ASC-SHIP-QUEUE-NAME.                             04530077
045400                 20  ASC-SHIP-TERM-ID                PIC  X(04).  04540077
045500                 20  ASC-SHIP-TASK-NUMBER            PIC S9(05)   04550077
045600                                                          COMP-3. 04560077
045700                 20  ASC-SHIP-SEQ                    PIC  9(01).  04570077
045800                                                                  04580077
045900             15  ASC-COMMENT-QUEUE-NAME.                          04590077
046000                 20  ASC-COMMENT-TERM-ID             PIC  X(04).  04600077
046100                 20  ASC-COMMENT-TASK-NUMBER         PIC S9(05)   04610077
046200                                                          COMP-3. 04620077
046300                 20  ASC-COMMENT-SEQ                 PIC  9(01).  04630077
046400                                                                  04640077
046500             15  ASC-CURSOR-SW                       PIC  X(01).  04650077
046600                 88  ASC-NO-CURSOR                   VALUE ' '.   04660077
046700                 88  ASC-PO-CURSOR                   VALUE 'P'.   04670077
046800                 88  ASC-DPT-CURSOR                  VALUE 'D'.   04680077
046900                 88  ASC-VND-CURSOR                  VALUE 'V'.   04690077
047000                 88  ASC-DPTVND-CURSOR               VALUE 'B'.   04700077
047100             15  ASC-START-ITEM-REQUEST.                          04710077
047200                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  04720077
047300                                                                  04730084
047400*---------------------------------------------------------------* 04740077
047500*    ABEND PROCESSING COPYBOOK.                                 * 04750077
047600*---------------------------------------------------------------* 04760077
047700                                                                  04770077
047800     COPY DPWS013.                                                04780085
047900                                                                  04790077
048000******************************************************************04800077
048100*  WORKING STORAGE AREA FOR COUNTRY AND STATE RETRIEVAL           04810077
048200******************************************************************04820077
048300     COPY DPWS410.                                                04830085
048400                                                                  04840077
048600*---------------------------------------------------------------* 04860077
048700*    DB2 AREA FOR TMESSAGE                                      * 04870077
048800*---------------------------------------------------------------* 04880077
048900     EXEC SQL                                                     04890077
049000          INCLUDE TSYMSG                                          04900077
049100     END-EXEC.                                                    04910077
049800                                                                  04911084
049200*---------------------------------------------------------------* 04920077
049300*    DB2 AREA FOR COMMUNICATIONS                                * 04930077
049400*---------------------------------------------------------------* 04940077
049500     EXEC SQL                                                     04950077
049600          INCLUDE SQLCA                                           04960077
049700     END-EXEC.                                                    04970077
049800                                                                  04980077
049900*---------------------------------------------------------------* 04990077
050000*    DB2 AREA THE REQUEST SHIPMENT ASSOCIATION TABLE            * 05000077
050100*---------------------------------------------------------------* 05010077
050200     EXEC SQL                                                     05020077
050300          INCLUDE TREQSHP                                         05030077
050400     END-EXEC.                                                    05040077
050500                                                                  05050077
050600*---------------------------------------------------------------* 05060077
050700*    DB2 AREA THE REQUEST SHIPMENT TABLE                        * 05070077
050800*---------------------------------------------------------------* 05080077
050900     EXEC SQL                                                     05090077
051000          INCLUDE TPTKSHP                                         05100077
051100     END-EXEC.                                                    05110077
051200                                                                  05120077
051300*---------------------------------------------------------------* 05130077
051400*    DB2 AREA THE REQUEST COMMENT TABLE                         * 05140077
051500*---------------------------------------------------------------* 05150077
051600     EXEC SQL                                                     05160077
051700          INCLUDE TPTKCMT                                         05170077
051800     END-EXEC.                                                    05180077
051900                                                                  05190077
052000*---------------------------------------------------------------* 05200077
052100*    DB2 AREA THE BUISNESS LOCATION TABLE                       * 05210077
052200*---------------------------------------------------------------* 05220077
052300     EXEC SQL                                                     05230077
052400          INCLUDE TBUSLOC                                         05240077
052500     END-EXEC.                                                    05250077
052600                                                                  05260077
052700*---------------------------------------------------------------* 05270077
052800*    DB2 AREA THE EXTERNAL ENTERPRISE TABLE                     * 05280077
052900*---------------------------------------------------------------* 05290077
053000     EXEC SQL                                                     05300077
053100          INCLUDE TEXTENT                                         05310077
053200     END-EXEC.                                                    05320077
053300                                                                  05330077
053400*---------------------------------------------------------------* 05340077
053500*    DB2 AREA THE ENTERPRISE REPRESENTATIVE TABLE               * 05350077
053600*---------------------------------------------------------------* 05360077
053700     EXEC SQL                                                     05370077
053800          INCLUDE TENTREP                                         05380077
053900     END-EXEC.                                                    05390077
054000                                                                  05400077
054100*---------------------------------------------------------------* 05410077
054200*    DB2 AREA THE PRETICKET REQUEST TABLE                       * 05420077
054300*---------------------------------------------------------------* 05430077
054400     EXEC SQL                                                     05440077
054500          INCLUDE TPTKREQ                                         05450077
054600     END-EXEC.                                                    05460077
054700                                                                  05470077
054800*---------------------------------------------------------------* 05480077
054900*    DB2 AREA THE PRETICKET REQUEST LINE TABLE                  * 05490077
055000*---------------------------------------------------------------* 05500077
055100     EXEC SQL                                                     05510077
055200          INCLUDE TPTKLNE                                         05520077
055300     END-EXEC.                                                    05530077
055400                                                                  05540077
055500*---------------------------------------------------------------* 05550077
055600*    DB2 AREA THE ENTERPRISE NAME TABLE                         * 05560077
055700*---------------------------------------------------------------* 05570077
055800     EXEC SQL                                                     05580077
055900          INCLUDE TENTNME                                         05590077
056000     END-EXEC.                                                    05600077
056100                                                                  05610077
056200*---------------------------------------------------------------* 05620077
056300*    SHIPMENT CURSOR FOR WHEN THE PROGRAM IS UPDATING AN        * 05630077
056400*    EXISTING SHIPMENT.                                         * 05640077
056500*---------------------------------------------------------------* 05650077
056600                                                                  05660077
056700     EXEC SQL                                                     05670077
056800          DECLARE UPDATE_CURSOR  CURSOR                           05680077
056900          FOR SELECT                                              05690077
057000                A.PO_REQ_NBR                                      05700077
057100              , A.PO_NBR                                          05710077
057200              , A.REQ_CREN_DTE                                    05720077
057300              , A.ACTL_PRT_DTE                                    05730077
057400              , A.VND_DUE_DTE                                     05740077
057500              , A.ENT_ID                                          05750077
057600              , A.ADDR_SEQ_NBR                                    05760077
057700              , C.ENT_NAME_DESC                                   05770077
057800          FROM                                                    05780077
057900                TPTKREQ A                                         05790077
058000              , TREQSHP B                                         05800077
058100              , TENTNME C                                         05810077
058200          WHERE                                                   05820077
058300                A.PO_REQ_NBR = B.PO_REQ_NBR                       05830077
058400            AND B.SHIPT_GRP_ID = :DK-SHIPT-GRP-ID                 05840077
058500            AND A.ENT_ID     = C.ENT_ID                           05850077
058600            AND C.TYPE_CDE = '01'                                 05860077
058700          GROUP BY                                                05870077
058800                A.PO_REQ_NBR                                      05880077
058900              , A.PO_NBR                                          05890077
059000              , A.REQ_CREN_DTE                                    05900077
059100              , A.ACTL_PRT_DTE                                    05910077
059200              , A.VND_DUE_DTE                                     05920077
059300              , A.ENT_ID                                          05930077
059400              , A.ADDR_SEQ_NBR                                    05940077
059500              , C.ENT_NAME_DESC                                   05950077
059600          ORDER BY                                                05960077
059700                A.ACTL_PRT_DTE, A.PO_NBR                          05970077
059800     END-EXEC.                                                    05980077
059900*---------------------------------------------------------------* 05990077
060000*    SHIPMENT CURSOR TO GET ALL THE SHIPMENTS FOR A PO          * 06000077
060100*    FOR DELETION (USED WHEN UPDATING - ALL COMMENTS ARE DELETED* 06010077
060200*    FOR DELETION (USED WHEN UPDATING - ALL COMMENTS ARE DELETED* 06020077
060300*---------------------------------------------------------------* 06030077
060400                                                                  06040077
060500     EXEC SQL                                                     06050077
060600          DECLARE SHIP_DEL_CURSOR CURSOR                          06060077
060700          FOR SELECT                                              06070077
060800                A.SHIPT_NBR                                       06080077
060900          FROM                                                    06090077
061000                TREQSHP A                                         06100077
061100          WHERE                                                   06110077
061200                A.PO_REQ_NBR = :DK-PO-REQ-NBR                     06120077
061300     END-EXEC.                                                    06130077
061400                                                                  06140077
061500*---------------------------------------------------------------* 06150077
061600*    SHIPMENT CURSOR TO GET ALL THE SHIPMENTS FOR UPDATING      * 06160077
061700*---------------------------------------------------------------* 06170077
061800                                                                  06180077
061900     EXEC SQL                                                     06190077
062000          DECLARE SHIPMENT_CURSOR CURSOR                          06200077
062100          FOR SELECT                                              06210077
062200                A.SHIPT_TYP_DESC                                  06220077
062300             ,  A.SCAC_CDE                                        06230077
062400             ,  A.CARR_SHIPT_ID                                   06240077
062500             ,  A.SHPD_PKG_CNT                                    06250077
062600             ,  A.SHIPT_DTE                                       06260077
062700          FROM                                                    06270077
062800                TREQSHP B                                         06280077
062900              , TPTKSHP A                                         06290077
063000          WHERE                                                   06300077
063100                B.SHIPT_GRP_ID = :DK-SHIPT-GRP-ID                 06310077
063200            AND A.SHIPT_NBR    = B.SHIPT_NBR                      06320077
063300          GROUP BY                                                06330077
063400                A.SHIPT_TYP_DESC                                  06340077
063500             ,  A.SCAC_CDE                                        06350077
063600             ,  A.CARR_SHIPT_ID                                   06360077
063700             ,  A.SHPD_PKG_CNT                                    06370077
063800             ,  A.SHIPT_DTE                                       06380077
063900          ORDER BY A.CARR_SHIPT_ID                                06390077
064000     END-EXEC.                                                    06400077
064100                                                                  06410077
064200*---------------------------------------------------------------* 06420077
064300*    COMMENT CURSOR TO GET ALL THE COMMENTS FOR UPDATING        * 06430077
064400*---------------------------------------------------------------* 06440077
064500                                                                  06450077
064600     EXEC SQL                                                     06460077
064700          DECLARE COMMENT_CURSOR CURSOR                           06470077
064800          FOR SELECT DISTINCT                                     06480077
064900                A.PRE_TKT_CMNT_DESC                               06490077
065000             ,  A.SEQ_NBR                                         06500077
065100             ,  A.CMNT_ID                                         06510077
065200          FROM                                                    06520077
065300                TPTKCMT A                                         06530077
065400              , TREQSHP B                                         06540077
065500              , TPTKSHP C                                         06550077
065600          WHERE                                                   06560077
065700                B.SHIPT_GRP_ID = :DK-SHIPT-GRP-ID                 06570077
065800            AND B.SHIPT_NBR    = C.SHIPT_NBR                      06580077
065900            AND A.CMNT_ID      = C.CMNT_ID                        06590077
066000          ORDER BY A.SEQ_NBR                                      06600077
066100     END-EXEC.                                                    06610077
066200                                                                  06620077
066400 LINKAGE SECTION.                                                 06640077
066500                                                                  06650077
066600 01  DFHCOMMAREA.                                                 06660077
066700     05  FILLER                         OCCURS  1 TO 4072 TIMES   06670077
066800                                        DEPENDING ON EIBCALEN.    06680077
066900         10  FILLER                     PIC X.                    06690077
067000                                                                  06700077
067200 PROCEDURE DIVISION.                                              06720077
067300******************************************************************06730077
067400**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **06740077
067500**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **06750077
067600**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **06760077
067700******************************************************************06770077
067800 0000-MAIN-MODULE.                                                06780077
067900     INITIALIZE DP030-CICS-API-FIELDS.                            06790077
068000     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       06800077
068100     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          06810077
068200     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         06820077
068300     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       06830077
068400     MOVE LENGTH OF VL507AI        TO DP030-MAP-LENGTH (1).       06840077
068500     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     06850077
068600     PERFORM 0001-CALL-CICS-ARCH-API.                             06860077
068700*                                                                 06870077
068800     PERFORM 1000-CONTROL-PROCESSING                              06880077
068900*                                                                 06890077
069000     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     06900077
069100     PERFORM 0001-CALL-CICS-ARCH-API.                             06910077
069200                                                                  06920077
069300******************************************************************06930077
069400**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **06940077
069500**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **06950077
069600******************************************************************06960077
069700 0001-CALL-CICS-ARCH-API.                                         06970077
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      06980086
069900                                    DFHCOMMAREA                   06990086
070000                                    DP030-CICS-API-FIELDS         07000086
070100                                    DP020-STANDARD-COMMAREA       07010086
070200                                    VL507AI.                      07020086
070300*                                                                 07030077
070400     IF  DP030-RC-CALL-SUCCESSFUL                                 07040077
070500         CONTINUE                                                 07050077
070600     ELSE                                                         07060077
070700         SET DP013-NO-ROLLBACK                                    07070077
070800             DP013-XCTL-DISPLAY-RESTART                           07080077
070900             DP013-CICS-ABEND      TO TRUE                        07090077
071000         MOVE '0001-CALL-CICS-ARCH-API'                           07100077
071100                                   TO DP013-PARAGRAPH             07110077
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O07111086
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      07112086
071400         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      07140077
071500         PERFORM DP013-0000-PROCESS-ABEND                         07150077
071600     END-IF.                                                      07160077
072600                                                                  07161084
071700*----------------------------------------------------------------*07170077
071800* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *07180077
071900* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *07190077
072000*                                                                *07200077
072100* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *07210077
072200*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *07220077
072300*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *07230077
072400*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *07240077
072500*----------------------------------------------------------------*07250077
072700 1000-CONTROL-PROCESSING.                                         07270077
072900     EVALUATE TRUE                                                07290077
073000         WHEN DP020-NEXT-ACT-INITIAL                              07300077
073100             INITIALIZE ASC-SPECIFIC-COMMAREA                     07310077
073200             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            07320077
073300                                      ASC-SEL-TERM-ID             07330077
073400                                      ASC-SHIP-TERM-ID            07340077
073500                                      ASC-COMMENT-TERM-ID         07350077
073600             MOVE DP020-SRC-TASK-NUMBER                           07360077
073700                                   TO ASC-LIST-TASK-NUMBER        07370077
073800                                      ASC-SEL-TASK-NUMBER         07380077
073900                                      ASC-SHIP-TASK-NUMBER        07390077
074000                                      ASC-COMMENT-TASK-NUMBER     07400077
074100             MOVE PC-LIST-QUEUE-SEQ                               07410077
074200                                   TO ASC-LIST-SEQ                07420077
074300             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 07430077
074400             MOVE PC-SHIP-QUEUE-SEQ                               07440077
074500                                   TO ASC-SHIP-SEQ                07450077
074600             MOVE PC-COMMENT-QUEUE-SEQ                            07460077
074700                                   TO ASC-COMMENT-SEQ             07470077
074800             PERFORM 1100-PROCESS-INTER-APPL-COMM                 07480077
074900***-----$TEMPLATE NOTE$-------------------------------------------07490077
075000*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,07500077
075100*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  07510077
075200*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.07520077
075300***---------------------------------------------------------------07530077
075400             IF  PS-COMMAREA-NOT-VALID                            07540077
075900                 SET DP020-NEXT-ACT-APPL-ERROR                    07590077
076000                                   TO TRUE                        07600077
076100             ELSE                                                 07610077
076200                 PERFORM 4000-BUILD-INITIAL-PANEL                 07620077
076300                 IF ASC-DELETE-SHIP-FORMAT                        07630077
076400                     PERFORM 3200-RESET-ATTRIBUTES                07640077
076500                     MOVE PC-TSYMSG-00004                         07650077
076600                                   TO DP020-MSG-NUMBER            07660077
076700                     SET DP020-MSG-INFORMATIONAL                  07670077
076800                                   TO TRUE                        07680077
076900                 END-IF                                           07690077
077000             END-IF                                               07700077
077200         WHEN DP020-NEXT-ACT-READ-MAP                             07720077
077300             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        07730077
077400                                   TO PV-TOP-ITEM                 07740077
077500             PERFORM 2000-PROCESS-PANEL                           07750077
077700         WHEN DP020-NEXT-ACT-RETURN                               07770077
077800             EVALUATE DP020-INT-APPL-FORMAT-IND                   07780077
077900             WHEN PC-RETURN-FROM-MULT-SHIP                        07790077
078000                 MOVE VL002-NUMBER-OF-SHIP-RECS                   07800077
078100                      TO ASC-NUMBER-OF-SHIP-RECS                  07810077
078200                 MOVE VL002-NUMBER-OF-SHIP-TS-ITEMS               07820077
078300                      TO ASC-NUMBER-OF-SHIP-TS-ITEMS              07830077
078400                 MOVE VL002-SHIP-QUEUE-NAME                       07840077
078500                      TO ASC-SHIP-QUEUE-NAME                      07850077
078600                 IF ASC-NUMBER-OF-SHIP-RECS < 1                   07860077
078700                     MOVE SPACES TO ASC-CARRIER-SHIP-NBR          07870077
078800                                    ASC-PACKAGE-COUNT             07880077
078900                 ELSE                                             07890077
079000                     MOVE +1 TO PV-SHIP-ITEM                      07900077
079100                     PERFORM 9302-READ-SHIP-QUEUE                 07910077
079200                     MOVE VL004-CARRIER-SHIP-NBR (1)              07920077
079300                          TO ASC-CARRIER-SHIP-NBR                 07930077
079400                     MOVE VL004-PACKAGE-COUNT (1)                 07940077
079500                          TO ASC-PACKAGE-COUNT                    07950077
079600                 END-IF                                           07960077
079800             WHEN PC-RETURN-FROM-COMMENTS                         07980077
079900                 MOVE VL002-NUMBER-OF-COMM-RECS                   07990077
080000                      TO ASC-NUMBER-OF-COMM-RECS                  08000077
080100                 MOVE VL002-NUMBER-OF-COMM-TS-ITEMS               08010077
080200                      TO ASC-NUMBER-OF-COMM-TS-ITEMS              08020077
080300                 MOVE VL002-COMMENT-QUEUE-NAME                    08030077
080400                      TO ASC-COMMENT-QUEUE-NAME                   08040077
080500             END-EVALUATE                                         08050077
080600                                                                  08060077
080700             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        08070077
080800                                   TO PV-TOP-ITEM                 08080077
080900             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    08090077
081000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   08100077
081100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08110077
081300         WHEN OTHER                                               08130077
081400             SET DP013-LOGIC-ABEND TO TRUE                        08140077
081500             SET DP013-NO-ROLLBACK TO TRUE                        08150077
081600             MOVE '1000-CONTROL-PROCESSING'                       08160077
081700                                   TO DP013-PARAGRAPH             08170077
081800             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    08180077
081900                                   TO DP013-MESSAGE-TEXT(1)       08190077
082000             PERFORM DP013-0000-PROCESS-ABEND                     08200077
082100     END-EVALUATE.                                                08210077
082200                                                                  08220077
082400*----------------------------------------------------------------*08240077
082500* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *08250077
082600* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *08260077
082700*----------------------------------------------------------------*08270077
082900 1100-PROCESS-INTER-APPL-COMM.                                    08290077
083000     SET PS-COMMAREA-VALID         TO TRUE.                       08300077
083100     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     08310077
083200                                                                  08320077
083300     MOVE DP020-INT-APPL-FORMAT-IND                               08330077
083400                                   TO ASC-FORMAT-INDICATOR.       08340077
083500     EVALUATE TRUE                                                08350077
083600         WHEN ASC-PRINT-LIST-FORMAT                               08360077
083700             MOVE VL002-SEL-QUEUE-NAME                            08370077
083800                                   TO ASC-SEL-QUEUE-NAME          08380077
083900             MOVE VL002-NUMBER-OF-SELECTED-ITEMS                  08390077
084000                                  TO ASC-NUMBER-OF-SELECTED-ITEMS 08400077
084100             MOVE VL002-NUMBER-OF-TS-ITEMS                        08410077
084200                                   TO ASC-NUMBER-OF-TS-ITEMS      08420077
084400             MOVE VL002-ENT-ID     TO ASC-ENT-ID                  08440077
084500             MOVE VL002-VENDOR-NAME                               08450077
084600                                   TO ASC-VENDOR-NAME             08460077
084700             MOVE VL002-ADDR-SEQ-NBR                              08470077
084800                                   TO ASC-ADDR-SEQ-NBR            08480077
085000         WHEN ASC-CRIT-SPEC-FORMAT                                08500077
085100             MOVE VL011-SHIPT-GRP-ID   TO ASC-KEY-SHIPT-GRP-ID    08510077
085200                                          DK-SHIPT-GRP-ID         08520077
085300         WHEN ASC-SHIP-LIST-FORMAT                                08530077
085400             MOVE VL011-NUMBER-OF-TS-ITEMS                        08540077
085500                               TO ASC-NUMBER-OF-TS-ITEMS          08550077
085600             MOVE VL011-SEL-QUEUE-NAME                            08560077
085700                               TO ASC-SEL-QUEUE-NAME              08570077
085800             PERFORM 1120-PREPARE-LIST-ENTRY                      08580077
085900         WHEN OTHER                                               08590077
086000             SET PS-COMMAREA-NOT-VALID TO TRUE                    08600077
086100     END-EVALUATE.                                                08610077
086200                                                                  08620077
086400*----------------------------------------------------------------*08640077
086500*    GET READY TO START AT THE FIRST ITEM ON THE LIST.           *08650077
086600*----------------------------------------------------------------*08660077
086800 1120-PREPARE-LIST-ENTRY.                                         08680077
086900                                                                  08690077
087000     MOVE VL012-MAX-ITEMS TO ASC-SEL-SUB.                         08700077
087100     MOVE ZERO            TO ASC-SEL-ITEM.                        08710077
087200     PERFORM 2140-GET-NEXT-SHIPMENT.                              08720077
087300                                                                  08730084
087400*----------------------------------------------------------------*08740077
087500* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *08750077
087600* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *08760077
087700* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *08770077
087800* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *08780077
087900* FUNCTION KEYS CAN GET THIS FAR.                                *08790077
088000*----------------------------------------------------------------*08800077
088200 2000-PROCESS-PANEL.                                              08820077
088300     EVALUATE TRUE                                                08830077
088400         WHEN DP020-SRC-AID = DP016-CLEAR                         08840077
088500             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    08850077
088600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   08860077
088700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08870077
088900         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    08890077
089000             MOVE ASC-KEY-SHIPT-GRP-ID TO DK-SHIPT-GRP-ID         08900077
089100             PERFORM 2050-DELETE-LIST-QUEUE                       08910077
089200             PERFORM 9290-DELETE-COMMENT-QUEUE                    08920077
089300             PERFORM 9390-DELETE-SHIP-QUEUE                       08930077
089400             PERFORM 4000-BUILD-INITIAL-PANEL                     08940077
089600         WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                    08960077
089700             MOVE ASC-KEY-SHIPT-GRP-ID TO DK-SHIPT-GRP-ID         08970077
089800             PERFORM 8000-DELETE-SHIPMENT                         08980077
090000         WHEN OTHER                                               09000077
090100             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 09010077
090200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   09020077
090300             IF  PS-NO-ERROR                                      09030077
090400                 SET DP030-CONTINUE-GO                            09040077
090500                                 TO TRUE                          09050077
090600                 PERFORM 2100-CHECK-FUNCTION-KEY                  09060077
090700             ELSE                                                 09070077
090800                 SET DP030-OVERRIDE-GO                            09080077
090900                                 TO TRUE                          09090077
091000             END-IF                                               09100077
091100     END-EVALUATE.                                                09110077
091200                                                                  09120084
091300*----------------------------------------------------------------*09130077
091400*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *09140077
091500*----------------------------------------------------------------*09150077
091600 2050-DELETE-LIST-QUEUE.                                          09160077
091800     EXEC CICS                                                    09180077
091900         DELETEQ TS                                               09190077
092000             QUEUE (ASC-LIST-QUEUE-NAME)                          09200077
092100             RESP  (PV-CICS-RESP)                                 09210077
092200     END-EXEC.                                                    09220077
092300                                                                  09230077
092400     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       09240077
092500        (PV-CICS-RESP = DFHRESP(QIDERR))                          09250077
092600         CONTINUE                                                 09260077
092700     ELSE                                                         09270077
092800         SET DP013-CICS-ABEND      TO TRUE                        09280077
092900         SET DP013-NO-ROLLBACK     TO TRUE                        09290077
093000                                                                  09300077
093100         MOVE '2050-DELETE-LIST-QUEUE'                            09310077
093200                                   TO DP013-PARAGRAPH             09320077
093300         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    09330077
093400                                   TO DP013-MESSAGE-TEXT (1)      09340077
093500         PERFORM DP013-0000-PROCESS-ABEND                         09350077
093600     END-IF.                                                      09360077
093700                                                                  09370077
093800     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  09380077
093900                                                                  09390084
094000*----------------------------------------------------------------*09400077
094100* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*09410077
094200* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *09420077
094300* CICS ARCHITECTURE API.                                         *09430077
094400*----------------------------------------------------------------*09440077
094500 2100-CHECK-FUNCTION-KEY.                                         09450077
094600     EVALUATE TRUE                                                09460077
094800*        UPDATE KEY WAS PRESSED                                   09480077
094900         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              09490077
095000             IF ASC-NUMBER-OF-SHIP-RECS = 0                       09500077
095100                 MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER        09510077
095200                 MOVE -1               TO ASTRTITL                09520077
095300                 SET DP030-SET-CURSOR-APPL-1                      09530077
095400                     DP030-OVERRIDE-GO                            09540077
095500                     DP020-MSG-FATAL                              09550077
095600                     PS-ERROR          TO TRUE                    09560077
095700                 MOVE DP015-REVERSE    TO ACSNBRH                 09570077
095800                                          APACKSH                 09580077
095900                 MOVE DP015-RED        TO ACSNBRC                 09590077
096000                                          APACKSC                 09600077
096100                 MOVE DP015-UNP-ALP-BRT-OFF                       09610077
096200                                       TO ACSNBRA                 09620077
096300                                          APACKSA                 09630077
096400             ELSE                                                 09640077
096500                 PERFORM 7000-UPDATE-SHIPMENT                     09650077
096600             END-IF                                               09660077
096800*        MULTISHIP KEY WAS PRESSED                                09680077
096900         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              09690077
097000             MOVE ASC-NUMBER-OF-SHIP-RECS                         09700077
097100                  TO VL002-NUMBER-OF-SHIP-RECS                    09710077
097200             MOVE ASC-NUMBER-OF-SHIP-TS-ITEMS                     09720077
097300                  TO VL002-NUMBER-OF-SHIP-TS-ITEMS                09730077
097400             MOVE ASC-SHIP-QUEUE-NAME                             09740077
097500                  TO VL002-SHIP-QUEUE-NAME                        09750077
097700*        COMMMENTS KEY WAS PRESSED                                09770077
097800         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              09780077
097900             MOVE ASC-NUMBER-OF-COMM-RECS                         09790077
098000                  TO VL002-NUMBER-OF-COMM-RECS                    09800077
098100             MOVE ASC-NUMBER-OF-COMM-TS-ITEMS                     09810077
098200                  TO VL002-NUMBER-OF-COMM-TS-ITEMS                09820077
098300             MOVE ASC-COMMENT-QUEUE-NAME                          09830077
098400                  TO VL002-COMMENT-QUEUE-NAME                     09840077
098600         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  09860077
098700             MOVE +1               TO PV-TOP-ITEM                 09870077
098800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09880077
099000         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   09900077
099100             PERFORM 2110-BROWSE-BACKWARD                         09910077
099200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09920077
099400         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   09940077
099500             PERFORM 2120-BROWSE-FORWARD                          09950077
099600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09960077
099800         WHEN DP020-SRC-AID = DP016-ENTER                         09980077
099900             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   09990077
100000             IF  PS-ERROR                                         10000077
100100                 CONTINUE                                         10010077
100200             ELSE                                                 10020077
100300                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             10030077
100400             END-IF                                               10040077
100600         WHEN OTHER                                               10060077
100700             SET DP013-NO-ROLLBACK                                10070077
100800                 DP013-XCTL-DISPLAY-RESTART                       10080077
100900                 DP013-CICS-ABEND  TO TRUE                        10090077
101000             MOVE '2100-CHECK-FUNCTION-KEY'                       10100077
101100                                   TO DP013-PARAGRAPH             10110077
101200             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      10120077
101300                                   TO DP013-MESSAGE-TEXT (1)      10130077
101400             PERFORM DP013-0000-PROCESS-ABEND                     10140077
101500     END-EVALUATE.                                                10150077
101600*                                                                 10160077
101700*----------------------------------------------------------------*10170077
101800*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *10180077
101900*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *10190077
102000*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *10200077
102100*    MESSAGE.                                                    *10210077
102200*----------------------------------------------------------------*10220077
102400 2110-BROWSE-BACKWARD.                                            10240077
102500     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    10250077
102600         GIVING PV-TOP-ITEM.                                      10260077
102700*                                                                 10270077
102800     IF  ((PV-TOP-ITEM < +1)                                      10280077
102900       OR (PV-TOP-ITEM = +1))                                     10290077
103000         MOVE +1                   TO PV-TOP-ITEM                 10300077
103100*        -- TOP OF LIST --                                        10310077
103200         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            10320077
103300         SET DP020-MSG-INFORMATIONAL TO TRUE                      10330077
103400     END-IF.                                                      10340077
103500                                                                  10350077
103700*----------------------------------------------------------------*10370077
103800*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *10380077
103900*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *10390077
104000*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *10400077
104100*----------------------------------------------------------------*10410077
104300 2120-BROWSE-FORWARD.                                             10430077
104500     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              10450077
104600         GIVING PV-TOP-ITEM.                                      10460077
104700     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   10470077
104800         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            10480077
104900                                   TO PV-TOP-ITEM                 10490077
105000*        -- BOTTOM OF LIST --                                     10500077
105100         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            10510077
105200         SET DP020-MSG-INFORMATIONAL                              10520077
105300                                   TO TRUE                        10530077
105400     ELSE                                                         10540077
105500         COMPUTE PV-BOTTOM-ITEM =                                 10550077
105600             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 10560077
105700         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            10570077
105800*            -- BOTTOM OF LIST --                                 10580077
105900             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            10590077
106000             SET DP020-MSG-INFORMATIONAL                          10600077
106100                                   TO TRUE                        10610077
106200         END-IF                                                   10620077
106300     END-IF.                                                      10630077
106400                                                                  10640084
106500*----------------------------------------------------------------*10650077
106600*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *10660077
106700*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *10670077
106800*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *10680077
106900*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *10690077
107000*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *10700077
107100*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *10710077
107200*----------------------------------------------------------------*10720077
107400 2130-CHECK-FOR-JUMP-BROWSE.                                      10740077
107500     SET PS-NO-ERROR               TO TRUE.                       10750077
107600     IF (ASC-START-ITEM-REQUEST = SPACE)                          10760077
107700         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            10770077
107800                                   TO PV-TOP-ITEM                 10780077
107900     ELSE                                                         10790077
108000         MOVE ASC-START-ITEM-REQUEST                              10800077
108100                                   TO DP010I-UNEDITED-FIELD       10810077
108200         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       10820077
108300         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     10830077
108400         SET DP010I-NEGATIVE-NOT-ALLOWED                          10840077
108500                                   TO TRUE                        10850077
263627         CALL DP010I-NUMERIC-EDIT-ROUTINE                         10861085
263627              USING DP010I-NUMERIC-EDIT-AREA                      10862085
108700                                                                  10870077
108800         IF  NOT DP010I-ERROR-DETECTED                            10880077
108900             MOVE DP010I-NUMERIC-FIELD                            10890077
109000                                   TO  ASC-START-ITEM-REQUEST-N   10900077
109100             IF  ASC-START-ITEM-REQUEST-N > ZERO                  10910077
109200                 IF  ASC-START-ITEM-REQUEST-N >                   10920077
109300                                          ASC-NUMBER-OF-ITEMS-READ10930077
109400                     MOVE SPACE TO ASC-START-ITEM-REQUEST         10940077
109500                     COMPUTE PV-TOP-ITEM =                        10950077
109600                             ASC-NUMBER-OF-ITEMS-READ             10960077
109700                             - PC-ITEMS-PER-PANEL + 1             10970077
109800                     IF  PV-TOP-ITEM < +1                         10980077
109900                         MOVE +1   TO PV-TOP-ITEM                 10990077
110000                         MOVE PC-TSYMSG-00070                     11000077
110100                                   TO DP020-MSG-NUMBER            11010077
110200                         SET DP020-MSG-INFORMATIONAL              11020077
110300                                   TO TRUE                        11030077
110400                     END-IF                                       11040077
110500                 ELSE                                             11050077
110600                     MOVE ASC-START-ITEM-REQUEST-N                11060077
110700                                   TO PV-TOP-ITEM                 11070077
110800                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      11080077
110900                     COMPUTE PV-BOTTOM-ITEM =                     11090077
111000                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     11100077
111100                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ11110077
111200*                        -- BOTTOM OF LIST --                     11120077
111300                         MOVE PC-TSYMSG-00070                     11130077
111400                                   TO DP020-MSG-NUMBER            11140077
111500                         SET DP020-MSG-INFORMATIONAL              11150077
111600                                   TO TRUE                        11160077
111700                     END-IF                                       11170077
111800                 END-IF                                           11180077
111900             ELSE                                                 11190077
112000*                --- VALUE OUT OF RANGE ----                      11200077
112100                 MOVE PC-TSYMSG-00101                             11210077
112200                                   TO DP020-MSG-NUMBER            11220077
112300                 MOVE -1           TO ASTRTITL                    11230077
112400                 SET DP030-SET-CURSOR-APPL-1                      11240077
112500                                   TO TRUE                        11250077
112600                 MOVE DP015-REVERSE                               11260077
112700                                   TO ASTRTITH                    11270077
112800                 MOVE DP015-RED    TO ASTRTITC                    11280077
112900                 MOVE DP015-UNP-ALP-BRT-OFF                       11290077
113000                                   TO ASTRTITA                    11300077
113100                 SET DP020-MSG-FATAL                              11310077
113200                                   TO TRUE                        11320077
113300                 SET PS-ERROR      TO TRUE                        11330077
113400             END-IF                                               11340077
113600         ELSE                                                     11360077
113700             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            11370077
113800             MOVE -1               TO ASTRTITL                    11380077
113900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  11390077
114000             MOVE DP015-REVERSE    TO ASTRTITH                    11400077
114100             MOVE DP015-RED        TO ASTRTITC                    11410077
114200             MOVE DP015-UNP-ALP-BRT-OFF                           11420077
114300                                   TO ASTRTITA                    11430077
114400             SET DP020-MSG-FATAL   TO TRUE                        11440077
114500             SET PS-ERROR          TO TRUE                        11450077
114600         END-IF                                                   11460077
114700     END-IF.                                                      11470077
115200                                                                  11471084
114800*----------------------------------------------------------------*11480077
114900*    GET THE NEXT MESSAGE IF A LIST OF MESSAGES IS BEING         *11490077
115000*    PROCESSED.                                                  *11500077
115100*----------------------------------------------------------------*11510077
115300 2140-GET-NEXT-SHIPMENT.                                          11530077
115500     ADD +1                       TO ASC-SEL-SUB.                 11550077
115600     IF  ASC-SEL-SUB > VL012-MAX-ITEMS                            11560077
115700         ADD +1                   TO ASC-SEL-ITEM                 11570077
115800         MOVE +1                  TO ASC-SEL-SUB                  11580077
115900     END-IF.                                                      11590077
116000     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                11600077
116100         PERFORM 9100-READ-SEL-QUEUE                              11610077
116200         IF  VL012-ITEM (ASC-SEL-SUB) > ZERO                      11620077
116300             MOVE VL012-SHIPT-GRP-ID (ASC-SEL-SUB)                11630077
116400                                       TO ASC-KEY-SHIPT-GRP-ID    11640077
116500                                          DK-SHIPT-GRP-ID         11650077
116600             SET VL012-INQ (ASC-SEL-SUB) TO TRUE                  11660077
116700             PERFORM 9101-REWRITE-SEL-QUEUE                       11670077
116800         ELSE                                                     11680077
116900             SUBTRACT +1 FROM ASC-SEL-SUB                         11690077
117000             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             11700077
117100             SET DP020-MSG-INFORMATIONAL TO TRUE                  11710077
117200         END-IF                                                   11720077
117300     ELSE                                                         11730077
117400         SUBTRACT +1 FROM ASC-SEL-ITEM                            11740077
117500         MOVE VL012-MAX-ITEMS     TO ASC-SEL-SUB                  11750077
117600         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             11760077
117700         SET DP020-MSG-INFORMATIONAL TO TRUE                      11770077
117800     END-IF.                                                      11780077
117900                                                                  11790077
118100******************************************************************11810077
118200** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **11820077
118300** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **11830077
118400******************************************************************11840077
118500 2200-MOVE-SCREEN-TO-COMMAREA.                                    11850077
118700     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             11870077
118800     MOVE +1                       TO PV-SUB.                     11880077
118900*                                                                 11890077
119000     PERFORM 3100-SET-SUBSCRIPTS.                                 11900077
119100*                                                                 11910077
119200     IF  ASTRTITL > ZERO                                          11920077
119300         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          11930077
119400     ELSE                                                         11940077
119500         IF  ASTRTITF = DP015-ERASE-EOF                           11950077
119600             INITIALIZE ASC-START-ITEM-REQUEST                    11960077
119700         END-IF                                                   11970077
119800     END-IF.                                                      11980077
119900*                                                                 11990077
120000     IF  ASCACL > ZERO                                            12000077
120100         MOVE ASCACI           TO ASC-SCAC-CDE                    12010077
120200     ELSE                                                         12020077
120300         IF  ASCACF = DP015-ERASE-EOF                             12030077
120400             INITIALIZE ASC-SCAC-CDE                              12040077
120500         END-IF                                                   12050077
120600     END-IF.                                                      12060077
120700*                                                                 12070077
120800     IF  ASDATEL > ZERO                                           12080077
120900         MOVE ASDATEI          TO PV-DATE-USA                     12090077
121000         MOVE PV-DATE-CC-USA   TO PV-DATE-CC-ISO                  12101084
121000         MOVE PV-DATE-YY-USA   TO PV-DATE-YY-ISO                  12102084
121000         MOVE PV-DATE-MM-USA   TO PV-DATE-MM-ISO                  12103084
121000         MOVE PV-DATE-DD-USA   TO PV-DATE-DD-ISO                  12104084
121100         MOVE PV-DATE-ISO      TO ASC-SHIP-DATE                   12110077
121200     ELSE                                                         12120077
121300         IF  ASDATEF = DP015-ERASE-EOF                            12130077
121400             INITIALIZE ASC-SHIP-DATE                             12140077
121500         END-IF                                                   12150077
121600     END-IF.                                                      12160077
121700*                                                                 12170077
121800     IF  ASMETHL > ZERO                                           12180077
121900         MOVE ASMETHI          TO ASC-SHIP-METHOD                 12190077
122000     ELSE                                                         12200077
122100         IF  ASMETHF = DP015-ERASE-EOF                            12210077
122200             INITIALIZE ASC-SHIP-METHOD                           12220077
122300         END-IF                                                   12230077
122400     END-IF.                                                      12240077
122500*                                                                 12250077
122600     IF  ACSNBRL > ZERO                                           12260077
122700         MOVE ACSNBRI          TO ASC-CARRIER-SHIP-NBR            12270077
122800     ELSE                                                         12280077
122900         IF  ACSNBRF = DP015-ERASE-EOF                            12290077
123000             INITIALIZE ASC-CARRIER-SHIP-NBR                      12300077
123100         END-IF                                                   12310077
123200     END-IF.                                                      12320077
123300*                                                                 12330077
123400     IF  APACKSL > ZERO                                           12340077
123500         MOVE APACKSI          TO ASC-PACKAGE-COUNT               12350077
123600     ELSE                                                         12360077
123700         IF  APACKSF = DP015-ERASE-EOF                            12370077
123800             INITIALIZE ASC-PACKAGE-COUNT                         12380077
123900         END-IF                                                   12390077
124000     END-IF.                                                      12400077
124000                                                                  12401084
124100******************************************************************12410077
124200** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **12420077
124300** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **12430077
124400******************************************************************12440077
124500 3000-EDIT-DATA-IN-COMMAREA.                                      12450077
124600     SET PS-NO-ERROR               TO TRUE.                       12460077
124700     PERFORM 3200-RESET-ATTRIBUTES.                               12470077
124800                                                                  12480077
124900     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     12490077
125000**                                                                12500077
125100* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              12510077
125200* EDITTING IS DONE FROM THE BOTTOM UP.                            12520077
125300**                                                                12530077
125400     IF ASC-PACKAGE-COUNT-N = ZERO                                12540077
125500     OR ASC-PACKAGE-COUNT   = SPACES                              12550077
125600        MOVE +1 TO ASC-PACKAGE-COUNT-N                            12560077
125700     ELSE                                                         12570077
125800         MOVE ASC-PACKAGE-COUNT        TO DP010I-UNEDITED-FIELD   12580077
125900         MOVE +5                       TO DP010I-MAXIMUM-DIGITS   12590077
126000         MOVE +0                       TO DP010I-MAXIMUM-DECIMALS 12600077
126100         SET DP010I-NEGATIVE-NOT-ALLOWED                          12610077
126200                                       TO TRUE                    12620077
263627         CALL DP010I-NUMERIC-EDIT-ROUTINE                         12631085
263627              USING DP010I-NUMERIC-EDIT-AREA                      12632085
126400                                                                  12640077
126500         IF  NOT DP010I-ERROR-DETECTED                            12650077
126600             MOVE DP010I-NUMERIC-FIELD TO  ASC-PACKAGE-COUNT-N    12660077
126700         ELSE                                                     12670077
126800             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            12680077
126900             MOVE -1               TO APACKSL                     12690077
127000             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  12700077
127100             MOVE DP015-REVERSE    TO APACKSH                     12710077
127200             MOVE DP015-RED        TO APACKSC                     12720077
127300             MOVE DP015-UNP-ALP-BRT-OFF                           12730077
127400                                   TO APACKSA                     12740077
127500             SET DP020-MSG-FATAL   TO TRUE                        12750077
127600             SET PS-ERROR          TO TRUE                        12760077
127700         END-IF                                                   12770077
127800     END-IF.                                                      12780077
127900*                                                                 12790077
128000     IF ASC-SHIP-METHOD = SPACES                                  12800077
128100         MOVE PC-TSYMSG-00007  TO DP020-MSG-NUMBER                12810077
128200         MOVE -1               TO ASMETHL                         12820077
128300         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      12830077
128400         MOVE DP015-REVERSE    TO ASMETHH                         12840077
128500         MOVE DP015-RED        TO ASMETHC                         12850077
128600         MOVE DP015-UNP-ALP-BRT-OFF                               12860077
128700                               TO ASMETHA                         12870077
128800         SET DP020-MSG-FATAL   TO TRUE                            12880077
128900         SET PS-ERROR          TO TRUE                            12890077
129000     END-IF.                                                      12900077
129100*                                                                 12910077
130400     IF ASC-SHIP-DATE = SPACES                                    13040077
130500         MOVE ASC-CURRENT-DATE TO ASC-SHIP-DATE                   13050077
130600     END-IF.                                                      13060077
130700                                                                  13070077
131400     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              13071084
130800     SET DPG51-ACTUAL-CALENDAR-ONLY                               13080077
130900         DPG51-DO-NOT-INCR-DECR-DATE  TO TRUE.                    13090077
131000                                                                  13100077
131100     MOVE ASC-SHIP-DATE               TO DPG52-LK-DATE-INPUT.     13110077
131200     SET DPG52-LK-DTE-ISO-FMT         TO TRUE.                    13120077
131300                                                                  13130077
131400     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    13140077
131500                                             DPG54 DPG55 DPG56.   13150077
131600                                                                  13160077
131700     EVALUATE TRUE                                                13170077
131800         WHEN DPG54-NO-ERROR                                      13180077
131900             CONTINUE                                             13190077
132000         WHEN DPG54-DATE-INVALID                                  13200077
132100*            DISPLAY INVALID DATE ERROR MESSAGE                   13210077
132200             SET DP030-SET-CURSOR-APPL-1  TO TRUE                 13220077
132300             MOVE PC-TSYMSG-01339         TO DP020-MSG-NUMBER     13230077
132400             MOVE -1                      TO ASDATEL              13240077
132500             MOVE DP015-REVERSE           TO ASDATEH              13250077
132600             MOVE DP015-RED               TO ASDATEC              13260077
132700             SET DP020-MSG-FATAL          TO TRUE                 13270077
132800         WHEN OTHER                                               13280077
132900             SET DP013-LOGIC-ABEND TO TRUE                        13290077
133000             SET DP013-NO-ROLLBACK TO TRUE                        13300077
133100             MOVE '3000-EDIT-DATA-IN-COMMAREA'                    13310077
133200                                   TO DP013-PARAGRAPH             13320077
133300             MOVE 'ERROR CALLING DPKUT500 DATE ROUTINE'           13330077
133400                                   TO DP013-MESSAGE-TEXT(1)       13340077
133500             MOVE DPG54-ERROR-MESSAGE                             13350077
133600                                   TO DP013-MESSAGE-TEXT(2)       13360077
133700             PERFORM DP013-0000-PROCESS-ABEND                     13370077
133800     END-EVALUATE.                                                13380077
133900*                                                                 13390077
134000     IF ASC-SCAC-CDE = SPACES                                     13400077
134100         MOVE PC-TSYMSG-00007  TO DP020-MSG-NUMBER                13410077
134200         MOVE -1               TO ASCACL                          13420077
134300         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      13430077
134400         MOVE DP015-REVERSE    TO ASCACH                          13440077
134500         MOVE DP015-RED        TO ASCACC                          13450077
134600         MOVE DP015-UNP-ALP-BRT-OFF                               13460077
134700                               TO ASCACA                          13470077
134800         SET DP020-MSG-FATAL   TO TRUE                            13480077
134900         SET PS-ERROR          TO TRUE                            13490077
135000     ELSE                                                         13500077
135100         PERFORM 3300-VALIDATE-SCAC-CDE                           13510077
135200         IF SQLCODE = +100                                        13520077
135300             MOVE PC-TSYMSG-00005  TO DP020-MSG-NUMBER            13530077
135400             MOVE -1               TO ASCACL                      13540077
135500             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  13550077
135600             MOVE DP015-REVERSE    TO ASCACH                      13560077
135700             MOVE DP015-RED        TO ASCACC                      13570077
135800             MOVE DP015-UNP-ALP-BRT-OFF                           13580077
135900                                   TO ASCACA                      13590077
136000             SET DP020-MSG-FATAL   TO TRUE                        13600077
136100             SET PS-ERROR          TO TRUE                        13610077
136200         END-IF                                                   13620077
136300     END-IF.                                                      13630077
136400*                                                                 13640077
136500     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       13650077
136600         ASC-ITEMS-DISPLAYED - 1.                                 13660077
136700     PERFORM 3100-SET-SUBSCRIPTS.                                 13670077
136800                                                                  13680077
136900     IF  PS-NO-ERROR                                              13690077
137000         IF ASC-NUMBER-OF-SHIP-RECS = 0                           13700077
137100*            IF THERE ARE NO OTHER RECORDS CURRENTLY IN THE QUEUE,13710077
137200*            INITIALIZE THE ITEM ARRAY, AND WRITE THE FIRST RECORD13720077
137300             INITIALIZE VL004-SHIPMENT-ARRAY                      13730077
137400             MOVE +1 TO ASC-NUMBER-OF-SHIP-RECS                   13740077
137500                        ASC-NUMBER-OF-SHIP-TS-ITEMS               13750077
137600                        PV-SHIP-ITEM                              13760077
137700                                                                  13770077
137800             MOVE ASC-CARRIER-SHIP-NBR                            13780077
137900                         TO VL004-CARRIER-SHIP-NBR (1)            13790077
138000             MOVE ASC-PACKAGE-COUNT-N                             13800077
138100                         TO VL004-PACKAGE-COUNT (1)               13810077
138200             MOVE +1     TO VL004-ITEM (1)                        13820077
138300                                                                  13830077
138400             PERFORM 9300-WRITE-SHIP-TS                           13840077
138500         ELSE                                                     13850077
138600*            IF THERE ARE OTHER RECORDS, READ THE FIRST ITEM AND  13860077
138700*            UPDATE THE THE FIRST OCCURSANCE OF THE FIRST RECORD  13870077
138800*            WITH THE SCREEN INFO                                 13880077
138900             MOVE +1 TO PV-SHIP-ITEM                              13890077
139000             PERFORM 9302-READ-SHIP-QUEUE                         13900077
139100                                                                  13910077
139200             MOVE ASC-CARRIER-SHIP-NBR                            13920077
139300                         TO VL004-CARRIER-SHIP-NBR (1)            13930077
139400             MOVE ASC-PACKAGE-COUNT-N                             13940077
139500                         TO VL004-PACKAGE-COUNT (1)               13950077
139600                                                                  13960077
139700             PERFORM 9301-REWRITE-SHIP-TS                         13970077
139800         END-IF                                                   13980077
139900     END-IF.                                                      13990077
140000                                                                  14000084
140100*----------------------------------------------------------------*14010077
140200*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *14020077
140300*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*14030077
140400*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *14040077
140500*                                                                *14050077
140600*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *14060077
140700*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *14070077
140800*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *14080077
140900*    US IN THE 2ND BLOCK OF THE ARRAY.                           *14090077
141000*----------------------------------------------------------------*14100077
141200 3100-SET-SUBSCRIPTS.                                             14120077
141400     COMPUTE ASC-ITEM-SUB =                                       14140077
141500         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        14150077
141600                                                                  14160077
141700     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         14170077
141800         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            14180077
141900                                                                  14190077
142000         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               14200077
142100     ELSE                                                         14210077
142200         MOVE +1                     TO ASC-BLK-SUB               14220077
142300     END-IF.                                                      14230077
142700                                                                  14231084
142400******************************************************************14240077
142500** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **14250077
142600******************************************************************14260077
142800 3200-RESET-ATTRIBUTES.                                           14280077
142900     IF ASC-DELETE-SHIP-FORMAT                                    14290077
143000         MOVE DP015-ASK-NOR-OFF    TO ASTRTITA                    14300077
143100                                      ASCACA                      14310077
143200                                      ASDATEA                     14320077
143300                                      ACSNBRA                     14330077
143400                                      ASMETHA                     14340077
143500                                      APACKSA                     14350077
143600         MOVE DP015-BLUE           TO ASTRTITC                    14360077
143700                                      ASCACC                      14370077
143800                                      ASDATEC                     14380077
143900                                      ACSNBRC                     14390077
144000                                      ASMETHC                     14400077
144100                                      APACKSC                     14410077
144200         MOVE DP015-HL-OFF         TO ASTRTITH                    14420077
144300                                      ASCACH                      14430077
144400                                      ASDATEH                     14440077
144500                                      ACSNBRH                     14450077
144600                                      ASMETHH                     14460077
144700                                      APACKSH                     14470077
144800     ELSE                                                         14480077
144900         MOVE DP015-UNP-ALP-NOR-OFF                               14490077
145000                                   TO ASTRTITA                    14500077
145100                                      ASCACA                      14510077
145200                                      ASDATEA                     14520077
145300                                      ACSNBRA                     14530077
145400                                      ASMETHA                     14540077
145500                                      APACKSA                     14550077
145600         MOVE DP015-GREEN          TO ASTRTITC                    14560077
145700                                      ASCACC                      14570077
145800                                      ASDATEC                     14580077
145900                                      ACSNBRC                     14590077
146000                                      ASMETHC                     14600077
146100                                      APACKSC                     14610077
146200         MOVE DP015-UNDERLINE      TO ASTRTITH                    14620077
146300                                      ASCACH                      14630077
146400                                      ASDATEH                     14640077
146500                                      ACSNBRH                     14650077
146600                                      ASMETHH                     14660077
146700                                      APACKSH                     14670077
146800     END-IF.                                                      14680077
146900*                                                                 14690077
147000*----------------------------------------------------------------*14700077
147100*    SELECT THE TICKET PLACEMENT CODE FROM THE TICKET PLACEMENT  *14710077
147200*    DESCRIPTION TABLE TO VERIFIY THAT IT EXISTS.                *14720077
147300*----------------------------------------------------------------*14730077
147500 3300-VALIDATE-SCAC-CDE.                                          14750077
147700     PERFORM                                                      14770077
147800         WITH TEST AFTER                                          14780077
147900         VARYING PV-RETRY-COUNTER                                 14790077
148000         FROM 1 BY 1                                              14800077
148100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               14810077
148200                   OR (SQLCODE = ZERO)                            14820077
148300                   OR (SQLCODE = +100))                           14830077
148400                                                                  14840077
148500         EXEC SQL                                                 14850077
148600             SELECT                                               14860077
148700                      SCAC_CDE                                    14870077
148800             INTO                                                 14880077
148900                     :EXTENT-SCAC-CDE                             14890077
149000             FROM                                                 14900077
149100                     TEXTENT                                      14910077
149200             WHERE                                                14920077
149300                     SCAC_CDE = :ASC-SCAC-CDE                     14930077
149400               AND   CARRIER_IND = 'Y'                            14940077
149500               AND   STATUS_CDE = 'A'                             14950077
149600         END-EXEC                                                 14960077
149700                                                                  14970077
149800         EVALUATE TRUE                                            14980077
149900             WHEN SQLCODE = ZERO                                  14990077
150000             WHEN SQLCODE = +100                                  15000077
150100                 CONTINUE                                         15010077
150300             WHEN SQLCODE = -904                                  15030077
150400             WHEN SQLCODE = -913                                  15040077
150500                 CONTINUE                                         15050077
150700             WHEN SQLWARN0 NOT = SPACES                           15070077
150800             WHEN SQLCODE < ZERO                                  15080077
150900             WHEN SQLCODE > ZERO                                  15090077
151000                 MOVE '3300-VALIDATE-SCAC-CDE'                    15100077
151100                                   TO DP013-PARAGRAPH             15110077
151200                 MOVE 'SELECT THE SCAC CODE'                      15120077
151300                                   TO DP013-MESSAGE-TEXT (1)      15130077
151400                 MOVE ASC-SCAC-CDE TO DP013-MESSAGE-TEXT (2)      15140077
151500                 MOVE SQLCA        TO DP013-SQLCA                 15150077
151600                 MOVE 'TEXTENT '   TO DP013-DB2-TABLE-NAME (1)    15160077
151700                 SET DP013-DB2-ABEND                              15170077
151800                     DP013-XCTL-DISPLAY-RESTART TO TRUE           15180077
151900                 PERFORM DP013-0000-PROCESS-ABEND                 15190077
152000         END-EVALUATE                                             15200077
152100     END-PERFORM.                                                 15210077
152200*                                                                 15220077
152300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        15230077
152400         MOVE '3300-VALIDATE-SCAC-CDE'                            15240077
152500                                   TO DP013-PARAGRAPH             15250077
152600         MOVE 'MAXIMUM RETRIES EXCEEDED SELECTING SCAC CDE'       15260077
152700                                   TO DP013-MESSAGE-TEXT (1)      15270077
152800         MOVE ASC-SCAC-CDE         TO DP013-MESSAGE-TEXT (1)      15280077
152900         MOVE SQLCA                TO DP013-SQLCA                 15290077
153000         MOVE 'TEXTENT '           TO DP013-DB2-TABLE-NAME (1)    15300077
153100         SET DP013-DB2-ABEND                                      15310077
153200             DP013-XCTL-DISPLAY-RESTART                           15320077
153300                                   TO TRUE                        15330077
153400         PERFORM DP013-0000-PROCESS-ABEND                         15340077
153500     END-IF.                                                      15350077
153600                                                                  15360084
153700*----------------------------------------------------------------*15370077
153800*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *15380077
153900*    INITIALIZE ALL COUNTERS AND FLAGS.                          *15390077
154000*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *15400077
154100*    DISPLAY THE PANEL TO USER.                                  *15410077
154200*----------------------------------------------------------------*15420077
154400 4000-BUILD-INITIAL-PANEL.                                        15440077
154600     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            15460077
154700                                 ASC-BLOCK-ENTRIES (2).           15470077
154800     MOVE +1                 TO ASC-BLK-SUB.                      15480077
154900     SET ASC-ITEMS-LEFT-ON-DB TO TRUE.                            15490077
155000                                                                  15500077
155100     MOVE +0                 TO ASC-ITEM-SUB                      15510077
155200                                ASC-NUMBER-OF-ITEMS-READ          15520077
155300                                ASC-HIGHEST-BLOCK-WRITTEN         15530077
155400                                ASC-START-OF-SELECTED-RANGE       15540077
155500                                ASC-END-OF-SELECTED-RANGE         15550077
155600                                ASC-ITEM-AT-TOP-OF-PANEL.         15560077
155700     MOVE +1 TO PV-SEL-ITEM.                                      15570077
155800                                                                  15580077
155900     PERFORM 4100-GET-CURRENT-DATE.                               15590077
156000                                                                  15600077
156100     IF ASC-CREATE-SHIP-FORMAT                                    15610077
156200         PERFORM 4110-GET-SHIPT-GRP-ID                            15620077
156300         UNTIL SQLCODE = +100                                     15630077
156400     END-IF.                                                      15640077
156500                                                                  15650077
156600     MOVE ASC-CURRENT-DATE     TO ASC-SHIP-DATE.                  15660077
156700     MOVE +1                   TO ASC-PACKAGE-COUNT-N.            15670077
156800                                                                  15680077
156900     IF ASC-CREATE-SHIP-FORMAT                                    15690077
157000         PERFORM 4300-READ-ITEMS-FROM-TS                          15700077
157100     ELSE                                                         15710077
157200         PERFORM 4320-OPEN-UPDATE-CURSOR                          15720077
157300         PERFORM 4300-READ-ITEMS-FROM-DB2                         15730077
157400         PERFORM 4330-CLOSE-UPDATE-CURSOR                         15740077
157600         PERFORM 4370-FILL-COMMENT-QUEUE                          15760077
157700         PERFORM 4380-FILL-SHIPMENT-QUEUE                         15770077
157800     END-IF.                                                      15780077
157900                                                                  15790077
158000     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          15800077
158100         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    15810077
158200         SET DP020-MSG-FATAL   TO  TRUE                           15820077
158300         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               15830077
158400     ELSE                                                         15840077
158500         MOVE -1               TO ASCACL                          15850077
158600         SET DP030-SET-CURSOR-APPL-1                              15860077
158700                               TO TRUE                            15870077
158800         PERFORM 4200-GET-ADDRESS                                 15880077
158900         MOVE +1               TO  PV-TOP-ITEM                    15890077
159000         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     15900077
159100     END-IF.                                                      15910077
159200                                                                  15920084
159300*----------------------------------------------------------------*15930077
159400*    GET THE CURRENT DATE.                                       *15940077
159500*----------------------------------------------------------------*15950077
159700 4100-GET-CURRENT-DATE.                                           15970077
159900     EXEC SQL                                                     15990077
160000         SET :ASC-CURRENT-DATE = CURRENT DATE                     16000077
160100     END-EXEC.                                                    16010077
160200                                                                  16020077
160300     IF SQLCODE = +0                                              16030077
160400         CONTINUE                                                 16040077
160500     ELSE                                                         16050077
160600         MOVE '4100-GET-CURRENT-DATE'                             16060077
160700                           TO DP013-PARAGRAPH                     16070077
160800         MOVE 'SET CURRENT DATE'                                  16080077
160900                           TO DP013-MESSAGE-TEXT (1)              16090077
161000         MOVE SQLCA        TO DP013-SQLCA                         16100077
161100         SET DP013-DB2-ABEND                                      16110077
161200             DP013-XCTL-DISPLAY-RESTART TO TRUE                   16120077
161300         PERFORM DP013-0000-PROCESS-ABEND                         16130077
161400     END-IF.                                                      16140077
161500                                                                  16150077
161600*----------------------------------------------------------------*16160077
161700*    THIS PARAGRAPH WILL CREATE A RANDOM SHIPMENT GROUP ID KEY   *16170077
161800*    FOR USE WHEN CREATING A SHIPMENT                            *16180077
161900*----------------------------------------------------------------*16190077
162000 4110-GET-SHIPT-GRP-ID.                                           16200077
162200     EXEC SQL                                                     16220077
162300         SET :PV-TIMESTAMP = CURRENT TIMESTAMP                    16230077
162400     END-EXEC.                                                    16240077
162500                                                                  16250077
162600     IF SQLCODE = +0                                              16260077
162700         CONTINUE                                                 16270077
162800     ELSE                                                         16280077
162900         MOVE '4100-GET-CURRENT-DATE'                             16290077
163000                           TO DP013-PARAGRAPH                     16300077
163100         MOVE 'SET TIMESTAMP FOR RND KEY GENERATION'              16310077
163200                           TO DP013-MESSAGE-TEXT (1)              16320077
163300         MOVE SQLCA        TO DP013-SQLCA                         16330077
163400         SET DP013-DB2-ABEND                                      16340077
163500             DP013-XCTL-DISPLAY-RESTART TO TRUE                   16350077
163600         PERFORM DP013-0000-PROCESS-ABEND                         16360077
163700     END-IF.                                                      16370077
163800                                                                  16380077
163900     MOVE PV-TIMESTAMP   TO PV-TIMESTAMP-SPLIT.                   16390077
164000     MOVE PV-MINUTE      TO PV-RND-MINUTE.                        16400077
164100     MOVE PV-SECOND      TO PV-RND-SECOND.                        16410077
164200     MOVE PV-NANOSEC-1-3 TO PV-RND-NANOSEC-1-3.                   16420077
164300     MOVE PV-NANOSEC-4-6 TO PV-RND-NANOSEC-4-6.                   16430077
164400                                                                  16440077
164500     MOVE PV-RANDOM-KEY  TO ASC-KEY-SHIPT-GRP-ID.                 16450077
164600                                                                  16460077
164700* CHECK TO SEE IF THE RANDOMLY GENERATED SHIPMENT GROUP ID IS ALRE16470077
164800* ON THE TABLE.  IF SO, RANDOMLY CREATE ANOTHER.                  16480077
164900     EXEC SQL                                                     16490077
165000          SELECT   SHIPT_GRP_ID                                   16500077
165100          INTO    :REQSHP-SHIPT-GRP-ID                            16510077
165200          FROM     TREQSHP                                        16520077
165300          WHERE SHIPT_GRP_ID  =  :ASC-KEY-SHIPT-GRP-ID            16530077
165400     END-EXEC                                                     16540077
165500                                                                  16550077
165600     EVALUATE TRUE                                                16560077
165700         WHEN SQLCODE = +0                                        16570077
165800         WHEN SQLCODE = +100                                      16580077
165900         WHEN SQLCODE = -811                                      16590077
166000             CONTINUE                                             16600077
166200         WHEN SQLWARN0 NOT = SPACE                                16620077
166300         WHEN SQLCODE < +0                                        16630077
166400         WHEN SQLCODE > +0                                        16640077
166500             MOVE '4110-GET-SHIPT-GRP-ID'                         16650077
166600                           TO DP013-PARAGRAPH                     16660077
166700             MOVE 'CHECK SHIPT-GRP-ID ON REQUEST ASSOCIATION'     16670077
166800                           TO DP013-MESSAGE-TEXT (1)              16680077
166900             MOVE ASC-KEY-SHIPT-GRP-ID                            16690077
167000                           TO PV-DISPLAY-COMP                     16700077
167100             MOVE PV-DISPLAY-COMP                                 16710077
167200                           TO DP013-MESSAGE-TEXT (2)              16720077
167300             MOVE SQLCA    TO DP013-SQLCA                         16730077
167400             MOVE 'TREQSHP'                                       16740077
167500                          TO DP013-DB2-TABLE-NAME (1)             16750077
167600             SET DP013-DB2-ABEND                                  16760077
167700                 DP013-XCTL-DISPLAY-RESTART TO TRUE               16770077
167800             PERFORM DP013-0000-PROCESS-ABEND                     16780077
168000     END-EVALUATE.                                                16800077
168100                                                                  16810077
168200*----------------------------------------------------------------*16820077
168300*    THIS PARAGRAPH WILL RETRIEVE THE PRETICKET ADDRESS          *16830077
168400*    ASSOCIATED TO THE PO(S) THAT ARE TO BE SHIPPED.             *16840077
168500*----------------------------------------------------------------*16850077
168600 4200-GET-ADDRESS.                                                16860077
168700     EXEC SQL                                                     16870077
168800         SELECT                                                   16880077
168900               A.ADDRESS_LINE1_DESC                               16890077
169000              ,A.ADDRESS_LINE2_DESC                               16900077
169100              ,A.ADDRESS_LINE3_DESC                               16910077
169200              ,A.ADDRESS_LINE4_DESC                               16920077
169300              ,A.ATTENTION_TO_TXT                                 16930077
169400              ,A.CITY_NAME                                        16940077
169600              ,A.ST_PROV_CDE                                      16960077
169700              ,A.ZIP_CDE                                          16970077
169800              ,A.CNTRY_CDE                                        16980077
170100              ,B.FIRST_NAME                                       17010077
170200              ,B.LAST_NAME                                        17020077
170300         INTO                                                     17030077
170400               :BUSLOC-ADDRESS-LINE1-DESC                         17040077
170500              ,:BUSLOC-ADDRESS-LINE2-DESC                         17050077
170600              ,:BUSLOC-ADDRESS-LINE3-DESC                         17060077
170700              ,:BUSLOC-ADDRESS-LINE4-DESC                         17070077
170800              ,:BUSLOC-ATTENTION-TO-TXT                           17080077
170900              ,:BUSLOC-CITY-NAME                                  17090077
170902              ,:BUSLOC-ST-PROV-CDE                                17090201
170903              ,:BUSLOC-ZIP-CDE                                    17090377
170904              ,:BUSLOC-CNTRY-CDE                                  17090401
170907              ,:ENTREP-FIRST-NAME                                 17090777
170908              ,:ENTREP-LAST-NAME                                  17090877
170909          FROM                                                    17090977
170910                TBUSLOC A                                         17091077
170920              , TENTREP B                                         17092077
170930          WHERE                                                   17093077
170940                A.ENT_ID         = :ASC-ENT-ID                    17094077
170950            AND A.FUNCTION_ID    = :PC-PRETICKET-FUNCTION-ID      17095077
170960            AND A.SEQ_NBR        = :ASC-ADDR-SEQ-NBR              17096077
170970            AND A.FUNCTION_ID    = B.FUNCTION_ID                  17097077
170980            AND A.ENT_ID         = B.ENT_ID                       17098077
170990            AND A.SEQ_NBR        = B.ENT_BUS_LOC_ID               17099077
171000     END-EXEC.                                                    17100077
171100                                                                  17110077
171200     EVALUATE TRUE                                                17120077
171300         WHEN SQLCODE = ZERO                                      17130077
171400              CONTINUE                                            17140077
171500         WHEN SQLCODE = +100                                      17150077
171600              MOVE 'PRETICKET ADDRESS NOT FOUND' TO               17160077
171700                    BUSLOC-ADDRESS-LINE1-DESC                     17170077
171800         WHEN SQLWARN0 NOT = SPACE                                17180077
171900         WHEN SQLCODE NOT = ZERO                                  17190077
172000              MOVE '4200-GET-ADDRESS'                             17200077
172100                               TO DP013-PARAGRAPH                 17210077
172200              MOVE 'GET THE PRETICKET ADDRESS'                    17220077
172300                               TO DP013-MESSAGE-TEXT (1)          17230077
172400              MOVE ASC-ENT-ID  TO DP013-MESSAGE-TEXT (2)          17240077
172500              MOVE ASC-ADDR-SEQ-NBR                               17250077
172600                               TO DP013-MESSAGE-TEXT (3)          17260077
172700              MOVE SQLCA       TO DP013-SQLCA                     17270077
172800              SET DP013-DB2-ABEND                                 17280077
172900                               TO TRUE                            17290077
173000              PERFORM DP013-0000-PROCESS-ABEND                    17300077
173100     END-EVALUATE.                                                17310077
173200                                                                  17320077
173400     IF BUSLOC-CNTRY-CDE = 'US ' OR SPACES                        17340077
173500        MOVE SPACES             TO PV-COUNTRY                     17350077
173600                                   PV-STATE-PROV                  17360077
173700        MOVE BUSLOC-ST-PROV-CDE TO PV-STATE-PROV                  17370077
173701     ELSE                                                         17370177
173702        PERFORM 4205-RETRIEVE-ST-PRV-CNTY-NAME.                   17370201
173704                                                                  17370477
173705     INITIALIZE ASC-ADDR-LINE-TABLE.                              17370577
173706     SET ASC-ADDR-IDX TO +1.                                      17370677
173707                                                                  17370777
173708**  ATTENTION-TO-TXT  ********************************************17370877
173709     IF BUSLOC-ATTENTION-TO-TXT = SPACES                          17370977
173710         CONTINUE                                                 17371077
173720     ELSE                                                         17372077
173730         MOVE BUSLOC-ATTENTION-TO-TXT                             17373077
173740              TO ASC-ADDR-LINE (ASC-ADDR-IDX)                     17374077
173750         SET ASC-ADDR-IDX UP BY +1                                17375077
173760     END-IF.                                                      17376077
173770                                                                  17377077
173780**  REP NAME *****************************************************17378077
173790     IF  ENTREP-FIRST-NAME = SPACES                               17379077
173800     AND ENTREP-LAST-NAME = SPACES                                17380077
173900         CONTINUE                                                 17390077
174000     ELSE                                                         17400077
174100          STRING                                                  17410077
174200              ENTREP-FIRST-NAME DELIMITED BY '  '                 17420077
174300              ENTREP-LAST-NAME DELIMITED BY '  '                  17430077
174400          INTO ASC-ADDR-LINE(ASC-ADDR-IDX)                        17440077
174500         SET ASC-ADDR-IDX UP BY +1                                17450077
174600     END-IF.                                                      17460077
174700                                                                  17470077
174800** ADDRESS LINE 1 ************************************************17480077
174900     IF BUSLOC-ADDRESS-LINE1-DESC = SPACES                        17490077
175000         CONTINUE                                                 17500077
175100     ELSE                                                         17510077
175200         MOVE BUSLOC-ADDRESS-LINE1-DESC                           17520077
175300              TO ASC-ADDR-LINE (ASC-ADDR-IDX)                     17530077
175400         SET ASC-ADDR-IDX UP BY +1                                17540077
175500     END-IF.                                                      17550077
175600                                                                  17560077
175700** ADDRESS LINE 2 ************************************************17570077
175800     IF BUSLOC-ADDRESS-LINE2-DESC = SPACES                        17580077
175900         CONTINUE                                                 17590077
176000     ELSE                                                         17600077
176100         MOVE BUSLOC-ADDRESS-LINE2-DESC                           17610077
176200              TO ASC-ADDR-LINE (ASC-ADDR-IDX)                     17620077
176300         SET ASC-ADDR-IDX UP BY +1                                17630077
176400     END-IF.                                                      17640077
176500                                                                  17650077
176600** ADDRESS LINE 3 ************************************************17660077
176700     IF BUSLOC-ADDRESS-LINE3-DESC = SPACES                        17670077
176800         CONTINUE                                                 17680077
176900     ELSE                                                         17690077
177000         MOVE BUSLOC-ADDRESS-LINE3-DESC                           17700077
177100              TO ASC-ADDR-LINE (ASC-ADDR-IDX)                     17710077
177200         SET ASC-ADDR-IDX UP BY +1                                17720077
177300     END-IF.                                                      17730077
177400                                                                  17740077
177500** ADDRESS LINE 4 ************************************************17750077
177600     IF BUSLOC-ADDRESS-LINE4-DESC = SPACES                        17760077
177700         CONTINUE                                                 17770077
177800     ELSE                                                         17780077
177900         MOVE BUSLOC-ADDRESS-LINE4-DESC                           17790077
178000              TO ASC-ADDR-LINE (ASC-ADDR-IDX)                     17800077
178100         SET ASC-ADDR-IDX UP BY +1                                17810077
178200     END-IF.                                                      17820077
178300                                                                  17830077
178400** CITY STATE ZIP PROVINCE COUNTRY *******************************17840077
178500     STRING                                                       17850077
178600         BUSLOC-CITY-NAME DELIMITED BY '  '                       17860077
178700         ' ' DELIMITED BY SIZE                                    17870077
179100         PV-STATE-PROV DELIMITED BY '  '                          17910077
179200         ' ' DELIMITED BY SIZE                                    17920077
179300         BUSLOC-ZIP-CDE DELIMITED BY '  '                         17930077
179400         ' ' DELIMITED BY SIZE                                    17940077
179600         PV-COUNTRY DELIMITED BY '  '                             17960077
179700     INTO ASC-ADDR-LINE(ASC-ADDR-IDX)                             17970077
179800     ON OVERFLOW                                                  17980077
179900         MOVE SPACES TO ASC-ADDR-LINE(ASC-ADDR-IDX)               17990077
180000         STRING                                                   18000077
180100             BUSLOC-CITY-NAME DELIMITED BY '  '                   18010077
180200             ' ' DELIMITED BY SIZE                                18020077
180500             BUSLOC-ZIP-CDE DELIMITED BY '  '                     18050077
180600         INTO ASC-ADDR-LINE(ASC-ADDR-IDX)                         18060077
180700                                                                  18070077
180800         SET ASC-ADDR-IDX UP BY +1                                18080077
180900                                                                  18090077
181000         STRING                                                   18100077
181200             PV-STATE-PROV DELIMITED BY '  '                      18120077
181300             ' ' DELIMITED BY SIZE                                18130077
181500             PV-COUNTRY DELIMITED BY '  '                         18150077
181600         INTO ASC-ADDR-LINE(ASC-ADDR-IDX)                         18160077
181700     END-STRING.                                                  18170077
181900                                                                  18190077
182000*----------------------------------------------------------------*18200079
182100*    RETRIEVE COUNTRY AND STATE NAME                             *18210077
182200*----------------------------------------------------------------*18220077
182300 4205-RETRIEVE-ST-PRV-CNTY-NAME.                                  18230077
182500     MOVE SPACES                 TO PV-STATE-PROV                 18250077
182600                                    PV-COUNTRY.                   18260077
182700     MOVE BUSLOC-ST-PROV-CDE     TO DP410-STATE-CODE.             18270077
182800     MOVE BUSLOC-CNTRY-CDE       TO DP410-COUNTRY-CODE.           18280077
182900                                                                  18290077
183000     CALL PC-DPKUT410 USING DFHEIBLK                              18300077
183100                            PV-DPKUT410-COMMAREA                  18310077
183200                            DP410-ST-PROV-CNTRY-ROUTINE.          18320077
183300     EVALUATE TRUE                                                18330077
183401         WHEN  DP410-DB2-ERROR                                    18340177
183402             MOVE '4205-RETRIEVE-ST-PRV-CNTY-NAME'                18340201
183403                                      TO DP013-PARAGRAPH          18340301
183404             DISPLAY 'STATE/PROV = ' DP410-STATE-CODE             18340477
183405             DISPLAY 'COUNTRY = ' DP410-COUNTRY-CODE              18340577
183406             MOVE 'PS_COUNTRY'        TO DP013-DB2-TABLE-NAME (1) 18340601
183407             MOVE 'PS_STATE'          TO DP013-DB2-TABLE-NAME (2) 18340701
183408             SET DP013-DB2-ABEND   TO TRUE                        18340800
183409             SET DP013-NO-ROLLBACK TO TRUE                        18340900
183410             MOVE SQLCA            TO DP013-SQLCA                 18341000
183420             PERFORM DP013-0000-PROCESS-ABEND                     18342001
183431         WHEN  DP410-DEADLOCK-BYPASS-ROUTINE                      18343178
183432             MOVE DP410-STATE-CODE TO PV-STATE-PROV               18343278
183433             MOVE DP410-COUNTRY-CODE TO PV-COUNTRY                18343378
183440         WHEN  OTHER                                              18344077
183450             MOVE DP410-STATE-NAME TO PV-STATE-PROV               18345077
183460             MOVE DP410-COUNTRY-NAME TO PV-COUNTRY                18346077
183470     END-EVALUATE.                                                18347077
183490                                                                  18349077
183500*----------------------------------------------------------------*18350077
183600*    IF CONTROL OF THE PROGRAM CAME FROM THE PRINTED REQUEST     *18360077
183700*    LIST, THIS IS AN "ADD" AND THE SELECTED PO'S FOR THE SHIP-  *18370077
183800*    MENT ARE IN A TEMP-STORAGE QUEUE.                           *18380077
183900*                                                                *18390077
184000*    READ THE ITEMS FROM THE TEMPORARY STORAGE QUEUE, AND MOVE TO*18400077
184100*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *18410077
184200*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *18420077
184300*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *18430077
184400*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *18440077
184500*                                                                *18450077
184600*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *18460077
184700*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *18470077
184800*    UPON INITIALIZATION.                                        *18480077
184900*----------------------------------------------------------------*18490077
185000 4300-READ-ITEMS-FROM-TS.                                         18500077
185200     PERFORM                                                      18520077
185300         VARYING PV-SEL-ITEM                                      18530077
185400         FROM 1 BY 1                                              18540077
185500         UNTIL ((PV-SEL-ITEM > PC-MAX-ITEMS)                      18550077
185600            OR (PV-SEL-ITEM > ASC-NUMBER-OF-TS-ITEMS))            18560077
185700                                                                  18570077
185800         PERFORM 9100-READ-SEL-QUEUE                              18580077
185900                                                                  18590077
186000         PERFORM                                                  18600077
186100             VARYING VL003-IDX                                    18610077
186200             FROM 1 BY 1                                          18620077
186300             UNTIL VL003-IDX > VL003-MAX-ITEMS                    18630077
186400                OR VL003-ITEM (VL003-IDX) = +0                    18640077
186500                                                                  18650077
186600             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                18660077
186700                 ADD +1            TO ASC-ITEM-SUB                18670077
186800             ELSE                                                 18680077
186900                 ADD +1            TO ASC-BLK-SUB                 18690077
187000                 MOVE +1           TO ASC-ITEM-SUB                18700077
187100                                                                  18710077
187200                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         18720077
187300                     MOVE +1       TO ASC-BLK-SUB                 18730077
187400                     SET ASC-BLOCK-MODIFIED (1)                   18740077
187500                                   TO TRUE                        18750077
187600                     PERFORM 5100-WRITE-TEMP-STORAGE              18760077
187700                     MOVE ASC-BLOCK-ENTRIES                       18770077
187800                               (PC-MAX-BLOCKS-IN-ARRAY)           18780077
187900                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 18790077
188000                     ADD +1        TO ASC-BLK-SUB                 18800077
188100                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   18810077
188200                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      18820077
188300                                   TO TRUE                        18830077
188400                 END-IF                                           18840077
188500             END-IF                                               18850077
188600             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    18860077
188700             MOVE ASC-NUMBER-OF-ITEMS-READ                        18870077
188800                                   TO ASC-LIST-ITEM-NUMBER        18880077
188900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18890077
189000                                                                  18900077
189100             MOVE VL003-PO-NUMBER  (VL003-IDX)                    18910077
189200                                   TO ASC-PO-NUMBER               18920077
189300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18930077
189400             MOVE VL003-PO-REQ-NBR (VL003-IDX)                    18940077
189500                                   TO ASC-PO-REQ-NBR              18950077
189600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18960077
189700             MOVE VL003-REQUEST-DATE (VL003-IDX)                  18970077
189800                                   TO ASC-REQUEST-DATE            18980077
189900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18990077
190000             MOVE VL003-PRINT-DATE (VL003-IDX)                    19000077
190100                                   TO ASC-PRINT-DATE              19010077
190200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19020077
190300             MOVE VL003-VND-DUE-DATE (VL003-IDX)                  19030077
190400                                   TO ASC-VENDOR-DUE-DATE         19040077
190500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19050077
190600             SET VL003-INQ (VL003-IDX)                            19060077
190700                                   TO TRUE                        19070077
190800         END-PERFORM                                              19080077
190900                                                                  19090077
191000         PERFORM 9101-REWRITE-SEL-QUEUE                           19100077
191100                                                                  19110077
191200     END-PERFORM.                                                 19120077
191300                                                                  19130077
191400     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          19140077
191500         MOVE +1               TO ASC-BLK-SUB                     19150077
191600         PERFORM 5100-WRITE-TEMP-STORAGE                          19160077
191700         ADD +1                TO ASC-BLK-SUB                     19170077
191800         PERFORM 5100-WRITE-TEMP-STORAGE                          19180077
191900                                                                  19190077
192000         MOVE 1                TO ASC-BLK-SUB                     19200077
192100                                  PV-BLOCK-NUMBER                 19210077
192200         PERFORM 4410-READ-TEMP-STORAGE                           19220077
192300         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             19230077
192400             MOVE 2            TO ASC-BLK-SUB                     19240077
192500                                  PV-BLOCK-NUMBER                 19250077
192600             PERFORM 4410-READ-TEMP-STORAGE                       19260077
192700         END-IF                                                   19270077
192800     END-IF.                                                      19280077
192900                                                                  19290084
193000*----------------------------------------------------------------*19300077
193100*    IF CONTROL OF THE PROGRAM CAME FROM THE SHIPMENT CRIT SPEC  *19310077
193200*    SCREEN, OR THE SHIPMENT LIST SCREEN, THE PROGRAM IN IS      *19320077
193300*    "UPDATE" MODE, AND ALL THE DATA MUST BE READ FROM DB2.      *19330077
193400*                                                                *19340077
193500*    READ THE ITEMS FROM THE DATABASE, AND MOVE TO THE           *19350077
193600*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *19360077
193700*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *19370077
193800*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *19380077
193900*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *19390077
194000*                                                                *19400077
194100*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *19410077
194200*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *19420077
194300*    UPON INITIALIZATION.                                        *19430077
194400*----------------------------------------------------------------*19440077
194600 4300-READ-ITEMS-FROM-DB2.                                        19460077
194800     PERFORM                                                      19480077
194900         VARYING PV-READ-COUNT                                    19490077
195000         FROM 1 BY 1                                              19500077
195100         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    19510077
195200            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         19520077
195300                                                                  19530077
195400         PERFORM 4310-FETCH-UPDATE-CURSOR                         19540077
195500                                                                  19550077
195600         IF ASC-ITEMS-LEFT-ON-DB                                  19560077
195700             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                19570077
195800                 ADD +1            TO ASC-ITEM-SUB                19580077
195900             ELSE                                                 19590077
196000                 ADD +1            TO ASC-BLK-SUB                 19600077
196100                 MOVE +1           TO ASC-ITEM-SUB                19610077
196200                                                                  19620077
196300                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         19630077
196400                     MOVE +1       TO ASC-BLK-SUB                 19640077
196500                     SET ASC-BLOCK-MODIFIED (1)                   19650077
196600                                   TO TRUE                        19660077
196700                     PERFORM 5100-WRITE-TEMP-STORAGE              19670077
196800                     MOVE ASC-BLOCK-ENTRIES                       19680077
196900                               (PC-MAX-BLOCKS-IN-ARRAY)           19690077
197000                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 19700077
197100                     ADD +1        TO ASC-BLK-SUB                 19710077
197200                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   19720077
197300                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      19730077
197400                                   TO TRUE                        19740077
197500                 END-IF                                           19750077
197600             END-IF                                               19760077
197700                                                                  19770077
197800             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    19780077
197900             MOVE ASC-NUMBER-OF-ITEMS-READ                        19790077
198000                                   TO ASC-LIST-ITEM-NUMBER        19800077
198100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19810077
198200                                                                  19820077
198300             MOVE PTKREQ-PO-REQ-NBR                               19830077
198400                                   TO ASC-PO-REQ-NBR              19840077
198500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19850077
198600             MOVE PTKREQ-PO-NBR    TO ASC-PO-NUMBER               19860077
198700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19870077
198800             MOVE PTKREQ-REQ-CREN-DTE                             19880077
198900                                   TO ASC-REQUEST-DATE            19890077
199000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19900077
199100             MOVE PTKREQ-ACTL-PRT-DTE                             19910077
199200                                   TO ASC-PRINT-DATE              19920077
199300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19930077
199400             MOVE PTKREQ-VND-DUE-DTE                              19940077
199500                                   TO ASC-VENDOR-DUE-DATE         19950077
199600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19960077
199700             MOVE PTKREQ-ENT-ID    TO ASC-ENT-ID                  19970077
199800             MOVE ENTNME-ENT-NAME-DESC                            19980077
199900                                   TO ASC-VENDOR-NAME             19990077
200000             MOVE PTKREQ-ADDR-SEQ-NBR                             20000077
200100                                   TO ASC-ADDR-SEQ-NBR            20010077
200200         END-IF                                                   20020077
200300     END-PERFORM.                                                 20030077
200400                                                                  20040077
200500     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          20050077
200600         MOVE +1               TO ASC-BLK-SUB                     20060077
200700         PERFORM 5100-WRITE-TEMP-STORAGE                          20070077
200800         ADD +1                TO ASC-BLK-SUB                     20080077
200900         PERFORM 5100-WRITE-TEMP-STORAGE                          20090077
201000                                                                  20100077
201100         MOVE 1                TO ASC-BLK-SUB                     20110077
201200                                  PV-BLOCK-NUMBER                 20120077
201300         PERFORM 4410-READ-TEMP-STORAGE                           20130077
201400         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             20140077
201500             MOVE 2            TO ASC-BLK-SUB                     20150077
201600                                  PV-BLOCK-NUMBER                 20160077
201700             PERFORM 4410-READ-TEMP-STORAGE                       20170077
201800         END-IF                                                   20180077
201900     END-IF.                                                      20190077
202000                                                                  20200084
202100*----------------------------------------------------------------*20210077
202200*    FETCH THE MESSAGE CURSOR.                                   *20220077
202300*----------------------------------------------------------------*20230077
202500 4310-FETCH-UPDATE-CURSOR.                                        20250077
202700     EXEC SQL                                                     20270077
202800          FETCH UPDATE_CURSOR                                     20280077
202900          INTO                                                    20290077
203000                :PTKREQ-PO-REQ-NBR                                20300077
203100              , :PTKREQ-PO-NBR                                    20310077
203200              , :PTKREQ-REQ-CREN-DTE                              20320077
203300              , :PTKREQ-ACTL-PRT-DTE                              20330077
203400              , :PTKREQ-VND-DUE-DTE                               20340077
203500              , :PTKREQ-ENT-ID                                    20350077
203600              , :PTKREQ-ADDR-SEQ-NBR                              20360077
203700              , :ENTNME-ENT-NAME-DESC                             20370077
203800     END-EXEC.                                                    20380077
203900                                                                  20390077
204000     EVALUATE TRUE                                                20400077
204100         WHEN SQLCODE = ZERO                                      20410077
204200         WHEN SQLCODE = +100                                      20420077
204300              CONTINUE                                            20430077
204400         WHEN SQLWARN0 NOT = SPACE                                20440077
204500         WHEN SQLCODE NOT = ZERO                                  20450077
204600              MOVE '4310-FETCH-UPDATE-CURSOR'                     20460077
204700                               TO DP013-PARAGRAPH                 20470077
204800              MOVE 'FETCH UPDATE_CURSOR '                         20480077
204900                               TO DP013-MESSAGE-TEXT (1)          20490077
205000              MOVE SQLCA       TO DP013-SQLCA                     20500077
205100              SET DP013-DB2-ABEND                                 20510077
205200                               TO TRUE                            20520077
205300              PERFORM DP013-0000-PROCESS-ABEND                    20530077
205400     END-EVALUATE.                                                20540077
205500                                                                  20550077
205600     IF  SQLCODE EQUAL +100                                       20560077
205700         SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                      20570077
205800     END-IF.                                                      20580077
205900                                                                  20590077
206100*----------------------------------------------------------------*20610077
206200*    OPEN THE LIST DETAIL CUSOR FOR SHIPPING UPDATE              *20620077
206300*----------------------------------------------------------------*20630077
206500 4320-OPEN-UPDATE-CURSOR.                                         20650077
206600     EXEC SQL                                                     20660077
206700          OPEN UPDATE_CURSOR                                      20670077
206800     END-EXEC.                                                    20680077
206900                                                                  20690077
207000     EVALUATE TRUE                                                20700077
207100         WHEN SQLCODE = ZERO                                      20710077
207200              CONTINUE                                            20720077
207300         WHEN SQLWARN0 NOT = SPACE                                20730077
207400         WHEN SQLCODE NOT = ZERO                                  20740077
207500              MOVE '4320-OPEN-UPDATE-CURSOR'                      20750077
207600                               TO DP013-PARAGRAPH                 20760077
207700              MOVE 'OPEN UPDATE_CURSOR '                          20770077
207800                               TO DP013-MESSAGE-TEXT (1)          20780077
207900              MOVE SQLCA       TO DP013-SQLCA                     20790077
208000              SET DP013-DB2-ABEND                                 20800077
208100                               TO TRUE                            20810077
208200              PERFORM DP013-0000-PROCESS-ABEND                    20820077
208300     END-EVALUATE.                                                20830077
208400                                                                  20840077
208500*----------------------------------------------------------------*20850077
208600*   CLOSE THE LIST DETAIL CUSOR FOR SHIPPING UPDATE              *20860077
208700*----------------------------------------------------------------*20870077
208900 4330-CLOSE-UPDATE-CURSOR.                                        20890077
209000     EXEC SQL                                                     20900077
209100         CLOSE UPDATE_CURSOR                                      20910077
209200     END-EXEC.                                                    20920077
209300                                                                  20930077
209400     EVALUATE TRUE                                                20940077
209500         WHEN SQLCODE = ZERO                                      20950077
209600              CONTINUE                                            20960077
209700         WHEN SQLWARN0 NOT = SPACE                                20970077
209800         WHEN SQLCODE NOT = ZERO                                  20980077
209900              MOVE '4330-CLOSE-UPDATE-CURSOR'                     20990077
210000                               TO DP013-PARAGRAPH                 21000077
210100              MOVE 'CLOSE UPDATE_CURSOR'                          21010077
210200                               TO DP013-MESSAGE-TEXT (1)          21020077
210300              MOVE SQLCA       TO DP013-SQLCA                     21030077
210400              SET DP013-DB2-ABEND                                 21040077
210500                               TO TRUE                            21050077
210600              PERFORM DP013-0000-PROCESS-ABEND                    21060077
210700     END-EVALUATE.                                                21070077
210800                                                                  21080077
210900*----------------------------------------------------------------*21090077
211000* READ ALL THE COMMENTS AND FILL THE TEMP STORAGE QUEUE THAT IS  *21100077
211100* USED BETWEEN THIS AND VLKCS503.                                *21110077
211200*----------------------------------------------------------------*21120077
211400 4370-FILL-COMMENT-QUEUE.                                         21140077
211600     PERFORM 7500-OPEN-COMMENT-CURSOR.                            21160077
211700     PERFORM 7510-FETCH-COMMENT-CURSOR.                           21170077
211800                                                                  21180077
211900     MOVE +0 TO ASC-NUMBER-OF-COMM-RECS                           21190077
212000                ASC-NUMBER-OF-COMM-TS-ITEMS                       21200077
212100                ASC-KEY-CMNT-ID                                   21210077
212200                                                                  21220077
212300     INITIALIZE VL001-SELECTED-ITEM-ARRAY                         21230077
212400                                                                  21240077
212500     SET VL001-IDX TO +1                                          21250077
212600                                                                  21260077
212700     PERFORM UNTIL PS-EOC-COMMENT                                 21270077
212900         IF VL001-IDX > VL001-MAX-ITEMS                           21290077
213000             ADD +1 TO ASC-NUMBER-OF-COMM-TS-ITEMS                21300077
213100             MOVE ASC-NUMBER-OF-COMM-TS-ITEMS                     21310077
213200                    TO PV-COMM-ITEM                               21320077
213300             PERFORM 9200-WRITE-COMMENT-QUEUE                     21330077
213400             INITIALIZE VL001-SELECTED-ITEM-ARRAY                 21340077
213500             SET VL001-IDX TO +1                                  21350077
213600         END-IF                                                   21360077
213700                                                                  21370077
213800         ADD +1  TO ASC-NUMBER-OF-COMM-RECS                       21380077
213900         MOVE ASC-NUMBER-OF-COMM-RECS                             21390077
214000                       TO VL001-ITEM (VL001-IDX)                  21400077
214100         MOVE PTKCMT-PRE-TKT-CMNT-DESC                            21410077
214200                       TO VL001-PRE-TKT-CMNT-DESC (VL001-IDX)     21420077
214300         MOVE PTKCMT-CMNT-CRER-ID                                 21430077
214400                       TO VL001-CMNT-CRER-ID (VL001-IDX)          21440077
214500         MOVE PTKCMT-CMNT-ID                                      21450077
214600                       TO ASC-KEY-CMNT-ID                         21460077
214700         PERFORM 7510-FETCH-COMMENT-CURSOR                        21470077
214800                                                                  21480077
214900         IF SQLCODE = ZERO                                        21490077
215000             SET VL001-IDX UP BY +1                               21500077
215100         END-IF                                                   21510077
215200     END-PERFORM.                                                 21520077
215300                                                                  21530077
215400     ADD +1 TO ASC-NUMBER-OF-COMM-TS-ITEMS.                       21540077
215500     MOVE ASC-NUMBER-OF-COMM-TS-ITEMS                             21550077
215600                       TO PV-COMM-ITEM.                           21560077
215700     PERFORM 9200-WRITE-COMMENT-QUEUE.                            21570077
215800                                                                  21580077
216000*----------------------------------------------------------------*21600077
216100* READ ALL THE SHIPMENTS AND FILL THE TEMP STORAGE QUEUE THAT    *21610077
216200* IS USED BETWEEN THIS AND VLKCS508                              *21620077
216300*----------------------------------------------------------------*21630077
216500 4380-FILL-SHIPMENT-QUEUE.                                        21650077
216700     PERFORM 7600-OPEN-SHIPMENT-CURSOR.                           21670077
216800     PERFORM 7610-FETCH-SHIPMENT-CURSOR.                          21680077
216900                                                                  21690077
217000     MOVE PTKSHP-SCAC-CDE       TO ASC-SCAC-CDE.                  21700077
217100     MOVE PTKSHP-SHIPT-DTE      TO ASC-SHIP-DATE.                 21710077
217200     MOVE PTKSHP-SHIPT-TYP-DESC TO ASC-SHIP-METHOD.               21720077
217300     MOVE PTKSHP-CARR-SHIPT-ID  TO ASC-CARRIER-SHIP-NBR.          21730077
217400     MOVE PTKSHP-SHPD-PKG-CNT   TO ASC-PACKAGE-COUNT-N.           21740077
217500                                                                  21750077
217600     MOVE +0 TO ASC-NUMBER-OF-SHIP-RECS                           21760077
217700                ASC-NUMBER-OF-SHIP-TS-ITEMS.                      21770077
217800     INITIALIZE VL004-SHIPMENT-ARRAY.                             21780077
217900                                                                  21790077
218000     SET VL004-IDX TO +1                                          21800077
218100                                                                  21810077
218200     PERFORM UNTIL PS-EOC-SHIPMENT                                21820077
218400         IF VL004-IDX > VL004-MAX-ITEMS                           21840077
218500             ADD +1 TO ASC-NUMBER-OF-SHIP-TS-ITEMS                21850077
218600             MOVE ASC-NUMBER-OF-SHIP-TS-ITEMS                     21860077
218700                    TO PV-SHIP-ITEM                               21870077
218800             PERFORM 9300-WRITE-SHIP-TS                           21880077
218900             INITIALIZE VL004-SHIPMENT-ARRAY                      21890077
219000             SET VL004-IDX TO +1                                  21900077
219100         END-IF                                                   21910077
219200                                                                  21920077
219300         ADD +1  TO ASC-NUMBER-OF-SHIP-RECS                       21930077
219400         MOVE ASC-NUMBER-OF-SHIP-RECS                             21940077
219500                       TO VL004-ITEM (VL004-IDX)                  21950077
219600         MOVE PTKSHP-CARR-SHIPT-ID                                21960077
219700                       TO VL004-CARRIER-SHIP-NBR (VL004-IDX)      21970077
219800         MOVE PTKSHP-SHPD-PKG-CNT                                 21980077
219900                       TO VL004-PACKAGE-COUNT (VL004-IDX)         21990077
220000                                                                  22000077
220100         PERFORM 7610-FETCH-SHIPMENT-CURSOR                       22010077
220200                                                                  22020077
220300         IF SQLCODE = ZERO                                        22030077
220400             SET VL004-IDX UP BY +1                               22040077
220500         END-IF                                                   22050077
220600     END-PERFORM.                                                 22060077
220700                                                                  22070077
220800     ADD +1 TO ASC-NUMBER-OF-SHIP-TS-ITEMS.                       22080077
220900     MOVE ASC-NUMBER-OF-SHIP-TS-ITEMS                             22090077
221000                    TO PV-SHIP-ITEM.                              22100077
221100     PERFORM 9300-WRITE-SHIP-TS.                                  22110077
221200                                                                  22120077
221400*----------------------------------------------------------------*22140077
221500* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *22150077
221600*----------------------------------------------------------------*22160077
221800 4400-MOVE-COMMAREA-TO-SCREEN.                                    22180077
221900     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             22190077
222000         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          22200077
222100         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          22210077
222200             MOVE +1    TO ASC-BLK-SUB                            22220077
222300             PERFORM 5100-WRITE-TEMP-STORAGE                      22230077
222400             ADD +1     TO ASC-BLK-SUB                            22240077
222500             PERFORM 5100-WRITE-TEMP-STORAGE                      22250077
222600             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             22260077
222700                 GIVING PV-BLOCK-NUMBER                           22270077
222800                 REMAINDER PV-REMAINDER                           22280077
222900             IF  PV-REMAINDER > ZERO                              22290077
223000                 ADD +1 TO PV-BLOCK-NUMBER                        22300077
223100             END-IF                                               22310077
223200             MOVE +1    TO ASC-BLK-SUB                            22320077
223300             PERFORM 4410-READ-TEMP-STORAGE                       22330077
223400             ADD +1     TO ASC-BLK-SUB                            22340077
223500                           PV-BLOCK-NUMBER                        22350077
223600             PERFORM 4410-READ-TEMP-STORAGE                       22360077
223700     END-IF.                                                      22370077
223800                                                                  22380077
223900     MOVE +1            TO ASC-BLK-SUB.                           22390077
224000                                                                  22400077
224100     COMPUTE ASC-ITEM-SUB =                                       22410077
224200         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              22420077
224300         + PC-ITEMS-PER-PANEL).                                   22430077
224400*                                                                 22440077
224500     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        22450077
224600         ADD +1         TO ASC-BLK-SUB                            22460077
224700         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            22470077
224800     END-IF.                                                      22480077
224900*                                                                 22490077
225000     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           22500077
225100         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                22510077
225200     PERFORM 4420-FORMAT-LIST-LINES                               22520077
225300         VARYING PV-SUB                                           22530077
225400         FROM PC-ITEMS-PER-PANEL BY -1                            22540077
225500         UNTIL PV-SUB < +1.                                       22550077
225600*                                                                 22560077
225700     COMPUTE ASC-ITEMS-DISPLAYED =                                22570077
225800         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          22580077
225900     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    22590077
226000                                      ASTRTITO.                   22600077
226100     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    22610077
226200     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    22620077
226600                                                                  22660077
226700     MOVE ASC-SCAC-CDE             TO ASCACO.                     22670077
226800                                                                  22680077
226900     MOVE ASC-SHIP-DATE            TO PV-DATE-ISO.                22690077
121000     MOVE PV-DATE-CC-ISO           TO PV-DATE-CC-USA              22701084
121000     MOVE PV-DATE-YY-ISO           TO PV-DATE-YY-USA              22702084
121000     MOVE PV-DATE-MM-ISO           TO PV-DATE-MM-USA              22703084
121000     MOVE PV-DATE-DD-ISO           TO PV-DATE-DD-USA              22704084
227100     MOVE PV-DATE-USA              TO ASDATEO.                    22710077
227200                                                                  22720077
227300     MOVE ASC-SHIP-METHOD          TO ASMETHO.                    22730077
227400     MOVE ASC-CARRIER-SHIP-NBR     TO ACSNBRO.                    22740077
227500     MOVE ASC-PACKAGE-COUNT-N      TO APACKSO.                    22750077
227600     MOVE ASC-VENDOR-NAME          TO AVNAMEO.                    22760077
227700     MOVE ASC-ADDR-LINE (1)        TO AADDR1O.                    22770077
227800     MOVE ASC-ADDR-LINE (2)        TO AADDR2O.                    22780077
227900     MOVE ASC-ADDR-LINE (3)        TO AADDR3O.                    22790077
228000     MOVE ASC-ADDR-LINE (4)        TO AADDR4O.                    22800077
228100     MOVE ASC-ADDR-LINE (5)        TO AADDR5O.                    22810077
228200     MOVE ASC-ADDR-LINE (6)        TO AADDR6O.                    22820077
228300     MOVE ASC-ADDR-LINE (7)        TO AADDR7O.                    22830077
228400     MOVE ASC-ADDR-LINE (8)        TO AADDR8O.                    22840077
228500                                                                  22850077
228600     IF  DP020-MSG-NUMBER-X = SPACE                               22860077
228700         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  22870077
228800*            --- MORE ITEMS TO DISPLAY ----                       22880077
228900             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            22890077
229000             SET DP020-MSG-INFORMATIONAL TO TRUE                  22900077
229100         END-IF                                                   22910077
229200     END-IF.                                                      22920077
229600                                                                  22921084
229300*----------------------------------------------------------------*22930077
229400*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *22940077
229500*----------------------------------------------------------------*22950077
229700 4410-READ-TEMP-STORAGE.                                          22970077
229900     EXEC CICS                                                    22990077
230000         READQ TS                                                 23000077
230100             QUEUE (ASC-LIST-QUEUE-NAME)                          23010077
230200             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               23020077
230300             ITEM  (PV-BLOCK-NUMBER)                              23030077
230400             RESP  (PV-CICS-RESP)                                 23040077
230500     END-EXEC.                                                    23050077
230600                                                                  23060077
230700     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       23070077
230800       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     23080077
230900         CONTINUE                                                 23090077
231000     ELSE                                                         23100077
231100         SET DP013-CICS-ABEND     TO TRUE                         23110077
231200         SET DP013-NO-ROLLBACK    TO TRUE                         23120077
231300         MOVE '4410-READ-TEMP-STORAGE'                            23130077
231400                                  TO DP013-PARAGRAPH              23140077
231500         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      23150077
231600                                  TO DP013-MESSAGE-TEXT(1)        23160077
231700         PERFORM DP013-0000-PROCESS-ABEND                         23170077
231800     END-IF.                                                      23180077
231900                                                                  23190077
232000     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             23200077
232100*                                                                 23210077
232200     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         23220077
232300         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               23230077
232400     END-IF.                                                      23240077
232500                                                                  23250084
232600*----------------------------------------------------------------*23260077
232700*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *23270077
232800*----------------------------------------------------------------*23280077
233000 4420-FORMAT-LIST-LINES.                                          23300077
233100     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      23310077
233200         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                23320077
233300         MOVE SPACE              TO MR-PO-NUMBER (PV-SUB)         23330077
233400                                    MR-REQUEST-DATE (PV-SUB)      23340077
233500                                    MR-PRINT-DATE (PV-SUB)        23350077
233600                                    MR-VENDOR-DUE-DATE (PV-SUB)   23360077
233800     ELSE                                                         23380077
234000         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           23400077
234100             MOVE ASC-PO-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)        23410077
234200                  TO MR-PO-NUMBER-N (PV-SUB)                      23420077
234300                                                                  23430077
234400             MOVE ASC-REQUEST-DATE (ASC-BLK-SUB ASC-ITEM-SUB)     23440077
234500                  TO  PV-DATE-ISO                                 23450077
121000             MOVE PV-DATE-CC-ISO   TO PV-DATE-CC-USA              23461084
121000             MOVE PV-DATE-YY-ISO   TO PV-DATE-YY-USA              23462084
121000             MOVE PV-DATE-MM-ISO   TO PV-DATE-MM-USA              23463084
121000             MOVE PV-DATE-DD-ISO   TO PV-DATE-DD-USA              23464084
234700             MOVE PV-DATE-USA                                     23470077
234800                  TO  MR-REQUEST-DATE (PV-SUB)                    23480077
234900                                                                  23490077
235000             MOVE ASC-VENDOR-DUE-DATE (ASC-BLK-SUB ASC-ITEM-SUB)  23500077
235100                  TO  PV-DATE-ISO                                 23510077
121000             MOVE PV-DATE-CC-ISO   TO PV-DATE-CC-USA              23521084
121000             MOVE PV-DATE-YY-ISO   TO PV-DATE-YY-USA              23522084
121000             MOVE PV-DATE-MM-ISO   TO PV-DATE-MM-USA              23523084
121000             MOVE PV-DATE-DD-ISO   TO PV-DATE-DD-USA              23524084
235300             MOVE PV-DATE-USA                                     23530077
235400                  TO  MR-VENDOR-DUE-DATE (PV-SUB)                 23540077
235500                                                                  23550077
235600             MOVE ASC-PRINT-DATE (ASC-BLK-SUB ASC-ITEM-SUB)       23560077
235700                  TO  PV-DATE-ISO                                 23570077
121000             MOVE PV-DATE-CC-ISO   TO PV-DATE-CC-USA              23581084
121000             MOVE PV-DATE-YY-ISO   TO PV-DATE-YY-USA              23582084
121000             MOVE PV-DATE-MM-ISO   TO PV-DATE-MM-USA              23583084
121000             MOVE PV-DATE-DD-ISO   TO PV-DATE-DD-USA              23584084
235900             MOVE PV-DATE-USA                                     23590077
236000                  TO  MR-PRINT-DATE (PV-SUB)                      23600077
236100         END-IF                                                   23610077
236200     END-IF.                                                      23620077
236300     SUBTRACT +1 FROM ASC-ITEM-SUB                                23630077
236400     IF  ASC-ITEM-SUB < + 1                                       23640077
236500         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  23650077
236600         MOVE +1                 TO ASC-BLK-SUB                   23660077
236700     END-IF.                                                      23670077
236900                                                                  23690077
237000*----------------------------------------------------------------*23700077
237100*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *23710077
237200*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *23720077
237300*----------------------------------------------------------------*23730077
237500 5100-WRITE-TEMP-STORAGE.                                         23750077
237600     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     23760077
237700                                   TO PV-LIST-ITEM-NUMBER.        23770077
237800     COMPUTE PV-BLOCK-NUMBER =                                    23780077
237900         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    23790077
238000                                                                  23800077
238100     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             23810077
238200     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             23820077
238300         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      23830077
238400             PERFORM 5105-REWRITE-ASC-LISTQ                       23840077
238500         END-IF                                                   23850077
238600     ELSE                                                         23860077
238700         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       23870077
238800         ASC-HIGHEST-BLOCK-WRITTEN + 1                            23880077
238900         PERFORM 5110-WRITE-ASC-LISTQ                             23890077
239000         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   23900077
239100     END-IF.                                                      23910077
239200                                                                  23920077
239300     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             23930077
239200                                                                  23931084
239400******************************************************************23940077
239500** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **23950077
239600** SPECIFIC COMMAREA.                                           **23960077
239700******************************************************************23970077
239800 5105-REWRITE-ASC-LISTQ.                                          23980077
239900     EXEC CICS                                                    23990077
240000         WRITEQ TS                                                24000077
240100             QUEUE (ASC-LIST-QUEUE-NAME)                          24010077
240200             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               24020077
240300             ITEM  (PV-BLOCK-NUMBER)                              24030077
240400             REWRITE                                              24040077
240500             RESP  (PV-CICS-RESP)                                 24050077
240600     END-EXEC.                                                    24060077
240700                                                                  24070077
240800     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           24080077
240900         CONTINUE                                                 24090077
241000     ELSE                                                         24100077
241100         SET DP013-CICS-ABEND            TO TRUE                  24110077
241200         SET DP013-NO-ROLLBACK           TO TRUE                  24120077
241300         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       24130077
241400         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     24140077
241500                                         TO DP013-MESSAGE-TEXT(1) 24150077
241600         PERFORM DP013-0000-PROCESS-ABEND                         24160077
241700     END-IF.                                                      24170077
241800                                                                  24180077
241900******************************************************************24190077
242000** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **24200077
242100** SPECIFIC COMMAREA.                                           **24210077
242200******************************************************************24220077
242300 5110-WRITE-ASC-LISTQ.                                            24230077
242400     EXEC CICS                                                    24240077
242500         WRITEQ TS                                                24250077
242600             QUEUE (ASC-LIST-QUEUE-NAME)                          24260077
242700             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               24270077
242800             ITEM  (PV-BLOCK-NUMBER)                              24280077
242900             RESP  (PV-CICS-RESP)                                 24290077
243000     END-EXEC.                                                    24300077
243100     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      24310077
243200         SET DP013-CICS-ABEND      TO TRUE                        24320077
243300         SET DP013-NO-ROLLBACK     TO TRUE                        24330077
243400         MOVE '5110-WRITE-ASC-LISTQ'                              24340077
243500                                   TO DP013-PARAGRAPH             24350077
243600         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           24360077
243700                                   TO DP013-MESSAGE-TEXT(1)       24370077
243800         PERFORM DP013-0000-PROCESS-ABEND                         24380077
243900     END-IF.                                                      24390077
244000                                                                  24400084
244100*----------------------------------------------------------------*24410077
244200*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*24420077
244300*----------------------------------------------------------------*24430077
244500 6112-READ-LIST-QUEUE.                                            24450077
244700     EXEC CICS                                                    24470077
244800         READQ TS                                                 24480077
244900             QUEUE (ASC-LIST-QUEUE-NAME)                          24490077
245000             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     24500077
245100             ITEM  (PV-ITEM)                                      24510077
245200             RESP  (PV-CICS-RESP)                                 24520077
245300     END-EXEC.                                                    24530077
245400*                                                                 24540077
245500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          24550077
245600         CONTINUE                                                 24560077
245700     ELSE                                                         24570077
245800         SET DP013-CICS-ABEND        TO TRUE                      24580077
245900         SET DP013-NO-ROLLBACK       TO TRUE                      24590077
246000         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           24600077
246100         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    24610077
246200                                     TO DP013-MESSAGE-TEXT(1)     24620077
246300         PERFORM DP013-0000-PROCESS-ABEND                         24630077
246400     END-IF.                                                      24640077
246500                                                                  24650077
246600*----------------------------------------------------------------*24660077
246700*    UPDATE THE DB2 TABLES WITH THE SHIPMENT INFORMATION.        *24670077
246800*----------------------------------------------------------------*24680077
246900 7000-UPDATE-SHIPMENT.                                            24690077
247100***************   COMMENT UPDATE SECTION  *********************   24710077
247200*    FIRST DELETE ANY "SHIPMENT" COMMENTS THAT MAY HAVE BEEN      24720077
247300*    INSERTED PREVIOUSLY                                          24730077
247400     IF ASC-KEY-CMNT-ID > +0                                      24740077
247500         PERFORM 7310-DELETE-SHIP-COMMENTS                        24750077
247600     END-IF.                                                      24760077
247700                                                                  24770077
247800*    IF THERE ARE COMMENTS, REINSERT THEM -- IF NOT, MAKE SURE    24780077
247900*    THE COMMENT ID ON THE SHIPMENT(S) IS 0                       24790077
248000     IF ASC-NUMBER-OF-COMM-RECS > 0                               24800077
248100         PERFORM 7300-INSERT-COMMENTS                             24810077
248200             VARYING PV-COMM-ITEM FROM 1 BY 1                     24820077
248300             UNTIL PV-COMM-ITEM                                   24830077
248400             GREATER ASC-NUMBER-OF-COMM-TS-ITEMS                  24840077
248500     ELSE                                                         24850077
248600         MOVE +0    TO ASC-KEY-CMNT-ID                            24860077
248700     END-IF.                                                      24870077
248800****************************************************************  24880077
248900                                                                  24890077
249000                                                                  24900077
249100*******************  SHIPMENT UPDATE SECTION  ******************* 24910077
249200*    FIRST DELETE ALL THE EXISTING SHIPMENT FOR THE REQUESTS THAT 24920077
249300*    HAVE BEEN SELECTED TO BE ON THIS SHIPMENT                    24930077
249400     PERFORM 7100-DELETE-SHIPMENT                                 24940077
249500     VARYING PV-ITEM FROM 1 BY 1                                  24950077
249600     UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.             24960077
249700*    FOR EACH OF THE SHIPMENTS, INSERT SHIPMENTS, AND ALL         24970077
249800*    ASSOCIATED ROWS                                              24980077
249900     PERFORM 7200-SHIPMENT-INSERT                                 24990077
250000     VARYING PV-SHIP-ITEM FROM 1 BY 1                             25000077
250100     UNTIL PV-SHIP-ITEM GREATER THAN ASC-NUMBER-OF-SHIP-TS-ITEMS. 25010077
250200*    FOR EACH OF THE REQUEST, UPDATE THE STATUS TO "S"HIPPED.     25020077
250300     MOVE 'S' TO PV-STATUS-CODE.                                  25030077
250400                                                                  25040077
250500     PERFORM 7400-UPDATE-REQUEST-STATUS                           25050077
250600         VARYING PV-ITEM FROM 1 BY 1                              25060077
250700         UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.         25070077
250800                                                                  25080077
250900*    IF THIS IS A CREATE, UPDATE THE INPUT QUEUE ACTION FIELD TO  25090077
251000*    SHOW 'SHP' BY EACH PO THAT WAS SELECTED, OTHERWISE SET       25100077
251100*    THE SELECT QUEUE TO SHOW 'UPD' NEXT TO THE SHIPMENT THAT     25110077
251200*    WAS JUST UPDATED.                                            25120077
251300     IF ASC-CREATE-SHIP-FORMAT                                    25130077
251400         PERFORM 7401-SET-ACTION-CODE                             25140077
251500             VARYING PV-SEL-ITEM                                  25150077
251600             FROM 1 BY 1                                          25160077
251700             UNTIL (PV-SEL-ITEM > ASC-NUMBER-OF-TS-ITEMS)         25170077
251800     ELSE                                                         25180077
251900         IF ASC-CRIT-SPEC-FORMAT                                  25190077
252000             CONTINUE                                             25200077
252100         ELSE                                                     25210077
252200             PERFORM 9100-READ-SEL-QUEUE                          25220077
252300             SET VL012-UPD (ASC-SEL-SUB) TO TRUE                  25230077
252400             PERFORM 9101-REWRITE-SEL-QUEUE                       25240077
252500     END-IF.                                                      25250077
252600***************************************************************** 25260077
252700                                                                  25270077
252800     MOVE PC-TSYMSG-00059          TO DP020-MSG-NUMBER.           25280077
252900     SET DP020-MSG-INFORMATIONAL   TO TRUE.                       25290077
253000*----------------------------------------------------------------*25300077
253100*  DELETE SHIPMENT ROWS.                                         *25310077
253200*----------------------------------------------------------------*25320077
253300 7100-DELETE-SHIPMENT.                                            25330077
253500     PERFORM 6112-READ-LIST-QUEUE.                                25350077
253600                                                                  25360077
253700     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       25370077
253800         PERFORM                                                  25380077
253900         VARYING LQW-IDX                                          25390077
254000         FROM 1 BY 1                                              25400077
254100         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            25410077
254200            OR LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          25420077
254300                                                                  25430077
254400                 MOVE LQW-PO-REQ-NBR (LQW-IDX)                    25440077
254500                                   TO DK-PO-REQ-NBR               25450077
254600                                                                  25460077
254700                 PERFORM 7101-OPEN-SHIP-DEL-CURSOR                25470077
254800                 PERFORM 7102-FETCH-SHIP-DEL-CURSOR               25480077
254900                 PERFORM 7110-SHIPMENT-DELETE                     25490077
255000                     UNTIL PS-EOC-SHIP-DEL                        25500077
255100                                                                  25510077
255200                 PERFORM 7120-ASSOCIATION-DELETE                  25520077
255300         END-PERFORM                                              25530077
255400     END-IF.                                                      25540077
255500*----------------------------------------------------------------*25550077
255600*  OPEN SHIPMENT CURSOR.                                         *25560077
255700*----------------------------------------------------------------*25570077
255800 7101-OPEN-SHIP-DEL-CURSOR.                                       25580077
256000     PERFORM                                                      25600077
256100         WITH TEST AFTER                                          25610077
256200         VARYING PV-RETRY-COUNTER                                 25620077
256300         FROM 1 BY 1                                              25630077
256400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               25640077
256500             OR (SQLCODE = +0)                                    25650077
256600             OR (SQLCODE = +100))                                 25660077
256700                                                                  25670077
256800         EXEC SQL                                                 25680077
256900              OPEN SHIP_DEL_CURSOR                                25690077
257000         END-EXEC                                                 25700077
257100                                                                  25710077
257200         EVALUATE TRUE                                            25720077
257300             WHEN SQLCODE = +0                                    25730077
257400                 SET PS-NOT-EOC-SHIP-DEL TO TRUE                  25740077
257500                                                                  25750077
257600             WHEN SQLWARN0 NOT = SPACE                            25760077
257700             WHEN SQLCODE < +0                                    25770077
257800             WHEN SQLCODE > +0                                    25780077
257900                 MOVE '7001-OPEN-SHIPEMNT-CURSOR'                 25790077
258000                                   TO DP013-PARAGRAPH             25800077
258100                 MOVE 'OPEN SHIP_DEL_CURSOR '                     25810077
258200                                   TO DP013-MESSAGE-TEXT (1)      25820077
258300                 MOVE DK-PO-REQ-NBR                               25830077
258400                                   TO PV-DISPLAY-COMP             25840077
258500                 MOVE PV-DISPLAY-COMP                             25850077
258600                                   TO DP013-MESSAGE-TEXT (2)      25860077
258700                 MOVE SQLCA        TO DP013-SQLCA                 25870077
258800                 MOVE 'TREQSHP '   TO DP013-DB2-TABLE-NAME (1)    25880077
258900                 MOVE 'TPTKSHP '   TO DP013-DB2-TABLE-NAME (2)    25890077
259000                 SET DP013-DB2-ABEND                              25900077
259100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           25910077
259200                 PERFORM DP013-0000-PROCESS-ABEND                 25920077
259300                                                                  25930077
259400         END-EVALUATE                                             25940077
259500     END-PERFORM.                                                 25950077
259600                                                                  25960077
259800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        25980077
259900         MOVE '7001-OPEN-SHIP-DEL-CURSOR'                         25990077
260000                                   TO DP013-PARAGRAPH             26000077
260100         MOVE SQLCA                TO DP013-SQLCA                 26010077
260200         SET DP013-DB2-ABEND                                      26020077
260300             DP013-XCTL-DISPLAY-RESTART                           26030077
260400                                   TO TRUE                        26040077
260500         PERFORM DP013-0000-PROCESS-ABEND                         26050077
260600     END-IF.                                                      26060077
260700                                                                  26070077
260800*----------------------------------------------------------------*26080077
260900*  FETCH SHIPMENT CURSOR.                                        *26090077
261000*----------------------------------------------------------------*26100077
261100 7102-FETCH-SHIP-DEL-CURSOR.                                      26110077
261300     PERFORM                                                      26130077
261400         WITH TEST AFTER                                          26140077
261500         VARYING PV-RETRY-COUNTER                                 26150077
261600         FROM 1 BY 1                                              26160077
261700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               26170077
261800             OR (SQLCODE = +0)                                    26180077
261900             OR (SQLCODE = +100))                                 26190077
262000                                                                  26200077
262100         EXEC SQL                                                 26210077
262200              FETCH SHIP_DEL_CURSOR                               26220077
262300               INTO :REQSHP-SHIPT-NBR                             26230077
262400         END-EXEC                                                 26240077
262500                                                                  26250077
262600         EVALUATE TRUE                                            26260077
262700             WHEN SQLCODE = +0                                    26270077
262800                 CONTINUE                                         26280077
262900             WHEN SQLCODE = +100                                  26290077
263000                 SET PS-EOC-SHIP-DEL TO TRUE                      26300077
263100                 PERFORM 7103-CLOSE-SHIP-DEL-CURSOR               26310077
263200                                                                  26320077
263300             WHEN SQLWARN0 NOT = SPACE                            26330077
263400             WHEN SQLCODE < +0                                    26340077
263500             WHEN SQLCODE > +0                                    26350077
263600                 MOVE '7102-FETCH-SHIP-DEL-CURSOR'                26360077
263700                                   TO DP013-PARAGRAPH             26370077
263800                 MOVE 'FETCH SHIP_DEL_CURSOR '                    26380077
263900                                   TO DP013-MESSAGE-TEXT (1)      26390077
264000                 MOVE DK-PO-REQ-NBR                               26400077
264100                                   TO PV-DISPLAY-COMP             26410077
264200                 MOVE PV-DISPLAY-COMP                             26420077
264300                                   TO DP013-MESSAGE-TEXT (2)      26430077
264400                 MOVE SQLCA        TO DP013-SQLCA                 26440077
264500                 MOVE 'TREQSHP '   TO DP013-DB2-TABLE-NAME (1)    26450077
264600                 MOVE 'TPTKSHP '   TO DP013-DB2-TABLE-NAME (2)    26460077
264700                 SET DP013-DB2-ABEND                              26470077
264800                     DP013-XCTL-DISPLAY-RESTART TO TRUE           26480077
264900                 PERFORM DP013-0000-PROCESS-ABEND                 26490077
265000                                                                  26500077
265100         END-EVALUATE                                             26510077
265200     END-PERFORM.                                                 26520077
265300                                                                  26530077
265500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        26550077
265600         MOVE '7102-OPEN-SHIP-DEL-CURSOR'                         26560077
265700                                   TO DP013-PARAGRAPH             26570077
265800         MOVE SQLCA                TO DP013-SQLCA                 26580077
265900         SET DP013-DB2-ABEND                                      26590077
266000             DP013-XCTL-DISPLAY-RESTART                           26600077
266100                                   TO TRUE                        26610077
266200         PERFORM DP013-0000-PROCESS-ABEND                         26620077
266300     END-IF.                                                      26630077
266400                                                                  26640077
266500*----------------------------------------------------------------*26650077
266600*  CLOSE SHIPMENT CURSOR.                                        *26660077
266700*----------------------------------------------------------------*26670077
266800 7103-CLOSE-SHIP-DEL-CURSOR.                                      26680077
267000     PERFORM                                                      26700077
267100         WITH TEST AFTER                                          26710077
267200         VARYING PV-RETRY-COUNTER                                 26720077
267300         FROM 1 BY 1                                              26730077
267400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               26740077
267500             OR (SQLCODE = +0))                                   26750077
267600                                                                  26760077
267700         EXEC SQL                                                 26770077
267800              CLOSE SHIP_DEL_CURSOR                               26780077
267900         END-EXEC                                                 26790077
268000                                                                  26800077
268100         EVALUATE TRUE                                            26810077
268200             WHEN SQLCODE = +0                                    26820077
268300                 CONTINUE                                         26830077
268500             WHEN SQLWARN0 NOT = SPACE                            26850077
268600             WHEN SQLCODE < +0                                    26860077
268700             WHEN SQLCODE > +0                                    26870077
268800                 MOVE '7103-CLOSE-SHIP-DEL-CURSOR'                26880077
268900                                   TO DP013-PARAGRAPH             26890077
269000                 MOVE 'FETCH SHIP_DEL_CURSOR '                    26900077
269100                                   TO DP013-MESSAGE-TEXT (1)      26910077
269200                 MOVE DK-PO-REQ-NBR                               26920077
269300                                   TO PV-DISPLAY-COMP             26930077
269400                 MOVE PV-DISPLAY-COMP                             26940077
269500                                   TO DP013-MESSAGE-TEXT (2)      26950077
269600                 MOVE SQLCA        TO DP013-SQLCA                 26960077
269700                 MOVE 'TREQSHP '   TO DP013-DB2-TABLE-NAME (1)    26970077
269800                 MOVE 'TPTKSHP '   TO DP013-DB2-TABLE-NAME (2)    26980077
269900                 SET DP013-DB2-ABEND                              26990077
270000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           27000077
270100                 PERFORM DP013-0000-PROCESS-ABEND                 27010077
270300         END-EVALUATE                                             27030077
270400     END-PERFORM.                                                 27040077
270500                                                                  27050077
270700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        27070077
270800         MOVE '7103-CLOSE-SHIP-DEL-CURSOR'                        27080077
270900                                   TO DP013-PARAGRAPH             27090077
271000         MOVE SQLCA                TO DP013-SQLCA                 27100077
271100         SET DP013-DB2-ABEND                                      27110077
271200             DP013-XCTL-DISPLAY-RESTART                           27120077
271300                                   TO TRUE                        27130077
271400         PERFORM DP013-0000-PROCESS-ABEND                         27140077
271500     END-IF.                                                      27150077
271600                                                                  27160077
271700*----------------------------------------------------------------*27170077
271800*  DELETE SHIPMENT ROWS.                                         *27180077
271900*----------------------------------------------------------------*27190077
272000 7110-SHIPMENT-DELETE.                                            27200077
272200     PERFORM                                                      27220077
272300         WITH TEST AFTER                                          27230077
272400         VARYING PV-RETRY-COUNTER                                 27240077
272500         FROM 1 BY 1                                              27250077
272600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               27260077
272700             OR (SQLCODE = +0)                                    27270077
272800             OR (SQLCODE = +100))                                 27280077
272900                                                                  27290077
273000         EXEC SQL                                                 27300077
273100              DELETE FROM TPTKSHP                                 27310077
273200              WHERE SHIPT_NBR  = :REQSHP-SHIPT-NBR                27320077
273300         END-EXEC                                                 27330077
273400                                                                  27340077
273500         EVALUATE TRUE                                            27350077
273600             WHEN SQLCODE = +0                                    27360077
273700             WHEN SQLCODE = +100                                  27370077
273800                 CONTINUE                                         27380077
273900                                                                  27390077
274000             WHEN SQLWARN0 NOT = SPACE                            27400077
274100             WHEN SQLCODE < +0                                    27410077
274200             WHEN SQLCODE > +0                                    27420077
274300                 MOVE '7110-SHIPMENT-DELETE'                      27430077
274400                                   TO DP013-PARAGRAPH             27440077
274500                 MOVE 'DELETE FROM THE REQUEST SHIPMENT TABLE'    27450077
274600                                   TO DP013-MESSAGE-TEXT (1)      27460077
274700                 MOVE REQSHP-SHIPT-NBR                            27470077
274800                                   TO PV-DISPLAY-COMP             27480077
274900                 MOVE PV-DISPLAY-COMP                             27490077
275000                                   TO DP013-MESSAGE-TEXT (2)      27500077
275100                 MOVE SQLCA        TO DP013-SQLCA                 27510077
275200                 MOVE 'TREQSHP '   TO DP013-DB2-TABLE-NAME (1)    27520077
275300                 SET DP013-DB2-ABEND                              27530077
275400                     DP013-XCTL-DISPLAY-RESTART TO TRUE           27540077
275500                 PERFORM DP013-0000-PROCESS-ABEND                 27550077
275600                                                                  27560077
275700         END-EVALUATE                                             27570077
275800     END-PERFORM.                                                 27580077
275900                                                                  27590077
276100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        27610077
276200         MOVE '7110-SHIPMENT-DELETE'                              27620077
276300                                   TO DP013-PARAGRAPH             27630077
276400         MOVE 'MAX RETRIES EXCEEDED DELETEING SHIPMENT TABLE'     27640077
276500                                   TO DP013-MESSAGE-TEXT (1)      27650077
276600         MOVE SQLCA                TO DP013-SQLCA                 27660077
276700         SET DP013-DB2-ABEND                                      27670077
276800             DP013-XCTL-DISPLAY-RESTART                           27680077
276900                                   TO TRUE                        27690077
277000         PERFORM DP013-0000-PROCESS-ABEND                         27700077
277100     END-IF.                                                      27710077
277200                                                                  27720077
277300     PERFORM 7102-FETCH-SHIP-DEL-CURSOR.                          27730077
277400                                                                  27740077
277500*----------------------------------------------------------------*27750077
277600*  DELETE ASSOCIAION ROWS.                                       *27760077
277700*----------------------------------------------------------------*27770077
277800 7120-ASSOCIATION-DELETE.                                         27780077
278000     PERFORM                                                      27800077
278100         WITH TEST AFTER                                          27810077
278200         VARYING PV-RETRY-COUNTER                                 27820077
278300         FROM 1 BY 1                                              27830077
278400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               27840077
278500             OR (SQLCODE = +0)                                    27850077
278600             OR (SQLCODE = +100))                                 27860077
278700                                                                  27870077
278800         EXEC SQL                                                 27880077
278900              DELETE FROM TREQSHP                                 27890077
279000              WHERE PO_REQ_NBR = :DK-PO-REQ-NBR                   27900077
279100         END-EXEC                                                 27910077
279200                                                                  27920077
279300         EVALUATE TRUE                                            27930077
279400             WHEN SQLCODE = +0                                    27940077
279500             WHEN SQLCODE = +100                                  27950077
279600                 CONTINUE                                         27960077
279700                                                                  27970077
279800             WHEN SQLWARN0 NOT = SPACE                            27980077
279900             WHEN SQLCODE < +0                                    27990077
280000             WHEN SQLCODE > +0                                    28000077
280100                 MOVE '7120-ASSOCIATION-DELETE'                   28010077
280200                                   TO DP013-PARAGRAPH             28020077
280300                 MOVE 'DELETE FROM THE REQUEST ASSOCIATION TABLE' 28030077
280400                                   TO DP013-MESSAGE-TEXT (1)      28040077
280500                 MOVE DK-PO-REQ-NBR                               28050077
280600                                   TO PV-DISPLAY-COMP             28060077
280700                 MOVE PV-DISPLAY-COMP                             28070077
280800                                   TO DP013-MESSAGE-TEXT (2)      28080077
280900                 MOVE SQLCA        TO DP013-SQLCA                 28090077
281000                 MOVE 'TREQSHP '   TO DP013-DB2-TABLE-NAME (1)    28100077
281100                 SET DP013-DB2-ABEND                              28110077
281200                     DP013-XCTL-DISPLAY-RESTART TO TRUE           28120077
281300                 PERFORM DP013-0000-PROCESS-ABEND                 28130077
281400                                                                  28140077
281500         END-EVALUATE                                             28150077
281600     END-PERFORM.                                                 28160077
281700                                                                  28170077
281900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        28190077
282000         MOVE '7120-ASSOCIATION-DELETE'                           28200077
282100                                   TO DP013-PARAGRAPH             28210077
282200         MOVE 'MAX RETRIES EXCEEDED DELETE ASSOCIATION TBL'       28220077
282300                                   TO DP013-MESSAGE-TEXT (1)      28230077
282400         MOVE SQLCA                TO DP013-SQLCA                 28240077
282500         SET DP013-DB2-ABEND                                      28250077
282600             DP013-XCTL-DISPLAY-RESTART                           28260077
282700                                   TO TRUE                        28270077
282800         PERFORM DP013-0000-PROCESS-ABEND                         28280077
282900     END-IF.                                                      28290077
283000                                                                  28300077
283400*----------------------------------------------------------------*28340077
283500*  INSERT SHIPMENT ROWS.                                         *28350077
283600*----------------------------------------------------------------*28360077
283700 7200-SHIPMENT-INSERT.                                            28370077
283900     PERFORM 9302-READ-SHIP-QUEUE.                                28390077
284000                                                                  28400077
284100* READ EACH SHIPMENT FROM THE QUEUE, AND CREATE A NEW SHIPMENT    28410077
284200     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       28420077
284300         PERFORM                                                  28430077
284400         VARYING VL004-IDX FROM 1 BY 1                            28440077
284500         UNTIL VL004-IDX > VL004-MAX-ITEMS                        28450077
284600            OR VL004-ITEM (VL004-IDX) = +0                        28460077
284700                                                                  28470077
284800*            FIRST INSERT THE ACTUAL SHIPMENT                     28480077
284900             MOVE ASC-SCAC-CDE           TO PTKSHP-SCAC-CDE       28490077
285000             MOVE ASC-SHIP-DATE          TO PTKSHP-SHIPT-DTE      28500077
285100             MOVE ASC-SHIP-METHOD        TO PTKSHP-SHIPT-TYP-DESC 28510077
285200                                                                  28520077
285300             MOVE VL004-CARRIER-SHIP-NBR (VL004-IDX)              28530077
285400                                         TO PTKSHP-CARR-SHIPT-ID  28540077
285500             MOVE VL004-PACKAGE-COUNT (VL004-IDX)                 28550077
285600                                         TO PTKSHP-SHPD-PKG-CNT   28560077
285700                                                                  28570077
285800             PERFORM                                              28580077
285900                 WITH TEST AFTER                                  28590077
286000                 VARYING PV-RETRY-COUNTER                         28600077
286100                 FROM 1 BY 1                                      28610077
286200                 UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)       28620077
286300                     OR (SQLCODE = +0))                           28630077
286400                 EXEC SQL                                         28640077
286500                     SET :PV-TIMESTAMP = CURRENT TIMESTAMP        28650077
286600                 END-EXEC                                         28660077
286700                                                                  28670077
286800                 IF SQLCODE = +0                                  28680077
286900                     CONTINUE                                     28690077
287000                 ELSE                                             28700077
287100                     MOVE '7110-SHIPMENT-INSERT'                  28710077
287200                                       TO DP013-PARAGRAPH         28720077
287300                     MOVE 'SET TIMESTAMP FOR RND KEY GENERATION'  28730077
287400                                       TO DP013-MESSAGE-TEXT (1)  28740077
287500                     MOVE SQLCA        TO DP013-SQLCA             28750077
287600                     SET DP013-DB2-ABEND                          28760077
287700                         DP013-XCTL-DISPLAY-RESTART TO TRUE       28770077
287800                     PERFORM DP013-0000-PROCESS-ABEND             28780077
287900                 END-IF                                           28790077
288000                                                                  28800077
288100                 MOVE PV-TIMESTAMP   TO PV-TIMESTAMP-SPLIT        28810077
288200                 MOVE PV-MINUTE      TO PV-RND-MINUTE             28820077
288300                 MOVE PV-SECOND      TO PV-RND-SECOND             28830077
288400                 MOVE PV-NANOSEC-1-3 TO PV-RND-NANOSEC-1-3        28840077
288500                 MOVE PV-NANOSEC-4-6 TO PV-RND-NANOSEC-4-6        28850077
288600                                                                  28860077
288700                 MOVE PV-RANDOM-KEY  TO PTKSHP-SHIPT-NBR          28870077
288800                                                                  28880077
288900                 EXEC SQL                                         28890077
289000                      INSERT INTO TPTKSHP                         28900077
289100                             ( SHIPT_NBR                          28910077
289200                              ,SCAC_CDE                           28920077
289300                              ,CARR_SHIPT_ID                      28930077
289400                              ,SHPD_PKG_CNT                       28940077
289500                              ,SHIPT_DTE                          28950077
289600                              ,SHPR_ID                            28960077
289700                              ,SHIPT_TYP_DESC                     28970077
289800                              ,CMNT_ID                            28980077
289900                             )                                    28990077
290000                      VALUES (                                    29000077
290100                              :PTKSHP-SHIPT-NBR                   29010077
290200                             ,:PTKSHP-SCAC-CDE                    29020077
290300                             ,:PTKSHP-CARR-SHIPT-ID               29030077
290400                             ,:PTKSHP-SHPD-PKG-CNT                29040077
290500                             ,:PTKSHP-SHIPT-DTE                   29050077
290600                             ,:DP020-USERID                       29060077
290700                             ,:PTKSHP-SHIPT-TYP-DESC              29070077
290800                             ,:ASC-KEY-CMNT-ID                    29080077
290900                             )                                    29090077
291000                 END-EXEC                                         29100077
291100                                                                  29110077
291200                 EVALUATE TRUE                                    29120077
291300                     WHEN SQLCODE = +0                            29130077
291400                     WHEN SQLCODE = -803                          29140077
291500                         CONTINUE                                 29150077
291700                     WHEN SQLWARN0 NOT = SPACE                    29170077
291800                     WHEN SQLCODE < +0                            29180077
291900                     WHEN SQLCODE > +0                            29190077
292000                         MOVE '7200-SHIPMENT-INSERT'              29200077
292100                                       TO DP013-PARAGRAPH         29210077
292200                         MOVE 'INSERT REQUEST SHIPMENT TABLE'     29220077
292300                                       TO DP013-MESSAGE-TEXT (1)  29230077
292400                         MOVE PTKSHP-SHIPT-NBR                    29240077
292500                                       TO PV-DISPLAY-COMP         29250077
292600                         MOVE PV-DISPLAY-COMP                     29260077
292700                                       TO DP013-MESSAGE-TEXT (2)  29270077
292800                         MOVE SQLCA    TO DP013-SQLCA             29280077
292900                         MOVE 'TPTKSHP'                           29290077
293000                                      TO DP013-DB2-TABLE-NAME (1) 29300077
293100                         SET DP013-DB2-ABEND                      29310077
293200                             DP013-XCTL-DISPLAY-RESTART TO TRUE   29320077
293300                         PERFORM DP013-0000-PROCESS-ABEND         29330077
293500                 END-EVALUATE                                     29350077
293600             END-PERFORM                                          29360077
293700*                                                                 29370077
293800             IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                29380077
293900                 MOVE '7200-SHIPMENT-INSERT'                      29390077
294000                                       TO DP013-PARAGRAPH         29400077
294100                 MOVE 'MAX RETRIES EXCEEDED INSERT SHIPMENT TABLE'29410077
294200                                       TO DP013-MESSAGE-TEXT (1)  29420077
294300                 MOVE SQLCA            TO DP013-SQLCA             29430077
294400                 SET DP013-DB2-ABEND                              29440077
294500                     DP013-XCTL-DISPLAY-RESTART                   29450077
294600                                           TO TRUE                29460077
294700                 PERFORM DP013-0000-PROCESS-ABEND                 29470077
294800             END-IF                                               29480077
294900                                                                  29490077
295000*            THEN INSERT AN ASSOCIATION ROW FOR THAT SHIPMENT FOR 29500077
295100*            EACH PURCHASE ORDER IN THE SELECTION QUEUE           29510077
295200             PERFORM 7210-INSERT-ASSOCIATION                      29520077
295300               VARYING PV-ITEM FROM 1 BY 1                        29530077
295400               UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN    29540077
295500         END-PERFORM                                              29550077
295600     END-IF.                                                      29560077
295700                                                                  29570077
295800*----------------------------------------------------------------*29580077
295900*  INSERT SHIPMENT ROWS.                                         *29590077
296000*----------------------------------------------------------------*29600077
296100 7210-INSERT-ASSOCIATION.                                         29610077
296300     PERFORM 6112-READ-LIST-QUEUE.                                29630077
296400                                                                  29640077
296500     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       29650077
296600         PERFORM                                                  29660077
296700         VARYING LQW-IDX                                          29670077
296800         FROM 1 BY 1                                              29680077
296900         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            29690077
297000            OR LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          29700077
297100                 MOVE LQW-PO-REQ-NBR (LQW-IDX)                    29710077
297200                                   TO DK-PO-REQ-NBR               29720077
297300                 PERFORM 7220-ASSOCIATION-INSERT                  29730077
297400         END-PERFORM                                              29740077
297500     END-IF.                                                      29750077
297600                                                                  29760077
297800*----------------------------------------------------------------*29780077
297900*  INSERT ASSOCIATION ROW.                                       *29790077
298000*----------------------------------------------------------------*29800077
298100 7220-ASSOCIATION-INSERT.                                         29810077
298300     PERFORM                                                      29830077
298400         WITH TEST AFTER                                          29840077
298500         VARYING PV-RETRY-COUNTER                                 29850077
298600         FROM 1 BY 1                                              29860077
298700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               29870077
298800             OR (SQLCODE = +0))                                   29880077
298900                                                                  29890077
299000         EXEC SQL                                                 29900077
299100              INSERT INTO TREQSHP                                 29910077
299200                     ( PO_REQ_NBR                                 29920077
299300                      ,SHIPT_NBR                                  29930077
299400                      ,SHIPT_GRP_ID                               29940077
299500                     )                                            29950077
299600              VALUES (                                            29960077
299700                      :DK-PO-REQ-NBR                              29970077
299800                     ,:PTKSHP-SHIPT-NBR                           29980077
299900                     ,:ASC-KEY-SHIPT-GRP-ID                       29990077
300000                     )                                            30000077
300100         END-EXEC                                                 30010077
300200                                                                  30020077
300300         EVALUATE TRUE                                            30030077
300400             WHEN SQLCODE = +0                                    30040077
300500                 CONTINUE                                         30050077
300700             WHEN SQLWARN0 NOT = SPACE                            30070077
300800             WHEN SQLCODE < +0                                    30080077
300900             WHEN SQLCODE > +0                                    30090077
301000                 MOVE '7220-ASSOCIATION-INSERT'                   30100077
301100                                   TO DP013-PARAGRAPH             30110077
301200                 MOVE 'INSERT TO THE REQ/SHIP ASSOCIATION TABLE'  30120077
301300                                   TO DP013-MESSAGE-TEXT (1)      30130077
301400                 MOVE PTKSHP-SHIPT-NBR                            30140077
301500                                   TO PV-DISPLAY-COMP             30150077
301600                 MOVE PV-DISPLAY-COMP                             30160077
301700                                   TO DP013-MESSAGE-TEXT (2)      30170077
301800                 MOVE SQLCA        TO DP013-SQLCA                 30180077
301900                 MOVE 'TREQSHP '   TO DP013-DB2-TABLE-NAME (1)    30190077
302000                 SET DP013-DB2-ABEND                              30200077
302100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           30210077
302200                 PERFORM DP013-0000-PROCESS-ABEND                 30220077
302300                                                                  30230077
302400         END-EVALUATE                                             30240077
302500     END-PERFORM.                                                 30250077
302600                                                                  30260077
302800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        30280077
302900         MOVE '7200-SHIPMENT-INSERT'                              30290077
303000                                   TO DP013-PARAGRAPH             30300077
303100         MOVE 'MAX RETRIES EXCEEDED INSERT SHIPMENT TABLE'        30310077
303200                                   TO DP013-MESSAGE-TEXT (1)      30320077
303300         MOVE SQLCA                TO DP013-SQLCA                 30330077
303400         SET DP013-DB2-ABEND                                      30340077
303500             DP013-XCTL-DISPLAY-RESTART                           30350077
303600                                   TO TRUE                        30360077
303700         PERFORM DP013-0000-PROCESS-ABEND                         30370077
303800     END-IF.                                                      30380077
303900                                                                  30390077
304100*-----------------------------------------------------------------30410077
304200*  INSERT ALL SHIPPING COMMENTS TO THE COMMENT TABLE              30420077
304300*-----------------------------------------------------------------30430077
304400 7300-INSERT-COMMENTS.                                            30440077
304600     PERFORM 9250-READ-COMMENT-QUEUE.                             30460077
304700                                                                  30470077
304800     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       30480077
304900         PERFORM                                                  30490077
305000         VARYING VL001-IDX                                        30500077
305100         FROM 1 BY 1                                              30510077
305200         UNTIL VL001-IDX GREATER THAN VL001-MAX-ITEMS             30520077
305300           OR  VL001-ITEM (VL001-IDX) EQUAL ZERO                  30530077
305400                 MOVE VL001-PRE-TKT-CMNT-DESC (VL001-IDX)         30540077
305500                   TO PTKCMT-PRE-TKT-CMNT-DESC                    30550077
305600                 MOVE VL001-CMNT-CRER-ID (VL001-IDX)              30560077
305700                   TO PTKCMT-CMNT-CRER-ID                         30570077
305800                 IF ASC-KEY-CMNT-ID = +0                          30580077
305900                     PERFORM 7320-GET-CMNT-ID                     30590077
306000                         UNTIL SQLCODE = +100                     30600077
306100                 END-IF                                           30610077
306200                 PERFORM 7330-COMMENT-INSERT                      30620077
306300         END-PERFORM                                              30630077
306400     END-IF.                                                      30640077
306500                                                                  30650077
306600*-----------------------------------------------------------------30660077
306700*  DELETE ANY SHIPPING COMMENTS THAT MAY BE BEEN INSERTED PREVIOUS30670077
306800*-----------------------------------------------------------------30680077
306900 7310-DELETE-SHIP-COMMENTS.                                       30690077
307100     EXEC SQL                                                     30710077
307200        DELETE FROM TPTKCMT                                       30720077
307300        WHERE                                                     30730077
307400              CMNT_ID    = :ASC-KEY-CMNT-ID                       30740077
307500          AND CMNT_TYP_CDE = 'S'                                  30750077
307600     END-EXEC.                                                    30760077
307700                                                                  30770077
307800     EVALUATE TRUE                                                30780077
307900         WHEN SQLCODE = +0                                        30790077
308000         WHEN SQLCODE = +100                                      30800077
308100             CONTINUE                                             30810077
308300         WHEN SQLWARN0 NOT = SPACE                                30830077
308400         WHEN SQLCODE < +0                                        30840077
308500         WHEN SQLCODE > +0                                        30850077
308600             MOVE '7310-DELETE-SHIP-COMMENTS'                     30860077
308700                                   TO DP013-PARAGRAPH             30870077
308800             MOVE 'DELETE SHIP COMMENTS FROM COMMENT TABLE'       30880077
308900                                   TO DP013-MESSAGE-TEXT (1)      30890077
309000             MOVE ASC-KEY-CMNT-ID  TO PV-DISPLAY-COMP             30900077
309100             MOVE PV-DISPLAY-COMP  TO DP013-MESSAGE-TEXT (2)      30910077
309200             MOVE SQLCA            TO DP013-SQLCA                 30920077
309300             MOVE 'TPTKCMT '       TO DP013-DB2-TABLE-NAME (1)    30930077
309400             SET DP013-DB2-ABEND                                  30940077
309500                 DP013-XCTL-DISPLAY-RESTART TO TRUE               30950077
309600             PERFORM DP013-0000-PROCESS-ABEND                     30960077
309700     END-EVALUATE.                                                30970077
309700                                                                  30971084
309800*-----------------------------------------------------------------30980077
309900*  GENERATE A RANDOM COMMENT ID NUMBER, AND CHECK TO MAKE SURE IT 30990077
310000*  UNIQUE ON THE COMMENT TABLE                                    31000077
310100*-----------------------------------------------------------------31010077
310200 7320-GET-CMNT-ID.                                                31020077
449400     EXEC SQL                                                     44940000
449500         SET :PV-TIMESTAMP = CURRENT TIMESTAMP                    44950000
449600     END-EXEC                                                     44960000
449700                                                                  44970000
449800     IF SQLCODE = +0                                              44980000
449900         CONTINUE                                                 44990000
450000     ELSE                                                         45000000
450100         MOVE '7320-GET-CMNT-ID'                                  45010077
450200                           TO DP013-PARAGRAPH                     45020000
450300         MOVE 'SET TIMESTAMP FOR RND KEY GENERATION'              45030000
450400                           TO DP013-MESSAGE-TEXT (1)              45040000
450500         MOVE SQLCA        TO DP013-SQLCA                         45050000
450600         SET DP013-DB2-ABEND                                      45060000
450700             DP013-XCTL-DISPLAY-RESTART TO TRUE                   45070000
450800         PERFORM DP013-0000-PROCESS-ABEND                         45080000
450900     END-IF                                                       45090000
451000                                                                  45100000
451100     MOVE PV-TIMESTAMP   TO PV-TIMESTAMP-SPLIT                    45110000
451200     MOVE PV-MINUTE      TO PV-RND-MINUTE                         45120000
451300     MOVE PV-SECOND      TO PV-RND-SECOND                         45130000
451400     MOVE PV-NANOSEC-1-3 TO PV-RND-NANOSEC-1-3                    45140000
451500     MOVE PV-NANOSEC-4-6 TO PV-RND-NANOSEC-4-6                    45150000
451600                                                                  45160000
451700     MOVE PV-RANDOM-KEY  TO ASC-KEY-CMNT-ID                       45170000
451800                                                                  45180000
451900     EXEC SQL                                                     45190000
452000          SELECT CMNT_ID                                          45200000
452100          INTO   :PTKCMT-CMNT-ID                                  45210077
452200          FROM   TPTKCMT                                          45220077
452300          WHERE  CMNT_ID = :ASC-KEY-CMNT-ID                       45230077
455400     END-EXEC                                                     45540000
455500                                                                  45550000
455600     EVALUATE TRUE                                                45560000
455700         WHEN SQLCODE = +0                                        45570000
455800         WHEN SQLCODE = -811                                      45580000
455810         WHEN SQLCODE = +100                                      45581077
455900             CONTINUE                                             45590000
456100         WHEN SQLWARN0 NOT = SPACE                                45610000
456200         WHEN SQLCODE < +0                                        45620000
456300         WHEN SQLCODE > +0                                        45630000
456400             MOVE '7320-GET-CMNT-ID'                              45640000
456500                               TO DP013-PARAGRAPH                 45650000
456600             MOVE 'CHECK THE COMMENT TABLE FOR DUPLICATE IDS'     45660000
456700                               TO DP013-MESSAGE-TEXT (1)          45670000
456800             MOVE ASC-KEY-CMNT-ID                                 45680000
456900                               TO PV-DISPLAY-COMP                 45690000
457000             MOVE PV-DISPLAY-COMP                                 45700000
457100                               TO DP013-MESSAGE-TEXT (2)          45710000
457600             MOVE SQLCA        TO DP013-SQLCA                     45760000
457700             MOVE 'TPTKCMT '   TO DP013-DB2-TABLE-NAME (1)        45770000
457800             SET DP013-DB2-ABEND                                  45780000
457900                 DP013-XCTL-DISPLAY-RESTART TO TRUE               45790000
458000             PERFORM DP013-0000-PROCESS-ABEND                     45800000
458200     END-EVALUATE.                                                45820000
458300                                                                  45830077
458400*-----------------------------------------------------------------45840077
458500*  INSERT ON COMMENT LINE TO ONE REQUEST                          45850077
458600*-----------------------------------------------------------------45860077
458700 7330-COMMENT-INSERT.                                             45870077
458900     ADD +1 TO    DK-COMMENT-SEQ.                                 45890077
459000                                                                  45900077
459100     EXEC SQL                                                     45910077
459200        INSERT INTO TPTKCMT                                       45920077
459300               (                                                  45930077
459400                 CMNT_ID                                          45940077
459500                ,SEQ_NBR                                          45950077
459600                ,PRE_TKT_CMNT_DESC                                45960077
459700                ,CMNT_CRER_ID                                     45970077
459800                ,CMNT_TYP_CDE                                     45980077
459900               )                                                  45990077
460000        VALUES (                                                  46000077
460100                 :ASC-KEY-CMNT-ID                                 46010077
460200                ,:DK-COMMENT-SEQ                                  46020077
460300                ,:PTKCMT-PRE-TKT-CMNT-DESC                        46030077
460400                ,:DP020-USERID                                    46040077
460500                ,'S'                                              46050077
460600               )                                                  46060077
460700     END-EXEC.                                                    46070077
460800                                                                  46080077
460900     EVALUATE TRUE                                                46090077
461000         WHEN SQLCODE = +0                                        46100077
461100             CONTINUE                                             46110077
461300         WHEN SQLWARN0 NOT = SPACE                                46130077
461400         WHEN SQLCODE < +0                                        46140077
461500         WHEN SQLCODE > +0                                        46150077
461600             MOVE '7330-COMMENT-INSERT'                           46160077
461700                                   TO DP013-PARAGRAPH             46170077
461800             MOVE 'INSERT COMMENT LINE TO THE COMMENT TABLE'      46180077
461900                                   TO DP013-MESSAGE-TEXT (1)      46190077
462000             MOVE DK-PO-REQ-NBR    TO PV-DISPLAY-COMP             46200077
462100             MOVE PV-DISPLAY-COMP  TO DP013-MESSAGE-TEXT (2)      46210077
462200             MOVE DK-COMMENT-SEQ   TO PV-DISPLAY-COMP             46220077
462300             MOVE PV-DISPLAY-COMP  TO DP013-MESSAGE-TEXT (3)      46230077
462400             MOVE SQLCA            TO DP013-SQLCA                 46240077
462500             MOVE 'TPTKCMT '       TO DP013-DB2-TABLE-NAME (1)    46250077
462600             SET DP013-DB2-ABEND                                  46260077
462700                 DP013-XCTL-DISPLAY-RESTART TO TRUE               46270077
462800             PERFORM DP013-0000-PROCESS-ABEND                     46280077
462900     END-EVALUATE.                                                46290077
463000                                                                  46300077
463200*----------------------------------------------------------------*46320077
463300*  UPDATE THE STATUS OF EACH REQUEST TO BE "SHIPPED"             *46330077
463400*----------------------------------------------------------------*46340077
463500 7400-UPDATE-REQUEST-STATUS.                                      46350077
463700     PERFORM 6112-READ-LIST-QUEUE.                                46370077
463800                                                                  46380077
463900     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       46390077
464000         PERFORM                                                  46400077
464100         VARYING LQW-IDX                                          46410077
464200         FROM 1 BY 1                                              46420077
464300         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            46430077
464400           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          46440077
464600             MOVE LQW-PO-REQ-NBR (LQW-IDX)                        46460077
464700                                   TO DK-PO-REQ-NBR               46470077
464900             PERFORM                                              46490077
465000                 WITH TEST AFTER                                  46500077
465100                 VARYING PV-RETRY-COUNTER                         46510077
465200                 FROM 1 BY 1                                      46520077
465300                 UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)       46530077
465400                     OR (SQLCODE = +0))                           46540077
465500                                                                  46550077
465600                 EXEC SQL                                         46560077
465700                      UPDATE TPTKREQ                              46570077
465800                      SET REQ_STAT_CDE = :PV-STATUS-CODE          46580077
465900                      WHERE PO_REQ_NBR = :DK-PO-REQ-NBR           46590077
466000                 END-EXEC                                         46600077
466100                                                                  46610077
466200                 EVALUATE TRUE                                    46620077
466300                     WHEN SQLCODE = +0                            46630077
466400                         CONTINUE                                 46640077
466500                                                                  46650077
466600                     WHEN SQLWARN0 NOT = SPACE                    46660077
466700                     WHEN SQLCODE < +0                            46670077
466800                     WHEN SQLCODE > +0                            46680077
466900                         MOVE '7400-UPDATE-REQUEST-STATUS'        46690077
467000                                     TO DP013-PARAGRAPH           46700077
467100                         MOVE 'UPDATE STATUS ON THE REQUEST TABLE'46710077
467200                                     TO DP013-MESSAGE-TEXT (1)    46720077
467300                         MOVE DK-PO-REQ-NBR                       46730077
467400                                     TO PV-DISPLAY-COMP           46740077
467500                         MOVE PV-DISPLAY-COMP                     46750077
467600                                     TO DP013-MESSAGE-TEXT (1)    46760077
467700                         MOVE SQLCA  TO DP013-SQLCA               46770077
467800                         MOVE 'TPTKREQ '                          46780077
467900                                     TO DP013-DB2-TABLE-NAME (1)  46790077
468000                         SET DP013-DB2-ABEND                      46800077
468100                             DP013-XCTL-DISPLAY-RESTART TO TRUE   46810077
468200                         PERFORM DP013-0000-PROCESS-ABEND         46820077
468400                 END-EVALUATE                                     46840077
468500             END-PERFORM                                          46850077
468600*                                                                 46860077
468700             IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                46870077
468800                 MOVE '7400-UPDATE-REQUEST-STATUS'                46880077
468900                                       TO DP013-PARAGRAPH         46890077
469000                 MOVE 'MAX RETRIES EXCEEDED UPDATE REQUEST TABLE' 46900077
469100                                       TO DP013-MESSAGE-TEXT(1)   46910077
469200                 MOVE SQLCA            TO DP013-SQLCA             46920077
469300                 SET DP013-DB2-ABEND                              46930077
469400                     DP013-XCTL-DISPLAY-RESTART                   46940077
469500                                       TO TRUE                    46950077
469600                 PERFORM DP013-0000-PROCESS-ABEND                 46960077
469700             END-IF                                               46970077
469800         END-PERFORM                                              46980077
470000     END-IF.                                                      47000077
470100                                                                  47010077
470200*----------------------------------------------------------------*47020077
470300*  SET THE ACTION CODE ON THE INPUT QUEUE (QUEUE OF PO'S IF THIS *47030077
470400*  IS COMING FROM THE PRINTED LIST (CREATE))                     *47040077
470500*----------------------------------------------------------------*47050077
470600 7401-SET-ACTION-CODE.                                            47060077
470800     PERFORM 9100-READ-SEL-QUEUE                                  47080077
470900                                                                  47090077
471000     PERFORM                                                      47100077
471100         VARYING VL003-IDX                                        47110077
471200         FROM 1 BY 1                                              47120077
471300         UNTIL VL003-IDX > VL003-MAX-ITEMS                        47130077
471400            OR VL003-ITEM (VL003-IDX) = +0                        47140077
471500                                                                  47150077
471600         SET VL003-SHP (VL003-IDX)                                47160077
471700                               TO TRUE                            47170077
471800     END-PERFORM                                                  47180077
471900                                                                  47190077
472000     PERFORM 9101-REWRITE-SEL-QUEUE.                              47200077
472100                                                                  47210077
472200*----------------------------------------------------------------*47220077
472300*  OPEN COMMENT CURSOR.                                          *47230077
472400*----------------------------------------------------------------*47240077
472500 7500-OPEN-COMMENT-CURSOR.                                        47250077
472700     PERFORM                                                      47270077
472800         WITH TEST AFTER                                          47280077
472900         VARYING PV-RETRY-COUNTER                                 47290077
473000         FROM 1 BY 1                                              47300077
473100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               47310077
473200             OR (SQLCODE = +0)                                    47320077
473300             OR (SQLCODE = +100))                                 47330077
473400                                                                  47340077
473500         EXEC SQL                                                 47350077
473600              OPEN COMMENT_CURSOR                                 47360077
473700         END-EXEC                                                 47370077
473800                                                                  47380077
473900         EVALUATE TRUE                                            47390077
474000             WHEN SQLCODE = +0                                    47400077
474100                 SET PS-NOT-EOC-COMMENT TO TRUE                   47410077
474200                                                                  47420077
474300             WHEN SQLWARN0 NOT = SPACE                            47430077
474400             WHEN SQLCODE < +0                                    47440077
474500             WHEN SQLCODE > +0                                    47450077
474600                 MOVE '7500-OPEN-COMMENT-CURSOR'                  47460077
474700                                   TO DP013-PARAGRAPH             47470077
474800                 MOVE 'OPEN COMMENT_CUROSR  '                     47480077
474900                                   TO DP013-MESSAGE-TEXT (1)      47490077
475000                 MOVE DK-SHIPT-GRP-ID                             47500077
475100                                   TO PV-DISPLAY-COMP             47510077
475200                 MOVE PV-DISPLAY-COMP                             47520077
475300                                   TO DP013-MESSAGE-TEXT (2)      47530077
475400                 MOVE SQLCA        TO DP013-SQLCA                 47540077
475500                 MOVE 'TREQSHP '   TO DP013-DB2-TABLE-NAME (1)    47550077
475600                 MOVE 'TPTKSHP '   TO DP013-DB2-TABLE-NAME (2)    47560077
475700                 MOVE 'TPTKCMT '   TO DP013-DB2-TABLE-NAME (3)    47570077
475800                 SET DP013-DB2-ABEND                              47580077
475900                     DP013-XCTL-DISPLAY-RESTART TO TRUE           47590077
476000                 PERFORM DP013-0000-PROCESS-ABEND                 47600077
476100                                                                  47610077
476200         END-EVALUATE                                             47620077
476300     END-PERFORM.                                                 47630077
476400                                                                  47640077
476600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        47660077
476700         MOVE '7500-OPEN-COMMENT-CURSOR'                          47670077
476800                                   TO DP013-PARAGRAPH             47680077
476900         MOVE SQLCA                TO DP013-SQLCA                 47690077
477000         SET DP013-DB2-ABEND                                      47700077
477100             DP013-XCTL-DISPLAY-RESTART                           47710077
477200                                   TO TRUE                        47720077
477300         PERFORM DP013-0000-PROCESS-ABEND                         47730077
477400     END-IF.                                                      47740077
477500                                                                  47750077
477600*----------------------------------------------------------------*47760077
477700*  FETCH COMMENT CURSOR.                                         *47770077
477800*----------------------------------------------------------------*47780077
477900 7510-FETCH-COMMENT-CURSOR.                                       47790077
478100     PERFORM                                                      47810077
478200         WITH TEST AFTER                                          47820077
478300         VARYING PV-RETRY-COUNTER                                 47830077
478400         FROM 1 BY 1                                              47840077
478500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               47850077
478600             OR (SQLCODE = +0)                                    47860077
478700             OR (SQLCODE = +100))                                 47870077
478800                                                                  47880077
478900         EXEC SQL                                                 47890077
479000              FETCH COMMENT_CURSOR                                47900077
479100              INTO  :PTKCMT-PRE-TKT-CMNT-DESC                     47910077
479200                   ,:PTKCMT-SEQ-NBR                               47920077
479300                   ,:PTKCMT-CMNT-ID                               47930077
479400         END-EXEC                                                 47940077
479500                                                                  47950077
479600         EVALUATE TRUE                                            47960077
479700             WHEN SQLCODE = +0                                    47970077
479800                 CONTINUE                                         47980077
479900             WHEN SQLCODE = +100                                  47990077
480000                 SET PS-EOC-COMMENT TO TRUE                       48000077
480100                 PERFORM 7520-CLOSE-COMMENT-CURSOR                48010077
480200                                                                  48020077
480300             WHEN SQLWARN0 NOT = SPACE                            48030077
480400             WHEN SQLCODE < +0                                    48040077
480500             WHEN SQLCODE > +0                                    48050077
480600                 MOVE '7510-FETCH-COMMENT-CURSOR'                 48060077
480700                                   TO DP013-PARAGRAPH             48070077
480800                 MOVE 'FETCH COMMENT_CURSOR '                     48080077
480900                                   TO DP013-MESSAGE-TEXT (1)      48090077
481000                 MOVE DK-SHIPT-GRP-ID                             48100077
481100                                   TO PV-DISPLAY-COMP             48110077
481200                 MOVE PV-DISPLAY-COMP                             48120077
481300                                   TO DP013-MESSAGE-TEXT (2)      48130077
481400                 MOVE SQLCA        TO DP013-SQLCA                 48140077
481500                 MOVE 'TREQSHP '   TO DP013-DB2-TABLE-NAME (1)    48150077
481600                 MOVE 'TPTKSHP '   TO DP013-DB2-TABLE-NAME (2)    48160077
481700                 MOVE 'TPTKCMT '   TO DP013-DB2-TABLE-NAME (3)    48170077
481800                 SET DP013-DB2-ABEND                              48180077
481900                     DP013-XCTL-DISPLAY-RESTART TO TRUE           48190077
482000                 PERFORM DP013-0000-PROCESS-ABEND                 48200077
482100                                                                  48210077
482200         END-EVALUATE                                             48220077
482300     END-PERFORM.                                                 48230077
482400                                                                  48240077
482600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        48260077
482700         MOVE '7510-FETCH-COMMENT-CURSOR'                         48270077
482800                                   TO DP013-PARAGRAPH             48280077
482900         MOVE SQLCA                TO DP013-SQLCA                 48290077
483000         SET DP013-DB2-ABEND                                      48300077
483100             DP013-XCTL-DISPLAY-RESTART                           48310077
483200                                   TO TRUE                        48320077
483300         PERFORM DP013-0000-PROCESS-ABEND                         48330077
483400     END-IF.                                                      48340077
483500                                                                  48350077
483600*----------------------------------------------------------------*48360077
483700*  CLOSE COMMENT CURSOR.                                         *48370077
483800*----------------------------------------------------------------*48380077
483900 7520-CLOSE-COMMENT-CURSOR.                                       48390077
484100     PERFORM                                                      48410077
484200         WITH TEST AFTER                                          48420077
484300         VARYING PV-RETRY-COUNTER                                 48430077
484400         FROM 1 BY 1                                              48440077
484500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               48450077
484600             OR (SQLCODE = +0))                                   48460077
484700                                                                  48470077
484800         EXEC SQL                                                 48480077
484900              CLOSE COMMENT_CURSOR                                48490077
485000         END-EXEC                                                 48500077
485100                                                                  48510077
485200         EVALUATE TRUE                                            48520077
485300             WHEN SQLCODE = +0                                    48530077
485400                 CONTINUE                                         48540077
485500                                                                  48550077
485600             WHEN SQLWARN0 NOT = SPACE                            48560077
485700             WHEN SQLCODE < +0                                    48570077
485800             WHEN SQLCODE > +0                                    48580077
485900                 MOVE '7520-CLOSE-COMMENT-CURSOR'                 48590077
486000                                   TO DP013-PARAGRAPH             48600077
486100                 MOVE 'CLOSE COMMENT_CURSOR'                      48610077
486200                                   TO DP013-MESSAGE-TEXT (1)      48620077
486300                 MOVE SQLCA        TO DP013-SQLCA                 48630077
486400                 MOVE 'TREQSHP '   TO DP013-DB2-TABLE-NAME (1)    48640077
486500                 MOVE 'TPTKCMT '   TO DP013-DB2-TABLE-NAME (3)    48650077
486600                 MOVE 'TPTKSHP '   TO DP013-DB2-TABLE-NAME (2)    48660077
486700                 SET DP013-DB2-ABEND                              48670077
486800                     DP013-XCTL-DISPLAY-RESTART TO TRUE           48680077
486900                 PERFORM DP013-0000-PROCESS-ABEND                 48690077
487000                                                                  48700077
487100         END-EVALUATE                                             48710077
487200     END-PERFORM.                                                 48720077
487300                                                                  48730077
487500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        48750077
487600         MOVE '7520-CLOSE-COMMENT-CURSOR'                         48760077
487700                                   TO DP013-PARAGRAPH             48770077
487800         MOVE SQLCA                TO DP013-SQLCA                 48780077
487900         SET DP013-DB2-ABEND                                      48790077
488000             DP013-XCTL-DISPLAY-RESTART                           48800077
488100                                   TO TRUE                        48810077
488200         PERFORM DP013-0000-PROCESS-ABEND                         48820077
488300     END-IF.                                                      48830077
488400                                                                  48840077
488700*----------------------------------------------------------------*48870077
488800*  OPEN SHIPMENT CURSOR.                                         *48880077
488900*----------------------------------------------------------------*48890077
489000 7600-OPEN-SHIPMENT-CURSOR.                                       48900077
489200     PERFORM                                                      48920077
489300         WITH TEST AFTER                                          48930077
489400         VARYING PV-RETRY-COUNTER                                 48940077
489500         FROM 1 BY 1                                              48950077
489600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               48960077
489700             OR (SQLCODE = +0)                                    48970077
489800             OR (SQLCODE = +100))                                 48980077
489900                                                                  48990077
490000         EXEC SQL                                                 49000077
490100              OPEN SHIPMENT_CURSOR                                49010077
490200         END-EXEC                                                 49020077
490300                                                                  49030077
490400         EVALUATE TRUE                                            49040077
490500             WHEN SQLCODE = +0                                    49050077
490600                 SET PS-NOT-EOC-SHIPMENT TO TRUE                  49060077
490700                                                                  49070077
490800             WHEN SQLWARN0 NOT = SPACE                            49080077
490900             WHEN SQLCODE < +0                                    49090077
491000             WHEN SQLCODE > +0                                    49100077
491100                 MOVE '7600-OPEN-SHIPMENT-CURSOR'                 49110077
491200                                   TO DP013-PARAGRAPH             49120077
491300                 MOVE 'OPEN SHIPMENT_CUROSR  '                    49130077
491400                                   TO DP013-MESSAGE-TEXT (1)      49140077
491500                 MOVE DK-SHIPT-GRP-ID                             49150077
491600                                   TO PV-DISPLAY-COMP             49160077
491700                 MOVE PV-DISPLAY-COMP                             49170077
491800                                   TO DP013-MESSAGE-TEXT (2)      49180077
491900                 MOVE SQLCA        TO DP013-SQLCA                 49190077
492000                 MOVE 'TREQSHP '   TO DP013-DB2-TABLE-NAME (1)    49200077
492100                 MOVE 'TPTKSHP '   TO DP013-DB2-TABLE-NAME (2)    49210077
492200                 SET DP013-DB2-ABEND                              49220077
492300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           49230077
492400                 PERFORM DP013-0000-PROCESS-ABEND                 49240077
492500                                                                  49250077
492600         END-EVALUATE                                             49260077
492700     END-PERFORM.                                                 49270077
492800                                                                  49280077
493000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        49300077
493100         MOVE '7600-OPEN-SHIPMENT-CURSOR'                         49310077
493200                                   TO DP013-PARAGRAPH             49320077
493300         MOVE SQLCA                TO DP013-SQLCA                 49330077
493400         SET DP013-DB2-ABEND                                      49340077
493500             DP013-XCTL-DISPLAY-RESTART                           49350077
493600                                   TO TRUE                        49360077
493700         PERFORM DP013-0000-PROCESS-ABEND                         49370077
493800     END-IF.                                                      49380077
493900                                                                  49390077
494000*----------------------------------------------------------------*49400077
494100*  FETCH SHIPMENT CURSOR.                                        *49410077
494200*----------------------------------------------------------------*49420077
494300 7610-FETCH-SHIPMENT-CURSOR.                                      49430077
494500     PERFORM                                                      49450077
494600         WITH TEST AFTER                                          49460077
494700         VARYING PV-RETRY-COUNTER                                 49470077
494800         FROM 1 BY 1                                              49480077
494900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               49490077
495000             OR (SQLCODE = +0)                                    49500077
495100             OR (SQLCODE = +100))                                 49510077
495200                                                                  49520077
495300         EXEC SQL                                                 49530077
495400              FETCH SHIPMENT_CURSOR                               49540077
495500              INTO  :PTKSHP-SHIPT-TYP-DESC                        49550077
495600                 ,  :PTKSHP-SCAC-CDE                              49560077
495700                 ,  :PTKSHP-CARR-SHIPT-ID                         49570077
495800                 ,  :PTKSHP-SHPD-PKG-CNT                          49580077
495900                 ,  :PTKSHP-SHIPT-DTE                             49590077
496000         END-EXEC                                                 49600077
496100                                                                  49610077
496200         EVALUATE TRUE                                            49620077
496300             WHEN SQLCODE = +0                                    49630077
496400                 CONTINUE                                         49640077
496500             WHEN SQLCODE = +100                                  49650077
496600                 SET PS-EOC-SHIPMENT TO TRUE                      49660077
496700                 PERFORM 7620-CLOSE-SHIPMENT-CURSOR               49670077
496800                                                                  49680077
496900             WHEN SQLWARN0 NOT = SPACE                            49690077
497000             WHEN SQLCODE < +0                                    49700077
497100             WHEN SQLCODE > +0                                    49710077
497200                 MOVE '7610-FETCH-SHIPMENT-CURSOR'                49720077
497300                                   TO DP013-PARAGRAPH             49730077
497400                 MOVE 'FETCH SHIPMENT_CURSOR '                    49740077
497500                                   TO DP013-MESSAGE-TEXT (1)      49750077
497600                 MOVE DK-SHIPT-GRP-ID                             49760077
497700                                   TO PV-DISPLAY-COMP             49770077
497800                 MOVE PV-DISPLAY-COMP                             49780077
497900                                   TO DP013-MESSAGE-TEXT (2)      49790077
498000                 MOVE SQLCA        TO DP013-SQLCA                 49800077
498100                 MOVE 'TREQSHP '   TO DP013-DB2-TABLE-NAME (1)    49810077
498200                 MOVE 'TPTKSHP '   TO DP013-DB2-TABLE-NAME (2)    49820077
498300                 SET DP013-DB2-ABEND                              49830077
498400                     DP013-XCTL-DISPLAY-RESTART TO TRUE           49840077
498500                 PERFORM DP013-0000-PROCESS-ABEND                 49850077
498600                                                                  49860077
498700         END-EVALUATE                                             49870077
498800     END-PERFORM.                                                 49880077
498900                                                                  49890077
499100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        49910077
499200         MOVE '7610-FETCH-SHIPMENT-CURSOR'                        49920077
499300                                   TO DP013-PARAGRAPH             49930077
499400         MOVE SQLCA                TO DP013-SQLCA                 49940077
499500         SET DP013-DB2-ABEND                                      49950077
499600             DP013-XCTL-DISPLAY-RESTART                           49960077
499700                                   TO TRUE                        49970077
499800         PERFORM DP013-0000-PROCESS-ABEND                         49980077
499900     END-IF.                                                      49990077
500000                                                                  50000077
500100*----------------------------------------------------------------*50010077
500200*  CLOSE SHIPMENT CURSOR.                                        *50020077
500300*----------------------------------------------------------------*50030077
500400 7620-CLOSE-SHIPMENT-CURSOR.                                      50040077
500600     PERFORM                                                      50060077
500700         WITH TEST AFTER                                          50070077
500800         VARYING PV-RETRY-COUNTER                                 50080077
500900         FROM 1 BY 1                                              50090077
501000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               50100077
501100             OR (SQLCODE = +0))                                   50110077
501200                                                                  50120077
501300         EXEC SQL                                                 50130077
501400              CLOSE SHIPMENT_CURSOR                               50140077
501500         END-EXEC                                                 50150077
501600                                                                  50160077
501700         EVALUATE TRUE                                            50170077
501800             WHEN SQLCODE = +0                                    50180077
501900                 CONTINUE                                         50190077
502100             WHEN SQLWARN0 NOT = SPACE                            50210077
502200             WHEN SQLCODE < +0                                    50220077
502300             WHEN SQLCODE > +0                                    50230077
502400                 MOVE '7620-CLOSE-SHIPMENT-CURSOR'                50240077
502500                                   TO DP013-PARAGRAPH             50250077
502600                 MOVE 'CLOSE SHIPMENT_CURSOR'                     50260077
502700                                   TO DP013-MESSAGE-TEXT (1)      50270077
502800                 MOVE SQLCA        TO DP013-SQLCA                 50280077
502900                 MOVE 'TREQSHP '   TO DP013-DB2-TABLE-NAME (1)    50290077
503000                 MOVE 'TPTKSHP '   TO DP013-DB2-TABLE-NAME (2)    50300077
503100                 SET DP013-DB2-ABEND                              50310077
503200                     DP013-XCTL-DISPLAY-RESTART TO TRUE           50320077
503300                 PERFORM DP013-0000-PROCESS-ABEND                 50330077
503500         END-EVALUATE                                             50350077
503600     END-PERFORM.                                                 50360077
503700                                                                  50370077
503900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        50390077
504000         MOVE '7620-CLOSE-SHIPMENT-CURSOR'                        50400077
504100                                   TO DP013-PARAGRAPH             50410077
504200         MOVE SQLCA                TO DP013-SQLCA                 50420077
504300         SET DP013-DB2-ABEND                                      50430077
504400             DP013-XCTL-DISPLAY-RESTART                           50440077
504500                                   TO TRUE                        50450077
504600         PERFORM DP013-0000-PROCESS-ABEND                         50460077
504700     END-IF.                                                      50470077
504800                                                                  50480077
505100*----------------------------------------------------------------*50510077
505200*    DELETE THE ENTIRE SHIPMENT (CHANGING THE STATUS OF THE      *50520077
505300*    REQUESTS BACK TO "P"                                        *50530077
505400*----------------------------------------------------------------*50540077
505600 8000-DELETE-SHIPMENT.                                            50560077
505800*    FIRST DELETE ANY "SHIPMENT" COMMENTS THAT MAY HAVE BEEN      50580077
505900*    INSERTED PREVIOUSLY                                          50590077
506000     IF ASC-KEY-CMNT-ID > +0                                      50600077
506100         PERFORM 7310-DELETE-SHIP-COMMENTS                        50610077
506200     END-IF.                                                      50620077
506300                                                                  50630077
506400*    THEN DELETE ALL THE EXISTING SHIPMENT FOR THE REQUESTS THAT  50640077
506500*    HAVE BEEN SELECTED TO BE ON THIS SHIPMENT                    50650077
506600     PERFORM 7100-DELETE-SHIPMENT                                 50660077
506700     VARYING PV-ITEM FROM 1 BY 1                                  50670077
506800     UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.             50680077
506900                                                                  50690077
507000*    FOR EACH OF THE REQUEST, UPDATE THE STATUS TO "P"RINTED.     50700077
507100     MOVE 'P'   TO PV-STATUS-CODE.                                50710077
507200                                                                  50720077
507300     PERFORM 7400-UPDATE-REQUEST-STATUS                           50730077
507400         VARYING PV-ITEM FROM 1 BY 1                              50740077
507500         UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.         50750077
507600                                                                  50760077
507700     IF ASC-CRIT-SPEC-FORMAT                                      50770077
507800        CONTINUE                                                  50780077
507900     ELSE                                                         50790077
508000         PERFORM 9100-READ-SEL-QUEUE                              50800077
508100         SET VL012-DEL (ASC-SEL-SUB) TO TRUE                      50810077
508200         PERFORM 9101-REWRITE-SEL-QUEUE                           50820077
508300     END-IF.                                                      50830077
508400                                                                  50840077
508500     MOVE PC-TSYMSG-00115        TO DP020-MSG-NUMBER.             50850077
508600     SET DP020-MSG-INFORMATIONAL TO TRUE.                         50860077
508700                                                                  50870084
508800*----------------------------------------------------------------*50880077
508900*    READ THE SELECTION QUEUE CREATED IN VLKCS506                *50890077
509000*----------------------------------------------------------------*50900077
509200 9100-READ-SEL-QUEUE.                                             50920077
509400     IF ASC-PRINT-LIST-FORMAT                                     50940077
509500         EXEC CICS                                                50950077
509600              READQ TS                                            50960077
509700                  QUEUE (ASC-SEL-QUEUE-NAME)                      50970077
509800                  INTO  (VL003-REQUEST-SEL-REC)                   50980077
509900                  ITEM  (PV-SEL-ITEM)                             50990077
510000                  RESP  (PV-CICS-RESP)                            51000077
510100         END-EXEC                                                 51010077
510200     ELSE                                                         51020077
510300         EXEC CICS                                                51030077
510400              READQ TS                                            51040077
510500                  QUEUE (ASC-SEL-QUEUE-NAME)                      51050077
510600                  INTO  (VL012-SHIPMENT-SEL-REC)                  51060077
510700                  ITEM  (ASC-SEL-ITEM)                            51070077
510800                  RESP  (PV-CICS-RESP)                            51080077
510900         END-EXEC                                                 51090077
511000     END-IF.                                                      51100077
511100*                                                                 51110077
511200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          51120077
511300         CONTINUE                                                 51130077
511400     ELSE                                                         51140077
511500         SET DP013-CICS-ABEND      TO  TRUE                       51150077
511600         SET DP013-NO-ROLLBACK     TO  TRUE                       51160077
511700         MOVE '9100-READ-SEL-QUEUE'                               51170077
511800                                   TO  DP013-PARAGRAPH            51180077
511900         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           51190077
512000                                   TO  DP013-MESSAGE-TEXT(1)      51200077
512100         PERFORM DP013-0000-PROCESS-ABEND                         51210077
512200     END-IF.                                                      51220077
512600                                                                  51221084
512300*----------------------------------------------------------------*51230077
512400*  REWRITE THE SELECTION QUEUE CREATED IN VLKCS506               *51240077
512500*----------------------------------------------------------------*51250077
512700 9101-REWRITE-SEL-QUEUE.                                          51270077
512900     IF ASC-PRINT-LIST-FORMAT                                     51290077
513000         EXEC CICS                                                51300077
513100            WRITEQ TS                                             51310077
513200                  QUEUE (ASC-SEL-QUEUE-NAME)                      51320077
513300                  FROM  (VL003-REQUEST-SEL-REC)                   51330077
513400                  ITEM  (PV-SEL-ITEM)                             51340077
513500                  REWRITE                                         51350077
513600                  RESP  (PV-CICS-RESP)                            51360077
513700         END-EXEC                                                 51370077
513800     ELSE                                                         51380077
513900         EXEC CICS                                                51390077
514000            WRITEQ TS                                             51400077
514100                  QUEUE (ASC-SEL-QUEUE-NAME)                      51410077
514200                  FROM  (VL012-SHIPMENT-SEL-REC)                  51420077
514300                  ITEM  (ASC-SEL-ITEM)                            51430077
514400                  REWRITE                                         51440077
514500                  RESP  (PV-CICS-RESP)                            51450077
514600         END-EXEC                                                 51460077
514700     END-IF.                                                      51470077
514800*                                                                 51480077
514900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          51490077
515000         CONTINUE                                                 51500077
515100     ELSE                                                         51510077
515200         SET DP013-CICS-ABEND      TO  TRUE                       51520077
515300         SET DP013-NO-ROLLBACK     TO  TRUE                       51530077
515400         MOVE '9101-REWRITE-SEL-QUEUE'                            51540077
515500                                   TO  DP013-PARAGRAPH            51550077
515600         MOVE 'ATTEMPTING TO REWRITE THE SEL QUEUE'               51560077
515700                                   TO  DP013-MESSAGE-TEXT(1)      51570077
515800         IF ASC-PRINT-LIST-FORMAT                                 51580077
515900             MOVE 'USING THE QUEUE FROM THE PRINT LIST SCREEN'    51590077
516000                                   TO  DP013-MESSAGE-TEXT(2)      51600077
516100         ELSE                                                     51610077
516200             MOVE 'USING THE QUEUE FROM THE SHIPMENT LIST SCRREN' 51620077
516300                                   TO  DP013-MESSAGE-TEXT(2)      51630077
516400         END-IF                                                   51640077
516500         PERFORM DP013-0000-PROCESS-ABEND                         51650077
516600     END-IF.                                                      51660077
516700                                                                  51670084
516800*----------------------------------------------------------------*51680077
516900*   WRITE THE COMMENT QUEUE                                      *51690077
517000*----------------------------------------------------------------*51700077
517200 9200-WRITE-COMMENT-QUEUE.                                        51720077
517400     EXEC CICS                                                    51740077
517500          WRITEQ TS                                               51750077
517600              QUEUE (ASC-COMMENT-QUEUE-NAME)                      51760077
517700              FROM  (VL001-COMMENTS-SEL-REC)                      51770077
517800              ITEM  (PV-COMM-ITEM)                                51780077
517900              RESP  (PV-CICS-RESP)                                51790077
518000     END-EXEC.                                                    51800077
518100*                                                                 51810077
518200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          51820077
518300         CONTINUE                                                 51830077
518400     ELSE                                                         51840077
518500         SET DP013-CICS-ABEND      TO  TRUE                       51850077
518600         SET DP013-NO-ROLLBACK     TO  TRUE                       51860077
518700         MOVE '9200-WRITE-COMMENT-QUEUE'                          51870077
518800                                   TO  DP013-PARAGRAPH            51880077
518900         MOVE 'ATTEMPTING TO WRITE TO THE COMMENT TS QUEUE'       51890077
519000                                   TO  DP013-MESSAGE-TEXT(1)      51900077
519100         PERFORM DP013-0000-PROCESS-ABEND                         51910077
519200     END-IF.                                                      51920077
519300                                                                  51930077
519400*----------------------------------------------------------------*51940077
519500*    READ THE COMMENT QUEUE CREATED IN VLKCS503                  *51950077
519600*----------------------------------------------------------------*51960077
519800 9250-READ-COMMENT-QUEUE.                                         51980077
520000     EXEC CICS                                                    52000077
520100          READQ TS                                                52010077
520200              QUEUE (ASC-COMMENT-QUEUE-NAME)                      52020077
520300              INTO  (VL001-COMMENTS-SEL-REC)                      52030077
520400              ITEM  (PV-COMM-ITEM)                                52040077
520500              RESP  (PV-CICS-RESP)                                52050077
520600     END-EXEC.                                                    52060077
520700                                                                  52070084
520800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          52080077
520900         CONTINUE                                                 52090077
521000     ELSE                                                         52100077
521100         SET DP013-CICS-ABEND      TO  TRUE                       52110077
521200         SET DP013-NO-ROLLBACK     TO  TRUE                       52120077
521300         MOVE '9250-READ-COMMENT-QUEUE'                           52130077
521400                                   TO  DP013-PARAGRAPH            52140077
521500         MOVE 'ATTEMPTING TO READ COMMENTS ITEMS QUEUE'           52150077
521600                                   TO  DP013-MESSAGE-TEXT(1)      52160077
521700         PERFORM DP013-0000-PROCESS-ABEND                         52170077
521800     END-IF.                                                      52180077
520700                                                                  52181084
521900*----------------------------------------------------------------*52190077
522000*  DELETE THE COMMENT TEMP STORAGE QUEUE.                     *   52200077
522100*----------------------------------------------------------------*52210077
522200 9290-DELETE-COMMENT-QUEUE.                                       52220077
522400     EXEC CICS                                                    52240077
522500         DELETEQ TS                                               52250077
522600             QUEUE (ASC-COMMENT-QUEUE-NAME)                       52260077
522700             RESP  (PV-CICS-RESP)                                 52270077
522800     END-EXEC.                                                    52280077
522900                                                                  52290077
523000     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       52300077
523100        (PV-CICS-RESP = DFHRESP(QIDERR))                          52310077
523200         CONTINUE                                                 52320077
523300     ELSE                                                         52330077
523400         SET DP013-CICS-ABEND      TO TRUE                        52340077
523500         SET DP013-NO-ROLLBACK     TO TRUE                        52350077
523600                                                                  52360077
523700         MOVE '9290-DELETE-COMMENT-QUEUE'                         52370077
523800                                   TO DP013-PARAGRAPH             52380077
523900         MOVE 'ERROR TRYING TO DELETE COMMENT TS QUEUE'           52390077
524000                                   TO DP013-MESSAGE-TEXT (1)      52400077
524100         PERFORM DP013-0000-PROCESS-ABEND                         52410077
524200     END-IF.                                                      52420077
524300                                                                  52430077
524400     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  52440077
524500                                                                  52450077
524600*----------------------------------------------------------------*52460077
524700*    WRITE A NEW RECORD TO THE SHIPMENT TEMP STORAGE QUEUE.      *52470077
524800*----------------------------------------------------------------*52480077
524900 9300-WRITE-SHIP-TS.                                              52490077
525100     EXEC CICS                                                    52510077
525200         WRITEQ TS                                                52520077
525300             QUEUE (ASC-SHIP-QUEUE-NAME)                          52530077
525400             FROM  (VL004-SHIPMENT-REC)                           52540077
525500             ITEM  (PV-SHIP-ITEM)                                 52550077
525600             RESP  (PV-CICS-RESP)                                 52560077
525700     END-EXEC.                                                    52570077
525800     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      52580077
525900         SET DP013-CICS-ABEND      TO TRUE                        52590077
526000         SET DP013-NO-ROLLBACK     TO TRUE                        52600077
526100         MOVE '9300-WRITE-SHIP-TS'                                52610077
526200                                   TO DP013-PARAGRAPH             52620077
526300         MOVE 'ATTEMPTING TO WRITE SHIP TEMP STORAGE'             52630077
526400                                   TO DP013-MESSAGE-TEXT(1)       52640077
526500         PERFORM DP013-0000-PROCESS-ABEND                         52650077
526600     END-IF.                                                      52660077
526700                                                                  52670077
526800******************************************************************52680077
526900** REWRITE THE SHIPMENT TEMP STORAGE QUEUE RECORD               **52690077
527000******************************************************************52700077
527100 9301-REWRITE-SHIP-TS.                                            52710077
527200     EXEC CICS                                                    52720077
527300         WRITEQ TS                                                52730077
527400             QUEUE (ASC-SHIP-QUEUE-NAME)                          52740077
527500             FROM  (VL004-SHIPMENT-REC)                           52750077
527600             ITEM  (PV-SHIP-ITEM)                                 52760077
527700             REWRITE                                              52770077
527800             RESP  (PV-CICS-RESP)                                 52780077
527900     END-EXEC.                                                    52790077
528000                                                                  52800077
528100     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           52810077
528200         CONTINUE                                                 52820077
528300     ELSE                                                         52830077
528400         SET DP013-CICS-ABEND            TO TRUE                  52840077
528500         SET DP013-NO-ROLLBACK           TO TRUE                  52850077
528600         MOVE '9301-REWRITE-SHIP-TS'     TO DP013-PARAGRAPH       52860077
528700         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     52870077
528800                                         TO DP013-MESSAGE-TEXT(1) 52880077
528900         PERFORM DP013-0000-PROCESS-ABEND                         52890077
529000     END-IF.                                                      52900077
529100                                                                  52910077
529300*----------------------------------------------------------------*52930077
529400*    READ A RECORD FROM THE SHIPMENT TS QUEUE                   * 52940077
529500*----------------------------------------------------------------*52950077
529700 9302-READ-SHIP-QUEUE.                                            52970077
529900     EXEC CICS                                                    52990077
530000         READQ TS                                                 53000077
530100             QUEUE (ASC-SHIP-QUEUE-NAME)                          53010077
530200             INTO  (VL004-SHIPMENT-REC)                           53020077
530300             ITEM  (PV-SHIP-ITEM)                                 53030077
530400             RESP  (PV-CICS-RESP)                                 53040077
530500     END-EXEC.                                                    53050077
530600*                                                                 53060077
530700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          53070077
530800         CONTINUE                                                 53080077
530900     ELSE                                                         53090077
531000         SET DP013-CICS-ABEND        TO TRUE                      53100077
531100         SET DP013-NO-ROLLBACK       TO TRUE                      53110077
531200         MOVE '9302-READ-SHIP-QUEUE' TO DP013-PARAGRAPH           53120077
531300         MOVE 'ATTEMPTING TO READQ SHIP QUEUE'                    53130077
531400                                     TO DP013-MESSAGE-TEXT(1)     53140077
531500         PERFORM DP013-0000-PROCESS-ABEND                         53150077
531600     END-IF.                                                      53160077
531700                                                                  53170077
531800*----------------------------------------------------------------*53180077
531900*  DELETE THE SHIPMENT TEMP STORAGE QUEUE.                    *   53190077
532000*----------------------------------------------------------------*53200077
532100 9390-DELETE-SHIP-QUEUE.                                          53210077
532300     EXEC CICS                                                    53230077
532400         DELETEQ TS                                               53240077
532500             QUEUE (ASC-SHIP-QUEUE-NAME)                          53250077
532600             RESP  (PV-CICS-RESP)                                 53260077
532700     END-EXEC.                                                    53270077
532800                                                                  53280077
532900     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       53290077
533000        (PV-CICS-RESP = DFHRESP(QIDERR))                          53300077
533100         CONTINUE                                                 53310077
533200     ELSE                                                         53320077
533300         SET DP013-CICS-ABEND      TO TRUE                        53330077
533400         SET DP013-NO-ROLLBACK     TO TRUE                        53340077
533500                                                                  53350077
533600         MOVE '9390-DELETE-SHIPMENT-QUEUE'                        53360077
533700                                   TO DP013-PARAGRAPH             53370077
533800         MOVE 'ERROR TRYING TO DELETE SHIPMENT TS QUEUE'          53380077
533900                                   TO DP013-MESSAGE-TEXT (1)      53390077
534000         PERFORM DP013-0000-PROCESS-ABEND                         53400077
534100     END-IF.                                                      53410077
534200                                                                  53420077
534300     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  53430077
534400                                                                  53440077
534600*----------------------------------------------------------------*53460077
534700*    ABEND PROCESSOR MODULE                                      *53470077
534800*----------------------------------------------------------------*53480077
534900                                                                  53490077
535000     COPY DPPD013.                                                53500085
