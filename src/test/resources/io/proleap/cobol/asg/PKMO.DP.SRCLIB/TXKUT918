000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400                                                                  00040000
000500 PROGRAM-ID.             TXKUT918.                                00050000
000600 AUTHOR.                 KATHERINE PRIESTER.                      00060000
000700 INSTALLATION.           KOHLS.                                   00070000
000800 DATE-WRITTEN.           APRIL 2003.                              00080019
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100***************************************************************** 00110000
001200*  THIS PROGRAM WILL CREATE A FILE OF DUMMY SKUS THAT ARE ACTIVE  00120000
001300*  IN PLU FOR EACH STATE WHERE KOHL'S HAS STORES.  EACH RECORD    00130000
001400*  WILL HAVE THE DEFAULT TAX PARAMETER FOR THE DEPT/SUB CL        00140015
001500*  ASSOCIATED WITH THE ITEM.  DUMMY SKUS ARE USED AT POS TO       00150015
001600*  OBTAIN ITEM TAXABILITY FOR AN ITEM WHEN ONLY THE DEPARMENT     00160015
001700*  AND CLASS ARE KNOWN.                                           00170015
001800******************************************************************00180000
001900***************************************************************** 00190000
002000 ENVIRONMENT DIVISION.                                            00200000
002100***************************************************************** 00210000
002200                                                                  00220000
002300 CONFIGURATION SECTION.                                           00230000
002400                                                                  00240000
002500 SOURCE-COMPUTER.        IBM-3090.                                00250000
002600 OBJECT-COMPUTER.        IBM-3090.                                00260000
002700                                                                  00270000
002800 INPUT-OUTPUT SECTION.                                            00280000
002900                                                                  00290000
003000 FILE-CONTROL.                                                    00300000
003100                                                                  00310000
003200     SELECT CONTROL-FILE                                          00320000
003300         ASSIGN TO INP01.                                         00330000
003400                                                                  00340000
004010     SELECT DAYS-OUT-CONTROL-FILE                                 00350029
004020         ASSIGN TO INP02.                                         00360042
004030                                                                  00370029
004061     SELECT TOMORROW-DATE-CONTROL-FILE                            00380035
004062         ASSIGN TO INP03.                                         00390042
004063                                                                  00400035
004064     SELECT RUN-DATE-CONTROL-FILE                                 00410040
004065         ASSIGN TO INP04.                                         00420042
004066                                                                  00430040
004070     SELECT DEPT-CL-EXTRACT-FILE                                  00440029
004080         ASSIGN TO INP05.                                         00450042
004090                                                                  00460029
004100     SELECT DUMMY-SKU-FILE                                        00470000
004200         ASSIGN TO OUT01.                                         00480000
004300                                                                  00490000
004400******************************************************************00500000
004500 DATA DIVISION.                                                   00510000
004600******************************************************************00520000
004700                                                                  00530000
004800 FILE SECTION.                                                    00540000
004900                                                                  00550000
005000 FD  CONTROL-FILE                                                 00560000
005100     RECORDING MODE IS F                                          00570000
005200     BLOCK CONTAINS 0 RECORDS                                     00580000
005300     LABEL RECORDS ARE STANDARD.                                  00590000
005400                                                                  00600000
005500 01  CONTROL-RECORD                  PIC X(80).                   00610000
005600                                                                  00620000
006310 FD  DAYS-OUT-CONTROL-FILE                                        00630029
006320     RECORDING MODE IS F                                          00640029
006330     BLOCK CONTAINS 0                                             00650029
006340     LABEL RECORDS ARE STANDARD.                                  00660029
006350 01  DAYS-OUT-CONTROL-RECORD          PIC X(80).                  00670029
006360                                                                  00680029
006394 FD  TOMORROW-DATE-CONTROL-FILE                                   00690035
006395     RECORDING MODE IS F                                          00700035
006396     BLOCK CONTAINS 0                                             00710035
006397     LABEL RECORDS ARE STANDARD.                                  00720035
006398 01  TOMORROW-DATE-CONTROL-RECORD    PIC X(80).                   00730035
006399                                                                  00740035
006400 FD  RUN-DATE-CONTROL-FILE                                        00750040
006401     RECORDING MODE IS F                                          00760040
006402     BLOCK CONTAINS 0                                             00770040
006403     LABEL RECORDS ARE STANDARD.                                  00780040
006404 01  RUN-DATE-CONTROL-RECORD         PIC X(80).                   00790040
006405                                                                  00800040
006410 FD  DEPT-CL-EXTRACT-FILE                                         00810000
006500     RECORDING MODE IS F                                          00820000
006600     BLOCK CONTAINS 0 RECORDS                                     00830000
006700     LABEL RECORDS ARE STANDARD.                                  00840000
006800                                                                  00850000
006900 01  DEPT-CL-EXTRACT-RCD             PIC X(109).                  00860000
007000                                                                  00870000
007100 FD  DUMMY-SKU-FILE                                               00880000
007200     RECORDING MODE IS F                                          00890000
007300     BLOCK CONTAINS 0  RECORDS.                                   00900000
007400                                                                  00910000
007500 01  DUMMY-SKU-RCD                   PIC  X(60).                  00920042
007600                                                                  00930000
007700******************************************************************00940000
007800 WORKING-STORAGE SECTION.                                         00950000
007900******************************************************************00960000
008000 01  FILLER                            PIC X(50)  VALUE           00970000
008100     ' *** WORKING STORAGE STARTS HERE FOR TXKUT918 *** '.        00980000
008200                                                                  00990000
008300******************************************************************01000000
008400* RECORD LAYOUT FOR INPUT CONTROL CARD                            01010000
008500******************************************************************01020000
008600     COPY EPWS105.                                                01030050
008700                                                                  01040000
009250******************************************************************01050042
009260*    COPYBOOK FOR CONTROL CARD EPCC045 - DAYS OUT                 01060029
009270******************************************************************01070042
009280     COPY EPRD045.                                                01080029
009281                                                                  01090029
009290******************************************************************01100042
009291*    COPYBOOK FOR CONTROL CARD EPCC140 - RUN DATE                 01110035
009292******************************************************************01120042
009293     COPY EPWS140.                                                01130037
009294                                                                  01140029
009295******************************************************************01150042
009296*    COPYBOOK FOR CONTROL CARD EPCC112 - TOMORROWS DATE           01160035
009297******************************************************************01170042
009298     COPY EPWS112.                                                01180036
009299                                                                  01190035
009300******************************************************************01200035
009301* RECORD LAYOUT FOR DEPARTMENT CLASS EXTRACT FILE.               *01210035
009302******************************************************************01220035
009303     COPY IMRD040.                                                01230050
009304                                                                  01240035
009310******************************************************************01250035
009400* RECORD LAYOUT FOR FOR SKU FILE                                 *01260002
009500******************************************************************01270000
009600     COPY TXRD911.                                                01280050
009700                                                                  01290000
010710******************************************************************01300042
010720*    COPYBOOK FOR DPKUT500 - CALENDAR SUBROUTINE                  01310029
010730******************************************************************01320042
010740     COPY DPWS500.                                                01330029
010750                                                                  01340029
010800 01  AC-ABEND-CODE                     PIC S9(04) VALUE ZERO      01350000
010900                                                  COMP SYNC.      01360000
011000     88  AC-CONTROL-CARD-ERROR                    VALUE +4003.    01370000
011100     88  AC-TABLE-OVERFLOW-ERROR                  VALUE +4004.    01380000
011200     88  AC-DATASET-DATA-ERROR                    VALUE +4008.    01390000
011300     88  AC-DB2-ERROR                             VALUE +4013.    01400000
011400     88  AC-CALENDAR-ROUTINE-ERROR                VALUE +4019.    01410029
011600                                                                  01420000
011700 01  PS-PROGRAM-SWITCHES.                                         01430000
011800     05  PS-END-OF-EXTR-SW             PIC X(01)  VALUE 'N'.      01440000
011900         88  PS-END-OF-EXTR                       VALUE 'Y'.      01450000
012000         88  PS-NOT-END-OF-EXTR                   VALUE 'N'.      01460000
012100     05  PS-END-OF-CONTROL-SW          PIC X(01)  VALUE 'N'.      01470000
012200         88  PS-END-OF-CONTROL                    VALUE 'Y'.      01480000
012600     05  PS-END-OF-STATES-SW           PIC X(01)  VALUE 'N'.      01490000
012700         88  PS-END-OF-STATES                     VALUE 'Y'.      01500000
012800         88  PS-NOT-END-OF-STATES                 VALUE 'N'.      01510000
012900     05  PS-SUB-CLASS-FOUND-SW         PIC X(01)  VALUE 'N'.      01520000
013000         88  PS-SUB-CLASS-FOUND                   VALUE 'Y'.      01530000
013100         88  PS-SUB-CLASS-NOT-FOUND               VALUE 'N'.      01540000
013110     05  PS-END-OF-DAYS-OUT-SW         PIC X(01)  VALUE 'N'.      01550029
013120         88  PS-END-OF-DAYS-OUT                   VALUE 'Y'.      01560029
013130         88  PS-NOT-END-OF-DAYS-OUT               VALUE 'N'.      01570029
013140     05  PS-END-OF-RUN-DATE-SW         PIC X(01)  VALUE 'N'.      01580029
013150         88  PS-END-OF-RUN-DATE                   VALUE 'Y'.      01590029
013160         88  PS-NOT-END-OF-RUN-DATE               VALUE 'N'.      01600029
013170     05  PS-END-OF-TOMORROW-CC-SW      PIC X(01)  VALUE 'N'.      01610035
013180         88  PS-END-OF-TOMORROW-CC                VALUE 'Y'.      01620035
013190         88  PS-NOT-END-OF-TOMORROW-CC            VALUE 'N'.      01630035
013170     05  PS-TAXABILITY-SW              PIC X(01)  VALUE 'N'.      01640053
013180         88  PS-TAXABILITY-FOUND                  VALUE 'Y'.      01650053
013190         88  PS-TAXABILITY-NOT-FOUND              VALUE 'N'.      01660053
013192     05  PS-PLU-DWNLD-EXCL-IND         PIC X(01)  VALUE 'N'.      01670068
013194         88  PS-PLU-DWNLD-EXCL-IND-YES            VALUE 'Y'.      01680068
013196         88  PS-PLU-DWNLD-EXCL-IND-NO             VALUE 'N'.      01690068
013200                                                                  01700000
013300 01  PC-CONSTANTS.                                                01710000
013500     05  PC-STATE-LIMIT              PIC S9(04)    VALUE +50.     01720024
013600     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          01730000
013700                                                   'TXKUT918'.    01740000
013800                                                                  01750000
013900 01  PV-MISC-FIELDS.                                              01760000
014000     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACE.   01770000
014100     05  PV-OPERATION-MSG-1          PIC  X(40)    VALUE SPACE.   01780000
014200     05  PV-OPERATION-MSG-2          PIC  X(40)    VALUE SPACE.   01790000
014300     05  PV-DB2-OPERATION            PIC  X(30)    VALUE SPACE.   01800000
014600     05  PV-STATE-SUB                PIC S9(4)     VALUE ZERO     01810001
014700                                          COMP.                   01820001
014800     05  PV-STATE-CNT                PIC  9(4)     VALUE ZERO.    01830013
014900     05  PV-DEPT-NBR-CHAR            PIC X(04).                   01840065
015000     05  PV-DEPT-NBR-NUM             PIC 9(04).                   01850080
015000     05  PV-SUB-CL-NBR-CHAR          PIC X(04).                   01870065
015500     05  PV-SUB-CL-NBR-NUM           PIC 9(04).                   01900079
015100     05  PV-SUB-CL-NBR-REDEF REDEFINES PV-SUB-CL-NBR-NUM.         01901088
015200         10  FILLER                  PIC X(02).                   01902088
015300         10  PV-SUB-CL-NBR-02        PIC X(02).                   01903088
015500     05  PV-MAJ-CL-NBR-CHAR          PIC X(04).                   01910065
015600     05  PV-MAJ-CL-NBR-NUM           PIC 9(04).                   01920079
015900     05  PV-SKU-NBR-CHAR             PIC X(08).                   01940001
016000     05  PV-SKU-NBR-NUM REDEFINES PV-SKU-NBR-CHAR                 01950001
016100                                     PIC 9(08).                   01960001
016200     05  PV-DISPLAY-NUM              PIC ZZZ,ZZZ,ZZ9.             01970001
016210     05  PV-NEW-DTE                  PIC X(10).                   01980031
016220     05  PV-INTERNAL-UPC             PIC 9(12).                   01990045
016230     05  PV-INTR-UPC-ID              PIC S9(12) COMP-3.           02000046
016230     05  PV-TX-CDE-DESC              PIC X(20)     VALUE SPACES.  02010063
016230     05  PV-TX-PRD-CDE-DESC-W REDEFINES PV-TX-CDE-DESC.           02020063
016230         10  PV-TX-PRD-CDE-DESC      PIC X(05).                   02030063
016230         10  PV-TX-PRD-CDE-DESC-N REDEFINES PV-TX-PRD-CDE-DESC    02040063
016230                                     PIC 9(05).                   02050063
016230         10  FILLER                  PIC X(15).                   02060063
016300                                                                  02070001
016400 01  PA-PROGRAM-ACCUMULATORS.                                     02080001
016500     05  PA-RECORDS-READ             PIC 9(9).                    02090001
016600     05  PA-RECORDS-WRITTEN          PIC 9(9).                    02100002
016700     05  PA-TAX-RECORDS-READ         PIC 9(9).                    02110012
016800     05  PA-TAX-RECORDS-SKIPPED      PIC 9(9).                    02120013
016900                                                                  02130001
018000******************************************************************02140000
018100*  THE STATE TABLE HOLDS ALL OF THE STATES WHERE KOHL'S HAS A     02150000
018200*  PRESENCE.                                                      02160000
018300******************************************************************02170000
018400 01  STATE-TABLE.                                                 02180000
018500     05  ST-STATE-DEF OCCURS 50 TIMES.                            02190053
018600         10  ST-ST-CDE         PIC X(2).                          02200000
018600         10  ST-PRD-CDE        PIC 9(5).                          02210063
018600         10  ST-PRD-CDE-X REDEFINES ST-PRD-CDE PIC X(5).          02220063
018600         10  ST-TX-CDE         PIC X(1).                          02230051
                                                                        02240051
018700******************************************************************02250000
018800*  WS FIELDS FOR SQLCA MESSAGE ROUTINE                            02260000
018900******************************************************************02270000
019000     COPY DPWS004.                                                02280000
019100                                                                  02290000
019200******************************************************************02300000
019300*  DB2 COMMUNICATION AREA.                                        02310000
019400******************************************************************02320000
019500     EXEC SQL                                                     02330000
019600          INCLUDE SQLCA                                           02340000
019700     END-EXEC.                                                    02350000
019700******************************************************************02360051
019700*  DB2 TABLE TAX PRODUCT TABLE - TXT_PRD                          02370051
019700******************************************************************02380051
019700     EXEC SQL                                                     02390051
019700          INCLUDE TXT00007                                        02400051
019700     END-EXEC.                                                    02410051
019700******************************************************************02420051
019700*  DB2 TABLE TAX PRODUCT EXCEPTION TABLE - TXT_PRD_EXC            02430051
019700******************************************************************02440051
019700     EXEC SQL                                                     02450051
019700          INCLUDE TXT00008                                        02460051
019700     END-EXEC.                                                    02470051
019800******************************************************************02480000
019900*  DB2 TABLE XST_SUB_CL                                           02490000
020000******************************************************************02500000
020100     EXEC SQL                                                     02510000
020200          INCLUDE XST00014                                        02520000
020300     END-EXEC.                                                    02530000
019800******************************************************************02540066
019900*  DB2 TABLE XST_SUB_CL_ATTR                                      02550066
020000******************************************************************02560066
020100     EXEC SQL                                                     02570066
020200          INCLUDE XST00055                                        02580066
020300     END-EXEC.                                                    02590066
020400******************************************************************02600000
020500*  DB2 TABLE XST_LOC                                              02610000
020600******************************************************************02620000
020700     EXEC SQL                                                     02630000
020800          INCLUDE XST00001                                        02640000
020900     END-EXEC.                                                    02650000
021000******************************************************************02660000
021100*  DB2 TABLE XST_LOC_ATTR                                         02670000
021200******************************************************************02680000
021300     EXEC SQL                                                     02690000
021400          INCLUDE XST00025                                        02700000
021500     END-EXEC.                                                    02710000
021600******************************************************************02720000
021700*  STATE CURSOR - PULLS EACH STATE WHERE STORES ARE OPEN OR IN    02730000
021800*                 TRAINING                                        02740000
021810*                                                                 02750047
021820*  NOTE: DURING THE PILOT NEW STORES WILL NOT BE ON THE PLU TAX   02760047
021830*        SYSTEM.  WHEN THE PILOT IS COMPLETE WE WILL LOOK FOR POS 02770047
021840*        CAPABILITY LEVELS 5 OR > 11.                             02780047
021900******************************************************************02790000
022000     EXEC SQL                                                     02800000
022100       DECLARE STATE-CSR CURSOR FOR                               02810000
022200           SELECT DISTINCT ST_CDE                                 02820000
022300           FROM   XST_LOC A                                       02830000
022400                 ,XST_LOC_ATTR B                                  02840000
022500           WHERE  A.LOC_NBR = B.LOC_NBR                           02850029
022600             AND  A.LOC_TYP_CDE = 'DS'                            02860029
022700             AND (B.POS_CAP_LVL_ID = 5                            02870050
022800              OR  B.POS_CAP_LVL_ID > 11)                          02880050
022800             AND  ST_CDE ^= 'XX'                                  02890063
022900             AND (:PV-NEW-DTE BETWEEN A.OPN_DTE AND A.CLO_DTE     02900029
022910              OR  :CC-EPCC112-TOMORROW-DATE BETWEEN               02910035
022911                   A.OPN_DTE AND A.CLO_DTE)                       02920035
022930           ORDER BY ST_CDE                                        02930029
022940           WITH UR                                                02940029
023000     END-EXEC.                                                    02950000
023100***************************************************************** 02960000
023200* PROCEDURE DIVISION.                                           * 02970000
023300***************************************************************** 02980000
023400 PROCEDURE DIVISION.                                              02990000
023500                                                                  03000000
023600 0000-MAINLINE-PROCESSING.                                        03010000
023700                                                                  03020000
023800     PERFORM 1000-INITIALIZE-PROGRAM.                             03030000
023900                                                                  03040000
024000     PERFORM 2900-READ-EXTRACT-FILE.                              03050000
024100                                                                  03060000
024200     IF PS-END-OF-EXTR                                            03070015
024300         MOVE 'DEFAULT MAINTENANCE EXTRACT FILE IS' TO            03080017
024400              PV-OPERATION-MSG-1                                  03090015
024410         MOVE 'EMPTY.' TO                                         03100017
024420              PV-OPERATION-MSG-2                                  03110017
024500         MOVE '0000-MAINLINE-PROCESSING' TO PV-PARAGRAPH-NAME     03120016
024600         SET AC-DATASET-DATA-ERROR TO TRUE                        03130015
024700         PERFORM 9999-ABEND                                       03140015
024800     END-IF.                                                      03150015
024900                                                                  03160015
025000     PERFORM 2000-CREATE-DUMMY-SKU-FILE                           03170000
025100       UNTIL PS-END-OF-EXTR.                                      03180000
025200                                                                  03190000
025300     PERFORM 9000-FINISH-PROGRAM.                                 03200000
025400                                                                  03210000
025500     GOBACK.                                                      03220000
025600                                                                  03230000
025700******************************************************************03240000
025800* 1000-INITIALIZE-PROGRAM                                         03250000
025900* OPEN FILES, GET CONTROL CARD, INITIALIZE TABLES.                03260000
026000******************************************************************03270000
026100 1000-INITIALIZE-PROGRAM.                                         03280000
026200                                                                  03290000
026300     OPEN INPUT  CONTROL-FILE                                     03300000
026510                 DAYS-OUT-CONTROL-FILE                            03310030
026520                 RUN-DATE-CONTROL-FILE                            03320030
026521                 TOMORROW-DATE-CONTROL-FILE                       03330035
026530                 DEPT-CL-EXTRACT-FILE                             03340030
026600          OUTPUT DUMMY-SKU-FILE.                                  03350002
026700                                                                  03360000
026900     INITIALIZE STATE-TABLE.                                      03370042
027000                                                                  03380000
027010     DISPLAY '****** TXKUT918 ******'.                            03390043
027020     DISPLAY ' '.                                                 03400043
027030                                                                  03410043
027100     PERFORM 1010-READ-CONTROL-FILE.                              03420000
027200                                                                  03430000
027300     IF PS-END-OF-CONTROL                                         03440000
027400         MOVE '1000-INITIALIZE-PROGRAM  '  TO PV-PARAGRAPH-NAME   03450000
027500         MOVE 'NO CONTROL CARD TO PROCESS' TO PV-OPERATION-MSG-1  03460000
027600         SET AC-CONTROL-CARD-ERROR TO TRUE                        03470000
027700         PERFORM 9999-ABEND                                       03480000
027800     END-IF.                                                      03490000
027900                                                                  03500000
027930     DISPLAY 'EPCC105 CONTROL CARD VALUE: '.                      03510032
027940     DISPLAY CC-EPCC105-CONTROL-CARD.                             03520027
029500                                                                  03530001
029510     PERFORM 1200-READ-RUN-DATE.                                  03540029
029520                                                                  03550029
029530     IF PS-END-OF-RUN-DATE                                        03560029
029540         MOVE '1000-INITIALIZE-PROGRAM  '  TO PV-PARAGRAPH-NAME   03570029
029550         MOVE 'NO RUN DATE TO PROCESS   '  TO PV-OPERATION-MSG-1  03580029
029560         SET AC-CONTROL-CARD-ERROR TO TRUE                        03590029
029570         PERFORM 9999-ABEND                                       03600029
029580     END-IF.                                                      03610029
029590                                                                  03620029
029603     DISPLAY 'RUN DATE IS: '                                      03630035
029604             CC-EPCC140-TODAY-DATE.                               03640037
029605                                                                  03650035
029606     PERFORM 1300-VALIDATE-DATE.                                  03660035
029607                                                                  03670035
029608     PERFORM 1400-READ-DAYS-OUT.                                  03680035
029609                                                                  03690035
029610     IF PS-END-OF-DAYS-OUT                                        03700035
029611         MOVE '1000-INITIALIZE-PROGRAM  '  TO PV-PARAGRAPH-NAME   03710035
029612         MOVE 'NO DAYS OUT RECORD       '  TO PV-OPERATION-MSG-1  03720035
029613         SET AC-CONTROL-CARD-ERROR TO TRUE                        03730035
029614         PERFORM 9999-ABEND                                       03740035
029615     END-IF.                                                      03750035
029616                                                                  03760035
029617     IF EP045-DAYS-TILL-STORE-OPN NUMERIC                         03770035
029618         CONTINUE                                                 03780035
029619     ELSE                                                         03790035
029620         MOVE '1000-INITIALIZE-PROGRAM  '  TO PV-PARAGRAPH-NAME   03800035
029621         MOVE 'DAYS OUT NOT NUMERIC     '  TO PV-OPERATION-MSG-1  03810035
029622         DISPLAY 'DAYS OUT PARAMETER ' EP045-DAYS-TILL-STORE-OPN  03820035
029623         SET AC-CONTROL-CARD-ERROR TO TRUE                        03830035
029624         PERFORM 9999-ABEND                                       03840035
029625     END-IF.                                                      03850035
029626                                                                  03860035
029627     DISPLAY 'DAYS OUT PARAMETER IS ' EP045-DAYS-TILL-STORE-OPN.  03870035
029628                                                                  03880035
029629     PERFORM  1500-CALC-NEW-OPEN-DTE.                             03890035
029630                                                                  03900035
029631     DISPLAY 'DATE INCL DAYS OUT IS ' PV-NEW-DTE.                 03910035
029632                                                                  03920035
029633     PERFORM 1600-READ-TOMORROW-DATE.                             03930035
029634                                                                  03940035
029635     IF PS-END-OF-TOMORROW-CC                                     03950035
029636         MOVE '1000-INITIALIZE-PROGRAM  '  TO PV-PARAGRAPH-NAME   03960035
029637         MOVE 'NO TOMORROW DATE TO PROCESS' TO                    03970035
029638              PV-OPERATION-MSG-1                                  03980035
029639         SET AC-CONTROL-CARD-ERROR TO TRUE                        03990035
029640         PERFORM 9999-ABEND                                       04000035
029641     END-IF.                                                      04010035
029642                                                                  04020035
029643     PERFORM 1700-VALIDATE-TOMORROW-DTE.                          04030035
029644                                                                  04040035
029645     DISPLAY CC-EPCC112-CONTROL-CARD.                             04050035
029646                                                                  04060035
029647     CLOSE CONTROL-FILE                                           04070035
029649           DAYS-OUT-CONTROL-FILE                                  04080035
029650           RUN-DATE-CONTROL-FILE                                  04090035
029651           TOMORROW-DATE-CONTROL-FILE.                            04100035
029660                                                                  04110035
029900     PERFORM 1800-OPEN-STATE-CSR.                                 04120035
030000                                                                  04130000
030100     PERFORM 1850-FETCH-STATE-CSR.                                04140035
030200                                                                  04150000
030300     PERFORM 1810-PROCESS-STATES                                  04160035
030400         UNTIL   PV-STATE-SUB > PC-STATE-LIMIT OR                 04170001
030500                 PS-END-OF-STATES.                                04180001
030600                                                                  04190061
030700     IF PS-NOT-END-OF-STATES                                      04200001
030800         MOVE 'MORE THAN THE MAXIMUM NUMBER OF STATES ' TO        04210022
030900              PV-OPERATION-MSG-1                                  04220015
030901         MOVE 'WERE SELECTED.   '        TO                       04230025
030910              PV-OPERATION-MSG-2                                  04240022
031000         MOVE '1000-INITIALIZE-PROGRAM' TO                        04250001
031100              PV-PARAGRAPH-NAME                                   04260002
031200         SET AC-TABLE-OVERFLOW-ERROR TO TRUE                      04270001
031300         PERFORM 9999-ABEND                                       04280001
031400     END-IF.                                                      04290001
031500                                                                  04300001
031600     PERFORM 1820-CLOSE-STATE-CSR.                                04310035
031700                                                                  04320000
031800******************************************************************04330000
031900* 1010-READ-CONTROL-FILE                                          04340000
032000* READ CONTROL CARD.                                              04350000
032100******************************************************************04360000
032200 1010-READ-CONTROL-FILE.                                          04370000
032300                                                                  04380000
032400     READ CONTROL-FILE INTO CC-EPCC105-CONTROL-CARD               04390000
032500        AT END                                                    04400000
032600           SET PS-END-OF-CONTROL TO TRUE                          04410000
032700     END-READ.                                                    04420000
032800                                                                  04430000
034910******************************************************************04440029
034920* 1200-READ-RUN-DATE                                              04450029
034930* READ RUN DATE CONTROL CARD.                                     04460029
034940******************************************************************04470029
034950 1200-READ-RUN-DATE.                                              04480029
034960                                                                  04490029
034970     READ RUN-DATE-CONTROL-FILE INTO CC-EPCC140-CONTROL-CARD      04500035
034980         AT END                                                   04510029
034990             SET PS-END-OF-RUN-DATE  TO TRUE.                     04520029
034991                                                                  04530029
034992******************************************************************04540042
034993* 1300-VALIDATE-DATE CHECKS RUN DATE FOR VALID DATE               04550029
034994******************************************************************04560042
034995 1300-VALIDATE-DATE.                                              04570029
034996                                                                  04580029
034997     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         04590029
034998     SET DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                     04600029
034999     SET DPG52-LK-DTE-ISO-FMT        TO TRUE.                     04610029
035000                                                                  04620029
035001     MOVE CC-EPCC140-TODAY-DATE TO                                04630035
035002          DPG52-LK-DATE-INPUT.                                    04640035
035003                                                                  04650035
035004     CALL DP500-KOHLS-CALENDAR-ROUTINE                            04660035
035005          USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              04670035
035006                                                                  04680035
035007     EVALUATE TRUE                                                04690035
035008         WHEN DPG54-NO-ERROR                                      04700035
035009             CONTINUE                                             04710035
035010         WHEN OTHER                                               04720035
035011             MOVE 'INVALID RUN DATE ON EPCC140 CONTROL CARD' TO   04730035
035012                  PV-OPERATION-MSG-1                              04740035
035013             MOVE '                 '        TO                   04750035
035014                  PV-OPERATION-MSG-2                              04760035
035015             MOVE '1300-VALIDATE-DATE' TO                         04770035
035016              PV-PARAGRAPH-NAME                                   04780035
035017             SET AC-CALENDAR-ROUTINE-ERROR TO TRUE                04790032
035018             PERFORM 9999-ABEND                                   04800032
035025     END-EVALUATE.                                                04810029
035026                                                                  04820029
035027******************************************************************04830029
035028* 1400-READ-DAYS-OUT                                              04840029
035029* READ DAYS OUT CONTROL CARD.                                     04850029
035030******************************************************************04860029
035031 1400-READ-DAYS-OUT.                                              04870029
035032                                                                  04880029
035033     READ DAYS-OUT-CONTROL-FILE INTO EP045-ADVDAYS-TO-SND-RECORD  04890029
035034         AT END                                                   04900029
035035             SET PS-END-OF-DAYS-OUT  TO TRUE.                     04910029
035036                                                                  04920029
035037******************************************************************04930042
035038* 1500-CALC-NEW-OPEN-DTE                                          04940029
035039******************************************************************04950042
035040 1500-CALC-NEW-OPEN-DTE.                                          04960029
035041                                                                  04970029
035042     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         04980029
035043     SET DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                     04990029
035044     SET DPG51-INCREMENT-DATE    TO TRUE.                         05000029
035045                                                                  05010029
035046     MOVE EP045-DAYS-TILL-STORE-OPN TO DPG51-INCR-DECR-DAYS-9.    05020029
035047                                                                  05030029
035048     SET DPG52-LK-DTE-ISO-FMT        TO TRUE.                     05040029
035049     MOVE CC-EPCC140-TODAY-DATE TO                                05050035
035050          DPG52-LK-DATE-INPUT.                                    05060035
035051                                                                  05070035
035052     CALL DP500-KOHLS-CALENDAR-ROUTINE                            05080035
035053          USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              05090035
035054                                                                  05100035
035055     EVALUATE TRUE                                                05110035
035056         WHEN DPG54-NO-ERROR                                      05120035
035057             CONTINUE                                             05130035
035058         WHEN OTHER                                               05140035
035059             DISPLAY DPG54-ERROR-MESSAGE                          05150035
035060             DISPLAY '** ABEND **'                                05160035
035061             DISPLAY PC-CURRENT-PROGRAM-NAME  ' - INVALID'        05170035
035062                       'NEW OPEN DATE PROVIDED'                   05180035
035063             DISPLAY '1500-CALC-NEW-OPEN-DTE'                     05190035
035064             SET AC-CALENDAR-ROUTINE-ERROR TO TRUE                05200035
035065             CALL 'ILBOABN0' USING AC-ABEND-CODE                  05210035
035066     END-EVALUATE.                                                05220035
035067                                                                  05230035
035068     MOVE DPG55-DB2-ISO-DATE-FMT TO PV-NEW-DTE.                   05240035
035069                                                                  05250035
035070******************************************************************05260035
035071* 1600-READ-TOMORROW-DATE                                         05270035
035072* READ THE CONTROL CARD CONTAINING TOMORROW'S DATE.               05280035
035073******************************************************************05290035
035074 1600-READ-TOMORROW-DATE.                                         05300035
035075                                                                  05310035
035076     READ TOMORROW-DATE-CONTROL-FILE INTO                         05320035
035077          CC-EPCC112-CONTROL-CARD                                 05330037
035078         AT END                                                   05340035
035079             SET PS-END-OF-TOMORROW-CC  TO TRUE                   05350035
035080     END-READ.                                                    05360035
035081                                                                  05370035
035082******************************************************************05380042
035083* 1700-VALIDATE-TOMORROW-DTE CHECKS FOR VALID DATE                05390035
035084******************************************************************05400042
035086 1700-VALIDATE-TOMORROW-DTE.                                      05410035
035087                                                                  05420035
035088     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         05430035
035089     SET DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                     05440035
035090     SET DPG52-LK-DTE-ISO-FMT        TO TRUE.                     05450035
035091                                                                  05460035
035092     MOVE CC-EPCC112-TOMORROW-DATE TO                             05470037
035093          DPG52-LK-DATE-INPUT.                                    05480035
035094                                                                  05490035
035095     CALL DP500-KOHLS-CALENDAR-ROUTINE                            05500035
035096          USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              05510035
035097                                                                  05520035
035098     EVALUATE TRUE                                                05530035
035099         WHEN DPG54-NO-ERROR                                      05540035
035100             CONTINUE                                             05550035
035101         WHEN OTHER                                               05560035
035102             MOVE 'INVALID DATE ON EPCC112 CONTROL CARD' TO       05570035
035103                  PV-OPERATION-MSG-1                              05580035
035104             MOVE '                 '        TO                   05590035
035105                  PV-OPERATION-MSG-2                              05600035
035106             MOVE '1700-VALIDATE-TOMORROW-DATE' TO                05610035
035107              PV-PARAGRAPH-NAME                                   05620035
035108             SET AC-CALENDAR-ROUTINE-ERROR TO TRUE                05630035
035109             PERFORM 9999-ABEND                                   05640035
035110     END-EVALUATE.                                                05650035
035111                                                                  05660035
035112******************************************************************05670035
035120* 1800-OPEN-STATE-CSR.                                            05680035
035200*                                                                 05690000
035300******************************************************************05700000
035400 1800-OPEN-STATE-CSR.                                             05710035
035500                                                                  05720000
035600     EXEC SQL                                                     05730000
035700          OPEN STATE-CSR                                          05740000
035800     END-EXEC.                                                    05750000
035900                                                                  05760000
036000     EVALUATE TRUE                                                05770000
036100         WHEN SQLCODE = ZERO                                      05780000
036200              CONTINUE                                            05790000
036300         WHEN SQLWARN0 NOT EQUAL SPACE                            05800000
036400         WHEN SQLCODE NOT EQUAL ZERO                              05810000
036500             MOVE '1800-OPEN-STATE-CSR        '                   05820035
036600                                            TO PV-PARAGRAPH-NAME  05830000
036700             MOVE 'ERROR ON OPEN OF STATE-CSR'                    05840000
036800                                            TO PV-DB2-OPERATION   05850000
036900             PERFORM 9100-SQL-ABEND                               05860000
037000     END-EVALUATE.                                                05870000
037100                                                                  05880000
037200******************************************************************05890000
037300* 1810-PROCESS-STATES                                             05900035
037400* SELECT STATES OPEN OR IN TRAINING.                              05910000
037500******************************************************************05920000
037600 1810-PROCESS-STATES.                                             05930035
037700                                                                  05940000
037900     ADD +1               TO PV-STATE-SUB.                        05950027
038000     MOVE XST00001-ST-CDE TO ST-ST-CDE(PV-STATE-SUB).             05960027
038300     MOVE PV-STATE-SUB    TO PV-STATE-CNT.                        05970027
038400                                                                  05980013
038500     PERFORM 1850-FETCH-STATE-CSR.                                05990035
038600                                                                  06000000
038700******************************************************************06010000
038800* 1820-CLOSE-STATE-CSR.                                           06020035
038900*                                                                 06030000
039000******************************************************************06040000
039100 1820-CLOSE-STATE-CSR.                                            06050035
039200                                                                  06060000
039300     EXEC SQL                                                     06070000
039400          CLOSE STATE-CSR                                         06080000
039500     END-EXEC.                                                    06090000
039600                                                                  06100000
039700     EVALUATE TRUE                                                06110000
039800         WHEN SQLCODE = ZERO                                      06120000
039900              CONTINUE                                            06130000
040000         WHEN SQLWARN0 NOT EQUAL SPACE                            06140000
040100         WHEN SQLCODE NOT EQUAL ZERO                              06150000
040200             MOVE '1820-CLOSE-STATE-CSR       '                   06160035
040300                                            TO PV-PARAGRAPH-NAME  06170000
040400             MOVE 'ERROR ON CLOSE OF STATE-CSR'                   06180000
040500                                            TO PV-DB2-OPERATION   06190000
040600             PERFORM 9100-SQL-ABEND                               06200000
040700     END-EVALUATE.                                                06210000
040800                                                                  06220000
040900******************************************************************06230000
041000* 1850-FETCH-STATE-CSR.                                           06240035
041100******************************************************************06250000
041200 1850-FETCH-STATE-CSR.                                            06260035
041300     EXEC SQL                                                     06270000
041400          FETCH STATE-CSR                                         06280000
041500           INTO :XST00001-ST-CDE                                  06290000
041600     END-EXEC.                                                    06300000
041700                                                                  06310000
041800     EVALUATE TRUE                                                06320000
041900         WHEN SQLCODE = ZERO                                      06330000
042000             CONTINUE                                             06340000
042100         WHEN SQLCODE = +100                                      06350000
042200             SET PS-END-OF-STATES TO TRUE                         06360000
042300         WHEN SQLWARN0 NOT EQUAL SPACE                            06370000
042400         WHEN SQLCODE NOT EQUAL ZERO                              06380000
042500             MOVE '1850-FETCH-STATE-CSR       '                   06390035
042600                                            TO PV-PARAGRAPH-NAME  06400000
042700             MOVE 'ERROR ON FETCH OF STATE-CSR'                   06410000
042800                                            TO PV-DB2-OPERATION   06420000
042900             PERFORM 9100-SQL-ABEND                               06430000
043000     END-EVALUATE.                                                06440000
043100                                                                  06450000
043200******************************************************************06460000
043300* 2000-CREATE-DUMMY-SKU-FILE                                      06470000
043400*                                                                 06480000
043500* IF THE RECORD READ CONTAINS THE DEFAULT TAXWARE PRODUCT CODE FOR06490000
043600* A SUB CLASS, GET DEFAULT TAX CODE FOR THE SUB CLASS FROM        06500018
043700* XST_SUB_CL.                                                     06510018
043710*                                                                 06520018
043800* IF THE SUB CLASS WAS FOUND ON XST_SUB_CL, FORMAT THE OUTPUT     06530018
044000* RECORD AND WRITE OUT ONE RECORD FOR EACH STATE.                 06540018
044200*                                                                 06550000
044300* READ ANOTHER RECORD FROM THE EXTRACT FILE.                      06560000
044400*                                                                 06570000
044500******************************************************************06580000
044600 2000-CREATE-DUMMY-SKU-FILE.                                      06590000
044700                                                                  06600000
044710     PERFORM 3000-CHECK-PLU-EXCLUSION-IND.                        06610076
044720                                                                  06620066
044730     IF PS-PLU-DWNLD-EXCL-IND-NO                                  06630076
045000         ADD +1 TO PA-TAX-RECORDS-READ                            06660070
               INITIALIZE TX911-TAX-ITEM-RECORD                         06670070
               SET PS-NOT-END-OF-STATES TO TRUE                         06680070
047500         MOVE IM040-MDSAER-DEPT-NBR   TO PV-DEPT-NBR-NUM          06690082
047600         MOVE IM040-MDSEAR-MAJ-CL-NBR TO PV-MAJ-CL-NBR-NUM        06700082
047700         MOVE IM040-MDSEAR-SUB-CL-NBR TO PV-SUB-CL-NBR-NUM        06710082
               IF IM040-VSCHVL-CHARTC-VAL-DESC(1:5) = PV-TX-PRD-CDE-DESC06720071
                   PERFORM 4000-MOVE-TABLE-VALUES                       06740070
                   VARYING PV-STATE-SUB FROM 1 BY 1                     06750070
                     UNTIL PS-END-OF-STATES OR                          06760070
                           PV-STATE-SUB > PC-STATE-LIMIT                06770070
               ELSE                                                     06780070
                   PERFORM 5000-GET-ITEM-TAXABILITY                     06790070
                   VARYING PV-STATE-SUB FROM 1 BY 1                     06800070
                     UNTIL PS-END-OF-STATES OR                          06810070
                           PV-STATE-SUB > PC-STATE-LIMIT                06820070
               END-IF                                                   06830076
046200     END-IF.                                                      06850076
046300                                                                  06860000
046400     PERFORM 2900-READ-EXTRACT-FILE.                              06870000
046500                                                                  06880000
061000******************************************************************06900000
061100* 2900-READ-EXTRACT-FILE                                          06910000
061200*                                                                 06920000
061300******************************************************************06930000
061400 2900-READ-EXTRACT-FILE.                                          06940000
061500                                                                  06950000
061600     READ DEPT-CL-EXTRACT-FILE INTO IM040-DEFAULT-MAINT-EXTRACT   06960000
061700        AT END                                                    06970000
061800           SET PS-END-OF-EXTR TO TRUE                             06980000
061900     END-READ.                                                    06990000
062000                                                                  07000000
062100     IF PS-NOT-END-OF-EXTR                                        07010007
062200         ADD +1 TO PA-RECORDS-READ                                07020007
062300     END-IF.                                                      07030007
062400                                                                  07040000
062500***************************************************************** 07050066
062600* 3000-CHECK-PLU-EXCLUSION-IND                                  * 07060066
062700* CHECK THE XST_SUB_CL_ATTR TABLE TO SEE IF THE DUMMY SKU IS TO * 07070066
062800* BE SENT TO THE REGISTER.                                      * 07080066
062700***************************************************************** 07090066
062900 3000-CHECK-PLU-EXCLUSION-IND.                                    07100076
063000                                                                  07110066
063100     MOVE IM040-MDSAER-DEPT-NBR   TO XST00055-DEPT-NBR.           07120076
063200     MOVE IM040-MDSEAR-MAJ-CL-NBR TO XST00055-MAJ-CL-NBR.         07130076
063300     MOVE IM040-MDSEAR-SUB-CL-NBR TO XST00055-SUB-CL-NBR.         07140076
063400                                                                  07150066
063500     EXEC SQL                                                     07160076
063600         SELECT PLU_DWNLD_EXCL_IND                                07170089
063700           INTO :XST00055-PLU-DWNLD-EXCL-IND                      07180089
063800           FROM XST_SUB_CL_ATTR A                                 07190089
063800              , XST_SUB_CL      B                                 07191089
063900          WHERE A.DEPT_NBR   = B.DEPT_NBR                         07200089
064000            AND A.MAJ_CL_NBR = B.MAJ_CL_NBR                       07200189
064100            AND A.SUB_CL_NBR = B.SUB_CL_NBR                       07200289
063900            AND A.DEPT_NBR   = :XST00055-DEPT-NBR                 07201089
064000            AND A.MAJ_CL_NBR = :XST00055-MAJ-CL-NBR               07210089
064100            AND A.SUB_CL_NBR = :XST00055-SUB-CL-NBR               07220089
064200           WITH UR                                                07230076
064300     END-EXEC.                                                    07240076
064400                                                                  07250067
064500     EVALUATE SQLCODE                                             07260076
064600         WHEN ZERO                                                07270076
064700              MOVE XST00055-PLU-DWNLD-EXCL-IND TO                 07280089
064710                                    PS-PLU-DWNLD-EXCL-IND         07290089
064800         WHEN +100                                                07300076
064900              SET PS-PLU-DWNLD-EXCL-IND-YES TO TRUE               07310077
065000         WHEN OTHER                                               07320076
065100              MOVE '3000-CHECK-PLU-EXCLUSION-IND' TO              07330076
065110                                       PV-PARAGRAPH-NAME          07331076
065200              MOVE 'SELECT FROM XST_SUB_CL_ATTR'                  07340076
065300                                       TO PV-DB2-OPERATION        07350076
065400              MOVE 'ERROR SELECTING FROM XST_SUB_CL_ATTR TBL'     07360076
065410                                       TO PV-OPERATION-MSG-1      07361076
065500              DISPLAY 'DEPT NBR: ' XST00055-DEPT-NBR              07370076
065600              DISPLAY 'MAJ CL NBR: ' XST00055-MAJ-CL-NBR          07380076
065700              DISPLAY 'SUB CL NBR: ' XST00055-SUB-CL-NBR          07390076
065800              PERFORM 9100-SQL-ABEND                              07400076
065900     END-EVALUATE.                                                07420076
065910                                                                  07421068
061000******************************************************************07430052
061100* 4000-MOVE-TABLE-VALUES                                          07440052
061200*                                                                 07450052
061300******************************************************************07460052
061400 4000-MOVE-TABLE-VALUES.                                          07470052
062400                                                                  07480057
062400     IF ST-ST-CDE (PV-STATE-SUB) = SPACES OR                      07490058
062400        PV-STATE-SUB > PC-STATE-LIMIT                             07500057
062400           SET PS-END-OF-STATES TO TRUE                           07510057
062400     ELSE                                                         07520057
061500        MOVE ST-ST-CDE (PV-STATE-SUB) TO TX911-STATE-CODE         07530057
062400        MOVE ST-PRD-CDE(PV-STATE-SUB) TO TX911-TX-PRD-CDE         07540057
062400        MOVE ST-TX-CDE(PV-STATE-SUB)  TO TX911-TX-PARM-CDE        07550057
062400        PERFORM 6000-FORMAT-DUMMY-SKU-RCD                         07560057
062400        PERFORM 7000-WRITE-DUMMY-SKU-RCD                          07570057
062400     END-IF.                                                      07580057
062400                                                                  07590057
061000******************************************************************07600057
061100* 5000-GET-ITEM-TAXABILITY                                        07610057
061200* GET THE ITEM TAX ABILITY CODE AND WRITE THE RECORD              07620057
061300******************************************************************07630057
061400 5000-GET-ITEM-TAXABILITY.                                        07640057
062400                                                                  07650057
062400     IF ST-ST-CDE (PV-STATE-SUB) = SPACES OR                      07660057
062400        PV-STATE-SUB > PC-STATE-LIMIT                             07670057
062400           SET PS-END-OF-STATES TO TRUE                           07680057
062400     ELSE                                                         07690057
062400        SET PS-TAXABILITY-NOT-FOUND TO TRUE                       07700057
062400        MOVE ST-ST-CDE (PV-STATE-SUB) TO TX911-STATE-CODE         07710057
062400        PERFORM 5100-FIND-PRODUCT-CDE-EXP                         07720057
062400        IF PS-TAXABILITY-FOUND                                    07730057
                  MOVE TXT00008-PRD-TX-CDE TO TX911-TX-PARM-CDE         07740063
062400        ELSE                                                      07750057
062400           PERFORM 5200-FIND-DEFAULT-PRODUCT-CDE                  07760057
062400           IF PS-TAXABILITY-FOUND                                 07770057
                    MOVE TXT00007-PRD-TX-CDE TO TX911-TX-PARM-CDE       07780063
062400           ELSE                                                   07790057
062400              PERFORM 5300-GET-DFLT-TX-CDE                        07800057
062400              IF PS-TAXABILITY-FOUND                              07810063
                       IF XST00014-TAX-DFLT-IND = 'Y'                   07820063
                          SET TX911-TAX-FULL-RTE TO TRUE                07830063
                       ELSE                                             07840063
                          SET TX911-NON-TAXABLE TO TRUE                 07850063
                       END-IF                                           07860063
                    END-IF                                              07870063
062400           END-IF                                                 07880063
062400        END-IF                                                    07890063
062400     END-IF.                                                      07900063
                                                                        07910063
062400     IF PS-END-OF-STATES                                          07920063
062400        CONTINUE                                                  07930063
062400     ELSE                                                         07940063
              IF PS-TAXABILITY-FOUND                                    07950063
                 MOVE IM040-VSCHVL-CHARTC-VAL-DESC (1:5)                07960063
                                TO PV-TX-CDE-DESC                       07970063
                 MOVE IM040-VSCHVL-CHARTC-VAL-DESC(1:5)                 07980063
                               TO TX911-TX-PRD-CDE                      07990063
                 MOVE TX911-TX-PRD-CDE TO ST-PRD-CDE(PV-STATE-SUB)      08000063
                 MOVE TX911-TX-PARM-CDE TO ST-TX-CDE (PV-STATE-SUB)     08010063
                 PERFORM 6000-FORMAT-DUMMY-SKU-RCD                      08020063
                 PERFORM 7000-WRITE-DUMMY-SKU-RCD                       08030063
              ELSE                                                      08040063
                 ADD +1 TO PA-TAX-RECORDS-SKIPPED                       08050063
              END-IF                                                    08060063
           END-IF.                                                      08070063
      ******************************************************************08080063
      * 5100-FIND-PRODUCT-CDE-EXP                                       08090063
      * GET THE PRODUCT TAX CODE FROM THE EXCEPTION TABLE               08100063
      ******************************************************************08110063
       5100-FIND-PRODUCT-CDE-EXP.                                       08120063
                                                                        08130063
           MOVE ST-ST-CDE (PV-STATE-SUB) TO TXT00008-ST-PROV-CDE.       08140063
           MOVE IM040-VSCHVL-CHARTC-VAL-DESC (1:5)                      08150063
                                         TO PV-TX-CDE-DESC.             08160063
           MOVE PV-TX-PRD-CDE-DESC-N     TO TXT00008-TX-PRD-NBR.        08170063
           EXEC SQL                                                     08180063
              SELECT PRD_TX_CDE                                         08190063
                INTO :TXT00008-PRD-TX-CDE                               08200063
              FROM TXT_PRD_EXC                                          08210063
              WHERE TX_PRD_NBR   = :TXT00008-TX-PRD-NBR                 08220063
                AND ST_PROV_CDE  = :TXT00008-ST-PROV-CDE                08230075
                AND EFF_BEG_DTE <= :CC-EPCC112-TOMORROW-DATE            08240063
                AND EFF_END_DTE >= :CC-EPCC112-TOMORROW-DATE            08250063
              WITH UR                                                   08260063
           END-EXEC.                                                    08270063
                                                                        08280063
           EVALUATE TRUE                                                08290063
              WHEN SQLCODE = ZERO                                       08300063
                  SET PS-TAXABILITY-FOUND TO TRUE                       08310063
              WHEN SQLCODE = +100                                       08320063
                  CONTINUE                                              08330063
              WHEN OTHER                                                08340063
                  MOVE '5100-FIND-PRODUCT-CDE-EXP' TO PV-PARAGRAPH-NAME 08350063
                  MOVE 'ERROR ON SELECT FROM TXT00008'                  08360063
                                             TO PV-DB2-OPERATION        08370063
                  DISPLAY 'ERROR SELECTING FROM TXT00008'               08380063
                  DISPLAY 'STATE CODE ' ST-ST-CDE(PV-STATE-SUB)         08390063
                  DISPLAY 'TX PRD NBR '                                 08400063
                                 IM040-VSCHVL-CHARTC-VAL-DESC (1:5)     08410063
                  PERFORM 9100-SQL-ABEND                                08420063
           END-EVALUATE.                                                08430063
      ******************************************************************08440063
      * 5200-FIND-DEFAULT-PRODUCT-CDE                                   08450063
      * GET THE PRODUCT TAX CODE                                        08460063
      ******************************************************************08470063
       5200-FIND-DEFAULT-PRODUCT-CDE.                                   08480063
           MOVE IM040-VSCHVL-CHARTC-VAL-DESC (1:5)                      08490063
                                         TO PV-TX-PRD-CDE-DESC-W.       08500063
           MOVE PV-TX-PRD-CDE-DESC       TO TXT00007-TX-PRD-NBR.        08510063
           EXEC SQL                                                     08520063
              SELECT PRD_TX_CDE                                         08530063
                INTO :TXT00007-PRD-TX-CDE                               08540063
              FROM TXT_PRD                                              08550063
              WHERE TX_PRD_NBR   = :TXT00007-TX-PRD-NBR                 08560063
              WITH UR                                                   08570063
           END-EXEC.                                                    08580063
           EVALUATE TRUE                                                08590063
               WHEN SQLCODE = ZERO                                      08600063
                   SET PS-TAXABILITY-FOUND TO TRUE                      08610063
               WHEN SQLCODE = +100                                      08620063
                   CONTINUE                                             08630063
               WHEN OTHER                                               08640063
                   MOVE '5200-FIND-DEFAULT-PRODUCT-CDE'                 08650063
                                         TO PV-PARAGRAPH-NAME           08660063
                   MOVE 'ERROR ON SELECT FROM TXT00007'                 08670063
                                                  TO PV-DB2-OPERATION   08680063
                   DISPLAY 'ERROR SELECTING FROM TXT00007'              08690063
                   DISPLAY 'TX PRD NBR '                                08700063
                             IM040-VSCHVL-CHARTC-VAL-DESC (1:5)         08710063
                   PERFORM 9100-SQL-ABEND                               08720063
           END-EVALUATE.                                                08730063
047200******************************************************************08740063
046700* 5300-GET-DFLT-TX-CDE                                            08750063
046800*                                                                 08760063
046900* SELECT THE DEFAULT TAX CODE FOR THE SUB CLASS.  DO NOT SELECT   08770063
047000* THE SUB CLASS IF THE CRE-TMST IS > THAN THE CURRENT RUN TIME-   08780063
047100* STAMP FOR THE PLU SYSTEM.  THIS WILL PREVENT US FROM GETTING    08790063
047110* RECORDS THAT PLU DID NOT PROCESS YET.                           08800063
047200******************************************************************08810063
047300 5300-GET-DFLT-TX-CDE.                                            08820063
047400                                                                  08830063
047800     MOVE PV-DEPT-NBR-NUM         TO XST00014-DEPT-NBR.           08840063
047900     MOVE PV-MAJ-CL-NBR-NUM       TO XST00014-MAJ-CL-NBR.         08850063
048000     MOVE PV-SUB-CL-NBR-NUM       TO XST00014-SUB-CL-NBR.         08860063
048100                                                                  08870063
048200     EXEC SQL                                                     08880063
048300         SELECT TAX_DFLT_IND                                      08890063
048500           INTO :XST00014-TAX-DFLT-IND                            08900063
048700           FROM XST_SUB_CL                                        08910063
048800          WHERE DEPT_NBR   = :XST00014-DEPT-NBR                   08920063
048900            AND MAJ_CL_NBR = :XST00014-MAJ-CL-NBR                 08930063
049000            AND SUB_CL_NBR = :XST00014-SUB-CL-NBR                 08940063
049010            AND CRE_TMST   < :CC-EPCC105-CRNT-TIMESTAMP           08950063
049020          WITH UR                                                 08960063
049100     END-EXEC.                                                    08970063
049200                                                                  08980063
049300     EVALUATE TRUE                                                08990063
049400         WHEN SQLCODE = ZERO                                      09000063
                   SET PS-TAXABILITY-FOUND TO TRUE                      09010063
049600         WHEN SQLCODE = +100                                      09020057
049700             CONTINUE                                             09030063
049800         WHEN SQLWARN0 NOT EQUAL SPACE                            09040057
049900         WHEN SQLCODE NOT EQUAL ZERO                              09050057
050000             MOVE '5300-GET-DFLT-TX-CDE    '                      09060063
050100                                      TO PV-PARAGRAPH-NAME        09070057
050200             MOVE 'ERROR ON SELECT FROM XST_SUB_CL'               09080057
050300                                      TO PV-DB2-OPERATION         09090057
050400             PERFORM 9100-SQL-ABEND                               09100057
050500     END-EVALUATE.                                                09110057
050510                                                                  09120057
050600******************************************************************09130057
050700* 6000-FORMAT-DUMMY-SKU-RCD                                       09140057
050800*                                                                 09150057
050900* FORMAT THE OUTPUT RECORD WITH ALL INFORMATION EXCEPT THE STATE  09160057
051000* CODE.                                                           09170057
051100*                                                                 09180057
051200******************************************************************09190057
051300 6000-FORMAT-DUMMY-SKU-RCD.                                       09200057
051400                                                                  09210057
051600                                                                  09220057
051700     PERFORM 6100-FORMAT-SKU-NBR.                                 09230057
051800                                                                  09240057
051900     PERFORM 6200-GET-INTERNAL-UPC.                               09250057
052000                                                                  09260057
052100     MOVE PV-INTERNAL-UPC       TO PV-INTR-UPC-ID                 09270057
052110     MOVE PV-INTR-UPC-ID        TO TX911-INTR-UPC-ID.             09280057
052200     MOVE PV-DEPT-NBR-NUM       TO TX911-DEPT-NBR.                09290057
052300     MOVE PV-SUB-CL-NBR-NUM     TO TX911-SUB-CL-NBR.              09300057
052300     MOVE PV-MAJ-CL-NBR-NUM     TO TX911-MAJ-CL-NBR.              09310064
052400     MOVE PV-SKU-NBR-NUM        TO TX911-SKU-NBR.                 09320064
052500                                                                  09330064
054800******************************************************************09340057
054900* 6100-FORMAT-SKU-NBR                                             09350057
055000*                                                                 09360057
055100* FORMAT THE SKU NUMBER FROM THE DEPARTMENT CLASS NUMBER.  THE    09370057
055200* SKU NUMBER FOR DUMMY SKUS IS 8 DIGITS LONG.  THE FORMAT IS      09380057
055300* DDDCCNNN WHERE                                                  09390057
055400*      DDD = DEPARTMENT NUMBER                                    09400057
055500*       CC = SUB-CLASS NUMBER                                     09410057
055600*      NNN = ZEROES                                               09420057
055700*                                                                 09430057
055800******************************************************************09440057
055900 6100-FORMAT-SKU-NBR.                                             09450057
056000                                                                  09460057
056100      MOVE IM040-MDSAER-DEPT-NBR  TO PV-SKU-NBR-CHAR (1:3).       09470087
056200      MOVE PV-SUB-CL-NBR-02       TO PV-SKU-NBR-CHAR (4:2).       09480087
056300      MOVE '000'                  TO PV-SKU-NBR-CHAR (6:3).       09490087
056400                                                                  09500057
056500******************************************************************09510057
056600* 6200-GET-INTERNAL-UPC.                                          09520057
056700*                                                                 09530057
056800* FORMAT THE INTERNAL UPC NUMBER FOR THE SKU.  IT IS ALWAYS 12    09540057
056900* DIGITS.                                                         09550057
056910*                                                                 09560057
056920* 01-02 99                                                        09570057
056930* 03-05 DEPARTMENT NUMBER                                         09580057
056940* 06-07 SUB CLASS NUMBER                                          09590057
056950* 08-12 00000                                                     09600057
057000******************************************************************09610057
057100 6200-GET-INTERNAL-UPC.                                           09620057
057200                                                                  09630057
057210      MOVE '99'                  TO PV-INTERNAL-UPC (1:2).        09640087
057300      MOVE IM040-MDSAER-DEPT-NBR TO PV-INTERNAL-UPC (3:3).        09650087
057400      MOVE PV-SUB-CL-NBR-02      TO PV-INTERNAL-UPC (6:2).        09660087
057500      MOVE '00000'               TO PV-INTERNAL-UPC (8:5).        09670087
059100                                                                  09680057
059200******************************************************************09690057
059300* 7000-WRITE-DUMMY-SKU-RCD                                        09700057
059400*                                                                 09710057
059500* IF THERE IS A STATE-CODE IN THE TABLE OCCURANCE, MOVE IT TO THE 09720057
059600* OUTPUT RECORD AN WRITE THE RECORD TO THE OUTPUT FILE.           09730057
059700* OTHERWISE, SET THE END OF STATES FLAG TO TRUE.                  09740057
059800*                                                                 09750057
059900******************************************************************09760057
060000 7000-WRITE-DUMMY-SKU-RCD.                                        09770057
060100                                                                  09780057
060600     WRITE DUMMY-SKU-RCD FROM TX911-TAX-ITEM-RECORD.              09790057
060700     ADD +1 TO PA-RECORDS-WRITTEN.                                09800057
062500******************************************************************09810057
062600* 9000-FINISH-PROGRAM CLOSES FILES AND DISPLAYS RUN COUNTS IN THE 09820052
062700* SYSOUT.                                                         09830000
062800******************************************************************09840000
062900 9000-FINISH-PROGRAM.                                             09850000
063000                                                                  09860000
063100     DISPLAY '****** TXKUT918 RUN STATISTICS ******'              09870001
063200     DISPLAY ' '                                                  09880001
063300     MOVE PA-RECORDS-READ     TO PV-DISPLAY-NUM                   09890001
063400     DISPLAY 'RECORDS READ........: ' PV-DISPLAY-NUM.             09900012
063500     MOVE PA-TAX-RECORDS-READ TO PV-DISPLAY-NUM                   09910012
063600     DISPLAY 'TAX RECORDS READ....: ' PV-DISPLAY-NUM.             09920012
063700     MOVE PA-TAX-RECORDS-SKIPPED TO PV-DISPLAY-NUM                09930013
063800     DISPLAY 'TAX RECORDS SKIPPED.: ' PV-DISPLAY-NUM.             09940013
063900     MOVE PV-STATE-CNT           TO PV-DISPLAY-NUM                09950013
064000     DISPLAY 'STATES SELECTED.....: ' PV-DISPLAY-NUM.             09960013
064100     MOVE PA-RECORDS-WRITTEN  TO PV-DISPLAY-NUM                   09970013
064200     DISPLAY 'RECORDS WRITTEN.....: ' PV-DISPLAY-NUM.             09980012
064300                                                                  09990001
064400     CLOSE DEPT-CL-EXTRACT-FILE                                   10000000
064500           DUMMY-SKU-FILE.                                        10010000
064600                                                                  10020000
064700******************************************************************10030000
064800* 9100-SQL-ABEND - PERFORMS THE ABEND FOR THE PROGRAM IN THE      10040000
064900* EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS.                 10050000
065000******************************************************************10060000
065100 9100-SQL-ABEND.                                                  10070000
065200     DISPLAY '** ABEND     **'.                                   10080000
065300     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        10090000
065400     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              10100000
065500     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               10110000
065600                                                                  10120000
065700******************************************************************10130000
065800* COPY BOOK CONTAINING PROCEDURE DIVISION STATEMENTS REQUIRED     10140000
065900* TO UTILIZE SQLCA MESSAGE DISPLAY MODULE 'DSNTIAR' FOLLOWS.      10150000
066000******************************************************************10160000
066100     COPY DPPD004.                                                10170050
066200                                                                  10180000
066300     SET AC-DB2-ERROR TO TRUE.                                    10190000
066400     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         10200000
066500                                                                  10210000
066600******************************************************************10220000
066700* 9999-ABEND - PERFORMS A NON-SQL-ABEND                           10230000
066800******************************************************************10240000
066900 9999-ABEND.                                                      10250000
067000     DISPLAY '** ABEND           **'.                             10260000
067100     DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  10270000
067200     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        10280000
067300     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       10290000
067400     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       10300000
067500     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         10310000
