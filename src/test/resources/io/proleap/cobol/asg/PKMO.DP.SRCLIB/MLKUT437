       ID DIVISION.                                                     00010009
                                                                        00020009
       PROGRAM-ID.      MLKUT437.                                       00030009
       AUTHOR.          TESS BESTE.                                     00040009
       INSTALLATION.    KOHLS DEPARTMENT STORES.                        00050009
       DATE-WRITTEN     06/1999.                                        00060009
       DATE-COMPILED.                                                   00070009
      ******************************************************************00080009
      *                                                                 00090009
      *  MLKUT437 - CREATE WEEKLY DEPARTMENT PLANNING EXTRACT FOR       00100009
      *             COMBINED LEDGER.                                    00110009
      *                                                                 00120009
      *  THIS PROGRAM READS A PLANNING EXTRACT FILE, REFORMATS IT,      00130009
      *  AND CREATES ANOTHER EXTRACT FILE THAT IS USED TO LOAD THE      00140009
      *  WEEKLY DEPARTMENT PLAN TABLE (TWKDPLN), WHICH IS THE SOURCE OF 00150009
      *  THE WEEKLY PLAN DATA ON THE COMBINED LEDGER REPORT.            00160009
      *                                                                 00170009
      *  BOTH THE INPUT AND OUTPUT EXTRACT FILES ARE AT A DEPARTMENT    00180009
      *  LEVEL AND CONTAIN WEEKLY DATA FOR A PARTICULAR SEASON.  EACH   00190009
      *  RECORD ON THE INPUT EXTRACT FILE CONTAINS 26 OR 27             00200009
      *  OCCURRENCES (ONE FOR EACH WEEK IN THE SEASON) OF ONE           00210009
      *  PARTICULAR PIECE OF INFORMATION (SALES RETAIL AMOUNT, FOR      00220009
      *  EXAMPLE).  EACH RECORD ON THE OUTPUT FILE CONTAINS ALL THE     00230009
      *  NECESSARY PIECES OF INFORMATION FOR ONE WEEK.                  00240009
      *                                                                 00250009
      *  TO CONVERT A RECORD FROM THE INPUT FORMAT TO THE OUTPUT        00260009
      *  FORMAT, ALL THE INFORMATION FOR A DEPARTMENT IS TABLED BY      00270009
      *  WEEK AS IT IS READ.  WHEN THE DEPARTMENT NUMBER CHANGES,       00280009
      *  26 OR 27 OUTPUT RECORDS ARE WRITTEN FROM THE TABLED DATA -     00290009
      *  ONE RECORD FOR EACH WEEK IN THE SEASON.                        00300009
      *                                                                 00310009
      *  THE SEASON BEGIN DATE IS READ FROM A CONTROL CARD THAT IS      00320009
      *  UPDATED BY BPK930.  IT IS USED TO RETRIEVE THE FISCAL WEEK     00330009
      *  END DATE AND FISCAL WEEK NUMBER FROM TDTATTR FOR EACH WEEK     00340009
      *  IN THE SEASON.                                                 00350009
      ******************************************************************00360009
      * WR/PITS#    DATE      DESCRIPTION                               00370032
      * --------  --------  -----------------------------------------   00380032
99999 * WR99999   08/17/2000 ROD JANSSEN                                00390032
99999 *    PLANNING/OTB EXTRACT CHANGES DUE TO AIM PROJECT.             00400011
99999 *    (ADJUSTMENTS TO UNSTRING VARIABLES AND NEW ROWS)             00410011
21517 * WR21517   09/25/2000 LEE VANG                                   00411032
21517 *    COMBINED LEDGER PHASE 6                                      00411132
31355 * WR31355   11/17/2000 ROD JANSSEN                                00413032
31355 *    E-Commerce Combined Ledger Report Modification.......        00414020
      * WR99999   03/23/2001 CHANGE TO EXTRACT GROSS RECEIPT ('GREC')   00416032
      *                         INSTEAD OF NET RECEIPT ('REC')          00417031
      *                         FOR WKDPLN-RCPT-RTL-AMT FIELD UPDATE.   00417131
      *                         PRODUCTION FIX.  -V. LEE YANG           00417231
W04031* WR#99999  04/03/2001 ROD JANSSEN                                00417332
W04031*    CHANGE ALL RECORD TYPE VERBIAGE TO UPPER CASE.               00417432
      *                                                                 00417534
C71482* C71482    08/04/2017 J SELWITSCHKA                              00417636
C71482*    EP UPGRADE. DO NOT ABEND IF INPUT FILE IS EMPTY.             00417736
      ******************************************************************00420009
                                                                        00430009
       ENVIRONMENT DIVISION.                                            00440009
                                                                        00450009
       CONFIGURATION SECTION.                                           00460009
                                                                        00470009
       SOURCE-COMPUTER.        IBM-3090.                                00480009
       OBJECT-COMPUTER.        IBM-3090.                                00490009
                                                                        00500009
       INPUT-OUTPUT SECTION.                                            00510009
                                                                        00520009
       FILE-CONTROL.                                                    00530009
                                                                        00540009
           SELECT  DPT-PLN-FILE                                         00550009
               ASSIGN TO INP01.                                         00560009
                                                                        00570009
           SELECT WEEKLY-PLN-EXTRACT-FILE                               00580009
               ASSIGN TO OUT01.                                         00590009
                                                                        00600009
       DATA DIVISION.                                                   00610009
                                                                        00620009
       FILE SECTION.                                                    00630009
                                                                        00640009
       FD  DPT-PLN-FILE                                                 00650009
           RECORDING MODE F                                             00660009
           LABEL RECORDS ARE STANDARD                                   00670009
           BLOCK CONTAINS  0 RECORDS                                    00680009
           RECORD CONTAINS 400 CHARACTERS                               00690009
           DATA RECORD IS DPT-PLN-REC.                                  00700009
                                                                        00710009
       01  DPT-PLN-REC                 PIC X(400).                      00720009
                                                                        00730009
       FD  WEEKLY-PLN-EXTRACT-FILE                                      00740009
           RECORDING MODE IS F                                          00750009
           LABEL RECORDS ARE STANDARD                                   00760009
           BLOCK CONTAINS 0 RECORDS.                                    00770009
                                                                        00780009
       01  WEEKLY-PLN-EXTRACT-REC      PIC X(64).                       00790009
                                                                        00800009
       WORKING-STORAGE SECTION.                                         00810009
                                                                        00820009
       01  FWT-FSCL-WK-TABLE.                                           00830009
           05  FWT-FSCL-WK-ENTRY       OCCURS 27.                       00840009
               10  FWT-FSCL-WK-END-DTE PIC X(10).                       00850009
               10  FWT-FSCL-WK-NBR     PIC X(02).                       00860009
                                                                        00870009
                                                                        00880009
      *  THIS TABLE IS USED TO HOLD ALL INPUT DATA FOR A DEPARTMENT     00890009
      *  BY WEEK.  WHEN A BREAK OCCURS ON DEPARTMENT NUMBER, THE        00900009
      *  OUTPUT RECORDS ARE BUILT FROM THIS TABLE.                      00910009
       01  PDT-PLAN-DATA-TABLE.                                         00920009
           05  PDT-PLAN-DATA-TABLE-ENTRY                                00930009
                                       OCCURS 27.                       00930109
               10  PDT-SLS-RTL-AMT     PIC S9(09)V99  COMP-3 VALUE +0.  00930201
               10  PDT-MKDN-RTL-AMT    PIC S9(09)V99  COMP-3 VALUE +0.  00930301
               10  PDT-RCPT-RTL-AMT    PIC S9(09)V99  COMP-3 VALUE +0.  00930401
               10  PDT-SHNK-RTL-AMT    PIC S9(09)V99  COMP-3 VALUE +0.  00930501
               10  PDT-END-INV-RTL-AMT PIC S9(09)V99  COMP-3 VALUE +0.  00930601
21517          10  PDT-PADJ-RTL-AMT    PIC S9(09)V99  COMP-3 VALUE +0.  00930715
                                                                        00930813
                                                                        00930913
       01  PS-PROGRAM-SWITCHES.                                         00931013
           05  PS-END-OF-DPT-PLN-FILE-SW    PIC X     VALUE 'N'.        00931113
               88  PS-END-OF-DPT-PLN-FILE             VALUE 'Y'.        00932009
                                                                        00933009
           05  PS-DATE-FOUND-SW             PIC X     VALUE 'N'.        00934009
               88  PS-DATE-FOUND                      VALUE 'Y'.        00935009
               88  PS-DATE-NOT-FOUND                  VALUE 'N'.        00936009
                                                                        00937009
           05  PS-END-OF-FSCL-WK-CSR-SW     PIC X      VALUE 'N'.       00938009
               88  PS-END-OF-FSCL-WK-CSR               VALUE 'Y'.       00939009
               88  PS-NOT-END-OF-FSCL-WK-CSR           VALUE 'N'.       00940009
                                                                        00950009
       01  PV-PROGRAM-VARIABLES.                                        00960009
           05  PV-DEL-ID1              PIC X          VALUE ','.        00970009
           05  PV-DEL-ID2              PIC X          VALUE '_'.        00980009
           05  PV-UNSTR-PTR            PIC S9(04)     COMP SYNC         00990009
                                                      VALUE ZERO.       01000009
           05  PV-PARAGRAPH-NAME       PIC X(30)      VALUE SPACE.      01010009
           05  PV-DB2-OPER-ATTEMPTED   PIC X(30)      VALUE SPACE.      01020009
           05  PV-PGM-NAME             PIC X(08)      VALUE 'MLKUT437'. 01030009
           05  PV-ABEND-CODE           PIC S9(04)     COMP SYNC         01040009
                                                      VALUE ZERO.       01050009
           05  PV-PREV-DEPT-NBR        PIC X(03).                       01060009
31355      05  PV-PREV-STORE-TYPE      PIC X(07)      VALUE SPACE.      01061025
31355          88 TOTAL-ALL-COMPANY                   VALUE 'TOTALCO'.  01062025
31355          88 E-STORE                             VALUE 'VIRTSTR'.  01063025
31355          88 PHYSICAL-STORE                      VALUE 'PHYSSTR'.  01064025
           05  PV-AMT                  PIC S9(09)V9(06).                01070009
                                                                        01080009
                                                                        01090009
       01  SS-SUBSCRIPTS.                                               01100009
           05  SS-WEEK                 PIC S9(04)     COMP SYNC         01110009
                                                      VALUE +0.         01120009
           05  SS-WEEK-MAX             PIC S9(04)     COMP SYNC         01130009
                                                      VALUE +0.         01140009
       01  US-UNSTRING-AREA.                                            01150009
           05  US-DEPT-NBR-6-CHAR.                                      01160009
               10  FILLER              PIC X(03).                       01170009
               10  US-DEPT-NBR         PIC X(03).                       01180009
99999      05  US-TOTAL-COMPANY        PIC X(04)      VALUE SPACE.      01190011
99999      05  US-STORE-TYPE           PIC X(07)      VALUE SPACE.      01210011
21517      05  US-REC-TYPE             PIC X(06)      VALUE SPACE.      01250019
           05  US-DATA-TYPE            PIC X(03)      VALUE SPACE.      01260009
           05  US-RTL-CST              PIC X(03)      VALUE SPACE.      01270009
           05  US-WEEKLY-AMT           OCCURS 27                        01280009
                                       PIC S9(09)V9(04) VALUE ZERO.     01290009
                                                                        01300009
      *************************************************************     01310009
      * INPUT AREA FOR DEPARTMENT PLANNING RECORD                 *     01320009
      *************************************************************     01330009
       01  PV-DPT-PLN-REC              PIC X(400).                      01340009
                                                                        01350009
      *************************************************************     01360009
      * COPYBOOK FOR OUTPUT WEEKLY PLANNING EXTRACT RECORD.       *     01370009
      *************************************************************     01380009
31355      COPY MLRD126.                                                01390020
                                                                        01400009
      *************************************************************     01410009
      * COPYBOOK FOR THE MERCHANISE PLANNING CONTROL CARD         *     01420009
      *************************************************************     01430009
           COPY BPRD045.                                                01440009
                                                                        01450009
      *************************************************************     01460009
      * COPYBOOK FOR CALENDAR ROUTINE                             *     01470009
      *************************************************************     01480009
           COPY DPWS500.                                                01490009
                                                                        01500009
      *************************************************************     01510009
      * COPYBOOK FOR NUMERIC EDIT ROUTINE                         *     01520009
      *************************************************************     01530009
           COPY DPWS010I.                                               01540009
                                                                        01550009
      *************************************************************     01560009
      *  DATE ATTRIBUTE TABLE                                     *     01570009
      *************************************************************     01580009
           EXEC SQL                                                     01590009
               INCLUDE TDTATTR                                          01600009
           END-EXEC.                                                    01610009
                                                                        01620009
      *************************************************************     01630009
      * DB2 ERROR MESSAGE AREA                                    *     01640009
      *************************************************************     01650009
           COPY DPWS004.                                                01660009
                                                                        01670009
      *************************************************************     01680009
      * DB2 COMMUNICATION AREA                                    *     01690009
      *************************************************************     01700009
           EXEC SQL                                                     01710009
               INCLUDE SQLCA                                            01720009
           END-EXEC.                                                    01730009
                                                                        01740009
      ****************************************************************  01750009
      * FISCAL WEEK CURSOR                                              01760009
      *                                                                 01770009
      * THIS CURSOR WILL RETURN THE FISCAL WEEK END DATE AND FISCAL     01780009
      * WEEK NUMBER FOR EACH WEEK IN THE SEASON.                        01790009
      ****************************************************************  01800009
                                                                        01810009
           EXEC SQL                                                     01820009
              DECLARE FSCL-WK-CSR CURSOR FOR                            01830009
                  SELECT                                                01840009
                      FSCL_WK_NBR                                       01850009
                     ,FSCL_WK_END_DTE                                   01860009
                  FROM                                                  01870009
                      TDTATTR                                           01880009
                  WHERE SEA_BEG_DTE = :DTATTR-KY-DTE                    01890009
                    AND KY_DTE      = FSCL_WK_END_DTE                   01900009
                  FOR FETCH ONLY                                        01910009
           END-EXEC.                                                    01920009
                                                                        01930009
       EJECT                                                            01940009
                                                                        01950009
       PROCEDURE DIVISION.                                              01960009
                                                                        01970009
       1000-MAINLINE.                                                   01980009
                                                                        01990009
           PERFORM 1100-INITIALIZATION.                                 02000009
                                                                        02010009
           PERFORM 7000-READ-DPT-PLN-FILE.                              02020009
                                                                        02030009
           IF NOT PS-END-OF-DPT-PLN-FILE                                02040009
               PERFORM 2100-UNSTRING-DPT-PLN-REC                        02050009
               MOVE US-DEPT-NBR  TO PV-PREV-DEPT-NBR                    02060009
31355          MOVE US-STORE-TYPE TO PV-PREV-STORE-TYPE                 02061025
               PERFORM 2000-PROCESS-DEPT-DATA                           02070009
                   UNTIL PS-END-OF-DPT-PLN-FILE                         02080009
               PERFORM 2300-BUILD-AND-WRITE-EXTRACT                     02090009
           ELSE                                                         02100035
C71482*        DISPLAY '** ABEND **'                                    02110036
               DISPLAY '** PROGRAM ' PV-PGM-NAME ' **'                  02120009
               DISPLAY '** PARAGRAPH 1000-MAINLINE  **'                 02130009
               DISPLAY '** THE INPUT DEPARTMENT PLAN FILE WAS EMPTY.'   02140009
C71482*        MOVE +4008 TO PV-ABEND-CODE                              02150036
C71482*        PERFORM 9999-ABEND                                       02160036
           END-IF.                                                      02170009
                                                                        02180009
           CLOSE DPT-PLN-FILE                                           02190009
                 WEEKLY-PLN-EXTRACT-FILE.                               02200009
                                                                        02210009
           STOP RUN.                                                    02220009
                                                                        02230009
       1100-INITIALIZATION.                                             02240009
                                                                        02250009
           ACCEPT BP045-REC.                                            02260009
                                                                        02270009
********** DISPLAY PV-PGM-NAME ' CONTROL CARD: ' BP045-REC.             02280028
                                                                        02290009
      *    MAKE SURE THE LAST RUN OF BPK930 WAS IN TY MODE.             02300009
           IF NOT BP045-TY-RUN-MODE                                     02310009
               DISPLAY '** ABEND **'                                    02320009
               DISPLAY '** PROGRAM ' PV-PGM-NAME ' **'                  02330009
               DISPLAY '** PARAGRAPH 1100-INITIALIZATION  **'           02340009
               DISPLAY '** INVALID RUN MODE ON CONTROL CARD.'           02350009
               DISPLAY '** EXPECTING TY.'                               02360009
               DISPLAY '** CONTROL CARD RUN MODE = ' BP045-RUN-MODE     02370009
               MOVE +4003 TO PV-ABEND-CODE                              02380009
               PERFORM 9999-ABEND                                       02390009
           END-IF.                                                      02400009
                                                                        02410009
      *    CALL THE CALENDAR ROUTINE TO CONVERT THE SEASON BEGIN DATE   02420009
      *    ON THE CONTROL CARD TO DB2 ISO FORMAT.                       02430009
           MOVE BP045-SEASON-START-DATE  TO DPG52-LK-DATE-INPUT.        02440009
           SET DPG51-FISCAL-454-CALENDAR TO TRUE.                       02450009
           SET DPG52-LK-DTE-ISO          TO TRUE                        02460009
                                                                        02470009
           CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52          02480009
                                                   DPG53 DPG54          02490009
                                                   DPG55 DPG56          02500009
           IF DPG54-SEVERE-ERROR                                        02510009
               DISPLAY '** ABEND **'                                    02520009
               DISPLAY '** PROGRAM ' PV-PGM-NAME ' **'                  02530009
               DISPLAY '** PARAGRAPH 1100-INITIALIZATION **'            02540009
               IF DPG54-DATE-INVALID                                    02550009
                   DISPLAY                                              02560009
                       '** INVALID SEASON START DATE ON CONTROL CARD.'  02570009
                   DISPLAY                                              02580009
                       '** EXPECTING CCYYMMDD DATE FORMAT.'             02590009
                   DISPLAY                                              02600009
                       '** SEASON START DATE ON CONTROL CARD: '         02610009
                           BP045-SEASON-START-DATE                      02620009
                   MOVE +4003 TO PV-ABEND-CODE                          02630009
               ELSE                                                     02640009
                   DISPLAY 'ERROR CALLING CALENDAR ROUTINE: '           02650009
                            DPG54-ERROR-MESSAGE                         02660009
                   MOVE +4019 TO PV-ABEND-CODE                          02670009
               END-IF                                                   02680009
               PERFORM 9999-ABEND                                       02690009
           END-IF.                                                      02700009
                                                                        02710009
      *    MAKE SURE THE SEASON BEGIN DATE ON THE CONTROL CARD IS A     02720009
      *    VALID SEASON BEGIN DATE.                                     02730009
           MOVE  DPG55-DB2-ISO-DATE-FMT TO DTATTR-KY-DTE.               02740009
                                                                        02750009
           PERFORM  8000-GET-DATE-ATTRIBUTES.                           02760009
           IF PS-DATE-NOT-FOUND                                         02770009
               DISPLAY '** ABEND **'                                    02780009
               DISPLAY '** PROGRAM ' PV-PGM-NAME ' **'                  02790009
               DISPLAY '** PARAGRAPH 1100-INITIALIZATION **'            02800009
               DISPLAY '** SEASON START DATE ON CONTROL CARD NOT'       02810009
               DISPLAY '** FOUND ON TDTATTR.'                           02820009
               DISPLAY '** SEASON START DATE: ' BP045-SEASON-START-DATE 02830009
               MOVE +4003 TO PV-ABEND-CODE                              02840009
               PERFORM 9999-ABEND                                       02850009
           END-IF.                                                      02860009
                                                                        02870009
           IF DTATTR-KY-DTE NOT = DTATTR-SEA-BEG-DTE                    02880009
               DISPLAY '** ABEND **'                                    02890009
               DISPLAY '** PROGRAM ' PV-PGM-NAME ' **'                  02900009
               DISPLAY '** PARAGRAPH 1100-INITIALIZATION **'            02910009
               DISPLAY '** SEASON START DATE ON CONTROL CARD IS '       02920009
               DISPLAY '** NOT AN ACTUAL SEASON BEGIN DATE.'            02930009
               DISPLAY '** SEASON START DATE ON CONTROL CARD: '         02940009
                        BP045-SEASON-START-DATE                         02950009
               MOVE +4003 TO PV-ABEND-CODE                              02960009
               PERFORM 9999-ABEND                                       02970009
           END-IF.                                                      02980009
                                                                        02990009
      *    GET THE FISCAL-WEEK-END-DATE AND FISCAL-WEEK-NUMBER FOR      03000009
      *    EACH WEEK IN THE SEASON.                                     03010009
           PERFORM 8500-OPEN-FSCL-WK-CSR.                               03020009
                                                                        03030009
           PERFORM 8600-FETCH-FSCL-WK-CSR.                              03040009
                                                                        03050009
           PERFORM 1200-TABLE-WKS-IN-SEASON                             03060009
               UNTIL PS-END-OF-FSCL-WK-CSR.                             03070009
                                                                        03080009
           PERFORM 8700-CLOSE-FSCL-WK-CSR.                              03090009
                                                                        03100009
           MOVE SS-WEEK TO SS-WEEK-MAX.                                 03110009
                                                                        03120009
      *    OPEN THE FILES.                                              03130009
           OPEN INPUT  DPT-PLN-FILE                                     03140009
                OUTPUT WEEKLY-PLN-EXTRACT-FILE.                         03150009
                                                                        03160009
                                                                        03170009
       1200-TABLE-WKS-IN-SEASON.                                        03180009
                                                                        03190009
           COMPUTE SS-WEEK = SS-WEEK + 1.                               03200009
                                                                        03210009
           MOVE DTATTR-FSCL-WK-END-DTE TO FWT-FSCL-WK-END-DTE (SS-WEEK).03220009
           MOVE DTATTR-FSCL-WK-NBR     TO FWT-FSCL-WK-NBR     (SS-WEEK).03230009
                                                                        03240009
           PERFORM 8600-FETCH-FSCL-WK-CSR.                              03250009
                                                                        03260009
                                                                        03270009
       2000-PROCESS-DEPT-DATA.                                          03280009
                                                                        03290009
31355 **** IF US-DEPT-NBR NOT = PV-PREV-DEPT-NBR                        03300025
31355      IF US-DEPT-NBR NOT = PV-PREV-DEPT-NBR OR                     03301025
31355         US-STORE-TYPE NOT = PV-PREV-STORE-TYPE                    03302025
               PERFORM 2300-BUILD-AND-WRITE-EXTRACT                     03310009
               INITIALIZE PDT-PLAN-DATA-TABLE                           03320009
               MOVE US-DEPT-NBR   TO PV-PREV-DEPT-NBR                   03330009
31355          MOVE US-STORE-TYPE TO PV-PREV-STORE-TYPE                 03331025
           END-IF.                                                      03340009
                                                                        03350009
           PERFORM 2200-LOAD-DATA-INTO-TABLE.                           03360009
                                                                        03370009
           PERFORM 7000-READ-DPT-PLN-FILE.                              03380009
                                                                        03390009
           IF NOT PS-END-OF-DPT-PLN-FILE                                03400009
               PERFORM 2100-UNSTRING-DPT-PLN-REC                        03410009
           END-IF.                                                      03420009
                                                                        03430009
                                                                        03440009
      ******************************************************************03450009
      *  THE INPUT RECORDS ARE NOT IN A FIXED FORMAT.  THE FIELDS ARE   03460009
      *  DELIMITED BY COMMAS AND THE NUMERIC FIELDS ARE IN A CHARACTER  03470009
      *  FORMAT.  THIS PARAGRAPH UNSTRINGS THE DATA AND CONVERTS THE    03480009
      *  RETAIL AMOUNTS INTO A NUMERIC FORMAT.                          03490009
      ******************************************************************03500009
       2100-UNSTRING-DPT-PLN-REC.                                       03510009
                                                                        03520009
      *     UNSTRING THE DEPARTMENT NUMBER.                             03530009
            MOVE +1       TO PV-UNSTR-PTR                               03540009
            UNSTRING PV-DPT-PLN-REC                                     03550009
                DELIMITED BY PV-DEL-ID1                                 03560009
                          OR PV-DEL-ID2                                 03570009
                INTO         US-DEPT-NBR-6-CHAR                         03580009
                POINTER      PV-UNSTR-PTR                               03590009
            END-UNSTRING.                                               03600009
99999 *     UNSTRING THE TOTALS BY COMPANY.                             03610011
  |         UNSTRING PV-DPT-PLN-REC                                     03620009
  |             DELIMITED BY PV-DEL-ID1                                 03630009
  |                       OR PV-DEL-ID2                                 03640009
  |             INTO         US-TOTAL-COMPANY                           03650009
  |             POINTER      PV-UNSTR-PTR                               03660009
  |         END-UNSTRING.                                               03670009
  |   *     UNSTRING THE STORE TYPE.                                    03680009
  |         UNSTRING PV-DPT-PLN-REC                                     03690009
  |             DELIMITED BY PV-DEL-ID1                                 03700009
  |                       OR PV-DEL-ID2                                 03710009
  |             INTO         US-STORE-TYPE                              03720009
  |             POINTER      PV-UNSTR-PTR                               03730009
99999       END-UNSTRING.                                               03740011
      *     UNSTRING THE RECORD TYPE.                                   03750009
            UNSTRING PV-DPT-PLN-REC                                     03760009
                DELIMITED BY PV-DEL-ID1                                 03770009
                          OR PV-DEL-ID2                                 03780009
                INTO         US-REC-TYPE                                03790009
                POINTER      PV-UNSTR-PTR                               03800009
            END-UNSTRING.                                               03810009
W04031*     UNSTRING THE RTL/CST INDICATOR.                             03811033
W04031      UNSTRING PV-DPT-PLN-REC                                     03812033
W04031          DELIMITED BY PV-DEL-ID1                                 03813033
W04031                    OR PV-DEL-ID2                                 03814033
W04031          INTO         US-RTL-CST                                 03815033
W04031          POINTER      PV-UNSTR-PTR                               03816033
W04031      END-UNSTRING.                                               03817033
      *     UNSTRING THE DATA TYPE.                                     03820009
            UNSTRING PV-DPT-PLN-REC                                     03830009
                DELIMITED BY PV-DEL-ID1                                 03840009
                          OR PV-DEL-ID2                                 03850009
                INTO         US-DATA-TYPE                               03860009
                POINTER      PV-UNSTR-PTR                               03870009
            END-UNSTRING.                                               03880009
W04031***   UNSTRING THE RTL/CST INDICATOR.                             03890033
W04031***   UNSTRING PV-DPT-PLN-REC                                     03900033
W04031***       DELIMITED BY PV-DEL-ID1                                 03910033
W04031***                 OR PV-DEL-ID2                                 03920033
W04031***       INTO         US-RTL-CST                                 03930033
W04031***       POINTER      PV-UNSTR-PTR                               03940033
W04031***   END-UNSTRING.                                               03950033
      *     UNSTRING THE WEEKLY AMT FIELDS AND CONVERT THEM TO NUMERIC  03960009
      *     VALUES.                                                     03970009
            PERFORM VARYING SS-WEEK FROM 1 BY 1                         03980009
              UNTIL SS-WEEK > SS-WEEK-MAX                               03990009
                                                                        04000009
               MOVE SPACE TO DP010I-UNEDITED-FIELD                      04010009
               UNSTRING PV-DPT-PLN-REC                                  04020009
                   DELIMITED BY PV-DEL-ID1                              04030009
                             OR PV-DEL-ID2                              04040009
                   INTO         DP010I-UNEDITED-FIELD                   04050009
                   POINTER      PV-UNSTR-PTR                            04060009
               END-UNSTRING                                             04070009
               MOVE 12          TO DP010I-MAXIMUM-DIGITS                04080009
               MOVE 4           TO DP010I-MAXIMUM-DECIMALS              04090009
               SET DP010I-NEGATIVE-ALLOWED TO TRUE                      04100009
                                                                        04110009
               PERFORM 2150-NUMERIC-CONVERSION                          04120009
                                                                        04130009
               MOVE DP010I-NUMERIC-FIELD TO PV-AMT                      04140009
               COMPUTE US-WEEKLY-AMT(SS-WEEK) = PV-AMT * 100            04150009
           END-PERFORM.                                                 04160009
                                                                        04170009
                                                                        04180009
       2150-NUMERIC-CONVERSION.                                         04190009
                                                                        04200009
           CALL DP010I-NUMERIC-EDIT-ROUTINE USING                       04210009
                                            DP010I-NUMERIC-EDIT-AREA.   04220009
                                                                        04230009
           IF DP010I-NO-ERROR-DETECTED                                  04240009
               NEXT SENTENCE                                            04250009
           ELSE                                                         04260009
               IF DP010I-INVALID-CHARACTER                              04270009
                   MOVE ZEROES TO DP010I-NUMERIC-FIELD                  04280009
               ELSE                                                     04290009
                   DISPLAY '** ABEND **'                                04300009
                   DISPLAY '** PROGRAM ' PV-PGM-NAME ' **'              04310009
                   DISPLAY '** PARAGRAPH 2150-NUMERIC-CONVERSION **'    04320009
                   DISPLAY '** ERROR IN CALLED NUMERIC EDIT ROUTINE.'   04330009
                   DISPLAY '** ERROR INDICATOR = ' DP010I-ERROR-IND     04340009
                   DISPLAY '** INPUT RECORD = ' PV-DPT-PLN-REC          04350009
                   MOVE +4008 TO PV-ABEND-CODE                          04360009
                   PERFORM 9999-ABEND                                   04370009
               END-IF                                                   04380009
           END-IF.                                                      04390009
                                                                        04400009
                                                                        04410009
      ******************************************************************04420009
      *  THIS PARAGRAPH EVALUATES THE 'UNSTRUNG' INPUT DATA TO DETERMINE04430009
      *  WHAT TYPE OF RECORD IS BEING PROCESSED.  IF THE RECORD IS ONE  04440009
      *  OF THE TYPES THAT SHOULD BE EXTRACTED, THE RETAIL AMOUNTS      04450009
      *  ARE LOADED BY WEEK INTO A WORKING STORAGE TABLE.               04460009
      ******************************************************************04470009
       2200-LOAD-DATA-INTO-TABLE.                                       04480009
                                                                        04490009
99999      EVALUATE US-TOTAL-COMPANY                                    04500011
99999        WHEN 'TOT1'                                                04510011
                                                                        04510124
31355 *** COMPANY TOTALS UNSTRING....                                   04511024
99999      EVALUATE US-STORE-TYPE                                       04520024
99999        WHEN 'TOTALCO'                                             04530024
           EVALUATE US-DATA-TYPE                                        04540009
             WHEN 'AP'                                                  04550009
               EVALUATE US-RTL-CST                                      04560009
99999            WHEN 'DLR'                                             04571030
                   EVALUATE US-REC-TYPE                                 04580009
99999                WHEN 'EOP'                                         04590011
                         PERFORM VARYING SS-WEEK FROM 1 BY 1            04600009
                           UNTIL SS-WEEK > SS-WEEK-MAX                  04610009
                             MOVE US-WEEKLY-AMT       (SS-WEEK)         04620009
                               TO PDT-END-INV-RTL-AMT (SS-WEEK)         04630009
                         END-PERFORM                                    04640009
W04031               WHEN 'GREC'                                        04650032
                         PERFORM VARYING SS-WEEK FROM 1 BY 1            04660009
                           UNTIL SS-WEEK > SS-WEEK-MAX                  04670009
                             MOVE US-WEEKLY-AMT    (SS-WEEK)            04680009
                               TO PDT-RCPT-RTL-AMT (SS-WEEK)            04690009
                         END-PERFORM                                    04700009
                     WHEN 'SLS'                                         04710009
                         PERFORM VARYING SS-WEEK FROM 1 BY 1            04720009
                           UNTIL SS-WEEK > SS-WEEK-MAX                  04730009
                             MOVE US-WEEKLY-AMT   (SS-WEEK)             04740009
                               TO PDT-SLS-RTL-AMT (SS-WEEK)             04750009
                         END-PERFORM                                    04760009
                     WHEN 'TMKD'                                        04770009
                         PERFORM VARYING SS-WEEK FROM 1 BY 1            04780009
                           UNTIL SS-WEEK > SS-WEEK-MAX                  04790009
                             MOVE US-WEEKLY-AMT   (SS-WEEK)             04800009
                               TO PDT-MKDN-RTL-AMT (SS-WEEK)            04810009
                         END-PERFORM                                    04820009
                     WHEN 'SHR'                                         04830009
                         PERFORM VARYING SS-WEEK FROM 1 BY 1            04840009
                           UNTIL SS-WEEK > SS-WEEK-MAX                  04850009
                             MOVE US-WEEKLY-AMT   (SS-WEEK)             04860009
                               TO PDT-SHNK-RTL-AMT (SS-WEEK)            04870009
                         END-PERFORM                                    04880009
W04031               WHEN 'RECADJ'                                      04881032
21517                    PERFORM VARYING SS-WEEK FROM 1 BY 1            04882013
21517                      UNTIL SS-WEEK > SS-WEEK-MAX                  04883013
21517                        MOVE US-WEEKLY-AMT   (SS-WEEK)             04884013
21517                          TO PDT-PADJ-RTL-AMT (SS-WEEK)            04885014
21517                    END-PERFORM                                    04886013
                   END-EVALUATE                                         04890009
               END-EVALUATE                                             04900009
           END-EVALUATE                                                 04910009
31355                                                                   04910224
  |   *** PHYSICAL STORE UNSTRING....                                   04910324
  |        WHEN 'PHYSSTR'                                               04911024
  |                                                                     04911124
  |        EVALUATE US-DATA-TYPE                                        04912024
  |          WHEN 'AP'                                                  04913024
  |            EVALUATE US-RTL-CST                                      04914024
  |              WHEN 'DLR'                                             04915024
  |                EVALUATE US-REC-TYPE                                 04916024
  |                  WHEN 'EOP'                                         04917024
  |                      PERFORM VARYING SS-WEEK FROM 1 BY 1            04918024
  |                        UNTIL SS-WEEK > SS-WEEK-MAX                  04919024
  |                          MOVE US-WEEKLY-AMT       (SS-WEEK)         04919124
  |                            TO PDT-END-INV-RTL-AMT (SS-WEEK)         04919224
  |                      END-PERFORM                                    04919324
W04031               WHEN 'GREC'                                        04919432
  |                      PERFORM VARYING SS-WEEK FROM 1 BY 1            04919524
  |                        UNTIL SS-WEEK > SS-WEEK-MAX                  04919624
  |                          MOVE US-WEEKLY-AMT    (SS-WEEK)            04919724
  |                            TO PDT-RCPT-RTL-AMT (SS-WEEK)            04919824
  |                      END-PERFORM                                    04919924
  |                  WHEN 'SLS'                                         04920024
  |                      PERFORM VARYING SS-WEEK FROM 1 BY 1            04920124
  |                        UNTIL SS-WEEK > SS-WEEK-MAX                  04920224
  |                          MOVE US-WEEKLY-AMT   (SS-WEEK)             04920324
  |                            TO PDT-SLS-RTL-AMT (SS-WEEK)             04920424
  |                      END-PERFORM                                    04920524
  |                  WHEN 'TMKD'                                        04920624
  |                      PERFORM VARYING SS-WEEK FROM 1 BY 1            04920724
  |                        UNTIL SS-WEEK > SS-WEEK-MAX                  04920824
  |                          MOVE US-WEEKLY-AMT   (SS-WEEK)             04920924
  |                            TO PDT-MKDN-RTL-AMT (SS-WEEK)            04921024
  |                      END-PERFORM                                    04921124
  |                  WHEN 'SHR'                                         04921224
  |                      PERFORM VARYING SS-WEEK FROM 1 BY 1            04921324
  |                        UNTIL SS-WEEK > SS-WEEK-MAX                  04921424
  |                          MOVE US-WEEKLY-AMT   (SS-WEEK)             04921524
  |                            TO PDT-SHNK-RTL-AMT (SS-WEEK)            04921624
31355                    END-PERFORM                                    04921724
W04031               WHEN 'RECADJ'                                      04921832
21517                    PERFORM VARYING SS-WEEK FROM 1 BY 1            04921924
21517                      UNTIL SS-WEEK > SS-WEEK-MAX                  04922024
21517                        MOVE US-WEEKLY-AMT   (SS-WEEK)             04922124
21517                          TO PDT-PADJ-RTL-AMT (SS-WEEK)            04922224
21517                    END-PERFORM                                    04922324
31355              END-EVALUATE                                         04922424
  |            END-EVALUATE                                             04922524
  |        END-EVALUATE                                                 04922624
  |                                                                     04922824
  |   *** VIRTUAL STORE UNSTRING....                                    04922924
  |        WHEN 'VIRTSTR'                                               04923124
  |                                                                     04923224
  |        EVALUATE US-DATA-TYPE                                        04923324
  |          WHEN 'AP'                                                  04923424
  |            EVALUATE US-RTL-CST                                      04923524
  |              WHEN 'DLR'                                             04923624
  |                EVALUATE US-REC-TYPE                                 04923724
  |                  WHEN 'EOP'                                         04923824
  |                      PERFORM VARYING SS-WEEK FROM 1 BY 1            04923924
  |                        UNTIL SS-WEEK > SS-WEEK-MAX                  04924024
  |                          MOVE US-WEEKLY-AMT       (SS-WEEK)         04924124
  |                            TO PDT-END-INV-RTL-AMT (SS-WEEK)         04924224
  |                      END-PERFORM                                    04924324
W04031               WHEN 'GREC'                                        04924432
  |                      PERFORM VARYING SS-WEEK FROM 1 BY 1            04924524
  |                        UNTIL SS-WEEK > SS-WEEK-MAX                  04924624
  |                          MOVE US-WEEKLY-AMT    (SS-WEEK)            04924724
  |                            TO PDT-RCPT-RTL-AMT (SS-WEEK)            04924824
  |                      END-PERFORM                                    04924924
  |                  WHEN 'SLS'                                         04925024
  |                      PERFORM VARYING SS-WEEK FROM 1 BY 1            04925124
  |                        UNTIL SS-WEEK > SS-WEEK-MAX                  04925224
  |                          MOVE US-WEEKLY-AMT   (SS-WEEK)             04925324
  |                            TO PDT-SLS-RTL-AMT (SS-WEEK)             04925424
  |                      END-PERFORM                                    04925524
  |                  WHEN 'TMKD'                                        04925624
  |                      PERFORM VARYING SS-WEEK FROM 1 BY 1            04925724
  |                        UNTIL SS-WEEK > SS-WEEK-MAX                  04925824
  |                          MOVE US-WEEKLY-AMT   (SS-WEEK)             04925924
  |                            TO PDT-MKDN-RTL-AMT (SS-WEEK)            04926024
  |                      END-PERFORM                                    04926124
  |                  WHEN 'SHR'                                         04926224
  |                      PERFORM VARYING SS-WEEK FROM 1 BY 1            04926324
  |                        UNTIL SS-WEEK > SS-WEEK-MAX                  04926424
  |                          MOVE US-WEEKLY-AMT   (SS-WEEK)             04926524
  |                            TO PDT-SHNK-RTL-AMT (SS-WEEK)            04926624
21517                    END-PERFORM                                    04926732
W04031               WHEN 'RECADJ'                                      04926832
21517                    PERFORM VARYING SS-WEEK FROM 1 BY 1            04926924
21517                      UNTIL SS-WEEK > SS-WEEK-MAX                  04927024
21517                        MOVE US-WEEKLY-AMT   (SS-WEEK)             04927124
21517                          TO PDT-PADJ-RTL-AMT (SS-WEEK)            04927224
21517                    END-PERFORM                                    04927324
31355              END-EVALUATE                                         04927424
31355          END-EVALUATE                                             04927524
31355      END-EVALUATE                                                 04927624
31355      END-EVALUATE                                                 04927827
31355                                                                   04927929
99999      END-EVALUATE.                                                04930011
                                                                        04950009
      ******************************************************************04960009
      *  THIS PARAGRAPH USES THE DATA THAT WAS TABLED FOR THE           04970009
      *  DEPARTMENT TO BUILD AND WRITE ONE OUTPUT RECORD FOR EACH WEEK  04980009
      *  IN THE SEASON.                                                 04990009
      ******************************************************************05000009
       2300-BUILD-AND-WRITE-EXTRACT.                                    05010009
31355 *** BUILD THE PHYSICAL STORE RECORD....                           05011020
  |                                                                     05020020
  |        IF PV-PREV-STORE-TYPE IS EQUAL TO 'PHYSSTR'                  05020525
  |            MOVE PV-PREV-DEPT-NBR     TO ML126-DEPT-NBR              05020620
  |            MOVE 'P'                  TO ML126-CHNL-CDE              05020720
  |                                                                     05020820
  |            PERFORM VARYING SS-WEEK FROM 1 BY 1                      05023020
  |              UNTIL SS-WEEK > SS-WEEK-MAX                            05024020
  |                MOVE FWT-FSCL-WK-NBR       (SS-WEEK)                 05025020
  |                  TO ML126-FSCL-WK-NBR                               05026020
  |                MOVE FWT-FSCL-WK-END-DTE   (SS-WEEK)                 05027020
  |                  TO ML126-FSCL-WK-END-DTE                           05028020
  |                MOVE PDT-SLS-RTL-AMT       (SS-WEEK)                 05029020
  |                  TO ML126-SLS-RTL-AMT                               05029120
  |                MOVE PDT-MKDN-RTL-AMT      (SS-WEEK)                 05029220
  |                  TO ML126-MKDN-RTL-AMT                              05029320
  |                MOVE PDT-RCPT-RTL-AMT      (SS-WEEK)                 05029420
  |                  TO ML126-RCPT-RTL-AMT                              05029520
  |                MOVE PDT-SHNK-RTL-AMT      (SS-WEEK)                 05029620
  |                  TO ML126-SHNK-RTL-AMT                              05029720
  |                MOVE PDT-END-INV-RTL-AMT   (SS-WEEK)                 05029820
31355               TO ML126-END-INV-RTL-AMT                            05029920
21517              MOVE PDT-PADJ-RTL-AMT      (SS-WEEK)                 05030020
21517               TO ML126-PADJ-RTL-AMT                               05030120
31355              PERFORM  7100-WRITE-WEEKLY-PLN-EXTRACT               05030220
  |            END-PERFORM                                              05030320
  |        END-IF.                                                      05030420
  |                                                                     05030520
  |   *** BUILD THE VIRTUAL STORE RECORD....                            05030620
  |                                                                     05030720
  |        IF PV-PREV-STORE-TYPE IS EQUAL TO 'VIRTSTR'                  05030925
  |            MOVE PV-PREV-DEPT-NBR     TO ML126-DEPT-NBR              05031020
  |            MOVE 'V'                  TO ML126-CHNL-CDE              05031120
  |                                                                     05031220
  |            PERFORM VARYING SS-WEEK FROM 1 BY 1                      05031320
  |              UNTIL SS-WEEK > SS-WEEK-MAX                            05031420
  |                MOVE FWT-FSCL-WK-NBR       (SS-WEEK)                 05031520
  |                  TO ML126-FSCL-WK-NBR                               05031620
  |                MOVE FWT-FSCL-WK-END-DTE   (SS-WEEK)                 05031720
  |                  TO ML126-FSCL-WK-END-DTE                           05031820
  |                MOVE PDT-SLS-RTL-AMT       (SS-WEEK)                 05031920
  |                  TO ML126-SLS-RTL-AMT                               05032020
  |                MOVE PDT-MKDN-RTL-AMT      (SS-WEEK)                 05032120
  |                  TO ML126-MKDN-RTL-AMT                              05032220
  |                MOVE PDT-RCPT-RTL-AMT      (SS-WEEK)                 05032320
  |                  TO ML126-RCPT-RTL-AMT                              05032420
  |                MOVE PDT-SHNK-RTL-AMT      (SS-WEEK)                 05032520
  |                  TO ML126-SHNK-RTL-AMT                              05032620
  |                MOVE PDT-END-INV-RTL-AMT   (SS-WEEK)                 05032720
31355               TO ML126-END-INV-RTL-AMT                            05032820
21517              MOVE PDT-PADJ-RTL-AMT      (SS-WEEK)                 05032920
21517               TO ML126-PADJ-RTL-AMT                               05033020
31355              PERFORM  7100-WRITE-WEEKLY-PLN-EXTRACT               05033120
  |            END-PERFORM                                              05033220
  |        END-IF.                                                      05033320
  |                                                                     05033420
  |   *** BUILD THE TOTAL COMPANY RECORD......                          05033520
31355                                                                   05033620
  |        IF PV-PREV-STORE-TYPE IS EQUAL TO 'TOTALCO'                  05033725
  |            MOVE PV-PREV-DEPT-NBR     TO ML126-DEPT-NBR              05033825
  |            MOVE 'A'                  TO ML126-CHNL-CDE              05033925
  |                                                                     05034025
  |            PERFORM VARYING SS-WEEK FROM 1 BY 1                      05034125
  |              UNTIL SS-WEEK > SS-WEEK-MAX                            05034225
  |                MOVE FWT-FSCL-WK-NBR       (SS-WEEK)                 05034325
  |                  TO ML126-FSCL-WK-NBR                               05034425
  |                MOVE FWT-FSCL-WK-END-DTE   (SS-WEEK)                 05034525
  |                  TO ML126-FSCL-WK-END-DTE                           05034625
  |                MOVE PDT-SLS-RTL-AMT       (SS-WEEK)                 05034725
  |                  TO ML126-SLS-RTL-AMT                               05034825
  |                MOVE PDT-MKDN-RTL-AMT      (SS-WEEK)                 05034925
  |                  TO ML126-MKDN-RTL-AMT                              05035025
  |                MOVE PDT-RCPT-RTL-AMT      (SS-WEEK)                 05035125
  |                  TO ML126-RCPT-RTL-AMT                              05035225
  |                MOVE PDT-SHNK-RTL-AMT      (SS-WEEK)                 05035325
  |                  TO ML126-SHNK-RTL-AMT                              05035425
  |                MOVE PDT-END-INV-RTL-AMT   (SS-WEEK)                 05035525
31355               TO ML126-END-INV-RTL-AMT                            05035625
21517              MOVE PDT-PADJ-RTL-AMT      (SS-WEEK)                 05035725
21517               TO ML126-PADJ-RTL-AMT                               05035825
31355              PERFORM  7100-WRITE-WEEKLY-PLN-EXTRACT               05035925
  |            END-PERFORM                                              05036025
  |        END-IF.                                                      05036125
31355                                                                   05036225
                                                                        05240009
       7000-READ-DPT-PLN-FILE.                                          05250009
                                                                        05260009
           READ DPT-PLN-FILE                                            05270009
               INTO PV-DPT-PLN-REC                                      05280009
                   AT END SET PS-END-OF-DPT-PLN-FILE TO TRUE.           05290009
                                                                        05300009
                                                                        05310009
       7100-WRITE-WEEKLY-PLN-EXTRACT.                                   05320009
                                                                        05330009
           WRITE WEEKLY-PLN-EXTRACT-REC  FROM                           05340009
                 ML126-WEEKLY-PLN-EXTRACT-REC.                          05350009
                                                                        05360009
                                                                        05370009
       8000-GET-DATE-ATTRIBUTES.                                        05380009
                                                                        05390009
           EXEC SQL                                                     05400009
                SELECT                                                  05410009
                    SEA_BEG_DTE                                         05420009
                INTO                                                    05430009
                    :DTATTR-SEA-BEG-DTE                                 05440009
                FROM                                                    05450009
                    TDTATTR                                             05460009
                WHERE                                                   05470009
                    KY_DTE = :DTATTR-KY-DTE                             05480009
           END-EXEC.                                                    05490009
                                                                        05500009
           EVALUATE TRUE                                                05510009
               WHEN SQLCODE = ZERO                                      05520009
                   SET PS-DATE-FOUND     TO TRUE                        05530009
               WHEN SQLCODE = +100                                      05540009
                   SET PS-DATE-NOT-FOUND TO TRUE                        05550009
               WHEN OTHER                                               05560009
                   DISPLAY '** DTATTR-KY-DTE: ' DTATTR-KY-DTE           05570009
                   MOVE    '8000-GET-DATE-ATTRIBUTES'                   05580009
                                                TO PV-PARAGRAPH-NAME    05590009
                   MOVE    'SELECT ROW FROM TDTATTR'                    05600009
                                                TO PV-DB2-OPER-ATTEMPTED05610009
                   PERFORM 9998-SQL-ABEND                               05620009
           END-EVALUATE.                                                05630009
                                                                        05640009
                                                                        05650009
       8500-OPEN-FSCL-WK-CSR.                                           05660009
                                                                        05670009
           EXEC SQL                                                     05680009
                OPEN FSCL-WK-CSR                                        05690009
           END-EXEC.                                                    05700009
                                                                        05710009
           EVALUATE TRUE                                                05720009
               WHEN SQLCODE = ZERO                                      05730009
                   CONTINUE                                             05740009
               WHEN OTHER                                               05750009
                   MOVE '8500-OPEN-FSCL-WK-CSR'                         05760009
                                            TO PV-PARAGRAPH-NAME        05770009
                   MOVE 'OPEN FSCL-WK-CSR'  TO PV-DB2-OPER-ATTEMPTED    05780009
                   PERFORM 9998-SQL-ABEND                               05790009
           END-EVALUATE.                                                05800009
                                                                        05810009
                                                                        05820009
      ******************************************************************05830009
      *  THIS PARAGRAPH RETRIEVES THE FISCAL-WEEK-END-DATE AND FISCAL-  05840009
      *  WEEK-NUMBER FOR ALL WEEKS IN THE SEASON.  THESE VALUES WILL    05850009
      *  USED TO BUILD THE OUTPUT RECORDS.                              05860009
      ******************************************************************05870009
       8600-FETCH-FSCL-WK-CSR.                                          05880009
                                                                        05890009
           EXEC SQL                                                     05900009
               FETCH                                                    05910009
                   FSCL-WK-CSR                                          05920009
               INTO                                                     05930009
                  :DTATTR-FSCL-WK-NBR                                   05940009
                 ,:DTATTR-FSCL-WK-END-DTE                               05950009
           END-EXEC.                                                    05960009
                                                                        05970009
           EVALUATE TRUE                                                05980009
               WHEN SQLCODE = ZERO                                      05990009
                   CONTINUE                                             06000009
               WHEN SQLCODE = +100                                      06010009
                   SET PS-END-OF-FSCL-WK-CSR TO TRUE                    06020009
               WHEN OTHER                                               06030009
                   MOVE '8600-FETCH-FSCL-WK-CSR' TO PV-PARAGRAPH-NAME   06040009
                   MOVE 'FETCH FSCL-WK-CSR'     TO PV-DB2-OPER-ATTEMPTED06050009
                   PERFORM 9998-SQL-ABEND                               06060009
           END-EVALUATE.                                                06070009
                                                                        06080009
                                                                        06090009
       8700-CLOSE-FSCL-WK-CSR.                                          06100009
                                                                        06110009
           EXEC SQL                                                     06120009
               CLOSE FSCL-WK-CSR                                        06130009
           END-EXEC.                                                    06140009
                                                                        06150009
           EVALUATE TRUE                                                06160009
               WHEN SQLCODE = ZERO                                      06170009
                   CONTINUE                                             06180009
               WHEN OTHER                                               06190009
                   MOVE '8700-CLOSE-FSCL-WK-CSR' TO PV-PARAGRAPH-NAME   06200009
                   MOVE 'CLOSE FSCL-WK-CSR'     TO PV-DB2-OPER-ATTEMPTED06210009
                   PERFORM 9998-SQL-ABEND                               06220009
           END-EVALUATE.                                                06230009
                                                                        06240009
                                                                        06250009
       9998-SQL-ABEND.                                                  06260009
                                                                        06270009
           MOVE +4013 TO PV-ABEND-CODE.                                 06280009
           DISPLAY ' '.                                                 06290009
           DISPLAY '** ABEND **         ** = SQLERROR'.                 06300009
           DISPLAY '** PROGRAM          ** = ' PV-PGM-NAME.             06310009
           DISPLAY '** PARAGRAPH        ** = ' PV-PARAGRAPH-NAME.       06320009
           DISPLAY '** OPERATION        ** = ' PV-DB2-OPER-ATTEMPTED.   06330009
      *    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE         06340009
      *    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.        06350009
           COPY DPPD004.                                                06360009
           PERFORM 9999-ABEND.                                          06370009
                                                                        06380009
                                                                        06390009
       9999-ABEND.                                                      06400009
                                                                        06410009
           CALL 'ILBOABN0'  USING PV-ABEND-CODE.                        06420009
