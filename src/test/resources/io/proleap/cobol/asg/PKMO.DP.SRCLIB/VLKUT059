000300 IDENTIFICATION DIVISION.                                         00030025
000500                                                                  00050048
000600 PROGRAM-ID.    VLKUT059.                                         00060025
000700 AUTHOR.        SAURABH DUDDALWAR.                                00070025
000800 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00080025
000900 DATE-WRITTEN.  06/11/2010.                                       00090025
001000 DATE-COMPILED.                                                   00100025
001100                                                                  00110048
001300*---------------------------------------------------------------* 00130025
001400*    THIS PROGRAM WILL CHECK THE EXTENDED CANCELLATION DATE FOR * 00140025
001500*    PURCHASE ORDER FROM TPLNSHP TABLE AND WILL MOVE TO THE     * 00150025
001600*    OUTPUT PURCHASE ORDER HEADER FILE.                         * 00160025
001700*                                                               * 00170025
001800*    THE PROGRAM WILL RECEIVE THE INPUT FILE FROM THE FTP VIA   * 00180025
001900*    JOB VLK021 AND WILL CREATE THE OUTPUT FILE WHICH CONTAINS  * 00190025
002000*    THE EXTENDED CANCELLATION DATE. THIS FILE WILL THEN SENT   * 00200025
002100*    TO PROGRAM VLKUT040.                                       * 00210025
002200*                                                                 00220034
002300*  01/03/2018 - JIM HUNTER - CHG0194891                           00230039
002400*  IF THE INPUT FILE CONTAINS A PARENT COMPANY OR FACTORY,        00240039
002500*  REPLACE THEM WITH THE IMPRT_VND_ID AND IMPRT_FCTRY_ID FROM     00250039
002600*  THE TPURCHS TABLE BEFORE WRITING THE OUTPUT FILE.              00260039
002700*                                                                 00270039
002800*---------------------------------------------------------------* 00280025
002900                                                                  00290048
003000 ENVIRONMENT DIVISION.                                            00300025
003100 INPUT-OUTPUT SECTION.                                            00310025
003200                                                                  00320048
003300 FILE-CONTROL.                                                    00330025
003400                                                                  00340048
003500     SELECT INPUT-PO-HEADER-FILE      ASSIGN TO INP01.            00350025
003600     SELECT OUTPUT-PO-HEADER-FILE     ASSIGN TO OUT01.            00360025
003610     SELECT OUTPUT-PO-RESEND-FILE     ASSIGN TO OUT02.            00361051
003700                                                                  00370048
003800 DATA DIVISION.                                                   00380025
003900                                                                  00390048
004000 FILE SECTION.                                                    00400025
004100                                                                  00410048
004200 FD  INPUT-PO-HEADER-FILE                                         00420025
004300     RECORDING MODE IS F                                          00430025
004400     LABEL RECORDS ARE STANDARD                                   00440025
004500     BLOCK CONTAINS 0 RECORDS.                                    00450025
004600                                                                  00460048
004900 01  INPUT-PO-HEADER-RECORD         PIC X(490).                   00490032
005100                                                                  00510048
005200 FD  OUTPUT-PO-HEADER-FILE                                        00520025
005300     RECORDING MODE IS F                                          00530025
005400     LABEL RECORDS ARE STANDARD                                   00540025
005500     BLOCK CONTAINS 0 RECORDS.                                    00550025
005600                                                                  00560025
005900 01  OUTPUT-PO-HEADER-RECORD          PIC X(498).                 00590032
006000                                                                  00600051
006010 FD  OUTPUT-PO-RESEND-FILE                                        00601051
006020     RECORDING MODE IS F                                          00602051
006030     LABEL RECORDS ARE STANDARD                                   00603051
006040     BLOCK CONTAINS 0 RECORDS.                                    00604051
006050                                                                  00605051
006060 01  OUTPUT-PO-RESEND-RECORD          PIC X(100).                 00606051
006100                                                                  00610048
006800 WORKING-STORAGE SECTION.                                         00680025
006810                                                                  00681051
006900 01 WS-PROGRAM-VARS.                                              00690025
007000    05 WS-INREC-COUNT                 PIC 9(09) VALUE ZEROES.     00700025
007100    05 WS-OUTREC-COUNT                PIC 9(09) VALUE ZEROES.     00710025
007101    05 WS-OUTREC-RESEND-COUNT         PIC 9(09) VALUE ZEROES.     00710151
007110    05 WS-NOT-ON-PO-COUNT             PIC 9(09) VALUE ZEROES.     00711048
007120    05 WS-NOT-ON-PLNSHP-COUNT         PIC 9(09) VALUE ZEROES.     00712048
007200    05 WS-PO-NBR                      PIC S9(09) COMP VALUE +0.   00720025
007300    05 WS-PO-NBR-N                    PIC 9(08)  VALUE ZEROES.    00730025
007400    05 WS-ID-NBR-N                    PIC 9(09)  VALUE ZEROES.    00740039
007500    05 WS-DATE                        PIC X(10)  VALUE SPACES.    00750025
007600    05 WS-DATE-8                      PIC X(08)  VALUE SPACES.    00760025
007610    05 WS-DISP-PO-NBR                 PIC 9(09)  VALUE ZEROES.    00761043
007700                                                                  00770048
007900 01  PS-PROGRAM-SWITCHES.                                         00790026
008000     05  PS-UNTIL-EXIT-LOOP-SW       PIC X(01) VALUE 'N'.         00800025
008100         88  PS-UNTIL-EXIT-LOOP-YES            VALUE 'Y'.         00810025
008200         88  PS-UNTIL-EXIT-LOOP-NO             VALUE 'N'.         00820025
008330     05  PS-NOT-ON-TPURCHS           PIC X(01) VALUE 'N'.         00833041
008340         88  PS-NOT-ON-TPURCHS-YES             VALUE 'Y'.         00834041
008350         88  PS-NOT-ON-TPURCHS-NO              VALUE 'N'.         00835041
008360     05  PS-PO-ON-TPURCHS-TABLE-SW   PIC X(01) VALUE 'N'.         00836048
008370         88  PS-PO-ON-TPURCHS-TABLE            VALUE 'Y'.         00837048
008380         88  PS-PO-NOT-ON-TPURCHS-TABLE        VALUE 'N'.         00838048
008390     05  PS-PO-ON-TPLNSHP-TABLE-SW   PIC X(01) VALUE 'N'.         00839048
008391         88  PS-PO-ON-TPLNSHP-TABLE            VALUE 'Y'.         00839148
008392         88  PS-PO-NOT-ON-TPLNSHP-TABLE        VALUE 'N'.         00839248
008393     05  PS-PO-TO-RESEND-SW          PIC X(01) VALUE 'N'.         00839351
008394         88  PS-PO-TO-RESEND-FILE              VALUE 'Y'.         00839451
008395         88  PS-PO-NOT-TO-RESEND-FILE          VALUE 'N'.         00839551
008396     05  PS-PO-WRITTEN-TO-RESEND-SW  PIC X(01) VALUE 'N'.         00839655
008397         88  PS-PO-WRITTEN-TO-RESEND           VALUE 'Y'.         00839755
008398         88  PS-PO-NOT-WRITTEN-TO-RESEND       VALUE 'N'.         00839855
008399                                                                  00839955
008400 01  WS-ABEND-FIELDS.                                             00840025
008500     05  WS-ABEND-CODE                PIC S9(04)  VALUE ZERO      00850025
008600                                                   COMP SYNC.     00860025
008700     05  WS-ABEND-PROGRAM             PIC X(08)  VALUE 'VLKUT059'.00870025
008800     05  WS-ABEND-PARAGRAPH           PIC X(50)  VALUE SPACES.    00880025
008900     05  WS-ABEND-OPERATION           PIC X(50)  VALUE SPACES.    00890025
009000     05  WS-SQLCODE                   PIC 9(09)  VALUE ZERO.      00900025
009100                                                                  00910048
009200 01 WS-PROGRAM-FLAGS.                                             00920025
009300     05 WS-EOF-INPUT-FILE-FLAG        PIC X(01)  VALUE 'N'.       00930025
009400        88 NOT-EOF-INPUT-FILE                    VALUE 'N'.       00940025
009500        88 EOF-INPUT-FILE                        VALUE 'Y'.       00950025
009600                                                                  00960048
009700 01 OR-PO-RESEND-HEADER-RECORD.                                   00970051
009800     05 OR-HEADER-TEXT                PIC X(100) VALUE SPACES.    00980051
010100                                                                  01010051
010200 01 OR-PO-RESEND-RECORD.                                          01020051
010210     05 OR-PO-NUMBER                  PIC X(08)  VALUE SPACES.    01021051
010220     05 OR-FILLER                     PIC X(92)  VALUE SPACES.    01022051
010230                                                                  01023051
010300*----------------------------------------------------------------*01030025
010400* COPYBOOK FOR INPUT PO HEADER FILE LAYOUT.                      *01040025
010500*----------------------------------------------------------------*01050025
010600                                                                  01060048
010700     COPY VLRD066.                                                01070025
010800                                                                  01080048
010900*----------------------------------------------------------------*01090025
011000* COPYBOOK FOR OUTPUT PO HEADER FILE LAYOUT.                     *01100025
011100*----------------------------------------------------------------*01110025
011200                                                                  01120048
011300     COPY VLRD067.                                                01130025
011400                                                                  01140048
011500*----------------------------------------------------------------*01150025
011600*  DB2 FORMATTED MESSAGE AREA                                     01160025
011700*----------------------------------------------------------------*01170025
011800                                                                  01180048
011900     COPY DPWS004.                                                01190025
012000                                                                  01200048
012100*----------------------------------------------------------------*01210025
012200*    DB2 SQL COMMUNICATION AREA                                   01220025
012300*----------------------------------------------------------------*01230025
012400     EXEC SQL                                                     01240025
012500          INCLUDE SQLCA                                           01250025
012600     END-EXEC.                                                    01260025
012700                                                                  01270048
012800*----------------------------------------------------------------*01280025
012900*    DB2 DCLGEN FOR PO PLANNED SHIPMENT TABLE                     01290025
013000*----------------------------------------------------------------*01300025
013100     EXEC SQL                                                     01310025
013200          INCLUDE TPLNSHP                                         01320025
013300     END-EXEC.                                                    01330025
013400                                                                  01340048
013500*----------------------------------------------------------------*01350039
013600*    DB2 DCLGEN FOR PURCHASE ORDER HEADER TABLE                   01360039
013700*----------------------------------------------------------------*01370039
013800     EXEC SQL                                                     01380039
013900          INCLUDE TPURCHS                                         01390039
014000     END-EXEC.                                                    01400039
014200                                                                  01420048
014900 PROCEDURE DIVISION.                                              01490025
015000                                                                  01500048
015100*----------------------------------------------------------------*01510025
015200*    MAIN PROCESSING FOR THE PROGRAM.                            *01520025
015300*    THE PROGRAM WILL READ THE INPUT FILE AND FOR EACH PO THE    *01530025
015400*    EXTENDED CANCELLATION DATE IS CHECKED. IF THE DATE IS       *01540025
015500*    AVAILABLE THEN THE PROGRAM WILL WRITE THE DATE IN THE OUTPUT*01550025
015600*    FILE. ELSE IT WILL BE MOVED AS BLANK TO OUTPUT FILE.        *01560025
015700*----------------------------------------------------------------*01570025
015800 0000-MAIN-MODULE.                                                01580025
015900                                                                  01590048
016000     INITIALIZE WS-EOF-INPUT-FILE-FLAG                            01600025
016100                WS-INREC-COUNT                                    01610025
016200                WS-OUTREC-COUNT                                   01620041
016201                WS-OUTREC-RESEND-COUNT                            01620151
016210                WS-NOT-ON-PO-COUNT                                01621048
016211                WS-NOT-ON-PLNSHP-COUNT                            01621148
016220                PS-NOT-ON-TPURCHS.                                01622041
016300                                                                  01630048
016400     OPEN INPUT  INPUT-PO-HEADER-FILE.                            01640025
016500     OPEN OUTPUT OUTPUT-PO-HEADER-FILE.                           01650025
016510     OPEN OUTPUT OUTPUT-PO-RESEND-FILE.                           01651051
016511                                                                  01651153
016512     SET PS-PO-NOT-TO-RESEND-FILE TO TRUE.                        01651253
016520                                                                  01652051
016600     PERFORM 1000-READ-INPUT-PO-FILE                              01660025
016700       UNTIL EOF-INPUT-FILE.                                      01670025
016800                                                                  01680048
016900     DISPLAY "                                  ".                01690051
017000     DISPLAY "PROGRAM VLKUT059 STATISTICS       ".                01700051
017100     DISPLAY "NUMBER OF RECORDS READ:           "                 01710051
017110             WS-INREC-COUNT.                                      01711049
017200     DISPLAY "NUMBER OF RECORDS WRITTEN:        "                 01720051
017201             WS-OUTREC-COUNT.                                     01720149
017202     DISPLAY "NUMBER OF RESEND RECORDS WRITTEN: "                 01720251
017203             WS-OUTREC-RESEND-COUNT.                              01720351
017210     DISPLAY "NUMBER OF PO NOT ON TPURCHS:      "                 01721051
017211             WS-NOT-ON-PO-COUNT.                                  01721149
017220     DISPLAY "NUMBER OF PO NOT ON TPLNSHP:      "                 01722051
017230             WS-NOT-ON-PLNSHP-COUNT.                              01723049
017301                                                                  01730148
017302     IF  WS-OUTREC-RESEND-COUNT = 0                               01730251
017303         MOVE SPACES TO OR-HEADER-TEXT                            01730351
017304         STRING 'NO PURCHASE ORDERS TO RESEND'                    01730451
017306                                    DELIMITED BY SIZE             01730651
017309                                    INTO OR-HEADER-TEXT           01730951
017310         PERFORM 6200-WRITE-HEADER-FILE                           01731051
017312     ELSE                                                         01731251
017313         MOVE SPACES TO OR-HEADER-TEXT                            01731351
017314         PERFORM 6200-WRITE-HEADER-FILE                           01731451
017315         MOVE SPACES TO OR-HEADER-TEXT                            01731551
017316         STRING 'END OF PURCHASE ORDER NUMBER LIST'               01731653
017317                                    DELIMITED BY SIZE             01731751
017318                                    INTO OR-HEADER-TEXT           01731851
017319         PERFORM 6200-WRITE-HEADER-FILE                           01731951
017320     END-IF.                                                      01732051
017321                                                                  01732151
017323     IF  PS-PO-TO-RESEND-FILE                                     01732353
017324         MOVE 4008 TO RETURN-CODE                                 01732441
017325     END-IF.                                                      01732541
017400                                                                  01740048
017500     CLOSE  INPUT-PO-HEADER-FILE.                                 01750025
017600     CLOSE  OUTPUT-PO-HEADER-FILE.                                01760025
017610     CLOSE  OUTPUT-PO-RESEND-FILE.                                01761051
017700                                                                  01770048
017800     STOP RUN.                                                    01780025
017900                                                                  01790048
018000*----------------------------------------------------------------*01800025
018100*    READ THE INPUT FILE DETAILS RECEIVED FROM FTP.              *01810025
018200*----------------------------------------------------------------*01820025
018300                                                                  01830048
018400 1000-READ-INPUT-PO-FILE.                                         01840025
018500                                                                  01850048
018600     INITIALIZE VL066-CMS-POHDR-RECORD.                           01860051
018610     SET PS-PO-NOT-WRITTEN-TO-RESEND TO TRUE.                     01861055
018620                                                                  01862052
018700     READ  INPUT-PO-HEADER-FILE                                   01870051
018710           INTO  VL066-CMS-POHDR-RECORD                           01871052
018900     AT END                                                       01890025
019000        SET EOF-INPUT-FILE          TO TRUE                       01900025
019100     NOT AT END                                                   01910025
019200        ADD 1                       TO WS-INREC-COUNT             01920025
019400        SET PS-UNTIL-EXIT-LOOP-NO   TO TRUE                       01940048
019410        SET PS-PO-NOT-ON-TPURCHS-TABLE TO TRUE                    01941048
019420        MOVE VL066-PO-NBR(1:8)      TO WS-PO-NBR-N                01942049
019430        MOVE WS-PO-NBR-N            TO WS-PO-NBR                  01943049
019500        PERFORM 1210-READ-TPURCHS-TABLE                           01950048
019600        PERFORM 1100-EXTEND-CANCEL-DATE                           01960025
019700        PERFORM 1200-MOVE-DETAILS-TO-OUTPUT                       01970025
019800     END-READ.                                                    01980025
019900                                                                  01990048
020000*----------------------------------------------------------------*02000025
020100*    RETRIEVE THE EXTENDED CANCEL DATE FROM THE TABLE TPLNSHP    *02010025
020200*----------------------------------------------------------------*02020025
020300                                                                  02030048
020400 1100-EXTEND-CANCEL-DATE.                                         02040025
020500                                                                  02050048
020600     INITIALIZE VL067-CMS-POHDR-RECORD.                           02060025
020610     SET PS-PO-NOT-ON-TPLNSHP-TABLE TO TRUE.                      02061048
021200     PERFORM                                                      02120025
021300          UNTIL PS-UNTIL-EXIT-LOOP-YES                            02130025
021400                                                                  02140048
021500     EXEC SQL                                                     02150025
021600          SELECT CHAR(EXT_CAN_DTE,ISO)                            02160025
021700                ,CHAR(CAN_IFNOT_SHIP_DTE,ISO)                     02170025
021800            INTO :PLNSHP-EXT-CAN-DTE                              02180025
021900                ,:PLNSHP-CAN-IFNOT-SHIP-DTE                       02190025
022000            FROM TPLNSHP                                          02200025
022100           WHERE PO_NBR             = :WS-PO-NBR                  02210025
022200             AND VER_STATUS_CDE     = 'A'                         02220025
022300     END-EXEC                                                     02230025
022400                                                                  02240048
022500     EVALUATE TRUE                                                02250025
022600         WHEN SQLCODE               = +0                          02260025
022610              SET PS-UNTIL-EXIT-LOOP-YES TO TRUE                  02261048
022620              SET PS-PO-ON-TPLNSHP-TABLE TO TRUE                  02262048
022700         WHEN SQLCODE               = +100                        02270025
023000              SET PS-UNTIL-EXIT-LOOP-YES TO TRUE                  02300025
023100              ADD 1 TO WS-NOT-ON-PLNSHP-COUNT                     02310048
023200              SET PS-NOT-ON-TPURCHS-YES  TO TRUE                  02320050
023210              MOVE WS-PO-NBR             TO  WS-DISP-PO-NBR       02321050
023220              DISPLAY 'PO NOT ON TPLNSHP : ' WS-DISP-PO-NBR       02322050
023230              PERFORM 6000-WRITE-RESEND-FILE                      02323051
023300         WHEN SQLCODE               = -811                        02330025
023400              PERFORM 1150-UPDATE-TPLNSHP-TABLE                   02340025
023600         WHEN OTHER                                               02360025
023700             MOVE '1100-EXTEND-CANCEL-DATE'  TO WS-ABEND-PARAGRAPH02370025
023800             MOVE 'SELECT XTEND CANCEL DATE' TO WS-ABEND-OPERATION02380025
023900             PERFORM 9900-DB2-ABEND                               02390025
024000     END-EVALUATE                                                 02400025
024200     END-PERFORM.                                                 02420025
024300* ************************************************************** *02430025
024400* * INACTIVATES THE OLDER RECORD FROM TPLNSHP TABLE            * *02440025
024500* ************************************************************** *02450025
024600                                                                  02460025
024700 1150-UPDATE-TPLNSHP-TABLE.                                       02470025
024800                                                                  02480025
024900     EXEC SQL                                                     02490038
025000           UPDATE TPLNSHP A                                       02500038
025100                SET A.VER_STATUS_CDE = 'I'                        02510038
025200           WHERE                                                  02520038
025300                A.PO_NBR = :WS-PO-NBR                             02530038
025400            AND A.LAST_UPD_TMST IN (SELECT MIN(B.LAST_UPD_TMST)   02540038
025500                                     FROM TPLNSHP B               02550038
025600                                    WHERE                         02560038
025700                                      B.PO_NBR = :WS-PO-NBR       02570038
025800                                    AND B.VER_STATUS_CDE = 'A')   02580038
025900     END-EXEC.                                                    02590038
026000                                                                  02600025
026100     EVALUATE TRUE                                                02610025
026200         WHEN SQLCODE = ZERO                                      02620025
026300              CONTINUE                                            02630025
026400         WHEN OTHER                                               02640025
026500              MOVE '1150-UPDATE-TPLNSHP-TABLE'                    02650025
026600                                 TO WS-ABEND-PARAGRAPH            02660025
026700              MOVE 'UPDATE DATA'                                  02670025
026800                                 TO WS-ABEND-OPERATION            02680025
026900              PERFORM 9900-DB2-ABEND                              02690025
027000     END-EVALUATE.                                                02700025
027100                                                                  02710025
027400*----------------------------------------------------------------*02740025
027500*    WRITE THE OUTPUT FILE ALONG WITH THE EXTENDED CANCELLATION  *02750025
027600*    DATE RETRIVED FROM TABLE.                                   *02760025
027700*----------------------------------------------------------------*02770025
027800                                                                  02780048
027900 1200-MOVE-DETAILS-TO-OUTPUT.                                     02790025
028000                                                                  02800048
028200*----------------------------------------------------------------*02820025
028300* CHECK IF THE EXTENDED DATE IS GIVEN FOR THE PO IN TPLNSHP TABLE*02830025
028400*                                                                *02840025
028500* IF IT IS AVAILABLE THEN MOVE THE SAME TO OUTPUT EXTENDED CANCEL*02850025
028600* DATE .                                                         *02860025
028700*                                                                *02870025
028800* IF IT IS NOT AVAILABLE THEN MOVE SPACES TO THE OUTPUT EXTENDED *02880025
028900* CANCEL DATE. MOVE THE IF-NOT-CANCEL DATE RETRIVED FROM TABLE   *02890025
029000*                                                                *02900025
029100* MOVE THE IF-NOT-CANCEL DATE RETRIVED FROM TABLE TPLNSHP TO THE *02910025
029200* TO THE SHIP STOP DATE.                                         *02920025
029300*----------------------------------------------------------------*02930025
029400                                                                  02940048
029500     INITIALIZE  WS-DATE                                          02950025
029600                 WS-DATE-8.                                       02960025
029610                                                                  02961049
029700     IF  PS-PO-NOT-ON-TPLNSHP-TABLE                               02970048
029710         NEXT SENTENCE                                            02971048
029720     ELSE                                                         02972048
029800         IF  PLNSHP-EXT-CAN-DTE         > SPACES                  02980048
029900         AND PLNSHP-EXT-CAN-DTE         NOT = '0001-01-01'        02990048
030000             MOVE PLNSHP-EXT-CAN-DTE    TO WS-DATE                03000048
030100             MOVE WS-DATE(1:4)         TO WS-DATE-8(1:4)          03010048
030200             MOVE WS-DATE(6:2)         TO WS-DATE-8(5:2)          03020048
030300             MOVE WS-DATE(9:2)         TO WS-DATE-8(7:2)          03030048
030400             MOVE WS-DATE-8            TO VL067-XTEND-CANCEL-DATE 03040048
030500         END-IF                                                   03050048
030510     END-IF.                                                      03051048
030600                                                                  03060048
030700     INITIALIZE  WS-DATE                                          03070025
030800                 WS-DATE-8.                                       03080025
030801                                                                  03080151
030810     IF  PS-PO-NOT-ON-TPLNSHP-TABLE                               03081048
030820         MOVE VL066-SHIP-STOP-DATE TO VL067-SHIP-STOP-DATE        03082048
030830     ELSE                                                         03083048
030900         IF  PLNSHP-CAN-IFNOT-SHIP-DTE  > SPACES                  03090048
031000         AND PLNSHP-CAN-IFNOT-SHIP-DTE  NOT = '0001-01-01'        03100048
031100              MOVE PLNSHP-CAN-IFNOT-SHIP-DTE                      03110048
031200                                        TO WS-DATE                03120048
031300              MOVE WS-DATE(1:4)         TO WS-DATE-8(1:4)         03130048
031400              MOVE WS-DATE(6:2)         TO WS-DATE-8(5:2)         03140048
031500              MOVE WS-DATE(9:2)         TO WS-DATE-8(7:2)         03150048
031600              MOVE WS-DATE-8            TO VL067-SHIP-STOP-DATE   03160048
031700         END-IF                                                   03170048
031710     END-IF.                                                      03171048
031800                                                                  03180048
031900     MOVE VL066-ACD-IND             TO VL067-ACD-IND.             03190025
032000     MOVE VL066-PO-NBR              TO VL067-PO-NBR.              03200025
032100     MOVE VL066-MASTER-PO-NBR       TO VL067-MASTER-PO-NBR.       03210025
032200     MOVE VL066-DEPT-NBR            TO VL067-DEPT-NBR.            03220025
032300     MOVE VL066-VENDOR-NBR          TO VL067-VENDOR-NBR.          03230025
032400     MOVE VL066-SHIP-START-DATE     TO VL067-SHIP-START-DATE.     03240025
032500     MOVE VL066-PO-CREATE-DATE      TO VL067-PO-CREATE-DATE.      03250025
032600     MOVE VL066-PO-APPROVAL-DATE    TO VL067-PO-APPROVAL-DATE.    03260025
032700     MOVE VL066-CANCEL-DATE         TO VL067-CANCEL-DATE          03270025
032800     MOVE VL066-OTB-DATE            TO VL067-OTB-DATE.            03280025
032900     MOVE VL066-XREF-PO-NBR         TO VL067-XREF-PO-NBR.         03290025
033000     MOVE VL066-ORDER-TYPE          TO VL067-ORDER-TYPE.          03300025
033100     MOVE VL066-PACK-BY-STORE       TO VL067-PACK-BY-STORE.       03310025
033200     MOVE VL066-EDI-SENT-DATE       TO VL067-EDI-SENT-DATE.       03320025
033300     MOVE VL066-NEW-STORE           TO VL067-NEW-STORE.           03330025
033400     MOVE VL066-ADVERT-DATE         TO VL067-ADVERT-DATE.         03340025
033500     MOVE VL066-FOB                 TO VL067-FOB.                 03350025
033600     MOVE VL066-SHIP-TO-NUMBER      TO VL067-SHIP-TO-NUMBER.      03360025
033700     MOVE VL066-ORDER-STATUS        TO VL067-ORDER-STATUS.        03370025
033800     MOVE VL066-DIST-METHOD         TO VL067-DIST-METHOD.         03380025
033900     MOVE VL066-BILL-TYPE           TO VL067-BILL-TYPE.           03390025
034000     MOVE VL066-REPL-FLAG           TO VL067-REPL-FLAG.           03400025
034100     MOVE VL066-SPL-ORDER-IND       TO VL067-SPL-ORDER-IND.       03410025
034200     MOVE VL066-TOTAL-UNIT-SIGN     TO VL067-TOTAL-UNIT-SIGN.     03420025
034300     MOVE VL066-TOTAL-UNITS         TO VL067-TOTAL-UNITS.         03430025
034400     MOVE VL066-BUYER-NUMBER        TO VL067-BUYER-NUMBER.        03440025
034500     MOVE VL066-ORIG-ORDER-QTY-SIGN TO VL067-ORIG-ORDER-QTY-SIGN. 03450025
034600     MOVE VL066-ORIG-ORDER-QTY      TO VL067-ORIG-ORDER-QTY.      03460025
034700     MOVE VL066-AD-EVENT            TO VL067-AD-EVENT.            03470025
034800     MOVE VL066-SECOND-EVENT        TO VL067-SECOND-EVENT.        03480025
034900     MOVE VL066-TERMS               TO VL067-TERMS.               03490025
035000     MOVE VL066-PO-RELEASE-DATE     TO VL067-PO-RELEASE-DATE.     03500025
035100     MOVE VL066-PARENT-COMPANY      TO VL067-PARENT-COMPANY.      03510039
035200     MOVE VL066-FACTORY             TO VL067-FACTORY.             03520039
035300     IF   VL066-PARENT-COMPANY = SPACES                           03530039
035400     AND  VL066-FACTORY        = SPACES                           03540039
035500         CONTINUE                                                 03550039
035600     ELSE                                                         03560039
035900         PERFORM 1220-FILL-PARENT-FACTORY-ID                      03590048
036000     END-IF.                                                      03600039
036100     MOVE VL066-DIRECT-STORE-IND    TO VL067-DIRECT-STORE-IND.    03610025
036300     MOVE VL066-XFACT-START-DATE    TO VL067-XFACT-START-DATE.    03630032
036400     MOVE VL066-XFACT-END-DATE      TO VL067-XFACT-END-DATE.      03640032
036600     MOVE VL066-ANCHOR-CONSTANT     TO VL067-ANCHOR-CONSTANT.     03660025
036610                                                                  03661049
036620     IF  VL067-SHIP-STOP-DATE < VL067-SHIP-START-DATE             03662049
036621         MOVE WS-PO-NBR             TO  WS-DISP-PO-NBR            03662149
036622         DISPLAY 'START/STOP ON PO  : ' WS-DISP-PO-NBR            03662249
036640                 ' SHIP STOP < SHIP START - '                     03664049
036650                 VL067-SHIP-STOP-DATE                             03665049
036660                 ' - '                                            03666049
036670                 VL067-SHIP-START-DATE                            03667049
036680         MOVE VL066-SHIP-STOP-DATE TO VL067-SHIP-STOP-DATE        03668049
036681         PERFORM 6000-WRITE-RESEND-FILE                           03668153
036690     END-IF.                                                      03669049
036700                                                                  03670048
036800     ADD   1                        TO WS-OUTREC-COUNT.           03680048
036900     WRITE OUTPUT-PO-HEADER-RECORD  FROM VL067-CMS-POHDR-RECORD.  03690025
037000                                                                  03700048
037100*----------------------------------------------------------------*03710039
037200*    READ TPURCHS TABLE                                          *03720048
037300*----------------------------------------------------------------*03730039
037400                                                                  03740048
037500 1210-READ-TPURCHS-TABLE.                                         03750039
037600                                                                  03760048
038100     EXEC SQL                                                     03810039
038200          SELECT  IMPRT_VND_ID                                    03820039
038300                , IMPRT_FCTRY_ID                                  03830039
038400            INTO :PURCHS-IMPRT-VND-ID                             03840039
038500                ,:PURCHS-IMPRT-FCTRY-ID                           03850039
038600            FROM TPURCHS                                          03860039
038700           WHERE PO_NBR             = :WS-PO-NBR                  03870039
038800             AND VER_STATUS_CDE     = 'A'                         03880039
038900     END-EXEC                                                     03890039
039000                                                                  03900039
039100     EVALUATE TRUE                                                03910039
039200         WHEN SQLCODE  = +0                                       03920039
039210             SET PS-PO-ON-TPURCHS-TABLE TO TRUE                   03921048
040100         WHEN SQLCODE  = +100                                     04010039
040421             MOVE WS-PO-NBR             TO  WS-DISP-PO-NBR        04042143
040422             DISPLAY 'PO NOT ON TPURCHS : ' WS-DISP-PO-NBR        04042243
040423             SET PS-NOT-ON-TPURCHS-YES  TO TRUE                   04042341
040424             ADD 1 TO WS-NOT-ON-PO-COUNT                          04042448
040425             PERFORM 6000-WRITE-RESEND-FILE                       04042551
040500         WHEN OTHER                                               04050039
040600             MOVE '1210-READ-TPURCHS-TABLE' TO WS-ABEND-PARAGRAPH 04060039
040700             MOVE 'GET FACTORY AND PARENT IDS'                    04070039
040800                                            TO WS-ABEND-OPERATION 04080039
040900             PERFORM 9900-DB2-ABEND                               04090039
041000     END-EVALUATE.                                                04100039
041100                                                                  04110036
041110*----------------------------------------------------------------*04111048
041120*    POPULATE THE FACTORY AND PARENT COMPANY IDS                 *04112048
041121*        IF PARENT COMPANY OR FACTORY NAMES ARE FILLED IN        *04112148
041122*        ON THE INPUT FILE, THEN REPLACE THAT DATA WITH THE      *04112248
041123*        CORRESPONDING ID'S FROM TPURCHS.                        *04112348
041130*----------------------------------------------------------------*04113048
041140                                                                  04114048
041150 1220-FILL-PARENT-FACTORY-ID.                                     04115048
041160                                                                  04116048
041202     IF  PS-PO-ON-TPURCHS-TABLE                                   04120248
041204         IF  VL066-FACTORY NOT = SPACES                           04120448
041205             MOVE PURCHS-IMPRT-FCTRY-ID TO WS-ID-NBR-N            04120548
041206             MOVE WS-ID-NBR-N           TO VL067-FACTORY          04120648
041207         END-IF                                                   04120748
041208         IF  VL066-PARENT-COMPANY NOT = SPACES                    04120848
041209             MOVE PURCHS-IMPRT-VND-ID TO WS-ID-NBR-N              04120948
041210             MOVE WS-ID-NBR-N         TO VL067-PARENT-COMPANY     04121048
041211         END-IF                                                   04121148
041212     ELSE                                                         04121248
041216         MOVE SPACES                TO VL067-FACTORY              04121648
041217         MOVE SPACES                TO VL067-PARENT-COMPANY       04121748
041226     END-IF.                                                      04122648
041227                                                                  04122748
041228 6000-WRITE-RESEND-FILE.                                          04122851
041229                                                                  04122951
041230     SET PS-PO-TO-RESEND-FILE TO TRUE.                            04123051
041231                                                                  04123151
041232     IF  PS-PO-NOT-WRITTEN-TO-RESEND                              04123255
041233         SET PS-PO-WRITTEN-TO-RESEND TO TRUE                      04123355
041234         IF  WS-OUTREC-RESEND-COUNT = 0                           04123455
041235             PERFORM 6100-WRITE-HEADER-INFO                       04123555
041236             MOVE VL066-PO-NBR(1:8) TO OR-PO-NUMBER               04123655
041237             MOVE SPACES TO OR-FILLER                             04123755
041238             WRITE OUTPUT-PO-RESEND-RECORD                        04123855
041239              FROM OR-PO-RESEND-RECORD                            04123955
041240             ADD +1 TO WS-OUTREC-RESEND-COUNT                     04124055
041241         ELSE                                                     04124155
041242             MOVE VL066-PO-NBR(1:8) TO OR-PO-NUMBER               04124255
041243             MOVE SPACES TO OR-FILLER                             04124355
041244             WRITE OUTPUT-PO-RESEND-RECORD                        04124455
041245              FROM OR-PO-RESEND-RECORD                            04124555
041246             ADD +1 TO WS-OUTREC-RESEND-COUNT                     04124655
041247         END-IF                                                   04124755
041248     END-IF.                                                      04124855
041249                                                                  04124955
041250 6100-WRITE-HEADER-INFO.                                          04125055
041251                                                                  04125155
041252     MOVE   SPACES                      TO OR-HEADER-TEXT.        04125255
041253     STRING  'FROM JOB VLK006 - PO FILE PREP FOR COMPLIANCE'      04125355
041254                                           DELIMITED BY SIZE      04125455
041255             ' VENDOR HAD ISSUES WITH SOME'                       04125556
041256                                           DELIMITED BY SIZE      04125655
041257                                      INTO OR-HEADER-TEXT.        04125755
041258     PERFORM 6200-WRITE-HEADER-FILE.                              04125855
041259                                                                  04125955
041260     MOVE   SPACES                      TO OR-HEADER-TEXT.        04126056
041261     STRING  'PURCHASE ORDERS.'                                   04126157
041262                                           DELIMITED BY SIZE      04126256
041265                                      INTO OR-HEADER-TEXT.        04126556
041266     PERFORM 6200-WRITE-HEADER-FILE.                              04126656
041267                                                                  04126756
041268     MOVE   SPACES                      TO OR-HEADER-TEXT.        04126856
041269     PERFORM 6200-WRITE-HEADER-FILE.                              04126956
041270                                                                  04127056
041271     MOVE   SPACES                      TO OR-HEADER-TEXT.        04127156
041272     STRING  'FLAG THE FOLLOWING PO NUMBERS IN YOUR PO'           04127256
041273                                           DELIMITED BY SIZE      04127356
041274             ' SYSTEM SO THAT THEY COME THRU THE NEXT'            04127456
041275                                           DELIMITED BY SIZE      04127556
041276                                      INTO OR-HEADER-TEXT.        04127656
041277     PERFORM 6200-WRITE-HEADER-FILE.                              04127756
041278                                                                  04127856
041279     MOVE   SPACES                      TO OR-HEADER-TEXT.        04127956
041280     STRING  'COMPLIANCE FILE BUILD PROCESS.'                     04128056
041281                                           DELIMITED BY SIZE      04128156
041282                                      INTO OR-HEADER-TEXT.        04128256
041283     PERFORM 6200-WRITE-HEADER-FILE.                              04128356
041284                                                                  04128456
041285     MOVE   SPACES                      TO OR-HEADER-TEXT.        04128556
041286     PERFORM 6200-WRITE-HEADER-FILE.                              04128656
041287                                                                  04128756
041288 6200-WRITE-HEADER-FILE.                                          04128856
041289                                                                  04128956
041290     WRITE OUTPUT-PO-RESEND-RECORD                                04129056
041291      FROM OR-PO-RESEND-HEADER-RECORD.                            04129156
041292                                                                  04129256
041293*    ADD +1 TO WS-OUTREC-RESEND-COUNT.                            04129356
041294                                                                  04129456
041295*----------------------------------------------------------------*04129556
041300*  DB2 ABEND ROUTINE                                             *04130025
041400*----------------------------------------------------------------*04140025
041500 9900-DB2-ABEND.                                                  04150025
041600                                                                  04160048
041700     MOVE SQLCODE                   TO WS-SQLCODE.                04170025
041800     DISPLAY '*** DB2 ERROR '.                                    04180025
041900     DISPLAY '*** SQLCODE   = '     WS-SQLCODE.                   04190025
042000     DISPLAY '*** PROGRAM   = '     WS-ABEND-PROGRAM.             04200025
042100     DISPLAY '*** PARAGRAPH = '     WS-ABEND-PARAGRAPH.           04210025
042200     DISPLAY '*** OPERATION = '     WS-ABEND-OPERATION.           04220025
042300                                                                  04230048
042400     COPY DPPD004.                                                04240025
042500                                                                  04250048
042600     MOVE +4013                     TO WS-ABEND-CODE.             04260025
042700     CALL 'ILBOABN0'                USING WS-ABEND-CODE.          04270025
042800                                                                  04280048
