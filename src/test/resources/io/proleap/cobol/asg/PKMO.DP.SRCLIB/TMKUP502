000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    TMKUP502.                                         00020012
000300 AUTHOR.        AL PETERS.                                        00030012
000400                                                                  00040000
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050000
000600 DATE-WRITTEN.  JANUARY 2005.                                     00060001
000700 DATE-COMPILED.                                                   00070000
000800                                                                  00080000
000900 ENVIRONMENT DIVISION.                                            00090000
001000 CONFIGURATION SECTION.                                           00100000
001100 SOURCE-COMPUTER. IBM-3090.                                       00110000
001200 OBJECT-COMPUTER. IBM-3090.                                       00120000
001300                                                                  00130000
001400****************************************************************  00140000
001600* THIS MODULE IS CALLED FROM TMKUT500                          *  00160021
001800****************************************************************  00180000
001900*                                                              *  00190001
002000* THIS DB2 PROGRAM IS CALLED TO LOOK AT PACKAGING CODE.        *  00200012
002010*                                                              *  00201099
002100* IT CHECKS THE RECEIVER AGAINST TALLPLN TO DETERMINE IF THE   *  00210099
002200* ENTIRE ALLOCATION IS FOUND BEFORE ATTEMPTING TO PROCESS.     *  00220012
002201*                                                              *  00220199
002202* IF THE RECEIVER IS PACK BY STORE (PBS) IT CALLS TMKUP508.    *  00220299
002203*                                                              *  00220399
002204* IF THE RECEIVER IS BULK AND SEASONAL SET CODE IS FBP IT THEN *  00220499
002205* CHANGES THE RECEIVER PACKAGING CODE TO PBS AND CALLS TMKUP508*  00220599
002206*                                                              *  00220699
002207* IF THE RECEIVER IS BULK AND NOT FLOW BACK IT CALLS TMKUP520. *  00220799
002300*                                                              *  00230001
002500****************************************************************  00250000
002600                                                                  00260000
002700 DATA DIVISION.                                                   00270000
002800 WORKING-STORAGE SECTION.                                         00280000
002900                                                                  00290099
002901  01  DK-DB2-KEYS.                                                00290199
002902      05  DK-PO-NBR                      PIC S9(09)  COMP.        00290299
002903      05  DK-REC-SEQ-NBR                 PIC S9(09)  COMP.        00290399
002904      05  DK-OPER-UNT-ID                 PIC S9(04)  COMP.        00290499
002905                                                                  00290599
002906 01  PROGRAM-VARIABLES.                                           00290699
002907                                                                  00290799
002908     05  PV-PREPACK-PGM-NBR       PIC X(03)  VALUE SPACE.         00290899
002909                                                                  00290999
002910     05  PV-PACKAGING-CDE         PIC X(01)  VALUE SPACES.        00291099
002920         88  PV-PACKAGING-NON-PBS            VALUES               00292099
002930             'C', 'S', 'M', 'I'.                                  00293099
002940         88  PV-PACKAGING-PBS                VALUES               00294099
002950             ' '.                                                 00295099
002960         88  PV-PACKAGING-BULK               VALUES               00296099
002970             'B'.                                                 00297099
002980         88  PV-PACKAGING-NONPACK            VALUES               00298099
002990             'B', 'S', 'C'.                                       00299099
003000         88  PV-PACKAGING-PREPACK            VALUES               00300099
003100             'M', 'I'.                                            00310099
003200                                                                  00320099
003300     05  PV-PURCHS-PO-SEASET-SHRT-NM.                             00330099
003400         10  PV-PO-SEASET-SHRT-NM3    PIC X(03)  VALUE SPACE.     00340099
003410         10  PV-PO-SEASET-SHRT-NM2    PIC X(02)  VALUE SPACE.     00341099
003420                                                                  00342099
003430     05  PV-COUNT-ALLOC               PIC S9(09) VALUE +0 COMP.   00343099
003440     05  PV-PBS-STORE-COUNT           PIC S9(09) VALUE +0 COMP.   00344099
003450     05  PV-PBS-PKSLIP-COUNT          PIC S9(09) VALUE +0 COMP.   00345099
003451     05  PV-PKSL-ITM-QTY              PIC S9(9)  VALUE +0 COMP.   00345199
003452* JAK 05/2007 - ADD PROGRAM VARIABLES                             00345299
003453     05  PV-SQL-CNT                     PIC S9(04)   VALUE +0     00345399
003454                                                    COMP.         00345499
003455* JAK 05/2007 - END                                               00345599
003460                                                                  00346099
003600 01  PS-SWITCHES.                                                 00360000
003700     05  PS-DONE-PROCESSING-SW        PIC X(01)  VALUE 'N'.       00370011
003800         88  PS-DONE                             VALUE 'Y'.       00380011
003900         88  PS-NOT-DONE                         VALUE 'N'.       00390011
004000     05  PS-END-OF-CSR-SW             PIC X(01)  VALUE 'N'.       00400011
004100         88  PS-END-OF-PO-CSR-YES                VALUE 'Y'.       00410011
004200         88  PS-END-OF-PO-CSR-NO                 VALUE 'N'.       00420011
004300     05  PS-END-OF-CSR-SW             PIC X(01)  VALUE 'N'.       00430011
004400         88  PS-END-OF-RCVRS-FOR-PO-YES          VALUE 'Y'.       00440011
004500         88  PS-END-OF-RCVRS-FOR-PO-NO           VALUE 'N'.       00450011
004600     05  PS-PKGNG-TYPE-CHECK-OK-SW    PIC X(01)  VALUE 'N'.       00460099
004700         88  PS-PKGNG-TYPE-CHECK-OK              VALUE 'Y'.       00470099
005430     05  PS-ALLOCATION-FOUND-SW       PIC X(01)  VALUE 'N'.       00543025
005440         88  PS-ALLOCATION-FOUND-YES             VALUE 'Y'.       00544025
005450         88  PS-ALLOCATION-FOUND-NO              VALUE 'N'.       00545025
005460     05  PS-UPDATE-TRECEIV-SW         PIC X(01)  VALUE 'N'.       00546036
005470         88  PS-UPDATE-TRECEIV-YES               VALUE 'Y'.       00547036
005480         88  PS-UPDATE-TRECEIV-NO                VALUE 'N'.       00548036
005481     05  PS-UPDATE-AUTOACKNL-SW       PIC X(01)  VALUE 'N'.       00548199
005482         88  PS-UPDATE-AUTOACKNL-YES             VALUE 'Y'.       00548299
005483         88  PS-UPDATE-AUTOACKNL-NO              VALUE 'N'.       00548399
005490     05  PS-PKSLIP-RECORD-SW          PIC X(01)  VALUE 'N'.       00549090
005491         88  PS-NO-MORE-PKSLIP-REC               VALUE 'N'.       00549190
005492         88  PS-MORE-PKSLIP-REC                  VALUE 'Y'.       00549290
005493     05  PS-NO-DISTRO-SW              PIC X(01)  VALUE 'Y'.       00549395
005494         88  PS-NO-DISTRO-OK                     VALUE 'Y'.       00549495
005495         88  PS-NO-DISTRO-NOT-OK                 VALUE 'N'.       00549595
005496     05  PS-PKITEM-RECORD-SW          PIC X(01)  VALUE 'N'.       00549699
005497         88  PS-NO-MORE-PKITEM-REC               VALUE 'N'.       00549799
005498         88  PS-MORE-PKITEM-REC                  VALUE 'Y'.       00549899
005499* JAK 05/2007 - ADD SWITCHES                                      00549999
005500     05  PS-ASNS-TO-WMS-SW            PIC X(01) VALUE 'N'.        00550099
005501         88  PS-ASNS-TO-WMS-YES                 VALUE 'Y'.        00550199
005502         88  PS-ASNS-TO-WMS-NO                  VALUE 'N'.        00550299
005503     05  PS-TRIP-FND-SW               PIC X(01) VALUE 'N'.        00550399
005504         88  PS-TRIP-FND-YES                    VALUE 'Y'.        00550499
005505         88  PS-TRIP-FND-NO                     VALUE 'N'.        00550599
005506* JAK 05/2007 - END                                               00550699
005510                                                                  00551000
005600 01  PC-CONSTANTS.                                                00560000
005610     05  PC-AUTO-VE-STP-FB        PIC S9(04) VALUE 0426 COMP.     00561099
005700     05  PC-SYSTEM-PBS            PIC X(08)  VALUE 'SYSM PBS'.    00570099
005800     05  PC-CURRENT-MODULE-NAME   PIC X(08)  VALUE 'TMKUP502'.    00580079
006100     05  PC-Y                     PIC X(01)  VALUE 'Y'.           00610011
006200     05  PC-SPACE                 PIC X(01)  VALUE ' '.           00620018
006300     05  PC-FCLTY-ID              PIC S9(4) COMP VALUE +1.        00630077
006310                                                                  00631014
006400     05  PC-CALLED-PROGRAM        PIC X(08).                      00640014
006500         88  PC-CALL-TMKUP508-PGM            VALUE 'TMKUP508'.    00650014
006600         88  PC-CALL-TMKUP520-PGM            VALUE 'TMKUP520'.    00660014
006700         88  PC-CALL-TMKUP501-PGM            VALUE 'TMKUP501'.    00670099
006900                                                                  00690020
006901     05  PC-A                     PIC X(01)  VALUE 'A'.           00690195
006902     05  PC-IF                    PIC X(02)  VALUE 'IF'.          00690224
006903     05  PC-FB                    PIC X(02)  VALUE 'FB'.          00690324
006904     05  PC-FBP                   PIC X(03)  VALUE 'FBP'.         00690424
006905     05 PC-DEFAULT-DATE           PIC X(10) VALUE                 00690599
006921                                            '9999-09-09'.         00692199
006922* JAK 05/2007 - ADD PROGRAM CONSTANTS                             00692299
006923     05  PC-WMS-CONTROL-MOD           PIC X(8)  VALUE  'WSKUP305'.00692399
006924* JAK 05/2007 - END                                               00692499
006925                                                                  00692599
006926                                                                  00692699
006929                                                                  00692999
006930****************************************************************  00693038
006931                                                                  00693120
006940* TROUBLE CENTRAL PROCESSING COPYBOOK.                            00694039
006950     COPY TMWS500.                                                00695039
006960                                                                  00696039
006980     COPY TMWS508.                                                00698057
006990                                                                  00699057
006991     COPY DPWS276.                                                00699157
006992                                                                  00699257
006993* JAK 05/2007 - ADD COPYBOOK FOR SHIPPING CONTROL MODULE          00699399
006994     COPY WSWS001.                                                00699499
007000****************************************************************  00700000
007100*  TABLE DECLARATIONS                                          *  00710000
007200****************************************************************  00720000
007300                                                                  00730000
009000* DB2 - PURCHASE ORDER                                            00900001
009100     EXEC SQL                                                     00910001
009200         INCLUDE TPURCHS                                          00920001
009300     END-EXEC.                                                    00930001
009400                                                                  00940001
009401* DB2 - PURCHASE ORDER                                            00940112
009402     EXEC SQL                                                     00940212
009403         INCLUDE TALLPLN                                          00940312
009404     END-EXEC.                                                    00940412
009405                                                                  00940512
009406* DB2 - PURCHASE ORDER                                            00940612
009407     EXEC SQL                                                     00940712
009408         INCLUDE TMESTDS                                          00940812
009409     END-EXEC.                                                    00940912
009410                                                                  00941012
009411* DB2 - RECEIVING                                                 00941112
009420     EXEC SQL                                                     00942012
009430         INCLUDE TRECEIV                                          00943012
009440     END-EXEC.                                                    00944012
009450                                                                  00945012
009460* DB2 - RECEIVING                                                 00946012
009470     EXEC SQL                                                     00947012
009480         INCLUDE TRECITM                                          00948012
009490     END-EXEC.                                                    00949012
009491                                                                  00949112
009492* DB2 - TPKSLIP                                                   00949290
009493     EXEC SQL                                                     00949390
009494         INCLUDE TPKSLIP                                          00949490
009495     END-EXEC.                                                    00949590
009496                                                                  00949690
009497* DB2 - TPKITEM                                                   00949799
009498     EXEC SQL                                                     00949899
009499         INCLUDE TPKITEM                                          00949999
009500     END-EXEC.                                                    00950099
009501                                                                  00950199
009502* DB2 - RECDIS - STORE LEVEL RECEIVING                            00950299
009503     EXEC SQL                                                     00950399
009504         INCLUDE TRECDIS                                          00950499
009505     END-EXEC.                                                    00950599
009506                                                                  00950699
009507* DB2 - TROUBLE NOTIFY                                            00950799
009508     EXEC SQL                                                     00950899
009509         INCLUDE TTRBNTF                                          00950999
009510     END-EXEC.                                                    00951099
009511                                                                  00951199
009512* JAK 05/2007 - ADD TABLES FOR WMS CODE                           00951299
009514*    DB2 DCLGEN FOR PARM TABLE                                    00951499
009516     EXEC SQL                                                     00951699
009517          INCLUDE TKRPRPM                                         00951799
009518     END-EXEC.                                                    00951899
009519                                                                  00951999
009520*    DB2 DCLGEN FOR SHIPMENT TABLE                                00952099
009521     EXEC SQL                                                     00952199
009522          INCLUDE TSHIPMT                                         00952299
009523     END-EXEC.                                                    00952399
009524                                                                  00952499
009525*    DB2 DCLGEN FOR SHIPMENT PO TABLE                             00952599
009526     EXEC SQL                                                     00952699
009527          INCLUDE TSHPTPO                                         00952799
009528     END-EXEC.                                                    00952899
009529                                                                  00952999
009532* JAK 05/2007 - END                                               00953299
009533                                                                  00953399
009534* DB2 COMMUNICATIONS AREA                                         00953496
009535     EXEC SQL                                                     00953596
009536          INCLUDE SQLCA                                           00953696
009537     END-EXEC.                                                    00953796
009538                                                                  00953896
009539******************************************************************00953992
009540* CURSORS                                                         00954096
009541******************************************************************00954196
009542*    GET ALL PACKSLIPS TO BE ABLE TO CHANGE THEM WHEN NEEDED FOR  00954296
009543*    FLOWBACK REASONS.                                            00954396
009544******************************************************************00954496
009545                                                                  00954596
009546                                                                  00954696
009547     EXEC SQL                                                     00954796
009548          DECLARE AUTO-PKSLP-CSR CURSOR FOR                       00954896
009549            SELECT  PO_NBR,                                       00954996
009550                    SEQ_NBR,                                      00955096
009551                    CRE_TMST,                                     00955196
009552                    VER_STAT_CDE,                                 00955296
009553                    OPER_UNT_ID,                                  00955396
009554                    FCLTY_ID,                                     00955496
009555                    PKSL_NBR,                                     00955596
009556                    STR_DEST_NBR,                                 00955696
009557                    REC_SEQ_NBR,                                  00955796
009558                    BOL_NBR,                                      00955896
009559                    PRO_NBR,                                      00955996
009560                    PKSL_STAT_CDE,                                00956096
009561                    CRE_UID,                                      00956196
009562                    PO_VER_NBR,                                   00956296
009563                    CRE_SRC_CDE,                                  00956396
009564                    EXPTED_PKG_QTY,                               00956496
009565                    OWNER_SCAC_ID,                                00956596
009566                    ASN_NBR,                                      00956696
009567                    VEND_SHIP_DTE,                                00956796
009568                    SHIPT_ID,                                     00956896
009569                    PKSL_PG_CNT,                                  00956996
009570                    CONTNR_ID,                                    00957096
009571                    ORIG_PKSL_SEQ_NBR                             00957196
009572              FROM  TPKSLIP                                       00957296
009573           WHERE PO_NBR           = :DK-PO-NBR                    00957396
009574             AND OPER_UNT_ID      = :DK-OPER-UNT-ID               00957496
009575             AND REC_SEQ_NBR      = :DK-REC-SEQ-NBR               00957596
009576             AND VER_STAT_CDE     = :PC-A                         00957696
009577     END-EXEC.                                                    00957796
009578                                                                  00957896
009579******************************************************************00957999
009580*   DECLARE FOR GETTING AND SUMMING ALL LINES FOR BEING           00958099
009581*   ABLE TO CREATE PBS RECDIS LINES.                              00958199
009582******************************************************************00958299
009583                                                                  00958399
009584     EXEC SQL                                                     00958499
009585          DECLARE PKSLIP-ITEM-CURSOR CURSOR FOR                   00958599
009586           SELECT SUM (PKSL_ITM_QTY),                             00958699
009587                  PKSL_LNE_NBR                                    00958799
009588             FROM TPKITEM                                         00958899
009589            WHERE PO_NBR        = :DK-PO-NBR                      00958999
009590              AND SEQ_NBR       = :PKSLIP-SEQ-NBR                 00959099
009591              AND VER_STAT_CDE  = 'A'                             00959199
009592         GROUP BY PKSL_LNE_NBR                                    00959299
009593         ORDER BY PKSL_LNE_NBR                                    00959399
009594     END-EXEC.                                                    00959499
009595                                                                  00959599
009596******************************************************************00959696
009597*     LINKAGE AREA                                                00959796
009598******************************************************************00959896
009600                                                                  00960096
011500 LINKAGE SECTION.                                                 01150000
011600     COPY TMRD007.                                                01160001
011800                                                                  01180000
012000 PROCEDURE DIVISION USING TM007-COMMUNICATIONS-AREA.              01200097
012010                                                                  01201056
012100******************************************************************01210000
012200 0000-MAINLINE.                                                   01220026
012300                                                                  01230026
012400     SET TM007-CALL-SUCCESSFUL   TO TRUE.                         01240079
012500     MOVE PC-CURRENT-MODULE-NAME TO TM007-CALLED-MODULE.          01250079
012510     MOVE SPACE TO TM007-RETURN-STATUS.                           01251099
012520                                                                  01252023
013701     PERFORM 1000-ALLOCATIONS.                                    01370123
013900                                                                  01390012
014700     GOBACK.                                                      01470026
014800                                                                  01480026
014900******************************************************************01490000
014901 1000-ALLOCATIONS.                                                01490118
014902                                                                  01490212
014903     PERFORM 2060-MOVE-KEY-FIELDS.                                01490326
014906     PERFORM 2000-CHECK-TALLPLN-ALLOC.                            01490612
014907                                                                  01490713
014908*AHP*                                                             01490899
014909     DISPLAY '************************************************'   01490999
014910     DISPLAY ' CHECK FOR TALLPLN ALLOCATION  (TMKUP502) '         01491099
014920     DISPLAY '      PO NBR: ' DK-PO-NBR                           01492099
014921     DISPLAY ' OPER UNT ID: ' DK-OPER-UNT-ID                      01492199
014922     DISPLAY ' REC SEQ NBR: ' DK-REC-SEQ-NBR                      01492299
014923     DISPLAY ' ALLOCATION FOUND YES: ' PS-ALLOCATION-FOUND-SW     01492399
014924     DISPLAY ' ALLOCATION FOUND  NO: ' PS-ALLOCATION-FOUND-SW     01492499
014925     DISPLAY ' COUNT ALLOC BUCKET: ' PV-COUNT-ALLOC               01492599
014926     DISPLAY '************************************************'.  01492699
014927*AHP*                                                             01492799
014928                                                                  01492899
014929     IF PV-COUNT-ALLOC = 0 AND                                    01492913
014930         PS-ALLOCATION-FOUND-YES                                  01493025
014931         PERFORM 2020-GET-REC-PO-INFO                             01493126
014932*AHP*                                                             01493299
014933     DISPLAY '************************************************'   01493399
014934     DISPLAY ' CHECK FOR REC PO INFORMATION  (TMKUP502) '         01493499
014935     DISPLAY '      PO NBR: ' DK-PO-NBR                           01493599
014936     DISPLAY ' OPER UNT ID: ' DK-OPER-UNT-ID                      01493699
014937     DISPLAY ' REC SEQ NBR: ' DK-REC-SEQ-NBR                      01493799
014938     DISPLAY ' PACKAGING CODE: ' PV-PACKAGING-CDE                 01493899
014939     DISPLAY ' PKGNG TYPE CHECK OK: ' PS-PKGNG-TYPE-CHECK-OK-SW   01493999
014940     DISPLAY ' COUNT ALLOC BUCKET: ' PV-COUNT-ALLOC               01494099
014941     DISPLAY '************************************************'   01494199
014942*AHP*                                                             01494299
014943         IF PS-PKGNG-TYPE-CHECK-OK                                01494331
014944             PERFORM 2030-FIND-ALLOC-REDISTRO-PATH                01494425
014945         ELSE                                                     01494525
014946*    AUTO REDISTRO FAILURE MEANS TRBL IS NOT SATISFIED            01494683
014947             SET TM007-AUTO-REDISTRO-FAILED TO TRUE               01494783
014948         END-IF                                                   01494825
014949     ELSE                                                         01494913
014950         SET TM007-AUTO-REDISTRO-FAILED TO TRUE                   01495083
014951     END-IF.                                                      01495113
014952                                                                  01495213
014953*AHP*                                                             01495399
014954     DISPLAY '************************************************'   01495499
014955     DISPLAY ' DISPLAY AUTO REDISTRO SWITCH  (TMKUP502) '         01495599
014956     DISPLAY ' HAS THIS TROUBLE BEEN SATISFIED '                  01495699
014957     DISPLAY ' TM007 RETURN STATUS CODE: ' TM007-RETURN-STATUS    01495799
014962     DISPLAY '************************************************'.  01496299
014963*AHP*                                                             01496399
014964                                                                  01496499
014965******************************************************************01496513
014966* CHECK PO AND DEST_NBR AGAINST TALLPLN TO MAKE SURE THAT ENTIRE  01496612
014967* ALLOCATION IS ON TALLPLN.  IF IT IS NOT THERE YET, WE DO NOT    01496712
014968* WANT TO PROCEED ANY FUTHER TO TRY TO RE-DISTRO.                 01496812
014969******************************************************************01496999
014970                                                                  01497012
014980 2000-CHECK-TALLPLN-ALLOC.                                        01498012
014981     MOVE '2000-CHECK-TALLPLN-ALLOC' TO TM007-RETURNED-PARA.      01498122
014982                                                                  01498222
014983     INITIALIZE DCLTALLPLN.                                       01498322
014990                                                                  01499012
014991     EXEC SQL                                                     01499112
014992          SELECT DISTINCT PO_NBR                                  01499212
014993            INTO :ALLPLN-PO-NBR                                   01499312
014994            FROM TALLPLN                                          01499412
014995           WHERE PO_NBR = :DK-PO-NBR                              01499512
014996             AND DEST_NBR = :DK-OPER-UNT-ID                       01499612
014997     END-EXEC                                                     01499712
014998                                                                  01499812
014999     EVALUATE TRUE                                                01499912
015000         WHEN SQLCODE = +0                                        01500012
015001              SET PS-ALLOCATION-FOUND-YES TO TRUE                 01500125
015002         WHEN SQLCODE = +100                                      01500212
015003              SET PS-ALLOCATION-FOUND-NO  TO TRUE                 01500351
015004         WHEN SQLWARN0 NOT = SPACE                                01500425
015005         WHEN SQLCODE = -904                                      01500512
015006         WHEN SQLCODE = -911                                      01500625
015007         WHEN SQLCODE = -913                                      01500725
015009              SET TM007-SQL-CONTENTION TO TRUE                    01500986
015010               MOVE SQLCODE            TO TM007-SQLCODE           01501025
015011               MOVE SQLCA              TO TM007-SQLCA             01501125
015012         WHEN OTHER                                               01501225
015013              SET PS-ALLOCATION-FOUND-NO  TO TRUE                 01501351
015014              SET TM007-SQL-UNRECOVERABLE-ERROR TO TRUE           01501486
015015               MOVE SQLCODE            TO TM007-SQLCODE           01501525
015016               MOVE SQLCA              TO TM007-SQLCA             01501625
015031     END-EVALUATE.                                                01503112
015032                                                                  01503212
015033     IF PS-ALLOCATION-FOUND-YES                                   01503325
015034         EXEC SQL                                                 01503412
015035            SELECT COUNT (*)                                      01503512
015036              INTO :PV-COUNT-ALLOC                                01503612
015037              FROM TRECITM A                                      01503753
015038              WHERE A.ORD_NBR     = :DK-PO-NBR                    01503853
015039                AND A.OPER_UNT_ID = :DK-OPER-UNT-ID               01503953
015040                AND A.ORD_LNE_NBR  NOT IN(                        01504053
015041               SELECT B.PO_LNE_NBR                                01504112
015042                 FROM TALLPLN B                                   01504212
015043                     ,TMESTDS C                                   01504312
015044                 WHERE B.PO_NBR = A.ORD_NBR                       01504453
015045                  AND B.PO_NBR = C.PO_NBR                         01504512
015046                  AND B.PO_LNE_NBR =  C.PO_LNE_NBR                01504612
015047                  AND B.PLAN_NBR = C.PLAN_NBR                     01504787
015048                  AND DEST_NBR = A.OPER_UNT_ID)                   01504853
015049         END-EXEC                                                 01504912
015050                                                                  01505012
015051         EVALUATE TRUE                                            01505112
015052              WHEN SQLCODE = +0                                   01505212
015053                   CONTINUE                                       01505315
015054              WHEN SQLWARN0 NOT = SPACE                           01505425
015055              WHEN SQLCODE = -904                                 01505525
015056              WHEN SQLCODE = -911                                 01505625
015057              WHEN SQLCODE = -913                                 01505725
015058                   SET TM007-SQL-CONTENTION TO TRUE               01505886
015059                   MOVE SQLCODE            TO TM007-SQLCODE       01505925
015060                   MOVE SQLCA              TO TM007-SQLCA         01506025
015061              WHEN OTHER                                          01506125
015062                   SET TM007-SQL-UNRECOVERABLE-ERROR TO TRUE      01506286
015064                   MOVE SQLCODE            TO TM007-SQLCODE       01506425
015065                   MOVE SQLCA              TO TM007-SQLCA         01506525
015066         END-EVALUATE.                                            01506625
015067                                                                  01506725
015119******************************************************************01511999
015120* GATHER INFORMATION TO PASS TO TMKCS520 TO HELP WITH DOING      *01512012
015121* THE REDISTRO                                                   *01512112
015122******************************************************************01512299
015123 2020-GET-REC-PO-INFO.                                            01512313
015125     MOVE '2020-GET-REC-PO-INFO'  TO TM007-RETURNED-PARA.         01512522
015129                                                                  01512922
015130     EXEC SQL                                                     01513012
015131           SELECT DISTINCT                                        01513112
015132                  A.ORD_NBR                                       01513213
015133                , A.REC_SEQ_NBR                                   01513313
015134                , A.PKGNG_CDE                                     01513413
015135                , B.PO_NBR                                        01513513
015136                , B.PO_TYP_CDE                                    01513613
015137                , B.SEASET_SHRT_NM                                01513713
015138           INTO                                                   01513812
015139                 :RECEIV-ORD-NBR                                  01513913
015140                ,:RECEIV-REC-SEQ-NBR                              01514046
015141                ,:RECEIV-PKGNG-CDE                                01514113
015142                ,:PURCHS-PO-NBR                                   01514213
015143                ,:PURCHS-PO-TYP-CDE                               01514313
015144                ,:PURCHS-SEASET-SHRT-NM                           01514413
015145           FROM   TRECEIV A                                       01514512
015146                 ,TPURCHS B                                       01514613
015147           WHERE  A.ORD_NBR           = :DK-PO-NBR                01514712
015148             AND  A.REC_SEQ_NBR       = :DK-REC-SEQ-NBR           01514812
015149             AND  A.ORD_NBR           = B.PO_NBR                  01514950
015151             AND  B.VER_STATUS_CDE    = :PC-A                     01515195
015152     END-EXEC.                                                    01515212
015153                                                                  01515312
015154     EVALUATE TRUE                                                01515412
015155         WHEN SQLCODE = +0                                        01515512
015156           MOVE RECEIV-PKGNG-CDE       TO PV-PACKAGING-CDE        01515672
015158           SET PS-PKGNG-TYPE-CHECK-OK  TO TRUE                    01515831
015159         WHEN SQLCODE = +100                                      01515912
015160              CONTINUE                                            01516012
015163         WHEN SQLWARN0 NOT = SPACE                                01516326
015164         WHEN SQLCODE = -904                                      01516426
015165         WHEN SQLCODE = -911                                      01516526
015166         WHEN SQLCODE = -913                                      01516626
015167              SET TM007-SQL-CONTENTION TO TRUE                    01516786
015169               MOVE SQLCODE            TO TM007-SQLCODE           01516926
015170               MOVE SQLCA              TO TM007-SQLCA             01517026
015171         WHEN OTHER                                               01517126
015172              SET TM007-SQL-UNRECOVERABLE-ERROR TO TRUE           01517286
015174               MOVE SQLCODE            TO TM007-SQLCODE           01517426
015175               MOVE SQLCA              TO TM007-SQLCA             01517526
015176     END-EVALUATE.                                                01517626
015195                                                                  01519512
015196******************************************************************01519699
015197* CHECK PKGNG CODE AND SEASET TO DETERMINE PROCESSING.           *01519719
015198******************************************************************01519899
015199 2030-FIND-ALLOC-REDISTRO-PATH.                                   01519915
015200                                                                  01520015
015201*---------------------*                                           01520199
015202*  NON PACK BY STORE  *  * PACKAGING CODE (C, S, M, I) *          01520299
015203*---------------------*                                           01520399
015204     IF PV-PACKAGING-NON-PBS                                      01520499
015205         PERFORM 6000-NON-PACK-BY-STORE                           01520599
015206     END-IF.                                                      01520699
015213                                                                  01521315
015214*-----------------*                                               01521499
015215*  PACK BY STORE  *  * PACKAGING CODE (SPACES) *                  01521599
015216*-----------------*                                               01521699
015217     IF PV-PACKAGING-PBS                                          01521799
015218         PERFORM 6100-PACK-BY-STORE                               01521899
015219     END-IF.                                                      01521999
015220                                                                  01522099
015234*--------*                                                        01523499
015235*  BULK  *  * PACKAGING CODE (B) *                                01523599
015236*--------*                                                        01523699
015237     IF PV-PACKAGING-BULK                                         01523799
015238         PERFORM 6200-BULK-PACKAGING                              01523899
015239     END-IF.                                                      01523999
015240                                                                  01524099
015241*--------*                                                        01524199
015242* NONE OF THE ABOVE PACKAGING CODES       *                       01524299
015243* SET AUTO REDISTRO FAILED SWITCH TO TRUE *                       01524399
015244*--------*                                                        01524499
015245     IF PV-PACKAGING-CDE NOT = ('B' AND 'C' AND 'S' AND 'M'       01524599
015246                                   AND 'I' AND SPACE)             01524699
015248         SET TM007-AUTO-REDISTRO-FAILED  TO TRUE                  01524899
015249     END-IF.                                                      01524999
015300                                                                  01530015
015301******************************************************************01530199
015302* MOVE KEY FIELDS TO HOLDING AREA                                *01530294
015303******************************************************************01530399
015304 2060-MOVE-KEY-FIELDS.                                            01530494
015305      MOVE TM007-PO-NBR       TO DK-PO-NBR.                       01530594
015306      MOVE TM007-OPER-UNT-ID  TO DK-OPER-UNT-ID.                  01530694
015307      MOVE TM007-REC-SEQ-NBR  TO DK-REC-SEQ-NBR.                  01530794
015308                                                                  01530894
015309******************************************************************01530999
015310* CHECK IF PACK OR LINE LEVEL AND SET SWITCH                     *01531094
015311******************************************************************01531199
015312 2070-CHK-PACK-LINE-LEVEL.                                        01531294
015313* PACKAGING CODE = (M, I)                                         01531399
015314      IF PV-PACKAGING-PREPACK                                     01531494
015316          SET TM500-PACK-LEVEL   TO TRUE                          01531694
015317      ELSE                                                        01531799
015319* PACKAGING CODE = (B, S, C)                                      01531994
015320          SET TM500-LINE-LEVEL   TO TRUE                          01532094
015321      END-IF.                                                     01532194
015322                                                                  01532299
015323******************************************************************01532399
015324*----------------------------------------------------------------*01532493
015325* DETERMINE IF THIS PO/RECEIVER IS A CANDIDATE TO BE CHANGED      01532593
015326* FROM A BULK TO A PBS.                                           01532693
015327* IT WILL BE DONE AUTOMATICALLY WHEN THE ALL FOLLOWING CONDITIONS 01532793
015328* ARE MET:                                                        01532893
015329*        1. RECEIVER PACKAGING CODE IS A "B"                      01532993
015330*        2. PO_TYP_CDE = 'FB' OR 'IF'                             01533093
015331*        3. SEASONAL SHORT NAME STARTS WITH 'FBP__'               01533193
015332*        4. FOR ALL OF THE LINES, THE STORE NMBR IS THE SAME      01533293
015333*           FOR ALL LINES.                                        01533393
015334*        5. ALSO, YOU CAN ONLY HAVE ONE ACTIVE PACKSLIP WHEN      01533493
015335*           DOING THIS FOR A PBS.                                 01533593
015336* WHEN THE CONDITIONS ABOVE ARE MET, THE RECEIVING PACKAGING CODE 01533693
015337* WILL BE CHANGED TO A PBS (SPACES) AND PACK-BY-STR-IND = "Y" ON  01533793
015338* TRECEIV, AND THE PACKSLIP HEADER(S) THAT ARE ACTIVE WILL BE     01533893
015339* UPDATED TO HAVE THE STORE NUMBER IN IT.                         01533993
015340* IF THERE IS MORE THAN ONE STORE NUMBER, THE PROCESS WILL        01534093
015341* CONTINUE TO PROCESS THE PO/RECEIVER AS A BULK.  IT WILL NOT     01534193
015342* CREATE NEW PACKSLIPS FOR MULTIPLE STORES.                       01534293
015343*----------------------------------------------------------------*01534393
015344******************************************************************01534499
015345 3000-CHECK-FLOWBACK-AUTO-PBS.                                    01534593
015346                                                                  01534693
015349     MOVE '3000-CHECK-FLOWBACK-AUTO-PBS' TO TM007-RETURNED-PARA.  01534993
015350                                                                  01535093
015351     MOVE ZEROES                TO PV-PBS-STORE-COUNT.            01535193
015352                                                                  01535293
015353*FIRST CHECK THAT THERE IS ONLY ONE STORE FOR THE ALLOCATION      01535393
015354                                                                  01535493
015355     EXEC SQL                                                     01535593
015356        SELECT COUNT (*) AS TOT2                                  01535693
015357        INTO  :PV-PBS-STORE-COUNT                                 01535793
015358        FROM (SELECT COUNT (*)                                    01535893
015359               FROM TALLPLN A                                     01535993
015360                   ,TMESTDS B                                     01536093
015361              WHERE A.PO_NBR    = :DK-PO-NBR                      01536193
015362               AND DEST_NBR     = :DK-OPER-UNT-ID                 01536293
015363               AND A.PO_NBR     = B.PO_NBR                        01536393
015364               AND A.PO_LNE_NBR = B.PO_LNE_NBR                    01536493
015365               AND A.PLAN_NBR   = B.PLAN_NBR                      01536593
015366              GROUP BY                                            01536693
015367                    STR_NBR) TOT1                                 01536793
015368     END-EXEC.                                                    01536893
015369                                                                  01536993
015370     EVALUATE TRUE                                                01537093
015371         WHEN SQLCODE = +0                                        01537193
015372              CONTINUE                                            01537293
015373         WHEN SQLWARN0 NOT = SPACE                                01537393
015374         WHEN SQLCODE = -904                                      01537493
015375         WHEN SQLCODE = -911                                      01537593
015376         WHEN SQLCODE = -913                                      01537693
015377              SET TM007-SQL-CONTENTION TO TRUE                    01537793
015378              SET PS-DONE              TO TRUE                    01537893
015379              MOVE SQLCODE             TO TM007-SQLCODE           01537994
015380              MOVE SQLCA               TO TM007-SQLCA             01538094
015381         WHEN OTHER                                               01538193
015382              SET PS-DONE              TO TRUE                    01538293
015383              SET TM007-SQL-UNRECOVERABLE-ERROR                   01538393
015384                                       TO TRUE                    01538493
015385              MOVE SQLCODE             TO TM007-SQLCODE           01538593
015386              MOVE SQLCA               TO TM007-SQLCA             01538693
015387     END-EVALUATE.                                                01538793
015388                                                                  01538893
015389                                                                  01538993
015390     MOVE ZEROES                TO PV-PBS-PKSLIP-COUNT.           01539093
015391                                                                  01539193
015392*THEN CHECK THAT THERE IS ONLY ONE ACTIVE PACKSLIP FOR RECEIVER   01539293
015393                                                                  01539393
015394     EXEC SQL                                                     01539493
015395       SELECT COUNT (*)                                           01539593
015396         INTO  :PV-PBS-PKSLIP-COUNT                               01539693
015397         FROM TPKSLIP                                             01539793
015398        WHERE PO_NBR           = :DK-PO-NBR                       01539893
015399          AND OPER_UNT_ID      = :DK-OPER-UNT-ID                  01539993
015400          AND REC_SEQ_NBR      = :DK-REC-SEQ-NBR                  01540093
015401          AND VER_STAT_CDE     = :PC-A                            01540193
015402     END-EXEC.                                                    01540293
015403                                                                  01540393
015404     EVALUATE TRUE                                                01540493
015405         WHEN SQLCODE = +0                                        01540593
015406              CONTINUE                                            01540693
015407         WHEN SQLWARN0 NOT = SPACE                                01540793
015408         WHEN SQLCODE = -904                                      01540893
015409         WHEN SQLCODE = -911                                      01540993
015410         WHEN SQLCODE = -913                                      01541093
015411             SET TM007-SQL-CONTENTION TO TRUE                     01541193
015412             SET PS-DONE              TO TRUE                     01541293
015413             MOVE SQLCODE             TO TM007-SQLCODE            01541393
015414             MOVE SQLCA               TO TM007-SQLCA              01541493
015415         WHEN OTHER                                               01541593
015416              SET PS-DONE                                         01541693
015417                  TM007-SQL-UNRECOVERABLE-ERROR                   01541793
015418                                     TO TRUE                      01541893
015419              MOVE SQLCODE           TO TM007-SQLCODE             01541993
015420              MOVE SQLCA             TO TM007-SQLCA               01542093
015421     END-EVALUATE.                                                01542193
015422                                                                  01542293
015423                                                                  01542393
015424     IF PS-NO-DISTRO-OK                                           01542493
015425        IF PS-NOT-DONE                                            01542593
015426           IF PV-PBS-STORE-COUNT = 1 AND                          01542693
015427              PV-PBS-PKSLIP-COUNT = 1                             01542793
015428*             PERFORM 3100-AUDIT-RECEIV                           01542893
015429              PERFORM 3200-UPDATE-TRECEIV                         01542993
015430              PERFORM 3300-UPDATE-ALL-PKSLIP                      01543093
015432           END-IF                                                 01543293
015433        END-IF                                                    01543393
015434     END-IF.                                                      01543493
015435                                                                  01543593
015436******************************************************************01543699
015437* SINCE THE LINE LEVEL TROUBLE IS DELETED, FOR THIS INSTANT       01543799
015438* ONLY, WE WILL NEED TO LOOK AT THE TROUBLE 426 - STOP AUTO VE    01543899
015439* FLOWBACK TROUBLE TO USE THAT NOTIF NUMBER TO PUT INTO THE       01543999
015440* RCT_AUTOACKNL_TRBL AND SET THAT TO COMPLETE SO THAT THE         01544099
015441* REPORT WILL PICK UP THIS PO/RECEIVER AS BEING COMPLETED.        01544199
015442******************************************************************01544299
015443 3050-GET-426-NOTIF-NBR.                                          01544399
015444                                                                  01544499
015445     EXEC SQL                                                     01544599
015446       SELECT  NOTIF_NBR                                          01544699
015447               ,PO_LNE_NBR                                        01544799
015448         INTO  :TRBNTF-NOTIF-NBR,                                 01544899
015449               :TRBNTF-PO-LNE-NBR                                 01544999
015450         FROM TTRBNTF T                                           01545099
015451         WHERE T.TRBL_RSN_CDE    = :PC-AUTO-VE-STP-FB             01545199
015452           AND T.PO_NBR          = :DK-PO-NBR                     01545299
015453           AND T.REC_SEQ_NBR     = :DK-REC-SEQ-NBR                01545399
015454     END-EXEC.                                                    01545499
015455                                                                  01545599
015456     EVALUATE TRUE                                                01545699
015457       WHEN SQLCODE = +0                                          01545799
015458       WHEN SQLCODE = +100                                        01545899
015459       WHEN SQLCODE = -811                                        01545999
015460            CONTINUE                                              01546099
015461       WHEN SQLWARN0 NOT = SPACES                                 01546199
015462       WHEN SQLCODE      = -904                                   01546299
015463       WHEN SQLCODE      = -911                                   01546399
015464       WHEN SQLCODE      = -913                                   01546499
015465           SET TM007-SQL-CONTENTION TO TRUE                       01546599
015466           MOVE SQLCODE     TO TM007-SQLCODE                      01546699
015467           MOVE SQLCA       TO TM007-SQLCA                        01546799
015468           MOVE '3050-GET-426-NOTIF-NBR'                          01546899
015469                            TO TM007-RETURNED-PARA                01546999
015470                                                                  01547099
015471       WHEN OTHER                                                 01547199
015472           SET TM007-SQL-UNRECOVERABLE-ERROR TO TRUE              01547299
015473           MOVE SQLCODE     TO TM007-SQLCODE                      01547399
015474           MOVE SQLCA       TO TM007-SQLCA                        01547499
015475           MOVE '3050-GET-426-NOTIF-NBR'                          01547599
015476                            TO TM007-RETURNED-PARA                01547699
015482     END-EVALUATE.                                                01548299
015483                                                                  01548399
015484**************************************************************    01548499
015485*CALL TMKUP501 TO INSERT A NEW ROW AS COMPLETE INTO THE           01548599
015486* RCT_AUTOACKNL_TRBL TABLE SO THAT THE REPORT CAN PICK IT UP      01548699
015487* THEN UPDATE IT TO A COMPLETE STATUS TMST.                       01548799
015488**************************************************************    01548899
015489 3051-FOOL-TMKUP501.                                              01548999
015490                                                                  01549099
015491     MOVE DK-PO-NBR                  TO TM007-PO-NBR.             01549199
015492     MOVE DK-REC-SEQ-NBR             TO TM007-REC-SEQ-NBR.        01549299
015493     MOVE DK-OPER-UNT-ID             TO TM007-OPER-UNT-ID.        01549399
015494     MOVE PC-AUTO-VE-STP-FB          TO TM007-TRBL-RSN-CDE.       01549499
015495     MOVE TRBNTF-NOTIF-NBR           TO TM007-NOTIF-NBR.          01549599
015496                                                                  01549699
015497* INSERT THIS AS A COMPLETE STATUS.                               01549799
015498                                                                  01549899
015499     SET TM007-INSERT                                             01549999
015500         TM007-CMPLT-STATUS       TO TRUE.                        01550099
015501                                                                  01550199
015502* CALL TMKUP501                                                   01550299
015503     SET PS-UPDATE-AUTOACKNL-NO   TO TRUE.                        01550399
015504                                                                  01550499
015505     SET PC-CALL-TMKUP501-PGM TO TRUE.                            01550599
015506                                                                  01550699
015507     CALL PC-CALLED-PROGRAM USING  TM007-COMMUNICATIONS-AREA.     01550799
015508                                                                  01550899
015509     EVALUATE TRUE                                                01550999
015510         WHEN TM007-CALL-SUCCESSFUL                               01551099
015511         WHEN TM007-SQLCODE = -803                                01551199
015512             CONTINUE                                             01551299
015513                                                                  01551399
015514         WHEN OTHER                                               01551499
015515             MOVE SQLCODE    TO TM007-SQLCODE                     01551599
015516             MOVE SQLCA      TO TM007-SQLCA                       01551699
015517             MOVE '3051-FOOL-TMKUP501' TO TM007-RETURNED-PARA     01551799
015518     END-EVALUATE.                                                01551899
015519                                                                  01551999
015520* UPDATE IT TO A COMPLETE STATUS TMST.                            01552099
015521                                                                  01552199
015522     SET TM007-UPDATE                                             01552299
015523         TM007-CMPLT-STATUS       TO TRUE.                        01552399
015524                                                                  01552499
015525* CALL TMKUP501                                                   01552599
015526     SET PS-UPDATE-AUTOACKNL-NO   TO TRUE.                        01552699
015527                                                                  01552799
015528     SET PC-CALL-TMKUP501-PGM TO TRUE.                            01552899
015529                                                                  01552999
015530     CALL PC-CALLED-PROGRAM USING  TM007-COMMUNICATIONS-AREA.     01553099
015531                                                                  01553199
015532     EVALUATE TRUE                                                01553299
015533         WHEN TM007-CALL-SUCCESSFUL                               01553399
015534         WHEN TM007-SQLCODE = -803                                01553499
015535             SET PS-UPDATE-AUTOACKNL-YES TO TRUE                  01553599
015536                                                                  01553699
015537         WHEN OTHER                                               01553799
015538             MOVE SQLCODE    TO TM007-SQLCODE                     01553899
015539             MOVE SQLCA      TO TM007-SQLCA                       01553999
015540             MOVE '3051-FOOL-TMKUP501' TO TM007-RETURNED-PARA     01554099
015541     END-EVALUATE.                                                01554199
015542******************************************************************01554299
015543* UPDATE TRECEIV                                                 *01554318
015544******************************************************************01554499
015550 3200-UPDATE-TRECEIV.                                             01555092
015600     MOVE '3200-UPDATE-TRECEIV' TO TM007-RETURNED-PARA.           01560092
015700                                                                  01570022
015800     INITIALIZE DCLTRECEIV.                                       01580022
016200                                                                  01620022
016400     EXEC SQL                                                     01640018
016500         UPDATE TRECEIV                                           01650018
016600            SET PKGNG_CDE      = :PC-SPACE,                       01660049
016610                PACK_BY_ST_IND = :PC-Y,                           01661051
016620                UPD_TMST       = CURRENT TIMESTAMP,               01662051
016630                UPD_PGM_ID     = :PC-CURRENT-MODULE-NAME          01663079
016700          WHERE ORD_NBR        = :DK-PO-NBR                       01670018
016800            AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR                  01680044
016900     END-EXEC.                                                    01690018
017000                                                                  01700018
017100     EVALUATE TRUE                                                01710018
017110                                                                  01711036
017200         WHEN SQLCODE = +0                                        01720036
017300             SET PS-UPDATE-TRECEIV-YES TO TRUE                    01730042
017310                                                                  01731036
017410         WHEN SQLWARN0 NOT = SPACE                                01741036
017420         WHEN SQLCODE      = -904                                 01742036
017430         WHEN SQLCODE      = -911                                 01743036
017440         WHEN SQLCODE      = -913                                 01744036
017450             SET TM007-SQL-CONTENTION TO TRUE                     01745086
017460             MOVE SQLCODE   TO TM007-SQLCODE                      01746036
017470             MOVE SQLCA     TO TM007-SQLCA                        01747036
017471                                                                  01747136
017480         WHEN OTHER                                               01748043
017490             SET TM007-SQL-UNRECOVERABLE-ERROR TO TRUE            01749086
017491             MOVE SQLCODE   TO TM007-SQLCODE                      01749136
017492             MOVE SQLCA     TO TM007-SQLCA                        01749236
017493                                                                  01749336
017500     END-EVALUATE.                                                01750036
017600                                                                  01760036
017700******************************************************************01770099
017800* BECAUSE THERE MAY BE MORE THAN ONE PACKSLIP, WE WILL NEED TO    01780093
017900* UPDATE ALL OF THE ACTIVE PACKSLIPS TO THE STORE NUMBER WHEN     01790093
018000* CHANGING IT TO PACK BY STORE.                                   01800093
018100******************************************************************01810099
018200 3300-UPDATE-ALL-PKSLIP.                                          01820093
018210     MOVE '3300-UPDATE-ALL-PKSLIP' TO TM007-RETURNED-PARA.        01821093
018300                                                                  01830093
018400     PERFORM 3400-OPEN-AUTO-PKSLP-CSR.                            01840093
018500                                                                  01850093
018600     IF PS-NOT-DONE                                               01860093
018610        PERFORM 3410-FETCH-TPKSLIP                                01861093
018620*         UNTIL PS-NO-MORE-PKSLIP-REC OR PS-DONE                  01862093
018630     END-IF.                                                      01863093
018640                                                                  01864093
018650     PERFORM 3420-CLOSE-AUTO-PKSLP-CSR.                           01865093
018660                                                                  01866093
018670******************************************************************01867099
018680*    OPEN AUTO-PKSLP-CSR                                          01868093
018690******************************************************************01869099
018691 3400-OPEN-AUTO-PKSLP-CSR.                                        01869193
018692     MOVE '3400-OPEN-AUTO-PKSLP-CSR' TO TM007-RETURNED-PARA.      01869293
018693                                                                  01869393
018694     EXEC SQL                                                     01869493
018695          OPEN AUTO-PKSLP-CSR                                     01869593
018696     END-EXEC.                                                    01869693
018697                                                                  01869793
018698     EVALUATE TRUE                                                01869893
018699         WHEN SQLCODE = +0                                        01869993
018700             CONTINUE                                             01870093
018701                                                                  01870193
018702         WHEN SQLWARN0 NOT = SPACE                                01870293
018703         WHEN SQLCODE      = -904                                 01870393
018704         WHEN SQLCODE      = -911                                 01870493
018705         WHEN SQLCODE      = -913                                 01870593
018706             SET TM007-SQL-CONTENTION TO TRUE                     01870693
018707             SET PS-DONE              TO TRUE                     01870793
018708             MOVE SQLCODE             TO TM007-SQLCODE            01870893
018709             MOVE SQLCA               TO TM007-SQLCA              01870993
018710                                                                  01871093
018711         WHEN OTHER                                               01871193
018713             SET TM007-SQL-UNRECOVERABLE-ERROR TO TRUE            01871393
018714             MOVE SQLCODE             TO TM007-SQLCODE            01871493
018715             MOVE SQLCA               TO TM007-SQLCA              01871593
018716             MOVE 'UNSUCCESSFUN OPEN OF TPKSLIP'                  01871694
018717                                      TO TM007-RETURN-MSG         01871794
018718                                                                  01871893
018723     END-EVALUATE.                                                01872393
018724                                                                  01872493
018725******************************************************************01872599
018726*    SELECT ALL FROM TPKSLIP TO PREPARE TO VERSION IT.   ALL THAT 01872693
018727*    WILL BE DIFFERENT WILL BE THE STORE DEST NUMBER.             01872793
018728******************************************************************01872899
018729 3410-FETCH-TPKSLIP.                                              01872993
018730                                                                  01873093
018731     MOVE '3410-FETCH-TPKSLIP' TO TM007-RETURNED-PARA.            01873193
018732                                                                  01873293
018733         EXEC SQL                                                 01873393
018734             FETCH  AUTO-PKSLP-CSR                                01873493
018735              INTO :PKSLIP-PO-NBR,                                01873593
018736                   :PKSLIP-SEQ-NBR,                               01873693
018737                   :PKSLIP-CRE-TMST,                              01873793
018738                   :PKSLIP-VER-STAT-CDE,                          01873893
018739                   :PKSLIP-OPER-UNT-ID,                           01873993
018740                   :PKSLIP-FCLTY-ID,                              01874093
018741                   :PKSLIP-PKSL-NBR,                              01874193
018742                   :PKSLIP-STR-DEST-NBR,                          01874293
018743                   :PKSLIP-REC-SEQ-NBR,                           01874393
018744                   :PKSLIP-BOL-NBR,                               01874493
018745                   :PKSLIP-PRO-NBR,                               01874593
018746                   :PKSLIP-PKSL-STAT-CDE,                         01874693
018747                   :PKSLIP-CRE-UID,                               01874793
018748                   :PKSLIP-PO-VER-NBR,                            01874893
018749                   :PKSLIP-CRE-SRC-CDE,                           01874993
018750                   :PKSLIP-EXPTED-PKG-QTY,                        01875093
018751                   :PKSLIP-OWNER-SCAC-ID,                         01875193
018752                   :PKSLIP-ASN-NBR,                               01875293
018753                   :PKSLIP-VEND-SHIP-DTE,                         01875393
018754                   :PKSLIP-SHIPT-ID,                              01875493
018755                   :PKSLIP-PKSL-PG-CNT,                           01875593
018756                   :PKSLIP-CONTNR-ID,                             01875693
018757                   :PKSLIP-ORIG-PKSL-SEQ-NBR                      01875793
018758         END-EXEC                                                 01875893
018759                                                                  01875993
018760         EVALUATE TRUE                                            01876093
018761             WHEN SQLCODE = ZERO                                  01876193
018762                  PERFORM 3500-UPDATE-PKSLIP                      01876293
018763             WHEN SQLCODE = +100                                  01876393
018764                  SET PS-NO-MORE-PKSLIP-REC                       01876493
018765                                       TO TRUE                    01876593
018766             WHEN SQLCODE = -904                                  01876693
018767             WHEN SQLCODE = -911                                  01876793
018768             WHEN SQLCODE = -913                                  01876893
018769                  SET PS-DONE          TO TRUE                    01876993
018770                  SET TM007-SQL-CONTENTION TO TRUE                01877093
018771                  MOVE SQLCODE         TO TM007-SQLCODE           01877193
018772                  MOVE SQLCA           TO TM007-SQLCA             01877293
018773                                                                  01877393
018774             WHEN SQLWARN0 NOT = SPACES                           01877493
018775             WHEN SQLCODE  NOT = ZERO                             01877593
018776                  SET PS-DONE          TO TRUE                    01877693
018777                  SET TM007-SQL-UNRECOVERABLE-ERROR TO TRUE       01877793
018778                  MOVE SQLCODE         TO TM007-SQLCODE           01877894
018779                  MOVE SQLCA           TO TM007-SQLCA             01877993
018780                  MOVE 'UNSUCCESSFUL FETCH OF TPKSLIP'            01878094
018790                                       TO TM007-RETURN-MSG        01879094
018793         END-EVALUATE.                                            01879393
018794                                                                  01879493
018795******************************************************************01879599
018796*    CLOSE AUTO-PKSLP-CSR                                         01879699
018797******************************************************************01879799
018798 3420-CLOSE-AUTO-PKSLP-CSR.                                       01879893
018799                                                                  01879993
018800     MOVE '3420-CLOSE-AUTO-PKSLP-CSR'  TO TM007-RETURNED-PARA.    01880094
018801                                                                  01880194
018802     EXEC SQL                                                     01880293
018803          CLOSE AUTO-PKSLP-CSR                                    01880393
018804     END-EXEC.                                                    01880493
018805                                                                  01880593
018806     EVALUATE TRUE                                                01880694
018807         WHEN SQLCODE = +0                                        01880794
018808             CONTINUE                                             01880894
018809                                                                  01880994
018810         WHEN SQLWARN0 NOT = SPACE                                01881094
018811         WHEN SQLCODE = -904                                      01881194
018812         WHEN SQLCODE = -911                                      01881294
018813         WHEN SQLCODE = -913                                      01881394
018814             SET PS-DONE              TO TRUE                     01881494
018815             SET TM007-SQL-CONTENTION TO TRUE                     01881594
018816             MOVE SQLCODE             TO TM007-SQLCODE            01881694
018817             MOVE SQLCA               TO TM007-SQLCA              01881794
018818                                                                  01881894
018819         WHEN OTHER                                               01881994
018820             SET PS-DONE              TO TRUE                     01882094
018821             MOVE SQLCODE             TO TM007-SQLCODE            01882194
018822             MOVE SQLCA               TO TM007-SQLCA              01882294
018823             SET TM007-SQL-UNRECOVERABLE-ERROR                    01882394
018824                                      TO TRUE                     01882494
018825             MOVE 'UNSUCCESSFUL CLOSE OF TPKSLIP'                 01882594
018826                                      TO TM007-RETURN-MSG         01882694
018827     END-EVALUATE.                                                01882794
018837                                                                  01883793
018838******************************************************************01883899
018839*    UPDATE THE CURRENT PACKSLIP ROW TO INACTIVE AND MOVE THE     01883993
018840*    PBS STORE NUMBER TO THE ACTIVE ROW WHICH WILL BE INSERTED.   01884093
018841******************************************************************01884199
018842 3500-UPDATE-PKSLIP.                                              01884293
018843     MOVE '3500-UPDATE-PKSLIP'   TO TM007-RETURNED-PARA.          01884394
018844                                                                  01884493
018845     PERFORM 3510-SET-CURR-PKSLIP-TO-INACT.                       01884593
018846                                                                  01884693
018847     EXEC SQL                                                     01884793
018848          SELECT DISTINCT STR_NBR                                 01884893
018849            INTO :MESTDS-STR-NBR                                  01884993
018850            FROM TALLPLN A                                        01885093
018851                ,TMESTDS B                                        01885193
018852            WHERE A.PO_NBR     = :DK-PO-NBR                       01885293
018853              AND DEST_NBR     = :DK-OPER-UNT-ID                  01885393
018854              AND A.PO_NBR     = B.PO_NBR                         01885493
018855              AND A.PO_LNE_NBR = B.PO_LNE_NBR                     01885593
018856              AND A.PLAN_NBR   = B.PLAN_NBR                       01885693
018857     END-EXEC.                                                    01885793
018858                                                                  01885893
018859     EVALUATE TRUE                                                01885993
018860       WHEN SQLCODE = +0                                          01886094
018861           MOVE MESTDS-STR-NBR     TO PKSLIP-STR-DEST-NBR         01886193
018862           MOVE DK-REC-SEQ-NBR     TO PKSLIP-REC-SEQ-NBR          01886293
018863           PERFORM 3520-INSERT-NEW-PKSLIP-STATUS                  01886393
018864                                                                  01886494
018865       WHEN SQLWARN0 NOT = SPACE                                  01886594
018866       WHEN SQLCODE = -904                                        01886694
018867       WHEN SQLCODE = -911                                        01886794
018868       WHEN SQLCODE = -913                                        01886894
018869           SET PS-DONE              TO TRUE                       01886994
018870           SET TM007-SQL-CONTENTION TO TRUE                       01887094
018871           MOVE SQLCODE             TO TM007-SQLCODE              01887194
018872           MOVE SQLCA               TO TM007-SQLCA                01887294
018873                                                                  01887394
018874       WHEN OTHER                                                 01887494
018875           SET PS-DONE              TO TRUE                       01887594
018876           SET TM007-SQL-UNRECOVERABLE-ERROR                      01887694
018877                                    TO TRUE                       01887794
018878           MOVE SQLCODE             TO TM007-SQLCODE              01887894
018879           MOVE SQLCA               TO TM007-SQLCA                01887994
018880           MOVE 'UNSUCCESSFUL SELECT OF STR-NBR'                  01888094
018881                                    TO TM007-RETURN-MSG           01888194
018890     END-EVALUATE.                                                01889094
018892                                                                  01889293
018893******************************************************************01889399
018894*    SET THE CURRENT ROW IN TPKSLIP TO INACTIVE.  THIS WILL ONLY  01889493
018895*    HAPPEN WHEN THERE IS A FLOWBACK PO THAT IS MET TO BE CHANGED 01889593
018896*    FROM A BULK TO A PBS.  THE PACKSLIP WILL ALSO NEED TO BE     01889693
018897*    CHANGED TO CONTAIN THE STORE NUMBER IN THE PACKSLIP HEADER.  01889793
018898******************************************************************01889899
018899 3510-SET-CURR-PKSLIP-TO-INACT.                                   01889993
018900                                                                  01890094
018901     MOVE '3510-SET-CURR-PKSLIP-TO-INACT'                         01890194
018902                                       TO TM007-RETURNED-PARA.    01890294
018903         EXEC SQL                                                 01890393
018904           UPDATE TPKSLIP                                         01890493
018905              SET VER_STAT_CDE  = 'I'                             01890593
018906            WHERE PO_NBR        = :DK-PO-NBR                      01890693
018907              AND SEQ_NBR       = :PKSLIP-SEQ-NBR                 01890793
018908              AND REC_SEQ_NBR   = :DK-REC-SEQ-NBR                 01890893
018909              AND OPER_UNT_ID   = :DK-OPER-UNT-ID                 01890993
018910              AND VER_STAT_CDE  = 'A'                             01891093
018911         END-EXEC.                                                01891193
018912                                                                  01891293
018913         EVALUATE TRUE                                            01891393
018914             WHEN SQLCODE = ZERO                                  01891493
018915                  CONTINUE                                        01891593
018916             WHEN SQLCODE = -904                                  01891693
018917             WHEN SQLCODE = -911                                  01891793
018918             WHEN SQLCODE = -913                                  01891893
018919                  SET PS-DONE              TO TRUE                01891994
018920                  SET TM007-SQL-CONTENTION TO TRUE                01892094
018921                  MOVE SQLCODE             TO TM007-SQLCODE       01892194
018922                  MOVE SQLCA               TO TM007-SQLCA         01892294
018924                                                                  01892493
018925             WHEN SQLWARN0 NOT = SPACES                           01892593
018926             WHEN SQLCODE  NOT = ZERO                             01892693
018927                  SET PS-DONE              TO TRUE                01892794
018928                  SET TM007-SQL-UNRECOVERABLE-ERROR               01892894
018929                                           TO TRUE                01892994
018930                  MOVE SQLCODE             TO TM007-SQLCODE       01893094
018931                  MOVE SQLCA               TO TM007-SQLCA         01893194
018932                  MOVE 'UNSUCCESSFUL UPDATE OF TPKSLIP'           01893293
018933                                   TO TM007-RETURN-MSG            01893394
018940         END-EVALUATE.                                            01894093
018941                                                                  01894193
018942                                                                  01894293
018943******************************************************************01894399
018944*    INSERT NEW PACKSLIP HEADER FOR FLOWBACK PO THAT WAS CHANGED  01894493
018945*    ON THE RECEIVING END FROM BULK TO PBS.  THE ONLY DIFFERENCE  01894593
018946*    IS THE STORE NUMBER.                                         01894693
018947******************************************************************01894799
018948 3520-INSERT-NEW-PKSLIP-STATUS.                                   01894893
018949                                                                  01894993
018950     MOVE '3520-INSERT-NEW-PKSLIP-STATUS'                         01895094
018951                                      TO TM007-RETURNED-PARA.     01895194
018952         EXEC SQL                                                 01895294
018953             INSERT INTO TPKSLIP                                  01895394
018954                   (PO_NBR,                                       01895494
018955                    SEQ_NBR,                                      01895594
018956                    CRE_TMST,                                     01895694
018957                    VER_STAT_CDE,                                 01895794
018958                    OPER_UNT_ID,                                  01895894
018959                    FCLTY_ID,                                     01895994
018960                    PKSL_NBR,                                     01896094
018961                    STR_DEST_NBR,                                 01896194
018962                    REC_SEQ_NBR,                                  01896294
018963                    SHIPT_ID,                                     01896394
018964                    BOL_NBR,                                      01896494
018965                    PRO_NBR,                                      01896594
018966                    PKSL_STAT_CDE,                                01896694
018967                    CRE_UID,                                      01896794
018968                    PO_VER_NBR,                                   01896894
018969                    CRE_SRC_CDE,                                  01896994
018970                    EXPTED_PKG_QTY,                               01897094
018971                    OWNER_SCAC_ID,                                01897194
018972                    ASN_NBR,                                      01897294
018973                    VEND_SHIP_DTE,                                01897394
018974                    PKSL_PG_CNT,                                  01897494
018975                    CONTNR_ID,                                    01897594
018976                    ORIG_PKSL_SEQ_NBR)                            01897694
018977            VALUES (:DK-PO-NBR,                                   01897794
018978                    :PKSLIP-SEQ-NBR,                              01897894
018979                    CURRENT TIMESTAMP,                            01897994
018980                    'A',                                          01898094
018981                    :PKSLIP-OPER-UNT-ID,                          01898194
018982                    :PKSLIP-FCLTY-ID,                             01898294
018983                    :PKSLIP-PKSL-NBR,                             01898394
018984                    :PKSLIP-STR-DEST-NBR,                         01898494
018985                    :PKSLIP-REC-SEQ-NBR,                          01898594
018986                    :PKSLIP-SHIPT-ID,                             01898694
018987                    :PKSLIP-BOL-NBR,                              01898794
018988                    :PKSLIP-PRO-NBR,                              01898894
018989                    'AC',                                         01898994
018990                    :PC-SYSTEM-PBS,                               01899099
018991                    :PKSLIP-PO-VER-NBR,                           01899194
018992                    :PKSLIP-CRE-SRC-CDE,                          01899294
018993                    :PKSLIP-EXPTED-PKG-QTY,                       01899394
018994                    :PKSLIP-OWNER-SCAC-ID,                        01899494
018995                    :PKSLIP-ASN-NBR,                              01899594
018996                    :PKSLIP-VEND-SHIP-DTE,                        01899694
018997                    :PKSLIP-PKSL-PG-CNT,                          01899794
018998                    :PKSLIP-CONTNR-ID,                            01899894
018999                    :PKSLIP-ORIG-PKSL-SEQ-NBR)                    01899994
019000         END-EXEC                                                 01900094
019001                                                                  01900194
019002         EVALUATE TRUE                                            01900294
019003             WHEN SQLCODE = ZERO                                  01900394
019004                  CONTINUE                                        01900494
019005             WHEN SQLCODE = -904                                  01900594
019006             WHEN SQLCODE = -911                                  01900694
019007             WHEN SQLCODE = -913                                  01900794
019008                  SET PS-DONE              TO TRUE                01900894
019009                  SET TM007-SQL-CONTENTION TO TRUE                01900994
019010                  MOVE SQLCODE             TO TM007-SQLCODE       01901094
019011                  MOVE SQLCA               TO TM007-SQLCA         01901194
019013                                                                  01901394
019014             WHEN SQLWARN0 NOT = SPACES                           01901494
019015             WHEN SQLCODE  NOT = ZERO                             01901594
019016                  SET PS-DONE      TO TRUE                        01901694
019017                  SET TM007-SQL-UNRECOVERABLE-ERROR TO TRUE       01901794
019018                  MOVE SQLCODE     TO TM007-SQLCODE               01901894
019019                  MOVE SQLCA       TO TM007-SQLCA                 01901994
019022                  MOVE 'UNSUCCESSFUL INSERT OF TPKSLIP'           01902294
019023                                   TO TM007-RETURN-MSG            01902394
019037         END-EVALUATE.                                            01903794
020200                                                                  02020074
020202******************************************************************02020299
020203* FOR BULK FLOWBACK WITH A SEASONAL SET CODE LIKE 'FBP%' ONLY.    02020399
020204* WHEN THE RECEIVER PACKAGING CODE OF BULK IS CHANGED TO A PBS,   02020499
020205* DELETE ALL OF THE LINE LEVEL TROUBLES.  THIS IS TO MAKE SURE    02020599
020206* THAT THERE IS NO CONFUSION BETWEEN (FOR EXAMPLE) A "REGULAR     02020699
020207* OVERAGE" (NON-PBS) THAT WOULD NEED TO BE LOOKED AT VERSUS A     02020799
020208* PBS OVERAGE, WHICH DOES NOT NEED TO BE LOOKED AT.               02020899
020209******************************************************************02020999
020210 3550-DELETE-LNE-TRBL.                                            02021099
020211                                                                  02021199
020212     EXEC SQL                                                     02021299
020213          DELETE                                                  02021399
020214            FROM TTRBNTF                                          02021499
020215            WHERE PO_NBR         = :DK-PO-NBR                     02021599
020216              AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR                02021699
020217              AND OPER_UNT_ID    = :DK-OPER-UNT-ID                02021799
020218              AND FCLTY_ID       = :PC-FCLTY-ID                   02021899
020219              AND PO_LNE_NBR     > 0                              02021999
020220     END-EXEC.                                                    02022099
020221                                                                  02022199
020222     EVALUATE TRUE                                                02022299
020223         WHEN SQLCODE = ZERO                                      02022399
020224         WHEN SQLCODE = +100                                      02022499
020225              CONTINUE                                            02022599
020226         WHEN SQLCODE = -904                                      02022699
020227         WHEN SQLCODE = -911                                      02022799
020228         WHEN SQLCODE = -913                                      02022899
020229              SET TM007-SQL-CONTENTION TO TRUE                    02022999
020230              MOVE SQLCODE             TO TM007-SQLCODE           02023099
020231              MOVE SQLCA               TO TM007-SQLCA             02023199
020232              MOVE '3350-DELETE-LNE-TRBL'                         02023299
020233                                       TO TM007-RETURNED-PARA     02023399
020234         WHEN OTHER                                               02023499
020235              SET TM007-SQL-UNRECOVERABLE-ERROR  TO TRUE          02023599
020236              MOVE SQLCODE             TO TM007-SQLCODE           02023699
020237              MOVE SQLCA               TO TM007-SQLCA             02023799
020238              MOVE '3350-DELETE-LNE-TRBL'                         02023899
020239                                       TO TM007-RETURNED-PARA     02023999
020246     END-EVALUATE.                                                02024699
020247                                                                  02024799
020250******************************************************************02025099
020430* FOR ALLOCATING TO PBS, GET THE PACKSLIP INFORMATION.            02043099
020440******************************************************************02044099
020450 3700-PREPARE-FOR-PBS-ALLOC.                                      02045099
020460                                                                  02046099
020470     SET PS-MORE-PKITEM-REC         TO TRUE.                      02047099
020480                                                                  02048099
020490     PERFORM 3710-OPEN-AUTO-PKITEM-CSR.                           02049099
020491                                                                  02049199
020492     IF PS-NOT-DONE                                               02049299
020493        PERFORM 3720-FETCH-TPKITEM                                02049399
020494          UNTIL PS-NO-MORE-PKITEM-REC OR PS-DONE                  02049499
020495     END-IF.                                                      02049599
020496                                                                  02049699
020497     PERFORM 3730-CLOSE-AUTO-PKITEM-CSR.                          02049799
020498                                                                  02049899
020499******************************************************************02049999
020500*    OPEN AUTO-PKITEM-CSR.                                        02050099
020501******************************************************************02050199
020502 3710-OPEN-AUTO-PKITEM-CSR.                                       02050299
020503                                                                  02050399
020504     EXEC SQL                                                     02050499
020505          OPEN PKSLIP-ITEM-CURSOR                                 02050599
020506     END-EXEC.                                                    02050699
020507                                                                  02050799
020508     EVALUATE TRUE                                                02050899
020509         WHEN SQLCODE = +0                                        02050999
020510             CONTINUE                                             02051099
020511                                                                  02051199
020512         WHEN SQLWARN0 NOT = SPACE                                02051299
020513         WHEN SQLCODE      = -904                                 02051399
020514         WHEN SQLCODE      = -911                                 02051499
020515         WHEN SQLCODE      = -913                                 02051599
020516             SET TM007-SQL-CONTENTION TO TRUE                     02051699
020517             SET PS-DONE              TO TRUE                     02051799
020518             MOVE SQLCODE             TO TM007-SQLCODE            02051899
020519             MOVE SQLCA               TO TM007-SQLCA              02051999
020520                                                                  02052099
020521         WHEN OTHER                                               02052199
020522             SET TM007-SQL-UNRECOVERABLE-ERROR TO TRUE            02052299
020523             SET PS-DONE              TO TRUE                     02052399
020524             MOVE SQLCODE             TO TM007-SQLCODE            02052499
020525             MOVE SQLCA               TO TM007-SQLCA              02052599
020526             MOVE 'UNSUCCESSFUN OPEN OF TPKITEM'                  02052699
020527                                      TO TM007-RETURN-MSG         02052799
020528                                                                  02052899
020529     END-EVALUATE.                                                02052999
020545                                                                  02054599
020546******************************************************************02054699
020547*    SELECT ALL FROM TPKSLIP TO PREPARE TO VERSION IT.   ALL THAT 02054799
020548*    WILL BE DIFFERENT WILL BE THE STORE DEST NUMBER.             02054899
020549******************************************************************02054999
020550 3720-FETCH-TPKITEM.                                              02055099
020551                                                                  02055199
020552         EXEC SQL                                                 02055299
020553             FETCH  PKSLIP-ITEM-CURSOR                            02055399
020554              INTO :PV-PKSL-ITM-QTY,                              02055499
020555                   :PKITEM-PKSL-LNE-NBR                           02055599
020556         END-EXEC                                                 02055699
020557                                                                  02055799
020558         EVALUATE TRUE                                            02055899
020559             WHEN SQLCODE = ZERO                                  02055999
020560                  PERFORM 3800-PREPARE-TRECDIS-FOR-PBS            02056099
020569             WHEN SQLCODE = +100                                  02056999
020570                  SET PS-NO-MORE-PKITEM-REC                       02057099
020571                                           TO TRUE                02057199
020572             WHEN SQLCODE = -904                                  02057299
020573             WHEN SQLCODE = -911                                  02057399
020574             WHEN SQLCODE = -913                                  02057499
020575                  SET PS-DONE              TO TRUE                02057599
020576                  SET TM007-SQL-CONTENTION TO TRUE                02057699
020577                  MOVE SQLCODE             TO TM007-SQLCODE       02057799
020578                  MOVE SQLCA               TO TM007-SQLCA         02057899
020579                                                                  02057999
020580             WHEN SQLWARN0 NOT = SPACES                           02058099
020581             WHEN SQLCODE  NOT = ZERO                             02058199
020582                  SET PS-DONE                        TO TRUE      02058299
020583                  SET TM007-SQL-UNRECOVERABLE-ERROR  TO TRUE      02058399
020584                  MOVE SQLCODE             TO TM007-SQLCODE       02058499
020585                  MOVE SQLCA               TO TM007-SQLCA         02058599
020586                  MOVE 'UNSUCCESSFUL FETCH OF PKITEM'             02058699
020587                                       TO TM007-RETURN-MSG        02058799
020590                                                                  02059099
020591         END-EVALUATE.                                            02059199
020592                                                                  02059299
020593******************************************************************02059399
020594*   CLOSE THE AUTO PKITEM CURSOR                                  02059499
020595******************************************************************02059599
020596 3730-CLOSE-AUTO-PKITEM-CSR.                                      02059699
020597                                                                  02059799
020598     EXEC SQL                                                     02059899
020599          CLOSE PKSLIP-ITEM-CURSOR                                02059999
020600     END-EXEC.                                                    02060099
020601                                                                  02060199
020602     EVALUATE TRUE                                                02060299
020603         WHEN SQLCODE = +0                                        02060399
020604             CONTINUE                                             02060499
020605                                                                  02060599
020606         WHEN SQLWARN0 NOT = SPACE                                02060699
020607         WHEN SQLCODE      = -904                                 02060799
020608         WHEN SQLCODE      = -911                                 02060899
020609         WHEN SQLCODE      = -913                                 02060999
020610             SET TM007-SQL-CONTENTION TO TRUE                     02061099
020611             SET PS-DONE              TO TRUE                     02061199
020612             MOVE SQLCODE             TO TM007-SQLCODE            02061299
020613             MOVE SQLCA               TO TM007-SQLCA              02061399
020614                                                                  02061499
020615         WHEN OTHER                                               02061599
020616             SET TM007-SQL-UNRECOVERABLE-ERROR TO TRUE            02061699
020617             SET PS-DONE              TO TRUE                     02061799
020618             MOVE SQLCODE             TO TM007-SQLCODE            02061899
020619             MOVE SQLCA               TO TM007-SQLCA              02061999
020620             MOVE 'UNSUCCESSFUN CLOSE OF TPKITEM'                 02062099
020621                                      TO TM007-RETURN-MSG         02062199
020622                                                                  02062299
020623     END-EVALUATE.                                                02062399
020624                                                                  02062499
020640******************************************************************02064099
020641* IF EVERYTHING IS OK WITH THE PBS OVERAGE, WE WILL INSERT RECORDS02064199
020642* INTO TRECDIS.  NOTE: THIS IS A COPY FROM PROGRAM RCKCS213 THAT  02064299
020643* DOES THIS DURING TRANSCRIPTION.                                 02064399
020644******************************************************************02064499
020645 3800-PREPARE-TRECDIS-FOR-PBS.                                    02064599
020646                                                                  02064699
020647     INITIALIZE DCLTRECDIS.                                       02064799
020648                                                                  02064899
020649     MOVE DK-PO-NBR          TO RECDIS-ORD-NBR.                   02064999
020650     MOVE PKITEM-PKSL-LNE-NBR                                     02065099
020651                             TO RECDIS-ORD-LNE-NBR.               02065199
020652     MOVE DK-REC-SEQ-NBR     TO RECDIS-REC-SEQ-NBR.               02065299
020653     MOVE DK-OPER-UNT-ID     TO RECDIS-OPER-UNT-ID.               02065399
020654     MOVE PC-CURRENT-MODULE-NAME                                  02065499
020655                             TO RECDIS-CRE-UID.                   02065599
020656     MOVE 'A'                TO RECDIS-VER-STATUS-CDE.            02065699
020657     MOVE PV-PKSL-ITM-QTY    TO RECDIS-EXPTED-ITM-QTY             02065799
020658                                RECDIS-VERIFY-ITM-QTY.            02065899
020659     MOVE MESTDS-STR-NBR     TO RECDIS-STR-NBR.                   02065999
020660     MOVE 1                  TO RECDIS-FCLTY-ID.                  02066099
020661     MOVE 1                  TO RECDIS-STR-FCLTY-ID.              02066199
020662                                                                  02066299
020663     MOVE PC-DEFAULT-DATE    TO RECDIS-AP-PRC-DTE.                02066399
020664                                                                  02066499
020665     PERFORM 3810-INSERT-TRECDIS.                                 02066599
020666                                                                  02066699
020667******************************************************************02066799
020668**   INSERT TRECDIS ONE LINE AT A TIME FOR PBS FLOWBACK           02066899
020669******************************************************************02066999
020670 3810-INSERT-TRECDIS.                                             02067099
020671                                                                  02067199
020672         EXEC SQL                                                 02067299
020673              INSERT INTO TRECDIS                                 02067399
020674                     (ORD_NBR                                     02067499
020675                   ,  ORD_LNE_NBR                                 02067599
020676                   ,  REC_SEQ_NBR                                 02067699
020677                   ,  OPER_UNT_ID                                 02067799
020678                   ,  FCLTY_ID                                    02067899
020679                   ,  CRE_TMST                                    02067999
020680                   ,  CRE_UID                                     02068099
020681                   ,  VER_STATUS_CDE                              02068199
020682                   ,  EXPTED_ITM_QTY                              02068299
020683                   ,  VERIFY_ITM_QTY                              02068399
020684                   ,  AP_VERIFY_ITM_QTY                           02068499
020685                   ,  STR_NBR                                     02068599
020686                   ,  STR_FCLTY_ID                                02068699
020687                   ,  PLAN_ITM_QTY                                02068799
020688                   ,  AP_PRC_CDE                                  02068899
020689                   ,  AP_PRC_DTE)                                 02068999
020690              VALUES (:RECDIS-ORD-NBR                             02069099
020691                   ,  :RECDIS-ORD-LNE-NBR                         02069199
020692                   ,  :RECDIS-REC-SEQ-NBR                         02069299
020693                   ,  :RECDIS-OPER-UNT-ID                         02069399
020694                   ,  :RECDIS-FCLTY-ID                            02069499
020695                   ,  CURRENT TIMESTAMP                           02069599
020696                   ,  :RECDIS-CRE-UID                             02069699
020697                   ,  :RECDIS-VER-STATUS-CDE                      02069799
020698                   ,  :RECDIS-EXPTED-ITM-QTY                      02069899
020699                   ,  :RECDIS-VERIFY-ITM-QTY                      02069999
020700                   ,  :RECDIS-AP-VERIFY-ITM-QTY                   02070099
020701                   ,  :RECDIS-STR-NBR                             02070199
020702                   ,  :RECDIS-STR-FCLTY-ID                        02070299
020703                   ,  :RECDIS-PLAN-ITM-QTY                        02070399
020704                   ,  :RECDIS-AP-PRC-CDE                          02070499
020705                   ,  :RECDIS-AP-PRC-DTE)                         02070599
020706         END-EXEC                                                 02070699
020707                                                                  02070799
020708         EVALUATE TRUE                                            02070899
020709             WHEN SQLCODE = +0                                    02070999
020710                  CONTINUE                                        02071099
020711             WHEN SQLCODE = -904                                  02071199
020712             WHEN SQLCODE = -911                                  02071299
020713             WHEN SQLCODE = -913                                  02071399
020714                  SET TM007-SQL-CONTENTION TO TRUE                02071499
020715                  MOVE SQLCODE             TO TM007-SQLCODE       02071599
020716                  MOVE SQLCA               TO TM007-SQLCA         02071699
020717             WHEN OTHER                                           02071799
020718                 SET PS-DONE       TO TRUE                        02071899
020719                 SET TM007-SQL-UNRECOVERABLE-ERROR TO TRUE        02071999
020720                 MOVE SQLCODE              TO TM007-SQLCODE       02072099
020721                 MOVE SQLCA                TO TM007-SQLCA         02072199
020722                 MOVE 'DB2 ERROR INSERTING A PACK BY STR RECDIS'  02072299
020723                                   TO TM007-RETURN-MSG            02072399
020800         END-EVALUATE.                                            02080099
020900                                                                  02090099
056610******************************************************************05661017
056620**  CALL THE MODULE TO PROCESS TROUBLE CENTRAL PROCESSING       **05662017
056630**         (TMKUP508) OR (TMKUP520)                             **05663025
056650******************************************************************05665017
056660 4000-TRBL-CENTRAL-PROCESSING.                                    05666092
056670     MOVE '4000-TRBL-CENTRAL-PROCESSING' TO TM007-RETURNED-PARA.  05667092
056697                                                                  05669739
056698     IF PC-CALL-TMKUP520-PGM                                      05669877
056700         MOVE TM007-PO-NBR               TO TM500-PO-NBR          05670077
056701         MOVE TM007-REC-SEQ-NBR          TO TM500-REC-SEQ-NBR     05670177
056702         MOVE TM007-OPER-UNT-ID          TO TM500-OPER-UNT-ID     05670277
056703         MOVE PC-FCLTY-ID                TO TM500-FCLTY-ID        05670391
056704                                                                  05670455
056712         CALL PC-CALLED-PROGRAM  USING TM500-FIELDS               05671277
056713                                       TM007-COMMUNICATIONS-AREA  05671389
056714     END-IF                                                       05671477
056715                                                                  05671577
056716     IF PC-CALL-TMKUP508-PGM                                      05671677
056717         MOVE TM007-PO-NBR               TO TM508-PO-NBR          05671777
056718         MOVE TM007-REC-SEQ-NBR          TO TM508-REC-SEQ-NBR     05671877
056719         MOVE TM007-OPER-UNT-ID          TO TM508-OPER-UNT-ID     05671977
056720         MOVE PC-FCLTY-ID                TO TM508-FCLTY-ID        05672077
056721                                                                  05672177
056722         CALL PC-CALLED-PROGRAM  USING TM500-FIELDS               05672277
056723                                       TM007-COMMUNICATIONS-AREA  05672389
056724                                                                  05672488
056725     END-IF.                                                      05672599
056728                                                                  05672834
056758******************************************************************05675899
056759* CHECK EXTERNAL SQL RETURN INFORMATION                          *05675986
056760******************************************************************05676099
056761 4100-EXTERNAL-SQL-ERROR-CHECK.                                   05676199
056762                                                                  05676236
056765*  SET RETURN CODE FOR CONTENTION OR UNRECOVERABLE ERROR          05676585
056766     IF TM007-SQLCODE = +0                                        05676685
056768         SET TM007-SQL-SUCCESSFUL TO TRUE                         05676885
056769     ELSE                                                         05676985
056774         IF TM007-SQLCODE = -904 OR -911 OR -913                  05677486
056775             SET TM007-SQL-CONTENTION TO TRUE                     05677586
056776         ELSE                                                     05677686
056777             SET TM007-SQL-UNRECOVERABLE-ERROR TO TRUE            05677786
056779         END-IF                                                   05677985
056780     END-IF.                                                      05678085
056781                                                                  05678181
056812                                                                  05681299
056813******************************************************************05681399
056814*    DELETE ENTIRE TRECDIS FOR PO / RECEIVER BEFORE DOING A       05681499
056815*    REDISTRO                                                     05681599
056816******************************************************************05681699
056817 5400-DELETE-TRECDIS.                                             05681799
056818                                                                  05681899
056819     EXEC SQL                                                     05681999
056820          DELETE                                                  05682099
056821            FROM TRECDIS                                          05682199
056822            WHERE ORD_NBR        = :DK-PO-NBR                     05682299
056823              AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR                05682399
056824              AND OPER_UNT_ID    = :DK-OPER-UNT-ID                05682499
056825              AND FCLTY_ID       = :PC-FCLTY-ID                   05682599
056827     END-EXEC.                                                    05682799
056828                                                                  05682899
056848     EVALUATE TRUE                                                05684899
056849         WHEN SQLCODE = ZERO                                      05684999
056850         WHEN SQLCODE = +100                                      05685099
056851              CONTINUE                                            05685199
056852         WHEN SQLCODE = -904                                      05685299
056853         WHEN SQLCODE = -911                                      05685399
056854         WHEN SQLCODE = -913                                      05685499
056855              SET TM007-SQL-CONTENTION TO TRUE                    05685599
056856              MOVE SQLCODE             TO TM007-SQLCODE           05685699
056857              MOVE SQLCA               TO TM007-SQLCA             05685799
056858              MOVE '5400-DELETE-TRECDIS'                          05685899
056859                                       TO TM007-RETURNED-PARA     05685999
056860         WHEN OTHER                                               05686099
056861              SET TM007-SQL-UNRECOVERABLE-ERROR  TO TRUE          05686199
056862              MOVE SQLCODE             TO TM007-SQLCODE           05686299
056863              MOVE SQLCA               TO TM007-SQLCA             05686399
056864              MOVE '5400-DELETE-TRECDIS'                          05686499
056865                                       TO TM007-RETURNED-PARA     05686599
056866     END-EVALUATE.                                                05686699
056867                                                                  05686799
056868******************************************************************05686899
056869* NON PACK BY STORE -- PACKAGING CODE (C, S, M, I)               *05686999
056870******************************************************************05687099
056871 6000-NON-PACK-BY-STORE.                                          05687199
056872                                                                  05687299
056873** CALL TMKUP520 **                                               05687399
056874     SET TM500-CREATE-AUTO                                        05687499
056875         PC-CALL-TMKUP520-PGM TO TRUE                             05687599
056876     PERFORM 2070-CHK-PACK-LINE-LEVEL                             05687699
056877     PERFORM 4000-TRBL-CENTRAL-PROCESSING                         05687799
056891     PERFORM 4100-EXTERNAL-SQL-ERROR-CHECK.                       05689199
056892                                                                  05689299
056893******************************************************************05689399
056894* PACK BY STORE -- PACKAGING CODE (SPACES)                       *05689499
056895******************************************************************05689599
056896 6100-PACK-BY-STORE.                                              05689699
056897                                                                  05689799
056898** ALLOCATING FOR PBS                                             05689899
056899     PERFORM 3700-PREPARE-FOR-PBS-ALLOC                           05689999
056900                                                                  05690099
056901** CALL TMKUP508 **                                               05690199
056902     SET PC-CALL-TMKUP508-PGM  TO TRUE                            05690299
056903     PERFORM 2070-CHK-PACK-LINE-LEVEL                             05690399
056904     PERFORM 4000-TRBL-CENTRAL-PROCESSING                         05690499
056905                                                                  05690599
056906** CHECK RETURN FROM TMKUP508                                     05690699
056907     EVALUATE TRUE                                                05690799
056908         WHEN TM007-RETURN-CODE = ZERO                            05690899
056909             PERFORM 4100-EXTERNAL-SQL-ERROR-CHECK                05690999
056910         WHEN OTHER                                               05691099
056911             SET TM007-AUTO-REDISTRO-FAILED TO TRUE               05691199
056912             PERFORM 4100-EXTERNAL-SQL-ERROR-CHECK                05691299
056913     END-EVALUATE.                                                05691399
056914                                                                  05691499
056915* JAK 05/2007 ADD CALL TO SHIPPING CONTROL MODULE                 05691599
056916     IF TM007-SQL-SUCCESSFUL                                      05691699
056917         PERFORM 7030-SELECT-TRECEIV                              05691799
056918         PERFORM 7000-CHECK-ASNDWN                                05691899
056919         IF PS-ASNS-TO-WMS-YES                                    05691999
056922             PERFORM 7010-GET-TRIP-ID                             05692299
056923             IF PS-TRIP-FND-YES                                   05692399
056924                 PERFORM 7020-CALL-WMS-MODULE                     05692499
056925             END-IF                                               05692599
056927         END-IF                                                   05692799
056928     END-IF.                                                      05692899
056929* JAK 05/2007 END                                                 05692999
056930                                                                  05693099
056931******************************************************************05693199
056932* BULK -- PACKAGING CODE (B)                                     *05693299
056933******************************************************************05693399
056934 6200-BULK-PACKAGING.                                             05693499
056935                                                                  05693599
056936     IF PURCHS-PO-TYP-CDE NOT = (PC-FB AND PC-IF)                 05693699
056937         SET TM500-CREATE-AUTO    TO TRUE                         05693799
056938** CALL TMKUP520 **                                               05693899
056939         SET PC-CALL-TMKUP520-PGM TO TRUE                         05693999
056940         PERFORM 2070-CHK-PACK-LINE-LEVEL                         05694099
056941         PERFORM 4000-TRBL-CENTRAL-PROCESSING                     05694199
056942         PERFORM 4100-EXTERNAL-SQL-ERROR-CHECK                    05694299
056943     ELSE                                                         05694399
056944         IF PURCHS-SEASET-SHRT-NM (1:3) NOT = PC-FBP              05694499
056945             SET TM500-CREATE-AUTO    TO TRUE                     05694599
056946** CALL TMKUP520 **                                               05694699
056947             SET PC-CALL-TMKUP520-PGM TO TRUE                     05694799
056948             PERFORM 2070-CHK-PACK-LINE-LEVEL                     05694899
056949             PERFORM 4000-TRBL-CENTRAL-PROCESSING                 05694999
056950             PERFORM 4100-EXTERNAL-SQL-ERROR-CHECK                05695099
056951         ELSE                                                     05695199
056952             IF PURCHS-PO-TYP-CDE = (PC-FB OR PC-IF)              05695299
056953                AND PURCHS-SEASET-SHRT-NM (1:3) = PC-FBP          05695399
056954                AND PS-NOT-DONE                                   05695499
056955                  SET PS-MORE-PKSLIP-REC TO TRUE                  05695599
056956** CHECK FLOWBACK AUTO PBS **                                     05695699
056957                  PERFORM 3000-CHECK-FLOWBACK-AUTO-PBS            05695799
056958                  IF PS-UPDATE-TRECEIV-YES                        05695899
056959                      MOVE ' ' TO PV-PACKAGING-CDE                05695999
056960                      PERFORM 2070-CHK-PACK-LINE-LEVEL            05696099
056961                      PERFORM 5400-DELETE-TRECDIS                 05696199
056962                      PERFORM 3700-PREPARE-FOR-PBS-ALLOC          05696299
056963                      PERFORM 3550-DELETE-LNE-TRBL                05696399
056964                      PERFORM 3050-GET-426-NOTIF-NBR              05696499
056965** CALL TMKUP501 **                                               05696599
056966                      PERFORM 3051-FOOL-TMKUP501                  05696699
056967** CHECK RETURN FROM TMKUP501                                     05696799
056968                      IF PS-UPDATE-AUTOACKNL-YES                  05696899
056969** CALL TMKUP508 **                                               05696999
056970                          SET PC-CALL-TMKUP508-PGM TO TRUE        05697099
056971                          PERFORM                                 05697199
056972                              4000-TRBL-CENTRAL-PROCESSING        05697299
056973** CHECK RETURN FROM TMKUP508                                     05697399
056974                          EVALUATE TRUE                           05697499
056975                              WHEN TM007-RETURN-CODE = ZERO       05697599
056976                                  PERFORM                         05697699
056977                                   4100-EXTERNAL-SQL-ERROR-CHECK  05697799
056978                              WHEN OTHER                          05697899
056979                                  SET TM007-AUTO-REDISTRO-FAILED  05697999
056980                                                      TO TRUE     05698099
056981                                  PERFORM                         05698199
056982                                   4100-EXTERNAL-SQL-ERROR-CHECK  05698299
056983                          END-EVALUATE                            05698399
056984                      ELSE                                        05698499
056985                          SET TM007-AUTO-REDISTRO-FAILED          05698599
056986                                                      TO TRUE     05698699
056987                          PERFORM 4100-EXTERNAL-SQL-ERROR-CHECK   05698799
056988                      END-IF                                      05698899
057006                  END-IF                                          05700699
057007             END-IF                                               05700799
057008         END-IF                                                   05700899
057010     END-IF.                                                      05701099
057011                                                                  05701199
057012                                                                  05701299
057020* JAK 05/2007 - ADD CODE TO CALL SHIPMENT CONTROL MODULE          05702099
057021******************************************************************05702199
057022*  THIS PARAGRAPH CHECKS TO SEE IF THE DC IS DOWNLOADING TO WMS   05702299
057023******************************************************************05702399
057024 7000-CHECK-ASNDWN.                                               05702499
057025                                                                  05702599
057026     MOVE RECEIV-OPER-UNT-ID     TO KRPRPM-LOC-ID.                05702699
057027                                                                  05702799
057028     EXEC SQL                                                     05702899
057029          SELECT   FUNC_TXT                                       05702999
057030            INTO  :KRPRPM-FUNC-TXT                                05703099
057031            FROM                                                  05703199
057032                  TKRPRPM                                         05703299
057033            WHERE                                                 05703399
057034                  LOC_ID            = :KRPRPM-LOC-ID              05703499
057035              AND SYS_PRC_FUNC_CDE  = 'ASNDWN'                    05703599
057036              AND FUNC_PRC_STAT_CDE = 'AC'                        05703699
057037              AND INTFC_SYS_CDE     = 'KHL'                       05703799
057038              AND FUNC_TXT          = 'Y'                         05703899
057039              AND FUNC_BEG_TMST    < CURRENT TIMESTAMP            05703999
057040     END-EXEC.                                                    05704099
057041                                                                  05704199
057042     EVALUATE TRUE                                                05704299
057043         WHEN SQLCODE = ZERO                                      05704399
057044              SET PS-ASNS-TO-WMS-YES    TO TRUE                   05704499
057045         WHEN SQLCODE = +100                                      05704599
057046              SET PS-ASNS-TO-WMS-NO     TO TRUE                   05704699
057047         WHEN SQLWARN0 NOT = SPACES                               05704799
057048         WHEN SQLCODE  NOT = ZERO                                 05704899
057053              SET TM007-SQL-UNRECOVERABLE-ERROR  TO TRUE          05705399
057054              MOVE SQLCODE             TO TM007-SQLCODE           05705499
057055              MOVE SQLCA               TO TM007-SQLCA             05705599
057056              MOVE '7000-CHECK-ASNDWN'                            05705699
057057                                       TO TM007-RETURNED-PARA     05705799
057058     END-EVALUATE.                                                05705899
057059                                                                  05705999
057060******************************************************************05706099
057061*  THIS PARAGRAPH GETS THE TRIP-ID FROM THE PO/RCVR.              05706199
057062******************************************************************05706299
057063 7010-GET-TRIP-ID.                                                05706399
057064                                                                  05706499
057065     EXEC SQL                                                     05706599
057066         SELECT A.TRIP_ID                                         05706699
057067           INTO :SHIPMT-TRIP-ID                                   05706799
057068           FROM TSHIPMT   A                                       05706899
057069              , TSHPTPO   B                                       05706999
057070          WHERE B.PO_NBR         = :RECDIS-ORD-NBR                05707099
057071            AND B.REC_SEQ_NBR    = :RECDIS-REC-SEQ-NBR            05707199
057072            AND A.SHIPT_ID       = B.SHIPT_ID                     05707299
057073     END-EXEC.                                                    05707399
057074                                                                  05707499
057075     EVALUATE TRUE                                                05707599
057076         WHEN SQLCODE = ZERO                                      05707699
057077             CONTINUE                                             05707799
057078         WHEN SQLCODE = -904                                      05707899
057079         WHEN SQLCODE = -911                                      05707999
057080         WHEN SQLCODE = -913                                      05708099
057081             CONTINUE                                             05708199
057082                                                                  05708299
057083         WHEN SQLWARN0 NOT = SPACES                               05708399
057084         WHEN SQLCODE  NOT = ZERO                                 05708499
057085              SET TM007-SQL-UNRECOVERABLE-ERROR  TO TRUE          05708599
057086              MOVE SQLCODE             TO TM007-SQLCODE           05708699
057087              MOVE SQLCA               TO TM007-SQLCA             05708799
057088              MOVE '7010-GET-TRIP-ID'                             05708899
057089                                       TO TM007-RETURNED-PARA     05708999
057094     END-EVALUATE.                                                05709499
057095                                                                  05709599
057096******************************************************************05709699
057097* CALL WMS VENDOR SHIPMENT CONTROL MODULE (WSKUP305) USING        05709799
057098*  COPYBOOK WSWS001.                                              05709899
057099******************************************************************05709999
057100 7020-CALL-WMS-MODULE.                                            05710099
057101                                                                  05710199
057102     IF TM500-CALL-SUCCESSFUL                                     05710299
057103         SET WS001-INSERT           TO TRUE                       05710399
057104     ELSE                                                         05710499
057105         SET WS001-PKSLIP-INACTIVE  TO TRUE                       05710599
057106     END-IF.                                                      05710699
057107     MOVE SHIPMT-TRIP-ID            TO WS001-TRIP-ID.             05710799
057108     MOVE DK-OPER-UNT-ID            TO WS001-OPER-UNT-ID.         05710899
057109     MOVE PC-CURRENT-MODULE-NAME    TO WS001-USER-ID.             05710999
057110     MOVE RECDIS-ORD-NBR            TO WS001-PO-NBR.              05711099
057111     MOVE RECDIS-ORD-LNE-NBR        TO WS001-PO-LNE-NBR.          05711199
057112     MOVE RECDIS-REC-SEQ-NBR        TO WS001-RCVR-NBR.            05711299
057113     MOVE ZEROS                     TO WS001-PREPK-ID.            05711399
057114     MOVE ZEROS                     TO WS001-SKU-NBR.             05711499
057115     MOVE ZEROS                     TO WS001-KOHLS-SHIPT-ID.      05711599
057116     MOVE 'RC'                      TO WS001-SHIPMENT-SOURCE.     05711699
057117     MOVE SPACES                    TO WS001-DTL-ASN-LEVEL-IND.   05711799
057118     MOVE ZEROS                     TO WS001-SRC-TASK-NUMBER.     05711899
057119     MOVE PC-CURRENT-MODULE-NAME    TO WS001-CALLING-PROGRAM-NAME.05711999
057120                                                                  05712099
057123     CALL PC-WMS-CONTROL-MOD        USING WS001-FIELDS.           05712399
057129                                                                  05712999
057130     EVALUATE TRUE                                                05713099
057131         WHEN WS001-SUCCESSFUL                                    05713199
057132              CONTINUE                                            05713299
057133                                                                  05713399
057134         WHEN OTHER                                               05713499
057138              SET TM007-SQL-UNRECOVERABLE-ERROR  TO TRUE          05713899
057139              MOVE SQLCODE             TO TM007-SQLCODE           05713999
057140              MOVE SQLCA               TO TM007-SQLCA             05714099
057141              MOVE '7020-CALL-WMS-MODULE'                         05714199
057142                                       TO TM007-RETURNED-PARA     05714299
057143                                                                  05714399
057144     END-EVALUATE.                                                05714499
057145                                                                  05714599
057146******************************************************************05714699
057147*  THIS PARAGRAPH GETS THE CURRENT OPER ID FOR THE PO/RCVR        05714799
057148******************************************************************05714899
057149 7030-SELECT-TRECEIV.                                             05714999
057150                                                                  05715099
057151     MOVE TM007-PO-NBR        TO RECEIV-ORD-NBR.                  05715199
057152     MOVE TM007-REC-SEQ-NBR   TO RECEIV-REC-SEQ-NBR.              05715299
057153                                                                  05715399
057154     EXEC SQL                                                     05715499
057155         SELECT OPER_UNT_ID                                       05715599
057156           INTO :RECEIV-OPER-UNT-ID                               05715699
057157           FROM TRECEIV                                           05715799
057159          WHERE ORD_NBR          = :RECEIV-ORD-NBR                05715999
057160            AND REC_SEQ_NBR      = :RECEIV-REC-SEQ-NBR            05716099
057161            AND VER_STATUS_CDE   = 'A'                            05716199
057162     END-EXEC.                                                    05716299
057163                                                                  05716399
057164     EVALUATE TRUE                                                05716499
057165         WHEN SQLCODE = ZERO                                      05716599
057166         WHEN SQLCODE = -811                                      05716699
057167             CONTINUE                                             05716799
057168         WHEN SQLCODE = +100                                      05716899
057169              MOVE ZERO           TO RECEIV-OPER-UNT-ID           05716999
057170         WHEN SQLCODE = -904                                      05717099
057171         WHEN SQLCODE = -911                                      05717199
057172         WHEN SQLCODE = -913                                      05717299
057173             CONTINUE                                             05717399
057174                                                                  05717499
057175         WHEN SQLWARN0 NOT = SPACES                               05717599
057176         WHEN SQLCODE  NOT = ZERO                                 05717699
057177              SET TM007-SQL-UNRECOVERABLE-ERROR  TO TRUE          05717799
057178              MOVE SQLCODE             TO TM007-SQLCODE           05717899
057179              MOVE SQLCA               TO TM007-SQLCA             05717999
057180              MOVE '7030-SELECT-TRECEIV'                          05718099
057181                                       TO TM007-RETURNED-PARA     05718199
057182     END-EVALUATE.                                                05718299
057183                                                                  05718399
057184* JAK 05/2007 - END                                               05718499
057185                                                                  05718599
057186                                                                  05718699
057187******************************************************************05718799
057190**                       END PROGRAM                            **05719008
057200******************************************************************05720000
