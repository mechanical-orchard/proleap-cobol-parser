000100*-----------------------*                                         00010099
000200 IDENTIFICATION DIVISION.                                         00020099
000300*-----------------------*                                         00030099
000400 PROGRAM-ID.    SAKCS426.                                         00040099
000500 AUTHOR.        PAT DOYLE.                                        00050099
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060099
000700 DATE-WRITTEN.  02/17/2000.                                       00070099
000800 DATE-COMPILED.                                                   00080099
000900                                                                  00090099
001000*----------------------------------------------------------------*00100099
001100*    S426 - SALES TRANSACTION LIST                               *00110099
001200*                                                                *00120099
001300*    THIS PROGRAM GENERATES A LIST OF TRANSACTIONS.  THIS        *00130099
001400*    PROGRAM USES DYNAMIC SQL TO CREATE THE CURSOR FOR THE LIST. *00140099
001500*                                                                *00150099
001600******************************************************************00161099
001700*                         CHANGES                                *00170099
001800******************************************************************00171099
001900* CHANGED: 07/05/2001                                            *00172099
002000* BY:      GAYLE HAUPT                                           *00173099
002100* FOR:     E-COMMERCE                                            *00174099
002200* WHY:     ADDED E-COMMERCE ORDER NUMBER AS SEARCH CRITERIA ON   *00175099
002300*          CRITERIA SPEC SCREEN (SAKCS425); SAKCS426 NEEDED TO   *00176099
002400*          BE MODIFIED TO ACCEPT THE NEW FIELD AND PROCESS IT    *00177099
002500*          CORRECTLY.                                            *00178099
002600******************************************************************00180099
002700* CHANGED: 01/21/2001                                            *00190099
002800* BY:      DOUG JONES                                            *00200099
002900* FOR:     PM00388257                                            *00210099
003000* WHY:     ADDED CHANGE IN 4240 FOR HISTORICAL WHERE CLAUSE.     *00220099
003100*          EXTRANEOUS PAREN AND WS-VARIABLE.                     *00230099
003200******************************************************************00261199
003300* CHANGED: 01/16/2001                                            *00261299
003400* BY:      DOUG JONES                                            *00261399
003500* FOR:                                                           *00261499
003600* WHY:     ADDED A FIX IN 4240 AND 4290 NEEDED WHEN THE FROM     *00261599
003700*          PARTITION NUMBER WAS GREATER THAN THE TO PARTITION    *00261699
003800*          NUMBER.  INSERTED AN OR CLAUSE IN PLACE OF AN EXISTING*00261799
003900*          AND CONDITION THAT COULD NEVER BE MET.                *00261899
004000******************************************************************00261999
004100* CHANGED: 11/06/2000                                            *00262099
004200* BY:      GAYLE HAUPT                                           *00263099
004300* FOR:     WR#21208 - OPEN TO RETURN PHASE 2                     *00264099
004400* WHY:     ADDED THE AVAIL OTR TO RIGHT SIDE (PF11) OF SCREEN.   *00265099
004500*          THIS FIELD WILL DISPLAY A CALCULATED AMOUNT:          *00266099
004600*          (OTR AMT - ACCUM RET AMT) * CURRENT THRESHOLD         *00267099
004700*          PERCENTAGE FROM TEPTHRT TABLE.                        *00268099
004800******************************************************************00269099
004900* CHANGED: 07/31/2000                                            *00270099
005000* BY:      LIHUA LIANG                                           *00280099
005100* FOR:     WR#20867                                              *00290099
005200* WHY:     ADDED SAME-DAY-SW TO ALLOW A GROUP OF PEOPLE TO HAVE  *00300099
005300*          SAME DAY ACCESS.                                      *00310099
005400******************************************************************00320099
005500* CHANGED: 07/30/2001                                            *        
005600* BY:      MICHELE RINDFLEISCH                                   *        
005700* FOR:     WR#                                                   *        
005800* WHY:     ADDED PF-KEY 24 (DP020-FK-LOCA-FUNC-06). THIS NEW     *        
005900*          FUNCTION KEY IS TO TRANSFER TO THE ORIGINAL           *        
006000*          TRANSACTION LIST SCREEN CREATED IN SAKCS431.          *        
006100******************************************************************00320099
005500* CHANGED: 12/11/2001                                            *        
005600* BY:      CHRIS CLARK                                           *        
005700* FOR:     WR#23086                                              *        
005800* WHY:     ADDED LOGIC FOR DYNAMIC SQL TO INCLUDE DEBIT TENDER   *        
005900*          TYPE AS SEARCH OPTION ON THIS SCREEN.                 *        
006100******************************************************************        
005500* CHANGED: 05/31/2002                                            *        
005600* BY:      CHRIS CLARK                                           *        
005700* FOR:     WR#23433                                              *        
005800* WHY:     CHANGED DEPT/CLASS/SKU LOGIC TO USE NEW SKU FIELD     *        
006100******************************************************************        
005500* CHANGED: 08/22/2002                                            *        
005600* BY:      CHRIS CLARK                                           *        
005700* FOR:     PM00489293                                            *        
005800* WHY:     FIXED DYNAMIC SQL TO GO AFTER HISTORICAL TABLES       *        
005800*          CORRECTLY FOR DEBIT.                                  *        
006100******************************************************************        
NEMCHG* CHANGED: 12/10/2002                                            *        
NEMCHG* BY:      NANCY MARTIN                                          *        
NEMCHG* FOR:     WR24311                                               *        
NEMCHG* WHY:     CHANGED TO EXPAND ASSOCIATE NUMBER FROM 6 TO 7 ON     *        
NEMCHG*          SCREEN FOR UNIQUE ASSOCIATE ID WORK.                  *        
006100******************************************************************        
006101* CHANGED: 10/24/2005                                            *        
006102* BY:      CAROLE MCCAMMON                                       *        
006103* FOR:     WR29309                                               *        
006104* WHY:     ADDED LOGIC TO INCLUDE KOHLS DEBIT AS TENDER TYPE FOR *        
006105*          BOTH CURRENT AND HISTORICAL DATA.                     *        
006106******************************************************************        
006101* CHANGED: 01/18/2012                                            *        
006102* BY:      ROB SWAGER                                            *        
006103* FOR:     WR24719                                               *        
006104* WHY:     EXPANDED SIZE OF DL-TRAN-AMOUNT-LEFT FIELD AND        *        
006105*          DL-AVAIL-OTR-RIGHT FOR LARGE RETAIL AMOUNT.           *        
006106******************************************************************        
C62728* CHANGED  10/04/2013                                            *        
C62728* BY:      COGNIZANT                                             *        
C62728* FOR:     CHG0062728                                            *        
C62728* WHY:     REMOVED LOGIC THAT REFERENCING THE FOLLOWING          *        
C62728*          COSA HISTORY TABLES FOR 9607 - FSH 2013-CFMC PROJECT  *        
C62728*                                                                *        
C62728*          EPT_DR_CRD_TNDRH,TEPATRH,TEPCHKH,TEPCRDH,TEPITMH,     *        
C62728*          TEPORDH,TEPTNDH,TEPTRNH                               *        
C62728******************************************************************        
P10237* CHANGED  03/30/2015                                            *        
P10237* BY:      COGNIZANT                                             *        
P10237* FOR:     CHG0104429                                            *        
P10237* WHY:     REMOVED THE PARA 4180-FORMAT-TENDER-WHERE WHICH DOES  *        
P10237*          LOOKUP FOR TENDER_ID ON TEPTND COSA DB2 TABLE AND     *        
P10237*          REMOVED THE PARA 4190-FORMAT-DL-NBR-WHERE WHICH DOES  *        
P10237*          LOOKUP FOR DRV_LIC_NBR ON TEPCHK AND TEPCRD COSA DB2  *        
P10237*          TABLES FOR 10237 - COSA DATA SECURITY PROJECT         *        
P10237*                                                                *        
C00000*-----------------------------------------------------------------        
C00000*  CHANGED 09/02/2021    BY GERMAN BANDA    WR: CHG0261091                
C00000*                                                                         
C00000*  CHANGE CALL OF DPKUT100 TO                                             
C00000*  CALL DP010I-NUMERIC-EDIT-ROUTINE                                       
C00000*  MAKING THE CALL DYNAMIC VS STATIC                                      
C00000*-----------------------------------------------------------------        
CICS  *  CHANGED 10/12/2022    BY JIM HUNTER      WR: CHG0276153                
CICS  *                                                                         
CICS  *  ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL               
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.              
CICS  *-----------------------------------------------------------------        
P10237******************************************************************        
006200                                                                  00330099
006300 DATA DIVISION.                                                   00340099
006400                                                                  00350099
006500 WORKING-STORAGE SECTION.                                         00360099
006600                                                                  00370099
006700 01  DK-DB2-KEYS.                                                 00380099
006800     15  DK-SALES-DATE                  PIC  X(10) VALUE SPACE.   00390099
006900     15  DK-STORE                       PIC S9(04) VALUE ZERO     00400099
007000                                                   COMP.          00410099
007100     15  DK-REGISTER                    PIC S9(04) VALUE ZERO     00420099
007200                                                   COMP.          00430099
007300     15  DK-TRANS                       PIC S9(04) VALUE ZERO     00440099
007400                                                   COMP.          00450099
007500     15  DK-PARTITION                   PIC S9(04) VALUE ZERO     00460099
007600                                                   COMP.          00470099
007700                                                                  00480099
007800 01  PC-PROGRAM-CONSTANTS.                                        00490099
007900     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00500099
008000                                                    'SA426A  '.   00510099
008100     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00520099
008200                                                    'SAKM426 '.   00530099
008300     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00540099
008400                                                    'SAKCS426'.   00550099
008500     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00560099
008600     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00570099
008700     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00580099
008800     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +14     00590099
008900                                                    COMP SYNC.    00600099
009000     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00610099
009100                                                    COMP SYNC.    00620099
009200     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00630099
009300                                                    +1000000      00640099
009400                                                    COMP-3.       00650099
009500     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00660099
009600                                                    COMP-3.       00670099
009700     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00680099
009800     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00690099
009900     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00700099
010000     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00710099
010100     05  PC-REV                         PIC  X(03)  VALUE 'REV'.  00720099
010200     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00730099
010300                                                    COMP SYNC.    00740099
010400     05  PC-QUOTE                       PIC  X(01)  VALUE QUOTE.  00750099
010400     05  PC-SPACE                       PIC  X(01)  VALUE ' '.    00750099
010500                                                                  00760099
010600     05  PC-TSYMSG-NUMBERS.                                       00770099
010700         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00780099
010800         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00790099
010900         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  00800099
011000         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00810099
011100         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00820099
011200         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00830099
011300         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00840099
011400         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00850099
011500         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00860099
011600         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00870099
011700         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00880099
011800         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00890099
011900         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00900099
012000         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00910099
012100         10  PC-TSYMSG-02416            PIC  9(05)  VALUE 02416.  00920099
012200         10  PC-TSYMSG-02748            PIC  9(05)  VALUE 02748.  00921099
012300                                                                  00930099
012400 01  PS-PROGRAM-SWITCHES.                                         00940099
012500     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00950099
012600         88  PS-NO-ERROR                            VALUE 'Y'.    00960099
012700         88  PS-ERROR                               VALUE 'N'.    00970099
012800     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00980099
012900         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00990099
013000         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01000099
013100     05  PS-PARTITON-SW                 PIC  X(01)  VALUE 'N'.    01010099
013200         88  PS-PARTITION-FOUND                     VALUE 'Y'.    01020099
013300         88  PS-PARTITION-NOT-FOUND                 VALUE 'N'.    01030099
013400     05  PS-DATE-RANGE-SW               PIC  X(01)  VALUE SPACES. 01040099
013500         88  PS-USE-DATE-RANGE                      VALUE 'Y'.    01050099
013600         88  PS-USE-ONE-DATE                        VALUE 'N'.    01060099
014000     05  PS-TENDER-WHERE-SW             PIC  X(01)  VALUE SPACES. 01100099
014100         88  PS-HAVE-TENDER-WHERE                   VALUE 'Y'.    01110099
014200     05  PS-PARTITION-WHERE-SW          PIC  X(01)  VALUE SPACES. 01120099
014300         88  PS-HAVE-PARTITION-WHERE                VALUE 'Y'.    01130099
014400     05  PS-HAVE-EXISTS-CLAUSE-SW       PIC  X(01)  VALUE SPACES. 01140099
014500         88  PS-HAVE-EXISTS-CLAUSE                  VALUE 'Y'.    01150099
014600     05  PS-E-STORE-SW                  PIC  X(01)  VALUE 'N'.    01151099
014700         88  PS-E-STORE-YES                         VALUE 'Y'.    01152099
014800         88  PS-E-STORE-NO                          VALUE 'N'.    01153099
014900                                                                  01160099
015000 01  RF-PROCESSING-DATE.                                          01170099
015100     05  RF-PRCG-DTE-CC                 PIC XX.                   01180099
015200     05  RF-PRCG-DTE-YY                 PIC XX.                   01190099
015300     05  FILLER                         PIC X.                    01200099
015400     05  RF-PRCG-DTE-MM                 PIC XX.                   01210099
015500     05  FILLER                         PIC X.                    01220099
015600     05  RF-PRCG-DTE-DD                 PIC XX.                   01230099
015700                                                                  01240099
015800 01  RF-DISPLAY-DATE.                                             01250099
015900     05  RF-DISPLAY-DTE-MM              PIC XX.                   01260099
016000     05  RF-DISPLAY-DTE-DD              PIC XX.                   01270099
016100     05  RF-DISPLAY-DTE-YY              PIC XX.                   01280099
016200                                                                  01290099
016300 01  RF-STATUS-TEXT.                                              01300099
016400     05  RF-STATUS-TEXT-MSG             PIC X(06).                01310099
016500     05  RF-STATUS-TEXT-DATE            PIC X(06).                01320099
016600                                                                  01330099
016700 01  PV-PROGRAM-VARIABLES.                                        01340099
016800     05  PV-BEG-POS                     PIC  9(02)  VALUE 0.      01350099
016800     05  PV-LENGTH                      PIC  9(02)  VALUE 0.      01350099
016800     05  PV-LEADING-SPACE-COUNT         PIC  9(02)  VALUE 0.      01350099
016800     05  PV-SUB                         PIC S9(04)  VALUE +0      01350099
016900                                                    COMP SYNC.    01360099
017000     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01370099
017100                                                    COMP SYNC.    01380099
017200     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01390099
017300                                                    COMP-3.       01400099
017400     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01410099
017500                                                    COMP-3.       01420099
017600     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01430099
017700                                                    COMP-3.       01440099
017800     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01450099
017900                                                    COMP-3.       01460099
018000     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01470099
018100                                                    COMP-3.       01480099
018200     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01490099
018300                                                    COMP-3.       01500099
018400     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01510099
018500                                                    COMP-3.       01520099
018600     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01530099
018700                                                    COMP SYNC.    01540099
018800     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01550099
018900                                                    COMP SYNC.    01560099
019000     05  PV-ITEM                        PIC S9(04)  VALUE +0      01570099
019100                                                    COMP SYNC.    01580099
019200     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01590099
019300                                                    COMP SYNC.    01600099
019400     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01610099
019500                                                    COMP SYNC.    01620099
019600     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01630099
019700                                                    COMP SYNC.    01640099
019800     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01650099
019900                                                    COMP SYNC.    01660099
020000     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01670099
020100                                                    COMP SYNC.    01680099
020200     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01690099
020300                                                    COMP SYNC.    01700099
020400     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01710099
020500                                                    COMP SYNC.    01720099
020600     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01730099
020700                                                    COMP SYNC.    01740099
020800     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01750099
020900                                                    COMP SYNC.    01760099
021000     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01770099
021100                                                    COMP SYNC.    01780099
021200     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01790099
021300                                                    COMP SYNC.    01800099
021400     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01810099
021500                                                    COMP SYNC.    01820099
021600     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01830099
021700                                                    COMP SYNC.    01840099
021800     05  PV-ASSOC-ID                    PIC  9(09)  VALUE ZERO.   01850099
021900     05  PV-SELECT-BYTES                PIC S9(04)  COMP          01860099
022000                                                    VALUE +245.   01870099
022100     05  PV-FROM-BYTES                  PIC S9(04)  COMP          01880099
022200                                                    VALUE +100.   01890099
022300     05  PV-ORDER-BY-BYTES              PIC S9(04)  COMP          01900099
022400                                                    VALUE +67.    01910099
022500     05  PV-STRING-POINTER-WHERE        PIC S9(04)  COMP          01920099
022600                                                    VALUE 0.      01930099
022700     05  PV-STORE                       PIC  9(04)  VALUE 0.      01940099
022800     05  PV-REGISTER                    PIC  9(04)  VALUE 0.      01950099
022900     05  PV-TRANSACTION                 PIC  9(04)  VALUE 0.      01960099
023000     05  PV-TRANSACTION-AMOUNT          PIC  -9999999.99.         01970099
023100     05  PV-OPERATOR-ID                 PIC  9(09)  VALUE 0.      01980099
023200     05  PV-PUR-ASSOC-ID                PIC  9(09)  VALUE 0.      01990099
023300     05  PV-FROM-PARTITION              PIC  9(04)  VALUE 0.      02000099
023400     05  PV-TO-PARTITION                PIC  9(04)  VALUE 0.      02010099
023500     05  PV-UPC-NBR                     PIC  9(15)  VALUE 0.      02020099
023500     05  PV-SKU-NBR                     PIC  9(08)  VALUE 0.      02020099
023600     05  PV-ECOM-ORD-NBR                PIC  X(40)  VALUE ZERO.   02021099
023700     05  PV-DUMMY                       PIC S9(04)  VALUE 0       02022099
023800                                                    COMP SYNC.    02023099
023900     05  PV-TABLE-QUALIFIER.                                      02030099
024000         10 FILLER                      PIC X(03) VALUE 'DB2'.    02040099
024100         10 PV-QUALIFIER                PIC X(01) VALUE ' '.      02050099
024200         10 FILLER                      PIC X(03) VALUE 'DBA'.    02060099
024300         10 FILLER                      PIC X(01) VALUE '.'.      02070099
024400     05  PV-TABLE-QUALIFIER-COMMA.                                02080099
024500         10 FILLER                      PIC X(04) VALUE ',DB2'.   02090099
024600         10 PV-QUALIFIER-COMMA          PIC X(01) VALUE ' '.      02100099
024700         10 FILLER                      PIC X(03) VALUE 'DBA'.    02110099
024800         10 FILLER                      PIC X(01) VALUE '.'.      02120099
024900     05  PV-SYSTEM-ID.                                            02130099
025000         10  FILLER                     PIC  X(04)  VALUE SPACE.  02140099
025100         10  PV-REGION-IND              PIC  X(01).               02150099
025200             88  PV-TEST-CICS                 VALUE 'T'.          02160099
025300             88  PV-QA-CICS                   VALUE 'Q'.          02170099
025400             88  PV-PROD-CICS                 VALUE 'P'.          02180099
025500             88  PV-LEARN-CICS                VALUE 'L'.          02190099
025600         10  FILLER                     PIC X(03)    VALUE SPACES.02200099
025700     05  PV-SLS-DTE-FORMATTED.                                    02210099
025800         10  PV-SLS-DTE-FORMATTED-MM    PIC X(02)  VALUE SPACES.  02220099
025900         10  FILLER                     PIC X(01)  VALUE '/'.     02230099
026000         10  PV-SLS-DTE-FORMATTED-DD    PIC X(02)  VALUE SPACES.  02240099
026100         10  FILLER                     PIC X(01)  VALUE '/'.     02250099
026200         10  PV-SLS-DTE-FORMATTED-YYYY  PIC X(04)  VALUE SPACES.  02260099
026300     05  PV-SLS-DTE-ISO.                                          02270099
026400         10  PV-SLS-DTE-ISO-YYYY        PIC X(04)  VALUE SPACES.  02280099
026500         10  FILLER                     PIC X(01)  VALUE '-'.     02290099
026600         10  PV-SLS-DTE-ISO-MM          PIC X(02)  VALUE SPACES.  02300099
026700         10  FILLER                     PIC X(01)  VALUE '-'.     02310099
026800         10  PV-SLS-DTE-ISO-DD          PIC X(02)  VALUE SPACES.  02320099
026900     05  PV-RGST-ID                     PIC S9(04).               02321099
027000         88  PV-RGST-ID-ECOM            VALUE 80 THRU 89.         02322099
027100                                                                  02330099
027200 01  PV-SELECT-STMT.                                              02340099
027300     05  FILLER                         PIC  X(06)  VALUE         02350099
027400         'SELECT'.                                                02360099
027500     05  FILLER                         PIC  X(14)  VALUE         02370099
027600         ' PRT.PARTN_NBR'.                                        02380099
027700     05  FILLER                         PIC  X(13)  VALUE         02390099
027800         ' ,TRN.STR_NBR'.                                         02400099
027900     05  FILLER                         PIC  X(13)  VALUE         02410099
028000         ' ,TRN.RGST_ID'.                                         02420099
028100     05  FILLER                         PIC  X(13)  VALUE         02430099
028200         ' ,TRN.TRN_NBR'.                                         02440099
028300     05  FILLER                         PIC  X(13)  VALUE         02450099
028400         ' ,TRN.STRT_TM'.                                         02460099
028500     05  FILLER                         PIC  X(22)  VALUE         02470099
028600         ' ,TRN.SLS_CORR_SEQ_NBR'.                                02480099
028700     05  FILLER                         PIC  X(15)  VALUE         02490099
028800         ' ,VOID_ABRT_CDE'.                                       02500099
028900     05  FILLER                         PIC  X(14)  VALUE         02510099
029000         ' ,TRN_STAT_CDE'.                                        02520099
029100     05  FILLER                         PIC  X(13)  VALUE         02530099
029200         ' ,TRN_TYP_CDE'.                                         02540099
029300     05  FILLER                         PIC  X(13)  VALUE         02550099
029400         ' ,PRT.SLS_DTE'.                                         02560099
029500     05  FILLER                         PIC  X(10)  VALUE         02570099
029600         ' ,PRCG_DTE'.                                            02580099
029700     05  FILLER                         PIC  X(13)  VALUE         02590099
029800         ' ,TRN_TOT_AMT'.                                         02600099
029900     05  FILLER                         PIC  X(15)  VALUE         02610099
030000         ' ,SRVR_ONLN_IND'.                                       02620099
030100     05  FILLER                         PIC  X(10)  VALUE         02630099
030200         ' ,ASSOC_ID'.                                            02640099
030300     05  FILLER                         PIC  X(14)  VALUE         02650099
030400         ' ,ORIG_OTR_AMT'.                                        02660099
030500     05  FILLER                         PIC  X(18)  VALUE         02670099
030600         ' ,ACCM_RET_TOT_AMT'.                                    02680099
030700     05  FILLER                         PIC  X(11)  VALUE         02681099
030800         ' ,E_BUS_IND'.                                           02682099
030900                                                                  02701999
031000 01  PV-FROM.                                                     02702099
031100     05  PV-FROM-STMT                   PIC X(100)  VALUE SPACES. 02710099
031200                                                                  02720099
031300 01  PV-WHERE.                                                    02730099
031400     05  PV-WHERE-STMT                  PIC X(1400) VALUE SPACES. 02740099
031500                                                                  02750099
031600 01  PV-ORDER-BY.                                                 02760099
031700     05  PV-ORDER-BY-STMT.                                        02770099
031800         10  FILLER                     PIC X(35)   VALUE         02822099
031900             'ORDER BY PRT.SLS_DTE, TRN.STR_NBR, '.               02823099
032000         10  FILLER                     PIC X(25)   VALUE         02824099
032100             'TRN.RGST_ID, TRN.TRN_NBR '.                         02825099
032200         10  FILLER                     PIC X(07)   VALUE         02826099
032300             'WITH UR'.                                           02827099
032400                                                                  02828099
032500 01  PV-COMPLETE-SQL.                                             02830099
032600     49  PV-SQL-STMT-LEN                PIC S9(04)  COMP VALUE 0. 02840099
032700     49  PV-COMPLETE-SQL-STMT           PIC X(1900) VALUE SPACES. 02850099
032800                                                                  02860099
032900*----------------------------------------------------------------*02870099
033000*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.    *02880099
033100*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE            *02890099
033200*   APPLICATION-SPECIFIC COMMAREA.                               *02900099
033300*----------------------------------------------------------------*02910099
033400 01  LQW-LIST-QUEUE-WORK-AREA.                                    02920099
033500     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  02930099
033600     05  LQW-ITEM-ENTRIES               OCCURS 14 TIMES           02940099
033700                                        INDEXED BY LQW-IDX.       02950099
033800         10  LQW-LIST-ITEM-NUMBER       PIC S9(07)  COMP-3.       02960099
033900         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               02970099
034000         10  LQW-SELECTED-SW            PIC  X(01).               02980099
034100             88  LQW-SELECT                         VALUE 'S'.    02990099
034200             88  LQW-DESELECT                       VALUE ' '.    03000099
034300         10  LQW-ACTION                 PIC  X(03).               03010099
034400         10  LQW-PARTITION-NBR          PIC S9(04)  COMP.         03020099
034500         10  LQW-SALES-DATE             PIC  X(10).               03030099
034600         10  LQW-STORE                  PIC S9(04)  COMP.         03040099
034700         10  LQW-REGISTER               PIC S9(04)  COMP.         03050099
034800         10  LQW-TRANSACTION            PIC S9(04)  COMP.         03060099
034900         10  LQW-START-TIME             PIC  X(08).               03070099
035000         10  LQW-REGISTER-OPERATOR      PIC 9(06)   COMP-3.       03080099
035100         10  LQW-TYPE                   PIC  X(02).               03090099
035200         10  LQW-ONLINE-IND             PIC  X(01).               03100099
035300         10  LQW-AMOUNT                 PIC S9(07)V9(02)          03110099
035400                                                    COMP-3.       03120099
035500         10  LQW-SALES-CORR-SEQ-NBR     PIC S9(04)  COMP.         03130099
035600         10  LQW-SOURCE-TEXT            PIC  X(03).               03140099
035700         10  LQW-STATUS                 PIC  X(02).               03150099
035800         10  LQW-STATUS-TEXT            PIC  X(12).               03160099
035900         10  LQW-VOID-CODE              PIC  X(01).               03170099
036000         10  LQW-VOID-CODE-TEXT         PIC  X(12).               03180099
036100         10  LQW-AVAIL-OTR-AMT          PIC S9(07)V9(02)          03190099
036200                                                    COMP-3.       03200099
036300                                                                  03210099
036400*---------------------------------------------------------------* 03220099
036500*  RECORD LAYOUT FOR THE TRANSACTION SELECTION TEMP STORAGE Q.  * 03230099
036600*---------------------------------------------------------------* 03240099
036700                                                                  03250099
036800     COPY SAWS001.                                                03260099
036900                                                                  03270099
037000*---------------------------------------------------------------* 03280099
037100*    MAP LAYOUT                                                 * 03290099
037200*---------------------------------------------------------------* 03300099
037300                                                                  03310099
037400     COPY SAKM426.                                                03320099
037500                                                                  03330099
037600 01  MR-OCCURS-LAYOUT                   REDEFINES  SA426AO.       03340099
037700     05  FILLER                         PIC X(94).                03350099
037800     05  MR-SCROLL-AREA                 OCCURS 14 TIMES.          03360099
037900         10  MR-SELECTL                 PIC S9(04) COMP.          03370099
038000         10  MR-SELECTA                 PIC  X(01).               03380099
038100         10  MR-SELECTC                 PIC  X(01).               03390099
038200         10  MR-SELECTH                 PIC  X(01).               03400099
038300         10  MR-SELECTI                 PIC  X(01).               03410099
038400                                                                  03420099
038500         10  MR-ACTIONL                 PIC S9(04) COMP.          03430099
038600         10  MR-ACTIONA                 PIC  X(01).               03440099
038700         10  MR-ACTIONC                 PIC  X(01).               03450099
038800         10  MR-ACTIONH                 PIC  X(01).               03460099
038900         10  MR-ACTION                  PIC  X(03).               03470099
039000                                                                  03480099
039100         10  MR-DATEL                   PIC S9(04) COMP.          03490099
039200         10  MR-DATEA                   PIC  X(01).               03500099
039300         10  MR-DATEC                   PIC  X(01).               03510099
039400         10  MR-DATEH                   PIC  X(01).               03520099
039500         10  MR-DATE                    PIC  X(10).               03530099
039600                                                                  03540099
039700         10  MR-STOREL                  PIC S9(04) COMP.          03550099
039800         10  MR-STOREA                  PIC  X(01).               03560099
039900         10  MR-STOREC                  PIC  X(01).               03570099
040000         10  MR-STOREH                  PIC  X(01).               03580099
040100         10  MR-STORE-X.                                          03590099
040200             15  MR-STORE               PIC  9(04).               03600099
040300                                                                  03610099
040400         10  MR-REGL                    PIC S9(04) COMP.          03620099
040500         10  MR-REGA                    PIC  X(01).               03630099
040600         10  MR-REGC                    PIC  X(01).               03640099
040700         10  MR-REGH                    PIC  X(01).               03650099
040800         10  MR-REG-X.                                            03660099
040900             15  MR-REG                 PIC  9(04).               03670099
041000                                                                  03680099
041100         10  MR-TRANSL                  PIC S9(04) COMP.          03690099
041200         10  MR-TRANSA                  PIC  X(01).               03700099
041300         10  MR-TRNASC                  PIC  X(01).               03710099
041400         10  MR-TRANSH                  PIC  X(01).               03720099
041500         10  MR-TRANS-X.                                          03730099
041600             15  MR-TRANS               PIC  9(04).               03740099
041700                                                                  03750099
041800         10  MR-VAR-AREAL               PIC S9(04) COMP.          03760099
041900         10  MR-VAR-AREAA               PIC  X(01).               03770099
042000         10  MR-VAR-AREAC               PIC  X(01).               03780099
042100         10  MR-VAR-AREAH               PIC  X(01).               03790099
042200         10  MR-VAR-AREA                PIC  X(40).               03800099
042300                                                                  03810099
042400*---------------------------------------------------------------* 03820099
042500*  SCROLLABLE AREA OF SCREEN                                    * 03830099
042600*---------------------------------------------------------------* 03840099
042700 01  DL-DETAIL-LINE-LEFT.                                         03850099
NEMCHG     05  DL-REG-OP-LEFT                 PIC  9(07) VALUE ZERO.    03860099
NEMCHG     05  FILLER                         PIC  X(02) VALUE SPACES.  03870099
043000     05  DL-TYPE-LEFT                   PIC  X(02) VALUE SPACES.  03880099
043100     05  FILLER                         PIC  X(05) VALUE SPACES.  03890099
043200     05  DL-ONLINE-IND-LEFT             PIC  X(01) VALUE SPACES.  03900099
043300     05  FILLER                         PIC  X(04) VALUE SPACES.  03910099
043400     05  DL-VOID-IND-LEFT               PIC  X(01) VALUE SPACES.  03920099
043500     05  FILLER                         PIC  X(04) VALUE SPACES.  03930099
043600     05  DL-TRAN-AMOUNT-LEFT            PIC  Z,ZZZ,ZZ9.99-.       03940099
043700     05  FILLER                         PIC  X(01).               03950099
043800                                                                  03960099
043900 01  DL-DETAIL-LINE-RIGHT REDEFINES DL-DETAIL-LINE-LEFT.          03970099
044000     05  DL-TRAN-SRC-RIGHT              PIC  X(03).               03980099
044100     05  FILLER                         PIC  X(01).               03990099
044200     05  DL-STATUS-RIGHT                PIC  X(13).               04000099
044300     05  DL-VOID-INFO-RIGHT             PIC  X(13).               04010099
044400     05  FILLER                         PIC  X(01).               04020099
044500     05  DL-AVAIL-OTR-RIGHT             PIC  ZZZZ9.99-.           04030099
044600                                                                  04040099
044700 01  HL-HEADING-LINES.                                            04050099
044800     05  HL-HEADING-LINE-LEFT           PIC  X(42)  VALUE         04060099
044900       'REG OP  TYPE  LINE  VOID   AMOUNT       '.                04070099
045000     05  HL-HEADING-LINE-RIGHT          PIC  X(42)  VALUE         04080099
045100       'SRC STATUS       VOID INFO     AVAIL OTR'.                04090099
045200                                                                  04100099
045300*---------------------------------------------------------------* 04110099
045400*    ATTRIBUTE SETTINGS COPYBOOK.                               * 04120099
045500*---------------------------------------------------------------* 04130099
045600                                                                  04140099
045700     COPY DPWS015.                                                04150099
045800                                                                  04160099
045900*---------------------------------------------------------------* 04170099
046000*    FUNCTION KEYS COPYBOOK.                                    * 04180099
046100*---------------------------------------------------------------* 04190099
046200                                                                  04200099
046300     COPY DPWS016.                                                04210099
046400                                                                  04220099
046500*---------------------------------------------------------------* 04230099
046600*    NUMERIC EDIT LAYOUT.                                       * 04240099
046700*---------------------------------------------------------------* 04250099
046800                                                                  04260099
046900     COPY DPWS010I.                                               04270099
047000                                                                  04280099
047100*---------------------------------------------------------------* 04290099
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 04300099
047300*---------------------------------------------------------------* 04310099
047400                                                                  04320099
047500     COPY DPWS030.                                                04330099
CICS       COPY DPWS930.                                                        
047600                                                                  04340099
047700*---------------------------------------------------------------* 04350099
047800*    STANDARD COMMAREA.                                         * 04360099
047900*---------------------------------------------------------------* 04370099
048000                                                                  04380099
048100     COPY DPWS020.                                                04390099
048200     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                04400099
048300                                                                  04410099
048400*---------------------------------------------------------------* 04420099
048500* INTER-APPLICATION COMMAREA.                                   * 04430099
048600*   SAWS031 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 04440099
048700*             SPEC SCREEN.                                      * 04450099
048800*   SAWS004 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 04460099
048900*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 04470099
049000*---------------------------------------------------------------* 04480099
049100                                                                  04490099
049200         10  INTER-APPL-COMM-AREA       PIC X(200).               04500099
049300     COPY SAWS031.                                                04510099
049400     COPY SAWS004.                                                04520099
049500                                                                  04530099
049600*---------------------------------------------------------------* 04540099
049700*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 04550099
049800*---------------------------------------------------------------* 04560099
049900         10  ASC-SPECIFIC-COMMAREA.                               04570099
050000             15  ASC-LIST-KEYS.                                   04580099
050100                 20  ASC-KEY-SALES-DATE-FROM     PIC  X(10).      04590099
050200                 20  ASC-KEY-SALES-DATE-TO       PIC  X(10).      04600099
050300                 20  ASC-KEY-STORE               PIC S9(04)       04610099
050400                                                 COMP.            04620099
050500                 20  ASC-KEY-REGISTER            PIC S9(04)       04630099
050600                                                 COMP.            04640099
050700                 20  ASC-KEY-TRANSACTION         PIC S9(04)       04650099
050800                                                 COMP.            04660099
050900                 20  ASC-KEY-TRANSACTION-AMOUNT  PIC S9(07)V9(02) 04670099
051000                                                 COMP-3.          04680099
051100                 20  ASC-KEY-PUR-ASSOC-ID        PIC S9(09)       04690099
051200                                                 COMP.            04700099
051300                 20  ASC-KEY-OPERATOR-ID         PIC S9(09)       04710099
051400                                                 COMP.            04720099
051500                 20  ASC-KEY-TENDER-ID           PIC  X(33).      04730099
051600                 20  ASC-KEY-TENDER-TYPE         PIC  X(02).      04740099
051600                 20  ASC-KEY-DEBIT-TYPE          PIC  X(02).      04740099
051700                 20  ASC-KEY-DRIVERS-LICENSE-NBR PIC  X(25).      04750099
051800                 20  ASC-KEY-KEYED-TENDER-IND    PIC  X(01).      04760099
051900                 20  ASC-KEY-SKU                 PIC S9(08)V      04770099
052000                                                      COMP-3.     04770099
052300                 20  ASC-KEY-UPC-NBR             PIC S9(15)       04810099
052400                                                     COMP-3.      04820099
052500                 20  ASC-KEY-TRANSACTION-TYPE    PIC  X(02).      04830099
052600                 20  ASC-KEY-VOID-TRANSACTION-IND                 04840099
052700                                                 PIC  X(01).      04850099
052800                 20  ASC-KEY-FROM-PARTN-NBR      PIC S9(04) COMP. 04860099
052900                 20  ASC-KEY-FROM-STRUC-CDE      PIC  X(01).      04870099
053000                 20  ASC-KEY-TO-PARTN-NBR        PIC S9(04) COMP. 04880099
053100                 20  ASC-KEY-TO-STRUC-CDE        PIC  X(01).      04890099
053200                 20  ASC-KEY-TRANS-AMOUNT-SIGN   PIC  X(01).      04900099
053300                 20  ASC-SAME-DATE-SW            PIC  X(01).      04910099
053400                 20  ASC-KEY-ECOM-ORD-NBR        PIC  X(40).      04911099
053500             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                04920099
053600                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  04930099
053700                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   04940099
053800                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   04950099
053900                                                                  04960099
054000                 20  ASC-ITEM-ARRAY.                              04970099
054100                     25  ASC-ITEM-ENTRIES OCCURS 14 TIMES.        04980099
054200                         30  ASC-LIST-ITEM-NUMBER                 04990099
054300                                                     PIC S9(07)   05000099
054400                                                     COMP-3.      05010099
054500                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  05020099
054600                             88  ASC-VALID-SELECT    VALUE ' '    05030099
054700                                                           'S'    05040099
054800                                                           'B'    05050099
054900                                                           'E'.   05060099
055000                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   05070099
055100                             88  ASC-TEMP-SELECT     VALUE 'S'.   05080099
055200                             88  ASC-TEMP-BEGIN      VALUE 'B'.   05090099
055300                             88  ASC-TEMP-END        VALUE 'E'.   05100099
055400                         30  ASC-SELECTED-SW         PIC  X(01).  05110099
055500                             88  ASC-NO-SELECT       VALUE ' '.   05120099
055600                             88  ASC-SELECT          VALUE 'S'.   05130099
055700                             88  ASC-BEGIN           VALUE 'B'.   05140099
055800                             88  ASC-END             VALUE 'E'.   05150099
055900                         30  ASC-ACTION              PIC  X(03).  05160099
056000                         30  ASC-PARTITION-NBR       PIC S9(04)   05170099
056100                                                         COMP.    05180099
056200                         30  ASC-SALES-DATE          PIC  X(10).  05190099
056300                         30  ASC-STORE               PIC S9(04)   05200099
056400                                                          COMP.   05210099
056500                         30  ASC-REGISTER            PIC S9(04)   05220099
056600                                                          COMP.   05230099
056700                         30  ASC-TRANSACTION         PIC S9(04)   05240099
056800                                                          COMP.   05250099
056900                         30  ASC-START-TIME          PIC X(08).   05260099
NEMCHG                         30  ASC-REGISTER-OPERATOR   PIC 9(07)    05270099
057100                                                          COMP-3. 05280099
057200                         30  ASC-TYPE                PIC  X(02).  05290099
057300                         30  ASC-ONLINE-IND          PIC  X(01).  05300099
057400                         30  ASC-AMOUNT          PIC S9(07)V9(02) 05310099
057500                                                          COMP-3. 05320099
057600                         30  ASC-SALES-CORR-SEQ-NBR  PIC S9(04)   05330099
057700                                                           COMP.  05340099
057800                         30  ASC-SOURCE-TEXT         PIC  X(03).  05350099
057900                         30  ASC-STATUS              PIC  X(02).  05360099
058000                             88 ASC-STAT-VALID-CORR  VALUE 'V'.   05370099
058100                             88 ASC-STAT-VALID-POS   VALUE 'Z'.   05380099
058200                             88 ASC-STAT-MIS-TOT     VALUE 'S'.   05390099
058300                             88 ASC-STAT-MIS-TND     VALUE 'T'.   05400099
058400                             88 ASC-STAT-OUT-BAL-TND VALUE 'B'.   05410099
058500                             88 ASC-STAT-OUT-BAL-ITM VALUE 'O'.   05420099
058600                             88 ASC-STAT-NON-NUM-ACT VALUE 'N'.   05430099
058700                             88 ASC-STAT-MIS-ACT     VALUE 'M'.   05440099
058800                             88 ASC-STAT-INVAL-COR   VALUE 'W'.   05450099
058900                             88 ASC-STAT-INVAL-PRE   VALUE 'P'.   05460099
059000                             88 ASC-STAT-INVAL-C-D   VALUE 'C'.   05470099
059100                             88 ASC-STAT-INVAL-STR   VALUE 'I'.   05480099
059200                             88 ASC-STAT-REVERSAL    VALUE 'R'.   05490099
059300                             88 ASC-STAT-LATE-DC     VALUE 'L'.   05500099
059400                             88 ASC-STAT-INVAL-HD-TOT             05510099
059500                                                     VALUE 'H'.   05520099
059600                             88 ASC-STAT-ERROR-GEN   VALUE 'E'.   05530099
059700                             88 ASC-STAT-INCOMP-DATA VALUE 'D'.   05540099
059800                         30  ASC-STATUS-TEXT         PIC  X(12).  05550099
059900                         30  ASC-VOID-CODE           PIC  X(01).  05560099
060000                             88 ASC-VOID-AFTER       VALUE 'V'.   05570099
060100                             88 ASC-VOID-DURING      VALUE 'A'.   05580099
060200                             88 ASC-VOID-AFTER-DURING             05590099
060300                                                     VALUE 'I'.   05600099
060400                             88 ASC-VOID-DURING-AFTER             05610099
060500                                                     VALUE 'B'.   05620099
060600                             88 ASC-VOID-REVERSED    VALUE 'R'.   05630099
060700                             88 ASC-VOID-UNCORRECTED VALUE 'U'.   05640099
060800                             88 ASC-VOID-NORMAL      VALUE 'N'.   05650099
060900                         30  ASC-VOID-CODE-TEXT      PIC  X(12).  05660099
061000                         30  ASC-AVAIL-OTR-AMT   PIC S9(07)V9(02) 05670099
061100                                                          COMP-3. 05680099
061200                                                                  05690099
061300                                                                  05700099
061400             15  ASC-BLK-SUB                         PIC S9(04)   05710099
061500                                                          COMP    05720099
061600                                                          SYNC.   05730099
061700             15  ASC-ITEM-SUB                        PIC S9(04)   05740099
061800                                                          COMP    05750099
061900                                                          SYNC.   05760099
062000             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   05770099
062100                                                          COMP-3. 05780099
062200             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   05790099
062300                                                          COMP-3. 05800099
062400             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   05810099
062500                                                          COMP-3. 05820099
062600             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   05830099
062700                                                          COMP-3. 05840099
062800             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   05850099
062900                                                          COMP-3. 05860099
063000             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   05870099
063100                                                          COMP    05880099
063200                                                          SYNC.   05890099
063300             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   05900099
063400                                                          COMP-3. 05910099
063500             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   05920099
063600                                                          COMP-3. 05930099
063700             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  05940099
063800                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   05950099
063900                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   05960099
064000             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  05970099
064100                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   05980099
064200                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   05990099
064300             15  ASC-LIST-QUEUE-NAME.                             06000099
064400                 20  ASC-LIST-TERM-ID                PIC  X(04).  06010099
064500                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   06020099
064600                                                          COMP-3. 06030099
064700                 20  ASC-LIST-SEQ                    PIC  9(01).  06040099
064800             15  ASC-SEL-QUEUE-NAME.                              06050099
064900                 20  ASC-SEL-TERM-ID                 PIC  X(04).  06060099
065000                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   06070099
065100                                                          COMP-3. 06080099
065200                 20  ASC-SEL-SEQ                     PIC  9(01).  06090099
065300                                                                  06100099
065400             15  ASC-START-ITEM-REQUEST.                          06110099
065500                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  06120099
065600             15  ASC-VIEW-IND                        PIC  X(01).  06130099
065700                 88  ASC-LEFT-VIEW                   VALUE 'L'.   06140099
065800                 88  ASC-RIGHT-VIEW                  VALUE 'R'.   06150099
065900         10  FILLER                                  PIC  X(280). 06160099
066000                                                                  06170099
066100*---------------------------------------------------------------* 06180099
066200*    ABEND PROCESSING COPYBOOK.                                 * 06190099
066300*---------------------------------------------------------------* 06200099
066400                                                                  06210099
066500     COPY DPWS013.                                                06220099
066600                                                                  06230099
066700*---------------------------------------------------------------* 06240099
066800*    DB2 AREA FOR TEPTRN (TRANSACTION TABLE)                    * 06250099
066900*---------------------------------------------------------------* 06260099
067000     EXEC SQL                                                     06270099
067100          INCLUDE TEPTRN                                          06280099
067200     END-EXEC.                                                    06290099
067300                                                                  06300099
067400*---------------------------------------------------------------* 06310099
067500*    DB2 AREA FOR TEPPART (PARTITION TABLE)                     * 06320099
067600*---------------------------------------------------------------* 06330099
067700     EXEC SQL                                                     06340099
067800          INCLUDE TEPPART                                         06350099
067900     END-EXEC.                                                    06360099
068000                                                                  06370099
068100*---------------------------------------------------------------* 06380099
068200*    DB2 AREA FOR TEPSTGP (STORE GROUP TABLE)                   * 06390099
068300*---------------------------------------------------------------* 06400099
068400     EXEC SQL                                                     06410099
068500          INCLUDE TEPSTGP                                         06420099
068600     END-EXEC.                                                    06430099
068700                                                                  06440099
068800*---------------------------------------------------------------* 06441099
068900*    DB2 AREA FOR XST_LOC (STORE INFORMATION TABLE)             * 06442099
069000*---------------------------------------------------------------* 06443099
069100     EXEC SQL                                                     06444099
069200          INCLUDE XST00001                                        06445099
069300     END-EXEC.                                                    06446099
069400                                                                  06447099
069500*---------------------------------------------------------------* 06448099
069600*    DB2 AREA FOR TEPORD (E-COMMERCE ORDER NUMBER TABLE)       *  06449099
069700*---------------------------------------------------------------* 06449199
069800     EXEC SQL                                                     06449299
069900          INCLUDE TEPORD                                          06449399
070000     END-EXEC.                                                    06449499
070100                                                                  06449599
069500*---------------------------------------------------------------* 06448099
069600*    DB2 AREA FOR EPT_DR_CRD_TNDR (DEBIT CARD TABLE)            * 06449099
069700*---------------------------------------------------------------* 06449199
069800     EXEC SQL                                                     06449299
069900          INCLUDE EPT00002                                        06449399
070000     END-EXEC.                                                    06449499
070100                                                                  06449599
070900*---------------------------------------------------------------* 06451099
071000*    DB2 AREA FOR COMMUNICATIONS                                * 06460099
071100*---------------------------------------------------------------* 06470099
071200     EXEC SQL                                                     06480099
071300          INCLUDE SQLCA                                           06490099
071400     END-EXEC.                                                    06500099
071500                                                                  06510099
071600 LINKAGE SECTION.                                                 06520099
071700                                                                  06530099
071800 01  DFHCOMMAREA.                                                 06540099
071900     05  FILLER                         OCCURS  1 TO 4072 TIMES   06550099
072000                                        DEPENDING ON EIBCALEN.    06560099
072100         10  FILLER                     PIC X.                    06570099
072200                                                                  06580099
072300 PROCEDURE DIVISION.                                              06590099
072400*----------------------------------------------------------------*06600099
072500*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM.  *06610099
072600*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM   *06620099
072700*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT.  *06630099
072800*----------------------------------------------------------------*06640099
072900 0000-MAIN-MODULE.                                                06650099
073000     INITIALIZE DP030-CICS-API-FIELDS.                            06660099
073100     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       06670099
073200     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          06680099
073300     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         06690099
073400     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       06700099
073500     MOVE LENGTH OF SA426AI        TO DP030-MAP-LENGTH (1).       06710099
073600     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     06720099
073700     PERFORM 0001-CALL-CICS-ARCH-API.                             06730099
073800                                                                  06740099
073900     PERFORM 1000-CONTROL-PROCESSING                              06750099
074000                                                                  06760099
074100     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     06770099
074200     PERFORM 0001-CALL-CICS-ARCH-API.                             06780099
074300                                                                  06790099
074400*----------------------------------------------------------------*06800099
074500*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *06810099
074600*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *06820099
074700*----------------------------------------------------------------*06830099
074800 0001-CALL-CICS-ARCH-API.                                         06840099
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      06850099
075000                                    DFHCOMMAREA                           
075100                                    DP030-CICS-API-FIELDS                 
075200                                    DP020-STANDARD-COMMAREA               
075300                                    SA426AI.                              
075400                                                                  06900099
075500     IF  DP030-RC-CALL-SUCCESSFUL                                 06910099
075600         CONTINUE                                                 06920099
075700     ELSE                                                         06930099
075800         SET DP013-NO-ROLLBACK                                    06940099
075900             DP013-XCTL-DISPLAY-RESTART                           06950099
076000             DP013-CICS-ABEND      TO TRUE                        06960099
076100         MOVE '0001-CALL-CICS-ARCH-API'                           06970099
076200                                   TO DP013-PARAGRAPH             06980099
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
076500         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      07010099
076600         PERFORM DP013-0000-PROCESS-ABEND                         07020099
076700     END-IF.                                                      07030099
076800*----------------------------------------------------------------*07040099
076900* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *07050099
077000* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *07060099
077100*                                                                *07070099
077200* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *07080099
077300*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *07090099
077400*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *07100099
077500*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *07110099
077600*----------------------------------------------------------------*07120099
077700                                                                  07130099
077800 1000-CONTROL-PROCESSING.                                         07140099
077900                                                                  07150099
078000     EVALUATE TRUE                                                07160099
078100         WHEN DP020-NEXT-ACT-INITIAL                              07170099
078200             INITIALIZE ASC-SPECIFIC-COMMAREA                     07180099
078300             SET ASC-LEFT-VIEW     TO TRUE                        07190099
078400             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            07200099
078500                                      ASC-SEL-TERM-ID             07210099
078600             MOVE DP020-SRC-TASK-NUMBER                           07220099
078700                                   TO ASC-LIST-TASK-NUMBER        07230099
078800                                      ASC-SEL-TASK-NUMBER         07240099
078900             MOVE PC-LIST-QUEUE-SEQ                               07250099
079000                                   TO ASC-LIST-SEQ                07260099
079100             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 07270099
079200             PERFORM 1100-PROCESS-INTER-APPL-COMM                 07280099
079300**  CHECK TO SEE IF CALLING PROGRAM SAKCS425 IS PASSING AN        07282099
079400**  E-STORE THROUGH.  IF THE E-COMMERCE ORDER NBR IS FILLED       07283099
079500**  IN, THE STORE MUST BE AN E-STORE.  IF NOT, RETURN             07284099
079600**  TO THE CALLING PROGRAM (SAKCS425 EJ CRITERIA SPEC) TO         07284199
079700**  DISPLAY AN ERROR.                                             07285099
079800             IF SA031-STORE > ZERO                                07285199
079900                 PERFORM 1150-VERIFY-E-STORE                      07286099
080000             END-IF                                               07286199
080100             IF ASC-KEY-ECOM-ORD-NBR NOT EQUAL SPACE              07287099
080200                 IF PS-E-STORE-YES                                07288099
080300                      SET PS-COMMAREA-VALID TO TRUE               07288199
080400                 ELSE                                             07288299
080500                     SET PS-COMMAREA-NOT-VALID                    07288399
080600                         DP020-NEXT-ACT-APPL-ERROR                07288499
080700                         DP020-MSG-FATAL        TO TRUE           07288599
080800                     MOVE PC-TSYMSG-02748  TO DP020-MSG-NUMBER    07288699
080900                 END-IF                                           07289499
081000             END-IF                                               07289599
081100***-----$TEMPLATE NOTE$-------------------------------------------07290099
081200*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,07300099
081300*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  07310099
081400*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.07320099
081500***---------------------------------------------------------------07330099
081600             IF  PS-COMMAREA-NOT-VALID                            07340099
081700                 SET DP020-NEXT-ACT-APPL-ERROR                    07350099
081800                                   TO TRUE                        07360099
081900             ELSE                                                 07370099
082000                 PERFORM 4000-BUILD-INITIAL-PANEL                 07380099
082100             END-IF                                               07390099
082200                                                                  07400099
082300         WHEN DP020-NEXT-ACT-READ-MAP                             07400199
082400             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        07400200
082500                                   TO PV-TOP-ITEM                 07400300
082600             PERFORM 2000-PROCESS-PANEL                           07400400
082700                                                                  07400599
082800         WHEN DP020-NEXT-ACT-RETURN                               07400699
082900             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        07400799
083000                                   TO PV-TOP-ITEM                 07400899
083100             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    07400999
083200             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 07401099
083300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07402099
083400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07403099
083500                                                                  07404099
083600         WHEN OTHER                                               07405099
083700             SET DP013-LOGIC-ABEND TO TRUE                        07406099
083800             SET DP013-NO-ROLLBACK TO TRUE                        07407099
083900             MOVE '1000-CONTROL-PROCESSING'                       07408099
084000                                   TO DP013-PARAGRAPH             07409099
084100             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    07410099
084200                                   TO DP013-MESSAGE-TEXT(1)       07420099
084300             PERFORM DP013-0000-PROCESS-ABEND                     07430099
084400     END-EVALUATE.                                                07440099
084500                                                                  07450099
084600*----------------------------------------------------------------*07462099
084700* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *07470099
084800* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *07480099
084900*----------------------------------------------------------------*07490099
085000                                                                  07500099
085100 1100-PROCESS-INTER-APPL-COMM.                                    07510099
085200                                                                  07520099
085300     SET PS-COMMAREA-VALID         TO TRUE.                       07530099
085400     MOVE SA031-SAME-DATE-SW       TO ASC-SAME-DATE-SW.           07540099
085500     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     07550099
085600     MOVE SA031-SALES-DATE-FROM    TO ASC-KEY-SALES-DATE-FROM.    07560099
085700                                                                  07570099
085800     IF ASC-SAME-DATE-SW            = 'Y'                         07580099
085900        MOVE SA031-SALES-DATE-FROM TO ASC-KEY-SALES-DATE-TO       07590099
086000     ELSE                                                         07600099
086100        MOVE SA031-SALES-DATE-TO   TO ASC-KEY-SALES-DATE-TO       07610099
086200     END-IF.                                                      07620099
086300                                                                  07630099
086400     MOVE SA031-STORE              TO ASC-KEY-STORE.              07640099
086500     MOVE SA031-REGISTER           TO ASC-KEY-REGISTER.           07650099
086600     MOVE SA031-TRANSACTION        TO ASC-KEY-TRANSACTION.        07660099
086700     MOVE SA031-TRANSACTION-AMOUNT TO ASC-KEY-TRANSACTION-AMOUNT. 07670099
086800     MOVE SA031-PUR-ASSOC-ID       TO ASC-KEY-PUR-ASSOC-ID.       07680099
086900     MOVE SA031-OPERATOR-ID        TO ASC-KEY-OPERATOR-ID.        07690099
087000                                                                  07700099
087000     INSPECT SA031-TENDER-ID                                      07700099
087000        TALLYING PV-LEADING-SPACE-COUNT                           07700099
087000           FOR LEADING PC-SPACE.                                  07700099
087000                                                                  07700099
087000     COMPUTE PV-BEG-POS = PV-LEADING-SPACE-COUNT + 1.             07700099
087000                                                                  07700099
087000     COMPUTE PV-LENGTH = LENGTH OF SA031-TENDER-ID                07700099
087000                       - PV-LEADING-SPACE-COUNT.                  07700099
087000                                                                  07700099
087000     MOVE SA031-TENDER-ID(PV-BEG-POS:PV-LENGTH)                   07700099
087000                                   TO ASC-KEY-TENDER-ID.          07700099
087000                                                                  07700099
087100     MOVE SA031-TENDER-TYPE        TO ASC-KEY-TENDER-TYPE.        07710099
087100     MOVE SA031-DEBIT-TYPE         TO ASC-KEY-DEBIT-TYPE.         07710099
087200     MOVE SA031-DRIVERS-LICENSE-NBR                               07720099
087300                                   TO ASC-KEY-DRIVERS-LICENSE-NBR.07730099
087400     MOVE SA031-KEYED-TENDER-IND   TO ASC-KEY-KEYED-TENDER-IND.   07740099
087500     MOVE SA031-SKU                TO ASC-KEY-SKU.                07750099
087600     MOVE SA031-UPC-NBR            TO ASC-KEY-UPC-NBR.            07760099
087700     MOVE SA031-TRANSACTION-TYPE   TO ASC-KEY-TRANSACTION-TYPE.   07770099
087800     MOVE SA031-VOID-TRANSACTION-IND                              07780099
087900                                 TO ASC-KEY-VOID-TRANSACTION-IND. 07790099
088000     MOVE SA031-TRANSACTION-AMOUNT-SIGN                           07800099
088100                                   TO ASC-KEY-TRANS-AMOUNT-SIGN.  07810099
088200     MOVE SA031-ECOM-ORD-NBR       TO ASC-KEY-ECOM-ORD-NBR.       07811099
088300     PERFORM 7000-VALIDATE-DATE-RANGE.                            07820099
088400                                                                  07830099
088500*----------------------------------------------------------------*07831099
088600* CHECK TO SEE IF THE USER ENTERED A VALID E-COMMERCE STORE IN   *07832099
088700* SAKCS425 (EJ CRITERIA SPEC SCREEN).                            *07833099
088800*----------------------------------------------------------------*07834099
088900                                                                  07835099
089000 1150-VERIFY-E-STORE.                                             07836099
089100                                                                  07837099
089200     EXEC SQL                                                     07838099
089300         SELECT  1                                                07839099
089400           INTO :PV-DUMMY                                         07839199
089500           FROM  XST_LOC                                          07839299
089600          WHERE  LOC_NBR            = :ASC-KEY-STORE              07839399
089700           AND   E_BUS_IND          =  'Y'                        07839499
089800           WITH  UR                                               07839599
089900     END-EXEC.                                                    07839699
090000                                                                  07839799
090100     EVALUATE TRUE                                                07839899
090200         WHEN SQLCODE = ZERO                                      07839999
090300             SET PS-E-STORE-YES         TO TRUE                   07840099
090400         WHEN SQLCODE NOT EQUAL ZERO                              07840299
090500             SET PS-E-STORE-NO          TO TRUE                   07840499
090600     END-EVALUATE.                                                07841099
090700                                                                  07841199
090800                                                                  07841299
090900*----------------------------------------------------------------*07842099
091000* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *07850099
091100* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *07860099
091200* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *07870099
091300* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *07880099
091400* FUNCTION KEYS CAN GET THIS FAR.                                *07890099
091500*----------------------------------------------------------------*07900099
091600                                                                  07910099
091700 2000-PROCESS-PANEL.                                              07920099
091800     EVALUATE TRUE                                                07930099
091900         WHEN DP020-SRC-AID = DP016-CLEAR                         07940099
092000             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    07950099
092100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07960099
092200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07970099
092300                                                                  07980099
092400         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    07990099
092500                                                                  08000099
092600*** THE REFRESH KEY JSUT DOES A MOVE IN THIS CASE.  THIS IS OK    08010099
092700*** BECAUSE THE DATA THAT THE SCREEN DISPLAYS DOES NOT CHANGE.    08020099
092800*** THERE IS NO NEED TO HAVE DB2 DO ALL THE WORK WHEN IT IS NOT   08030099
092900*** NECESSARY.                                                    08040099
093000                                                                  08050099
093100             SET ASC-LEFT-VIEW     TO TRUE                        08060099
093200             MOVE +1               TO PV-TOP-ITEM                 08070099
093300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08080099
093400                                                                  08090099
093500         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    08100099
093600             PERFORM 2140-DESELECT-ALL-ITEMS                      08110099
093700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08120099
093800                                                                  08130099
093900         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  08140099
094000             PERFORM 2150-SELECT-ALL-ITEMS                        08150099
094100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08160099
094200                                                                  08170099
094300         WHEN OTHER                                               08180099
094400             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 08190099
094500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   08200099
094600             IF  PS-NO-ERROR                                      08210099
094700                 SET DP030-CONTINUE-GO                            08220099
094800                                 TO TRUE                          08230099
094900                 PERFORM 2100-CHECK-FUNCTION-KEY                  08240099
095000             ELSE                                                 08250099
095100                 SET DP030-OVERRIDE-GO                            08260099
095200                                 TO TRUE                          08270099
095300             END-IF                                               08280099
095400     END-EVALUATE.                                                08290099
095500                                                                  08300099
095600*----------------------------------------------------------------*08310099
095700*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *08320099
095800*----------------------------------------------------------------*08330099
095900 2050-DELETE-LIST-QUEUE.                                          08340099
096000                                                                  08350099
096100     EXEC CICS                                                    08360099
096200         DELETEQ TS                                               08370099
096300             QUEUE (ASC-LIST-QUEUE-NAME)                          08380099
096400             RESP  (PV-CICS-RESP)                                 08390099
096500     END-EXEC.                                                    08400099
096600                                                                  08410099
096700     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       08420099
096800        (PV-CICS-RESP = DFHRESP(QIDERR))                          08430099
096900         CONTINUE                                                 08440099
097000     ELSE                                                         08450099
097100         SET DP013-CICS-ABEND      TO TRUE                        08460099
097200         SET DP013-NO-ROLLBACK     TO TRUE                        08470099
097300                                                                  08480099
097400         MOVE '2050-DELETE-LIST-QUEUE'                            08490099
097500                                   TO DP013-PARAGRAPH             08500099
097600         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    08510099
097700                                   TO DP013-MESSAGE-TEXT (1)      08520099
097800         PERFORM DP013-0000-PROCESS-ABEND                         08530099
097900     END-IF.                                                      08540099
098000                                                                  08550099
098100     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  08560099
098200                                                                  08570099
098300*----------------------------------------------------------------*08580099
098400* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*08590099
098500* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *08600099
098600* CICS ARCHITECTURE API.                                         *08610099
098700*----------------------------------------------------------------*08620099
098800 2100-CHECK-FUNCTION-KEY.                                         08630099
098900     EVALUATE TRUE                                                08640099
099000         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)               08650099
099100         WHEN DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)               08660099
099200         WHEN DP020-FK-LOCAL-FUNC-03(DP020-SRC-AID)               08670099
099300         WHEN DP020-FK-LOCAL-FUNC-04(DP020-SRC-AID)               08680099
099400         WHEN DP020-FK-LOCAL-FUNC-05(DP020-SRC-AID)               08690099
099500         WHEN DP020-FK-LOCAL-FUNC-06(DP020-SRC-AID)                       
099600                                                                  08700099
099700             IF  ASC-NUMBER-OF-SELECTED-ITEMS = +1                08710099
099800                 INITIALIZE SA004-INTER-APPL-COMMAREA             08720099
099900                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                08730099
100000                                TO SA004-NUMBER-OF-SELECTED-ITEMS 08740099
100100                 PERFORM 5000-PREPARE-SEL-QUEUE                   08750099
100200             ELSE                                                 08760099
100300                 IF ASC-NUMBER-OF-SELECTED-ITEMS > +1             08770099
100400                     SET DP030-OVERRIDE-GO                        08780099
100500                                   TO TRUE                        08790099
100600                     MOVE PC-TSYMSG-00047                         08800099
100700                                   TO DP020-MSG-NUMBER            08810099
100800                     SET DP020-MSG-FATAL                          08820099
100900                                   TO TRUE                        08830099
101000                 ELSE                                             08840099
101100                     SET DP030-OVERRIDE-GO                        08850099
101200                                   TO TRUE                        08860099
101300                     MOVE PC-TSYMSG-00057                         08870099
101400                                   TO DP020-MSG-NUMBER            08880099
101500                     SET DP020-MSG-WARNING                        08890099
101600                                   TO TRUE                        08900099
101700                 END-IF                                           08910099
101800             END-IF                                               08920099
101900                                                                  08930099
102000         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  08940099
102100             MOVE +1               TO PV-TOP-ITEM                 08950099
102200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08960099
102300                                                                  08970099
102400         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   08980099
102500             PERFORM 2110-BROWSE-BACKWARD                         08990099
102600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09000099
102700                                                                  09010099
102800         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   09020099
102900             PERFORM 2120-BROWSE-FORWARD                          09030099
103000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09040099
103100                                                                  09050099
103200         WHEN DP020-FK-LEFT (DP020-SRC-AID)                       13840099
103300             SET ASC-LEFT-VIEW  TO TRUE                           13850099
103400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 13860099
103500                                                                  13870099
103600         WHEN DP020-FK-RIGHT (DP020-SRC-AID)                      13880099
103700             SET ASC-RIGHT-VIEW TO TRUE                           13890099
103800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 13900099
103900                                                                  13910099
104000         WHEN DP020-SRC-AID = DP016-ENTER                         13920099
104100             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   13930099
104200             IF  PS-ERROR                                         13940099
104300                 CONTINUE                                         13950099
104400             ELSE                                                 13960099
104500                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             13970099
104600             END-IF                                               13980099
104700                                                                  13990099
104800         WHEN OTHER                                               14000099
104900             SET DP013-NO-ROLLBACK                                14010099
105000                 DP013-XCTL-DISPLAY-RESTART                       14020099
105100                 DP013-CICS-ABEND  TO TRUE                        14030099
105200             MOVE '2100-CHECK-FUNCTION-KEY'                       14040099
105300                                   TO DP013-PARAGRAPH             14050099
105400             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      14060099
105500                                   TO DP013-MESSAGE-TEXT (1)      14070099
105600             PERFORM DP013-0000-PROCESS-ABEND                     14080099
105700     END-EVALUATE.                                                14090099
105800                                                                  14100099
105900*----------------------------------------------------------------*14110099
106000*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *14120099
106100*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *14130099
106200*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *14140099
106300*    MESSAGE.                                                    *14150099
106400*----------------------------------------------------------------*14160099
106500                                                                  14170099
106600 2110-BROWSE-BACKWARD.                                            14180099
106700     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    14190099
106800         GIVING PV-TOP-ITEM.                                      14200099
106900                                                                  14210099
107000     IF  ((PV-TOP-ITEM < +1)                                      14220099
107100       OR (PV-TOP-ITEM = +1))                                     14230099
107200         MOVE +1                   TO PV-TOP-ITEM                 14240099
107300*        -- TOP OF LIST --                                        14250099
107400         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            14260099
107500         SET DP020-MSG-INFORMATIONAL TO TRUE                      14270099
107600     END-IF.                                                      14280099
107700                                                                  14290099
107800*----------------------------------------------------------------*14300099
107900*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *14310099
108000*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *14320099
108100*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *14330099
108200*----------------------------------------------------------------*14340099
108300 2120-BROWSE-FORWARD.                                             14350099
108400                                                                  14360099
108500     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              14370099
108600         GIVING PV-TOP-ITEM.                                      14380099
108700     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   14390099
108800         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            14400099
108900                                   TO PV-TOP-ITEM                 14410099
109000*        -- BOTTOM OF LIST --                                     14420099
109100         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            14430099
109200         SET DP020-MSG-INFORMATIONAL                              14440099
109300                                   TO TRUE                        14450099
109400     ELSE                                                         14460099
109500         COMPUTE PV-BOTTOM-ITEM =                                 14470099
109600             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 14480099
109700         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            14490099
109800*            -- BOTTOM OF LIST --                                 14500099
109900             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            14510099
110000             SET DP020-MSG-INFORMATIONAL                          14520099
110100                                   TO TRUE                        14530099
110200         END-IF                                                   14540099
110300     END-IF.                                                      14550099
110400                                                                  14560099
110500*----------------------------------------------------------------*14570099
110600*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *14580099
110700*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *14590099
110800*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *14600099
110900*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *14610099
111000*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *14620099
111100*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *14630099
111200*----------------------------------------------------------------*14640099
111300 2130-CHECK-FOR-JUMP-BROWSE.                                      14650099
111400                                                                  14660099
111500     SET PS-NO-ERROR               TO TRUE.                       14670099
111600     IF (ASC-START-ITEM-REQUEST = SPACE)                          14680099
111700         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            14690099
111800                                   TO PV-TOP-ITEM                 14700099
111900     ELSE                                                         14710099
112000         MOVE ASC-START-ITEM-REQUEST                              14720099
112100                                   TO DP010I-UNEDITED-FIELD       14730099
112200         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       14740099
112300         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     14750099
112400         SET DP010I-NEGATIVE-NOT-ALLOWED                          14760099
112500                                   TO TRUE                        14770099
139218         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
139218                         USING DP010I-NUMERIC-EDIT-AREA                   
112700                                                                  14790099
112800         IF  NOT DP010I-ERROR-DETECTED                            14800099
112900             MOVE DP010I-NUMERIC-FIELD                            14810099
113000                                   TO  ASC-START-ITEM-REQUEST-N   14820099
113100             IF  ASC-START-ITEM-REQUEST-N > ZERO                  14830099
113200                 IF  ASC-START-ITEM-REQUEST-N >                   14840099
113300                                          ASC-NUMBER-OF-ITEMS-READ14850099
113400                     MOVE SPACE TO ASC-START-ITEM-REQUEST         14860099
113500                     COMPUTE PV-TOP-ITEM =                        14870099
113600                             ASC-NUMBER-OF-ITEMS-READ             14880099
113700                             - PC-ITEMS-PER-PANEL + 1             14890099
113800                     IF  PV-TOP-ITEM < +1                         14900099
113900                         MOVE +1   TO PV-TOP-ITEM                 14910099
114000                         MOVE PC-TSYMSG-00070                     14920099
114100                                   TO DP020-MSG-NUMBER            14930099
114200                         SET DP020-MSG-INFORMATIONAL              14940099
114300                                   TO TRUE                        14950099
114400                     END-IF                                       14960099
114500                 ELSE                                             14970099
114600                     MOVE ASC-START-ITEM-REQUEST-N                14980099
114700                                   TO PV-TOP-ITEM                 14990099
114800                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      15000099
114900                     COMPUTE PV-BOTTOM-ITEM =                     15010099
115000                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     15020099
115100                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ15030099
115200*                        -- BOTTOM OF LIST --                     15040099
115300                         MOVE PC-TSYMSG-00070                     15050099
115400                                   TO DP020-MSG-NUMBER            15060099
115500                         SET DP020-MSG-INFORMATIONAL              15070099
115600                                   TO TRUE                        15080099
115700                     END-IF                                       15090099
115800                 END-IF                                           15100099
115900             ELSE                                                 15110099
116000*                --- VALUE OUT OF RANGE ----                      15120099
116100                 MOVE PC-TSYMSG-00101                             15130099
116200                                   TO DP020-MSG-NUMBER            15140099
116300                 MOVE -1           TO ASTRTITL                    15150099
116400                 SET DP030-SET-CURSOR-APPL-1                      15160099
116500                                   TO TRUE                        15170099
116600                 MOVE DP015-REVERSE                               15180099
116700                                   TO ASTRTITH                    15190099
116800                 MOVE DP015-RED    TO ASTRTITC                    15200099
116900                 MOVE DP015-UNP-NUM-BRT-MDT                       15210099
117000                                   TO ASTRTITA                    15220099
117100                 SET DP020-MSG-FATAL                              15230099
117200                                   TO TRUE                        15240099
117300                 SET PS-ERROR      TO TRUE                        15250099
117400             END-IF                                               15260099
117500                                                                  15270099
117600         ELSE                                                     15280099
117700             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            15290099
117800             MOVE -1               TO ASTRTITL                    15300099
117900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  15310099
118000             MOVE DP015-REVERSE    TO ASTRTITH                    15320099
118100             MOVE DP015-RED        TO ASTRTITC                    15330099
118200             MOVE DP015-UNP-NUM-BRT-MDT                           15340099
118300                                   TO ASTRTITA                    15350099
118400             SET DP020-MSG-FATAL   TO TRUE                        15360099
118500             SET PS-ERROR          TO TRUE                        15370099
118600         END-IF                                                   15380099
118700     END-IF.                                                      15390099
118800                                                                  15400099
118900*----------------------------------------------------------------*15410099
119000*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *15420099
119100*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *15430099
119200*----------------------------------------------------------------*15440099
119300 2140-DESELECT-ALL-ITEMS.                                         15450099
119400                                                                  15460099
119500     MOVE +1                       TO ASC-BLK-SUB.                15470099
119600                                                                  15480099
119700     PERFORM 2141-CLEAR-SELECTED-INDS                             15490099
119800         VARYING ASC-ITEM-SUB                                     15500099
119900         FROM 1 BY 1                                              15510099
120000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15520099
120100                                                                  15530099
120200     ADD +1                        TO ASC-BLK-SUB.                15540099
120300                                                                  15550099
120400     PERFORM 2141-CLEAR-SELECTED-INDS                             15560099
120500         VARYING ASC-ITEM-SUB                                     15570099
120600         FROM 1 BY 1                                              15580099
120700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15590099
120800                                                                  15600099
120900     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               15610099
121000                                   TO PV-LIST-ITEM-NUMBER.        15620099
121100                                                                  15630099
121200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            15640099
121300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    15650099
121400                                                                  15660099
121500     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     15670099
121600        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      15680099
121700         MOVE +1                   TO ASC-BLK-SUB                 15690099
121800                                                                  15700099
121900         PERFORM 5100-WRITE-TEMP-STORAGE                          15710099
122000                                                                  15720099
122100         MOVE +1                   TO PV-BLOCK-NUMBER             15730099
122200                                                                  15740099
122300         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         15750099
122400             PV-FIRST-BLOCK-IN-ARRAY - 1                          15760099
122500                                                                  15770099
122600         PERFORM                                                  15780099
122700             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       15790099
122800                                                                  15800099
122900             PERFORM 4410-READ-TEMP-STORAGE                       15810099
123000                                                                  15820099
123100             PERFORM 2141-CLEAR-SELECTED-INDS                     15830099
123200                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 15840099
123300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15850099
123400                                                                  15860099
123500             PERFORM 5100-WRITE-TEMP-STORAGE                      15870099
123600                                                                  15880099
123700             ADD +1                TO PV-BLOCK-NUMBER             15890099
123800                                                                  15900099
123900         END-PERFORM                                              15910099
124000                                                                  15920099
124100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         15930099
124200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     15940099
124300                                                                  15950099
124400         PERFORM                                                  15960099
124500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       15970099
124600                   ASC-HIGHEST-BLOCK-WRITTEN                      15980099
124700                                                                  15990099
124800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          16000099
124900                                   TO PV-BLOCK-NUMBER             16010099
125000                                                                  16020099
125100             PERFORM 4410-READ-TEMP-STORAGE                       16030099
125200                                                                  16040099
125300             PERFORM 2141-CLEAR-SELECTED-INDS                     16050099
125400                 VARYING ASC-ITEM-SUB                             16060099
125500                 FROM 1 BY 1                                      16070099
125600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16080099
125700                                                                  16090099
125800             PERFORM 5100-WRITE-TEMP-STORAGE                      16100099
125900                                                                  16110099
126000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      16120099
126100                                                                  16130099
126200         END-PERFORM                                              16140099
126300                                                                  16150099
126400         MOVE PV-FIRST-BLOCK-IN-ARRAY                             16160099
126500                                   TO PV-BLOCK-NUMBER             16170099
126600                                                                  16180099
126700         PERFORM 4410-READ-TEMP-STORAGE                           16190099
126800     END-IF.                                                      16200099
126900                                                                  16210099
127000                                                                  16220099
127100     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 16230099
127200     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.16240099
127300     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  16250099
127400                                                                  16260099
127500     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        16270099
127600                                                                  16280099
127700*----------------------------------------------------------------*16290099
127800*    MARK EACH ITEM AS BEING NOT SELECTED.                       *16300099
127900*----------------------------------------------------------------*16310099
128000 2141-CLEAR-SELECTED-INDS.                                        16320099
128100                                                                  16330099
128200     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           16340099
128300             NOT EQUAL ZERO                                       16350099
128400         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          16360099
128500             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          16370099
128600                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    16380099
128700                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  16390099
128800                                   TO TRUE                        16400099
128900         END-IF                                                   16410099
129000     END-IF.                                                      16420099
129100                                                                  16430099
129200*----------------------------------------------------------------*16440099
129300*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *16450099
129400*  FOR ALL ITEMS.                                                *16460099
129500*----------------------------------------------------------------*16470099
129600 2150-SELECT-ALL-ITEMS.                                           16480099
129700                                                                  16490099
129800     MOVE +1                       TO ASC-BLK-SUB.                16500099
129900                                                                  16510099
130000     PERFORM 2151-SET-SELECTED-INDS                               16520099
130100         VARYING ASC-ITEM-SUB                                     16530099
130200         FROM 1 BY 1                                              16540099
130300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16550099
130400                                                                  16560099
130500     ADD +1                        TO ASC-BLK-SUB.                16570099
130600                                                                  16580099
130700     PERFORM 2151-SET-SELECTED-INDS                               16590099
130800         VARYING ASC-ITEM-SUB                                     16600099
130900         FROM 1 BY 1                                              16610099
131000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16620099
131100                                                                  16630099
131200     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               16640099
131300                                   TO PV-LIST-ITEM-NUMBER.        16650099
131400                                                                  16660099
131500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            16670099
131600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    16680099
131700                                                                  16690099
131800     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     16700099
131900        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    16710099
132000         MOVE +1                   TO ASC-BLK-SUB                 16720099
132100                                                                  16730099
132200         PERFORM 5100-WRITE-TEMP-STORAGE                          16740099
132300                                                                  16750099
132400         MOVE +1                   TO PV-BLOCK-NUMBER             16760099
132500                                                                  16770099
132600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         16780099
132700             PV-FIRST-BLOCK-IN-ARRAY - 1                          16790099
132800                                                                  16800099
132900         PERFORM                                                  16810099
133000             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       16820099
133100                                                                  16830099
133200             PERFORM 4410-READ-TEMP-STORAGE                       16840099
133300                                                                  16850099
133400             PERFORM 2151-SET-SELECTED-INDS                       16860099
133500                 VARYING ASC-ITEM-SUB                             16870099
133600                 FROM 1 BY 1                                      16880099
133700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16890099
133800                                                                  16900099
133900             PERFORM 5100-WRITE-TEMP-STORAGE                      16910099
134000                                                                  16920099
134100             ADD +1                TO PV-BLOCK-NUMBER             16930099
134200                                                                  16940099
134300         END-PERFORM                                              16950099
134400                                                                  16960099
134500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         16970099
134600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     16980099
134700                                                                  16990099
134800         PERFORM                                                  17000099
134900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       17010099
135000                   ASC-HIGHEST-BLOCK-WRITTEN                      17020099
135100                                                                  17030099
135200             MOVE PV-NEXT-BLOCK-IN-ARRAY                          17040099
135300                                   TO PV-BLOCK-NUMBER             17050099
135400                                                                  17060099
135500             PERFORM 4410-READ-TEMP-STORAGE                       17070099
135600                                                                  17080099
135700             PERFORM 2151-SET-SELECTED-INDS                       17090099
135800                 VARYING ASC-ITEM-SUB                             17100099
135900                 FROM 1 BY 1                                      17110099
136000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          17120099
136100                                                                  17130099
136200             PERFORM 5100-WRITE-TEMP-STORAGE                      17140099
136300                                                                  17150099
136400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      17160099
136500                                                                  17170099
136600         END-PERFORM                                              17180099
136700                                                                  17190099
136800         MOVE PV-FIRST-BLOCK-IN-ARRAY                             17200099
136900                                   TO PV-BLOCK-NUMBER             17210099
137000                                                                  17220099
137100         PERFORM 4410-READ-TEMP-STORAGE                           17230099
137200     END-IF.                                                      17240099
137300                                                                  17250099
137400                                                                  17260099
137500     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             17270099
137600                       ASC-NUMBER-OF-SELECTED-ITEMS.              17280099
137700                                                                  17290099
137800     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        17300099
137900                                                                  17310099
138000*----------------------------------------------------------------*17320099
138100*    MARK EACH ITEM AS BEING SELECTED.                           *17330099
138200*----------------------------------------------------------------*17340099
138300 2151-SET-SELECTED-INDS.                                          17350099
138400                                                                  17360099
138500     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           17370099
138600             NOT EQUAL ZERO                                       17380099
138700         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             17390099
138800             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             17400099
138900                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        17410099
139000                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  17420099
139100                               TO  TRUE                           17430099
139200         END-IF                                                   17440099
139300     END-IF.                                                      17450099
139400*----------------------------------------------------------------*17460099
139500*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *17470099
139600*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *17480099
139700*----------------------------------------------------------------*17490099
139800 2200-MOVE-SCREEN-TO-COMMAREA.                                    17500099
139900                                                                  17510099
140000     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             17520099
140100     MOVE +1                       TO PV-SUB.                     17530099
140200                                                                  17540099
140300     PERFORM 3100-SET-SUBSCRIPTS.                                 17550099
140400     IF  ASTRTITL > ZERO                                          17560099
140500         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          17570099
140600     ELSE                                                         17580099
140700         IF  ASTRTITF = DP015-ERASE-EOF                           17590099
140800             INITIALIZE ASC-START-ITEM-REQUEST                    17600099
140900         END-IF                                                   17610099
141000     END-IF.                                                      17620099
141100     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          17630099
141200         VARYING PV-SUB                                           17640099
141300         FROM 1 BY 1                                              17650099
141400         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      17660099
141500*----------------------------------------------------------------*17670099
141600*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *17680099
141700*----------------------------------------------------------------*17690099
141800 2210-MOVE-LINES-TO-COMMAREA.                                     17700099
141900     IF  MR-SELECTL (PV-SUB) > ZERO                               17710099
142000         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             17720099
142100         MOVE MR-SELECTI (PV-SUB)                                 17730099
142200                                   TO ASC-TEMP-SELECTED-SW        17740099
142300                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      17750099
142400     ELSE                                                         17760099
142500         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                17770099
142600                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     17780099
142700                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        17790099
142800                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      17800099
142900         END-IF                                                   17810099
143000     END-IF.                                                      17820099
143100     ADD +1                        TO ASC-ITEM-SUB.               17830099
143200     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        17840099
143300         ADD +1                    TO ASC-BLK-SUB                 17850099
143400         MOVE +1                   TO ASC-ITEM-SUB                17860099
143500     END-IF.                                                      17870099
143600*----------------------------------------------------------------*17880099
143700*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *17890099
143800*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *17900099
143900*----------------------------------------------------------------*17910099
144000 3000-EDIT-DATA-IN-COMMAREA.                                      17920099
144100     SET PS-NO-ERROR               TO TRUE.                       17930099
144200     PERFORM 3200-RESET-ATTRIBUTES.                               17940099
144300     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     17950099
144400**                                                                17960099
144500* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              17970099
144600* EDITTING IS DONE FROM THE BOTTOM UP.                            17980099
144700**                                                                17990099
144800     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       18000099
144900         ASC-ITEMS-DISPLAYED - 1.                                 18010099
145000     PERFORM 3100-SET-SUBSCRIPTS.                                 18020099
145100     PERFORM 3300-EDIT-SELECTIONS                                 18030099
145200         VARYING PV-SUB                                           18040099
145300         FROM PV-SUB BY -1                                        18050099
145400         UNTIL PV-SUB < +1                                        18060099
145500                                                                  18070099
145600     IF  PS-NO-ERROR                                              18080099
145700         PERFORM 3400-CHECK-RANGE-SEQUENCE                        18090099
145800     END-IF.                                                      18100099
145900                                                                  18110099
146000     IF  ((PS-NO-ERROR)                                           18120099
146100       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   18130099
146200       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    18140099
146300             PERFORM 3500-MARK-RANGE-AS-SELECTED                  18150099
146400     END-IF.                                                      18160099
146500                                                                  18170099
146600*----------------------------------------------------------------*18180099
146700*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *18190099
146800*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*18200099
146900*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *18210099
147000*                                                                *18220099
147100*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *18230099
147200*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *18240099
147300*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *18250099
147400*    US IN THE 2ND BLOCK OF THE ARRAY.                           *18260099
147500*----------------------------------------------------------------*18270099
147600                                                                  18280099
147700 3100-SET-SUBSCRIPTS.                                             18290099
147800                                                                  18300099
147900     COMPUTE ASC-ITEM-SUB =                                       18310099
148000         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        18320099
148100                                                                  18330099
148200     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         18340099
148300         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            18350099
148400                                                                  18360099
148500         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               18370099
148600     ELSE                                                         18380099
148700         MOVE +1                     TO ASC-BLK-SUB               18390099
148800     END-IF.                                                      18400099
148900*----------------------------------------------------------------*18410099
149000*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *18420099
149100*----------------------------------------------------------------*18430099
149200                                                                  18440099
149300 3200-RESET-ATTRIBUTES.                                           18450099
149400     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   18460099
149500     MOVE DP015-GREEN              TO ASTRTITC.                   18470099
149600     MOVE DP015-UNDERLINE          TO ASTRTITH.                   18480099
149700                                                                  18490099
149800     PERFORM                                                      18500099
149900         VARYING PV-SUB                                           18510099
150000         FROM 1 BY 1                                              18520099
150100         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        18530099
150200         MOVE DP015-UNP-ALP-NOR-OFF                               18540099
150300                                   TO MR-SELECTA (PV-SUB)         18550099
150400         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         18560099
150500         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         18570099
150600     END-PERFORM.                                                 18580099
150700*----------------------------------------------------------------*18590099
150800*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *18600099
150900*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *18610099
151000*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *18620099
151100*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *18630099
151200*----------------------------------------------------------------*18640099
151300 3300-EDIT-SELECTIONS.                                            18650099
151400     EVALUATE TRUE                                                18660099
151500         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     18670099
151600             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         18680099
151700                 CONTINUE                                         18690099
151800         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         18700099
151900             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        18710099
152000                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   18720099
152100                 MOVE ASC-TEMP-SELECTED-SW                        18730099
152200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18740099
152300                                TO ASC-SELECTED-SW                18750099
152400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18760099
152500             END-IF                                               18770099
152600         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     18780099
152700                 = SPACE                                          18790099
152800             EVALUATE TRUE                                        18800099
152900                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       18810099
153000                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS18820099
153100                     MOVE SPACE TO ASC-SELECTED-SW                18830099
153200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18840099
153300                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        18850099
153400                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    18860099
153500                     MOVE SPACE TO ASC-SELECTED-SW                18870099
153600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18880099
153700                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          18890099
153800                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      18900099
153900                     MOVE SPACE TO ASC-SELECTED-SW                18910099
154000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18920099
154100             END-EVALUATE                                         18930099
154200         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           18940099
154300             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            18950099
154400                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    18960099
154500             END-IF                                               18970099
154600             PERFORM 3310-EDIT-RANGE                              18980099
154700         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             18990099
154800             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            19000099
154900                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    19010099
155000             END-IF                                               19020099
155100             PERFORM 3310-EDIT-RANGE                              19030099
155200         WHEN OTHER                                               19040099
155300             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           19050099
155400             SET DP020-MSG-FATAL    TO TRUE                       19060099
155500             MOVE -1                TO MR-SELECTL (PV-SUB)        19070099
155600             SET DP030-SET-CURSOR-APPL-1                          19080099
155700                                    TO TRUE                       19090099
155800             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        19100099
155900             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        19110099
156000             SET PS-ERROR TO TRUE                                 19120099
156100             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            19130099
156200                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     19140099
156300                 MOVE SPACE         TO ASC-SELECTED-SW            19150099
156400                                        (ASC-BLK-SUB ASC-ITEM-SUB)19160099
156500             END-IF                                               19170099
156600     END-EVALUATE.                                                19180099
156700                                                                  19190099
156800     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 19200099
156900     SUBTRACT +1 FROM ASC-ITEM-SUB.                               19210099
157000     IF  ASC-ITEM-SUB < 1                                         19220099
157100         SUBTRACT +1 FROM ASC-BLK-SUB                             19230099
157200         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                19240099
157300     END-IF.                                                      19250099
157400*----------------------------------------------------------------*19260099
157500*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *19270099
157600*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *19280099
157700*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *19290099
157800*  THE ENDING.                                                   *19300099
157900*----------------------------------------------------------------*19310099
158000 3310-EDIT-RANGE.                                                 19320099
158100     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                19330099
158200         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   19340099
158300             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)19350099
158400                                   TO ASC-SELECTED-SW             19360099
158500                                        (ASC-BLK-SUB ASC-ITEM-SUB)19370099
158600             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 19380099
158700         ELSE                                                     19390099
158800             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     19400099
158900                 CONTINUE                                         19410099
159000             ELSE                                                 19420099
159100*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        19430099
159200                 MOVE PC-TSYMSG-00054                             19440099
159300                                   TO DP020-MSG-NUMBER            19450099
159400                 SET DP020-MSG-FATAL                              19460099
159500                                   TO TRUE                        19470099
159600                 MOVE -1           TO MR-SELECTL (PV-SUB)         19480099
159700                 SET DP030-SET-CURSOR-APPL-1                      19490099
159800                                   TO TRUE                        19500099
159900                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         19510099
160000                 MOVE DP015-UNDERLINE                             19520099
160100                                   TO MR-SELECTH (PV-SUB)         19530099
160200                 SET PS-ERROR      TO TRUE                        19540099
160300             END-IF                                               19550099
160400         END-IF                                                   19560099
160500     ELSE                                                         19570099
160600         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     19580099
160700             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 19590099
160800                                   TO ASC-SELECTED-SW             19600099
160900                                     (ASC-BLK-SUB ASC-ITEM-SUB)   19610099
161000             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   19620099
161100         ELSE                                                     19630099
161200             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       19640099
161300                 CONTINUE                                         19650099
161400             ELSE                                                 19660099
161500*                -- ONLY ONE END-OF-RANGE ALLOWED --              19670099
161600                 MOVE PC-TSYMSG-00055                             19680099
161700                                   TO DP020-MSG-NUMBER            19690099
161800                 SET DP020-MSG-FATAL                              19700099
161900                                   TO TRUE                        19710099
162000                 MOVE -1           TO MR-SELECTL (PV-SUB)         19720099
162100                 SET DP030-SET-CURSOR-APPL-1                      19730099
162200                                   TO TRUE                        19740099
162300                 SET PS-ERROR      TO TRUE                        19750099
162400             END-IF                                               19760099
162500         END-IF                                                   19770099
162600     END-IF.                                                      19780099
162700                                                                  19790099
162800*----------------------------------------------------------------*19800099
162900*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *19810099
163000*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *19820099
163100*----------------------------------------------------------------*19830099
163200 3400-CHECK-RANGE-SEQUENCE.                                       19840099
163300     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       19850099
163400       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      19860099
163500       AND  ASC-START-OF-SELECTED-RANGE >                         19870099
163600                                         ASC-END-OF-SELECTED-RANGE19880099
163700*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                19890099
163800         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 19900099
163900         SET DP020-MSG-FATAL TO TRUE                              19910099
164000         SET PS-ERROR TO TRUE                                     19920099
164100         PERFORM 3410-POSITION-AT-ERROR                           19930099
164200     END-IF.                                                      19940099
164300*----------------------------------------------------------------*19950099
164400*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *19960099
164500*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *19970099
164600*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *19980099
164700*----------------------------------------------------------------*19990099
164800 3410-POSITION-AT-ERROR.                                          20000099
164900     SET DP030-SET-CURSOR-APPL-1                                  20010099
165000                                   TO TRUE.                       20020099
165100     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 20030099
165200                    - PV-TOP-ITEM + 1.                            20040099
165300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      20050099
165400         CONTINUE                                                 20060099
165500     ELSE                                                         20070099
165600         MOVE -1                   TO MR-SELECTL (PV-SUB)         20080099
165700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         20090099
165800         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         20100099
165900     END-IF.                                                      20110099
166000                                                                  20120099
166100     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   20130099
166200                    - PV-TOP-ITEM + 1.                            20140099
166300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      20150099
166400         CONTINUE                                                 20160099
166500     ELSE                                                         20170099
166600         MOVE -1                   TO MR-SELECTL (PV-SUB)         20180099
166700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         20190099
166800         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         20200099
166900     END-IF.                                                      20210099
167000                                                                  20220099
167100*----------------------------------------------------------------*20230099
167200*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *20240099
167300*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *20250099
167400*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *20260099
167500*----------------------------------------------------------------*20270099
167600                                                                  20280099
167700 3500-MARK-RANGE-AS-SELECTED.                                     20290099
167800     MOVE +1                       TO  ASC-BLK-SUB.               20300099
167900     PERFORM 3510-MARK-SELECTED-INDS                              20310099
168000         VARYING ASC-ITEM-SUB                                     20320099
168100         FROM 1 BY 1                                              20330099
168200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 20340099
168300                                                                  20350099
168400     ADD +1                        TO ASC-BLK-SUB.                20360099
168500     PERFORM 3510-MARK-SELECTED-INDS                              20370099
168600         VARYING ASC-ITEM-SUB                                     20380099
168700         FROM 1 BY 1                                              20390099
168800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 20400099
168900                                                                  20410099
169000     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               20420099
169100                                   TO  PV-LIST-ITEM-NUMBER.       20430099
169200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            20440099
169300         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         20450099
169400               PC-ITEMS-PER-PANEL).                               20460099
169500                                                                  20470099
169600     MOVE ASC-START-OF-SELECTED-RANGE                             20480099
169700                                   TO PV-START-OF-SELECTED-RANGE. 20490099
169800     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            20500099
169900         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  20510099
170000               PC-ITEMS-PER-PANEL).                               20520099
170100                                                                  20530099
170200     MOVE ASC-END-OF-SELECTED-RANGE                               20540099
170300                                   TO  PV-END-OF-SELECTED-RANGE.  20550099
170400     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             20560099
170500         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    20570099
170600               PC-ITEMS-PER-PANEL).                               20580099
170700     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             20590099
170800         PV-FIRST-BLOCK-IN-ARRAY + 1.                             20600099
170900                                                                  20610099
171000     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    20620099
171100        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        20630099
171200         MOVE +1                   TO ASC-BLK-SUB                 20640099
171300         PERFORM 5100-WRITE-TEMP-STORAGE                          20650099
171400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         20660099
171500             PV-FIRST-BLOCK-IN-ARRAY - 1                          20670099
171600                                                                  20680099
171700         PERFORM                                                  20690099
171800             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      20700099
171900                   PV-PREV-BLOCK-IN-ARRAY                         20710099
172000             MOVE PV-FIRST-BLOCK-IN-RANGE                         20720099
172100                                   TO PV-BLOCK-NUMBER             20730099
172200             PERFORM 4410-READ-TEMP-STORAGE                       20740099
172300             PERFORM 3510-MARK-SELECTED-INDS                      20750099
172400                 VARYING ASC-ITEM-SUB                             20760099
172500                 FROM 1 BY 1                                      20770099
172600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          20780099
172700             PERFORM 5100-WRITE-TEMP-STORAGE                      20790099
172800             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     20800099
172900         END-PERFORM                                              20810099
173000                                                                  20820099
173100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         20830099
173200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     20840099
173300         PERFORM                                                  20850099
173400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       20860099
173500                   PV-LAST-BLOCK-IN-RANGE                         20870099
173600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          20880099
173700                                   TO PV-BLOCK-NUMBER             20890099
173800             PERFORM 4410-READ-TEMP-STORAGE                       20900099
173900             PERFORM 3510-MARK-SELECTED-INDS                      20910099
174000                 VARYING ASC-ITEM-SUB                             20920099
174100                 FROM 1 BY 1                                      20930099
174200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          20940099
174300             PERFORM 5100-WRITE-TEMP-STORAGE                      20950099
174400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      20960099
174500         END-PERFORM                                              20970099
174600                                                                  20980099
174700         MOVE PV-FIRST-BLOCK-IN-ARRAY                             20990099
174800                                   TO PV-BLOCK-NUMBER             21000099
174900         PERFORM 4410-READ-TEMP-STORAGE                           21010099
175000     END-IF.                                                      21020099
175100                                                                  21030099
175200     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 21040099
175300                                      ASC-END-OF-SELECTED-RANGE.  21050099
175400                                                                  21060099
175500*----------------------------------------------------------------*21070099
175600* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *21080099
175700*----------------------------------------------------------------*21090099
175800                                                                  21100099
175900 3510-MARK-SELECTED-INDS.                                         21110099
176000                                                                  21120099
176100     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         21130099
176200                                ASC-ITEM-SUB) >                   21140099
176300         ASC-START-OF-SELECTED-RANGE)                             21150099
176400     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         21160099
176500                                ASC-ITEM-SUB) =                   21170099
176600         ASC-START-OF-SELECTED-RANGE)                             21180099
176700                                                                  21190099
176800         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     21200099
176900                                    ASC-ITEM-SUB) <               21210099
177000             ASC-END-OF-SELECTED-RANGE)                           21220099
177100         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     21230099
177200                                    ASC-ITEM-SUB) =               21240099
177300             ASC-END-OF-SELECTED-RANGE)                           21250099
177400                                                                  21260099
177500             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          21270099
177600                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   21280099
177700                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   21290099
177800                               TO TRUE                            21300099
177900                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              21310099
178000                               TO TRUE                            21320099
178100                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    21330099
178200             END-IF                                               21340099
178300         END-IF                                                   21350099
178400     END-IF.                                                      21360099
178500                                                                  21370099
178600*----------------------------------------------------------------*21380099
178700*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *21390099
178800*    INITIALIZE ALL COUNTERS AND FLAGS.                          *21400099
178900*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *21410099
179000*    DISPLAY THE PANEL TO USER.                                  *21420099
179100*----------------------------------------------------------------*21430099
179200                                                                  21440099
179300 4000-BUILD-INITIAL-PANEL.                                        21450099
179400                                                                  21460099
179500     INITIALIZE                 ASC-BLOCK-ENTRIES (1)             21470099
179600                                ASC-BLOCK-ENTRIES (2).            21480099
179700     MOVE +1                 TO ASC-BLK-SUB                       21490099
179800                                PV-STRING-POINTER-WHERE.          21500099
179900                                                                  21510099
180000     SET ASC-ITEMS-LEFT-ON-DB                                     21520099
180100                             TO TRUE.                             21530099
180200                                                                  21540099
180300     MOVE +0                 TO ASC-ITEM-SUB                      21550099
180400                                ASC-NUMBER-OF-ITEMS-READ          21560099
180500                                ASC-NUMBER-OF-SELECTED-ITEMS      21570099
180600                                ASC-HIGHEST-BLOCK-WRITTEN         21580099
180700                                ASC-START-OF-SELECTED-RANGE       21590099
180800                                ASC-END-OF-SELECTED-RANGE         21600099
180900                                ASC-ITEM-AT-TOP-OF-PANEL.         21610099
181000     PERFORM 4100-PREPARE-CURSOR                                  21620099
181100                                                                  21630099
181200     IF PS-PARTITION-FOUND                                        21640099
181300         PERFORM 4010-PREPARE-CURSOR                              21650099
181400         PERFORM 4020-DECLARE-CURSOR                              21660099
181500         PERFORM 4030-OPEN-CURSOR                                 21670099
181600         PERFORM 4300-READ-ITEMS-FROM-DB                          21680099
181700         PERFORM 4040-CLOSE-CURSOR                                21690099
181800     END-IF.                                                      21700099
181900                                                                  21710099
182000     MOVE +1                   TO  PV-TOP-ITEM.                   21720099
182100     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO OR                       21730099
182200         PS-PARTITION-NOT-FOUND                                   21740099
182300         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    21750099
182400         SET DP020-MSG-FATAL   TO  TRUE                           21760099
182500         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               21770099
182600     ELSE                                                         21780099
182700         MOVE -1               TO MR-SELECTL (1)                  21790099
182800         SET DP030-SET-CURSOR-APPL-1                              21800099
182900                               TO TRUE                            21810099
183000         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     21820099
183100     END-IF.                                                      21830099
183200                                                                  21840099
183300*----------------------------------------------------------------*21850099
183400* PREPARE THE DYNAMIC SQL CURSOR                                 *21860099
183500*----------------------------------------------------------------*21870099
183600 4010-PREPARE-CURSOR.                                             21880099
183700                                                                  21890099
183800     MOVE SPACES                   TO PV-COMPLETE-SQL-STMT        21900099
183900                                      PV-FROM-STMT.               21910099
184000                                                                  21920099
184300     IF PS-E-STORE-YES      AND                                   21941099
184400        ASC-KEY-ECOM-ORD-NBR > SPACE                              21941199
184500         STRING 'FROM '                                           21941299
184600                PV-TABLE-QUALIFIER                                21941399
184700                'TEPTRN TRN '                                     21941499
184800                PV-TABLE-QUALIFIER-COMMA                          21941599
184900                'TEPPART PRT '                                    21941699
185000                PV-TABLE-QUALIFIER-COMMA                          21941799
185100                'XST_LOC XST '                                    21941899
185200                PV-TABLE-QUALIFIER-COMMA                          21941999
185300                'TEPORD ORD'                                      21942099
185400                DELIMITED BY SIZE                                 21942199
185500         INTO PV-FROM-STMT                                        21942299
185600     ELSE                                                         21942399
185700         STRING 'FROM '                                           21942499
185800                PV-TABLE-QUALIFIER                                21943099
185900                'TEPTRN TRN '                                     21944099
186000                PV-TABLE-QUALIFIER-COMMA                          21945099
186100                'TEPPART PRT '                                    21946099
186200                PV-TABLE-QUALIFIER-COMMA                          21947099
186300                'XST_LOC XST'                                     21948099
186400                DELIMITED BY SIZE                                 21949099
186500        INTO PV-FROM-STMT                                         21949199
186600     END-IF.                                                      21949299
189300                                                                  22110099
189400     STRING PV-SELECT-STMT                                        22120099
189500            ' '                                                   22130099
189600            PV-FROM-STMT                                          22140099
189700            ' '                    DELIMITED BY SIZE              22150099
189800            PV-WHERE-STMT DELIMITED BY '   '                      22160099
189900            ' '                                                   22170099
190000            PV-ORDER-BY-STMT       DELIMITED BY SIZE              22180099
190100     INTO PV-COMPLETE-SQL-STMT.                                   22190099
190200                                                                  22200099
190300     ADD PV-SELECT-BYTES                                          22210099
190400         PV-FROM-BYTES                                            22220099
190500         PV-STRING-POINTER-WHERE                                  22230099
190600         PV-ORDER-BY-BYTES                                        22240099
190700         2                                                        22250099
190800     GIVING PV-SQL-STMT-LEN.                                      22260099
190900                                                                  22270099
191000     EXEC SQL                                                     22280099
191100         PREPARE PREPCSR           FROM :PV-COMPLETE-SQL          22290099
191200     END-EXEC.                                                    22300099
191300                                                                  22310099
191400     EVALUATE TRUE                                                22320099
191500         WHEN SQLCODE = ZERO                                      22330099
191600              CONTINUE                                            22340099
191700         WHEN SQLWARN0 NOT = SPACE                                22350099
191800         WHEN SQLCODE NOT = ZERO                                  22360099
191900              MOVE '4010-PREPARE-CURSOR'                          22370099
192000                               TO DP013-PARAGRAPH                 22380099
192100              MOVE 'PREPARE CURSOR '                              22390099
192200                               TO DP013-MESSAGE-TEXT (1)          22400099
192300              MOVE SQLCA       TO DP013-SQLCA                     22410099
192400              SET DP013-DB2-ABEND                                 22420099
192500                               TO TRUE                            22430099
192600              PERFORM DP013-0000-PROCESS-ABEND                    22440099
192700     END-EVALUATE.                                                22450099
192800                                                                  22460099
192900*----------------------------------------------------------------*22470099
193000* DECLARE THE CURSOR                                             *22480099
193100*----------------------------------------------------------------*22490099
193200 4020-DECLARE-CURSOR.                                             22500099
193300                                                                  22510099
193400     EXEC SQL                                                     22520099
193500            DECLARE TRANS-CSR CURSOR FOR PREPCSR                  22530099
193600     END-EXEC.                                                    22540099
193700                                                                  22550099
193800     EVALUATE TRUE                                                22560099
193900         WHEN SQLCODE = ZERO                                      22570099
194000              CONTINUE                                            22580099
194100         WHEN SQLWARN0 NOT = SPACE                                22590099
194200         WHEN SQLCODE NOT = ZERO                                  22600099
194300              MOVE '4020-DECLARE-CURSOR'                          22610099
194400                               TO DP013-PARAGRAPH                 22620099
194500              MOVE 'DECLARE CURSOR '                              22630099
194600                               TO DP013-MESSAGE-TEXT (1)          22640099
194700              MOVE SQLCA       TO DP013-SQLCA                     22650099
194800              SET DP013-DB2-ABEND                                 22660099
194900                               TO TRUE                            22670099
195000              PERFORM DP013-0000-PROCESS-ABEND                    22680099
195100     END-EVALUATE.                                                22690099
195200                                                                  22700099
195300*----------------------------------------------------------------*22710099
195400*  OPEN THE TRANSACTION CURSOR                                   *22720099
195500*----------------------------------------------------------------*22730099
195600 4030-OPEN-CURSOR.                                                22740099
195700                                                                  22750099
195800     EXEC SQL                                                     22760099
195900         OPEN TRANS-CSR                                           22770099
196000     END-EXEC.                                                    22780099
196100                                                                  22790099
196200     EVALUATE TRUE                                                22800099
196300         WHEN SQLCODE = ZERO                                      22810099
196400              CONTINUE                                            22820099
196500         WHEN SQLWARN0 NOT = SPACE                                22830099
196600         WHEN SQLCODE NOT = ZERO                                  22840099
196700              MOVE '4030-OPEN-CSR'                                22850099
196800                               TO DP013-PARAGRAPH                 22860099
196900              MOVE 'OPEN CURSOR '                                 22870099
197000                               TO DP013-MESSAGE-TEXT (1)          22880099
197100              MOVE SQLCA       TO DP013-SQLCA                     22890099
197200              SET DP013-DB2-ABEND                                 22900099
197300                               TO TRUE                            22910099
197400              PERFORM DP013-0000-PROCESS-ABEND                    22920099
197500     END-EVALUATE.                                                22930099
197600                                                                  22940099
197700*----------------------------------------------------------------*22950099
197800*   CLOSE THE TRANSACTION CURSOR                                 *22960099
197900*----------------------------------------------------------------*22970099
198000 4040-CLOSE-CURSOR.                                               22980099
198100                                                                  22990099
198200     EXEC SQL                                                     23000099
198300         CLOSE TRANS-CSR                                          23010099
198400     END-EXEC.                                                    23020099
198500                                                                  23030099
198600     EVALUATE TRUE                                                23040099
198700         WHEN SQLCODE = ZERO                                      23050099
198800              CONTINUE                                            23060099
198900         WHEN SQLWARN0 NOT = SPACE                                23070099
199000         WHEN SQLCODE NOT = ZERO                                  23080099
199100              MOVE '4040-CLOSE-CURSOR'                            23090099
199200                               TO DP013-PARAGRAPH                 23100099
199300              MOVE 'CLOSE CURSOR '                                23110099
199400                               TO DP013-MESSAGE-TEXT (1)          23120099
199500              MOVE SQLCA       TO DP013-SQLCA                     23130099
199600              SET DP013-DB2-ABEND                                 23140099
199700                               TO TRUE                            23150099
199800              PERFORM DP013-0000-PROCESS-ABEND                    23160099
199900     END-EVALUATE.                                                23170099
200000                                                                  23180099
200100*----------------------------------------------------------------*23190099
200200*    SET UP THE HOST VARIABLES.                                  *23200099
200300*----------------------------------------------------------------*23210099
200400 4100-PREPARE-CURSOR.                                             23220099
200500                                                                  23230099
200600***  GET THE CICS REGION TO BUILD THE TABLE QUALIFIER             23240099
200700                                                                  23250099
200800     EXEC CICS                                                    23260099
200900         ASSIGN APPLID (PV-SYSTEM-ID)                             23270099
201000     END-EXEC.                                                    23280099
201100                                                                  23290099
201200     MOVE PV-REGION-IND            TO PV-QUALIFIER                23300099
201300                                      PV-QUALIFIER-COMMA.         23310099
201400                                                                  23320099
201500     IF ASC-KEY-STORE              > ZEROS                        23330099
201600         PERFORM 4120-FORMAT-STORE-WHERE                          23340099
201700     END-IF.                                                      23350099
201800                                                                  23360099
201900     IF ASC-KEY-REGISTER           > ZEROS                        23370099
202000         PERFORM 4130-FORMAT-REGISTER-WHERE                       23380099
202100     END-IF.                                                      23390099
202200                                                                  23400099
202300     IF ASC-KEY-TRANSACTION        > ZEROS                        23410099
202400         PERFORM 4140-FORMAT-TRANSACTION-WHERE                    23420099
202500     END-IF.                                                      23430099
202600                                                                  23440099
202700     IF ASC-KEY-TRANSACTION-AMOUNT NOT EQUAL ZEROS                23450099
202800         PERFORM 4150-FORMAT-TRANS-AMT-WHERE                      23460099
202900     END-IF.                                                      23470099
203000                                                                  23480099
203100     IF ASC-KEY-TRANSACTION-TYPE   NOT EQUAL SPACES               23490099
203200         PERFORM 4220-FORMAT-TRANS-TYPE-WHERE                     23500099
203300     END-IF.                                                      23510099
203400                                                                  23520099
203500     IF ASC-KEY-VOID-TRANSACTION-IND = 'Y'                        23530099
203600         PERFORM 4230-FORMAT-VOID-WHERE                           23540099
203700     END-IF.                                                      23550099
203800                                                                  23560099
203900     IF ASC-KEY-OPERATOR-ID        > ZEROS                        23570099
204000         PERFORM 4160-FORMAT-OP-ID-WHERE                          23580099
204100     END-IF.                                                      23590099
204200                                                                  23600099
204300     IF ASC-KEY-PUR-ASSOC-ID       > ZEROS                        23610099
204400         PERFORM 4170-FORMAT-PUR-ID-WHERE                         23620099
204500     END-IF.                                                      23630099
204600                                                                  23640099
204700     IF ASC-KEY-TENDER-ID          NOT EQUAL SPACES               23650099
P10237         CONTINUE                                                         
204900     ELSE                                                         23670099
205000         IF ASC-KEY-TENDER-TYPE    NOT EQUAL SPACES               23680099
205100             PERFORM 4185-FORMAT-TENDER-TYPE-WHERE                23690099
205200         END-IF                                                   23700099
205300     END-IF.                                                      23710099
205400                                                                  23720099
206000     IF ASC-KEY-SKU                > ZEROS                        23780099
206100         PERFORM 4200-FORMAT-DCS-WHERE                            23790099
206200     END-IF.                                                      23800099
206300                                                                  23810099
206400     IF ASC-KEY-UPC-NBR            > ZEROS                        23820099
206500         PERFORM 4210-FORMAT-UPC-WHERE                            23830099
206600     END-IF.                                                      23840099
206700                                                                  23850099
206800     IF ASC-KEY-ECOM-ORD-NBR       NOT EQUAL SPACES               23851099
206900         PERFORM 4250-FORMAT-ECOM-NBR-WHERE                       23852099
207000     END-IF.                                                      23853099
207100                                                                  23854099
207200     IF PS-HAVE-PARTITION-WHERE                                   23860099
207300         CONTINUE                                                 23870099
207400     ELSE                                                         23880099
207500         PERFORM 4290-FORMAT-PARTITION-WHERE                      23890099
207600     END-IF.                                                      23900099
207700                                                                  23910099
207800     PERFORM 4240-FINAL-WHERE.                                    23920099
207900                                                                  23930099
208000*----------------------------------------------------------------*23940099
208100*  FORMAT THE WHERE CLAUSE WHEN A STORE NUMBER HAS BEEN PROVIDED *23950099
208200*----------------------------------------------------------------*23960099
208300 4120-FORMAT-STORE-WHERE.                                         23970099
208400                                                                  23980099
208500     MOVE ASC-KEY-STORE            TO PV-STORE.                   23990099
208600     STRING 'WHERE '                                              24000099
208700            'TRN.STR_NBR = '                                      24010099
208800            PV-STORE                                              24020099
208900            DELIMITED BY SIZE                                     24030099
209000     INTO PV-WHERE-STMT                                           24040099
209100     WITH POINTER PV-STRING-POINTER-WHERE.                        24050099
209200                                                                  24060099
209300*----------------------------------------------------------------*24070099
209400*  FORMAT THE WHERE CLAUSE WHEN A REGISTER NUMBER HAS BEEN       *24080099
209500*  PROVIDED.                                                     *24090099
209600*----------------------------------------------------------------*24100099
209700 4130-FORMAT-REGISTER-WHERE.                                      24110099
209800                                                                  24120099
209900     MOVE ASC-KEY-REGISTER         TO PV-REGISTER.                24130099
210000     IF PV-STRING-POINTER-WHERE    > 1                            24140099
210100         STRING ' AND'                                            24150099
210200                ' TRN.RGST_ID = '                                 24160099
210300                PV-REGISTER                                       24170099
210400                DELIMITED BY SIZE                                 24180099
210500         INTO PV-WHERE-STMT                                       24190099
210600         WITH POINTER PV-STRING-POINTER-WHERE                     24200099
210700     ELSE                                                         24210099
210800         STRING 'WHERE'                                           24220099
210900                ' TRN.RGST_ID = '                                 24230099
211000                PV-REGISTER                                       24240099
211100                DELIMITED BY SIZE                                 24250099
211200         INTO PV-WHERE-STMT                                       24260099
211300         WITH POINTER PV-STRING-POINTER-WHERE                     24270099
211400     END-IF.                                                      24280099
211500                                                                  24290099
211600*----------------------------------------------------------------*24300099
211700*  FORMAT THE WHERE CLAUSE WHEN A TRANSACTION NUMBER HAS BEEN    *24310099
211800*  PROVIDED.                                                     *24320099
211900*----------------------------------------------------------------*24330099
212000 4140-FORMAT-TRANSACTION-WHERE.                                   24340099
212100                                                                  24350099
212200     MOVE ASC-KEY-TRANSACTION      TO PV-TRANSACTION.             24360099
212300     IF PV-STRING-POINTER-WHERE    > 1                            24370099
212400         STRING ' AND'                                            24380099
212500                ' TRN.TRN_NBR = '                                 24390099
212600                PV-TRANSACTION                                    24400099
212700                DELIMITED BY SIZE                                 24410099
212800         INTO PV-WHERE-STMT                                       24420099
212900         WITH POINTER PV-STRING-POINTER-WHERE                     24430099
213000     ELSE                                                         24440099
213100         STRING 'WHERE'                                           24450099
213200                ' TRN.TRN_NBR = '                                 24460099
213300                PV-TRANSACTION                                    24470099
213400                DELIMITED BY SIZE                                 24480099
213500         INTO PV-WHERE-STMT                                       24490099
213600         WITH POINTER PV-STRING-POINTER-WHERE                     24500099
213700     END-IF.                                                      24510099
213800                                                                  24520099
213900*----------------------------------------------------------------*24530099
214000*  FORMAT THE WHERE CLAUSE WHEN A TRANSACTION AMOUNT HAS BEEN    *24540099
214100*  PROVIDED.                                                     *24550099
214200*----------------------------------------------------------------*24560099
214300 4150-FORMAT-TRANS-AMT-WHERE.                                     24570099
214400                                                                  24580099
214500     MOVE ASC-KEY-TRANSACTION-AMOUNT                              24590099
214600                                   TO PV-TRANSACTION-AMOUNT.      24600099
214700     IF PV-STRING-POINTER-WHERE    > 1                            24610099
214800         STRING ' AND'                                            24620099
214900                ' TRN_TOT_AMT  '                                  24630099
215000                ASC-KEY-TRANS-AMOUNT-SIGN                         24640099
215100                ' '                                               24650099
215200                PV-TRANSACTION-AMOUNT                             24660099
215300                DELIMITED BY SIZE                                 24670099
215400         INTO PV-WHERE-STMT                                       24680099
215500         WITH POINTER PV-STRING-POINTER-WHERE                     24690099
215600     ELSE                                                         24700099
215700         STRING 'WHERE'                                           24710099
215800                ' TRN_TOT_AMT  '                                  24720099
215900                ASC-KEY-TRANS-AMOUNT-SIGN                         24730099
216000                ' '                                               24740099
216100                PV-TRANSACTION-AMOUNT                             24750099
216200                DELIMITED BY SIZE                                 24760099
216300         INTO PV-WHERE-STMT                                       24770099
216400         WITH POINTER PV-STRING-POINTER-WHERE                     24780099
216500     END-IF.                                                      24790099
216600                                                                  24800099
216700*----------------------------------------------------------------*24810099
216800*  FORMAT THE WHERE CLAUSE WHEN A REGISTER OPERATOR ID HAS BEEN  *24820099
216900*  PROVIDED.                                                     *24830099
217000*----------------------------------------------------------------*24840099
217100 4160-FORMAT-OP-ID-WHERE.                                         24850099
217200                                                                  24860099
217300     MOVE ASC-KEY-OPERATOR-ID      TO PV-OPERATOR-ID.             24870099
217400     IF PV-STRING-POINTER-WHERE    > 1                            24880099
217500         STRING ' AND'                                            24890099
217600                ' ASSOC_ID = '                                    24900099
217700                PV-OPERATOR-ID                                    24910099
217800                DELIMITED BY SIZE                                 24920099
217900         INTO PV-WHERE-STMT                                       24930099
218000         WITH POINTER PV-STRING-POINTER-WHERE                     24940099
218100     ELSE                                                         24950099
218200         STRING 'WHERE'                     DELIMITED BY SIZE     24960099
218300                ' ASSOC_ID = '                                    24970099
218400                PV-OPERATOR-ID                                    24980099
218500                DELIMITED BY SIZE                                 24990099
218600         INTO PV-WHERE-STMT                                       25000099
218700         WITH POINTER PV-STRING-POINTER-WHERE                     25010099
218800     END-IF.                                                      25020099
218900                                                                  25030099
219000*----------------------------------------------------------------*25040099
219100*  FORMAT THE WHERE CLAUSE WHEN A PURCHASING ASSOC ID HAS BEEN   *25050099
219200*  PROVIDED.                                                     *25060099
219300*----------------------------------------------------------------*25070099
219400 4170-FORMAT-PUR-ID-WHERE.                                        25080099
219500                                                                  25090099
219600     MOVE ASC-KEY-PUR-ASSOC-ID     TO PV-PUR-ASSOC-ID.            25100099
219700                                                                  25110099
219800     IF PV-STRING-POINTER-WHERE > 1                               25120099
219900         STRING ' AND EXISTS ('                                   25130099
220000                'SELECT 1 FROM '                                  25140099
220100                'DB2'                                             25150099
220200                PV-REGION-IND                                     25160099
220300                'DBA.'                                            25170099
220400                'TEPATR ATR WHERE'                                25180099
220500                ' CUST_ASSOC_ID = '                               25190099
220600                PV-PUR-ASSOC-ID                                   25200099
220700                ' AND TRN.PARTN_NBR = ATR.PARTN_NBR'              25210099
220800                ' AND TRN.STR_NBR = ATR.STR_NBR'                  25220099
220900                ' AND TRN.RGST_ID = ATR.RGST_ID'                  25230099
221000                ' AND TRN.TRN_NBR = ATR.TRN_NBR'                  25240099
221100                ' AND TRN.STRT_TM = ATR.STRT_TM'                  25250099
221200                ' AND TRN.SLS_CORR_SEQ_NBR'                       25260099
221300                ' = ATR.SLS_CORR_SEQ_NBR'                         25270099
221400                DELIMITED BY SIZE                                 25280099
221500         INTO PV-WHERE-STMT                                       25290099
221600         WITH POINTER PV-STRING-POINTER-WHERE                     25300099
221700     ELSE                                                         25310099
221800         STRING 'WHERE EXISTS ('                                  25320099
221900                ' SELECT 1 FROM '                                 25330099
222000                'DB2'                                             25340099
222100                PV-REGION-IND                                     25350099
222200                'DBA.TEPATR ATR WHERE'                            25360099
222300                ' CUST_ASSOC_ID = '                               25370099
222400                PV-PUR-ASSOC-ID                                   25380099
222500                ' AND TRN.PARTN_NBR = ATR.PARTN_NBR'              25390099
222600                ' AND TRN.STR_NBR = ATR.STR_NBR'                  25400099
222700                ' AND TRN.RGST_ID = ATR.RGST_ID'                  25410099
222800                ' AND TRN.TRN_NBR = ATR.TRN_NBR'                  25420099
222900                ' AND TRN.STRT_TM = ATR.STRT_TM'                  25430099
223000                ' AND TRN.SLS_CORR_SEQ_NBR'                       25440099
223100                ' = ATR.SLS_CORR_SEQ_NBR'                         25450099
223200                DELIMITED BY SIZE                                 25460099
223300         INTO PV-WHERE-STMT                                       25470099
223400         WITH POINTER PV-STRING-POINTER-WHERE                     25480099
223500     END-IF.                                                      25490099
227700                                                                  25910099
227800     SET PS-HAVE-EXISTS-CLAUSE     TO TRUE.                       25920099
227900     PERFORM 4290-FORMAT-PARTITION-WHERE.                         25930099
228000                                                                  25940099
250200*----------------------------------------------------------------*28140099
250300*  FORMAT THE WHERE CLUASE IF TENDER TYPE IS PROVIDED BUT NOT    *28150099
250400*  TENDER ID                                                     *28160099
250500*----------------------------------------------------------------*28170099
250600 4185-FORMAT-TENDER-TYPE-WHERE.                                   28180099
250700                                                                  28190099
250900     IF PV-STRING-POINTER-WHERE > 1                               28210099
251000         STRING ' AND EXISTS ('                                   28220099
251100                ' SELECT 1 FROM '                                 28230099
251200                'DB2'                                             28240099
251300                PV-REGION-IND                                     28250099
251400                'DBA.TEPTND TND WHERE'                            28260099
251500                ' TNDR_TYP_CDE = '                                28270099
251600                PC-QUOTE                                          28280099
251700                ASC-KEY-TENDER-TYPE                               28290099
251800                PC-QUOTE                                          28300099
251900                DELIMITED BY SIZE                                 28310099
252000         INTO PV-WHERE-STMT                                       28320099
252100         WITH POINTER PV-STRING-POINTER-WHERE                     28330099
                      IF ASC-KEY-TENDER-TYPE = '19'                             
                        IF ASC-KEY-DEBIT-TYPE = 'DM'                            
                         STRING ' AND EXISTS ('                         26570099
                           'SELECT 1 FROM '                             26580099
                           'DB2'                                        26590099
                           PV-REGION-IND                                26600099
                           'DBA.EPT_DR_CRD_TNDR WHERE'                  26610099
                           ' TND.PARTN_NBR = PARTN_NBR '                        
                           ' AND '                                              
                           ' TND.STR_NBR = STR_NBR AND '                        
                           ' TND.RGST_ID = RGST_ID AND '                        
                           ' TND.TRN_NBR = TRN_NBR AND '                        
                           ' TND.STRT_TM = STRT_TM AND '                        
                           ' TND.SLS_CORR_SEQ_NBR = '                           
                           ' SLS_CORR_SEQ_NBR AND '                             
                           ' TND.TNDR_SEQ_NBR = '                               
                           ' TNDR_SEQ_NBR AND '                                 
                           ' CRD_TYP_CDE = ''M'' )'                     26620099
                           DELIMITED BY SIZE                            26710099
                         INTO PV-WHERE-STMT                             26720099
                         WITH POINTER PV-STRING-POINTER-WHERE           26730099
                        ELSE                                                    
                         IF ASC-KEY-DEBIT-TYPE = 'DV'                           
                          STRING ' AND EXISTS ('                        26570099
                            'SELECT 1 FROM '                            26580099
                            'DB2'                                       26590099
                            PV-REGION-IND                               26600099
                            'DBA.EPT_DR_CRD_TNDR WHERE'                 26610099
                            ' TND.PARTN_NBR = PARTN_NBR '                       
                            ' AND '                                             
                            ' TND.STR_NBR = STR_NBR AND '                       
                            ' TND.RGST_ID = RGST_ID AND '                       
                            ' TND.TRN_NBR = TRN_NBR AND '                       
                            ' TND.STRT_TM = STRT_TM AND '                       
                            ' TND.SLS_CORR_SEQ_NBR = '                          
                            ' SLS_CORR_SEQ_NBR AND '                            
                            ' TND.TNDR_SEQ_NBR = '                              
                            ' TNDR_SEQ_NBR AND '                                
                            ' CRD_TYP_CDE = ''V'' )'                    26620099
                            DELIMITED BY SIZE                           26710099
                          INTO PV-WHERE-STMT                            26720099
                          WITH POINTER PV-STRING-POINTER-WHERE          26730099
                         ELSE                                                   
                          IF ASC-KEY-DEBIT-TYPE = 'DA'                          
                           STRING ' AND EXISTS ('                       26570099
                             'SELECT 1 FROM '                           26580099
                             'DB2'                                      26590099
                             PV-REGION-IND                              26600099
                             'DBA.EPT_DR_CRD_TNDR WHERE'                26610099
                             ' TND.PARTN_NBR = PARTN_NBR '                      
                             ' AND '                                            
                             ' TND.STR_NBR = STR_NBR AND '                      
                             ' TND.RGST_ID = RGST_ID AND '                      
                             ' TND.TRN_NBR = TRN_NBR AND '                      
                             ' TND.STRT_TM = STRT_TM AND '                      
                             ' TND.SLS_CORR_SEQ_NBR = '                         
                             ' SLS_CORR_SEQ_NBR AND '                           
                             ' TND.TNDR_SEQ_NBR = '                             
                             ' TNDR_SEQ_NBR AND '                               
                             ' CRD_TYP_CDE = ''A'' )'                   26620099
                             DELIMITED BY SIZE                          26710099
                           INTO PV-WHERE-STMT                           26720099
                           WITH POINTER PV-STRING-POINTER-WHERE         26730099
                          ELSE                                                  
252120* KOHLS DEBIT                                                             
252121                     IF ASC-KEY-DEBIT-TYPE = 'DK'                         
252122                      STRING ' AND EXISTS ('                       2657009
252123                        'SELECT 1 FROM '                           2658009
252124                        'DB2'                                      2659009
252125                        PV-REGION-IND                              2660009
252126                        'DBA.EPT_DR_CRD_TNDR WHERE'                2661009
252127                        ' TND.PARTN_NBR = PARTN_NBR '                     
252128                        ' AND '                                           
252129                        ' TND.STR_NBR = STR_NBR AND '                     
252130                        ' TND.RGST_ID = RGST_ID AND '                     
252131                        ' TND.TRN_NBR = TRN_NBR AND '                     
252132                        ' TND.STRT_TM = STRT_TM AND '                     
252133                        ' TND.SLS_CORR_SEQ_NBR = '                        
252134                        ' SLS_CORR_SEQ_NBR AND '                          
252135                        ' TND.TNDR_SEQ_NBR = '                            
252136                        ' TNDR_SEQ_NBR AND '                              
252137                        ' CRD_TYP_CDE = ''K'' )'                   2662009
252138                        DELIMITED BY SIZE                          2671009
252139                      INTO PV-WHERE-STMT                           2672009
252140                      WITH POINTER PV-STRING-POINTER-WHERE         2673009
252141                     ELSE                                                 
252142                      IF ASC-KEY-DEBIT-TYPE = 'DB'                        
252143                         CONTINUE                                         
252144                      END-IF                                              
252145                     END-IF                                               
                          END-IF                                                
                         END-IF                                                 
                        END-IF                                                  
                      END-IF                                                    
252200     ELSE                                                         28340099
252300         STRING ' WHERE EXISTS ('                                 28350099
252400                ' SELECT 1 FROM '                                 28360099
252500                'DB2'                                             28370099
252600                PV-REGION-IND                                     28380099
252700                'DBA.TEPTND TND WHERE'                            28390099
252800                ' TNDR_TYP_CDE = '                                28400099
252900                PC-QUOTE                                          28410099
253000                ASC-KEY-TENDER-TYPE                               28420099
253100                PC-QUOTE                                          28430099
253200                DELIMITED BY SIZE                                 28440099
253300         INTO PV-WHERE-STMT                                       28450099
253400         WITH POINTER PV-STRING-POINTER-WHERE                     28460099
                      IF ASC-KEY-TENDER-TYPE = '19'                             
                        IF ASC-KEY-DEBIT-TYPE = 'DM'                            
                         STRING ' AND EXISTS ('                         26570099
                           'SELECT 1 FROM '                             26580099
                           'DB2'                                        26590099
                           PV-REGION-IND                                26600099
                           'DBA.EPT_DR_CRD_TNDR WHERE'                  26610099
                           ' TND.PARTN_NBR = PARTN_NBR '                        
                           ' AND '                                              
                           ' TND.STR_NBR = STR_NBR AND '                        
                           ' TND.RGST_ID = RGST_ID AND '                        
                           ' TND.TRN_NBR = TRN_NBR AND '                        
                           ' TND.STRT_TM = STRT_TM AND '                        
                           ' TND.SLS_CORR_SEQ_NBR = '                           
                           ' SLS_CORR_SEQ_NBR AND '                             
                           ' TND.TNDR_SEQ_NBR = '                               
                           ' TNDR_SEQ_NBR AND '                                 
                           ' CRD_TYP_CDE = ''M'' )'                     26620099
                           DELIMITED BY SIZE                            26710099
                         INTO PV-WHERE-STMT                             26720099
                         WITH POINTER PV-STRING-POINTER-WHERE           26730099
                        ELSE                                                    
                         IF ASC-KEY-DEBIT-TYPE = 'DV'                           
                          STRING ' AND EXISTS ('                        26570099
                            'SELECT 1 FROM '                            26580099
                            'DB2'                                       26590099
                            PV-REGION-IND                               26600099
                            'DBA.EPT_DR_CRD_TNDR WHERE'                 26610099
                            ' TND.PARTN_NBR = PARTN_NBR '                       
                            ' AND '                                             
                            ' TND.STR_NBR = STR_NBR AND '                       
                            ' TND.RGST_ID = RGST_ID AND '                       
                            ' TND.TRN_NBR = TRN_NBR AND '                       
                            ' TND.STRT_TM = STRT_TM AND '                       
                            ' TND.SLS_CORR_SEQ_NBR = '                          
                            ' SLS_CORR_SEQ_NBR AND '                            
                            ' TND.TNDR_SEQ_NBR = '                              
                            ' TNDR_SEQ_NBR AND '                                
                            ' CRD_TYP_CDE = ''V'' )'                    26620099
                            DELIMITED BY SIZE                           26710099
                          INTO PV-WHERE-STMT                            26720099
                          WITH POINTER PV-STRING-POINTER-WHERE          26730099
                         ELSE                                                   
                          IF ASC-KEY-DEBIT-TYPE = 'DA'                          
                           STRING ' AND EXISTS ('                       26570099
                             'SELECT 1 FROM '                           26580099
                             'DB2'                                      26590099
                             PV-REGION-IND                              26600099
                             'DBA.EPT_DR_CRD_TNDR WHERE'                26610099
                             ' TND.PARTN_NBR = PARTN_NBR '                      
                             ' AND '                                            
                             ' TND.STR_NBR = STR_NBR AND '                      
                             ' TND.RGST_ID = RGST_ID AND '                      
                             ' TND.TRN_NBR = TRN_NBR AND '                      
                             ' TND.STRT_TM = STRT_TM AND '                      
                             ' TND.SLS_CORR_SEQ_NBR = '                         
                             ' SLS_CORR_SEQ_NBR AND '                           
                             ' TND.TNDR_SEQ_NBR = '                             
                             ' TNDR_SEQ_NBR AND '                               
                             ' CRD_TYP_CDE = ''A'' )'                   26620099
                             DELIMITED BY SIZE                          26710099
                           INTO PV-WHERE-STMT                           26720099
                           WITH POINTER PV-STRING-POINTER-WHERE         26730099
                          ELSE                                                  
253420* KOHLS DEBIT                                                             
253421                     IF ASC-KEY-DEBIT-TYPE = 'DK'                         
253422                      STRING ' AND EXISTS ('                       2657009
253423                        'SELECT 1 FROM '                           2658009
253424                        'DB2'                                      2659009
253425                        PV-REGION-IND                              2660009
253426                        'DBA.EPT_DR_CRD_TNDR WHERE'                2661009
253427                        ' TND.PARTN_NBR = PARTN_NBR '                     
253428                        ' AND '                                           
253429                        ' TND.STR_NBR = STR_NBR AND '                     
253430                        ' TND.RGST_ID = RGST_ID AND '                     
253431                        ' TND.TRN_NBR = TRN_NBR AND '                     
253432                        ' TND.STRT_TM = STRT_TM AND '                     
253433                        ' TND.SLS_CORR_SEQ_NBR = '                        
253434                        ' SLS_CORR_SEQ_NBR AND '                          
253435                        ' TND.TNDR_SEQ_NBR = '                            
253436                        ' TNDR_SEQ_NBR AND '                              
253437                        ' CRD_TYP_CDE = ''K'' )'                   2662009
253438                        DELIMITED BY SIZE                          2671009
253439                      INTO PV-WHERE-STMT                           2672009
253440                      WITH POINTER PV-STRING-POINTER-WHERE         2673009
253441                     ELSE                                                 
253442                      IF ASC-KEY-DEBIT-TYPE = 'DB'                        
253443                         CONTINUE                                         
253444                      END-IF                                              
253445                     END-IF                                               
                          END-IF                                                
                         END-IF                                                 
                        END-IF                                                  
                      END-IF                                                    
253500     END-IF.                                                      28470099
253600     STRING ' AND TRN.PARTN_NBR = TND.PARTN_NBR'                  28480099
253700            ' AND TRN.STR_NBR = TND.STR_NBR'                      28490099
253800            ' AND TRN.RGST_ID = TND.RGST_ID'                      28500099
253900            ' AND TRN.TRN_NBR = TND.TRN_NBR'                      28510099
254000            ' AND TRN.STRT_TM = TND.STRT_TM'                      28520099
254100            ' AND TRN.SLS_CORR_SEQ_NBR'                           28530099
254200            ' = TND.SLS_CORR_SEQ_NBR'                             28540099
254300            DELIMITED BY SIZE                                     28550099
254400     INTO PV-WHERE-STMT                                           28560099
254500     WITH POINTER PV-STRING-POINTER-WHERE.                        28570099
258600                                                                  28980099
258700     IF ASC-KEY-KEYED-TENDER-IND   = 'Y'                          28990099
258800         STRING ' AND TNDR_ID_SRC_CDE = ''00'' '                  29000099
258900                 DELIMITED BY SIZE                                29010099
259000         INTO PV-WHERE-STMT                                       29020099
259100         WITH POINTER PV-STRING-POINTER-WHERE                     29030099
259200     END-IF.                                                      29040099
259300                                                                  29050099
259400     SET PS-HAVE-EXISTS-CLAUSE     TO TRUE.                       29060099
259500     PERFORM 4290-FORMAT-PARTITION-WHERE.                         29070099
259600                                                                  29080099
279300*----------------------------------------------------------------*31050099
279400*  FORMAT THE WHERE CLAUSE WHEN A SKU IS PROVIDED                *31060099
279500*----------------------------------------------------------------*31070099
279600 4200-FORMAT-DCS-WHERE.                                           31080099
279700                                                                  31090099
291700     MOVE ASC-KEY-SKU              TO PV-SKU-NBR.                 32290099
279900     IF PV-STRING-POINTER-WHERE > 1                               31110099
280000         STRING ' AND EXISTS ('                                   31120099
280100                'SELECT 1 FROM '                                  31130099
280200                'DB2'                                             31140099
280300                PV-REGION-IND                                     31150099
280400                'DBA.TEPITM ITM WHERE'                            31160099
280500                ' SKU_NBR =  '                                    31170099
280700                PV-SKU-NBR                                        31190099
281700                DELIMITED BY SIZE                                 31290099
281800         INTO PV-WHERE-STMT                                       31300099
281900         WITH POINTER PV-STRING-POINTER-WHERE                     31310099
282000     ELSE                                                         31320099
282100         STRING 'WHERE EXISTS ('                                  31330099
282200                'SELECT 1 FROM '                                  31340099
282300                'DB2'                                             31350099
282400                PV-REGION-IND                                     31360099
282500                'DBA.TEPITM ITM WHERE'                            31370099
282600                ' SKU_NBR =  '                                    31380099
283600                PV-SKU-NBR                                        31480099
283800                DELIMITED BY SIZE                                 31500099
283900         INTO PV-WHERE-STMT                                       31510099
284000         WITH POINTER PV-STRING-POINTER-WHERE                     31520099
284100     END-IF.                                                      31530099
284200     STRING ' AND TRN.PARTN_NBR = ITM.PARTN_NBR'                  31540099
284300            ' AND TRN.STR_NBR = ITM.STR_NBR'                      31550099
284400            ' AND TRN.RGST_ID = ITM.RGST_ID'                      31560099
284500            ' AND TRN.TRN_NBR = ITM.TRN_NBR'                      31570099
284600            ' AND TRN.STRT_TM = ITM.STRT_TM'                      31580099
284700            ' AND TRN.SLS_CORR_SEQ_NBR'                           31590099
284800            ' = ITM.SLS_CORR_SEQ_NBR'                             31600099
284900            DELIMITED BY SIZE                                     31610099
285000            INTO PV-WHERE-STMT                                    31620099
285100            WITH POINTER PV-STRING-POINTER-WHERE.                 31630099
290800                                                                  32200099
290900     SET PS-HAVE-EXISTS-CLAUSE     TO TRUE.                       32210099
291000     PERFORM 4290-FORMAT-PARTITION-WHERE.                         32220099
291100                                                                  32230099
291200*----------------------------------------------------------------*32240099
291300*  FORMAT THE WHERE CLAUSE WHEN A UPC NUMBER IS PROVIDED         *32250099
291400*----------------------------------------------------------------*32260099
291500 4210-FORMAT-UPC-WHERE.                                           32270099
291600                                                                  32280099
291700     MOVE ASC-KEY-UPC-NBR          TO PV-UPC-NBR.                 32290099
291900     IF PV-STRING-POINTER-WHERE > 1                               32310099
292000         STRING ' AND EXISTS ('                                   32320099
292100                'SELECT 1 FROM '                                  32330099
292200                'DB2'                                             32340099
292300                PV-REGION-IND                                     32350099
292400                'DBA.TEPITM ITM WHERE'                            32360099
292500                ' UPC_NBR = '                                     32370099
292600                PV-UPC-NBR                                        32380099
292700                DELIMITED BY SIZE                                 32390099
292800         INTO PV-WHERE-STMT                                       32400099
292900         WITH POINTER PV-STRING-POINTER-WHERE                     32410099
293000     ELSE                                                         32420099
293100         STRING 'WHERE EXISTS ('                                  32430099
293200                'SELECT 1 FROM '                                  32440099
293300                'DB2'                                             32450099
293400                PV-REGION-IND                                     32460099
293500                'DBA.TEPITM ITM WHERE'                            32470099
293600                ' UPC_NBR = '                                     32480099
293700                PV-UPC-NBR                                        32490099
293800                DELIMITED BY SIZE                                 32500099
293900         INTO PV-WHERE-STMT                                       32510099
294000         WITH POINTER PV-STRING-POINTER-WHERE                     32520099
294100     END-IF.                                                      32530099
294200     STRING ' AND TRN.PARTN_NBR = ITM.PARTN_NBR'                  32540099
294300            ' AND TRN.STR_NBR = ITM.STR_NBR'                      32550099
294400            ' AND TRN.RGST_ID = ITM.RGST_ID'                      32560099
294500            ' AND TRN.TRN_NBR = ITM.TRN_NBR'                      32570099
294600            ' AND TRN.STRT_TM = ITM.STRT_TM'                      32580099
294700            ' AND TRN.SLS_CORR_SEQ_NBR'                           32590099
294800            ' = ITM.SLS_CORR_SEQ_NBR'                             32600099
294900            DELIMITED BY SIZE                                     32610099
295000            INTO PV-WHERE-STMT                                    32620099
295100            WITH POINTER PV-STRING-POINTER-WHERE.                 32630099
298800                                                                  33000099
298900     SET PS-HAVE-EXISTS-CLAUSE     TO TRUE.                       33010099
299000     PERFORM 4290-FORMAT-PARTITION-WHERE.                         33020099
299100                                                                  33030099
299200*----------------------------------------------------------------*33040099
299300*  FORMAT THE WHERE CLAUSE WHEN A TRANSACTION TYPE HAS BEEN      *33050099
299400*  PROVIDED.                                                     *33060099
299500*----------------------------------------------------------------*33070099
299600 4220-FORMAT-TRANS-TYPE-WHERE.                                    33080099
299700                                                                  33090099
299800     IF PV-STRING-POINTER-WHERE    > 1                            33100099
299900         STRING ' AND'                                            33110099
300000                ' TRN_TYP_CDE = '                                 33120099
300100                PC-QUOTE                                          33130099
300200                ASC-KEY-TRANSACTION-TYPE                          33140099
300300                PC-QUOTE                                          33150099
300400                DELIMITED BY SIZE                                 33160099
300500         INTO PV-WHERE-STMT                                       33170099
300600         WITH POINTER PV-STRING-POINTER-WHERE                     33180099
300700     ELSE                                                         33190099
300800         STRING 'WHERE'                                           33200099
300900                ' TRN_TYP_CDE = '                                 33210099
301000                PC-QUOTE                                          33220099
301100                ASC-KEY-TRANSACTION-TYPE                          33230099
301200                PC-QUOTE                                          33240099
301300                DELIMITED BY SIZE                                 33250099
301400         INTO PV-WHERE-STMT                                       33260099
301500         WITH POINTER PV-STRING-POINTER-WHERE                     33270099
301600     END-IF.                                                      33280099
301700                                                                  33290099
301800*----------------------------------------------------------------*33300099
301900*  FORMAT THE WHERE CLAUSE WHEN VOID INDICATOR IS 'Y'            *33310099
302000*----------------------------------------------------------------*33320099
302100 4230-FORMAT-VOID-WHERE.                                          33330099
302200                                                                  33340099
302300     IF PV-STRING-POINTER-WHERE    > 1                            33350099
302400         STRING ' AND'                         DELIMITED BY SIZE  33360099
302500                ' VOID_ABRT_CDE IN '           DELIMITED BY SIZE  33370099
302600                '(''V'', ''A'', ''I'', ''B'', ''R'', ''U'')'      33380099
302700                 DELIMITED BY SIZE                                33390099
302800         INTO PV-WHERE-STMT                                       33400099
302900         WITH POINTER PV-STRING-POINTER-WHERE                     33410099
303000     ELSE                                                         33420099
303100         STRING 'WHERE'                     DELIMITED BY SIZE     33430099
303200                ' VOID_ABRT_CDE IN '           DELIMITED BY SIZE  33440099
303300                '(''V'', ''A'', ''I'', ''B'', ''R'', ''U'')'      33450099
303400                 DELIMITED BY SIZE                                33460099
303500         INTO PV-WHERE-STMT                                       33470099
303600         WITH POINTER PV-STRING-POINTER-WHERE                     33480099
303700     END-IF.                                                      33490099
303800                                                                  33500099
303900*----------------------------------------------------------------*33510099
304000* PUT THE FINAL PIECE ON THE WHERE CLAUSE                        *33520099
304100*----------------------------------------------------------------*33530099
304200 4240-FINAL-WHERE.                                                33540099
304300                                                                  33550099
304500     STRING ' AND TRN.PARTN_NBR = PRT.PARTN_NBR'                  33570099
304600            ' AND TRN.SLS_DTE = PRT.SLS_DTE'                      33580099
304700            ' AND XST.LOC_NBR = TRN.STR_NBR'                      33581099
304800            DELIMITED BY SIZE                                     33590099
304900     INTO PV-WHERE-STMT                                           33600099
305000     WITH POINTER PV-STRING-POINTER-WHERE                         33610099
305100     MOVE ASC-KEY-FROM-PARTN-NBR                                  33620099
305200                               TO PV-FROM-PARTITION               33630099
305300     MOVE ASC-KEY-TO-PARTN-NBR TO PV-TO-PARTITION                 33640099
305400     IF PS-USE-ONE-DATE                                           33650099
305500         STRING ' AND TRN.PARTN_NBR = '                           33660099
305600                PV-FROM-PARTITION                                 33670099
305700                ' AND XST.LOC_NBR = TRN.STR_NBR'                  33671099
305800                DELIMITED BY SIZE                                 33680099
305900         INTO PV-WHERE-STMT                                       33690099
306000         WITH POINTER PV-STRING-POINTER-WHERE                     33700099
306100     ELSE                                                         33710099
306200         EVALUATE TRUE                                            33720099
306300             WHEN ASC-KEY-FROM-PARTN-NBR                          33730099
306400                               < ASC-KEY-TO-PARTN-NBR             33740099
306500                 STRING ' AND TRN.PARTN_NBR BETWEEN '             33750099
306600                        PV-FROM-PARTITION                         33760099
306700                        ' AND '                                   33770099
306800                        PV-TO-PARTITION                           33780099
306900                        ' AND XST.LOC_NBR = TRN.STR_NBR'          33781099
307000                        DELIMITED BY SIZE                         33790099
307100                 INTO PV-WHERE-STMT                               33800099
307200                 WITH POINTER PV-STRING-POINTER-WHERE             33810099
307300             WHEN ASC-KEY-FROM-PARTN-NBR                          33820099
307400                               > ASC-KEY-TO-PARTN-NBR             33830099
307500                 STRING ' AND (TRN.PARTN_NBR >= '                 33840099
307600                        PV-FROM-PARTITION                         33850099
307700                        ' OR  TRN.PARTN_NBR <= '                  33860099
307800                        PV-TO-PARTITION                           33870099
307900                        ')'                                       33871099
308000                        ' AND XST.LOC_NBR = TRN.STR_NBR'          33872099
308100                        DELIMITED BY SIZE                         33880099
308200                 INTO PV-WHERE-STMT                               33890099
308300                 WITH POINTER PV-STRING-POINTER-WHERE             33900099
308400             WHEN ASC-KEY-FROM-PARTN-NBR                          33910099
308500                               = ASC-KEY-TO-PARTN-NBR             33920099
308600                 STRING ' AND TRN.PARTN_NBR = '                   33930099
308700                        PV-FROM-PARTITION                         33940099
308800                        ' AND XST.LOC_NBR = TRN.STR_NBR'          33941099
308900                        DELIMITED BY SIZE                         33950099
309000                 INTO PV-WHERE-STMT                               33960099
309100                 WITH POINTER PV-STRING-POINTER-WHERE             33970099
309200         END-EVALUATE                                             33980099
309300     END-IF.                                                      33990099
317300                                                                  34750099
317400*----------------------------------------------------------------*34751099
317500*  FORMAT THE WHERE CLAUSE WHEN AN E-COMMERCE ORDER NUMBER HAS   *34752099
317600*  BEEN PROVIDED.                                                *34753099
317700*----------------------------------------------------------------*34754099
317800                                                                  34755099
317900 4250-FORMAT-ECOM-NBR-WHERE.                                      34756099
318000                                                                  34757099
318100     MOVE ASC-KEY-ECOM-ORD-NBR     TO PV-ECOM-ORD-NBR.            34757199
318200     IF PV-STRING-POINTER-WHERE    > 1                            34757499
318300         STRING ' AND'                                            34757599
318400                ' ORD_NBR = '                                     34758099
318500                PC-QUOTE        DELIMITED BY SIZE                 34758199
318600                PV-ECOM-ORD-NBR DELIMITED BY ' '                  34758299
318700                PC-QUOTE                                          34758399
318800                DELIMITED BY SIZE                                 34758499
318900         INTO PV-WHERE-STMT                                       34758599
319000         WITH POINTER PV-STRING-POINTER-WHERE                     34758699
319100     ELSE                                                         34758799
319200         STRING ' WHERE'                                          34758899
319300                ' ORD_NBR = '                                     34759399
319400                PC-QUOTE        DELIMITED BY SIZE                 34759499
319500                PV-ECOM-ORD-NBR DELIMITED BY ' '                  34759699
319600                PC-QUOTE                                          34759899
319700                DELIMITED BY SIZE                                 34759999
319800         INTO PV-WHERE-STMT                                       34760099
319900         WITH POINTER PV-STRING-POINTER-WHERE                     34760199
320000     END-IF.                                                      34760299
320100     STRING ' AND TRN.PARTN_NBR = ORD.PARTN_NBR'                  34760399
320200            ' AND TRN.STR_NBR = ORD.STR_NBR'                      34760499
320300            ' AND TRN.RGST_ID = ORD.RGST_ID'                      34760599
320400            ' AND TRN.TRN_NBR = ORD.TRN_NBR'                      34760699
320500            ' AND TRN.STRT_TM = ORD.STRT_TM'                      34760799
320600            ' AND TRN.SLS_CORR_SEQ_NBR'                           34760899
320700            ' = ORD.SLS_CORR_SEQ_NBR'                             34760999
320800            DELIMITED BY SIZE                                     34761099
320900     INTO PV-WHERE-STMT                                           34761199
321000     WITH POINTER PV-STRING-POINTER-WHERE.                        34761299
321100                                                                  34765299
321200                                                                  34765599
321300*----------------------------------------------------------------*34766099
321400*  FORMAT HAVE THE PARTN NUMBER STATEMENT ON THE EXISTS CLAUSES  *34770099
321500*  SHOULD LOOK.  IF THERE IS A DATE RANGE AND THE FROM PARTITION *34780099
321600*  NUMBER IS GREATER THAN THE TO PARTITON NUMBER, A BETWEEN      *34790099
321700*  CONDIITON CANNOT BE USED.                                     *34800099
321800*----------------------------------------------------------------*34810099
321900                                                                  34830099
322000 4290-FORMAT-PARTITION-WHERE.                                     34840099
322100                                                                  34850099
322200     MOVE ASC-KEY-FROM-PARTN-NBR   TO PV-FROM-PARTITION.          34860099
322300     MOVE ASC-KEY-TO-PARTN-NBR     TO PV-TO-PARTITION.            34870099
322400     IF PS-USE-ONE-DATE                                           34880099
322500         STRING ' AND PRT.PARTN_NBR = '                           34890099
322600                 PV-FROM-PARTITION                                34900099
322700                 DELIMITED BY SIZE                                34910099
322800         INTO PV-WHERE-STMT                                       34920099
322900         WITH POINTER PV-STRING-POINTER-WHERE                     34930099
323000     ELSE                                                         34940099
323100         EVALUATE TRUE                                            34950099
323200             WHEN ASC-KEY-FROM-PARTN-NBR                          34960099
323300                                   < ASC-KEY-TO-PARTN-NBR         34970099
323400                 STRING ' AND PRT.PARTN_NBR BETWEEN '             34980099
323500                        PV-FROM-PARTITION                         34990099
323600                        ' AND '                                   35000099
323700                        PV-TO-PARTITION                           35010099
323800                        DELIMITED BY SIZE                         35020099
323900                 INTO PV-WHERE-STMT                               35030099
324000                 WITH POINTER PV-STRING-POINTER-WHERE             35040099
324100             WHEN ASC-KEY-FROM-PARTN-NBR                          35050099
324200                                   > ASC-KEY-TO-PARTN-NBR         35060099
324300                 STRING ' AND (PRT.PARTN_NBR >= '                 35070099
324400                        PV-FROM-PARTITION                         35080099
324500                        ' OR PRT.PARTN_NBR <= '                   35090099
324600                        PV-TO-PARTITION                           35100099
324700                        ')'                                       35101099
324800                        DELIMITED BY SIZE                         35110099
324900                 INTO PV-WHERE-STMT                               35120099
325000                 WITH POINTER PV-STRING-POINTER-WHERE             35130099
325100             WHEN ASC-KEY-FROM-PARTN-NBR                          35140099
325200                                   = ASC-KEY-TO-PARTN-NBR         35150099
325300                 STRING ' AND PRT.PARTN_NBR = '                   35160099
325400                        PV-FROM-PARTITION                         35170099
325500                        DELIMITED BY SIZE                         35180099
325600                 INTO PV-WHERE-STMT                               35190099
325700                 WITH POINTER PV-STRING-POINTER-WHERE             35200099
325800         END-EVALUATE                                             35210099
325900     END-IF.                                                      35220099
326000                                                                  35230099
329000     IF PS-HAVE-EXISTS-CLAUSE                                     35530099
329100         STRING ')'                           DELIMITED BY SIZE   35540099
329200         INTO PV-WHERE-STMT                                       35550099
329300         WITH POINTER PV-STRING-POINTER-WHERE                     35560099
329400     END-IF.                                                      35570099
329500                                                                  35571099
329600     SET PS-HAVE-PARTITION-WHERE   TO TRUE.                       35572099
329700                                                                  35573099
329800                                                                  35580099
329900*----------------------------------------------------------------*35590099
330000*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *35600099
330100*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *35610099
330200*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *35620099
330300*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *35630099
330400*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *35640099
330500*                                                                *35650099
330600*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *35660099
330700*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *35670099
330800*    UPON INITIALIZATION.                                        *35680099
330900*----------------------------------------------------------------*35690099
331000                                                                  35700099
331100 4300-READ-ITEMS-FROM-DB.                                         35710099
331200                                                                  35720099
331300     PERFORM                                                      35730099
331400         VARYING PV-READ-COUNT                                    35740099
331500         FROM 1 BY 1                                              35750099
331600         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    35760099
331700            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         35770099
331800                                                                  35780099
331900         PERFORM 4310-FETCH                                       35790099
332000                                                                  35800099
332100         IF  ASC-ITEMS-LEFT-ON-DB                                 35810099
332200             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                35820099
332300                 ADD +1            TO ASC-ITEM-SUB                35830099
332400             ELSE                                                 35840099
332500                 ADD +1            TO ASC-BLK-SUB                 35850099
332600                 MOVE +1           TO ASC-ITEM-SUB                35860099
332700                                                                  35870099
332800                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         35880099
332900                     MOVE +1       TO ASC-BLK-SUB                 35890099
333000                     SET ASC-BLOCK-MODIFIED (1)                   35900099
333100                                   TO TRUE                        35910099
333200                     PERFORM 5100-WRITE-TEMP-STORAGE              35920099
333300                     MOVE ASC-BLOCK-ENTRIES                       35930099
333400                               (PC-MAX-BLOCKS-IN-ARRAY)           35940099
333500                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 35950099
333600                     ADD +1        TO ASC-BLK-SUB                 35960099
333700                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   35970099
333800                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      35980099
333900                                   TO TRUE                        35990099
334000                 END-IF                                           36000099
334100             END-IF                                               36010099
334200             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    36020099
334300             MOVE ASC-NUMBER-OF-ITEMS-READ                        36030099
334400                                   TO ASC-LIST-ITEM-NUMBER        36040099
334500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  36050099
334600             MOVE EPPART-PARTN-NBR TO ASC-PARTITION-NBR           36060099
334700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  36070099
334800             MOVE EPPART-SLS-DTE (1:4)                            36080099
334900                                   TO PV-SLS-DTE-FORMATTED-YYYY   36090099
335000             MOVE EPPART-SLS-DTE (6:2)                            36100099
335100                                   TO PV-SLS-DTE-FORMATTED-MM     36110099
335200             MOVE EPPART-SLS-DTE (9:2)                            36120099
335300                                   TO PV-SLS-DTE-FORMATTED-DD     36130099
335400             MOVE PV-SLS-DTE-FORMATTED                            36140099
335500                                   TO ASC-SALES-DATE              36150099
335600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  36160099
335700             MOVE EPTRN-STR-NBR    TO ASC-STORE                   36170099
335800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  36180099
335900             MOVE EPTRN-RGST-ID    TO ASC-REGISTER                36190099
336000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 36200099
336100                                      PV-RGST-ID                  36201099
336200             MOVE EPTRN-TRN-NBR    TO ASC-TRANSACTION             36210099
336300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 36220099
336400             MOVE EPTRN-STRT-TM    TO ASC-START-TIME              36230099
336500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 36240099
336600             MOVE EPTRN-ASSOC-ID   TO PV-ASSOC-ID                 36250099
336700             MOVE PV-ASSOC-ID      TO ASC-REGISTER-OPERATOR       36260099
336800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 36270099
336900             MOVE EPTRN-TRN-TYP-CDE                               36280099
337000                                   TO  ASC-TYPE                   36290099
337100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 36300099
337200             MOVE EPTRN-SLS-CORR-SEQ-NBR                          36310099
337300                                   TO ASC-SALES-CORR-SEQ-NBR      36320099
337400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 36330099
337500             EVALUATE TRUE                                        36340099
337600                 WHEN ((XST00001-E-BUS-IND    = 'Y')       AND    36341099
337700                       (EPTRN-ASSOC-ID    NOT = 12345678)  AND    36342099
337800                       (NOT PV-RGST-ID-ECOM))                     36343099
337900                     MOVE 'TEL'    TO ASC-SOURCE-TEXT             36344099
338000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 36345099
338100                 WHEN ((XST00001-E-BUS-IND    = 'Y')       AND    36346099
338200                       (EPTRN-ASSOC-ID        = 12345678))        36347099
338300                     MOVE 'EC'     TO ASC-SOURCE-TEXT             36348099
338400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 36349099
338500                 WHEN ((XST00001-E-BUS-IND    = 'Y')       AND    36349199
338600                       (PV-RGST-ID-ECOM))                         36349299
338700                     MOVE 'POS'    TO ASC-SOURCE-TEXT             36349399
338800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 36349499
338900                 WHEN EPTRN-SLS-CORR-SEQ-NBR = ZERO               36350099
339000                     MOVE 'POS'    TO ASC-SOURCE-TEXT             36360099
339100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 36370099
339200                 WHEN EPTRN-SLS-CORR-SEQ-NBR > ZERO               36380099
339300                     MOVE 'SA'     TO ASC-SOURCE-TEXT             36390099
339400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 36400099
339500                 WHEN EPTRN-SLS-CORR-SEQ-NBR < ZERO               36410099
339600                     MOVE 'SYS'    TO ASC-SOURCE-TEXT             36420099
339700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 36430099
339800             END-EVALUATE                                         36440099
339900                                                                  36450099
340000             MOVE EPTRN-TRN-STAT-CDE                              36460099
340100                                   TO ASC-STATUS                  36470099
340200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 36480099
340300             EVALUATE TRUE                                        36490099
340400                 WHEN ASC-STAT-VALID-CORR                         36500099
340500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 36510099
340600                     MOVE 'CORR'       TO RF-STATUS-TEXT-MSG      36520099
340700                     MOVE EPTRN-PRCG-DTE TO RF-PROCESSING-DATE    36530099
340800                     MOVE RF-PRCG-DTE-MM TO RF-DISPLAY-DTE-MM     36540099
340900                     MOVE RF-PRCG-DTE-DD TO RF-DISPLAY-DTE-DD     36550099
341000                     MOVE RF-PRCG-DTE-YY TO RF-DISPLAY-DTE-YY     36560099
341100                     MOVE RF-DISPLAY-DATE TO RF-STATUS-TEXT-DATE  36570099
341200                     MOVE RF-STATUS-TEXT TO ASC-STATUS-TEXT       36580099
341300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 36590099
341400                 WHEN ASC-STAT-VALID-POS                          36600099
341500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 36610099
341600                     MOVE 'VALID POS' TO ASC-STATUS-TEXT          36620099
341700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 36630099
341800                 WHEN ASC-STAT-MIS-TOT                            36640099
341900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 36650099
342000                     MOVE 'MISSNG TOTAL' TO ASC-STATUS-TEXT       36660099
342100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 36670099
342200                 WHEN ASC-STAT-MIS-TND                            36680099
342300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 36690099
342400                     MOVE 'MISSNG TENDR' TO ASC-STATUS-TEXT       36700099
342500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 36710099
342600                 WHEN ASC-STAT-OUT-BAL-ITM                        36720099
342700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 36730099
342800                     MOVE 'ITMS NOT BAL' TO ASC-STATUS-TEXT       36740099
342900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 36750099
343000                 WHEN ASC-STAT-OUT-BAL-TND                        36760099
343100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 36770099
343200                     MOVE 'TNDR NOT BAL' TO ASC-STATUS-TEXT       36780099
343300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 36790099
343400                 WHEN ASC-STAT-NON-NUM-ACT                        36800099
343500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 36810099
343600                     MOVE 'ACCT NOT NUM' TO ASC-STATUS-TEXT       36820099
343700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 36830099
343800                 WHEN ASC-STAT-MIS-ACT                            36840099
343900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 36850099
344000                     MOVE 'MISSNG ACT #' TO ASC-STATUS-TEXT       36860099
344100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 36870099
344200                 WHEN ASC-STAT-INVAL-COR                          36880099
344300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 36890099
344400                     MOVE 'INVALID CORR' TO ASC-STATUS-TEXT       36900099
344500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 36910099
344600                 WHEN ASC-STAT-INVAL-PRE                          36920099
344700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 36930099
344800                     MOVE 'INVALD PREFX' TO ASC-STATUS-TEXT       36940099
344900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 36950099
345000                 WHEN ASC-STAT-INVAL-C-D                          36960099
345100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 36970099
345200                     MOVE 'INVLD CK DGT' TO ASC-STATUS-TEXT       36980099
345300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 36990099
345400                 WHEN ASC-STAT-INVAL-STR                          37000099
345500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37010099
345600                     MOVE 'INVALD STORE' TO ASC-STATUS-TEXT       37020099
345700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37030099
345800                 WHEN ASC-STAT-REVERSAL                           37040099
345900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37050099
346000                     MOVE 'REVRS'      TO RF-STATUS-TEXT-MSG      37060099
346100                     MOVE EPTRN-PRCG-DTE TO RF-PROCESSING-DATE    37070099
346200                     MOVE RF-PRCG-DTE-MM TO RF-DISPLAY-DTE-MM     37080099
346300                     MOVE RF-PRCG-DTE-DD TO RF-DISPLAY-DTE-DD     37090099
346400                     MOVE RF-PRCG-DTE-YY TO RF-DISPLAY-DTE-YY     37100099
346500                     MOVE RF-DISPLAY-DATE TO RF-STATUS-TEXT-DATE  37110099
346600                     MOVE RF-STATUS-TEXT TO ASC-STATUS-TEXT       37120099
346700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37130099
346800                 WHEN ASC-STAT-LATE-DC                            37140099
346900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37150099
347000                     MOVE 'LATE '      TO RF-STATUS-TEXT-MSG      37160099
347100                     MOVE EPTRN-PRCG-DTE TO RF-PROCESSING-DATE    37170099
347200                     MOVE RF-PRCG-DTE-MM TO RF-DISPLAY-DTE-MM     37180099
347300                     MOVE RF-PRCG-DTE-DD TO RF-DISPLAY-DTE-DD     37190099
347400                     MOVE RF-PRCG-DTE-YY TO RF-DISPLAY-DTE-YY     37200099
347500                     MOVE RF-DISPLAY-DATE TO RF-STATUS-TEXT-DATE  37210099
347600                     MOVE RF-STATUS-TEXT TO ASC-STATUS-TEXT       37220099
347700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37230099
347800                 WHEN ASC-STAT-INVAL-HD-TOT                       37240099
347900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37250099
348000                     MOVE 'HD TOTAL INC' TO ASC-STATUS-TEXT       37260099
348100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37270099
348200                 WHEN ASC-STAT-ERROR-GEN                          37280099
348300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37290099
348400                     MOVE 'ERROR IN TRN' TO ASC-STATUS-TEXT       37300099
348500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37310099
348600                 WHEN ASC-STAT-INCOMP-DATA                        37320099
348700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37330099
348800                     MOVE 'INCOMPL DATA' TO ASC-STATUS-TEXT       37340099
348900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37350099
349000                 WHEN OTHER                                       37360099
349100                     MOVE 'UNKNOWN     ' TO ASC-STATUS-TEXT       37370099
349200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37380099
349300             END-EVALUATE                                         37390099
349400                                                                  37400099
349500             MOVE EPTRN-VOID-ABRT-CDE                             37410099
349600                                   TO ASC-VOID-CODE               37420099
349700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37430099
349800                                                                  37440099
349900             EVALUATE TRUE                                        37450099
350000                 WHEN ASC-VOID-NORMAL                             37460099
350100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37470099
350200                     MOVE 'NORMAL TRAN' TO ASC-VOID-CODE-TEXT     37480099
350300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37490099
350400                 WHEN ASC-VOID-AFTER                              37500099
350500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37510099
350600                     MOVE 'VOID AFTER' TO ASC-VOID-CODE-TEXT      37520099
350700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37530099
350800                 WHEN ASC-VOID-DURING                             37540099
350900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37550099
351000                     MOVE 'VOID DURING' TO ASC-VOID-CODE-TEXT     37560099
351100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37570099
351200                 WHEN ASC-VOID-AFTER-DURING                       37580099
351300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37590099
351400                     MOVE 'VOID AFT/DUR' TO ASC-VOID-CODE-TEXT    37600099
351500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37610099
351600                 WHEN ASC-VOID-DURING-AFTER                       37620099
351700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37630099
351800                     MOVE 'VOID DUR/AFT' TO ASC-VOID-CODE-TEXT    37640099
351900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37650099
352000                 WHEN ASC-VOID-REVERSED                           37660099
352100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37670099
352200                     MOVE 'REVERSD CORR' TO ASC-VOID-CODE-TEXT    37680099
352300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37690099
352400                 WHEN ASC-VOID-UNCORRECTED                        37700099
352500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37710099
352600                     MOVE 'UNCORR VOID' TO ASC-VOID-CODE-TEXT     37720099
352700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37730099
352800                 WHEN OTHER                                       37740099
352900                     MOVE 'UNKNOWN    ' TO ASC-VOID-CODE-TEXT     37750099
353000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37760099
353100             END-EVALUATE                                         37770099
353200                                                                  37780099
353300             MOVE EPTRN-TRN-TOT-AMT     TO ASC-AMOUNT             37790099
353400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37800099
353500             MOVE EPTRN-SRVR-ONLN-IND   TO ASC-ONLINE-IND         37810099
353600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37820099
353700             COMPUTE ASC-AVAIL-OTR-AMT (ASC-BLK-SUB ASC-ITEM-SUB) 37830099
353800                                        = (EPTRN-ORIG-OTR-AMT     37840099
353900                                        -  EPTRN-ACCM-RET-TOT-AMT)37850099
354000         END-IF                                                   37860099
354100     END-PERFORM.                                                 37870099
354200                                                                  37880099
354300     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          37890099
354400         MOVE +1               TO ASC-BLK-SUB                     37900099
354500         PERFORM 5100-WRITE-TEMP-STORAGE                          37910099
354600         ADD +1                TO ASC-BLK-SUB                     37920099
354700         PERFORM 5100-WRITE-TEMP-STORAGE                          37930099
354800                                                                  37940099
354900         MOVE 1                TO ASC-BLK-SUB                     37950099
355000                                  PV-BLOCK-NUMBER                 37960099
355100         PERFORM 4410-READ-TEMP-STORAGE                           37970099
355200         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             37980099
355300             MOVE 2            TO ASC-BLK-SUB                     37990099
355400                                  PV-BLOCK-NUMBER                 38000099
355500             PERFORM 4410-READ-TEMP-STORAGE                       38010099
355600         END-IF                                                   38020099
355700     END-IF.                                                      38030099
355800                                                                  38040099
355900*----------------------------------------------------------------*38050099
356000*    FETCH THE MESSAGE CURSOR.                                   *38060099
356100*----------------------------------------------------------------*38070099
356200                                                                  38080099
356300 4310-FETCH.                                                      38090099
356400                                                                  38100099
356500     EXEC SQL                                                     38110099
356600         FETCH TRANS-CSR                                          38120099
356700         INTO  :EPPART-PARTN-NBR                                  38130099
356800              ,:EPTRN-STR-NBR                                     38140099
356900              ,:EPTRN-RGST-ID                                     38150099
357000              ,:EPTRN-TRN-NBR                                     38160099
357100              ,:EPTRN-STRT-TM                                     38170099
357200              ,:EPTRN-SLS-CORR-SEQ-NBR                            38180099
357300              ,:EPTRN-VOID-ABRT-CDE                               38190099
357400              ,:EPTRN-TRN-STAT-CDE                                38200099
357500              ,:EPTRN-TRN-TYP-CDE                                 38210099
357600              ,:EPPART-SLS-DTE                                    38220099
357700              ,:EPTRN-PRCG-DTE                                    38230099
357800              ,:EPTRN-TRN-TOT-AMT                                 38240099
357900              ,:EPTRN-SRVR-ONLN-IND                               38250099
358000              ,:EPTRN-ASSOC-ID                                    38260099
358100              ,:EPTRN-ORIG-OTR-AMT                                38270099
358200              ,:EPTRN-ACCM-RET-TOT-AMT                            38280099
358300              ,:XST00001-E-BUS-IND                                38281099
358400     END-EXEC.                                                    38290099
358500                                                                  38300099
358600     EVALUATE TRUE                                                38310099
358700         WHEN SQLCODE = ZERO                                      38320099
358800         WHEN SQLCODE = +100                                      38330099
358900              CONTINUE                                            38340099
359000         WHEN SQLWARN0 NOT = SPACE                                38350099
359100         WHEN SQLCODE NOT = ZERO                                  38360099
359200              MOVE '4040-CLOSE-CURSOR'                            38370099
359300                               TO DP013-PARAGRAPH                 38380099
359400              MOVE 'CLOSE CURSOR '                                38390099
359500                               TO DP013-MESSAGE-TEXT (1)          38400099
359600              MOVE SQLCA       TO DP013-SQLCA                     38410099
359700              SET DP013-DB2-ABEND                                 38420099
359800                               TO TRUE                            38430099
359900              PERFORM DP013-0000-PROCESS-ABEND                    38440099
360000     END-EVALUATE.                                                38450099
360100                                                                  38460099
360200     IF  SQLCODE EQUAL +100                                       38470099
360300         SET ASC-NO-ITEMS-LEFT-ON-DB                              38480099
360400                                   TO TRUE                        38490099
360500     END-IF.                                                      38500099
360600                                                                  38510099
360700*----------------------------------------------------------------*38520099
360800* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *38530099
360900*----------------------------------------------------------------*38540099
361000                                                                  38550099
361100 4400-MOVE-COMMAREA-TO-SCREEN.                                    38560099
361200     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             38570099
361300         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          38580099
361400         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          38590099
361500             MOVE +1    TO ASC-BLK-SUB                            38600099
361600             PERFORM 5100-WRITE-TEMP-STORAGE                      38610099
361700             ADD +1     TO ASC-BLK-SUB                            38620099
361800             PERFORM 5100-WRITE-TEMP-STORAGE                      38630099
361900             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             38640099
362000                 GIVING PV-BLOCK-NUMBER                           38650099
362100                 REMAINDER PV-REMAINDER                           38660099
362200             IF  PV-REMAINDER > ZERO                              38670099
362300                 ADD +1 TO PV-BLOCK-NUMBER                        38680099
362400             END-IF                                               38690099
362500             MOVE +1    TO ASC-BLK-SUB                            38700099
362600             PERFORM 4410-READ-TEMP-STORAGE                       38710099
362700             ADD +1     TO ASC-BLK-SUB                            38720099
362800                           PV-BLOCK-NUMBER                        38730099
362900             PERFORM 4410-READ-TEMP-STORAGE                       38740099
363000     END-IF.                                                      38750099
363100     MOVE +1            TO ASC-BLK-SUB.                           38760099
363200     COMPUTE ASC-ITEM-SUB =                                       38770099
363300         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              38780099
363400         + PC-ITEMS-PER-PANEL).                                   38790099
363500                                                                  38800099
363600     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        38810099
363700         ADD +1         TO ASC-BLK-SUB                            38820099
363800         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            38830099
363900     END-IF.                                                      38840099
364000                                                                  38850099
364100     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           38860099
364200         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                38870099
364300     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        38880099
364400     PERFORM 4420-FORMAT-LIST-LINES                               38890099
364500         VARYING PV-SUB                                           38900099
364600         FROM PC-ITEMS-PER-PANEL BY -1                            38910099
364700         UNTIL PV-SUB < +1.                                       38920099
364800                                                                  38930099
364900     COMPUTE ASC-ITEMS-DISPLAYED =                                38940099
365000         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          38950099
365100     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    38960099
365200                                      ASTRTITO.                   38970099
365300     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    38980099
365400     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    38990099
365500     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            39000099
365600                                   TO ASELITO.                    39010099
365700                                                                  39020099
365800     IF  DP020-MSG-NUMBER-X = SPACE                               39030099
365900         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  39040099
366000*            --- MORE ITEMS TO DISPLAY ----                       39050099
366100             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            39060099
366200             SET DP020-MSG-INFORMATIONAL TO TRUE                  39070099
366300         END-IF                                                   39080099
366400     END-IF.                                                      39090099
366500*----------------------------------------------------------------*39100099
366600*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *39110099
366700*----------------------------------------------------------------*39120099
366800                                                                  39130099
366900 4410-READ-TEMP-STORAGE.                                          39140099
367000                                                                  39150099
367100     EXEC CICS                                                    39160099
367200         READQ TS                                                 39170099
367300             QUEUE (ASC-LIST-QUEUE-NAME)                          39180099
367400             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               39190099
367500             ITEM  (PV-BLOCK-NUMBER)                              39200099
367600             RESP  (PV-CICS-RESP)                                 39210099
367700     END-EXEC.                                                    39220099
367800                                                                  39230099
367900     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       39240099
368000       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     39250099
368100         CONTINUE                                                 39260099
368200     ELSE                                                         39270099
368300         SET DP013-CICS-ABEND     TO TRUE                         39280099
368400         SET DP013-NO-ROLLBACK    TO TRUE                         39290099
368500         MOVE '4410-READ-TEMP-STORAGE'                            39300099
368600                                  TO DP013-PARAGRAPH              39310099
368700         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      39320099
368800                                  TO DP013-MESSAGE-TEXT(1)        39330099
368900         PERFORM DP013-0000-PROCESS-ABEND                         39340099
369000     END-IF.                                                      39350099
369100                                                                  39360099
369200     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             39370099
369300                                                                  39380099
369400     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         39390099
369500         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               39400099
369600     END-IF.                                                      39410099
369700                                                                  39420099
369800*----------------------------------------------------------------*39430099
369900*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *39440099
370000*----------------------------------------------------------------*39450099
370100                                                                  39460099
370200 4420-FORMAT-LIST-LINES.                                          39470099
370300     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      39480099
370400         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                39490099
370500         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           39500099
370600         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           39510099
370700         MOVE SPACE              TO MR-SELECTI (PV-SUB)           39520099
370800                                    MR-ACTION (PV-SUB)            39530099
370900                                    MR-DATE (PV-SUB)              39540099
371000                                    MR-STORE-X (PV-SUB)           39550099
371100                                    MR-REG-X (PV-SUB)             39560099
371200                                    MR-TRANS-X (PV-SUB)           39570099
371300                                    MR-VAR-AREA (PV-SUB)          39580099
371400     ELSE                                                         39590099
371500         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      39600099
371600                                                   > SPACE        39610099
371700             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 39620099
371800                                 TO MR-SELECTI (PV-SUB)           39630099
371900         ELSE                                                     39640099
372000             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      39650099
372100                                 TO MR-SELECTI (PV-SUB)           39660099
372200         END-IF                                                   39670099
372300                                                                  39680099
372400         IF  DP030-SET-CURSOR-TRAILER                             39690099
372500             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)39700099
372600                 > SPACE)                                         39710099
372700               OR (PV-SUB = 1))                                   39720099
372800                SET DP030-SET-CURSOR-APPL-1 TO TRUE               39730099
372900                MOVE -1          TO MR-SELECTL (PV-SUB)           39740099
373000             END-IF                                               39750099
373100         END-IF                                                   39760099
373200                                                                  39770099
373300*** THE IF STATEMENT BELOW IS COMMENTED OUT SO THAT THE SCREEN    39780099
373400*** ALWAYS GETS REBUILT.  THIS ALLOWS THE LEFT AND RIGHT          39790099
373500*** FUNCTION KEYS TO OPERATE CORRECTLY.                           39800099
373600                                                                  39810099
373700*        IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           39820099
373800             MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)           39830099
373900                                   TO MR-ACTION (PV-SUB)          39840099
374000             MOVE ASC-SALES-DATE (ASC-BLK-SUB ASC-ITEM-SUB)       39850099
374100                                   TO MR-DATE (PV-SUB)            39860099
374200             MOVE ASC-STORE (ASC-BLK-SUB ASC-ITEM-SUB)            39870099
374300                                   TO MR-STORE (PV-SUB)           39880099
374400             MOVE ASC-REGISTER (ASC-BLK-SUB ASC-ITEM-SUB)         39890099
374500                                   TO MR-REG (PV-SUB)             39900099
374600             MOVE ASC-TRANSACTION (ASC-BLK-SUB ASC-ITEM-SUB)      39910099
374700                                   TO MR-TRANS (PV-SUB)           39920099
374800             MOVE SPACES           TO DL-DETAIL-LINE-LEFT         39930099
374900             IF ASC-LEFT-VIEW                                     39940099
375000                 MOVE DP015-ASK-NOR-OFF                           39950099
375100                                   TO AVARONA                     39960099
375200                 MOVE DP015-WHITE  TO AVARONC                     39970099
375300                 MOVE 'ON'         TO AVARONO                     39980099
375400                 MOVE ASC-REGISTER-OPERATOR                       39990099
375500                       (ASC-BLK-SUB ASC-ITEM-SUB)                 40000099
375600                                   TO DL-REG-OP-LEFT              40010099
375700                 MOVE ASC-TYPE (ASC-BLK-SUB ASC-ITEM-SUB)         40020099
375800                                   TO DL-TYPE-LEFT                40030099
375900                 MOVE ASC-ONLINE-IND (ASC-BLK-SUB ASC-ITEM-SUB)   40040099
376000                                   TO DL-ONLINE-IND-LEFT          40050099
376100                 IF ASC-VOID-CODE (ASC-BLK-SUB ASC-ITEM-SUB)      40060099
376200                                   = 'N'                          40070099
376300                     MOVE 'N'      TO DL-VOID-IND-LEFT            40080099
376400                 ELSE                                             40090099
376500                     MOVE 'Y'      TO DL-VOID-IND-LEFT            40100099
376600                 END-IF                                           40110099
376700                 MOVE ASC-AMOUNT (ASC-BLK-SUB ASC-ITEM-SUB)       40120099
376800                                   TO DL-TRAN-AMOUNT-LEFT         40130099
376900                 MOVE DL-DETAIL-LINE-LEFT                         40140099
377000                                   TO MR-VAR-AREA (PV-SUB)        40150099
377100                 MOVE HL-HEADING-LINE-LEFT                        40160099
377200                                   TO AVARHDRO                    40170099
377300             ELSE                                                 40180099
377400                 MOVE ASC-SOURCE-TEXT (ASC-BLK-SUB ASC-ITEM-SUB)  40190099
377500                                   TO DL-TRAN-SRC-RIGHT           40200099
377600                 MOVE ASC-STATUS-TEXT (ASC-BLK-SUB ASC-ITEM-SUB)  40210099
377700                                   TO DL-STATUS-RIGHT             40220099
377800                 MOVE ASC-VOID-CODE-TEXT                          40230099
377900                        (ASC-BLK-SUB ASC-ITEM-SUB)                40240099
378000                                   TO DL-VOID-INFO-RIGHT          40250099
378100                 MOVE ASC-AVAIL-OTR-AMT (ASC-BLK-SUB ASC-ITEM-SUB)40260099
378200                                   TO DL-AVAIL-OTR-RIGHT          40270099
378300                 MOVE DL-DETAIL-LINE-RIGHT                        40280099
378400                                   TO MR-VAR-AREA (PV-SUB)        40290099
378500                 MOVE DP015-ASK-DRK-OFF                           40300099
378600                                   TO AVARONA                     40310099
378700                 MOVE HL-HEADING-LINE-RIGHT                       40320099
378800                                   TO AVARHDRO                    40330099
378900             END-IF                                               40340099
379000*        END-IF                                                   40350099
379100     END-IF.                                                      40360099
379200     SUBTRACT +1 FROM ASC-ITEM-SUB                                40370099
379300     IF  ASC-ITEM-SUB < + 1                                       40380099
379400         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  40390099
379500         MOVE +1                 TO ASC-BLK-SUB                   40400099
379600     END-IF.                                                      40410099
379700*----------------------------------------------------------------*40420099
379800*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *40430099
379900*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *40440099
380000*  ISSUE A WARNING.                                              *40450099
380100*----------------------------------------------------------------*40460099
380200 4430-CHECK-FOR-BEGIN-AND-END.                                    40470099
380300     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       40480099
380400         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     40490099
380500*            -- NO END-OF-RANGE SPECFIED ---                      40500099
380600             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            40510099
380700             SET DP020-MSG-WARNING TO TRUE                        40520099
380800             PERFORM 4431-POSITION-AT-WARNING                     40530099
380900         END-IF                                                   40540099
381000     ELSE                                                         40550099
381100         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     40560099
381200*            -- NO BEGINNING-OF-RANGE SPECFIED ---                40570099
381300             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            40580099
381400             SET DP020-MSG-WARNING TO TRUE                        40590099
381500             PERFORM 4431-POSITION-AT-WARNING                     40600099
381600         END-IF                                                   40610099
381700     END-IF.                                                      40620099
381800*----------------------------------------------------------------*40630099
381900*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *40640099
382000*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *40650099
382100*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *40660099
382200*  POSITION THE CURSOR THERE.                                    *40670099
382300*----------------------------------------------------------------*40680099
382400 4431-POSITION-AT-WARNING.                                        40690099
382500     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 40700099
382600                    - PV-TOP-ITEM + 1.                            40710099
382700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      40720099
382800         CONTINUE                                                 40730099
382900     ELSE                                                         40740099
383000         SET DP030-SET-CURSOR-APPL-1                              40750099
383100                                   TO TRUE                        40760099
383200         MOVE -1                   TO MR-SELECTL (PV-SUB)         40770099
383300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         40780099
383400         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         40790099
383500     END-IF.                                                      40800099
383600                                                                  40810099
383700     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   40820099
383800                    - PV-TOP-ITEM + 1.                            40830099
383900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      40840099
384000         CONTINUE                                                 40850099
384100     ELSE                                                         40860099
384200         SET DP030-SET-CURSOR-APPL-1                              40870099
384300                                   TO TRUE                        40880099
384400         MOVE -1                   TO MR-SELECTL (PV-SUB)         40890099
384500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         40900099
384600         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         40910099
384700     END-IF.                                                      40920099
384800                                                                  40930099
384900*----------------------------------------------------------------*40940099
385000* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *40950099
385100* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *40960099
385200* FOR THE SELECTED ITEMS QUEUE.                                  *40970099
385300*                                                                *40980099
385400* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *40990099
385500* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *41000099
385600* THE ARRAY IS FULL.                                             *41010099
385700*----------------------------------------------------------------*41020099
385800                                                                  41030099
385900 5000-PREPARE-SEL-QUEUE.                                          41040099
386000                                                                  41050099
386100     MOVE +1                   TO  ASC-BLK-SUB.                   41060099
386200     PERFORM 5100-WRITE-TEMP-STORAGE.                             41070099
386300     ADD +1                    TO  ASC-BLK-SUB.                   41080099
386400     PERFORM 5100-WRITE-TEMP-STORAGE.                             41090099
386500                                                                  41100099
386600     MOVE ASC-SEL-QUEUE-NAME   TO  SA004-SEL-QUEUE-NAME.          41110099
386700     PERFORM 6010-DELETE-SEL-QUEUE.                               41120099
386800                                                                  41130099
386900     SET ASC-UPDATE-TSQ        TO  TRUE.                          41140099
387000                                                                  41150099
387100     SET SA001-IDX             TO  1.                             41160099
387200     MOVE ZERO                 TO SA004-NUMBER-OF-TS-ITEMS.       41170099
387300     INITIALIZE SA001-SELECTED-ITEM-ARRAY.                        41180099
387400                                                                  41190099
387500     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           41200099
387600             VARYING PV-ITEM                                      41210099
387700             FROM 1 BY 1                                          41220099
387800             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     41230099
387900                                                                  41240099
388000     IF  SA001-IDX > 1                                            41250099
388100         PERFORM 5205-WRITE-SEL-QUEUE                             41260099
388200         ADD +1                TO SA004-NUMBER-OF-TS-ITEMS        41270099
388300     END-IF.                                                      41280099
388400                                                                  41290099
388500*----------------------------------------------------------------*41300099
388600*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *41310099
388700*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *41320099
388800*----------------------------------------------------------------*41330099
388900                                                                  41340099
389000 5100-WRITE-TEMP-STORAGE.                                         41350099
389100     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     41360099
389200                                   TO PV-LIST-ITEM-NUMBER.        41370099
389300     COMPUTE PV-BLOCK-NUMBER =                                    41380099
389400         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    41390099
389500                                                                  41400099
389600     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             41410099
389700     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             41420099
389800         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      41430099
389900             PERFORM 5105-REWRITE-ASC-LISTQ                       41440099
390000         END-IF                                                   41450099
390100     ELSE                                                         41460099
390200         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       41470099
390300         ASC-HIGHEST-BLOCK-WRITTEN + 1                            41480099
390400         PERFORM 5110-WRITE-ASC-LISTQ                             41490099
390500         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   41500099
390600     END-IF.                                                      41510099
390700                                                                  41520099
390800     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             41530099
390900*----------------------------------------------------------------*41540099
391000*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *41550099
391100*  SPECIFIC COMMAREA.                                            *41560099
391200*----------------------------------------------------------------*41570099
391300 5105-REWRITE-ASC-LISTQ.                                          41580099
391400     EXEC CICS                                                    41590099
391500         WRITEQ TS                                                41600099
391600             QUEUE (ASC-LIST-QUEUE-NAME)                          41610099
391700             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               41620099
391800             ITEM  (PV-BLOCK-NUMBER)                              41630099
391900             REWRITE                                              41640099
392000             RESP  (PV-CICS-RESP)                                 41650099
392100     END-EXEC.                                                    41660099
392200                                                                  41670099
392300     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           41680099
392400         CONTINUE                                                 41690099
392500     ELSE                                                         41700099
392600         SET DP013-CICS-ABEND            TO TRUE                  41710099
392700         SET DP013-NO-ROLLBACK           TO TRUE                  41720099
392800         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       41730099
392900         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     41740099
393000                                         TO DP013-MESSAGE-TEXT(1) 41750099
393100         PERFORM DP013-0000-PROCESS-ABEND                         41760099
393200     END-IF.                                                      41770099
393300                                                                  41780099
393400*----------------------------------------------------------------*41790099
393500*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *41800099
393600*  SPECIFIC COMMAREA.                                            *41810099
393700*----------------------------------------------------------------*41820099
393800 5110-WRITE-ASC-LISTQ.                                            41830099
393900     EXEC CICS                                                    41840099
394000         WRITEQ TS                                                41850099
394100             QUEUE (ASC-LIST-QUEUE-NAME)                          41860099
394200             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               41870099
394300             ITEM  (PV-BLOCK-NUMBER)                              41880099
394400             RESP  (PV-CICS-RESP)                                 41890099
394500     END-EXEC.                                                    41900099
394600     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      41910099
394700         SET DP013-CICS-ABEND      TO TRUE                        41920099
394800         SET DP013-NO-ROLLBACK     TO TRUE                        41930099
394900         MOVE '5110-WRITE-ASC-LISTQ'                              41940099
395000                                   TO DP013-PARAGRAPH             41950099
395100         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           41960099
395200                                   TO DP013-MESSAGE-TEXT(1)       41970099
395300         PERFORM DP013-0000-PROCESS-ABEND                         41980099
395400     END-IF.                                                      41990099
395500                                                                  42000099
395600*----------------------------------------------------------------*42010099
395700* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *42020099
395800* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *42030099
395900*----------------------------------------------------------------*42040099
396000                                                                  42050099
396100 5200-FILL-SEL-QUEUE-RECORD.                                      42060099
396200                                                                  42070099
396300     PERFORM 6112-READ-LIST-QUEUE.                                42080099
396400                                                                  42090099
396500     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       42100099
396600         PERFORM                                                  42110099
396700         VARYING LQW-IDX                                          42120099
396800         FROM 1 BY 1                                              42130099
396900         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            42140099
397000           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          42150099
397100                                                                  42160099
397200             IF  LQW-SELECT (LQW-IDX)                             42170099
397300                                                                  42180099
397400***  THE MOVE TO THE SALES DATE VARIABLE IS OK HERE BECSUE        42190099
397500***  ONLY ONE ITEM CAN BE SELECTED                                42200099
397600                                                                  42210099
397700                 MOVE LQW-SALES-DATE (LQW-IDX)                    42220099
397800                                   TO SA004-SALES-DATE-DISPLAY    42230099
397900                                      PV-SLS-DTE-FORMATTED        42240099
398000                 MOVE PV-SLS-DTE-FORMATTED-YYYY                   42250099
398100                                   TO PV-SLS-DTE-ISO-YYYY         42260099
398200                 MOVE PV-SLS-DTE-FORMATTED-MM                     42270099
398300                                   TO PV-SLS-DTE-ISO-MM           42280099
398400                 MOVE PV-SLS-DTE-FORMATTED-DD                     42290099
398500                                   TO PV-SLS-DTE-ISO-DD           42300099
398600                 MOVE PV-SLS-DTE-ISO                              42310099
398700                                   TO SA004-SALES-DATE-ISO        42320099
398800                 MOVE LQW-PARTITION-NBR (LQW-IDX)                 42330099
398900                                   TO SA001-PARTITION (SA001-IDX) 42340099
399000                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              42350099
399100                                   TO SA001-ITEM (SA001-IDX)      42360099
399200                 MOVE LQW-STORE (LQW-IDX)                         42370099
399300                                   TO SA001-STORE (SA001-IDX)     42380099
399400                 MOVE LQW-REGISTER (LQW-IDX)                      42390099
399500                                   TO SA001-REGISTER (SA001-IDX)  42400099
399600                 MOVE LQW-TRANSACTION (LQW-IDX)                   42410099
399700                                   TO SA001-TRANS (SA001-IDX)     42420099
399800                 MOVE LQW-START-TIME (LQW-IDX)                    42430099
399900                                   TO SA001-START-TIME            42440099
400000                                      (SA001-IDX)                 42450099
400100                 MOVE LQW-REGISTER-OPERATOR (LQW-IDX)             42460099
400200                                   TO SA001-ID (SA001-IDX)        42470099
400300                 MOVE LQW-TYPE (LQW-IDX)                          42480099
400400                                   TO SA001-TYPE (SA001-IDX)      42490099
400500                 MOVE LQW-SALES-CORR-SEQ-NBR (LQW-IDX)            42500099
400600                                   TO SA001-SALES-CORR-SEQ-NBR    42510099
400700                                       (SA001-IDX)                42520099
400800                 MOVE LQW-VOID-CODE (LQW-IDX)                     42530099
400900                                   TO SA001-VOID-ABRT-CDE         42540099
401000                                       (SA001-IDX)                42550099
401100                 MOVE LQW-STATUS (LQW-IDX)                        42560099
401200                                   TO SA001-TRAN-STAT-CDE         42570099
401300                                       (SA001-IDX)                42580099
401400                 MOVE SPACE        TO SA001-ACTION-SW (SA001-IDX) 42590099
401500                 SET SA001-UPD-TRAN (SA001-IDX)                   42600099
401600                                   TO TRUE                        42610099
401700                 SET SA001-IDX UP BY 1                            42620099
401800                 IF  SA001-IDX > SA001-MAX-ITEMS                  42630099
401900                     PERFORM 5205-WRITE-SEL-QUEUE                 42640099
402000                     ADD +1        TO SA004-NUMBER-OF-TS-ITEMS    42650099
402100                     INITIALIZE SA001-SELECTED-ITEM-ARRAY         42660099
402200                     SET SA001-IDX TO  1                          42670099
402300                 END-IF                                           42680099
402400             END-IF                                               42690099
402500         END-PERFORM                                              42700099
402600     END-IF.                                                      42710099
402700                                                                  42720099
402800*----------------------------------------------------------------*42730099
402900*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *42740099
403000*----------------------------------------------------------------*42750099
403100                                                                  42760099
403200 5205-WRITE-SEL-QUEUE.                                            42770099
403300                                                                  42780099
403400     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            42790099
403500                                   TO SA001-SELECTED-ITEMS.       42800099
403600                                                                  42810099
403700     EXEC CICS                                                    42820099
403800          WRITEQ TS                                               42830099
403900              QUEUE (ASC-SEL-QUEUE-NAME)                          42840099
404000              FROM  (SA001-TRANSACTION-SEL-REC)                   42850099
404100              ITEM  (PV-SEL-QUEUE-ITEM)                           42860099
404200              RESP  (PV-CICS-RESP)                                42870099
404300     END-EXEC.                                                    42880099
404400                                                                  42890099
404500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          42900099
404600         CONTINUE                                                 42910099
404700     ELSE                                                         42920099
404800         SET DP013-CICS-ABEND      TO TRUE                        42930099
404900         SET DP013-NO-ROLLBACK     TO TRUE                        42940099
405000         MOVE '5205-WRITE-SEL-QUEUE'                              42950099
405100                                   TO DP013-PARAGRAPH             42960099
405200         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          42970099
405300                                   TO DP013-MESSAGE-TEXT(1)       42980099
405400         PERFORM DP013-0000-PROCESS-ABEND                         42990099
405500     END-IF.                                                      43000099
405600                                                                  43010099
405700*----------------------------------------------------------------*43020099
405800*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *43030099
405900*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *43040099
406000*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *43050099
406100*  THE USER.                                                     *43060099
406200*----------------------------------------------------------------*43070099
406300 6000-REFRESH-PANEL-FROM-TEMP.                                    43080099
406400     IF  ASC-UPDATE-TSQ                                           43090099
406500         SET ASC-NO-TSQ-UPDATE TO TRUE                            43100099
406600         MOVE ZERO                 TO PV-SAVE-ITEM                43110099
406700                                      PV-SEL-QUEUE-ITEM           43120099
406800         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        43130099
406900                                   TO PV-HOLD-SELECTED-ITEMS      43140099
407000         MOVE +1                   TO PV-ITEMS-PROCESSED          43150099
407100         PERFORM 6100-UPDATE-TSQ                                  43160099
407200             UNTIL PV-ITEMS-PROCESSED >                           43170099
407300                                     PV-HOLD-SELECTED-ITEMS       43180099
407400         PERFORM 6010-DELETE-SEL-QUEUE                            43190099
407500         INITIALIZE ASC-BLOCK-ENTRIES (1)                         43200099
407600                    ASC-BLOCK-ENTRIES (2)                         43210099
407700     END-IF.                                                      43220099
407800                                                                  43230099
407900*----------------------------------------------------------------*43240099
408000*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *43250099
408100*----------------------------------------------------------------*43260099
408200 6010-DELETE-SEL-QUEUE.                                           43270099
408300                                                                  43280099
408400     EXEC CICS                                                    43290099
408500         DELETEQ TS                                               43300099
408600             QUEUE (ASC-SEL-QUEUE-NAME)                           43310099
408700             RESP  (PV-CICS-RESP)                                 43320099
408800     END-EXEC.                                                    43330099
408900                                                                  43340099
409000     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      43350099
409100        (PV-CICS-RESP = DFHRESP(QIDERR)))                         43360099
409200         CONTINUE                                                 43370099
409300     ELSE                                                         43380099
409400         SET DP013-CICS-ABEND TO TRUE                             43390099
409500         SET DP013-NO-ROLLBACK TO TRUE                            43400099
409600         MOVE '6010-DELETE-SEL-QUEUE'                             43410099
409700                        TO DP013-PARAGRAPH                        43420099
409800         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         43430099
409900                        TO DP013-MESSAGE-TEXT (1)                 43440099
410000         PERFORM DP013-0000-PROCESS-ABEND                         43450099
410100     END-IF.                                                      43460099
410200                                                                  43470099
410300*----------------------------------------------------------------*43480099
410400*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *43490099
410500*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *43500099
410600*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *43510099
410700*    THE TEMP QUEUE.                                             *43520099
410800*----------------------------------------------------------------*43530099
410900                                                                  43540099
411000 6100-UPDATE-TSQ.                                                 43550099
411100                                                                  43560099
411200     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             43570099
411300     PERFORM 6105-READ-SEL-QUEUE.                                 43580099
411400     PERFORM                                                      43590099
411500         VARYING SA001-IDX                                        43600099
411600         FROM 1 BY 1                                              43610099
411700         UNTIL ((PV-ITEMS-PROCESSED >                             43620099
411800                              PV-HOLD-SELECTED-ITEMS)             43630099
411900         OR (SA001-IDX GREATER THAN SA001-MAX-ITEMS))             43640099
412000         IF  SA001-ACTION-SW (SA001-IDX) > SPACE                  43650099
412100             PERFORM 6110-PROCESS-ITEMS                           43660099
412200         END-IF                                                   43670099
412300         ADD +1                TO PV-ITEMS-PROCESSED              43680099
412400     END-PERFORM.                                                 43690099
412500     PERFORM 6111-WRITE-LIST-QUEUE.                               43700099
412600*----------------------------------------------------------------*43710099
412700*    READ THE LIST QUEUE RECORD.                                 *43720099
412800*----------------------------------------------------------------*43730099
412900                                                                  43740099
413000 6105-READ-SEL-QUEUE.                                             43750099
413100                                                                  43760099
413200     EXEC CICS                                                    43770099
413300          READQ TS                                                43780099
413400              QUEUE (ASC-SEL-QUEUE-NAME)                          43790099
413500              INTO  (SA001-TRANSACTION-SEL-REC)                   43800099
413600              ITEM  (PV-SEL-QUEUE-ITEM)                           43810099
413700              RESP  (PV-CICS-RESP)                                43820099
413800     END-EXEC.                                                    43830099
413900                                                                  43840099
414000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          43850099
414100         CONTINUE                                                 43860099
414200     ELSE                                                         43870099
414300         SET DP013-CICS-ABEND      TO  TRUE                       43880099
414400         SET DP013-NO-ROLLBACK     TO  TRUE                       43890099
414500         MOVE '6105-READ-SEL-QUEUE'                               43900099
414600                                   TO  DP013-PARAGRAPH            43910099
414700         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           43920099
414800                                   TO  DP013-MESSAGE-TEXT(1)      43930099
414900         PERFORM DP013-0000-PROCESS-ABEND                         43940099
415000     END-IF.                                                      43950099
415100                                                                  43960099
415200*----------------------------------------------------------------*43970099
415300*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*43980099
415400*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*43990099
415500*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *44000099
415600*----------------------------------------------------------------*44010099
415700                                                                  44020099
415800 6110-PROCESS-ITEMS.                                              44030099
415900                                                                  44040099
416000     COMPUTE PV-ITEM = 1 + ((SA001-ITEM (SA001-IDX) - 1)          44050099
416100                     / PC-ITEMS-PER-PANEL).                       44060099
416200                                                                  44070099
416300     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           44080099
416400         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          44090099
416500             PERFORM 6111-WRITE-LIST-QUEUE                        44100099
416600         END-IF                                                   44110099
416700         MOVE PV-ITEM          TO PV-SAVE-ITEM                    44120099
416800                                                                  44130099
416900         PERFORM 6112-READ-LIST-QUEUE                             44140099
417000         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               44150099
417100             CONTINUE                                             44160099
417200         END-IF                                                   44170099
417300     END-IF.                                                      44180099
417400                                                                  44190099
417500     COMPUTE PV-SUB = (SA001-ITEM (SA001-IDX)                     44200099
417600                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              44210099
417700     SET LQW-DESELECT (PV-SUB) TO    TRUE                         44220099
417800     MOVE LQW-SELECTED-SW (PV-SUB)                                44230099
417900                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  44240099
418000     EVALUATE TRUE                                                44250099
418100         WHEN SA001-INQ (SA001-IDX)                               44260099
418200              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             44270099
418300                                                                  44280099
418400         WHEN SA001-UPD (SA001-IDX)                               44290099
418500              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             44300099
418600                                                                  44310099
418700         WHEN SA001-DEL (SA001-IDX)                               44320099
418800              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             44330099
418900                                                                  44340099
419000         WHEN SA001-ERR (SA001-IDX)                               44350099
419100              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             44360099
419200                                                                  44370099
419300         WHEN SA001-REV (SA001-IDX)                               44380099
419400              MOVE PC-REV      TO LQW-ACTION (PV-SUB)             44390099
419500     END-EVALUATE.                                                44400099
419600                                                                  44410099
419700     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                44420099
419800                                                                  44430099
419900*----------------------------------------------------------------*44440099
420000*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *44450099
420100*----------------------------------------------------------------*44460099
420200                                                                  44470099
420300 6111-WRITE-LIST-QUEUE.                                           44480099
420400                                                                  44490099
420500     EXEC CICS                                                    44500099
420600         WRITEQ TS                                                44510099
420700             QUEUE (ASC-LIST-QUEUE-NAME)                          44520099
420800             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     44530099
420900             ITEM  (PV-SAVE-ITEM)                                 44540099
421000             REWRITE                                              44550099
421100             RESP  (PV-CICS-RESP)                                 44560099
421200     END-EXEC.                                                    44570099
421300                                                                  44580099
421400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          44590099
421500         CONTINUE                                                 44600099
421600     ELSE                                                         44610099
421700         SET DP013-CICS-ABEND  TO  TRUE                           44620099
421800         SET DP013-NO-ROLLBACK TO  TRUE                           44630099
421900         MOVE '6111-WRITE-LIST-QUEUE'                             44640099
422000                               TO  DP013-PARAGRAPH                44650099
422100         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  44660099
422200                               TO  DP013-MESSAGE-TEXT(1)          44670099
422300         PERFORM DP013-0000-PROCESS-ABEND                         44680099
422400     END-IF.                                                      44690099
422500                                                                  44700099
422600                                                                  44710099
422700*----------------------------------------------------------------*44720099
422800*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*44730099
422900*----------------------------------------------------------------*44740099
423000                                                                  44750099
423100 6112-READ-LIST-QUEUE.                                            44760099
423200                                                                  44770099
423300     EXEC CICS                                                    44780099
423400         READQ TS                                                 44790099
423500             QUEUE (ASC-LIST-QUEUE-NAME)                          44800099
423600             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     44810099
423700             ITEM  (PV-ITEM)                                      44820099
423800             RESP  (PV-CICS-RESP)                                 44830099
423900     END-EXEC.                                                    44840099
424000                                                                  44850099
424100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          44860099
424200         CONTINUE                                                 44870099
424300     ELSE                                                         44880099
424400         SET DP013-CICS-ABEND        TO TRUE                      44890099
424500         SET DP013-NO-ROLLBACK       TO TRUE                      44900099
424600         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           44910099
424700         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    44920099
424800                                     TO DP013-MESSAGE-TEXT(1)     44930099
424900         PERFORM DP013-0000-PROCESS-ABEND                         44940099
425000     END-IF.                                                      44950099
425100                                                                  44960099
425200*----------------------------------------------------------------*44970099
425300*  IF THERE IS A DATE RANGE, MAKE SURE BOTH DATES ARE IN         *44980099
425400*  OPERATIONAL                                                   *44990099
425500*----------------------------------------------------------------*45000099
425600 7000-VALIDATE-DATE-RANGE.                                        45010099
425700                                                                  45020099
425800     SET PS-PARTITION-FOUND        TO TRUE.                       45030099
425900                                                                  45040099
426000     IF ASC-KEY-SALES-DATE-TO      > SPACES                       45050099
426100         SET PS-USE-DATE-RANGE     TO TRUE                        45060099
426200         PERFORM 7010-GET-FROM-DATE-STRUC                         45070099
426300         PERFORM 7020-GET-TO-DATE-STRUC                           45080099
428600         IF PS-PARTITION-NOT-FOUND                                45310099
427800             SET PS-COMMAREA-NOT-VALID                            45230099
427900                                   TO TRUE                        45240099
428000             MOVE PC-TSYMSG-02416  TO DP020-MSG-NUMBER            45250099
428100             SET DP020-MSG-FATAL   TO TRUE                        45260099
428200         END-IF                                                   45270099
428300     ELSE                                                         45280099
428400         SET PS-USE-ONE-DATE       TO TRUE                        45290099
428500         PERFORM 7010-GET-FROM-DATE-STRUC                         45300099
428600         IF PS-PARTITION-NOT-FOUND                                45310099
428700             SET PS-COMMAREA-NOT-VALID                            45320099
428800                                   TO TRUE                        45330099
428900             MOVE PC-TSYMSG-02416  TO DP020-MSG-NUMBER            45340099
429000             SET DP020-MSG-FATAL   TO TRUE                        45350099
430000         END-IF                                                   45450099
430100     END-IF.                                                      45460099
430200                                                                  45470099
430300*----------------------------------------------------------------*45480099
430400*  GET THE PARTITION NUMBER OF FROM DATE FROM THE PARTITON       *45490099
430500*  TABLE                                                         *45500099
430600*----------------------------------------------------------------*45510099
430700 7010-GET-FROM-DATE-STRUC.                                        45520099
430800                                                                  45530099
432400     EXEC SQL                                                     45690099
432500          SELECT PARTN_NBR                                        45700099
432700            INTO :ASC-KEY-FROM-PARTN-NBR                          45720099
432900            FROM TEPPART                                          45740099
433000           WHERE SLS_DTE          = :ASC-KEY-SALES-DATE-FROM      45750099
433100                 WITH UR                                          45760099
433200     END-EXEC.                                                    45770099
433400                                                                  45790099
433500     EVALUATE TRUE                                                45800099
433600         WHEN SQLCODE = ZERO                                      45810099
433700              CONTINUE                                            45820099
433800         WHEN SQLCODE = +100                                      45830099
433900              SET PS-PARTITION-NOT-FOUND                          45840099
434000                                   TO TRUE                        45850099
434100         WHEN SQLWARN0 NOT = SPACE                                45860099
434200         WHEN SQLCODE NOT = ZERO                                  45870099
434300              MOVE '7010-GET-FROM-DATE-STRUC'                     45880099
434400                               TO DP013-PARAGRAPH                 45890099
434500              MOVE 'GET FROM DATE TEPPART INFO '                  45900099
434600                               TO DP013-MESSAGE-TEXT (1)          45910099
434700              MOVE SQLCA       TO DP013-SQLCA                     45920099
434800              SET DP013-DB2-ABEND                                 45930099
434900                               TO TRUE                            45940099
435000              PERFORM DP013-0000-PROCESS-ABEND                    45950099
435100     END-EVALUATE.                                                45960099
435200                                                                  45970099
435300*----------------------------------------------------------------*45980099
430400*  GET THE PARTITION NUMBER OF TO DATE FROM THE PARTITON         *45490099
435500*  TABLE                                                         *46000099
435600*----------------------------------------------------------------*46010099
435700 7020-GET-TO-DATE-STRUC.                                          46020099
435800                                                                  46030099
435900     IF ASC-SAME-DATE-SW          = 'Y'                           46040099
436000        MOVE ASC-KEY-FROM-PARTN-NBR TO ASC-KEY-TO-PARTN-NBR       46050099
436200     ELSE                                                         46070099
436300        EXEC SQL                                                  46080099
436400             SELECT PARTN_NBR                                     46090099
436600               INTO :ASC-KEY-TO-PARTN-NBR                         46110099
436800               FROM TEPPART                                       46130099
436900              WHERE SLS_DTE = :ASC-KEY-SALES-DATE-TO              46140099
437000                    WITH UR                                       46150099
437100        END-EXEC                                                  46160099
437200                                                                  46170099
437300        EVALUATE TRUE                                             46180099
437400           WHEN SQLCODE = ZERO                                    46190099
437500                CONTINUE                                          46200099
437600           WHEN SQLCODE = +100                                    46210099
437700                SET PS-PARTITION-NOT-FOUND                        46220099
437800                                   TO TRUE                        46230099
437900           WHEN SQLWARN0 NOT = SPACE                              46240099
438000           WHEN SQLCODE NOT = ZERO                                46250099
438100                MOVE '7020-GET-TO-DATE-STRUC'                     46260099
438200                                   TO DP013-PARAGRAPH             46270099
438300                MOVE 'GET TO DATE TEPPART INFO '                  46280099
438400                                   TO DP013-MESSAGE-TEXT (1)      46290099
438500                MOVE SQLCA         TO DP013-SQLCA                 46300099
438600                SET DP013-DB2-ABEND                               46310099
438700                                   TO TRUE                        46320099
438800                PERFORM DP013-0000-PROCESS-ABEND                  46330099
438900        END-EVALUATE                                              46340099
439000     END-IF.                                                      46350099
439100                                                                  46360099
439200*----------------------------------------------------------------*46370099
439300*    ABEND PROCESSOR MODULE                                      *46380099
439400*----------------------------------------------------------------*46390099
439500                                                                  46400099
439600     COPY DPPD013.                                                46410099
