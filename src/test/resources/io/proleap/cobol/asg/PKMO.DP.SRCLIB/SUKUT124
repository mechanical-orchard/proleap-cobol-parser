000100 TITLE 'PURGE TSUCDOT ROWS'.                                      00010018
000200 IDENTIFICATION DIVISION.                                         00020018
000300 PROGRAM-ID.    SUKUT124.                                         00030018
000400 AUTHOR.        DENNIS STEFFEN.                                   00040018
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050018
000600 DATE-WRITTEN   DECEMBER 2008.                                    00060018
000700 DATE-COMPILED.                                                   00070018
000800 ENVIRONMENT DIVISION.                                            00080018
000900 CONFIGURATION SECTION.                                           00090018
001000 SOURCE-COMPUTER.        IBM-3090.                                00100018
001100 OBJECT-COMPUTER.        IBM-3090.                                00110018
001200                                                                  00120018
001300 INPUT-OUTPUT SECTION.                                            00130018
001400 FILE-CONTROL.                                                    00140018
001500                                                                  00150018
001600     SELECT INPUT-FILE                                            00160018
001700         ASSIGN TO INP01.                                         00170018
001800                                                                  00180018
001900 DATA DIVISION.                                                   00190018
002000 FILE SECTION.                                                    00200018
002100                                                                  00210018
002200 FD  INPUT-FILE                                                   00220018
002300     RECORDING MODE IS F                                          00230018
002400     LABEL RECORDS ARE STANDARD                                   00240018
002500     BLOCK CONTAINS 0 RECORDS.                                    00250018
002600                                                                  00260018
002700 01  INPUT-REC                        PIC X(020).                 00270018
002800/                                                                 00280018
002900 WORKING-STORAGE SECTION.                                         00290018
003000                                                                  00300018
003100*    DRIVER FILE FROM SUKUT127.                                   00310018
003200     COPY SURD054.                                                00320018
003300                                                                  00330018
003400     COPY DPWS004.                                                00340018
003500*                                                                 00350018
003600     EXEC SQL                                                     00360018
003700         INCLUDE TSUCDOT                                          00370018
003800     END-EXEC.                                                    00380018
003900                                                                  00390018
004000     EXEC SQL                                                     00400018
004100          INCLUDE SQLCA                                           00410018
004200     END-EXEC.                                                    00420018
004300                                                                  00430018
004400 01  ABEND-CODE                      PIC S9(04)    VALUE +0       00440018
004500                                                   COMP SYNC.     00450018
004600                                                                  00460018
004700 01  PS-PROGRAM-SWITCHES.                                         00470018
004800     05  PS-END-INPUT-SW              PIC  X(01) VALUE 'N'.       00480018
004900         88  PS-END-INPUT-YES                    VALUE 'Y'.       00490018
005000         88  PS-END-INPUT-NO                     VALUE 'N'.       00500018
005100     05  PS-END-OF-DRIVE-CSR-SW       PIC  X(01) VALUE 'N'.       00510018
005200         88  PS-END-DRIVE-CSR-YES                VALUE 'Y'.       00520018
005300         88  PS-END-DRIVE-CSR-NO                 VALUE 'N'.       00530018
005400                                                                  00540018
005500 01  PC-PROGRAM-CONSTANTS.                                        00550018
005600     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08) VALUE 'SUKUT124'. 00560018
005700                                                                  00570018
005800 01  DK-DB2-VARIABLES.                                            00580018
005900     05  DK-PURGE-DATE                PIC X(10).                  00590018
006000                                                                  00600018
006100 01  PV-PROGRAM-VARIABLES.                                        00610018
006200                                                                  00620018
006300     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  00630018
006400     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  00640018
006500     05  PV-DB2-OPERATION-MSG-1      PIC  X(40)    VALUE SPACES.  00650018
006600     05  PV-READ-COUNTER             PIC  S9(9) COMP.             00660018
006700     05  PV-ROWS-DELETED             PIC S9(07) COMP-3            00670018
006800                                                VALUE ZEROS.      00680018
006900     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.             00690018
007000     05  PV-FUNC-QTY                 PIC  S9(4) COMP.             00700018
007100     05  PV-OTBND-TRIP-ID-MSG.                                    00710018
007200         10  FILLER                  PIC  X(13)    VALUE          00720018
007300         'OTBND TRIP = '.                                         00730018
007400         10  PV-OTBND-TRIP-ID        PIC  9(15).                  00740018
007500/                                                                 00750018
007600 PROCEDURE DIVISION.                                              00760018
007700                                                                  00770018
007800     PERFORM 1000-INITIALIZE.                                     00780018
007900                                                                  00790018
008000     PERFORM 2000-PROCESS                                         00800018
008100             UNTIL PS-END-INPUT-YES                               00810018
008200                                                                  00820018
008300     PERFORM 9000-EOJ-ROUTINE.                                    00830018
008400                                                                  00840018
008500     GOBACK.                                                      00850018
008600/                                                                 00860018
008700 1000-INITIALIZE.                                                 00870018
008800                                                                  00880018
008900     OPEN INPUT INPUT-FILE                                        00890018
009000                                                                  00900018
009100     DISPLAY '* * * * * * * * * * * '.                            00910018
009200     DISPLAY 'CURRENT PROGRAM ' PC-CURRENT-PROGRAM-NAME.          00920018
009210     DISPLAY '*** TSUCDOT PURGE *** '.                            00921019
009220     DISPLAY '* * * * * * * * * * * '.                            00922019
009300                                                                  00930018
009400     PERFORM 8000-READ-SURD054-REC.                               00940018
009500                                                                  00950018
009600                                                                  00960018
009700 2000-PROCESS.                                                    00970018
009800                                                                  00980018
009900     MOVE SU054-OTBND-TRIP-ID         TO SUCDOT-OTBND-TRIP-ID     00990018
010000     PERFORM 7000-DELETE-TSUCDOT.                                 01000018
010100                                                                  01010018
010200     PERFORM 8000-READ-SURD054-REC.                               01020018
010300                                                                  01030018
010400                                                                  01040018
010500 7000-DELETE-TSUCDOT.                                             01050018
010600                                                                  01060018
010700     MOVE '7000-DELETE-TSUCDOT'       TO PV-PARAGRAPH-NAME.       01070018
010800                                                                  01080018
010900     EXEC SQL                                                     01090018
011000         DELETE                                                   01100018
011100             FROM TSUCDOT                                         01110018
011200         WHERE OTBND_TRIP_ID = :SUCDOT-OTBND-TRIP-ID              01120018
011300     END-EXEC.                                                    01130018
011400                                                                  01140018
011500     EVALUATE TRUE                                                01150018
011600         WHEN SQLCODE = ZERO                                      01160018
011700             ADD SQLERRD(3) TO PV-ROWS-DELETED                    01170018
011800             PERFORM 7100-COMMIT                                  01180018
011900         WHEN SQLCODE = +100                                      01190018
012000             CONTINUE                                             01200018
012100         WHEN SQLWARN0 NOT = SPACES                               01210018
012200         WHEN SQLCODE < ZERO                                      01220018
012300         WHEN SQLCODE > ZERO                                      01230018
012400             MOVE 'DELETE' TO PV-DB2-OPERATION-ATTEMPTED          01240018
012500             PERFORM 9100-SQL-ABEND                               01250018
012600     END-EVALUATE.                                                01260018
012700                                                                  01270018
012800 7100-COMMIT.                                                     01280018
012900                                                                  01290018
013000     EXEC SQL                                                     01300018
013100          COMMIT                                                  01310018
013200     END-EXEC                                                     01320018
013300                                                                  01330018
013400     IF SQLCODE = ZERO                                            01340018
013500         CONTINUE                                                 01350018
013600     ELSE                                                         01360018
013700         MOVE '7100-COMMIT'       TO PV-PARAGRAPH-NAME            01370018
013800         MOVE SU054-OTBND-TRIP-ID TO PV-OTBND-TRIP-ID             01380018
013900         MOVE PV-OTBND-TRIP-ID-MSG                                01390018
014000                                  TO PV-DB2-OPERATION-MSG-1       01400018
014100         MOVE 'COMMIT'            TO PV-DB2-OPERATION-ATTEMPTED   01410018
014200         PERFORM 9100-SQL-ABEND                                   01420018
014300     END-IF.                                                      01430018
014400*                                                                 01440018
014500                                                                  01450018
014600 8000-READ-SURD054-REC.                                           01460018
014700                                                                  01470018
014800     READ INPUT-FILE INTO                                         01480018
014900         SU054-EXTRACT-RECORD                                     01490018
015000     AT END                                                       01500018
015100         SET PS-END-INPUT-YES         TO TRUE                     01510018
015200     NOT AT END                                                   01520018
015300         ADD +1                       TO PV-READ-COUNTER          01530018
015400     END-READ.                                                    01540018
015500/                                                                 01550018
015600 9000-EOJ-ROUTINE.                                                01560018
015700                                                                  01570018
015800     CLOSE INPUT-FILE                                             01580018
015900                                                                  01590018
016000     MOVE PV-READ-COUNTER             TO PV-DISPLAY-COUNT.        01600018
016100     DISPLAY 'TOTAL RECORDS READ = ' PV-DISPLAY-COUNT.            01610018
016200                                                                  01620018
016300                                                                  01630018
016400     MOVE PV-ROWS-DELETED             TO PV-DISPLAY-COUNT.        01640018
016500     DISPLAY 'TOTAL ROWS DELETED = ' PV-DISPLAY-COUNT.            01650018
016600                                                                  01660018
016700     DISPLAY '* * * * * * * * * * * '.                            01670018
016800                                                                  01680018
016900 9100-SQL-ABEND.                                                  01690018
017000     DISPLAY '9100-SQL-ABEND'.                                    01700018
017100     DISPLAY '** ABEND     **'.                                   01710018
017200     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        01720018
017300     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              01730018
017400     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     01740018
017500     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-MSG-1.         01750018
017600                                                                  01760018
017700     COPY DPPD004.                                                01770018
017800                                                                  01780018
017900     MOVE +4013                  TO ABEND-CODE.                   01790018
018000     CALL 'ILBOABN0' USING ABEND-CODE.                            01800018
018100                                                                  01810018
