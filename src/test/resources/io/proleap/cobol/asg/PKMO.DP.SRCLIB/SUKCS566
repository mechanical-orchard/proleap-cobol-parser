000100 TITLE 'SU - STORE TRAILER CRIT SPEC'.                            00010006
000200 IDENTIFICATION DIVISION.                                         00020006
000300 PROGRAM-ID.    SUKCS566.                                         00030006
000400 AUTHOR.        DENNIS STEFFEN.                                   00040006
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050006
000600 DATE-WRITTEN.  AUTUMN 2001.                                      00060006
000700 DATE-COMPILED.                                                   00070006
000800*---------------------------------------------------------------  00080006
000900*    S566 - STORE TRAILER CRITERIA SPECIFICATION                  00090006
001000*---------------------------------------------------------------  00100006
263968* CHANGED 11/15/2021    BY JIM HUNTER      WR: CHG0263968         00102041
263968* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00103041
263968* MAKING THE CALL DYNAMIC VS STATIC.                              00104041
001130*                                                                 00104142
001110* CHANGED 01/09/2023    BY JEAN KURK       WR: CHG0278099         00104242
001120* CHANGE CALL OF DPKCS030 TO BE DYNAMIC                           00104342
263968*---------------------------------------------------------------* 00105041
001100                                                                  00110006
001200 ENVIRONMENT DIVISION.                                            00120006
001300                                                                  00130006
001400 DATA DIVISION.                                                   00140006
001500                                                                  00150006
001600 WORKING-STORAGE SECTION.                                         00160006
001700                                                                  00170006
001800 01  DK-DB2-KEYS.                                                 00180006
001900     05  DK-OPER-UNT-ID            PIC S9(04) COMP VALUE +0.      00190006
002000     05  DK-FCLTY-ID               PIC S9(04) COMP VALUE +0.      00200006
002100     05  DK-SCAC-ID                PIC  X(04)  VALUE SPACE.       00210006
002200     05  DK-TRIP-ID                PIC S9(09)  VALUE +0 COMP.     00220006
002300     05  DK-TRIP-STATUS            PIC  X(02)  VALUE SPACES.      00230006
002400     05  DK-TRLR-NBR               PIC  X(10)  VALUE SPACE.       00240006
002500     05  DK-REC-SEQ-NBR            PIC S9(09)  VALUE +0 COMP.     00250006
002600     05  DK-SERIAL-SHIP-CDE        PIC S9(18)V COMP-3.            00260006
002700                                                                  00270006
002800 01  PV-PROGRAM-VARIABLES.                                        00280006
002900     05  PV-LOCATION.                                             00290006
003000         10  FILLER                      PIC  X(01)  VALUE '0'.   00300006
003100         10  PV-DP020-LOCATION           PIC  X(03)  VALUE '000'. 00310006
003200     05  PV-LOCATION-N REDEFINES PV-LOCATION                      00320006
003300                                         PIC  9(04).              00330006
003400     05  PV-CICS-RESPONSE            PIC S9(04)  VALUE ZERO.      00340006
003500     05  PV-STATUS-COUNT              PIC S9(03) COMP-3           00350006
003600                                                 VALUE ZERO.      00360006
003601* DMH - 05/08/17 BEGIN                                            00360107
003602     05  PV-DC-OPEN-CNT                 PIC S9(09)  COMP.         00360207
003603     05  PV-DC-CLOSE-CNT                PIC S9(09)  COMP.         00360307
003604     05  PV-DC-SHIP-CNT                 PIC S9(09)  COMP.         00360407
003605     05  PV-STR-OPEN-CNT                PIC S9(09)  COMP.         00360507
003608     05  PV-DISP-TRLR-CNT               PIC ZZZ.                  00360818
003609     05  PV-DC-OPEN-DATE                PIC X(10).                00360918
003610     05  PV-DC-CLOSE-DATE               PIC X(10).                00361018
003611     05  PV-DC-SHIP-DATE                PIC X(10).                00361118
003612     05  PV-STR-OPEN-DATE               PIC X(10).                00361218
003613     05  PV-DC-OPEN-DAYS                PIC S9(04)  COMP.         00361326
003614     05  PV-DC-CLOSE-DAYS               PIC S9(04)  COMP.         00361426
003615     05  PV-DC-SHIP-DAYS                PIC S9(04)  COMP.         00361526
003616     05  PV-STR-OPEN-DAYS               PIC S9(04)  COMP.         00361626
003617     05  PV-DISP-DAYS                   PIC Z(04).                00361726
003618     05  PV-DC-SHIP-HIGH-DAYS           PIC S9(9) COMP.           00361830
003619     05  PV-STR-OPEN-HIGH-DAYS          PIC S9(9) COMP.           00361930
003620* DMH - 05/08/17 END                                              00362011
003700                                                                  00370006
003800 01  PC-PROGRAM-CONSTANTS.                                        00380006
003900     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE  'SU566A'.   00390006
004000     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE  'SUKM566 '. 00400006
004100     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE  'SUKCS566'. 00410006
004200     05  PC-LOCATION-MODULE        PIC  X(08)  VALUE  'XLKUT071'. 00420006
004300     05  PC-TSYMSG-NUMBERS.                                       00430006
004400         10  PC-TSYMSG-00005       PIC  9(05)  VALUE  00005.      00440006
004500         10  PC-TSYMSG-00007       PIC  9(05)  VALUE  00007.      00450006
004600         10  PC-TSYMSG-00008       PIC  9(05)  VALUE  00008.      00460006
004700         10  PC-TSYMSG-00009       PIC  9(05)  VALUE  00009.      00470006
004800         10  PC-TSYMSG-00308       PIC  9(05)  VALUE  00308.      00480006
004900         10  PC-TSYMSG-02294       PIC  9(05)  VALUE  02294.      00490006
005000         10  PC-TSYMSG-02805       PIC  9(05)  VALUE  02805.      00500006
005100         10  PC-TSYMSG-02806       PIC  9(05)  VALUE  02806.      00510006
005200         10  PC-TSYMSG-02810       PIC  9(05)  VALUE  02810.      00520006
005300*                                                                 00530006
005400                                                                  00540006
005500 01  PM-CICSAUTH-MESSAGE.                                         00550006
005600     05  FILLER                       PIC  X(36)     VALUE        00560006
005700         'INVALID RETURN CODE FROM CICSAUTH - '.                  00570006
005800     05  PM-CM-RETURN-CODE            PIC  9(04).                 00580006
005900                                                                  00590006
006000                                                                  00600006
006100 01  PS-PROGRAM-SWITCHES.                                         00610006
006200     05  PS-ERROR-SW               PIC  X(01)  VALUE  'N'.        00620006
006300         88  PS-ERROR                          VALUE  'Y'.        00630006
006400         88  PS-NO-ERROR                       VALUE  'N'.        00640006
006500     05  PS-TRAILER-EXISTS-SW      PIC  X(01)  VALUE  'N'.        00650006
006600         88  PS-TRAILER-EXISTS                 VALUE  'Y'.        00660006
006700         88  PS-TRAILER-DOESNT-EXIST           VALUE  'N'.        00670006
006800     05  PS-TRIP-EXISTS-SW         PIC  X(01)  VALUE  'N'.        00680006
006900         88  PS-TRIP-EXISTS                    VALUE  'Y'.        00690006
007000         88  PS-TRIP-DOESNT-EXIST              VALUE  'N'.        00700006
007100     05  PS-SCAC-EXISTS-SW         PIC  X(01)  VALUE  'N'.        00710006
007200         88  PS-SCAC-EXISTS                    VALUE  'Y'.        00720006
007300         88  PS-SCAC-DOESNT-EXIST              VALUE  'N'.        00730006
007400     05  PS-TRIP-STATUS-EXISTS-SW  PIC  X(01)  VALUE  'N'.        00740006
007500         88  PS-TRIP-STATUS-EXISTS             VALUE  'Y'.        00750006
007600         88  PS-NO-TRIP-STATUS                 VALUE  'N'.        00760006
007700     05  PS-PO-EXISTS-SW           PIC  X(01)  VALUE  'N'.        00770006
007800         88  PS-PO-EXISTS                      VALUE  'Y'.        00780006
007900         88  PS-PO-DOESNT-EXIST                VALUE  'N'.        00790006
008000     05  PS-RECEIVER-EXISTS-SW     PIC  X(01)  VALUE  'N'.        00800006
008100         88  PS-RECEIVER-EXISTS                VALUE  'Y'.        00810006
008200         88  PS-RECEIVER-DOESNT-EXIST          VALUE  'N'.        00820006
008300     05  PS-SHIP-CDE-EXISTS-SW     PIC  X(01)  VALUE  'N'.        00830006
008400         88  PS-SHIP-CDE-EXISTS                VALUE  'Y'.        00840006
008500         88  PS-SHIP-CDE-DOESNT-EXIST          VALUE  'N'.        00850006
008600     05  PS-DEPARTED-CHKD-SW       PIC  X(01)  VALUE  'N'.        00860006
008700         88  PS-DEPARTED-CHKD                  VALUE  'Y'.        00870006
008800         88  PS-DEPARTED-NOT-CHKD              VALUE  'N'.        00880006
008810     05  PS-DC-SHIP-HIGHLIGHT-SW   PIC  X(01)  VALUE  'N'.        00881030
008820         88  PS-DC-SHIP-HIGHLIGHT              VALUE  'Y'.        00882030
008830         88  PS-DC-SHIP-HIGHLIGHT-NO           VALUE  'N'.        00883030
008840     05  PS-STR-OPEN-HIGHLIGHT-SW  PIC  X(01)  VALUE  'N'.        00884030
008850         88  PS-STR-OPEN-HIGHLIGHT             VALUE  'Y'.        00885030
008860         88  PS-STR-OPEN-HIGHLIGHT-NO          VALUE  'N'.        00886030
008900                                                                  00890006
009000 01  PM-PROGRAM-MESSAGES.                                         00900006
009100     05  PM-ABEND-INFO-A.                                         00910006
009200         10  FILLER                PIC X(15)   VALUE              00920006
009300                                   'DP020-SRC-AID: '.             00930006
009400         10  PM-A-SRC-AID          PIC X(02)   VALUE  SPACE.      00940006
009500         10  FILLER                PIC X(19)   VALUE              00950006
009600                                   '. DP020-FK-ACTION: '.         00960006
009700         10  PM-A-FK-ACTION        PIC X(01)   VALUE  SPACE.      00970006
009800         10  FILLER                PIC X(22)   VALUE              00980006
009900                                   '. DP020-FK-DISPN-IND: '.      00990006
010000         10  PM-A-FK-DISPN         PIC X(01)   VALUE  SPACE.      01000006
010100         10  FILLER                PIC X(01)   VALUE '.'.         01010006
010200         10  FILLER                PIC X(19)   VALUE SPACE.       01020006
010300                                                                  01030006
010400                                                                  01040006
010500*    MAP LAYOUT                                                  *01050006
010600     COPY SUKM566.                                                01060006
010700/                                                                 01070006
010800*    RACF                                                         01080006
010900     COPY DPWS008.                                                01090006
011000                                                                  01100006
011100*    ATTRIBUTE SETTINGS                                           01110006
011200     COPY DPWS015.                                                01120006
011300                                                                  01130006
011400*    FUNCTION KEYS                                                01140006
011500     COPY DPWS016.                                                01150006
011600/                                                                 01160006
011700** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **01170006
011800** SUB-ROUTINE (DPKUT100).                                      **01180006
011900     COPY DPWS010I.                                               01190006
012000/                                                                 01200006
012200** PARAMETERS FOR CALLING CICS ARCHITECTURE API                 **01220042
012300     COPY DPWS030.                                                01230006
012300     COPY DPWS930.                                                01231042
012400/                                                                 01240006
012500*    STANDARD COMMAREA.                                           01250006
012600     COPY DPWS020.                                                01260006
012700     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01270006
012800                                                                  01280006
012900*    INTER-APPLICATION COMMAREA.                                  01290006
013000                                                                  01300006
013100         10  INTER-APPL-COMM-AREA PIC X(200).                     01310006
013200     COPY SUWS011.                                                01320006
013300         10  ASC-SPECIFIC-COMMAREA.                               01330006
013400             15  ASC-USER-TYPE               PIC X(02).           01340006
013500                 88  ASC-DISTRICT-MGR            VALUE 'DM'.      01350006
013600                 88  ASC-REGIONAL-MGR            VALUE 'RM'.      01360006
013700                 88  ASC-STORE-MGR               VALUE 'SM'.      01370006
013800                 88  ASC-OSA                     VALUE 'OS'.      01380006
013900                 88  ASC-NO-AUTH                 VALUE 'NA'.      01390006
014000             15  ASC-ACCESS-SW               PIC X(01).           01400006
014100                 88  ASC-ACCESS-ALLOWED          VALUE 'Y'.       01410006
014200                 88  ASC-ACCESS-DENIED           VALUE 'N'.       01420006
014300             15  ASC-STORE-NBR.                                   01430006
014400                 20  ASC-STORE-NBR-N         PIC 9(04).           01440006
014500             15  ASC-STORE-NAME              PIC X(25).           01450006
014600             15  ASC-OPER-UNT-ID             PIC 9(04).           01460006
014700             15  ASC-CURR-LOC-DIST-NBR       PIC X(02).           01470006
014800             15  ASC-SCREEN-DIST-NBR         PIC X(02).           01480006
014900             15  ASC-STATUS-OPEN-AT-DC       PIC X(01).           01490006
015000             15  ASC-STATUS-CLOSED-AT-DC     PIC X(01).           01500006
015100             15  ASC-STATUS-SHIPPED-FROM-DC  PIC X(01).           01510006
015200             15  ASC-STATUS-OPENED-AT-STORE  PIC X(01).           01520006
015300             15  ASC-STATUS-UNLOAD-AT-STORE  PIC X(01).           01530006
015400             15  ASC-HIST-FROM-DATE          PIC X(10).           01540006
015500             15  FILLER REDEFINES ASC-HIST-FROM-DATE.             01550006
015600                 20  ASC-HIST-FROM-MM        PIC XX.              01560006
015700                 20  FILLER                  PIC X.               01570006
015800                 20  ASC-HIST-FROM-DD        PIC XX.              01580006
015900                 20  FILLER                  PIC X.               01590006
016000                 20  ASC-HIST-FROM-CY        PIC X(04).           01600006
016100             15  ASC-HIST-TO-DATE.                                01610006
016200                 20  ASC-HIST-TO-MM          PIC XX.              01620006
016300                 20  FILLER                  PIC X.               01630006
016400                 20  ASC-HIST-TO-DD          PIC XX.              01640006
016500                 20  FILLER                  PIC X.               01650006
016600                 20  ASC-HIST-TO-CY          PIC X(04).           01660006
016610             15  ASC-STR-OPEN-GRTR-X-DAYS-SW  PIC X(01).          01661035
016611                 88  ASC-STR-OPEN-GRTR-X-DAYS     VALUE 'Y'.      01661134
016612                 88  ASC-STR-OPEN-GRTR-X-DAYS-NO  VALUE 'N'.      01661234
016620             15  ASC-DC-SHIP-GRTR-X-DAYS-SW   PIC X(01).          01662034
016630                 88  ASC-DC-SHIP-GRTR-X-DAYS      VALUE 'Y'.      01663034
016640                 88  ASC-DC-SHIP-GRTR-X-DAYS-NO   VALUE 'N'.      01664034
016700                                                                  01670006
016800*    LOCATION MODULE                                              01680006
016900     COPY XLWS071.                                                01690006
017000                                                                  01700006
017100*    ABEND PROCESSING                                             01710006
017200     COPY DPWS013.                                                01720006
017300                                                                  01730006
017400*    DATE ROUTINE WORK AREA                                       01740006
017500     COPY DPWS500.                                                01750006
017600                                                                  01760006
017700*  OUTBOUND TRIP                                                  01770008
017800*                                                                 01780006
017900     EXEC SQL                                                     01790006
018000         INCLUDE TSUOBTR                                          01800008
018100     END-EXEC.                                                    01810006
018101                                                                  01810108
018102*  OUTBOUND TRIP STATUS                                           01810208
018103*                                                                 01810308
018104     EXEC SQL                                                     01810408
018105         INCLUDE TSUOBTS                                          01810508
018106     END-EXEC.                                                    01810608
018107                                                                  01810708
018108*  PARAMETER TABLE                                                01810830
018109*                                                                 01810930
018110     EXEC SQL                                                     01811030
018111         INCLUDE TKRPRPM                                          01811130
018112     END-EXEC.                                                    01811230
018113                                                                  01811330
018114*  COMMUNICATION AREAS FOR DB2                                    01811408
018120*                                                                 01812008
018130     EXEC SQL                                                     01813008
018140         INCLUDE SQLCA                                            01814008
018150     END-EXEC.                                                    01815008
018200*----------------------------------------------------------------*01820006
018300 LINKAGE SECTION.                                                 01830006
018400                                                                  01840006
018500 01  DFHCOMMAREA.                                                 01850006
018600     05  FILLER                         OCCURS  1 TO 4072 TIMES   01860006
018700                                        DEPENDING ON EIBCALEN.    01870006
018800         10  FILLER                     PIC X.                    01880006
018900                                                                  01890006
019000                                                                  01900006
019100 PROCEDURE DIVISION.                                              01910006
019200***************************************************************** 01920006
019300** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 01930006
019400** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 01940006
019500** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 01950006
019600**                                                             ** 01960006
019700** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 01970006
019800** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 01980006
019900***************************************************************** 01990006
020000 0000-MAIN-MODULE.                                                02000006
020100     INITIALIZE DP030-CICS-API-FIELDS.                            02010006
020200     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       02020006
020300     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          02030006
020400     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         02040006
020500     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       02050006
020600     MOVE LENGTH OF SU566AI        TO DP030-MAP-LENGTH (1).       02060006
020700     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     02070006
020800     PERFORM 0001-CALL-CICS-ARCH-API.                             02080006
020900*                                                                 02090006
021000     PERFORM 1000-CONTROL-PROCESSING                              02100006
021100*                                                                 02110006
021200     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     02120006
021300     PERFORM 0001-CALL-CICS-ARCH-API.                             02130006
021400                                                                  02140006
021500 0001-CALL-CICS-ARCH-API.                                         02150006
021600*    CALL 'DPKCS030' USING DFHEIBLK                               02160042
021600     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      02161042
021700                           DFHCOMMAREA                            02170006
021800                           DP030-CICS-API-FIELDS                  02180006
021900                           DP020-STANDARD-COMMAREA                02190006
022000                           SU566AI.                               02200006
022100*                                                                 02210006
022200     IF  DP030-RC-CALL-SUCCESSFUL                                 02220006
022300         CONTINUE                                                 02230006
022400     ELSE                                                         02240006
022500         SET DP013-NO-ROLLBACK                                    02250006
022600             DP013-XCTL-DISPLAY-RESTART                           02260006
022700             DP013-CICS-ABEND      TO TRUE                        02270006
022800         MOVE 'BEFORE 0000-MAIN-MODULE'                           02280006
022900                                   TO DP013-PARAGRAPH             02290006
023000*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX02300042
023100*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      02310042
023000         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL. RETURN-CODE O02311042
023100-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      02312042
023200         MOVE DP030-RETURN-CODE                                   02320006
023300                                   TO DP013-MESSAGE-TEXT (3)      02330006
023400         PERFORM DP013-0000-PROCESS-ABEND                         02340006
023500     END-IF.                                                      02350006
023600 EJECT                                                            02360006
023700*----------------------------------------------------------------*02370006
023800*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *02380006
023900*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *02390006
024000*----------------------------------------------------------------*02400006
024100                                                                  02410006
024200 1000-CONTROL-PROCESSING.                                         02420006
024300                                                                  02430006
024400     EVALUATE TRUE                                                02440006
024500         WHEN DP020-NEXT-ACT-INITIAL                              02450006
024600         WHEN DP020-NEXT-ACT-RETURN                               02460006
024700             INITIALIZE ASC-SPECIFIC-COMMAREA                     02470006
024800             PERFORM 4000-BUILD-INITIAL-PANEL                     02480006
024900             PERFORM 3200-RESET-ATTRIBUTES                        02490006
025000                                                                  02500006
025100                                                                  02510006
025200         WHEN DP020-NEXT-ACT-READ-MAP                             02520006
025300             PERFORM 2000-FKEY-PROCESSING                         02530006
025400                                                                  02540006
025500         WHEN OTHER                                               02550006
025600             SET DP013-LOGIC-ABEND                                02560006
025700                 DP013-NO-ROLLBACK TO TRUE                        02570006
025800             MOVE '1000-CONTROL-PROCESSING'                       02580006
025900                                   TO  DP013-PARAGRAPH            02590006
026000             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   02600006
026100                                   TO  DP013-MESSAGE-TEXT(1)      02610006
026200             MOVE DP020-NEXT-APPL-ACTIVITY                        02620006
026300                                   TO DP013-MESSAGE-TEXT(2)       02630006
026400             PERFORM DP013-0000-PROCESS-ABEND                     02640006
026500     END-EVALUATE.                                                02650006
026600                                                                  02660006
026700*----------------------------------------------------------------*02670006
026800* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*02680006
026900* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*02690006
027000* EDITS.                                                         *02700006
027100*----------------------------------------------------------------*02710006
027200                                                                  02720006
027300 2000-FKEY-PROCESSING.                                            02730006
027400                                                                  02740006
027500     EVALUATE TRUE                                                02750006
027600                                                                  02760006
027700         WHEN DP020-SRC-AID = DP016-CLEAR                         02770006
027800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   02780006
027900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 02790006
028000                                                                  02800006
028100         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     02810006
028200             INITIALIZE ASC-SPECIFIC-COMMAREA                     02820006
028300             PERFORM 4000-BUILD-INITIAL-PANEL                     02830006
028400             PERFORM 3200-RESET-ATTRIBUTES                        02840006
028500                                                                  02850006
028600         WHEN OTHER                                               02860006
028700             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 02870006
028800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   02880006
028900             IF  PS-NO-ERROR                                      02890006
029000                 SET DP030-CONTINUE-GO TO TRUE                    02900006
029100                 PERFORM 2100-CHECK-FUNCTION-KEY                  02910006
029200             ELSE                                                 02920006
029300                 SET DP030-OVERRIDE-GO TO TRUE                    02930006
029400             END-IF                                               02940006
029500     END-EVALUATE.                                                02950006
029600******************************************************************02960006
029700** ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **02970006
029800** FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **02980006
029900** FROM THE CICS ARCHITECTURE API.                              **02990006
030000******************************************************************03000006
030100 2100-CHECK-FUNCTION-KEY.                                         03010006
030200     EVALUATE TRUE                                                03020006
030300         WHEN DP020-FK-DISPN-GO (DP020-SRC-AID)                   03030006
030400             PERFORM 2110-PREPARE-INTER-APPL-COMM                 03040006
030500                                                                  03050006
030600         WHEN DP020-SRC-AID = DP016-ENTER                         03060006
030700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03070006
030800                                                                  03080006
030900         WHEN OTHER                                               03090006
031000             SET DP013-NO-ROLLBACK                                03100006
031100                 DP013-XCTL-DISPLAY-RESTART                       03110006
031200                 DP013-CICS-ABEND  TO TRUE                        03120006
031300             MOVE '2100-CHECK-FUNCTION-KEY'                       03130006
031400                                   TO DP013-PARAGRAPH             03140006
031500             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      03150006
031600                                   TO DP013-MESSAGE-TEXT (1)      03160006
031700             MOVE 'OR CODE MISSING FROM THIS PROGRAM TO PROCESS:' 03170006
031800                                   TO DP013-MESSAGE-TEXT (2)      03180006
031900             MOVE DP020-SRC-AID    TO PM-A-SRC-AID                03190006
032000             MOVE DP020-FK-ACTION (DP020-SRC-AID)                 03200006
032100                                   TO PM-A-FK-ACTION              03210006
032200             MOVE DP020-FK-DISPN-IND (DP020-SRC-AID)              03220006
032300                                   TO PM-A-FK-DISPN               03230006
032400             MOVE PM-ABEND-INFO-A  TO DP013-MESSAGE-TEXT (3)      03240006
032500             MOVE 'REVIEW PFKEYS SETUP FOR THIS MNEMONIC.'        03250006
032600                                   TO DP013-MESSAGE-TEXT (4)      03260006
032700             PERFORM DP013-0000-PROCESS-ABEND                     03270006
032800     END-EVALUATE.                                                03280006
032900                                                                  03290006
033000******************************************************************03300006
033100** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **03310006
033200** INTER-APPLICATION COMMAREA.                                  **03320006
033300******************************************************************03330006
033400 2110-PREPARE-INTER-APPL-COMM.                                    03340006
033500     INITIALIZE SU011-INTER-APPL-COMMAREA                         03350006
033501                                                                  03350134
033700     MOVE ASC-OPER-UNT-ID             TO SU011-CURR-OPER-UNT-ID   03370006
033800     MOVE DP020-LOCATION-TYPE         TO SU011-CURR-LOC-TYPE-CODE 03380006
033900     MOVE ASC-CURR-LOC-DIST-NBR       TO SU011-CURR-LOC-DIST-NBR  03390006
034000     MOVE DP020-USERID                TO SU011-USER-ID            03400006
034100     MOVE ASC-USER-TYPE               TO SU011-USER-TYPE          03410006
034200     MOVE ASC-STORE-NBR-N             TO SU011-STR-NBR            03420006
034300     MOVE ASC-SCREEN-DIST-NBR         TO SU011-STR-DIST-NBR       03430006
034400     MOVE ASC-STORE-NAME              TO SU011-STR-NAME           03440006
034500     MOVE ASC-STATUS-OPEN-AT-DC       TO SU011-OPEN-AT-DC         03450006
034600     MOVE ASC-STATUS-CLOSED-AT-DC     TO SU011-DC-CLOSED          03460006
034700     MOVE ASC-STATUS-SHIPPED-FROM-DC  TO SU011-DC-SHIPPED         03470006
034800     MOVE ASC-STATUS-OPENED-AT-STORE  TO SU011-STR-OPEN           03480006
034900     MOVE ASC-STATUS-UNLOAD-AT-STORE  TO SU011-STR-UNLOADED       03490006
035000     MOVE ASC-HIST-FROM-CY           TO SU011-STR-UNLD-FROM-CCYY  03500006
035100     MOVE ASC-HIST-FROM-MM            TO SU011-STR-UNLD-FROM-MM   03510006
035200     MOVE ASC-HIST-FROM-DD            TO SU011-STR-UNLD-FROM-DD   03520006
035300     MOVE ASC-HIST-TO-CY              TO SU011-STR-UNLD-TO-CCYY   03530006
035400     MOVE ASC-HIST-TO-MM              TO SU011-STR-UNLD-TO-MM     03540006
035500     MOVE ASC-HIST-TO-DD              TO SU011-STR-UNLD-TO-DD.    03550006
035510     MOVE ASC-STR-OPEN-GRTR-X-DAYS-SW                             03551035
035520                                   TO SU011-STR-OPEN-X-DAYS-SW.   03552035
035540     MOVE ASC-DC-SHIP-GRTR-X-DAYS-SW                              03554035
035550                                   TO SU011-DC-SHIP-X-DAYS-SW.    03555035
035600/                                                                 03560006
035700 2200-MOVE-SCREEN-TO-COMMAREA.                                    03570006
035800     IF  ASTOREL > ZERO                                           03580006
035900         MOVE ASTOREI             TO ASC-STORE-NBR                03590006
036000     ELSE                                                         03600006
036100         IF ASTOREF = DP015-ERASE-EOF                             03610006
036200             MOVE SPACE            TO ASC-STORE-NBR               03620006
036300         END-IF                                                   03630006
036400     END-IF                                                       03640006
036500                                                                  03650006
036600     IF  AOPNDCL > ZERO                                           03660006
036700         MOVE AOPNDCI             TO ASC-STATUS-OPEN-AT-DC        03670006
036800     ELSE                                                         03680006
036900         IF AOPNDCF = DP015-ERASE-EOF                             03690006
037000             MOVE SPACE            TO ASC-STATUS-OPEN-AT-DC       03700006
037100         END-IF                                                   03710006
037200     END-IF                                                       03720006
037300                                                                  03730006
037400     IF  ACLSDCL > ZERO                                           03740006
037500         MOVE ACLSDCI             TO ASC-STATUS-CLOSED-AT-DC      03750006
037600     ELSE                                                         03760006
037700         IF ACLSDCF = DP015-ERASE-EOF                             03770006
037800             MOVE SPACE            TO ASC-STATUS-CLOSED-AT-DC     03780006
037900         END-IF                                                   03790006
038000     END-IF                                                       03800006
038100                                                                  03810006
038200     IF  ASHPDCL > ZERO                                           03820006
038300         MOVE ASHPDCI             TO ASC-STATUS-SHIPPED-FROM-DC   03830006
038400     ELSE                                                         03840006
038500         IF ASHPDCF = DP015-ERASE-EOF                             03850006
038600             MOVE SPACE            TO ASC-STATUS-SHIPPED-FROM-DC  03860006
038700         END-IF                                                   03870006
038800     END-IF                                                       03880006
038900                                                                  03890006
039000     IF  AOPNSTRL > ZERO                                          03900006
039100         MOVE AOPNSTRI            TO ASC-STATUS-OPENED-AT-STORE   03910006
039200     ELSE                                                         03920006
039300         IF AOPNSTRF = DP015-ERASE-EOF                            03930006
039400             MOVE SPACE            TO ASC-STATUS-OPENED-AT-STORE  03940006
039500         END-IF                                                   03950006
039600     END-IF                                                       03960006
039700                                                                  03970006
039800     IF  AUNLSTRL > ZERO                                          03980006
039900         MOVE AUNLSTRI               TO ASC-STATUS-UNLOAD-AT-STORE03990006
040000     ELSE                                                         04000006
040100         IF AUNLSTRF = DP015-ERASE-EOF                            04010006
040200             MOVE SPACE              TO ASC-STATUS-UNLOAD-AT-STORE04020006
040300         END-IF                                                   04030006
040400     END-IF                                                       04040006
040500                                                                  04050006
040600     IF  AFDTMML > ZERO                                           04060006
040700         MOVE AFDTMMI                 TO ASC-HIST-FROM-MM         04070006
040800     ELSE                                                         04080006
040900         IF AFDTMMF = DP015-ERASE-EOF                             04090006
041000             MOVE SPACE               TO ASC-HIST-FROM-MM         04100006
041100         END-IF                                                   04110006
041200     END-IF                                                       04120006
041300                                                                  04130006
041400     IF  AFDTDDL > ZERO                                           04140006
041500         MOVE AFDTDDI                 TO ASC-HIST-FROM-DD         04150006
041600     ELSE                                                         04160006
041700         IF AFDTDDF = DP015-ERASE-EOF                             04170006
041800             MOVE SPACE               TO ASC-HIST-FROM-DD         04180006
041900         END-IF                                                   04190006
042000     END-IF                                                       04200006
042100                                                                  04210006
042200     IF  AFDTCYL > ZERO                                           04220006
042300         MOVE AFDTCYI                 TO ASC-HIST-FROM-CY         04230006
042400     ELSE                                                         04240006
042500         IF AFDTCYF = DP015-ERASE-EOF                             04250006
042600             MOVE SPACE               TO ASC-HIST-FROM-CY         04260006
042700         END-IF                                                   04270006
042800     END-IF                                                       04280006
042900                                                                  04290006
043000     IF  ATDTMML > ZERO                                           04300006
043100         MOVE ATDTMMI                 TO ASC-HIST-TO-MM           04310006
043200     ELSE                                                         04320006
043300         IF ATDTMMF = DP015-ERASE-EOF                             04330006
043400             MOVE SPACE               TO ASC-HIST-TO-MM           04340006
043500         END-IF                                                   04350006
043600     END-IF                                                       04360006
043700                                                                  04370006
043800     IF  ATDTDDL > ZERO                                           04380006
043900         MOVE ATDTDDI                 TO ASC-HIST-TO-DD           04390006
044000     ELSE                                                         04400006
044100         IF ATDTDDF = DP015-ERASE-EOF                             04410006
044200             MOVE SPACE               TO ASC-HIST-TO-DD           04420006
044300         END-IF                                                   04430006
044400     END-IF                                                       04440006
044500                                                                  04450006
044600     IF  ATDTCYL > ZERO                                           04460006
044700         MOVE ATDTCYI                 TO ASC-HIST-TO-CY           04470006
044800     ELSE                                                         04480006
044900         IF ATDTCYF = DP015-ERASE-EOF                             04490006
045000             MOVE SPACE               TO ASC-HIST-TO-CY           04500006
045100         END-IF                                                   04510006
045200     END-IF.                                                      04520006
045210                                                                  04521030
045300/                                                                 04530006
045400 3000-EDIT-DATA-IN-COMMAREA.                                      04540006
045500     PERFORM 3200-RESET-ATTRIBUTES.                               04550006
045600     PERFORM 3005-EDIT-STORE.                                     04560006
045700     IF PS-NO-ERROR                                               04570006
045800         PERFORM 3006-EDIT-STATUS-FLAGS                           04580006
045900     END-IF.                                                      04590006
046000                                                                  04600006
046001     EVALUATE TRUE                                                04600140
046002              WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)         04600240
046003                   CONTINUE                                       04600340
046004              WHEN OTHER                                          04600440
046010                   PERFORM 4500-COUNT-TRAILER-STATUS              04601040
046011     END-EVALUATE.                                                04601140
046020                                                                  04602030
046100     IF PS-NO-ERROR AND ASC-STATUS-UNLOAD-AT-STORE = 'S'          04610006
046200         PERFORM 3007-EDIT-DATES                                  04620006
046300     END-IF.                                                      04630006
046400                                                                  04640006
046500                                                                  04650006
046600 3005-EDIT-STORE.                                                 04660006
046700     MOVE ASC-STORE-NBR               TO DP010I-UNEDITED-FIELD    04670006
046800     MOVE +4                          TO DP010I-MAXIMUM-DIGITS    04680006
046900     MOVE ZERO                        TO DP010I-MAXIMUM-DECIMALS  04690006
047000     SET DP010I-NEGATIVE-NOT-ALLOWED                              04700006
047100                                      TO TRUE                     04710006
047200                                                                  04720006
263968     CALL DP010I-NUMERIC-EDIT-ROUTINE                             04731041
263968          USING DP010I-NUMERIC-EDIT-AREA                          04732041
047400                                                                  04740006
047500     IF DP010I-NO-ERROR-DETECTED                                  04750006
047600         MOVE DP010I-NUMERIC-FIELD                                04760006
047700                                      TO DK-OPER-UNT-ID           04770006
047800                                         ASC-OPER-UNT-ID          04780006
047900                                         ASC-STORE-NBR-N          04790006
048000     ELSE                                                         04800006
048100         MOVE -1                      TO ASTOREL                  04810006
048200         MOVE DP015-RED               TO ASTOREC                  04820006
048300         MOVE PC-TSYMSG-00008         TO DP020-MSG-NUMBER         04830006
048400         SET DP020-MSG-FATAL                                      04840006
048500             DP030-SET-CURSOR-APPL-1                              04850006
048600             PS-ERROR                 TO TRUE                     04860006
048700     END-IF.                                                      04870006
048800                                                                  04880006
048900     IF PS-NO-ERROR                                               04890006
049000         IF ASC-OPER-UNT-ID = ZERO                                04900006
049100             MOVE -1                  TO ASTOREL                  04910006
049200             MOVE DP015-RED           TO ASTOREC                  04920006
049300             MOVE PC-TSYMSG-00007     TO DP020-MSG-NUMBER         04930006
049400             SET DP020-MSG-FATAL                                  04940006
049500                 DP030-SET-CURSOR-APPL-1                          04950006
049600                 PS-ERROR             TO TRUE                     04960006
049700         END-IF                                                   04970006
049800     END-IF.                                                      04980006
049900                                                                  04990006
050000     IF PS-NO-ERROR                                               05000006
050100         PERFORM 7000-GET-STORE-NAME                              05010006
050200         EVALUATE SQLCODE                                         05020006
050300         WHEN ZERO                                                05030006
050400             MOVE XL071-DIST-NBR           TO ASC-SCREEN-DIST-NBR 05040006
050500             MOVE XL071-LOC-NM             TO ASC-STORE-NAME      05050006
050600                                              SU011-STR-NAME      05060006
050700                                                                  05070006
050800*            IF ASC-REGIONAL-MGR                                  05080006
050900*                CONTINUE                                         05090006
051000*            ELSE                                                 05100006
051100*                IF ASC-SCREEN-DIST-NBR = ASC-CURR-LOC-DIST-NBR   05110006
051200*                    CONTINUE                                     05120006
051300*                ELSE                                             05130006
051400*                    MOVE -1                TO ASTOREL            05140006
051500*                    MOVE DP015-RED         TO ASTOREC            05150006
051600*                    MOVE PC-TSYMSG-02810   TO DP020-MSG-NUMBER   05160006
051700*                    SET DP020-MSG-FATAL                          05170006
051800*                        DP030-SET-CURSOR-APPL-1                  05180006
051900*                        PS-ERROR           TO TRUE               05190006
052000*                END-IF                                           05200006
052100*            END-IF                                               05210006
052200                                                                  05220006
052300         WHEN +100                                                05230006
052400             MOVE SPACES              TO ASC-STORE-NAME           05240006
052500                                         ASC-SCREEN-DIST-NBR      05250006
052600                                         ASTNMEO                  05260006
052700             MOVE -1                  TO ASTOREL                  05270006
052800             MOVE DP015-RED           TO ASTOREC                  05280006
052900             MOVE PC-TSYMSG-02294     TO DP020-MSG-NUMBER         05290006
053000             SET DP020-MSG-FATAL                                  05300006
053100                 DP030-SET-CURSOR-APPL-1                          05310006
053200                 PS-ERROR             TO TRUE                     05320006
053300         END-EVALUATE                                             05330006
053400     END-IF.                                                      05340006
053500                                                                  05350006
053600 3006-EDIT-STATUS-FLAGS.                                          05360006
053700                                                                  05370006
053800                                                                  05380006
053900     IF ASC-STATUS-UNLOAD-AT-STORE = 'S' OR SPACE                 05390006
054000         CONTINUE                                                 05400006
054100     ELSE                                                         05410006
054200         MOVE -1                  TO AUNLSTRL                     05420006
054300         MOVE DP015-RED           TO AUNLSTRC                     05430006
054400         MOVE PC-TSYMSG-00005     TO DP020-MSG-NUMBER             05440006
054500         SET DP020-MSG-FATAL                                      05450006
054600             DP030-SET-CURSOR-APPL-1                              05460006
054700             PS-ERROR             TO TRUE                         05470006
054800     END-IF                                                       05480006
054900                                                                  05490006
055000     IF ASC-STATUS-OPENED-AT-STORE = 'S' OR SPACE                 05500006
055100         CONTINUE                                                 05510006
055200     ELSE                                                         05520006
055300         MOVE -1                  TO AOPNSTRL                     05530006
055400         MOVE DP015-RED           TO AOPNSTRC                     05540006
055500         MOVE PC-TSYMSG-00005     TO DP020-MSG-NUMBER             05550006
055600         SET DP020-MSG-FATAL                                      05560006
055700             DP030-SET-CURSOR-APPL-1                              05570006
055800             PS-ERROR             TO TRUE                         05580006
055900     END-IF                                                       05590006
056000                                                                  05600006
056100     IF ASC-STATUS-SHIPPED-FROM-DC = 'S' OR SPACE                 05610006
056200         CONTINUE                                                 05620006
056300     ELSE                                                         05630006
056400         MOVE -1                  TO ASHPDCL                      05640006
056500         MOVE DP015-RED           TO ASHPDCC                      05650006
056600         MOVE PC-TSYMSG-00005     TO DP020-MSG-NUMBER             05660006
056700         SET DP020-MSG-FATAL                                      05670006
056800             DP030-SET-CURSOR-APPL-1                              05680006
056900             PS-ERROR             TO TRUE                         05690006
057000     END-IF                                                       05700006
057100                                                                  05710006
057200     IF ASC-STATUS-CLOSED-AT-DC = 'S' OR SPACE                    05720006
057300         CONTINUE                                                 05730006
057400     ELSE                                                         05740006
057500         MOVE -1                  TO ACLSDCL                      05750006
057600         MOVE DP015-RED           TO ACLSDCC                      05760006
057700         MOVE PC-TSYMSG-00005     TO DP020-MSG-NUMBER             05770006
057800         SET DP020-MSG-FATAL                                      05780006
057900             DP030-SET-CURSOR-APPL-1                              05790006
058000             PS-ERROR             TO TRUE                         05800006
058100     END-IF                                                       05810006
058200                                                                  05820006
058300     IF ASC-STATUS-OPEN-AT-DC  = 'S' OR SPACE                     05830006
058400         CONTINUE                                                 05840006
058500     ELSE                                                         05850006
058600         MOVE -1                  TO AOPNDCL                      05860006
058700         MOVE DP015-RED           TO AOPNDCC                      05870006
058800         MOVE PC-TSYMSG-00005     TO DP020-MSG-NUMBER             05880006
058900         SET DP020-MSG-FATAL                                      05890006
059000             DP030-SET-CURSOR-APPL-1                              05900006
059100             PS-ERROR             TO TRUE                         05910006
059200     END-IF.                                                      05920006
059300                                                                  05930006
059400     IF PS-NO-ERROR                                               05940006
059500         IF ASC-STATUS-OPENED-AT-STORE = 'S'                      05950006
059600             ADD 1                    TO PV-STATUS-COUNT          05960006
059700         END-IF                                                   05970006
059800         IF ASC-STATUS-SHIPPED-FROM-DC = 'S'                      05980006
059900             ADD 1                    TO PV-STATUS-COUNT          05990006
060000         END-IF                                                   06000006
060100         IF ASC-STATUS-CLOSED-AT-DC = 'S'                         06010006
060200             ADD 1                    TO PV-STATUS-COUNT          06020006
060300         END-IF                                                   06030006
060400         IF ASC-STATUS-OPEN-AT-DC  = 'S'                          06040006
060500             ADD 1                    TO PV-STATUS-COUNT          06050006
060600         END-IF                                                   06060006
060700         IF ASC-STATUS-UNLOAD-AT-STORE = 'S'                      06070006
060800             ADD 1                    TO PV-STATUS-COUNT          06080006
060900         END-IF                                                   06090006
061000     END-IF                                                       06100006
061100                                                                  06110006
061200* NO STATUSES WERE SELECTED                                       06120006
061300     IF PS-NO-ERROR                                               06130006
061400         IF PV-STATUS-COUNT = ZERO                                06140006
061500             MOVE -1              TO AOPNDCL                      06150006
061600             MOVE DP015-RED       TO AOPNDCC                      06160006
061700             MOVE PC-TSYMSG-00308 TO DP020-MSG-NUMBER             06170006
061800             SET DP020-MSG-FATAL                                  06180006
061900                 DP030-SET-CURSOR-APPL-1                          06190006
062000                 PS-ERROR         TO TRUE                         06200006
062100         END-IF                                                   06210006
062200     END-IF.                                                      06220006
062300                                                                  06230006
062400                                                                  06240006
062500* OPENED AT STORE FLAG CANNOT BE USED WITH ANY OTHERS             06250006
062600     IF PS-NO-ERROR                                               06260006
062700     IF ASC-STATUS-OPENED-AT-STORE = 'S' OR                       06270006
062800        ASC-STATUS-SHIPPED-FROM-DC = 'S' OR                       06280006
062900           ASC-STATUS-CLOSED-AT-DC = 'S' OR                       06290006
063000            ASC-STATUS-OPEN-AT-DC  = 'S'                          06300006
063100         IF ASC-STATUS-UNLOAD-AT-STORE = 'S'                      06310006
063200             SET DP020-MSG-FATAL                                  06320006
063300                 DP030-SET-CURSOR-APPL-1                          06330006
063400                 PS-ERROR         TO TRUE                         06340006
063500             MOVE PC-TSYMSG-02805 TO DP020-MSG-NUMBER             06350006
063600             EVALUATE TRUE                                        06360006
063700                WHEN ASC-STATUS-OPEN-AT-DC  = 'S'                 06370006
063800                   MOVE -1        TO AOPNDCL                      06380006
063900                   MOVE DP015-RED TO AOPNDCC                      06390006
064000                WHEN ASC-STATUS-CLOSED-AT-DC = 'S'                06400006
064100                   MOVE -1        TO ACLSDCL                      06410006
064200                   MOVE DP015-RED TO ACLSDCC                      06420006
064300                WHEN ASC-STATUS-SHIPPED-FROM-DC = 'S'             06430006
064400                   MOVE -1        TO ASHPDCL                      06440006
064500                   MOVE DP015-RED TO ASHPDCC                      06450006
064600                WHEN ASC-STATUS-OPENED-AT-STORE = 'S'             06460006
064700                   MOVE -1        TO AOPNSTRL                     06470006
064800                   MOVE DP015-RED TO AOPNSTRC                     06480006
064900             END-EVALUATE                                         06490006
065000         END-IF                                                   06500006
065100     END-IF                                                       06510006
065200     END-IF.                                                      06520006
065300                                                                  06530006
065400 3007-EDIT-DATES.                                                 06540006
065500     IF ASC-HIST-FROM-MM = SPACES                                 06550006
065600         MOVE -1                      TO AFDTMML                  06560006
065700         MOVE DP015-RED               TO AFDTMMC                  06570006
065800         SET DP020-MSG-FATAL                                      06580006
065900             DP030-SET-CURSOR-APPL-1                              06590006
066000             PS-ERROR                 TO TRUE                     06600006
066100             MOVE PC-TSYMSG-00007     TO DP020-MSG-NUMBER         06610006
066200     END-IF                                                       06620006
066300                                                                  06630006
066400     IF ASC-HIST-FROM-DD = SPACES                                 06640006
066500         MOVE -1                      TO AFDTDDL                  06650006
066600         MOVE DP015-RED               TO AFDTDDC                  06660006
066700         SET DP020-MSG-FATAL                                      06670006
066800             DP030-SET-CURSOR-APPL-1                              06680006
066900             PS-ERROR                 TO TRUE                     06690006
067000             MOVE PC-TSYMSG-00007     TO DP020-MSG-NUMBER         06700006
067100     END-IF                                                       06710006
067200                                                                  06720006
067300     IF ASC-HIST-FROM-CY = SPACES                                 06730006
067400         MOVE -1                      TO AFDTCYL                  06740006
067500         MOVE DP015-RED               TO AFDTCYC                  06750006
067600         SET DP020-MSG-FATAL                                      06760006
067700             DP030-SET-CURSOR-APPL-1                              06770006
067800             PS-ERROR                 TO TRUE                     06780006
067900             MOVE PC-TSYMSG-00007     TO DP020-MSG-NUMBER         06790006
068000     END-IF                                                       06800006
068100                                                                  06810006
068200     IF ASC-HIST-TO-MM = SPACES                                   06820006
068300         MOVE -1                      TO ATDTMML                  06830006
068400         MOVE DP015-RED               TO ATDTMMC                  06840006
068500         SET DP020-MSG-FATAL                                      06850006
068600             DP030-SET-CURSOR-APPL-1                              06860006
068700             PS-ERROR                 TO TRUE                     06870006
068800             MOVE PC-TSYMSG-00007     TO DP020-MSG-NUMBER         06880006
068900     END-IF                                                       06890006
069000                                                                  06900006
069100     IF ASC-HIST-TO-DD = SPACES                                   06910006
069200         MOVE -1                      TO ATDTDDL                  06920006
069300         MOVE DP015-RED               TO ATDTDDC                  06930006
069400         SET DP020-MSG-FATAL                                      06940006
069500             DP030-SET-CURSOR-APPL-1                              06950006
069600             PS-ERROR                 TO TRUE                     06960006
069700             MOVE PC-TSYMSG-00007     TO DP020-MSG-NUMBER         06970006
069800     END-IF                                                       06980006
069900                                                                  06990006
070000     IF ASC-HIST-TO-CY = SPACES                                   07000006
070100         MOVE -1                      TO ATDTCYL                  07010006
070200         MOVE DP015-RED               TO ATDTCYC                  07020006
070300         SET DP020-MSG-FATAL                                      07030006
070400             DP030-SET-CURSOR-APPL-1                              07040006
070500             PS-ERROR                 TO TRUE                     07050006
070600             MOVE PC-TSYMSG-00007     TO DP020-MSG-NUMBER         07060006
070700     END-IF.                                                      07070006
070800                                                                  07080006
070900     IF PS-NO-ERROR                                               07090006
071000         PERFORM 3007A-VALIDATE-DATES                             07100006
071100     END-IF.                                                      07110006
071200                                                                  07120006
071300     IF PS-NO-ERROR                                               07130006
071400         PERFORM 3007B-COMPARE-DATES                              07140006
071500     END-IF.                                                      07150006
071600                                                                  07160006
071700 3007A-VALIDATE-DATES.                                            07170006
071800     INITIALIZE DPG51 DPG52                                       07180006
071900                DPG53 DPG54                                       07190006
072000                DPG55 DPG56.                                      07200006
072100                                                                  07210006
072200     STRING                                                       07220006
072300         ASC-HIST-FROM-CY                                         07230006
072400         ASC-HIST-FROM-MM                                         07240006
072500         ASC-HIST-FROM-DD DELIMITED BY SIZE                       07250006
072600                                      INTO DPG52-LK-DATE-INPUT    07260006
072700                                                                  07270006
072800     SET DPG51-DO-NOT-INCR-DECR-DATE                              07280006
072900         DPG51-ACTUAL-CALENDAR-ONLY                               07290006
073000         DPG52-LK-DTE-ISO             TO TRUE                     07300006
073100                                                                  07310006
073200     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52          07320006
073300                                             DPG53 DPG54          07330006
073400                                             DPG55 DPG56.         07340006
073500     IF DPG54-DATE-INVALID                                        07350006
073600         MOVE -1                      TO AFDTMML                  07360006
073700         MOVE DP015-RED               TO AFDTMMC                  07370006
073800                                         AFDTDDC                  07380006
073900                                         AFDTCYC                  07390006
074000         SET DP020-MSG-FATAL                                      07400006
074100             DP030-SET-CURSOR-APPL-1                              07410006
074200             PS-ERROR                 TO TRUE                     07420006
074300             MOVE PC-TSYMSG-00009     TO DP020-MSG-NUMBER         07430006
074400     END-IF.                                                      07440006
074500                                                                  07450006
074600     INITIALIZE DPG51 DPG52                                       07460006
074700                DPG53 DPG54                                       07470006
074800                DPG55 DPG56.                                      07480006
074900                                                                  07490006
075000     STRING                                                       07500006
075100         ASC-HIST-TO-CY                                           07510006
075200         ASC-HIST-TO-MM                                           07520006
075300         ASC-HIST-TO-DD DELIMITED BY SIZE                         07530006
075400                                      INTO DPG52-LK-DATE-INPUT    07540006
075500                                                                  07550006
075600     SET DPG51-DO-NOT-INCR-DECR-DATE                              07560006
075700         DPG51-ACTUAL-CALENDAR-ONLY                               07570006
075800         DPG52-LK-DTE-ISO             TO TRUE                     07580006
075900                                                                  07590006
076000     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52          07600006
076100                                             DPG53 DPG54          07610006
076200                                             DPG55 DPG56.         07620006
076300     IF DPG54-DATE-INVALID                                        07630006
076400         MOVE -1                      TO ATDTMML                  07640006
076500         MOVE DP015-RED               TO ATDTMMC                  07650006
076600                                         ATDTDDC                  07660006
076700                                         ATDTCYC                  07670006
076800         SET DP020-MSG-FATAL                                      07680006
076900             DP030-SET-CURSOR-APPL-1                              07690006
077000             PS-ERROR                 TO TRUE                     07700006
077100             MOVE PC-TSYMSG-00009     TO DP020-MSG-NUMBER         07710006
077200     END-IF.                                                      07720006
077300                                                                  07730006
077400 3007B-COMPARE-DATES.                                             07740006
077500                                                                  07750006
077600     INITIALIZE DPG51 DPG52                                       07760006
077700                DPG53 DPG54                                       07770006
077800                DPG55 DPG56.                                      07780006
077900                                                                  07790006
078000     STRING                                                       07800006
078100         ASC-HIST-TO-CY                                           07810006
078200         ASC-HIST-TO-MM                                           07820006
078300         ASC-HIST-TO-DD DELIMITED BY SIZE                         07830006
078400                                      INTO DPG52-LK-DATE-INPUT    07840006
078500                                                                  07850006
078600     STRING                                                       07860006
078700         ASC-HIST-FROM-CY                                         07870006
078800         ASC-HIST-FROM-MM                                         07880006
078900         ASC-HIST-FROM-DD DELIMITED BY SIZE                       07890006
079000                          INTO DPG53-LK-CMPR-DATE-INPUT           07900006
079100                                                                  07910006
079200     SET DPG51-DO-NOT-INCR-DECR-DATE                              07920006
079300         DPG51-ACTUAL-CALENDAR-ONLY                               07930006
079400         DPG52-LK-DTE-ISO                                         07940006
079500         DPG53-LK-CMPR-DTE-ISO        TO TRUE                     07950006
079600                                                                  07960006
079700     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52          07970006
079800                                             DPG53 DPG54          07980006
079900                                             DPG55 DPG56.         07990006
080000     IF DPG54-CMPR-DATE-VALID                                     08000006
080100         IF DPG55-DAYS-DIFFERENCE < ZERO                          08010006
080200         MOVE -1                      TO AFDTMML                  08020006
080300         MOVE DP015-RED               TO ATDTMMC                  08030006
080400                                         ATDTDDC                  08040006
080500                                         ATDTCYC                  08050006
080600                                         AFDTMMC                  08060006
080700                                         AFDTDDC                  08070006
080800                                         AFDTCYC                  08080006
080900         SET DP020-MSG-FATAL                                      08090006
081000             DP030-SET-CURSOR-APPL-1                              08100006
081100             PS-ERROR                 TO TRUE                     08110006
081200             MOVE PC-TSYMSG-02806     TO DP020-MSG-NUMBER         08120006
081300         END-IF                                                   08130006
081400     END-IF.                                                      08140006
081500                                                                  08150006
081600/                                                                 08160006
081700******************************************************************08170006
081800** MOVE THE DEFAULT ATTRIBUTES TO ALL OF THE OPEN FIELDS ON THE **08180006
081900** MAP.                                                         **08190006
082000******************************************************************08200006
082100 3200-RESET-ATTRIBUTES.                                           08210006
082200     MOVE DP015-UNP-ALP-NOR-OFF       TO ASTOREA                  08220006
082300     MOVE DP015-GREEN                 TO ASTOREC                  08230006
082400     MOVE DP015-UNDERLINE             TO ASTOREH                  08240006
082500                                                                  08250006
082600     IF DP020-LOCATION-TYPE = 'DS'                                08260006
082700         IF ASC-DISTRICT-MGR OR ASC-REGIONAL-MGR                  08270006
082800             CONTINUE                                             08280006
082900         ELSE                                                     08290006
083000             MOVE DP015-ASK-NOR-OFF   TO ASTOREA                  08300006
083100             MOVE DP015-BLUE          TO ASTOREC                  08310006
083200         END-IF                                                   08320006
083300     END-IF.                                                      08330006
083400                                                                  08340006
083500     MOVE DP015-UNP-ALP-NOR-OFF       TO AOPNDCA                  08350006
083600                                         ACLSDCA                  08360006
083700                                         ASHPDCA                  08370006
083800                                         AOPNSTRA                 08380006
083900                                         AUNLSTRA                 08390006
084000                                         AFDTMMA                  08400006
084100                                         AFDTDDA                  08410006
084200                                         AFDTCYA                  08420006
084300                                         ATDTMMA                  08430006
084400                                         ATDTDDA                  08440006
084500                                         ATDTCYA                  08450006
084600     MOVE DP015-GREEN                 TO AOPNDCC                  08460006
084700                                         ACLSDCC                  08470006
084800                                         ASHPDCC                  08480006
084900                                         AOPNSTRC                 08490006
085000                                         AUNLSTRC                 08500006
085100                                         AFDTMMC                  08510006
085200                                         AFDTDDC                  08520006
085300                                         AFDTCYC                  08530006
085400                                         ATDTMMC                  08540006
085500                                         ATDTDDC                  08550006
085600                                         ATDTCYC                  08560006
085700     MOVE DP015-UNDERLINE             TO AOPNDCH                  08570006
085800                                         ACLSDCH                  08580006
085900                                         ASHPDCH                  08590006
086000                                         AOPNSTRH                 08600006
086100                                         AUNLSTRH                 08610006
086200                                         AFDTMMH                  08620006
086300                                         AFDTDDH                  08630006
086400                                         AFDTCYH                  08640006
086500                                         ATDTMMH                  08650006
086600                                         ATDTDDH                  08660006
086700                                         ATDTCYH.                 08670006
086800/                                                                 08680006
086900 4000-BUILD-INITIAL-PANEL.                                        08690006
087000     SET DP030-SET-CURSOR-APPL-1      TO TRUE                     08700006
087100     MOVE DP020-LOCATION-NBR          TO ASTOREO                  08710006
087200                                         DK-OPER-UNT-ID           08720006
087300                                         ASC-OPER-UNT-ID          08730006
087400                                         ASC-STORE-NBR-N          08740006
087500     PERFORM 7000-GET-STORE-NAME.                                 08750006
087600     MOVE XL071-LOC-NM                TO ASTNMEO                  08760006
087700                                         ASC-STORE-NAME           08770006
087800                                         SU011-STR-NAME           08780006
087900     MOVE XL071-DIST-NBR              TO ASC-CURR-LOC-DIST-NBR    08790006
088000                                                                  08800006
088100     PERFORM 4010-IS-USER-DMM.                                    08810006
088200     IF DP008-ACCESS-ALLOWED                                      08820006
088300         SET ASC-ACCESS-ALLOWED                                   08830006
088400             ASC-DISTRICT-MGR         TO TRUE                     08840006
088500     ELSE                                                         08850006
088600         PERFORM 4020-IS-USER-STR-MGR                             08860006
088700         IF DP008-ACCESS-ALLOWED                                  08870006
088800             SET ASC-ACCESS-ALLOWED                               08880006
088900                 ASC-STORE-MGR        TO TRUE                     08890006
089000         ELSE                                                     08900006
089100             PERFORM 4030-IS-USER-OSA                             08910006
089200             IF DP008-ACCESS-ALLOWED                              08920006
089300                 SET ASC-ACCESS-ALLOWED                           08930006
089400                     ASC-OSA          TO TRUE                     08940006
089500             ELSE                                                 08950006
089600                 SET ASC-ACCESS-DENIED                            08960006
089700                     ASC-NO-AUTH      TO TRUE                     08970006
089800             END-IF                                               08980006
089900         END-IF                                                   08990006
090000     END-IF.                                                      09000006
090100                                                                  09010006
090200***  MOVE 'S'                         TO ASHPDCO                  09020026
090300***                                     ASC-STATUS-SHIPPED-FROM-DC09030026
090400                                                                  09040006
090500     EXEC SQL                                                     09050006
090600         SELECT                                                   09060006
090700             CHAR((CURRENT_DATE),USA)                             09070006
090800         INTO                                                     09080006
090900             :ASC-HIST-FROM-DATE                                  09090006
091000         FROM SYSIBM.SYSDUMMY1                                    09100006
091100     END-EXEC.                                                    09110006
091200     EVALUATE TRUE                                                09120006
091300         WHEN SQLCODE = ZERO                                      09130006
091400         WHEN SQLCODE = +100                                      09140006
091500             CONTINUE                                             09150006
091600                                                                  09160006
091700         WHEN SQLWARN0 NOT = SPACES                               09170006
091800         WHEN SQLCODE < +0                                        09180006
091900         WHEN SQLCODE > +0                                        09190006
092000             MOVE '4000-BUILD-INITIAL-PANEL'                      09200006
092100                             TO DP013-PARAGRAPH                   09210006
092200             MOVE 'SELECT DATE '                                  09220006
092300                             TO DP013-MESSAGE-TEXT (1)            09230006
092400             MOVE SQLCA      TO DP013-SQLCA                       09240006
092500             MOVE 'SYSDUMMY1' TO DP013-DB2-TABLE-NAME (1)         09250006
092600             SET DP013-DB2-ABEND                                  09260006
092700                             TO TRUE                              09270006
092800             SET DP013-XCTL-DISPLAY-RESTART                       09280006
092900                             TO TRUE                              09290006
093000             PERFORM DP013-0000-PROCESS-ABEND                     09300006
093100     END-EVALUATE.                                                09310006
093200                                                                  09320006
093300     MOVE ASC-HIST-FROM-DATE          TO ASC-HIST-TO-DATE.        09330006
093400     MOVE ASC-HIST-FROM-MM            TO AFDTMMO                  09340006
093500     MOVE ASC-HIST-FROM-DD            TO AFDTDDO                  09350006
093600     MOVE ASC-HIST-FROM-CY            TO AFDTCYO                  09360006
093700     MOVE ASC-HIST-TO-MM              TO ATDTMMO                  09370006
093800     MOVE ASC-HIST-TO-DD              TO ATDTDDO                  09380006
093900     MOVE ASC-HIST-TO-CY              TO ATDTCYO.                 09390006
094000     MOVE -1                          TO AOPNDCL.                 09400006
094100                                                                  09410006
094110* DMH - 05/08/17 BEGIN                                            09411007
094111     PERFORM 4500-COUNT-TRAILER-STATUS.                           09411130
094112     IF  PV-DC-OPEN-CNT  > 0                                      09411230
094113         MOVE 'S'           TO AOPNDCO                            09411330
094114                               ASC-STATUS-OPEN-AT-DC              09411430
094115     ELSE                                                         09411532
094116         MOVE ' '           TO AOPNDCO                            09411632
094117                               ASC-STATUS-OPEN-AT-DC              09411732
094118     END-IF.                                                      09411830
094119                                                                  09411930
094120     IF  PV-DC-CLOSE-CNT  > 0                                     09412030
094121         MOVE 'S'           TO ACLSDCO                            09412130
094122                               ASC-STATUS-CLOSED-AT-DC            09412230
094123     ELSE                                                         09412332
094124         MOVE ' '           TO ACLSDCO                            09412432
094125                               ASC-STATUS-CLOSED-AT-DC            09412532
094126     END-IF.                                                      09412630
094127                                                                  09412730
094130     IF  PV-DC-SHIP-CNT  > 0                                      09413030
094140         MOVE 'S'           TO ASHPDCO                            09414030
094150                               ASC-STATUS-SHIPPED-FROM-DC         09415030
094151     ELSE                                                         09415132
094152         MOVE ' '           TO ASHPDCO                            09415232
094153                               ASC-STATUS-SHIPPED-FROM-DC         09415332
094154     END-IF.                                                      09415430
094155                                                                  09415530
094156     IF  PV-STR-OPEN-CNT  > 0                                     09415630
094157         MOVE 'S'           TO AOPNSTRO                           09415730
094158                               ASC-STATUS-OPENED-AT-STORE         09415830
094159     ELSE                                                         09415933
094160         MOVE ' '           TO AOPNSTRO                           09416032
094161                               ASC-STATUS-OPENED-AT-STORE         09416132
094162     END-IF.                                                      09416230
094163* DMH - 05/08/17 END                                              09416307
094170                                                                  09417007
094200 4010-IS-USER-DMM.                                                09420006
094300     SET DP008-RSRC-TYPE-FUNC                                     09430006
094400         DP008-ACCESS-TYPE-READ       TO TRUE.                    09440006
094500     MOVE 'SDPRJ01'                   TO DP008-FUNCTION-NAME.     09450006
094600     PERFORM 8000-CALL-RACF.                                      09460006
094700                                                                  09470006
094800 4020-IS-USER-STR-MGR.                                            09480006
094900     SET DP008-RSRC-TYPE-FUNC                                     09490006
095000         DP008-ACCESS-TYPE-READ       TO TRUE.                    09500006
095100     MOVE 'SDPRJ02'                   TO DP008-FUNCTION-NAME.     09510006
095200     PERFORM 8000-CALL-RACF.                                      09520006
095300                                                                  09530006
095400 4030-IS-USER-OSA.                                                09540006
095500     SET DP008-RSRC-TYPE-FUNC                                     09550006
095600         DP008-ACCESS-TYPE-READ       TO TRUE.                    09560006
095700     MOVE 'SDPRJ03'                   TO DP008-FUNCTION-NAME.     09570006
095800     PERFORM 8000-CALL-RACF.                                      09580006
095900                                                                  09590006
096000*----------------------------------------------------------------*09600006
096100*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *09610006
096200*----------------------------------------------------------------*09620006
096300 4400-MOVE-COMMAREA-TO-SCREEN.                                    09630006
096400                                                                  09640006
096500     MOVE ASC-OPER-UNT-ID             TO ASTOREO                  09650006
096600     MOVE ASC-STORE-NAME              TO ASTNMEO                  09660006
096700     MOVE ASC-STATUS-OPEN-AT-DC       TO AOPNDCO                  09670006
096800     MOVE ASC-STATUS-CLOSED-AT-DC     TO ACLSDCO                  09680006
096900     MOVE ASC-STATUS-SHIPPED-FROM-DC  TO ASHPDCO                  09690006
097000     MOVE ASC-STATUS-OPENED-AT-STORE  TO AOPNSTRO                 09700006
097100     MOVE ASC-STATUS-UNLOAD-AT-STORE  TO AUNLSTRO                 09710006
097200                                                                  09720006
097300     MOVE ASC-HIST-FROM-MM            TO AFDTMMO                  09730006
097400     MOVE ASC-HIST-FROM-DD            TO AFDTDDO                  09740006
097500     MOVE ASC-HIST-FROM-CY            TO AFDTCYO                  09750006
097600     MOVE ASC-HIST-TO-MM              TO ATDTMMO                  09760006
097700     MOVE ASC-HIST-TO-DD              TO ATDTDDO                  09770006
097800     MOVE ASC-HIST-TO-CY              TO ATDTCYO.                 09780006
097900                                                                  09790006
097901*----------------------------------------------------------------*09790130
097902* COUNT TRAILER STATUS - DETERMINE HIGHLIGHTING                  *09790230
097904* 5/8/17 - DMH                                                   *09790430
097905*----------------------------------------------------------------*09790530
097907 4500-COUNT-TRAILER-STATUS.                                       09790730
097908                                                                  09790830
097909     SET  PS-DC-SHIP-HIGHLIGHT-NO                                 09790930
097910          PS-STR-OPEN-HIGHLIGHT-NO    TO TRUE.                    09791030
097911     PERFORM 5000-COUNT-DC-OPEN-TRLR.                             09791130
097912     PERFORM 5010-COUNT-DC-CLOSE-TRLR.                            09791230
097913     PERFORM 5030-COUNT-DC-SHIP-TRLR.                             09791330
097914     PERFORM 5040-COUNT-STR-OPEN-TRLR.                            09791430
097915                                                                  09791530
097916                                                                  09791630
097917*----------------------------------------------------------------*09791729
097918* COUNT THE NUMBER OF TRAILERS FOR STORE THAT ARE CURRENTLY IN   *09791829
097919* OPEN AT DC STATUS                                              *09791929
097920* 5/8/17 - DMH                                                   *09792029
097921*----------------------------------------------------------------*09792129
097922 5000-COUNT-DC-OPEN-TRLR.                                         09792229
097923                                                                  09792329
097924     MOVE ZEROES  TO  PV-DC-OPEN-CNT.                             09792429
097925     MOVE SPACES  TO  AOPNTXO.                                    09792538
097926                                                                  09792629
097927     EXEC SQL                                                     09792729
097928         SELECT  COUNT(*)                                         09792829
097929           INTO :PV-DC-OPEN-CNT                                   09792929
097930           FROM  TSUOBTR A                                        09793029
097931              ,  TSUOBTS B                                        09793129
097932          WHERE A.DEST_OPER_UNT_ID   = :DK-OPER-UNT-ID            09793229
097933            AND A.OTBND_TRIP_ID      =  B.OTBND_TRIP_ID           09793329
097934            AND B.OTBND_STAT_TMST IN                              09793429
097935                (SELECT MAX(C.OTBND_STAT_TMST)                    09793529
097936                   FROM TSUOBTS C                                 09793629
097937                  WHERE B.OTBND_TRIP_ID  =  C.OTBND_TRIP_ID)      09793729
097938            AND  B.TRIP_STAT_CDE  = 'DO'                          09793829
097939           WITH UR                                                09793929
097940     END-EXEC.                                                    09794029
097941                                                                  09794129
097942     EVALUATE TRUE                                                09794229
097943         WHEN SQLCODE = ZERO                                      09794329
097944              MOVE PV-DC-OPEN-CNT   TO  PV-DISP-TRLR-CNT          09794429
097945              MOVE PV-DISP-TRLR-CNT TO  AOPNCTO                   09794529
097946              IF  PV-DC-OPEN-CNT  > 0                             09794629
097947                  MOVE 'S'           TO AOPNDCO                   09794731
097948                                        ASC-STATUS-OPEN-AT-DC     09794831
097949                  PERFORM 5005-GET-OPEN-DAYS                      09794929
097950              ELSE                                                09795032
097951                  MOVE ' '           TO AOPNDCO                   09795132
097952                                        ASC-STATUS-OPEN-AT-DC     09795232
097953                                        AOPNTXO                   09795332
097954              END-IF                                              09795432
097955                                                                  09795532
097956         WHEN SQLCODE = +100                                      09795632
097957             CONTINUE                                             09795732
097958                                                                  09795832
097959         WHEN SQLWARN0 NOT = SPACES                               09795932
097960         WHEN SQLCODE < +0                                        09796032
097961         WHEN SQLCODE > +0                                        09796132
097962             MOVE '5000-COUNT-DC-OPEN-TRLR '                      09796232
097963                             TO DP013-PARAGRAPH                   09796332
097964             MOVE 'COUNT NUMBER OF OPEN TRAILERS'                 09796432
097965                             TO DP013-MESSAGE-TEXT (1)            09796532
097966             MOVE SQLCA      TO DP013-SQLCA                       09796632
097967             MOVE 'TSUOBTR'   TO DP013-DB2-TABLE-NAME (1)         09796732
097968             MOVE 'TSUOBTS'   TO DP013-DB2-TABLE-NAME (2)         09796832
097969             SET DP013-DB2-ABEND                                  09796932
097970                             TO TRUE                              09797032
097971             SET DP013-XCTL-DISPLAY-RESTART                       09797132
097972                             TO TRUE                              09797232
097973             PERFORM DP013-0000-PROCESS-ABEND                     09797332
097974     END-EVALUATE.                                                09797432
097975                                                                  09797532
097976                                                                  09797632
097977*----------------------------------------------------------------*09797732
097978* GET THE OLDEST DATE FOR THE TRAILER THAT ARE CURRENTLY IN A    *09797832
097979* DC OPEN STATUS                                                 *09797932
097980* 5/8/17 - DMH                                                   *09798032
097981*----------------------------------------------------------------*09798132
097982 5005-GET-OPEN-DAYS.                                              09798232
097983                                                                  09798332
097984     MOVE ZEROES  TO  PV-DC-OPEN-DAYS.                            09798432
097985     MOVE SPACES  TO  AOPNTXO.                                    09798537
097986                                                                  09798637
097987     EXEC SQL                                                     09798737
097988         SELECT DAYS(CURRENT TIMESTAMP) -                         09798837
097989                DAYS(E.OTBND_STAT_TMST)                           09798937
097990           INTO :PV-DC-OPEN-DAYS                                  09799037
097991           FROM TSUOBTR D                                         09799137
097992              , TSUOBTS E                                         09799237
097993         WHERE  D.DEST_OPER_UNT_ID       = :DK-OPER-UNT-ID        09799337
097994           AND  D.OTBND_TRIP_ID          = E.OTBND_TRIP_ID        09799437
097995           AND  E.TRIP_STAT_CDE          = 'DO'                   09799537
097996           AND  E.OTBND_STAT_TMST  IN                             09799637
098000                (SELECT MIN(B.OTBND_STAT_TMST)                    09800026
098010                   FROM TSUOBTR A                                 09801026
098011                      , TSUOBTS B                                 09801126
098012                  WHERE A.DEST_OPER_UNT_ID = :DK-OPER-UNT-ID      09801226
098013                    AND A.OTBND_TRIP_ID    = B.OTBND_TRIP_ID      09801326
098014                    AND B.OTBND_STAT_TMST IN                      09801426
098015                       (SELECT MAX(C.OTBND_STAT_TMST)             09801526
098016                          FROM TSUOBTS C                          09801626
098017                         WHERE B.OTBND_TRIP_ID = C.OTBND_TRIP_ID  09801726
098018                           AND B.TRIP_STAT_CDE = 'DO')            09801827
098019                 )                                                09801926
098020           WITH UR                                                09802026
098021     END-EXEC.                                                    09802126
098022                                                                  09802226
098023     EVALUATE TRUE                                                09802326
098024         WHEN SQLCODE = ZERO                                      09802426
098025              MOVE  PV-DC-OPEN-DAYS TO PV-DISP-DAYS               09802527
098026              STRING 'TRAILER STATUS FOR '                        09802627
098027                      PV-DISP-DAYS                                09802726
098028                      ' DAYS'            DELIMITED BY SIZE        09802826
098029                                   INTO  AOPNTXO                  09802927
098030                                                                  09803026
098031         WHEN SQLCODE = +100                                      09803126
098032             CONTINUE                                             09803226
098033                                                                  09803326
098034         WHEN SQLWARN0 NOT = SPACES                               09803426
098035         WHEN SQLCODE < +0                                        09803526
098036         WHEN SQLCODE > +0                                        09803626
098037             MOVE '5005-GET-OPEN-DAYS      '                      09803727
098038                             TO DP013-PARAGRAPH                   09803826
098039             MOVE 'CALC DAYS TRAILER IN SHIPPED STATUS  '         09803926
098040                             TO DP013-MESSAGE-TEXT (1)            09804026
098041             MOVE SQLCA      TO DP013-SQLCA                       09804126
098042             MOVE 'TSUOBTR'   TO DP013-DB2-TABLE-NAME (1)         09804226
098043             MOVE 'TSUOBTS'   TO DP013-DB2-TABLE-NAME (2)         09804326
098044             SET DP013-DB2-ABEND                                  09804426
098045                             TO TRUE                              09804526
098046             SET DP013-XCTL-DISPLAY-RESTART                       09804626
098047                             TO TRUE                              09804726
098048             PERFORM DP013-0000-PROCESS-ABEND                     09804826
098049     END-EVALUATE.                                                09804926
098050                                                                  09805011
098051                                                                  09805111
098052*----------------------------------------------------------------*09805211
098053* COUNT THE NUMBER OF TRAILERS FOR STORE THAT ARE CURRENTLY IN   *09805311
098054* CLOSED AT DC STATUS                                            *09805411
098055* 5/8/17 - DMH                                                   *09805511
098056*----------------------------------------------------------------*09805611
098057 5010-COUNT-DC-CLOSE-TRLR.                                        09805711
098058                                                                  09805811
098059     MOVE  ZEROES  TO  PV-DC-CLOSE-CNT.                           09805911
098060     MOVE SPACES  TO  ACLSTXO.                                    09806038
098061                                                                  09806111
098062     EXEC SQL                                                     09806211
098063         SELECT  COUNT(*)                                         09806311
098064           INTO :PV-DC-CLOSE-CNT                                  09806411
098065           FROM  TSUOBTR A                                        09806511
098066              ,  TSUOBTS B                                        09806611
098067          WHERE A.DEST_OPER_UNT_ID   = :DK-OPER-UNT-ID            09806711
098068            AND A.OTBND_TRIP_ID      =  B.OTBND_TRIP_ID           09806811
098069            AND B.OTBND_STAT_TMST IN                              09806911
098070                (SELECT MAX(C.OTBND_STAT_TMST)                    09807011
098071                   FROM TSUOBTS C                                 09807111
098072                  WHERE B.OTBND_TRIP_ID  =  C.OTBND_TRIP_ID)      09807211
098073            AND  B.TRIP_STAT_CDE  = 'DC'                          09807311
098074           WITH UR                                                09807416
098075     END-EXEC.                                                    09807511
098076                                                                  09807611
098077     EVALUATE TRUE                                                09807711
098078         WHEN SQLCODE = ZERO                                      09807811
098079              MOVE PV-DC-CLOSE-CNT  TO  PV-DISP-TRLR-CNT          09807911
098080              MOVE PV-DISP-TRLR-CNT TO  ACLSCTO                   09808011
098081              IF  PV-DC-CLOSE-CNT  > 0                            09808116
098082                  MOVE 'S'           TO ACLSDCO                   09808231
098083                                        ASC-STATUS-CLOSED-AT-DC   09808331
098084                  PERFORM 5015-GET-DC-CLOSE-DAYS                  09808427
098085              ELSE                                                09808532
098086                  MOVE ' '           TO ACLSDCO                   09808632
098087                                        ASC-STATUS-CLOSED-AT-DC   09808732
098088                                        ACLSTXO                   09808832
098089              END-IF                                              09808929
098090                                                                  09809029
098091         WHEN SQLCODE = +100                                      09809129
098092             CONTINUE                                             09809229
098093                                                                  09809329
098094         WHEN SQLWARN0 NOT = SPACES                               09809429
098095         WHEN SQLCODE < +0                                        09809529
098096         WHEN SQLCODE > +0                                        09809629
098097             MOVE '5010-COUNT-DC-CLOSE-TRLR'                      09809729
098098                             TO DP013-PARAGRAPH                   09809829
098099             MOVE 'COUNT NUMBER OF DC CLOSED TRAILERS'            09809929
098100                             TO DP013-MESSAGE-TEXT (1)            09810029
098101             MOVE SQLCA      TO DP013-SQLCA                       09810129
098102             MOVE 'TSUOBTR'   TO DP013-DB2-TABLE-NAME (1)         09810229
098103             MOVE 'TSUOBTS'   TO DP013-DB2-TABLE-NAME (2)         09810329
098104             SET DP013-DB2-ABEND                                  09810429
098105                             TO TRUE                              09810529
098106             SET DP013-XCTL-DISPLAY-RESTART                       09810629
098107                             TO TRUE                              09810729
098108             PERFORM DP013-0000-PROCESS-ABEND                     09810829
098109     END-EVALUATE.                                                09810929
098110                                                                  09811029
098111                                                                  09811129
098112*----------------------------------------------------------------*09811229
098113* GET THE OLDEST DATE FOR THE TRAILER THAT ARE CURRENTLY IN A    *09811329
098114* DC OPEN STATUS                                                 *09811429
098115* 5/8/17 - DMH                                                   *09811529
098116*----------------------------------------------------------------*09811629
098117 5015-GET-DC-CLOSE-DAYS.                                          09811729
098118                                                                  09811829
098119     MOVE ZEROES  TO  PV-DC-CLOSE-DAYS.                           09811929
098120     MOVE SPACES  TO  ACLSTXO.                                    09812037
098121                                                                  09812137
098122     EXEC SQL                                                     09812237
098123         SELECT DAYS(CURRENT TIMESTAMP) -                         09812337
098124                DAYS(E.OTBND_STAT_TMST)                           09812437
098125           INTO :PV-DC-CLOSE-DAYS                                 09812537
098126           FROM TSUOBTR D                                         09812637
098127              , TSUOBTS E                                         09812737
098128         WHERE  D.DEST_OPER_UNT_ID       = :DK-OPER-UNT-ID        09812837
098129           AND  D.OTBND_TRIP_ID          = E.OTBND_TRIP_ID        09812937
098130           AND  E.TRIP_STAT_CDE          = 'DC'                   09813037
098131           AND  E.OTBND_STAT_TMST  IN                             09813137
098132                (SELECT MIN(B.OTBND_STAT_TMST)                    09813237
098133                   FROM TSUOBTR A                                 09813337
098134                      , TSUOBTS B                                 09813437
098135                  WHERE A.DEST_OPER_UNT_ID = :DK-OPER-UNT-ID      09813537
098136                    AND A.OTBND_TRIP_ID    = B.OTBND_TRIP_ID      09813637
098137                    AND B.OTBND_STAT_TMST IN                      09813737
098138                       (SELECT MAX(C.OTBND_STAT_TMST)             09813837
098139                          FROM TSUOBTS C                          09813937
098140                         WHERE B.OTBND_TRIP_ID = C.OTBND_TRIP_ID  09814037
098141                           AND B.TRIP_STAT_CDE = 'DC')            09814137
098142                 )                                                09814237
098143           WITH UR                                                09814337
098144     END-EXEC.                                                    09814437
098145                                                                  09814537
098146     EVALUATE TRUE                                                09814637
098147         WHEN SQLCODE = ZERO                                      09814737
098148              MOVE  PV-DC-CLOSE-DAYS TO PV-DISP-DAYS              09814837
098149              STRING 'TRAILER STATUS FOR '                        09814937
098150                      PV-DISP-DAYS                                09815037
098151                      ' DAYS'            DELIMITED BY SIZE        09815137
098152                                   INTO  ACLSTXO                  09815237
098160                                                                  09816029
098169         WHEN SQLCODE = +100                                      09816911
098170             CONTINUE                                             09817011
098171                                                                  09817111
098172         WHEN SQLWARN0 NOT = SPACES                               09817211
098173         WHEN SQLCODE < +0                                        09817311
098174         WHEN SQLCODE > +0                                        09817411
098175             MOVE '5015-GET-DC-CLOSE-DAYS  '                      09817527
098176                             TO DP013-PARAGRAPH                   09817611
098177             MOVE 'GET OLDEST DATE FOR DC CLOSED TRAILER'         09817711
098178                             TO DP013-MESSAGE-TEXT (1)            09817811
098179             MOVE SQLCA      TO DP013-SQLCA                       09817911
098180             MOVE 'TSUOBTR'   TO DP013-DB2-TABLE-NAME (1)         09818011
098181             MOVE 'TSUOBTS'   TO DP013-DB2-TABLE-NAME (2)         09818111
098182             SET DP013-DB2-ABEND                                  09818211
098183                             TO TRUE                              09818311
098184             SET DP013-XCTL-DISPLAY-RESTART                       09818411
098185                             TO TRUE                              09818511
098186             PERFORM DP013-0000-PROCESS-ABEND                     09818611
098187     END-EVALUATE.                                                09818711
098188                                                                  09818811
098189                                                                  09818911
098193*----------------------------------------------------------------*09819311
098194* COUNT THE NUMBER OF TRAILERS FOR STORE THAT ARE CURRENTLY IN   *09819411
098195* DC SHIPPED STATUS                                              *09819511
098196* 5/8/17 - DMH                                                   *09819611
098197*----------------------------------------------------------------*09819711
098198 5030-COUNT-DC-SHIP-TRLR.                                         09819811
098199                                                                  09819911
098200     MOVE ZEROES  TO  PV-DC-SHIP-CNT.                             09820011
098201     MOVE SPACES  TO  ASHPTXO.                                    09820139
098202                                                                  09820239
098203     EXEC SQL                                                     09820339
098204         SELECT  COUNT(*)                                         09820439
098205           INTO :PV-DC-SHIP-CNT                                   09820539
098206           FROM  TSUOBTR A                                        09820639
098207              ,  TSUOBTS B                                        09820739
098208          WHERE A.DEST_OPER_UNT_ID   = :DK-OPER-UNT-ID            09820839
098209            AND A.OTBND_TRIP_ID      =  B.OTBND_TRIP_ID           09820939
098210            AND B.OTBND_STAT_TMST IN                              09821039
098211                (SELECT MAX(C.OTBND_STAT_TMST)                    09821139
098212                   FROM TSUOBTS C                                 09821239
098213                  WHERE B.OTBND_TRIP_ID  =  C.OTBND_TRIP_ID)      09821339
098214            AND  B.TRIP_STAT_CDE  = 'DS'                          09821439
098215           WITH UR                                                09821539
098216     END-EXEC.                                                    09821639
098217                                                                  09821739
098218     EVALUATE TRUE                                                09821839
098219         WHEN SQLCODE = ZERO                                      09821939
098220              MOVE PV-DC-SHIP-CNT   TO  PV-DISP-TRLR-CNT          09822039
098221              MOVE PV-DISP-TRLR-CNT TO  ASHPCTO                   09822139
098222              IF  PV-DC-SHIP-CNT  > 0                             09822239
098223                  MOVE 'S'           TO ASHPDCO                   09822339
098224                                        ASC-STATUS-SHIPPED-FROM-DC09822439
098225                  PERFORM 5035-GET-DAYS-SHIPPED                   09822539
098226                  PERFORM 5037-GET-DC-SHIP-HIGHLIGHT              09822639
098227              ELSE                                                09822739
098228                  MOVE ' '           TO ASHPDCO                   09822839
098229                                        ASC-STATUS-SHIPPED-FROM-DC09822939
098230                                        ASHPDCO                   09823039
098231             END-IF                                               09823139
098232                                                                  09823239
098233         WHEN SQLCODE = +100                                      09823339
098234             CONTINUE                                             09823439
098235                                                                  09823539
098236         WHEN SQLWARN0 NOT = SPACES                               09823639
098237         WHEN SQLCODE < +0                                        09823739
098238         WHEN SQLCODE > +0                                        09823839
098239             MOVE '5030-COUNT-DC-SHIP-TRLR '                      09823939
098240                             TO DP013-PARAGRAPH                   09824039
098241             MOVE 'COUNT THE NUMBER OF DC SHIPPED TRAILERS'       09824139
098242                             TO DP013-MESSAGE-TEXT (1)            09824239
098243             MOVE SQLCA      TO DP013-SQLCA                       09824339
098244             MOVE 'TSUOBTR'   TO DP013-DB2-TABLE-NAME (1)         09824439
098245             MOVE 'TSUOBTS'   TO DP013-DB2-TABLE-NAME (2)         09824539
098246             SET DP013-DB2-ABEND                                  09824639
098247                             TO TRUE                              09824739
098248             SET DP013-XCTL-DISPLAY-RESTART                       09824839
098249                             TO TRUE                              09824939
098250             PERFORM DP013-0000-PROCESS-ABEND                     09825039
098251     END-EVALUATE.                                                09825139
098252                                                                  09825239
098253                                                                  09825339
098254*----------------------------------------------------------------*09825439
098255* GET THE NUMBER OF DAYS THE OLDEST TRAILER HAS BEEN SET TO      *09825539
098256* DC SHIPPED STATUS                                              *09825639
098257* 5/8/17 - DMH                                                   *09825739
098258*----------------------------------------------------------------*09825839
098259 5035-GET-DAYS-SHIPPED.                                           09825939
098260                                                                  09826039
098261     MOVE ZEROES  TO  PV-DC-SHIP-DAYS.                            09826139
098262                                                                  09826239
098263     EXEC SQL                                                     09826339
098264         SELECT DAYS(CURRENT TIMESTAMP) -                         09826439
098265                DAYS(E.OTBND_STAT_TMST)                           09826539
098266           INTO :PV-DC-SHIP-DAYS                                  09826639
098267           FROM TSUOBTR D                                         09826739
098268              , TSUOBTS E                                         09826839
098269         WHERE  D.DEST_OPER_UNT_ID       = :DK-OPER-UNT-ID        09826939
098270           AND  D.OTBND_TRIP_ID          = E.OTBND_TRIP_ID        09827039
098271           AND  E.TRIP_STAT_CDE          = 'DS'                   09827139
098272           AND  E.OTBND_STAT_TMST  IN                             09827239
098273                (SELECT MIN(B.OTBND_STAT_TMST)                    09827339
098274                   FROM TSUOBTR A                                 09827439
098275                      , TSUOBTS B                                 09827539
098276                  WHERE A.DEST_OPER_UNT_ID = :DK-OPER-UNT-ID      09827639
098277                    AND A.OTBND_TRIP_ID    = B.OTBND_TRIP_ID      09827739
098278                    AND B.OTBND_STAT_TMST IN                      09827839
098279                       (SELECT MAX(C.OTBND_STAT_TMST)             09827939
098280                          FROM TSUOBTS C                          09828039
098281                         WHERE B.OTBND_TRIP_ID = C.OTBND_TRIP_ID  09828139
098282                           AND B.TRIP_STAT_CDE = 'DS')            09828239
098283                 )                                                09828339
098284           WITH UR                                                09828439
098285     END-EXEC.                                                    09828539
098286                                                                  09828639
098287     EVALUATE TRUE                                                09828739
098288         WHEN SQLCODE = ZERO                                      09828839
098289              MOVE  PV-DC-SHIP-DAYS TO PV-DISP-DAYS               09828939
098290              STRING 'TRAILER STATUS FOR '                        09829039
098291                      PV-DISP-DAYS                                09829139
098292                      ' DAYS'            DELIMITED BY SIZE        09829239
098293                                   INTO  ASHPTXO                  09829339
098294                                                                  09829439
098295         WHEN SQLCODE = +100                                      09829539
098296             CONTINUE                                             09829639
098297                                                                  09829739
098298         WHEN SQLWARN0 NOT = SPACES                               09829839
098299         WHEN SQLCODE < +0                                        09829939
098300         WHEN SQLCODE > +0                                        09830039
098301             MOVE '5035-GET-DAYS-SHIPPED   '                      09830139
098302                             TO DP013-PARAGRAPH                   09830239
098303             MOVE 'CALC DAYS TRAILER IN SHIPPED STATUS  '         09830339
098304                             TO DP013-MESSAGE-TEXT (1)            09830439
098305             MOVE SQLCA      TO DP013-SQLCA                       09830539
098306             MOVE 'TSUOBTR'   TO DP013-DB2-TABLE-NAME (1)         09830639
098307             MOVE 'TSUOBTS'   TO DP013-DB2-TABLE-NAME (2)         09830739
098308             SET DP013-DB2-ABEND                                  09830839
098309                             TO TRUE                              09830939
098310             SET DP013-XCTL-DISPLAY-RESTART                       09831039
098311                             TO TRUE                              09831139
098312             PERFORM DP013-0000-PROCESS-ABEND                     09831239
098313     END-EVALUATE.                                                09831339
098314                                                                  09831439
098315                                                                  09831539
098316 5037-GET-DC-SHIP-HIGHLIGHT.                                      09831639
098317     SET  PS-DC-SHIP-HIGHLIGHT-NO  TO  TRUE.                      09831739
098318     MOVE ZEROES  TO  PV-DC-SHIP-HIGH-DAYS.                       09831839
098319                                                                  09831939
098320     EXEC SQL                                                     09832039
098321         SELECT  FUNC_QTY                                         09832139
098322           INTO :PV-DC-SHIP-HIGH-DAYS                             09832239
098323           FROM TKRPRPM                                           09832339
098324         WHERE LOC_ID            = 90                             09832439
098325           AND INTFC_SYS_CDE     = 'KHL'                          09832539
098326           AND SYS_PRC_FUNC_CDE  = 'TRDCSH'                       09832639
098327           AND FUNC_PRC_STAT_CDE = 'AC'                           09832739
098328           AND FUNC_BEG_TMST    <= CURRENT TIMESTAMP              09832839
098329           AND FUNC_END_TMST    >= CURRENT TIMESTAMP              09832939
098330          WITH UR                                                 09833039
098339     END-EXEC.                                                    09833930
098340                                                                  09834030
098341     EVALUATE TRUE                                                09834130
098342         WHEN SQLCODE = ZERO                                      09834230
098343              IF  PV-DC-SHIP-DAYS >  PV-DC-SHIP-HIGH-DAYS         09834336
098347                  MOVE  DP015-RED   TO  ASHPTXC                   09834730
098350                  SET  ASC-DC-SHIP-GRTR-X-DAYS   TO  TRUE         09835034
098351              ELSE                                                09835134
098352                  MOVE  DP015-BLUE  TO  ASHPTXC                   09835234
098353              END-IF                                              09835334
098354                                                                  09835434
098355         WHEN SQLCODE = +100                                      09835534
098356             CONTINUE                                             09835634
098357                                                                  09835734
098358         WHEN SQLWARN0 NOT = SPACES                               09835834
098359         WHEN SQLCODE < +0                                        09835934
098360         WHEN SQLCODE > +0                                        09836034
098361             MOVE '5037-GET-DC-SHIP-HIGHLIGHT'                    09836134
098362                             TO DP013-PARAGRAPH                   09836234
098363             MOVE 'CHECK DAYS TO HIGHLIGHT SHIPPED TRLR '         09836334
098364                             TO DP013-MESSAGE-TEXT (1)            09836434
098365             MOVE SQLCA      TO DP013-SQLCA                       09836534
098366             MOVE 'TKRPRPM'   TO DP013-DB2-TABLE-NAME (1)         09836634
098367             SET DP013-DB2-ABEND                                  09836734
098368                             TO TRUE                              09836834
098369             SET DP013-XCTL-DISPLAY-RESTART                       09836934
098370                             TO TRUE                              09837034
098371             PERFORM DP013-0000-PROCESS-ABEND                     09837134
098372     END-EVALUATE.                                                09837234
098373                                                                  09837334
098374                                                                  09837434
098375*----------------------------------------------------------------*09837534
098376* COUNT THE NUMBER OF TRAILERS FOR STORE THAT ARE CURRENTLY IN   *09837634
098377* DC SHIPPED STATUS                                              *09837734
098378* 5/8/17 - DMH                                                   *09837834
098379*----------------------------------------------------------------*09837934
098380 5040-COUNT-STR-OPEN-TRLR.                                        09838034
098381                                                                  09838134
098382     MOVE  ZEROES  TO  PV-STR-OPEN-CNT.                           09838234
098383     MOVE  SPACES  TO  ASTRTXO.                                   09838339
098384                                                                  09838439
098385     EXEC SQL                                                     09838539
098386         SELECT  COUNT(*)                                         09838639
098387           INTO :PV-STR-OPEN-CNT                                  09838739
098388           FROM  TSUOBTR A                                        09838839
098389              ,  TSUOBTS B                                        09838939
098390          WHERE A.DEST_OPER_UNT_ID   = :DK-OPER-UNT-ID            09839039
098391            AND A.OTBND_TRIP_ID      =  B.OTBND_TRIP_ID           09839139
098392            AND B.OTBND_STAT_TMST IN                              09839239
098393                (SELECT MAX(C.OTBND_STAT_TMST)                    09839339
098394                   FROM TSUOBTS C                                 09839439
098395                  WHERE B.OTBND_TRIP_ID  =  C.OTBND_TRIP_ID)      09839539
098396            AND  B.TRIP_STAT_CDE  = 'SO'                          09839639
098397           WITH UR                                                09839739
098398     END-EXEC.                                                    09839839
098399                                                                  09839939
098400     EVALUATE TRUE                                                09840039
098401         WHEN SQLCODE = ZERO                                      09840139
098402              MOVE PV-STR-OPEN-CNT  TO  PV-DISP-TRLR-CNT          09840239
098403              MOVE PV-DISP-TRLR-CNT TO  ASTRCTO                   09840339
098404              IF  PV-STR-OPEN-CNT  > 0                            09840439
098405                  MOVE 'S'           TO AOPNSTRO                  09840539
098406                                        ASC-STATUS-OPENED-AT-STORE09840639
098407                  PERFORM 5045-GET-STORE-OPEN                     09840739
098408                  PERFORM 5047-GET-STR-OPEN-HIGHLIGHT             09840839
098409              ELSE                                                09840939
098410                  MOVE ' '           TO AOPNSTRO                  09841039
098411                                        ASC-STATUS-OPENED-AT-STORE09841139
098412                                        ASTRTXO                   09841239
098413              END-IF                                              09841339
098414                                                                  09841439
098415         WHEN SQLCODE = +100                                      09841539
098416             CONTINUE                                             09841639
098417                                                                  09841739
098418         WHEN SQLWARN0 NOT = SPACES                               09841839
098419         WHEN SQLCODE < +0                                        09841939
098420         WHEN SQLCODE > +0                                        09842039
098421             MOVE '5040-COUNT-STR-OPEN-TRLR '                     09842139
098422                             TO DP013-PARAGRAPH                   09842239
098423             MOVE 'COUNT THE NUMBER TRLRS OPENED AT STORE '       09842339
098424                             TO DP013-MESSAGE-TEXT (1)            09842439
098425             MOVE SQLCA      TO DP013-SQLCA                       09842539
098426             MOVE 'TSUOBTR'   TO DP013-DB2-TABLE-NAME (1)         09842639
098427             MOVE 'TSUOBTS'   TO DP013-DB2-TABLE-NAME (2)         09842739
098428             SET DP013-DB2-ABEND                                  09842839
098429                             TO TRUE                              09842939
098430             SET DP013-XCTL-DISPLAY-RESTART                       09843039
098431                             TO TRUE                              09843139
098432             PERFORM DP013-0000-PROCESS-ABEND                     09843239
098433     END-EVALUATE.                                                09843339
098434                                                                  09843439
098435                                                                  09843539
098436*----------------------------------------------------------------*09843639
098437* GET THE NUMBER OF DAYS THE OLDEST TRAILER HAS BEEN SET TO      *09843739
098438* STORE OPEN STATUS                                              *09843839
098439* 5/8/17 - DMH                                                   *09843939
098440*----------------------------------------------------------------*09844039
098441 5045-GET-STORE-OPEN.                                             09844139
098442                                                                  09844239
098443     MOVE ZEROES  TO  PV-STR-OPEN-DAYS.                           09844339
098444                                                                  09844439
098445     EXEC SQL                                                     09844539
098446         SELECT DAYS(CURRENT TIMESTAMP) -                         09844639
098447                DAYS(E.OTBND_STAT_TMST)                           09844739
098448           INTO :PV-STR-OPEN-DAYS                                 09844839
098449           FROM TSUOBTR D                                         09844939
098450              , TSUOBTS E                                         09845039
098451         WHERE  D.DEST_OPER_UNT_ID       = :DK-OPER-UNT-ID        09845139
098452           AND  D.OTBND_TRIP_ID          = E.OTBND_TRIP_ID        09845239
098453           AND  E.TRIP_STAT_CDE          = 'SO'                   09845339
098454           AND  E.OTBND_STAT_TMST  IN                             09845439
098455                (SELECT MIN(B.OTBND_STAT_TMST)                    09845539
098456                   FROM TSUOBTR A                                 09845639
098457                      , TSUOBTS B                                 09845739
098458                  WHERE A.DEST_OPER_UNT_ID = :DK-OPER-UNT-ID      09845839
098459                    AND A.OTBND_TRIP_ID    = B.OTBND_TRIP_ID      09845939
098460                    AND B.OTBND_STAT_TMST IN                      09846039
098461                       (SELECT MAX(C.OTBND_STAT_TMST)             09846139
098462                          FROM TSUOBTS C                          09846239
098463                         WHERE B.OTBND_TRIP_ID = C.OTBND_TRIP_ID  09846339
098464                           AND B.TRIP_STAT_CDE = 'SO')            09846439
098465                 )                                                09846539
098466           WITH UR                                                09846639
098467     END-EXEC.                                                    09846739
098468                                                                  09846839
098469     EVALUATE TRUE                                                09846939
098470         WHEN SQLCODE = ZERO                                      09847039
098471              MOVE  PV-STR-OPEN-DAYS TO PV-DISP-DAYS              09847139
098472              STRING 'TRAILER STATUS FOR '                        09847239
098473                      PV-DISP-DAYS                                09847339
098474                      ' DAYS'            DELIMITED BY SIZE        09847439
098475                                   INTO  ASTRTXO                  09847539
098476                                                                  09847639
098477         WHEN SQLCODE = +100                                      09847739
098478             CONTINUE                                             09847839
098479                                                                  09847939
098480         WHEN SQLWARN0 NOT = SPACES                               09848039
098481         WHEN SQLCODE < +0                                        09848139
098482         WHEN SQLCODE > +0                                        09848239
098483             MOVE '5035-GET-DAYS-SHIPPED   '                      09848339
098484                             TO DP013-PARAGRAPH                   09848439
098485             MOVE 'CALC DAYS TRAILER IN SHIPPED STATUS  '         09848539
098486                             TO DP013-MESSAGE-TEXT (1)            09848639
098487             MOVE SQLCA      TO DP013-SQLCA                       09848739
098488             MOVE 'TSUOBTR'   TO DP013-DB2-TABLE-NAME (1)         09848839
098489             MOVE 'TSUOBTS'   TO DP013-DB2-TABLE-NAME (2)         09848939
098490             SET DP013-DB2-ABEND                                  09849039
098491                             TO TRUE                              09849139
098492             SET DP013-XCTL-DISPLAY-RESTART                       09849239
098493                             TO TRUE                              09849339
098494             PERFORM DP013-0000-PROCESS-ABEND                     09849439
098495     END-EVALUATE.                                                09849539
098496                                                                  09849639
098497                                                                  09849739
098498 5047-GET-STR-OPEN-HIGHLIGHT.                                     09849839
098499     SET  PS-STR-OPEN-HIGHLIGHT-NO  TO  TRUE.                     09849939
098500     MOVE ZEROES  TO  PV-STR-OPEN-HIGH-DAYS.                      09850039
098501                                                                  09850139
098502     EXEC SQL                                                     09850239
098503         SELECT  FUNC_QTY                                         09850339
098504           INTO :PV-STR-OPEN-HIGH-DAYS                            09850439
098505           FROM TKRPRPM                                           09850539
098506         WHERE LOC_ID            = 90                             09850639
098507           AND INTFC_SYS_CDE     = 'KHL'                          09850739
098508           AND SYS_PRC_FUNC_CDE  = 'TROPST'                       09850839
098509           AND FUNC_PRC_STAT_CDE = 'AC'                           09850939
098510           AND FUNC_BEG_TMST    <= CURRENT TIMESTAMP              09851039
098511           AND FUNC_END_TMST    >= CURRENT TIMESTAMP              09851139
098512          WITH UR                                                 09851239
098513     END-EXEC.                                                    09851339
098514                                                                  09851439
098515     EVALUATE TRUE                                                09851539
098516         WHEN SQLCODE = ZERO                                      09851639
098517              IF  PV-STR-OPEN-DAYS >  PV-STR-OPEN-HIGH-DAYS       09851739
098518                  MOVE  DP015-RED   TO  ASTRTXC                   09851839
098519                  SET  ASC-STR-OPEN-GRTR-X-DAYS  TO  TRUE         09851939
098520              ELSE                                                09852039
098521                  MOVE  DP015-BLUE  TO  ASTRTXC                   09852139
098522              END-IF                                              09852234
098523                                                                  09852334
098524         WHEN SQLCODE = +100                                      09852434
098525             CONTINUE                                             09852534
098526                                                                  09852634
098527         WHEN SQLWARN0 NOT = SPACES                               09852734
098528         WHEN SQLCODE < +0                                        09852834
098529         WHEN SQLCODE > +0                                        09852934
098530             MOVE '5047-GET-STR-OPEN-HIGHLIGHT'                   09853034
098531                             TO DP013-PARAGRAPH                   09853134
098532             MOVE 'CHECK DAYS TO HIGHLIGHT STORE OPEN TRLR'       09853234
098533                             TO DP013-MESSAGE-TEXT (1)            09853334
098534             MOVE SQLCA      TO DP013-SQLCA                       09853434
098535             MOVE 'TKRPRPM'   TO DP013-DB2-TABLE-NAME (1)         09853534
098536             SET DP013-DB2-ABEND                                  09853634
098537                             TO TRUE                              09853734
098538             SET DP013-XCTL-DISPLAY-RESTART                       09853834
098539                             TO TRUE                              09853934
098540             PERFORM DP013-0000-PROCESS-ABEND                     09854034
098541     END-EVALUATE.                                                09854134
098542                                                                  09854234
098543                                                                  09854334
098544*----------------------------------------------------------------*09854434
098545*                                                                *09854534
098546*                                                                *09854634
098547*----------------------------------------------------------------*09854734
098548 7000-GET-STORE-NAME.                                             09854834
098549                                                                  09854934
098550     INITIALIZE XL071-COMMAREA-REC.                               09855034
098551     MOVE DK-OPER-UNT-ID  TO XL071-LOCATION-NUMBER.               09855134
098552                                                                  09855234
098560     CALL PC-LOCATION-MODULE  USING DFHEIBLK                      09856034
098600                                    XL071-COMMAREA                09860006
098700                                    XL071-COMMAREA-REC.           09870006
098800                                                                  09880006
098900     IF XL071-NO-ERRORS                                           09890006
099000         MOVE XL071-LOC-NM  TO ASC-STORE-NAME                     09900006
099100     ELSE                                                         09910006
099200         MOVE SPACES        TO ASC-STORE-NAME                     09920006
099300     END-IF.                                                      09930006
099400                                                                  09940006
099500 8000-CALL-RACF.                                                  09950006
099600     EXEC CICS                                                    09960006
099700        LINK PROGRAM  (DP008-SECURITY-SUBROUTINE)                 09970006
099800             COMMAREA (DP008-SECURITY-COMMAREA)                   09980006
099900             LENGTH   (DP008-SECURITY-COMMAREA-LENGTH)            09990006
100000             RESP     (PV-CICS-RESPONSE)                          10000006
100100     END-EXEC.                                                    10010006
100200                                                                  10020006
100300     IF PV-CICS-RESPONSE = DFHRESP (NORMAL)                       10030006
100400        IF DP008-CALL-SUCCESSFUL                                  10040006
100500           CONTINUE                                               10050006
100600        ELSE                                                      10060006
100700           MOVE DP008-ERROR-CODE TO PM-CM-RETURN-CODE             10070006
100800           MOVE PM-CICSAUTH-MESSAGE TO DP013-MESSAGE-TEXT(1)      10080006
100900           SET DP013-CICS-ABEND TO TRUE                           10090006
101000           SET DP013-NO-ROLLBACK TO TRUE                          10100006
101100           MOVE '8000-CHECK-RACF' TO DP013-PARAGRAPH              10110006
101200           PERFORM DP013-0000-PROCESS-ABEND                       10120006
101300        END-IF                                                    10130006
101400     ELSE                                                         10140006
101500        MOVE 'CALL RACF SECURITY PROGRAM' TO DP013-MESSAGE-TEXT(1)10150006
101600        SET DP013-CICS-ABEND TO TRUE                              10160006
101700        SET DP013-NO-ROLLBACK TO TRUE                             10170006
101800        MOVE '8000-CHECK-RACF' TO DP013-PARAGRAPH                 10180006
101900        PERFORM DP013-0000-PROCESS-ABEND                          10190006
102000     END-IF.                                                      10200006
102100                                                                  10210006
102200*----------------------------------------------------------------*10220006
102300*    ABEND PROCESSOR MODULE                                      *10230006
102400*----------------------------------------------------------------*10240006
102500                                                                  10250006
102600     COPY DPPD013.                                                10260006
