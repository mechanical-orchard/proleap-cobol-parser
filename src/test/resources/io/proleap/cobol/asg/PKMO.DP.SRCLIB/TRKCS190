000100*-----------------------*                                         00010099
000200 IDENTIFICATION DIVISION.                                         00020099
000300*-----------------------*                                         00030099
000400 PROGRAM-ID.    TRKCS190.                                         00040099
000500 AUTHOR.        MARGARET MORRISON.                                00050099
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060099
000700 DATE-WRITTEN.  11/98.                                            00070099
000800 DATE-COMPILED.                                                   00080099
000900                                                                  00090099
001000*---------------------------------------------------------------* 00100099
001100*    Y190 - CONTAINER BILL OF LADING LIST.                      * 00110099
001200*                                                               * 00120099
001300*    THIS PROGRAM GENERATES A LIST OF MASTER AND HOUSE BILL OF  * 00130099
001400*    LADINGS FOR A SELECTED CONTAINER.                          * 00140099
001600*---------------------------------------------------------------* 00160099
001700*  11/07/2003 TKMA643 - VISWA KARUTURI                          *         
001701*     REMOVED LOGIC THAT PERTAINS TO COLUMNS FRGT_CHRG_AMT AND  *         
001702*     CONSLR_CHRG_AMT AND ADDED MOM_POL_CDE AND MOM_POR_CDE.    *         
001703*---------------------------------------------------------------* 00160099
C94517*  CHANGED 10/28/2014    BY COGNIZANT       WR: CHG0094517                
C94517*                                                                         
C94517* EXTENDED PO# FROM 7 TO 8 DIGITS WHERE NEEDED.                           
C94517*-----------------------------------------------------------------        
263697* CHANGED 11/08/2021    BY JIM HUNTER      WR: CHG0263697                 
263697* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263697* MAKING THE CALL DYNAMIC VS STATIC.                                      
263697*---------------------------------------------------------------*         
CICS  * CHANGED  1/16/2023    BY JIM HUNTER      WR: CHG0278495                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  *-----------------------------------------------------------------        
001704                                                                  00170099
001800 ENVIRONMENT DIVISION.                                            00180099
001900                                                                  00190099
002000 DATA DIVISION.                                                   00200099
002100                                                                  00210099
002200 WORKING-STORAGE SECTION.                                         00220099
002300                                                                  00230099
002400 01  DK-DB2-KEYS.                                                 00240099
002401     15  DK-CONTNR-NBR                  PIC  X(12)  VALUE SPACE.          
002410     15  DK-CONTNR-SEQ-NBR              PIC S9(04)  COMP.                 
002600                                                                  00260099
002700 01  PC-PROGRAM-CONSTANTS.                                        00270099
002800     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00280099
002900                                                    'TR190A  '.   00290099
003000     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00300099
003100                                                    'TRKM190 '.   00310099
003200     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00320099
003300                                                    'TRKCS190'.   00330099
003400     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00340099
003500     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00350099
003510     05  PC-LIST-FORMAT                 PIC  X(01)  VALUE '4'.            
003600     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +9      00360099
003700                                                    COMP SYNC.    00370099
003800     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00380099
003900                                                    COMP SYNC.    00390099
004000     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00400099
004100                                                    +1000000      00410099
004200                                                    COMP-3.       00420099
004300     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00430099
004400                                                    COMP SYNC.    00440099
004500     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00450099
004600                                                    COMP-3.       00460099
004700     05  PC-INIT-DATE                   PIC  X(10)  VALUE         00470099
004800                                                    '0001-01-01'. 00480099
004801     05  PC-A                           PIC  X(01)  VALUE 'A'.            
004802     05  PC-O                           PIC  X(01)  VALUE 'O'.            
004810     05  PC-POL                         PIC  X(03)  VALUE 'POL'.          
004820     05  PC-POR                         PIC  X(03)  VALUE 'POR'.          
004900     05  PC-TSYMSG-NUMBERS.                                       00490099
005000         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00500099
005100         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00510099
005200         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00520099
005300         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00530099
005400         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00540099
005500         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00550099
005600                                                                  00560099
005700 01  PS-PROGRAM-SWITCHES.                                         00570099
005800     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00580099
005900         88  PS-NO-ERROR                            VALUE 'Y'.    00590099
006000         88  PS-ERROR                               VALUE 'N'.    00600099
006100     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00610099
006200         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00620099
006300         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00630099
006400                                                                  00640099
006500 01  PV-PROGRAM-VARIABLES.                                        00650099
006600     05  PV-SUB                         PIC S9(04)  VALUE +0      00660099
006700                                                    COMP SYNC.    00670099
006800     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00680099
006900                                                    COMP SYNC.    00690099
007000     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      00700099
007100                                                    COMP-3.       00710099
007200     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      00720099
007300                                                    COMP-3.       00730099
007400     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      00740099
007500                                                    COMP-3.       00750099
007600     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      00760099
007700                                                    COMP-3.       00770099
007800     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      00780099
007900                                                    COMP SYNC.    00790099
008000     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      00800099
008100                                                    COMP SYNC.    00810099
008200     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      00820099
008300                                                    COMP SYNC.    00830099
008400     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      00840099
008500                                                    COMP SYNC.    00850099
008600     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      00860099
008700                                                    COMP SYNC.    00870099
008800     05  PV-TAUCNTK-CNT                 PIC S9(04)  VALUE +0      00880099
008900                                                    COMP SYNC.    00890099
009000     05  PV-TIMCNTK-CNT                 PIC S9(04)  VALUE +0      00900099
009100                                                    COMP SYNC.    00910099
009110     05  PV-TRN-CNT                     PIC S9(04)  VALUE +0      00900099
009120                                                    COMP SYNC.    00910099
009130     05  PV-HOLD-ORGN-CDE               PIC X(05)   VALUE SPACES.         
009140     05  PV-HOLD-ORGN-TYP-CDE           PIC X(03)   VALUE SPACES.         
009150     05  PV-HOLD-TRIP-TYP-CDE           PIC X(01)   VALUE SPACES.         
009160                                                                          
009800     05  PV-DATE-BREAK.                                           00980099
009900         10 FILLER                      PIC  X(02).               00990099
010000         10 PV-DB-YY                    PIC  X(02).               01000099
010100         10 FILLER                      PIC  X(01).               01010099
010200         10 PV-DB-MM                    PIC  X(02).               01020099
010300         10 FILLER                      PIC  X(01).               01030099
010400         10 PV-DB-DD                    PIC  X(02).               01040099
010500     05  PV-DATE-DISPLAY.                                         01050099
010600         10 PV-DD-MM                    PIC  X(02).               01060099
010700         10 FILLER                      PIC  X(01)  VALUE '/'.    01070099
010800         10 PV-DD-DD                    PIC  X(02).               01080099
010900         10 FILLER                      PIC  X(01)  VALUE '/'.    01090099
011000         10 PV-DD-YY                    PIC  X(02).               01100099
011100                                                                  01110099
011101     05  PV-SHPMT-TYPE.                                                   
011102         10 PV-SHPMT-FROM-CDE           PIC  X(03).                       
011103         10 FILLER                      PIC  X(01) VALUE '-'.             
011104         10 PV-SHPMT-TO-CDE             PIC  X(03).                       
011110                                                                          
011200*---------------------------------------------------------------* 01120099
011300*    MAP LAYOUT                                                 * 01130099
011400*---------------------------------------------------------------* 01140099
011500                                                                  01150099
011600     COPY TRKM190.                                                01160099
011700                                                                  01170099
011800 01  MR-OCCURS-LAYOUT                    REDEFINES  TR190AO.      01180099
011910     05  FILLER                          PIC X(329).              01190099
012000                                                                  01200099
012100     05  MR-SCROLL-AREA                  OCCURS 9 TIMES.          01210099
012200         10  MR-SELECTL                  PIC S9(04) COMP.         01220099
012300         10  MR-SELECTA                  PIC  X(01).              01230099
012400         10  MR-SELECTC                  PIC  X(01).              01240099
012500         10  MR-SELECTH                  PIC  X(01).              01250099
012600         10  MR-SELECTI                  PIC  X(01).              01260099
012700                                                                  01270099
012800         10  MR-ACTIONL                  PIC S9(04) COMP.         01280099
012900         10  MR-ACTIONA                  PIC  X(01).              01290099
013000         10  MR-ACTIONC                  PIC  X(01).              01300099
013100         10  MR-ACTIONH                  PIC  X(01).              01310099
013200         10  MR-ACTION                   PIC  X(03).              01320099
013300                                                                  01330099
013400         10  MR-PO-NBRL                  PIC S9(04) COMP.         01340099
013500         10  MR-PO-NBRA                  PIC  X(01).              01350099
013600         10  MR-PO-NBRC                  PIC  X(01).              01360099
013700         10  MR-PO-NBRH                  PIC  X(01).              01370099
C94517         10  MR-PO-NBR                   PIC  ZZZZZZZZ.           01380099
013900                                                                  01390099
014000         10  MR-MSTR-BOLL                PIC S9(04) COMP.         01400099
014100         10  MR-MSTR-BOLA                PIC  X(01).              01410099
014200         10  MR-MSTR-BOLC                PIC  X(01).              01420099
014300         10  MR-MSTR-BOLH                PIC  X(01).              01430099
014400         10  MR-MSTR-BOL                 PIC  X(30).              01440099
014500                                                                  01450099
014510         10  MR-HSE-BOLL                 PIC S9(04) COMP.         01400099
014520         10  MR-HSE-BOLA                 PIC  X(01).              01410099
014530         10  MR-HSE-BOLC                 PIC  X(01).              01420099
014540         10  MR-HSE-BOLH                 PIC  X(01).              01430099
014550         10  MR-HSE-BOL                  PIC  X(30).              01440099
014560                                                                  01450099
019700     05  FILLER                          PIC  X(12).              01970099
019800                                                                  01980099
019900 EJECT                                                            01990099
020000*---------------------------------------------------------------* 02000099
020100*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02010099
020200*---------------------------------------------------------------* 02020099
020300                                                                  02030099
020400     COPY DPWS015.                                                02040099
020500                                                                  02050099
020600 EJECT                                                            02060099
020700*---------------------------------------------------------------* 02070099
020800*    FUNCTION KEYS COPYBOOK.                                    * 02080099
020900*---------------------------------------------------------------* 02090099
021000                                                                  02100099
021100     COPY DPWS016.                                                02110099
021200                                                                  02120099
021300 EJECT                                                            02130099
021400*---------------------------------------------------------------* 02140099
021500*    NUMERIC EDIT LAYOUT.                                       * 02150099
021600*---------------------------------------------------------------* 02160099
021700                                                                  02170099
021800     COPY DPWS010I.                                               02180099
021900                                                                  02190099
022000 EJECT                                                            02200099
022100*---------------------------------------------------------------* 02210099
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02220099
022300*---------------------------------------------------------------* 02230099
022400                                                                  02240099
022500     COPY DPWS030.                                                02250099
CICS       COPY DPWS930.                                                02260099
022700 EJECT                                                            02270099
022800*---------------------------------------------------------------* 02280099
022900*    STANDARD COMMAREA.                                         * 02290099
023000*---------------------------------------------------------------* 02300099
023100                                                                  02310099
023200     COPY DPWS020.                                                02320099
023300     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02330099
023400                                                                  02340099
023500*---------------------------------------------------------------* 02350099
023600* INTER-APPLICATION COMMAREA.                                   * 02360099
023700*   TRWS102 - IS THE INPUT LAYOUT WHEN COMING FROM THE PO       * 02370099
023800*             CONTAINER LIST SCREEN.                            * 02380099
023900*---------------------------------------------------------------* 02390099
024000                                                                  02400099
024100         10  INTER-APPL-COMM-AREA       PIC X(200).               02410099
024200     COPY TRWS102.                                                02420099
024300                                                                  02430099
024400*---------------------------------------------------------------* 02440099
024500*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02450099
024600*---------------------------------------------------------------* 02460099
024700         10  ASC-SPECIFIC-COMMAREA.                               02470099
024800             15  ASC-LIST-KEYS.                                   02480099
024801                 20  ASC-KEY-CONTNR-NBR             PIC  X(12).           
024810                 20  ASC-KEY-CONTNR-SEQ-NBR         PIC S9(04)            
025000                                                    COMP.         02500099
025100             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                02510099
025200                 20  ASC-BLOCK-MODIFIED-SW          PIC  X(01).   02520099
025300                     88  ASC-BLOCK-NOT-MODIFIED     VALUE 'N'.    02530099
025400                     88  ASC-BLOCK-MODIFIED         VALUE 'Y'.    02540099
025500                                                                  02550099
025600                 20  ASC-ITEM-ARRAY.                              02560099
025700                     25  ASC-ITEM-ENTRIES OCCURS 9 TIMES.         02570099
025800                         30  ASC-LIST-ITEM-NUMBER                 02580099
025900                                                    PIC S9(09)    02590099
026000                                                    COMP-3.       02600099
026100                         30  ASC-TEMP-SELECTED-SW   PIC  X(01).   02610099
026200                             88  ASC-VALID-SELECT   VALUE ' '     02620099
026300                                                          'S'     02630099
026400                                                          'B'     02640099
026500                                                          'E'.    02650099
026600                             88  ASC-TEMP-NO-SELECT VALUE ' '.    02660099
026700                             88  ASC-TEMP-SELECT    VALUE 'S'.    02670099
026800                             88  ASC-TEMP-BEGIN     VALUE 'B'.    02680099
026900                             88  ASC-TEMP-END       VALUE 'E'.    02690099
027000                         30  ASC-SELECTED-SW        PIC  X(01).   02700099
027100                             88  ASC-NO-SELECT      VALUE ' '.    02710099
027200                             88  ASC-SELECT         VALUE 'S'.    02720099
027300                             88  ASC-BEGIN          VALUE 'B'.    02730099
027400                             88  ASC-END            VALUE 'E'.    02740099
027500                         30  ASC-ACTION             PIC  X(03).   02750099
027600                         30  ASC-PO-NBR             PIC S9(09)    02760099
027610                                                    COMP.                 
027700                         30  ASC-MSTR-BOL           PIC  X(30).   02770099
027710                         30  ASC-HSE-BOL            PIC  X(30).   02770099
028900                                                                  02890099
029000             15  ASC-BLK-SUB                         PIC S9(04)   02900099
029100                                                          COMP    02910099
029200                                                          SYNC.   02920099
029300             15  ASC-ITEM-SUB                        PIC S9(04)   02930099
029400                                                          COMP    02940099
029500                                                          SYNC.   02950099
029600             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   02960099
029700                                                          COMP-3. 02970099
029800             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   02980099
029900                                                          COMP-3. 02990099
030000             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03000099
030100                                                          COMP-3. 03010099
030200             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   03020099
030300                                                          COMP-3. 03030099
030400             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03040099
030500                                                          COMP-3. 03050099
030600             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   03060099
030700                                                          COMP    03070099
030800                                                          SYNC.   03080099
030900             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03090099
031000                                                          COMP-3. 03100099
031100             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03110099
031200                                                          COMP-3. 03120099
031300             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03130099
031400                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   03140099
031500                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   03150099
031600             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  03160099
031700                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   03170099
031800                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   03180099
031900             15  ASC-LIST-QUEUE-NAME.                             03190099
032000                 20  ASC-LIST-TERM-ID                PIC  X(04).  03200099
032100                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   03210099
032200                                                          COMP-3. 03220099
032300                 20  ASC-LIST-SEQ                    PIC  9(01).  03230099
032400             15  ASC-SEL-QUEUE-NAME.                              03240099
032500                 20  ASC-SEL-TERM-ID                 PIC  X(04).  03250099
032600                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   03260099
032700                                                          COMP-3. 03270099
032800                 20  ASC-SEL-SEQ                     PIC  9(01).  03280099
032900             15  ASC-START-ITEM-REQUEST.                          03290099
033000                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  03300099
033100                                                                  03310099
033200 EJECT                                                            03320099
033300*---------------------------------------------------------------* 03330099
033400*    ABEND PROCESSING COPYBOOK.                                 * 03340099
033500*---------------------------------------------------------------* 03350099
033600                                                                  03360099
033700     COPY DPWS013.                                                03370099
033800                                                                  03380099
033900 EJECT                                                            03390099
033901*---------------------------------------------------------------*         
033902*    DB2 AREA FOR TIMCNTK - CONTAINER MANIFEST TABLE            *         
033903*---------------------------------------------------------------*         
033904     EXEC SQL                                                             
033905          INCLUDE TIMCNTK                                                 
033906     END-EXEC.                                                            
033907*---------------------------------------------------------------*         
033908*    DB2 AREA FOR TIMCNPO - CONTAINER PURCHASE ORDER TABLE      *         
033909*---------------------------------------------------------------*         
033910     EXEC SQL                                                             
033911          INCLUDE TIMCNPO                                                 
033912     END-EXEC.                                                            
033913*---------------------------------------------------------------*         
033914*    DB2 AREA FOR TIMFOB - IMPORTS FREE ON BOARD TABLE          *         
033915*---------------------------------------------------------------*         
033916     EXEC SQL                                                             
033917          INCLUDE TIMFOB                                                  
033918     END-EXEC.                                                            
033919*---------------------------------------------------------------*         
033920*    DB2 AREA FOR TIMPOE - IMPORTS PORT OF ENTRY TABLE          *         
033921*---------------------------------------------------------------*         
033922     EXEC SQL                                                             
033923          INCLUDE TIMPOE                                                  
033924     END-EXEC.                                                            
033925*---------------------------------------------------------------*         
033926*    DB2 AREA FOR TAUCNTK - CONTAINER MANIFEST AUDIT TABLE      *         
033927*---------------------------------------------------------------*         
033928     EXEC SQL                                                             
033929          INCLUDE TAUCNTK                                                 
033930     END-EXEC.                                                            
033940*---------------------------------------------------------------*         
033950*    DB2 AREA FOR TRT_IMPRT_ORGN                                *         
033960*---------------------------------------------------------------*         
033970     EXEC SQL                                                             
033980          INCLUDE TRT00010                                                
033990     END-EXEC.                                                            
038200*---------------------------------------------------------------* 03820099
038300*    DB2 AREA FOR COMMUNICATIONS                                * 03830099
038400*---------------------------------------------------------------* 03840099
038500     EXEC SQL                                                     03850099
038600          INCLUDE SQLCA                                           03860099
038700     END-EXEC.                                                    03870099
038800*---------------------------------------------------------------* 03880099
038900*    CURSOR FOR CONTAINER MASTER AND HOUSE BILL OF LADINGS.     * 03890099
039000*---------------------------------------------------------------* 03900099
039100                                                                  03910099
039200     EXEC SQL                                                     03920099
039300          DECLARE  BOL-CSR CURSOR                                 03930099
039400              FOR  SELECT                                         03940099
039500                   PO_NBR                                         03950099
039600                 , MSTR_BOL_NBR                                   03960099
039700                 , HSE_BOL_NBR                                    03970099
040600            FROM   TIMCNPO                                        04060099
040700           WHERE   CONTNR_ID      = :DK-CONTNR-NBR                04070099
040710             AND   CONTNR_SEQ_NBR = :DK-CONTNR-SEQ-NBR                    
040800        ORDER BY   PO_NBR                                         04080099
040900     END-EXEC.                                                    04090099
041000                                                                  04100099
041100 EJECT                                                            04110099
041101                                                                          
041102*---------------------------------------------------------------*         
041103*    CURSOR DECLARATION FOR SELECTING POE CODE.                 *         
041104*---------------------------------------------------------------*         
041105                                                                          
041106     EXEC SQL                                                             
041107          DECLARE  POE-CSR CURSOR                                         
041108              FOR  SELECT DISTINCT                                        
041109                   POE_CDE                                                
041110             FROM  TIMPOE                                                 
041111            WHERE  POE_STD_EDI_CDE = :IMCNTK-MOM-DEST-POE-CDE             
041112              AND  STAT_CDE        = 'A'                                  
041113         ORDER BY  POE_CDE                                                
041114     END-EXEC.                                                            
041120                                                                          
041200 EJECT                                                                    
043000*----------------------------------------------------------------*04300099
043100 LINKAGE SECTION.                                                 04310099
043200                                                                  04320099
043300 01  DFHCOMMAREA.                                                 04330099
043400     05  FILLER                         OCCURS  1 TO 4072 TIMES   04340099
043500                                        DEPENDING ON EIBCALEN.    04350099
043600         10  FILLER                     PIC X.                    04360099
043700                                                                  04370099
043800 EJECT                                                            04380099
043900*----------------------------------------------------------------*04390099
044000 PROCEDURE DIVISION.                                              04400099
044100*----------------------------------------------------------------*04410099
044200*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM.  *04420099
044300*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM   *04430099
044400*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT.  *04440099
044500*----------------------------------------------------------------*04450099
044600 0000-MAIN-MODULE.                                                04460099
044700                                                                  04470099
044800     INITIALIZE DP030-CICS-API-FIELDS.                            04480099
044900     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04490099
045000     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04500099
045100     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04510099
045200     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04520099
045300     MOVE LENGTH OF TR190AI        TO DP030-MAP-LENGTH (1).       04530099
045400     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04540099
045500     PERFORM 0001-CALL-CICS-ARCH-API.                             04550099
045600                                                                  04560099
045700     PERFORM 1000-CONTROL-PROCESSING                              04570099
045800                                                                  04580099
045900     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04590099
046000     PERFORM 0001-CALL-CICS-ARCH-API.                             04600099
046100                                                                  04610099
046200*----------------------------------------------------------------*04620099
046300*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *04630099
046400*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *04640099
046500*----------------------------------------------------------------*04650099
046600 0001-CALL-CICS-ARCH-API.                                         04660099
046700                                                                  04670099
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04680099
046900                                    DFHCOMMAREA                           
047000                                    DP030-CICS-API-FIELDS                 
047100                                    DP020-STANDARD-COMMAREA               
047200                                    TR190AI.                              
047300                                                                  04730099
047400     IF  DP030-RC-CALL-SUCCESSFUL                                 04740099
047500         CONTINUE                                                 04750099
047600     ELSE                                                         04760099
047700         SET DP013-NO-ROLLBACK                                    04770099
047800             DP013-XCTL-DISPLAY-RESTART                           04780099
047900             DP013-CICS-ABEND      TO TRUE                        04790099
048000         MOVE '0001-CALL-CICS-ARCH-API'                           04800099
048100                                   TO DP013-PARAGRAPH             04810099
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04820099
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04830099
048400         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      04840099
048500         PERFORM DP013-0000-PROCESS-ABEND                         04850099
048600     END-IF.                                                      04860099
048700                                                                  04870099
048800 EJECT                                                            04880099
048900*----------------------------------------------------------------*04890099
049000* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *04900099
049100* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *04910099
049200*                                                                *04920099
049300* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *04930099
049400*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *04940099
049500*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *04950099
049600*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *04960099
049700*----------------------------------------------------------------*04970099
049800 1000-CONTROL-PROCESSING.                                         04980099
049900                                                                  04990099
050000     EVALUATE TRUE                                                05000099
050100         WHEN DP020-NEXT-ACT-INITIAL                              05010099
050200             INITIALIZE ASC-SPECIFIC-COMMAREA                     05020099
050300             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            05030099
050400                                      ASC-SEL-TERM-ID             05040099
050500             MOVE DP020-SRC-TASK-NUMBER                           05050099
050600                                   TO ASC-LIST-TASK-NUMBER        05060099
050700                                      ASC-SEL-TASK-NUMBER         05070099
050800             MOVE PC-LIST-QUEUE-SEQ                               05080099
050900                                   TO ASC-LIST-SEQ                05090099
051000             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 05100099
051100             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05110099
051200*-------$TEMPLATE NOTE$------------------------------------------*05120099
051300* IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,* 05130099
051400* SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO *  05140099
051500* TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.* 05150099
051600*----------------------------------------------------------------*05160099
051700             IF  PS-COMMAREA-NOT-VALID                            05170099
051800                 SET DP020-NEXT-ACT-APPL-ERROR                    05180099
051900                                   TO TRUE                        05190099
052000             ELSE                                                 05200099
052100                 PERFORM 4000-BUILD-INITIAL-PANEL                 05210099
052200             END-IF                                               05220099
052300                                                                  05230099
052400         WHEN DP020-NEXT-ACT-READ-MAP                             05240099
052500             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05250099
052600                                   TO PV-TOP-ITEM                 05260099
052700             PERFORM 2000-PROCESS-PANEL                           05270099
052800                                                                  05280099
052900         WHEN DP020-NEXT-ACT-RETURN                               05290099
053000             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05300099
053100                                   TO PV-TOP-ITEM                 05310099
053200             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05320099
053300             MOVE ASC-KEY-CONTNR-NBR     TO DK-CONTNR-NBR         05330099
053301             MOVE ASC-KEY-CONTNR-SEQ-NBR TO DK-CONTNR-SEQ-NBR     05330099
053400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05340099
053500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05350099
053600                                                                  05360099
053700         WHEN OTHER                                               05370099
053800             SET DP013-LOGIC-ABEND TO TRUE                        05380099
053900             SET DP013-NO-ROLLBACK TO TRUE                        05390099
054000             MOVE '1000-CONTROL-PROCESSING'                       05400099
054100                                   TO DP013-PARAGRAPH             05410099
054200             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05420099
054300                                   TO DP013-MESSAGE-TEXT(1)       05430099
054400             PERFORM DP013-0000-PROCESS-ABEND                     05440099
054500     END-EVALUATE.                                                05450099
054600                                                                  05460099
054700 EJECT                                                            05470099
054800*----------------------------------------------------------------*05480099
054900* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *05490099
055000* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *05500099
055100*----------------------------------------------------------------*05510099
055200 1100-PROCESS-INTER-APPL-COMM.                                    05520099
055300                                                                  05530099
055400     SET PS-COMMAREA-VALID         TO TRUE.                       05540099
055500     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     05550099
055600                                                                  05560099
055601     IF  DP020-INT-APPL-FORMAT-IND = PC-LIST-FORMAT                       
055602          MOVE TR102-CONTNR-NO                                            
055603                                   TO ASC-KEY-CONTNR-NBR                  
055604                                      DK-CONTNR-NBR                       
055605          MOVE TR102-CONTNR-SEQ-NO                                        
055606                                   TO ASC-KEY-CONTNR-SEQ-NBR              
055610                                      DK-CONTNR-SEQ-NBR                   
056300     END-IF.                                                      05630099
056400                                                                  05640099
056500 EJECT                                                            05650099
056600*----------------------------------------------------------------*05660099
056700* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *05670099
056800* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *05680099
056900* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *05690099
057000* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *05700099
057100* FUNCTION KEYS CAN GET THIS FAR.                                *05710099
057200*----------------------------------------------------------------*05720099
057300 2000-PROCESS-PANEL.                                              05730099
057400                                                                  05740099
057500     EVALUATE TRUE                                                05750099
057600         WHEN DP020-SRC-AID = DP016-CLEAR                         05760099
057700             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05770099
057800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05780099
057900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05790099
058000                                                                  05800099
058100         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    05810099
058200             MOVE ASC-KEY-CONTNR-NBR     TO DK-CONTNR-NBR                 
058210             MOVE ASC-KEY-CONTNR-SEQ-NBR TO DK-CONTNR-SEQ-NBR     05820099
058300             PERFORM 2050-DELETE-LIST-QUEUE                       05830099
058400             PERFORM 4000-BUILD-INITIAL-PANEL                     05840099
058500                                                                  05850099
058600         WHEN OTHER                                               05860099
058700             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 05870099
058800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05880099
058900             IF  PS-NO-ERROR                                      05890099
059000                 SET DP030-CONTINUE-GO                            05900099
059100                                 TO TRUE                          05910099
059200                 PERFORM 2100-CHECK-FUNCTION-KEY                  05920099
059300             ELSE                                                 05930099
059400                 SET DP030-OVERRIDE-GO                            05940099
059500                                 TO TRUE                          05950099
059600             END-IF                                               05960099
059700     END-EVALUATE.                                                05970099
059800                                                                  05980099
059900 EJECT                                                            05990099
060000*----------------------------------------------------------------*06000099
060100*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *06010099
060200*----------------------------------------------------------------*06020099
060300 2050-DELETE-LIST-QUEUE.                                          06030099
060400                                                                  06040099
060500     EXEC CICS                                                    06050099
060600         DELETEQ TS                                               06060099
060700             QUEUE (ASC-LIST-QUEUE-NAME)                          06070099
060800             RESP  (PV-CICS-RESP)                                 06080099
060900     END-EXEC.                                                    06090099
061000                                                                  06100099
061100     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       06110099
061200        (PV-CICS-RESP = DFHRESP(QIDERR))                          06120099
061300         CONTINUE                                                 06130099
061400     ELSE                                                         06140099
061500         SET DP013-CICS-ABEND      TO TRUE                        06150099
061600         SET DP013-NO-ROLLBACK     TO TRUE                        06160099
061700                                                                  06170099
061800         MOVE '2050-DELETE-LIST-QUEUE'                            06180099
061900                                   TO DP013-PARAGRAPH             06190099
062000         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    06200099
062100                                   TO DP013-MESSAGE-TEXT (1)      06210099
062200         PERFORM DP013-0000-PROCESS-ABEND                         06220099
062300     END-IF.                                                      06230099
062400                                                                  06240099
062500     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  06250099
062600                                                                  06260099
062700 EJECT                                                            06270099
062800*----------------------------------------------------------------*06280099
062900* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*06290099
063000* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *06300099
063100* CICS ARCHITECTURE API.                                         *06310099
063200*----------------------------------------------------------------*06320099
063300 2100-CHECK-FUNCTION-KEY.                                         06330099
063400                                                                  06340099
063500     EVALUATE TRUE                                                06350099
063600                                                                  06360099
063700         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  06370099
063800             MOVE +1               TO PV-TOP-ITEM                 06380099
063910             MOVE ASC-KEY-CONTNR-NBR     TO DK-CONTNR-NBR                 
063920             MOVE ASC-KEY-CONTNR-SEQ-NBR TO DK-CONTNR-SEQ-NBR             
064000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06400099
064100             PERFORM 3200-RESET-ATTRIBUTES                        06410099
064200                                                                  06420099
064300         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   06430099
064400             PERFORM 2110-BROWSE-BACKWARD                         06440099
064410             MOVE ASC-KEY-CONTNR-NBR     TO DK-CONTNR-NBR                 
064420             MOVE ASC-KEY-CONTNR-SEQ-NBR TO DK-CONTNR-SEQ-NBR             
064600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06460099
064700             PERFORM 3200-RESET-ATTRIBUTES                        06470099
064800                                                                  06480099
064900         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   06490099
065000             PERFORM 2120-BROWSE-FORWARD                          06500099
065010             MOVE ASC-KEY-CONTNR-NBR     TO DK-CONTNR-NBR                 
065020             MOVE ASC-KEY-CONTNR-SEQ-NBR TO DK-CONTNR-SEQ-NBR             
065200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06520099
065300                                                                  06530099
065400         WHEN DP020-SRC-AID = DP016-ENTER                         06540099
065500             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   06550099
065600             IF  PS-ERROR                                         06560099
065700                 CONTINUE                                         06570099
065800             ELSE                                                 06580099
065900                 MOVE ASC-KEY-CONTNR-NBR     TO                           
065901                  DK-CONTNR-NBR                                           
065902                 MOVE ASC-KEY-CONTNR-SEQ-NBR TO                           
065903                  DK-CONTNR-SEQ-NBR                                       
066000                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06600099
066100                 PERFORM 3200-RESET-ATTRIBUTES                    06610099
066200             END-IF                                               06620099
066300                                                                  06630099
066400         WHEN OTHER                                               06640099
066500             SET DP013-NO-ROLLBACK                                06650099
066600                 DP013-XCTL-DISPLAY-RESTART                       06660099
066700                 DP013-CICS-ABEND  TO TRUE                        06670099
066800             MOVE '2100-CHECK-FUNCTION-KEY'                       06680099
066900                                   TO DP013-PARAGRAPH             06690099
067000             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      06700099
067100                                   TO DP013-MESSAGE-TEXT (1)      06710099
067200             PERFORM DP013-0000-PROCESS-ABEND                     06720099
067300     END-EVALUATE.                                                06730099
067400                                                                  06740099
067500 EJECT                                                            06750099
067600*----------------------------------------------------------------*06760099
067700*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *06770099
067800*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *06780099
067900*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *06790099
068000*    MESSAGE.                                                    *06800099
068100*----------------------------------------------------------------*06810099
068200 2110-BROWSE-BACKWARD.                                            06820099
068300                                                                  06830099
068400     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    06840099
068500         GIVING PV-TOP-ITEM.                                      06850099
068600*                                                                 06860099
068700     IF  ((PV-TOP-ITEM < +1)                                      06870099
068800       OR (PV-TOP-ITEM = +1))                                     06880099
068900         MOVE +1                   TO PV-TOP-ITEM                 06890099
069000*------- TOP OF LIST --------                                     06900099
069100         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            06910099
069200         SET DP020-MSG-INFORMATIONAL TO TRUE                      06920099
069300     END-IF.                                                      06930099
069400                                                                  06940099
069500 EJECT                                                            06950099
069600*----------------------------------------------------------------*06960099
069700*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *06970099
069800*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *06980099
069900*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *06990099
070000*----------------------------------------------------------------*07000099
070100 2120-BROWSE-FORWARD.                                             07010099
070200                                                                  07020099
070300     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              07030099
070400         GIVING PV-TOP-ITEM.                                      07040099
070500     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   07050099
070600         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07060099
070700                                   TO PV-TOP-ITEM                 07070099
070800*------- BOTTOM OF LIST -----------                               07080099
070900         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            07090099
071000         SET DP020-MSG-INFORMATIONAL                              07100099
071100                                   TO TRUE                        07110099
071200     ELSE                                                         07120099
071300         COMPUTE PV-BOTTOM-ITEM =                                 07130099
071400             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 07140099
071500         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            07150099
071600*------------BOTTOM OF LIST ---------                             07160099
071700             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            07170099
071800             SET DP020-MSG-INFORMATIONAL                          07180099
071900                                   TO TRUE                        07190099
072000         END-IF                                                   07200099
072100     END-IF.                                                      07210099
072200                                                                  07220099
072300 EJECT                                                            07230099
072400*----------------------------------------------------------------*07240099
072500*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *07250099
072600*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *07260099
072700*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *07270099
072800*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *07280099
072900*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *07290099
073000*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *07300099
073100*----------------------------------------------------------------*07310099
073200 2130-CHECK-FOR-JUMP-BROWSE.                                      07320099
073300                                                                  07330099
073400     SET PS-NO-ERROR               TO TRUE.                       07340099
073500     IF (ASC-START-ITEM-REQUEST = SPACE)                          07350099
073600         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07360099
073700                                   TO PV-TOP-ITEM                 07370099
073800     ELSE                                                         07380099
073900         MOVE ASC-START-ITEM-REQUEST                              07390099
074000                                   TO DP010I-UNEDITED-FIELD       07400099
074100         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       07410099
074200         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     07420099
074300         SET DP010I-NEGATIVE-NOT-ALLOWED                          07430099
074400                                   TO TRUE                        07440099
263697         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263697              USING DP010I-NUMERIC-EDIT-AREA                              
074600                                                                  07460099
074700         IF  NOT DP010I-ERROR-DETECTED                            07470099
074800             MOVE DP010I-NUMERIC-FIELD                            07480099
074900                                   TO  ASC-START-ITEM-REQUEST-N   07490099
075000             IF  ASC-START-ITEM-REQUEST-N > ZERO                  07500099
075100                 IF  ASC-START-ITEM-REQUEST-N >                   07510099
075200                                          ASC-NUMBER-OF-ITEMS-READ07520099
075300                     MOVE SPACE TO ASC-START-ITEM-REQUEST         07530099
075400                     COMPUTE PV-TOP-ITEM =                        07540099
075500                             ASC-NUMBER-OF-ITEMS-READ             07550099
075600                             - PC-ITEMS-PER-PANEL + 1             07560099
075700                     IF  PV-TOP-ITEM < +1                         07570099
075800                         MOVE +1   TO PV-TOP-ITEM                 07580099
075900                         MOVE PC-TSYMSG-00070                     07590099
076000                                   TO DP020-MSG-NUMBER            07600099
076100                         SET DP020-MSG-INFORMATIONAL              07610099
076200                                   TO TRUE                        07620099
076300                     END-IF                                       07630099
076400                 ELSE                                             07640099
076500                     MOVE ASC-START-ITEM-REQUEST-N                07650099
076600                                   TO PV-TOP-ITEM                 07660099
076700                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      07670099
076800                     COMPUTE PV-BOTTOM-ITEM =                     07680099
076900                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     07690099
077000                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ07700099
077100*----------------------- BOTTOM OF LIST --------------            07710099
077200                         MOVE PC-TSYMSG-00070                     07720099
077300                                   TO DP020-MSG-NUMBER            07730099
077400                         SET DP020-MSG-INFORMATIONAL              07740099
077500                                   TO TRUE                        07750099
077600                     END-IF                                       07760099
077700                 END-IF                                           07770099
077800             ELSE                                                 07780099
077900*--------------- VALUE OUT OF RANGE ------------------            07790099
078000                 MOVE PC-TSYMSG-00101                             07800099
078100                                   TO DP020-MSG-NUMBER            07810099
078200                 MOVE -1           TO ASTRTITL                    07820099
078300                 SET DP030-SET-CURSOR-APPL-1                      07830099
078400                                   TO TRUE                        07840099
078500                 MOVE DP015-REVERSE                               07850099
078600                                   TO ASTRTITH                    07860099
078700                 MOVE DP015-RED    TO ASTRTITC                    07870099
078800                 MOVE DP015-UNP-NUM-BRT-MDT                       07880099
078900                                   TO ASTRTITA                    07890099
079000                 SET DP020-MSG-FATAL                              07900099
079100                                   TO TRUE                        07910099
079200                 SET PS-ERROR      TO TRUE                        07920099
079300             END-IF                                               07930099
079400                                                                  07940099
079500         ELSE                                                     07950099
079600             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            07960099
079700             MOVE -1               TO ASTRTITL                    07970099
079800             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07980099
079900             MOVE DP015-REVERSE    TO ASTRTITH                    07990099
080000             MOVE DP015-RED        TO ASTRTITC                    08000099
080100             MOVE DP015-UNP-NUM-BRT-MDT                           08010099
080200                                   TO ASTRTITA                    08020099
080300             SET DP020-MSG-FATAL   TO TRUE                        08030099
080400             SET PS-ERROR          TO TRUE                        08040099
080500         END-IF                                                   08050099
080600     END-IF.                                                      08060099
080700                                                                  08070099
080800 EJECT                                                            08080099
080900*----------------------------------------------------------------*08090099
081000*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *08100099
081100*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *08110099
081200*----------------------------------------------------------------*08120099
081300 2200-MOVE-SCREEN-TO-COMMAREA.                                    08130099
081400                                                                  08140099
081500     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             08150099
081600     MOVE +1                       TO PV-SUB.                     08160099
081700                                                                  08170099
081800     PERFORM 3100-SET-SUBSCRIPTS.                                 08180099
081900     IF  ASTRTITL > ZERO                                          08190099
082000         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          08200099
082100     ELSE                                                         08210099
082200         IF  ASTRTITF = DP015-ERASE-EOF                           08220099
082300             INITIALIZE ASC-START-ITEM-REQUEST                    08230099
082400         END-IF                                                   08240099
082500     END-IF.                                                      08250099
082600                                                                  08260099
082700 EJECT                                                            08270099
082800*----------------------------------------------------------------*08280099
082900*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *08290099
083000*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *08300099
083100*----------------------------------------------------------------*08310099
083200 3000-EDIT-DATA-IN-COMMAREA.                                      08320099
083300                                                                  08330099
083400     SET PS-NO-ERROR               TO TRUE.                       08340099
083500     PERFORM 3200-RESET-ATTRIBUTES.                               08350099
083600     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     08360099
083700*----------------------------------------------------------------*08370099
083800* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED. *            08380099
083900* EDITTING IS DONE FROM THE BOTTOM UP. *                          08390099
084000*----------------------------------------------------------------*08400099
084100     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       08410099
084200         ASC-ITEMS-DISPLAYED - 1.                                 08420099
084300     PERFORM 3100-SET-SUBSCRIPTS.                                 08430099
084400                                                                  08440099
084500 EJECT                                                            08450099
084600*----------------------------------------------------------------*08460099
084700*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *08470099
084800*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*08480099
084900*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *08490099
085000*                                                                *08500099
085100*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *08510099
085200*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *08520099
085300*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *08530099
085400*    US IN THE 2ND BLOCK OF THE ARRAY.                           *08540099
085500*----------------------------------------------------------------*08550099
085600 3100-SET-SUBSCRIPTS.                                             08560099
085700                                                                  08570099
085800     COMPUTE ASC-ITEM-SUB =                                       08580099
085900         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        08590099
086000                                                                  08600099
086100     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         08610099
086200         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            08620099
086300                                                                  08630099
086400         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               08640099
086500     ELSE                                                         08650099
086600         MOVE +1                     TO ASC-BLK-SUB               08660099
086700     END-IF.                                                      08670099
086800                                                                  08680099
086900 EJECT                                                            08690099
087000*----------------------------------------------------------------*08700099
087100*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *08710099
087200*----------------------------------------------------------------*08720099
087300 3200-RESET-ATTRIBUTES.                                           08730099
087400                                                                  08740099
087500     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   08750099
087600     MOVE DP015-GREEN              TO ASTRTITC.                   08760099
087700     MOVE DP015-UNDERLINE          TO ASTRTITH.                   08770099
087800                                                                  08780099
087900     PERFORM                                                      08790099
088000         VARYING PV-SUB                                           08800099
088100         FROM 1 BY 1                                              08810099
088200         UNTIL PV-SUB > (PC-ITEMS-PER-PANEL  OR                   08820099
088300                         ASC-ITEMS-DISPLAYED)                     08830099
088400*        MOVE DP015-UNP-ALP-NOR-OFF                               08840099
088500*                                  TO MR-SELECTA (PV-SUB)         08850099
088600*        MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         08860099
088700*        MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         08870099
088800                                                                  08880099
088900         MOVE DP015-ASK-DRK-OFF                                   08890099
089000                                   TO MR-SELECTA (PV-SUB)         08900099
089100         MOVE DP015-HL-OFF         TO MR-SELECTH (PV-SUB)         08910099
089200     END-PERFORM.                                                 08920099
089300                                                                  08930099
089400 EJECT                                                            08940099
089500*----------------------------------------------------------------*08950099
089600*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *08960099
089700*    INITIALIZE ALL COUNTERS AND FLAGS.                          *08970099
089800*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *08980099
089900*    DISPLAY THE PANEL TO USER.                                  *08990099
090000*----------------------------------------------------------------*09000099
090100 4000-BUILD-INITIAL-PANEL.                                        09010099
090200                                                                  09020099
090300     INITIALIZE                 ASC-BLOCK-ENTRIES (1)             09030099
090400                                ASC-BLOCK-ENTRIES (2).            09040099
090500     MOVE +1                 TO ASC-BLK-SUB.                      09050099
090600     SET ASC-ITEMS-LEFT-ON-DB                                     09060099
090700                             TO TRUE.                             09070099
090800                                                                  09080099
090900     MOVE +0                 TO ASC-ITEM-SUB                      09090099
091000                                ASC-NUMBER-OF-ITEMS-READ          09100099
091100                                ASC-NUMBER-OF-SELECTED-ITEMS      09110099
091200                                ASC-HIGHEST-BLOCK-WRITTEN         09120099
091300                                ASC-START-OF-SELECTED-RANGE       09130099
091400                                ASC-END-OF-SELECTED-RANGE         09140099
091500                                ASC-ITEM-AT-TOP-OF-PANEL.         09150099
091600     PERFORM 4010-OPEN-CURSOR.                                    09160099
091700                                                                  09170099
091800     PERFORM 4300-READ-ITEMS-FROM-DB.                             09180099
091900                                                                  09190099
092000     PERFORM 4020-CLOSE-CURSOR.                                   09200099
092100                                                                  09210099
092200     MOVE +1                   TO  PV-TOP-ITEM.                   09220099
092300     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          09230099
092400         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    09240099
092500         SET DP020-MSG-FATAL   TO  TRUE                           09250099
092600*------- PURCHASE ORDER DOES NOT EXIST                            09260099
092700         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               09270099
092800     ELSE                                                         09280099
092900         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     09290099
093000     END-IF.                                                      09300099
093100                                                                  09310099
093200 EJECT                                                            09320099
093300*----------------------------------------------------------------*09330099
093400*   OPEN THE CONTAINER BILL OF LADING CURSOR                     *09340099
093500*----------------------------------------------------------------*09350099
093600 4010-OPEN-CURSOR.                                                09360099
093700                                                                  09370099
093800     PERFORM                                                      09380099
093900         WITH TEST AFTER                                          09390099
094000         VARYING PV-RETRY-COUNTER                                 09400099
094100         FROM 1 BY 1                                              09410099
094200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09420099
094300                   OR (SQLCODE = ZERO))                           09430099
094400                                                                  09440099
094500         MOVE 'CURSOR:  BOL-CSR'     TO DP013-MESSAGE-TEXT (2)    09450099
094600                                                                  09460099
094700         EXEC SQL                                                 09470099
094800              OPEN BOL-CSR                                        09480099
094900         END-EXEC                                                 09490099
095000                                                                  09500099
095100         EVALUATE TRUE                                            09510099
095200             WHEN SQLCODE = ZERO                                  09520099
095300             WHEN SQLCODE = -904                                  09530099
095400             WHEN SQLCODE = -913                                  09540099
095500                 CONTINUE                                         09550099
095600             WHEN SQLWARN0 NOT = SPACES                           09560099
095700             WHEN SQLCODE < ZERO                                  09570099
095800             WHEN SQLCODE > ZERO                                  09580099
095900                 MOVE '4010-OPEN-CURSOR'                          09590099
096000                                   TO DP013-PARAGRAPH             09600099
096100                 MOVE 'OPEN BOL CURSOR - '                        09610099
096200                                   TO DP013-MESSAGE-TEXT (1)      09620099
096300                 MOVE SQLCA        TO DP013-SQLCA                 09630099
096400                 MOVE 'TIMCNPO '   TO DP013-DB2-TABLE-NAME (1)    09640099
096500                 SET DP013-DB2-ABEND                              09650099
096600                     DP013-XCTL-DISPLAY-RESTART TO TRUE           09660099
096700                 PERFORM DP013-0000-PROCESS-ABEND                 09670099
096800         END-EVALUATE                                             09680099
096900     END-PERFORM.                                                 09690099
097000*                                                                 09700099
097100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09710099
097200         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             09720099
097300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   09730099
097400                                   TO DP013-MESSAGE-TEXT (1)      09740099
097500         MOVE SQLCA                TO DP013-SQLCA                 09750099
097600         MOVE 'TIMCNPO '           TO DP013-DB2-TABLE-NAME (1)    09760099
097700         SET DP013-DB2-ABEND                                      09770099
097800             DP013-XCTL-DISPLAY-RESTART                           09780099
097900                                   TO TRUE                        09790099
098000         PERFORM DP013-0000-PROCESS-ABEND                         09800099
098100     END-IF.                                                      09810099
098200                                                                  09820099
098300 EJECT                                                            09830099
098400*----------------------------------------------------------------*09840099
098500*   CLOSE THE CONTAINER BILL OF LADING CURSOR                    *09850099
098600*----------------------------------------------------------------*09860099
098700 4020-CLOSE-CURSOR.                                               09870099
098800                                                                  09880099
098900     EXEC SQL                                                     09890099
099000          CLOSE BOL-CSR                                           09900099
099100     END-EXEC.                                                    09910099
099200                                                                  09920099
099300     EVALUATE TRUE                                                09930099
099400         WHEN SQLCODE = ZERO                                      09940099
099500             CONTINUE                                             09950099
099600         WHEN SQLWARN0 NOT = SPACES                               09960099
099700         WHEN SQLCODE < ZERO                                      09970099
099800         WHEN SQLCODE > ZERO                                      09980099
099900             MOVE '4020-CLOSE-CURSOR'                             09990099
100000                               TO DP013-PARAGRAPH                 10000099
100100             MOVE 'CLOSE BOL CURSOR '                             10010099
100200                               TO DP013-MESSAGE-TEXT (1)          10020099
100300             MOVE SQLCA        TO DP013-SQLCA                     10030099
100400             MOVE 'TIMCNPO '   TO DP013-DB2-TABLE-NAME (1)        10040099
100500             SET DP013-DB2-ABEND                                  10050099
100600                 DP013-XCTL-DISPLAY-RESTART TO TRUE               10060099
100700             PERFORM DP013-0000-PROCESS-ABEND                     10070099
100800     END-EVALUATE.                                                10080099
100900                                                                  10090099
101000 EJECT                                                            10100099
101100*----------------------------------------------------------------*10110099
101200*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *10120099
101300*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *10130099
101400*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *10140099
101500*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *10150099
101600*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *10160099
101700*                                                                *10170099
101800*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *10180099
101900*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *10190099
102000*    UPON INITIALIZATION.                                        *10200099
102100*----------------------------------------------------------------*10210099
102200 4300-READ-ITEMS-FROM-DB.                                         10220099
102300                                                                  10230099
102400     PERFORM                                                      10240099
102500         VARYING PV-READ-COUNT                                    10250099
102600         FROM 1 BY 1                                              10260099
102700         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    10270099
102800            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         10280099
102900                                                                  10290099
103000         PERFORM 4310-FETCH                                       10300099
103100                                                                  10310099
103200         IF  ASC-ITEMS-LEFT-ON-DB                                 10320099
103300             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                10330099
103400                 ADD +1            TO ASC-ITEM-SUB                10340099
103500             ELSE                                                 10350099
103600                 ADD +1            TO ASC-BLK-SUB                 10360099
103700                 MOVE +1           TO ASC-ITEM-SUB                10370099
103800                                                                  10380099
103900                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         10390099
104000                     MOVE +1       TO ASC-BLK-SUB                 10400099
104100                     SET ASC-BLOCK-MODIFIED (1)                   10410099
104200                                   TO TRUE                        10420099
104300                     PERFORM 5100-WRITE-TEMP-STORAGE              10430099
104400                     MOVE ASC-BLOCK-ENTRIES                       10440099
104500                               (PC-MAX-BLOCKS-IN-ARRAY)           10450099
104600                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 10460099
104700                     ADD +1        TO ASC-BLK-SUB                 10470099
104800                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   10480099
104900                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      10490099
105000                                   TO  TRUE                       10500099
105100                 END-IF                                           10510099
105200             END-IF                                               10520099
105300             ADD +1                TO  ASC-NUMBER-OF-ITEMS-READ   10530099
105400             MOVE ASC-NUMBER-OF-ITEMS-READ                        10540099
105500                                   TO  ASC-LIST-ITEM-NUMBER       10550099
105600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 10560099
105700             MOVE IMCNPO-PO-NBR                                   10570099
105800                                   TO  ASC-PO-NBR                 10580099
105900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 10590099
106000             MOVE IMCNPO-MSTR-BOL-NBR                             10600099
106100                                   TO  ASC-MSTR-BOL               10610099
106200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 10620099
106300             MOVE IMCNPO-HSE-BOL-NBR                              10630099
106400                                   TO  ASC-HSE-BOL                10640099
106500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 10650099
106600         END-IF                                                           
111500     END-PERFORM.                                                 11150099
111600                                                                  11160099
111700     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          11170099
111800         MOVE +1               TO ASC-BLK-SUB                     11180099
111900         PERFORM 5100-WRITE-TEMP-STORAGE                          11190099
112000         ADD +1                TO ASC-BLK-SUB                     11200099
112100         PERFORM 5100-WRITE-TEMP-STORAGE                          11210099
112200                                                                  11220099
112300         MOVE 1                TO ASC-BLK-SUB                     11230099
112400                                  PV-BLOCK-NUMBER                 11240099
112500         PERFORM 4410-READ-TEMP-STORAGE                           11250099
112600         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             11260099
112700             MOVE 2            TO ASC-BLK-SUB                     11270099
112800                                  PV-BLOCK-NUMBER                 11280099
112900             PERFORM 4410-READ-TEMP-STORAGE                       11290099
113000         END-IF                                                   11300099
113100     END-IF.                                                      11310099
113200                                                                  11320099
113300 EJECT                                                            11330099
113400*----------------------------------------------------------------*11340099
113500*    FETCH THE CONTAINER BILL OF LADING CURSOR                   *11350099
113600*----------------------------------------------------------------*11360099
113700 4310-FETCH.                                                      11370099
113800                                                                  11380099
113900     EXEC SQL                                                     11390099
114000          FETCH BOL-CSR                                           11400099
114100          INTO  :IMCNPO-PO-NBR                                    11410099
114200              , :IMCNPO-MSTR-BOL-NBR                              11420099
114300              , :IMCNPO-HSE-BOL-NBR                               11430099
115200     END-EXEC.                                                    11520099
115300                                                                  11530099
115400     EVALUATE TRUE                                                11540099
115500         WHEN SQLCODE = ZERO                                      11550099
115600         WHEN SQLCODE = +100                                      11560099
115700              CONTINUE                                            11570099
115800         WHEN SQLWARN0 NOT = SPACE                                11580099
115900         WHEN SQLCODE NOT = ZERO                                  11590099
116000              MOVE '4310-FETCH-CURSOR'                            11600099
116100                               TO DP013-PARAGRAPH                 11610099
116200              MOVE 'FETCH BOL CURSOR'                             11620099
116300                               TO DP013-MESSAGE-TEXT (1)          11630099
116400              MOVE SQLCA       TO DP013-SQLCA                     11640099
116500              SET DP013-DB2-ABEND                                 11650099
116600                               TO TRUE                            11660099
116700              PERFORM DP013-0000-PROCESS-ABEND                    11670099
116800     END-EVALUATE.                                                11680099
116900                                                                  11690099
117000     IF  SQLCODE EQUAL +100                                       11700099
117100         SET ASC-NO-ITEMS-LEFT-ON-DB                              11710099
117200                                   TO TRUE                        11720099
117300     END-IF.                                                      11730099
117400                                                                  11740099
117500 EJECT                                                            11750099
117600*----------------------------------------------------------------*11760099
117700*        FORMAT THE DB2 DATE TO MM/DD/YY.                        *11770099
117800*----------------------------------------------------------------*11780099
117900 4320-FORMAT-DATE.                                                11790099
118000                                                                  11800099
118100     MOVE PV-DB-MM          TO  PV-DD-MM.                         11810099
118200     MOVE PV-DB-DD          TO  PV-DD-DD.                         11820099
118300     MOVE PV-DB-YY          TO  PV-DD-YY.                         11830099
118400                                                                  11840099
118500 EJECT                                                            11850099
124800*----------------------------------------------------------------*12480099
124900* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *12490099
125000*----------------------------------------------------------------*12500099
125100 4400-MOVE-COMMAREA-TO-SCREEN.                                    12510099
125200                                                                  12520099
125300     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             12530099
125400         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          12540099
125500         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          12550099
125600             MOVE +1    TO ASC-BLK-SUB                            12560099
125700             PERFORM 5100-WRITE-TEMP-STORAGE                      12570099
125800             ADD +1     TO ASC-BLK-SUB                            12580099
125900             PERFORM 5100-WRITE-TEMP-STORAGE                      12590099
126000             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             12600099
126100                 GIVING PV-BLOCK-NUMBER                           12610099
126200                 REMAINDER PV-REMAINDER                           12620099
126300             IF  PV-REMAINDER > ZERO                              12630099
126400                 ADD +1 TO PV-BLOCK-NUMBER                        12640099
126500             END-IF                                               12650099
126600             MOVE +1    TO ASC-BLK-SUB                            12660099
126700             PERFORM 4410-READ-TEMP-STORAGE                       12670099
126800             ADD +1     TO ASC-BLK-SUB                            12680099
126900                           PV-BLOCK-NUMBER                        12690099
127000             PERFORM 4410-READ-TEMP-STORAGE                       12700099
127100     END-IF.                                                      12710099
127200     MOVE +1            TO ASC-BLK-SUB.                           12720099
127300     COMPUTE ASC-ITEM-SUB =                                       12730099
127400         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              12740099
127500         + PC-ITEMS-PER-PANEL).                                   12750099
127600                                                                  12760099
127700     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        12770099
127800         ADD +1         TO ASC-BLK-SUB                            12780099
127900         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            12790099
128000     END-IF.                                                      12800099
128100                                                                  12810099
128200     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           12820099
128300         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                12830099
128400     PERFORM 4420-FORMAT-LIST-LINES                               12840099
128500         VARYING PV-SUB                                           12850099
128600         FROM PC-ITEMS-PER-PANEL BY -1                            12860099
128700         UNTIL PV-SUB < +1.                                       12870099
128800                                                                  12880099
128900     COMPUTE ASC-ITEMS-DISPLAYED =                                12890099
129000         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          12900099
129100                                                                  12910099
129200     PERFORM 4401-SELECT-CONTAINER-DETAILS.                       12920099
129800     PERFORM 4402-MOVE-CONTNR-DTLS-TO-SCR.                        12980099
129900                                                                  12990099
130000     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    13000099
130100                                      ASTRTITO.                   13010099
130200     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    13020099
130300     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    13030099
130400     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            13040099
130500                                   TO ASELITO.                    13050099
130600                                                                  13060099
130700     IF  DP020-MSG-NUMBER-X = SPACE                               13070099
130800         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  13080099
130900*----------- MORE ITEMS TO DISPLAY ----                           13090099
131000             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            13100099
131100             SET DP020-MSG-INFORMATIONAL TO TRUE                  13110099
131200         END-IF                                                   13120099
131300     END-IF.                                                      13130099
131400                                                                  13140099
131500 EJECT                                                            13150099
170601*----------------------------------------------------------------*DPKCS036
170602*    SELECT CONTAINER DETAILS FROM TIMCNTK                       *DPKCS036
170603*----------------------------------------------------------------*DPKCS036
170604 4401-SELECT-CONTAINER-DETAILS.                                   DPKCS036
170605                                                                  DPKCS036
170606     EXEC SQL                                                     DPKCS036
170607        SELECT  A.CONTNR_ID                                       DPKCS036
170608              , A.SIZE_CDE                                        DPKCS036
170609              , A.ORGN_SHPD_FR_CDE                                DPKCS036
170610              , A.ORGN_SHPD_TO_CDE                                DPKCS036
170611              , A.MOM_IMPRT_VEH_NM                                DPKCS036
170612              , A.MOM_CARR_SCAC_ID                                DPKCS036
170613              , A.CONSLR_SCAC_ID                                  DPKCS036
170614              , A.MOM_IMPRT_TRIP_ID                               DPKCS036
170615              , A.MOM_TRIP_TYP_CDE                                DPKCS036
170616              , A.FDR_TRIP_TYP_CDE                                DPKCS036
170617              , A.FDR_FOB_CDE                                     DPKCS036
170618              , A.MOM_FOB_CDE                                     DPKCS036
170619              , A.FDR_DPRTR_TMST                                  DPKCS036
170620              , A.MOM_DPRTR_TMST                                  DPKCS036
170621              , A.CART_CNT                                        DPKCS036
170622              , A.CBMT_QTY                                        DPKCS036
170623              , A.MOM_DEST_POE_CDE                                DPKCS036
170624*---ATA DATA WILL COME FROM CUSTOMS LOAD -------                  DPKCS036
170625              , A.WT_KGRM_QTY                                     DPKCS036
170627              , A.MOM_POE_DELY_TMST                               DPKCS036
170628              , A.UNT_QTY                                         DPKCS036
170630              , A.EST_LBD_NM                                      DPKCS036
170631              , A.EST_LBD_TMST                                    DPKCS036
170632              , A.LAST_UPD_TMST                                   DPKCS036
170633              , A.ACTL_POE_DELY_TMST                                      
170636              , A.MOM_POL_CDE                                             
170637              , A.FDR_POL_CDE                                             
170638              , A.MOM_POR_CDE                                             
170639              , A.FDR_POR_CDE                                             
170640        INTO  :IMCNTK-CONTNR-ID                                   DPKCS036
170641            , :IMCNTK-SIZE-CDE                                    DPKCS036
170642            , :IMCNTK-ORGN-SHPD-FR-CDE                            DPKCS036
170643            , :IMCNTK-ORGN-SHPD-TO-CDE                            DPKCS036
170644            , :IMCNTK-MOM-IMPRT-VEH-NM                            DPKCS036
170645            , :IMCNTK-MOM-CARR-SCAC-ID                            DPKCS036
170646            , :IMCNTK-CONSLR-SCAC-ID                              DPKCS036
170647            , :IMCNTK-MOM-IMPRT-TRIP-ID                           DPKCS036
170648            , :IMCNTK-MOM-TRIP-TYP-CDE                            DPKCS036
170649            , :IMCNTK-FDR-TRIP-TYP-CDE                            DPKCS036
170650            , :IMCNTK-FDR-FOB-CDE                                 DPKCS036
170651            , :IMCNTK-MOM-FOB-CDE                                 DPKCS036
170652            , :IMCNTK-FDR-DPRTR-TMST                              DPKCS036
170653            , :IMCNTK-MOM-DPRTR-TMST                              DPKCS036
170654            , :IMCNTK-CART-CNT                                    DPKCS036
170655            , :IMCNTK-CBMT-QTY                                    DPKCS036
170656            , :IMCNTK-MOM-DEST-POE-CDE                            DPKCS036
170657*---PROVISION FOR ATA DATA -----------                            DPKCS036
170658            , :IMCNTK-WT-KGRM-QTY                                 DPKCS036
170659            , :IMCNTK-MOM-POE-DELY-TMST                           DPKCS036
170660            , :IMCNTK-UNT-QTY                                     DPKCS036
170661            , :IMCNTK-EST-LBD-NM                                  DPKCS036
170662            , :IMCNTK-EST-LBD-TMST                                DPKCS036
170663            , :IMCNTK-LAST-UPD-TMST                               DPKCS036
170664            , :IMCNTK-ACTL-POE-DELY-TMST                                  
170672            , :IMCNTK-MOM-POL-CDE                                         
170673            , :IMCNTK-FDR-POL-CDE                                         
170674            , :IMCNTK-MOM-POR-CDE                                         
170675            , :IMCNTK-FDR-POR-CDE                                         
170676         FROM  TIMCNTK A                                          DPKCS036
170677         WHERE CONTNR_ID      = :DK-CONTNR-NBR                    DPKCS036
170678           AND CONTNR_SEQ_NBR = :DK-CONTNR-SEQ-NBR                DPKCS036
170679     END-EXEC.                                                    DPKCS036
170680                                                                  DPKCS036
170681     EVALUATE TRUE                                                DPKCS036
170682         WHEN SQLCODE = ZERO                                      DPKCS036
170683         WHEN SQLCODE = +100                                      DPKCS036
170684              CONTINUE                                            DPKCS036
170685         WHEN SQLWARN0 NOT = SPACE                                DPKCS036
170686         WHEN SQLCODE NOT = ZERO                                  DPKCS036
170687              MOVE '4401-SELECT-CONTAINER-DETAILS'                DPKCS036
170688                               TO DP013-PARAGRAPH                 DPKCS036
170689              MOVE 'SQL ERROR SELECTING CONTAINER DETAILS'        DPKCS036
170690                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
170691              MOVE SQLCA       TO DP013-SQLCA                     DPKCS036
170692              SET DP013-DB2-ABEND                                 DPKCS036
170693                               TO TRUE                            DPKCS036
170694              PERFORM DP013-0000-PROCESS-ABEND                    DPKCS036
170695     END-EVALUATE.                                                DPKCS036
170696                                                                  DPKCS036
170697 EJECT                                                            DPKCS036
170698*----------------------------------------------------------------*DPKCS036
170699*    MOVE CONTAINER DETAILS TO SCREEN.                           *DPKCS036
170700*----------------------------------------------------------------*DPKCS036
170701 4402-MOVE-CONTNR-DTLS-TO-SCR.                                    DPKCS036
170702                                                                  DPKCS036
170703     MOVE IMCNTK-CONTNR-ID         TO ACNTRNOO.                   DPKCS036
170704     MOVE IMCNTK-SIZE-CDE          TO ASIZEO.                     DPKCS036
170705     MOVE IMCNTK-MOM-IMPRT-VEH-NM  TO AVSNMO.                     DPKCS036
170706     MOVE IMCNTK-MOM-CARR-SCAC-ID  TO ACRSCACO.                   DPKCS036
170707     MOVE IMCNTK-CONSLR-SCAC-ID    TO ACNSCACO.                   DPKCS036
170708     MOVE IMCNTK-MOM-IMPRT-TRIP-ID TO AVYNOO.                     DPKCS036
170709     MOVE IMCNTK-CART-CNT          TO ACTNO.                      DPKCS036
170710     MOVE IMCNTK-CBMT-QTY          TO ACBMO.                      DPKCS036
170711     MOVE IMCNTK-WT-KGRM-QTY       TO AKGSO.                      DPKCS036
170714     PERFORM 4408-SELECT-TAUCNTK-CNT.                             DPKCS036
170715     PERFORM 4409-SELECT-TIMCNTK-CNT.                             DPKCS036
170716     ADD  PV-TAUCNTK-CNT PV-TIMCNTK-CNT                           DPKCS036
170717     GIVING  PV-TRN-CNT.                                          DPKCS036
170718     MOVE PV-TRN-CNT               TO ATRNCNTO.                   DPKCS036
170719     MOVE IMCNTK-UNT-QTY           TO AUNITSO.                    DPKCS036
170720     MOVE IMCNTK-ORGN-SHPD-FR-CDE  TO PV-SHPMT-FROM-CDE.          DPKCS036
170721     MOVE IMCNTK-ORGN-SHPD-TO-CDE  TO PV-SHPMT-TO-CDE.            DPKCS036
170722     MOVE PV-SHPMT-TYPE            TO ASHPTYPO.                   DPKCS036
170723     MOVE IMCNTK-EST-LBD-NM (1:18) TO ALBDNMO.                    DPKCS036
170724                                                                  DPKCS036
170725     PERFORM 4403-FOB-CDE-CHECK.                                  DPKCS036
170726                                                                  DPKCS036
170727     PERFORM 4406-POE-CDE-CHECK.                                  DPKCS036
170728                                                                  DPKCS036
170733     IF IMCNTK-FDR-TRIP-TYP-CDE = SPACES                                  
170734         MOVE IMCNTK-MOM-TRIP-TYP-CDE TO PV-HOLD-TRIP-TYP-CDE             
170735         MOVE IMCNTK-MOM-POR-CDE TO PV-HOLD-ORGN-CDE                      
170736         MOVE PC-POR TO PV-HOLD-ORGN-TYP-CDE                              
170737         PERFORM 4430-EDIT-ORGN-CDE                                       
170738         MOVE TRT00010-IMPRT-ORGN-CDE TO AMPORO                           
170740         MOVE IMCNTK-MOM-POL-CDE TO PV-HOLD-ORGN-CDE                      
170741         MOVE PC-POL TO PV-HOLD-ORGN-TYP-CDE                              
170742         PERFORM 4430-EDIT-ORGN-CDE                                       
170743         MOVE TRT00010-IMPRT-ORGN-CDE TO AMPOLO                           
170750     ELSE                                                                 
170751         MOVE IMCNTK-FDR-TRIP-TYP-CDE TO PV-HOLD-TRIP-TYP-CDE             
170752         MOVE IMCNTK-FDR-POR-CDE TO PV-HOLD-ORGN-CDE                      
170753         MOVE PC-POR TO PV-HOLD-ORGN-TYP-CDE                              
170754         PERFORM 4430-EDIT-ORGN-CDE                                       
170755         MOVE TRT00010-IMPRT-ORGN-CDE TO AMPORO                           
170756         MOVE IMCNTK-FDR-POL-CDE TO PV-HOLD-ORGN-CDE                      
170757         MOVE PC-POL TO PV-HOLD-ORGN-TYP-CDE                              
170758         PERFORM 4430-EDIT-ORGN-CDE                                       
170759         MOVE TRT00010-IMPRT-ORGN-CDE TO AMPOLO                           
170760     END-IF.                                                              
170778                                                                  DPKCS036
170779     MOVE IMCNTK-EST-LBD-TMST (1:10)                              DPKCS036
170780                                   TO  PV-DATE-BREAK.             DPKCS036
170781     IF PV-DATE-BREAK = SPACES OR PC-INIT-DATE                            
170782         MOVE SPACES              TO AELDO                                
170783     ELSE                                                                 
170784         PERFORM 4320-FORMAT-DATE                                         
170785         MOVE PV-DATE-DISPLAY     TO AELDO                                
170786     END-IF.                                                              
170787                                                                          
170788     IF IMCNTK-FDR-DPRTR-TMST (1:10)                                      
170789                                   = SPACES OR PC-INIT-DATE               
170790         MOVE IMCNTK-MOM-DPRTR-TMST (1:10)                                
170791                                   TO  PV-DATE-BREAK                      
170792     ELSE                                                                 
170793         MOVE IMCNTK-FDR-DPRTR-TMST (1:10)                                
170794                                   TO  PV-DATE-BREAK                      
170795     END-IF.                                                              
170796     IF PV-DATE-BREAK              = SPACES OR PC-INIT-DATE               
170797         MOVE SPACES                   TO AATDO                           
170798     ELSE                                                                 
170799         PERFORM 4320-FORMAT-DATE                                         
170800         MOVE PV-DATE-DISPLAY          TO AATDO                           
170801     END-IF.                                                              
170802                                                                          
170803     MOVE IMCNTK-MOM-POE-DELY-TMST (1:10)                                 
170804                                   TO  PV-DATE-BREAK.                     
170805     IF PV-DATE-BREAK = SPACES OR PC-INIT-DATE                            
170806         MOVE SPACES                TO AETAO                              
170807     ELSE                                                                 
170808        PERFORM 4320-FORMAT-DATE                                          
170809         MOVE PV-DATE-DISPLAY       TO AETAO                              
170810     END-IF.                                                              
170811                                                                          
170812*                                                                         
170813     MOVE IMCNTK-ACTL-POE-DELY-TMST (1:10)                                
170814                                   TO  PV-DATE-BREAK.                     
170815     IF PV-DATE-BREAK = SPACES OR PC-INIT-DATE                            
170816        MOVE SPACES                TO AATAO                               
170817     ELSE                                                                 
170818        PERFORM 4320-FORMAT-DATE                                          
170819        MOVE PV-DATE-DISPLAY       TO AATAO                               
170820     END-IF.                                                              
170821                                                                          
170822     IF IMCNTK-LAST-UPD-TMST (1:10)                                       
170823                                   = SPACES OR PC-INIT-DATE               
170824         MOVE SPACES               TO ALSTTRNO                            
170825     ELSE                                                                 
170826         STRING  IMCNTK-LAST-UPD-TMST(6:2) '/'                            
170827                 IMCNTK-LAST-UPD-TMST(9:2)                                
170828                 DELIMITED BY SIZE                                        
170829                           INTO ALSTTRNO                                  
170830     END-IF.                                                              
170831                                                                          
170832 EJECT                                                                    
170833*----------------------------------------------------------------*DPKCS036
170834*    CHECK FOR TRIP-TYP-CODE AND PROCESS  OB-CODE FOR DISPLAY    *DPKCS036
170835*----------------------------------------------------------------*DPKCS036
170836 4403-FOB-CDE-CHECK.                                              DPKCS036
170837                                                                  DPKCS036
170838     EVALUATE TRUE                                                DPKCS036
170839        WHEN  (IMCNTK-FDR-TRIP-TYP-CDE = 'A') OR                  DPKCS036
170840              (IMCNTK-MOM-TRIP-TYP-CDE = 'A')                     DPKCS036
170841              IF IMCNTK-FDR-FOB-CDE = SPACES                      DPKCS036
170842                 MOVE IMCNTK-MOM-FOB-CDE TO AFOBO                 DPKCS036
170843              ELSE                                                DPKCS036
170844                 MOVE IMCNTK-FDR-FOB-CDE TO AFOBO                 DPKCS036
170845              END-IF                                              DPKCS036
170846                                                                  DPKCS036
170847        WHEN  (IMCNTK-FDR-TRIP-TYP-CDE = 'O' OR 'M') OR           DPKCS036
170848              (IMCNTK-MOM-TRIP-TYP-CDE = 'O' OR 'M')              DPKCS036
170849              IF IMCNTK-FDR-FOB-CDE = SPACES                      DPKCS036
170850                 PERFORM 4404-SELECT-MOM-FOB-CDE                  DPKCS036
170851              ELSE                                                DPKCS036
170852                 PERFORM 4405-SELECT-FDR-FOB-CDE                  DPKCS036
170853              END-IF                                              DPKCS036
170854                                                                  DPKCS036
170855        WHEN  OTHER                                               DPKCS036
170856              MOVE SPACES             TO AFOBO                    DPKCS036
170857     END-EVALUATE.                                                DPKCS036
170858                                                                  DPKCS036
170859 EJECT                                                            DPKCS036
170860*----------------------------------------------------------------*DPKCS036
170861*    SELECT MOM FOB CODE FROM TIMFOB.                            *DPKCS036
170862*----------------------------------------------------------------*DPKCS036
170863 4404-SELECT-MOM-FOB-CDE.                                         DPKCS036
170864                                                                  DPKCS036
170865     EXEC SQL                                                     DPKCS036
170866         SELECT DISTINCT                                          DPKCS036
170867               A.FOB_CDE                                          DPKCS036
170868         INTO   :IMFOB-FOB-CDE                                    DPKCS036
170869         FROM   TIMFOB A                                          DPKCS036
170870         WHERE  A.FOB_STD_EDI_CDE = :IMCNTK-MOM-FOB-CDE           DPKCS036
170871            AND A.STAT_CDE = 'A'                                  DPKCS036
170872     END-EXEC.                                                    DPKCS036
170873                                                                  DPKCS036
170874     EVALUATE TRUE                                                DPKCS036
170875         WHEN SQLCODE = ZERO                                      DPKCS036
170876              MOVE IMFOB-FOB-CDE   TO AFOBO                       DPKCS036
170877         WHEN SQLCODE = +100                                      DPKCS036
170878         WHEN SQLCODE = -811                                      DPKCS036
170879              MOVE SPACES          TO AFOBO                       DPKCS036
170880         WHEN SQLWARN0 NOT = SPACE                                DPKCS036
170881         WHEN SQLCODE NOT = ZERO                                  DPKCS036
170882              MOVE '4404-SELECT-MOM-FOB-CDE'                      DPKCS036
170883                               TO DP013-PARAGRAPH                 DPKCS036
170884              MOVE 'SQL ERROR SELECTING MOM FOB CODE'             DPKCS036
170885                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
170886              MOVE SQLCA       TO DP013-SQLCA                     DPKCS036
170887              SET DP013-DB2-ABEND                                 DPKCS036
170888                               TO TRUE                            DPKCS036
170889              PERFORM DP013-0000-PROCESS-ABEND                    DPKCS036
170890     END-EVALUATE.                                                DPKCS036
170891                                                                  DPKCS036
170892 EJECT                                                            DPKCS036
170893*----------------------------------------------------------------*DPKCS036
170894*    SELECT FDR FOB CODE FROM TIMFOB.                            *DPKCS036
170895*----------------------------------------------------------------*DPKCS036
170896 4405-SELECT-FDR-FOB-CDE.                                         DPKCS036
170897                                                                  DPKCS036
170898     EXEC SQL                                                     DPKCS036
170899         SELECT DISTINCT                                          DPKCS036
170900               A.FOB_CDE                                          DPKCS036
170901         INTO   :IMFOB-FOB-CDE                                    DPKCS036
170902         FROM   TIMFOB A                                          DPKCS036
170903         WHERE  A.FOB_STD_EDI_CDE = :IMCNTK-FDR-FOB-CDE           DPKCS036
170904            AND A.STAT_CDE = 'A'                                  DPKCS036
170905     END-EXEC.                                                    DPKCS036
170906                                                                  DPKCS036
170907     EVALUATE TRUE                                                DPKCS036
170908         WHEN SQLCODE = ZERO                                      DPKCS036
170909              MOVE IMFOB-FOB-CDE   TO AFOBO                       DPKCS036
170910         WHEN SQLCODE = +100                                      DPKCS036
170911         WHEN SQLCODE = -811                                      DPKCS036
170912              MOVE SPACES          TO AFOBO                       DPKCS036
170913         WHEN SQLWARN0 NOT = SPACE                                DPKCS036
170914         WHEN SQLCODE NOT = ZERO                                  DPKCS036
170915              MOVE '4405-SELECT-FDR-FOB-CDE'                      DPKCS036
170916                               TO DP013-PARAGRAPH                 DPKCS036
170917              MOVE 'SQL ERROR SELECTING FDR FOB CODE'             DPKCS036
170918                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
170919              MOVE SQLCA       TO DP013-SQLCA                     DPKCS036
170920              SET DP013-DB2-ABEND                                 DPKCS036
170921                               TO TRUE                            DPKCS036
170922              PERFORM DP013-0000-PROCESS-ABEND                    DPKCS036
170923     END-EVALUATE.                                                DPKCS036
170924                                                                  DPKCS036
170925 EJECT                                                            DPKCS036
170926*----------------------------------------------------------------*DPKCS036
170927*    CHECK FOR TRIP-TYP-CODE AND PROCESS POE-CODE FOR DISPLAY    *DPKCS036
170928*----------------------------------------------------------------*DPKCS036
170929 4406-POE-CDE-CHECK.                                              DPKCS036
170930                                                                  DPKCS036
170931     EVALUATE TRUE                                                DPKCS036
170935        WHEN  IMCNTK-MOM-TRIP-TYP-CDE = 'O' OR 'M' OR 'A'         DPKCS036
170936              PERFORM 4500-OPEN-POE-CURSOR                                
170937              PERFORM 4510-FETCH-POE-CURSOR                               
170938              PERFORM 4505-CLOSE-POE-CURSOR                               
170939              MOVE IMPOE-POE-CDE           TO APOEO               DPKCS036
170940                                                                  DPKCS036
170941        WHEN  OTHER                                               DPKCS036
170942              MOVE SPACES                  TO APOEO               DPKCS036
170943     END-EVALUATE.                                                DPKCS036
170944                                                                  DPKCS036
170945 EJECT                                                            DPKCS036
170946*----------------------------------------------------------------*DPKCS036
170947*    SELECT COUNT FROM TAUCNTK                                   *DPKCS036
170948*----------------------------------------------------------------*DPKCS036
170949 4408-SELECT-TAUCNTK-CNT.                                         DPKCS036
170950                                                                  DPKCS036
170951     EXEC SQL                                                     DPKCS036
170952         SELECT                                                   DPKCS036
170953               COUNT (*)                                          DPKCS036
170954         INTO   :PV-TAUCNTK-CNT                                   DPKCS036
170955         FROM   TAUCNTK                                           DPKCS036
170956         WHERE  CONTNR_ID      = :DK-CONTNR-NBR                   DPKCS036
170957           AND  CONTNR_SEQ_NBR = :DK-CONTNR-SEQ-NBR               DPKCS036
170958     END-EXEC.                                                    DPKCS036
170959                                                                  DPKCS036
170960     EVALUATE TRUE                                                DPKCS036
170961         WHEN SQLCODE = ZERO                                      DPKCS036
170962         WHEN SQLCODE = +100                                      DPKCS036
170963              CONTINUE                                            DPKCS036
170964         WHEN SQLWARN0 NOT = SPACE                                DPKCS036
170965         WHEN SQLCODE NOT = ZERO                                  DPKCS036
170966              MOVE '4408-SELECT-TAUCNTK-CNT'                      DPKCS036
170967                               TO DP013-PARAGRAPH                 DPKCS036
170968              MOVE 'SQL ERROR SELECTING COUNT FROM TAUCNTK'       DPKCS036
170969                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
170970              MOVE SQLCA       TO DP013-SQLCA                     DPKCS036
170971              SET DP013-DB2-ABEND                                 DPKCS036
170972                               TO TRUE                            DPKCS036
170973              PERFORM DP013-0000-PROCESS-ABEND                    DPKCS036
170974     END-EVALUATE.                                                DPKCS036
170975                                                                  DPKCS036
170976 EJECT                                                            DPKCS036
170977*----------------------------------------------------------------*DPKCS036
170978*    SELECT COUNT FROM TIMCNTK                                   *DPKCS036
170979*----------------------------------------------------------------*DPKCS036
170980 4409-SELECT-TIMCNTK-CNT.                                         DPKCS036
170981                                                                  DPKCS036
170982     EXEC SQL                                                     DPKCS036
170983         SELECT                                                   DPKCS036
170984               COUNT (*)                                          DPKCS036
170985         INTO   :PV-TIMCNTK-CNT                                   DPKCS036
170986         FROM   TIMCNTK                                           DPKCS036
170987         WHERE  CONTNR_ID      = :DK-CONTNR-NBR                   DPKCS036
170988           AND  CONTNR_SEQ_NBR = :DK-CONTNR-SEQ-NBR               DPKCS036
170989     END-EXEC.                                                    DPKCS036
170990                                                                  DPKCS036
170991     EVALUATE TRUE                                                DPKCS036
170992         WHEN SQLCODE = ZERO                                      DPKCS036
170993         WHEN SQLCODE = +100                                      DPKCS036
170994              CONTINUE                                            DPKCS036
170995         WHEN SQLWARN0 NOT = SPACE                                DPKCS036
170996         WHEN SQLCODE NOT = ZERO                                  DPKCS036
170997              MOVE '4409-SELECT-TIMCNTK-CNT'                      DPKCS036
170998                               TO DP013-PARAGRAPH                 DPKCS036
170999              MOVE 'SQL ERROR SELECTING COUNT FROM TIMCNTK'       DPKCS036
171000                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
171001              MOVE SQLCA       TO DP013-SQLCA                     DPKCS036
171002              SET DP013-DB2-ABEND                                 DPKCS036
171003                               TO TRUE                            DPKCS036
171004              PERFORM DP013-0000-PROCESS-ABEND                    DPKCS036
171005     END-EVALUATE.                                                DPKCS036
171006                                                                  DPKCS036
171007 EJECT                                                            DPKCS036
171008*----------------------------------------------------------------*17070099
171009*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *17080099
171010*----------------------------------------------------------------*17090099
171020 4410-READ-TEMP-STORAGE.                                          17100099
171100                                                                  17110099
171200     EXEC CICS                                                    17120099
171300         READQ TS                                                 17130099
171400             QUEUE (ASC-LIST-QUEUE-NAME)                          17140099
171500             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               17150099
171600             ITEM  (PV-BLOCK-NUMBER)                              17160099
171700             RESP  (PV-CICS-RESP)                                 17170099
171800     END-EXEC.                                                    17180099
171900                                                                  17190099
172000     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       17200099
172100       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     17210099
172200         CONTINUE                                                 17220099
172300     ELSE                                                         17230099
172400         SET DP013-CICS-ABEND     TO TRUE                         17240099
172500         SET DP013-NO-ROLLBACK    TO TRUE                         17250099
172600         MOVE '4410-READ-TEMP-STORAGE'                            17260099
172700                                  TO DP013-PARAGRAPH              17270099
172800         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      17280099
172900                                  TO DP013-MESSAGE-TEXT(1)        17290099
173000         PERFORM DP013-0000-PROCESS-ABEND                         17300099
173100     END-IF.                                                      17310099
173200                                                                  17320099
173300     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             17330099
173400                                                                  17340099
173500     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         17350099
173600         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               17360099
173700     END-IF.                                                      17370099
173800                                                                  17380099
173900 EJECT                                                            17390099
174000*----------------------------------------------------------------*17400099
174100*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *17410099
174200*----------------------------------------------------------------*17420099
174300 4420-FORMAT-LIST-LINES.                                          17430099
174400                                                                  17440099
174500     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      17450099
174600         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                17460099
174700         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA    (PV-SUB)        17470099
174800         MOVE DP015-HL-OFF       TO MR-SELECTH    (PV-SUB)        17480099
174900         MOVE SPACES             TO MR-SELECTI    (PV-SUB)        17490099
175000                                    MR-ACTION     (PV-SUB)        17500099
175200                                    MR-MSTR-BOL   (PV-SUB)        17520099
175300                                    MR-HSE-BOL    (PV-SUB)        17530099
176000                                                                  17600099
176100         MOVE ZEROS              TO MR-PO-NBR     (PV-SUB)        17610099
176200     ELSE                                                         17620099
176300         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      17630099
176400                                                   > SPACE        17640099
176500             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 17650099
176600                                 TO MR-SELECTI (PV-SUB)           17660099
176700         ELSE                                                     17670099
176800             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      17680099
176900                                 TO MR-SELECTI (PV-SUB)           17690099
177000         END-IF                                                   17700099
177100                                                                  17710099
177200         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           17720099
177300             MOVE ASC-ACTION   (ASC-BLK-SUB ASC-ITEM-SUB)         17730099
177400                               TO MR-ACTION   (PV-SUB)            17740099
177500             MOVE ASC-PO-NBR   (ASC-BLK-SUB ASC-ITEM-SUB)         17750099
177600                               TO MR-PO-NBR   (PV-SUB)            17760099
177700             MOVE ASC-MSTR-BOL (ASC-BLK-SUB ASC-ITEM-SUB)         17770099
177800                               TO MR-MSTR-BOL (PV-SUB)            17780099
177900             MOVE ASC-HSE-BOL  (ASC-BLK-SUB ASC-ITEM-SUB)         17790099
178000                               TO MR-HSE-BOL  (PV-SUB)            17800099
179500         END-IF                                                   17950099
179600     END-IF.                                                      17960099
179700     SUBTRACT +1 FROM ASC-ITEM-SUB.                               17970099
179800     IF  ASC-ITEM-SUB < + 1                                       17980099
179900         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  17990099
180000         MOVE +1                 TO ASC-BLK-SUB                   18000099
180100     END-IF.                                                      18010099
180200                                                                  18020099
180300 EJECT                                                            18030099
180301******************************************************************        
180302* EDIT THE POL AND POR ORIGIN CODES.                             *        
180303******************************************************************        
180304 4430-EDIT-ORGN-CDE.                                                      
180305                                                                          
180306     IF PV-HOLD-ORGN-CDE = SPACES                                         
180307         CONTINUE                                                         
180308     ELSE                                                                 
180309         EVALUATE TRUE                                                    
180310             WHEN PV-HOLD-TRIP-TYP-CDE = PC-A                             
180311                 PERFORM 4432-SELECT-ORGN-AIR                             
180312                                                                          
180313             WHEN PV-HOLD-TRIP-TYP-CDE = PC-O                             
180314                 PERFORM 4434-SELECT-ORGN-OCEAN                           
180315                                                                          
180316             WHEN OTHER                                                   
180317                 MOVE SPACES TO TRT00010-IMPRT-ORGN-CDE                   
180318         END-EVALUATE                                                     
180319     END-IF.                                                              
180320                                                                          
180321******************************************************************        
180322* SELECT POL AND POR CODES FOR AIR.                              *        
180323******************************************************************        
180324 4432-SELECT-ORGN-AIR.                                                    
180325                                                                          
180326     EXEC SQL                                                             
180327         SELECT A.IMPRT_ORGN_CDE                                          
180328           INTO  :TRT00010-IMPRT-ORGN-CDE                                 
180329           FROM TRT_IMPRT_ORGN  A                                         
180330          WHERE A.IMPRT_ORGN_CDE = :PV-HOLD-ORGN-CDE                      
180331            AND A.STAT_CDE    =   'A'                                     
180332            AND A.IMPRT_ORGN_TYP_CDE = :PV-HOLD-ORGN-TYP-CDE              
180333     END-EXEC.                                                            
180334                                                                          
180335     EVALUATE TRUE                                                DPKCS036
180336         WHEN SQLCODE = ZERO                                      DPKCS036
180337              CONTINUE                                            DPKCS036
180338         WHEN SQLCODE = +100                                      DPKCS036
180339         WHEN SQLCODE = -811                                      DPKCS036
180340              MOVE  SPACES TO TRT00010-IMPRT-ORGN-CDE                     
180341         WHEN SQLWARN0 NOT = SPACE                                DPKCS036
180342         WHEN SQLCODE NOT = ZERO                                  DPKCS036
180343              MOVE '4432-SELECT-ORGN-AIR'                         DPKCS036
180344                               TO DP013-PARAGRAPH                 DPKCS036
180345              MOVE 'SQL ERROR SELECTING ORIGIN CODE'              DPKCS036
180346                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
180347              MOVE SQLCA       TO DP013-SQLCA                     DPKCS036
180348              SET DP013-DB2-ABEND                                 DPKCS036
180349                               TO TRUE                            DPKCS036
180350              PERFORM DP013-0000-PROCESS-ABEND                    DPKCS036
180351     END-EVALUATE.                                                DPKCS036
180352                                                                  DPKCS036
180353 EJECT                                                                    
180354******************************************************************        
180355* SELECT POL AND POR CODES FOR OCEAN.                            *        
180356******************************************************************        
180357 4434-SELECT-ORGN-OCEAN.                                                  
180358                                                                          
180359     EXEC SQL                                                             
180360         SELECT A.IMPRT_ORGN_CDE                                          
180361          INTO :TRT00010-IMPRT-ORGN-CDE                                   
180362           FROM TRT_IMPRT_ORGN  A                                         
180363          WHERE A.STD_EDI_CDE  = :PV-HOLD-ORGN-CDE                        
180364            AND A.STAT_CDE     = 'A'                                      
180365            AND A.IMPRT_ORGN_TYP_CDE = :PV-HOLD-ORGN-TYP-CDE              
180366     END-EXEC.                                                            
180367                                                                          
180368     EVALUATE TRUE                                                DPKCS036
180369         WHEN SQLCODE = ZERO                                      DPKCS036
180370              CONTINUE                                            DPKCS036
180371         WHEN SQLCODE = +100                                      DPKCS036
180372         WHEN SQLCODE = -811                                      DPKCS036
180373              MOVE  SPACES TO TRT00010-IMPRT-ORGN-CDE                     
180374         WHEN SQLWARN0 NOT = SPACE                                DPKCS036
180375         WHEN SQLCODE NOT = ZERO                                  DPKCS036
180376              MOVE '4434-SELECT-ORGN-OCEAN'                       DPKCS036
180377                               TO DP013-PARAGRAPH                 DPKCS036
180378              MOVE 'SQL ERROR SELECTING ORIGIN CODE'              DPKCS036
180379                               TO DP013-MESSAGE-TEXT (1)          DPKCS036
180380              MOVE SQLCA       TO DP013-SQLCA                     DPKCS036
180381              SET DP013-DB2-ABEND                                 DPKCS036
180382                               TO TRUE                            DPKCS036
180383              PERFORM DP013-0000-PROCESS-ABEND                    DPKCS036
180384     END-EVALUATE.                                                DPKCS036
180385                                                                  DPKCS036
180386 EJECT                                                                    
180387*----------------------------------------------------------------*        
180388*   OPEN THE POE CODE CURSOR                                     *        
180389*----------------------------------------------------------------*        
180390 4500-OPEN-POE-CURSOR.                                                    
180391                                                                          
180392     PERFORM                                                              
180393         WITH TEST AFTER                                                  
180394         VARYING PV-RETRY-COUNTER                                         
180395         FROM 1 BY 1                                                      
180396         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
180397                   OR (SQLCODE = ZERO))                                   
180398                                                                          
180399         MOVE 'CURSOR:  POE-CSR'     TO DP013-MESSAGE-TEXT (2)            
180400                                                                          
180401         EXEC SQL                                                         
180402              OPEN POE-CSR                                                
180403         END-EXEC                                                         
180404                                                                          
180405         EVALUATE TRUE                                                    
180406             WHEN SQLCODE = ZERO                                          
180407             WHEN SQLCODE = -904                                          
180408             WHEN SQLCODE = -913                                          
180409                 CONTINUE                                                 
180410             WHEN SQLWARN0 NOT = SPACES                                   
180411             WHEN SQLCODE < ZERO                                          
180412             WHEN SQLCODE > ZERO                                          
180413                 MOVE '4500-OPEN-POE-CURSOR'                              
180414                                   TO DP013-PARAGRAPH                     
180415                 MOVE 'OPEN POE CURSOR - '                                
180416                                   TO DP013-MESSAGE-TEXT (1)              
180417                 MOVE SQLCA        TO DP013-SQLCA                         
180418                 MOVE 'TIMPOE  '   TO DP013-DB2-TABLE-NAME (1)            
180419                 SET DP013-DB2-ABEND                                      
180420                     DP013-XCTL-DISPLAY-RESTART TO TRUE                   
180421                 PERFORM DP013-0000-PROCESS-ABEND                         
180422         END-EVALUATE                                                     
180423     END-PERFORM.                                                         
180424*                                                                         
180425     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
180426         MOVE '4382-OPEN-POE-CURSOR' TO DP013-PARAGRAPH                   
180427         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'           
180428                                   TO DP013-MESSAGE-TEXT (1)              
180429         MOVE SQLCA                TO DP013-SQLCA                         
180430         MOVE 'TIMPOE  '           TO DP013-DB2-TABLE-NAME (1)            
180431         SET DP013-DB2-ABEND                                              
180432             DP013-XCTL-DISPLAY-RESTART                                   
180433                                   TO TRUE                                
180434         PERFORM DP013-0000-PROCESS-ABEND                                 
180435     END-IF.                                                              
180436                                                                          
180437 EJECT                                                                    
180438*----------------------------------------------------------------*        
180439*   CLOSE THE POE CODE CURSOR                                    *        
180440*----------------------------------------------------------------*        
180441 4505-CLOSE-POE-CURSOR.                                                   
180442                                                                          
180443     EXEC SQL                                                             
180444          CLOSE POE-CSR                                                   
180445     END-EXEC.                                                            
180446                                                                          
180447     EVALUATE TRUE                                                        
180448         WHEN SQLCODE = ZERO                                              
180449             CONTINUE                                                     
180450         WHEN SQLWARN0 NOT = SPACES                                       
180451         WHEN SQLCODE < ZERO                                              
180452         WHEN SQLCODE > ZERO                                              
180453             MOVE '4505-CLOSE-POE-CURSOR'                                 
180454                               TO DP013-PARAGRAPH                         
180455             MOVE 'CLOSE POE CURSOR '                                     
180456                               TO DP013-MESSAGE-TEXT (1)                  
180457             MOVE SQLCA        TO DP013-SQLCA                             
180458             MOVE 'TIMPOE  '   TO DP013-DB2-TABLE-NAME (1)                
180459             SET DP013-DB2-ABEND                                          
180460                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
180461             PERFORM DP013-0000-PROCESS-ABEND                             
180462     END-EVALUATE.                                                        
180463                                                                          
180464 EJECT                                                                    
180465*----------------------------------------------------------------*        
180466*    FETCH THE POE CODE CURSOR                                   *        
180467*----------------------------------------------------------------*        
180468 4510-FETCH-POE-CURSOR.                                                   
180469                                                                          
180470     EXEC SQL                                                             
180471          FETCH POE-CSR                                                   
180472          INTO  :IMPOE-POE-CDE                                            
180473     END-EXEC.                                                            
180474                                                                          
180475     EVALUATE TRUE                                                        
180476         WHEN SQLCODE = ZERO                                              
180477         WHEN SQLCODE = -811                                              
180478              CONTINUE                                                    
180479         WHEN SQLCODE = +100                                              
180480              MOVE SPACES TO IMPOE-POE-CDE                                
180481         WHEN SQLWARN0 NOT = SPACE                                        
180482         WHEN SQLCODE NOT = ZERO                                          
180483              MOVE '4510-FETCH-POE-CURSOR'                                
180484                               TO DP013-PARAGRAPH                         
180485              MOVE 'FETCH POE CURSOR'                                     
180486                               TO DP013-MESSAGE-TEXT (1)                  
180487              MOVE SQLCA       TO DP013-SQLCA                             
180488              SET DP013-DB2-ABEND                                         
180489                               TO TRUE                                    
180490              PERFORM DP013-0000-PROCESS-ABEND                            
180491     END-EVALUATE.                                                        
180492                                                                          
180493 EJECT                                                                    
180494*----------------------------------------------------------------*18040099
180500*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *18050099
180600*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *18060099
180700*----------------------------------------------------------------*18070099
180800 5100-WRITE-TEMP-STORAGE.                                         18080099
180900                                                                  18090099
181000     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     18100099
181100                                   TO PV-LIST-ITEM-NUMBER.        18110099
181200     COMPUTE PV-BLOCK-NUMBER =                                    18120099
181300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    18130099
181400                                                                  18140099
181500     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             18150099
181600     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             18160099
181700         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      18170099
181800             PERFORM 5105-REWRITE-ASC-LISTQ                       18180099
181900         END-IF                                                   18190099
182000     ELSE                                                         18200099
182100         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       18210099
182200         ASC-HIGHEST-BLOCK-WRITTEN + 1                            18220099
182300         PERFORM 5110-WRITE-ASC-LISTQ                             18230099
182400         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   18240099
182500     END-IF.                                                      18250099
182600                                                                  18260099
182700     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             18270099
182800                                                                  18280099
182900 EJECT                                                            18290099
183000*----------------------------------------------------------------*18300099
183100*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *18310099
183200*  SPECIFIC COMMAREA.                                            *18320099
183300*----------------------------------------------------------------*18330099
183400 5105-REWRITE-ASC-LISTQ.                                          18340099
183500                                                                  18350099
183600     EXEC CICS                                                    18360099
183700         WRITEQ TS                                                18370099
183800             QUEUE (ASC-LIST-QUEUE-NAME)                          18380099
183900             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               18390099
184000             ITEM  (PV-BLOCK-NUMBER)                              18400099
184100             REWRITE                                              18410099
184200             RESP  (PV-CICS-RESP)                                 18420099
184300     END-EXEC.                                                    18430099
184400                                                                  18440099
184500     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           18450099
184600         CONTINUE                                                 18460099
184700     ELSE                                                         18470099
184800         SET DP013-CICS-ABEND            TO TRUE                  18480099
184900         SET DP013-NO-ROLLBACK           TO TRUE                  18490099
185000         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       18500099
185100         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     18510099
185200                                         TO DP013-MESSAGE-TEXT(1) 18520099
185300         PERFORM DP013-0000-PROCESS-ABEND                         18530099
185400     END-IF.                                                      18540099
185500                                                                  18550099
185600 EJECT                                                            18560099
185700*----------------------------------------------------------------*18570099
185800*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *18580099
185900*  SPECIFIC COMMAREA.                                            *18590099
186000*----------------------------------------------------------------*18600099
186100 5110-WRITE-ASC-LISTQ.                                            18610099
186200                                                                  18620099
186300     EXEC CICS                                                    18630099
186400         WRITEQ TS                                                18640099
186500             QUEUE (ASC-LIST-QUEUE-NAME)                          18650099
186600             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               18660099
186700             ITEM  (PV-BLOCK-NUMBER)                              18670099
186800             RESP  (PV-CICS-RESP)                                 18680099
186900     END-EXEC.                                                    18690099
187000                                                                  18700099
187100     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      18710099
187200         SET DP013-CICS-ABEND      TO TRUE                        18720099
187300         SET DP013-NO-ROLLBACK     TO TRUE                        18730099
187400         MOVE '5110-WRITE-ASC-LISTQ'                              18740099
187500                                   TO DP013-PARAGRAPH             18750099
187600         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           18760099
187700                                   TO DP013-MESSAGE-TEXT(1)       18770099
187800         PERFORM DP013-0000-PROCESS-ABEND                         18780099
187900     END-IF.                                                      18790099
188000                                                                  18800099
188100 EJECT                                                            18810099
188200*----------------------------------------------------------------*18820099
188300*    ABEND PROCESSOR MODULE                                      *18830099
188400*----------------------------------------------------------------*18840099
188500                                                                  18850099
188600     COPY DPPD013.                                                18860099
