000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.      EPKUT156.                                       00020013
000300 AUTHOR.          SANDY POTTER.                                   00030000
000400 DATE-WRITTEN.    MARCH 31, 2005.                                 00040000
000500                                                                  00050000
000600*-----------------------------------------------------------      00060000
000700*        EXTRACT PLU STORE SPECIFIC PRICE AND STATUS CHANGES      00070000
000800*-----------------------------------------------------------      00080000
000900*  THIS PROGRAM EXTRACTS A CHANGE FILE OF PLU DATA FOR SKU PRICE  00090017
001000*  RELATED DATA CHANGED SINCE THE LAST BATCH CYCLE. IT ENCOMPASSES00100000
001100*  THE PORTION OF EPKUT107 THAT PERTAINED TO STORE PRICE CHANGES  00110000
001200*  ONLY, AS THAT PROGRAM HAS BEEN BROKEN INTO SMALLER PIECES      00120000
001300*  THAT CAN EXECUTE SIMULTANEOUSLY, THUS REDUCING THE CRITAL PATH 00130000
001400*  ON YELLOW AND RED TICKET EVENT DAYS.                           00140000
001500*                                                                 00150000
001600*  THIS PROGRAM EXTRACTS STORE SPECIFIC PRICE CHANGE DATA FOR A   00160000
001700*  RANGE OF TIMESTAMP VALUES.  IT MAY BE EXECUTED SIMULTANEOUSLY  00170000
001800*  IN DIFFERENT JOBS FOR DIFFERENT RANGES OF STORE NUMBERS.       00180000
001900*                                                                 00190000
002000*  PROGRAM READS FIVE CONTROL CARDS, WHICH ARE DETAILED BELOW.    00200000
002100*    INP01- CC-TOMORROW                EPWS112                    00210000
002200*    INP02- CC-PREV-TMST               EPWS105                    00220000
002300*    INP03- CC-TODAY                   EPWS140                    00230000
002400*    INP04- CC-DAYS                    EPRD045                    00240000
002500*    INP05- CC-TMST-RANGE              EPWS160                    00250000
002600*                                                                 00260000
002700*    OTHER FILES AND THEIR ASSOCIATED COPYBOOK/PURPOSE.           00270000
002800*    OUT01- CHG-SKU-PRICG-STORE-FILE   EPRD220                    00280026
002900*                                                                 00290000
003000*  THIS PROGRAM WILL USE A CURSOR TO FETCH ALL THE CHANGED SKU    00300000
003100*  STORE INFO AND CREATE STORE SPECIFIC PLU RECORDS WITH          00310000
003200*  APPROPRIATE INFORMATION.                                       00320000
003300*  IT WILL NOW ALSO CREATE STORE SPECIFIC SKU PRICING RECORDS.    00330000
003400*=================================================================00340017
003500* CL3132  COGNIZANT  08-02-10   STORE ENHANCEMENT-MADE CHANGES TO 00350014
003600*                               IMPROVE PROGRAM PERFORMANCE.      00360016
003700*----------------------------------------------------------       00370000
003800 ENVIRONMENT DIVISION.                                            00380000
003900*----------------------------------------------------------       00390000
004000 CONFIGURATION SECTION.                                           00400000
004100 SOURCE-COMPUTER.        IBM-3090.                                00410000
004200 OBJECT-COMPUTER.        IBM-3090.                                00420000
004300                                                                  00430000
004400 INPUT-OUTPUT SECTION.                                            00440000
004500                                                                  00450000
004600 FILE-CONTROL.                                                    00460000
004700                                                                  00470000
004800     SELECT CC-TOMORROW                                           00480000
004900            ASSIGN TO INP01.                                      00490000
005000     SELECT CC-PREV-TMST                                          00500000
005100            ASSIGN TO INP02.                                      00510000
005200     SELECT CC-TODAY                                              00520000
005300            ASSIGN TO INP03.                                      00530000
005400     SELECT CC-DAYS                                               00540000
005500            ASSIGN TO INP04.                                      00550000
005600     SELECT CC-TMST-RANGE                                         00560000
005700            ASSIGN TO INP05.                                      00570000
005800     SELECT CHG-SKU-PRICG-STORE-FILE                              00580000
005900            ASSIGN TO OUT01.                                      00590026
006000                                                                  00600000
006100 DATA DIVISION.                                                   00610000
006200 FILE SECTION.                                                    00620000
006300                                                                  00630000
006400 FD  CC-TOMORROW                                                  00640000
006500     RECORDING MODE F                                             00650000
006600     BLOCK CONTAINS 0 RECORDS                                     00660000
006700     LABEL RECORDS ARE OMITTED                                    00670000
006800     DATA RECORD IS CC-TOMORROW-RECORD.                           00680000
006900 01  CC-TOMORROW-RECORD              PIC X(80).                   00690000
007000                                                                  00700000
007100 FD  CC-PREV-TMST                                                 00710000
007200     RECORDING MODE F                                             00720000
007300     BLOCK CONTAINS 0 RECORDS                                     00730000
007400     LABEL RECORDS ARE OMITTED                                    00740000
007500     DATA RECORD IS CC-PREV-TMST-RECORD.                          00750000
007600 01  CC-PREV-TMST-RECORD             PIC X(80).                   00760000
007700                                                                  00770000
007800 FD  CC-TODAY                                                     00780000
007900     RECORDING MODE F                                             00790000
008000     BLOCK CONTAINS 0 RECORDS                                     00800000
008100     LABEL RECORDS ARE OMITTED                                    00810000
008200     DATA RECORD IS CC-TODAY-RECORD.                              00820000
008300 01  CC-TODAY-RECORD                 PIC X(80).                   00830000
008400                                                                  00840000
008500 FD  CC-DAYS                                                      00850000
008600     RECORDING MODE F                                             00860000
008700     BLOCK CONTAINS 0 RECORDS                                     00870000
008800     LABEL RECORDS ARE OMITTED                                    00880000
008900     DATA RECORD IS CONTROL-CARD-4-RECORD.                        00890000
009000 01  CC-DAYS-RECORD                  PIC X(80).                   00900000
009100                                                                  00910000
009200 FD  CC-TMST-RANGE                                                00920000
009300     RECORDING MODE F                                             00930000
009400     BLOCK CONTAINS 0 RECORDS                                     00940000
009500     LABEL RECORDS ARE OMITTED                                    00950000
009600     DATA RECORD IS CC-EPWS160-CONTROL-CARD.                      00960000
009700 01  CC-TMST-RANGE-RECORD            PIC X(80).                   00970000
009800                                                                  00980000
009900 FD  CHG-SKU-PRICG-STORE-FILE                                     00990000
010000     RECORDING MODE F                                             01000000
010100     BLOCK CONTAINS 0 RECORDS                                     01010000
010200     LABEL RECORDS ARE OMITTED                                    01020000
010300     DATA RECORD IS CHG-SKU-PRICG-STORE-RECORD.                   01030000
010400 01  CHG-SKU-PRICG-STORE-RECORD      PIC X(260).                  01040000
010500                                                                  01050000
010600 WORKING-STORAGE SECTION.                                         01060000
010700*-----------------------------------------------------------      01070000
010800* PS- PROGRAM SWITCHES                                            01080000
010900*-----------------------------------------------------------      01090000
011000 01  PS-PROGRAM-SWITCHES.                                         01100000
011100     05  PS-END-OF-INPUT-FILE-SW        PIC X(01) VALUE 'Y'.      01110000
011200         88  PS-END-OF-INPUT-FILE                 VALUE 'N'.      01120000
011300         88  PS-MORE-INPUT-FILE                   VALUE 'Y'.      01130000
011400     05  PS-END-OF-SKUS-STR-CSR-SW      PIC X(01) VALUE 'N'.      01140000
011500         88  PS-END-OF-SKUS-STR-CSR               VALUE 'Y'.      01150000
011600         88  PS-MORE-SKUS-STR-CSR                 VALUE 'N'.      01160000
011700                                                                  01170000
011800*-----------------------------------------------------------      01180000
011900* PC- PROGRAM CONSTANTS                                           01190000
012000*-----------------------------------------------------------      01200000
012100 01  PC-PROGRAM-CONSTANTS.                                        01210000
012200     05  PC-CURRENT-PROGRAM-NAME   PIC X(08) VALUE 'EPKUT156'.    01220013
012300     05  PC-MAX-RETRIES            PIC S9(04) VALUE +5 COMP.      01230000
012400     05  PC-ACTIVE-STATUS          PIC X(02) VALUE '20'.          01240000
012500     05  PC-MIXED-STATUS           PIC X(02) VALUE '25'.          01250000
012600     05  PC-STR-GRP-TYP-CDE-STORE  PIC  9(05) VALUE 5000.         01260000
012700                                                                  01270000
012800     05  PC-SQLS-START-TIME        PIC X(08)  VALUE '03:00:00'.   01280000
012900     05  PC-PRIC-EFF-TIME-STD      PIC X(08)  VALUE '03:00:00'.   01290000
013000     05  PC-MDSE-HIER-SKU          PIC X(03)  VALUE 'SKU'.        01300000
013100     05  PC-NULL-CHAR              PIC X(01)  VALUE '~'.          01310000
013200     05  PC-ROWS                   PIC S9(4)  VALUE +100 COMP.    01320017
013300                                                                  01330000
013400*-----------------------------------------------------------      01340000
013500* PV- PROGRAM VARIABLES                                           01350000
013600*-----------------------------------------------------------      01360000
013700 01  PV-PROGRAM-VARIABLES.                                        01370000
013800     05  PV-START-DATE             PIC X(10)  VALUE SPACES.       01380000
013900     05  PV-NEW-DATE               PIC X(10)  VALUE SPACES.       01390000
014000     05  PV-SUB                    PIC S9(4)  VALUE +0 COMP.      01400014
014100     05  PV-SQL-SUB                PIC S9(4)  VALUE +0 COMP.      01410000
014200     05  PV-CPU-TIME               PIC X(08)  VALUE SPACES.       01420021
014300     05  PV-CONVERT-PRICE          PIC S9(07)V9(02) VALUE +0.     01430000
014400     05  PV-GP-PRIC-ID             PIC 9(11)  VALUE 0.            01440000
014500                                                                  01450000
014600     05  PV-PRIC-EFF-TMST.                                        01460000
014700         10  PV-PRIC-EFF-DTE       PIC X(10).                     01470000
014800         10  FILLER                PIC X(01) VALUE SPACE.         01480000
014900         10  PV-PRIC-EFF-TIME      PIC X(08).                     01490000
015000                                                                  01500000
015100     05  PV-LAST-PRCHG-TMST.                                      01510000
015200         10  PV-LAST-PRCHG-DTE    PIC X(10).                      01520000
015300         10  FILLER               PIC X(01) VALUE SPACE.          01530000
015400         10  PV-LAST-PRCHG-TIME   PIC X(08).                      01540000
015500                                                                  01550000
015600*----------------------------------------------------------       01560000
015700*  SKU PRICING FILE LAYOUT                                        01570000
015800*----------------------------------------------------------       01580000
015900     COPY EPRD220.                                                01590000
016000                                                                  01600000
016100*----------------------------------------------------------       01610000
016200* CONTROL CARD LAYOUT FOR TIMESTAMP                               01620000
016300*----------------------------------------------------------       01630000
016400     COPY EPWS105.                                                01640000
016500                                                                  01650000
016600*----------------------------------------------------------       01660000
016700* CONTROL CARD LAYOUT FOR TOMORROW'S DATE                         01670000
016800*----------------------------------------------------------       01680000
016900     COPY EPWS112.                                                01690000
017000                                                                  01700000
017100*----------------------------------------------------------       01710000
017200* CONTROL CARD LAYOUT FOR TODAY'S DATE                            01720000
017300*----------------------------------------------------------       01730000
017400     COPY EPWS140.                                                01740000
017500                                                                  01750000
017600*----------------------------------------------------------       01760000
017700* CONTROL CARD LAYOUT FOR NUMBER OF DAYS IN ADVANCE OF STORE      01770000
017800*              OPEN TO INCLUDE STORE IN EXTRACT PROCESS.          01780000
017900*----------------------------------------------------------       01790000
018000     COPY EPRD045.                                                01800000
018100                                                                  01810000
018200*----------------------------------------------------------       01820000
018300* CONTROL CARD LAYOUT FOR RANGE OF TIMESTAMPS FOR WHICH TO        01830000
018400*              EXTRACT DATA.                                      01840000
018500*----------------------------------------------------------       01850000
018600     COPY EPWS160.                                                01860000
018700                                                                  01870000
018800*-----------------------------------------------------------      01880000
018900* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         01890000
019000*-----------------------------------------------------------      01900000
019100     COPY DPWS004.                                                01910000
019200                                                                  01920000
019300*-----------------------------------------------------------      01930000
019400* PARAMETER LIST FOR THE CALENDAR ROUTINE (DPKUT500)              01940000
019500*-----------------------------------------------------------      01950000
019600     COPY DPWS500.                                                01960000
019700                                                                  01970000
019800*-----------------------------------------------------------      01980000
019900* DB2 ABEND COPYBOOK                                              01990000
020000*-----------------------------------------------------------      02000000
020100     COPY DPWS900.                                                02010000
020200                                                                  02020000
020300*-----------------------------------------------------------      02030000
020400* DB2 MESSAGE AREA                                                02040000
020500*-----------------------------------------------------------      02050000
020600     COPY SQLCA2.                                                 02060000
020700                                                                  02070000
020800*-----------------------------------------------------------      02080000
020900* PROGRAM COUNTERS                                                02090000
021000*-----------------------------------------------------------      02100000
021100 01  PV-PROGRAM-COUNTERS.                                         02110000
021200     05  PV-CNT-SKUS-STR-CSR          PIC 9(09) VALUE 0.          02120000
021300     05  PV-CNT-SKUS-ATTR-CSR         PIC 9(09) VALUE 0.          02130000
021400     05  PV-CNT-STR-SKU-PRICG-RECS    PIC 9(09) VALUE 0.          02140000
021500     05  PV-CNT-SINCE-DISPLAY         PIC 9(09) VALUE 0.          02150000
021510                                                                  02151025
021520 01  DL-DISPLAY-LINE.                                             02152025
021530     05  FILLER                       PIC X(18) VALUE             02153025
021540                                    '>> INTERIM COUNT: '.         02154025
021550     05  DL-COUNT                     PIC 9(09) VALUE ZERO.       02155025
021560     05  FILLER                       PIC X(05) VALUE 'TIME '.    02156025
021570     05  DL-TIME                      PIC X(08) VALUE SPACE.      02157025
021600*-----------------------------------------------------------      02160016
021700* TABLE TO HOLD THE 100 RECORDS FROM THE MULTI-ROW FETCH          02170016
021800*-----------------------------------------------------------      02180016
021900 01 TL-HOST-VAR-TABLE.                                            02190016
022000     05 TL-SKU-NBR           PIC S9(8)V COMP-3 OCCURS 100 TIMES.  02200016
022100     05 TL-LOC-NBR           PIC S9(4) COMP OCCURS 100 TIMES.     02210016
022200     05 TL-UNT-RTL-AMT   PIC S9(7)V9(2) COMP-3 OCCURS 100 TIMES.  02220016
022300     05 TL-LOC-SKU-STAT-CDE PIC X(02) OCCURS 100 TIMES.           02230016
022400     05 TL-GP-PRIC-ID        PIC S9(9) COMP OCCURS 100 TIMES.     02240016
022500     05 TL-GP-PRIC-ID-IND    PIC S9(4) COMP OCCURS 100 TIMES.     02250016
022600     05 TL-UNT-RTL-CHG-DTE   PIC X(10) OCCURS 100 TIMES.          02260016
022700     05 TL-GP-RTL-QTY        PIC S9(4) COMP OCCURS 100 TIMES.     02270016
022800     05 TL-GP-RTL-QTY-IND    PIC S9(4) COMP OCCURS 100 TIMES.     02280016
022900     05 TL-GP-RTL-AMT    PIC S9(7)V9(2) COMP-3 OCCURS 100 TIMES.  02290016
023000     05 TL-GP-RTL-AMT-IND    PIC S9(4) COMP OCCURS 100 TIMES.     02300016
023100     05 TLB-LOC-NBR          PIC S9(4) COMP OCCURS 100 TIMES.     02310016
023200     05 TLB-PRMPT-FOR-PRIC-IND PIC X(1) OCCURS 100 TIMES.         02320016
023300                                                                  02330014
023400                                                                  02340000
023500*-----------------------------------------------------------      02350000
023600* ERROR HANDLING                                                  02360000
023700*-----------------------------------------------------------      02370000
023800 01  PV-MISC-ABEND-FIELDS.                                        02380000
023900     05  PV-PARAGRAPH-NAME            PIC X(30) VALUE SPACE.      02390000
024000     05  PV-OPERATION-MSG-1           PIC X(40) VALUE SPACE.      02400000
024100     05  PV-OPERATION-MSG-2           PIC X(40) VALUE SPACE.      02410000
024200     05  PV-DB2-OPERATION             PIC X(30) VALUE SPACE.      02420000
024300 01  ABEND-CODE                  PIC S9(4) VALUE ZEROS COMP SYNC. 02430000
024400     88  ABEND-4003-CTRL-CARD-ERROR        VALUE +4003.           02440000
024500     88  ABEND-4013-DB2-ERROR              VALUE +4013.           02450000
024600     88  ABEND-4019-CAL-SUB-ERROR          VALUE +4019.           02460000
024700                                                                  02470000
024800*-----------------------------------------------------------      02480000
024900* DB2 COMMUNICATIONS AREA                                         02490000
025000*-----------------------------------------------------------      02500000
025100     EXEC SQL                                                     02510000
025200          INCLUDE SQLCA                                           02520000
025300     END-EXEC.                                                    02530000
025400                                                                  02540000
025500*-----------------------------------------------------------      02550000
025600* DB2 TABLE XST00010(XST_SKU) - SKU TABLE                         02560000
025700*-----------------------------------------------------------      02570000
025800     EXEC SQL                                                     02580000
025900          INCLUDE XST00010                                        02590000
026000     END-EXEC.                                                    02600000
026100                                                                  02610000
026200*-----------------------------------------------------------      02620000
026300* DB2 TABLE XST00011(XST_SKU_ATTR) - SKU ATTRIBUTE TABLE          02630000
026400*-----------------------------------------------------------      02640000
026500     EXEC SQL                                                     02650000
026600          INCLUDE XST00011                                        02660000
026700     END-EXEC.                                                    02670000
026800                                                                  02680000
026900*-----------------------------------------------------------      02690000
027000* DB2 TABLE XST00008(XST_SKU_LOC) - SKU LOCATION TABLE            02700000
027100*-----------------------------------------------------------      02710000
027200     EXEC SQL                                                     02720000
027300          INCLUDE XST00008                                        02730000
027400     END-EXEC.                                                    02740000
027500                                                                  02750000
027600*-----------------------------------------------------------      02760000
027700* DB2 TABLE XST00041(XST_SKU_LOC_ATTR) - SKU LOCATION ATTRIBUTE   02770000
027800*                                               TABLE             02780000
027900*-----------------------------------------------------------      02790000
028000     EXEC SQL                                                     02800000
028100          INCLUDE XST00041                                        02810000
028200     END-EXEC.                                                    02820000
028300                                                                  02830000
028400*-----------------------------------------------------------      02840000
028500* DB2 TABLE XST00001(XST_LOC) - LOCATION TABLE                    02850000
028600*-----------------------------------------------------------      02860000
028700     EXEC SQL                                                     02870000
028800          INCLUDE XST00001                                        02880000
028900     END-EXEC.                                                    02890000
029000                                                                  02900000
029100*-----------------------------------------------------------      02910000
029200* DB2 TABLE XST00025(XST_LOC_ATTR) - LOCATION ATTRIBUTE TABLE     02920000
029300*-----------------------------------------------------------      02930000
029400     EXEC SQL                                                     02940000
029500          INCLUDE XST00025                                        02950000
029600     END-EXEC.                                                    02960000
029700                                                                  02970000
029800*-----------------------------------------------------------      02980000
029900*  SKUS-STR-CSR WILL FIND RECORDS RELATED TO A INTR_UPC_ID        02990000
030000*       WHERE THE SKU_LOC ROW WAS UPDATED DURING THE TIMESTAMP    03000000
030100*       RANGE PROVIDED ON THE CONTROL CARD.                       03010000
030200*       FINDS CHANGES TO STORE SPECIFIC PRICING ONLY.             03020000
030300*-----------------------------------------------------------      03030000
030400     EXEC SQL                                                     03040000
030500       DECLARE SKUS-STR-CSR CURSOR                                03050017
030600       WITH ROWSET POSITIONING FOR                                03060014
030700            SELECT  A.SKU_NBR                                     03070018
030800                   ,B.LOC_NBR                                     03080007
030900                   ,B.UNT_RTL_AMT                                 03090007
031000                   ,B.LOC_SKU_STAT_CDE                            03100007
031100                   ,B.GP_PRIC_ID                                  03110007
031200                   ,B.UNT_RTL_CHG_DTE                             03120007
031300                   ,B.GP_RTL_QTY                                  03130007
031400                   ,B.GP_RTL_AMT                                  03140007
031500              FROM  XST_SKU           A                           03150007
031600                   ,XST_SKU_LOC       B                           03160007
031700                   ,XST_SKU_ATTR      C                           03170027
031800                   ,XST_LOC           E                           03180007
031900                   ,XST_LOC_ATTR      F                           03190007
032000             WHERE  A.INTR_UPC_ID     = B.INTR_UPC_ID             03200007
032100               AND  A.INTR_UPC_ID     = C.INTR_UPC_ID             03210027
032200               AND  B.LOC_NBR         > 0                         03220007
032300               AND  B.END_TMST        IS NULL                     03230007
032400               AND  C.PLU_DWNLD_EXCL_IND = 'N'                    03240027
032500               AND  B.LAST_UPD_TMST   >                           03250007
032600                    :CC-EPWS160-START-TMST                        03260007
032700               AND  B.LAST_UPD_TMST  <=                           03270007
032800                    :CC-EPWS160-END-TMST                          03280007
032900               AND  B.LOC_NBR         = E.LOC_NBR                 03290007
033000               AND  B.LOC_NBR         = F.LOC_NBR                 03300007
033100               AND  E.LOC_TYP_CDE     = 'DS'                      03310007
033200               AND ((E.OPN_DTE       <= :PV-START-DATE            03320007
033300                AND  E.CLO_DTE       >= :PV-START-DATE)           03330007
033400               OR   (E.OPN_DTE        > :PV-START-DATE            03340007
033500                AND  E.OPN_DTE       <= :PV-NEW-DATE              03350007
033600                AND E.CLO_DTE        >= :PV-NEW-DATE))            03360007
033700               AND  E.LOC_NBR         = F.LOC_NBR                 03370007
033800               AND (F.POS_CAP_LVL_ID  = 5                         03380007
033900                 OR F.POS_CAP_LVL_ID  > 11)                       03390007
034000           WITH UR                                                03400007
034100     END-EXEC.                                                    03410000
034200                                                                  03420000
034300*-----------------------------------------------------------      03430000
034400*  SKUS-ATTR-CSR WILL FIND RECORDS RELATED TO A INTR_UPC_ID       03440000
034500*       WHERE THE SKU_LOC_ATTR ROW WAS UPDATED DURING THE         03450000
034600*       TIMESTAMP RANGE PROVIDED ON THE CONTROL CARD.             03460000
034700*       FINDS CHANGES TO STORE SPECIFIC PRICING ONLY.             03470000
034800*-----------------------------------------------------------      03480000
034900     EXEC SQL                                                     03490000
035000       DECLARE SKUS-ATTR-CSR CURSOR                               03500017
035100          WITH ROWSET POSITIONING FOR                             03510014
035200            SELECT  A.SKU_NBR                                     03520018
035300                   ,D.LOC_NBR                                     03530007
035400                   ,D.PRMPT_FOR_PRIC_IND                          03540007
035500              FROM  XST_SKU           A                           03550007
035600                   ,XST_SKU_ATTR      C                           03560007
035700                   ,XST_SKU_LOC_ATTR  D                           03570007
035800                   ,XST_LOC           E                           03580007
035900                   ,XST_LOC_ATTR      F                           03590007
036000             WHERE  A.INTR_UPC_ID     = C.INTR_UPC_ID             03600007
036100               AND  A.INTR_UPC_ID     = D.INTR_UPC_ID             03610007
036200               AND  D.LOC_NBR         > 0                         03620007
036300               AND  C.PLU_DWNLD_EXCL_IND = 'N'                    03630007
036400               AND  D.LAST_UPD_TMST   >                           03640007
036500                    :CC-EPWS160-START-TMST                        03650007
036600               AND  D.LAST_UPD_TMST  <=                           03660007
036700                    :CC-EPWS160-END-TMST                          03670007
036800               AND  D.LOC_NBR         = E.LOC_NBR                 03680007
036900               AND  D.LOC_NBR         = F.LOC_NBR                 03690007
037000               AND  E.LOC_TYP_CDE     = 'DS'                      03700007
037100               AND ((E.OPN_DTE       <= :PV-START-DATE            03710007
037200                AND  E.CLO_DTE       >= :PV-START-DATE)           03720007
037300               OR   (E.OPN_DTE        > :PV-START-DATE            03730007
037400                AND  E.OPN_DTE       <= :PV-NEW-DATE              03740007
037500                AND E.CLO_DTE        >= :PV-NEW-DATE))            03750007
037600               AND  E.LOC_NBR         = F.LOC_NBR                 03760007
037700               AND (F.POS_CAP_LVL_ID  = 5                         03770007
037800                 OR F.POS_CAP_LVL_ID  > 11)                       03780007
037900           WITH UR                                                03790007
038000     END-EXEC.                                                    03800000
038100                                                                  03810000
038200 LINKAGE SECTION.                                                 03820000
038300                                                                  03830000
038400*----------------------------------------------------------       03840000
038500 PROCEDURE DIVISION.                                              03850000
038600*----------------------------------------------------------       03860000
038700 0000-MAINLINE.                                                   03870000
038800                                                                  03880000
038900     PERFORM 1000-INITIALIZATION.                                 03890000
039000                                                                  03900000
039100     PERFORM 2000-PROCESS-CSR.                                    03910000
039200                                                                  03920000
039300     PERFORM 9999-WRAPUP.                                         03930000
039400                                                                  03940000
039500     GOBACK.                                                      03950000
039600                                                                  03960000
039700*0000-EXIT.                                                       03970000
039800                                                                  03980000
039900*----------------------------------------------------------       03990000
040000* 1000-INITIALIZATION.                                            04000000
040100*     INITIALIZATION AREA - INITIALIZES ALL VARIABLES, OPENS      04010000
040200*     FILES AND READS CONTROL RECORDS                             04020000
040300*----------------------------------------------------------       04030000
040400 1000-INITIALIZATION.                                             04040000
040500                                                                  04050000
040600     DISPLAY '***EPKUT156 * 1000-INITIALIZATION'.                 04060000
040700     DISPLAY ' '.                                                 04070000
040800                                                                  04080000
040900     INITIALIZE CC-EPCC112-CONTROL-CARD,                          04090000
041000                CC-EPCC105-CONTROL-CARD,                          04100000
041100                CC-EPCC140-CONTROL-CARD,                          04110000
041200                EP045-ADVDAYS-TO-SND-RECORD,                      04120000
041300                CC-EPWS160-CONTROL-CARD                           04130019
041400                EP220-XST-SKU-PRICG-RECORD.                       04140019
041500     SET PS-MORE-INPUT-FILE TO TRUE.                              04150000
041600                                                                  04160000
041700     OPEN INPUT  CC-TOMORROW                                      04170000
041800                 CC-PREV-TMST                                     04180000
041900                 CC-TODAY                                         04190000
042000                 CC-DAYS                                          04200000
042100                 CC-TMST-RANGE                                    04210000
042200          OUTPUT CHG-SKU-PRICG-STORE-FILE.                        04220018
042300                                                                  04230000
042400     PERFORM 1200-READ-CC-TOMORROW.                               04240000
042500                                                                  04250000
042600     PERFORM 1300-READ-CC-PREV-TMST.                              04260000
042700                                                                  04270000
042800     PERFORM 1400-READ-TODAY.                                     04280000
042900                                                                  04290000
043000     PERFORM 1100-READ-DAYS.                                      04300000
043100                                                                  04310000
043200*    * ADD "DAYS" (BEFORE OPENING TO SEND DATA)                   04320000
043300*    * TO "TODAY" (RUN DATE)                                      04330000
043400*    *  TO GET DATE FOR NEW STORES DATE CHECKING                  04340000
043500     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         04350000
043600     SET  DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                     04360000
043700     SET  DPG52-LK-DTE-ISO-FMT       TO TRUE.                     04370000
043800     SET  DPG51-INCREMENT-DATE       TO TRUE.                     04380000
043900     MOVE CC-EPCC140-TODAY-DATE      TO DPG52-LK-DATE-INPUT.      04390000
044000     MOVE EP045-DAYS-TILL-STORE-OPN  TO DPG51-INCR-DECR-DAYS-9.   04400000
044100     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    04410000
044200                                             DPG54 DPG55 DPG56.   04420000
044300     EVALUATE TRUE                                                04430000
044400         WHEN DPG54-NO-ERROR                                      04440000
044500             DISPLAY 'CALCULATED DATE FOR FUTURE STORES',         04450000
044600                     ' (USING DPKUT500):',                        04460000
044700                DPG55-DB2-ISO-DATE-FMT                            04470000
044800             DISPLAY '      TODAY + DAYS = FUTURE DATE'           04480000
044900             MOVE DPG55-DB2-ISO-DATE-FMT TO PV-NEW-DATE           04490000
045000         WHEN DPG54-SEVERE-ERROR                                  04500000
045100             DISPLAY ' '                                          04510000
045200             DISPLAY '** ABEND ** IN EPKUT108'                    04520000
045300             DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE'    04530000
045400             DISPLAY '** CALLED BY 1000-INITIALIZATION'           04540000
045500             DISPLAY '** ERROR MESSAGE = '                        04550000
045600                               DPG54-ERROR-MESSAGE                04560000
045700             DISPLAY '** DPG51 = ' DPG51                          04570000
045800             DISPLAY '** DPG52 = ' DPG52                          04580000
045900             DISPLAY '** DPG53 = ' DPG53                          04590000
046000             DISPLAY '** DPG54 = ' DPG54                          04600000
046100             DISPLAY '** DPG55 = ' DPG55                          04610000
046200             DISPLAY '** DPG56 = ' DPG56                          04620000
046300             MOVE '1000-INITIALIZATION'                           04630000
046400                                  TO PV-PARAGRAPH-NAME            04640000
046500             MOVE 'ERROR CALCULATING NEW STORE DATE'              04650000
046600                                  TO PV-OPERATION-MSG-1           04660000
046700             MOVE DPG54-ERROR-MESSAGE  TO PV-OPERATION-MSG-2      04670000
046800             SET ABEND-4019-CAL-SUB-ERROR TO TRUE                 04680000
046900             PERFORM 9800-ABEND                                   04690000
047000     END-EVALUATE.                                                04700000
047100                                                                  04710000
047200     PERFORM 1500-READ-RANGE.                                     04720000
047300                                                                  04730000
047400     CLOSE CC-TOMORROW                                            04740000
047500           CC-PREV-TMST                                           04750000
047600           CC-TODAY                                               04760000
047700           CC-DAYS                                                04770000
047800           CC-TMST-RANGE.                                         04780000
047900                                                                  04790000
048000*1000-EXIT.                                                       04800000
048100                                                                  04810000
048200*----------------------------------------------------------       04820000
048300* 1100-READ-DAYS.                                                 04830000
048400*     READ DAYS CONTROL CARD. GETS NUMBERS OF DAYS BEFORE         04840000
048500*     STORE OPENING TO CONSIDER STORES VALID.                     04850000
048600*----------------------------------------------------------       04860000
048700 1100-READ-DAYS.                                                  04870000
048800                                                                  04880000
048900     READ CC-DAYS INTO EP045-ADVDAYS-TO-SND-RECORD                04890000
049000       AT END                                                     04900000
049100          SET PS-END-OF-INPUT-FILE TO TRUE.                       04910000
049200                                                                  04920000
049300     IF PS-END-OF-INPUT-FILE                                      04930000
049400        DISPLAY 'CONTROL CARD MISSING FOR EPCC045 '               04940000
049500        MOVE '1100-READ-DAYS'            TO PV-PARAGRAPH-NAME     04950000
049600        MOVE 'CONTROL CARD 3 IS MISSING' TO PV-OPERATION-MSG-1    04960000
049700        SET ABEND-4003-CTRL-CARD-ERROR   TO TRUE                  04970000
049800        PERFORM 9800-ABEND                                        04980000
049900     END-IF.                                                      04990000
050000                                                                  05000000
050100     IF EP045-DAYS-TILL-STORE-OPN NOT NUMERIC                     05010000
050200        DISPLAY 'INVALID CONTROL CARD 045 - DAYS'                 05020000
050300        DISPLAY '   DAYS UNTIL OPEN: ',                           05030000
050400                EP045-DAYS-TILL-STORE-OPN                         05040000
050500        MOVE '1100-READ-DAYS'            TO PV-PARAGRAPH-NAME     05050000
050600        MOVE 'CONTROL CARD 3 IS INVALID' TO PV-OPERATION-MSG-1    05060000
050700        SET ABEND-4003-CTRL-CARD-ERROR   TO TRUE                  05070000
050800        PERFORM 9800-ABEND                                        05080000
050900     END-IF.                                                      05090000
051000                                                                  05100000
051100     DISPLAY '** DAYS BEFORE OPEN TO INCLUDE NEW STORE:'.         05110000
051200     DISPLAY '   EPCC045 CONTROL CARD: '                          05120000
051300             EP045-ADVDAYS-TO-SND-RECORD.                         05130000
051400     DISPLAY ' '.                                                 05140000
051500                                                                  05150000
051600*1100-EXIT.                                                       05160000
051700                                                                  05170000
051800*----------------------------------------------------------       05180000
051900* 1200-READ-CC-TOMORROW.                                          05190000
052000*     READ CONTROL CARD 1.  THIS GETS THE FUTURE DATE THAT        05200000
052100*     NEEDS TO BE PROCESSED.                                      05210000
052200*----------------------------------------------------------       05220000
052300 1200-READ-CC-TOMORROW.                                           05230000
052400                                                                  05240000
052500     READ CC-TOMORROW INTO CC-EPCC112-CONTROL-CARD                05250000
052600       AT END                                                     05260000
052700          SET PS-END-OF-INPUT-FILE TO TRUE.                       05270000
052800                                                                  05280000
052900     IF PS-END-OF-INPUT-FILE                                      05290000
053000        DISPLAY 'CONTROL CARD MISSING FOR EPCC112 '               05300000
053100        MOVE '1200-READ-CC-TOMORROW'     TO PV-PARAGRAPH-NAME     05310000
053200        MOVE 'CONTROL CARD 1 IS MISSING' TO PV-OPERATION-MSG-1    05320000
053300        SET ABEND-4003-CTRL-CARD-ERROR   TO TRUE                  05330000
053400        PERFORM 9800-ABEND                                        05340000
053500     END-IF.                                                      05350000
053600                                                                  05360000
053700     IF CC-EPCC112-TOMORROW-DATE =  SPACES                        05370000
053800        DISPLAY 'INVALID CONTROL CARD'                            05380000
053900        DISPLAY '  TOMMORROWS DATE: ' CC-EPCC112-TOMORROW-DATE    05390000
054000        MOVE '1200-READ-CC-TOMORROW'   TO PV-PARAGRAPH-NAME       05400000
054100        MOVE 'CONTROL CARD IS INVALID' TO PV-OPERATION-MSG-1      05410000
054200        SET ABEND-4003-CTRL-CARD-ERROR TO TRUE                    05420000
054300        PERFORM 9800-ABEND                                        05430000
054400     END-IF.                                                      05440000
054500                                                                  05450000
054600     DISPLAY '** TOMORROW DATE BASED ON CONTROL CARD **'.         05460000
054700     DISPLAY '   EPCC112 CONTROL CARD: ' CC-EPCC112-CONTROL-CARD. 05470000
054800     DISPLAY ' '.                                                 05480000
054900     MOVE CC-EPCC112-TOMORROW-DATE     TO PV-START-DATE.          05490000
055000                                                                  05500000
055100     MOVE CC-EPCC112-TOMORROW-DATE  TO PV-PRIC-EFF-DTE.           05510000
055200     MOVE PC-PRIC-EFF-TIME-STD      TO PV-PRIC-EFF-TIME.          05520000
055300     DISPLAY 'PRIC EFF TMST TO SQLS: ' PV-PRIC-EFF-TMST.          05530000
055400                                                                  05540000
055500*1200-EXIT.                                                       05550000
055600                                                                  05560000
055700*----------------------------------------------------------       05570000
055800* 1300-READ-CC-PREV-TMST.                                         05580000
055900*     READ CONTROL CARD 2.  THIS GETS ALL TIMESTAMP WHEN THE      05590000
056000*     EXTRACT PROCESS STARTED THE PREVIOUS DAY.  ALL CHANGES      05600000
056100*     SINCE THAT TIME ARE TO BE EXTRACTED DURING THIS RUN.        05610000
056200*----------------------------------------------------------       05620000
056300 1300-READ-CC-PREV-TMST.                                          05630000
056400                                                                  05640000
056500     READ CC-PREV-TMST INTO CC-EPCC105-CONTROL-CARD               05650000
056600       AT END                                                     05660000
056700          SET PS-END-OF-INPUT-FILE TO TRUE                        05670000
056800     END-READ.                                                    05680000
056900                                                                  05690000
057000     IF PS-END-OF-INPUT-FILE                                      05700000
057100        DISPLAY 'CONTROL CARD MISSING FOR EPCC105 '               05710000
057200        MOVE '1300-READ-CC-PREV-TMST'    TO PV-PARAGRAPH-NAME     05720000
057300        MOVE 'CONTROL CARD 2 IS MISSING' TO PV-OPERATION-MSG-1    05730000
057400        SET ABEND-4003-CTRL-CARD-ERROR   TO TRUE                  05740000
057500        PERFORM 9800-ABEND                                        05750000
057600     END-IF.                                                      05760000
057700                                                                  05770000
057800     DISPLAY '** PREVIOUS RUN TIMESTAMP CONTROL CARD **'.         05780000
057900     DISPLAY '   EPCC105 CONTROL CARD: ' CC-EPCC105-CONTROL-CARD. 05790000
058000     DISPLAY ' '.                                                 05800000
058100                                                                  05810000
058200*1300-EXIT.                                                       05820000
058300                                                                  05830000
058400*----------------------------------------------------------       05840000
058500* 1400-READ-TODAY.                                                05850000
058600*     READ EPCC140 TODAY.  TODAYS RUN DATE                        05860000
058700*----------------------------------------------------------       05870000
058800 1400-READ-TODAY.                                                 05880000
058900                                                                  05890000
059000     READ CC-TODAY INTO CC-EPCC140-CONTROL-CARD                   05900000
059100       AT END                                                     05910000
059200          SET PS-END-OF-INPUT-FILE TO TRUE                        05920000
059300     END-READ.                                                    05930000
059400                                                                  05940000
059500     IF  PS-END-OF-INPUT-FILE                                     05950000
059600        DISPLAY 'MISSING CONTROL CARD 140 - TODAY'                05960000
059700        MOVE '1400-READ-TODAY'         TO PV-PARAGRAPH-NAME       05970000
059800        MOVE 'CONTROL CARD IS MISSING' TO PV-OPERATION-MSG-1      05980000
059900        SET ABEND-4003-CTRL-CARD-ERROR TO TRUE                    05990000
060000        PERFORM 9800-ABEND                                        06000000
060100     END-IF.                                                      06010000
060200                                                                  06020000
060300     IF CC-EPCC140-TODAY-DATE =  SPACES                           06030000
060400        DISPLAY 'INVALID CONTROL CARD'                            06040000
060500        DISPLAY '   TODAY RUN DATE: ' CC-EPCC140-TODAY-DATE       06050000
060600        MOVE '1400-READ-TODAY'         TO PV-PARAGRAPH-NAME       06060000
060700        MOVE 'CONTROL CARD IS INVALID' TO PV-OPERATION-MSG-1      06070000
060800        SET ABEND-4003-CTRL-CARD-ERROR TO TRUE                    06080000
060900        PERFORM 9800-ABEND                                        06090000
061000     END-IF.                                                      06100000
061100                                                                  06110000
061200     DISPLAY '** TODAY BASED ON CONTROL CARD **'.                 06120000
061300     DISPLAY '   EPCC140 CONTROL CARD: ' CC-EPCC140-CONTROL-CARD. 06130000
061400     DISPLAY ' '.                                                 06140000
061500                                                                  06150000
061600*1400-EXIT.                                                       06160000
061700                                                                  06170000
061800*----------------------------------------------------------       06180000
061900* 1500-READ-RANGE.                                                06190000
062000*     READ START/END TIMESTAMP RANGE INTO EPWS160.                06200000
062100*----------------------------------------------------------       06210000
062200 1500-READ-RANGE.                                                 06220000
062300                                                                  06230000
062400     READ CC-TMST-RANGE INTO CC-EPWS160-CONTROL-CARD              06240000
062500       AT END                                                     06250000
062600          SET PS-END-OF-INPUT-FILE TO TRUE                        06260000
062700     END-READ.                                                    06270000
062800                                                                  06280000
062900     IF  PS-END-OF-INPUT-FILE                                     06290000
063000        DISPLAY 'MISSING CONTROL CARD 160 - RANGE'                06300000
063100        MOVE '1500-READ-RANGE'         TO PV-PARAGRAPH-NAME       06310000
063200        MOVE 'CONTROL CARD IS MISSING' TO PV-OPERATION-MSG-1      06320000
063300        SET ABEND-4003-CTRL-CARD-ERROR TO TRUE                    06330000
063400        PERFORM 9800-ABEND                                        06340000
063500     END-IF.                                                      06350000
063600                                                                  06360000
063700     DISPLAY '** LAST UPDATE TIMESTAMP RANGE ON CONTROL CARD **'. 06370000
063800     DISPLAY '   EPWS160 CONTROL CARD: ' CC-EPWS160-CONTROL-CARD. 06380000
063900     DISPLAY ' '.                                                 06390000
064000                                                                  06400000
064100*1500-EXIT.                                                       06410000
064200                                                                  06420000
064300*----------------------------------------------------------       06430000
064400* 2000-PROCESS-CSR.                                               06440000
064500*     FETCHES THE SKUS STORE CURSOR AND THEN WRITES APPROPRIATE   06450000
064600*     STORE SPECIFIC RECORDS.                                     06460000
064700*----------------------------------------------------------       06470000
064800 2000-PROCESS-CSR.                                                06480000
064900                                                                  06490000
065000     DISPLAY '** OPENING SKUS STR CSR   **  :'.                   06500017
065100     PERFORM 2400-OPEN-SKUS-STR-CSR.                              06510000
065200                                                                  06520000
065300     SET PS-MORE-SKUS-STR-CSR  TO TRUE.                           06530014
065400                                                                  06540000
065500     PERFORM 2420-PROCESS-SKUS-STR-CSR                            06550011
065600       UNTIL PS-END-OF-SKUS-STR-CSR.                              06560000
065700                                                                  06570000
065800     PERFORM 2410-CLOSE-SKUS-STR-CSR.                             06580000
065900                                                                  06590000
066000     DISPLAY '** OPENING SKUS ATTR CSR **'.                       06600017
066100     PERFORM 2500-OPEN-SKUS-ATTR-CSR.                             06610000
066200                                                                  06620000
066300     SET PS-MORE-SKUS-STR-CSR TO TRUE.                            06630014
066400     PERFORM 2520-PROCESS-SKUS-ATTR-CSR                           06640000
066500       UNTIL PS-END-OF-SKUS-STR-CSR.                              06650000
066600                                                                  06660000
066700     PERFORM 2510-CLOSE-SKUS-ATTR-CSR.                            06670000
066800                                                                  06680000
066900*2000-EXIT.                                                       06690000
067000                                                                  06700000
067100*----------------------------------------------------------       06710000
067200* 2400-OPEN-SKUS-STR-CSR.                                         06720000
067300*     OPEN SKUS STORE CURSOR TO FIND PRICE CHANGES.               06730000
067400*----------------------------------------------------------       06740000
067500 2400-OPEN-SKUS-STR-CSR.                                          06750000
067600                                                                  06760000
067700     PERFORM                                                      06770000
067800         WITH TEST AFTER                                          06780000
067900         VARYING PV-SQL-SUB                                       06790000
068000         FROM 1 BY 1                                              06800000
068100         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 06810000
068200                   OR  SQLCODE = 0)                               06820000
068300                                                                  06830000
068400           EXEC SQL                                               06840000
068500              OPEN SKUS-STR-CSR                                   06850000
068600           END-EXEC                                               06860000
068700                                                                  06870000
068800         EVALUATE TRUE                                            06880000
068900             WHEN SQLCODE = -904                                  06890000
069000             WHEN SQLCODE = -911                                  06900000
069100             WHEN SQLCODE = -913                                  06910000
069200                  CONTINUE                                        06920000
069300             WHEN SQLCODE = 0                                     06930000
069400                  SET PS-MORE-SKUS-STR-CSR TO TRUE                06940000
069500             WHEN OTHER                                           06950000
069600                  MOVE '2400-OPEN-SKUS-STR-CSR'                   06960000
069700                                     TO PV-PARAGRAPH-NAME         06970000
069800                  MOVE 'ERROR ON OPEN OF SKU STORE CURSOR'        06980000
069900                                     TO PV-DB2-OPERATION          06990000
070000                  PERFORM 9900-SQL-ABEND-ROUTINE                  07000000
070100         END-EVALUATE                                             07010000
070200     END-PERFORM.                                                 07020000
070300                                                                  07030000
070400     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         07040000
070500        MOVE '2400-OPEN-SKUS-STR-CSR'                             07050000
070600                             TO  PV-PARAGRAPH-NAME                07060000
070700        MOVE 'OPEN RETRIES EXCEEDED'                              07070000
070800                              TO  PV-DB2-OPERATION                07080000
070900        PERFORM 9900-SQL-ABEND-ROUTINE                            07090000
071000     END-IF.                                                      07100000
071100                                                                  07110000
071200*2400-EXIT.                                                       07120000
071300                                                                  07130000
071400*-----------------------------------------------------------      07140000
071500* 2410-CLOSE-SKUS-STR-CSR.                                        07150000
071600*     CLOSE THE SKUS STORE CURSOR.                                07160000
071700*-----------------------------------------------------------      07170000
071800 2410-CLOSE-SKUS-STR-CSR.                                         07180000
071900                                                                  07190000
072000     IF PV-CNT-SINCE-DISPLAY > 0                                  07200000
072100        ACCEPT PV-CPU-TIME FROM TIME                              07210025
072110        MOVE PV-CNT-SINCE-DISPLAY TO DL-COUNT                     07211025
072120        MOVE PV-CPU-TIME          TO DL-TIME                      07212025
072200        DISPLAY DL-DISPLAY-LINE                                   07220025
072400        MOVE 0 TO PV-CNT-SINCE-DISPLAY                            07240000
072500     END-IF.                                                      07250000
072600                                                                  07260000
072700     PERFORM                                                      07270000
072800         WITH TEST AFTER                                          07280000
072900         VARYING PV-SQL-SUB                                       07290000
073000         FROM 1 BY 1                                              07300000
073100         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 07310000
073200                   OR  SQLCODE = 0)                               07320000
073300                                                                  07330000
073400           EXEC SQL                                               07340000
073500              CLOSE SKUS-STR-CSR                                  07350000
073600           END-EXEC                                               07360000
073700                                                                  07370000
073800          EVALUATE TRUE                                           07380000
073900             WHEN SQLCODE = -904                                  07390000
074000             WHEN SQLCODE = -911                                  07400000
074100             WHEN SQLCODE = -913                                  07410000
074200                  CONTINUE                                        07420000
074300             WHEN SQLCODE = 0                                     07430000
074400                  CONTINUE                                        07440000
074500             WHEN OTHER                                           07450000
074600                  MOVE '2410-CLOSE-SKUS-STR-CSR'                  07460000
074700                                      TO PV-PARAGRAPH-NAME        07470000
074800                  MOVE 'ERROR ON CLOSE OF SKU STORE CURSOR'       07480000
074900                                      TO PV-DB2-OPERATION         07490000
075000                  PERFORM 9900-SQL-ABEND-ROUTINE                  07500000
075100          END-EVALUATE                                            07510000
075200     END-PERFORM.                                                 07520000
075300                                                                  07530000
075400     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         07540000
075500        MOVE '2410-CLOSE-SKUS-STR-CSR'                            07550000
075600                               TO  PV-PARAGRAPH-NAME              07560000
075700        MOVE 'CLOSE RETRIES EXCEEDED'                             07570000
075800                               TO  PV-DB2-OPERATION               07580000
075900        PERFORM 9900-SQL-ABEND-ROUTINE                            07590000
076000     END-IF.                                                      07600000
076100                                                                  07610000
076200*2410-EXIT.                                                       07620000
076300                                                                  07630000
076400*----------------------------------------------------------       07640000
076500* 2420-PROCESS-SKUS-STR-CSR.                                      07650000
076600*     PROCESSES STORE SKUS THAT HAVE CHANGED, WRITING A STORE     07660000
076700*     PLU RECORD.  IF SKU WAS CREATED SINCE LAST RUN, ANY RELATED 07670000
076800*     STORE DATA IS INCLUDED HERE.                                07680000
076900*----------------------------------------------------------       07690000
077000 2420-PROCESS-SKUS-STR-CSR.                                       07700000
077100                                                                  07710000
077200     PERFORM 2430-FETCH-SKUS-STR-CSR.                             07720014
077300                                                                  07730014
077400     PERFORM VARYING PV-SUB                                       07740014
077500        FROM 1 BY 1                                               07750014
077600       UNTIL PV-SUB > SQLERRD(3)                                  07760014
077700                                                                  07770000
077800       PERFORM 4000-CREATE-SKU-PRICG-STR-REC                      07780014
077900                                                                  07790000
078000                                                                  07800000
078100       IF PV-CNT-SINCE-DISPLAY > 99999                            07810021
078200          ACCEPT PV-CPU-TIME FROM TIME                            07820025
078210          MOVE PV-CNT-SINCE-DISPLAY TO DL-COUNT                   07821025
078220          MOVE PV-CPU-TIME          TO DL-TIME                    07822025
078230          DISPLAY DL-DISPLAY-LINE                                 07823025
078500          MOVE 0 TO PV-CNT-SINCE-DISPLAY                          07850000
078600       END-IF                                                     07860017
078700     END-PERFORM.                                                 07870014
078800                                                                  07880000
078900*2420-EXIT.                                                       07890000
079000                                                                  07900000
079100*----------------------------------------------------------       07910000
079200* 2430-FETCH-SKUS-STR-CSR.                                        07920000
079300*     FETCH A ROW FORM THE SKUS STORE CURSOR.                     07930000
079400*----------------------------------------------------------       07940000
079500 2430-FETCH-SKUS-STR-CSR.                                         07950000
079600                                                                  07960000
079700     PERFORM                                                      07970000
079800         WITH TEST AFTER                                          07980000
079900         VARYING PV-SQL-SUB                                       07990000
080000         FROM 1 BY 1                                              08000000
080100         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 08010000
080200                   OR  SQLCODE = 0                                08020000
080300                   OR  SQLCODE = +100)                            08030000
080400                                                                  08040000
080500           EXEC SQL                                               08050000
080600              FETCH NEXT ROWSET FROM SKUS-STR-CSR                 08060014
080700              FOR :PC-ROWS ROWS                                   08070017
080800              INTO                                                08080014
080900                    :TL-SKU-NBR                                   08090018
081000                   ,:TL-LOC-NBR                                   08100016
081100                   ,:TL-UNT-RTL-AMT                               08110016
081200                   ,:TL-LOC-SKU-STAT-CDE                          08120016
081300                   ,:TL-GP-PRIC-ID       :TL-GP-PRIC-ID-IND       08130016
081400                   ,:TL-UNT-RTL-CHG-DTE                           08140016
081500                   ,:TL-GP-RTL-QTY       :TL-GP-RTL-QTY-IND       08150016
081600                   ,:TL-GP-RTL-AMT       :TL-GP-RTL-AMT-IND       08160016
081700           END-EXEC                                               08170000
081800                                                                  08180000
081900          EVALUATE TRUE                                           08190000
082000             WHEN SQLCODE = -904                                  08200000
082100             WHEN SQLCODE = -911                                  08210000
082200             WHEN SQLCODE = -913                                  08220000
082300                  CONTINUE                                        08230000
082400             WHEN SQLCODE = ZERO                                  08240000
082500*    SQLERRD (3) - CONTAINS THE COUNT OF RECORDS FETCHED          08250017
082600                  ADD SQLERRD(3) TO PV-CNT-SKUS-STR-CSR           08260014
082700                                    PV-CNT-SINCE-DISPLAY          08270014
082800             WHEN SQLCODE = +100                                  08280000
082900                  ADD SQLERRD(3) TO PV-CNT-SKUS-STR-CSR           08290014
083000                                    PV-CNT-SINCE-DISPLAY          08300014
083100                  SET PS-END-OF-SKUS-STR-CSR      TO TRUE         08310000
083200             WHEN OTHER                                           08320000
083300                  MOVE '2430-FETCH-SKUS-STR-CSR'                  08330000
083400                                     TO PV-PARAGRAPH-NAME         08340000
083500                  MOVE 'ERROR ON FETCHING SKU STORE CURSOR'       08350000
083600                                     TO PV-DB2-OPERATION          08360000
083700                  DISPLAY 'SQLCODE= ' SQLCODE                     08370000
083800                  PERFORM 9900-SQL-ABEND-ROUTINE                  08380000
083900          END-EVALUATE                                            08390000
084000     END-PERFORM.                                                 08400000
084100                                                                  08410000
084200     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        08420000
084300         MOVE '2430-FETCH-SKUS-STR-CSR'                           08430000
084400                               TO  PV-PARAGRAPH-NAME              08440000
084500         MOVE 'FETCH RETRIES EXCEEDED'                            08450000
084600                               TO  PV-DB2-OPERATION               08460000
084700         PERFORM 9900-SQL-ABEND-ROUTINE                           08470000
084800     END-IF.                                                      08480000
084900                                                                  08490000
085000*2430-EXIT.                                                       08500000
085100                                                                  08510000
085200*----------------------------------------------------------       08520000
085300* 2500-OPEN-SKUS-ATTR-CSR.                                        08530000
085400*     OPEN SKUS ATTR CURSOR TO FIND PROMPT FOR PRICE CHANGES.     08540000
085500*----------------------------------------------------------       08550000
085600 2500-OPEN-SKUS-ATTR-CSR.                                         08560000
085700                                                                  08570000
085800     DISPLAY '** ABOUT TO OPEN SKUS ATTR CSR **'.                 08580000
085900     PERFORM                                                      08590000
086000         WITH TEST AFTER                                          08600000
086100         VARYING PV-SQL-SUB                                       08610000
086200         FROM 1 BY 1                                              08620000
086300         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 08630000
086400                   OR  SQLCODE = 0)                               08640000
086500                                                                  08650000
086600           EXEC SQL                                               08660000
086700              OPEN SKUS-ATTR-CSR                                  08670000
086800           END-EXEC                                               08680000
086900                                                                  08690000
087000         EVALUATE TRUE                                            08700000
087100             WHEN SQLCODE = -904                                  08710000
087200             WHEN SQLCODE = -911                                  08720000
087300             WHEN SQLCODE = -913                                  08730000
087400                  CONTINUE                                        08740000
087500             WHEN SQLCODE = 0                                     08750000
087600                  SET PS-MORE-SKUS-STR-CSR TO TRUE                08760000
087700             WHEN OTHER                                           08770000
087800                  MOVE '2500-OPEN-SKUS-ATTR-CSR'                  08780000
087900                                     TO PV-PARAGRAPH-NAME         08790000
088000                  MOVE 'ERROR ON OPEN OF SKU ATTR CURSOR'         08800000
088100                                     TO PV-DB2-OPERATION          08810000
088200                  PERFORM 9900-SQL-ABEND-ROUTINE                  08820000
088300         END-EVALUATE                                             08830000
088400     END-PERFORM.                                                 08840000
088500                                                                  08850000
088600     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         08860000
088700        MOVE '2500-OPEN-SKUS-ATTR-CSR'                            08870000
088800                             TO  PV-PARAGRAPH-NAME                08880000
088900        MOVE 'OPEN RETRIES EXCEEDED'                              08890000
089000                              TO  PV-DB2-OPERATION                08900000
089100        PERFORM 9900-SQL-ABEND-ROUTINE                            08910000
089200     END-IF.                                                      08920000
089300                                                                  08930000
089400*2500-EXIT.                                                       08940000
089500                                                                  08950000
089600*-----------------------------------------------------------      08960000
089700* 2510-CLOSE-SKUS-ATTR-CSR.                                       08970000
089800*     CLOSE THE SKUS ATTR CURSOR.                                 08980000
089900*-----------------------------------------------------------      08990000
090000 2510-CLOSE-SKUS-ATTR-CSR.                                        09000000
090100                                                                  09010000
090200     IF PV-CNT-SINCE-DISPLAY > 0                                  09020000
090300        ACCEPT PV-CPU-TIME FROM TIME                              09030025
090310        MOVE PV-CNT-SINCE-DISPLAY TO DL-COUNT                     09031025
090320        MOVE PV-CPU-TIME          TO DL-TIME                      09032025
090330        DISPLAY DL-DISPLAY-LINE                                   09033025
090600        MOVE 0 TO PV-CNT-SINCE-DISPLAY                            09060000
090700     END-IF.                                                      09070000
090800                                                                  09080000
090900     PERFORM                                                      09090000
091000         WITH TEST AFTER                                          09100000
091100         VARYING PV-SQL-SUB                                       09110000
091200         FROM 1 BY 1                                              09120000
091300         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 09130000
091400                   OR  SQLCODE = 0)                               09140000
091500                                                                  09150000
091600           EXEC SQL                                               09160000
091700              CLOSE SKUS-ATTR-CSR                                 09170000
091800           END-EXEC                                               09180000
091900                                                                  09190000
092000          EVALUATE TRUE                                           09200000
092100             WHEN SQLCODE = -904                                  09210000
092200             WHEN SQLCODE = -911                                  09220000
092300             WHEN SQLCODE = -913                                  09230000
092400                  CONTINUE                                        09240000
092500             WHEN SQLCODE = 0                                     09250000
092600                  CONTINUE                                        09260000
092700             WHEN OTHER                                           09270000
092800                  MOVE '2510-CLOSE-SKUS-ATTR-CSR'                 09280000
092900                                      TO PV-PARAGRAPH-NAME        09290000
093000                  MOVE 'ERROR ON CLOSE OF SKU ATTR CURSOR'        09300000
093100                                      TO PV-DB2-OPERATION         09310000
093200                  PERFORM 9900-SQL-ABEND-ROUTINE                  09320000
093300          END-EVALUATE                                            09330000
093400     END-PERFORM.                                                 09340000
093500                                                                  09350000
093600     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         09360000
093700        MOVE '2510-CLOSE-SKUS-ATTR-CSR'                           09370000
093800                               TO  PV-PARAGRAPH-NAME              09380000
093900        MOVE 'CLOSE RETRIES EXCEEDED'                             09390000
094000                               TO  PV-DB2-OPERATION               09400000
094100        PERFORM 9900-SQL-ABEND-ROUTINE                            09410000
094200     END-IF.                                                      09420000
094300                                                                  09430000
094400*2510-EXIT.                                                       09440000
094500                                                                  09450000
094600*----------------------------------------------------------       09460000
094700* 2520-PROCESS-SKUS-ATTR-CSR.                                     09470000
094800*     PROCESSES STORE SKU ATTRIBUTES THAT HAVE CHANGED, WRITING   09480000
094900*     A STORE PLU RECORD.  IF SKU WAS CREATED SINCE LAST RUN,     09490000
095000*     ANY STORE DATA IS PROCESSED HERE.                           09500000
095100*----------------------------------------------------------       09510000
095200 2520-PROCESS-SKUS-ATTR-CSR.                                      09520000
095300                                                                  09530000
095400     PERFORM 2530-FETCH-SKUS-ATTR-CSR.                            09540014
095500     PERFORM VARYING PV-SUB                                       09550014
095600        FROM 1 BY 1                                               09560014
095700       UNTIL PV-SUB > SQLERRD(3)                                  09570014
095800                                                                  09580000
095900     PERFORM 4100-CREATE-SKU-PRICG-ATTR-REC                       09590015
096000                                                                  09600000
096100                                                                  09610000
096200     IF PV-CNT-SINCE-DISPLAY > 99999                              09620022
096300        ACCEPT PV-CPU-TIME FROM TIME                              09630025
096310        MOVE PV-CNT-SINCE-DISPLAY TO DL-COUNT                     09631025
096320        MOVE PV-CPU-TIME          TO DL-TIME                      09632025
096330        DISPLAY DL-DISPLAY-LINE                                   09633025
096600        MOVE 0 TO PV-CNT-SINCE-DISPLAY                            09660000
096700     END-IF                                                       09670017
096800     END-PERFORM.                                                 09680014
096900*2520-EXIT.                                                       09690000
097000                                                                  09700000
097100*----------------------------------------------------------       09710000
097200* 2530-FETCH-SKUS-ATTR-CSR.                                       09720000
097300*     FETCH A ROW FROM THE SKUS ATTR CURSOR.                      09730000
097400*----------------------------------------------------------       09740000
097500 2530-FETCH-SKUS-ATTR-CSR.                                        09750000
097600                                                                  09760000
097700     PERFORM                                                      09770000
097800         WITH TEST AFTER                                          09780000
097900         VARYING PV-SQL-SUB                                       09790000
098000         FROM 1 BY 1                                              09800000
098100         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 09810000
098200                   OR  SQLCODE = 0                                09820000
098300                   OR  SQLCODE = +100)                            09830000
098400                                                                  09840000
098500           EXEC SQL                                               09850000
098600              FETCH NEXT ROWSET FROM SKUS-ATTR-CSR                09860014
098700                FOR :PC-ROWS ROWS                                 09870017
098800              INTO                                                09880014
098900                    :TL-SKU-NBR                                   09890018
099000                   ,:TLB-LOC-NBR                                  09900016
099100                   ,:TLB-PRMPT-FOR-PRIC-IND                       09910016
099200           END-EXEC                                               09920014
099300                                                                  09930000
099400          EVALUATE TRUE                                           09940000
099500             WHEN SQLCODE = -904                                  09950000
099600             WHEN SQLCODE = -911                                  09960000
099700             WHEN SQLCODE = -913                                  09970000
099800                  CONTINUE                                        09980000
099900             WHEN SQLCODE = ZERO                                  09990000
100000*    SQLERRD (3) - CONTAINS THE COUNT OF RECORDS FETCHED          10000017
100100                  ADD SQLERRD (3) TO  PV-CNT-SKUS-ATTR-CSR        10010014
100200                                      PV-CNT-SINCE-DISPLAY        10020014
100300             WHEN SQLCODE = +100                                  10030000
100400                  ADD SQLERRD (3) TO  PV-CNT-SKUS-ATTR-CSR        10040014
100500                                      PV-CNT-SINCE-DISPLAY        10050014
100600                  SET PS-END-OF-SKUS-STR-CSR      TO TRUE         10060000
100700             WHEN OTHER                                           10070000
100800                  MOVE '2530-FETCH-SKUS-ATTR-CSR'                 10080000
100900                                     TO PV-PARAGRAPH-NAME         10090000
101000                  MOVE 'ERROR ON FETCHING SKU ATTR CURSOR'        10100000
101100                                     TO PV-DB2-OPERATION          10110000
101200                  DISPLAY 'SQLCODE= ' SQLCODE                     10120000
101300                  PERFORM 9900-SQL-ABEND-ROUTINE                  10130000
101400          END-EVALUATE                                            10140000
101500     END-PERFORM.                                                 10150000
101600                                                                  10160000
101700     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        10170000
101800         MOVE '2530-FETCH-SKUS-ATTR-CSR'                          10180000
101900                               TO  PV-PARAGRAPH-NAME              10190000
102000         MOVE 'FETCH RETRIES EXCEEDED'                            10200000
102100                               TO  PV-DB2-OPERATION               10210000
102200         PERFORM 9900-SQL-ABEND-ROUTINE                           10220000
102300     END-IF.                                                      10230000
102400                                                                  10240000
102500*2530-EXIT.                                                       10250000
102600                                                                  10260000
102700*----------------------------------------------------------       10270000
102800* 4000-CREATE-SKU-PRICG-STR-REC.                                  10280000
102900*     BUILD AND OUTPUT THE SKU PRICING STORE PRICING              10290000
103000*     OUTPUT RECORD.                                              10300000
103100*----------------------------------------------------------       10310000
103200 4000-CREATE-SKU-PRICG-STR-REC.                                   10320000
103300                                                                  10330000
103400     PERFORM 5000-POP-SKU-PRICG-COMMON.                           10340000
103500     PERFORM 5100-POP-SKU-PRICG-PRICE-REC.                        10350000
103600                                                                  10360000
103700     PERFORM 8100-WRITE-SKU-PRICG-STR-REC.                        10370000
103800                                                                  10380000
103900*4000-EXIT.                                                       10390000
104000*----------------------------------------------------------       10400000
104100* 4100-CREATE-SKU-PRICG-ATTR-REC.                                 10410000
104200*     BUILD AND OUTPUT THE SKU PRICING STORE ATTRIBUTE            10420000
104300*     (PROMPT) OUTPUT RECORD.                                     10430000
104400*----------------------------------------------------------       10440000
104500 4100-CREATE-SKU-PRICG-ATTR-REC.                                  10450000
104600                                                                  10460000
104700     PERFORM 5000-POP-SKU-PRICG-COMMON.                           10470000
104800     PERFORM 5200-POP-SKU-PRICG-ATTR-REC.                         10480000
104900                                                                  10490000
105000     PERFORM 8100-WRITE-SKU-PRICG-STR-REC.                        10500000
105100                                                                  10510000
105200*4100-EXIT.                                                       10520000
105300*----------------------------------------------------------       10530000
105400* 5000-POP-SKU-PRICG-COMMON.                                      10540000
105500*     POPULATES COMMON FIELDS AND DEFAULTS YES/NO FIELD           10550000
105600*     INDICATORS TO NO, FOR SKU PRICING RECORD.                   10560000
105700*----------------------------------------------------------       10570000
105800 5000-POP-SKU-PRICG-COMMON.                                       10580000
105900                                                                  10590000
106000     INITIALIZE EP220-XST-SKU-PRICG-RECORD.                       10600000
106100                                                                  10610000
106200     MOVE CC-EPCC112-TOMORROW-DATE TO EP220-PRICG-EFFECT-DTE.     10620000
106300     MOVE PC-STR-GRP-TYP-CDE-STORE TO EP220-STR-GRP-TYP-CDE.      10630000
106400                                                                  10640000
106500     SET EP220-FILE-CHANGE             TO TRUE.                   10650000
106600     SET EP220-APPLY-NIGHTLY           TO TRUE.                   10660000
106700                                                                  10670000
106800     SET EP220-PRIC-EFF-TMST-YES       TO TRUE.                   10680000
106900     MOVE PV-PRIC-EFF-TMST         TO EP220-PRIC-EFF-TMST.        10690000
107000                                                                  10700000
107100*    SET MDSE-HIER-CDE TO 'SKU' FOR ALL CURRENT PRICING RECORDS   10710000
107200     SET EP220-MDSE-HIER-CDE-YES       TO TRUE.                   10720000
107300     MOVE PC-MDSE-HIER-SKU         TO EP220-MDSE-HIER-CDE.        10730000
107400                                                                  10740000
107500*    CURRENT PRICING IS ALWAYS AT SKU LEVEL                       10750000
107600     SET EP220-SKU-NBR-YES             TO TRUE.                   10760000
107700     MOVE TL-SKU-NBR (PV-SUB)   TO EP220-SKU-NBR.                 10770016
107800                                                                  10780000
107900*    SET REST OF DATA ITEM INCLUSION INDICATORS TO NO             10790000
108000     SET EP220-SKU-PRICG-ID-NO         TO TRUE.                   10800000
108100     SET EP220-DEPT-NBR-NO             TO TRUE.                   10810000
108200     SET EP220-MAJ-CL-NBR-NO           TO TRUE.                   10820000
108300     SET EP220-SUB-CL-NBR-NO           TO TRUE.                   10830000
108400     SET EP220-STYL-ID-NO              TO TRUE.                   10840000
108500     SET EP220-EXCL-MDSE-IND-NO        TO TRUE.                   10850000
108600     SET EP220-UNT-RTL-AMT-NO          TO TRUE.                   10860000
108700     SET EP220-LAST-NCLR-RTL-AMT-NO    TO TRUE.                   10870000
108800     SET EP220-N-RCPT-RT-RTL-AMT-N     TO TRUE.                   10880000
108900     SET EP220-GP-RTL-AMT-NO           TO TRUE.                   10890000
109000     SET EP220-LO-UNT-RTL-AMT-NO       TO TRUE.                   10900000
109100     SET EP220-HGH-UNT-RTL-AMT-NO      TO TRUE.                   10910000
109200     SET EP220-GP-RTL-QTY-NO           TO TRUE.                   10920000
109300     SET EP220-GP-PRIC-ID-NO           TO TRUE.                   10930000
109400     SET EP220-LOC-SKU-STAT-CDE-NO     TO TRUE.                   10940000
109500     SET EP220-TKT-CLOR-CDE-NO         TO TRUE.                   10950000
109600     SET EP220-LAST-PRCHG-TMST-NO      TO TRUE.                   10960000
109700     SET EP220-PRMPT-FOR-PRIC-IND-NO   TO TRUE.                   10970000
109800     SET EP220-PERM-PRCHG-DIRN-CDE-NO  TO TRUE.                   10980000
109900     SET EP220-MLT-PRPT-IND-NO         TO TRUE.                   10990000
110000     SET EP220-PRCHG-APL-TKT-CLR-CD-N  TO TRUE.                   11000000
110100                                                                  11010000
110200*5000-EXIT.                                                       11020000
110300*----------------------------------------------------------       11030000
110400* 5100-POP-SKU-PRICG-PRICE-REC.                                   11040000
110500*     POPULATES THE UPDATED FIELDS ON THE SKU PRICING             11050000
110600*     RECORD FOR PRICE AND STATUS RELATED CHANGES.                11060000
110700*----------------------------------------------------------       11070000
110800 5100-POP-SKU-PRICG-PRICE-REC.                                    11080000
110900                                                                  11090000
111000     SET EP220-RECORD-UPDATE           TO TRUE.                   11100000
111100                                                                  11110000
111200     MOVE TL-LOC-NBR (PV-SUB) TO EP220-STR-GRP-ID.                11120016
111300                                                                  11130000
111400     SET EP220-UNT-RTL-AMT-YES         TO TRUE.                   11140000
111500     MOVE TL-UNT-RTL-AMT (PV-SUB)    TO PV-CONVERT-PRICE.         11150016
111600     MOVE PV-CONVERT-PRICE         TO EP220-UNT-RTL-AMT.          11160000
111700                                                                  11170000
111800     SET EP220-GP-RTL-AMT-YES          TO TRUE.                   11180000
111900     SET EP220-GP-RTL-QTY-YES          TO TRUE.                   11190000
112000     SET EP220-GP-PRIC-ID-YES          TO TRUE.                   11200000
112100     IF TL-GP-PRIC-ID-IND (PV-SUB) = -1                           11210016
112200        MOVE PC-NULL-CHAR          TO EP220-GP-RTL-AMT-NUL        11220000
112300                                      EP220-GP-RTL-QTY-NUL        11230000
112400                                      EP220-GP-PRIC-ID-NUL        11240000
112500     ELSE                                                         11250000
112600        MOVE TL-GP-RTL-AMT (PV-SUB)    TO PV-CONVERT-PRICE        11260016
112700        MOVE PV-CONVERT-PRICE      TO EP220-GP-RTL-AMT            11270000
112800        MOVE TL-GP-RTL-QTY (PV-SUB)   TO EP220-GP-RTL-QTY         11280016
112900        MOVE TL-GP-PRIC-ID (PV-SUB)   TO PV-GP-PRIC-ID            11290016
113000        MOVE PV-GP-PRIC-ID         TO EP220-GP-PRIC-ID            11300000
113100     END-IF.                                                      11310000
113200                                                                  11320000
113300     SET EP220-LOC-SKU-STAT-CDE-YES    TO TRUE.                   11330000
113400*    * A MIXED STATUS IS CONSIDERED ACTIVE TO A STORE *           11340000
113500     IF TL-LOC-SKU-STAT-CDE (PV-SUB) = PC-MIXED-STATUS            11350016
113600        MOVE PC-ACTIVE-STATUS      TO EP220-LOC-SKU-STAT-CDE      11360000
113700     ELSE                                                         11370000
113800        MOVE TL-LOC-SKU-STAT-CDE (PV-SUB)                         11380016
113900                                   TO EP220-LOC-SKU-STAT-CDE      11390000
114000     END-IF.                                                      11400000
114100                                                                  11410000
114200     SET EP220-TKT-CLOR-CDE-YES        TO TRUE.                   11420000
114300     IF TL-LOC-SKU-STAT-CDE (PV-SUB) = '30'                       11430016
114400        MOVE 'Y'                   TO EP220-TKT-CLOR-CDE          11440000
114500     ELSE                                                         11450000
114600        MOVE 'W'                   TO EP220-TKT-CLOR-CDE          11460000
114700     END-IF.                                                      11470000
114800                                                                  11480000
114900     SET EP220-LAST-PRCHG-TMST-YES     TO TRUE.                   11490000
115000     MOVE TL-UNT-RTL-CHG-DTE (PV-SUB) TO PV-LAST-PRCHG-DTE.       11500016
115100     MOVE PC-SQLS-START-TIME       TO PV-LAST-PRCHG-TIME.         11510000
115200     MOVE PV-LAST-PRCHG-TMST       TO EP220-LAST-PRCHG-TMST.      11520000
115300                                                                  11530000
115400*5100-EXIT.                                                       11540000
115500*----------------------------------------------------------       11550000
115600* 5200-POP-SKU-PRICG-ATTR-REC.                                    11560000
115700*     POPULATES THE UPDATED FIELDS ON THE SKU PRICING             11570000
115800*     RECORD FOR PROMPT FOR PRICE CHANGE.                         11580000
115900*----------------------------------------------------------       11590000
116000 5200-POP-SKU-PRICG-ATTR-REC.                                     11600000
116100                                                                  11610000
116200     MOVE TLB-LOC-NBR (PV-SUB) TO EP220-STR-GRP-ID.               11620016
116300     SET EP220-RECORD-UPDATE           TO TRUE.                   11630000
116400                                                                  11640000
116500     SET EP220-PRMPT-FOR-PRIC-IND-YES  TO TRUE.                   11650000
116600     MOVE TLB-PRMPT-FOR-PRIC-IND (PV-SUB)                         11660016
116700                                   TO EP220-PRMPT-FOR-PRIC-IND.   11670000
116800                                                                  11680000
116900*5200-EXIT.                                                       11690000
117000*----------------------------------------------------------       11700000
117100* 8100-WRITE-SKU-PRICG-STR-REC.                                   11710000
117200*     WRITES THE SKU PRICING STORE RECORD OUT                     11720000
117300*----------------------------------------------------------       11730000
117400 8100-WRITE-SKU-PRICG-STR-REC.                                    11740000
117500                                                                  11750000
117600     WRITE CHG-SKU-PRICG-STORE-RECORD                             11760000
117700         FROM EP220-XST-SKU-PRICG-RECORD.                         11770000
117800                                                                  11780000
117900     ADD 1 TO PV-CNT-STR-SKU-PRICG-RECS.                          11790000
118000                                                                  11800000
118100*8100-EXIT.                                                       11810000
118200*----------------------------------------------------------       11820000
118300* 9800-ABEND.                                                     11830000
118400*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                  11840000
118500*----------------------------------------------------------       11850000
118600 9800-ABEND.                                                      11860000
118700                                                                  11870000
118800     DISPLAY '** ABEND           **'.                             11880000
118900     DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  11890000
119000     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        11900000
119100     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       11910000
119200     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       11920000
119300     CALL 'ILBOABN0' USING ABEND-CODE.                            11930000
119400                                                                  11940000
119500*9800-EXIT.                                                       11950000
119600                                                                  11960000
119700*----------------------------------------------------------       11970000
119800* 9900-SQL-ABEND-ROUTINE.                                         11980000
119900*     SQL ABEND ROUTINE.                                          11990000
120000*----------------------------------------------------------       12000000
120100 9900-SQL-ABEND-ROUTINE.                                          12010000
120200                                                                  12020000
120300     SET ABEND-4013-DB2-ERROR TO TRUE.                            12030000
120400     DISPLAY '** ABEND     **'.                                   12040000
120500     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        12050000
120600     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              12060000
120700     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               12070000
120800                                                                  12080000
120900     COPY DPPD004.                                                12090000
121000     CALL 'ILBOABN0' USING ABEND-CODE.                            12100000
121100                                                                  12110000
121200*9900-EXIT.                                                       12120000
121300                                                                  12130000
121400*----------------------------------------------------------       12140000
121500* 9999-WRAPUP.                                                    12150000
121600*     END OF PROGRAM ROUTINE.  CLOSES ALL FILES AND DISPLAYS      12160000
121700*     ANY DATA FROM THE PROGRAM.                                  12170000
121800*----------------------------------------------------------       12180000
121900 9999-WRAPUP.                                                     12190000
122000                                                                  12200000
122100     CLOSE CHG-SKU-PRICG-STORE-FILE.                              12210018
122200                                                                  12220000
122300     DISPLAY ' '.                                                 12230000
122400     DISPLAY '*********************************************'.     12240000
122500     DISPLAY 'PROGRAM NAME: ' PC-CURRENT-PROGRAM-NAME.            12250000
122600     DISPLAY '*********************************************'.     12260000
122700     DISPLAY '  # SKUS STORE CSR ROWS: ' PV-CNT-SKUS-STR-CSR.     12270000
122800     DISPLAY ' '.                                                 12280000
122900     DISPLAY '   # SKUS ATTR CSR ROWS: ' PV-CNT-SKUS-ATTR-CSR.    12290000
123000     DISPLAY ' '.                                                 12300000
123100     DISPLAY '# STR SKU PRICG RECS WRITE: '                       12310000
123200                                        PV-CNT-STR-SKU-PRICG-RECS.12320000
123300     DISPLAY '*********************************************'.     12330000
123400                                                                  12340000
123500*9999-EXIT.                                                       12350000
