       IDENTIFICATION DIVISION.                                         00010085
       PROGRAM-ID.       PXKCS705.                                      00020099
       AUTHOR.           KOHLS DEPARTMENT STORES.                       00030085
       INSTALLATION.     KOHLS DEPARTMENT STORES.                       00040085
       DATE-WRITTEN      11/08/2005.                                    00050099
       DATE-COMPILED.                                                   00060085
      ******************************************************************00070085
      **T705 - CLEARANCE PRICE CHANGES                                  00080099
      **THIS PROGRAM RECEIVES A REQUEST FROM AN RF DEVICE CONTAINING:   00090085
      **   - STORE                                                      00100085
      **   - UPC NBR                                                    00110085
      ******************************************************************00120085
      **DATE: 11/08/2005 CHANGED BY: JULIE TEWES INITIAL PROGRAM WRITE  00130099
      ******************************************************************00140099
112905**DATE: 11/29/2005 CHANGED BY: FIX TO COMPUTED PERCENT OFF        00150099
112905******************************************************************00160099
112805**DATE: 11/28/2005 CHANGED BY: JULIE TEWES ADD COLOR TO COPYBOOK  00170099
112805******************************************************************00180099
011106**DATE: 01/11/2006 CHANGED BY: JULIE TEWES GROUP B CHANGES        00190099
011106******************************************************************00200099
011806**DATE: 01/18/2006 CHANGED BY: RAY GRAF                           00210099
011806**      INTERROGATE LAST_ACTN_CDE FIELD IN XST_UPC                00220099
011106******************************************************************00230099
012706**DATE: 01/27/2006 CHANGED BY: JULIE TEWES                        00240099
012706**      STOP STORES NOT PART OF NEW CLEARANCE METHOD FROM ENTERING00250099
      ******************************************************************00260099
031006**DATE: 03/10/2006 CHANGED BY: DAVID WELLER                       00261099
031006**      CHANGE PRINT EVENT CODE CUTOFF FROM 85 TO 80 PERCENT      00262099
      ******************************************************************00263099
051906**DATE: 05/19/2006 CHANGED BY: DAVID WELLER                       00264099
051906**      ADD 116 PRICE OPTIMIZATION STORES TO RFWS010 AS GROUP C   00265099
      ******************************************************************00266099
071806**DATE: 07/18/2006 CHANGED BY: DAVID WELLER                       00267099
071806**      ADD 186 PRICE OPTIMIZATION STORES TO RFWS010 GROUP C      00268099
      ******************************************************************00269099
       ENVIRONMENT DIVISION.                                            00270085
       DATA DIVISION.                                                   00280085
       WORKING-STORAGE SECTION.                                         00290085
      ******************************************************************00300085
      **PROGRAM VARIABLES                                               00310085
      ******************************************************************00320085
       01  PV-PROGRAM-VARIABLES.                                        00330085
           05  PV-COMMAREA-LENGTH          PIC S9(04) VALUE +0          00340085
                                                      COMP SYNC.        00350085
      ******************************************************************00360085
      **PROGRAM CONSTANTS                                               00370085
      ******************************************************************00380085
       01  PC-PROGRAM-CONSTANTS.                                        00390085
           05  PC-NULL-VALUE               PIC S9(04) VALUE -1          00400088
                                                      COMP SYNC.        00410088
      ******************************************************************00420099
      **DATE TIME FIELDS                                                00430099
      ******************************************************************00440099
       01  DF-DATE-TIME-FIELDS.                                         00450099
           05  DF-ACCEPT-DATE.                                          00460099
               10  DF-ACCEPT-YY            PIC 9(02) VALUE ZEROS.       00470099
               10  DF-ACCEPT-MM            PIC 9(02) VALUE ZEROS.       00480099
               10  DF-ACCEPT-DD            PIC 9(02) VALUE ZEROS.       00490099
           05  DF-ACCEPT-TIME.                                          00500099
               10  DF-ACCEPT-HH            PIC 9(02) VALUE ZEROS.       00510099
               10  DF-ACCEPT-MIN           PIC 9(02) VALUE ZEROS.       00520099
               10  DF-ACCEPT-SEC           PIC 9(02) VALUE ZEROS.       00530099
               10  DF-ACCEPT-HSEC          PIC 9(02) VALUE ZEROS.       00540099
       01  DF-FORMAT-DATE-TIME.                                         00550099
      ***CURRENT DATE                                                   00560099
           05  DF-FORMAT-DATE-CC           PIC 9(02) VALUE 20.          00570099
           05  DF-FORMAT-DATE-YY           PIC 9(02) VALUE ZEROS.       00580099
           05  FILLER                      PIC X(01) VALUE '-'.         00590099
           05  DF-FORMAT-DATE-MM           PIC 9(02) VALUE ZEROS.       00600099
           05  FILLER                      PIC X(01) VALUE '-'.         00610099
           05  DF-FORMAT-DATE-DD           PIC 9(02) VALUE ZEROS.       00620099
       01  DF-ORIG-DATE.                                                00630099
           05  DF-ORIG-DATE-YY             PIC 9(04) VALUE ZEROS.       00640099
           05  FILLER                      PIC X(01) VALUE '-'.         00650099
           05  DF-ORIG-DATE-MM             PIC 9(02) VALUE ZEROS.       00660099
           05  FILLER                      PIC X(01) VALUE '-'.         00670099
           05  DF-ORIG-DATE-DD             PIC 9(02) VALUE ZEROS.       00680099
112905******************************************************************00690099
112905**PROGRAM CALCULATIONS VARIABLES                                  00700099
112905******************************************************************00710099
112905 01  PC-PROGRAM-CALCULATIONS.                                     00720099
112905     05  PC-PERCENT-OFF              PIC S9(04)V999 VALUE ZEROS.  00730099
      ******************************************************************00740099
      **NULL VARIABLES                                                  00750099
      ******************************************************************00760099
       01  NV-NULL-VARIABLES.                                           00770099
           05  NV-GP-RTL-NULL-IND          PIC S9(04) VALUE +0          00780099
                                                      COMP SYNC.        00790085
           05  NV-GP-QTY-NULL-IND          PIC S9(04) VALUE +0          00800085
                                                      COMP SYNC.        00810085
           05  NV-ORIG-CLR-DTE-NULL-IND    PIC S9(04) VALUE +0          00820088
                                                      COMP SYNC.        00830088
           05  NV-LAST-NRTL-CLR-AMT        PIC S9(04) VALUE +0          00840093
                                                      COMP SYNC.        00850093
      ******************************************************************00860085
      **PROGRAM CONSTANTS                                               00870085
      ******************************************************************00880085
       01  PC-PROGRAM-CONSTANTS.                                        00890085
           05  PC-CURRENT-PROGRAM-NAME     PIC X(08)  VALUE 'PXKCS705'. 00900099
012705     05  PC-STORE-MESSAGE            PIC X(125) VALUE             00910099
012705         'CLEARANCE PRICE CHANGES IS NOT AVAILABLE FOR YOUR STORE 00920099
012705-        'PLEASE EXIT APPLICATION.'.                              00930099
      **CICS RETURN MESSAGES                                            00940085
           05  PC-TSYMSG-NUMBERS.                                       00950085
      **INVALID UPC                                                     00960085
               10  PC-TSYMSG-00100         PIC 9(05)  VALUE  00100.     00970085
      **DATA IS UNAVAILABLE; PLEASE CONTACT THE IS HELP DESK            00980085
               10  PC-TSYMSG-01063         PIC 9(05)  VALUE  01063.     00990085
               10  PC-TSYMSG-01064         PIC 9(05)  VALUE  01064.     01000085
      ******************************************************************01010085
      **TABLE INCLUSIONS                                                01020085
      ******************************************************************01030085
      **XST_LOC TABLE                                                   01040099
           EXEC SQL                                                     01050099
                INCLUDE XST00001                                        01060099
           END-EXEC.                                                    01070099
      **XST_SKU_LOC TABLE                                               01080085
           EXEC SQL                                                     01090085
                INCLUDE XST00008                                        01100085
           END-EXEC.                                                    01110085
      **XST_SKU TABLE                                                   01120085
           EXEC SQL                                                     01130085
                INCLUDE XST00010                                        01140085
           END-EXEC.                                                    01150085
      **XST_SKU_ATTR TABLE                                              01160085
           EXEC SQL                                                     01170085
                INCLUDE XST00011                                        01180085
           END-EXEC.                                                    01190085
      **XST_UPC TABLE                                                   01200085
           EXEC SQL                                                     01210085
                INCLUDE XST00012                                        01220085
           END-EXEC.                                                    01230085
      **XST_STR_GP_MBSHP TABLE                                          01240099
           EXEC SQL                                                     01250099
                INCLUDE XST00023                                        01260099
           END-EXEC.                                                    01270099
      **XST_PRCHG TABLE                                                 01280099
           EXEC SQL                                                     01290099
                INCLUDE XST00063                                        01300099
           END-EXEC.                                                    01310099
      **XST_STR_GP_PRCHG TABLE                                          01320099
           EXEC SQL                                                     01330099
                INCLUDE XST00064                                        01340099
           END-EXEC.                                                    01350099
      **XST_PRCHG_MDSE TABLE                                            01360099
           EXEC SQL                                                     01370099
                INCLUDE XST00065                                        01380099
           END-EXEC.                                                    01390099
      **COMMUNICATIONS AREA FOR DB2                                     01400085
           EXEC SQL                                                     01410085
                INCLUDE SQLCA                                           01420085
           END-EXEC.                                                    01430085
      ******************************************************************01440085
      **COPYBOOKS                                                       01450085
      ******************************************************************01460085
      **RECORD LAYOUT BEING TRANSMITTED FROM THE CLIENT                 01470085
           COPY PXRD008.                                                01480099
      **RECORD LAYOUT BEING TRASMITTED TO THE CLIENT                    01490085
           COPY PXRD009.                                                01500099
      **RF CICS COPYBOOK - USED IN CONJUCTION WITH RFPD001              01510085
           COPY RFWS007.                                                01520085
      **RF COMMON STATUS DETERMINATION COPYBOOK WITH RFPD008            01530099
           COPY RFWS008.                                                01540085
011106**RF PRICE OPTIMIZATION STORES COPYBOOK                           01550099
011106     COPY RFWS010.                                                01560099
      **LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA                 01570085
           COPY DPWS013.                                                01580085
      **KOHLS DATE ROUTINE COPYBOOK                                     01590087
           COPY DPWS500.                                                01600087
                                                                        01610085
       PROCEDURE DIVISION.                                              01620085
      ******************************************************************01630085
       0000-PROGRAM-MAINLINE.                                           01640085
                                                                        01650085
           PERFORM 1000-INITIALIZATION.                                 01660085
012705     MOVE PXRD008-LOC-NBR         TO RFWS010-TEST-STORES.         01670099
012705     IF  RFWS010-TEST-STORES-ALL                                  01680099
               PERFORM 2000-PROCESS-REQUEST                             01700099
012705     ELSE                                                         01710099
012705         MOVE 'E'                 TO PXRD009-ERR-TYP-IND          01720099
012705         MOVE PC-STORE-MESSAGE    TO PXRD009-ERR-MSG              01730099
012705     END-IF.                                                      01740099
           PERFORM 9000-CALL-CICS.                                      01750085
           GOBACK.                                                      01760085
                                                                        01770085
       EJECT.                                                           01780085
      ******************************************************************01790085
      **INTIALIZATION ROUTINE                                           01800085
      ******************************************************************01810085
       1000-INITIALIZATION.                                             01820085
                                                                        01830085
           MOVE '1000-INITIALIZATION'     TO DP013-PARAGRAPH.           01840085
                                                                        01850085
           INITIALIZE PXRD008-FROM-CLIENT-RECORD.                       01860099
           INITIALIZE PXRD009-TO-CLIENT-RECORD.                         01870099
           INITIALIZE DCLXST00008.                                      01880089
           INITIALIZE DCLXST00010.                                      01890089
           INITIALIZE DCLXST00011.                                      01900089
           INITIALIZE DCLXST00012.                                      01910089
           INITIALIZE DCLXST00063.                                      01920099
           INITIALIZE DCLXST00064.                                      01930099
           INITIALIZE DCLXST00065.                                      01940099
                                                                        01950085
           ACCEPT DF-ACCEPT-TIME FROM TIME.                             01960099
           ACCEPT DF-ACCEPT-DATE FROM DATE.                             01970099
           MOVE DF-ACCEPT-YY          TO DF-FORMAT-DATE-YY.             01980099
           MOVE DF-ACCEPT-MM          TO DF-FORMAT-DATE-MM.             01990099
           MOVE DF-ACCEPT-DD          TO DF-FORMAT-DATE-DD.             02000099
                                                                        02010099
           PERFORM 1100-RETRIEVE-TEXT.                                  02020085
                                                                        02030085
       EJECT.                                                           02040085
      ******************************************************************02050085
      **RETRIEVE DATA FROM CLIENT                                       02060085
      ******************************************************************02070085
       1100-RETRIEVE-TEXT.                                              02080085
                                                                        02090085
           MOVE '1100-RETRIEVE-TEXT'    TO DP013-PARAGRAPH.             02100085
                                                                        02110085
           PERFORM RFPD001-0500-RETRIEVE-TEXT.                          02120085
           MOVE RFWS007-FROM-CLIENT-RECORD                              02130085
                                        TO PXRD008-FROM-CLIENT-RECORD.  02140099
                                                                        02150085
           IF  RFWS007-NOT-SUCCESSFUL-RET                               02160085
               MOVE DP011-MSG-LEVEL     TO PXRD009-ERR-TYP-IND          02170099
               MOVE DP011-MSG-TEXT      TO PXRD009-ERR-MSG              02180099
               PERFORM 9000-FMT-ERR-MSG-TO-PTC                          02190085
               PERFORM 9000-CALL-CICS                                   02200085
           END-IF.                                                      02210085
                                                                        02220085
       EJECT.                                                           02230085
      ******************************************************************02240085
      **MAIN PROCESSOR OF PROGRAM                                       02250085
      ******************************************************************02260085
       2000-PROCESS-REQUEST.                                            02270085
                                                                        02280085
           MOVE '2000-PROCESS-REQUEST'      TO DP013-PARAGRAPH.         02290085
                                                                        02300085
           MOVE PXRD008-UPC-NBR             TO XST00012-UPC-NBR.        02310099
           PERFORM 2100-RETRIEVE-SKU-DATA.                              02320085
                                                                        02330085
           IF   XST00010-REGN-PRIC-IND = 'Y'                            02340085
                MOVE PXRD008-LOC-NBR        TO XST00008-LOC-NBR         02350099
                PERFORM 2200-REGN-PRICE-CHECK                           02360086
                IF  SQLCODE = +100                                      02370085
      ***INDICATES NO STORE SPECIFIC ROW FOUND                          02380089
                    MOVE 0                  TO XST00008-LOC-NBR         02390086
                    PERFORM 2200-REGN-PRICE-CHECK                       02400086
                END-IF                                                  02410085
           ELSE                                                         02420085
      ***REGIONAL PRICING NOT IN EFFECT                                 02430093
                MOVE 0                      TO XST00008-LOC-NBR         02440086
                PERFORM 2200-REGN-PRICE-CHECK                           02450086
           END-IF.                                                      02460085
                                                                        02470085
           MOVE PXRD008-LOC-NBR             TO XST00023-STR-NBR         02480099
                                                                        02490099
           PERFORM 2400-RETRIEVE-FUTURE-PERMS.                          02500099
                                                                        02510099
           PERFORM 2600-MOVE-DATA-TO-OUTPUT.                            02520085
                                                                        02530085
       EJECT.                                                           02540085
      ***************************************************************** 02550085
      **RETRIEVE SKU DATA                                               02560085
      ***************************************************************** 02570085
       2100-RETRIEVE-SKU-DATA.                                          02580085
                                                                        02590085
           MOVE '2100-RETRIEVE-SKU-DATA'   TO DP013-PARAGRAPH.          02600085
                                                                        02610085
           EXEC SQL                                                     02620085
                SELECT A.INTR_UPC_ID                                    02630085
                      ,B.SKU_DESC                                       02640085
112805                ,B.NRF_CLOR_DESC                                  02650099
                      ,B.REGN_PRIC_IND                                  02660085
                      ,C.LAST_NCLR_RTL_AMT                              02670099
                INTO  :XST00012-INTR-UPC-ID                             02680085
                     ,:XST00010-SKU-DESC                                02690085
112805               ,:XST00010-NRF-CLOR-DESC                           02700099
                     ,:XST00010-REGN-PRIC-IND                           02710085
                     ,:XST00011-LAST-NCLR-RTL-AMT :NV-LAST-NRTL-CLR-AMT 02720093
                FROM   XST_UPC      A                                   02730085
                      ,XST_SKU      B                                   02740085
                      ,XST_SKU_ATTR C                                   02750099
                WHERE  A.INTR_UPC_ID    = B.INTR_UPC_ID                 02760099
                  AND  B.INTR_UPC_ID    = C.INTR_UPC_ID                 02770099
                  AND  A.UPC_NBR        = :XST00012-UPC-NBR             02780099
011806            AND  A.LAST_ACTN_CDE IN ('A','U')                     02790099
                WITH UR                                                 02800085
           END-EXEC.                                                    02810085
                                                                        02820085
           EVALUATE TRUE                                                02830085
              WHEN SQLCODE = +0                                         02840085
                   CONTINUE                                             02850085
              WHEN SQLCODE = +100                                       02860085
                   SET DP011-MSG-FATAL      TO TRUE                     02870099
                   MOVE PC-TSYMSG-00100     TO DP011-MSG-NUMBER         02880099
                   PERFORM DP011-0000-FORMAT-MSG-LINES                  02890099
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      02900099
                   PERFORM 9000-CALL-CICS                               02910099
              WHEN OTHER                                                02920085
                   SET DP013-DB2-ABEND                                  02930085
                       DP013-NO-ROLLBACK     TO TRUE                    02940085
                   MOVE XST00012-UPC-NBR     TO DP013-MESSAGE-TEXT (1)  02950085
                   MOVE SQLCA                TO DP013-SQLCA             02960085
                   MOVE 'XST_UPC'            TO DP013-DB2-TABLE-NAME (1)02970089
                   PERFORM RFPD001-9998-LOG-CICS-MSG                    02980085
           END-EVALUATE.                                                02990085
                                                                        03000085
       EJECT.                                                           03010085
      ***************************************************************** 03020085
      **RETRIEVE PRICING FROM XST_SKU_LOC                               03030085
      ***************************************************************** 03040085
       2200-REGN-PRICE-CHECK.                                           03050085
                                                                        03060085
           MOVE '2200-REGN-PRICE-CHECK'   TO DP013-PARAGRAPH.           03070085
                                                                        03080085
           EXEC SQL                                                     03090085
                SELECT UNT_RTL_AMT                                      03100085
                      ,GP_RTL_QTY                                       03110085
                      ,GP_RTL_AMT                                       03120085
                      ,BEG_TMST                                         03130085
                      ,LOC_SKU_STAT_CDE                                 03140085
                      ,ORIG_CLR_DTE                                     03150088
                INTO  :XST00008-UNT-RTL-AMT                             03160085
                     ,:XST00008-GP-RTL-QTY  :NV-GP-RTL-NULL-IND         03170085
                     ,:XST00008-GP-RTL-AMT  :NV-GP-QTY-NULL-IND         03180085
                     ,:XST00008-BEG-TMST                                03190085
                     ,:XST00008-LOC-SKU-STAT-CDE                        03200085
                     ,:XST00008-ORIG-CLR-DTE :NV-ORIG-CLR-DTE-NULL-IND  03210088
                FROM   XST_SKU_LOC                                      03220085
                WHERE  INTR_UPC_ID = :XST00012-INTR-UPC-ID              03230092
                  AND  LOC_NBR     = :XST00008-LOC-NBR                  03240085
                  AND  BEG_TMST <= CURRENT TIMESTAMP                    03250085
                  AND (END_TMST >= CURRENT TIMESTAMP                    03260085
                   OR  END_TMST IS NULL)                                03270085
                WITH UR                                                 03280085
           END-EXEC.                                                    03290085
                                                                        03300085
           EVALUATE TRUE                                                03310085
              WHEN SQLCODE = +0                                         03320085
              WHEN SQLCODE = +100                                       03330085
                   CONTINUE                                             03340085
              WHEN OTHER                                                03350085
                   SET DP013-DB2-ABEND                                  03360085
                       DP013-NO-ROLLBACK     TO TRUE                    03370085
                   MOVE XST00012-UPC-NBR     TO DP013-MESSAGE-TEXT (1)  03380085
                   MOVE SQLCA                TO DP013-SQLCA             03390085
                   MOVE 'XST_UPC'            TO DP013-DB2-TABLE-NAME (1)03400089
                   PERFORM RFPD001-9998-LOG-CICS-MSG                    03410085
           END-EVALUATE.                                                03420085
                                                                        03430085
       EJECT.                                                           03440085
      ***************************************************************** 03450099
      **RETRIEVE FUTURE MARKDOWN EVENTS                                 03460099
      ***************************************************************** 03470099
       2400-RETRIEVE-FUTURE-PERMS.                                      03480099
                                                                        03490099
           MOVE '2400-RETRIEVE-FUTURE-PERMS' TO DP013-PARAGRAPH.        03500099
                                                                        03510099
           EXEC SQL                                                     03520099
                SELECT D.UNT_RTL_AMT                                    03530099
                      ,DATE(B.PRCHG_EFF_DTE)                            03540099
                INTO  :XST00065-UNT-RTL-AMT                             03550099
                     ,:XST00064-PRCHG-EFF-DTE                           03560099
                FROM   XST_PRCHG         A                              03570099
                      ,XST_STR_GP_PRCHG  B                              03580099
                      ,XST_STR_GP_MBSHP  C                              03590099
                      ,XST_PRCHG_MDSE    D                              03600099
                      ,XST_SKU           E                              03610099
                WHERE A.PRCHG_ID       = B.PRCHG_ID                     03620099
                  AND B.STR_GP_TYP_CDE = C.STR_GP_TYP_CDE               03630099
                  AND B.STR_GP_ID      = C.STR_GP_ID                    03640099
                  AND B.STR_GP_TYP_CDE = D.STR_GP_TYP_CDE               03650099
                  AND B.STR_GP_ID      = D.STR_GP_ID                    03660099
                  AND B.PRCHG_ID       = D.PRCHG_ID                     03670099
                  AND D.SKU_NBR        = E.SKU_NBR                      03680099
                  AND (C.EFF_END_DTE   >= B.PRCHG_EFF_DTE               03690099
                    OR C.EFF_END_DTE   IS NULL)                         03700099
                  AND C.EFF_BEG_DTE    <= B.PRCHG_EFF_DTE               03710099
                  AND B.PRCHG_EFF_DTE  <= CURRENT DATE + 1 DAY          03720099
                  AND B.PRCHG_EFF_DTE  >  CURRENT DATE                  03730099
                  AND A.PRCHG_TYP_CDE  IN ('RCP','MK2','FNL')           03740099
      ***INDICATES MARK 1, MARK 2 AND FINAL MARKS                       03750099
                  AND A.EVNT_CTG_CDE   IN ('CLR','RCP')                 03760099
                  AND A.PRCHG_ST_CDE   = 'APR'                          03770099
      ***ONLY MARKS IN APPROVED STATUS                                  03780099
                  AND A.LAST_ACTN_CDE  <> 'D'                           03790099
                  AND B.LAST_ACTN_CDE  <> 'D'                           03800099
                  AND D.LAST_ACTN_CDE  <> 'D'                           03810099
                  AND E.INTR_UPC_ID    = :XST00012-INTR-UPC-ID          03820099
                  AND C.STR_NBR        = :XST00023-STR-NBR              03830099
                WITH UR                                                 03840099
           END-EXEC.                                                    03850099
                                                                        03860099
           EVALUATE TRUE                                                03870099
              WHEN SQLCODE = +0                                         03880099
              WHEN SQLCODE = +100                                       03890099
                   CONTINUE                                             03900099
              WHEN OTHER                                                03910099
                   SET DP013-DB2-ABEND                                  03920099
                       DP013-NO-ROLLBACK     TO TRUE                    03930099
                   MOVE XST00012-UPC-NBR     TO DP013-MESSAGE-TEXT (1)  03940099
                   MOVE SQLCA                TO DP013-SQLCA             03950099
                   MOVE 'XST_PRCHG'          TO DP013-DB2-TABLE-NAME (1)03960099
                   PERFORM RFPD001-9998-LOG-CICS-MSG                    03970099
           END-EVALUATE.                                                03980099
                                                                        03990099
       EJECT.                                                           04000099
      ***************************************************************** 04010099
      **MOVE DATA TO OUTPUT FIELDS                                      04020085
      ***************************************************************** 04030085
       2600-MOVE-DATA-TO-OUTPUT.                                        04040085
                                                                        04050085
           MOVE '2600-MOVE-DATA-TO-OUTPUT'     TO DP013-PARAGRAPH.      04060099
                                                                        04070085
           EVALUATE TRUE                                                04080099
               WHEN SQLCODE = 0                                         04090099
      ***FUTURE CLEARANCE PRICE CHANGE EXISTS                           04100099
                    PERFORM 2625-DATA-FUTURE-PERMS                      04110099
               WHEN OTHER                                               04120099
      ***NO FUTURE CLEARANCE PRICE CHANGE EXISTS                        04130099
                    IF  XST00008-LOC-SKU-STAT-CDE = '30'                04140099
      ***SKU IS CURRENTLY CLEARANCE                                     04150099
                        PERFORM 2650-DATA-CURRENT-CLEAR                 04160099
                    ELSE                                                04170099
      ***SKU IS CURRENTLY NOT CLEARANCE                                 04180099
                        PERFORM 2675-DATA-CURRENT-ACTIV                 04190099
                   END-IF                                               04200099
           END-EVALUATE.                                                04210099
                                                                        04220085
           MOVE PXRD008-UPC-NBR                TO PXRD009-UPC-NBR.      04230099
           MOVE XST00010-SKU-DESC              TO PXRD009-SKU-DESC.     04240099
112805     MOVE XST00010-NRF-CLOR-DESC         TO PXRD009-NRF-CLOR-DESC.04250099
                                                                        04260099
       EJECT.                                                           04270085
      ***************************************************************** 04280099
      **MOVE DATA WHEN FUTURE PERMS EXIST                               04290099
      ***************************************************************** 04300099
       2625-DATA-FUTURE-PERMS.                                          04310099
                                                                        04320099
           MOVE '2625-DATA-FUTURE-PERMS'  TO DP013-PARAGRAPH.           04330099
                                                                        04340099
      ***CLEARANCE TICKET AS ONLY CLEARANCE FUTURE PERMS ARE PULLED     04350099
           SET PXRD009-STAT-CLEAR         TO TRUE.                      04360099
      ***USE RETAIL FROM FUTURE TABLES AS PRICE                         04370099
           MOVE XST00065-UNT-RTL-AMT      TO PXRD009-PRICE.             04380099
                                                                        04390099
           MOVE XST00064-PRCHG-EFF-DTE    TO DF-ORIG-DATE.              04400099
           MOVE DF-ORIG-DATE-YY           TO PXRD009-EFFECTIVE-DATE-YY. 04410099
           MOVE DF-ORIG-DATE-MM           TO PXRD009-EFFECTIVE-DATE-MM. 04420099
           MOVE DF-ORIG-DATE-DD           TO PXRD009-EFFECTIVE-DATE-DD. 04430099
                                                                        04440099
      ***AUTO PRINT TICKET AS ONLY CLEARANCE IN THE NEXT 3 DAYS ARE PULL04450099
           SET PXRD009-PRINT-IND-YES      TO TRUE.                      04460099
                                                                        04470099
           IF  NV-LAST-NRTL-CLR-AMT NOT EQUAL PC-NULL-VALUE             04480099
      ***CALCULATE PERCENT OFF IF ONLY IF IT EXISTS                     04490099
               MOVE XST00011-LAST-NCLR-RTL-AMT                          04500099
                                          TO PXRD009-ORIGINAL-NCLR-RTL  04510099
112905         COMPUTE PC-PERCENT-OFF                                   04520099
                       = 100 * (1 - (XST00065-UNT-RTL-AMT /             04530099
                                     XST00011-LAST-NCLR-RTL-AMT))       04540099
112905         MOVE PC-PERCENT-OFF        TO PXRD009-CLR-PCT-OFF        04550099
           END-IF.                                                      04560099
                                                                        04570099
031006*    IF  PXRD009-CLR-PCT-OFF >= 85                                04580099
031006     IF  PXRD009-CLR-PCT-OFF >= 80                                04581099
031006***RETREIVE FISCAL WEEK NUMBER IF PERCENT OFF IS 80 OR GREATER    04590099
               PERFORM 2700-DETERMINE-EVENT-CODE                        04600099
           END-IF.                                                      04610099
                                                                        04620099
       EJECT.                                                           04630099
      ***************************************************************** 04640099
      **MOVE DATA WHEN ITEM IS CURRENTLY CLEARANCE                      04650099
      ***************************************************************** 04660099
       2650-DATA-CURRENT-CLEAR.                                         04670099
                                                                        04680099
           MOVE '2650-DATA-CURRENT-CLEAR' TO DP013-PARAGRAPH.           04690099
                                                                        04700099
      ***CLEARANCE TICKET AS ONLY CLEARANCE FUTURE PERMS ARE PULLED     04710099
           SET PXRD009-STAT-CLEAR         TO TRUE.                      04720099
      ***USE RETAIL FROM CURRENT TABLES AS PRICE                        04730099
           MOVE XST00008-UNT-RTL-AMT      TO PXRD009-PRICE.             04740099
                                                                        04750099
           MOVE XST00008-BEG-TMST         TO DF-ORIG-DATE.              04760099
           MOVE DF-ORIG-DATE-YY           TO PXRD009-EFFECTIVE-DATE-YY. 04770099
           MOVE DF-ORIG-DATE-MM           TO PXRD009-EFFECTIVE-DATE-MM. 04780099
           MOVE DF-ORIG-DATE-DD           TO PXRD009-EFFECTIVE-DATE-DD. 04790099
                                                                        04800099
           IF  NV-LAST-NRTL-CLR-AMT NOT EQUAL PC-NULL-VALUE             04810099
      ***CALCULATE PERCENT OFF IF ONLY IF IT EXISTS                     04820099
               MOVE XST00011-LAST-NCLR-RTL-AMT                          04830099
                                          TO PXRD009-ORIGINAL-NCLR-RTL  04840099
112905         COMPUTE PC-PERCENT-OFF                                   04850099
                       = 100 * (1 - (XST00008-UNT-RTL-AMT /             04860099
                                     XST00011-LAST-NCLR-RTL-AMT))       04870099
112905         MOVE PC-PERCENT-OFF        TO PXRD009-CLR-PCT-OFF        04880099
           END-IF.                                                      04890099
                                                                        04900099
011106     MOVE PXRD008-LOC-NBR           TO RFWS010-TEST-STORES.       04910099
                                                                        04920099
011106*    IF (RFWS010-TEST-STORES-A                                    04930099
011106*    AND XST00008-ORIG-CLR-DTE < '2005-11-07')                    04940099
011106*    OR (RFWS010-TEST-STORES-B                                    04950099
011106*    AND XST00008-ORIG-CLR-DTE < '2006-01-31')                    04960099
051906*    OR (RFWS010-TEST-STORES-C                                    04961099
051806*    AND XST00008-ORIG-CLR-DTE < '2006-01-31')                    04962099
      ***MOVE DEFAULT CODE IF ORIGINAL MARK WAS BEFORE 11/07/05         04970099
      *        MOVE 01                    TO PXRD009-EVENT-CODE         04980099
      *    ELSE                                                         04990099
031006*        IF  PXRD009-CLR-PCT-OFF >= 85                            05000099
031006         IF  PXRD009-CLR-PCT-OFF >= 80                            05001099
031006***RETREIVE FISCAL WEEK NUMBER IF PERCENT OFF IS 80 OR GREATER    05010099
                   MOVE XST00008-ORIG-CLR-DTE                           05020099
                                          TO DF-ORIG-DATE               05030099
                   PERFORM 2700-DETERMINE-EVENT-CODE                    05040099
               END-IF.                                                  05050099
      *    END-IF.                                                      05060099
                                                                        05070099
           PERFORM 2725-DETERMINE-PRINT-IND.                            05080099
                                                                        05090099
       EJECT.                                                           05100099
      ***************************************************************** 05110099
      **MOVE DATA WHEN ITEM IS CURRENTLY ACTIVE                         05120099
      ***************************************************************** 05130099
       2675-DATA-CURRENT-ACTIV.                                         05140099
                                                                        05150099
           MOVE '2675-DATA-CURRENT-ACTIV'   TO DP013-PARAGRAPH.         05160099
                                                                        05170099
           SET PXRD009-TICKET-TYPE-ACTIV    TO TRUE.                    05180099
           SET PXRD009-STAT-ACTIVE          TO TRUE.                    05190099
           SET PXRD009-PRINT-IND-NO         TO TRUE.                    05200099
           MOVE XST00008-UNT-RTL-AMT        TO PXRD009-PRICE.           05210099
                                                                        05220099
      ***DETERMINES IF GROUP PRICING IS AVAILABLE FOR ITEM              05230099
           IF  NV-GP-RTL-NULL-IND  = PC-NULL-VALUE                      05240099
               MOVE ZEROS                   TO PXRD009-GP-QTY           05250099
           ELSE                                                         05260099
               MOVE XST00008-GP-RTL-QTY     TO PXRD009-GP-QTY           05270099
           END-IF.                                                      05280099
                                                                        05290099
      ***DETERMINES IF GROUP PRICING IS AVAILABLE FOR ITEM              05300099
           IF  NV-GP-QTY-NULL-IND  = PC-NULL-VALUE                      05310099
               MOVE ZEROS                   TO PXRD009-GP-PRICE         05320099
           ELSE                                                         05330099
               MOVE XST00008-GP-RTL-AMT     TO PXRD009-GP-PRICE         05340099
           END-IF.                                                      05350099
                                                                        05360099
       EJECT.                                                           05370099
      ***************************************************************** 05380099
      **DETERMINE EVENT CODE OF ITEM                                    05390099
      ***************************************************************** 05400099
       2700-DETERMINE-EVENT-CODE.                                       05410099
                                                                        05420099
           MOVE '2700-DETERMINE-EVENT-CODE'    TO DP013-PARAGRAPH.      05430099
                                                                        05440099
           INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              05450099
           SET DPG51-FISCAL-454-CALENDAR       TO TRUE.                 05460099
           SET DPG51-DO-NOT-INCR-DECR-DATE     TO TRUE.                 05470099
           SET DPG52-LK-DTE-ISO-FMT            TO TRUE.                 05480099
           MOVE DF-ORIG-DATE                   TO DPG52-LK-DATE-INPUT.  05490099
                                                                        05500099
           PERFORM 9999-DATE-ROUTINE.                                   05510099
                                                                        05520099
           MOVE DPG56-FISCAL-WEEK-NBR          TO PXRD009-EVENT-CODE.   05530099
                                                                        05540099
       EJECT.                                                           05550099
      ***************************************************************** 05560099
      **DETERMINE IF DEVICE SHOULD AUTO PRINT                           05570099
      ***************************************************************** 05580099
       2725-DETERMINE-PRINT-IND.                                        05590099
                                                                        05600099
           MOVE '2725-DETERMINE-PRINT-IND' TO DP013-PARAGRAPH.          05610099
                                                                        05620099
           INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              05630099
           SET DPG51-FISCAL-454-CALENDAR   TO TRUE.                     05640099
           SET DPG51-DO-NOT-INCR-DECR-DATE TO TRUE.                     05650099
           SET DPG52-LK-DTE-ISO-FMT        TO TRUE.                     05660099
           MOVE XST00008-BEG-TMST          TO DPG52-LK-DATE-INPUT.      05670099
           SET DPG53-LK-CMPR-DTE-ISO-FMT   TO TRUE.                     05680099
           MOVE DF-FORMAT-DATE-TIME        TO DPG53-LK-CMPR-DATE-INPUT. 05690099
           PERFORM 9999-DATE-ROUTINE.                                   05700099
                                                                        05710099
           IF  DPG55-DAYS-DIFFERENCE >= -3                              05720099
      ***EFFECTIVE DATE IS LESS THAN 3 DAYS OLD                         05730099
               SET PXRD009-PRINT-IND-YES   TO TRUE                      05740099
           ELSE                                                         05750099
      ***EFFECTIVE DATE IS MORE THAN 3 DAYS OLD                         05760099
               SET PXRD009-PRINT-IND-NO    TO TRUE                      05770099
           END-IF.                                                      05780099
                                                                        05790099
       EJECT.                                                           05800099
      ***************************************************************** 05810088
      **DETERMINE EVENT CODE (FISCAL WEEK OF FIRST MARK)                05820088
      ***************************************************************** 05830088
       9999-DATE-ROUTINE.                                               05840099
                                                                        05850088
           MOVE '9999-DATE-ROUTINE'         TO DP013-PARAGRAPH.         05860099
                                                                        05870088
           CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51                05880088
                                                   DPG52                05890088
                                                   DPG53                05900088
                                                   DPG54                05910088
                                                   DPG55                05920088
                                                   DPG56.               05930088
                                                                        05940088
           EVALUATE TRUE                                                05950088
              WHEN DPG54-NO-ERROR                                       05960088
                   CONTINUE                                             05970088
              WHEN OTHER                                                05980088
                   MOVE 'DPG52-LK-DATE-INPUT'                           05990088
                                            TO DP013-MESSAGE-TEXT (1)   06000088
                   MOVE DPG52-LK-DATE-INPUT                             06010088
                                            TO DP013-MESSAGE-TEXT (2)   06020088
                   SET DP013-OTHER-ABEND                                06030088
                       DP013-NO-ROLLBACK    TO TRUE                     06040088
                   PERFORM 9999-WRITE-CICS-LOG-MSG                      06050088
                   SET  DP011-MSG-FATAL     TO TRUE                     06060088
                   MOVE PC-TSYMSG-01064     TO DP011-MSG-NUMBER         06070088
                   PERFORM 9000-FMT-ERR-MSG-TO-PTC                      06080088
                   PERFORM 9000-CALL-CICS                               06090088
           END-EVALUATE.                                                06100088
                                                                        06110088
       EJECT.                                                           06120088
      ***************************************************************** 06130085
      **PREP AND CICS CALLS                                             06140085
      ***************************************************************** 06150085
       9000-CALL-CICS.                                                  06160085
                                                                        06170085
           MOVE '9000-CALL-CICS'      TO DP013-PARAGRAPH.               06180085
                                                                        06190085
           PERFORM 9100-RFPD001-PREP.                                   06200085
           PERFORM RFPD001-1000-RETURN-DATA.                            06210085
                                                                        06220085
       EJECT.                                                           06230085
      ******************************************************************06240085
      **FORMAT MESSAGE TO WRITE TO CICS LOG                             06250085
      ******************************************************************06260085
       9000-FMT-ERR-MSG-TO-PTC.                                         06270085
                                                                        06280085
           PERFORM DP011-0000-FORMAT-MSG-LINES.                         06290085
           MOVE DP011-MSG-LEVEL   TO PXRD009-ERR-TYP-IND.               06300099
           MOVE DP011-MSG-TEXT    TO PXRD009-ERR-MSG.                   06310099
                                                                        06320085
       EJECT.                                                           06330085
      ****************************************************************  06340085
      **PREPARATION FOR RFPD001 PROCEDURE DIVISION                      06350085
      ****************************************************************  06360085
       9100-RFPD001-PREP.                                               06370085
                                                                        06380085
           MOVE '9100-RFPD001-PREP'      TO DP013-PARAGRAPH.            06390085
                                                                        06400085
      **USED TO DETERMINE THE SENDING PATH                              06410085
           MOVE PXRD008-MQ-INDICATOR     TO RFWS007-MQ-INDICATOR.       06420099
           MOVE LENGTH OF PXRD009-TO-CLIENT-RECORD                      06430099
                                         TO RFWS007-DATA-LENGTH         06440085
                                            PXRD009-TOT-REC-LENGTH.     06450099
      **USED FOR POCKET PCS TO UNIQUELY IDENTIFY THE MESSAGE            06460085
           MOVE PXRD008-MSGID            TO MQMD-CORRELID.              06470099
      **USED FOR OLD DEVICES TO UNIQUELY IDENTIFY THE MESSAGE           06480085
           MOVE PXRD008-MATCHING-NBR     TO PXRD009-MATCHING-NBR.       06490099
           MOVE PXRD009-TO-CLIENT-RECORD TO RFWS007-TO-CLIENT-RECORD.   06500099
           MOVE PXRD008-REPLYTOQ         TO MQOD-OBJECTNAME.            06510099
           MOVE PXRD008-REPLYTOQMGR      TO MQOD-OBJECTQMGRNAME.        06520099
           MOVE PXRD009-TO-CLIENT-RECORD TO RFWS007-MSGBUFFER.          06530099
                                                                        06540085
       EJECT.                                                           06550085
      ****************************************************************  06560085
      **CICS MESSAGE LOG ROUTINE                                        06570085
      ****************************************************************  06580085
       9999-WRITE-CICS-LOG-MSG.                                         06590085
                                                                        06600085
           MOVE PC-CURRENT-PROGRAM-NAME  TO  DP013-PROGRAM.             06610085
           MOVE DFHEIBLK                 TO  DP013-DFHEIBLK.            06620085
                                                                        06630085
           INITIALIZE DP013-SRC-TASK-NUMBER                             06640085
                      DP013-STACK.                                      06650085
                                                                        06660085
           SET DP013-LINK-RETURN         TO  TRUE.                      06670085
                                                                        06680085
           EXEC CICS                                                    06690085
               LINK                                                     06700085
                   PROGRAM   (DP013-NAME)                               06710085
                   COMMAREA  (DP013-PARAMETERS)                         06720085
                   LENGTH    (DP013-LENGTH)                             06730085
           END-EXEC.                                                    06740085
                                                                        06750085
       EJECT.                                                           06760085
      ******************************************************************06770085
      **RF CICS CALL COPYBOOK                                           06780085
      ******************************************************************06790085
           COPY RFPD001.                                                06800085
      ******************************************************************06810085
      **RF COMMON SKU STATUS DETERMINATION                              06820085
      ******************************************************************06830085
           COPY RFPD008.                                                06840085
