000100 IDENTIFICATION DIVISION.                                         00010029
000200 PROGRAM-ID.    RCKCS283.                                         00020029
000300 AUTHOR.        DENNIS STEFFEN - OMNI RESOURCES.                  00030029
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040029
000500 DATE-WRITTEN.  APRIL 1996.                                       00050029
000600 DATE-COMPILED.                                                   00060029
000700* RCKCS283 - THIS PROGRAM WILL BE USED FOR A SCREEN WHICH WILL    00070029
000800*            LIST DATA FROM THE AUDIT TABLE FOR ADJUSTMENTS       00080029
000900*            MADE TO A RECEIVER (LIST STORE LEVEL INFORMATION     00090029
001000*            FOR THE SELECTED LINES).                             00100029
001100*---------------------------------------------------------------* 00110029
001200* CHANGED 11/11/2021    BY JIM HUNTER      WR: CHG0263784         00120029
001300* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00130029
001400* MAKING THE CALL DYNAMIC VS STATIC.                              00140029
001500*---------------------------------------------------------------* 00150029
001600 ENVIRONMENT DIVISION.                                            00160029
001700 DATA DIVISION.                                                   00170029
001800 WORKING-STORAGE SECTION.                                         00180029
001900                                                                  00190029
002000 01  PC-PROGRAM-CONSTANTS.                                        00200029
002100     05  PC-CURRENT-MAP-NAME          PIC X(8)  VALUE 'RC283A  '. 00210029
002200     05  PC-CURRENT-MAPSET-NAME       PIC X(8)  VALUE 'RCKM283 '. 00220029
002300     05  PC-CURRENT-PROGRAM-NAME      PIC X(8)  VALUE 'RCKCS283'. 00230029
002400     05  PC-LOCATION-MODULE           PIC X(8)  VALUE 'XLKUT071'. 00240029
002500     05  PC-LIST-QUEUE-SEQ            PIC 9     VALUE 1.          00250029
002600     05  PC-SEL-QUEUE-SEQ             PIC 9     VALUE 2.          00260029
002700     05  PC-ITEMS-PER-PANEL           PIC S9(4) VALUE +12         00270029
002800                                                COMP SYNC.        00280029
002900     05  PC-MAX-BLOCKS-IN-ARRAY       PIC S9(4) VALUE +2          00290029
003000                                                COMP SYNC.        00300029
003100     05  PC-MAX-ITEMS                 PIC S9(4) VALUE +9999       00310029
003200                                                COMP SYNC.        00320029
003300     05  PC-A                         PIC X(01) VALUE 'A'.        00330029
003400     05  PC-DASH                      PIC X(01) VALUE '-'.        00340029
003500                                                                  00350029
003600     05  PC-TSYMSG-NUMBERS.                                       00360029
003700         10  PC-TSYMSG-00008          PIC 9(5)  VALUE 00008.      00370029
003800*            MUST BE NUMERIC                                      00380029
003900         10  PC-TSYMSG-00050          PIC 9(5)  VALUE 00050.      00390029
004000*            NO LIST ITEMS WERE FOUND FOR THE CRITERIA SPECIFIED  00400029
004100         10  PC-TSYMSG-00051          PIC 9(5)  VALUE 00051.      00410029
004200*            NO END OF RANGE HAS BEEN SPECIFIED                   00420029
004300         10  PC-TSYMSG-00052          PIC 9(5)  VALUE 00052.      00430029
004400*            END OF RANGE PRECEDES START OF RANGE                 00440029
004500         10  PC-TSYMSG-00053          PIC 9(5)  VALUE 00053.      00450029
004600*            NO START OF RANGE HAS BEEN SPECIFIED                 00460029
004700         10  PC-TSYMSG-00054          PIC 9(5)  VALUE 00054.      00470029
004800*            ONLY ONE START OF RANGE INDICATOR MAY BE SPECIFIED   00480029
004900         10  PC-TSYMSG-00055          PIC 9(5)  VALUE 00055.      00490029
005000*            ONLY ONE END OF RANGE INDICATOR MAY BE SPECIFIED     00500029
005100         10  PC-TSYMSG-00057          PIC 9(5)  VALUE 00057.      00510029
005200*            A LIST ITEM MUST BE SELECTED FOR THIS FUNCTION       00520029
005300         10  PC-TSYMSG-00069          PIC 9(5)  VALUE 00069.      00530029
005400*            TOP OF LIST                                          00540029
005500         10  PC-TSYMSG-00070          PIC 9(5)  VALUE 00070.      00550029
005600*            BOTTOM OF LIST                                       00560029
005700         10  PC-TSYMSG-00101          PIC 9(5)  VALUE 00101.      00570029
005800*            VALUE MUST BE GREATER THAN ZERO AND < 1,000,000      00580029
005900         10  PC-TSYMSG-00279          PIC 9(5)  VALUE 00279.      00590029
006000*            MORE ITEMS TO DISPLAY                                00600029
006100         10  PC-TSYMSG-00551          PIC 9(5)  VALUE 00551.      00610029
006200*            WAIT 15 SECONDS;RETRY FUNCTION AGAIN;IF UNSUCCESSFUL 00620029
006300*            CALL HELP DESK                                       00630029
006400                                                                  00640029
006500*----------------------------------------------------------------*00650029
006600* INCLUDED PROGRAM CONSTANTS PC-000 AND PC-999.      WR # 21361  *00660029
006700*----------------------------------------------------------------*00670029
006800     05  PC-000                       PIC X(03) VALUE '000'.      00680029
006900     05  PC-999                       PIC X(03) VALUE '999'.      00690029
007000*----------------------------------------------------------------*00700029
007100* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *00710029
007200*----------------------------------------------------------------*00720029
007300 01  PS-PROGRAM-SWITCHES.                                         00730029
007400     05  PS-ERROR-SW                  PIC  X    VALUE 'N'.        00740029
007500         88  PS-NO-ERROR                        VALUE 'N'.        00750029
007600         88  PS-ERROR                           VALUE 'Y'.        00760029
007700     05  PS-NEXT-SCREEN-SW            PIC  X    VALUE 'N'.        00770029
007800         88  PS-NO-NEXT-SCREEN                  VALUE 'N'.        00780029
007900         88  PS-NEXT-SCREEN                     VALUE 'Y'.        00790029
008000     05  PS-WRITE-LIST-QUEUE-SW       PIC  X    VALUE 'N'.        00800029
008100         88  PS-DONT-WRITE-LIST-QUEUE           VALUE 'N'.        00810029
008200         88  PS-WRITE-LIST-QUEUE                VALUE 'Y'.        00820029
008300                                                                  00830029
008400*----------------------------------------------------------------*00840029
008500*  INCLUDED PROGRAM SWITCHES FOR XLKUT001       **   WR # 21361  *00850029
008600*----------------------------------------------------------------*00860029
008700     05  PS-CALL-API-SW               PIC  X    VALUE 'N'.        00870029
008800         88  PS-CALL-API-NO                     VALUE 'N'.        00880029
008900         88  PS-CALL-API-YES                    VALUE 'Y'.        00890029
009000*----------------------------------------------------------------*00900029
009100* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *00910029
009200*----------------------------------------------------------------*00920029
009300 01  DK-DB2-KEYS.                                                 00930029
009400     05  DK-PO-NBR                    PIC S9(9) COMP VALUE ZERO.  00940029
009500     05  DK-PKSL-LNE-NBR              PIC S9(9) COMP VALUE ZERO.  00950029
009600     05  DK-REC-SEQ-NBR               PIC S9(9) COMP VALUE ZERO.  00960029
009700     05  DK-CYC-NBR                   PIC S9(9) COMP VALUE ZERO.  00970029
009800*----------------------------------------------------------------*00980029
009900* CHANGED PROGRAM VARIABLES                          WR # 21361  *00990029
010000* PV-SKU-NBR FIELD INCREASED FROM X(03) TO X(08)                 *01000029
010100* FILLER VALUE IS CHANGED FROM '_' TO SPACES                      01010029
010200*----------------------------------------------------------------*01020029
010300                                                                  01030029
010400 01  PV-PROGRAM-VARIABLES.                                        01040029
010500     05  PV-SUB                       PIC S9(4) VALUE ZERO        01050029
010600                                                COMP SYNC.        01060029
010700     05  PV-REMAINDER                 PIC S9(4) VALUE ZERO        01070029
010800                                                COMP SYNC.        01080029
010900     05  PV-READ-COUNT                PIC S9(9) VALUE ZERO        01090029
011000                                                COMP-3.           01100029
011100     05  PV-ITEMS-PROCESSED           PIC S9(9) VALUE ZERO        01110029
011200                                                COMP-3.           01120029
011300     05  PV-HOLD-SELECTED-ITEMS       PIC S9(9) VALUE ZERO        01130029
011400                                                COMP-3.           01140029
011500     05  PV-ITEM-IN-USE               PIC S9(9) VALUE ZERO        01150029
011600                                                COMP-3.           01160029
011700     05  PV-TOP-ITEM                  PIC S9(9) VALUE ZERO        01170029
011800                                                COMP-3.           01180029
011900     05  PV-BOTTOM-ITEM               PIC S9(9) VALUE ZERO        01190029
012000                                                COMP-3.           01200029
012100     05  PV-TEMP-BLOCK-NUMBER         PIC S9(9) VALUE ZERO        01210029
012200                                                COMP-3.           01220029
012300     05  PV-BLOCK-NUMBER              PIC S9(4) VALUE ZERO        01230029
012400                                                COMP SYNC.        01240029
012500     05  PV-CICS-RESP                 PIC S9(4) VALUE ZERO        01250029
012600                                                COMP SYNC.        01260029
012700     05  PV-ITEM                      PIC S9(4) VALUE ZERO        01270029
012800                                                COMP SYNC.        01280029
012900     05  PV-SEL-QUEUE-ITEM            PIC S9(4) VALUE ZERO        01290029
013000                                                COMP SYNC.        01300029
013100     05  PV-SAVE-ITEM                 PIC S9(4) VALUE ZERO        01310029
013200                                                COMP SYNC.        01320029
013300     05  PV-HIGHEST-BLOCK-WRITTEN     PIC S9(4) VALUE ZERO        01330029
013400                                                COMP SYNC.        01340029
013500     05  PV-LIST-ITEM-NUMBER          PIC S9(4) VALUE ZERO        01350029
013600                                                COMP SYNC.        01360029
013700     05  PV-FIRST-BLOCK-IN-ARRAY      PIC S9(4) VALUE ZERO        01370029
013800                                                COMP SYNC.        01380029
013900     05  PV-NEXT-BLOCK-IN-ARRAY       PIC S9(4) VALUE ZERO        01390029
014000                                                COMP SYNC.        01400029
014100     05  PV-PREV-BLOCK-IN-ARRAY       PIC S9(4) VALUE ZERO        01410029
014200                                                COMP SYNC.        01420029
014300     05  PV-FIRST-BLOCK-IN-RANGE      PIC S9(4) VALUE ZERO        01430029
014400                                                COMP SYNC.        01440029
014500     05  PV-LAST-BLOCK-IN-RANGE       PIC S9(4) VALUE ZERO        01450029
014600                                                COMP SYNC.        01460029
014700     05  PV-START-OF-SELECTED-RANGE   PIC S9(4) VALUE ZERO        01470029
014800                                                COMP SYNC.        01480029
014900     05  PV-END-OF-SELECTED-RANGE     PIC S9(4) VALUE ZERO        01490029
015000                                                COMP SYNC.        01500029
015100     05  PV-SUM-UNIT-QTY              PIC S9(07)  VALUE ZERO      01510029
015200                                                        COMP-3.   01520029
015300     05  PV-ADJ-RETAIL-QTY            PIC S9(6)V99 VALUE ZERO     01530029
015400                                                        COMP-3.   01540029
015500     05  PV-ADJ-COST                  PIC S9(6)V99 VALUE ZERO     01550029
015600                                                        COMP-3.   01560029
015700     05  PV-TOT-ADJ-QTY               PIC S9(7) VALUE ZERO        01570029
015800                                                        COMP-3.   01580029
015900*    05  PV-DISTR-LNE-QTY             PIC S9(9) VALUE ZERO        01590029
016000*                                               COMP SYNC.        01600029
016100     05  PV-AURECD-STR-NBR            PIC S9(4) VALUE ZERO        01610029
016200                                                COMP SYNC.        01620029
016300     05  PV-DEPT-NBR                  PIC  X(3).                  01630029
016400     05  PV-CLASS-NBR                 PIC  X(2).                  01640029
016500     05  PV-SKU-NBR                   PIC  X(8).                  01650029
016600     05  PV-NOTIF-NBR                 PIC S9(9) COMP VALUE ZERO.  01660029
016700                                                                  01670029
016800 01  MSG-QUEUE-ITEM.                                              01680029
016900     05  FILLER                       PIC X(11)  VALUE            01690029
017000         'QUEUE NAME '.                                           01700029
017100     05  MSG-QUEUE-NAME               PIC X(08).                  01710029
017200     05  FILLER                       PIC X(14)  VALUE            01720029
017300         '  ITEM NUMBER '.                                        01730029
017400     05  MSG-SEL-ITEM                 PIC 9(04).                  01740029
017500                                                                  01750029
017600 01  MSG1-PO-REC.                                                 01760029
017700     05  FILLER                       PIC X(07)  VALUE            01770029
017800         'PO NBR '.                                               01780029
017900     05  MSG1-PO-NBR                  PIC 9(09).                  01790029
018000     05  FILLER                       PIC X(11)  VALUE            01800029
018100         '  REC SEQ  '.                                           01810029
018200     05  MSG1-REC-SEQ-NBR-N           PIC 9(09).                  01820029
018300     05  FILLER                       PIC X(12)  VALUE            01830029
018400         '  OPER UNIT '.                                          01840029
018500     05  MSG1-OPER-UNT-ID             PIC X(04).                  01850029
018600     05  FILLER                       PIC X(11)  VALUE            01860029
018700         '  FACILITY '.                                           01870029
018800     05  MSG1-FACILITY-ID             PIC X(04).                  01880029
018900                                                                  01890029
019000*----------------------------------------------------------------*01900029
019100* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *01910029
019200*----------------------------------------------------------------*01920029
019300                                                                  01930029
019400******************************************************************01940029
019500*    LOCATION MODULE COPYBOOK                                     01950029
019600******************************************************************01960029
019700     COPY XLWS071.                                                01970029
019800                                                                  01980029
019900                                                                  01990029
020000******************************************************************02000029
020100*    SELECTED ITEMS TEMPORARY STORAGE QUEUE ITEM LAYOUT           02010029
020200******************************************************************02020029
020300     COPY RCWS013.                                                02030029
020400                                                                  02040029
020500******************************************************************02050029
020600*    SELECTED ITEMS TEMPORARY STORAGE QUEUE WO ITEM LAYOUT        02060029
020700******************************************************************02070029
020800     COPY PCWS016.                                                02080029
020900                                                                  02090029
021000******************************************************************02100029
021100*    BMS MAP                                                      02110029
021200******************************************************************02120029
021300     COPY RCKM283.                                                02130029
021400                                                                  02140029
021500 01  MR-OCCURS-LAYOUT                 REDEFINES RC283AO.          02150029
021600*CLP 11/05/14                                                     02160029
021700     05  FILLER                       PIC X(175).                 02170029
021800                                                                  02180029
021900     05  MR-SCROLL-AREA               OCCURS 12 TIMES.            02190029
022000                                                                  02200029
022100         10  MR-STORE-L               PIC S9(4) COMP.             02210029
022200         10  MR-STORE-A               PIC X.                      02220029
022300         10  MR-STORE-C               PIC X.                      02230029
022400         10  MR-STORE-H               PIC X.                      02240029
022500         10  MR-STORE.                                            02250029
022600             15 MR-STORE-NUMERIC      PIC 9(04).                  02260029
022700                                                                  02270029
022800         10  MR-ADJ-QTY-L             PIC S9(4) COMP.             02280029
022900         10  MR-ADJ-QTY-A             PIC X.                      02290029
023000         10  MR-ADJ-QTY-C             PIC X.                      02300029
023100         10  MR-ADJ-QTY-H             PIC X.                      02310029
023200         10  MR-ADJ-QTY.                                          02320029
023300             15  MR-ADJ-QTY-EDITED                                02330029
023400                                      PIC ZZ,ZZ9-.                02340029
023500                                                                  02350029
023600         10  MR-ADJ-RETAIL-QTY-L      PIC S9(4) COMP.             02360029
023700         10  MR-ADJ-RETAIL-QTY-A      PIC X.                      02370029
023800         10  MR-ADJ-RETAIL-QTY-C      PIC X.                      02380029
023900         10  MR-ADJ-RETAIL-QTY-H      PIC X.                      02390029
024000         10  MR-ADJ-RETAIL-QTY.                                   02400029
024100             15  MR-ADJ-RETAIL-QTY-EDITED                         02410029
024200                                      PIC ZZZ,ZZ9.99-.            02420029
024300                                                                  02430029
024400         10  MR-ADJ-COST-QTY-L        PIC S9(4) COMP.             02440029
024500         10  MR-ADJ-COST-QTY-A        PIC X.                      02450029
024600         10  MR-ADJ-COST-QTY-C        PIC X.                      02460029
024700         10  MR-ADJ-COST-QTY-H        PIC X.                      02470029
024800         10  MR-ADJ-COST-QTY.                                     02480029
024900             15  MR-ADJ-COST-QTY-EDITED                           02490029
025000                                      PIC ZZZ,ZZ9.99-.            02500029
025100                                                                  02510029
025200     05 FILLER                        PIC X(12).                  02520029
025300                                                                  02530029
025400******************************************************************02540029
025500*    BMS ATTRIBUTES                                               02550029
025600******************************************************************02560029
025700     COPY DPWS015.                                                02570029
025800                                                                  02580029
025900******************************************************************02590029
026000*    FUNCTION KEYS                                                02600029
026100******************************************************************02610029
026200     COPY DPWS016.                                                02620029
026300                                                                  02630029
026400******************************************************************02640029
026500*    PARAMETER LIST FOR NUMERIC EDIT SUBROUTINE                   02650029
026600******************************************************************02660029
026700     COPY DPWS010I.                                               02670029
026800                                                                  02680029
026900******************************************************************02690029
027000*    PARAMETER LIST FOR CICS API                                  02700029
027100******************************************************************02710029
027200     COPY DPWS030.                                                02720029
027210     COPY DPWS930.                                                02721030
027300                                                                  02730029
027400******************************************************************02740029
027500*    GLOBAL COMMUNICATION AREA                                    02750029
027600******************************************************************02760029
027700     COPY DPWS020.                                                02770029
027800     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02780029
027900                                                                  02790029
028000******************************************************************02800029
028100*    INTER-APPLICATION COMMUNICATION AREA                         02810029
028200*    RCWS015 = INPUT FROM PACK SLIP LINE SUMMARY PROGRAM          02820029
028300******************************************************************02830029
028400         10  INTER-APPL-COMM-AREA       PIC X(200).               02840029
028500     COPY RCWS015.                                                02850029
028600     COPY PCWS000.                                                02860029
028700     COPY TMWS001.                                                02870029
028800                                                                  02880029
028900******************************************************************02890029
029000*    APPLICATION SPECIFIC COMMUNICATION AREA                      02900029
029100******************************************************************02910029
029200*----------------------------------------------------------------*02920029
029300*                                             WR # 21361         *02930029
029400* CHANGED THE STRUCTURE OF ASC TO MATCH THE APPL COMMAREA.       *02940029
029500* ASC-DEPT-NBR IS ADDED.                                         *02950029
029600* ASC-CLS-NBR IS ADDED.                                          *02960029
029700* ASC-SKU-NBR FIELD IS CHANGED FROM X(10) TO X(8).               *02970029
029800*----------------------------------------------------------------*02980029
029900         10  ASC-SPECIFIC-COMMAREA.                               02990029
030000             15  ASC-LIST-HEADER-INFO.                            03000029
030100                 20  ASC-KEY-RECEIVER.                            03010029
030200                     25  ASC-KEY-PO-NBR.                          03020029
030300** CHG0094517  CHANGED PO-NBR LENGTH FROM 7 TO 8                  03030029
030400                         30  ASC-KEY-PO-NBR-N   PIC 9(08).        03040029
030500                     25  ASC-KEY-REC-DASH       PIC X(01).        03050029
030600                     25  ASC-KEY-REC-SEQ-NBR.                     03060029
030700                         30  ASC-KEY-REC-SEQ-NBR-N                03070029
030800                                                PIC 9(04).        03080029
030900                 20  ASC-KEY-PKSL-LNE-NBR       PIC 9(04).        03090029
031000                 20  ASC-KEY-OPER-UNT-ID        PIC S9(4) COMP.   03100029
031100                 20  ASC-KEY-FCLTY-ID           PIC S9(4) COMP.   03110029
031200                 20  ASC-KEY-FCLTY-DESC         PIC X(30).        03120029
031300                 20  ASC-KEY-CYC-NBR            PIC S9(9) COMP.   03130029
031400                 20  ASC-KEY-ADJ-DATE           PIC X(10).        03140029
031500                 20  ASC-SKU-NBR                PIC X(08).        03150029
031600                 20  ASC-DEPT-NBR               PIC X(03).        03160029
031700                 20  ASC-CLS-NBR                PIC X(02).        03170029
031800             15  ASC-BLOCK-ENTRIES  OCCURS 2 TIMES.               03180029
031900                 20  ASC-BLOCK-MODIFIED-SW           PIC X.       03190029
032000                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03200029
032100                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03210029
032200                                                                  03220029
032300                 20  ASC-ITEM-ARRAY.                              03230029
032400                     25  ASC-ITEM-ENTRIES  OCCURS 12 TIMES.       03240029
032500                         30  ASC-LIST-ITEM-NUMBER    PIC S9(9)    03250029
032600                                                     COMP-3.      03260029
032700                         30  ASC-STR-NBR             PIC 9(04).   03270029
032800                         30  ASC-ADJ-QTY.                         03280029
032900                             35  ASC-ADJ-QTY-N                    03290029
033000                                                     PIC S9(05).  03300029
033100                         30  ASC-ADJ-RETAIL-QTY.                  03310029
033200                             35  ASC-ADJ-RETAIL-QTY-N             03320029
033300                                                    PIC S9(6)V99. 03330029
033400                         30  ASC-ADJ-COST.                        03340029
033500                             35  ASC-ADJ-COST-N     PIC S9(6)V99. 03350029
033600                         30  ASC-NOTIF-NBR    PIC S9(9) COMP.     03360029
033700                                                                  03370029
033800             15  ASC-BLK-SUB                         PIC S9(4)    03380029
033900                                                     COMP SYNC.   03390029
034000             15  ASC-ITEM-SUB                        PIC S9(4)    03400029
034100                                                     COMP SYNC.   03410029
034200             15  ASC-SEL-SUB                         PIC S9(4)    03420029
034300                                                     COMP.        03430029
034400             15  ASC-SEL-ITEM                        PIC S9(4)    03440029
034500                                                     COMP.        03450029
034600             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(9)    03460029
034700                                                     COMP-3.      03470029
034800             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(9)    03480029
034900                                                     COMP-3.      03490029
035000             15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(5)    03500029
035100                                                     COMP-3.      03510029
035200             15  ASC-ITEMS-DISPLAYED                 PIC S999     03520029
035300                                                     COMP-3.      03530029
035400             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(9)    03540029
035500                                                     COMP-3.      03550029
035600             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(9)    03560029
035700                                                     COMP-3.      03570029
035800             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(4)    03580029
035900                                                     COMP SYNC.   03590029
036000             15  ASC-START-OF-SELECTED-RANGE         PIC S9(9)    03600029
036100                                                     COMP-3.      03610029
036200             15  ASC-END-OF-SELECTED-RANGE           PIC S9(9)    03620029
036300                                                     COMP-3.      03630029
036400             15  ASC-ITEMS-LEFT-INDICATOR                         03640029
036500                                        PIC X(01).                03650029
036600                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     03660029
036700                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     03670029
036800             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC X.       03680029
036900                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   03690029
037000                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   03700029
037100             15  ASC-LIST-QUEUE-NAME.                             03710029
037200                 20  ASC-LIST-TERM-ID                PIC X(4).    03720029
037300                 20  ASC-LIST-TASK-NUMBER            PIC S9(5)    03730029
037400                                                     COMP-3.      03740029
037500                 20  ASC-LIST-SEQ                    PIC 9.       03750029
037600             15  ASC-SEL-QUEUE-NAME-IN               PIC X(8).    03760029
037700             15  ASC-SEL-QUEUE-NAME-OUT.                          03770029
037800                 20  ASC-SEL-TERM-ID                 PIC X(4).    03780029
037900                 20  ASC-SEL-TASK-NUMBER             PIC S9(5)    03790029
038000                                                     COMP-3.      03800029
038100                 20  ASC-SEL-SEQ                     PIC 9.       03810029
038200             15  ASC-START-ITEM-REQUEST.                          03820029
038300                 20  ASC-START-ITEM-REQUEST-N        PIC 9(5).    03830029
038400             15  ASC-USE-SELECTION-QUEUE-IND         PIC X(1).    03840029
038500                 88  ASC-USE-SELECTION-QUEUE         VALUE 'Y'.   03850029
038600             15  ASC-HOLD-INTER-APPL                 PIC X(200).  03860029
038700             15  ASC-INTER-APPL-CODE-IND             PIC X(01).   03870029
038800             15  ASC-TOT-ADJUST-QTY    PIC S9(7) COMP-3.          03880029
038900/                                                                 03890029
039000*----------------------------------------------------------------*03900029
039100* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *03910029
039200*----------------------------------------------------------------*03920029
039300*----------------------------------------------------------------*03930029
039400 01  LQW-LIST-QUEUE-WORK-AREA.                                    03940029
039500     05  LQW-BLOCK-MODIFIED           PIC X(01)  VALUE SPACE.     03950029
039600     05  LQW-ITEM-ENTRIES             OCCURS 12 TIMES             03960029
039700                                      INDEXED BY LQW-IDX.         03970029
039800         10  LQW-LIST-ITEM-NUMBER     PIC S9(9)  COMP-3.          03980029
039900         10  LQW-STORE-NBR            PIC 9(04).                  03990029
040000         10  LQW-ADJ-QTY.                                         04000029
040100             15  LQW-ADJ-QTY-N        PIC 9(05).                  04010029
040200         10  LQW-ADJ-RETAIL-QTY.                                  04020029
040300             15  LQW-ADJ-RETAIL-QTY-N PIC S9(6)V99.               04030029
040400         10  LQW-ADJ-COST.                                        04040029
040500             15  LQW-ADJ-COST-N       PIC S9(6)V99.               04050029
040600         10  LQW-NOTIF-NBR            PIC S9(9) COMP.             04060029
040700                                                                  04070029
040800******************************************************************04080029
040900*    ABEND PROCESSING                                             04090029
041000******************************************************************04100029
041100     COPY DPWS013.                                                04110029
041200/                                                                 04120029
041300*----------------------------------------------------------------*04130029
041400*                                                **   WR # 21361 *04140029
041500*  RECORD LAYOUT FOR LOGISTICS DOMAIN ITEM ACCESS MODULE         *04150029
041600*----------------------------------------------------------------*04160029
041700     COPY XLWS001.                                                04170029
041800*----------------------------------------------------------------*04180029
041900*   CHANGES MADE FOR WR # 21361 ENDS HERE.                        04190029
042000*----------------------------------------------------------------*04200029
042100******************************************************************04210029
042200*    DB2 SQL COMMUNICATION AREA                                   04220029
042300******************************************************************04230029
042400     EXEC SQL                                                     04240029
042500          INCLUDE SQLCA                                           04250029
042600     END-EXEC.                                                    04260029
042700/                                                                 04270029
042800*---------------------------------------------------------------* 04280029
042900*    DB2 AREA FOR AUDIT TABLE FOR TAURECD  TABLE                * 04290029
043000*---------------------------------------------------------------* 04300029
043100     EXEC SQL                                                     04310029
043200          INCLUDE TAURECD                                         04320029
043300     END-EXEC.                                                    04330029
043400/                                                                 04340029
043500******************************************************************04350029
043600*    DB2 DCLGEN FOR PURCHASE ORDER TABLE                          04360029
043700******************************************************************04370029
043800     EXEC SQL                                                     04380029
043900          INCLUDE TPURCHS                                         04390029
044000     END-EXEC.                                                    04400029
044100                                                                  04410029
044200******************************************************************04420029
044300*    DB2 DCLGEN FOR PURCHASE ORDER ITEM TABLE                     04430029
044400******************************************************************04440029
044500     EXEC SQL                                                     04450029
044600          INCLUDE TPURITM                                         04460029
044700     END-EXEC.                                                    04470029
044800                                                                  04480029
044900*---------------------------------------------------------------* 04490029
045000*    DB2 AREA FOR RECEIVING ITEMS                                 04500029
045100*---------------------------------------------------------------* 04510029
045200     EXEC SQL                                                     04520029
045300          INCLUDE TRECITM                                         04530029
045400     END-EXEC.                                                    04540029
045500                                                                  04550029
045600******************************************************************04560029
045700*    DB2 CURSOR FOR ALL THE AUDIT STORES BELONGING TO A SELECTED  04570029
045800*    LINE.                                                        04580029
045900******************************************************************04590029
046000     EXEC SQL                                                     04600029
046100         DECLARE TAURECD-CURSOR CURSOR FOR                        04610029
046200             SELECT STR_NBR                                       04620029
046300                , REC_SEQ_NBR                                     04630029
046400                , UPD_TMST                                        04640029
046500                , AUD_TYP_CDE                                     04650029
046600                , AP_VERIFY_ITM_QTY                               04660029
046700                , NOTIF_NBR                                       04670029
046800             FROM TAURECD                                         04680029
046900             WHERE ORD_NBR         = :DK-PO-NBR                   04690029
047000               AND REC_SEQ_NBR     = :DK-REC-SEQ-NBR              04700029
047100               AND ORD_LNE_NBR     = :DK-PKSL-LNE-NBR             04710029
047200               AND VER_STATUS_CDE  = :PC-A                        04720029
047300               AND ADJ_CYC_NBR     = :DK-CYC-NBR                  04730029
047400                AND (UPD_PGM_ID    = 'RCKCS279' OR                04740029
047500                     UPD_PGM_ID    = 'RCKCS280' OR                04750029
047600                     UPD_PGM_ID    = 'RCKPV818' OR                04760029
047700                     UPD_PGM_ID    = 'RCKPV819' OR                04770029
047800                     UPD_PGM_ID    = 'RCKPV820' OR                04780029
047900                     UPD_PGM_ID    = 'SUKPV702')                  04790029
048000             ORDER BY STR_NBR                                     04800029
048100                  , UPD_TMST                                      04810029
048200                  , AUD_TYP_CDE                                   04820029
048300     END-EXEC.                                                    04830029
048400/                                                                 04840029
048500 LINKAGE SECTION.                                                 04850029
048600                                                                  04860029
048700 01  DFHCOMMAREA.                                                 04870029
048800     05  FILLER                       OCCURS 1 TO 4072 TIMES      04880029
048900                                      DEPENDING ON EIBCALEN.      04890029
049000         10  FILLER                   PIC X.                      04900029
049100                                                                  04910029
049200                                                                  04920029
049300 PROCEDURE DIVISION.                                              04930029
049400                                                                  04940029
049500 0000-MAIN-MODULE.                                                04950029
049600                                                                  04960029
049700     INITIALIZE DP030-CICS-API-FIELDS.                            04970029
049800                                                                  04980029
049900     MOVE +1                     TO DP030-NUMBER-OF-MAPS.         04990029
050000     MOVE PC-CURRENT-MAPSET-NAME TO DP030-MAPSET-NAME.            05000029
050100     MOVE PC-CURRENT-MAP-NAME    TO DP030-MAP-NAME (1).           05010029
050200     SET DP030-RECEIVE-APPL-MAP  TO TRUE.                         05020029
050300     MOVE LENGTH OF RC283AI      TO DP030-MAP-LENGTH (1).         05030029
050400     MOVE 'PROGRAM ENTRY CALL'   TO DP013-MESSAGE-TEXT (1).       05040029
050500     SET DP030-OVERRIDE-APPL-ERROR                                05050029
050600                                 TO TRUE.                         05060029
050700                                                                  05070029
050800     PERFORM 0001-CALL-CICS-ARCH-API.                             05080029
050900                                                                  05090029
051000     PERFORM 1000-CONTROL-PROCESSING.                             05100029
051100                                                                  05110029
051200     MOVE 'PROGRAM EXIT CALL'    TO DP013-MESSAGE-TEXT (1).       05120029
051300                                                                  05130029
051400     PERFORM 0001-CALL-CICS-ARCH-API.                             05140029
051500                                                                  05150029
051600 0001-CALL-CICS-ARCH-API.                                         05160029
051700                                                                  05170029
051810     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      05181030
051900                                    DFHCOMMAREA                   05190030
052000                                    DP030-CICS-API-FIELDS         05200030
052100                                    DP020-STANDARD-COMMAREA       05210030
052200                                    RC283AI.                      05220030
052300                                                                  05230029
052400     IF DP030-RC-CALL-SUCCESSFUL OR                               05240029
052500        DP030-RC-APPL-ERROR                                       05250029
052600         CONTINUE                                                 05260029
052700     ELSE                                                         05270029
052800         SET DP013-CICS-ABEND                                     05280029
052900             DP013-NO-ROLLBACK                                    05290029
053000             DP013-XCTL-DISPLAY-RESTART                           05300029
053100                                 TO TRUE                          05310029
053200         MOVE '0001-CALL-CICS-ARCH-API'                           05320029
053300                                 TO DP013-PARAGRAPH               05330029
053320         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN CODE O05332030
053330-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05333030
053600         MOVE DP030-RETURN-CODE  TO DP013-MESSAGE-TEXT (3)        05360029
053700                                                                  05370029
053800         PERFORM DP013-0000-PROCESS-ABEND.                        05380029
053900                                                                  05390029
054000 1000-CONTROL-PROCESSING.                                         05400029
054100                                                                  05410029
054200     EVALUATE TRUE                                                05420029
054300                                                                  05430029
054400         WHEN DP030-RC-APPL-ERROR                                 05440029
054500              MOVE ASC-ITEM-AT-TOP-OF-PANEL                       05450029
054600                                 TO PV-TOP-ITEM                   05460029
054700              MOVE ZERO          TO ASC-ITEM-AT-TOP-OF-PANEL      05470029
054800                                                                  05480029
054900              PERFORM 6000-REFRESH-PANEL-FROM-TEMP                05490029
055000                                                                  05500029
055100              PERFORM 3000-EDIT-DATA-IN-COMMAREA                  05510029
055200                                                                  05520029
055300              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                05530029
055400                                                                  05540029
055500                                                                  05550029
055600         WHEN DP020-NEXT-ACT-INITIAL                              05560029
055700              INITIALIZE ASC-SPECIFIC-COMMAREA                    05570029
055800              MOVE EIBTRMID      TO ASC-LIST-TERM-ID              05580029
055900                                    ASC-SEL-TERM-ID               05590029
056000              MOVE DP020-SRC-TASK-NUMBER                          05600029
056100                                 TO ASC-LIST-TASK-NUMBER          05610029
056200                                    ASC-SEL-TASK-NUMBER           05620029
056300              MOVE PC-LIST-QUEUE-SEQ                              05630029
056400                                 TO ASC-LIST-SEQ                  05640029
056500              MOVE PC-SEL-QUEUE-SEQ                               05650029
056600                                 TO ASC-SEL-SEQ                   05660029
056700              SET PS-NO-ERROR    TO TRUE                          05670029
056800                                                                  05680029
056900              PERFORM 1100-PROCESS-INTER-APPL-COMM                05690029
057000                                                                  05700029
057100              IF PS-NO-ERROR                                      05710029
057200                  MOVE INTER-APPL-COMM-AREA                       05720029
057300                                 TO ASC-HOLD-INTER-APPL           05730029
057400                  PERFORM 4000-BUILD-INITIAL-PANEL                05740029
057500              END-IF                                              05750029
057600                                                                  05760029
057700                                                                  05770029
057800         WHEN DP020-NEXT-ACT-READ-MAP                             05780029
057900              MOVE ASC-ITEM-AT-TOP-OF-PANEL                       05790029
058000                                 TO PV-TOP-ITEM                   05800029
058100                                                                  05810029
058200              PERFORM 2000-PROCESS-PANEL                          05820029
058300                                                                  05830029
058400                                                                  05840029
058500         WHEN DP020-NEXT-ACT-RETURN                               05850029
058600                                                                  05860029
058700              MOVE ASC-ITEM-AT-TOP-OF-PANEL                       05870029
058800                                 TO PV-TOP-ITEM                   05880029
058900              MOVE ZERO          TO ASC-ITEM-AT-TOP-OF-PANEL      05890029
059000                                                                  05900029
059100              PERFORM 6000-REFRESH-PANEL-FROM-TEMP                05910029
059200              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                05920029
059300                                                                  05930029
059400         WHEN OTHER                                               05940029
059500              SET DP013-LOGIC-ABEND                               05950029
059600                  DP013-NO-ROLLBACK                               05960029
059700                                 TO TRUE                          05970029
059800              MOVE '1000-CONTROL-PROCESSING'                      05980029
059900                                 TO DP013-PARAGRAPH               05990029
060000              MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'   06000029
060100                                 TO DP013-MESSAGE-TEXT(1)         06010029
060200                                                                  06020029
060300              PERFORM DP013-0000-PROCESS-ABEND                    06030029
060400                                                                  06040029
060500     END-EVALUATE.                                                06050029
060600                                                                  06060029
060700 1100-PROCESS-INTER-APPL-COMM.                                    06070029
060800                                                                  06080029
060900     MOVE SPACE                  TO ASC-START-ITEM-REQUEST.       06090029
061000     MOVE DP020-INT-APPL-FORMAT-IND                               06100029
061100                                 TO ASC-INTER-APPL-CODE-IND.      06110029
061200* SINCE THERE'S ONLY ONE POSSIBLE VALUE FOR THIS CODE,            06120029
061300* THERE'S NO NEED TO INTEROGATE IT.                               06130029
061400                                                                  06140029
061500     MOVE RC015-OPER-UNT-ID      TO ASC-KEY-OPER-UNT-ID           06150029
061600     MOVE RC015-FCLTY-ID         TO ASC-KEY-FCLTY-ID              06160029
061700                                                                  06170029
061800     MOVE RC015-PO-NBR           TO ASC-KEY-PO-NBR-N              06180029
061900                                    DK-PO-NBR                     06190029
062000     MOVE RC015-REC-SEQ-NBR      TO ASC-KEY-REC-SEQ-NBR-N         06200029
062100                                    DK-REC-SEQ-NBR                06210029
062200     MOVE RC015-ADJ-CYC-NBR      TO ASC-KEY-CYC-NBR               06220029
062300                                    DK-CYC-NBR                    06230029
062400                                                                  06240029
062500                                                                  06250029
062600     SET ASC-USE-SELECTION-QUEUE                                  06260029
062700                             TO TRUE                              06270029
062800     MOVE RC015-NUMBER-OF-SELECTED-ITEMS                          06280029
062900                             TO ASC-NUMBER-OF-SELECTED-ITEMS      06290029
063000     MOVE RC015-NUMBER-OF-TS-ITEMS                                06300029
063100                             TO ASC-NUMBER-OF-TS-ITEMS            06310029
063200     MOVE RC015-SEL-QUEUE-NAME                                    06320029
063300                             TO ASC-SEL-QUEUE-NAME-IN             06330029
063400     MOVE RC013-MAX-ITEMS        TO ASC-SEL-SUB                   06340029
063500     MOVE ZERO                   TO ASC-SEL-ITEM                  06350029
063600     PERFORM 2300-GET-SELQUE-RECORD.                              06360029
063700     EJECT                                                        06370029
063800 2000-PROCESS-PANEL.                                              06380029
063900                                                                  06390029
064000     EVALUATE TRUE                                                06400029
064100                                                                  06410029
064200         WHEN DP020-SRC-AID = DP016-CLEAR                         06420029
064300              MOVE ZERO          TO ASC-ITEM-AT-TOP-OF-PANEL      06430029
064400              PERFORM 3000-EDIT-DATA-IN-COMMAREA                  06440029
064500              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                06450029
064600                                                                  06460029
064700         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    06470029
064800              PERFORM 2050-DELETE-LIST-QUEUE                      06480029
064900              PERFORM 4000-BUILD-INITIAL-PANEL                    06490029
065000                                                                  06500029
065100                                                                  06510029
065200         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             06520029
065300             IF ASC-USE-SELECTION-QUEUE                           06530029
065400                 PERFORM 6200-DEL-LIST-QUEUE                      06540029
065500                 PERFORM 2300-GET-SELQUE-RECORD                   06550029
065600                 PERFORM 4000-BUILD-INITIAL-PANEL                 06560029
065700             ELSE                                                 06570029
065800*                --- BOTTOM OF LIST ---                           06580029
065900                 MOVE PC-TSYMSG-00070                             06590029
066000                                 TO DP020-MSG-NUMBER              06600029
066100                 SET DP020-MSG-INFORMATIONAL                      06610029
066200                                 TO TRUE                          06620029
066300             END-IF                                               06630029
066400                                                                  06640029
066500         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             06650029
066600             IF ASC-USE-SELECTION-QUEUE                           06660029
066700                 PERFORM 6200-DEL-LIST-QUEUE                      06670029
066800                     PERFORM 2310-GET-PREV-RECORD                 06680029
066900*                END-IF                                           06690029
067000                 PERFORM 4000-BUILD-INITIAL-PANEL                 06700029
067100             ELSE                                                 06710029
067200*                --- TOP OF LIST ---                              06720029
067300                 MOVE PC-TSYMSG-00069                             06730029
067400                                 TO DP020-MSG-NUMBER              06740029
067500                 SET DP020-MSG-INFORMATIONAL                      06750029
067600                                 TO TRUE                          06760029
067700             END-IF                                               06770029
067800                                                                  06780029
067900         WHEN OTHER                                               06790029
068000              PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                06800029
068100              PERFORM 3000-EDIT-DATA-IN-COMMAREA                  06810029
068200              IF PS-NO-ERROR                                      06820029
068300                  SET DP030-CONTINUE-GO                           06830029
068400                                 TO TRUE                          06840029
068500                  PERFORM 2100-CHECK-FUNCTION-KEY                 06850029
068600              ELSE                                                06860029
068700                  SET DP030-OVERRIDE-GO                           06870029
068800                                 TO TRUE                          06880029
068900              END-IF                                              06890029
069000     END-EVALUATE.                                                06900029
069100                                                                  06910029
069200 2050-DELETE-LIST-QUEUE.                                          06920029
069300                                                                  06930029
069400     EXEC CICS DELETEQ TS QUEUE (ASC-LIST-QUEUE-NAME)             06940029
069500                          RESP  (PV-CICS-RESP)                    06950029
069600                          END-EXEC.                               06960029
069700                                                                  06970029
069800     IF (PV-CICS-RESP = DFHRESP (NORMAL)) OR                      06980029
069900        (PV-CICS-RESP = DFHRESP (QIDERR))                         06990029
070000         CONTINUE                                                 07000029
070100     ELSE                                                         07010029
070200         SET DP013-CICS-ABEND                                     07020029
070300             DP013-NO-ROLLBACK   TO TRUE                          07030029
070400         MOVE '2050-DELETE-LIST-QUEUE'                            07040029
070500                                 TO DP013-PARAGRAPH               07050029
070600         MOVE 'UNSUCCESSFUL LIST ITEMS TEMP STORAGE QUEUE DELETE' 07060029
070700                                 TO DP013-MESSAGE-TEXT (1)        07070029
070800                                                                  07080029
070900         PERFORM DP013-0000-PROCESS-ABEND                         07090029
071000     END-IF.                                                      07100029
071100                                                                  07110029
071200     MOVE ZERO                   TO ASC-HIGHEST-BLOCK-WRITTEN.    07120029
071300                                                                  07130029
071400 2100-CHECK-FUNCTION-KEY.                                         07140029
071500                                                                  07150029
071600     SET PS-NEXT-SCREEN TO TRUE.                                  07160029
071700     EVALUATE TRUE                                                07170029
071800         WHEN DP020-FK-LOCAL-GOTO (DP020-SRC-AID)                 07180029
071900*       TRANSFER TO TROUBLE DETAIL SCREEN, TMLDETL                07190029
072000             MOVE ASC-NUMBER-OF-SELECTED-ITEMS                    07200029
072100                                 TO RC015-NUMBER-OF-SELECTED-ITEMS07210029
072200             MOVE ASC-KEY-PO-NBR-N                                07220029
072300                                 TO RC015-PO-NBR                  07230029
072400             MOVE ASC-KEY-REC-SEQ-NBR-N                           07240029
072500                                 TO RC015-REC-SEQ-NBR             07250029
072600             MOVE ASC-KEY-OPER-UNT-ID                             07260029
072700                                 TO RC015-OPER-UNT-ID             07270029
072800             MOVE ASC-KEY-FCLTY-ID                                07280029
072900                                 TO RC015-FCLTY-ID                07290029
073000             MOVE ASC-KEY-PKSL-LNE-NBR                            07300029
073100                                 TO RC015-PKSL-LNE-NBR            07310029
073200            MOVE ASC-KEY-CYC-NBR TO RC015-ADJ-CYC-NBR             07320029
073300          PERFORM 5000-PREPARE-SEL-QUEUE                          07330029
073400                                                                  07340029
073500         WHEN DP020-FK-FIRST-PAGE (DP020-SRC-AID)                 07350029
073600             MOVE +1             TO PV-TOP-ITEM                   07360029
073700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07370029
073800                                                                  07380029
073900         WHEN DP020-FK-PREV-PAGE (DP020-SRC-AID)                  07390029
074000             PERFORM 2110-BROWSE-BACKWARD                         07400029
074100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07410029
074200                                                                  07420029
074300         WHEN DP020-FK-NEXT-PAGE (DP020-SRC-AID)                  07430029
074400             PERFORM 2120-BROWSE-FORWARD                          07440029
074500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07450029
074600                                                                  07460029
074700         WHEN DP020-SRC-AID = DP016-ENTER                         07470029
074800                                                                  07480029
074900             PERFORM 2180-CHECK-FOR-JUMP-BROWSE                   07490029
075000                                                                  07500029
075100             IF PS-NO-ERROR                                       07510029
075200                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07520029
075300             END-IF                                               07530029
075400                                                                  07540029
075500         WHEN OTHER                                               07550029
075600             SET DP013-CICS-ABEND                                 07560029
075700                 DP013-NO-ROLLBACK                                07570029
075800                 DP013-XCTL-DISPLAY-RESTART                       07580029
075900                                 TO TRUE                          07590029
076000             MOVE '2100-CHECK-FUNCTION-KEY'                       07600029
076100                                 TO DP013-PARAGRAPH               07610029
076200             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      07620029
076300                                 TO DP013-MESSAGE-TEXT (1)        07630029
076400                                                                  07640029
076500             PERFORM DP013-0000-PROCESS-ABEND                     07650029
076600     END-EVALUATE.                                                07660029
076700                                                                  07670029
076800 2110-BROWSE-BACKWARD.                                            07680029
076900                                                                  07690029
077000     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    07700029
077100         GIVING PV-TOP-ITEM.                                      07710029
077200                                                                  07720029
077300     IF PV-TOP-ITEM NOT > +1                                      07730029
077400         MOVE +1                 TO PV-TOP-ITEM                   07740029
077500         MOVE PC-TSYMSG-00069    TO DP020-MSG-NUMBER              07750029
077600         SET DP020-MSG-INFORMATIONAL                              07760029
077700                                 TO TRUE.                         07770029
077800                                                                  07780029
077900 2120-BROWSE-FORWARD.                                             07790029
078000                                                                  07800029
078100     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              07810029
078200         GIVING PV-TOP-ITEM.                                      07820029
078300                                                                  07830029
078400     IF PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                    07840029
078500         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07850029
078600                                 TO PV-TOP-ITEM                   07860029
078700         MOVE PC-TSYMSG-00070    TO DP020-MSG-NUMBER              07870029
078800         SET DP020-MSG-INFORMATIONAL                              07880029
078900                                 TO TRUE                          07890029
079000     ELSE                                                         07900029
079100         COMPUTE PV-BOTTOM-ITEM =                                 07910029
079200             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 07920029
079300         IF PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ             07930029
079400             MOVE PC-TSYMSG-00070                                 07940029
079500                                 TO DP020-MSG-NUMBER              07950029
079600             SET DP020-MSG-INFORMATIONAL                          07960029
079700                                 TO TRUE.                         07970029
079800                                                                  07980029
079900 2180-CHECK-FOR-JUMP-BROWSE.                                      07990029
080000                                                                  08000029
080100     SET PS-NO-ERROR             TO TRUE.                         08010029
080200                                                                  08020029
080300     IF ASC-START-ITEM-REQUEST = SPACE                            08030029
080400         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08040029
080500                                 TO PV-TOP-ITEM                   08050029
080600     ELSE                                                         08060029
080700         MOVE ASC-START-ITEM-REQUEST                              08070029
080800                                 TO DP010I-UNEDITED-FIELD         08080029
080900         MOVE +5                 TO DP010I-MAXIMUM-DIGITS         08090029
081000         MOVE ZERO               TO DP010I-MAXIMUM-DECIMALS       08100029
081100         SET DP010I-NEGATIVE-NOT-ALLOWED                          08110029
081200                                 TO TRUE                          08120029
081300                                                                  08130029
081400         CALL DP010I-NUMERIC-EDIT-ROUTINE                         08140029
081500              USING DP010I-NUMERIC-EDIT-AREA                      08150029
081600                                                                  08160029
081700         IF NOT DP010I-ERROR-DETECTED                             08170029
081800             MOVE DP010I-NUMERIC-FIELD                            08180029
081900                                 TO ASC-START-ITEM-REQUEST-N      08190029
082000             IF ASC-START-ITEM-REQUEST-N > ZERO                   08200029
082100                IF ASC-START-ITEM-REQUEST-N >                     08210029
082200                                          ASC-NUMBER-OF-ITEMS-READ08220029
082300                    MOVE SPACE   TO ASC-START-ITEM-REQUEST        08230029
082400                    COMPUTE PV-TOP-ITEM = ASC-NUMBER-OF-ITEMS-READ08240029
082500                                          - PC-ITEMS-PER-PANEL + 108250029
082600                    IF PV-TOP-ITEM < +1                           08260029
082700                        MOVE +1  TO PV-TOP-ITEM                   08270029
082800                        MOVE PC-TSYMSG-00070                      08280029
082900                                 TO DP020-MSG-NUMBER              08290029
083000                        SET DP020-MSG-INFORMATIONAL               08300029
083100                                 TO TRUE                          08310029
083200                    END-IF                                        08320029
083300                ELSE                                              08330029
083400                    MOVE ASC-START-ITEM-REQUEST-N                 08340029
083500                                 TO PV-TOP-ITEM                   08350029
083600                    MOVE SPACE   TO ASC-START-ITEM-REQUEST        08360029
083700                    COMPUTE PV-BOTTOM-ITEM = PV-TOP-ITEM +        08370029
083800                                            PC-ITEMS-PER-PANEL - 108380029
083900                    IF PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ  08390029
084000                         MOVE PC-TSYMSG-00070                     08400029
084100                                 TO DP020-MSG-NUMBER              08410029
084200                         SET DP020-MSG-INFORMATIONAL              08420029
084300                                 TO TRUE                          08430029
084400                    END-IF                                        08440029
084500                END-IF                                            08450029
084600             ELSE                                                 08460029
084700* VALUE MUST BE GREATER THAN ZERO AND LESS THAN 1,000,000         08470029
084800                 MOVE PC-TSYMSG-00101                             08480029
084900                                 TO DP020-MSG-NUMBER              08490029
085000                 SET DP030-SET-CURSOR-APPL-1                      08500029
085100                                 TO TRUE                          08510029
085200                 MOVE -1         TO ASTRTITL                      08520029
085300                 MOVE DP015-UNP-NUM-BRT-MDT                       08530029
085400                                 TO ASTRTITA                      08540029
085500                 MOVE DP015-RED  TO ASTRTITC                      08550029
085600                 MOVE DP015-REVERSE                               08560029
085700                                 TO ASTRTITH                      08570029
085800                 SET PS-ERROR                                     08580029
085900                     DP020-MSG-FATAL                              08590029
086000                                 TO TRUE                          08600029
086100             END-IF                                               08610029
086200         ELSE                                                     08620029
086300             MOVE PC-TSYMSG-00008                                 08630029
086400                                 TO DP020-MSG-NUMBER              08640029
086500             SET DP030-SET-CURSOR-APPL-1                          08650029
086600                                 TO TRUE                          08660029
086700             MOVE -1             TO ASTRTITL                      08670029
086800             MOVE DP015-UNP-NUM-BRT-MDT                           08680029
086900                                 TO ASTRTITA                      08690029
087000             MOVE DP015-RED      TO ASTRTITC                      08700029
087100             MOVE DP015-REVERSE  TO ASTRTITH                      08710029
087200             SET PS-ERROR                                         08720029
087300                 DP020-MSG-FATAL TO TRUE                          08730029
087400         END-IF                                                   08740029
087500     END-IF.                                                      08750029
087600                                                                  08760029
087700                                                                  08770029
087800 2200-MOVE-SCREEN-TO-COMMAREA.                                    08780029
087900                                                                  08790029
088000     MOVE PV-TOP-ITEM            TO PV-ITEM-IN-USE.               08800029
088100     MOVE +1                     TO PV-SUB.                       08810029
088200                                                                  08820029
088300     PERFORM 3100-SET-SUBSCRIPTS.                                 08830029
088400                                                                  08840029
088500     IF ASTRTITL > ZERO                                           08850029
088600         MOVE ASTRTITI           TO ASC-START-ITEM-REQUEST        08860029
088700     ELSE                                                         08870029
088800         IF ASTRTITF = DP015-ERASE-EOF                            08880029
088900             INITIALIZE ASC-START-ITEM-REQUEST                    08890029
089000         END-IF                                                   08900029
089100     END-IF.                                                      08910029
089200     EJECT                                                        08920029
089300******************************************************************08930029
089400* GET THE KEYS OF THE NEXT SELECTED OBJECT FROM THE              *08940029
089500* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *08950029
089600******************************************************************08960029
089700 2300-GET-SELQUE-RECORD.                                          08970029
089800                                                                  08980029
089900     ADD +1                      TO ASC-SEL-SUB.                  08990029
090000                                                                  09000029
090100     IF ASC-SEL-SUB > RC013-MAX-ITEMS                             09010029
090200         ADD +1                  TO ASC-SEL-ITEM                  09020029
090300         MOVE +1                 TO ASC-SEL-SUB                   09030029
090400     END-IF.                                                      09040029
090500                                                                  09050029
090600     IF ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                 09060029
090700         PERFORM 9100-READ-SEL-QUEUE                              09070029
090800         IF RC013-ITEM (ASC-SEL-SUB) > ZERO                       09080029
090900             PERFORM 2320-LOAD-ASC-FROM-RC013                     09090029
091000             SET RC013-INQ (ASC-SEL-SUB)                          09100029
091100                                 TO TRUE                          09110029
091200             PERFORM 9200-REWRITE-LIST-QUEUE                      09120029
091300         ELSE                                                     09130029
091400             SUBTRACT +1 FROM ASC-SEL-SUB                         09140029
091500*            --- BOTTOM OF LIST ---                               09150029
091600             MOVE PC-TSYMSG-00070                                 09160029
091700                                 TO DP020-MSG-NUMBER              09170029
091800             SET DP020-MSG-INFORMATIONAL                          09180029
091900                                 TO TRUE                          09190029
092000         END-IF                                                   09200029
092100     ELSE                                                         09210029
092200         SUBTRACT +1 FROM ASC-SEL-ITEM                            09220029
092300         MOVE RC013-MAX-ITEMS    TO ASC-SEL-SUB                   09230029
092400         MOVE PC-TSYMSG-00070    TO DP020-MSG-NUMBER              09240029
092500         SET DP020-MSG-INFORMATIONAL                              09250029
092600                                 TO TRUE                          09260029
092700     END-IF.                                                      09270029
092800                                                                  09280029
092900/                                                                 09290029
093000******************************************************************09300029
093100* GET THE KEYS OF THE PREVIOUS SELECTED OBJECT FROM THE          *09310029
093200* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *09320029
093300******************************************************************09330029
093400 2310-GET-PREV-RECORD.                                            09340029
093500                                                                  09350029
093600     SUBTRACT +1 FROM ASC-SEL-SUB.                                09360029
093700                                                                  09370029
093800     IF ASC-SEL-SUB < +1                                          09380029
093900         SUBTRACT +1 FROM ASC-SEL-ITEM                            09390029
094000         MOVE RC013-MAX-ITEMS    TO ASC-SEL-SUB                   09400029
094100     END-IF.                                                      09410029
094200                                                                  09420029
094300     IF ASC-SEL-ITEM > ZERO                                       09430029
094400         PERFORM 9100-READ-SEL-QUEUE                              09440029
094500         PERFORM 2320-LOAD-ASC-FROM-RC013                         09450029
094600     ELSE                                                         09460029
094700         MOVE +1                 TO ASC-SEL-ITEM                  09470029
094800                                    ASC-SEL-SUB                   09480029
094900*        --- TOP OF LIST ---                                      09490029
095000         MOVE PC-TSYMSG-00069    TO DP020-MSG-NUMBER              09500029
095100         SET DP020-MSG-INFORMATIONAL                              09510029
095200                                 TO TRUE                          09520029
095300     END-IF.                                                      09530029
095400 2320-LOAD-ASC-FROM-RC013.                                        09540029
095500                                                                  09550029
095600     MOVE RC013-PKSL-LNE-NBR-N (ASC-SEL-SUB)                      09560029
095700                                 TO ASC-KEY-PKSL-LNE-NBR          09570029
095800                                    DK-PKSL-LNE-NBR               09580029
095900                                    RC015-PKSL-LNE-NBR            09590029
096000     MOVE RC013-ARRIVAL-DTE (ASC-SEL-SUB)                         09600029
096100                                 TO ASC-KEY-ADJ-DATE.             09610029
096200/                                                                 09620029
096300 3000-EDIT-DATA-IN-COMMAREA.                                      09630029
096400                                                                  09640029
096500     SET PS-NO-ERROR             TO TRUE.                         09650029
096600                                                                  09660029
096700     MOVE ASC-ITEMS-DISPLAYED    TO PV-SUB.                       09670029
096800     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       09680029
096900                                          ASC-ITEMS-DISPLAYED - 1.09690029
097000     PERFORM 3100-SET-SUBSCRIPTS.                                 09700029
097100                                                                  09710029
097200 3100-SET-SUBSCRIPTS.                                             09720029
097300                                                                  09730029
097400     COMPUTE ASC-ITEM-SUB =                                       09740029
097500                (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER (1 1)) + 1.09750029
097600                                                                  09760029
097700     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         09770029
097800         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            09780029
097900         MOVE PC-MAX-BLOCKS-IN-ARRAY                              09790029
098000                                 TO ASC-BLK-SUB                   09800029
098100     ELSE                                                         09810029
098200         MOVE +1                 TO ASC-BLK-SUB                   09820029
098300     END-IF.                                                      09830029
098400                                                                  09840029
098500                                                                  09850029
098600     EJECT                                                        09860029
098700 4000-BUILD-INITIAL-PANEL.                                        09870029
098800                                                                  09880029
098900     INITIALIZE ASC-BLOCK-ENTRIES (1)                             09890029
099000                ASC-BLOCK-ENTRIES (2).                            09900029
099100                                                                  09910029
099200     MOVE +1                     TO ASC-BLK-SUB.                  09920029
099300                                                                  09930029
099400     MOVE ZERO                   TO ASC-ITEM-SUB                  09940029
099500                                    ASC-NUMBER-OF-ITEMS-READ      09950029
099600                                    ASC-NUMBER-OF-SELECTED-ITEMS  09960029
099700                                    ASC-HIGHEST-BLOCK-WRITTEN     09970029
099800                                    ASC-START-OF-SELECTED-RANGE   09980029
099900                                    ASC-END-OF-SELECTED-RANGE     09990029
100000                                    ASC-ITEM-AT-TOP-OF-PANEL      10000029
100100                                                                  10010029
100200     MOVE ASC-KEY-PO-NBR-N       TO DK-PO-NBR.                    10020029
100300     MOVE ASC-KEY-REC-SEQ-NBR-N  TO DK-REC-SEQ-NBR.               10030029
100400     MOVE ASC-KEY-PKSL-LNE-NBR   TO DK-PKSL-LNE-NBR               10040029
100500     MOVE ASC-KEY-CYC-NBR        TO DK-CYC-NBR                    10050029
100600                                                                  10060029
100700     PERFORM 7100-OPEN-CURSOR.                                    10070029
100800     PERFORM 7110-FETCH-AURECD                                    10080029
100900                                                                  10090029
101000     IF ASC-ITEMS-LEFT-ON-DB                                      10100029
101100         PERFORM 4010-SCREEN-HEADER                               10110029
101200         MOVE AURECD-STR-NBR     TO PV-AURECD-STR-NBR             10120029
101300         MOVE AURECD-NOTIF-NBR   TO PV-NOTIF-NBR                  10130029
101400         PERFORM 4042-LINE-INFO                                   10140029
101500     END-IF                                                       10150029
101600                                                                  10160029
101700     PERFORM 4040-PROCESS-CURSOR                                  10170029
101800         VARYING PV-READ-COUNT  FROM 1 BY 1                       10180029
101900         UNTIL PV-READ-COUNT > PC-MAX-ITEMS OR                    10190029
102000             ASC-NO-ITEMS-LEFT-ON-DB                              10200029
102100                                                                  10210029
102200     PERFORM 4043-MOVE-QTYS                                       10220029
102300                                                                  10230029
102400     IF ASC-NUMBER-OF-ITEMS-READ > ZERO                           10240029
102500         MOVE +1                 TO ASC-BLK-SUB                   10250029
102600         PERFORM 5100-WRITE-TEMP-STORAGE                          10260029
102700         ADD +1                  TO ASC-BLK-SUB                   10270029
102800         PERFORM 5100-WRITE-TEMP-STORAGE                          10280029
102900         MOVE +1                 TO ASC-BLK-SUB                   10290029
103000                                    PV-BLOCK-NUMBER               10300029
103100         PERFORM 4410-READ-TEMP-STORAGE                           10310029
103200         IF ASC-HIGHEST-BLOCK-WRITTEN > 1                         10320029
103300             MOVE +2             TO ASC-BLK-SUB                   10330029
103400                                    PV-BLOCK-NUMBER               10340029
103500             PERFORM 4410-READ-TEMP-STORAGE                       10350029
103600         END-IF                                                   10360029
103700     END-IF.                                                      10370029
103800                                                                  10380029
103900     PERFORM 7120-CLOSE-CURSOR.                                   10390029
104000                                                                  10400029
104100     MOVE +1                     TO PV-TOP-ITEM.                  10410029
104200     SET DP030-SET-CURSOR-APPL-1 TO TRUE.                         10420029
104300     MOVE -1                     TO ASTRTITL                      10430029
104400     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        10440029
104500                                                                  10450029
104600*----------------------------------------------------------------*10460029
104700*                                               **   WR # 21361  *10470029
104800* ADDED CODE TO INCLUDE XLKUT001 LOGIC.                          *10480029
104900*----------------------------------------------------------------*10490029
105000 4010-SCREEN-HEADER.                                              10500029
105100     PERFORM 7000-GET-PO-INFO.                                    10510029
105200     PERFORM 7010-PURITM-HEADER-DATA                              10520029
105300         IF PURITM-ITM-NBR < 0                                    10530029
105400            MOVE '7010-PURITM-HEADER-DATA'                        10540029
105500                             TO DP013-PARAGRAPH                   10550029
105600            MOVE 'PUR-ITM-NBR IS LESS THAN ZERO'                  10560029
105700                             TO DP013-MESSAGE-TEXT (1)            10570029
105800            MOVE SQLCA       TO DP013-SQLCA                       10580029
105900            MOVE 'TPURITM' TO DP013-DB2-TABLE-NAME (1)            10590029
106000            MOVE 'TRECITM' TO DP013-DB2-TABLE-NAME (2)            10600029
106100            SET DP013-DB2-ABEND                                   10610029
106200                DP013-XCTL-DISPLAY-RESTART                        10620029
106300                             TO TRUE                              10630029
106400            PERFORM DP013-0000-PROCESS-ABEND                      10640029
106500         END-IF                                                   10650029
106600                                                                  10660029
106700         IF PURITM-ITM-NBR = 0                                    10670029
106800            IF PURITM-SKU-SEQ-NBR = PC-000                        10680029
106900               MOVE '00000000' TO PV-SKU-NBR                      10690029
107000            ELSE                                                  10700029
107100               IF PURITM-SKU-SEQ-NBR = PC-999                     10710029
107200                  MOVE '99999999' TO PV-SKU-NBR                   10720029
107300               ELSE                                               10730029
107400                  MOVE '7010-PURITM-HEADER-DATA'                  10740029
107500                               TO DP013-PARAGRAPH                 10750029
107600                  MOVE 'INVALID PURCHASE ITEM NUMBER'             10760029
107700                               TO DP013-MESSAGE-TEXT (1)          10770029
107800                  MOVE SQLCA      TO DP013-SQLCA                  10780029
107900                  MOVE 'TPURITM' TO DP013-DB2-TABLE-NAME (1)      10790029
108000                  MOVE 'TRECITM' TO DP013-DB2-TABLE-NAME (2)      10800029
108100                  SET DP013-DB2-ABEND                             10810029
108200                      DP013-XCTL-DISPLAY-RESTART                  10820029
108300                               TO TRUE                            10830029
108400                  PERFORM DP013-0000-PROCESS-ABEND                10840029
108500               END-IF                                             10850029
108600            END-IF                                                10860029
108700         END-IF                                                   10870029
108800                                                                  10880029
108900         IF PURITM-ITM-NBR > 0 AND                                10890029
109000            PS-CALL-API-YES    AND                                10900029
109100            ((PURITM-SKU-SEQ-NBR NOT = PC-000) AND                10910029
109200            (PURITM-SKU-SEQ-NBR NOT = PC-999))                    10920029
109300            PERFORM 4020-CALL-XLKUT-DOMAIN-PGM                    10930029
109400         END-IF                                                   10940029
109500     MOVE PURCHS-DEPT-NBR        TO PV-DEPT-NBR                   10950029
109600     MOVE PURITM-CL-NBR          TO PV-CLASS-NBR                  10960029
109700     MOVE PV-SKU-NBR             TO ASC-SKU-NBR                   10970029
109800     MOVE PV-DEPT-NBR            TO ASC-DEPT-NBR                  10980029
109900     MOVE PV-CLASS-NBR           TO ASC-CLS-NBR                   10990029
110000                                                                  11000029
110100     PERFORM 7040-GET-FACILITY-DESC.                              11010029
110200*----------------------------------------------------------------*11020029
110300* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *11030029
110400*----------------------------------------------------------------*11040029
110500/                                                                 11050029
110600*----------------------------------------------------------------*11060029
110700*                                               **   WR # 21361  *11070029
110800*  ADDERD NEW PARAGRAPH TO INCLUDE XLKUT001 LOGIC                *11080029
110900*----------------------------------------------------------------*11090029
111000 4020-CALL-XLKUT-DOMAIN-PGM.                                      11100029
111100            INITIALIZE XL001-ITEM-COMMAREA                        11110029
111200            MOVE PURITM-ITM-NBR   TO XL001-KEY-ITM-NBR            11120029
111300                                                                  11130029
111400            SET  XL001-BY-ITEM                                    11140029
111500                 XL001-SELECT-SKU TO TRUE                         11150029
111600                                                                  11160029
111700            CALL XL001-VSM-PGM USING  DFHEIBLK                    11170029
111800                                      XL001-COMMAREA              11180029
111900                                      XL001-ITEM-COMMAREA         11190029
112000                                                                  11200029
112100            EVALUATE TRUE                                         11210029
112200                                                                  11220029
112300                WHEN XL001-SKU-SQLCODE = +0                       11230029
112400                      MOVE XL001-SKU-NBR                          11240029
112500                                       TO  PV-SKU-NBR             11250029
112600                                                                  11260029
112700                WHEN XL001-SKU-SQLCODE = +100                     11270029
112800                      MOVE SPACES      TO  PV-SKU-NBR             11280029
112900                                                                  11290029
113000                WHEN XL001-SKU-CONTENTION                         11300029
113100                      MOVE '4020-CALL-XLKUT-DOMAIN-PGM'           11310029
113200                                       TO DP013-PARAGRAPH         11320029
113300                      MOVE 'SKU CONTENTION'                       11330029
113400                                       TO DP013-MESSAGE-TEXT (1)  11340029
113500                      MOVE XL001-SQLCA TO DP013-SQLCA             11350029
113600                      MOVE 'XLV_SKU' TO DP013-DB2-TABLE-NAME (1)  11360029
113700                      SET DP013-DB2-ABEND                         11370029
113800                           DP013-XCTL-DISPLAY-RESTART             11380029
113900                                       TO TRUE                    11390029
114000                      PERFORM DP013-0000-PROCESS-ABEND            11400029
114100                                                                  11410029
114200                WHEN OTHER                                        11420029
114300                      MOVE '4020-CALL-XLKUT-DOMAIN-PGM'           11430029
114400                                       TO DP013-PARAGRAPH         11440029
114500                      MOVE 'INVALID RETURN'                       11450029
114600                                       TO DP013-MESSAGE-TEXT (1)  11460029
114700                      MOVE 'XLV_SKU' TO DP013-DB2-TABLE-NAME (1)  11470029
114800                      MOVE XL001-SQLCA TO DP013-SQLCA             11480029
114900                      SET DP013-DB2-ABEND                         11490029
115000                          DP013-XCTL-DISPLAY-RESTART              11500029
115100                                       TO TRUE                    11510029
115200                      PERFORM DP013-0000-PROCESS-ABEND            11520029
115300            END-EVALUATE.                                         11530029
115400*----------------------------------------------------------------*11540029
115500* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *11550029
115600*----------------------------------------------------------------*11560029
115700 4040-PROCESS-CURSOR.                                             11570029
115800                                                                  11580029
115900     IF AURECD-STR-NBR = PV-AURECD-STR-NBR                        11590029
116000         PERFORM 4041-CALC-NET-CHANGES                            11600029
116100     ELSE                                                         11610029
116200         PERFORM 4043-MOVE-QTYS                                   11620029
116300         MOVE AURECD-STR-NBR     TO PV-AURECD-STR-NBR             11630029
116400         MOVE AURECD-NOTIF-NBR   TO PV-NOTIF-NBR                  11640029
116500         PERFORM 4042-LINE-INFO                                   11650029
116600         PERFORM 4041-CALC-NET-CHANGES                            11660029
116700     END-IF.                                                      11670029
116800                                                                  11680029
116900     PERFORM 7110-FETCH-AURECD.                                   11690029
117000                                                                  11700029
117100 4041-CALC-NET-CHANGES.                                           11710029
117200     EVALUATE AURECD-AUD-TYP-CDE                                  11720029
117300     WHEN 'A'                                                     11730029
117400         ADD AURECD-AP-VERIFY-ITM-QTY TO PV-SUM-UNIT-QTY          11740029
117500     WHEN 'B'                                                     11750029
117600         SUBTRACT AURECD-AP-VERIFY-ITM-QTY                        11760029
117700                                   FROM PV-SUM-UNIT-QTY           11770029
117800     END-EVALUATE.                                                11780029
117900                                                                  11790029
118000 4042-LINE-INFO.                                                  11800029
118100     PERFORM 4800-INCR-ASC-COMM-AREA                              11810029
118200     PERFORM 7020-PURITM-DETAIL-DATA                              11820029
118300                                                                  11830029
118400     MOVE AURECD-STR-NBR         TO ASC-STR-NBR                   11840029
118500                                   (ASC-BLK-SUB ASC-ITEM-SUB).    11850029
118600                                                                  11860029
118700 4043-MOVE-QTYS.                                                  11870029
118800     MOVE PV-NOTIF-NBR           TO ASC-NOTIF-NBR                 11880029
118900                                   (ASC-BLK-SUB ASC-ITEM-SUB)     11890029
119000     MOVE PV-SUM-UNIT-QTY        TO ASC-ADJ-QTY-N                 11900029
119100                                   (ASC-BLK-SUB ASC-ITEM-SUB)     11910029
119200     ADD PV-SUM-UNIT-QTY         TO PV-TOT-ADJ-QTY                11920029
119300     MOVE PV-TOT-ADJ-QTY         TO ASC-TOT-ADJUST-QTY            11930029
119400     MULTIPLY PV-SUM-UNIT-QTY BY PURITM-UNT-RTL-PR-AMT            11940029
119500                                 GIVING PV-ADJ-RETAIL-QTY         11950029
119600     MOVE PV-ADJ-RETAIL-QTY      TO ASC-ADJ-RETAIL-QTY-N          11960029
119700                                   (ASC-BLK-SUB ASC-ITEM-SUB)     11970029
119800     MULTIPLY PV-SUM-UNIT-QTY BY PURITM-UNT-COST-AMT              11980029
119900                                 GIVING PV-ADJ-COST               11990029
120000     MOVE PV-ADJ-COST            TO ASC-ADJ-COST-N                12000029
120100                                   (ASC-BLK-SUB ASC-ITEM-SUB)     12010029
120200     MOVE ZERO                   TO PV-SUM-UNIT-QTY               12020029
120300                                    PV-ADJ-RETAIL-QTY             12030029
120400                                    PV-ADJ-COST.                  12040029
120500*----------------------------------------------------------------*12050029
120600*                                               **   WR # 21361  *12060029
120700* ADDED CODE TO CHANGE THE SCREEN AS PER REQUIREMENT             *12070029
120800* MOVED DEPT NO, CLASS NO TO SCREEN                               12080029
120900*----------------------------------------------------------------*12090029
121000 4400-MOVE-COMMAREA-TO-SCREEN.                                    12100029
121100                                                                  12110029
121200     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1)) AND         12120029
121300           (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1))) OR         12130029
121400           (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))            12140029
121500             MOVE +1             TO ASC-BLK-SUB                   12150029
121600                                                                  12160029
121700             PERFORM 5100-WRITE-TEMP-STORAGE                      12170029
121800                                                                  12180029
121900             ADD +1              TO ASC-BLK-SUB                   12190029
122000                                                                  12200029
122100             PERFORM 5100-WRITE-TEMP-STORAGE                      12210029
122200                                                                  12220029
122300             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             12230029
122400                 GIVING PV-BLOCK-NUMBER                           12240029
122500                 REMAINDER PV-REMAINDER                           12250029
122600             IF PV-REMAINDER > ZERO                               12260029
122700                 ADD +1          TO PV-BLOCK-NUMBER               12270029
122800             END-IF                                               12280029
122900             MOVE +1             TO ASC-BLK-SUB                   12290029
123000                                                                  12300029
123100             PERFORM 4410-READ-TEMP-STORAGE                       12310029
123200                                                                  12320029
123300             ADD +1              TO ASC-BLK-SUB                   12330029
123400                                    PV-BLOCK-NUMBER               12340029
123500                                                                  12350029
123600             PERFORM 4410-READ-TEMP-STORAGE                       12360029
123700                                                                  12370029
123800     END-IF.                                                      12380029
123900                                                                  12390029
124000     MOVE +1                     TO ASC-BLK-SUB.                  12400029
124100     COMPUTE ASC-ITEM-SUB =                                       12410029
124200         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              12420029
124300                       + PC-ITEMS-PER-PANEL).                     12430029
124400                                                                  12440029
124500     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         12450029
124600         ADD +1                  TO ASC-BLK-SUB                   12460029
124700         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            12470029
124800     END-IF.                                                      12480029
124900                                                                  12490029
125000     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           12500029
125100         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                12510029
125200                                                                  12520029
125300     PERFORM 4420-FORMAT-LIST-LINES                               12530029
125400         VARYING PV-SUB  FROM PC-ITEMS-PER-PANEL BY -1            12540029
125500         UNTIL   PV-SUB < +1.                                     12550029
125600                                                                  12560029
125700     COMPUTE ASC-ITEMS-DISPLAYED =                                12570029
125800                   ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).12580029
125900     MOVE PV-TOP-ITEM            TO ASC-ITEM-AT-TOP-OF-PANEL      12590029
126000                                    ASTRTITO.                     12600029
126100     MOVE ASC-ITEM-AT-BOT-OF-PANEL                                12610029
126200                                 TO AENDITO.                      12620029
126300     MOVE ASC-NUMBER-OF-ITEMS-READ                                12630029
126400                                 TO ATOTITO.                      12640029
126500     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            12650029
126600                                 TO ASELITO.                      12660029
126700                                                                  12670029
126800     MOVE PC-DASH                TO ASC-KEY-REC-DASH.             12680029
126900     MOVE ASC-KEY-RECEIVER       TO ARCVRO.                       12690029
127000     MOVE ASC-KEY-PKSL-LNE-NBR   TO ALINEO.                       12700029
127100     MOVE ASC-KEY-OPER-UNT-ID    TO AOPERO.                       12710029
127200     MOVE ASC-KEY-FCLTY-ID       TO AFCLTYO.                      12720029
127300     MOVE ASC-KEY-FCLTY-DESC     TO AFDESCO.                      12730029
127400     MOVE ASC-KEY-ADJ-DATE       TO ADATEO                        12740029
127500                                                                  12750029
127600     MOVE ASC-TOT-ADJUST-QTY     TO AADJQTYO.                     12760029
127700                                                                  12770029
127800     MOVE ASC-SKU-NBR            TO ASKUO                         12780029
127900     MOVE ASC-DEPT-NBR           TO ADPTO                         12790029
128000     MOVE ASC-CLS-NBR            TO ACLO                          12800029
128100                                                                  12810029
128200     IF DP020-MSG-NUMBER-X = SPACE                                12820029
128300        IF ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ    12830029
128400            MOVE PC-TSYMSG-00279 TO DP020-MSG-NUMBER              12840029
128500            SET DP020-MSG-INFORMATIONAL                           12850029
128600                                 TO TRUE                          12860029
128700        END-IF                                                    12870029
128800     END-IF.                                                      12880029
128900*----------------------------------------------------------------*12890029
129000* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *12900029
129100*----------------------------------------------------------------*12910029
129200                                                                  12920029
129300 4410-READ-TEMP-STORAGE.                                          12930029
129400                                                                  12940029
129500     EXEC CICS READQ TS                                           12950029
129600               QUEUE (ASC-LIST-QUEUE-NAME)                        12960029
129700               INTO  (ASC-BLOCK-ENTRIES (ASC-BLK-SUB))            12970029
129800               ITEM  (PV-BLOCK-NUMBER)                            12980029
129900               RESP  (PV-CICS-RESP)                               12990029
130000     END-EXEC.                                                    13000029
130100                                                                  13010029
130200     IF ((PV-CICS-RESP = DFHRESP (NORMAL)) OR                     13020029
130300         (PV-CICS-RESP = DFHRESP (ITEMERR)))                      13030029
130400         CONTINUE                                                 13040029
130500     ELSE                                                         13050029
130600         SET DP013-CICS-ABEND                                     13060029
130700             DP013-NO-ROLLBACK   TO TRUE                          13070029
130800         MOVE '4410-READ-TEMP-STORAGE'                            13080029
130900                                 TO DP013-PARAGRAPH               13090029
131000         MOVE 'UNSUCCESSFUL LIST ITEMS TEMP STORAGE QUEUE READ'   13100029
131100                                 TO DP013-MESSAGE-TEXT (1)        13110029
131200                                                                  13120029
131300         PERFORM DP013-0000-PROCESS-ABEND                         13130029
131400     END-IF.                                                      13140029
131500                                                                  13150029
131600     SET ASC-BLOCK-NOT-MODIFIED (ASC-BLK-SUB)                     13160029
131700                                 TO TRUE.                         13170029
131800                                                                  13180029
131900     IF PV-CICS-RESP = DFHRESP (ITEMERR)                          13190029
132000         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               13200029
132100     END-IF.                                                      13210029
132200                                                                  13220029
132300 4420-FORMAT-LIST-LINES.                                          13230029
132400                                                                  13240029
132500     IF ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ       13250029
132600* BLANK OUT UNUSED LINES FROM PREVIOUS SCREEN                     13260029
132700         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                13270029
132800         MOVE SPACE              TO                               13280029
132900                                    MR-STORE         (PV-SUB)     13290029
133000                                    MR-ADJ-QTY       (PV-SUB)     13300029
133100                                    MR-ADJ-RETAIL-QTY             13310029
133200                                                 (PV-SUB)         13320029
133300                                    MR-ADJ-COST-QTY               13330029
133400                                                 (PV-SUB)         13340029
133500     ELSE                                                         13350029
133600         IF PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL            13360029
133700             MOVE ASC-STR-NBR (ASC-BLK-SUB ASC-ITEM-SUB)          13370029
133800                                 TO MR-STORE-NUMERIC (PV-SUB)     13380029
133900             MOVE ASC-ADJ-QTY-N (ASC-BLK-SUB ASC-ITEM-SUB)        13390029
134000                                 TO MR-ADJ-QTY-EDITED  (PV-SUB)   13400029
134100             MOVE ASC-ADJ-RETAIL-QTY-N (ASC-BLK-SUB ASC-ITEM-SUB) 13410029
134200                                 TO MR-ADJ-RETAIL-QTY-EDITED      13420029
134300                                                 (PV-SUB)         13430029
134400             MOVE ASC-ADJ-COST-N (ASC-BLK-SUB ASC-ITEM-SUB)       13440029
134500                                 TO MR-ADJ-COST-QTY-EDITED        13450029
134600                                                 (PV-SUB)         13460029
134700         END-IF                                                   13470029
134800     END-IF.                                                      13480029
134900                                                                  13490029
135000     SUBTRACT +1 FROM ASC-ITEM-SUB.                               13500029
135100                                                                  13510029
135200     IF ASC-ITEM-SUB < +1                                         13520029
135300         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  13530029
135400         MOVE +1                 TO ASC-BLK-SUB.                  13540029
135500                                                                  13550029
135600 4800-INCR-ASC-COMM-AREA.                                         13560029
135700                                                                  13570029
135800     IF ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                         13580029
135900         ADD +1                  TO ASC-ITEM-SUB                  13590029
136000     ELSE                                                         13600029
136100         ADD +1                  TO ASC-BLK-SUB                   13610029
136200         MOVE +1                 TO ASC-ITEM-SUB                  13620029
136300                                                                  13630029
136400         IF ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY                  13640029
136500             MOVE +1             TO ASC-BLK-SUB                   13650029
136600             SET ASC-BLOCK-MODIFIED (1)                           13660029
136700                                 TO TRUE                          13670029
136800                                                                  13680029
136900             PERFORM 5100-WRITE-TEMP-STORAGE                      13690029
137000                                                                  13700029
137100             MOVE ASC-BLOCK-ENTRIES       (PC-MAX-BLOCKS-IN-ARRAY)13710029
137200                                 TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB)13720029
137300             ADD +1              TO ASC-BLK-SUB                   13730029
137400             INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)           13740029
137500                 SET ASC-BLOCK-NOT-MODIFIED (ASC-BLK-SUB)         13750029
137600                                 TO TRUE                          13760029
137700             END-IF                                               13770029
137800         END-IF                                                   13780029
137900         ADD +1                  TO ASC-NUMBER-OF-ITEMS-READ      13790029
138000         MOVE ASC-NUMBER-OF-ITEMS-READ                            13800029
138100                                 TO ASC-LIST-ITEM-NUMBER          13810029
138200                                   (ASC-BLK-SUB ASC-ITEM-SUB).    13820029
138300                                                                  13830029
138400 5000-PREPARE-SEL-QUEUE.                                          13840029
138500                                                                  13850029
138600     MOVE +1                     TO ASC-BLK-SUB.                  13860029
138700     PERFORM 5100-WRITE-TEMP-STORAGE.                             13870029
138800     ADD +1                      TO ASC-BLK-SUB.                  13880029
138900     PERFORM 5100-WRITE-TEMP-STORAGE.                             13890029
139000                                                                  13900029
139100     PERFORM 5002-PREPARE-RC-QUEUE.                               13910029
139200                                                                  13920029
139300 5002-PREPARE-RC-QUEUE.                                           13930029
139400                                                                  13940029
139500     MOVE ASC-SEL-QUEUE-NAME-OUT TO RC015-SEL-QUEUE-NAME.         13950029
139600     PERFORM 6010-DELETE-SEL-QUEUE.                               13960029
139700                                                                  13970029
139800     SET ASC-UPDATE-TSQ          TO TRUE.                         13980029
139900     SET RC013-IDX               TO 1.                            13990029
140000     MOVE ZERO                   TO RC015-NUMBER-OF-TS-ITEMS.     14000029
140100     INITIALIZE RC013-SELECTED-ITEM-ARRAY.                        14010029
140200                                                                  14020029
140300     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           14030029
140400         VARYING PV-ITEM  FROM 1 BY 1                             14040029
140500         UNTIL PV-ITEM > ASC-HIGHEST-BLOCK-WRITTEN                14050029
140600                                                                  14060029
140700     IF RC013-IDX > 1                                             14070029
140800         PERFORM 5205-WRITE-SEL-QUEUE                             14080029
140900         ADD +1                  TO RC015-NUMBER-OF-TS-ITEMS      14090029
141000     END-IF.                                                      14100029
141100                                                                  14110029
141200 5100-WRITE-TEMP-STORAGE.                                         14120029
141300                                                                  14130029
141400     MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)                    14140029
141500                                 TO PV-LIST-ITEM-NUMBER.          14150029
141600     COMPUTE PV-BLOCK-NUMBER = 1 +                                14160029
141700                 ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).14170029
141800                                                                  14180029
141900     IF PV-BLOCK-NUMBER NOT > ASC-HIGHEST-BLOCK-WRITTEN           14190029
142000        IF ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                       14200029
142100                                                                  14210029
142200            PERFORM 5105-REWRITE-ASC-LISTQ                        14220029
142300                                                                  14230029
142400        END-IF                                                    14240029
142500     ELSE                                                         14250029
142600         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       14260029
142700                                     ASC-HIGHEST-BLOCK-WRITTEN + 114270029
142800         PERFORM 5110-WRITE-ASC-LISTQ                             14280029
142900                                                                  14290029
143000         ADD +1                  TO ASC-HIGHEST-BLOCK-WRITTEN     14300029
143100     END-IF.                                                      14310029
143200                                                                  14320029
143300     SET ASC-BLOCK-NOT-MODIFIED (ASC-BLK-SUB)                     14330029
143400                                 TO TRUE.                         14340029
143500                                                                  14350029
143600 5105-REWRITE-ASC-LISTQ.                                          14360029
143700                                                                  14370029
143800     EXEC CICS WRITEQ TS                                          14380029
143900               QUEUE   (ASC-LIST-QUEUE-NAME)                      14390029
144000               FROM    (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))           14400029
144100               ITEM    (PV-BLOCK-NUMBER)                          14410029
144200               REWRITE                                            14420029
144300               RESP    (PV-CICS-RESP)                             14430029
144400     END-EXEC.                                                    14440029
144500                                                                  14450029
144600     IF PV-CICS-RESP NOT = DFHRESP (NORMAL)                       14460029
144700         SET DP013-CICS-ABEND                                     14470029
144800             DP013-NO-ROLLBACK   TO TRUE                          14480029
144900         MOVE '5105-REWRITE-ASC-LISTQ'                            14490029
145000                                 TO DP013-PARAGRAPH               14500029
145100         MOVE 'UNSUCCESSFUL LIST ITEMS TEMP STORAGE QUEUE REWRITE'14510029
145200                                 TO DP013-MESSAGE-TEXT (1)        14520029
145300         PERFORM DP013-0000-PROCESS-ABEND                         14530029
145400     END-IF.                                                      14540029
145500                                                                  14550029
145600 5110-WRITE-ASC-LISTQ.                                            14560029
145700                                                                  14570029
145800     EXEC CICS WRITEQ TS                                          14580029
145900               QUEUE (ASC-LIST-QUEUE-NAME)                        14590029
146000               FROM  (ASC-BLOCK-ENTRIES (ASC-BLK-SUB))            14600029
146100               ITEM  (PV-BLOCK-NUMBER)                            14610029
146200               RESP  (PV-CICS-RESP)                               14620029
146300     END-EXEC.                                                    14630029
146400                                                                  14640029
146500     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      14650029
146600         SET DP013-CICS-ABEND                                     14660029
146700             DP013-NO-ROLLBACK   TO TRUE                          14670029
146800         MOVE '5110-WRITE-ASC-LISTQ'                              14680029
146900                                 TO DP013-PARAGRAPH               14690029
147000         MOVE 'UNSUCCESSFUL LIST ITEMS TEMP STORAGE QUEUE WRITE'  14700029
147100                                 TO DP013-MESSAGE-TEXT (1)        14710029
147200         PERFORM DP013-0000-PROCESS-ABEND                         14720029
147300     END-IF.                                                      14730029
147400/                                                                 14740029
147500 5200-FILL-SEL-QUEUE-RECORD.                                      14750029
147600                                                                  14760029
147700     PERFORM 6112-READ-LIST-QUEUE.                                14770029
147800                                                                  14780029
147900     IF PV-CICS-RESP = DFHRESP (NORMAL)                           14790029
148000         PERFORM                                                  14800029
148100         VARYING LQW-IDX  FROM 1 BY 1                             14810029
148200         UNTIL   LQW-IDX > PC-ITEMS-PER-PANEL OR                  14820029
148300                 LQW-LIST-ITEM-NUMBER (LQW-IDX) = ZERO            14830029
148400                 MOVE SPACE      TO RC013-ACTION-SW  (RC013-IDX)  14840029
148500                 SET RC013-IDX UP BY 1                            14850029
148600                 IF RC013-IDX > RC013-MAX-ITEMS                   14860029
148700                                                                  14870029
148800                     PERFORM 5205-WRITE-SEL-QUEUE                 14880029
148900                                                                  14890029
149000                     ADD +1      TO RC015-NUMBER-OF-TS-ITEMS      14900029
149100                     INITIALIZE RC013-SELECTED-ITEM-ARRAY         14910029
149200                     SET RC013-IDX                                14920029
149300                                 TO 1                             14930029
149400                 END-IF                                           14940029
149500         END-PERFORM                                              14950029
149600     END-IF.                                                      14960029
149700                                                                  14970029
149800 5205-WRITE-SEL-QUEUE.                                            14980029
149900                                                                  14990029
150000     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            15000029
150100                                 TO RC013-SELECTED-ITEMS.         15010029
150200                                                                  15020029
150300     EXEC CICS WRITEQ TS                                          15030029
150400               QUEUE (ASC-SEL-QUEUE-NAME-OUT)                     15040029
150500               FROM  (RC013-DC-SELECT-RECORD)                     15050029
150600               ITEM  (PV-SEL-QUEUE-ITEM)                          15060029
150700               RESP  (PV-CICS-RESP)                               15070029
150800     END-EXEC.                                                    15080029
150900                                                                  15090029
151000     IF PV-CICS-RESP NOT = DFHRESP (NORMAL)                       15100029
151100         SET DP013-CICS-ABEND                                     15110029
151200             DP013-NO-ROLLBACK   TO TRUE                          15120029
151300         MOVE '5205-WRITE-SEL-QUEUE'                              15130029
151400                                 TO DP013-PARAGRAPH               15140029
151500         MOVE 'UNSUCCESSFUL SEL ITEMS TEMP STORAGE QUEUE WRITE'   15150029
151600                                 TO DP013-MESSAGE-TEXT (1)        15160029
151700         PERFORM DP013-0000-PROCESS-ABEND                         15170029
151800     END-IF.                                                      15180029
151900/                                                                 15190029
152000 6000-REFRESH-PANEL-FROM-TEMP.                                    15200029
152100                                                                  15210029
152200     IF ASC-UPDATE-TSQ                                            15220029
152300         SET ASC-NO-TSQ-UPDATE   TO TRUE                          15230029
152400         MOVE ZERO               TO PV-SAVE-ITEM                  15240029
152500                                    PV-SEL-QUEUE-ITEM             15250029
152600         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        15260029
152700                                 TO PV-HOLD-SELECTED-ITEMS        15270029
152800         PERFORM 6100-UPDATE-TSQ                                  15280029
152900           UNTIL PV-ITEMS-PROCESSED > ASC-NUMBER-OF-SELECTED-ITEMS15290029
153000                                                                  15300029
153100         PERFORM 6010-DELETE-SEL-QUEUE                            15310029
153200                                                                  15320029
153300         INITIALIZE ASC-BLOCK-ENTRIES (1)                         15330029
153400                    ASC-BLOCK-ENTRIES (2)                         15340029
153500                                                                  15350029
153600         DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                 15360029
153700                GIVING    PV-BLOCK-NUMBER                         15370029
153800                REMAINDER PV-REMAINDER                            15380029
153900                                                                  15390029
154000         IF PV-REMAINDER > ZERO                                   15400029
154100             ADD +1              TO PV-BLOCK-NUMBER               15410029
154200         END-IF                                                   15420029
154300                                                                  15430029
154400         MOVE +1                 TO ASC-BLK-SUB                   15440029
154500                                                                  15450029
154600         PERFORM 4410-READ-TEMP-STORAGE                           15460029
154700                                                                  15470029
154800         ADD +1                  TO ASC-BLK-SUB                   15480029
154900                            PV-BLOCK-NUMBER                       15490029
155000         PERFORM 4410-READ-TEMP-STORAGE                           15500029
155100                                                                  15510029
155200     END-IF.                                                      15520029
155300                                                                  15530029
155400 6010-DELETE-SEL-QUEUE.                                           15540029
155500                                                                  15550029
155600     EXEC CICS DELETEQ TS                                         15560029
155700               QUEUE (ASC-SEL-QUEUE-NAME-OUT)                     15570029
155800               RESP  (PV-CICS-RESP)                               15580029
155900     END-EXEC.                                                    15590029
156000                                                                  15600029
156100     IF ((PV-CICS-RESP = DFHRESP (NORMAL)) OR                     15610029
156200         (PV-CICS-RESP = DFHRESP (QIDERR)))                       15620029
156300         CONTINUE                                                 15630029
156400     ELSE                                                         15640029
156500         SET DP013-CICS-ABEND                                     15650029
156600             DP013-NO-ROLLBACK   TO TRUE                          15660029
156700         MOVE '6010-DELETE-SEL-QUEUE'                             15670029
156800                                 TO DP013-PARAGRAPH               15680029
156900         MOVE 'UNSUCCESSFUL SEL ITEMS TEMP STORAGE QUEUE DELETE'  15690029
157000                                 TO DP013-MESSAGE-TEXT (1)        15700029
157100         PERFORM DP013-0000-PROCESS-ABEND                         15710029
157200     END-IF.                                                      15720029
157300                                                                  15730029
157400 6100-UPDATE-TSQ.                                                 15740029
157500                                                                  15750029
157600     ADD 1                       TO PV-SEL-QUEUE-ITEM.            15760029
157700                                                                  15770029
157800     PERFORM 6105-READ-SEL-QUEUE.                                 15780029
157900                                                                  15790029
158000     PERFORM                                                      15800029
158100     VARYING RC013-IDX  FROM 1 BY 1                               15810029
158200     UNTIL   PV-ITEMS-PROCESSED > PV-HOLD-SELECTED-ITEMS OR       15820029
158300             RC013-IDX > RC013-MAX-ITEMS                          15830029
158400                                                                  15840029
158500         IF RC013-ACTION-SW (RC013-IDX) > SPACE                   15850029
158600            PERFORM 6110-PROCESS-ITEMS                            15860029
158700            SET PS-WRITE-LIST-QUEUE                               15870029
158800                                 TO TRUE                          15880029
158900         END-IF                                                   15890029
159000                                                                  15900029
159100         ADD +1                  TO PV-ITEMS-PROCESSED            15910029
159200     END-PERFORM.                                                 15920029
159300                                                                  15930029
159400     IF PS-WRITE-LIST-QUEUE                                       15940029
159500         PERFORM 6111-WRITE-LIST-QUEUE                            15950029
159600     END-IF.                                                      15960029
159700                                                                  15970029
159800                                                                  15980029
159900 6105-READ-SEL-QUEUE.                                             15990029
160000                                                                  16000029
160100     EXEC CICS READQ TS                                           16010029
160200               QUEUE (ASC-SEL-QUEUE-NAME-OUT)                     16020029
160300               INTO  (RC013-DC-SELECT-RECORD)                     16030029
160400               ITEM  (PV-SEL-QUEUE-ITEM)                          16040029
160500               RESP  (PV-CICS-RESP)                               16050029
160600     END-EXEC.                                                    16060029
160700                                                                  16070029
160800     IF PV-CICS-RESP NOT = DFHRESP (NORMAL)                       16080029
160900         SET DP013-CICS-ABEND                                     16090029
161000             DP013-NO-ROLLBACK   TO TRUE                          16100029
161100         MOVE '6105-READ-SEL-QUEUE'                               16110029
161200                                 TO DP013-PARAGRAPH               16120029
161300         MOVE 'UNSUCCESSFUL SEL ITEMS TEMP STORAGE QUEUE READ'    16130029
161400                                 TO DP013-MESSAGE-TEXT (1)        16140029
161500         PERFORM DP013-0000-PROCESS-ABEND                         16150029
161600     END-IF.                                                      16160029
161700                                                                  16170029
161800 6110-PROCESS-ITEMS.                                              16180029
161900                                                                  16190029
162000     COMPUTE PV-ITEM = 1 + ((RC013-ITEM (RC013-IDX) - 1)          16200029
162100                                            / PC-ITEMS-PER-PANEL).16210029
162200                                                                  16220029
162300     IF PV-ITEM NOT = PV-SAVE-ITEM                                16230029
162400        IF PV-SAVE-ITEM NOT = ZERO                                16240029
162500                                                                  16250029
162600            PERFORM 6111-WRITE-LIST-QUEUE                         16260029
162700                                                                  16270029
162800        END-IF                                                    16280029
162900        MOVE PV-ITEM             TO PV-SAVE-ITEM                  16290029
163000                                                                  16300029
163100        PERFORM 6112-READ-LIST-QUEUE                              16310029
163200                                                                  16320029
163300     END-IF.                                                      16330029
163400                                                                  16340029
163500     COMPUTE PV-SUB = (RC013-ITEM (RC013-IDX) -                   16350029
163600                                    LQW-LIST-ITEM-NUMBER (1)) + 1.16360029
163700                                                                  16370029
163800     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                16380029
163900                                                                  16390029
164000 6111-WRITE-LIST-QUEUE.                                           16400029
164100                                                                  16410029
164200     EXEC CICS WRITEQ TS                                          16420029
164300               QUEUE (ASC-LIST-QUEUE-NAME)                        16430029
164400               FROM  (LQW-LIST-QUEUE-WORK-AREA)                   16440029
164500               ITEM  (PV-SAVE-ITEM)                               16450029
164600               REWRITE                                            16460029
164700               RESP  (PV-CICS-RESP)                               16470029
164800     END-EXEC.                                                    16480029
164900                                                                  16490029
165000     IF PV-CICS-RESP NOT = DFHRESP (NORMAL)                       16500029
165100         SET DP013-CICS-ABEND                                     16510029
165200             DP013-NO-ROLLBACK   TO TRUE                          16520029
165300         MOVE '6111-WRITE-LIST-QUEUE'                             16530029
165400                                 TO DP013-PARAGRAPH               16540029
165500         MOVE 'UNSUCCESSFUL LIST ITEMS TEMP STORAGE QUEUE REWRITE'16550029
165600                                 TO DP013-MESSAGE-TEXT(1)         16560029
165700         PERFORM DP013-0000-PROCESS-ABEND                         16570029
165800     END-IF.                                                      16580029
165900                                                                  16590029
166000 6112-READ-LIST-QUEUE.                                            16600029
166100                                                                  16610029
166200     EXEC CICS READQ TS                                           16620029
166300               QUEUE (ASC-LIST-QUEUE-NAME)                        16630029
166400               INTO  (LQW-LIST-QUEUE-WORK-AREA)                   16640029
166500               ITEM  (PV-ITEM)                                    16650029
166600               RESP  (PV-CICS-RESP)                               16660029
166700     END-EXEC.                                                    16670029
166800                                                                  16680029
166900     IF PV-CICS-RESP NOT = DFHRESP (NORMAL)                       16690029
167000         SET DP013-CICS-ABEND                                     16700029
167100             DP013-NO-ROLLBACK   TO TRUE                          16710029
167200         MOVE '6112-READ-LIST-QUEUE'                              16720029
167300                                 TO DP013-PARAGRAPH               16730029
167400         MOVE 'UNSUCCESSFUL LIST ITEMS TEMP STORAGE QUEUE READ'   16740029
167500                                 TO DP013-MESSAGE-TEXT(1)         16750029
167600         PERFORM DP013-0000-PROCESS-ABEND                         16760029
167700     END-IF.                                                      16770029
167800                                                                  16780029
167900******************************************************************16790029
168000* DELETE THE LIST QUEUE WHEN PREV-SEL OR NEXT-SEL WAS ENTERED.   *16800029
168100******************************************************************16810029
168200 6200-DEL-LIST-QUEUE.                                             16820029
168300                                                                  16830029
168400     EXEC CICS                                                    16840029
168500         DELETEQ TS                                               16850029
168600             QUEUE (ASC-LIST-QUEUE-NAME)                          16860029
168700             RESP  (PV-CICS-RESP)                                 16870029
168800     END-EXEC.                                                    16880029
168900                                                                  16890029
169000     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      16900029
169100        (PV-CICS-RESP = DFHRESP(QIDERR)))                         16910029
169200         CONTINUE                                                 16920029
169300     ELSE                                                         16930029
169400        SET DP013-CICS-ABEND     TO TRUE                          16940029
169500        SET DP013-NO-ROLLBACK    TO TRUE                          16950029
169600        MOVE '6200-DEL-LIST-QUEUE'                                16960029
169700                                 TO DP013-PARAGRAPH               16970029
169800        MOVE 'ERROR TRYING TO DELETE LIST TS QUEUE'               16980029
169900                                 TO DP013-MESSAGE-TEXT (1)        16990029
170000        PERFORM DP013-0000-PROCESS-ABEND                          17000029
170100     END-IF.                                                      17010029
170200/                                                                 17020029
170300 7000-GET-PO-INFO.                                                17030029
170400                                                                  17040029
170500     EXEC SQL                                                     17050029
170600          SELECT A.DEPT_NBR                                       17060029
170700            INTO :PURCHS-DEPT-NBR                                 17070029
170800            FROM TPURCHS A                                        17080029
170900           WHERE A.VER_STATUS_CDE = :PC-A                         17090029
171000             AND A.PO_NBR             = :DK-PO-NBR                17100029
171100     END-EXEC                                                     17110029
171200                                                                  17120029
171300     EVALUATE TRUE                                                17130029
171400         WHEN SQLCODE = ZERO                                      17140029
171500             CONTINUE                                             17150029
171600         WHEN SQLCODE = +100                                      17160029
171700            MOVE  SPACES TO PURCHS-DEPT-NBR                       17170029
171800         WHEN SQLCODE = -904                                      17180029
171900         WHEN SQLCODE = -911                                      17190029
172000         WHEN SQLCODE = -913                                      17200029
172100             PERFORM 9900-SOFT-ABORT                              17210029
172200         WHEN SQLWARN0 NOT = SPACES                               17220029
172300         WHEN SQLCODE      NOT = ZERO                             17230029
172400             MOVE '7000-GET-PO-INFO'                              17240029
172500                             TO DP013-PARAGRAPH                   17250029
172600             MOVE 'UNSUCCESSFUL SELECT OF VENDOR NAME'            17260029
172700                             TO DP013-MESSAGE-TEXT (1)            17270029
172800             MOVE SQLCA         TO DP013-SQLCA                    17280029
172900             MOVE 'TPURCHS' TO DP013-DB2-TABLE-NAME (1)           17290029
173000             SET DP013-DB2-ABEND                                  17300029
173100                  DP013-XCTL-DISPLAY-RESTART                      17310029
173200                             TO TRUE                              17320029
173300             PERFORM DP013-0000-PROCESS-ABEND                     17330029
173400     END-EVALUATE.                                                17340029
173500/                                                                 17350029
173600*----------------------------------------------------------------*17360029
173700*                                               **   WR # 21361  *17370029
173800* ADDED CODE TO INCLUDE ITM_NBR IN THE SELECT FROM TPURITM       *17380029
173900*----------------------------------------------------------------*17390029
174000 7010-PURITM-HEADER-DATA.                                         17400029
174100                                                                  17410029
174200     SET PS-CALL-API-NO TO TRUE.                                  17420029
174300     EXEC SQL                                                     17430029
174400           SELECT A.CL_NBR                                        17440029
174500                , A.SKU_SEQ_NBR                                   17450029
174600                , A.ITM_NBR                                       17460029
174700             INTO :PURITM-CL-NBR                                  17470029
174800                , :PURITM-SKU-SEQ-NBR                             17480029
174900                , :PURITM-ITM-NBR                                 17490029
175000             FROM TPURITM A                                       17500029
175100                , TRECITM B                                       17510029
175200            WHERE A.PO_NBR         = :DK-PO-NBR                   17520029
175300              AND A.PO_NBR         = B.ORD_NBR                    17530029
175400                                                                  17540029
175500              AND A.APP_PO_LNE_NBR = :DK-PKSL-LNE-NBR             17550029
175600              AND A.APP_PO_LNE_NBR = B.ORD_LNE_NBR                17560029
175700                                                                  17570029
175800              AND B.REC_SEQ_NBR    = :AURECD-REC-SEQ-NBR          17580029
175900                                                                  17590029
176000              AND B.VER_STATUS_CDE = :PC-A                        17600029
176100              AND A.VER_NBR        = B.PO_VER_NBR                 17610029
176200     END-EXEC                                                     17620029
176300                                                                  17630029
176400     EVALUATE TRUE                                                17640029
176500         WHEN SQLCODE = ZERO                                      17650029
176600             SET PS-CALL-API-YES TO TRUE                          17660029
176700         WHEN SQLCODE = +100                                      17670029
176800              CONTINUE                                            17680029
176900     WHEN SQLCODE = -904                                          17690029
177000     WHEN SQLCODE = -911                                          17700029
177100     WHEN SQLCODE = -913                                          17710029
177200         PERFORM 9900-SOFT-ABORT                                  17720029
177300         WHEN SQLWARN0 NOT = SPACES                               17730029
177400         WHEN SQLCODE      NOT = ZERO                             17740029
177500              MOVE '7010-PURITM-DETAIL-DATA'                      17750029
177600                             TO DP013-PARAGRAPH                   17760029
177700              MOVE 'UNSUCCESSFUL SELECT OF PURITM'                17770029
177800                             TO DP013-MESSAGE-TEXT (1)            17780029
177900              MOVE SQLCA         TO DP013-SQLCA                   17790029
178000              MOVE 'TPURITM' TO DP013-DB2-TABLE-NAME (1)          17800029
178100              MOVE 'TRECITM' TO DP013-DB2-TABLE-NAME (2)          17810029
178200              SET DP013-DB2-ABEND                                 17820029
178300                  DP013-XCTL-DISPLAY-RESTART                      17830029
178400                             TO TRUE                              17840029
178500                                                                  17850029
178600              PERFORM DP013-0000-PROCESS-ABEND                    17860029
178700     END-EVALUATE.                                                17870029
178800/                                                                 17880029
178900*----------------------------------------------------------------*17890029
179000* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *17900029
179100*----------------------------------------------------------------*17910029
179200 7020-PURITM-DETAIL-DATA.                                         17920029
179300                                                                  17930029
179400     EXEC SQL                                                     17940029
179500           SELECT A.UNT_RTL_PR_AMT                                17950029
179600                , A.UNT_COST_AMT                                  17960029
179700             INTO :PURITM-UNT-RTL-PR-AMT                          17970029
179800                , :PURITM-UNT-COST-AMT                            17980029
179900             FROM TPURITM A                                       17990029
180000                , TRECITM B                                       18000029
180100            WHERE A.PO_NBR         = :DK-PO-NBR                   18010029
180200              AND A.PO_NBR         = B.ORD_NBR                    18020029
180300                                                                  18030029
180400              AND A.APP_PO_LNE_NBR = :DK-PKSL-LNE-NBR             18040029
180500              AND A.APP_PO_LNE_NBR = B.ORD_LNE_NBR                18050029
180600                                                                  18060029
180700              AND B.REC_SEQ_NBR    = :AURECD-REC-SEQ-NBR          18070029
180800                                                                  18080029
180900              AND B.VER_STATUS_CDE = :PC-A                        18090029
181000              AND A.VER_NBR        = B.PO_VER_NBR                 18100029
181100     END-EXEC                                                     18110029
181200                                                                  18120029
181300     EVALUATE TRUE                                                18130029
181400         WHEN SQLCODE = ZERO                                      18140029
181500             CONTINUE                                             18150029
181600         WHEN SQLCODE = +100                                      18160029
181700              CONTINUE                                            18170029
181800     WHEN SQLCODE = -904                                          18180029
181900     WHEN SQLCODE = -911                                          18190029
182000     WHEN SQLCODE = -913                                          18200029
182100         PERFORM 9900-SOFT-ABORT                                  18210029
182200         WHEN SQLWARN0 NOT = SPACES                               18220029
182300         WHEN SQLCODE      NOT = ZERO                             18230029
182400              MOVE '7010-PURITM-HEADER-DATA'                      18240029
182500                             TO DP013-PARAGRAPH                   18250029
182600              MOVE 'UNSUCCESSFUL SELECT OF PURITM'                18260029
182700                             TO DP013-MESSAGE-TEXT (1)            18270029
182800              MOVE SQLCA         TO DP013-SQLCA                   18280029
182900              MOVE 'TPURITM' TO DP013-DB2-TABLE-NAME (1)          18290029
183000              MOVE 'TRECITM' TO DP013-DB2-TABLE-NAME (1)          18300029
183100              SET DP013-DB2-ABEND                                 18310029
183200                  DP013-XCTL-DISPLAY-RESTART                      18320029
183300                             TO TRUE                              18330029
183400                                                                  18340029
183500              PERFORM DP013-0000-PROCESS-ABEND                    18350029
183600     END-EVALUATE.                                                18360029
183700                                                                  18370029
183800******************************************************            18380029
183900 7040-GET-FACILITY-DESC.                                          18390029
184000                                                                  18400029
184100     INITIALIZE XL071-COMMAREA-REC.                               18410029
184200     MOVE ASC-KEY-OPER-UNT-ID    TO XL071-LOCATION-NUMBER.        18420029
184300                                                                  18430029
184400     CALL PC-LOCATION-MODULE  USING                               18440029
184500                                    DFHEIBLK                      18450029
184600                                    XL071-COMMAREA                18460029
184700                                    XL071-COMMAREA-REC.           18470029
184800     EVALUATE TRUE                                                18480029
184900         WHEN XL071-NO-ERRORS                                     18490029
185000             MOVE XL071-LOC-NM  TO  ASC-KEY-FCLTY-DESC            18500029
185100         WHEN XL071-LOC-NOT-FOUND                                 18510029
185200             MOVE SPACES        TO  ASC-KEY-FCLTY-DESC            18520029
185300         WHEN XL071-BAD-DB2-RETURN                                18530029
185400             MOVE '7040-GET-FACILITY-DESC'   TO DP013-PARAGRAPH   18540029
185500             MOVE 'SELECT FACILITY DESC' TO DP013-MESSAGE-TEXT (1)18550029
185600             MOVE SQLCA        TO DP013-SQLCA                     18560029
185700             MOVE 'XLT_LOC'    TO DP013-DB2-TABLE-NAME (1)        18570029
185800             SET DP013-DB2-ABEND             TO TRUE              18580029
185900             SET DP013-XCTL-DISPLAY-RESTART  TO TRUE              18590029
186000             PERFORM DP013-0000-PROCESS-ABEND                     18600029
186100     END-EVALUATE.                                                18610029
186200                                                                  18620029
186300 7100-OPEN-CURSOR.                                                18630029
186400                                                                  18640029
186500     EXEC SQL                                                     18650029
186600          OPEN TAURECD-CURSOR                                     18660029
186700     END-EXEC                                                     18670029
186800                                                                  18680029
186900     EVALUATE TRUE                                                18690029
187000         WHEN SQLCODE = ZERO                                      18700029
187100              CONTINUE                                            18710029
187200         WHEN SQLCODE = -904                                      18720029
187300         WHEN SQLCODE = -911                                      18730029
187400         WHEN SQLCODE = -913                                      18740029
187500             PERFORM 9900-SOFT-ABORT                              18750029
187600         WHEN SQLWARN0 NOT = SPACES                               18760029
187700         WHEN SQLCODE      NOT = ZERO                             18770029
187800              MOVE '7100-OPEN-CURSOR'                             18780029
187900                             TO DP013-PARAGRAPH                   18790029
188000              MOVE 'UNSUCCESSFUL RECDIS CURSOR OPEN'              18800029
188100                             TO DP013-MESSAGE-TEXT (1)            18810029
188200              MOVE SQLCA         TO DP013-SQLCA                   18820029
188300              MOVE 'TAURECD' TO DP013-DB2-TABLE-NAME (1)          18830029
188400              SET DP013-XCTL-DISPLAY-RESTART                      18840029
188500                  DP013-DB2-ABEND                                 18850029
188600                             TO TRUE                              18860029
188700                                                                  18870029
188800              PERFORM DP013-0000-PROCESS-ABEND                    18880029
188900     END-EVALUATE.                                                18890029
189000/                                                                 18900029
189100 7110-FETCH-AURECD.                                               18910029
189200                                                                  18920029
189300     EXEC SQL                                                     18930029
189400          FETCH  TAURECD-CURSOR                                   18940029
189500         INTO                                                     18950029
189600              :AURECD-STR-NBR                                     18960029
189700            , :AURECD-REC-SEQ-NBR                                 18970029
189800            , :AURECD-UPD-TMST                                    18980029
189900            , :AURECD-AUD-TYP-CDE                                 18990029
190000            , :AURECD-AP-VERIFY-ITM-QTY                           19000029
190100            , :AURECD-NOTIF-NBR                                   19010029
190200     END-EXEC.                                                    19020029
190300                                                                  19030029
190400     EVALUATE TRUE                                                19040029
190500         WHEN SQLCODE = ZERO                                      19050029
190600             SET ASC-ITEMS-LEFT-ON-DB TO TRUE                     19060029
190700         WHEN SQLCODE = +100                                      19070029
190800             SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                  19080029
190900         WHEN SQLCODE = -904                                      19090029
191000         WHEN SQLCODE = -911                                      19100029
191100         WHEN SQLCODE = -913                                      19110029
191200             PERFORM 9900-SOFT-ABORT                              19120029
191300         WHEN SQLWARN0 NOT = SPACES                               19130029
191400         WHEN SQLCODE  NOT = ZERO                                 19140029
191500              MOVE '7110-FETCH-AURECD'                            19150029
191600                                 TO DP013-PARAGRAPH               19160029
191700              MOVE 'UNSUCCESSFUL FETCH OF RECDIS CURSOR'          19170029
191800                                 TO DP013-MESSAGE-TEXT (1)        19180029
191900              MOVE SQLCA         TO DP013-SQLCA                   19190029
192000              MOVE 'TAURECD'     TO DP013-DB2-TABLE-NAME (1)      19200029
192100              SET DP013-DB2-ABEND                                 19210029
192200                  DP013-XCTL-DISPLAY-RESTART                      19220029
192300                                 TO TRUE                          19230029
192400                                                                  19240029
192500              PERFORM DP013-0000-PROCESS-ABEND                    19250029
192600     END-EVALUATE.                                                19260029
192700/                                                                 19270029
192800 7120-CLOSE-CURSOR.                                               19280029
192900                                                                  19290029
193000     EXEC SQL                                                     19300029
193100          CLOSE TAURECD-CURSOR                                    19310029
193200     END-EXEC.                                                    19320029
193300                                                                  19330029
193400     EVALUATE TRUE                                                19340029
193500         WHEN SQLCODE = ZERO                                      19350029
193600              CONTINUE                                            19360029
193700         WHEN SQLCODE = -904                                      19370029
193800         WHEN SQLCODE = -911                                      19380029
193900         WHEN SQLCODE = -913                                      19390029
194000             PERFORM 9900-SOFT-ABORT                              19400029
194100         WHEN SQLWARN0 NOT = SPACES                               19410029
194200         WHEN SQLCODE  NOT = ZERO                                 19420029
194300              MOVE '7120-CLOSE-CURSOR'                            19430029
194400                                 TO DP013-PARAGRAPH               19440029
194500              MOVE 'UNSUCCESSFUL RECDIS CURSOR CLOSE'             19450029
194600                                 TO DP013-MESSAGE-TEXT (1)        19460029
194700              MOVE SQLCA         TO DP013-SQLCA                   19470029
194800              MOVE 'TAURECD '    TO DP013-DB2-TABLE-NAME (1)      19480029
194900              SET DP013-DB2-ABEND                                 19490029
195000                  DP013-XCTL-DISPLAY-RESTART                      19500029
195100                                 TO TRUE                          19510029
195200                                                                  19520029
195300              PERFORM DP013-0000-PROCESS-ABEND                    19530029
195400     END-EVALUATE.                                                19540029
195500/                                                                 19550029
195600******************************************************************19560029
195700* RECORD IN THE SELECTION TEMP STORAGE QUEUE THE FACT THAT THIS  *19570029
195800* OBJECT WAS UPDATED.                                            *19580029
195900******************************************************************19590029
196000 9000-UPDATE-SELECTION-QUEUE.                                     19600029
196100                                                                  19610029
196200     PERFORM 9100-READ-SEL-QUEUE                                  19620029
196300                                                                  19630029
196400     SET RC013-INQ (ASC-SEL-SUB) TO TRUE                          19640029
196500     PERFORM 9200-REWRITE-LIST-QUEUE.                             19650029
196600                                                                  19660029
196700/                                                                 19670029
196800******************************************************************19680029
196900* READ AN ITEM FROM THE INPUT SELECTED ITEMS TEMP STORAGE QUEUE. *19690029
197000******************************************************************19700029
197100 9100-READ-SEL-QUEUE.                                             19710029
197200                                                                  19720029
197300     EXEC CICS                                                    19730029
197400         READQ TS                                                 19740029
197500             QUEUE (ASC-SEL-QUEUE-NAME-IN)                        19750029
197600             INTO  (RC013-DC-SELECT-RECORD)                       19760029
197700             ITEM  (ASC-SEL-ITEM)                                 19770029
197800             RESP  (PV-CICS-RESP)                                 19780029
197900     END-EXEC.                                                    19790029
198000                                                                  19800029
198100     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        19810029
198200         CONTINUE                                                 19820029
198300     ELSE                                                         19830029
198400         SET DP013-LOGIC-ABEND                                    19840029
198500             DP013-NO-ROLLBACK   TO TRUE                          19850029
198600         MOVE '9100-READ-SEL-QUEUE'                               19860029
198700                                 TO DP013-PARAGRAPH               19870029
198800         MOVE 'ATTEMPTING TO READ TO LIST SELECTIONS TS QUEUE'    19880029
198900                                 TO DP013-MESSAGE-TEXT (1)        19890029
199000         PERFORM DP013-0000-PROCESS-ABEND                         19900029
199100     END-IF.                                                      19910029
199200                                                                  19920029
199300/                                                                 19930029
199400******************************************************************19940029
199500* UPDATE AN ITEM IN THE INPUT SELECTED ITEMS TEMP STORAGE QUEUE. *19950029
199600******************************************************************19960029
199700 9200-REWRITE-LIST-QUEUE.                                         19970029
199800     EXEC CICS                                                    19980029
199900          WRITEQ TS                                               19990029
200000              QUEUE   (ASC-SEL-QUEUE-NAME-IN)                     20000029
200100              FROM    (RC013-DC-SELECT-RECORD)                    20010029
200200              ITEM    (ASC-SEL-ITEM)                              20020029
200300              RESP    (PV-CICS-RESP)                              20030029
200400              REWRITE                                             20040029
200500     END-EXEC.                                                    20050029
200600                                                                  20060029
200700     IF PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                    20070029
200800         SET DP013-CICS-ABEND                                     20080029
200900             DP013-NO-ROLLBACK   TO TRUE                          20090029
201000         MOVE '9200-REWRITE-LIST-QUEUE'                           20100029
201100                                 TO DP013-PARAGRAPH               20110029
201200         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   20120029
201300                                 TO DP013-MESSAGE-TEXT (1)        20130029
201400         PERFORM DP013-0000-PROCESS-ABEND                         20140029
201500     END-IF.                                                      20150029
201600/                                                                 20160029
201700******************************************************************20170029
201800* READ AN ITEM FROM THE INPUT SELECTED WORK ORDER ITEMS          *20180029
201900* TEMP STORAGE QUEUE.                                            *20190029
202000******************************************************************20200029
202100 9300-READ-WO-SEL-QUEUE.                                          20210029
202200                                                                  20220029
202300     EXEC CICS                                                    20230029
202400         READQ TS                                                 20240029
202500             QUEUE (ASC-SEL-QUEUE-NAME-IN)                        20250029
202600             INTO  (PC016-TS-SEL-REC)                             20260029
202700             ITEM  (ASC-SEL-ITEM)                                 20270029
202800             RESP  (PV-CICS-RESP)                                 20280029
202900     END-EXEC.                                                    20290029
203000                                                                  20300029
203100     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        20310029
203200         CONTINUE                                                 20320029
203300     ELSE                                                         20330029
203400         SET DP013-LOGIC-ABEND                                    20340029
203500             DP013-NO-ROLLBACK   TO TRUE                          20350029
203600         MOVE '9300-READ-WO-SEL-QUEUE'                            20360029
203700                                 TO DP013-PARAGRAPH               20370029
203800         MOVE 'ATTEMPTING TO READ TO LIST SELECTIONS TS QUEUE'    20380029
203900                                 TO DP013-MESSAGE-TEXT (1)        20390029
204000         MOVE ASC-SEL-QUEUE-NAME-IN TO MSG-QUEUE-NAME             20400029
204100         MOVE ASC-SEL-ITEM       TO MSG-SEL-ITEM                  20410029
204200         MOVE MSG-QUEUE-ITEM     TO DP013-MESSAGE-TEXT (2)        20420029
204300         MOVE PC000-PO-NBR-N     TO MSG1-PO-NBR                   20430029
204400         MOVE PC000-REC-SEQ-NBR-N                                 20440029
204500                                 TO MSG1-REC-SEQ-NBR-N            20450029
204600         MOVE PC000-OPERATING-UNIT-ID                             20460029
204700                                 TO MSG1-OPER-UNT-ID              20470029
204800         MOVE PC000-FACILITY-ID  TO MSG1-FACILITY-ID              20480029
204900         MOVE MSG1-PO-REC        TO DP013-MESSAGE-TEXT (3)        20490029
205000         PERFORM DP013-0000-PROCESS-ABEND                         20500029
205100     END-IF.                                                      20510029
205200                                                                  20520029
205300/                                                                 20530029
205400******************************************************************20540029
205500* UPDATE AN ITEM IN THE INPUT SELECTED WORK ORDER ITEMS          *20550029
205600* TEMP STORAGE QUEUE.                                            *20560029
205700******************************************************************20570029
205800 9400-REWRITE-WO-LIST-QUEUE.                                      20580029
205900     EXEC CICS                                                    20590029
206000          WRITEQ TS                                               20600029
206100              QUEUE   (ASC-SEL-QUEUE-NAME-IN)                     20610029
206200              FROM    (PC016-TS-SEL-REC)                          20620029
206300              ITEM    (ASC-SEL-ITEM)                              20630029
206400              RESP    (PV-CICS-RESP)                              20640029
206500              REWRITE                                             20650029
206600     END-EXEC.                                                    20660029
206700                                                                  20670029
206800     IF PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                    20680029
206900         SET DP013-CICS-ABEND                                     20690029
207000             DP013-NO-ROLLBACK   TO TRUE                          20700029
207100         MOVE '9400-REWRITE-WO-LIST-QUEUE'                        20710029
207200                                 TO DP013-PARAGRAPH               20720029
207300         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   20730029
207400                                 TO DP013-MESSAGE-TEXT (1)        20740029
207500         PERFORM DP013-0000-PROCESS-ABEND                         20750029
207600     END-IF.                                                      20760029
207700/                                                                 20770029
207800******************************************************************20780029
207900*    THE DB2 RESOURCE IS NOT AVAILABLE, SET THE ERROR MESSAGE    *20790029
208000*    AND THE ERROR SWITCHES.                                     *20800029
208100******************************************************************20810029
208200 9900-SOFT-ABORT.                                                 20820029
208300     SET PS-ERROR         TO TRUE.                                20830029
208400     SET DP020-MSG-FATAL  TO TRUE.                                20840029
208500     MOVE PC-TSYMSG-00551 TO DP020-MSG-NUMBER.                    20850029
208600     IF PS-NO-NEXT-SCREEN                                         20860029
208700        SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                     20870029
208800     END-IF.                                                      20880029
208900     IF SQLCODE = -913                                            20890029
209000        PERFORM 9901-ROLLBACK                                     20900029
209100     END-IF.                                                      20910029
209200     MOVE 'PROGRAM EXIT CALL' TO DP013-MESSAGE-TEXT (1).          20920029
209300     PERFORM 0001-CALL-CICS-ARCH-API.                             20930029
209400                                                                  20940029
209500 9901-ROLLBACK.                                                   20950029
209600     EXEC CICS SYNCPOINT                                          20960029
209700          ROLLBACK                                                20970029
209800     END-EXEC.                                                    20980029
209900/                                                                 20990029
210000******************************************************************21000029
210100*    ABEND PROCESSING                                             21010029
210200******************************************************************21020029
210300     COPY DPPD013.                                                21030029
