000100*-----------------------*                                         00010039
000200 IDENTIFICATION DIVISION.                                         00020039
000300*-----------------------*                                         00030039
000400 PROGRAM-ID.    RDKCS033.                                         00040039
000500 AUTHOR.        DOUGLAS W ROUSAR.                                 00050039
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060039
000700 DATE-WRITTEN.  01-10-98.                                         00070039
000800 DATE-COMPILED.                                                   00080039
000900*----------------------------------------------------------------*00090039
001000*    U033 - KMC USED CARD CHECK-IN                               *00100039
001100*                                                                *00110039
001200*    THIS PROGRAM UPDATES THE STATUS CODE TO 'HQ' IN THE         *00120039
001300*    SVT_KOHLS_CRD_ACCT                                           00130039
001400*  TABLE FOR ALL KMRC AND GIFT CARDS RECIEVED AT CORPORATE       *00140039
001500*----------------------------------------------------------------*00150039
001600*  CHANGED BY: BARB ERTL      08/15/2001                         *00160039
001700*       CHANGE TO UPDATE ON ENTER AS WELL AS F15                 *00170039
001800*       THIS IS TO ALLOW THE STORES TO USE THE SAME SCANNING GUN *00180039
001900*       PROGRAM TO CHECK IN STORED VALUE CARDS AS THEY USE FOR   *00190039
002000*       UPC LOOK-UP.                                             *00200039
002100*----------------------------------------------------------------*00210039
002200* 04/09/02 - JIM MYERS    - WR# 22603                            *00220039
002300* - CHANGED LOGIC TO EXPAND THE CARD NUMBER FIELD TO 16 BYTES.   *00230039
002400*----------------------------------------------------------------*00240039
002500* 10/24/02 - BARB ERTL    - PM# 503202                           *00250039
002600* - WHEN ERROR OCCURS, WIPE OUT ENTRY FIELD AND PUT CARD NUMBER  *00260039
002700*   IN ERROR MESSAGE.                                            *00270039
002800*----------------------------------------------------------------*00280039
CICS  * CHANGED 10/27/2022    BY JIM HUNTER      WR: CHG0277293                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  ******************************************************************        
002900                                                                  00290039
003000 ENVIRONMENT DIVISION.                                            00300039
003100                                                                  00310039
003200 DATA DIVISION.                                                   00320039
003300                                                                  00330039
003400 WORKING-STORAGE SECTION.                                         00340039
003500*                                                                 00350039
003600 01  PC-PROGRAM-CONSTANTS.                                        00360039
003700     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE  'RD033A  '. 00370039
003800     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE  'RDKM033 '. 00380039
003900     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE  'RDKCS033'. 00390039
004000     05  PC-TSYMSG-NUMBERS.                                       00400039
004100         10  PC-TSYMSG-00007       PIC  9(05)  VALUE  00007.      00410039
004200         10  PC-TSYMSG-00008       PIC  9(05)  VALUE  00008.      00420039
004300         10  PC-TSYMSG-00059       PIC  9(05)  VALUE  00059.      00430039
004400         10  PC-TSYMSG-00482       PIC  9(05)  VALUE  00482.      00440039
004500         10  PC-TSYMSG-03007       PIC  9(05)  VALUE  03007.      00450039
004600         10  PC-TSYMSG-03008       PIC  9(05)  VALUE  03008.      00460039
004700     05  PC-NULL                   PIC  9(04).                    00470039
004800*                                                                 00480039
004900 01  PS-PROGRAM-SWITCHES.                                         00490039
005000     05  PS-ERROR-SW               PIC  X(01)  VALUE  'N'.        00500039
005100         88  PS-ERROR                          VALUE  'Y'.        00510039
005200         88  PS-NO-ERROR                       VALUE  'N'.        00520039
005210     05  PS-CARD-SPACE-FOUND-SW    PIC  X(01)  VALUE  'N'.        00521039
005220         88  PS-CARD-SPACE-FOUND               VALUE  'Y'.        00522039
005230         88  PS-CARD-SPACE-NOT-FOUND           VALUE  'N'.        00523039
005231     05  PS-CARD-NON-ZERO-FOUND-SW PIC  X(01)  VALUE  'N'.        00523139
005232         88  PS-CARD-NON-ZERO-FOUND            VALUE  'Y'.        00523239
005233         88  PS-CARD-NON-ZERO-NOT-FOUND        VALUE  'N'.        00523339
005234                                                                  00523439
005235                                                                  00523539
005236 01  PM-PROGRAM-MESSAGES.                                         00523639
005237     05  PM-ABEND-INFO-A.                                         00523739
005238         10  FILLER                PIC X(15)   VALUE              00523839
005239                                   'DP020-SRC-AID: '.             00523939
005240         10  PM-A-SRC-AID          PIC X(02)   VALUE  SPACE.      00524039
005250         10  FILLER                PIC X(19)   VALUE              00525039
005260                                   '. DP020-FK-ACTION: '.         00526039
005270         10  PM-A-FK-ACTION        PIC X(01)   VALUE  SPACE.      00527039
005280         10  FILLER                PIC X(22)   VALUE              00528039
005290                                   '. DP020-FK-DISPN-IND: '.      00529039
005300         10  PM-A-FK-DISPN         PIC X(01)   VALUE  SPACE.      00530039
005400         10  FILLER                PIC X(01)   VALUE '.'.         00540039
005500         10  FILLER                PIC X(19)   VALUE SPACE.       00550039
005600                                                                  00560039
005700 01  PV-PROGRAM-VARIABLES.                                        00570039
005800     05  PV-CURRENT-TIMESTAMP         PIC  X(26)   VALUE SPACES.  00580039
005900                                                                  00590039
006000     05  PV-TIMESTAMP.                                            00600039
006100         10  PV-CURRENT-DATE          PIC X(10).                  00610039
006200         10  FILLER                   PIC X.                      00620039
006300         10  PV-CURRENT-TIME          PIC X(15).                  00630039
006400         10  FILLER REDEFINES PV-CURRENT-TIME.                    00640039
006500             15  PV-TIME              PIC X(08).                  00650039
006600             15  PV-FRACT-SEC         PIC X(07).                  00660039
006700                                                                  00670039
006800     05 PV-COUNT-CARD-CHAR       PIC  9(02).                      00680039
006900     05 PV-COUNT-CARD-SPACES     PIC  9(02).                      00690039
007000     05 PV-COUNT-CARD-ZEROES     PIC  9(02).                      00700039
007100     05 PV-CARD-NBR              PIC  S9(12)V COMP-3.             00710039
007200     05 PV-CARD-ID               PIC  X(30).                      00720039
007300     05 PV-GENERIC-CARD-NBR-N.                                    00730039
007400         10  PV-GENERIC-UPC-NBR-N        PIC 9(11) VALUE ZEROES.  00740039
007500         10  PV-GENERIC-KOHLS-BIN-NBR-N  PIC 9(06) VALUE ZEROES.  00750039
007600         10  PV-GENERIC-CARD-TYPE-N      PIC 9(01) VALUE ZEROES.  00760039
007700         10  PV-GENERIC-ACCOUNT-NBR-N    PIC 9(12) VALUE ZEROES.  00770039
007710                                                                  00771039
007711 01  WS-WORK-AREA.                                                00771139
007712     05  WS-CARD1                  PIC X(30).                     00771239
007713     05  WS-CARD1-REDEF REDEFINES WS-CARD1.                       00771339
007714         10  WS-CARD1-AREA         OCCURS 30 TIMES                00771439
007715                                   INDEXED BY CARD-INDX1.         00771539
007716             15  WS-CARD1-ONE      PIC X(01).                     00771639
007717                                                                  00771739
007718     05  WS-CARD2                  PIC X(30).                     00771839
007719     05  WS-CARD2-REDEF REDEFINES WS-CARD2.                       00771939
007720         10  WS-CARD2-AREA          OCCURS 30 TIMES               00772039
007721                                    INDEXED BY CARD-INDX2.        00772139
007722             15  WS-CARD2-ONE       PIC X(01).                    00772239
007723     05  WS-CARD-ID                 PIC X(30).                    00772339
007724     05  WS-CARD-ID-N   REDEFINES  WS-CARD-ID.                    00772439
007725         10 WS-CARD-ID-N-1ST15      PIC 9(15).                    00772539
007726         10 WS-CARD-ID-N-2ND15      PIC 9(15).                    00772639
007727     05  WS-ZERO1                  PIC X(30).                     00772739
007728     05  WS-ZERO1-REDEF REDEFINES WS-ZERO1.                       00772839
007729         10  WS-ZERO1-AREA         OCCURS 30 TIMES                00772939
007730                                   INDEXED BY ZERO-INDX1.         00773039
007731             15  WS-ZERO1-ONE      PIC X(01).                     00773139
007732                                                                  00773239
007733     05  WS-ZERO2                  PIC X(30).                     00773339
007734     05  WS-ZERO2-REDEF REDEFINES WS-ZERO2.                       00773439
007735         10  WS-ZERO2-AREA          OCCURS 30 TIMES               00773539
007736                                    INDEXED BY ZERO-INDX2.        00773639
007737             15  WS-ZERO2-ONE       PIC X(01).                    00773739
007738     05  WS-ZERO-ID                 PIC X(30).                    00773839
007739     05  WS-ZERO-ID-N   REDEFINES  WS-ZERO-ID.                    00773939
007740         10 WS-ZERO-ID-N-1ST15      PIC 9(15).                    00774039
007741         10 WS-ZERO-ID-N-2ND15      PIC 9(15).                    00774139
007742                                                                  00774239
007743*----------------------------------------------------------------*00774339
007744*    MAP LAYOUT                                                  *00774439
007745*----------------------------------------------------------------*00774539
007746                                                                  00774639
007747     COPY RDKM033.                                                00774739
007748     EJECT                                                        00774839
007749                                                                  00774939
007750*----------------------------------------------------------------*00775039
007760*    TABLE TO BE UPDATED                                         *00776039
007770*----------------------------------------------------------------*00777039
007780                                                                  00778039
007790     EXEC SQL                                                     00779039
007800        INCLUDE SVT00001                                          00780039
007900     END-EXEC.                                                    00790039
008000                                                                  00800039
008100*----------------------------------------------------------------*00810039
008200*    ATTRIBUTE SETTINGS COPYBOOK.                                *00820039
008300*----------------------------------------------------------------*00830039
008400                                                                  00840039
008500     COPY DPWS015.                                                00850039
008600                                                                  00860039
008700*----------------------------------------------------------------*00870039
008800*    FUNCTION KEYS COPYBOOK                                      *00880039
008900*----------------------------------------------------------------*00890039
009000                                                                  00900039
009100     COPY DPWS016.                                                00910039
009200 EJECT                                                            00920039
009300******************************************************************00930039
009400** WORKING STORAGE FOR CONVERSION TO CARD NUMBER                 *00940039
009500******************************************************************00950039
009600     COPY SVWS007.                                                00960039
009700******************************************************************00970039
009800** WORKING STORAGE CONSTANT LIST FOR STORED VALUE SYSTEM         *00980039
009900******************************************************************00990039
010000     COPY SVWS004.                                                01000039
010100 EJECT                                                            01010039
010200******************************************************************01020039
010300** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **01030039
010400** SUB-ROUTINE (DPKUT100).                                      **01040039
010500******************************************************************01050039
010600     COPY DPWS010I.                                               01060039
010700 EJECT                                                            01070039
010800******************************************************************01080039
010900** THE CALLING PARAMETER LIST (DPWS030) FOR THE CICS            **01090039
011000** ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                    **01100039
011100******************************************************************01110039
011200     COPY DPWS030.                                                01120039
CICS       COPY DPWS930.                                                01120039
011300 EJECT                                                            01130039
011400***************************************************************** 01140039
011500*    STANDARD COMMAREA.                                           01150039
011600***************************************************************** 01160039
011700                                                                  01170039
011800     COPY DPWS020.                                                01180039
011900     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01190039
012000                                                                  01200039
012100***************************************************************** 01210039
012200*    INTER-APPLICATION COMMAREA.                                  01220039
012300***************************************************************** 01230039
012400                                                                  01240039
012500         10  INTER-APPL-COMM-AREA PIC X(200).                     01250039
012600***************************************************************** 01260039
012700*    SPECIFIC COMMMAREA FOR RDKCS033.                             01270039
012800***************************************************************** 01280039
012900         10  ASC-SPECIFIC-COMMAREA.                               01290039
013000             15  ASC-CARD-NMBR               PIC  X(30).          01300039
013100             15  ASC-CARD-NMBR-N REDEFINES ASC-CARD-NMBR.         01310039
013200                 20  ASC-CARD-NMBR-N-1ST15   PIC  9(15).          01320039
013300                 20  ASC-CARD-NMBR-N-2ND15   PIC  9(15).          01330039
013400         10  FILLER                          PIC  X(2835).        01340039
013500     EJECT                                                        01350039
013600*----------------------------------------------------------------*01360039
013700*    ABEND PROCESSING COPYBOOK.                                  *01370039
013800*----------------------------------------------------------------*01380039
013900                                                                  01390039
014000     COPY DPWS013.                                                01400039
014100                                                                  01410039
014200*                                                                 01420039
014300*  COMMUNICATION AREAS FOR DB2                                    01430039
014400*                                                                 01440039
014500     EXEC SQL                                                     01450039
014600         INCLUDE SQLCA                                            01460039
014700     END-EXEC.                                                    01470039
014800                                                                  01480039
014900*                                                                 01490039
015000*  DB2 COMMUNICATION AREA 2                                       01500039
015100*                                                                 01510039
015200     COPY SQLCA2.                                                 01520039
015300                                                                  01530039
015400 EJECT                                                            01540039
015500 LINKAGE SECTION.                                                 01550039
015600                                                                  01560039
015700 01  DFHCOMMAREA.                                                 01570039
015800     05  FILLER                         OCCURS  1 TO 4072 TIMES   01580039
015900                                        DEPENDING ON EIBCALEN.    01590039
016000         10  FILLER                     PIC X.                    01600039
016100                                                                  01610039
016200                                                                  01620039
016300 PROCEDURE DIVISION.                                              01630039
016400***************************************************************** 01640039
016500** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 01650039
016600** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 01660039
016700** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 01670039
016800**                                                             ** 01680039
016900** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 01690039
017000** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 01700039
017100***************************************************************** 01710039
017200 0000-MAIN-MODULE.                                                01720039
017300     INITIALIZE DP030-CICS-API-FIELDS.                            01730039
017400     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       01740039
017500     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          01750039
017600     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         01760039
017700     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       01770039
017800     MOVE LENGTH OF RD033AI        TO DP030-MAP-LENGTH (1).       01780039
017900     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     01790039
018000     PERFORM 0001-CALL-CICS-ARCH-API.                             01800039
018100*                                                                 01810039
018200     PERFORM 1000-CONTROL-PROCESSING                              01820039
018300*                                                                 01830039
018400     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     01840039
018500     PERFORM 0001-CALL-CICS-ARCH-API.                             01850039
018600                                                                  01860039
018700 0001-CALL-CICS-ARCH-API.                                         01870039
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                              
018900                                    DFHCOMMAREA                           
019000                                    DP030-CICS-API-FIELDS                 
019100                                    DP020-STANDARD-COMMAREA               
019200                                    RD033AI.                              
019300*                                                                 01930039
019400     IF  DP030-RC-CALL-SUCCESSFUL                                 01940039
019500         CONTINUE                                                 01950039
019600     ELSE                                                         01960039
019700         SET DP013-NO-ROLLBACK                                    01970039
019800             DP013-XCTL-DISPLAY-RESTART                           01980039
019900             DP013-CICS-ABEND      TO TRUE                        01990039
020000         MOVE 'BEFORE 0000-MAIN-MODULE'                           02000039
020100                                   TO DP013-PARAGRAPH             02010039
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
020400         MOVE DP030-RETURN-CODE                                   02040039
020500                                   TO DP013-MESSAGE-TEXT (3)      02050039
020600         PERFORM DP013-0000-PROCESS-ABEND                         02060039
020700     END-IF.                                                      02070039
020800 EJECT                                                            02080039
020900*----------------------------------------------------------------*02090039
021000*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *02100039
021100*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *02110039
021200*----------------------------------------------------------------*02120039
021300                                                                  02130039
021400 1000-CONTROL-PROCESSING.                                         02140039
021500                                                                  02150039
021600     EVALUATE TRUE                                                02160039
021700         WHEN DP020-NEXT-ACT-INITIAL                              02170039
021800             INITIALIZE ASC-SPECIFIC-COMMAREA                     02180039
021900             PERFORM 4000-BUILD-INITIAL-PANEL                     02190039
022000                                                                  02200039
022100         WHEN DP020-NEXT-ACT-READ-MAP                             02210039
022200             PERFORM 2000-FKEY-PROCESSING                         02220039
022300                                                                  02230039
022400         WHEN DP020-NEXT-ACT-RETURN                               02240039
022500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 02250039
022600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   02260039
022700                                                                  02270039
022800         WHEN OTHER                                               02280039
022900             SET DP013-LOGIC-ABEND                                02290039
023000                 DP013-NO-ROLLBACK TO TRUE                        02300039
023100             MOVE '1000-CONTROL-PROCESSING'                       02310039
023200                                   TO  DP013-PARAGRAPH            02320039
023300             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   02330039
023400                                   TO  DP013-MESSAGE-TEXT(1)      02340039
023500             MOVE DP020-NEXT-APPL-ACTIVITY                        02350039
023600                                   TO DP013-MESSAGE-TEXT(2)       02360039
023700             PERFORM DP013-0000-PROCESS-ABEND                     02370039
023800     END-EVALUATE.                                                02380039
023900                                                                  02390039
024000*----------------------------------------------------------------*02400039
024100* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*02410039
024200* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*02420039
024300* EDITS.                                                         *02430039
024400*----------------------------------------------------------------*02440039
024500                                                                  02450039
024600 2000-FKEY-PROCESSING.                                            02460039
024700                                                                  02470039
024800     EVALUATE TRUE                                                02480039
024900                                                                  02490039
025000         WHEN DP020-SRC-AID = DP016-CLEAR                         02500039
025100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   02510039
025200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 02520039
025300                                                                  02530039
025400         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     02540039
025500             INITIALIZE ASC-SPECIFIC-COMMAREA                     02550039
025600             PERFORM 4000-BUILD-INITIAL-PANEL                     02560039
025700             PERFORM 3200-RESET-ATTRIBUTES                        02570039
025800                                                                  02580039
025900         WHEN OTHER                                               02590039
026000             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 02600039
026100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   02610039
026200             IF  PS-NO-ERROR                                      02620039
026300                 SET DP030-CONTINUE-GO TO TRUE                    02630039
026400                 PERFORM 2100-CHECK-FUNCTION-KEY                  02640039
026500             ELSE                                                 02650039
026600                 SET DP030-OVERRIDE-GO TO TRUE                    02660039
026700             END-IF                                               02670039
026800     END-EVALUATE.                                                02680039
026900******************************************************************02690039
027000** ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **02700039
027100** FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **02710039
027200** FROM THE CICS ARCHITECTURE API.                              **02720039
027300******************************************************************02730039
027400 2100-CHECK-FUNCTION-KEY.                                         02740039
027500     EVALUATE TRUE                                                02750039
027600         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              02760039
027700         WHEN DP020-SRC-AID = DP016-ENTER                         02770039
027800             PERFORM 5000-PROCESS-UPDATE                          02780039
027900             INITIALIZE ASC-SPECIFIC-COMMAREA                     02790039
028000                                                                  02800039
028100         WHEN DP020-FK-DISPN-GO (DP020-SRC-AID)                   02810039
028200             CONTINUE                                             02820039
028300                                                                  02830039
028400         WHEN OTHER                                               02840039
028500             SET DP013-NO-ROLLBACK                                02850039
028600                 DP013-XCTL-DISPLAY-RESTART                       02860039
028700                 DP013-CICS-ABEND  TO TRUE                        02870039
028800             MOVE '2100-CHECK-FUNCTION-KEY'                       02880039
028900                                   TO DP013-PARAGRAPH             02890039
029000             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      02900039
029100                                   TO DP013-MESSAGE-TEXT (1)      02910039
029200             MOVE 'OR CODE MISSING FROM THIS PROGRAM TO PROCESS:' 02920039
029300                                   TO DP013-MESSAGE-TEXT (2)      02930039
029400             MOVE DP020-SRC-AID    TO PM-A-SRC-AID                02940039
029500             MOVE DP020-FK-ACTION (DP020-SRC-AID)                 02950039
029600                                   TO PM-A-FK-ACTION              02960039
029700             MOVE DP020-FK-DISPN-IND (DP020-SRC-AID)              02970039
029800                                   TO PM-A-FK-DISPN               02980039
029900             MOVE PM-ABEND-INFO-A  TO DP013-MESSAGE-TEXT (3)      02990039
030000             MOVE 'REVIEW PFKEYS SETUP FOR THIS MNEMONIC.'        03000039
030100                                   TO DP013-MESSAGE-TEXT (4)      03010039
030200             PERFORM DP013-0000-PROCESS-ABEND                     03020039
030300     END-EVALUATE.                                                03030039
030400*----------------------------------------------------------------*03040039
030500* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*03050039
030600* THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *03060039
030700* APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *03070039
030800*----------------------------------------------------------------*03080039
030900                                                                  03090039
031000 2200-MOVE-SCREEN-TO-COMMAREA.                                    03100039
031100                                                                  03110039
031200     IF  ACRDNUML > ZERO                                          03120039
031300         MOVE ACRDNUMI             TO ASC-CARD-NMBR               03130039
031400     END-IF.                                                      03140039
031500                                                                  03150039
031600*----------------------------------------------------------------*03160039
031700* ENSURE THE DATA IS CORRECT.  NOTE THAT IN A CRITERIA SPECIFI-  *03170039
031800* CATION SCREEN ONLY MINIMAL EDITS ARE DONE.  EDITS RELATED TO   *03180039
031900* A SPECIFIC SCREEN THAT THE USER IS GOING TO (LOCAL-GO) ARE DONE*03190039
032000* IN THE DESTINATION PROGRAM, NOT HERE.                          *03200039
032100*----------------------------------------------------------------*03210039
032200                                                                  03220039
032300 3000-EDIT-DATA-IN-COMMAREA.                                      03230039
032400                                                                  03240039
032500     PERFORM 3200-RESET-ATTRIBUTES.                               03250039
032600                                                                  03260039
032700     IF  ASC-CARD-NMBR > SPACE                                    03270039
             MOVE ASC-CARD-NMBR         TO SV007-CARD-NUMBER-IN                 
             MOVE 0                     TO SV007-CARD-NUMBER-LENGTH             
             SET SV007-FORMAT-IN        TO TRUE                                 
             PERFORM SV007-FORMAT-CARD                                          
             IF SV007-FORMAT-ERROR                                              
033800           SET PS-ERROR                                                   
033810               DP020-MSG-FATAL   TO TRUE                                  
033811           MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER                      
033812           MOVE DP015-UNP-ALP-BRT-OFF                                     
033813                                 TO ACRDNUMA                              
033814           MOVE DP015-RED        TO ACRDNUMC                              
033815           MOVE DP015-REVERSE    TO ACRDNUMH                              
033816           MOVE -1               TO ACRDNUML                              
033817           SET DP030-SET-CURSOR-APPL-1 TO TRUE                            
             ELSE                                                               
                 MOVE SV007-CARD-NBR        TO PV-CARD-NBR                      
033818       END-IF                                                             
033853     ELSE                                                         03385339
033854        SET PS-ERROR                                              03385439
033855            DP020-MSG-FATAL   TO TRUE                             03385539
033856        MOVE PC-TSYMSG-00007  TO DP020-MSG-NUMBER                 03385639
033857        MOVE DP015-UNP-ALP-BRT-OFF                                03385739
033858                             TO ACRDNUMA                          03385839
033859        MOVE DP015-RED        TO ACRDNUMC                         03385939
033860        MOVE DP015-REVERSE    TO ACRDNUMH                         03386039
033861        MOVE -1               TO ACRDNUML                         03386139
033862        SET DP030-SET-CURSOR-APPL-1 TO TRUE                       03386239
033863     END-IF.                                                      03386339
033864                                                                  03386439
033865     IF  PS-NO-ERROR                                              03386539
033866         MOVE -1                   TO ACRDNUML                    03386639
033867         SET DP030-SET-CURSOR-APPL-1                              03386739
033868                                   TO TRUE                        03386839
033869     END-IF.                                                      03386939
034700                                                                  03470039
034710******************************************************************03471039
034720** LOOK FOR THE FIRST SPACE IN THE CARD ID.  WHEN FOUND MOVE    **03472039
034730** SPACES TO ALL REMAINING CHARACTERS.                          **03473039
034740******************************************************************03474039
034750 3190-DETERMINE-CARD-ID-SPACES.                                   03475039
034760                                                                  03476039
034761     MOVE SPACES TO WS-CARD1.                                     03476139
034762     MOVE ASC-CARD-NMBR  TO WS-CARD1.                             03476239
034763     MOVE 'N' TO PS-CARD-SPACE-FOUND-SW.                          03476339
034764     MOVE SPACES TO WS-CARD2.                                     03476439
034765     MOVE ZEROES TO PV-COUNT-CARD-CHAR.                           03476539
034766     SET CARD-INDX2 TO 1.                                         03476639
034767                                                                  03476739
034768     PERFORM VARYING CARD-INDX1 FROM 1 BY 1                       03476839
034769       UNTIL CARD-INDX1 > 30                                      03476939
034770        OR PS-CARD-SPACE-FOUND                                    03477039
034780         IF WS-CARD1-ONE(CARD-INDX1) = ' '                        03478039
034790            MOVE 'Y' TO PS-CARD-SPACE-FOUND-SW                    03479039
034800         ELSE                                                     03480039
034801            MOVE WS-CARD1-ONE(CARD-INDX1) TO                      03480139
034802                 WS-CARD2-ONE(CARD-INDX2)                         03480239
034803            SET CARD-INDX2 UP BY 1                                03480339
034804            COMPUTE PV-COUNT-CARD-CHAR = PV-COUNT-CARD-CHAR + 1   03480439
034805         END-IF                                                   03480539
034806     END-PERFORM.                                                 03480639
034807                                                                  03480739
034808     MOVE SPACES TO WS-CARD1.                                     03480839
034809     MOVE ZEROES TO PV-COUNT-CARD-SPACES.                         03480939
034810     COMPUTE PV-COUNT-CARD-SPACES = 30 - PV-COUNT-CARD-CHAR.      03481039
034811                                                                  03481139
034812     IF PS-CARD-SPACE-FOUND                                       03481239
034813        SET CARD-INDX2 TO 1                                       03481339
034814        PERFORM VARYING CARD-INDX1 FROM 1 BY 1                    03481439
034815          UNTIL CARD-INDX1 > 30                                   03481539
034816            IF CARD-INDX1 > PV-COUNT-CARD-SPACES                  03481639
034817               MOVE WS-CARD2-ONE(CARD-INDX2) TO                   03481739
034818                                      WS-CARD1-ONE(CARD-INDX1)    03481839
034819               SET CARD-INDX2 UP BY 1                             03481939
034820            ELSE                                                  03482039
034821               MOVE ZEROES TO WS-CARD1-ONE(CARD-INDX1)            03482139
034822            END-IF                                                03482239
034823        END-PERFORM                                               03482339
034824        MOVE WS-CARD1 TO WS-CARD-ID                               03482439
034826        MOVE WS-CARD-ID-N TO ASC-CARD-NMBR-N                      03482639
034827     ELSE                                                         03482739
034828        MOVE WS-CARD2 TO WS-CARD-ID                               03482839
034830        MOVE WS-CARD-ID-N TO ASC-CARD-NMBR-N                      03483039
034831     END-IF.                                                      03483139
034832                                                                  03483239
034878                                                                  03487839
034879******************************************************************03487939
034880** MOVE THE DEFAULT ATTRIBUTES TO ALL OF THE OPEN FIELDS ON THE **03488039
034890** MAP.                                                         **03489039
034900******************************************************************03490039
035000 3200-RESET-ATTRIBUTES.                                           03500039
035100     IF  PS-NO-ERROR                                              03510039
035200        MOVE DP015-UNP-ALP-NOR-OFF    TO ACRDNUMA                 03520039
035300        MOVE DP015-GREEN              TO ACRDNUMC                 03530039
035400        MOVE DP015-UNDERLINE          TO ACRDNUMH                 03540039
035500     ELSE                                                         03550039
035600        CONTINUE                                                  03560039
035700     END-IF.                                                      03570039
035800*                                                                 03580039
035900*----------------------------------------------------------------*03590039
036000*  POSITION THE CURSOR AT THE APPROPRIATE FIELD.                 *03600039
036100*  IF THERE IS ANY DATA TO MOVE TO THE SCREEN ON INITIAL, MOVE   *03610039
036200*  IT HERE.                                                      *03620039
036300*----------------------------------------------------------------*03630039
036400 4000-BUILD-INITIAL-PANEL.                                        03640039
036500     SET DP030-SET-CURSOR-APPL-1   TO TRUE                        03650039
036600     MOVE -1                       TO ACRDNUML.                   03660039
036700*                                                                 03670039
036800*----------------------------------------------------------------*03680039
036900*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *03690039
037000*----------------------------------------------------------------*03700039
037100 4400-MOVE-COMMAREA-TO-SCREEN.                                            
           MOVE ASC-CARD-NMBR             TO SV007-CARD-NUMBER                  
           SET SV007-FORMAT-DISPLAY       TO TRUE                               
           PERFORM SV007-FORMAT-CARD                                            
           MOVE SV007-CARD-NUMBER-DISPLAY TO ACRDNUMO.                          
                                                                                
037400*----------------------------------------------------------------*03740039
037500*    PERFORMS THE LOOKUP AND UPDATE OF TKMCTBL                   *03750039
037600*----------------------------------------------------------------*03760039
037700 5000-PROCESS-UPDATE.                                             03770039
037800                                                                  03780039
037900     EXEC SQL                                                     03790039
038000         SET :PV-CURRENT-TIMESTAMP = CURRENT TIMESTAMP            03800039
038100     END-EXEC.                                                    03810039
038200                                                                  03820039
038300     MOVE PV-CURRENT-TIMESTAMP  TO  PV-TIMESTAMP.                 03830039
038400                                                                  03840039
038500     EXEC SQL                                                     03850039
038600        SELECT CRD_STAT_CDE                                       03860039
038700        INTO :SVT00001-CRD-STAT-CDE                               03870039
038800        FROM SVT_KOHLS_CRD_ACCT                                   03880039
038900        WHERE CRD_NBR = :PV-CARD-NBR                              03890039
038901        WITH UR                                                           
039000     END-EXEC.                                                    03900039
039100                                                                  03910039
039200     EVALUATE SQLCODE                                             03920039
039300        WHEN +100                                                 03930039
039400           SET PS-ERROR                                           03940039
039500               DP020-MSG-FATAL                                    03950039
039600               DP030-ERASE-UNPROT TO TRUE                         03960039
039700           MOVE PC-TSYMSG-03007  TO DP020-MSG-NUMBER              03970039
                 MOVE ACRDNUMI         TO DP020-MSG-TEXT                        
040000           MOVE PC-NULL          TO ACRDNUMI                      04000039
040100           MOVE DP015-UNP-ALP-BRT-OFF                             04010039
040200                               TO ACRDNUMA                        04020039
040300           MOVE DP015-RED       TO ACRDNUMC                       04030039
040400           MOVE DP015-REVERSE    TO ACRDNUMH                      04040039
040500           MOVE -1               TO ACRDNUML                      04050039
040600           SET DP030-SET-CURSOR-APPL-1 TO TRUE                    04060039
040700        WHEN +0                                                   04070039
040800          IF SVT00001-CRD-STAT-CDE = SV004-CRD-STAT-TYP-CORP      04080039
040900             SET PS-ERROR                                         04090039
041000                  DP020-MSG-FATAL                                 04100039
041100                  DP030-ERASE-UNPROT TO TRUE                      04110039
041200             MOVE PC-TSYMSG-03008  TO DP020-MSG-NUMBER            04120039
041300             MOVE ACRDNUMI         TO DP020-MSG-TEXT              04130039
041400             MOVE PC-NULL          TO ACRDNUMI                    04140039
041500             MOVE DP015-UNP-ALP-BRT-OFF                           04150039
041600                                 TO ACRDNUMA                      04160039
041700             MOVE DP015-RED        TO ACRDNUMC                    04170039
041800             MOVE DP015-REVERSE    TO ACRDNUMH                    04180039
041900             MOVE -1               TO ACRDNUML                    04190039
042000             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  04200039
042100          ELSE                                                    04210039
042200             PERFORM 5100-UPDATE-SVT00001                         04220039
042300          END-IF                                                  04230039
042400        WHEN  -911                                                04240039
042500           MOVE '5000-PROCESS-UPDATE'                             04250039
042600                                 TO DP013-PARAGRAPH               04260039
042700           MOVE 'UPDATE THE MERCHANDISE CARD TABLE'               04270039
042800                                 TO DP013-MESSAGE-TEXT (1)        04280039
042900           MOVE 'SVT00001'     TO DP013-DB2-TABLE-NAME (1)        04290039
043000           MOVE SQLCA          TO DP013-SQLCA                     04300039
043100           SET DP013-LINK-RETURN                                  04310039
043200               DP013-DB2-ABEND                                    04320039
043300               DP013-ROLLBACK  TO TRUE                            04330039
043400           PERFORM DP013-0000-PROCESS-ABEND                       04340039
043500           MOVE 'SVT00001'     TO DP020-MSG-TEXT                  04350039
043600           MOVE PC-TSYMSG-00482                                   04360039
043700                                 TO DP020-MSG-NUMBER              04370039
043800           SET DP020-MSG-FATAL                                    04380039
043900                                 TO TRUE                          04390039
044000        WHEN  -913                                                04400039
044100           MOVE '5000-PROCESS-UPDATE'                             04410039
044200                                 TO DP013-PARAGRAPH               04420039
044300           MOVE 'SELECT THE MERCHANDISE CARD TABLE'               04430039
044400                                 TO DP013-MESSAGE-TEXT (1)        04440039
044500           MOVE 'SVT00001'     TO DP013-DB2-TABLE-NAME (1)        04450039
044600           MOVE SQLCA          TO DP013-SQLCA                     04460039
044700           SET DP013-LINK-RETURN                                  04470039
044800               DP013-DB2-ABEND                                    04480039
044900               DP013-ROLLBACK  TO TRUE                            04490039
045000           PERFORM DP013-0000-PROCESS-ABEND                       04500039
045100           MOVE 'SVT00001'     TO DP020-MSG-TEXT                  04510039
045200           MOVE PC-TSYMSG-00482                                   04520039
045300                                 TO DP020-MSG-NUMBER              04530039
045400           SET DP020-MSG-FATAL                                    04540039
045500                                 TO TRUE                          04550039
045600        WHEN OTHER                                                04560039
045700           MOVE '5000-PROCESS-UPDATE'                             04570039
045800                                 TO DP013-PARAGRAPH               04580039
045900           MOVE 'SELECT THE MERCHANDISE CARD TABLE'               04590039
046000                                   TO DP013-MESSAGE-TEXT(1)       04600039
046100           MOVE SQLCA            TO DP013-SQLCA                   04610039
046200           MOVE 'SVT00001'       TO DP013-DB2-TABLE-NAME (1)      04620039
046300           SET DP013-DB2-ABEND                                    04630039
046400               DP013-XCTL-DISPLAY-RESTART TO TRUE                 04640039
046500           PERFORM DP013-0000-PROCESS-ABEND                       04650039
046600     END-EVALUATE.                                                04660039
046700*----------------------------------------------------------------*04670039
046800*    PERFORMS THE LOOKUP AND UPDATE OF SVT00001                  *04680039
046900*----------------------------------------------------------------*04690039
047000 5100-UPDATE-SVT00001.                                            04700039
047100                                                                  04710039
047200     EXEC SQL                                                     04720039
047300        UPDATE SVT_KOHLS_CRD_ACCT                                 04730039
047400        SET CRD_CLO_DTE          = :PV-CURRENT-DATE               04740039
047500           ,CRD_CLO_TM           = :PV-TIME                       04750039
047600           ,CLO_USR_ID           = :DP020-USERID                  04760039
047700           ,CRD_STAT_CDE         = :SV004-CRD-STAT-TYP-CORP       04770039
047800           ,CRD_STAT_CHG_DTE     = :PV-CURRENT-DATE               04780039
047900           ,CRD_STAT_CHG_TM      = :PV-TIME                       04790039
048000           ,STAT_CHG_BY_USR_ID   = :DP020-USERID                  04800039
048100        WHERE CRD_NBR            = :PV-CARD-NBR                   04810039
048200     END-EXEC                                                     04820039
048300                                                                  04830039
048400     EVALUATE SQLCODE                                             04840039
048500        WHEN +0                                                   04850039
048600           SET DP030-ERASE-UNPROT TO TRUE                         04860039
048700           MOVE PC-TSYMSG-00059  TO DP020-MSG-NUMBER              04870039
048800           SET DP020-MSG-INFORMATIONAL TO TRUE                    04880039
048900           MOVE PC-NULL TO ACRDNUMI                               04890039
049000                           ASC-CARD-NMBR                          04900039
049100        WHEN +100                                                 04910039
049200           SET PS-ERROR                                           04920039
049300               DP020-MSG-FATAL TO TRUE                            04930039
049400           MOVE PC-TSYMSG-03007  TO DP020-MSG-NUMBER              04940039
                 MOVE ACRDNUMI         TO DP020-MSG-TEXT                        
049700           MOVE PC-NULL          TO ACRDNUMI                      04970039
049800           MOVE DP015-UNP-ALP-BRT-OFF                             04980039
049900                               TO ACRDNUMA                        04990039
050000           MOVE DP015-RED        TO ACRDNUMC                      05000039
050100           MOVE DP015-REVERSE    TO ACRDNUMH                      05010039
050200           MOVE -1               TO ACRDNUML                      05020039
050300           SET DP030-SET-CURSOR-APPL-1 TO TRUE                    05030039
050400        WHEN  -911                                                05040039
050500           MOVE '5100-UPDATE-SVT00001'                            05050039
050600                                 TO DP013-PARAGRAPH               05060039
050700           MOVE 'UPDATE THE MERCHANDISE CARD TABLE'               05070039
050800                                 TO DP013-MESSAGE-TEXT (1)        05080039
050900           MOVE 'SVT00001'     TO DP013-DB2-TABLE-NAME (1)        05090039
051000           MOVE SQLCA          TO DP013-SQLCA                     05100039
051100           SET DP013-LINK-RETURN                                  05110039
051200               DP013-DB2-ABEND                                    05120039
051300               DP013-ROLLBACK  TO TRUE                            05130039
051400           PERFORM DP013-0000-PROCESS-ABEND                       05140039
051500           MOVE 'SVT00001'     TO DP020-MSG-TEXT                  05150039
051600           MOVE PC-TSYMSG-00482                                   05160039
051700                                 TO DP020-MSG-NUMBER              05170039
051800           SET DP020-MSG-FATAL                                    05180039
051900                                 TO TRUE                          05190039
052000        WHEN  -913                                                05200039
052100           MOVE '5100-UPDATE-SVT00001'                            05210039
052200                                 TO DP013-PARAGRAPH               05220039
052300           MOVE 'UPDATE THE MERCHANDISE CARD TABLE'               05230039
052400                                 TO DP013-MESSAGE-TEXT (1)        05240039
052500           MOVE 'SVT00001'     TO DP013-DB2-TABLE-NAME (1)        05250039
052600           MOVE SQLCA          TO DP013-SQLCA                     05260039
052700           SET DP013-LINK-RETURN                                  05270039
052800               DP013-DB2-ABEND                                    05280039
052900               DP013-ROLLBACK  TO TRUE                            05290039
053000           PERFORM DP013-0000-PROCESS-ABEND                       05300039
053100           MOVE 'SVT00001'     TO DP020-MSG-TEXT                  05310039
053200           MOVE PC-TSYMSG-00482                                   05320039
053300                                 TO DP020-MSG-NUMBER              05330039
053400           SET DP020-MSG-FATAL                                    05340039
053500                                 TO TRUE                          05350039
053600        WHEN OTHER                                                05360039
053700           MOVE '5000-PROCESS-UPDATE'                             05370039
053800                                 TO DP013-PARAGRAPH               05380039
053900           MOVE 'UPDATE THE MERCHANDISE CARD TABLE'               05390039
054000                                   TO DP013-MESSAGE-TEXT(1)       05400039
054100           MOVE SQLCA            TO DP013-SQLCA                   05410039
054200           MOVE 'SVT00001'       TO DP013-DB2-TABLE-NAME (1)      05420039
054300           SET DP013-DB2-ABEND                                    05430039
054400               DP013-XCTL-DISPLAY-RESTART TO TRUE                 05440039
054500           PERFORM DP013-0000-PROCESS-ABEND                       05450039
054600     END-EVALUATE.                                                05460039
054700                                                                  05470039
054800******************************************************************05480039
054900**  CONVERSION OF CARD NUMBER                                    *05490039
055000******************************************************************05500039
055100     COPY SVPD007.                                                05510039
055200*----------------------------------------------------------------*05520039
055300*    ABEND PROCESSOR MODULE                                      *05530039
055400*----------------------------------------------------------------*05540039
055500                                                                  05550039
055600     COPY DPPD013.                                                05560039
