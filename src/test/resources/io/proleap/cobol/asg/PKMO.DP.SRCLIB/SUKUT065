000100 TITLE 'CREATE REPORT DATE CONTROL CARD'.                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300 PROGRAM-ID.    SUKUT065.                                         00030000
000400 AUTHOR.        DENNIS STEFFEN.                                   00040000
000500 DATE-WRITTEN.  WINTER 2002.                                      00050000
000600 ENVIRONMENT DIVISION.                                            00060000
000700 INPUT-OUTPUT SECTION.                                            00070000
000800                                                                  00080000
000900 FILE-CONTROL.                                                    00090000
001000     SELECT OLD-CONTROL-FILE        ASSIGN TO INP01.              00100000
001100     SELECT NEW-CONTROL-FILE        ASSIGN TO OUT01.              00110000
001200                                                                  00120000
001300 DATA DIVISION.                                                   00130000
001400 FILE SECTION.                                                    00140000
001500                                                                  00150000
001600 FD  OLD-CONTROL-FILE                                             00160000
001700     RECORDING MODE IS F                                          00170000
001800     LABEL RECORDS ARE STANDARD                                   00180000
001900     RECORD CONTAINS 080                                          00190000
002000     BLOCK CONTAINS 0 RECORDS                                     00200000
002100     DATA RECORD IS OLD-CONTROL-RECORD.                           00210000
002200 01  OLD-CONTROL-RECORD               PIC X(080).                 00220000
002300                                                                  00230000
002400 FD  NEW-CONTROL-FILE                                             00240000
002500     RECORDING MODE IS F                                          00250000
002600     LABEL RECORDS ARE STANDARD                                   00260000
002700     RECORD CONTAINS 080                                          00270000
002800     BLOCK CONTAINS 0 RECORDS                                     00280000
002900     DATA RECORD IS NEW-CONTROL-RECORD.                           00290000
003000 01  NEW-CONTROL-RECORD               PIC X(080).                 00300000
003100                                                                  00310000
003200 WORKING-STORAGE SECTION.                                         00320000
003300                                                                  00330000
003400 01  PV-ABEND-CODE                    PIC S9(04)   VALUE ZERO     00340000
003500                                                   COMP SYNC.     00350000
003600                                                                  00360000
003700 01  PS-PROGRAM-SWITCHES.                                         00370000
003800     05  PS-END-EXTRACT-SW            PIC X(1)   VALUE 'N'.       00380000
003900         88  PS-END-EXTRACT                      VALUE 'Y'.       00390000
004000                                                                  00400000
004100                                                                  00410000
004200 01  PV-PROGRAM-VARIABLES.                                        00420000
004300     05  PV-RETRY-COUNT               PIC S9(04)  VALUE ZERO      00430000
004400                                                  COMP SYNC.      00440000
004500     05  PV-PARAGRAPH-NAME            PIC X(30)   VALUE SPACES.   00450000
004600     05  PV-ERROR-MESSAGE-1           PIC X(60)   VALUE SPACES.   00460000
004700     05  PV-ERROR-MESSAGE-2           PIC X(60)   VALUE SPACES.   00470000
004800     05  PV-SQLCODE                   PIC 9(9)    VALUE ZERO.     00480000
004900     05  PV-CURR-YEAR                 PIC S9(09) COMP VALUE ZERO. 00490000
005000     05  PV-DISP-YEAR                 PIC 9(04) VALUE ZERO.       00500000
005100     05  PV-READ-COUNT                PIC S9(9) COMP-3            00510000
005200                                                   VALUE ZERO.    00520000
005300     05  PV-WRITE-COUNT               PIC S9(9) COMP-3            00530000
005400                                                   VALUE ZERO.    00540000
005500     05  PV-DISP-NBR                  PIC Z(8)9.                  00550000
005600                                                                  00560000
005700 01  PC-PROGRAM-CONSTANTS.                                        00570000
005800     05  PC-PROGRAM-NAME              PIC X(08)  VALUE 'SUKUT065'.00580000
005900     05  PC-MAX-RETRIES               PIC S9(04) VALUE +3         00590000
006000                                                 COMP SYNC.       00600000
006100 01  PV-ABEND-FIELDS.                                             00610000
006200     05  PV-ABEND-PROGRAM             PIC X(8)   VALUE 'SUKUT065'.00620000
006300     05  PV-ABEND-PARAGRAPH           PIC X(50)  VALUE SPACES.    00630000
006400     05  PV-ABEND-OPERATION           PIC X(50)  VALUE SPACES.    00640000
006500     05  PV-ABEND-STRUCTURE-1         PIC X(8)   VALUE SPACES.    00650000
006600     05  PV-ABEND-STRUCTURE-2         PIC X(8)   VALUE SPACES.    00660000
006700     05  PV-ABEND-STRUCTURE-3         PIC X(8)   VALUE SPACES.    00670000
006800     05  PV-ABEND-STATUS              PIC XX     VALUE SPACES.    00680000
006900     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    00690000
007000     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    00700000
007100     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    00710000
007200     05  PV-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    00720000
007300                                                                  00730000
007400/                                                                 00740000
007500*    DATE CONTROL CARD                                            00750000
007600     COPY SURD032.                                                00760000
007700/                                                                 00770000
007800*    DATE ATTRIBUTES                                              00780000
007900     EXEC SQL                                                     00790000
008000         INCLUDE TCOCNTL                                          00800000
008100     END-EXEC                                                     00810000
008200                                                                  00820000
008300     EXEC SQL                                                     00830000
008400         INCLUDE TDTATTR                                          00840000
008500     END-EXEC                                                     00850000
008600/                                                                 00860000
008700*  USED FOR DB2 ERROR MESSAGE BUILDING                            00870000
008800     COPY DPWS004.                                                00880000
008900                                                                  00890000
009000*   DB2 SQL COMMUNICATION AREA                                    00900000
009100     EXEC SQL                                                     00910000
009200          INCLUDE SQLCA                                           00920000
009300     END-EXEC.                                                    00930000
009400/                                                                 00940000
009500 PROCEDURE DIVISION.                                              00950000
009600                                                                  00960000
009700     PERFORM 1000-INIT.                                           00970000
009800                                                                  00980000
009900     PERFORM 2000-PROCESS                                         00990000
010000                                                                  01000000
010100     PERFORM 9000-TERMINATE.                                      01010000
010200                                                                  01020000
010300     GOBACK.                                                      01030000
010400                                                                  01040000
010500 1000-INIT.                                                       01050000
010600                                                                  01060000
010700     OPEN INPUT  OLD-CONTROL-FILE                                 01070000
010800          OUTPUT NEW-CONTROL-FILE.                                01080000
010900                                                                  01090000
011000     PERFORM 8000-READ-CONTROL-REC.                               01100000
011100                                                                  01110000
011200 2000-PROCESS.                                                    01120000
011300                                                                  01130000
011400     IF SU032-FROM-DATE = '9999-09-09' OR                         01140000
011500        SU032-TO-DATE   = '9999-09-09'                            01150000
011600         PERFORM 3000-GET-DATES                                   01160000
011700     END-IF.                                                      01170000
011800                                                                  01180000
011900     PERFORM 8100-WRITE-CONTROL-REC.                              01190000
012000                                                                  01200000
012100/                                                                 01210000
012200 3000-GET-DATES.                                                  01220000
012300                                                                  01230000
012400     PERFORM 7000-GET-FISCAL-INFO.                                01240000
012500                                                                  01250000
012600                                                                  01260000
012700     EVALUATE SU032-RPT-TYPE                                      01270000
012800     WHEN 'D'                                                     01280000
012900         MOVE COCNTL-BTCH-PRC-DTE     TO SU032-FROM-DATE          01290000
013000                                         SU032-TO-DATE            01300000
013100     WHEN 'C'                                                     01310000
013200*        PREVIOUS CALENDAR YEAR                                   01320000
013300         MOVE PV-CURR-YEAR            TO PV-DISP-YEAR             01330000
013400         STRING PV-DISP-YEAR '-01-01' DELIMITED BY SIZE           01340000
013500                                     INTO SU032-FROM-DATE         01350000
013600         STRING PV-DISP-YEAR '-12-31' DELIMITED BY SIZE           01360000
013700                                     INTO SU032-TO-DATE           01370000
013800     WHEN 'F'                                                     01380000
013900*        CURRENT FISCAL YEAR                                      01390000
014000         MOVE DTATTR-FSCL-YR-BEG-DTE  TO SU032-FROM-DATE          01400000
014100         MOVE DTATTR-FSCL-YR-END-DTE  TO SU032-TO-DATE            01410000
014200     WHEN 'M'                                                     01420000
014300*        CURRENT FISCAL MONTH                                     01430000
014400         MOVE DTATTR-FSCL-MN-BEG-DTE  TO SU032-FROM-DATE          01440000
014500         MOVE DTATTR-FSCL-MN-END-DTE  TO SU032-TO-DATE            01450000
014510     WHEN 'N'                                                     01451004
014520*        CURRENT FISCAL MTD                                       01452004
014530         MOVE DTATTR-FSCL-MN-BEG-DTE  TO SU032-FROM-DATE          01453004
014540         MOVE DTATTR-FSCL-WK-END-DTE  TO SU032-TO-DATE            01454004
014600     WHEN 'S'                                                     01460000
014700*        CURRENT SEASON                                           01470000
014800         MOVE DTATTR-SEA-BEG-DTE      TO SU032-FROM-DATE          01480000
014900         MOVE DTATTR-SEA-END-DTE      TO SU032-TO-DATE            01490000
015000     WHEN 'W'                                                     01500000
015100*        CURRENT WEEK                                             01510000
015200         MOVE DTATTR-FSCL-WK-BEG-DTE  TO SU032-FROM-DATE          01520000
015300         MOVE DTATTR-FSCL-WK-END-DTE  TO SU032-TO-DATE            01530000
015310     WHEN 'T'                                                     01531001
015320*        YEAR TO DATE                                             01532001
015330         MOVE DTATTR-FSCL-YR-BEG-DTE  TO SU032-FROM-DATE          01533001
015340         MOVE COCNTL-BTCH-PRC-DTE     TO SU032-TO-DATE            01534003
015400     WHEN OTHER                                                   01540000
015500         MOVE '3000-GET-DATES'        TO PV-PARAGRAPH-NAME        01550000
015600         MOVE 'INVALID RPT TYPE'      TO PV-ERROR-MESSAGE-1       01560000
015700         MOVE SPACES                  TO PV-ERROR-MESSAGE-2       01570000
015800         PERFORM 9200-ABEND                                       01580000
015900     END-EVALUATE.                                                01590000
016000/                                                                 01600000
016100 7000-GET-FISCAL-INFO.                                            01610000
016200                                                                  01620000
016300     EXEC SQL                                                     01630000
016400         SELECT                                                   01640000
016500             CTL.BTCH_PRC_DTE                                     01650000
016600         ,   YEAR(CTL.BTCH_PRC_DTE)                               01660000
016700         ,   DTE.FSCL_MN_BEG_DTE                                  01670000
016800         ,   DTE.FSCL_MN_END_DTE                                  01680000
016900         ,   DTE.FSCL_YR_BEG_DTE                                  01690000
017000         ,   DTE.FSCL_YR_END_DTE                                  01700000
017100         ,   DTE.FSCL_WK_BEG_DTE                                  01710000
017200         ,   DTE.FSCL_WK_END_DTE                                  01720000
017300         ,   DTE.SEA_BEG_DTE                                      01730000
017400         ,   DTE.SEA_END_DTE                                      01740000
017500         INTO                                                     01750000
017600             :COCNTL-BTCH-PRC-DTE                                 01760000
017700         ,   :PV-CURR-YEAR                                        01770000
017800         ,   :DTATTR-FSCL-MN-BEG-DTE                              01780000
017900         ,   :DTATTR-FSCL-MN-END-DTE                              01790000
018000         ,   :DTATTR-FSCL-YR-BEG-DTE                              01800000
018100         ,   :DTATTR-FSCL-YR-END-DTE                              01810000
018200         ,   :DTATTR-FSCL-WK-BEG-DTE                              01820000
018300         ,   :DTATTR-FSCL-WK-END-DTE                              01830000
018400         ,   :DTATTR-SEA-BEG-DTE                                  01840000
018500         ,   :DTATTR-SEA-END-DTE                                  01850000
018600         FROM                                                     01860000
018700             TCOCNTL CTL                                          01870000
018800           , TDTATTR DTE                                          01880000
018900         WHERE                                                    01890000
019000             CTL.BTCH_PRC_DTE = DTE.KY_DTE                        01900000
019100         AND OPER_UNT_ID = 90                                     01910000
019200         WITH UR                                                  01920000
019300     END-EXEC.                                                    01930000
019400                                                                  01940000
019500     EVALUATE TRUE                                                01950000
019600         WHEN SQLCODE = ZERO                                      01960000
019700         WHEN SQLCODE = -904                                      01970000
019800         WHEN SQLCODE = -911                                      01980000
019900         WHEN SQLCODE = -913                                      01990000
020000             CONTINUE                                             02000000
020100         WHEN SQLWARN0 NOT = SPACE                                02010000
020200         WHEN SQLCODE  NOT = ZERO                                 02020000
020300             MOVE '7000-GET-FISCAL-INFO'                          02030000
020400                                       TO PV-ABEND-PARAGRAPH      02040000
020500             MOVE 'SELECT'                                        02050000
020600                                       TO PV-ABEND-OPERATION      02060000
020700             MOVE 'TCOCNTL' TO PV-ABEND-STRUCTURE-1               02070000
020800             MOVE 'TDTATTR' TO PV-ABEND-STRUCTURE-2               02080000
020900             PERFORM 9900-DB2-ABEND                               02090000
021000     END-EVALUATE.                                                02100000
021100                                                                  02110000
021200 8000-READ-CONTROL-REC.                                           02120000
021300                                                                  02130000
021400     READ OLD-CONTROL-FILE INTO                                   02140000
021500           SU032-DATE-CONTROL-REC                                 02150000
021600     AT END                                                       02160000
021700         SET PS-END-EXTRACT           TO TRUE                     02170000
021800     NOT AT END                                                   02180000
021900         ADD 1                        TO PV-READ-COUNT            02190000
022000         DISPLAY 'ORIGINAL CONTROL CARD:'                         02200000
022100         DISPLAY SU032-DATE-CONTROL-REC                           02210000
022200         DISPLAY SPACES                                           02220000
022300     END-READ.                                                    02230000
022400                                                                  02240000
022500 8100-WRITE-CONTROL-REC.                                          02250000
022600                                                                  02260000
022700     ADD 1                         TO PV-WRITE-COUNT              02270000
022800     WRITE NEW-CONTROL-RECORD FROM                                02280000
022900           SU032-DATE-CONTROL-REC.                                02290000
023000/                                                                 02300000
023100 9000-TERMINATE.                                                  02310000
023200                                                                  02320000
023300     CLOSE OLD-CONTROL-FILE                                       02330000
023400           NEW-CONTROL-FILE                                       02340000
023500                                                                  02350000
023600     DISPLAY '************************'.                          02360000
023700     DISPLAY '******* SUKUT065 *******'.                          02370000
023800     DISPLAY '************************'.                          02380000
023900     DISPLAY SPACES                                               02390000
024000                                                                  02400000
024100     DISPLAY 'GENERATED CONTROL CARD:'                            02410000
024200     DISPLAY SU032-DATE-CONTROL-REC                               02420000
024300     DISPLAY SPACES                                               02430000
024400                                                                  02440000
024500     DISPLAY 'BATCH CONTROL DATE = ' COCNTL-BTCH-PRC-DTE          02450000
024600                                                                  02460000
024700     MOVE PV-READ-COUNT               TO PV-DISP-NBR              02470000
024800     DISPLAY 'CONTROL CARDS READ         = ' PV-DISP-NBR          02480000
024900                                                                  02490000
025000     MOVE PV-WRITE-COUNT              TO PV-DISP-NBR              02500000
025100     DISPLAY 'CONTROL CARDS WRITTEN      = ' PV-DISP-NBR          02510000
025200     DISPLAY SPACES                                               02520000
025300     DISPLAY '************************'.                          02530000
025400                                                                  02540000
025500 9900-DB2-ABEND.                                                  02550000
025600                                                                  02560000
025700     MOVE SQLCODE TO PV-SQLCODE.                                  02570000
025800     DISPLAY '*** DB2 ERROR '.                                    02580000
025900     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       02590000
026000     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 02600000
026100     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               02610000
026200     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               02620000
026300     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       02630000
026400     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       02640000
026500     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       02650000
026600     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             02660000
026700                                                                  02670000
026800     IF PV-ABEND-STRUCTURE-2 > SPACES                             02680000
026900         DISPLAY '*** TABLE 2   = ' PV-ABEND-STRUCTURE-2          02690000
027000     END-IF.                                                      02700000
027100                                                                  02710000
027200                                                                  02720000
027300     COPY DPPD004.                                                02730004
027400                                                                  02740000
027500     MOVE +4013                  TO PV-ABEND-CODE.                02750000
027600     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         02760000
027700                                                                  02770000
027800 9200-ABEND.                                                      02780000
027900******************************************************************02790000
028000*  PERFORMS A NON-SQL ABEND FOR THE PROGRAM                       02800000
028100******************************************************************02810000
028200     DISPLAY '***************************'.                       02820000
028300     DISPLAY '**       ABEND           **'.                       02830000
028400     DISPLAY '**  IN PROGRAM SUKUT065  **'.                       02840000
028500     DISPLAY '***************************'.                       02850000
028600     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        02860000
028700     DISPLAY '**                 ** = ' PV-ERROR-MESSAGE-1.       02870000
028800     DISPLAY '**                 ** = ' PV-ERROR-MESSAGE-2.       02880000
028900                                                                  02890000
029000     MOVE +4014                  TO PV-ABEND-CODE.                02900000
029100     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         02910000
029200                                                                  02920000
