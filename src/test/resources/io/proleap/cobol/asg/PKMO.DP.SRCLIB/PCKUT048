000100 IDENTIFICATION DIVISION.                                         00010012
000200 TITLE 'SEPARATE STORE EXPECTED DETAILS BY DATE'.                 00020012
000300                                                                  00030012
000400 PROGRAM-ID.             PCKUT048.                                00040012
000500 AUTHOR.                 DENNIS STEFFEN.                          00050012
000600 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00060012
000700 DATE-WRITTEN            MAY 2005.                                00070012
000800 DATE-COMPILED.                                                   00080012
000900                                                                  00090012
001000 ENVIRONMENT DIVISION.                                            00100012
001100 CONFIGURATION SECTION.                                           00110012
001200                                                                  00120012
001300 SOURCE-COMPUTER.        IBM-3090.                                00130012
001400 OBJECT-COMPUTER.        IBM-3090.                                00140012
001500                                                                  00150012
001600 INPUT-OUTPUT SECTION.                                            00160012
001700                                                                  00170012
001800 FILE-CONTROL.                                                    00180012
001900                                                                  00190012
002000     SELECT UNBALANCED-SUMMARY-FILE                               00200012
002100         ASSIGN TO INP01.                                         00210012
002200                                                                  00220012
002300     SELECT ALL-TYPE-SE-FILE                                      00230012
002400         ASSIGN TO INP02.                                         00240012
002500                                                                  00250012
002600     SELECT STORE-EXPECTED-GT-21                                  00260012
002700         ASSIGN TO OUT01.                                         00270012
002800                                                                  00280012
002900 DATA DIVISION.                                                   00290012
003000 FILE SECTION.                                                    00300012
003100                                                                  00310012
003200 FD  UNBALANCED-SUMMARY-FILE                                      00320012
003300     RECORDING MODE IS F                                          00330012
003400     LABEL RECORDS ARE STANDARD                                   00340012
003500     BLOCK CONTAINS 0 RECORDS.                                    00350012
003600                                                                  00360012
003700 01  UNBALANCED-SUMMARY-REC           PIC X(035).                 00370012
003800                                                                  00380012
003900 FD  ALL-TYPE-SE-FILE                                             00390012
004000     RECORDING MODE IS F                                          00400012
004100     LABEL RECORDS ARE STANDARD                                   00410012
004200     BLOCK CONTAINS 0 RECORDS.                                    00420012
004300                                                                  00430012
004400 01  ALL-TYPE-SE-RECORD               PIC  X(048).                00440012
004500                                                                  00450012
004600 FD  STORE-EXPECTED-GT-21                                         00460012
004700     RECORDING MODE IS F                                          00470012
004800     LABEL RECORDS ARE STANDARD                                   00480012
004900     BLOCK CONTAINS 0 RECORDS.                                    00490012
005000                                                                  00500012
005100 01  STORE-EXPECTED-GT-21-REC         PIC X(035).                 00510012
005200                                                                  00520012
005300 WORKING-STORAGE SECTION.                                         00530012
005400                                                                  00540012
005500 01  FILLER.                                                      00550012
005600     05  FILLER                      PIC  X(36)    VALUE          00560012
005700         ' ***** WORKING STORAGE PGM=PCKUT048 '.                  00570012
005800     05  PGM-COMPILED                PIC  X(20)    VALUE SPACE.   00580012
005900                                                                  00590012
006000 01  PS-SWITCHES.                                                 00600012
006100*    DON'T MESS WITH THESE.  THEY CONTROL THE MATCH PROCESSING    00610012
006200     05  PS-EOF-DETAIL-SW             PIC X(01) VALUE 'N'.        00620012
006300         88  PS-EOF-DETAIL-YES                  VALUE 'Y'.        00630012
006400         88  PS-EOF-DETAIL-NO                   VALUE 'N'.        00640012
006500     05  PS-EOF-SUMMRY-SW             PIC X(01) VALUE 'N'.        00650012
006600         88  PS-EOF-SUMMRY-YES                  VALUE 'Y'.        00660012
006700         88  PS-EOF-SUMMRY-NO                   VALUE 'N'.        00670012
006800     05  PS-DETAIL-CATCHUP-SW         PIC X(01) VALUE 'N'.        00680012
006900         88  PS-DETAIL-CATCHUP-YES              VALUE 'Y'.        00690012
007000         88  PS-DETAIL-CATCHUP-NO               VALUE 'N'.        00700012
007100                                                                  00710012
007200 01  PV-SYSIN-CARD.                                               00720012
007300     05  PV-SYSIN-DATE                PIC X(010).                 00730012
007400     05  FILLER                       PIC X(070).                 00740012
007500                                                                  00750012
007600****************************************************************  00760012
007700*        THESE KEYS CONTROL THE OUTER LOOP OF PO/RCVR             00770012
007800 01  PV-MATCH-KEYS.                                               00780012
007900     05  PV-MATCH-DTL-KEY.                                        00790012
008000         10  PV-MATCH-DTL-PO          PIC 9(10) VALUE ZERO.       00800012
008100         10  PV-MATCH-DTL-RCVR        PIC S9(10) VALUE ZERO.      00810012
008200                                                                  00820012
008300     05  PV-MATCH-SUM-KEY.                                        00830012
008400         10  PV-MATCH-SUM-PO          PIC 9(10) VALUE ZERO.       00840012
008500         10  PV-MATCH-SUM-RCVR        PIC S9(10) VALUE ZERO.      00850012
008600                                                                  00860012
008700*        THESE KEYS CONTROL THE INNER LOOP OF PO/RCVR/UPC/LOC     00870012
008800 01  PV-INNER-KEYS.                                               00880012
008900     05  PV-DETAIL-INNER-KEY.                                     00890012
009000         10  PV-DETAIL-INNER-PO       PIC 9(10) VALUE ZERO.       00900012
009100         10  PV-DETAIL-INNER-RCVR     PIC S9(10) VALUE ZERO.      00910012
009300                                                                  00930012
009400         10  PV-DETAIL-INNER-UPC      PIC S9(10)  VALUE ZEROES    00940012
009500                                                COMP.             00950012
009600         10  FILLER REDEFINES PV-DETAIL-INNER-UPC.                00960012
009700             15  FILLER               PIC X(04).                  00970012
009800             15  PV-DET-UPC-ID-4      PIC X(04).                  00980012
009900             15  PV-DET-UPC-SPC REDEFINES PV-DET-UPC-ID-4         00990012
010000                                      PIC S9(9)                   01000012
010100                                               COMP.              01010012
010200                                                                  01020012
010300         10  PV-DETAIL-INNER-LOC      PIC 9(05) VALUE ZERO.       01030012
010400                                                                  01040012
010500     05  PV-MASTER-INNER-KEY.                                     01050012
010600         10  PV-MASTER-INNER-PO       PIC 9(10) VALUE ZERO.       01060012
010700         10  PV-MASTER-INNER-RCVR     PIC S9(10) VALUE ZERO.      01070012
010900                                                                  01090012
011000         10  PV-MASTER-INNER-UPC      PIC S9(10)  VALUE ZEROES    01100012
011100                                                COMP.             01110012
011200         10  FILLER REDEFINES PV-MASTER-INNER-UPC.                01120012
011300             15  FILLER               PIC X(04).                  01130012
011400             15  PV-MST-UPC-ID-4      PIC X(04).                  01140012
011500             15  PV-MST-UPC-SPC REDEFINES PV-MST-UPC-ID-4         01150012
011600                                      PIC S9(9)                   01160012
011700                                               COMP.              01170012
011800                                                                  01180012
011900         10  PV-MASTER-INNER-LOC      PIC 9(05) VALUE ZERO.       01190012
012000****************************************************************  01200012
012100                                                                  01210012
012200 01  PV-TYPE-TOTALS.                                              01220012
012300     05  PV-AR-TOTAL                  PIC S9(09) COMP-3           01230012
012400                                                 VALUE ZERO.      01240012
012500     05  PV-UN-TOTAL                  PIC S9(09) COMP-3           01250012
012600                                                 VALUE ZERO.      01260012
012700     05  PV-PERCENT                   PIC S9(04)V9(05) COMP-3     01270012
012800                                                 VALUE ZERO.      01280012
012900     05  DK-PERCENT                   PIC S9(09) COMP             01290012
013000                                                 VALUE ZERO.      01300012
013100/                                                                 01310012
013200 01  PC-CONSTANTS.                                                01320012
013300     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          01330012
013400                                                   'PCKUT048'.    01340012
013500     05  PC-ILBOABN0                 PIC  X(08)    VALUE          01350012
013600                                                   'ILBOABN0'.    01360012
013700     05  PC-MAX-RETRIES              PIC S9(04)    VALUE  +3      01370012
013800                                                   COMP.          01380012
013900                                                                  01390012
014000 01  PV-MISC-STUFF.                                               01400012
014100     05  PV-NEAR-DATE                 PIC X(10).                  01410012
014200     05  PV-FAR-DATE                  PIC X(10).                  01420012
014300     05  PV-LATEST-DATE               PIC X(10).                  01430012
014400     05  PV-OFFSET                    PIC S9(04) COMP VALUE ZERO. 01440012
014500     05  PV-BOSS-PARM-RECV            PIC S9(09) COMP.            01450012
014600     05  PV-BOSS-PARM-DISP            PIC -9(04).                 01460012
014700     05  PV-BOSS-PARM-DATE            PIC  X(10).                 01470012
014701                                                                  01470114
014702* DMH - 5-06-2021 - BEGIN                                         01470214
014710     05  PV-FAR-DATE-SEPH-SUPP        PIC X(10).                  01471014
014711     05  PV-FAR-DATE-SEPH-DIFF        PIC X(10).                  01471114
014712* DMH - 5-06-2021 - END                                           01471214
014720                                                                  01472014
014800     05  PV-ABEND-PARAGRAPH           PIC  X(30) VALUE SPACES.    01480012
014900     05  PV-DB2-OPERATION-ATTEMPTED   PIC  X(60) VALUE SPACE.     01490012
015000     05  PV-SQL-CODE                  PIC  9(04) VALUE ZERO.      01500012
015100     05  PV-ABEND-CODE                PIC S9(04) VALUE ZERO       01510012
015200                                                   COMP SYNC.     01520012
015300     05  PV-RETRY-COUNTER             PIC S9(04) VALUE ZERO       01530012
015400                                                 COMP SYNC.       01540012
015500     05  PV-READ-COUNTER-DTL          PIC S9(09) COMP-3           01550012
015600                                              VALUE ZERO.         01560012
015700     05  PV-READ-COUNTER-SUM          PIC S9(09) COMP-3           01570012
015800                                              VALUE ZERO.         01580012
015900     05  PV-WRITE-1-COUNTER           PIC S9(09) COMP-3           01590012
016000                                              VALUE ZERO.         01600012
016100     05  PV-WRITE-2-COUNTER           PIC S9(09) COMP-3           01610012
016200                                              VALUE ZERO.         01620012
016300     05  PV-WRITE-6-COUNTER           PIC S9(09) COMP-3           01630012
016400                                              VALUE ZERO.         01640012
016500     05  PV-SKIP-COUNT                PIC S9(09) COMP-3           01650012
016600                                              VALUE ZERO.         01660012
016700     05  PV-BOSS-COUNT                PIC S9(09) COMP-3           01670012
016800                                              VALUE ZERO.         01680012
016801                                                                  01680114
016802* DMH - 5-06-2021 - BEGIN                                         01680214
016810     05  PV-SKIP-COUNT-SEPH-SUPP      PIC S9(09) COMP-3           01681015
016820                                              VALUE ZERO.         01682014
016830     05  PV-SKIP-COUNT-SEPH-DIFF      PIC S9(09) COMP-3           01683015
016840                                              VALUE ZERO.         01684014
016860* DMH - 5-06-2021 - END                                           01686014
016870                                                                  01687014
016900     05  PV-BYPASS-COUNT              PIC S9(09) COMP-3           01690012
017000                                              VALUE ZERO.         01700012
017100     05  PV-DISP-NBR                  PIC ZZZ,ZZZ,ZZ9.            01710012
017200     05  PV-ABEND-OPERATION           PIC X(20) VALUE SPACES.     01720012
017300     05  PV-ABEND-STRUCTURE-1         PIC X(20) VALUE SPACES.     01730012
017400                                                                  01740012
017500 01  ABEND-CODE                       PIC S9(04)     VALUE +0     01750012
017600                                                     COMP SYNC.   01760012
017700     88  ABEND-4001-WRITE-ERROR                      VALUE +4001. 01770012
017800     88  ABEND-4002-READ-ERROR                       VALUE +4002. 01780012
017900     88  ABEND-4003-CTRL-CARD-ERROR                  VALUE +4003. 01790012
018000     88  ABEND-4004-TABLE-ERROR                      VALUE +4004. 01800012
018100     88  ABEND-4005-OPEN-ERROR                       VALUE +4005. 01810012
018200     88  ABEND-4006-CLOSE-ERROR                      VALUE +4006. 01820012
018300     88  ABEND-4007-SEQUENCE-ERROR                   VALUE +4007. 01830012
018400     88  ABEND-4008-DATS-ERROR                       VALUE +4008. 01840012
018500     88  ABEND-4009-KEY-DATS-ERROR                   VALUE +4009. 01850012
018600     88  ABEND-4013-DB2-ERROR                        VALUE +4013. 01860012
018700                                                                  01870012
018800 01  PV-COUNT-MSG-1.                                              01880012
018900     05  FILLER                       PIC X(38) VALUE             01890012
019000         'RECORDS WRITTEN TO OUT01 (OLDER THAN '.                 01900012
019100     05  PV-MSG-1-LIT                 PIC X(10).                  01910012
019200     05  FILLER                       PIC X(21) VALUE             01920012
019300         ')  = '.                                                 01930012
019400     05  PV-MSG-1-COUNT               PIC ZZZ,ZZZ,ZZ9.            01940012
019500                                                                  01950012
019600 01  PV-COUNT-MSG-2.                                              01960012
019700     05  FILLER                       PIC X(35) VALUE             01970012
019800         'RECORDS WRITTEN TO OUT02 (BETWEEN '.                    01980012
019900     05  PV-MSG-2-LIT1                PIC X(10).                  01990012
020000     05  FILLER                       PIC X(05) VALUE             02000012
020100         ' AND '.                                                 02010012
020200     05  PV-MSG-2-LIT2                PIC X(10).                  02020012
020300     05  FILLER                       PIC X(09) VALUE             02030012
020400         ' ) = '.                                                 02040012
020500     05  PV-MSG-2-COUNT2              PIC ZZZ,ZZZ,ZZ9.            02050012
020600                                                                  02060012
020700 01  PV-COUNT-MSG-3.                                              02070012
020800     05  FILLER                       PIC X(35) VALUE             02080012
020900         'RECORDS SKIPPED =                 '.                    02090012
021000     05  FILLER                       PIC X(15) VALUE             02100012
021100         SPACES.                                                  02110012
021200     05  FILLER                       PIC X(19) VALUE             02120012
021300         SPACES.                                                  02130012
021400     05  PV-MSG-SKIP-COUNT            PIC ZZZ,ZZZ,ZZ9.            02140012
021500                                                                  02150012
021600 01  PV-COUNT-MSG-4.                                              02160012
021700     05  FILLER                       PIC X(35) VALUE             02170012
021800         'DETAIL RECORDS READ =             '.                    02180012
021900     05  FILLER                       PIC X(34) VALUE             02190012
022000         SPACES.                                                  02200012
022100     05  PV-MSG-READ-COUNT            PIC ZZZ,ZZZ,ZZ9.            02210012
022200                                                                  02220012
022300 01  PV-COUNT-MSG-5.                                              02230012
022400     05  FILLER                       PIC X(35) VALUE             02240012
022500         'OUT OF BALANCE RECORDS READ=      '.                    02250012
022600     05  FILLER                       PIC X(34) VALUE             02260012
022700         SPACES.                                                  02270012
022800     05  PV-MSG-READ-COUNT5           PIC ZZZ,ZZZ,ZZ9.            02280012
022900                                                                  02290012
023000 01  PV-COUNT-MSG-6.                                              02300012
023100     05  FILLER                       PIC X(35) VALUE             02310012
023200         'RECORDS WRITTEN TO OUT03          '.                    02320012
023300     05  FILLER                       PIC X(34) VALUE             02330012
023400         SPACES.                                                  02340012
023500     05  PV-MSG-6-COUNT               PIC ZZZ,ZZZ,ZZ9.            02350012
023600                                                                  02360012
023700 01  PV-COUNT-MSG-7.                                              02370012
023800     05  FILLER                       PIC X(35) VALUE             02380012
023900         'BOSS RECORDS SKIPPED =            '.                    02390012
024000     05  FILLER                       PIC X(15) VALUE             02400012
024100         SPACES.                                                  02410012
024200     05  FILLER                       PIC X(19) VALUE             02420012
024300         SPACES.                                                  02430012
024400     05  PV-MSG-BOSS-COUNT            PIC ZZZ,ZZZ,ZZ9.            02440012
024500                                                                  02450012
024520 01  PV-COUNT-MSG-8.                                              02452014
024530     05  FILLER                       PIC X(35) VALUE             02453014
024540         'SEPHORA SUPPORT DC SKIPPED:       '.                    02454014
024550     05  FILLER                       PIC X(15) VALUE             02455014
024560         SPACES.                                                  02456014
024570     05  FILLER                       PIC X(19) VALUE             02457014
024580         SPACES.                                                  02458014
024590     05  PV-MSG-SEPH-SUPP-SKIP-CNT    PIC ZZZ,ZZZ,ZZ9.            02459014
024591                                                                  02459114
024592 01  PV-COUNT-MSG-9.                                              02459214
024593     05  FILLER                       PIC X(35) VALUE             02459314
024594         'SEPHORA DIFFERENT DC SKIPPED:     '.                    02459414
024595     05  FILLER                       PIC X(15) VALUE             02459514
024596         SPACES.                                                  02459614
024597     05  FILLER                       PIC X(19) VALUE             02459714
024598         SPACES.                                                  02459814
024599     05  PV-MSG-SEPH-DIFF-SKIP-CNT    PIC ZZZ,ZZZ,ZZ9.            02459914
024600                                                                  02460014
024610*    SE UNBALANCED FILE                                           02461012
024700     COPY PCRD037.                                                02470012
024800                                                                  02480012
024900*    GREATER-90-FILE                                              02490012
025000     COPY PCRD041.                                                02500012
025100/                                                                 02510012
025200*  PARAMETER TABLE                                                02520012
025300     EXEC SQL                                                     02530012
025400         INCLUDE TKRPRPM                                          02540012
025500     END-EXEC.                                                    02550012
025600                                                                  02560012
025700     EXEC SQL                                                     02570012
025800         INCLUDE SQLCA                                            02580012
025900     END-EXEC.                                                    02590012
026000                                                                  02600012
026100     COPY SQLCA2.                                                 02610012
026200                                                                  02620012
026300     COPY DPWS004.                                                02630012
026400/                                                                 02640012
026500 PROCEDURE DIVISION.                                              02650012
026600                                                                  02660012
026700     PERFORM 1000-INITIALIZATION.                                 02670012
026800                                                                  02680012
026900     PERFORM 2000-PROCESS UNTIL PS-EOF-DETAIL-YES                 02690012
027000                             OR PS-EOF-SUMMRY-YES                 02700012
027100                                                                  02710012
027200     PERFORM 9000-QUIT.                                           02720012
027300                                                                  02730012
027400     GOBACK.                                                      02740012
027500/                                                                 02750012
027600 1000-INITIALIZATION.                                             02760012
027700     MOVE '1000-INITIALIZATION         '  TO PV-ABEND-PARAGRAPH.  02770012
027800                                                                  02780012
027900*    OPEN THE EXTRACT FILES                                       02790012
028000     OPEN INPUT ALL-TYPE-SE-FILE                                  02800012
028100                UNBALANCED-SUMMARY-FILE                           02810012
028200     OPEN OUTPUT STORE-EXPECTED-GT-21                             02820012
028300                                                                  02830012
028400     PERFORM 8000-READ-DETAIL-EXTRACT.                            02840012
028500     PERFORM 8050-READ-SUMMRY-EXTRACT.                            02850012
028600                                                                  02860012
028700     IF PS-EOF-DETAIL-YES                                         02870012
028800         DISPLAY SPACES                                           02880012
028900         DISPLAY ALL '*'                                          02890012
029000         DISPLAY '  DETAIL INPUT FILE IS EMPTY '                  02900012
029100         DISPLAY ALL '*'                                          02910012
029200         DISPLAY SPACES                                           02920012
029300     END-IF                                                       02930012
029400                                                                  02940012
029500     IF PS-EOF-SUMMRY-YES                                         02950012
029600         DISPLAY SPACES                                           02960012
029700         DISPLAY ALL '*'                                          02970012
029800         DISPLAY '  SUMMARY INPUT FILE IS EMPTY '                 02980012
029900         DISPLAY ALL '*'                                          02990012
030000         DISPLAY SPACES                                           03000012
030100     END-IF                                                       03010012
030200                                                                  03020012
030300     IF PS-EOF-SUMMRY-YES AND PS-EOF-DETAIL-YES                   03030012
030400         CONTINUE                                                 03040012
030500     ELSE                                                         03050012
030600         ACCEPT PV-SYSIN-CARD FROM SYSIN                          03060012
030700         IF PV-SYSIN-CARD = LOW-VALUES OR SPACES                  03070012
030800             DISPLAY ALL '!'                                      03080012
030900             DISPLAY ' DATE CARD IS MISSING - JOB GO BOOM'        03090012
031000             DISPLAY SPACES                                       03100012
031100             PERFORM 9200-CROAK                                   03110012
031200         ELSE                                                     03120012
031300             DISPLAY 'PCKUT048 - DATE IS ' PV-SYSIN-DATE          03130012
031400         END-IF                                                   03140012
031500         PERFORM 7000-GET-FAR-DATE                                03150012
031600         PERFORM 7200-GET-BOSS-PARM-RCVR                          03160012
031700         PERFORM 7400-GET-BOSS-DATE                               03170012
031710         PERFORM 7410-GET-SEPH-SUPP-DATE                          03171014
031720         PERFORM 7420-GET-SEPH-DIFF-DATE                          03172014
031800     END-IF.                                                      03180012
031900/                                                                 03190012
032000 2000-PROCESS.                                                    03200012
032100                                                                  03210012
032200     MOVE '2000-PROCESS'                  TO PV-ABEND-PARAGRAPH.  03220012
032300                                                                  03230012
032400     EVALUATE TRUE                                                03240012
032500         WHEN PV-MATCH-DTL-KEY = PV-MATCH-SUM-KEY                 03250012
032600                                                                  03260012
032700*            A MATCH IS OCCURRING AFTER THE DETAILS WERE          03270012
032800*            READ TO CATCH UP WITH THE MASTERS.  THIS IMPLIES     03280012
032900*            A PO/RCVR CHANGE.                                    03290012
033000                                                                  03300012
033100             IF PS-DETAIL-CATCHUP-YES                             03310012
033200                SET PS-DETAIL-CATCHUP-NO                          03320012
033300                                      TO TRUE                     03330012
033400                PERFORM 2200-PO-RCVR-BREAK                        03340012
033500             END-IF                                               03350012
033600                                                                  03360012
033700*            NOW WE CAN PROCEED WITH THE NORMAL PROCESSING        03370012
033800*            OF A MATCHED PO/RCVR                                 03380012
033900                                                                  03390012
034000             IF PC037-TRN-TYP-CDE = 'AR'                          03400012
034100                 ADD PC037-TRN-CLSN-PRCG-QTY                      03410012
034200                                      TO PV-AR-TOTAL              03420012
034300             ELSE                                                 03430012
034400                 ADD PC037-TRN-CLSN-PRCG-QTY                      03440012
034500                                      TO PV-UN-TOTAL              03450012
034600             END-IF                                               03460012
034700                                                                  03470012
034800*            A FURTHER MATCH ON UPC/LOC                           03480012
034900             EVALUATE TRUE                                        03490012
035000             WHEN PV-DETAIL-INNER-KEY = PV-MASTER-INNER-KEY       03500012
035100                                                                  03510012
035200*                SAVE THE LATEST DATE OF THE GROUP                03520012
035300                 IF PC037-IN-TRNST-TRN-TMST (1:10) >              03530012
035400                             PV-LATEST-DATE                       03540012
035500                     MOVE PC037-IN-TRNST-TRN-TMST (1:10)          03550012
035600                                      TO PV-LATEST-DATE           03560012
035700                 END-IF                                           03570012
035800                                                                  03580012
035900                 PERFORM 8000-READ-DETAIL-EXTRACT                 03590012
036000                                                                  03600012
036100             WHEN PV-DETAIL-INNER-KEY > PV-MASTER-INNER-KEY       03610012
036200                                                                  03620012
036300*                END OF UPC/LOC GROUP                             03630012
036400                 PERFORM 2100-WRITE-EM-OUT                        03640012
036500                 PERFORM 8050-READ-SUMMRY-EXTRACT                 03650012
036600                                                                  03660012
036700             WHEN PV-DETAIL-INNER-KEY < PV-MASTER-INNER-KEY       03670012
036800                                                                  03680012
036900*                END OF UPC/LOC GROUP                             03690012
037000                 PERFORM 8000-READ-DETAIL-EXTRACT                 03700012
037100                                                                  03710012
037200             END-EVALUATE                                         03720012
037300                                                                  03730012
037400                                                                  03740012
037500         WHEN PV-MATCH-DTL-KEY > PV-MATCH-SUM-KEY                 03750012
037600                                                                  03760012
037700*            END OF PO/RCVR GROUP                                 03770012
037800*            CALC PERCENTAGE AND WRITE PO/RCVR SUMMARY REC        03780012
037900*            THEN READ ANOTHER SUMMARY RECORD                     03790012
038000                                                                  03800012
038100             PERFORM 2100-WRITE-EM-OUT                            03810012
038200             PERFORM 2200-PO-RCVR-BREAK                           03820012
038300                                                                  03830012
038400         WHEN PV-MATCH-DTL-KEY < PV-MATCH-SUM-KEY                 03840012
038500                                                                  03850012
038600*            KEEP READING DETAILS UNTIL A MATCH WITH SUMMARY      03860012
038700             SET PS-DETAIL-CATCHUP-YES TO TRUE                    03870012
038800             PERFORM 8000-READ-DETAIL-EXTRACT                     03880012
038900     END-EVALUATE.                                                03890012
039000                                                                  03900012
039100 2100-WRITE-EM-OUT.                                               03910012
039200*    DISPLAY PV-LATEST-DATE ' / '                                 03920012
039300*            PC041-PO-NBR ' / '                                   03930012
039400*            PC041-RCVR-SEQ-NBR ' / '                             03940012
039500*            PC041-INTR-UPC-ID  ' / '                             03950012
039600*            PC041-LOC-NBR                                        03960012
039700                                                                  03970012
039800     MULTIPLY PC041-TRN-CLSN-QTY BY -1 GIVING PC041-TRN-CLSN-QTY  03980012
039900                                                                  03990012
040000     IF PC041-RCVR-SEQ-NBR = PV-BOSS-PARM-RECV                    04000012
040100         EVALUATE TRUE                                            04010012
040200            WHEN PV-LATEST-DATE <= PV-BOSS-PARM-DATE              04020012
040300                MOVE 'Y'                 TO PC041-BOSS-INDICATOR  04030012
040400                PERFORM 8100-WRITE                                04040012
040500                                                                  04050012
040600             WHEN OTHER                                           04060012
040700                ADD 1                    TO PV-BOSS-COUNT         04070012
040800                                                                  04080012
040900         END-EVALUATE                                             04090012
041000     ELSE                                                         04100012
041001*                                                                 04100114
041002* DMH - 5-06-2021 - BEGIN                                         04100214
041004         IF  PC041-SEPHORA                                        04100414
041007             IF  PC041-SEPHORA-SUPPORT-DC                         04100714
041008                 EVALUATE TRUE                                    04100814
041009                     WHEN PV-LATEST-DATE <= PV-FAR-DATE-SEPH-SUPP 04100914
041013                          PERFORM 8100-WRITE                      04101314
041015                     WHEN OTHER                                   04101514
041019                          ADD 1      TO PV-SKIP-COUNT-SEPH-SUPP   04101914
041020                 END-EVALUATE                                     04102014
041021             ELSE                                                 04102114
041023                 EVALUATE TRUE                                    04102314
041024                     WHEN PV-LATEST-DATE <= PV-FAR-DATE-SEPH-DIFF 04102414
041027                          PERFORM 8100-WRITE                      04102714
041028                     WHEN OTHER                                   04102814
041031                          ADD 1      TO PV-SKIP-COUNT-SEPH-DIFF   04103114
041032                 END-EVALUATE                                     04103214
041033             END-IF                                               04103314
041034* DMH - 5-06-2021 - END                                           04103414
041035*                                                                 04103514
041040         ELSE                                                     04104014
041100             EVALUATE TRUE                                        04110014
041200                 WHEN PV-LATEST-DATE <= PV-FAR-DATE               04120014
041600                      PERFORM 8100-WRITE                          04160014
041800                 WHEN OTHER                                       04180014
042200                      ADD 1          TO PV-SKIP-COUNT             04220014
042300             END-EVALUATE                                         04230014
042400         END-IF                                                   04240014
042410     END-IF.                                                      04241014
042500                                                                  04250012
042600     MOVE '0001-01-01'                TO PV-LATEST-DATE.          04260012
042700                                                                  04270012
042800 2200-PO-RCVR-BREAK.                                              04280012
042900                                                                  04290012
043000     IF PV-AR-TOTAL = ZERO OR PV-UN-TOTAL = ZERO                  04300012
043100         MOVE 100                     TO PV-PERCENT               04310012
043200     ELSE                                                         04320012
043300         IF PV-AR-TOTAL < ZERO                                    04330012
043400            MULTIPLY PV-AR-TOTAL BY -1 GIVING PV-AR-TOTAL         04340012
043500         END-IF                                                   04350012
043600                                                                  04360012
043700         IF PV-UN-TOTAL < ZERO                                    04370012
043800            MULTIPLY PV-UN-TOTAL BY -1 GIVING PV-UN-TOTAL         04380012
043900         END-IF                                                   04390012
044000                                                                  04400012
044100         EVALUATE TRUE                                            04410012
044200             WHEN PV-UN-TOTAL > PV-AR-TOTAL                       04420012
044300                 COMPUTE PV-PERCENT = (PV-AR-TOTAL / PV-UN-TOTAL) 04430012
044400                                  * 100                           04440012
044500             WHEN PV-UN-TOTAL < PV-AR-TOTAL                       04450012
044600                 COMPUTE PV-PERCENT = (PV-UN-TOTAL / PV-AR-TOTAL) 04460012
044700                                  * 100                           04470012
044800             WHEN OTHER                                           04480012
044900                 MOVE ZERO            TO PV-PERCENT               04490012
045000         END-EVALUATE                                             04500012
045100     END-IF.                                                      04510012
045200                                                                  04520012
045300     EVALUATE TRUE                                                04530012
045400     WHEN PV-DETAIL-INNER-KEY > PV-MASTER-INNER-KEY               04540012
045500         IF PS-EOF-SUMMRY-NO                                      04550012
045600             PERFORM 8050-READ-SUMMRY-EXTRACT                     04560012
045700         END-IF                                                   04570012
045800     WHEN PV-MASTER-INNER-KEY > PV-DETAIL-INNER-KEY               04580012
045900         IF PS-EOF-DETAIL-NO                                      04590012
046000             PERFORM 8000-READ-DETAIL-EXTRACT                     04600012
046100         END-IF                                                   04610012
046200     END-EVALUATE                                                 04620012
046300                                                                  04630012
046400     MOVE ZERO                        TO PV-AR-TOTAL              04640012
046500                                         PV-UN-TOTAL.             04650012
046600     MOVE '0001-01-01'                TO PV-LATEST-DATE.          04660012
046700/                                                                 04670012
046800 7000-GET-FAR-DATE.                                               04680012
046900                                                                  04690012
047000     MOVE '7000-GET-FAR-DATE'         TO PV-ABEND-PARAGRAPH.      04700012
047100                                                                  04710012
047200     PERFORM                                                      04720012
047300         WITH TEST AFTER                                          04730012
047400         VARYING PV-RETRY-COUNTER                                 04740012
047500         FROM 1 BY 1                                              04750012
047600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               04760012
047700            OR  (SQLCODE = +100)                                  04770012
047800            OR  (SQLCODE = +0))                                   04780012
047900                                                                  04790012
048000         EXEC SQL                                                 04800012
048100             SELECT DATE(DAYS(:PV-SYSIN-DATE) - FUNC_QTY)         04810012
048200             INTO :PV-FAR-DATE                                    04820012
048300             FROM                                                 04830012
048400                 TKRPRPM P                                        04840012
048500             WHERE                                                04850012
048600                 P.LOC_ID            = 90                         04860012
048700             AND P.INTFC_SYS_CDE     = 'KHL'                      04870012
048800             AND P.SYS_PRC_FUNC_CDE  = 'CLEAN4'                   04880012
048900             AND P.FUNC_PRC_STAT_CDE = 'AC'                       04890012
049000             WITH UR                                              04900012
049100         END-EXEC                                                 04910012
049200                                                                  04920012
049300         EVALUATE TRUE                                            04930012
049400             WHEN SQLCODE = ZERO                                  04940012
049500             WHEN SQLCODE = +100                                  04950012
049600                  DISPLAY ' CALCULATED PARM DATE= ' PV-FAR-DATE   04960012
049610                          '                    CLEAN4'            04961016
049700             WHEN SQLCODE = -904                                  04970012
049800             WHEN SQLCODE = -911                                  04980012
049900             WHEN SQLCODE = -913                                  04990012
050000                  CONTINUE                                        05000012
050100                                                                  05010012
050200             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              05020012
050300                 DISPLAY '**************************************' 05030012
050400                 DISPLAY 'WARNING ISSUED '                        05040012
050500                 DISPLAY 'SELECT TKRPRPM                        ' 05050012
050600                 DISPLAY '**************************************' 05060012
050700                 PERFORM 9800-SQL-WARNING                         05070012
050800                                                                  05080012
050900             WHEN SQLCODE < ZERO                                  05090012
051000                 DISPLAY '**************************************' 05100012
051100                 DISPLAY 'ERROR ISSUED ON                       ' 05110012
051200                 DISPLAY 'SELECT TKRPRPM                        ' 05120012
051300                 DISPLAY '**************************************' 05130012
051400                 PERFORM 9900-SQL-ERROR                           05140012
051500                                                                  05150012
051600         END-EVALUATE                                             05160012
051700     END-PERFORM.                                                 05170012
051800                                                                  05180012
051900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    05190012
052000         SQLCODE NOT = ZERO                                       05200012
052100         DISPLAY '**************************************'         05210012
052200         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         05220012
052300         DISPLAY 'SELECT TKRPRPM         '                        05230012
052400         DISPLAY '**************************************'         05240012
052500         PERFORM 9900-SQL-ERROR                                   05250012
052600     END-IF.                                                      05260012
052700/                                                                 05270012
052800******************************************************************05280012
052900*- READ TKRPRPM TO RETRIEVE THE BOSS RECEIVER PARM                05290012
053000******************************************************************05300012
053100 7200-GET-BOSS-PARM-RCVR.                                         05310012
053200                                                                  05320012
053300     MOVE '7200-GET-BOSS-PARM-RCVR'   TO PV-ABEND-PARAGRAPH.      05330012
053400                                                                  05340012
053500     PERFORM                                                      05350012
053600         WITH TEST AFTER                                          05360012
053700         VARYING PV-RETRY-COUNTER                                 05370012
053800         FROM 1 BY 1                                              05380012
053900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05390012
054000            OR  (SQLCODE = +100)                                  05400012
054100            OR  (SQLCODE = +0))                                   05410012
054200                                                                  05420012
054300         EXEC SQL                                                 05430012
054400             SELECT FUNC_QTY                                      05440012
054500               INTO :PV-BOSS-PARM-RECV                            05450012
054600               FROM TKRPRPM                                       05460012
054700              WHERE LOC_ID            = 90                        05470012
054800                AND INTFC_SYS_CDE     = 'GIV'                     05480012
054900                AND SYS_PRC_FUNC_CDE  = 'BSSRCV'                  05490012
055000                AND FUNC_PRC_STAT_CDE = 'AC'                      05500012
055100               WITH UR                                            05510012
055200         END-EXEC                                                 05520012
055300                                                                  05530012
055400         EVALUATE TRUE                                            05540012
055500             WHEN SQLCODE = ZERO                                  05550012
055600             WHEN SQLCODE = +100                                  05560012
055700                  MOVE PV-BOSS-PARM-RECV TO PV-BOSS-PARM-DISP     05570012
055800                  DISPLAY ' BOSS PARM RECEIVER  = '               05580012
055900                                            PV-BOSS-PARM-DISP     05590012
056000                                                                  05600012
056100             WHEN SQLCODE = -904                                  05610012
056200             WHEN SQLCODE = -911                                  05620012
056300             WHEN SQLCODE = -913                                  05630012
056400                  CONTINUE                                        05640012
056500                                                                  05650012
056600             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              05660012
056700                 DISPLAY '**************************************' 05670012
056800                 DISPLAY 'WARNING ISSUED '                        05680012
056900                 DISPLAY 'SELECT TKRPRPM - BOSS RECEIVER        ' 05690012
057000                 DISPLAY '**************************************' 05700012
057100                 PERFORM 9800-SQL-WARNING                         05710012
057200                                                                  05720012
057300             WHEN SQLCODE < ZERO                                  05730012
057400                 DISPLAY '**************************************' 05740012
057500                 DISPLAY 'ERROR ISSUED ON                       ' 05750012
057600                 DISPLAY 'SELECT TKRPRPM - BOSS RECEIVER        ' 05760012
057700                 DISPLAY '**************************************' 05770012
057800                 PERFORM 9900-SQL-ERROR                           05780012
057900                                                                  05790012
058000         END-EVALUATE                                             05800012
058100     END-PERFORM.                                                 05810012
058200                                                                  05820012
058300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    05830012
058400         SQLCODE NOT = ZERO                                       05840012
058500         DISPLAY '**************************************'         05850012
058600         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         05860012
058700         DISPLAY 'SELECT TKRPRPM - BOSS RECEIVER '                05870012
058800         DISPLAY '**************************************'         05880012
058900         PERFORM 9900-SQL-ERROR                                   05890012
059000     END-IF.                                                      05900012
059100                                                                  05910012
059200******************************************************************05920012
059300*- READ TKRPRPM TO RETRIEVE THE BOSS DATE                         05930012
059400******************************************************************05940012
059500 7400-GET-BOSS-DATE.                                              05950012
059600                                                                  05960012
059700     MOVE '7400-GET-BOSS-DATE'        TO PV-ABEND-PARAGRAPH.      05970012
059800                                                                  05980012
059900     PERFORM                                                      05990012
060000         WITH TEST AFTER                                          06000012
060100         VARYING PV-RETRY-COUNTER                                 06010012
060200         FROM 1 BY 1                                              06020012
060300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06030012
060400            OR  (SQLCODE = +100)                                  06040012
060500            OR  (SQLCODE = +0))                                   06050012
060600                                                                  06060012
060700         EXEC SQL                                                 06070012
060800             SELECT DATE(DAYS(:PV-SYSIN-DATE) - FUNC_QTY)         06080012
060900               INTO :PV-BOSS-PARM-DATE                            06090012
061000               FROM TKRPRPM                                       06100012
061100              WHERE LOC_ID            = 90                        06110012
061200                AND INTFC_SYS_CDE     = 'KHL'                     06120012
061300                AND SYS_PRC_FUNC_CDE  = 'CLEAN8'                  06130012
061400                AND FUNC_PRC_STAT_CDE = 'AC'                      06140012
061500             WITH UR                                              06150012
061600         END-EXEC                                                 06160012
061700                                                                  06170012
061800         EVALUATE TRUE                                            06180012
061900             WHEN SQLCODE = ZERO                                  06190012
062000             WHEN SQLCODE = +100                                  06200012
062100                  DISPLAY ' CALCULATED BOSS DATE= '               06210012
062200                                                PV-BOSS-PARM-DATE 06220012
062210                          '                    CLEAN8'            06221016
062300             WHEN SQLCODE = -904                                  06230012
062400             WHEN SQLCODE = -911                                  06240012
062500             WHEN SQLCODE = -913                                  06250012
062600                  CONTINUE                                        06260012
062700                                                                  06270012
062800             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              06280012
062900                 DISPLAY '**************************************' 06290012
063000                 DISPLAY 'WARNING ISSUED '                        06300012
063100                 DISPLAY 'SELECT TKRPRPM - PARM DATE            ' 06310012
063200                 DISPLAY '**************************************' 06320012
063300                 PERFORM 9800-SQL-WARNING                         06330012
063400                                                                  06340012
063500             WHEN SQLCODE < ZERO                                  06350012
063600                 DISPLAY '**************************************' 06360012
063700                 DISPLAY 'ERROR ISSUED ON                       ' 06370012
063800                 DISPLAY 'SELECT TKRPRPM - PARM DATE            ' 06380012
063900                 DISPLAY '**************************************' 06390012
064000                 PERFORM 9900-SQL-ERROR                           06400012
064100                                                                  06410012
064200         END-EVALUATE                                             06420012
064300     END-PERFORM.                                                 06430012
064400                                                                  06440012
064500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    06450012
064600         SQLCODE NOT = ZERO                                       06460012
064700         DISPLAY '**************************************'         06470012
064800         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         06480012
064900         DISPLAY 'SELECT TKRPRPM - PARM DATE'                     06490012
065000         DISPLAY '**************************************'         06500012
065100         PERFORM 9900-SQL-ERROR                                   06510012
065200     END-IF.                                                      06520012
065300                                                                  06530012
065301                                                                  06530114
065302*-----------------------------------------------------------------06530214
065303* READ TKRPRPM TO RETRIEVE THE SEPHORA SUPPORTING DC DATE         06530314
065304*-----------------------------------------------------------------06530414
065310 7410-GET-SEPH-SUPP-DATE.                                         06531014
065315                                                                  06531514
065316     MOVE '7410-GET-SEPH-SUPP-DATE'   TO PV-ABEND-PARAGRAPH.      06531614
065317                                                                  06531714
065318     PERFORM                                                      06531814
065319         WITH TEST AFTER                                          06531914
065320         VARYING PV-RETRY-COUNTER                                 06532014
065321         FROM 1 BY 1                                              06532114
065322         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06532214
065323            OR  (SQLCODE = +100)                                  06532314
065324            OR  (SQLCODE = +0))                                   06532414
065325                                                                  06532514
065326         EXEC SQL                                                 06532614
065327             SELECT DATE(DAYS(:PV-SYSIN-DATE) - FUNC_QTY)         06532714
065328               INTO :PV-FAR-DATE-SEPH-SUPP                        06532814
065329               FROM TKRPRPM                                       06532914
065330              WHERE LOC_ID            = 90                        06533014
065331                AND INTFC_SYS_CDE     = 'KHL'                     06533114
065332                AND SYS_PRC_FUNC_CDE  = 'CLEAND'                  06533214
065333                AND FUNC_PRC_STAT_CDE = 'AC'                      06533314
065334             WITH UR                                              06533414
065335         END-EXEC                                                 06533514
065336                                                                  06533614
065337         EVALUATE TRUE                                            06533714
065338             WHEN SQLCODE = ZERO                                  06533814
065339             WHEN SQLCODE = +100                                  06533914
065340                  DISPLAY ' CALCULATED SEPHORA SUPPORT DC DATE: ' 06534014
065341                                            PV-FAR-DATE-SEPH-SUPP 06534114
065342                          '      CLEAND'                          06534216
065343             WHEN SQLCODE = -904                                  06534314
065344             WHEN SQLCODE = -911                                  06534414
065345             WHEN SQLCODE = -913                                  06534514
065346                  CONTINUE                                        06534614
065347                                                                  06534714
065348             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              06534814
065349                 DISPLAY '**************************************' 06534914
065350                 DISPLAY 'WARNING ISSUED '                        06535014
065351                 DISPLAY 'SELECT TKRPRPM - CLEAND               ' 06535114
065352                 DISPLAY '**************************************' 06535214
065353                 PERFORM 9800-SQL-WARNING                         06535314
065354                                                                  06535414
065355             WHEN SQLCODE < ZERO                                  06535514
065356                 DISPLAY '**************************************' 06535614
065357                 DISPLAY 'ERROR ISSUED ON                       ' 06535714
065358                 DISPLAY 'SELECT TKRPRPM - CLEAND               ' 06535814
065359                 DISPLAY '**************************************' 06535914
065360                 PERFORM 9900-SQL-ERROR                           06536014
065361                                                                  06536114
065362         END-EVALUATE                                             06536214
065363     END-PERFORM.                                                 06536314
065364                                                                  06536414
065365     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    06536514
065366         SQLCODE NOT = ZERO                                       06536614
065367         DISPLAY '**************************************'         06536714
065368         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         06536814
065369         DISPLAY 'SELECT TKRPRPM - CLEAND               '         06536914
065370         DISPLAY '**************************************'         06537014
065371         PERFORM 9900-SQL-ERROR                                   06537114
065372     END-IF.                                                      06537214
065373                                                                  06537314
065374                                                                  06537414
065375*-----------------------------------------------------------------06537514
065376* READ TKRPRPM TO RETRIEVE THE SEPHORA DIFFERENT DC DATE          06537614
065377*-----------------------------------------------------------------06537714
065378 7420-GET-SEPH-DIFF-DATE.                                         06537814
065382                                                                  06538214
065383     MOVE '7420-GET-SEPH-DIFF-DATE'   TO PV-ABEND-PARAGRAPH.      06538314
065384                                                                  06538414
065385     PERFORM                                                      06538514
065386         WITH TEST AFTER                                          06538614
065387         VARYING PV-RETRY-COUNTER                                 06538714
065388         FROM 1 BY 1                                              06538814
065389         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06538914
065390            OR  (SQLCODE = +100)                                  06539014
065391            OR  (SQLCODE = +0))                                   06539114
065392                                                                  06539214
065393         EXEC SQL                                                 06539314
065394             SELECT DATE(DAYS(:PV-SYSIN-DATE) - FUNC_QTY)         06539414
065395               INTO :PV-FAR-DATE-SEPH-DIFF                        06539514
065396               FROM TKRPRPM                                       06539614
065397              WHERE LOC_ID            = 90                        06539714
065398                AND INTFC_SYS_CDE     = 'KHL'                     06539814
065399                AND SYS_PRC_FUNC_CDE  = 'CLEANH'                  06539914
065400                AND FUNC_PRC_STAT_CDE = 'AC'                      06540014
065401             WITH UR                                              06540114
065402         END-EXEC                                                 06540214
065403                                                                  06540314
065404         EVALUATE TRUE                                            06540414
065405             WHEN SQLCODE = ZERO                                  06540514
065406             WHEN SQLCODE = +100                                  06540614
065407                  DISPLAY ' CALCULATED SEPHORA DIFFRNT DC DATE: ' 06540714
065408                                         PV-FAR-DATE-SEPH-DIFF    06540814
065409                          '      CLEANH'                          06540916
065410             WHEN SQLCODE = -904                                  06541014
065411             WHEN SQLCODE = -911                                  06541114
065412             WHEN SQLCODE = -913                                  06541214
065413                  CONTINUE                                        06541314
065414                                                                  06541414
065415             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              06541514
065416                 DISPLAY '**************************************' 06541614
065417                 DISPLAY 'WARNING ISSUED '                        06541714
065418                 DISPLAY 'SELECT TKRPRPM - CLEANH               ' 06541814
065419                 DISPLAY '**************************************' 06541914
065420                 PERFORM 9800-SQL-WARNING                         06542014
065421                                                                  06542114
065422             WHEN SQLCODE < ZERO                                  06542214
065423                 DISPLAY '**************************************' 06542314
065424                 DISPLAY 'ERROR ISSUED ON                       ' 06542414
065425                 DISPLAY 'SELECT TKRPRPM - CLEANH               ' 06542514
065426                 DISPLAY '**************************************' 06542614
065427                 PERFORM 9900-SQL-ERROR                           06542714
065428                                                                  06542814
065429         END-EVALUATE                                             06542914
065430     END-PERFORM.                                                 06543014
065431                                                                  06543114
065432     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    06543214
065433         SQLCODE NOT = ZERO                                       06543314
065434         DISPLAY '**************************************'         06543414
065435         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         06543514
065436         DISPLAY 'SELECT TKRPRPM - CLEANH               '         06543614
065437         DISPLAY '**************************************'         06543714
065438         PERFORM 9900-SQL-ERROR                                   06543814
065439     END-IF.                                                      06543914
065440                                                                  06544014
065441                                                                  06544114
065442*-----------------------------------------------------------------06544214
065443*                                                                 06544314
065444*-----------------------------------------------------------------06544414
065450 8000-READ-DETAIL-EXTRACT.                                        06545012
065500                                                                  06550012
065600     MOVE '8000-READ-DETAIL-EXTRACT   '  TO PV-ABEND-PARAGRAPH.   06560012
065700*                                                                 06570012
065800     READ ALL-TYPE-SE-FILE                                        06580012
065900         INTO                                                     06590012
066000             PC037-BMC-UNLOAD-SE-REC                              06600012
066100         AT END                                                   06610012
066200             SET PS-EOF-DETAIL-YES    TO TRUE                     06620012
066300         NOT AT END                                               06630012
066400             ADD 1                    TO PV-READ-COUNTER-DTL      06640012
066500             MOVE PC037-PO-NBR        TO PV-MATCH-DTL-PO          06650012
066600                                         PV-DETAIL-INNER-PO       06660012
066700             MOVE PC037-RCVR-SEQ-NBR  TO PV-MATCH-DTL-RCVR        06670012
066800                                         PV-DETAIL-INNER-RCVR     06680012
066900             MOVE PC037-INTR-UPC-ID   TO PV-DETAIL-INNER-UPC      06690012
067000             MOVE PC037-LOC-NBR       TO PV-DETAIL-INNER-LOC      06700012
067100             EVALUATE PC037-TRN-TYP-CDE                           06710012
067200                 WHEN 'UN'                                        06720012
067300                 WHEN 'AU'                                        06730012
067400                 WHEN 'MU'                                        06740012
067500                     CONTINUE                                     06750012
067600                 WHEN 'CL'                                        06760012
067700                     IF PC037-TRN-CLSN-PRCG-QTY > ZERO            06770012
067800                         MOVE 'AR'    TO PC037-TRN-TYP-CDE        06780012
067900                     ELSE                                         06790012
068000                         MOVE 'UN'    TO PC037-TRN-TYP-CDE        06800012
068100                     END-IF                                       06810012
068200                 WHEN OTHER                                       06820012
068300                     MOVE 'AR'        TO PC037-TRN-TYP-CDE        06830012
068400             END-EVALUATE                                         06840012
068500                                                                  06850012
068600     END-READ.                                                    06860012
068700                                                                  06870012
068800 8050-READ-SUMMRY-EXTRACT.                                        06880012
068900                                                                  06890012
069000     MOVE '8050-READ-SUMMRY-EXTRACT   '  TO PV-ABEND-PARAGRAPH.   06900012
069100*                                                                 06910012
069200     READ UNBALANCED-SUMMARY-FILE                                 06920012
069300         INTO                                                     06930012
069400             PC041-UNBAL-SUMMARY-REC                              06940012
069500         AT END                                                   06950012
069600             SET PS-EOF-SUMMRY-YES    TO TRUE                     06960012
069700         NOT AT END                                               06970012
069800             ADD 1                    TO PV-READ-COUNTER-SUM      06980012
069900             MOVE PC041-PO-NBR        TO PV-MATCH-SUM-PO          06990012
070000                                         PV-MASTER-INNER-PO       07000012
070100             MOVE PC041-RCVR-SEQ-NBR  TO PV-MATCH-SUM-RCVR        07010012
070200                                         PV-MASTER-INNER-RCVR     07020012
070300             MOVE PC041-INTR-UPC-ID   TO PV-MASTER-INNER-UPC      07030012
070400             MOVE PC041-LOC-NBR       TO PV-MASTER-INNER-LOC      07040012
070500     END-READ.                                                    07050012
070600                                                                  07060012
070700 8100-WRITE.                                                      07070012
070800                                                                  07080012
070900     MOVE '8100-WRITE          '      TO PV-ABEND-PARAGRAPH.      07090012
071000     SET PC041-GT-21                  TO TRUE                     07100012
071100     WRITE                                                        07110012
071200         STORE-EXPECTED-GT-21-REC FROM PC041-UNBAL-SUMMARY-REC    07120012
071300     END-WRITE.                                                   07130012
071400     ADD 1                            TO PV-WRITE-1-COUNTER.      07140012
071500/                                                                 07150012
071600 9000-QUIT.                                                       07160012
071700                                                                  07170012
071800     IF PS-EOF-SUMMRY-YES                                         07180012
071900         CONTINUE                                                 07190012
072000     ELSE                                                         07200012
072100         PERFORM 2100-WRITE-EM-OUT                                07210012
072200         PERFORM 2200-PO-RCVR-BREAK                               07220012
072300     END-IF                                                       07230012
072400                                                                  07240012
072500     CLOSE ALL-TYPE-SE-FILE                                       07250012
072600           UNBALANCED-SUMMARY-FILE                                07260012
072700           STORE-EXPECTED-GT-21                                   07270012
072800                                                                  07280012
072900     DISPLAY SPACES.                                              07290012
073000                                                                  07300012
073100     MOVE PV-READ-COUNTER-DTL         TO PV-MSG-READ-COUNT        07310012
073200     DISPLAY PV-COUNT-MSG-4.                                      07320012
073300                                                                  07330012
073400     DISPLAY SPACES                                               07340012
073500                                                                  07350012
073600     MOVE PV-READ-COUNTER-SUM         TO PV-MSG-READ-COUNT5       07360012
073700     DISPLAY PV-COUNT-MSG-5.                                      07370012
073800                                                                  07380012
073900     MOVE PV-FAR-DATE                 TO PV-MSG-1-LIT             07390012
074000     MOVE PV-WRITE-1-COUNTER          TO PV-MSG-1-COUNT           07400012
074100     DISPLAY PV-COUNT-MSG-1.                                      07410012
074200                                                                  07420012
074300     DISPLAY SPACES                                               07430012
074400                                                                  07440012
074500     MOVE PV-SKIP-COUNT               TO PV-MSG-SKIP-COUNT        07450012
074600     DISPLAY PV-COUNT-MSG-3.                                      07460012
074700                                                                  07470012
074800     MOVE PV-BOSS-COUNT               TO PV-MSG-BOSS-COUNT        07480012
074900     DISPLAY PV-COUNT-MSG-7.                                      07490012
075000                                                                  07500012
075001     MOVE PV-SKIP-COUNT-SEPH-SUPP    TO PV-MSG-SEPH-SUPP-SKIP-CNT 07500115
075002     DISPLAY PV-COUNT-MSG-8.                                      07500214
075003                                                                  07500314
075004     MOVE PV-SKIP-COUNT-SEPH-DIFF    TO PV-MSG-SEPH-DIFF-SKIP-CNT 07500415
075005     DISPLAY PV-COUNT-MSG-9.                                      07500514
075006                                                                  07500614
075100     MOVE PV-WRITE-6-COUNTER          TO PV-MSG-6-COUNT           07510012
075200     DISPLAY PV-COUNT-MSG-6.                                      07520012
075300                                                                  07530012
075400/                                                                 07540012
075500 9100-SQL-ABEND.                                                  07550012
075600******************************************************************07560012
075700*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    07570012
075800*  ERROR OR WARNING CODE OCCURS.                                  07580012
075900******************************************************************07590012
076000     DISPLAY '9100-SQL-ABEND'.                                    07600012
076100     DISPLAY '** ABEND     **'.                                   07610012
076200     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        07620012
076300     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             07630012
076400     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     07640012
076500     DISPLAY '**              ** = '                              07650012
076600     MOVE SQLCODE TO PV-SQL-CODE.                                 07660012
076700     DISPLAY '** SQL CODE  ** = ' PV-SQL-CODE.                    07670012
076800     MOVE +4013 TO PV-ABEND-CODE.                                 07680012
076900     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         07690012
077000                                                                  07700012
077100 9200-CROAK.                                                      07710012
077200******************************************************************07720012
077300*  PERFORMS THE ABEND FOR THE PROGRAM                             07730012
077400******************************************************************07740012
077500     DISPLAY '9200-CROAK'.                                        07750012
077600     DISPLAY '** ABEND     **'.                                   07760012
077700     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        07770012
077800     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             07780012
077900     DISPLAY '**              ** = '                              07790012
078000     MOVE +4013 TO PV-ABEND-CODE.                                 07800012
078100     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         07810012
078200                                                                  07820012
078300******************************************************************07830012
078400*  THIS MODULE PERFORMS THE SQL WARNING.                         *07840012
078500******************************************************************07850012
078600                                                                  07860012
078700 9800-SQL-WARNING.                                                07870012
078800                                                                  07880012
078900     MOVE SQLCODE               TO SQLCODE2.                      07890012
079000     MOVE SQLERRD(3)            TO SQLERRD3.                      07900012
079100     DISPLAY '** ABEND **       ** = SQLWARNING'.                 07910012
079200     DISPLAY '** PROGRAM        ** = PCKUT048'.                   07920012
079300     DISPLAY '** PARAGRAPH      ** = ' PV-ABEND-PARAGRAPH.        07930012
079400     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  07940012
079500     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  07950012
079600                                                                  07960012
079700     COPY DPPD004.                                                07970012
079800     SET ABEND-4013-DB2-ERROR   TO TRUE                           07980012
079900     CALL 'ILBOABN0' USING ABEND-CODE.                            07990012
080000/                                                                 08000012
080100******************************************************************08010012
080200* THIS MODULE PERFORMS THE SQL ERROR.                            *08020012
080300******************************************************************08030012
080400                                                                  08040012
080500 9900-SQL-ERROR.                                                  08050012
080600                                                                  08060012
080700     MOVE SQLCODE               TO SQLCODE2.                      08070012
080800     MOVE SQLERRD(3)            TO SQLERRD3.                      08080012
080900     DISPLAY '** ABEND **       ** = SQLERROR'.                   08090012
081000     DISPLAY '** PROGRAM        ** = PCKUT048'.                   08100012
081100     DISPLAY '** PARAGRAPH      ** = ' PV-ABEND-PARAGRAPH.        08110012
081200     DISPLAY '** OPERATION      ** = ' PV-ABEND-OPERATION         08120012
081300     DISPLAY '** TABLE          ** = ' PV-ABEND-STRUCTURE-1       08130012
081400     DISPLAY SPACES                                               08140012
081500                                                                  08150012
081600     COPY DPPD004.                                                08160012
081700     SET ABEND-4013-DB2-ERROR   TO TRUE                           08170012
081800     CALL 'ILBOABN0' USING ABEND-CODE.                            08180012
