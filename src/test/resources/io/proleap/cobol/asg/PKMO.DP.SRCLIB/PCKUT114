000100 IDENTIFICATION DIVISION.                                         00010045
000200                                                                  00020045
000300 PROGRAM-ID.             PCKUT114.                                00030045
000400 AUTHOR.                 MEENAKSHI MITTAL.                        00040045
000500 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00050045
000600 DATE-WRITTEN            SEP 2015.                                00060045
000700 DATE-COMPILED.                                                   00070045
000800                                                                  00080045
000900******************************************************************00090045
001000*    COBOL 2                                                      00100045
001100*                                                                 00110045
001200*    EXCLUDE MISDIRECTED CARTONS                                  00120045
001300*                                                                 00130045
001400*    THIS PROGRAM WILL EXCLUDE MISDIRECTED CARTONS CORRECTIONS    00140045
001500*    FROM BEING INCLUDED IN THE PRE-PHYSICAL INVENTORY CLEAN UP   00150045
001600*    FILE. TO DO THIS WE WILL NOT WRITE OUT THE MISDIRECTED       00160045
001700*    CARTONS TO THE OUTPUT FILE. MISDIRECTED CARTONS ARE          00170045
001800*    IDENTIFIED AS CARTONS WHERE THE CURRENT LOCATION IS NOT EQUAL00180045
001900*    TO THE RECEIVER LOCATION.                                    00190045
002000*                                                                 00200045
002100***************************************************************** 00210045
002200*                                                                 00220045
002300* CHANGE LOG:                                                     00230045
002400*                                                                 00240045
002500* 09/21/15  INITIAL VERSION                                       00250045
002600*                                                                 00260045
002700***************************************************************** 00270045
002800 ENVIRONMENT DIVISION.                                            00280045
002900 CONFIGURATION SECTION.                                           00290045
003000                                                                  00300045
003100 SOURCE-COMPUTER.        IBM-3090.                                00310045
003200 OBJECT-COMPUTER.        IBM-3090.                                00320045
003300                                                                  00330045
003400 INPUT-OUTPUT SECTION.                                            00340045
003500                                                                  00350045
003600 FILE-CONTROL.                                                    00360045
003700                                                                  00370045
003800     SELECT ALL-TYPE-SE-INP-FILE                                  00380045
003900         ASSIGN TO INP01.                                         00390045
004000                                                                  00400045
004100     SELECT ALL-TYPE-SE-OUT-FILE                                  00410045
004200         ASSIGN TO OUT01.                                         00420045
004300                                                                  00430045
004400 DATA DIVISION.                                                   00440045
004500 FILE SECTION.                                                    00450045
004600                                                                  00460045
004700 FD  ALL-TYPE-SE-INP-FILE                                         00470045
004800     RECORDING MODE IS F                                          00480045
004900     LABEL RECORDS ARE STANDARD                                   00490045
005000     BLOCK CONTAINS 0 RECORDS.                                    00500045
005100                                                                  00510045
005200 01  ALL-TYPE-SE-INP-RECORD               PIC  X(048).            00520045
005300                                                                  00530045
005400 FD  ALL-TYPE-SE-OUT-FILE                                         00540045
005500     RECORDING MODE IS F                                          00550045
005600     LABEL RECORDS ARE STANDARD                                   00560045
005700     BLOCK CONTAINS 0 RECORDS.                                    00570045
005800                                                                  00580045
005900 01  ALL-TYPE-SE-OUT-RECORD           PIC X(048).                 00590045
006000                                                                  00600045
006100 WORKING-STORAGE SECTION.                                         00610045
006200                                                                  00620045
006300 01  FILLER.                                                      00630045
006400     05  FILLER                      PIC  X(36)    VALUE          00640045
006500         ' ***** WORKING STORAGE PGM=PCKUT114 '.                  00650045
006600     05  PGM-COMPILED                PIC  X(20)    VALUE SPACE.   00660045
006700                                                                  00670045
006800 01  PS-SWITCHES.                                                 00680045
006900     05  PS-EOF-DETAIL-SW             PIC X(01) VALUE 'N'.        00690045
007000         88  PS-EOF-DETAIL-YES                  VALUE 'Y'.        00700045
007100         88  PS-EOF-DETAIL-NO                   VALUE 'N'.        00710045
007200     05  PS-FUNC-TXT-CSR-SW           PIC X(01) VALUE 'N'.        00720045
007300         88 END-OF-FUNC-TXT-CSR                 VALUE 'Y'.        00730045
007910     05  PS-BYPASS-RECORD-SW          PIC X(01) VALUE 'N'.        00791046
007920         88  PS-BYPASS-RECORD-YES               VALUE 'Y'.        00792046
007930         88  PS-BYPASS-RECORD-NO                VALUE 'N'.        00793046
008000                                                                  00800045
008100 01  PV-OPER-UNT-ID           PIC S9(04) COMP.                    00810045
008200 01  PV-DIS-OPER-UNT-ID       PIC  9(04) VALUE ZEROES.            00820045
008300 01  PV-CURR-OPER-UNT-ID      PIC S9(04) COMP.                    00830045
008400 01  PV-DIS-CURR-OPER-UNT-ID  PIC  9(04) VALUE ZEROES.            00840045
008500 01  PV-LOC-ID                PIC S9(04) COMP.                    00850045
008600 01  PV-HOLD-PO-NBR           PIC S9(09) COMP.                    00860045
008700 01  PV-HOLD-RCVR-SEQ-NBR     PIC S9(09) COMP.                    00870045
008800 01  PV-DIS-LOC-ID            PIC  9(04) VALUE ZEROES.            00880045
008900 01  PV-DIS-PO-NBR            PIC  9(09) VALUE ZEROES.            00890045
009000 01  PV-DIS-RCVR-SEQ-NBR      PIC  9(09) VALUE ZEROES.            00900045
009100 01  PV-FUNC-TXT              PIC X(25)  VALUE SPACES.            00910045
009200 01  PV-DIS-FUNC              PIC  9(03) VALUE ZEROES.            00920045
009300                                                                  00930045
009400 01  PV-HOLD-FUNC-TXT-TABLE.                                      00940045
009500     05  PV-HOLD-FUNC-TXT OCCURS 100 TIMES INDEXED BY X1.         00950045
009600         10  PV-LOC           PIC S9(04) COMP.                    00960045
009700         10  PV-FUNC          PIC 9(03).                          00970045
009800                                                                  00980045
009900****************************************************************  00990045
010000****************************************************************  01000045
010100/                                                                 01010045
010200 01  PC-CONSTANTS.                                                01020045
010300     05  PC-CURRENT-PROGRAM-NAME      PIC  X(08) VALUE            01030045
010400                                                   'PCKUT114'.    01040045
010500     05  PC-ILBOABN0                  PIC  X(08) VALUE            01050045
010600                                                   'ILBOABN0'.    01060045
010610     05  PC-LOC-90                    PIC S9(04) COMP             01061046
010620                                                 VALUE 90.        01062046
010630     05  PC-DE                        PIC  X(02) VALUE 'DE'.      01063046
010640                                                                  01064046
010700 01  PV-MISC-STUFF.                                               01070045
010800     05  PV-ABEND-PARAGRAPH           PIC  X(30) VALUE SPACE.     01080045
010900     05  PV-DB2-OPERATION-ATTEMPTED   PIC  X(60) VALUE SPACE.     01090045
011000     05  PV-SQL-CODE                  PIC  9(04) VALUE ZERO.      01100045
011100     05  PV-ABEND-CODE                PIC S9(04) VALUE ZERO       01110045
011200                                                    COMP SYNC.    01120045
011300     05  PV-READ-COUNTER-DTL          PIC S9(09) COMP-3           01130045
011400                                                    VALUE ZERO.   01140045
011500     05  PV-WRITE-COUNTER             PIC S9(09) COMP-3           01150045
011600                                                    VALUE ZERO.   01160045
011700     05  PV-NOT-FOUND-COUNTER         PIC S9(09) COMP-3           01170045
011800                                                    VALUE ZERO.   01180045
011900     05  PV-BYPASS-COUNTER            PIC S9(09) COMP-3           01190045
012000                                                    VALUE ZERO.   01200045
012100     05  PV-SEARCH-COUNTER            PIC S9(09) COMP-3           01210045
012200                                                    VALUE ZERO.   01220045
012300     05  PV-ABEND-OPERATION           PIC X(20) VALUE SPACE.      01230045
012400     05  PV-ABEND-STRUCTURE-1         PIC X(20) VALUE SPACE.      01240045
012500                                                                  01250045
012600 01  ABEND-CODE                       PIC S9(04)     VALUE +0     01260045
012700                                                     COMP SYNC.   01270045
012800     88  ABEND-4001-WRITE-ERROR                      VALUE +4001. 01280045
012900     88  ABEND-4002-READ-ERROR                       VALUE +4002. 01290045
013000     88  ABEND-4003-CTRL-CARD-ERROR                  VALUE +4003. 01300045
013100     88  ABEND-4004-TABLE-ERROR                      VALUE +4004. 01310045
013200     88  ABEND-4005-OPEN-ERROR                       VALUE +4005. 01320045
013300     88  ABEND-4006-CLOSE-ERROR                      VALUE +4006. 01330045
013400     88  ABEND-4007-SEQUENCE-ERROR                   VALUE +4007. 01340045
013500     88  ABEND-4008-DATS-ERROR                       VALUE +4008. 01350045
013600     88  ABEND-4009-KEY-DATS-ERROR                   VALUE +4009. 01360045
013700     88  ABEND-4013-DB2-ERROR                        VALUE +4013. 01370045
013800                                                                  01380045
013900 01  PV-COUNT-MSG-1.                                              01390045
014000     05  FILLER                       PIC X(35) VALUE             01400045
014100         'DETAIL RECORDS READ =             '.                    01410045
014200     05  FILLER                       PIC X(34) VALUE             01420045
014300         SPACES.                                                  01430045
014400     05  PV-MSG-READ-COUNT            PIC ZZZ,ZZZ,ZZ9.            01440045
014500                                                                  01450045
014600                                                                  01460045
014700 01  PV-COUNT-MSG-2.                                              01470045
014800     05  FILLER                       PIC X(35) VALUE             01480045
014900         'RECORDS WRITTEN TO OUTPUT =       '.                    01490045
015000     05  FILLER                       PIC X(34) VALUE             01500045
015100         SPACES.                                                  01510045
015200     05  PV-MSG-WRITE-COUNT           PIC ZZZ,ZZZ,ZZ9.            01520045
015300                                                                  01530045
015400 01  PV-COUNT-MSG-3.                                              01540045
015500     05  FILLER                       PIC X(35) VALUE             01550045
015600         'RECORDS BYPASSED =                '.                    01560045
015700     05  FILLER                       PIC X(34) VALUE             01570045
015800         SPACES.                                                  01580045
015900     05  PV-MSG-BYPASS-COUNT          PIC ZZZ,ZZZ,ZZ9.            01590045
016000                                                                  01600045
016100 01  PV-COUNT-MSG-4.                                              01610045
016200     05  FILLER                       PIC X(35) VALUE             01620045
016300         'RECORDS NOT FOUND ON TRECEIV =    '.                    01630045
016400     05  FILLER                       PIC X(34) VALUE             01640045
016500         SPACES.                                                  01650045
016600     05  PV-MSG-NOT-FOUND-COUNT       PIC ZZZ,ZZZ,ZZ9.            01660045
016700                                                                  01670045
016800 01  PV-COUNT-MSG-5.                                              01680045
016900     05  FILLER                       PIC X(35) VALUE             01690045
017000         'RECORDS SEARCHED =                '.                    01700045
017100     05  FILLER                       PIC X(34) VALUE             01710045
017200         SPACES.                                                  01720045
017300     05  PV-MSG-SEARCH-COUNT          PIC ZZZ,ZZZ,ZZ9.            01730045
017400                                                                  01740045
017500*    SE UNBALANCED FILE                                           01750045
017600     COPY PCRD037.                                                01760045
017700                                                                  01770045
017800/                                                                 01780045
017900*---------- RC - KOHLS TO RETEK PROCESSING PARAMETERS TABLE ----* 01790045
018000     EXEC SQL                                                     01800045
018100         INCLUDE TKRPRPM                                          01810045
018200     END-EXEC.                                                    01820045
018300                                                                  01830045
018400*---------- RC-RECEIVER TABLE ----------*                         01840045
018500     EXEC SQL                                                     01850045
018600         INCLUDE TRECEIV                                          01860045
018700     END-EXEC.                                                    01870045
018800                                                                  01880045
018900     EXEC SQL                                                     01890045
019000         INCLUDE SQLCA                                            01900045
019100     END-EXEC.                                                    01910045
019200                                                                  01920045
019300     COPY SQLCA2.                                                 01930045
019400                                                                  01940045
019500     COPY DPWS004.                                                01950045
019600                                                                  01960045
019700*---------------------------------------------------------------* 01970045
019800* DECLARE A NEW CURSOR TO UNLOAD THE PARM ENTRIES FROM THE TKRPRPM01980045
019900* INTO AN INTERNAL TABLE.                                         01990045
020000* CURSOR FOR GETTING LOC_ID & FUNC_TXT FROM TABLE TKRPRPM         02000045
020100*---------------------------------------------------------------* 02010045
020200     EXEC SQL                                                     02020045
020300        DECLARE FUNC_TXT_CSR CURSOR FOR                           02030045
020400        SELECT                                                    02040045
020500               LOC_ID                                             02050045
020600              ,FUNC_TXT                                           02060045
020700          FROM TKRPRPM                                            02070045
020800         WHERE INTFC_SYS_CDE = 'KHL'                              02080045
020900           AND FUNC_PRC_STAT_CDE = 'AC'                           02090045
021000           AND SYS_PRC_FUNC_CDE = 'ECDCSU'                        02100045
021100           AND CURRENT DATE >= DATE(FUNC_BEG_TMST)                02110045
021200     END-EXEC                                                     02120045
021300*----------------------------------------------------------------*02130045
021400                                                                  02140045
021500 PROCEDURE DIVISION.                                              02150045
021600                                                                  02160045
021700 A100-MAINLINE.                                                   02170045
021800                                                                  02180045
021900     PERFORM B100-INITIALIZATION.                                 02190045
022000                                                                  02200045
022100     PERFORM B200-PROCESS UNTIL PS-EOF-DETAIL-YES.                02210045
022200                                                                  02220045
022300     PERFORM B300-END-OF-JOB.                                     02230045
022400                                                                  02240045
022500     GOBACK.                                                      02250045
022600                                                                  02260045
022700 B100-INITIALIZATION.                                             02270045
022800                                                                  02280045
022900     MOVE 'B100-INITIALIZATION         '  TO PV-ABEND-PARAGRAPH.  02290045
023000                                                                  02300045
023100     OPEN INPUT ALL-TYPE-SE-INP-FILE.                             02310045
023200                                                                  02320045
023300     OPEN OUTPUT ALL-TYPE-SE-OUT-FILE.                            02330045
023400                                                                  02340045
023500     INITIALIZE PV-HOLD-PO-NBR                                    02350045
023600                PV-HOLD-RCVR-SEQ-NBR.                             02360045
023700                                                                  02370045
023800     PERFORM R100-READ-DETAIL-EXTRACT.                            02380045
023900                                                                  02390045
023910     MOVE ZEROS TO PV-HOLD-PO-NBR                                 02391046
023920                   PV-HOLD-RCVR-SEQ-NBR.                          02392046
024400                                                                  02440045
024500     IF PS-EOF-DETAIL-YES                                         02450045
024600        DISPLAY SPACES                                            02460045
024700        DISPLAY ALL '*'                                           02470045
024800        DISPLAY '  DETAIL INPUT FILE IS EMPTY '                   02480045
024900        DISPLAY ALL '*'                                           02490045
025000        DISPLAY SPACES                                            02500045
025100     ELSE                                                         02510045
025200        PERFORM S100-OPEN-FUNC-TXT-CSR                            02520045
025300        SET X1 TO 1                                               02530045
025400        PERFORM S200-FETCH-FUNC-TXT-CSR UNTIL END-OF-FUNC-TXT-CSR 02540045
025500        PERFORM S300-CLOSE-FUNC-TXT-CSR                           02550045
025600     END-IF.                                                      02560045
025700                                                                  02570045
025800 B200-PROCESS.                                                    02580045
025900                                                                  02590045
026000     MOVE 'B200-PROCESS       '  TO PV-ABEND-PARAGRAPH.           02600045
026100                                                                  02610045
026200     IF  PC037-PO-NBR       = PV-HOLD-PO-NBR                      02620046
026300     AND PC037-RCVR-SEQ-NBR = PV-HOLD-RCVR-SEQ-NBR                02630046
026400         IF  PS-BYPASS-RECORD-YES                                 02640047
026410             ADD +1 TO PV-BYPASS-COUNTER                          02641046
026420         ELSE                                                     02642046
026700             PERFORM D100-WRITE                                   02670046
026800         END-IF                                                   02680046
026900     ELSE                                                         02690045
026910         SET PS-BYPASS-RECORD-NO TO TRUE                          02691046
027000         PERFORM C100-SEARCH-PARA                                 02700046
027100         MOVE PC037-PO-NBR        TO PV-HOLD-PO-NBR               02710046
027200         MOVE PC037-RCVR-SEQ-NBR  TO PV-HOLD-RCVR-SEQ-NBR         02720046
027300     END-IF.                                                      02730045
027400                                                                  02740045
027500     PERFORM R100-READ-DETAIL-EXTRACT.                            02750045
027800                                                                  02780045
027900*----------------------------------------------------------------*02790045
028000*SELECT THE OPER_UNT_ID AND CURR_OPER_UNT_ID FROM THE TRECEIV     02800045
028100*TABLE.IF THE OPER_UNT_ID HAS DIFFERENT VALUES ON THE INPUT FILE  02810045
028200*THAN THE CURR_OPER_UNT_ID ON THE TRECEIV, WE NEED TO CHECK THE   02820045
028300*ECDCSU PARM (PARA C200-SRCH-INTERNAL-ECDCSU-PARM) WHERE THE      02830045
028400*LOC_ID ON TKRPRPM HAS THE VALUE OF OPER_UNT_ID ON TRECEIV AND    02840045
028500*THE FUNC_TXT HAS THE VALUE OF CURR_OPER_UNT_ID ON TREEIV. IF THEY02850045
028600*MATCH THEN THE RECEIVER IS NOT CONSIDERED AS MISDIRECTED AND     02860045
028700*WRITTEN OUT TO THE OUTPUT FILE AND IF THE VALUES DO NOT MATCH    02870045
028800*THEY ARE CONSIDERED AS MISDIRECTED CARTONS AND NOT WRITTEN OUT TO02880045
028900*THE OUTPUT FILE.                                                 02890045
028910*ADDED THE "NOT CURR_OPER_UNT_ID = :PC-LOC-90" AND CLAUSE SO THAT 02891046
028920*IF THE RECEIVER WAS KEYED BY CORPORATE, THE MISDIRECT CHECK      02892046
028930*NOT BE DONE AND THAT THE DATA WOULD BE PROCESSED AS NORMAL, NOT  02893046
028940*AS A MISDIRECT VIA THE +100 LOGIC FOLLOWING THE SELECT.          02894046
028950*ADDED THE "AND NOT STATUS_CDE       = :PC-DE" AND CLAUSE SO THAT 02895046
028960*IF THE DATA BEING CHECKED IS RELATED TO A RECEIVER IN A DELETED  02896046
028970*STATUS, WE BYPASS THE MISDIRECT CHECK FOR THAT DATA AND THAT THE 02897046
028980*DATA WOULD BE PROCESSED AS NORMAL.  ADDING THIS TO THE SQL WOULD 02898046
028990*GENERATE A +100 AND THUS BYPASS THE MISDIRECT CHECK.             02899046
029000*-----------------------------------------------------------------02900045
029100 C100-SEARCH-PARA.                                                02910045
029200                                                                  02920045
029300     EXEC SQL                                                     02930045
029400          SELECT                                                  02940045
029500                 OPER_UNT_ID,                                     02950045
029600                 CURR_OPER_UNT_ID                                 02960045
029700          INTO                                                    02970045
029800                 :PV-OPER-UNT-ID,                                 02980045
029900                 :PV-CURR-OPER-UNT-ID                             02990045
030000          FROM  TRECEIV                                           03000045
030100          WHERE ORD_NBR              = :PC037-PO-NBR              03010046
030200            AND REC_SEQ_NBR          = :PC037-RCVR-SEQ-NBR        03020046
030210            AND NOT CURR_OPER_UNT_ID = :PC-LOC-90                 03021046
030220            AND NOT STATUS_CDE       = :PC-DE                     03022046
030300     END-EXEC                                                     03030045
030400                                                                  03040045
030500     EVALUATE TRUE                                                03050045
030600        WHEN SQLCODE = +0                                         03060045
030700             IF  PV-OPER-UNT-ID = PV-CURR-OPER-UNT-ID             03070045
030800                 PERFORM D100-WRITE                               03080045
030900             ELSE                                                 03090045
031000                 PERFORM C200-SRCH-INTERNAL-ECDCSU-PARM           03100045
031100             END-IF                                               03110045
031200        WHEN SQLCODE = +100                                       03120045
031300             PERFORM D100-WRITE                                   03130045
031400             ADD +1 TO PV-NOT-FOUND-COUNTER                       03140045
031500        WHEN SQLWARN0 NOT = SPACE                                 03150045
031600        WHEN SQLCODE  NOT = +0                                    03160045
031700             MOVE 'C100-SEARCH-PARA    '  TO PV-ABEND-PARAGRAPH   03170045
031800             MOVE 'SELECT TRECEIV - OPER ID' TO PV-ABEND-OPERATION03180045
031900             MOVE 'TRECEIV'   TO PV-ABEND-STRUCTURE-1             03190045
032000             PERFORM 9100-SQL-ABEND                               03200045
032100     END-EVALUATE.                                                03210045
032200                                                                  03220045
032300 R100-READ-DETAIL-EXTRACT.                                        03230045
032400                                                                  03240045
032500     MOVE 'R100-READ-DETAIL-EXTRACT   '  TO PV-ABEND-PARAGRAPH.   03250045
032600                                                                  03260045
032700     READ ALL-TYPE-SE-INP-FILE INTO PC037-BMC-UNLOAD-SE-REC       03270045
032800         AT END                                                   03280045
032900             SET PS-EOF-DETAIL-YES    TO TRUE                     03290045
033000         NOT AT END                                               03300045
033100             ADD 1                    TO PV-READ-COUNTER-DTL      03310045
033200     END-READ.                                                    03320045
033300                                                                  03330045
033400*----------------------------------------------------------------*03340045
033500*             OPENS THE CURSOR                                  * 03350045
033600*----------------------------------------------------------------*03360045
033700 S100-OPEN-FUNC-TXT-CSR.                                          03370045
033800                                                                  03380045
033900     EXEC SQL                                                     03390045
034000          OPEN FUNC_TXT_CSR                                       03400045
034100     END-EXEC.                                                    03410045
034200                                                                  03420045
034300     EVALUATE TRUE                                                03430045
034400       WHEN SQLCODE = +0                                          03440045
034500           CONTINUE                                               03450045
034600       WHEN SQLWARN0 NOT = SPACE                                  03460045
034700       WHEN SQLCODE  NOT = +0                                     03470045
034800           MOVE 'S100-OPEN-FUNC-TXT-CSR'  TO PV-ABEND-PARAGRAPH   03480045
034900           MOVE 'UNSUCCESSFUL OPEN '      TO PV-ABEND-OPERATION   03490045
035000           MOVE 'TKRPRPM'   TO PV-ABEND-STRUCTURE-1               03500045
035100           PERFORM 9100-SQL-ABEND                                 03510045
035200     END-EVALUATE.                                                03520045
035300                                                                  03530045
035400*----------------------------------------------------------------*03540045
035500*          FETCHES ROWS FROM THE CURSOR                          *03550045
035600*----------------------------------------------------------------*03560045
035700 S200-FETCH-FUNC-TXT-CSR.                                         03570045
035800                                                                  03580045
035900      EXEC SQL                                                    03590045
036000          FETCH FUNC_TXT_CSR                                      03600045
036100          INTO  :PV-LOC-ID                                        03610045
036200              , :PV-FUNC-TXT                                      03620045
036300      END-EXEC                                                    03630045
036400                                                                  03640045
036500      EVALUATE TRUE                                               03650045
036600          WHEN SQLCODE = +0                                       03660045
037400              MOVE PV-LOC-ID        TO PV-LOC(X1)                 03740045
037500              MOVE PV-FUNC-TXT(1:3) TO PV-FUNC(X1)                03750045
037600              SET X1 UP BY 1                                      03760045
037700          WHEN SQLCODE = +100                                     03770045
037800              SET END-OF-FUNC-TXT-CSR TO TRUE                     03780045
037900          WHEN OTHER                                              03790045
038000              MOVE 'S200-FETCH-FUNC-TXT-CSR' TO PV-ABEND-PARAGRAPH03800045
038100              MOVE 'UNSUCCESSFUL FETCH '     TO PV-ABEND-OPERATION03810045
038200              MOVE 'TKRPRPM'              TO PV-ABEND-STRUCTURE-1 03820045
038300              PERFORM 9100-SQL-ABEND                              03830045
038400      END-EVALUATE.                                               03840045
038500                                                                  03850045
038600*----------------------------------------------------------------*03860045
038700*     CLOSES THE CURSOR                                           03870045
038800*----------------------------------------------------------------*03880045
038900 S300-CLOSE-FUNC-TXT-CSR.                                         03890045
039000                                                                  03900045
039100      EXEC SQL                                                    03910045
039200        CLOSE FUNC_TXT_CSR                                        03920045
039300      END-EXEC                                                    03930045
039400                                                                  03940045
039500      EVALUATE TRUE                                               03950045
039600          WHEN SQLCODE = +0                                       03960045
039700              CONTINUE                                            03970045
039800          WHEN OTHER                                              03980045
039900              MOVE 'S300-CLOSE-FUNC-TXT-CSR' TO PV-ABEND-PARAGRAPH03990045
040000              MOVE 'UNSUCCESSFUL CLOSE '     TO PV-ABEND-OPERATION04000045
040100              MOVE 'TKRPRPM'              TO PV-ABEND-STRUCTURE-1 04010045
040200              PERFORM 9100-SQL-ABEND                              04020045
040300      END-EVALUATE.                                               04030045
040400                                                                  04040045
040500*----------------------------------------------------------------*04050045
040600*     CHECKING FOR FUNCTION                                      *04060045
040700*     - LOC_ID SHOULD EQUAL RECEIV-OPER-UNT-ID                   *04070045
040800*     - FUNC-TXT SHOULD EQUAL RECEIV-CURR-OPER-UNT-ID            *04080045
040900*       IF THESE EQUAL, WRITE OUT THE OUTPUT RECORD              *04090045
041000*       IF THESE DO NOT EQUAL WE HAVE A MISMATCH, DO NOT WRITE   *04100045
041100*----------------------------------------------------------------*04110045
041200 C200-SRCH-INTERNAL-ECDCSU-PARM.                                  04120045
041300                                                                  04130045
041400      SET X1 TO +1.                                               04140045
041600                                                                  04160045
041700      SEARCH PV-HOLD-FUNC-TXT                                     04170045
041800         AT END                                                   04180045
042700            ADD +1 TO PV-BYPASS-COUNTER                           04270045
042710            SET PS-BYPASS-RECORD-YES TO TRUE                      04271046
042900         WHEN PV-LOC(X1)   = PV-OPER-UNT-ID                       04290045
043000          AND PV-FUNC(X1)  = PV-CURR-OPER-UNT-ID                  04300045
043100              PERFORM D100-WRITE                                  04310045
043300              ADD +1 TO PV-SEARCH-COUNTER                         04330045
043400      END-SEARCH.                                                 04340045
043500                                                                  04350045
043600*----------------------------------------------------------------*04360045
043700                                                                  04370045
043800 D100-WRITE.                                                      04380045
043900                                                                  04390045
044000     MOVE 'D100-WRITE          '      TO PV-ABEND-PARAGRAPH.      04400045
044100     WRITE                                                        04410045
044200         ALL-TYPE-SE-OUT-RECORD   FROM PC037-BMC-UNLOAD-SE-REC    04420045
044300     END-WRITE.                                                   04430045
044400     ADD 1                            TO PV-WRITE-COUNTER.        04440045
044500                                                                  04450045
044600 B300-END-OF-JOB.                                                 04460045
044700                                                                  04470045
044800     CLOSE ALL-TYPE-SE-INP-FILE                                   04480045
044900           ALL-TYPE-SE-OUT-FILE.                                  04490045
045000                                                                  04500045
045100     DISPLAY SPACES.                                              04510045
045200                                                                  04520045
045300     MOVE PV-READ-COUNTER-DTL       TO PV-MSG-READ-COUNT.         04530045
045400     DISPLAY PV-COUNT-MSG-1.                                      04540045
045500                                                                  04550045
045600     DISPLAY SPACES.                                              04560045
045700                                                                  04570045
045800     MOVE PV-WRITE-COUNTER          TO PV-MSG-WRITE-COUNT.        04580045
045900     DISPLAY PV-COUNT-MSG-2.                                      04590045
046000                                                                  04600045
046100     MOVE PV-BYPASS-COUNTER         TO PV-MSG-BYPASS-COUNT.       04610045
046200     DISPLAY PV-COUNT-MSG-3.                                      04620045
046300                                                                  04630045
046400     MOVE PV-NOT-FOUND-COUNTER      TO PV-MSG-NOT-FOUND-COUNT.    04640045
046500     DISPLAY PV-COUNT-MSG-4.                                      04650045
046600                                                                  04660045
046700     MOVE PV-SEARCH-COUNTER         TO PV-MSG-SEARCH-COUNT.       04670045
046800     DISPLAY PV-COUNT-MSG-5.                                      04680045
046900                                                                  04690045
047000 9100-SQL-ABEND.                                                  04700045
047100******************************************************************04710045
047200*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    04720045
047300*  ERROR OR WARNING CODE OCCURS.                                  04730045
047400******************************************************************04740045
047500     DISPLAY '9100-SQL-ABEND'.                                    04750045
047600     DISPLAY '** ABEND     **'.                                   04760045
047700     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        04770045
047800     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             04780045
047900     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     04790045
048000     DISPLAY '**              ** = '.                             04800045
048100     MOVE SQLCODE TO PV-SQL-CODE.                                 04810045
048200     DISPLAY '** SQL CODE  ** = ' PV-SQL-CODE.                    04820045
048300     MOVE +4013 TO PV-ABEND-CODE.                                 04830045
048400     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         04840045
048500                                                                  04850045
