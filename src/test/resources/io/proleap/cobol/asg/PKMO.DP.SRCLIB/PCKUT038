000100 IDENTIFICATION DIVISION.                                         00010000
000200 TITLE 'STORE EXPECTED CLEANUP REPORT EXTRACT'.                   00020012
000300                                                                  00030000
000400 PROGRAM-ID.             PCKUT038.                                00040000
000500 AUTHOR.                 DENNIS STEFFEN.                          00050000
000600 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00060000
000700 DATE-WRITTEN            MARCH 2005.                              00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000 ENVIRONMENT DIVISION.                                            00100000
001100 CONFIGURATION SECTION.                                           00110000
001200                                                                  00120000
001300 SOURCE-COMPUTER.        IBM-3090.                                00130000
001400 OBJECT-COMPUTER.        IBM-3090.                                00140000
001500 INPUT-OUTPUT SECTION.                                            00150000
001600 FILE-CONTROL.                                                    00160000
001700                                                                  00170000
001800     SELECT STORE-EXPECTED-GT-90                                  00180000
001900         ASSIGN TO INP01.                                         00190000
002000     SELECT REPORT-EXTRACT-FILE                                   00200000
002100         ASSIGN TO OUT01.                                         00210000
002200                                                                  00220000
002300 DATA DIVISION.                                                   00230000
002400 FILE SECTION.                                                    00240000
002500                                                                  00250000
002600 FD  STORE-EXPECTED-GT-90                                         00260000
002700     RECORDING MODE IS F                                          00270000
002800     LABEL RECORDS ARE STANDARD                                   00280000
002900     BLOCK CONTAINS 0 RECORDS.                                    00290000
003000                                                                  00300000
003100 01  STORE-EXPECTED-GT-90-REC         PIC X(035).                 00310000
003200                                                                  00320000
003300 FD  REPORT-EXTRACT-FILE                                          00330000
003400     RECORDING MODE IS F                                          00340000
003500     LABEL RECORDS ARE STANDARD                                   00350000
003600     BLOCK CONTAINS 0 RECORDS.                                    00360000
003700                                                                  00370000
003800 01  REPORT-EXTRACT-REC             PIC X(150).                   00380000
003900                                                                  00390000
004000 WORKING-STORAGE SECTION.                                         00400000
004100                                                                  00410000
004200 01  FILLER.                                                      00420000
004300     05  FILLER                      PIC  X(36)    VALUE          00430000
004400         ' ***** WORKING STORAGE PGM=PCKUT038 '.                  00440000
004500     05  PGM-COMPILED                PIC  X(20)    VALUE SPACE.   00450000
004600     05  FILLER                      PIC  X(10)    VALUE          00460000
004700         ' LOCATION='.                                            00470000
004800     05  PGM-LOCATION                PIC  X(04)    VALUE SPACE.   00480000
004900     05  FILLER                      PIC  X(06)    VALUE          00490000
005000         ' *****'.                                                00500000
005100                                                                  00510000
005200 01  PS-SWITCHES.                                                 00520000
005300     05  PS-EOF-SW                    PIC X(01) VALUE 'N'.        00530000
005400         88  PS-EOF-EXTRACT-YES                 VALUE 'Y'.        00540000
005500         88  PS-EOF-EXTRACT-NO                  VALUE 'N'.        00550000
005600     05  PS-TRIP-CSR-SW               PIC X(01) VALUE 'N'.        00560000
005700         88  PS-END-OF-TRIP-CSR                 VALUE 'Y'.        00570000
005710     05  PS-LINE-NBR-TRY-AGAIN-SW     PIC X(01) VALUE 'N'.        00571000
005720         88  PS-LINE-NBR-TRY-AGAIN-NO           VALUE 'N'.        00572000
005730         88  PS-LINE-NBR-TRY-AGAIN-YES          VALUE 'Y'.        00573000
005800                                                                  00580000
005900 01  PC-CONSTANTS.                                                00590000
006000     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          00600000
006100                                                   'PCKUT038'.    00610000
006200     05  PV-CKPT-JOB-NAME            PIC X(08)   VALUE 'PCK115'.  00620000
006300     05  PC-ILBOABN0                 PIC  X(08)    VALUE          00630000
006400                                                   'ILBOABN0'.    00640000
006500     05  PC-MAX-RETRIES              PIC S9(04)    VALUE  +3      00650000
006600                                                   COMP.          00660000
006700                                                                  00670000
006800 01  PV-PARM-STUFF.                                               00680000
006900     05  PV-NEAR-PARM                 PIC S9(09) COMP VALUE ZERO. 00690000
007000     05  PV-FAR-PARM                  PIC S9(09) COMP VALUE ZERO. 00700000
007100     05  PV-PERCENT-PARM              PIC S9(09) COMP VALUE ZERO. 00710000
007200     05  PV-INVENTORY-PARM            PIC S9(09) COMP VALUE ZERO. 00720000
007201                                                                  00720101
007202* DMH - 5/6/21 - BEGIN                                            00720201
007210     05  PV-NEAR-PARM-SEPH-SUPP       PIC S9(09) COMP VALUE ZERO. 00721001
007220     05  PV-FAR-PARM-SEPH-SUPP        PIC S9(09) COMP VALUE ZERO. 00722001
007230     05  PV-PERCENT-PARM-SEPH-SUPP    PIC S9(09) COMP VALUE ZERO. 00723001
007240     05  PV-INVENTORY-PARM-SEPH-SUPP  PIC S9(09) COMP VALUE ZERO. 00724001
007300                                                                  00730000
007310     05  PV-NEAR-PARM-SEPH-DIFF       PIC S9(09) COMP VALUE ZERO. 00731001
007320     05  PV-FAR-PARM-SEPH-DIFF        PIC S9(09) COMP VALUE ZERO. 00732001
007330     05  PV-PERCENT-PARM-SEPH-DIFF    PIC S9(09) COMP VALUE ZERO. 00733001
007340     05  PV-INVENTORY-PARM-SEPH-DIFF  PIC S9(09) COMP VALUE ZERO. 00734001
007350* DMH - 5/6/21 - END                                              00735001
007400                                                                  00740000
007500*    FOR PARM='CLEAN2' -- OVER XXX DAYS OLD                       00750000
007600*    EXAMPLE:  > 90 DAYS OLD                                      00760000
007700                                                                  00770000
007800 01  PV-CLEAN-REASONS.                                            00780000
007900     05  PV-CLEAN-MSG1.                                           00790000
008000         10  FILLER                   PIC X(01) VALUE '>'.        00800000
008100         10  PV-CLEAN-MSG1-PARM       PIC ZZ9.                    00810000
008200         10  FILLER                   PIC X(09) VALUE             00820000
008300                         ' DAYS OLD'.                             00830000
008400         10  FILLER                   PIC X(27) VALUE SPACES.     00840000
008500                                                                  00850000
008600*    FOR BETWEEN 'CLEAN1' AND 'CLEAN2' DAYS OLD                   00860000
008700*        & >= 'CLEAN3' %                                          00870000
008800*    EXAMPLE: >7 & <90 DAYS OLD AND >= 95%                        00880000
008900                                                                  00890000
009000     05  PV-CLEAN-MSG2.                                           00900000
009100         10  FILLER                   PIC X(01) VALUE '>'.        00910000
009200         10  PV-CLEAN-MSG2-PARM1      PIC ZZ9.                    00920000
009300         10  FILLER                   PIC X(04) VALUE             00930000
009400                         ' & <'.                                  00940000
009500         10  PV-CLEAN-MSG2-PARM2      PIC ZZ9.                    00950000
009600         10  FILLER                   PIC X(12) VALUE             00960000
009700                         ' DAYS AND >='.                          00970000
009800         10  PV-CLEAN-MSG2-PARM3      PIC ZZ9.                    00980000
009900         10  FILLER                   PIC X(01) VALUE             00990000
010000                         '%'.                                     01000000
010100         10  FILLER                   PIC X(20) VALUE SPACES.     01010000
010200                                                                  01020000
010300*    FOR PARM='CLEAN4' -- OVER XXX DAYS OLD FOR INVENTORY RPTS    01030000
010400*    EXAMPLE:  > 21 DAYS OLD                                      01040000
010500                                                                  01050000
010600     05  PV-CLEAN-MSG3.                                           01060000
010700         10  FILLER                   PIC X(01) VALUE '>'.        01070000
010800         10  PV-CLEAN-MSG3-PARM       PIC ZZ9.                    01080000
010900         10  FILLER                   PIC X(09) VALUE             01090000
011000                         ' DAYS OLD'.                             01100000
011100         10  FILLER                   PIC X(27) VALUE SPACES.     01110000
011200                                                                  01120000
011210*    FOR PARM='CLEAN4' -- CLEAN TRANSACTIONS GENERATED BY         01121000
011220*                         PHYSICAL INVENTORY ADJ REVERSALS        01122000
011230                                                                  01123000
011240     05  PV-CLEAN-MSG4.                                           01124000
011250         10  FILLER                   PIC X(40) VALUE             01125000
011260                                                'PHY INV REVERSE'.01126000
011270                                                                  01127000
011271* DMH - 5/6/21 - BEGIN                                            01127101
011272*    FOR PARM='CLEANA' -- OVER XXX DAYS OLD                       01127201
011273*    EXAMPLE:  > 90 DAYS OLD-SEPHORA-SUPPORT DC                   01127301
011274                                                                  01127401
011276     05  PV-CLEAN-MSG5.                                           01127601
011277         10  FILLER                   PIC X(01) VALUE '>'.        01127701
011278         10  PV-CLEANA-MSG5-PARM      PIC ZZ9.                    01127801
011279         10  FILLER                   PIC X(09) VALUE             01127901
011280                         ' DAYS OLD'.                             01128001
011281         10  FILLER                   PIC X(27) VALUE             01128101
011282                         '-SEPHORA-SUPPORT DC        '.           01128201
011284                                                                  01128401
011285*    FOR BETWEEN 'CLEANA' AND 'CLEANB' DAYS OLD                   01128501
011286*        & >= 'CLEANC' %                                          01128601
011287*    EXAMPLE: >7 & <90 DAYS OLD AND >= 95%-SEPHORA-SUPPORT DC     01128701
011288                                                                  01128801
011289     05  PV-CLEAN-MSG6.                                           01128901
011290         10  FILLER                   PIC X(01) VALUE '>'.        01129001
011291         10  PV-CLEANA-MSG6-PARM1     PIC ZZ9.                    01129101
011292         10  FILLER                   PIC X(04) VALUE             01129201
011293                         ' & <'.                                  01129301
011294         10  PV-CLEANB-MSG6-PARM2     PIC ZZ9.                    01129401
011295         10  FILLER                   PIC X(12) VALUE             01129501
011296                         ' DAYS AND >='.                          01129601
011297         10  PV-CLEANC-MSG6-PARM3      PIC ZZ9.                   01129701
011298         10  FILLER                   PIC X(01) VALUE             01129801
011299                         '%'.                                     01129901
011300         10  FILLER                   PIC X(20) VALUE             01130001
011301                         '-SEPHORA-SUPPORT DC '.                  01130101
011302                                                                  01130201
011303*    FOR PARM='CLEAND' -- OVER XXX DAYS OLD FOR INVENTORY RPTS    01130301
011304*    EXAMPLE:  > 21 DAYS OLD-SEPHORA-SUPPORT DC                   01130401
011305                                                                  01130501
011306     05  PV-CLEAN-MSG7.                                           01130601
011307         10  FILLER                   PIC X(01) VALUE '>'.        01130701
011308         10  PV-CLEAND-MSG7-PARM      PIC ZZ9.                    01130801
011309         10  FILLER                   PIC X(09) VALUE             01130901
011310                         ' DAYS OLD'.                             01131001
011311         10  FILLER                   PIC X(27) VALUE             01131101
011312                         '-SEPHORA-SUPPORT DC        '.           01131201
011313                                                                  01131301
011314*    FOR PARM='CLEAND' -- CLEAN TRANSACTIONS GENERATED BY         01131401
011315*                         PHYSICAL INVENTORY ADJ REVERSALS        01131501
011316*                           -SEPHORA-SUPPORT DC                   01131601
011317                                                                  01131701
011318     05  PV-CLEAN-MSG8.                                           01131801
011319         10  FILLER                   PIC X(40) VALUE             01131901
011320                         'PHY INV REVERSE-SEPHORA SUPPORT DC '.   01132001
011321                                                                  01132101
011322*    FOR PARM='CLEANE' -- OVER XXX DAYS OLD                       01132201
011323*    EXAMPLE:  > 90 DAYS OLD-SEPHORA-DIFFERENT DC                 01132301
011324                                                                  01132401
011325     05  PV-CLEAN-MSG9.                                           01132501
011326         10  FILLER                   PIC X(01) VALUE '>'.        01132601
011327         10  PV-CLEANE-MSG9-PARM      PIC ZZ9.                    01132701
011328         10  FILLER                   PIC X(09) VALUE             01132801
011329                         ' DAYS OLD'.                             01132901
011330         10  FILLER                   PIC X(27) VALUE             01133001
011331                         '-SEPHORA-DIFFERENT DC      '.           01133101
011332                                                                  01133201
011333*    FOR BETWEEN 'CLEANE' AND 'CLEANF' DAYS OLD                   01133301
011334*        & >= 'CLEANG' %                                          01133401
011335*    EXAMPLE: >7 & <90 DAYS OLD AND >= 95%-SEPHORA-DIFFERENT DC   01133501
011336                                                                  01133601
011337     05  PV-CLEAN-MSG10.                                          01133701
011338         10  FILLER                   PIC X(01) VALUE '>'.        01133801
011339         10  PV-CLEANE-MSG10-PARM1    PIC ZZ9.                    01133901
011340         10  FILLER                   PIC X(04) VALUE             01134001
011341                         ' & <'.                                  01134101
011342         10  PV-CLEANF-MSG10-PARM2    PIC ZZ9.                    01134201
011343         10  FILLER                   PIC X(12) VALUE             01134301
011344                         ' DAYS AND >='.                          01134401
011345         10  PV-CLEANG-MSG10-PARM3    PIC ZZ9.                    01134501
011346         10  FILLER                   PIC X(01) VALUE             01134601
011347                         '%'.                                     01134701
011348         10  FILLER                   PIC X(20) VALUE             01134801
011349                         '-SEPHORA-DIFFERNT DC'.                  01134901
011350                                                                  01135001
011351*    FOR PARM='CLEANH' -- OVER XXX DAYS OLD FOR INVENTORY RPTS    01135101
011352*    EXAMPLE:  > 21 DAYS OLD-SEPHORA-DIFFERENT DC                 01135201
011353                                                                  01135301
011354     05  PV-CLEAN-MSG11.                                          01135401
011355         10  FILLER                   PIC X(01) VALUE '>'.        01135501
011356         10  PV-CLEANH-MSG11-PARM     PIC ZZ9.                    01135601
011357         10  FILLER                   PIC X(09) VALUE             01135701
011358                         ' DAYS OLD'.                             01135801
011359         10  FILLER                   PIC X(27) VALUE             01135901
011360                         '-SEPHORA-DIFFERENT DC      '.           01136001
011361                                                                  01136101
011362*    FOR PARM='CLEANH' -- CLEAN TRANSACTIONS GENERATED BY         01136201
011363*                         PHYSICAL INVENTORY ADJ REVERSALS        01136301
011364*                           -SEPHORA-DIFFERENT DC                 01136401
011365                                                                  01136501
011366     05  PV-CLEAN-MSG12.                                          01136601
011367         10  FILLER                   PIC X(40) VALUE             01136701
011368                         'PHY INV REVERSE-SEPHORA DIFFERNT DC'.   01136801
011369* DMH - 5/6/21 - BEGIN                                            01136901
011370                                                                  01137001
011371 01  PV-MISC-STUFF.                                               01137101
011372     05  PV-DISP-PARM                 PIC -Z(8)9 VALUE ZERO.      01137207
011373     05  PV-PREV-PO-NBR               PIC S9(08) COMP VALUE ZERO. 01137307
011380     05  PV-ABEND-PARAGRAPH           PIC  X(30) VALUE SPACES.    01138000
011400     05  PV-DB2-OPERATION-ATTEMPTED   PIC  X(60) VALUE SPACE.     01140000
011500     05  PV-SQL-CODE                  PIC  9(04) VALUE ZERO.      01150000
011600     05  PV-ABEND-CODE                PIC S9(04) VALUE ZERO       01160000
011700                                                   COMP SYNC.     01170000
011800     05  PV-RETRY-COUNTER             PIC S9(04) VALUE ZERO       01180000
011900                                                 COMP SYNC.       01190000
012000     05  PV-COMMIT-COUNTER            PIC S9(04) VALUE ZERO       01200000
012100                                                 COMP SYNC.       01210000
012200     05  PV-READ-COUNTER              PIC S9(09) COMP-3           01220000
012300                                              VALUE ZERO.         01230000
012400     05  PV-DISP-CONTROL              PIC S9(09) COMP-3           01240000
012500                                              VALUE ZERO.         01250000
012600     05  PV-TIME                      PIC X(08) VALUE SPACES.     01260000
012700     05  PV-TRIP-CNT                  PIC S9(04) COMP-3           01270000
012800                                              VALUE ZERO.         01280000
012900     05  PV-NULL-IND-1                PIC S9(04)  VALUE +0  COMP. 01290000
013000     05  PV-WRITE-1-COUNTER           PIC S9(09) COMP-3           01300000
013100                                              VALUE ZERO.         01310000
013200     05  PV-BYPASS-COUNT              PIC S9(09) COMP-3           01320000
013300                                              VALUE ZERO.         01330000
013400     05  PV-DISP-NBR                  PIC ZZZ,ZZZ,ZZ9.            01340000
013500     05  PV-ABEND-OPERATION           PIC X(20) VALUE SPACES.     01350000
013600     05  PV-ABEND-STRUCTURE-1         PIC X(20) VALUE SPACES.     01360000
013700                                                                  01370000
013800     05  PT-TRIP-TABLE.                                           01380000
013900         10  PT-TRIP PIC S9(9) COMP OCCURS 4 TIMES.               01390000
014000     05  PV-TRIP-SUB                  PIC S9(03) COMP-3.          01400000
014100                                                                  01410000
014200 01  ABEND-CODE                       PIC S9(04)     VALUE +0     01420000
014300                                                     COMP SYNC.   01430000
014400     88  ABEND-4001-WRITE-ERROR                      VALUE +4001. 01440000
014500     88  ABEND-4002-READ-ERROR                       VALUE +4002. 01450000
014600     88  ABEND-4003-CTRL-CARD-ERROR                  VALUE +4003. 01460000
014700     88  ABEND-4004-TABLE-ERROR                      VALUE +4004. 01470000
014800     88  ABEND-4005-OPEN-ERROR                       VALUE +4005. 01480000
014900     88  ABEND-4006-CLOSE-ERROR                      VALUE +4006. 01490000
015000     88  ABEND-4007-SEQUENCE-ERROR                   VALUE +4007. 01500000
015100     88  ABEND-4008-DATS-ERROR                       VALUE +4008. 01510000
015200     88  ABEND-4009-KEY-DATS-ERROR                   VALUE +4009. 01520000
015300     88  ABEND-4013-DB2-ERROR                        VALUE +4013. 01530000
015400                                                                  01540000
015500 01  PV-COUNT-MSG-1.                                              01550000
015600     05  FILLER                       PIC X(26) VALUE             01560000
015700         'RECORDS WRITTEN TO OUT01 ='.                            01570000
015800     05  PV-MSG-1-COUNT               PIC Z,ZZZ,ZZZ,ZZ9.          01580000
015900                                                                  01590000
016000 01  PV-COUNT-MSG-4.                                              01600000
016100     05  FILLER                       PIC X(26) VALUE             01610000
016200         'RECORDS READ             ='.                            01620000
016300     05  PV-MSG-READ-COUNT            PIC Z,ZZZ,ZZZ,ZZ9.          01630000
016400                                                                  01640000
016500 01  CC-CONTROL-CARD.                                             01650000
016600     05  CC-PROGRAM-NAME              PIC X(08)    VALUE SPACES.  01660000
016700     05  FILLER                       PIC X(72)    VALUE SPACES.  01670000
016800                                                                  01680000
016900*    SE UNBALANCED FILE                                           01690000
017000     COPY PCRD041.                                                01700000
017100                                                                  01710000
017200*    REPORT EXTRACT FILE                                          01720000
017300     COPY PCRD038.                                                01730000
017400/                                                                 01740000
017500*    PARM TABLE                                                   01750000
017600     EXEC SQL                                                     01760000
017700         INCLUDE TKRPRPM                                          01770000
017800     END-EXEC.                                                    01780000
017900                                                                  01790000
018000/                                                                 01800000
018100*    IN-TRANSIT DETAIL TABLE                                      01810000
018200     EXEC SQL                                                     01820000
018300         INCLUDE PCT00015                                         01830000
018400     END-EXEC.                                                    01840000
018500                                                                  01850000
018600*    XLT_SKU                                                      01860000
018700     EXEC SQL                                                     01870000
018800         INCLUDE XLT00003                                         01880000
018900     END-EXEC.                                                    01890000
019000                                                                  01900000
019100*    XLT_VND_STYL                                                 01910000
019200     EXEC SQL                                                     01920000
019300         INCLUDE XLT00004                                         01930000
019400     END-EXEC.                                                    01940000
019500                                                                  01950000
019600*    RECEIVER MASTER                                              01960000
019700     EXEC SQL                                                     01970000
019800         INCLUDE TRECEIV                                          01980000
019900     END-EXEC.                                                    01990000
020000                                                                  02000000
020100*    UPC PRICES BY STORE                                          02010000
020200     EXEC SQL                                                     02020000
020300         INCLUDE TUPCPLS                                          02030000
020400     END-EXEC.                                                    02040000
020500*                                                                 02050000
020600*  PURCHASE ORDER ITEM                                            02060000
020700     EXEC SQL                                                     02070000
020800         INCLUDE TPURITM                                          02080000
020900     END-EXEC.                                                    02090000
021000*                                                                 02100000
021100*  CENTRAL STOCK ITEM                                             02110000
021101     EXEC SQL                                                     02110100
021102         INCLUDE TCEPLIT                                          02110200
021103     END-EXEC.                                                    02110300
021104*                                                                 02110400
021105*  CENTRAL STOCK ITEM                                             02110500
021106     EXEC SQL                                                     02110600
021107         INCLUDE TCEPLDS                                          02110700
021108     END-EXEC.                                                    02110800
021111*---------------------------------------------------------------* 02111100
021120*    RC-RECEIPT ITEM                                              02112000
021130*---------------------------------------------------------------* 02113000
021140     EXEC SQL                                                     02114000
021150          INCLUDE TRECITM                                         02115000
021160     END-EXEC.                                                    02116000
021170*---------------------------------------------------------------* 02117000
021180*    RC-RECEIPT DISTRIBUTION                                      02118000
021190*---------------------------------------------------------------* 02119000
021191     EXEC SQL                                                     02119100
021192          INCLUDE TRECDIS                                         02119200
021193     END-EXEC.                                                    02119300
021200                                                                  02120000
021300     EXEC SQL                                                     02130000
021400         INCLUDE SQLCA                                            02140000
021500     END-EXEC.                                                    02150000
021600                                                                  02160000
021700     COPY SQLCA2.                                                 02170000
021800                                                                  02180000
021900     COPY DPWS004.                                                02190000
022000*---------------------------------------------------------------* 02200000
022100* USE THIS CURSOR TO RETRIEVE OTBND TRIP ID FOR EXTRACT FILE      02210000
022200*---------------------------------------------------------------* 02220000
022300     EXEC SQL                                                     02230000
022400          DECLARE TRIP-CSR CURSOR WITH ROWSET POSITIONING         02240000
022410          FOR                                                     02241000
022500              SELECT DISTINCT                                     02250000
022600                     OTBND_TRIP_ID                                02260000
022700                FROM  PCT_TRN_CLSN_DTL                            02270000
022800               WHERE  INTR_UPC_ID    = :PC041-INTR-UPC-ID         02280000
022900                 AND  LOC_NBR        = :PC041-LOC-NBR             02290000
023000                 AND  PO_NBR         = :PC041-PO-NBR              02300000
023100                 AND  RCVR_SEQ_NBR   = :PC041-RCVR-SEQ-NBR        02310000
023200                 AND OTBND_TRIP_ID IS NOT NULL                    02320000
023300               WITH UR                                            02330000
023400     END-EXEC.                                                    02340000
023500                                                                  02350000
023600*---------------------------------------------------------------* 02360000
023700 PROCEDURE DIVISION.                                              02370000
023800                                                                  02380000
023810     DISPLAY 'START - PCKUT038'.                                  02381010
023820                                                                  02382010
023900     PERFORM 1000-INITIALIZATION.                                 02390000
024000                                                                  02400000
024100     PERFORM 2000-PROCESS UNTIL PS-EOF-EXTRACT-YES                02410000
024200                                                                  02420000
024300     PERFORM 9000-QUIT.                                           02430000
024400                                                                  02440000
024500     GOBACK.                                                      02450000
024600/                                                                 02460000
024700 1000-INITIALIZATION.                                             02470000
024800     MOVE '1000-INITIALIZATION         '  TO PV-ABEND-PARAGRAPH.  02480000
024900                                                                  02490000
025000     OPEN INPUT STORE-EXPECTED-GT-90                              02500000
025100     OPEN OUTPUT REPORT-EXTRACT-FILE                              02510000
025200                                                                  02520000
025300     ACCEPT CC-CONTROL-CARD FROM SYSIN.                           02530000
025400       DISPLAY ' REPORT PROGRAM = ' CC-PROGRAM-NAME.              02540000
025410       DISPLAY ' '.                                               02541011
025500                                                                  02550000
025600     PERFORM 8000-READ-EXTRACT.                                   02560000
025700                                                                  02570000
025800     IF PS-EOF-EXTRACT-YES                                        02580000
025900         DISPLAY SPACES                                           02590000
026000         DISPLAY ALL '*'                                          02600000
026100         DISPLAY '  INPUT FILE IS EMPTY '                         02610000
026200         DISPLAY ALL '*'                                          02620000
026300         DISPLAY SPACES                                           02630000
026400     END-IF.                                                      02640000
026500     PERFORM 1100-SETUP-CLEAN-REASONS.                            02650000
026510                                                                  02651001
026520                                                                  02652001
026600 1100-SETUP-CLEAN-REASONS.                                        02660000
026700     PERFORM 7400-GET-NEAR-PARM.                                  02670000
026710     PERFORM 7403-GET-NEAR-PARM-SEPH-SUPP.                        02671001
026720     PERFORM 7405-GET-NEAR-PARM-SEPH-DIFF.                        02672001
026730                                                                  02673001
026800     PERFORM 7410-GET-FAR-PARM.                                   02680000
026810     PERFORM 7413-GET-FAR-PARM-SEPH-SUPP.                         02681001
026820     PERFORM 7415-GET-FAR-PARM-SEPH-DIFF.                         02682001
026830                                                                  02683001
026900     PERFORM 7420-GET-PERCENT-PARM.                               02690000
026910     PERFORM 7423-GET-PERCNT-PARM-SEPH-SUPP.                      02691002
026920     PERFORM 7425-GET-PERCNT-PARM-SEPH-DIFF.                      02692002
026930                                                                  02693001
027000     PERFORM 7430-GET-INVENTORY-PARM.                             02700001
027010     PERFORM 7433-GET-INVTRY-PARM-SEPH-SUPP.                      02701002
027020     PERFORM 7435-GET-INVTRY-PARM-SEPH-DIFF.                      02702002
027100                                                                  02710000
027200     MOVE PV-NEAR-PARM                TO PV-CLEAN-MSG2-PARM1      02720000
027300     MOVE PV-FAR-PARM                 TO PV-CLEAN-MSG2-PARM2      02730000
027400                                         PV-CLEAN-MSG1-PARM       02740000
027500     MOVE PV-PERCENT-PARM             TO PV-CLEAN-MSG2-PARM3      02750000
027600     MOVE PV-INVENTORY-PARM           TO PV-CLEAN-MSG3-PARM.      02760000
027610                                                                  02761001
027620* DMH - 5/6/2021 - BEGIN                                          02762001
027621     MOVE PV-NEAR-PARM-SEPH-SUPP      TO PV-CLEANA-MSG6-PARM1.    02762101
027622     MOVE PV-FAR-PARM-SEPH-SUPP       TO PV-CLEANB-MSG6-PARM2     02762202
027623                                         PV-CLEANA-MSG5-PARM.     02762302
027624     MOVE PV-PERCENT-PARM-SEPH-SUPP   TO PV-CLEANC-MSG6-PARM3.    02762401
027625     MOVE PV-INVENTORY-PARM-SEPH-SUPP TO PV-CLEAND-MSG7-PARM.     02762501
027626                                                                  02762601
027627     MOVE PV-NEAR-PARM-SEPH-DIFF      TO PV-CLEANE-MSG10-PARM1.   02762701
027628     MOVE PV-FAR-PARM-SEPH-DIFF       TO PV-CLEANF-MSG10-PARM2    02762801
027629                                         PV-CLEANE-MSG9-PARM.     02762902
027630     MOVE PV-PERCENT-PARM-SEPH-DIFF   TO PV-CLEANG-MSG10-PARM3.   02763001
027631     MOVE PV-INVENTORY-PARM-SEPH-DIFF TO PV-CLEANH-MSG11-PARM.    02763101
027632                                                                  02763201
027640* DMH - 5/6/2021 - BEGIN                                          02764001
027700                                                                  02770003
027710                                                                  02771003
027720*---------------------------------------------------------------- 02772003
027730*                                                                 02773003
027740*---------------------------------------------------------------- 02774003
027800 2000-PROCESS.                                                    02780000
027900                                                                  02790000
028000     MOVE '2000-PROCESS'                  TO PV-ABEND-PARAGRAPH.  02800000
028100     PERFORM 2200-BUILD-REPORT-REC                                02810000
028200     PERFORM 8200-WRITE-PC038.                                    02820000
028300                                                                  02830000
028400     IF PV-COMMIT-COUNTER > 10000                                 02840000
028500         PERFORM 7999-COMMIT                                      02850000
028600     END-IF                                                       02860000
028700                                                                  02870000
028800     PERFORM 8000-READ-EXTRACT.                                   02880000
028900                                                                  02890003
028901                                                                  02890103
028910*---------------------------------------------------------------- 02891003
028920*                                                                 02892003
028930*---------------------------------------------------------------- 02893003
029000 2200-BUILD-REPORT-REC.                                           02900000
029100                                                                  02910000
029200     INITIALIZE PC038-SE-UNBALANCED-RPT-REC                       02920000
029300     MOVE PC041-PO-NBR                TO PC038-PO-NBR             02930000
029400     MOVE PC041-RCVR-SEQ-NBR          TO PC038-RCVR-SEQ-NBR       02940000
029500     MOVE PC041-LOC-NBR               TO PC038-LOC-NBR            02950000
029600     MOVE PC041-INTRNST-TRN-DTE       TO PC038-INTRNST-TRN-DTE    02960000
029700     MOVE PC041-INTR-UPC-ID           TO XLT00003-INTR-UPC-ID     02970000
029800     MOVE PC041-INTR-UPC-ID           TO PC038-INTR-UPC-ID        02980000
029810     MOVE PC041-SEPHORA-IND           TO PC038-SEPHORA-IND        02981005
029820     MOVE PC041-SEPHORA-DC            TO PC038-SEPHORA-DC         02982006
029900                                                                  02990000
030000     IF CC-PROGRAM-NAME = 'PCKRP022'                              03000000
030100         PERFORM 7050-GET-SKU                                     03010000
030200     ELSE                                                         03020000
030300         PERFORM 7000-GET-SKU-AND-PRICES                          03030000
030400     END-IF                                                       03040000
030500                                                                  03050000
030510     SET PS-LINE-NBR-TRY-AGAIN-NO TO TRUE                         03051000
030520     IF PC041-RCVR-SEQ-NBR = ZERO                                 03052000
030530        PERFORM 7140-SELECT-LNE-NBR-CS                            03053000
030540     ELSE                                                         03054000
030600        PERFORM 7100-SELECT-LNE-NBR                               03060000
030601     END-IF                                                       03060100
030610     IF PS-LINE-NBR-TRY-AGAIN-YES                                 03061000
030611         SET PS-LINE-NBR-TRY-AGAIN-NO TO TRUE                     03061100
030620         PERFORM 7110-LNE-NBR-2ND-TRY                             03062000
030630         IF PS-LINE-NBR-TRY-AGAIN-YES                             03063000
030631             SET PS-LINE-NBR-TRY-AGAIN-NO TO TRUE                 03063100
030640             PERFORM 7120-LNE-NBR-3RD-TRY                         03064000
030641             IF PS-LINE-NBR-TRY-AGAIN-YES                         03064100
030643                 PERFORM 7130-LNE-NBR-4TH-TRY                     03064300
030650             END-IF                                               03065000
030651         END-IF                                                   03065100
030660     END-IF.                                                      03066000
030700                                                                  03070000
030800     MOVE XLT00003-SKU-NBR            TO PC038-SKU-9              03080000
030900                                                                  03090000
031000     MOVE XLT00004-DEPT-NBR           TO PC038-DEPT-NBR           03100000
031100     MOVE XLT00004-SUB-CL-NBR         TO PC038-SUB-CL-NBR         03110000
031200     MOVE PC041-TRN-CLSN-QTY          TO PC038-STR-EXPECTED-UNITS 03120000
031300                                                                  03130000
031400     IF PC038-STR-EXPECTED-UNITS < ZERO                           03140000
031500        MULTIPLY PC038-STR-EXPECTED-UNITS BY -1                   03150000
031600             GIVING PC038-UNITS-VARIANCE                          03160000
031700     ELSE                                                         03170000
031800         MOVE PC038-STR-EXPECTED-UNITS                            03180000
031900                                      TO PC038-UNITS-VARIANCE     03190000
032000     END-IF                                                       03200000
032100                                                                  03210000
032200***** DETERMINED THAT THE EXTRACT CREATED FOR STORE INVENTORY     03220000
032300*     AND SUBSEQUENT REPORTS WERE NOT GETTING NEGATIVE AMOUNTS    03230000
032400*     DUE TO THE CODE BELOW.                                      03240000
032500***************************************************************** 03250000
032600*    IF PC038-STR-EXPECTED-UNITS < ZERO                           03260000
032700*       MULTIPLY PC038-STR-EXPECTED-UNITS BY -1                   03270000
032800*            GIVING PC038-STR-EXPECTED-UNITS                      03280000
032900*    END-IF                                                       03290000
033000*                                                                 03300000
033100*    MULTIPLY UPCPLS-UNT-RTL-AMT BY PC041-TRN-CLSN-QTY            03310000
033200*            GIVING PC038-EXTD-RTL-AMT                            03320000
033300*    IF PC038-EXTD-RTL-AMT < ZERO                                 03330000
033400*       MULTIPLY PC038-EXTD-RTL-AMT BY -1                         03340000
033500*            GIVING PC038-EXTD-RTL-AMT                            03350000
033600*    END-IF                                                       03360000
033700                                                                  03370000
033800     MULTIPLY UPCPLS-UNT-RTL-AMT BY PC041-TRN-CLSN-QTY            03380000
033900             GIVING PC038-EXTD-RTL-AMT                            03390000
034000                                                                  03400000
034010*                                                                 03401003
034020* DMH - 5/6/2021 BEGIN - SEPHORA CHANGES                          03402003
034030*                                                                 03403003
034031     IF  PC041-SEPHORA                                            03403103
034032         IF  PC041-SEPHORA-SUPPORT-DC                             03403203
034033             EVALUATE TRUE                                        03403303
034034                 WHEN PC041-GT-90                                 03403403
034035                      MOVE PV-CLEAN-MSG5  TO PC038-CLEAN-REASON   03403503
034036                 WHEN PC041-GT-21                                 03403603
034037                      MOVE PV-CLEAN-MSG7  TO PC038-CLEAN-REASON   03403703
034038                 WHEN PC041-GT-7-LT-90                            03403803
034039                      MOVE PV-CLEAN-MSG6  TO PC038-CLEAN-REASON   03403903
034040                 WHEN PC041-PHY-INV-REVERSE                       03404003
034041                      MOVE PV-CLEAN-MSG8  TO PC038-CLEAN-REASON   03404103
034042                 WHEN OTHER                                       03404203
034043                      MOVE SPACES TO PC038-CLEAN-REASON           03404303
034044             END-EVALUATE                                         03404403
034045         ELSE                                                     03404503
034046             EVALUATE TRUE                                        03404603
034047                 WHEN PC041-GT-90                                 03404703
034048                      MOVE PV-CLEAN-MSG9  TO PC038-CLEAN-REASON   03404803
034049                 WHEN PC041-GT-21                                 03404903
034050                      MOVE PV-CLEAN-MSG11 TO PC038-CLEAN-REASON   03405003
034051                 WHEN PC041-GT-7-LT-90                            03405103
034052                      MOVE PV-CLEAN-MSG10 TO PC038-CLEAN-REASON   03405203
034053                 WHEN PC041-PHY-INV-REVERSE                       03405303
034054                      MOVE PV-CLEAN-MSG12 TO PC038-CLEAN-REASON   03405403
034055                 WHEN OTHER                                       03405503
034056                      MOVE SPACES TO PC038-CLEAN-REASON           03405603
034057             END-EVALUATE                                         03405703
034058         END-IF                                                   03405803
034059                                                                  03405903
034060*                                                                 03406003
034061* DMH - 5/6/2021 END   - SEPHORA CHANGES                          03406103
034062*                                                                 03406203
034070     ELSE                                                         03407003
034100         EVALUATE TRUE                                            03410003
034200             WHEN PC041-GT-90                                     03420003
034300                  MOVE PV-CLEAN-MSG1    TO PC038-CLEAN-REASON     03430003
034400             WHEN PC041-GT-21                                     03440003
034500                  MOVE PV-CLEAN-MSG3    TO PC038-CLEAN-REASON     03450003
034600             WHEN PC041-GT-7-LT-90                                03460003
034700                  MOVE PV-CLEAN-MSG2    TO PC038-CLEAN-REASON     03470003
034710             WHEN PC041-PHY-INV-REVERSE                           03471003
034720                  MOVE PV-CLEAN-MSG4    TO PC038-CLEAN-REASON     03472003
034800             WHEN OTHER                                           03480003
034900                  MOVE SPACES TO PC038-CLEAN-REASON               03490003
035000         END-EVALUATE                                             03500003
035010     END-IF.                                                      03501003
035100                                                                  03510000
035200     EVALUATE TRUE                                                03520000
035300     WHEN PC038-PO-NBR = ZEROES                                   03530000
035400         MOVE 90                      TO PC038-OPER-UNT-ID        03540000
035500     WHEN OTHER                                                   03550000
035600         PERFORM 7200-SELECT-RCVR                                 03560000
035700         MOVE RECEIV-CURR-OPER-UNT-ID                             03570000
035800                                      TO PC038-OPER-UNT-ID        03580000
035900         MOVE RECEIV-REC-TYP-CDE      TO PC038-REC-TYP-CDE        03590000
036000     END-EVALUATE.                                                03600000
036100                                                                  03610000
036200     IF CC-PROGRAM-NAME = 'PCKRP020' OR 'PCKRP021'                03620000
036300         CONTINUE                                                 03630000
036400     ELSE                                                         03640000
036500         PERFORM 7300-GET-OTBND-TRIP-ID                           03650000
036600     END-IF.                                                      03660000
036700                                                                  03670000
036800                                                                  03680003
036810*---------------------------------------------------------------- 03681004
036820*                                                                 03682004
036830*---------------------------------------------------------------- 03683004
036900 7000-GET-SKU-AND-PRICES.                                         03690000
037000                                                                  03700000
037100     MOVE '7000-GET-SKU-AND-PRICES' TO PV-ABEND-PARAGRAPH.        03710000
037200                                                                  03720000
037300     INITIALIZE XLT00003-ITM-NBR                                  03730000
037400                XLT00003-SKU-NBR                                  03740000
037500                XLT00004-DEPT-NBR                                 03750000
037600                XLT00004-SUB-CL-NBR                               03760000
037700                UPCPLS-UNT-RTL-AMT                                03770000
037800                                                                  03780000
037900     PERFORM                                                      03790000
038000         WITH TEST AFTER                                          03800000
038100         VARYING PV-RETRY-COUNTER                                 03810000
038200         FROM 1 BY 1                                              03820000
038300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               03830000
038400            OR  (SQLCODE = +100)                                  03840000
038500            OR  (SQLCODE = +0))                                   03850000
038600                                                                  03860000
038700         EXEC SQL                                                 03870000
038800             SELECT SK.ITM_NBR                                    03880000
038900              ,     SK.SKU_NBR                                    03890000
039000              ,     PL.UNT_RTL_AMT                                03900000
039100              ,     DP.DEPT_NBR                                   03910000
039200              ,     DP.SUB_CL_NBR                                 03920000
039300             INTO :XLT00003-ITM-NBR                               03930000
039400              ,   :XLT00003-SKU-NBR                               03940000
039500              ,   :UPCPLS-UNT-RTL-AMT                             03950000
039600              ,   :XLT00004-DEPT-NBR                              03960000
039700              ,   :XLT00004-SUB-CL-NBR                            03970000
039800              FROM  XLT_SKU             SK                        03980000
039900              ,     TUPCPLS             PL                        03990000
040000              ,     XLT_VND_STYL        DP                        04000000
040100                                                                  04010000
040200             WHERE                                                04020000
040300                 SK.INTR_UPC_ID    = :XLT00003-INTR-UPC-ID        04030000
040400            AND  SK.INTR_UPC_ID    = PL.UPC_ID                    04040000
040500            AND  SK.STYL_ID        = DP.STYL_ID                   04050000
040600            AND  PL.OPERCO_NBR     = '03'                         04060000
040700            AND  PL.STR_NBR        = 0                            04070000
040800            AND  PL.EFF_BEG_TMST <= CURRENT TIMESTAMP             04080000
040900            AND (PL.EFF_END_TMST >= CURRENT TIMESTAMP             04090000
041000              OR PL.EFF_END_TMST IS NULL)                         04100000
041100            WITH UR                                               04110000
041200                                                                  04120000
041300         END-EXEC                                                 04130000
041400                                                                  04140000
041500         EVALUATE TRUE                                            04150000
041600             WHEN SQLCODE = ZERO                                  04160000
041700             WHEN SQLCODE = +100                                  04170000
041800                 CONTINUE                                         04180000
041900             WHEN SQLCODE = -904                                  04190000
042000             WHEN SQLCODE = -911                                  04200000
042100             WHEN SQLCODE = -913                                  04210000
042200                  CONTINUE                                        04220000
042300                                                                  04230000
042400             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              04240000
042500                 DISPLAY '**************************************' 04250000
042600                 DISPLAY 'WARNING ISSUED '                        04260000
042700                 DISPLAY 'SELECT XLT_SKU / TUPCPLS              ' 04270000
042800                 DISPLAY '**************************************' 04280000
042900                 PERFORM 9800-SQL-WARNING                         04290000
043000                                                                  04300000
043100             WHEN SQLCODE < ZERO                                  04310000
043200                 DISPLAY '**************************************' 04320000
043300                 DISPLAY 'ERROR ISSUED ON                       ' 04330000
043400                 DISPLAY 'SELECT XLT_SKU / TUPCPLS              ' 04340000
043500                 DISPLAY '**************************************' 04350000
043600                 PERFORM 9900-SQL-ERROR                           04360000
043700                                                                  04370000
043800         END-EVALUATE                                             04380000
043900     END-PERFORM.                                                 04390000
044000                                                                  04400000
044100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    04410000
044200         SQLCODE NOT = ZERO                                       04420000
044300         DISPLAY '**************************************'         04430000
044400         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         04440000
044500         DISPLAY 'SELECT XLT_SKU / TUPCPLS              '         04450000
044600         DISPLAY '**************************************'         04460000
044700         PERFORM 9900-SQL-ERROR                                   04470000
044800     END-IF.                                                      04480000
044900                                                                  04490000
045000 7050-GET-SKU.                                                    04500000
045100                                                                  04510000
045200     MOVE '7050-GET-SKU'              TO PV-ABEND-PARAGRAPH.      04520000
045300                                                                  04530000
045400     INITIALIZE XLT00003-ITM-NBR                                  04540000
045500                XLT00003-SKU-NBR                                  04550000
045600                XLT00004-DEPT-NBR                                 04560000
045700                XLT00004-SUB-CL-NBR                               04570000
045800                UPCPLS-UNT-RTL-AMT                                04580000
045900                                                                  04590000
046000     PERFORM                                                      04600000
046100         WITH TEST AFTER                                          04610000
046200         VARYING PV-RETRY-COUNTER                                 04620000
046300         FROM 1 BY 1                                              04630000
046400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               04640000
046500            OR  (SQLCODE = +100)                                  04650000
046600            OR  (SQLCODE = +0))                                   04660000
046700                                                                  04670000
046800         EXEC SQL                                                 04680000
046900             SELECT SK.ITM_NBR                                    04690000
047000              ,     SK.SKU_NBR                                    04700000
047100              ,     DP.DEPT_NBR                                   04710000
047200              ,     DP.SUB_CL_NBR                                 04720000
047300             INTO :XLT00003-ITM-NBR                               04730000
047400              ,   :XLT00003-SKU-NBR                               04740000
047500              ,   :XLT00004-DEPT-NBR                              04750000
047600              ,   :XLT00004-SUB-CL-NBR                            04760000
047700              FROM  XLT_SKU             SK                        04770000
047800              ,     XLT_VND_STYL        DP                        04780000
047900             WHERE                                                04790000
048000                   INTR_UPC_ID       = :XLT00003-INTR-UPC-ID      04800000
048100              AND  SK.STYL_ID        = DP.STYL_ID                 04810000
048200         WITH UR                                                  04820000
048300         END-EXEC                                                 04830000
048400                                                                  04840000
048500         EVALUATE TRUE                                            04850000
048600             WHEN SQLCODE = ZERO                                  04860000
048700             WHEN SQLCODE = +100                                  04870000
048800                 CONTINUE                                         04880000
048900             WHEN SQLCODE = -904                                  04890000
049000             WHEN SQLCODE = -911                                  04900000
049100             WHEN SQLCODE = -913                                  04910000
049200                  CONTINUE                                        04920000
049300                                                                  04930000
049400             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              04940000
049500                 DISPLAY '**************************************' 04950000
049600                 DISPLAY 'WARNING ISSUED '                        04960000
049700                 DISPLAY 'SELECT XLT_SKU / XLT_VND_STYL         ' 04970000
049800                 DISPLAY '**************************************' 04980000
049900                 PERFORM 9800-SQL-WARNING                         04990000
050000                                                                  05000000
050100             WHEN SQLCODE < ZERO                                  05010000
050200                 DISPLAY '**************************************' 05020000
050300                 DISPLAY 'ERROR ISSUED ON                       ' 05030000
050400                 DISPLAY 'SELECT XLT_SKU / XLT_VND_STYL         ' 05040000
050500                 DISPLAY '**************************************' 05050000
050600                 PERFORM 9900-SQL-ERROR                           05060000
050700                                                                  05070000
050800         END-EVALUATE                                             05080000
050900     END-PERFORM.                                                 05090000
051000                                                                  05100000
051100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    05110000
051200         SQLCODE NOT = ZERO                                       05120000
051300         DISPLAY '**************************************'         05130000
051400         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         05140000
051500         DISPLAY 'SELECT XLT_SKU / XLT_VND_STYL         '         05150000
051600         DISPLAY '**************************************'         05160000
051700         PERFORM 9900-SQL-ERROR                                   05170000
051800     END-IF.                                                      05180000
051900                                                                  05190000
052000                                                                  05200000
052100 7100-SELECT-LNE-NBR.                                             05210000
052200                                                                  05220000
052300     MOVE '7100-SELECT-LNE-NBR'       TO PV-ABEND-PARAGRAPH.      05230000
052400                                                                  05240000
052500     PERFORM                                                      05250000
052600         WITH TEST AFTER                                          05260000
052700         VARYING PV-RETRY-COUNTER                                 05270000
052800         FROM 1 BY 1                                              05280000
052900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05290000
053000            OR  (SQLCODE = +0)                                    05300000
053100            OR  (SQLCODE = +100)                                  05310000
053200            OR  (SQLCODE = -811))                                 05320000
053300                                                                  05330000
053400         EXEC SQL                                                 05340000
053500             SELECT                                               05350000
053600                 APP_PO_LNE_NBR                                   05360000
053700             INTO                                                 05370000
053800                 :PURITM-APP-PO-LNE-NBR                           05380000
053900              FROM  TPURITM                                       05390000
054000             WHERE                                                05400000
054100             PO_NBR                 = :PC041-PO-NBR               05410000
054200         AND ITM_NBR                = :XLT00003-ITM-NBR           05420000
054300         AND VER_STATUS_CDE         = 'A'                         05430000
054400         END-EXEC                                                 05440000
054500                                                                  05450000
054600         EVALUATE TRUE                                            05460000
054700             WHEN SQLCODE = ZERO                                  05470000
054800                 MOVE PURITM-APP-PO-LNE-NBR                       05480000
054900                                      TO PC038-APP-PO-LNE-NBR     05490000
055000             WHEN SQLCODE = +100                                  05500000
055100                 MOVE SPACES          TO PC038-APP-PO-LNE-NBR-X   05510000
055200             WHEN SQLCODE = -811                                  05520000
055300*                MOVE 'MULT'          TO PC038-APP-PO-LNE-NBR-X   05530000
055310                 SET PS-LINE-NBR-TRY-AGAIN-YES                    05531000
055320                                      TO TRUE                     05532000
055400             WHEN SQLCODE = -904                                  05540000
055500             WHEN SQLCODE = -911                                  05550000
055600             WHEN SQLCODE = -913                                  05560000
055700                  CONTINUE                                        05570000
055800                                                                  05580000
055900             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              05590000
056000                 DISPLAY '**************************************' 05600000
056100                 DISPLAY 'WARNING ISSUED '                        05610000
056200                 DISPLAY 'SELECT TPURITM                        ' 05620000
056300                 DISPLAY '**************************************' 05630000
056400                 PERFORM 9800-SQL-WARNING                         05640000
056500                                                                  05650000
056600             WHEN SQLCODE < ZERO                                  05660000
056700                 DISPLAY '**************************************' 05670000
056800                 DISPLAY 'ERROR ISSUED ON                       ' 05680000
056900                 DISPLAY 'SELECT TPURITM                        ' 05690000
057000                 DISPLAY '**************************************' 05700000
057100                 PERFORM 9900-SQL-ERROR                           05710000
057200                                                                  05720000
057300         END-EVALUATE                                             05730000
057400     END-PERFORM.                                                 05740000
057500                                                                  05750000
057600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    05760000
057700         SQLCODE NOT = ZERO                                       05770000
057800         DISPLAY '**************************************'         05780000
057900         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         05790000
058000         DISPLAY 'SELECT TPURITM         '                        05800000
058100         DISPLAY '**************************************'         05810000
058200         PERFORM 9900-SQL-ERROR                                   05820000
058300     END-IF.                                                      05830000
058301                                                                  05830100
058310 7110-LNE-NBR-2ND-TRY.                                            05831000
058320                                                                  05832000
058330     MOVE '7110-LNE-NBR-2ND-TRY'       TO PV-ABEND-PARAGRAPH.     05833000
058340                                                                  05834000
058350     PERFORM                                                      05835000
058360         WITH TEST AFTER                                          05836000
058370         VARYING PV-RETRY-COUNTER                                 05837000
058380         FROM 1 BY 1                                              05838000
058390         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05839000
058391            OR  (SQLCODE = +0)                                    05839100
058392            OR  (SQLCODE = +100)                                  05839200
058393            OR  (SQLCODE = -811))                                 05839300
058394                                                                  05839400
058395         EXEC SQL                                                 05839500
058396             SELECT                                               05839600
058397                 B.ORD_LNE_NBR                                    05839700
058398             INTO                                                 05839800
058399                 :RECITM-ORD-LNE-NBR                              05839900
058400              FROM  TPURITM A                                     05840000
058401                   ,TRECITM B                                     05840100
058402             WHERE                                                05840200
058403             A.PO_NBR                 = :PC041-PO-NBR             05840300
058404         AND A.PO_NBR                 =  B.ORD_NBR                05840400
058405         AND A.ITM_NBR                = :XLT00003-ITM-NBR         05840500
058407         AND A.APP_PO_LNE_NBR         =  B.ORD_LNE_NBR            05840700
058408         AND A.VER_STATUS_CDE         = 'A'                       05840800
058409         AND B.REC_SEQ_NBR            = :PC041-RCVR-SEQ-NBR       05840900
058410         AND B.VER_STATUS_CDE         = 'A'                       05841000
058411         END-EXEC                                                 05841100
058412                                                                  05841200
058413         EVALUATE TRUE                                            05841300
058414             WHEN SQLCODE = ZERO                                  05841400
058415                 MOVE RECITM-ORD-LNE-NBR                          05841500
058416                                      TO PC038-APP-PO-LNE-NBR     05841600
058417             WHEN SQLCODE = +100                                  05841700
058418                 MOVE 'MULT'          TO PC038-APP-PO-LNE-NBR-X   05841800
058419             WHEN SQLCODE = -811                                  05841900
058420                 SET PS-LINE-NBR-TRY-AGAIN-YES                    05842000
058421                                      TO TRUE                     05842100
058423             WHEN SQLCODE = -904                                  05842300
058424             WHEN SQLCODE = -911                                  05842400
058425             WHEN SQLCODE = -913                                  05842500
058426                  CONTINUE                                        05842600
058427                                                                  05842700
058428             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              05842800
058429                 DISPLAY '**************************************' 05842900
058430                 DISPLAY 'WARNING ISSUED '                        05843000
058431                 DISPLAY 'SELECT TPURITM, TRECITM               ' 05843100
058432                 DISPLAY '**************************************' 05843200
058433                 PERFORM 9800-SQL-WARNING                         05843300
058434                                                                  05843400
058435             WHEN SQLCODE < ZERO                                  05843500
058436                 DISPLAY '**************************************' 05843600
058437                 DISPLAY 'ERROR ISSUED ON                       ' 05843700
058438                 DISPLAY 'SELECT TPURITM, TRECITM               ' 05843800
058439                 DISPLAY '**************************************' 05843900
058440                 PERFORM 9900-SQL-ERROR                           05844000
058441                                                                  05844100
058442         END-EVALUATE                                             05844200
058443     END-PERFORM.                                                 05844300
058444                                                                  05844400
058445     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    05844500
058446         SQLCODE NOT = ZERO                                       05844600
058447         DISPLAY '**************************************'         05844700
058448         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         05844800
058449         DISPLAY 'SELECT TPURITM, TRECITM'                        05844900
058450         DISPLAY '**************************************'         05845000
058451         PERFORM 9900-SQL-ERROR                                   05845100
058452     END-IF.                                                      05845200
058453                                                                  05845300
058454 7120-LNE-NBR-3RD-TRY.                                            05845400
058455                                                                  05845500
058456     MOVE '7120-LNE-NBR-3RD-TRY'       TO PV-ABEND-PARAGRAPH.     05845600
058457                                                                  05845700
058458     PERFORM                                                      05845800
058459         WITH TEST AFTER                                          05845900
058460         VARYING PV-RETRY-COUNTER                                 05846000
058461         FROM 1 BY 1                                              05846100
058462         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05846200
058463            OR  (SQLCODE = +0)                                    05846300
058464            OR  (SQLCODE = +100)                                  05846400
058465            OR  (SQLCODE = -811))                                 05846500
058466                                                                  05846600
058467         EXEC SQL                                                 05846700
058468             SELECT                                               05846800
058469                 B.ORD_LNE_NBR                                    05846900
058470             INTO                                                 05847000
058471                 :RECITM-ORD-LNE-NBR                              05847100
058472              FROM  TPURITM A                                     05847200
058473                   ,TRECITM B                                     05847300
058474                   ,TRECDIS C                                     05847400
058475             WHERE                                                05847500
058476             A.PO_NBR                 = :PC041-PO-NBR             05847600
058477         AND A.PO_NBR                 =  B.ORD_NBR                05847700
058478         AND A.PO_NBR                 =  C.ORD_NBR                05847800
058479         AND A.ITM_NBR                = :XLT00003-ITM-NBR         05847900
058480         AND A.APP_PO_LNE_NBR         =  B.ORD_LNE_NBR            05848000
058481         AND A.VER_STATUS_CDE         = 'A'                       05848100
058482         AND B.REC_SEQ_NBR            = :PC041-RCVR-SEQ-NBR       05848200
058483         AND B.REC_SEQ_NBR            =  C.REC_SEQ_NBR            05848300
058484         AND B.VER_STATUS_CDE         = 'A'                       05848400
058485         AND B.ORD_LNE_NBR            =  C.ORD_LNE_NBR            05848500
058486         AND C.STR_NBR                = :PC041-LOC-NBR            05848600
058488         END-EXEC                                                 05848800
058489                                                                  05848900
058490         EVALUATE TRUE                                            05849000
058491             WHEN SQLCODE = ZERO                                  05849100
058492                 MOVE RECITM-ORD-LNE-NBR                          05849200
058493                                      TO PC038-APP-PO-LNE-NBR     05849300
058494             WHEN SQLCODE = +100                                  05849400
058495                 MOVE 'MULT'          TO PC038-APP-PO-LNE-NBR-X   05849500
058496             WHEN SQLCODE = -811                                  05849600
058497                 SET PS-LINE-NBR-TRY-AGAIN-YES                    05849700
058498                                      TO TRUE                     05849800
058499             WHEN SQLCODE = -904                                  05849900
058500             WHEN SQLCODE = -911                                  05850000
058501             WHEN SQLCODE = -913                                  05850100
058502                  CONTINUE                                        05850200
058503                                                                  05850300
058504             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              05850400
058505                 DISPLAY '**************************************' 05850500
058506                 DISPLAY 'WARNING ISSUED '                        05850600
058507                 DISPLAY 'SELECT TPURITM, TRECITM, TRECDIS      ' 05850700
058508                 DISPLAY '**************************************' 05850800
058509                 PERFORM 9800-SQL-WARNING                         05850900
058510                                                                  05851000
058511             WHEN SQLCODE < ZERO                                  05851100
058512                 DISPLAY '**************************************' 05851200
058513                 DISPLAY 'ERROR ISSUED ON                       ' 05851300
058514                 DISPLAY 'SELECT TPURITM, TRECITM, TRECDIS      ' 05851400
058515                 DISPLAY '**************************************' 05851500
058516                 PERFORM 9900-SQL-ERROR                           05851600
058517                                                                  05851700
058518         END-EVALUATE                                             05851800
058519     END-PERFORM.                                                 05851900
058520                                                                  05852000
058521     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    05852100
058522         SQLCODE NOT = ZERO                                       05852200
058523         DISPLAY '**************************************'         05852300
058524         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         05852400
058525         DISPLAY 'SELECT TPURITM, TRECITM, TRECDIS'               05852500
058526         DISPLAY '**************************************'         05852600
058527         PERFORM 9900-SQL-ERROR                                   05852700
058528     END-IF.                                                      05852800
058529                                                                  05852900
058530 7130-LNE-NBR-4TH-TRY.                                            05853000
058531                                                                  05853100
058532     MOVE '7130-LNE-NBR-4TH-TRY'       TO PV-ABEND-PARAGRAPH.     05853200
058533                                                                  05853300
058534     PERFORM                                                      05853400
058535         WITH TEST AFTER                                          05853500
058536         VARYING PV-RETRY-COUNTER                                 05853600
058537         FROM 1 BY 1                                              05853700
058538         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05853800
058539            OR  (SQLCODE = +0)                                    05853900
058540            OR  (SQLCODE = +100)                                  05854000
058541            OR  (SQLCODE = -811))                                 05854100
058542                                                                  05854200
058543         EXEC SQL                                                 05854300
058544             SELECT                                               05854400
058545                 B.ORD_LNE_NBR                                    05854500
058546             INTO                                                 05854600
058547                 :RECITM-ORD-LNE-NBR                              05854700
058548              FROM  TPURITM A                                     05854800
058549                   ,TRECITM B                                     05854900
058550                   ,TRECDIS C                                     05855000
058551             WHERE                                                05855100
058552             A.PO_NBR                 = :PC041-PO-NBR             05855200
058553         AND A.PO_NBR                 =  B.ORD_NBR                05855300
058554         AND A.PO_NBR                 =  C.ORD_NBR                05855400
058555         AND A.ITM_NBR                = :XLT00003-ITM-NBR         05855500
058556         AND A.APP_PO_LNE_NBR         =  B.ORD_LNE_NBR            05855600
058557         AND A.VER_STATUS_CDE         = 'A'                       05855700
058558         AND B.REC_SEQ_NBR            = :PC041-RCVR-SEQ-NBR       05855800
058559         AND B.REC_SEQ_NBR            =  C.REC_SEQ_NBR            05855900
058560         AND B.VER_STATUS_CDE         = 'A'                       05856000
058561         AND B.ORD_LNE_NBR            =  C.ORD_LNE_NBR            05856100
058562         AND C.STR_NBR                = :PC041-LOC-NBR            05856200
058563         AND C.AP_VERIFY_ITM_QTY      >  0                        05856300
058565         END-EXEC                                                 05856500
058566                                                                  05856600
058567         EVALUATE TRUE                                            05856700
058568             WHEN SQLCODE = ZERO                                  05856800
058569                 MOVE RECITM-ORD-LNE-NBR                          05856900
058570                                      TO PC038-APP-PO-LNE-NBR     05857000
058571             WHEN SQLCODE = +100                                  05857100
058572             WHEN SQLCODE = -811                                  05857200
058573                 MOVE 'MULT'          TO PC038-APP-PO-LNE-NBR-X   05857300
058576             WHEN SQLCODE = -904                                  05857600
058577             WHEN SQLCODE = -911                                  05857700
058578             WHEN SQLCODE = -913                                  05857800
058579                  CONTINUE                                        05857900
058580                                                                  05858000
058581             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              05858100
058582                 DISPLAY '**************************************' 05858200
058583                 DISPLAY 'WARNING ISSUED '                        05858300
058584                 DISPLAY 'SELECT TPURITM, TRECITM, TRECDIS      ' 05858400
058585                 DISPLAY '**************************************' 05858500
058586                 PERFORM 9800-SQL-WARNING                         05858600
058587                                                                  05858700
058588             WHEN SQLCODE < ZERO                                  05858800
058589                 DISPLAY '**************************************' 05858900
058590                 DISPLAY 'ERROR ISSUED ON                       ' 05859000
058591                 DISPLAY 'SELECT TPURITM, TRECITM, TRECDIS      ' 05859100
058592                 DISPLAY '**************************************' 05859200
058593                 PERFORM 9900-SQL-ERROR                           05859300
058594                                                                  05859400
058595         END-EVALUATE                                             05859500
058596     END-PERFORM.                                                 05859600
058597                                                                  05859700
058598     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    05859800
058599         SQLCODE NOT = ZERO                                       05859900
058600         DISPLAY '**************************************'         05860000
058601         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         05860100
058602         DISPLAY 'SELECT TPURITM, TRECITM, TRECDIS'               05860200
058603         DISPLAY '**************************************'         05860300
058604         PERFORM 9900-SQL-ERROR                                   05860400
058605     END-IF.                                                      05860500
058606******************************************************************05860600
058607                                                                  05860700
058608 7140-SELECT-LNE-NBR-CS.                                          05860800
058609                                                                  05860900
058610     MOVE '7140-SELECT-LNE-NBR-CS'       TO PV-ABEND-PARAGRAPH.   05861000
058611                                                                  05861100
058613     PERFORM                                                      05861300
058614         WITH TEST AFTER                                          05861400
058615         VARYING PV-RETRY-COUNTER                                 05861500
058616         FROM 1 BY 1                                              05861600
058617         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05861700
058618            OR  (SQLCODE = +0)                                    05861800
058619            OR  (SQLCODE = +100)                                  05861900
058620            OR  (SQLCODE = -811))                                 05862000
058621                                                                  05862100
058622         EXEC SQL                                                 05862200
058623             SELECT                                               05862300
058624                 PL_LNE_NBR                                       05862400
058625             INTO                                                 05862500
058626                 :CEPLIT-PL-LNE-NBR                               05862600
058627              FROM  TCEPLIT                                       05862700
058628             WHERE                                                05862800
058629             CNSTK_REQ_PL_NBR       = :PC041-PO-NBR               05862900
058630         AND ITM_NBR                = :XLT00003-ITM-NBR           05863000
058631         END-EXEC                                                 05863100
058632                                                                  05863200
058633         EVALUATE TRUE                                            05863300
058634             WHEN SQLCODE = ZERO                                  05863400
058635                 MOVE CEPLIT-PL-LNE-NBR                           05863500
058636                                      TO PC038-APP-PO-LNE-NBR     05863600
058637             WHEN SQLCODE = +100                                  05863700
058639                 MOVE SPACES          TO PC038-APP-PO-LNE-NBR-X   05863900
058640             WHEN SQLCODE = -811                                  05864000
058641                 PERFORM 7150-SELECT-LNE-NBR-TCEPLDS              05864100
058644             WHEN SQLCODE = -904                                  05864400
058645             WHEN SQLCODE = -911                                  05864500
058646             WHEN SQLCODE = -913                                  05864600
058647                  CONTINUE                                        05864700
058648                                                                  05864800
058649             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              05864900
058650                 DISPLAY '**************************************' 05865000
058651                 DISPLAY 'WARNING ISSUED '                        05865100
058652                 DISPLAY 'SELECT TCEPLIT                        ' 05865200
058653                 DISPLAY '**************************************' 05865300
058654                 PERFORM 9800-SQL-WARNING                         05865400
058655                                                                  05865500
058656             WHEN SQLCODE < ZERO                                  05865600
058657                 DISPLAY '**************************************' 05865700
058658                 DISPLAY 'ERROR ISSUED ON                       ' 05865800
058659                 DISPLAY 'SELECT TCEPLIT                        ' 05865900
058660                 DISPLAY '**************************************' 05866000
058661                 PERFORM 9900-SQL-ERROR                           05866100
058662                                                                  05866200
058663         END-EVALUATE                                             05866300
058664     END-PERFORM.                                                 05866400
058665                                                                  05866500
058666     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    05866600
058667         SQLCODE NOT = ZERO                                       05866700
058668         DISPLAY '**************************************'         05866800
058669         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         05866900
058670         DISPLAY 'SELECT TCEPLIT         '                        05867000
058671         DISPLAY '**************************************'         05867100
058672         PERFORM 9900-SQL-ERROR                                   05867200
058673     END-IF.                                                      05867300
058674                                                                  05867400
058675 7150-SELECT-LNE-NBR-TCEPLDS.                                     05867500
058676                                                                  05867600
058677     MOVE '7150-SELECT-LNE-NBR-TCEPLDS'  TO PV-ABEND-PARAGRAPH.   05867700
058678                                                                  05867800
058682     PERFORM                                                      05868200
058683         WITH TEST AFTER                                          05868300
058684         VARYING PV-RETRY-COUNTER                                 05868400
058685         FROM 1 BY 1                                              05868500
058686         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05868600
058687            OR  (SQLCODE = +0)                                    05868700
058688            OR  (SQLCODE = +100)                                  05868800
058689            OR  (SQLCODE = -811))                                 05868900
058690                                                                  05869000
058691         EXEC SQL                                                 05869100
058692             SELECT                                               05869200
058693                 A.PL_LNE_NBR                                     05869300
058694             INTO                                                 05869400
058695                 :CEPLDS-PL-LNE-NBR                               05869500
058696              FROM  TCEPLDS A                                     05869600
058697                   ,TCEPLIT B                                     05869700
058698             WHERE                                                05869800
058699             A.CNSTK_REQ_PL_NBR     = :PC041-PO-NBR               05869900
058700         AND A.CNSTK_REQ_PL_NBR     = B.CNSTK_REQ_PL_NBR          05870000
058701         AND A.PL_LNE_NBR           = B.PL_LNE_NBR                05870100
058702         AND A.STR_NBR              = :PC041-LOC-NBR              05870200
058703         AND B.ITM_NBR              = :XLT00003-ITM-NBR           05870300
058704         END-EXEC                                                 05870400
058705                                                                  05870500
058706         EVALUATE TRUE                                            05870600
058707             WHEN SQLCODE = ZERO                                  05870700
058708                 MOVE CEPLDS-PL-LNE-NBR                           05870800
058709                                      TO PC038-APP-PO-LNE-NBR     05870900
058710             WHEN SQLCODE = +100                                  05871000
058712             WHEN SQLCODE = -811                                  05871200
058713                 MOVE 'MULT'          TO PC038-APP-PO-LNE-NBR-X   05871300
058714             WHEN SQLCODE = -904                                  05871400
058715             WHEN SQLCODE = -911                                  05871500
058716             WHEN SQLCODE = -913                                  05871600
058717                  CONTINUE                                        05871700
058718                                                                  05871800
058719             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              05871900
058720                 DISPLAY '**************************************' 05872000
058721                 DISPLAY 'WARNING ISSUED '                        05872100
058722                 DISPLAY 'SELECT TCEPLDS                        ' 05872200
058723                 DISPLAY '**************************************' 05872300
058724                 PERFORM 9800-SQL-WARNING                         05872400
058725                                                                  05872500
058726             WHEN SQLCODE < ZERO                                  05872600
058727                 DISPLAY '**************************************' 05872700
058728                 DISPLAY 'ERROR ISSUED ON                       ' 05872800
058729                 DISPLAY 'SELECT TCEPLDS                        ' 05872900
058730                 DISPLAY '**************************************' 05873000
058731                 PERFORM 9900-SQL-ERROR                           05873100
058732                                                                  05873200
058733         END-EVALUATE                                             05873300
058734     END-PERFORM.                                                 05873400
058735                                                                  05873500
058736     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    05873600
058737         SQLCODE NOT = ZERO                                       05873700
058738         DISPLAY '**************************************'         05873800
058739         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         05873900
058740         DISPLAY 'SELECT TCEPLIT         '                        05874000
058741         DISPLAY '**************************************'         05874100
058742         PERFORM 9900-SQL-ERROR                                   05874200
058743     END-IF.                                                      05874300
058744                                                                  05874400
058745 7200-SELECT-RCVR.                                                05874500
058750                                                                  05875000
058800     MOVE '7200-SELECT-RCVR'          TO PV-ABEND-PARAGRAPH.      05880000
058900                                                                  05890000
059000     MOVE PC041-PO-NBR                TO RECEIV-ORD-NBR           05900000
059100     MOVE PC041-RCVR-SEQ-NBR          TO RECEIV-REC-SEQ-NBR       05910000
059200     INITIALIZE RECEIV-CURR-OPER-UNT-ID                           05920000
059300                RECEIV-REC-TYP-CDE                                05930000
059400                                                                  05940000
059500     PERFORM                                                      05950000
059600         WITH TEST AFTER                                          05960000
059700         VARYING PV-RETRY-COUNTER                                 05970000
059800         FROM 1 BY 1                                              05980000
059900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05990000
060000            OR  (SQLCODE = +100)                                  06000000
060100            OR  (SQLCODE = +0))                                   06010000
060200                                                                  06020000
060300         EXEC SQL                                                 06030000
060400             SELECT                                               06040000
060500                 CURR_OPER_UNT_ID                                 06050000
060600             ,   REC_TYP_CDE                                      06060000
060700             INTO                                                 06070000
060800                 :RECEIV-CURR-OPER-UNT-ID                         06080000
060900             ,   :RECEIV-REC-TYP-CDE                              06090000
061000              FROM  TRECEIV                                       06100000
061100             WHERE                                                06110000
061200             ORD_NBR                 = :RECEIV-ORD-NBR            06120000
061300         AND REC_SEQ_NBR             = :RECEIV-REC-SEQ-NBR        06130000
061400         AND FCLTY_ID                = 1                          06140000
061500         AND VER_STATUS_CDE          = 'A'                        06150000
061600         WITH UR                                                  06160000
061700         END-EXEC                                                 06170000
061800                                                                  06180000
061900         EVALUATE TRUE                                            06190000
062000             WHEN SQLCODE = ZERO                                  06200000
062100                 CONTINUE                                         06210000
062200             WHEN SQLCODE = +100                                  06220000
062300                 MOVE 90              TO RECEIV-CURR-OPER-UNT-ID  06230000
062400             WHEN SQLCODE = -904                                  06240000
062500             WHEN SQLCODE = -911                                  06250000
062600             WHEN SQLCODE = -913                                  06260000
062700                  CONTINUE                                        06270000
062800                                                                  06280000
062900             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              06290000
063000                 DISPLAY '**************************************' 06300000
063100                 DISPLAY 'WARNING ISSUED '                        06310000
063200                 DISPLAY 'SELECT TRECEIV                        ' 06320000
063300                 DISPLAY '**************************************' 06330000
063400                 PERFORM 9800-SQL-WARNING                         06340000
063500                                                                  06350000
063600             WHEN SQLCODE < ZERO                                  06360000
063700                 DISPLAY '**************************************' 06370000
063800                 DISPLAY 'ERROR ISSUED ON                       ' 06380000
063900                 DISPLAY 'SELECT TRECEIV                        ' 06390000
064000                 DISPLAY '**************************************' 06400000
064100                 PERFORM 9900-SQL-ERROR                           06410000
064200                                                                  06420000
064300         END-EVALUATE                                             06430000
064400     END-PERFORM.                                                 06440000
064500                                                                  06450000
064600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    06460000
064700         SQLCODE NOT = ZERO                                       06470000
064800         DISPLAY '**************************************'         06480000
064900         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         06490000
065000         DISPLAY 'SELECT TRECEIV         '                        06500000
065100         DISPLAY '**************************************'         06510000
065200         PERFORM 9900-SQL-ERROR                                   06520000
065300     END-IF.                                                      06530000
065400******************************************************************06540000
065500 7300-GET-OTBND-TRIP-ID.                                          06550000
065600     MOVE 'N'  TO  PS-TRIP-CSR-SW.                                06560000
065700     MOVE +0   TO  PV-TRIP-CNT.                                   06570000
065800     MOVE 1                           TO PV-TRIP-SUB.             06580000
065900     INITIALIZE PT-TRIP-TABLE.                                    06590000
066000                                                                  06600000
066100     PERFORM 7310-OPEN-TRIP-CSR.                                  06610000
066200                                                                  06620000
066300     PERFORM 7320-FETCH-TRIP-CSR                                  06630000
066400             VARYING PV-TRIP-SUB FROM 1 BY 1                      06640000
066500         UNTIL PS-END-OF-TRIP-CSR                                 06650000
066600                                                                  06660000
066700     PERFORM 7330-CLOSE-TRIP-CSR.                                 06670000
066800                                                                  06680000
066900     IF PV-TRIP-CNT > ZERO                                        06690000
067000     PERFORM VARYING PV-TRIP-SUB FROM 1 BY 1 UNTIL                06700000
067100                     PV-TRIP-SUB > PV-TRIP-CNT                    06710000
067200                 OR PV-TRIP-SUB > 4                               06720000
067300         EVALUATE PV-TRIP-SUB                                     06730000
067400         WHEN 1                                                   06740000
067500             MOVE PT-TRIP (PV-TRIP-SUB) TO PC038-OTBND-TRIP-1     06750000
067600         WHEN 2                                                   06760000
067700             MOVE PT-TRIP (PV-TRIP-SUB) TO PC038-OTBND-TRIP-2     06770000
067800         WHEN 3                                                   06780000
067900             MOVE PT-TRIP (PV-TRIP-SUB) TO PC038-OTBND-TRIP-3     06790000
068000         WHEN 4                                                   06800000
068100             MOVE '*' TO PC038-MULTIPLE-TRIP-IND                  06810000
068200         END-EVALUATE                                             06820000
068300     END-PERFORM                                                  06830000
068400     END-IF.                                                      06840000
068500                                                                  06850000
068600******************************************************************06860000
068700*  OPEN THE CURSOR.                                               06870000
068800******************************************************************06880000
068900 7310-OPEN-TRIP-CSR.                                              06890000
069000                                                                  06900000
069100      EXEC SQL                                                    06910000
069200           OPEN TRIP-CSR                                          06920000
069300      END-EXEC.                                                   06930000
069400                                                                  06940000
069500      EVALUATE TRUE                                               06950000
069600          WHEN SQLCODE = ZERO                                     06960000
069700          WHEN SQLCODE = -904                                     06970000
069800          WHEN SQLCODE = -911                                     06980000
069900              CONTINUE                                            06990000
070000          WHEN SQLWARN0 NOT = SPACES                              07000000
070100          WHEN SQLCODE < ZERO                                     07010000
070200          WHEN SQLCODE > ZERO                                     07020000
070300              MOVE '7310-OPEN-CURSOR' TO PV-ABEND-PARAGRAPH       07030000
070400              MOVE 'OPEN THE TRIP-CSR '                           07040000
070500                                TO PV-DB2-OPERATION-ATTEMPTED     07050000
070600              PERFORM 9100-SQL-ABEND                              07060000
070700      END-EVALUATE.                                               07070000
070800                                                                  07080000
070900******************************************************************07090000
071000*  FETCH THE ROW FROM THE RESULTS TABLE USING THE CURSOR.         07100000
071100******************************************************************07110000
071200 7320-FETCH-TRIP-CSR.                                             07120000
071300                                                                  07130000
071400     EXEC SQL                                                     07140000
071500         FETCH NEXT ROWSET                                        07150000
071510             FROM TRIP-CSR                                        07151000
071520             FOR 4 ROWS                                           07152000
071600         INTO                                                     07160000
071610             :PT-TRIP                                             07161000
071700     END-EXEC.                                                    07170000
071800                                                                  07180000
071900     EVALUATE TRUE                                                07190000
072000         WHEN SQLCODE = ZERO                                      07200000
072100             MOVE PCT00015-OTBND-TRIP-ID                          07210000
072200                                      TO PT-TRIP (PV-TRIP-SUB)    07220000
072300             ADD 1                    TO PV-TRIP-CNT              07230000
072400             IF PV-TRIP-CNT = 4                                   07240000
072500                 SET  PS-END-OF-TRIP-CSR TO TRUE                  07250000
072600             END-IF                                               07260000
072700                                                                  07270000
072800         WHEN SQLCODE = +100                                      07280000
072900             SET  PS-END-OF-TRIP-CSR TO TRUE                      07290000
073000         WHEN SQLWARN0 NOT = SPACES                               07300000
073100         WHEN SQLCODE < ZERO                                      07310000
073200         WHEN SQLCODE > ZERO                                      07320000
073300             MOVE '7320-FETCH-TRIP-CSR'  TO PV-ABEND-PARAGRAPH    07330000
073400             MOVE 'FETCH THE TRIP-CSR '                           07340000
073500                                 TO PV-DB2-OPERATION-ATTEMPTED    07350000
073600             PERFORM 9100-SQL-ABEND                               07360000
073700     END-EVALUATE.                                                07370000
073800                                                                  07380000
073900******************************************************************07390000
074000*  CLOSE THE CURSOR.                                              07400000
074100******************************************************************07410000
074200 7330-CLOSE-TRIP-CSR.                                             07420000
074300      EXEC SQL                                                    07430000
074400          CLOSE TRIP-CSR                                          07440000
074500      END-EXEC.                                                   07450000
074600                                                                  07460000
074700      EVALUATE TRUE                                               07470000
074800          WHEN SQLCODE = ZERO                                     07480000
074900          WHEN SQLCODE = -904                                     07490000
075000          WHEN SQLCODE = -911                                     07500000
075100              CONTINUE                                            07510000
075200          WHEN SQLWARN0 NOT = SPACES                              07520000
075300          WHEN SQLCODE < ZERO                                     07530000
075400          WHEN SQLCODE > ZERO                                     07540000
075500              MOVE '7330-CLOSE-TRIP-CSR' TO PV-ABEND-PARAGRAPH    07550000
075600              MOVE 'CLOSE THE TRIP-CSR   '                        07560000
075700                              TO PV-DB2-OPERATION-ATTEMPTED       07570000
075800              PERFORM 9100-SQL-ABEND                              07580000
075900      END-EVALUATE.                                               07590000
076000                                                                  07600000
076010*-----------------------------------------------------------------07601001
076020*                                                                 07602001
076030*-----------------------------------------------------------------07603001
076100 7400-GET-NEAR-PARM.                                              07610000
076200                                                                  07620000
076300     MOVE '7400-GET-NEAR-PARM'        TO PV-ABEND-PARAGRAPH.      07630000
076400                                                                  07640000
076500     PERFORM                                                      07650000
076600         WITH TEST AFTER                                          07660000
076700         VARYING PV-RETRY-COUNTER                                 07670000
076800         FROM 1 BY 1                                              07680000
076900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               07690000
077000            OR  (SQLCODE = +100)                                  07700000
077100            OR  (SQLCODE = +0))                                   07710000
077200                                                                  07720000
077300         EXEC SQL                                                 07730000
077400             SELECT FUNC_QTY                                      07740000
077500             INTO :PV-NEAR-PARM                                   07750000
077600              FROM  TKRPRPM P                                     07760000
077700             WHERE                                                07770000
077800                   P.LOC_ID            = 90                       07780000
077900               AND P.INTFC_SYS_CDE     = 'KHL'                    07790000
078000               AND P.SYS_PRC_FUNC_CDE  = 'CLEAN1'                 07800000
078100               AND P.FUNC_PRC_STAT_CDE = 'AC'                     07810000
078200         WITH UR                                                  07820000
078300         END-EXEC                                                 07830000
078400                                                                  07840000
078500         EVALUATE TRUE                                            07850000
078600             WHEN SQLCODE = ZERO                                  07860000
078700             WHEN SQLCODE = +100                                  07870000
078710                 DISPLAY 'CLEAN NEAR DAYS - CALCULATE TO DATE'    07871008
078800                 MOVE PV-NEAR-PARM  TO  PV-DISP-PARM              07880007
078810                 DISPLAY '   CLEAN1: '    PV-DISP-PARM            07881008
078820                         ' REGULAR CLEAN'                         07882007
078900             WHEN SQLCODE = -904                                  07890000
079000             WHEN SQLCODE = -911                                  07900000
079100             WHEN SQLCODE = -913                                  07910000
079200                  CONTINUE                                        07920000
079300                                                                  07930000
079400             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              07940000
079500                 DISPLAY '**************************************' 07950000
079600                 DISPLAY 'WARNING ISSUED '                        07960000
079700                 DISPLAY 'SELECT TKRPRPM                        ' 07970000
079800                 DISPLAY '**************************************' 07980000
079900                 PERFORM 9800-SQL-WARNING                         07990000
080000                                                                  08000000
080100             WHEN SQLCODE < ZERO                                  08010000
080200                 DISPLAY '**************************************' 08020000
080300                 DISPLAY 'ERROR ISSUED ON                       ' 08030000
080400                 DISPLAY 'SELECT TKRPRPM                        ' 08040000
080500                 DISPLAY '**************************************' 08050000
080600                 PERFORM 9900-SQL-ERROR                           08060000
080700                                                                  08070000
080800         END-EVALUATE                                             08080000
080900     END-PERFORM.                                                 08090000
081000                                                                  08100000
081100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    08110000
081200         SQLCODE NOT = ZERO                                       08120000
081300         DISPLAY '**************************************'         08130000
081400         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         08140000
081500         DISPLAY 'SELECT TKRPRPM         '                        08150000
081600         DISPLAY '**************************************'         08160000
081700         PERFORM 9900-SQL-ERROR                                   08170000
081800     END-IF.                                                      08180000
081900                                                                  08190000
081910*-----------------------------------------------------------------08191001
081911* GET NEAR PARM (TO DATE) FOR SEPHORA RECEIVERS PROCESSED AT THE  08191101
081912* STORES SUPPORTING DC                                            08191201
081913* DMH - 5/6/2021                                                  08191301
081914*-----------------------------------------------------------------08191401
081920 7403-GET-NEAR-PARM-SEPH-SUPP.                                    08192001
081930                                                                  08193001
081940     MOVE '7403-GET-NEAR-PARM-SEPH-SUPP' TO PV-ABEND-PARAGRAPH.   08194001
081950                                                                  08195001
081960     PERFORM                                                      08196001
081970         WITH TEST AFTER                                          08197001
081980         VARYING PV-RETRY-COUNTER                                 08198001
081990         FROM 1 BY 1                                              08199001
081991         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08199101
081992            OR  (SQLCODE = +100)                                  08199201
081993            OR  (SQLCODE = +0))                                   08199301
081994                                                                  08199401
081995         EXEC SQL                                                 08199501
081996             SELECT FUNC_QTY                                      08199601
081997             INTO :PV-NEAR-PARM-SEPH-SUPP                         08199701
081998              FROM  TKRPRPM P                                     08199801
081999             WHERE                                                08199901
082000                   P.LOC_ID            = 90                       08200001
082001               AND P.INTFC_SYS_CDE     = 'KHL'                    08200101
082002               AND P.SYS_PRC_FUNC_CDE  = 'CLEANA'                 08200201
082003               AND P.FUNC_PRC_STAT_CDE = 'AC'                     08200301
082004         WITH UR                                                  08200401
082005         END-EXEC                                                 08200501
082006                                                                  08200601
082007         EVALUATE TRUE                                            08200701
082008             WHEN SQLCODE = ZERO                                  08200801
082009             WHEN SQLCODE = +100                                  08200901
082010                 MOVE PV-NEAR-PARM-SEPH-SUPP TO PV-DISP-PARM      08201007
082011                 DISPLAY '   CLEANA: '    PV-DISP-PARM            08201108
082012                         ' SEPHORA-SUPPORT DC-NEAR DAYS'          08201207
082013             WHEN SQLCODE = -904                                  08201301
082014             WHEN SQLCODE = -911                                  08201401
082015             WHEN SQLCODE = -913                                  08201501
082016                  CONTINUE                                        08201601
082017                                                                  08201701
082018             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              08201801
082019                 DISPLAY '**************************************' 08201901
082020                 DISPLAY 'WARNING ISSUED '                        08202001
082021                 DISPLAY 'SELECT TKRPRPM - CLEANA               ' 08202101
082022                 DISPLAY '**************************************' 08202201
082023                 PERFORM 9800-SQL-WARNING                         08202301
082024                                                                  08202401
082025             WHEN SQLCODE < ZERO                                  08202501
082026                 DISPLAY '**************************************' 08202601
082027                 DISPLAY 'ERROR ISSUED ON                       ' 08202701
082028                 DISPLAY 'SELECT TKRPRPM - CLEANA               ' 08202801
082029                 DISPLAY '**************************************' 08202901
082030                 PERFORM 9900-SQL-ERROR                           08203001
082031                                                                  08203101
082032         END-EVALUATE                                             08203201
082033     END-PERFORM.                                                 08203301
082034                                                                  08203401
082035     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    08203501
082036         SQLCODE NOT = ZERO                                       08203601
082037         DISPLAY '**************************************'         08203701
082038         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         08203801
082039         DISPLAY 'SELECT TKRPRPM - CLEANA               '         08203901
082040         DISPLAY '**************************************'         08204001
082041         PERFORM 9900-SQL-ERROR                                   08204101
082042     END-IF.                                                      08204201
082043                                                                  08204301
082060*-----------------------------------------------------------------08206001
082070* GET NEAR PARM (TO DATE) FOR SEPHORA RECEIVERS PROCESSED AT A    08207001
082080* DIFFERENT DC THEN THE STORES SUPPORTING DC                      08208001
082090* DMH - 5/6/2021                                                  08209001
082091*-----------------------------------------------------------------08209101
082092 7405-GET-NEAR-PARM-SEPH-DIFF.                                    08209201
082093                                                                  08209301
082094     MOVE '7405-GET-NEAR-PARM-SEPH-DIFF' TO PV-ABEND-PARAGRAPH.   08209401
082095                                                                  08209501
082096     PERFORM                                                      08209601
082097         WITH TEST AFTER                                          08209701
082098         VARYING PV-RETRY-COUNTER                                 08209801
082099         FROM 1 BY 1                                              08209901
082100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08210001
082101            OR  (SQLCODE = +100)                                  08210101
082102            OR  (SQLCODE = +0))                                   08210201
082103                                                                  08210301
082104         EXEC SQL                                                 08210401
082105             SELECT FUNC_QTY                                      08210501
082106             INTO :PV-NEAR-PARM-SEPH-DIFF                         08210601
082107              FROM  TKRPRPM P                                     08210701
082108             WHERE                                                08210801
082109                   P.LOC_ID            = 90                       08210901
082110               AND P.INTFC_SYS_CDE     = 'KHL'                    08211001
082111               AND P.SYS_PRC_FUNC_CDE  = 'CLEANE'                 08211101
082112               AND P.FUNC_PRC_STAT_CDE = 'AC'                     08211201
082113         WITH UR                                                  08211301
082114         END-EXEC                                                 08211401
082115                                                                  08211501
082116         EVALUATE TRUE                                            08211601
082117             WHEN SQLCODE = ZERO                                  08211701
082118             WHEN SQLCODE = +100                                  08211801
082119                 MOVE PV-NEAR-PARM-SEPH-DIFF TO PV-DISP-PARM      08211907
082120                 DISPLAY '   CLEANE: '    PV-DISP-PARM            08212008
082121                         ' SEPHORA-DIFFERENT DC-NEAR DAYS'        08212107
082123             WHEN SQLCODE = -904                                  08212301
082124             WHEN SQLCODE = -911                                  08212401
082125             WHEN SQLCODE = -913                                  08212501
082126                  CONTINUE                                        08212601
082127                                                                  08212701
082128             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              08212801
082129                 DISPLAY '**************************************' 08212901
082130                 DISPLAY 'WARNING ISSUED '                        08213001
082131                 DISPLAY 'SELECT TKRPRPM - CLEANE               ' 08213101
082132                 DISPLAY '**************************************' 08213201
082133                 PERFORM 9800-SQL-WARNING                         08213301
082134                                                                  08213401
082135             WHEN SQLCODE < ZERO                                  08213501
082136                 DISPLAY '**************************************' 08213601
082137                 DISPLAY 'ERROR ISSUED ON                       ' 08213701
082138                 DISPLAY 'SELECT TKRPRPM - CLEANE               ' 08213801
082139                 DISPLAY '**************************************' 08213901
082140                 PERFORM 9900-SQL-ERROR                           08214001
082141                                                                  08214101
082142         END-EVALUATE                                             08214201
082143     END-PERFORM.                                                 08214301
082144                                                                  08214401
082145     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    08214501
082146         SQLCODE NOT = ZERO                                       08214601
082147         DISPLAY '**************************************'         08214701
082148         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         08214801
082149         DISPLAY 'SELECT TKRPRPM - CLEANE               '         08214901
082150         DISPLAY '**************************************'         08215001
082151         PERFORM 9900-SQL-ERROR                                   08215101
082152     END-IF.                                                      08215201
082153                                                                  08215301
082154*-----------------------------------------------------------------08215401
082155*                                                                 08215501
082156*-----------------------------------------------------------------08215601
082157 7410-GET-FAR-PARM.                                               08215701
082160                                                                  08216000
082200     MOVE '7410-GET-FAR-PARM'          TO PV-ABEND-PARAGRAPH.     08220000
082300                                                                  08230000
082400     PERFORM                                                      08240000
082500         WITH TEST AFTER                                          08250000
082600         VARYING PV-RETRY-COUNTER                                 08260000
082700         FROM 1 BY 1                                              08270000
082800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08280000
082900            OR  (SQLCODE = +100)                                  08290000
083000            OR  (SQLCODE = +0))                                   08300000
083100                                                                  08310000
083200         EXEC SQL                                                 08320000
083300             SELECT FUNC_QTY                                      08330000
083400             INTO :PV-FAR-PARM                                    08340000
083500              FROM  TKRPRPM P                                     08350000
083600             WHERE                                                08360000
083700                   P.LOC_ID            = 90                       08370000
083800               AND P.INTFC_SYS_CDE     = 'KHL'                    08380000
083900               AND P.SYS_PRC_FUNC_CDE  = 'CLEAN2'                 08390000
084000               AND P.FUNC_PRC_STAT_CDE = 'AC'                     08400000
084100         WITH UR                                                  08410000
084200         END-EXEC                                                 08420000
084300                                                                  08430000
084400         EVALUATE TRUE                                            08440000
084500             WHEN SQLCODE = ZERO                                  08450000
084600             WHEN SQLCODE = +100                                  08460000
084601                 DISPLAY ' '                                      08460108
084602                 DISPLAY 'CLEAN FAR DAYS - CALCULATE FROM DATE'   08460208
084610                 MOVE PV-FAR-PARM            TO PV-DISP-PARM      08461007
084620                 DISPLAY '   CLEAN2: '    PV-DISP-PARM            08462008
084630                         ' REGULAR-FAR DAYS'                      08463007
084800             WHEN SQLCODE = -904                                  08480000
084900             WHEN SQLCODE = -911                                  08490000
085000             WHEN SQLCODE = -913                                  08500000
085100                  CONTINUE                                        08510000
085200                                                                  08520000
085300             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              08530000
085400                 DISPLAY '**************************************' 08540000
085500                 DISPLAY 'WARNING ISSUED '                        08550000
085600                 DISPLAY 'SELECT TKRPRPM                        ' 08560000
085700                 DISPLAY '**************************************' 08570000
085800                 PERFORM 9800-SQL-WARNING                         08580000
085900                                                                  08590000
086000             WHEN SQLCODE < ZERO                                  08600000
086100                 DISPLAY '**************************************' 08610000
086200                 DISPLAY 'ERROR ISSUED ON                       ' 08620000
086300                 DISPLAY 'SELECT TKRPRPM                        ' 08630000
086400                 DISPLAY '**************************************' 08640000
086500                 PERFORM 9900-SQL-ERROR                           08650000
086600                                                                  08660000
086700         END-EVALUATE                                             08670000
086800     END-PERFORM.                                                 08680000
086900                                                                  08690000
087000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    08700000
087100         SQLCODE NOT = ZERO                                       08710000
087200         DISPLAY '**************************************'         08720000
087300         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         08730000
087400         DISPLAY 'SELECT TKRPRPM         '                        08740000
087500         DISPLAY '**************************************'         08750000
087600         PERFORM 9900-SQL-ERROR                                   08760000
087700     END-IF.                                                      08770000
087701                                                                  08770101
087702                                                                  08770201
087710*-----------------------------------------------------------------08771001
087711* GET FAR PARM (FROM DATE) FOR SEPHORA RECEIVERS PROCESSED AT THE 08771101
087712* STORES SUPPORTING DC                                            08771201
087713* DMH - 5/6/2021                                                  08771301
087730*-----------------------------------------------------------------08773001
087740 7413-GET-FAR-PARM-SEPH-SUPP.                                     08774001
087750                                                                  08775001
087760     MOVE '7413-GET-FAR-PARM-SEPH-SUPP' TO PV-ABEND-PARAGRAPH.    08776001
087770                                                                  08777001
087780     PERFORM                                                      08778001
087790         WITH TEST AFTER                                          08779001
087791         VARYING PV-RETRY-COUNTER                                 08779101
087792         FROM 1 BY 1                                              08779201
087793         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08779301
087794            OR  (SQLCODE = +100)                                  08779401
087795            OR  (SQLCODE = +0))                                   08779501
087796                                                                  08779601
087797         EXEC SQL                                                 08779701
087798             SELECT FUNC_QTY                                      08779801
087799             INTO :PV-FAR-PARM-SEPH-SUPP                          08779901
087800              FROM  TKRPRPM P                                     08780001
087801             WHERE                                                08780101
087802                   P.LOC_ID            = 90                       08780201
087803               AND P.INTFC_SYS_CDE     = 'KHL'                    08780301
087804               AND P.SYS_PRC_FUNC_CDE  = 'CLEANB'                 08780401
087805               AND P.FUNC_PRC_STAT_CDE = 'AC'                     08780501
087806         WITH UR                                                  08780601
087807         END-EXEC                                                 08780701
087808                                                                  08780801
087809         EVALUATE TRUE                                            08780901
087810             WHEN SQLCODE = ZERO                                  08781001
087811             WHEN SQLCODE = +100                                  08781101
087812                 MOVE PV-FAR-PARM-SEPH-SUPP  TO PV-DISP-PARM      08781207
087813                 DISPLAY '   CLEANB: '    PV-DISP-PARM            08781308
087814                         ' SEPHORA-SUPPORT DC - FAR DAYS'         08781407
087816             WHEN SQLCODE = -904                                  08781601
087817             WHEN SQLCODE = -911                                  08781701
087818             WHEN SQLCODE = -913                                  08781801
087819                  CONTINUE                                        08781901
087820                                                                  08782001
087821             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              08782101
087822                 DISPLAY '**************************************' 08782201
087823                 DISPLAY 'WARNING ISSUED '                        08782301
087824                 DISPLAY 'SELECT TKRPRPM - CLEANB               ' 08782401
087825                 DISPLAY '**************************************' 08782501
087826                 PERFORM 9800-SQL-WARNING                         08782601
087827                                                                  08782701
087828             WHEN SQLCODE < ZERO                                  08782801
087829                 DISPLAY '**************************************' 08782901
087830                 DISPLAY 'ERROR ISSUED ON                       ' 08783001
087831                 DISPLAY 'SELECT TKRPRPM - CLEANB              '  08783101
087832                 DISPLAY '**************************************' 08783201
087833                 PERFORM 9900-SQL-ERROR                           08783301
087834                                                                  08783401
087835         END-EVALUATE                                             08783501
087836     END-PERFORM.                                                 08783601
087837                                                                  08783701
087838     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    08783801
087839         SQLCODE NOT = ZERO                                       08783901
087840         DISPLAY '**************************************'         08784001
087841         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         08784101
087842         DISPLAY 'SELECT TKRPRPM - CLEANB               '         08784201
087843         DISPLAY '**************************************'         08784301
087844         PERFORM 9900-SQL-ERROR                                   08784401
087845     END-IF.                                                      08784501
087850                                                                  08785001
087851*-----------------------------------------------------------------08785101
087852* GET FAR PARM (FROM DATE) FOR SEPHORA RECEIVERS PROCESSED AT A   08785201
087853* DIFFERENT DC THEN THE STORES SUPPORTING DC                      08785301
087854* DMH - 5/6/2021                                                  08785401
087855*-----------------------------------------------------------------08785501
087856 7415-GET-FAR-PARM-SEPH-DIFF.                                     08785601
087857                                                                  08785701
087858     MOVE '7413-GET-FAR-PARM-SEPH-DIFF' TO PV-ABEND-PARAGRAPH.    08785801
087859                                                                  08785901
087860     PERFORM                                                      08786001
087861         WITH TEST AFTER                                          08786101
087862         VARYING PV-RETRY-COUNTER                                 08786201
087863         FROM 1 BY 1                                              08786301
087864         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08786401
087865            OR  (SQLCODE = +100)                                  08786501
087866            OR  (SQLCODE = +0))                                   08786601
087867                                                                  08786701
087868         EXEC SQL                                                 08786801
087869             SELECT FUNC_QTY                                      08786901
087870             INTO :PV-FAR-PARM-SEPH-DIFF                          08787001
087871              FROM  TKRPRPM P                                     08787101
087872             WHERE                                                08787201
087873                   P.LOC_ID            = 90                       08787301
087874               AND P.INTFC_SYS_CDE     = 'KHL'                    08787401
087875               AND P.SYS_PRC_FUNC_CDE  = 'CLEANF'                 08787501
087876               AND P.FUNC_PRC_STAT_CDE = 'AC'                     08787601
087877         WITH UR                                                  08787701
087878         END-EXEC                                                 08787801
087879                                                                  08787901
087880         EVALUATE TRUE                                            08788001
087881             WHEN SQLCODE = ZERO                                  08788101
087882             WHEN SQLCODE = +100                                  08788201
087883                 MOVE PV-FAR-PARM-SEPH-DIFF  TO PV-DISP-PARM      08788307
087884                 DISPLAY '   CLEANF: '    PV-DISP-PARM            08788408
087885                         ' SEPHORA-DIFFERENT DC - FAR DAYS'       08788507
087887             WHEN SQLCODE = -904                                  08788701
087888             WHEN SQLCODE = -911                                  08788801
087889             WHEN SQLCODE = -913                                  08788901
087890                  CONTINUE                                        08789001
087891                                                                  08789101
087892             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              08789201
087893                 DISPLAY '**************************************' 08789301
087894                 DISPLAY 'WARNING ISSUED '                        08789401
087895                 DISPLAY 'SELECT TKRPRPM - CLEANF               ' 08789501
087896                 DISPLAY '**************************************' 08789601
087897                 PERFORM 9800-SQL-WARNING                         08789701
087898                                                                  08789801
087899             WHEN SQLCODE < ZERO                                  08789901
087900                 DISPLAY '**************************************' 08790001
087901                 DISPLAY 'ERROR ISSUED ON                       ' 08790101
087902                 DISPLAY 'SELECT TKRPRPM - CLEANF              '  08790201
087903                 DISPLAY '**************************************' 08790301
087904                 PERFORM 9900-SQL-ERROR                           08790401
087905                                                                  08790501
087906         END-EVALUATE                                             08790601
087907     END-PERFORM.                                                 08790701
087908                                                                  08790801
087909     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    08790901
087910         SQLCODE NOT = ZERO                                       08791001
087911         DISPLAY '**************************************'         08791101
087912         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         08791201
087913         DISPLAY 'SELECT TKRPRPM - CLEANF               '         08791301
087914         DISPLAY '**************************************'         08791401
087915         PERFORM 9900-SQL-ERROR                                   08791501
087916     END-IF.                                                      08791601
087917                                                                  08791701
087918*-----------------------------------------------------------------08791801
087919*                                                                 08791901
087920*-----------------------------------------------------------------08792001
087930 7420-GET-PERCENT-PARM.                                           08793000
088000                                                                  08800000
088100     MOVE '7420-GET-PERCENT-PARM'     TO PV-ABEND-PARAGRAPH.      08810000
088200                                                                  08820000
088300     PERFORM                                                      08830000
088400         WITH TEST AFTER                                          08840000
088500         VARYING PV-RETRY-COUNTER                                 08850000
088600         FROM 1 BY 1                                              08860000
088700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08870000
088800            OR  (SQLCODE = +100)                                  08880000
088900            OR  (SQLCODE = +0))                                   08890000
089000                                                                  08900000
089100         EXEC SQL                                                 08910000
089200             SELECT FUNC_QTY                                      08920000
089300             INTO :PV-PERCENT-PARM                                08930000
089400              FROM  TKRPRPM                                       08940000
089500             WHERE                                                08950000
089600                   LOC_ID            = 90                         08960000
089700               AND INTFC_SYS_CDE     = 'KHL'                      08970000
089800               AND SYS_PRC_FUNC_CDE  = 'CLEAN3'                   08980000
089900               AND FUNC_PRC_STAT_CDE = 'AC'                       08990000
090000         WITH UR                                                  09000000
090100         END-EXEC                                                 09010000
090200                                                                  09020000
090300         EVALUATE TRUE                                            09030000
090400             WHEN SQLCODE = ZERO                                  09040000
090401                 DISPLAY ' '                                      09040108
090402                 DISPLAY 'CLEAN PERCENT - %'                      09040208
090410                 MOVE PV-PERCENT-PARM TO  PV-DISP-PARM            09041007
090420                 DISPLAY '   CLEAN3: '      PV-DISP-PARM          09042008
090430                         ' REGULAR %'                             09043007
090600             WHEN SQLCODE = -904                                  09060000
090700             WHEN SQLCODE = -911                                  09070000
090800             WHEN SQLCODE = -913                                  09080000
090900                  CONTINUE                                        09090000
091000                                                                  09100000
091100             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              09110000
091200                 DISPLAY '**************************************' 09120000
091300                 DISPLAY 'WARNING ISSUED '                        09130000
091400                 DISPLAY 'SELECT TKRPRPM                        ' 09140000
091500                 DISPLAY '**************************************' 09150000
091600                 PERFORM 9800-SQL-WARNING                         09160000
091700                                                                  09170000
091800             WHEN SQLCODE < ZERO                                  09180000
091900                 DISPLAY '**************************************' 09190000
092000                 DISPLAY 'ERROR ISSUED ON                       ' 09200000
092100                 DISPLAY 'SELECT TKRPRPM                        ' 09210000
092200                 DISPLAY '**************************************' 09220000
092300                 PERFORM 9900-SQL-ERROR                           09230000
092400                                                                  09240000
092500         END-EVALUATE                                             09250000
092600     END-PERFORM.                                                 09260000
092700                                                                  09270000
092800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    09280000
092900         SQLCODE NOT = ZERO                                       09290000
093000         DISPLAY '**************************************'         09300000
093100         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         09310000
093200         DISPLAY 'SELECT TKRPRPM         '                        09320000
093300         DISPLAY '**************************************'         09330000
093400         PERFORM 9900-SQL-ERROR                                   09340000
093500     END-IF.                                                      09350000
093600                                                                  09360001
093601                                                                  09360101
093610*-----------------------------------------------------------------09361001
093620* SELECT THE PERCENT PARM FOR SEPHORA RECEIVER THAT WAS PROCESSED 09362001
093621* AT THE STORES SUPPORTING DC                                     09362101
093630*-----------------------------------------------------------------09363001
093640 7423-GET-PERCNT-PARM-SEPH-SUPP.                                  09364002
093650                                                                  09365001
093660     MOVE '7423-GET-PERCNT-PARM-SEPH-SUPP' TO  PV-ABEND-PARAGRAPH.09366002
093670                                                                  09367001
093680     PERFORM                                                      09368001
093690         WITH TEST AFTER                                          09369001
093691         VARYING PV-RETRY-COUNTER                                 09369101
093692         FROM 1 BY 1                                              09369201
093693         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09369301
093694            OR  (SQLCODE = +100)                                  09369401
093695            OR  (SQLCODE = +0))                                   09369501
093696                                                                  09369601
093697         EXEC SQL                                                 09369701
093698             SELECT FUNC_QTY                                      09369801
093699             INTO :PV-PERCENT-PARM-SEPH-SUPP                      09369901
093700              FROM  TKRPRPM                                       09370001
093701             WHERE                                                09370101
093702                   LOC_ID            = 90                         09370201
093703               AND INTFC_SYS_CDE     = 'KHL'                      09370301
093704               AND SYS_PRC_FUNC_CDE  = 'CLEANC'                   09370401
093705               AND FUNC_PRC_STAT_CDE = 'AC'                       09370501
093706         WITH UR                                                  09370601
093707         END-EXEC                                                 09370701
093708                                                                  09370801
093709         EVALUATE TRUE                                            09370901
093710             WHEN SQLCODE = ZERO                                  09371001
093711                 MOVE PV-PERCENT-PARM-SEPH-SUPP TO PV-DISP-PARM   09371107
093712                 DISPLAY '   CLEANC: '      PV-DISP-PARM          09371208
093713                         ' SEPHORA-SUPPORT DC-%'                  09371307
093714             WHEN SQLCODE = -904                                  09371401
093715             WHEN SQLCODE = -911                                  09371501
093716             WHEN SQLCODE = -913                                  09371601
093717                  CONTINUE                                        09371701
093718                                                                  09371801
093719             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              09371901
093720                 DISPLAY '**************************************' 09372001
093721                 DISPLAY 'WARNING ISSUED '                        09372101
093722                 DISPLAY 'SELECT TKRPRPM - CLEANC               ' 09372201
093723                 DISPLAY '**************************************' 09372301
093724                 PERFORM 9800-SQL-WARNING                         09372401
093725                                                                  09372501
093726             WHEN SQLCODE < ZERO                                  09372601
093727                 DISPLAY '**************************************' 09372701
093728                 DISPLAY 'ERROR ISSUED ON                       ' 09372801
093729                 DISPLAY 'SELECT TKRPRPM - CLEANC               ' 09372901
093730                 DISPLAY '**************************************' 09373001
093731                 PERFORM 9900-SQL-ERROR                           09373101
093732                                                                  09373201
093733         END-EVALUATE                                             09373301
093734     END-PERFORM.                                                 09373401
093735                                                                  09373501
093736     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    09373601
093737         SQLCODE NOT = ZERO                                       09373701
093738         DISPLAY '**************************************'         09373801
093739         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         09373901
093740         DISPLAY 'SELECT TKRPRPM - CLEANC               '         09374001
093741         DISPLAY '**************************************'         09374101
093742         PERFORM 9900-SQL-ERROR                                   09374201
093743     END-IF.                                                      09374301
093744                                                                  09374401
093745                                                                  09374501
093746*-----------------------------------------------------------------09374601
093747* SELECT THE PERCENT PARM FOR SEPHORA RECEIVER THAT WAS PROCESSED 09374701
093748* AT A DIFFERENT DC THEN THE STORES SUPPORTING DC                 09374801
093749*-----------------------------------------------------------------09374901
093750 7425-GET-PERCNT-PARM-SEPH-DIFF.                                  09375002
093751                                                                  09375101
093752     MOVE '7425-GET-PERCNT-PARM-SEPH-DIFF' TO  PV-ABEND-PARAGRAPH.09375202
093753                                                                  09375301
093754     PERFORM                                                      09375401
093755         WITH TEST AFTER                                          09375501
093756         VARYING PV-RETRY-COUNTER                                 09375601
093757         FROM 1 BY 1                                              09375701
093758         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09375801
093759            OR  (SQLCODE = +100)                                  09375901
093760            OR  (SQLCODE = +0))                                   09376001
093761                                                                  09376101
093762         EXEC SQL                                                 09376201
093763             SELECT FUNC_QTY                                      09376301
093764             INTO :PV-PERCENT-PARM-SEPH-DIFF                      09376401
093765              FROM  TKRPRPM                                       09376501
093766             WHERE                                                09376601
093767                   LOC_ID            = 90                         09376701
093768               AND INTFC_SYS_CDE     = 'KHL'                      09376801
093769               AND SYS_PRC_FUNC_CDE  = 'CLEANG'                   09376901
093770               AND FUNC_PRC_STAT_CDE = 'AC'                       09377001
093771         WITH UR                                                  09377101
093772         END-EXEC                                                 09377201
093773                                                                  09377301
093774         EVALUATE TRUE                                            09377401
093775             WHEN SQLCODE = ZERO                                  09377501
093776                 MOVE PV-PERCENT-PARM-SEPH-DIFF TO PV-DISP-PARM   09377607
093777                 DISPLAY '   CLEANG: '      PV-DISP-PARM          09377708
093778                         ' SEPHORA-DIFFERENT DC-%'                09377807
093780             WHEN SQLCODE = -904                                  09378001
093781             WHEN SQLCODE = -911                                  09378101
093782             WHEN SQLCODE = -913                                  09378201
093783                  CONTINUE                                        09378301
093784                                                                  09378401
093785             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              09378501
093786                 DISPLAY '**************************************' 09378601
093787                 DISPLAY 'WARNING ISSUED '                        09378701
093788                 DISPLAY 'SELECT TKRPRPM - CLEANG               ' 09378801
093789                 DISPLAY '**************************************' 09378901
093790                 PERFORM 9800-SQL-WARNING                         09379001
093791                                                                  09379101
093792             WHEN SQLCODE < ZERO                                  09379201
093793                 DISPLAY '**************************************' 09379301
093794                 DISPLAY 'ERROR ISSUED ON                       ' 09379401
093795                 DISPLAY 'SELECT TKRPRPM - CLEANG               ' 09379501
093796                 DISPLAY '**************************************' 09379601
093797                 PERFORM 9900-SQL-ERROR                           09379701
093798                                                                  09379801
093799         END-EVALUATE                                             09379901
093800     END-PERFORM.                                                 09380001
093801                                                                  09380101
093802     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    09380201
093803         SQLCODE NOT = ZERO                                       09380301
093804         DISPLAY '**************************************'         09380401
093805         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         09380501
093806         DISPLAY 'SELECT TKRPRPM - CLEANG               '         09380601
093807         DISPLAY '**************************************'         09380701
093808         PERFORM 9900-SQL-ERROR                                   09380801
093809     END-IF.                                                      09380901
093810                                                                  09381001
093811                                                                  09381101
093812*-----------------------------------------------------------------09381201
093813*                                                                 09381301
093814*-----------------------------------------------------------------09381401
093815 7430-GET-INVENTORY-PARM.                                         09381500
093820                                                                  09382000
093900     MOVE '7430-GET-INVENTORY-PARM'   TO PV-ABEND-PARAGRAPH.      09390000
094000                                                                  09400000
094100     PERFORM                                                      09410000
094200         WITH TEST AFTER                                          09420000
094300         VARYING PV-RETRY-COUNTER                                 09430000
094400         FROM 1 BY 1                                              09440000
094500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09450000
094600            OR  (SQLCODE = +100)                                  09460000
094700            OR  (SQLCODE = +0))                                   09470000
094800                                                                  09480000
094900         EXEC SQL                                                 09490000
095000             SELECT FUNC_QTY                                      09500000
095100             INTO :PV-INVENTORY-PARM                              09510000
095200              FROM  TKRPRPM                                       09520000
095300             WHERE                                                09530000
095400                   LOC_ID            = 90                         09540000
095500               AND INTFC_SYS_CDE     = 'KHL'                      09550000
095600               AND SYS_PRC_FUNC_CDE  = 'CLEAN4'                   09560000
095700               AND FUNC_PRC_STAT_CDE = 'AC'                       09570000
095800         WITH UR                                                  09580000
095900         END-EXEC                                                 09590000
096000                                                                  09600000
096100         EVALUATE TRUE                                            09610000
096200             WHEN SQLCODE = ZERO                                  09620000
096201                 DISPLAY ' '                                      09620108
096202                 DISPLAY 'INVENTORY - SE INTRANSIT REVERSAL DAYS' 09620208
096210                 MOVE PV-INVENTORY-PARM         TO PV-DISP-PARM   09621007
096220                 DISPLAY '   CLEAN4: '       PV-DISP-PARM         09622008
096230                         ' INVENTORY PARM DAYS'                   09623007
096400             WHEN SQLCODE = -904                                  09640000
096500             WHEN SQLCODE = -911                                  09650000
096600             WHEN SQLCODE = -913                                  09660000
096700                  CONTINUE                                        09670000
096800                                                                  09680000
096900             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              09690000
097000                 DISPLAY '**************************************' 09700000
097100                 DISPLAY 'WARNING ISSUED '                        09710000
097200                 DISPLAY 'SELECT TKRPRPM                        ' 09720000
097300                 DISPLAY '**************************************' 09730000
097400                 PERFORM 9800-SQL-WARNING                         09740000
097500                                                                  09750000
097600             WHEN SQLCODE < ZERO                                  09760000
097700                 DISPLAY '**************************************' 09770000
097800                 DISPLAY 'ERROR ISSUED ON                       ' 09780000
097900                 DISPLAY 'SELECT TKRPRPM                        ' 09790000
098000                 DISPLAY '**************************************' 09800000
098100                 PERFORM 9900-SQL-ERROR                           09810000
098200                                                                  09820000
098300         END-EVALUATE                                             09830000
098400     END-PERFORM.                                                 09840000
098500                                                                  09850000
098600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    09860000
098700         SQLCODE NOT = ZERO                                       09870000
098800         DISPLAY '**************************************'         09880000
098900         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         09890000
099000         DISPLAY 'SELECT TKRPRPM         '                        09900000
099100         DISPLAY '**************************************'         09910000
099200         PERFORM 9900-SQL-ERROR                                   09920000
099300     END-IF.                                                      09930000
099400                                                                  09940001
099410*-----------------------------------------------------------------09941001
099420* SELECT THE INVENTORY PARM FOR SEPHORA RECEIVERS PROCESSED AT THE09942001
099421* STORES SUPPORTING DC                                            09942101
099430*-----------------------------------------------------------------09943001
099440 7433-GET-INVTRY-PARM-SEPH-SUPP.                                  09944002
099450                                                                  09945001
099460     MOVE '7433-GET-INVTRY-PARM-SEPH-SUPP'                        09946002
099461                                          TO PV-ABEND-PARAGRAPH.  09946101
099470                                                                  09947001
099480     PERFORM                                                      09948001
099490         WITH TEST AFTER                                          09949001
099491         VARYING PV-RETRY-COUNTER                                 09949101
099492         FROM 1 BY 1                                              09949201
099493         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09949301
099494            OR  (SQLCODE = +100)                                  09949401
099495            OR  (SQLCODE = +0))                                   09949501
099496                                                                  09949601
099497         EXEC SQL                                                 09949701
099498             SELECT FUNC_QTY                                      09949801
099499             INTO :PV-INVENTORY-PARM-SEPH-SUPP                    09949901
099500              FROM  TKRPRPM                                       09950001
099501             WHERE                                                09950101
099502                   LOC_ID            = 90                         09950201
099503               AND INTFC_SYS_CDE     = 'KHL'                      09950301
099504               AND SYS_PRC_FUNC_CDE  = 'CLEAND'                   09950401
099505               AND FUNC_PRC_STAT_CDE = 'AC'                       09950501
099506         WITH UR                                                  09950601
099507         END-EXEC                                                 09950701
099508                                                                  09950801
099509         EVALUATE TRUE                                            09950901
099510             WHEN SQLCODE = ZERO                                  09951001
099511                 MOVE PV-INVENTORY-PARM-SEPH-SUPP TO PV-DISP-PARM 09951107
099512                 DISPLAY '   CLEAND: '       PV-DISP-PARM         09951208
099513                         ' INVENTORY-SEPHORA-SUPPORT DC - DAYS'   09951307
099515             WHEN SQLCODE = -904                                  09951501
099516             WHEN SQLCODE = -911                                  09951601
099517             WHEN SQLCODE = -913                                  09951701
099518                  CONTINUE                                        09951801
099519                                                                  09951901
099520             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              09952001
099521                 DISPLAY '**************************************' 09952101
099522                 DISPLAY 'WARNING ISSUED '                        09952201
099523                 DISPLAY 'SELECT TKRPRPM - CLEAND               ' 09952301
099524                 DISPLAY '**************************************' 09952401
099525                 PERFORM 9800-SQL-WARNING                         09952501
099526                                                                  09952601
099527             WHEN SQLCODE < ZERO                                  09952701
099528                 DISPLAY '**************************************' 09952801
099529                 DISPLAY 'ERROR ISSUED ON                       ' 09952901
099530                 DISPLAY 'SELECT TKRPRPM - CLEAND               ' 09953001
099531                 DISPLAY '**************************************' 09953101
099532                 PERFORM 9900-SQL-ERROR                           09953201
099533                                                                  09953301
099534         END-EVALUATE                                             09953401
099535     END-PERFORM.                                                 09953501
099536                                                                  09953601
099537     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    09953701
099538         SQLCODE NOT = ZERO                                       09953801
099539         DISPLAY '**************************************'         09953901
099540         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         09954001
099541         DISPLAY 'SELECT TKRPRPM - CLEAND               '         09954101
099542         DISPLAY '**************************************'         09954201
099543         PERFORM 9900-SQL-ERROR                                   09954301
099544     END-IF.                                                      09954401
099545                                                                  09954501
099546                                                                  09954601
099547*-----------------------------------------------------------------09954701
099548* SELECT THE INVENTORY PARM FOR SEPHORA RECEIVERS PROCESSED AT A  09954801
099549* DIFFERENT DC THEN THE STORES SUPPORTING DC                      09954901
099550*-----------------------------------------------------------------09955001
099551 7435-GET-INVTRY-PARM-SEPH-DIFF.                                  09955102
099552                                                                  09955201
099553     MOVE '7435-GET-INVTRY-PARM-SEPH-DIFF'                        09955302
099554                                          TO PV-ABEND-PARAGRAPH.  09955401
099555                                                                  09955501
099556     PERFORM                                                      09955601
099557         WITH TEST AFTER                                          09955701
099558         VARYING PV-RETRY-COUNTER                                 09955801
099559         FROM 1 BY 1                                              09955901
099560         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09956001
099561            OR  (SQLCODE = +100)                                  09956101
099562            OR  (SQLCODE = +0))                                   09956201
099563                                                                  09956301
099564         EXEC SQL                                                 09956401
099565             SELECT FUNC_QTY                                      09956501
099566             INTO :PV-INVENTORY-PARM-SEPH-DIFF                    09956601
099567              FROM  TKRPRPM                                       09956701
099568             WHERE                                                09956801
099569                   LOC_ID            = 90                         09956901
099570               AND INTFC_SYS_CDE     = 'KHL'                      09957001
099571               AND SYS_PRC_FUNC_CDE  = 'CLEANH'                   09957101
099572               AND FUNC_PRC_STAT_CDE = 'AC'                       09957201
099573         WITH UR                                                  09957301
099574         END-EXEC                                                 09957401
099575                                                                  09957501
099576         EVALUATE TRUE                                            09957601
099577             WHEN SQLCODE = ZERO                                  09957701
099578                 MOVE PV-INVENTORY-PARM-SEPH-DIFF TO PV-DISP-PARM 09957807
099579                 DISPLAY '   CLEANH: '       PV-DISP-PARM         09957909
099580                         ' INVENTORY-SEPHORA-DIFFERENT DC - DAYS' 09958007
099581                 DISPLAY ' '                                      09958109
099582             WHEN SQLCODE = -904                                  09958201
099583             WHEN SQLCODE = -911                                  09958301
099584             WHEN SQLCODE = -913                                  09958401
099585                  CONTINUE                                        09958501
099586                                                                  09958601
099587             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              09958701
099588                 DISPLAY '**************************************' 09958801
099589                 DISPLAY 'WARNING ISSUED '                        09958901
099590                 DISPLAY 'SELECT TKRPRPM - CLEANH               ' 09959001
099591                 DISPLAY '**************************************' 09959101
099592                 PERFORM 9800-SQL-WARNING                         09959201
099593                                                                  09959301
099594             WHEN SQLCODE < ZERO                                  09959401
099595                 DISPLAY '**************************************' 09959501
099596                 DISPLAY 'ERROR ISSUED ON                       ' 09959601
099597                 DISPLAY 'SELECT TKRPRPM - CLEANH               ' 09959701
099598                 DISPLAY '**************************************' 09959801
099599                 PERFORM 9900-SQL-ERROR                           09959901
099600                                                                  09960001
099601         END-EVALUATE                                             09960101
099602     END-PERFORM.                                                 09960201
099603                                                                  09960301
099604     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    09960401
099605         SQLCODE NOT = ZERO                                       09960501
099606         DISPLAY '**************************************'         09960601
099607         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         09960701
099608         DISPLAY 'SELECT TKRPRPM - CLEANH               '         09960801
099609         DISPLAY '**************************************'         09960901
099610         PERFORM 9900-SQL-ERROR                                   09961001
099611     END-IF.                                                      09961101
099612                                                                  09961201
099613******************************************************************09961301
099620 7999-COMMIT.                                                     09962000
099700                                                                  09970000
099800     MOVE '7999-COMMIT'               TO PV-ABEND-PARAGRAPH.      09980000
099900                                                                  09990000
100000                                                                  10000000
100100     EXEC SQL                                                     10010000
100200         COMMIT                                                   10020000
100300     END-EXEC                                                     10030000
100400                                                                  10040000
100500     EVALUATE TRUE                                                10050000
100600         WHEN SQLCODE = ZERO                                      10060000
100700             MOVE ZERO                    TO PV-COMMIT-COUNTER    10070000
100800         WHEN SQLCODE = -904                                      10080000
100900         WHEN SQLCODE = -911                                      10090000
101000         WHEN SQLCODE = -913                                      10100000
101100             DISPLAY '**************************************'     10110000
101200             DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '     10120000
101300             DISPLAY 'COMMIT                 '                    10130000
101400             DISPLAY '**************************************'     10140000
101500             PERFORM 9900-SQL-ERROR                               10150000
101600                                                                  10160000
101700         WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')                  10170000
101800             DISPLAY '**************************************'     10180000
101900             DISPLAY 'WARNING ISSUED '                            10190000
102000             DISPLAY 'COMMIT                                '     10200000
102100             DISPLAY '**************************************'     10210000
102200             PERFORM 9800-SQL-WARNING                             10220000
102300                                                                  10230000
102400         WHEN SQLCODE < ZERO                                      10240000
102500             DISPLAY '**************************************'     10250000
102600             DISPLAY 'ERROR ISSUED ON                       '     10260000
102700             DISPLAY 'COMMIT                                '     10270000
102800             DISPLAY '**************************************'     10280000
102900             PERFORM 9900-SQL-ERROR                               10290000
103000                                                                  10300000
103100     END-EVALUATE.                                                10310000
103200/                                                                 10320000
103300 8000-READ-EXTRACT.                                               10330000
103400                                                                  10340000
103500     MOVE '8000-READ-EXTRACT   '  TO PV-ABEND-PARAGRAPH.          10350000
103600*                                                                 10360000
103700     READ STORE-EXPECTED-GT-90                                    10370000
103800         INTO                                                     10380000
103900             PC041-UNBAL-SUMMARY-REC                              10390000
104000         AT END                                                   10400000
104100             SET PS-EOF-EXTRACT-YES   TO TRUE                     10410000
104200         NOT AT END                                               10420000
104300             ADD 1                    TO PV-READ-COUNTER          10430000
104400                                         PV-COMMIT-COUNTER        10440000
104500                                         PV-DISP-CONTROL          10450000
104600*        DISPLAY A PROGRESS MESSAGE EVERY 100K RECORDS            10460000
104700         IF PV-DISP-CONTROL > 99999                               10470000
104800             EXEC SQL                                             10480000
104900                 SELECT CURRENT TIME                              10490000
105000                 INTO :PV-TIME                                    10500000
105100                 FROM SYSIBM.SYSDUMMY1                            10510000
105200             END-EXEC                                             10520000
105300             MOVE PV-READ-COUNTER     TO PV-DISP-NBR              10530000
105400             DISPLAY PV-TIME                                      10540000
105500             ' PROCESSING REC # ' PV-DISP-NBR                     10550000
105600             MOVE ZERO                TO PV-DISP-CONTROL          10560000
105700         END-IF                                                   10570000
105800     END-READ.                                                    10580000
105900                                                                  10590000
106000 8200-WRITE-PC038.                                                10600000
106100     MOVE '8200-WRITE-PC038    '  TO PV-ABEND-PARAGRAPH.          10610000
106200     WRITE                                                        10620000
106300         REPORT-EXTRACT-REC                                       10630000
106400         FROM PC038-SE-UNBALANCED-RPT-REC                         10640000
106500     END-WRITE.                                                   10650000
106600     ADD 1                            TO PV-WRITE-1-COUNTER.      10660000
106700/                                                                 10670000
106800 9000-QUIT.                                                       10680000
106900                                                                  10690000
107000     CLOSE STORE-EXPECTED-GT-90                                   10700000
107100           REPORT-EXTRACT-FILE                                    10710000
107200                                                                  10720000
107300     MOVE PV-READ-COUNTER             TO PV-MSG-READ-COUNT        10730000
107400     DISPLAY PV-COUNT-MSG-4.                                      10740000
107500                                                                  10750000
107600     MOVE PV-WRITE-1-COUNTER          TO PV-MSG-1-COUNT           10760000
107700     DISPLAY PV-COUNT-MSG-1.                                      10770000
107800                                                                  10780000
107900/                                                                 10790000
108000 9100-SQL-ABEND.                                                  10800000
108100******************************************************************10810000
108200*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    10820000
108300*  ERROR OR WARNING CODE OCCURS.                                  10830000
108400******************************************************************10840000
108500     DISPLAY '9100-SQL-ABEND'.                                    10850000
108600     DISPLAY '** ABEND     **'.                                   10860000
108700     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        10870000
108800     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             10880000
108900     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     10890000
109000     DISPLAY '**              ** = '                              10900000
109100     MOVE SQLCODE TO PV-SQL-CODE.                                 10910000
109200     DISPLAY '** SQL CODE  ** = ' PV-SQL-CODE.                    10920000
109300     MOVE +4013 TO PV-ABEND-CODE.                                 10930000
109400     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         10940000
109500                                                                  10950000
109600******************************************************************10960000
109700*  THIS MODULE PERFORMS THE SQL WARNING.                         *10970000
109800******************************************************************10980000
109900                                                                  10990000
110000 9800-SQL-WARNING.                                                11000000
110100                                                                  11010000
110200     MOVE SQLCODE               TO SQLCODE2.                      11020000
110300     MOVE SQLERRD(3)            TO SQLERRD3.                      11030000
110400     DISPLAY '** ABEND **       ** = SQLWARNING'.                 11040000
110500     DISPLAY '** PROGRAM        ** = PCKUT038'.                   11050000
110600     DISPLAY '** PARAGRAPH      ** = ' PV-ABEND-PARAGRAPH.        11060000
110700     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  11070000
110800     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  11080000
110900                                                                  11090000
111000     COPY DPPD004.                                                11100000
111100     SET ABEND-4013-DB2-ERROR   TO TRUE                           11110000
111200     CALL 'ILBOABN0' USING ABEND-CODE.                            11120000
111300/                                                                 11130000
111400******************************************************************11140000
111500* THIS MODULE PERFORMS THE SQL ERROR.                            *11150000
111600******************************************************************11160000
111700                                                                  11170000
111800 9900-SQL-ERROR.                                                  11180000
111900                                                                  11190000
112000     MOVE SQLCODE               TO SQLCODE2.                      11200000
112100     MOVE SQLERRD(3)            TO SQLERRD3.                      11210000
112200     DISPLAY '** ABEND **       ** = SQLERROR'.                   11220000
112300     DISPLAY '** PROGRAM        ** = PCKUT038'.                   11230000
112400     DISPLAY '** PARAGRAPH      ** = ' PV-ABEND-PARAGRAPH.        11240000
112500     DISPLAY '** OPERATION      ** = ' PV-ABEND-OPERATION         11250000
112600     DISPLAY '** TABLE          ** = ' PV-ABEND-STRUCTURE-1       11260000
112700     DISPLAY SPACES                                               11270000
112800                                                                  11280000
112900     COPY DPPD004.                                                11290000
113000     SET ABEND-4013-DB2-ERROR   TO TRUE                           11300000
113100     CALL 'ILBOABN0' USING ABEND-CODE.                            11310000
