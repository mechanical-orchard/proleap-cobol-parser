000100*****************************************************************         
000200 IDENTIFICATION DIVISION.                                                 
000300*****************************************************************         
000400                                                                          
000500 PROGRAM-ID.             MRKUT014.                                        
000600 AUTHOR.                 LYNN CHRISTIANSEN.                               
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                         
000800 DATE-WRITTEN            11-XX-92.                                        
000900 DATE-COMPILED.                                                           
001000                                                                          
001100*****************************************************************         
001200*          CREATE TRANSFER RECORD INPUT                         *         
001300*                                                               *         
001400*  VERSION OF MRKUT003                                          *         
001500*                                                               *         
001600*  THIS PROGRAM WILL JOIN THE TSK, TMRITEM, TMRITST, AND        *         
001700*  TMRISFE TABLE AND CREATE AN EXTRACT FILE WHICH WILL BE       *         
001800*  SORTED EXTERNALLY.                                           *         
001900*                                                               *         
002000*****************************************************************         
002100*  CHANGE MADE:                                                 *         
002200*                                                               *         
002300*****************************************************************         
002400* CHANGED XX/XX/XX BY XXXXXXXXXXXXXXXXXXXXXXXXXX                          
002500*   WR# XXXXXXXXXXXX                                                      
002600*            XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX          
002700*            XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX          
002800*            XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX          
002900*            XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX          
003000* CHANGED 09/19/95 BY HOWARD MENDELSON                                    
003100*   WR# 2784                                                              
003200*            MODIFIED MRRD017 TO REDUCE OUTPUT FILE LENGTH TO             
003300*            1200 BYTES.  ADDED CODE TO LOAD DATA FROM THE                
003400*            ITEM HISTORY TABLE.                                          
003500* CHANGED 12/07/93 BY DAVID PHELPS                                        
003600*   WR# XXXXXXXXXXXX                                                      
003700*            FOR THE REFERENCE NUMBER REFORMAT THE INAME LAYOUT           
003800*            IS CHANGED TO INCLUDE THE GROUP-CODE AND THE                 
003900*            STORE-ID-CODE.                                               
004000*                                                                         
004100* CHANGED 05/21/96 BY CHRISTINE FOLEY                                     
004200*   WR# XXXXXXXXXXXX                                                      
004300*            PARAGRAPH: F000-FORMAT-TRAN-INPUT                            
004400*            THE PERCENT VALUES WERE CHANGED IN WORKING                   
004500*            STORAGE TO REFLECT CHANGES IN THE UPGRADE TO 1.1.6.          
004600*                                                                         
004700* CHANGED 06/14/96 BY HOWARD MENDELSON  --  G&R                           
004800*   WR# 3303                                                              
004900*            ADDED LOGIC TO SELECT BIWEEKLY REVIEW TIME ORDERS            
005000*            RT = 14 , RT-DAY 1 THRU 14.                                  
005100*                                                                         
005200* CHANGED 01/08/97 BY CHRISTINE FOLEY                                     
005300*   WR# 5017                                                              
005400*            PARAGRAPH: F000-FORMAT-TRAN-INPUT                            
005500*            ADDED LOGIC TO EVALUATE UCYCLE BEFORE DETERMINING            
005600*            VOLUME SENSITIVE VARIABLES.  IF UCYCLE 5 THE DD              
005700*            NEEDS TO BE DIVIDED BY 4(WEEKS) BEFORE EVALUATING.           
005800*                                                                         
005900* CHANGED 11/09/98 BY LINDA FRIESS                                        
006000*   WR# 3801                                                              
006100*            PARAGRAPH: F000-FORMAT-TRAN-INPUT                            
006200*            CHANGED TO GET VALUES FROM THE DD MATRIX RECORD OF           
006300*            THE CONTROL FILE, INSTEAD OF USING CONSTANTS.  ADDED         
006400*            CADL, DAMP, MINSMK, MAXSMK & LOMADP FIELDS TO OUTPUT         
006500*            RECORD.                                                      
006600* CHANGED 05/13/99 BY ANNE KINTOPF                                        
006700*   PIT# 309322                                                           
006800*            CHANGE PROGRAM TO MOVE TMRISHS ROWS TO CORRECT FIELDS        
006900*            BY USING DATA LOGIC.                                         
007000*                                                                         
007100* CHANGED 01/03/2001 BY LINDA FRIESS                                      
007200*   WR# 9998                                                              
007300*            MODIFIED MR_ITEM_CSR TO ELIMINATE UNIONS, FOR                
007400*            EFFICIENCY.  ADDED SEARCH OF INTERNAL TABLE TO               
007500*            PARAGRAPH F000-FORMAT-TRAN-INPUT TO GET WEEK NUMBER          
007600*            CORRESPONDING TO SEQUENCE NUMBER.                            
007700*                                                                         
007800* CHANGED 03/19/2001 BY LINDA FRIESS                                      
007900*   WR# 21599                                                             
008000*            MODIFIED MR_ITEM_CSR TO EXCLUDE E-COMMERCE STORES            
008100*            (ADDED TSTR000 TABLE).                                       
008200*                                                                         
008220* CHANGED 09/04/2002 BY IBM GLOBAL SERVICES INDIA                         
008230*   WR# 21601 (NI-SKU PROJECT)                                            
008240*            DEPARTMENT, CLASS AND 8-DIGIT SKU ARE FETCHED FROM           
008250*            TSKXREF AND IS WRITTEN INTO OUTPUT OF PROGRAM.               
007700*                                                                         
007800* CHANGED 11/21/2002 BY LINDA FRIESS                                      
007900*   WR# 24054                                                             
008000*            MODIFIED MR_ITEM_CSR TO INCLUDE ONLY ROWS WITH               
008100*            RT_NBR > 0, FOR PERFORMANCE ENHANCEMENT.                     
008260*                                                                         
007800* CHANGED 06/01/2004 BY BOB FORD                                          
007900*   WR# 26363                                                             
008000*            MODIFIED FOR STORE EXPANSION TO HANDLE 5-DIGIT STORE         
008100*            NUMBERS.  DB CHANGES NOT COMPLETE FOR TMRITST TABLE,         
008200*            SO NOT ABLE TO REMOVE TSTR000/ADD XMT_LOC ON CURSOR          
008260*            MR_ITEM_CSR YET.                                             
007800* CHANGED 06/14/2004 BY BOB FORD                                          
007900*   WR# 26363                                                             
008000*            REPLACED TSTR000 WITH XMT_LOC                                
007860*                                                                         
007870* CHANGED 02/17/2006 BY LINDA FRIESS                                      
007880*  PITS# 849440 CHANGED PARA. I100 TO ONLY DECREMENT DATE 1 WEEK          
007890*            INSTEAD OF 2, TO INCLUDE MOST RECENT TMRISHS WEEK            
008260*                                                                         
3372A * CHANGED 06/18/2012 BY KUSHAL BOTHRA                                     
3372A *  WR#   3372A  CHANGED PARA. F000 TO GET-INNR-OUTR FROM THE NEW          
3372A *            DB2 INNER/OUTER TABLE USING THE SKU                          
3372A *                                                                         
   300*****************************************************************         
008400 ENVIRONMENT DIVISION.                                                    
008500*****************************************************************         
008600                                                                          
008700 CONFIGURATION SECTION.                                                   
008800                                                                          
008900 SOURCE-COMPUTER.        IBM-3090.                                        
009000 OBJECT-COMPUTER.        IBM-3090.                                        
009100                                                                          
009200 INPUT-OUTPUT SECTION.                                                    
009300                                                                          
009400 FILE-CONTROL.                                                            
009500*                                                                         
009600     SELECT IC-CONTROL-FILE       ASSIGN       TO INP01                   
009700                                  ORGANIZATION IS INDEXED                 
009800                                  ACCESS       IS RANDOM                  
009900                                  RECORD KEY   IS ICCTL-KEY               
010000                                  FILE STATUS  IS PV-VSAM-STATUS.         
010100     SELECT IC-PARM-FILE          ASSIGN       TO INP02.                  
010200     SELECT TRANSFER-RECORD       ASSIGN TO OUT01.                        
010300*                                                                         
010400*****************************************************************         
010500 DATA DIVISION.                                                           
010600*****************************************************************         
010700*                                                                         
010800 FILE SECTION.                                                            
010900*                                                                         
011000 FD  IC-CONTROL-FILE.                                                     
011100 01  IC-CONTROL-REC.                                                      
011200     05  ICCTL-KEY                   PIC  X(21).                          
011300     05  FILLER                      PIC  X(379).                         
011400*                                                                         
011500 FD  IC-PARM-FILE                                                         
011600     RECORDING MODE IS F.                                                 
011700 01  IC-PARM-REC.                                                         
011800     05  FILLER                      PIC  X(80).                          
011900*                                                                         
012000 FD  TRANSFER-RECORD                                                      
012100     RECORDING MODE IS F                                                  
012200     LABEL RECORDS ARE STANDARD                                           
012300     RECORD CONTAINS 1143 CHARACTERS                                      
012400     BLOCK CONTAINS 0  RECORDS.                                           
012500 01  TRANSFER-REC                    PIC  X(1143).                        
012600*                                                                         
012700 WORKING-STORAGE SECTION.                                                 
012800*                                                                         
012900 01  FILLER.                                                              
013000     05  FILLER                      PIC  X(36)    VALUE                  
013100         ' ***** WORKING STORAGE PGM=MRKUT014 '.                          
013200     05  FILLER                      PIC  X(10)    VALUE                  
013300         ' LOCATION='.                                                    
013400     05  PGM-LOCATION                PIC  X(04)    VALUE SPACE.           
013500     05  FILLER                      PIC  X(06)    VALUE                  
013600         ' *****'.                                                        
013700 EJECT                                                                    
013800 01  PROGRAM-SWITCHES.                                                    
013900     05  PS-EOC-ITEM-CSR             PIC  X(01)    VALUE 'N'.             
014000         88  EOC-ITEM-CSR                          VALUE 'Y'.             
014100     05  PS-ROW-FOUND-SWITCH         PIC  X(01)    VALUE 'Y'.             
014200         88  PS-ROW-FOUND                          VALUE 'Y'.             
014300         88  PS-ROW-NOT-FOUND                      VALUE 'N'.             
014400*                                                                         
014500/                                                                         
014600 01  PC-CONSTANTS.                                                        
014700     05  PC-PLUS-1                   PIC S9(04)    VALUE +1               
014800                                                   COMP SYNC.             
014900     05  PC-ROW-NOT-FOUND            PIC S9(04)    VALUE +100             
015000                                                   COMP SYNC.             
015100     05  PC-1                        PIC S9(03)    VALUE +1               
015200                                                   COMP-3.                
015300     05  PC-2                        PIC S9(01)V   VALUE +2               
015400                                                   COMP-3.                
015500     05  PC-3                        PIC S9(03)    VALUE +3               
015600                                                   COMP-3.                
015700     05  PC-4                        PIC S9(03)    VALUE +4               
015800                                                   COMP-3.                
015900     05  PC-5                        PIC S9(01)V   VALUE +5               
016000                                                   COMP-3.                
016100     05  PC-5A                       PIC  X(01)    VALUE '5'.             
016200     05  PC-7                        PIC S9(03)    VALUE +7               
016300                                                   COMP-3.                
016400     05  PC-10                       PIC S9(03)    VALUE +10              
016500                                                   COMP-3.                
016600     05  PC-11                       PIC S9(03)    VALUE +11              
016700                                                   COMP-3.                
016800     05  PC-13                       PIC S9(03)    VALUE +13              
016900                                                   COMP-3.                
017000     05  PC-14                       PIC S9(03)    VALUE +14              
017100                                                   COMP-3.                
017200     05  PC-52                       PIC S9(03)    VALUE +52              
017300                                                   COMP-3.                
017400     05  PC-100                      PIC S9(03)    VALUE +100             
017500                                                   COMP-3.                
017400     05  PC-200                      PIC S9(03)    VALUE +200             
017500                                                   COMP-3.                
017400     05  PC-400                      PIC S9(03)    VALUE +400             
017500                                                   COMP-3.                
017600     05  PC-20A                      PIC  X        VALUE  '2'.            
017700     05  PC-30A                      PIC  X        VALUE  '3'.            
017800     05  PC-50A                      PIC  X        VALUE  '5'.            
017900     05  PC-50P                      PIC  V9       VALUE  .5.             
018000     05  PC-1P                       PIC  S99V     VALUE +1               
018100                                                   COMP-3.                
018200     05  PC-2P                       PIC  S99V     VALUE +2               
018300                                                   COMP-3.                
018400     05  PC-3P                       PIC  S99V     VALUE +3               
018500                                                   COMP-3.                
018600     05  PC-4P                       PIC  S99V     VALUE +4               
018700                                                   COMP-3.                
018800     05  PC-B                        PIC  X(01)    VALUE 'B'.             
018900     05  PC-C                        PIC  X(01)    VALUE 'C'.             
019000     05  PC-D                        PIC  X(01)    VALUE 'D'.             
019100     05  PC-E                        PIC  X(01)    VALUE 'E'.             
019500     05  PC-F                        PIC  X(01)    VALUE 'F'.             
019500     05  PC-G                        PIC  X(01)    VALUE 'G'.             
019200     05  PC-N                        PIC  X(01)    VALUE 'N'.             
019300     05  PC-S                        PIC  X(01)    VALUE 'S'.             
019400     05  PC-Y                        PIC  X(01)    VALUE 'Y'.             
019500     05  PC-Z                        PIC  X(01)    VALUE 'Z'.             
019600     05  PC-RCD-TYPE                 PIC  X(03)    VALUE 'SYS'.           
019700     05  PC-DDM                      PIC  X(03)    VALUE 'DDM'.           
019800     05  PC-STORE-NAME               PIC  X(05)    VALUE                  
019900                                                   ' STR:'.               
020000     05  PC-PGM-DPKUT500             PIC  X(08)    VALUE                  
020100                                                   'DPKUT500'.            
020200 EJECT                                                                    
020300*                                                                         
020400 01  PV-ACCUMULATOR-FIELDS.                                               
020500     05  PV-SYSTEM-INPUT-CNT         PIC S9(03)    VALUE ZERO             
020600                                                   COMP-3.                
020700     05  PV-SYSTEM-OUTPUT-CNT        PIC S9(04)    VALUE ZERO             
020800                                                   COMP-3.                
020900     05  PV-TNOW-ADD-DAY             PIC S9(04)    VALUE ZERO             
021000                                                   COMP-3.                
021100*                                                                         
021200 01  PV-DATE-FIELDS.                                                      
021300     05  PV-DATE.                                                         
021400         10  PV-YEAR                     PIC 9(4) VALUE ZEROES.           
021500         10  PV-MO                       PIC 9(2) VALUE ZEROES.           
021600         10  PV-DY                       PIC 9(2) VALUE ZEROES.           
021700     05  PV-CURR-WEEK-YEAR.                                               
021800         10  PV-CURR-CCYY                PIC  9(04).                      
021900         10  PV-CURR-WEEK                PIC  9(02).                      
022000     05  PV-WEEK-YEAR.                                                    
022100         10  PV-CCYY                     PIC  9(04).                      
022200         10  PV-WEEK                     PIC  9(02).                      
022300*                                                                         
022400 01  CD-CPU-DATE                      PIC X(10).                          
022500 01  FILLER REDEFINES CD-CPU-DATE.                                        
022600     05  CD-CPU-YEAR                  PIC 9(04).                          
022700     05  FILLER REDEFINES CD-CPU-YEAR.                                    
022800         10  CD-CPU-CC                PIC 9(02).                          
022900         10  CD-CPU-YR                PIC 9(02).                          
023000     05  FILLER                       PIC X(01).                          
023100     05  CD-CPU-MO                    PIC 9(02).                          
023200     05  FILLER                       PIC X(01).                          
023300     05  CD-CPU-DY                    PIC 9(02).                          
023400*                                                                         
023500 01  PV-MISC-FIELDS.                                                      
023600     05  PV-ABEND-CODE               PIC S9(04)    VALUE ZERO             
023700                                                   COMP SYNC.             
023800     05  PV-VSAM-STATUS              PIC  X(02) VALUE SPACE.              
023900         88  PV-VSAM-SUCCESSFUL                 VALUE '00'.               
024000         88  PV-VSAM-NOT-FOUND                  VALUE '23'.               
024100     05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACES.          
024200                                                                          
024300     05  PV-INAME.                                                        
024810         10  PV-INAME-SKU            PIC  9(08)    VALUE ZERO.            
024820         10  FILLER                  PIC  X(02)    VALUE SPACES.          
024900         10  PV-INAME-STORE-HEADING  PIC  X(05)    VALUE SPACES.          
025000         10  PV-INAME-STORE          PIC  9(05)    VALUE ZEROES.          
025000         10  PV-INAME-STORE-ALPHA REDEFINES PV-INAME-STORE.               
025000             15  PV-INAME-STORE-X    PIC  X(05).                          
025100         10  FILLER                  PIC  X(01)    VALUE '/'.             
025200         10  PV-INAME-SKU-DESC       PIC  X(25)    VALUE SPACES.          
025300         10  PV-INAME-GROUP-CODE     PIC  X(03)    VALUE SPACES.          
025400         10  PV-INAME-STORE-CODE     PIC  X(01)    VALUE SPACES.          
025500     05  PV-SKU.                                                          
025600         10  PV-SKU-STYLE            PIC  X(15)    VALUE SPACES.          
025700         10  FILLER                  PIC  X(01)    VALUE '/'.             
025800         10  PV-SKU-SIZE             PIC  X(05)    VALUE SPACES.          
025900         10  FILLER                  PIC  X(01)    VALUE '/'.             
026000         10  PV-SKU-COLOR            PIC  X(04)    VALUE SPACES.          
026100         10  FILLER                  PIC  X(01)    VALUE ' '.             
026200         10  PV-SKU-VEND-NBR         PIC  X(03)    VALUE SPACES.          
026300     05  PV-HOLD-WEEK                PIC  9(02)    VALUE ZERO.            
026400     05  PV-MRISHS-SUB               PIC  9(02)    VALUE ZERO.            
026500     05  PV-HIST-SUB                 PIC  9(02)    VALUE ZERO.            
026600     05  PV-TEMP-DD-FCTR             PIC  9(6)V9(1) COMP-3                
026700                                                   VALUE ZERO.            
026800     05  PV-TNOW-WN-NOSIGN           PIC  9(02)    VALUE ZERO.            
026900     05  PV-TNOW-WN-SPLIT.                                                
027000         10  PV-TNOW-WN-DIGIT1       PIC  9(01)    VALUE ZERO.            
027100         10  PV-TNOW-WN-DIGIT2       PIC  9(01)    VALUE ZERO.            
027200             88  PV-ODD                   VALUE 1, 3, 5, 7, 9.            
027300     05  PV-TNOW-WN                  PIC  S99      COMP-3.                
027400     05  PV-TNOW-DN                  PIC  S9       COMP-3.                
027500     05  PV-F2                           PIC  X(02)    VALUE 'F2'.        
027600 EJECT                                                                    
027700*---------------------------------------------------------------*         
027800*   COPYBOOK FOR DATE MODULE                                              
027900*---------------------------------------------------------------*         
028000     COPY DPWS500.                                                        
028100*                                                                         
028200     COPY MRRD001I.                                                       
028300*                                                                         
028400 EJECT                                                                    
028500 01 PV-OUTPUT.                                                            
028600     COPY MRRD017.                                                        
028700 EJECT                                                                    
028800*                                                                         
028900 01  SYSTEM-RECORD                   PIC X(400).                          
029000 01  FILLER REDEFINES SYSTEM-RECORD.                                      
029100     COPY ICI005C.                                                        
029200*                                                                         
029300 01  FILLER REDEFINES SYSTEM-RECORD.                                      
029400     COPY ICI028C.                                                        
029500*                                                                         
029550     COPY ISWS006.                                                        
029551*                                                                         
029600*---------------------------------------------------------------*         
029700*   DATE TABLE                                                            
029800*---------------------------------------------------------------*         
029900 01  PT-PROGRAM-TABLES.                                                   
030000     05  PT-WEEKS-TABLE.                                                  
030100         10 PT-WEEK                   PIC  X(2)                           
030200                                      OCCURS 13 TIMES.                    
030300         10 PT-YEAR                   PIC  X(4)                           
030400                                      OCCURS 13 TIMES.                    
030500*                                                                         
030600*---------------------------------------------------------------*         
030700*   FORECAST LOOKUP TABLE TO CROSS-REFERENCE WEEK AND SEQ NBR             
030800*---------------------------------------------------------------*         
030900 01  FL-FORECAST-LOOKUP-TABLE.                                            
031000     05  FL-FORECAST-LOOKUP-ENTRIES OCCURS 4 TIMES                        
031100                                    INDEXED BY FL-INDEX.                  
031200         10  FL-WEEK-NBR              PIC S99V  COMP-3.                   
031300         10  FL-SEQ-NBR               PIC S99V  COMP-3.                   
031400*                                                                         
031500 EJECT                                                                    
031600     EXEC SQL                                                             
031700         INCLUDE TMRITST                                                  
031800     END-EXEC.                                                            
031900 EJECT                                                                    
032000     EXEC SQL                                                             
032100         INCLUDE TMRITEM                                                  
032200     END-EXEC.                                                            
032300 EJECT                                                                    
032400     EXEC SQL                                                             
032500         INCLUDE TMRISFE                                                  
032600     END-EXEC.                                                            
032700 EJECT                                                                    
032800     EXEC SQL                                                             
032900         INCLUDE TMRISFL                                                  
033000     END-EXEC.                                                            
033100 EJECT                                                                    
033200     EXEC SQL                                                             
033300         INCLUDE TMRISHS                                                  
033400     END-EXEC.                                                            
033500 EJECT                                                                    
033600     EXEC SQL                                                             
033700         INCLUDE TSK                                                      
033800     END-EXEC.                                                            
033900 EJECT                                                                    
034000     EXEC SQL                                                             
034100         INCLUDE XMT00001                                                 
034200     END-EXEC.                                                            
034210 EJECT                                                                    
034220     EXEC SQL                                                             
034230         INCLUDE TSKXREF                                                  
034240     END-EXEC.                                                            
034300*                                                                         
034400* DB2 COMMUNICATION AREA                                                  
034500*                                                                         
034600     EXEC SQL                                                             
034700         INCLUDE SQLCA                                                    
034800     END-EXEC.                                                            
034900 EJECT                                                                    
035000* DB2 COMMUNICATION AREA2                                                 
035100*                                                                         
035200     COPY SQLCA2.                                                         
035300 EJECT                                                                    
035400*                                                                         
035500* CURSOR FOR JOIN OF TSK, TMRITEM, TMRITST, AND TMRISFE                   
035600*                                                                         
035700* ADD THE TMRITEM-ORD-GROUP-SW  @@@                                       
035800*                                                                         
035900     EXEC SQL                                                             
036000       DECLARE MR_ITEM_CSR  CURSOR FOR                                    
3372A        WITH DATA_1 AS(                                                    
036100       SELECT A.ITEM_NBR,                                                 
036200              A.UCYCLE_CDE,                                               
036300              A.TSL_NBR,                                                  
036400              A.BYPDDU_CDE,                                               
036500              A.BYPSCL_NBR,                                               
036600              A.FRCDDU_CDE,                                               
036700              A.BYPZSL_CDE,                                               
036800              A.BYPTFP_CDE,                                               
036900              A.BYPZOH_CDE,                                               
037000              A.BYPBEF_CDE,                                               
037100              A.BYPAFT_CDE,                                               
037200              A.LUMPSW_CDE,                                               
037300              A.MINBI_FCTR,                                               
037400              A.DDFTSW_CDE,                                               
037500              A.RT_NBR,                                                   
037600              A.RTF_FCTR,                                                 
037700              A.ZOPSW_CDE,                                                
037800              A.OUTLSW_CDE,                                               
037900              A.ZSSTOCK_CDE,                                              
038000              A.PACKSW_CDE,                                               
038100              A.DSER_CDE,                                                 
038200              A.LT_QTY,                                                   
038300              A.IMIN_QTY,                                                 
038400              A.IMAX_QTY,                                                 
038500              A.SSADJ_PCT,                                                
038600              A.RT_DAY_NBR,                                               
038700              A.DDUPRM_SW,                                                
038800              A.ORD_GROUP_SW,                                             
039110              X.DEPT,                                                     
039120              X.SUBCLASS,                                                 
039130              X.SKU,                                                      
039200              B.MERCH_DIV_CODE,                                           
039300              B.DMM_NMBR,                                                 
039400              B.VENDOR_NMBR,                                              
039500              B.VNDR_IN_HSE_NMBR,                                         
039600              B.VENDOR_STYLE_CODE,                                        
039700              B.GROUP_CODE,                                               
039800              B.SKU_DESC,                                                 
039900              B.SIZE_DESC,                                                
040000              B.COLOR_DESC,                                               
040100              B.COST_UNIT_MSRMNT,                                         
040200              B.RTL_UNIT_MSRMNT,                                          
040300              B.UNIT_COST_AMT,                                            
040400              B.GP_RTL_AMT,                                               
040500              B.CUR_UNIT_RTL_AMT,                                         
040600              B.VNDR_INNR_PACK_QTY,                                       
040700              B.GP_QTY,                                                   
040800              C.STR_NBR,                                                  
040900              C.MINDD_QTY,                                                
041000              C.PTAG_ID,                                                  
041100              C.ON_ORDER_QTY,                                             
041200              C.COMSTK_QTY,                                               
041300              C.SPOQSW_CDE,                                               
041400              C.SPOQ_QTY,                                                 
041500              C.FT_CDE,                                                   
041600              C.OSTRAT_QTY,                                               
041700              C.CSTOCK_QTY,                                               
041800              C.MINOUTL_QTY,                                              
041900              C.MAXOUTL_QTY,                                              
042000              C.MAXOQP_PCT,                                               
042100              C.FOQ_QTY,                                                  
042200              C.TMIN_QTY,                                                 
042300              C.USERMIN_QTY,                                              
042400              C.USERMAX_QTY,                                              
042500              C.DD_FCTR,                                                  
042600              C.DDI_FCTR,                                                 
042700              C.LPP_QTY,                                                  
042800              C.MADSS_QTY,                                                
042900              C.FWMAD_QTY,                                                
043000              C.TRNDP_PCT,                                                
043100              C.MSDTS_QTY,                                                
043200              C.MADTS_QTY,                                                
043300              C.LTVFACT_FCTR,                                             
043400              C.PCTZ_PCT,                                                 
043500              C.MADSTAT_CDE,                                              
043600              C.DFLREG_CDE,                                               
043700              C.TSREG_CDE,                                                
043800              C.DIREG_CDE,                                                
043900              C.BYPREG_CDE,                                               
044000              C.LDD_FCTR,                                                 
044100              C.LDDI_FCTR,                                                
044200              C.LFWMAD_QTY,                                               
044300              C.OUTSTAT_CDE,                                              
044400              C.LRTFCST_NBR,                                              
044500              C.ORDSTAT_CDE,                                              
044600              C.CSTKMINT1_PCT,                                            
044700              C.CSTKMINT2_PCT,                                            
044800              C.CSTKMINT3_PCT,                                            
044900              C.CSTKMINT4_PCT,                                            
045000              C.CSTKMINT5_PCT,                                            
045100              C.CSTKMINT6_PCT,                                            
045200              C.CSTKMAXT1_PCT,                                            
045300              C.CSTKMAXT2_PCT,                                            
045400              C.CSTKMAXT3_PCT,                                            
045500              C.CSTKMAXT4_PCT,                                            
045600              C.CSTKMAXT5_PCT,                                            
045700              C.CSTKMAXT6_PCT,                                            
045800              C.FTJOPF_CDE,                                               
045900              D.SEQ_NBR,                                                  
046000              D.LFWM_QTY,                                                 
046100              D.FWM_QTY                                                   
046200         FROM TMRITEM A,                                                  
046300              TSK B,                                                      
046400              TMRITST C,                                                  
046500              TMRISFE D,                                                  
046510              TSKXREF X                                                   
046600        WHERE A.ITEM_NBR  = B.ITEM_NMBR                                   
046700          AND B.ITEM_NMBR = C.ITEM_NBR                                    
046800          AND C.ITEM_NBR  = D.ITEM_NBR                                    
046810          AND D.ITEM_NBR  = X.ITM_NBR                                     
046900          AND C.STR_NBR   = D.STR_NBR                                     
046900          AND C.FT_CDE    <> 'X'                                          
047000          AND (A.RT_NBR        = :MRITEM-RT-NBR                           
047100              AND A.RT_DAY_NBR = :MRITEM-RT-DAY-NBR)                      
                AND A.RT_NBR > 0                                                
047200          AND C.STR_NBR NOT IN (                                          
047300                        SELECT LOC_NBR                                    
047400                          FROM XMT_LOC                                    
047500                         WHERE E_BUS_IND = 'Y'                            
047600*                          AND LOC_TYP_CDE = 'DS')                        
3372A                            AND LOC_TYP_CDE = 'DS'))                       
3372A        SELECT DATA_1.ITEM_NBR,                                            
3372A               DATA_1.UCYCLE_CDE,                                          
3372A               DATA_1.TSL_NBR,                                             
3372A               DATA_1.BYPDDU_CDE,                                          
3372A               DATA_1.BYPSCL_NBR,                                          
3372A               DATA_1.FRCDDU_CDE,                                          
3372A               DATA_1.BYPZSL_CDE,                                          
3372A               DATA_1.BYPTFP_CDE,                                          
3372A               DATA_1.BYPZOH_CDE,                                          
3372A               DATA_1.BYPBEF_CDE,                                          
3372A               DATA_1.BYPAFT_CDE,                                          
3372A               DATA_1.LUMPSW_CDE,                                          
3372A               DATA_1.MINBI_FCTR,                                          
3372A               DATA_1.DDFTSW_CDE,                                          
3372A               DATA_1.RT_NBR,                                              
3372A               DATA_1.RTF_FCTR,                                            
3372A               DATA_1.ZOPSW_CDE,                                           
3372A               DATA_1.OUTLSW_CDE,                                          
3372A               DATA_1.ZSSTOCK_CDE,                                         
3372A               DATA_1.PACKSW_CDE,                                          
3372A               DATA_1.DSER_CDE,                                            
3372A               DATA_1.LT_QTY,                                              
3372A               DATA_1.IMIN_QTY,                                            
3372A               DATA_1.IMAX_QTY,                                            
3372A               DATA_1.SSADJ_PCT,                                           
3372A               DATA_1.RT_DAY_NBR,                                          
3372A               DATA_1.DDUPRM_SW,                                           
3372A               DATA_1.ORD_GROUP_SW,                                        
3372A               DATA_1.DEPT,                                                
3372A               DATA_1.SUBCLASS,                                            
3372A               DATA_1.SKU,                                                 
3372A               DATA_1.MERCH_DIV_CODE,                                      
3372A               DATA_1.DMM_NMBR,                                            
3372A               DATA_1.VENDOR_NMBR,                                         
3372A               DATA_1.VNDR_IN_HSE_NMBR,                                    
3372A               DATA_1.VENDOR_STYLE_CODE,                                   
3372A               DATA_1.GROUP_CODE,                                          
3372A               DATA_1.SKU_DESC,                                            
3372A               DATA_1.SIZE_DESC,                                           
3372A               DATA_1.COLOR_DESC,                                          
3372A               DATA_1.COST_UNIT_MSRMNT,                                    
3372A               DATA_1.RTL_UNIT_MSRMNT,                                     
3372A               DATA_1.UNIT_COST_AMT,                                       
3372A               DATA_1.GP_RTL_AMT,                                          
3372A               DATA_1.CUR_UNIT_RTL_AMT,                                    
3372A               COALESCE(Y.INNR_PK_QTY,DATA_1.VNDR_INNR_PACK_QTY),          
3372A               DATA_1.GP_QTY,                                              
3372A               DATA_1.STR_NBR,                                             
3372A               DATA_1.MINDD_QTY,                                           
3372A               DATA_1.PTAG_ID,                                             
3372A               DATA_1.ON_ORDER_QTY,                                        
3372A               DATA_1.COMSTK_QTY,                                          
3372A               DATA_1.SPOQSW_CDE,                                          
3372A               DATA_1.SPOQ_QTY,                                            
3372A               DATA_1.FT_CDE,                                              
3372A               DATA_1.OSTRAT_QTY,                                          
3372A               DATA_1.CSTOCK_QTY,                                          
3372A               DATA_1.MINOUTL_QTY,                                         
3372A               DATA_1.MAXOUTL_QTY,                                         
3372A               DATA_1.MAXOQP_PCT,                                          
3372A               DATA_1.FOQ_QTY,                                             
3372A               DATA_1.TMIN_QTY,                                            
3372A               DATA_1.USERMIN_QTY,                                         
3372A               DATA_1.USERMAX_QTY,                                         
3372A               DATA_1.DD_FCTR,                                             
3372A               DATA_1.DDI_FCTR,                                            
3372A               DATA_1.LPP_QTY,                                             
3372A               DATA_1.MADSS_QTY,                                           
3372A               DATA_1.FWMAD_QTY,                                           
3372A               DATA_1.TRNDP_PCT,                                           
3372A               DATA_1.MSDTS_QTY,                                           
3372A               DATA_1.MADTS_QTY,                                           
3372A               DATA_1.LTVFACT_FCTR,                                        
3372A               DATA_1.PCTZ_PCT,                                            
3372A               DATA_1.MADSTAT_CDE,                                         
3372A               DATA_1.DFLREG_CDE,                                          
3372A               DATA_1.TSREG_CDE,                                           
3372A               DATA_1.DIREG_CDE,                                           
3372A               DATA_1.BYPREG_CDE,                                          
3372A               DATA_1.LDD_FCTR,                                            
3372A               DATA_1.LDDI_FCTR,                                           
3372A               DATA_1.LFWMAD_QTY,                                          
3372A               DATA_1.OUTSTAT_CDE,                                         
3372A               DATA_1.LRTFCST_NBR,                                         
3372A               DATA_1.ORDSTAT_CDE,                                         
3372A               DATA_1.CSTKMINT1_PCT,                                       
3372A               DATA_1.CSTKMINT2_PCT,                                       
3372A               DATA_1.CSTKMINT3_PCT,                                       
3372A               DATA_1.CSTKMINT4_PCT,                                       
3372A               DATA_1.CSTKMINT5_PCT,                                       
3372A               DATA_1.CSTKMINT6_PCT,                                       
3372A               DATA_1.CSTKMAXT1_PCT,                                       
3372A               DATA_1.CSTKMAXT2_PCT,                                       
3372A               DATA_1.CSTKMAXT3_PCT,                                       
3372A               DATA_1.CSTKMAXT4_PCT,                                       
3372A               DATA_1.CSTKMAXT5_PCT,                                       
3372A               DATA_1.CSTKMAXT6_PCT,                                       
3372A               DATA_1.FTJOPF_CDE,                                          
3372A               DATA_1.SEQ_NBR,                                             
3372A               DATA_1.LFWM_QTY,                                            
3372A               DATA_1.FWM_QTY                                              
3372A               FROM DATA_1                                                 
3372A               LEFT OUTER JOIN MRTW_SKU_PKGNG_OVRRID Y                     
3372A               ON (DATA_1.SKU=Y.SKU_NBR)                                   
3372A               AND Y.DISTRB_TYP_CDE = 'B'                                  
3372A           FOR FETCH ONLY                                                  
047700     END-EXEC.                                                            
047800*                                                                         
047900* CURSOR FOR TMRISHS                                                      
048000*                                                                         
048100     EXEC SQL                                                             
048200         DECLARE ITEM_HIST_CSR CURSOR FOR                                 
048300          SELECT                                                          
048400                 YR_NBR                                                   
048500               , WK_NBR                                                   
048600               , ITM_REV_ID                                               
048700               , SLS_HIST_QTY                                             
048800               , OH_HIST_QTY                                              
048900               , MAD_HIST_QTY                                             
049000               , DSD_HIST_QTY                                             
049100           FROM                                                           
049200                 TMRISHS                                                  
049300          WHERE  ITM_NBR = :MRISHS-ITM-NBR                                
049400            AND  STR_NBR = :MRISHS-STR-NBR                                
049500       ORDER BY  YR_NBR     DESC                                          
049600               , WK_NBR     DESC                                          
049700               , ITM_REV_ID DESC                                          
049800     END-EXEC.                                                            
049900*                                                                         
050000*                                                                         
050100*                                                                         
050200*****************************************************************         
050300*PROCEDURE DIVISION.                                                      
050400*****************************************************************         
050500 PROCEDURE DIVISION.                                                      
050600*                                                                         
050700*                                                                         
050800 A000-MAINLINE-PROCESSING.                                                
050900*                                                                         
051000     DISPLAY 'TEST VERSION, FROM TKMA949.Z.PGMSRC'                        
051000     PERFORM A100-INITIALIZATION.                                         
051100*                                                                         
051200     PERFORM B000-PROCESS-SYSTEM-RECORD                                   
051300             UNTIL EOC-ITEM-CSR.                                          
051400*                                                                         
051500     PERFORM Y100-END-ROUTINE.                                            
051600*                                                                         
051700     GOBACK.                                                              
051800*                                                                         
051900 EJECT                                                                    
052000******************************************************************        
052100** OPEN THE SYSTEM FILE AND ACCEPT CONTROL CARDS.                         
052200** CALL CALENDAR ROUTINES TO RETRIEVE VALUES NEEDED IN PROGRAM            
052300******************************************************************        
052400 A100-INITIALIZATION.                                                     
052500*                                                                         
052600*                                                                         
052700     OPEN  INPUT IC-CONTROL-FILE                                          
052800                 IC-PARM-FILE                                             
052900          OUTPUT TRANSFER-RECORD.                                         
053000*                                                                         
053100     IF  PV-VSAM-SUCCESSFUL                                               
053200        CONTINUE                                                          
053300     ELSE                                                                 
053400        IF PV-VSAM-NOT-FOUND                                              
053500           DISPLAY '** ABEND **'                                          
053600           DISPLAY '** PROGRAM    = MRKUT014'                             
053700           DISPLAY '** PARAGRAPH  = A100-INITIALIZATION   '               
053800           DISPLAY '** MESSAGE    = '                                     
053900                   'RECORD NOT FOUND,STATUS: ' PV-VSAM-STATUS             
054000           MOVE +4008           TO PV-ABEND-CODE                          
054100           CALL 'ILBOABN0'      USING PV-ABEND-CODE                       
054200        ELSE                                                              
054300           DISPLAY '** ABEND **'                                          
054400           DISPLAY '** PROGRAM    = MRKUT014'                             
054500           DISPLAY '** PARAGRAPH  = A100-INITIALIZATION   '               
054600           DISPLAY '** MESSAGE    = '                                     
054700                   'BAD VSAM READ, STATUS = ' PV-VSAM-STATUS              
054800           MOVE +4005           TO PV-ABEND-CODE                          
054900           CALL 'ILBOABN0'      USING PV-ABEND-CODE                       
055000        END-IF                                                            
055100     END-IF.                                                              
055200     INITIALIZE PV-OUTPUT.                                                
055300*                                                                         
055400*    ACCEPT PARAMETER-INPUT-RECORD.                                       
055500*                                                                         
055600     PERFORM R100-READ-PARM-FILE.                                         
055700*                                                                         
055800     MOVE MR001I-S-SYS-ID   TO  S-SYS-ID.                                 
055900     MOVE PC-RCD-TYPE       TO  S-RCD-TYPE.                               
056000     MOVE LOW-VALUES        TO  S-RCD-ID.                                 
056100     MOVE S-KEY             TO  ICCTL-KEY.                                
056200     PERFORM R000-READ-CONTROL-FILE.                                      
056300*                                                                         
056400     DISPLAY ' MR001I-S-RUN-CYCLE: ' MR001I-S-RUN-CYCLE                   
056500*                                                                         
056600     IF MR001I-S-RUN-CYCLE = PC-B                                         
056700         MOVE PC-4          TO MRITEM-RT-NBR                              
056800         MOVE ZERO          TO MRITEM-RT-DAY-NBR                          
056900     END-IF.                                                              
057000*                                                                         
057100     IF MR001I-S-RUN-CYCLE = PC-S                                         
057200         MOVE PC-4          TO MRITEM-RT-NBR                              
057300         MOVE PC-100        TO MRITEM-RT-DAY-NBR                          
057400     END-IF.                                                              
057500*                                                                         
057600     IF MR001I-S-RUN-CYCLE = PC-D                                         
057700         MOVE PC-7          TO MRITEM-RT-NBR                              
057800         MOVE S-TNOW-DN     TO MRITEM-RT-DAY-NBR                          
057900     END-IF.                                                              
058000*                                                                         
058100*  FOR THE 1B ONCE A WEEK SYSTEM     S.M 1/2000                           
058200     MOVE ZERO TO PV-TNOW-ADD-DAY.                                        
058300     IF MR001I-S-RUN-CYCLE = PC-E                                         
058400         MOVE PC-7          TO MRITEM-RT-NBR                              
058500         ADD  PC-100        TO S-TNOW-DN                                  
058600            GIVING PV-TNOW-ADD-DAY                                        
058700         MOVE PV-TNOW-ADD-DAY TO MRITEM-RT-DAY-NBR                        
058800     END-IF.                                                              
058900*                                                                         
058100*  FOR THE 1C ONCE A WEEK SYSTEM     R.S 10/2007                          
058300     IF MR001I-S-RUN-CYCLE = PC-F                                         
058400         MOVE PC-7          TO MRITEM-RT-NBR                              
058500         ADD  PC-200        TO S-TNOW-DN                                  
058600            GIVING PV-TNOW-ADD-DAY                                        
058700         MOVE PV-TNOW-ADD-DAY TO MRITEM-RT-DAY-NBR                        
058800     END-IF.                                                              
058900                                                                          
058100*  FOR THE 1D ONCE A WEEK SYSTEM                                          
058300     IF MR001I-S-RUN-CYCLE = PC-G                                         
058400         MOVE PC-7          TO MRITEM-RT-NBR                              
058500         ADD  PC-400        TO S-TNOW-DN                                  
058600            GIVING PV-TNOW-ADD-DAY                                        
058700         MOVE PV-TNOW-ADD-DAY TO MRITEM-RT-DAY-NBR                        
058800     END-IF.                                                              
058900                                                                          
059100     IF MR001I-S-RUN-CYCLE = PC-Z                                         
059200         MOVE ZERO          TO MRITEM-RT-NBR                              
059300         MOVE ZERO          TO MRITEM-RT-DAY-NBR                          
059400     END-IF.                                                              
059500*                                                                         
059600     IF MR001I-S-RUN-CYCLE = PC-C                                         
059700         MOVE S-TNOW-WN     TO PV-TNOW-WN-NOSIGN                          
059800         MOVE PV-TNOW-WN-NOSIGN                                           
059900                            TO PV-TNOW-WN-SPLIT                           
060000         IF PV-ODD                                                        
060100             MOVE PC-14     TO MRITEM-RT-NBR                              
060200             MOVE S-TNOW-DN TO MRITEM-RT-DAY-NBR                          
060300         ELSE                                                             
060400             MOVE PC-14     TO MRITEM-RT-NBR                              
060500             COMPUTE MRITEM-RT-DAY-NBR = S-TNOW-DN + PC-7                 
060600         END-IF                                                           
060700     END-IF.                                                              
060800*                                                                         
060900     DISPLAY 'S-TNOW-WN: '    S-TNOW-WN.                                  
061000     DISPLAY 'S-TNOW-DN: '    S-TNOW-DN.                                  
061100     DISPLAY 'A.RT_NBR: '     MRITEM-RT-NBR.                              
061200     DISPLAY 'A.RT_DAY_NBR: ' MRITEM-RT-DAY-NBR.                          
061300     DISPLAY 'A.RT_DAY_NBR:+100 ' PV-TNOW-ADD-DAY.                        
061400*                                                                         
061500     MOVE S-TNOW-WN  TO PV-TNOW-WN.                                       
061600     MOVE S-TNOW-DN  TO PV-TNOW-DN.                                       
061700*                                                                         
061800     MOVE MR001I-S-SYS-ID   TO  D-SYS-ID.                                 
061900     MOVE PC-DDM            TO  D-RCD-TYPE.                               
062000     MOVE LOW-VALUES        TO  D-RCD-ID.                                 
062100     MOVE D-KEY             TO  ICCTL-KEY.                                
062200     PERFORM R000-READ-CONTROL-FILE.                                      
062300*                                                                         
062400     MOVE PC-1 TO FL-WEEK-NBR (1).                                        
062500     MOVE PC-2 TO FL-WEEK-NBR (2).                                        
062600     MOVE PC-3 TO FL-WEEK-NBR (3).                                        
062700     MOVE PC-4 TO FL-WEEK-NBR (4).                                        
062800*                                                                         
062900     PERFORM S200-SELECT-SEQ-NBR1.                                        
063000     PERFORM S300-SELECT-SEQ-NBR2.                                        
063100     PERFORM S400-SELECT-SEQ-NBR3.                                        
063200     PERFORM S500-SELECT-SEQ-NBR4.                                        
063300*                                                                         
063400     PERFORM I100-SET-WEEK-TABLE.                                         
063500*                                                                         
063600     MOVE PC-N TO PS-EOC-ITEM-CSR.                                        
063700     PERFORM S100-OPEN-ITEM-CSR.                                          
063800                                                                          
063900*                                                                         
064000 EJECT                                                                    
064100******************************************************************        
064200*                                                                *        
064300******************************************************************        
064400 B000-PROCESS-SYSTEM-RECORD.                                              
064500*                                                                         
064600*    DISPLAY 'B000-PROCESS-SYSTEM-RECORD'.                                
064700*                                                                         
064800     PERFORM T300-FETCH-ITEM-CURSOR.                                      
064900*                                                                         
065000     IF EOC-ITEM-CSR                                                      
065100       CONTINUE                                                           
065200     ELSE                                                                 
065300       PERFORM C000-FORMAT-TRANSFER-REC                                   
065400           UNTIL EOC-ITEM-CSR                                             
065500     END-IF.                                                              
065600*                                                                         
065700*                                                                         
065800 EJECT                                                                    
065900******************************************************************        
066000*                                                                *        
066100******************************************************************        
066200 C000-FORMAT-TRANSFER-REC.                                                
066300*                                                                         
066400*    DISPLAY 'C000-FORMAT-TRANSFER-REC'.                                  
066500*                                                                         
066600*                                                                         
066700     PERFORM F000-FORMAT-TRAN-INPUT.                                      
066800*                                                                         
066900     PERFORM G000-FORMAT-ROD-USER-AREA.                                   
067000*                                                                         
067100     PERFORM H000-FORMAT-ROH-USER-AREA.                                   
067200*                                                                         
067300     PERFORM W000-WRITE-OUTPUT.                                           
067400*                                                                         
067500     PERFORM T300-FETCH-ITEM-CURSOR.                                      
067600*                                                                         
067700******************************************************************        
067800*  MOVE VALUES INTO THE TRANSFER-RECORD LAYOUT FOR OUTPUT                 
067900******************************************************************        
068000 F000-FORMAT-TRAN-INPUT.                                                  
068100*                                                                         
068200*    DISPLAY 'F000-FORMAT-TRAN-INPUT'.                                    
068300*                                                                         
068400*    FORMAT/MOVE ADDITIONAL FIELDS.                                       
068500*                                                                         
068710     MOVE SKXREF-DEPT                 TO NI-DEPT-9-3.                     
068711     MOVE NI-DEPT-9-3                 TO MR017-DEPT-NBR.                  
068720     MOVE SKXREF-SUBCLASS             TO NI-SUB-CLASS-9-2.                
068730     MOVE NI-SUB-CLASS-9-2            TO MR017-CLASS-NBR.                 
068800     MOVE TSK-VNDR-IN-HSE-NMBR        TO MR017-VEND-NBR.                  
068910     MOVE SKXREF-SKU                  TO MR017-SKU-NBR.                   
069000     MOVE MRITEM-ITEM-NBR             TO MR017-ITEM-NBR.                  
113900     MOVE MRITST-STR-NBR              TO MR017-STR-NBR                    
069200     MOVE MRISFE-SEQ-NBR              TO MR017-FE-SEQ-NBR.                
069300     MOVE MRISFE-LFWM-QTY             TO MR017-LFWM-QTY.                  
069400     MOVE MRISFE-FWM-QTY              TO MR017-FWM-QTY.                   
069500                                                                          
069600     SET FL-INDEX TO 1.                                                   
069700     SEARCH FL-FORECAST-LOOKUP-ENTRIES                                    
069800        WHEN FL-SEQ-NBR (FL-INDEX) = MRISFE-SEQ-NBR                       
069900           MOVE FL-WEEK-NBR (FL-INDEX) TO MR017-WEEK-NBR                  
070000     END-SEARCH.                                                          
070100*                                                                         
070200*  ADD LOGIC TO EVALUATE FOR UCYCLE 5                                     
070300     IF MRITEM-UCYCLE-CDE = PC-5A                                         
070400        IF MRITST-DD-FCTR = 0                                             
070500           MOVE MRITST-DD-FCTR TO PV-TEMP-DD-FCTR                         
070600        ELSE                                                              
070700           COMPUTE PV-TEMP-DD-FCTR =                                      
070800               MRITST-DD-FCTR / PC-4                                      
070900        END-IF                                                            
071000     ELSE                                                                 
071100        MOVE MRITST-DD-FCTR TO PV-TEMP-DD-FCTR                            
071200     END-IF.                                                              
071300*  ADD LOGIC END                                                          
071400                                                                          
071500     EVALUATE TRUE                                                        
071600       WHEN PV-TEMP-DD-FCTR <= D-MAXDD-1                                  
071700           MOVE D-CADL-1              TO MR017-CADL                       
071800           MOVE D-IDFL-1              TO MR017-IDFL                       
071900           MOVE D-HIDFL-1             TO MR017-HIDFL                      
072000           MOVE D-LODFL-1             TO MR017-LODFL                      
072100           MOVE D-NDFL-1              TO MR017-NDFL                       
072200           MOVE D-DAMP-1              TO MR017-DAMP                       
072300           MOVE D-MINSMK-1            TO MR017-MINSMK                     
072400           MOVE D-MAXSMK-1            TO MR017-MAXSMK                     
072500           MOVE D-HIPCT-1             TO MR017-HIPCT                      
072600           MOVE D-LOPCT-1             TO MR017-LOPCT                      
072700           MOVE D-HIMADP-1            TO MR017-HIMADP                     
072800           MOVE D-LOMADP-1            TO MR017-LOMADP                     
072900           MOVE D-TSL-1               TO MR017-TSL                        
073000           MOVE D-BYPZSL-1            TO MR017-BYPZSL                     
073100       WHEN PV-TEMP-DD-FCTR <= D-MAXDD-2                                  
073200           MOVE D-CADL-2              TO MR017-CADL                       
073300           MOVE D-IDFL-2              TO MR017-IDFL                       
073400           MOVE D-HIDFL-2             TO MR017-HIDFL                      
073500           MOVE D-LODFL-2             TO MR017-LODFL                      
073600           MOVE D-NDFL-2              TO MR017-NDFL                       
073700           MOVE D-DAMP-2              TO MR017-DAMP                       
073800           MOVE D-MINSMK-2            TO MR017-MINSMK                     
073900           MOVE D-MAXSMK-2            TO MR017-MAXSMK                     
074000           MOVE D-HIPCT-2             TO MR017-HIPCT                      
074100           MOVE D-LOPCT-2             TO MR017-LOPCT                      
074200           MOVE D-HIMADP-2            TO MR017-HIMADP                     
074300           MOVE D-LOMADP-2            TO MR017-LOMADP                     
074400           MOVE D-TSL-2               TO MR017-TSL                        
074500           MOVE D-BYPZSL-2            TO MR017-BYPZSL                     
074600       WHEN PV-TEMP-DD-FCTR <= D-MAXDD-3                                  
074700           MOVE D-CADL-3              TO MR017-CADL                       
074800           MOVE D-IDFL-3              TO MR017-IDFL                       
074900           MOVE D-HIDFL-3             TO MR017-HIDFL                      
075000           MOVE D-LODFL-3             TO MR017-LODFL                      
075100           MOVE D-NDFL-3              TO MR017-NDFL                       
075200           MOVE D-DAMP-3              TO MR017-DAMP                       
075300           MOVE D-MINSMK-3            TO MR017-MINSMK                     
075400           MOVE D-MAXSMK-3            TO MR017-MAXSMK                     
075500           MOVE D-HIPCT-3             TO MR017-HIPCT                      
075600           MOVE D-LOPCT-3             TO MR017-LOPCT                      
075700           MOVE D-HIMADP-3            TO MR017-HIMADP                     
075800           MOVE D-LOMADP-3            TO MR017-LOMADP                     
075900           MOVE D-TSL-3               TO MR017-TSL                        
076000           MOVE D-BYPZSL-3            TO MR017-BYPZSL                     
076100     END-EVALUATE.                                                        
076200                                                                          
076300***********************************                                       
076400**     WHEN PV-TEMP-DD-FCTR < PC-1                                        
076500**         MOVE PC-3                  TO MR017-IDFL                       
076600**         MOVE PC-5                  TO MR017-HIDFL                      
076700**         MOVE PC-2                  TO MR017-LODFL                      
076800**         MOVE PC-3                  TO MR017-NDFL                       
076900**         MOVE PC-30A                TO MR017-HIPCT                      
077000**         MOVE PC-20A                TO MR017-LOPCT                      
077100**         MOVE ZEROES                TO MR017-HIMADP                     
077200**     WHEN PV-TEMP-DD-FCTR >= PC-1 AND < PC-11                           
077300**         MOVE PC-3                  TO MR017-IDFL                       
077400**         MOVE PC-3                  TO MR017-HIDFL                      
077500**         MOVE PC-2                  TO MR017-LODFL                      
077600**         MOVE PC-3                  TO MR017-NDFL                       
077700**         MOVE PC-30A                TO MR017-HIPCT                      
077800**         MOVE PC-20A                TO MR017-LOPCT                      
077900**         MOVE PC-50P                TO MR017-HIMADP                     
078000**     WHEN PV-TEMP-DD-FCTR > PC-10                                       
078100**         MOVE PC-3                  TO MR017-IDFL                       
078200**         MOVE PC-2                  TO MR017-HIDFL                      
078300**         MOVE PC-2                  TO MR017-LODFL                      
078400**         MOVE PC-3                  TO MR017-NDFL                       
078500**         MOVE PC-30A                TO MR017-HIPCT                      
078600**         MOVE PC-30A                TO MR017-LOPCT                      
078700**         MOVE PC-50P                TO MR017-HIMADP                     
078800***********************************                                       
078900*                                                                         
079000     MOVE MRITEM-UCYCLE-CDE           TO MR017-UCYCLE.                    
079100     MOVE PV-TNOW-WN                  TO MR017-WN.                        
079200     MOVE PV-TNOW-DN                  TO MR017-DN.                        
079300**   MOVE MRITEM-TSL-NBR              TO MR017-TSL.                       
079400     MOVE MRITEM-BYPDDU-CDE           TO MR017-BYPDDU.                    
079500     MOVE MRITEM-BYPSCL-NBR           TO MR017-BYPSCL.                    
079600     MOVE MRITEM-FRCDDU-CDE           TO MR017-FRCDDU.                    
079700**   MOVE MRITEM-BYPZSL-CDE           TO MR017-BYPZSL.                    
079800     MOVE MRITEM-BYPTFP-CDE           TO MR017-BYPTFP.                    
079900     MOVE MRITEM-BYPZOH-CDE           TO MR017-BYPZOH.                    
080000     MOVE MRITEM-BYPBEF-CDE           TO MR017-BYPBEF.                    
080100     MOVE MRITEM-BYPAFT-CDE           TO MR017-BYPAFT.                    
080200     MOVE MRITEM-LUMPSW-CDE           TO MR017-LUMPSW.                    
080300     MOVE MRITEM-MINBI-FCTR           TO MR017-MINBI.                     
080400     MOVE MRITEM-DDFTSW-CDE           TO MR017-DDFTSW.                    
080500     MOVE MRITST-MINDD-QTY            TO MR017-MINDD.                     
080600     MOVE MRITEM-RT-NBR               TO MR017-RT.                        
080700     MOVE MRITEM-RTF-FCTR             TO MR017-RTF.                       
080800     MOVE MRITEM-ZOPSW-CDE            TO MR017-ZOPSW.                     
080900     MOVE MRITEM-OUTLSW-CDE           TO MR017-OUTLSW.                    
081000     MOVE MRITEM-ZSSTOCK-CDE          TO MR017-ZSSTOCK.                   
081100     MOVE MRITEM-PACKSW-CDE           TO MR017-PACKSW.                    
081200     MOVE MRITEM-DSER-CDE             TO MR017-DSER.                      
081300     MOVE MRITEM-DDUPRM-SW            TO MR017-DDUPRM.                    
081400     MOVE MRITST-PTAG-ID              TO MR017-PTAG.                      
081500     MOVE MRITEM-LT-QTY               TO MR017-LT.                        
081600     MOVE TSK-UNIT-COST-AMT           TO MR017-ICOST.                     
081700     MOVE MRITST-ON-ORDER-QTY         TO MR017-OO.                        
081800     MOVE MRITST-COMSTK-QTY           TO MR017-COMSTK.                    
081900     MOVE MRITST-SPOQSW-CDE           TO MR017-SPOQSW.                    
082000     MOVE MRITST-SPOQ-QTY             TO MR017-SPOQ.                      
082100*                                                                         
082200     MOVE TSK-SKU-DESC                TO PV-INAME-SKU-DESC.               
082510     MOVE SKXREF-SKU                  TO PV-INAME-SKU.                    
082600     MOVE MRITST-STR-NBR              TO PV-INAME-STORE.                  
082700*                                                                         
082800     IF MRITEM-ORD-GROUP-SW = 'Y'                                         
082900        MOVE TSK-GROUP-CODE TO PV-INAME-GROUP-CODE                        
083000     ELSE                                                                 
083100        MOVE SPACES TO PV-INAME-GROUP-CODE                                
083200     END-IF                                                               
083300                                                                          
083400     IF PV-INAME-STORE = ZERO                                             
083500        MOVE 'C'                      TO PV-INAME-STORE-CODE              
083600        MOVE SPACES                   TO PV-INAME-STORE-HEADING           
083700        MOVE SPACES                   TO PV-INAME-STORE-X                 
083800     ELSE                                                                 
083900        MOVE 'S'                      TO PV-INAME-STORE-CODE              
084000        MOVE PC-STORE-NAME            TO PV-INAME-STORE-HEADING           
084100     END-IF.                                                              
084200                                                                          
084300     MOVE PV-INAME                    TO MR017-INAME.                     
084400*                                                                         
084500     MOVE TSK-VENDOR-STYLE-CODE       TO PV-SKU-STYLE.                    
084600     MOVE TSK-SIZE-DESC               TO PV-SKU-SIZE.                     
084700     MOVE TSK-COLOR-DESC              TO PV-SKU-COLOR.                    
084800     MOVE TSK-VNDR-IN-HSE-NMBR        TO PV-SKU-VEND-NBR.                 
084900     MOVE PV-SKU                      TO MR017-SKU.                       
085000*                                                                         
085100*    MOVE TUPCSKU-UPC-NBR             TO MR017-UPC.                       
085200     MOVE MRITST-FT-CDE               TO MR017-FT.                        
085300     MOVE MRITST-OSTRAT-QTY           TO MR017-OSTRAT.                    
085400     MOVE TSK-VNDR-INNR-PACK-QTY      TO MR017-PACKSZ.                    
085500     MOVE MRITEM-IMIN-QTY             TO MR017-IMIN.                      
085600     MOVE MRITEM-IMAX-QTY             TO MR017-IMAX.                      
085700     MOVE MRITST-CSTOCK-QTY           TO MR017-CSTOCK.                    
085800     MOVE MRITEM-SSADJ-PCT            TO MR017-SSADJ.                     
085900     MOVE MRITST-MINOUTL-QTY          TO MR017-MINOUTL.                   
086000     MOVE MRITST-MAXOUTL-QTY          TO MR017-MAXOUTL.                   
086100     MOVE MRITST-MAXOQP-PCT           TO MR017-MAXOQP.                    
086200     MOVE MRITST-FOQ-QTY              TO MR017-FOQ.                       
086300     MOVE MRITST-TMIN-QTY             TO MR017-TMIN.                      
086400     MOVE MRITST-USERMIN-QTY          TO MR017-USERMIN.                   
086500     MOVE MRITST-USERMAX-QTY          TO MR017-USERMAX.                   
086600     MOVE MRITST-DD-FCTR              TO MR017-DD.                        
086700     MOVE MRITST-DDI-FCTR             TO MR017-DDI.                       
086800     MOVE MRITST-LPP-QTY              TO MR017-LPP.                       
086900     MOVE MRITST-MADSS-QTY            TO MR017-MADSS.                     
087000     MOVE MRITST-FWMAD-QTY            TO MR017-FWMAD.                     
087100     MOVE MRITST-TRNDP-PCT            TO MR017-TRNDP.                     
087200     MOVE MRITST-MSDTS-QTY            TO MR017-MSDTS.                     
087300     MOVE MRITST-MADTS-QTY            TO MR017-MADTS.                     
087400     MOVE MRITST-LTVFACT-FCTR         TO MR017-LTVFACT.                   
087500     MOVE MRITST-PCTZ-PCT             TO MR017-PCTZ.                      
087600     MOVE MRITST-MADSTAT-CDE          TO MR017-MADSTAT.                   
087700     MOVE MRITST-DFLREG-CDE           TO MR017-DFLREG.                    
087800     MOVE MRITST-TSREG-CDE            TO MR017-TSREG.                     
087900     MOVE MRITST-DIREG-CDE            TO MR017-DIREG.                     
088000     MOVE MRITST-BYPREG-CDE           TO MR017-BYPREG.                    
088100     MOVE MRITST-LDD-FCTR             TO MR017-LDD.                       
088200     MOVE MRITST-LDDI-FCTR            TO MR017-LDDI.                      
088300     MOVE MRITST-LFWMAD-QTY           TO MR017-LMADSS.                    
088400     MOVE MRITST-OUTSTAT-CDE          TO MR017-OUTSTAT.                   
088500     MOVE MRITST-LRTFCST-NBR          TO MR017-LRTFCST.                   
088600     MOVE MRITST-ORDSTAT-CDE          TO MR017-ORDSTAT.                   
088700*                                                                         
088800     MOVE MRITST-CSTKMINT1-PCT        TO MR017-CSTKMINT (1).              
088900     MOVE MRITST-CSTKMINT2-PCT        TO MR017-CSTKMINT (2).              
089000     MOVE MRITST-CSTKMINT3-PCT        TO MR017-CSTKMINT (3).              
089100     MOVE MRITST-CSTKMINT4-PCT        TO MR017-CSTKMINT (4).              
089200     MOVE MRITST-CSTKMINT5-PCT        TO MR017-CSTKMINT (5).              
089300     MOVE MRITST-CSTKMINT6-PCT        TO MR017-CSTKMINT (6).              
089400*                                                                         
089500     MOVE MRITST-CSTKMAXT1-PCT        TO MR017-CSTKMAXT (1).              
089600     MOVE MRITST-CSTKMAXT2-PCT        TO MR017-CSTKMAXT (2).              
089700     MOVE MRITST-CSTKMAXT3-PCT        TO MR017-CSTKMAXT (3).              
089800     MOVE MRITST-CSTKMAXT4-PCT        TO MR017-CSTKMAXT (4).              
089900     MOVE MRITST-CSTKMAXT5-PCT        TO MR017-CSTKMAXT (5).              
090000     MOVE MRITST-CSTKMAXT6-PCT        TO MR017-CSTKMAXT (6).              
090100*                                                                         
090200     MOVE MRITST-FTJOPF-CDE           TO MR017-FTJOPF.                    
090300*                                                                         
090400     PERFORM F100-FORMAT-HIST-DATA.                                       
090500*                                                                         
090600******************************************************************        
090700*   MOVE APPROPRIATE FIELDS TO THE DETAIL HIST AREA FOR OUTPUT            
090800******************************************************************        
090900 F100-FORMAT-HIST-DATA.                                                   
091000*                                                                         
091100*    DISPLAY 'F100-FORMAT-HIST-DATA'.                                     
091200*                                                                         
091300     MOVE MRITEM-ITEM-NBR             TO MRISHS-ITM-NBR.                  
091400     MOVE MRITST-STR-NBR              TO MRISHS-STR-NBR.                  
091500     MOVE PC-1                        TO PV-HIST-SUB.                     
091600     MOVE PC-1                        TO PV-MRISHS-SUB.                   
091700*                                                                         
091800     PERFORM S600-OPEN-ITEM-HIST-CURSOR.                                  
091900     PERFORM S700-FETCH-ITEM-HIST-CURSOR.                                 
092000     MOVE 53            TO PV-HOLD-WEEK.                                  
092100*                                                                         
092200     PERFORM F200-LOAD-REPL-HIST                                          
092300             UNTIL PV-HIST-SUB GREATER THAN PC-13.                        
092400*                                                                         
092500     PERFORM S800-CLOSE-ITEM-HIST-CURSOR.                                 
092600*                                                                         
092700******************************************************************        
092800*   LOAD HISTORY OCCURANCES                                               
092900******************************************************************        
093000 F200-LOAD-REPL-HIST .                                                    
093100*                                                                         
093200*    DISPLAY 'F200-LOAD-REPL-HIST'.                                       
093300*                                                                         
093400     IF PS-ROW-NOT-FOUND                                                  
093500         MOVE ZEROES           TO  MR017-HISTBPN(PV-HIST-SUB)             
093600         MOVE ZEROES           TO  MR017-HISTCPS(PV-HIST-SUB)             
093700         MOVE ZEROES           TO  MR017-HISTMAD(PV-HIST-SUB)             
093800         MOVE ZEROES           TO  MR017-HISTOH(PV-HIST-SUB)              
093900         MOVE ZEROES           TO  MR017-HISTDD(PV-HIST-SUB)              
094000         ADD PC-1              TO  PV-HIST-SUB                            
094100         ADD PC-1              TO  PV-MRISHS-SUB                          
094200     ELSE                                                                 
094300         IF MRISHS-WK-NBR = PV-HOLD-WEEK                                  
094400             CONTINUE                                                     
094500         ELSE                                                             
094600             IF MRISHS-YR-NBR > PT-YEAR(PV-MRISHS-SUB)                    
094700                OR (MRISHS-WK-NBR > PT-WEEK(PV-MRISHS-SUB)                
094800                AND  MRISHS-YR-NBR = PT-YEAR(PV-MRISHS-SUB))              
094900                 CONTINUE                                                 
095000             ELSE                                                         
095100                 PERFORM F250-SET-CORRECT-WEEK                            
095200                     UNTIL(PT-YEAR(PV-MRISHS-SUB) = MRISHS-YR-NBR         
095300                     AND PT-WEEK(PV-MRISHS-SUB) = MRISHS-WK-NBR)          
095400                     OR PV-HIST-SUB GREATER THAN PC-13                    
095500                 IF PV-HIST-SUB GREATER THAN PC-13                        
095600                     CONTINUE                                             
095700                 ELSE                                                     
095800                     MOVE MRISHS-WK-NBR TO                                
095900                                     MR017-HISTBPN(PV-HIST-SUB)           
096000                     MOVE MRISHS-SLS-HIST-QTY                             
096100                                    TO MR017-HISTCPS(PV-HIST-SUB)         
096200                     MOVE MRISHS-MAD-HIST-QTY                             
096300                                    TO MR017-HISTMAD(PV-HIST-SUB)         
096400                     MOVE MRISHS-OH-HIST-QTY                              
096500                                    TO MR017-HISTOH(PV-HIST-SUB)          
096600                     MOVE MRISHS-DSD-HIST-QTY                             
096700                                    TO MR017-HISTDD(PV-HIST-SUB)          
096800                     MOVE MRISHS-WK-NBR TO PV-HOLD-WEEK                   
096900                     ADD PC-1              TO  PV-HIST-SUB                
097000                     ADD PC-1              TO  PV-MRISHS-SUB              
097100                 END-IF                                                   
097200             END-IF                                                       
097300         END-IF                                                           
097400     END-IF.                                                              
097500*                                                                         
097600     PERFORM S700-FETCH-ITEM-HIST-CURSOR.                                 
097700*                                                                         
097800******************************************************************        
097900*   MOVE APPROPRIATE FIELDS TO THE DETAIL USER AREA FOR OUTPUT            
098000******************************************************************        
098100 F250-SET-CORRECT-WEEK.                                                   
098200*                                                                         
098300*    DISPLAY 'F250-SET-CORRECT-WEEK'.                                     
098400*                                                                         
098500     MOVE ZEROES           TO  MR017-HISTBPN(PV-HIST-SUB)                 
098600     MOVE ZEROES           TO  MR017-HISTCPS(PV-HIST-SUB)                 
098700     MOVE ZEROES           TO  MR017-HISTMAD(PV-HIST-SUB)                 
098800     MOVE ZEROES           TO  MR017-HISTOH(PV-HIST-SUB)                  
098900     MOVE ZEROES           TO  MR017-HISTDD(PV-HIST-SUB)                  
099000                                                                          
099100     ADD PC-1                  TO  PV-HIST-SUB.                           
099200     ADD PC-1                  TO  PV-MRISHS-SUB.                         
099300*                                                                         
099400******************************************************************        
099500*   MOVE APPROPRIATE FIELDS TO THE DETAIL USER AREA FOR OUTPUT            
099600******************************************************************        
099700 G000-FORMAT-ROD-USER-AREA.                                               
099800*                                                                         
099900*    DISPLAY 'G000-FORMAT-ROD-USER-AREA'.                                 
100000*                                                                         
100100     MOVE TSK-COST-UNIT-MSRMNT        TO MR017-COST-UNIT-MSMT.            
100200     MOVE TSK-RTL-UNIT-MSRMNT         TO MR017-RTL-UNIT-MSMT.             
100300     MOVE TSK-GP-RTL-AMT              TO MR017-GR-RTL-AMT.                
100400     MOVE TSK-CUR-UNIT-RTL-AMT        TO MR017-CUR-UNIT-RTL-AMT.          
100500     MOVE TSK-GP-QTY                  TO MR017-GR-QTY.                    
100600     MOVE TSK-MERCH-DIV-CODE          TO MR017-MERCH-DIV-CODE.            
100700     MOVE TSK-DMM-NMBR                TO MR017-DMM-NBR.                   
100810     MOVE SPACES                      TO MR017-ROD-SEQ-NBR.               
100900*                                                                         
101000******************************************************************        
101100*   MOVE APPROPRIATE FIELDS TO THE HEADER USER AREA FOR OUTPUT            
101200******************************************************************        
101300 H000-FORMAT-ROH-USER-AREA.                                               
101400*                                                                         
101500*    DISPLAY 'H000-FORMAT-ROH-USER-AREA'.                                 
101600*                                                                         
101700     MOVE PV-TNOW-WN   TO MR017-H-WN.                                     
101800     MOVE PV-TNOW-DN   TO MR017-H-DN.                                     
101900*                                                                         
102000*                                                                         
102100******************************************************************        
102200*   SETS UP THE WEEKS IN THE WEEK TABLE                                   
102300******************************************************************        
102400 I100-SET-WEEK-TABLE.                                                     
102500*                                                                         
102600*    DISPLAY 'I100-SET-WEEK-TABLE'.                                       
102700*                                                                         
102800     ACCEPT CD-CPU-DATE.                                                  
102900*                                                                         
103000     MOVE CD-CPU-YEAR            TO PV-YEAR.                              
103100     MOVE CD-CPU-MO              TO PV-MO.                                
103200     MOVE CD-CPU-DY              TO PV-DY.                                
103300                                                                          
103400     MOVE PV-DATE               TO DPG52-LK-DATE-INPUT.                   
103500                                                                          
103600     MOVE SPACES                TO DPG51-INCREMENT-DECREMENT-FLAG.        
103700     MOVE PV-F2                 TO DPG51-CALENDAR-TYPE.                   
103800     SET DPG52-LK-DTE-ISO       TO TRUE.                                  
103900                                                                          
104000     PERFORM I200-CALENDAR-ROUTINE.                                       
104100     MOVE DPG56-FISCAL-YEAR-CCYY   TO PV-CURR-CCYY.                       
104200     MOVE DPG56-FISCAL-WEEK-NBR    TO PV-CURR-WEEK.                       
104300                                                                          
104400     MOVE SPACES                   TO DPG52-LK-DATE-INPUT.                
104500     MOVE PV-CURR-WEEK-YEAR        TO DPG52-LK-DATE-INPUT.                
104600     SET DPG52-LK-DTE-FISC-WEEK-CC TO TRUE.                               
104700     MOVE 1                     TO DPG51-INCR-DECR-FISCAL-WEEK-9.         
104800     SET DPG51-DECREMENT-DATE      TO TRUE.                               
104900                                                                          
105000     PERFORM I200-CALENDAR-ROUTINE.                                       
105100     MOVE DPG56-FISCAL-YEAR-CCYY   TO PV-CCYY.                            
105200     MOVE DPG56-FISCAL-WEEK-NBR    TO PV-WEEK.                            
105300                                                                          
105400     IF PV-WEEK = 53                                                      
105500         MOVE PC-52          TO   PV-WEEK                                 
105600     END-IF                                                               
105700                                                                          
105800     PERFORM I300-CALCULATE-WEEK                                          
105900             VARYING PV-MRISHS-SUB FROM 1 BY 1                            
106000             UNTIL PV-MRISHS-SUB GREATER THAN PC-13.                      
106100                                                                          
106200******************************************************************        
106300*                                                                         
106400******************************************************************        
106500 I200-CALENDAR-ROUTINE.                                                   
106600*                                                                         
106700     CALL PC-PGM-DPKUT500 USING DPG51 DPG52                               
106800                                DPG53 DPG54                               
106900                                DPG55 DPG56.                              
107000     EVALUATE TRUE                                                        
107100     WHEN DPG54-SEVERE-ERROR                                              
107200         DISPLAY 'SEVERE ERROR IN CALENDAR ROUTINE'                       
107300         DISPLAY DPG54-ERROR-MESSAGE                                      
107400         DISPLAY 'INPUT DATE: '  DPG52-LK-DATE-INPUT                      
107500         CALL 'ILBOABN0'        USING PV-ABEND-CODE                       
107600     WHEN DPG54-WARNING-ERROR                                             
107700         DISPLAY 'WARNING ERROR IN CALENDAR ROUTINE'                      
107800         DISPLAY DPG54-ERROR-MESSAGE                                      
107900     WHEN DPG54-NO-ERROR                                                  
108000         CONTINUE                                                         
108100     END-EVALUATE.                                                        
108200*                                                                         
108300******************************************************************        
108400*                                                                         
108500******************************************************************        
108600 I300-CALCULATE-WEEK.                                                     
108700                                                                          
108800     MOVE PV-WEEK                TO PT-WEEK(PV-MRISHS-SUB).               
108900     MOVE PV-CCYY                TO PT-YEAR(PV-MRISHS-SUB).               
109000                                                                          
109100     IF PV-WEEK  > 1                                                      
109200         SUBTRACT 1              FROM PV-WEEK                             
109300     ELSE                                                                 
109400         IF PV-WEEK = 1                                                   
109500             MOVE PC-52          TO   PV-WEEK                             
109600             SUBTRACT 1          FROM PV-CCYY                             
109700         END-IF                                                           
109800     END-IF.                                                              
109900*                                                                         
110000******************************************************************        
110100* THIS SECTION READS THE VSAM SYSTEM RECORD                      *        
110200******************************************************************        
110300 R000-READ-CONTROL-FILE.                                                  
110400*                                                                         
110500*    DISPLAY 'R000-READ-CONTROL-FILE'.                                    
110600*                                                                         
110700     READ IC-CONTROL-FILE INTO  SYSTEM-RECORD                             
110800                                KEY IS ICCTL-KEY.                         
110900*                                                                         
111000     IF  PV-VSAM-SUCCESSFUL                                               
111100        CONTINUE                                                          
111200     ELSE                                                                 
111300        IF PV-VSAM-NOT-FOUND                                              
111400           DISPLAY 'KEY: ' ICCTL-KEY                                      
111500           DISPLAY '** ABEND **'                                          
111600           DISPLAY '** PROGRAM    = MRKUT014'                             
111700           DISPLAY '** PARAGRAPH  = R000-READ-CONTROL-FILE'               
111800           DISPLAY '** MESSAGE    = '                                     
111900                   'RECORD NOT FOUND,STATUS: ' PV-VSAM-STATUS             
112000           MOVE +4008           TO PV-ABEND-CODE                          
112100           CALL 'ILBOABN0'      USING PV-ABEND-CODE                       
112200        ELSE                                                              
112300           DISPLAY '** ABEND **'                                          
112400           DISPLAY '** PROGRAM    = MRKUT014'                             
112500           DISPLAY '** PARAGRAPH  = R000-READ-CONTROL-FILE'               
112600           DISPLAY '** MESSAGE    = '                                     
112700                   'BAD VSAM READ, STATUS = ' PV-VSAM-STATUS              
112800           MOVE +4005           TO PV-ABEND-CODE                          
112900           CALL 'ILBOABN0'      USING PV-ABEND-CODE                       
113000        END-IF                                                            
113100     END-IF.                                                              
113200*                                                                         
113300     ADD PC-PLUS-1 TO PV-SYSTEM-INPUT-CNT.                                
113400*                                                                         
113500******************************************************************        
113600* THIS SECTION READS THE VSAM SYSTEM RECORD                      *        
113700******************************************************************        
113800 R100-READ-PARM-FILE.                                                     
113900*                                                                         
114000*    DISPLAY 'R100-READ-PARM-FILE'.                                       
114100*                                                                         
114200     READ IC-PARM-FILE INTO  PARAMETER-INPUT-RECORD.                      
114300*                                                                         
114400*                                                                         
114500 EJECT                                                                    
114600******************************************************************        
114700* THIS PARAGRAPH OPENS THE ITEM CURSOR FOR A RUN TYPE OF 3 ON THE         
114800* CONTROL FILE (SALES REVISION RUN)                                       
114900******************************************************************        
115000 S100-OPEN-ITEM-CSR.                                                      
115100*                                                                         
115200     MOVE 'S100'                   TO PGM-LOCATION.                       
115300     MOVE 'S100-OPEN-ITEM-CSR'     TO PV-ABEND-PARAGRAPH.                 
115400*    DISPLAY 'S100-OPEN-ITEM-CSR'.                                        
115500*                                                                         
115600     EXEC SQL                                                             
115700         OPEN MR_ITEM_CSR                                                 
115800     END-EXEC.                                                            
115900*                                                                         
116000     EVALUATE TRUE                                                        
116100       WHEN SQLCODE         = ZERO                                        
116200       WHEN SQLCODE         = PC-ROW-NOT-FOUND                            
116300         CONTINUE                                                         
116400       WHEN OTHER                                                         
116500         DISPLAY PV-ABEND-PARAGRAPH                                       
116600         PERFORM Z999-SQL-ERROR                                           
116700     END-EVALUATE.                                                        
116800*                                                                         
116900 EJECT                                                                    
117000*                                                                         
117100******************************************************************        
117200*  OBTAIN SEQUENCE NUMBER FOR WEEK 1                             *        
117300******************************************************************        
117400 S200-SELECT-SEQ-NBR1.                                                    
117500*                                                                         
117600     MOVE 'S200'                   TO PGM-LOCATION.                       
117700     MOVE 'S200-SELECT-SEQ-NBR1'   TO PV-ABEND-PARAGRAPH.                 
117800*                                                                         
117900     EXEC SQL                                                             
118000         SELECT   SEQ_NBR                                                 
118100           INTO   :MRISFL-SEQ-NBR                                         
118200           FROM   TMRISFL                                                 
118300          WHERE   WEEK_NBR     = :PC-1P                                   
118400     END-EXEC.                                                            
118500*                                                                         
118600     EVALUATE TRUE                                                        
118700       WHEN SQLCODE         = ZERO                                        
118800         MOVE MRISFL-SEQ-NBR TO FL-SEQ-NBR (1)                            
118900       WHEN OTHER                                                         
119000         DISPLAY PV-ABEND-PARAGRAPH                                       
119100         PERFORM Z999-SQL-ERROR                                           
119200     END-EVALUATE.                                                        
119300*                                                                         
119400******************************************************************        
119500*  OBTAIN SEQUENCE NUMBER FOR WEEK 2                             *        
119600******************************************************************        
119700 S300-SELECT-SEQ-NBR2.                                                    
119800*                                                                         
119900     MOVE 'S300'                   TO PGM-LOCATION.                       
120000     MOVE 'S300-SELECT-SEQ-NBR1'   TO PV-ABEND-PARAGRAPH.                 
120100*                                                                         
120200     EXEC SQL                                                             
120300         SELECT   SEQ_NBR                                                 
120400           INTO   :MRISFL-SEQ-NBR                                         
120500           FROM   TMRISFL                                                 
120600          WHERE   WEEK_NBR     = :PC-2P                                   
120700     END-EXEC.                                                            
120800*                                                                         
120900     EVALUATE TRUE                                                        
121000       WHEN SQLCODE         = ZERO                                        
121100         MOVE MRISFL-SEQ-NBR TO FL-SEQ-NBR (2)                            
121200       WHEN OTHER                                                         
121300         DISPLAY PV-ABEND-PARAGRAPH                                       
121400         PERFORM Z999-SQL-ERROR                                           
121500     END-EVALUATE.                                                        
121600*                                                                         
121700******************************************************************        
121800*  OBTAIN SEQUENCE NUMBER FOR WEEK 3                             *        
121900******************************************************************        
122000 S400-SELECT-SEQ-NBR3.                                                    
122100*                                                                         
122200     MOVE 'S400'                   TO PGM-LOCATION.                       
122300     MOVE 'S400-SELECT-SEQ-NBR1'   TO PV-ABEND-PARAGRAPH.                 
122400*                                                                         
122500     EXEC SQL                                                             
122600         SELECT   SEQ_NBR                                                 
122700           INTO   :MRISFL-SEQ-NBR                                         
122800           FROM   TMRISFL                                                 
122900          WHERE   WEEK_NBR     = :PC-3P                                   
123000     END-EXEC.                                                            
123100*                                                                         
123200     EVALUATE TRUE                                                        
123300       WHEN SQLCODE         = ZERO                                        
123400         MOVE MRISFL-SEQ-NBR TO FL-SEQ-NBR (3)                            
123500       WHEN OTHER                                                         
123600         DISPLAY PV-ABEND-PARAGRAPH                                       
123700         PERFORM Z999-SQL-ERROR                                           
123800     END-EVALUATE.                                                        
123900*                                                                         
124000******************************************************************        
124100*  OBTAIN SEQUENCE NUMBER FOR WEEK 4                             *        
124200******************************************************************        
124300 S500-SELECT-SEQ-NBR4.                                                    
124400*                                                                         
124500     MOVE 'S500'                   TO PGM-LOCATION.                       
124600     MOVE 'S500-SELECT-SEQ-NBR1'   TO PV-ABEND-PARAGRAPH.                 
124700*                                                                         
124800     EXEC SQL                                                             
124900         SELECT   SEQ_NBR                                                 
125000           INTO   :MRISFL-SEQ-NBR                                         
125100           FROM   TMRISFL                                                 
125200          WHERE   WEEK_NBR     = :PC-4P                                   
125300     END-EXEC.                                                            
125400*                                                                         
125500     EVALUATE TRUE                                                        
125600       WHEN SQLCODE         = ZERO                                        
125700         MOVE MRISFL-SEQ-NBR TO FL-SEQ-NBR (4)                            
125800       WHEN OTHER                                                         
125900         DISPLAY PV-ABEND-PARAGRAPH                                       
126000         PERFORM Z999-SQL-ERROR                                           
126100     END-EVALUATE.                                                        
126200*                                                                         
126300******************************************************************        
126400*  OPEN ITEM HISTORY CURSOR                                      *        
126500******************************************************************        
126600 S600-OPEN-ITEM-HIST-CURSOR.                                              
126700*                                                                         
126800*    DISPLAY 'S600-OPEN-ITEM-HIST-CURSOR'.                                
126900*                                                                         
127000     MOVE 'S600'                   TO PGM-LOCATION.                       
127100     MOVE 'S600-OPEN-ITEM-HIST-CURSOR'                                    
127200                                   TO PGM-LOCATION.                       
127300*                                                                         
127400                                                                          
127500     EXEC SQL                                                             
127600       OPEN ITEM_HIST_CSR                                                 
127700     END-EXEC.                                                            
127800                                                                          
127900     EVALUATE TRUE                                                        
128000         WHEN SQLCODE EQUAL ZERO                                          
128100         WHEN SQLCODE EQUAL PC-ROW-NOT-FOUND                              
128200             CONTINUE                                                     
128300         WHEN OTHER                                                       
128400              DISPLAY PV-ABEND-PARAGRAPH                                  
128500              PERFORM Z999-SQL-ERROR                                      
128600     END-EVALUATE.                                                        
128700*                                                                         
128800******************************************************************        
128900*  FETCH ITEM HISTORY CURSOR                                     *        
129000******************************************************************        
129100 S700-FETCH-ITEM-HIST-CURSOR.                                             
129200*                                                                         
129300*    DISPLAY 'S700-FETCH-ITEM-HIST-CURSOR'.                               
129400*                                                                         
129500     MOVE 'S700'                   TO PGM-LOCATION.                       
129600     MOVE 'S700-FETCH-ITEM-HIST-CURSOR'                                   
129700                                   TO PGM-LOCATION.                       
129800*                                                                         
129900                                                                          
130000     EXEC SQL                                                             
130100       FETCH ITEM_HIST_CSR                                                
130200        INTO                                                              
130300             :MRISHS-YR-NBR                                               
130400           , :MRISHS-WK-NBR                                               
130500           , :MRISHS-ITM-REV-ID                                           
130600           , :MRISHS-SLS-HIST-QTY                                         
130700           , :MRISHS-OH-HIST-QTY                                          
130800           , :MRISHS-MAD-HIST-QTY                                         
130900           , :MRISHS-DSD-HIST-QTY                                         
131000     END-EXEC.                                                            
131100                                                                          
131200     EVALUATE TRUE                                                        
131300         WHEN SQLCODE EQUAL ZERO                                          
131400              SET PS-ROW-FOUND     TO  TRUE                               
131500         WHEN SQLCODE EQUAL PC-ROW-NOT-FOUND                              
131600              SET PS-ROW-NOT-FOUND TO TRUE                                
131700         WHEN SQLWARN0 NOT EQUAL   TO SPACE                               
131800         WHEN SQLCODE  NOT EQUAL   TO ZERO                                
131900              PERFORM Z999-SQL-ERROR                                      
132000     END-EVALUATE.                                                        
132100*                                                                         
132200*                                                                         
132300******************************************************************        
132400*  CLOSE ITEM HISTORY CURSOR                                     *        
132500******************************************************************        
132600 S800-CLOSE-ITEM-HIST-CURSOR.                                             
132700*                                                                         
132800*    DISPLAY 'S800-CLOSE-ITEM-HIST-CURSOR'.                               
132900*                                                                         
133000     MOVE 'S800'               TO PGM-LOCATION.                           
133100     MOVE 'S800-CLOSE-ITEM-HIST-CURSOR'                                   
133200                               TO PV-ABEND-PARAGRAPH.                     
133300*                                                                         
133400     EXEC SQL                                                             
133500         CLOSE ITEM_HIST_CSR                                              
133600     END-EXEC.                                                            
133700*                                                                         
133800     EVALUATE TRUE                                                        
133900         WHEN SQLCODE EQUAL ZERO                                          
134000         WHEN SQLCODE EQUAL PC-ROW-NOT-FOUND                              
134100             CONTINUE                                                     
134200         WHEN OTHER                                                       
134300             DISPLAY PV-ABEND-PARAGRAPH                                   
134400             PERFORM Z999-SQL-ERROR                                       
134500     END-EVALUATE.                                                        
134600*                                                                         
134700******************************************************************        
134800* THIS PARAGRAPH FETCHES THE ITEM CURSOR FOR RUN TYPE OF 3       *        
134900*               (SALES REVISION RUN)                             *        
135000******************************************************************        
135100 T300-FETCH-ITEM-CURSOR.                                                  
135200*                                                                         
135300*    DISPLAY 'T300-FETCH-ITEM-CURSOR'.                                    
135400*                                                                         
135500     MOVE 'T300'                   TO PGM-LOCATION.                       
135600     MOVE 'T300-FETCH-ITEM-CURSOR'                                        
135700                                   TO PV-ABEND-PARAGRAPH.                 
135800*                                                                         
135900     EXEC SQL                                                             
136000       FETCH MR_ITEM_CSR                                                  
136100        INTO                                                              
136200              :MRITEM-ITEM-NBR,                                           
136300              :MRITEM-UCYCLE-CDE,                                         
136400              :MRITEM-TSL-NBR,                                            
136500              :MRITEM-BYPDDU-CDE,                                         
136600              :MRITEM-BYPSCL-NBR,                                         
136700              :MRITEM-FRCDDU-CDE,                                         
136800              :MRITEM-BYPZSL-CDE,                                         
136900              :MRITEM-BYPTFP-CDE,                                         
137000              :MRITEM-BYPZOH-CDE,                                         
137100              :MRITEM-BYPBEF-CDE,                                         
137200              :MRITEM-BYPAFT-CDE,                                         
137300              :MRITEM-LUMPSW-CDE,                                         
137400              :MRITEM-MINBI-FCTR,                                         
137500              :MRITEM-DDFTSW-CDE,                                         
137600              :MRITEM-RT-NBR,                                             
137700              :MRITEM-RTF-FCTR,                                           
137800              :MRITEM-ZOPSW-CDE,                                          
137900              :MRITEM-OUTLSW-CDE,                                         
138000              :MRITEM-ZSSTOCK-CDE,                                        
138100              :MRITEM-PACKSW-CDE,                                         
138200              :MRITEM-DSER-CDE,                                           
138300              :MRITEM-LT-QTY,                                             
138400              :MRITEM-IMIN-QTY,                                           
138500              :MRITEM-IMAX-QTY,                                           
138600              :MRITEM-SSADJ-PCT,                                          
138700              :MRITEM-RT-DAY-NBR,                                         
138800              :MRITEM-DDUPRM-SW,                                          
138900              :MRITEM-ORD-GROUP-SW,                                       
139210              :SKXREF-DEPT,                                               
139220              :SKXREF-SUBCLASS,                                           
139230              :SKXREF-SKU,                                                
139300              :TSK-MERCH-DIV-CODE,                                        
139400              :TSK-DMM-NMBR,                                              
139500              :TSK-VENDOR-NMBR,                                           
139600              :TSK-VNDR-IN-HSE-NMBR,                                      
139700              :TSK-VENDOR-STYLE-CODE,                                     
139800              :TSK-GROUP-CODE,                                            
139900              :TSK-SKU-DESC,                                              
140000              :TSK-SIZE-DESC,                                             
140100              :TSK-COLOR-DESC,                                            
140200              :TSK-COST-UNIT-MSRMNT,                                      
140300              :TSK-RTL-UNIT-MSRMNT,                                       
140400              :TSK-UNIT-COST-AMT,                                         
140500              :TSK-GP-RTL-AMT,                                            
140600              :TSK-CUR-UNIT-RTL-AMT,                                      
140700              :TSK-VNDR-INNR-PACK-QTY,                                    
140800              :TSK-GP-QTY,                                                
140900              :MRITST-STR-NBR,                                            
141000              :MRITST-MINDD-QTY,                                          
141100              :MRITST-PTAG-ID,                                            
141200              :MRITST-ON-ORDER-QTY,                                       
141300              :MRITST-COMSTK-QTY,                                         
141400              :MRITST-SPOQSW-CDE,                                         
141500              :MRITST-SPOQ-QTY,                                           
141600              :MRITST-FT-CDE,                                             
141700              :MRITST-OSTRAT-QTY,                                         
141800              :MRITST-CSTOCK-QTY,                                         
141900              :MRITST-MINOUTL-QTY,                                        
142000              :MRITST-MAXOUTL-QTY,                                        
142100              :MRITST-MAXOQP-PCT,                                         
142200              :MRITST-FOQ-QTY,                                            
142300              :MRITST-TMIN-QTY,                                           
142400              :MRITST-USERMIN-QTY,                                        
142500              :MRITST-USERMAX-QTY,                                        
142600              :MRITST-DD-FCTR,                                            
142700              :MRITST-DDI-FCTR,                                           
142800              :MRITST-LPP-QTY,                                            
142900              :MRITST-MADSS-QTY,                                          
143000              :MRITST-FWMAD-QTY,                                          
143100              :MRITST-TRNDP-PCT,                                          
143200              :MRITST-MSDTS-QTY,                                          
143300              :MRITST-MADTS-QTY,                                          
143400              :MRITST-LTVFACT-FCTR,                                       
143500              :MRITST-PCTZ-PCT,                                           
143600              :MRITST-MADSTAT-CDE,                                        
143700              :MRITST-DFLREG-CDE,                                         
143800              :MRITST-TSREG-CDE,                                          
143900              :MRITST-DIREG-CDE,                                          
144000              :MRITST-BYPREG-CDE,                                         
144100              :MRITST-LDD-FCTR,                                           
144200              :MRITST-LDDI-FCTR,                                          
144300              :MRITST-LFWMAD-QTY,                                         
144400              :MRITST-OUTSTAT-CDE,                                        
144500              :MRITST-LRTFCST-NBR,                                        
144600              :MRITST-ORDSTAT-CDE,                                        
144700              :MRITST-CSTKMINT1-PCT,                                      
144800              :MRITST-CSTKMINT2-PCT,                                      
144900              :MRITST-CSTKMINT3-PCT,                                      
145000              :MRITST-CSTKMINT4-PCT,                                      
145100              :MRITST-CSTKMINT5-PCT,                                      
145200              :MRITST-CSTKMINT6-PCT,                                      
145300              :MRITST-CSTKMAXT1-PCT,                                      
145400              :MRITST-CSTKMAXT2-PCT,                                      
145500              :MRITST-CSTKMAXT3-PCT,                                      
145600              :MRITST-CSTKMAXT4-PCT,                                      
145700              :MRITST-CSTKMAXT5-PCT,                                      
145800              :MRITST-CSTKMAXT6-PCT,                                      
145900              :MRITST-FTJOPF-CDE,                                         
146000              :MRISFE-SEQ-NBR,                                            
146100              :MRISFE-LFWM-QTY,                                           
146200              :MRISFE-FWM-QTY                                             
146300     END-EXEC.                                                            
146400*                                                                         
146500     EVALUATE TRUE                                                        
146600       WHEN SQLCODE         = ZERO                                        
146700         CONTINUE                                                         
146800       WHEN SQLCODE         = PC-ROW-NOT-FOUND                            
146900         PERFORM U000-CLOSE-ITEM-CSR                                      
147000         MOVE PC-Y TO PS-EOC-ITEM-CSR                                     
147100       WHEN OTHER                                                         
147200         DISPLAY PV-ABEND-PARAGRAPH                                       
147300         PERFORM Z999-SQL-ERROR                                           
147400     END-EVALUATE.                                                        
147500*                                                                         
147600 EJECT                                                                    
147700*                                                                         
147800 EJECT                                                                    
147900******************************************************************        
148000*                                                                *        
148100******************************************************************        
148200 U000-CLOSE-ITEM-CSR.                                                     
148300*                                                                         
148400     MOVE 'U000'                   TO PGM-LOCATION.                       
148500     MOVE 'U000-CLOSE-ITEM-CSR'                                           
148600                                   TO PV-ABEND-PARAGRAPH.                 
148700*                                                                         
148800     EXEC SQL                                                             
148900         CLOSE MR_ITEM_CSR                                                
149000     END-EXEC.                                                            
149100*                                                                         
149200     EVALUATE TRUE                                                        
149300       WHEN SQLCODE         = ZERO                                        
149400       WHEN SQLCODE         = PC-ROW-NOT-FOUND                            
149500         CONTINUE                                                         
149600       WHEN OTHER                                                         
149700         DISPLAY PV-ABEND-PARAGRAPH                                       
149800         PERFORM Z999-SQL-ERROR                                           
149900     END-EVALUATE.                                                        
150000*                                                                         
150100 EJECT                                                                    
150200******************************************************************        
150300*                                                                *        
150400******************************************************************        
150500 W000-WRITE-OUTPUT.                                                       
150600*                                                                         
150700     MOVE 'W000'                  TO PGM-LOCATION.                        
150800     MOVE 'W000-WRITE-SYSTEM-RECORD   '                                   
150900                                  TO PV-ABEND-PARAGRAPH.                  
151000*                                                                         
151100     WRITE TRANSFER-REC           FROM PV-OUTPUT.                         
151200*                                                                         
151300     IF (PV-VSAM-SUCCESSFUL                                               
151400     OR  PV-VSAM-NOT-FOUND)                                               
151500        CONTINUE                                                          
151600     ELSE                                                                 
151700        DISPLAY '** ABEND **'                                             
151800        DISPLAY '** PROGRAM    = MRKUT014'                                
151900        DISPLAY '** PARAGRAPH  = W000-WRITE-SYSTEM-RECORD'                
152000        DISPLAY '** MESSAGE    = '                                        
152100                'BAD VSAM WRITE,STATUS = ' PV-VSAM-STATUS                 
152200        MOVE +4005              TO PV-ABEND-CODE                          
152300        CALL 'ILBOABN0'         USING PV-ABEND-CODE                       
152400     END-IF.                                                              
152500*                                                                         
152600     ADD PC-PLUS-1 TO PV-SYSTEM-OUTPUT-CNT.                               
152700*                                                                         
152800 EJECT                                                                    
152900******************************************************************        
153000*   CLOSES FILES AND DISPLAYS MESSAGES.                          *        
153100******************************************************************        
153200 Y100-END-ROUTINE.                                                        
153300*                                                                         
153400     CLOSE  IC-CONTROL-FILE                                               
153500            IC-PARM-FILE                                                  
153600            TRANSFER-RECORD.                                              
153700*                                                                         
153800 EJECT                                                                    
153900******************************************************************        
154000*     SQL WARNING OR ERROR PROCESSING                            *        
154100*                                                                *        
154200******************************************************************        
154300                                                                          
154400 Z998-SQL-WARNING.                                                        
154500*-----------------                                                        
154600                                                                          
154700     MOVE SQLCODE    TO SQLCODE2.                                         
154800     MOVE SQLERRD(3) TO SQLERRD3.                                         
154900     DISPLAY '** ABEND **       ** = SQLWARNING'.                         
155000     DISPLAY '** PROGRAM        ** = MRKUT014'.                           
155100     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                          
155200     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                          
155300     DISPLAY '** SQLWARN0       ** = ' SQLWARN0.                          
155400     DISPLAY '** SQLWARN1       ** = ' SQLWARN1.                          
155500     DISPLAY '** SQLWARN2       ** = ' SQLWARN2.                          
155600     DISPLAY '** SQLWARN3       ** = ' SQLWARN3.                          
155700     DISPLAY '** SQLWARN4       ** = ' SQLWARN4.                          
155800     DISPLAY '** SQLWARN5       ** = ' SQLWARN5.                          
155900     DISPLAY '** SQLWARN6       ** = ' SQLWARN6.                          
156000     DISPLAY '** SQLWARN7       ** = ' SQLWARN7.                          
156100     EXEC SQL                                                             
156200         COMMIT                                                           
156300     END-EXEC.                                                            
156400     MOVE +4013 TO PV-ABEND-CODE.                                         
156500     CALL 'ILBOABN0' USING PV-ABEND-CODE.                                 
156600*                                                                         
156700 Z999-SQL-ERROR.                                                          
156800*---------------                                                          
156900                                                                          
157000     MOVE SQLCODE    TO SQLCODE2.                                         
157100     MOVE SQLERRD(3) TO SQLERRD3.                                         
157200     DISPLAY '** ABEND **       ** = SQLERROR'.                           
157300     DISPLAY '** PROGRAM        ** = MRKUT014'.                           
157400     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                          
157500     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                          
157600     DISPLAY '** SQLERRM        ** = ' SQLERRM.                           
157700     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                          
157800     MOVE +4013 TO PV-ABEND-CODE.                                         
157900     CALL 'ILBOABN0' USING PV-ABEND-CODE.                                 
158000*                                                                         
158100******************************************************************        
158200******************END OF PROGRAM   *******************************        
158300******************************************************************        
