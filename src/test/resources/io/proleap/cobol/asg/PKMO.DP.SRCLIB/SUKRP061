000100 IDENTIFICATION DIVISION.                                         00010001
000200 TITLE 'CARTON PACKED QUERY REPORT BY DC'.                        00020002
000300 PROGRAM-ID.             SUKRP061.                                00030002
000400 AUTHOR.                 SUDHAN VEERASINGH.                       00040002
000500 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00050002
000600 DATE-WRITTEN            APRIL 2011.                              00060002
000700 DATE-COMPILED.                                                   00070002
000800***************************************************************** 00080002
000900*  THIS PROGRAM WILL CREATE THE CARTON PACKED QUERY REPORT FOR  * 00090002
001000*  THE PO PASSED FROM THE CICS SCREEN.                          * 00100002
001100***************************************************************** 00110002
001200 ENVIRONMENT DIVISION.                                            00120002
001300 CONFIGURATION SECTION.                                           00130002
001400 SOURCE-COMPUTER.        IBM-3090.                                00140002
001500 OBJECT-COMPUTER.        IBM-3090.                                00150002
001600*                                                                 00160002
001700 INPUT-OUTPUT SECTION.                                            00170002
001800 FILE-CONTROL.                                                    00180002
001900*                                                                 00190002
002000     SELECT INPUT-FILE                                            00200002
002100         ASSIGN TO INP01.                                         00210002
002200*                                                                 00220002
002300     SELECT REPORT-FILE                                           00230002
002400         ASSIGN TO RPT01.                                         00240002
002500*                                                                 00250002
002600 DATA DIVISION.                                                   00260002
002700 FILE SECTION.                                                    00270002
002800*                                                                 00280002
002900 FD  INPUT-FILE                                                   00290002
003000     RECORDING MODE IS F                                          00300002
003100     LABEL RECORDS ARE STANDARD                                   00310002
003200     BLOCK CONTAINS 0 RECORDS                                     00320002
003300     RECORD CONTAINS 100 CHARACTERS.                              00330002
003400 01  INPUT-RECORD                    PIC  X(100).                 00340002
003500*                                                                 00350002
003600 FD  REPORT-FILE                                                  00360002
003700     RECORDING MODE IS F                                          00370002
003800     BLOCK CONTAINS 0  RECORDS.                                   00380002
003900 01  REPORT-RECORD                   PIC  X(132).                 00390002
004000*                                                                 00400002
004100 WORKING-STORAGE SECTION.                                         00410002
004200*                                                                 00420002
004300 01  PROGRAM-SWITCHES.                                            00430002
004400     05  PS-END-OF-INPUT-FILE-SW     PIC X(01) VALUE 'N'.         00440002
004500         88  PS-END-OF-INPUT                   VALUE 'Y'.         00450002
004600         88  PS-NOT-END-OF-INPUT               VALUE 'N'.         00460002
004700 01  PV-CURR-KEY.                                                 00470002
004800     05  PV-CURR-OPER                PIC 9(04).                   00480002
004900 01  PV-PREV-KEY.                                                 00490002
005000     05  PV-PREV-OPER                PIC 9(04).                   00500002
005100 01  PV-PROGRAM-CONSTANTS.                                        00510002
005200     05  PV-TIMESTAMP                PIC X(26).                   00520002
005300                                                                  00530002
005400     05  PC-SUKRP061                 PIC X(08) VALUE  'SUKRP061'. 00540002
005500     05  PC-REPORT-NBR               PIC X(02) VALUE '-1'.        00550002
005600 01  PV-PROGRAM-VARIABLES.                                        00560002
005700     05  PV-PAGE-COUNT               PIC S9(4) VALUE ZERO         00570002
005800                                                   COMP-3.        00580002
005900     05  PV-LINE-COUNT               PIC S9(3) VALUE ZERO         00590002
006000                                                   COMP-3.        00600002
006100     05  PV-MAX-LINE-COUNT           PIC S9(3) VALUE +40          00610002
006200                                                   COMP-3.        00620002
006300     05  PV-READ-COUNT               PIC S9(9) VALUE ZERO         00630002
006400                                                   COMP-3.        00640002
006500     05  PV-DETAIL-COUNT             PIC S9(9) VALUE ZERO         00650002
006600                                                   COMP-3.        00660002
006700     05  PV-DISP-NBR                 PIC ZZZ,ZZZ,ZZ9.             00670002
006800     05  PV-OPER-UNT-ID              PIC S9(4) VALUE ZERO         00680002
006900                                                   COMP.          00690002
007000     05  PV-TODAYS-DATE.                                          00700002
007100         10  PV-TODAYS-DATE-YY       PIC 9(02) VALUE ZERO.        00710002
007200         10  PV-TODAYS-DATE-MM       PIC 9(02) VALUE ZERO.        00720002
007300         10  PV-TODAYS-DATE-DD       PIC 9(02) VALUE ZERO.        00730002
007400     05  PV-TODAYS-TIME.                                          00740002
007500         10  PV-TODAYS-TIME-HH       PIC 9(02) VALUE ZERO.        00750002
007600         10  PV-TODAYS-TIME-MM       PIC 9(02) VALUE ZERO.        00760002
007700         10  PV-TODAYS-TIME-SS       PIC 9(02) VALUE ZERO.        00770002
007800         10  FILLER                  PIC 9(02) VALUE ZERO.        00780002
007900 01  ABEND-CODE                      PIC S9(4)  VALUE +0          00790002
008000                                                 COMP SYNC.       00800002
008100******************************************************************00810002
008200* COPY BOOK FOR CARTON PACKED QUERY REPORT                        00820002
008300******************************************************************00830002
008400*                                                                 00840002
008500     COPY DPWS004.                                                00850002
008600*                                                                 00860002
008700     COPY DPWS132O.                                               00870002
008800*                                                                 00880002
008900     COPY SURD101.                                                00890002
009000*                                                                 00900002
009100 01  HEADING-LINES.                                               00910002
009200     05  HEADING-LINE-1.                                          00920002
009300         10  FILLER                  PIC  X(57)    VALUE SPACES.  00930002
009400         10  FILLER                  PIC  X(19)    VALUE          00940002
009500             'CARTON PACKED QUERY'.                               00950002
009600         10  FILLER                  PIC  X(56)    VALUE SPACES.  00960002
009700*                                                                 00970002
009800     05  HEADING-LINE-2.                                          00980002
009900         10  FILLER                  PIC  X(05)    VALUE          00990003
010000             'DC - '.                                             01000002
010100         10  HL01-DC-NUM             PIC  Z(04)    VALUE SPACES.  01010002
010200         10  FILLER                  PIC  X(02)    VALUE SPACES.  01020002
010300         10  HL01-DC-NAME            PIC  X(20)    VALUE SPACES.  01030002
010400         10  FILLER                  PIC  X(98)    VALUE SPACES.  01040002
010500*                                                                 01050002
010600     05  HEADING-LINE-3.                                          01060002
010700         10  FILLER                  PIC  X(11)    VALUE          01070004
010800             'PO NUMBER: '.                                       01080004
010900         10  HL02-PO-NUM             PIC  Z(10)    VALUE SPACES.  01090002
011000         10  FILLER                  PIC  X(105)   VALUE SPACES.  01100002
011100*                                                                 01110002
011200     05  HEADING-LINE-4.                                          01120002
011300         10  FILLER                  PIC  X(06)    VALUE SPACES.  01130002
011400         10  FILLER                  PIC  X(06)    VALUE          01140002
011500             'CARTON'.                                            01150002
011600         10  FILLER                  PIC  X(10)    VALUE SPACES.  01160002
011700         10  FILLER                  PIC  X(04)    VALUE          01170002
011800             'OPER'.                                              01180002
011900         10  FILLER                  PIC  X(02)    VALUE SPACES.  01190002
012000         10  FILLER                  PIC  X(05)    VALUE          01200002
012100             'STORE'.                                             01210002
012200         10  FILLER                  PIC  X(06)    VALUE SPACES.  01220002
012300         10  FILLER                  PIC  X(02)    VALUE          01230002
012400             'PO'.                                                01240002
012500         10  FILLER                  PIC  X(04)    VALUE SPACES.  01250002
012600         10  FILLER                  PIC  X(04)    VALUE          01260002
012700             'RCVR'.                                              01270002
012800         10  FILLER                  PIC  X(01)    VALUE SPACES.  01280002
012900         10  FILLER                  PIC  X(04)    VALUE          01290002
013000             'LINE'.                                              01300002
013100         10  FILLER                  PIC  X(09)    VALUE SPACES.  01310002
013200         10  FILLER                  PIC  X(03)    VALUE          01320002
013300             'UPC'.                                               01330002
013400         10  FILLER                  PIC  X(07)    VALUE SPACES.  01340002
013500         10  FILLER                  PIC  X(06)    VALUE          01350002
013600             'PACKED'.                                            01360002
013700         10  FILLER                  PIC  X(12)    VALUE SPACES.  01370002
013800         10  FILLER                  PIC  X(06)    VALUE          01380002
013900             'PACKED'.                                            01390002
014000         10  FILLER                  PIC  X(14)    VALUE SPACES.  01400002
014100         10  FILLER                  PIC  X(03)    VALUE          01410002
014200             'PKD'.                                               01420002
014300         10  FILLER                  PIC  X(03)    VALUE SPACES.  01430002
014400         10  FILLER                  PIC  X(03)    VALUE          01440002
014500             'MOD'.                                               01450002
014600         10  FILLER                  PIC  X(04)    VALUE SPACES.  01460002
014700         10  FILLER                  PIC  X(05)    VALUE          01470002
014800             'OTBND'.                                             01480002
014900         10  FILLER                  PIC  X(03)    VALUE SPACES.  01490002
015000*                                                                 01500002
015100     05  HEADING-LINE-5.                                          01510002
015200         10  FILLER                  PIC  X(08)    VALUE SPACES.  01520002
015300         10  FILLER                  PIC  X(02)    VALUE          01530002
015400             'ID'.                                                01540002
015500         10  FILLER                  PIC  X(12)    VALUE SPACES.  01550002
015600         10  FILLER                  PIC  X(04)    VALUE          01560002
015700             'UNIT'.                                              01570002
015800         10  FILLER                  PIC  X(03)    VALUE SPACES.  01580002
015900         10  FILLER                  PIC  X(04)    VALUE          01590002
016000             'DEST'.                                              01600002
016100         10  FILLER                  PIC  X(04)    VALUE SPACES.  01610002
016200         10  FILLER                  PIC  X(06)    VALUE          01620002
016300             'NUMBER'.                                            01630002
016400         10  FILLER                  PIC  X(03)    VALUE SPACES.  01640002
016500         10  FILLER                  PIC  X(03)    VALUE          01650002
016600             'SEQ'.                                               01660002
016700         10  FILLER                  PIC  X(02)    VALUE SPACES.  01670002
016800         10  FILLER                  PIC  X(03)    VALUE          01680002
016900             'NBR'.                                               01690002
017000         10  FILLER                  PIC  X(08)    VALUE SPACES.  01700002
017100         10  FILLER                  PIC  X(06)    VALUE          01710002
017200             'NUMBER'.                                            01720002
017300         10  FILLER                  PIC  X(05)    VALUE SPACES.  01730002
017400         10  FILLER                  PIC  X(07)    VALUE          01740002
017500             'USER ID'.                                           01750002
017600         10  FILLER                  PIC  X(10)    VALUE SPACES.  01760002
017700         10  FILLER                  PIC  X(09)    VALUE          01770002
017800             'TIMESTAMP'.                                         01780002
017900         10  FILLER                  PIC  X(12)    VALUE SPACES.  01790002
018000         10  FILLER                  PIC  X(03)    VALUE          01800002
018100             'QTY'.                                               01810002
018200         10  FILLER                  PIC  X(03)    VALUE SPACES.  01820002
018300         10  FILLER                  PIC  X(03)    VALUE          01830002
018400             'NBR'.                                               01840002
018500         10  FILLER                  PIC  X(05)    VALUE SPACES.  01850002
018600         10  FILLER                  PIC  X(04)    VALUE          01860002
018700             'TRIP'.                                              01870002
018800*                                                                 01880002
018900 01  DETAIL-LINES.                                                01890002
019000     05  DETAIL-LINE1.                                            01900002
019100         10  DL1-CARTON-ID          PIC  Z(20)     VALUE SPACES.  01910002
019200         10  FILLER                 PIC  X(02)     VALUE SPACES.  01920002
019300         10  DL1-OPER-UNT           PIC  Z(04)     VALUE SPACES.  01930002
019400         10  FILLER                 PIC  X(02)     VALUE SPACES.  01940002
019500         10  DL1-STORE-NM           PIC  Z(05)     VALUE SPACES.  01950002
019600         10  FILLER                 PIC  X(02)     VALUE SPACES.  01960002
019700         10  DL1-PO-NUMBER          PIC  Z(09)     VALUE SPACES.  01970002
019800         10  FILLER                 PIC  X(01)     VALUE SPACES.  01980002
019900         10  DL1-RCVR-SEQ           PIC  Z(04)     VALUE SPACES.  01990002
020000         10  FILLER                 PIC  X(01)     VALUE SPACES.  02000002
020100         10  DL1-LINE-NBR           PIC  Z(04)     VALUE SPACES.  02010002
020200         10  FILLER                 PIC  X(02)     VALUE SPACES.  02020002
020300         10  DL1-UPC-NBR            PIC  Z(15)     VALUE SPACES.  02030002
020400         10  FILLER                 PIC  X(02)     VALUE SPACES.  02040002
020500         10  DL1-USER-ID            PIC  X(08)     VALUE SPACES.  02050002
020600         10  FILLER                 PIC  X(01)     VALUE SPACES.  02060002
020700         10  DL1-TIMESTAMP          PIC  X(26)     VALUE SPACES.  02070002
020800         10  FILLER                 PIC  X(02)     VALUE SPACES.  02080002
020900         10  DL1-PACK-QTY           PIC  Z(04)     VALUE SPACES.  02090002
021000         10  FILLER                 PIC  X(02)     VALUE SPACES.  02100002
021100         10  DL1-MOD-NBR            PIC  Z(04)     VALUE SPACES.  02110002
021200         10  FILLER                 PIC  X(02)     VALUE SPACES.  02120002
021300         10  DL1-TRIP-ID            PIC  Z(09)     VALUE SPACES.  02130002
021400*                                                                 02140002
021500 01  MISCELLANEOUS-LINES.                                         02150002
021600     05  BLANK-LINE.                                              02160002
021700         10  FILLER                  PIC  X(132)   VALUE SPACES.  02170002
021800     05  NO-DATA-LINE.                                            02180002
021900         10  FILLER                  PIC  X(42)    VALUE SPACES.  02190002
022000         10  FILLER                  PIC  X(47)    VALUE          02200002
022100             '**** NO INFORMATION EXISTS FOR THIS REPORT ****'.   02210002
022200         10  FILLER                  PIC  X(43)    VALUE SPACES.  02220002
022300     05  END-OF-REPORT-LINE.                                      02230002
022400         10  FILLER                  PIC  X(54)    VALUE SPACES.  02240002
022500         10  FILLER                  PIC  X(44)    VALUE          02250002
022600             '  ** END OF REPORT **                       '.      02260002
022700         10  FILLER                  PIC  X(44)    VALUE SPACES.  02270002
022800     05  PV-BLANK-LINE.                                           02280002
022900         10  FILLER                  PIC  X(132)   VALUE SPACES.  02290002
023000*                                                                 02300002
023100     EXEC SQL                                                     02310002
023200          INCLUDE XLT00010                                        02320002
023300     END-EXEC.                                                    02330002
023400*                                                                 02340002
023500     EXEC SQL                                                     02350002
023600         INCLUDE SQLCA                                            02360002
023700     END-EXEC.                                                    02370002
023800*                                                                 02380002
023900     COPY SQLCA2.                                                 02390002
024000*                                                                 02400002
024100 PROCEDURE DIVISION.                                              02410002
024200*                                                                 02420002
024300******************************************************************02430002
024400*  MAIN LINE PROCESSING - EXECUTES ALL PARAGRAPHS                 02440002
024500******************************************************************02450002
024600*                                                                 02460002
024700 0000-MAINLINE-PROCESSING.                                        02470002
024800*                                                                 02480002
024900     PERFORM 1000-INITIALIZATION.                                 02490002
025000     PERFORM 2000-PROCESS-INPUT UNTIL PS-END-OF-INPUT             02500002
025100     PERFORM 9000-END.                                            02510002
025110     DISPLAY '****** EXECUTED SUKRP061 ******'.                   02511002
025120*                                                                 02512002
025130     GOBACK.                                                      02513002
025140*                                                                 02514002
025150******************************************************************02515002
025160*  OPENS INPUT & OUTPUT FILES. READS THE FIRST RECORD FROM THE    02516002
025170*  INPUT FILE. IF END OF FILE IT WILL PRINT THE HEADERS AND       02517002
025180*  "NO DATA TO REPORT MESSAGE". IF THE FILE HAS DATA THEN IT WILL 02518002
025190*  PRINT DO THE LOCATION NAME LOOK-UP AND PRINTS THE HEADERS.     02519002
025200******************************************************************02520002
025300*                                                                 02530002
025400 1000-INITIALIZATION.                                             02540002
025500*                                                                 02550002
025600     DISPLAY '****** STARTING SUKRP061 ******'.                   02560002
025700     OPEN INPUT INPUT-FILE                                        02570002
025800          OUTPUT REPORT-FILE.                                     02580002
025900*                                                                 02590002
026000     EXEC SQL SET :PV-TIMESTAMP = CURRENT TIMESTAMP               02600002
026100     END-EXEC.                                                    02610002
026200*                                                                 02620002
026300     ACCEPT PV-TODAYS-DATE                                        02630002
026400       FROM DATE.                                                 02640002
026500*                                                                 02650002
026600     ACCEPT PV-TODAYS-TIME                                        02660002
026700       FROM TIME.                                                 02670002
026800*                                                                 02680002
026900     MOVE PV-TODAYS-DATE-MM  TO DP132O-RUN-MONTH                  02690002
027000     MOVE PV-TODAYS-DATE-DD  TO DP132O-RUN-DAY                    02700002
027100     MOVE PV-TODAYS-DATE-YY  TO DP132O-RUN-YEAR                   02710002
027200*                                                                 02720002
027300     MOVE PV-TODAYS-TIME-HH  TO DP132O-RUN-HOUR.                  02730002
027400     MOVE PV-TODAYS-TIME-MM  TO DP132O-RUN-MINUTE.                02740002
027500*                                                                 02750002
027600     MOVE PC-SUKRP061        TO DP132O-PROGRAM-NAME.              02760002
027700     MOVE PC-REPORT-NBR      TO DP132O-REPORT-NUMBER.             02770002
027800*                                                                 02780002
027900     MOVE ZERO               TO PV-PAGE-COUNT.                    02790002
028000     SET PS-NOT-END-OF-INPUT TO TRUE.                             02800002
028100     PERFORM 8000-READ-EXTRACT-FILE                               02810002
028200     MOVE PV-CURR-KEY        TO PV-PREV-KEY                       02820002
028300*                                                                 02830002
028400     IF PS-END-OF-INPUT                                           02840002
028500         ADD +1              TO PV-PAGE-COUNT                     02850002
028600         MOVE PV-PAGE-COUNT  TO DP132O-PAGE-NUMBER                02860002
028700         WRITE REPORT-RECORD                                      02870002
028800                      FROM DP132O-STANDRD-HEADER-132-COLS         02880002
028900                      AFTER ADVANCING PAGE                        02890002
029000         WRITE REPORT-RECORD                                      02900002
029100                      FROM HEADING-LINE-1                         02910002
029200                      AFTER ADVANCING 2 LINES                     02920002
029300         WRITE REPORT-RECORD                                      02930002
029400                      FROM HEADING-LINE-2                         02940002
029500                      AFTER ADVANCING 1 LINE                      02950002
029600         WRITE REPORT-RECORD                                      02960002
029700                      FROM HEADING-LINE-3                         02970002
029800                      AFTER ADVANCING 1 LINE                      02980002
029900         WRITE REPORT-RECORD                                      02990002
030000                      FROM HEADING-LINE-4                         03000002
030100                      AFTER ADVANCING 1 LINE                      03010002
030200         WRITE REPORT-RECORD                                      03020002
030300                      FROM HEADING-LINE-5                         03030002
030400                      AFTER ADVANCING 1 LINE                      03040002
030500         WRITE REPORT-RECORD                                      03050002
030600                      FROM NO-DATA-LINE                           03060002
030700                      AFTER ADVANCING 2 LINES                     03070002
030800     ELSE                                                         03080002
030900         PERFORM 7000-GET-LOC-NAME                                03090002
031000         PERFORM 2200-PAGE-BREAK                                  03100002
031100     END-IF.                                                      03110002
031200*                                                                 03120002
031300******************************************************************03130002
031400*  MAIN PROCESSING LOGIC OF THE PROGRAM                           03140002
031500******************************************************************03150002
031600*                                                                 03160002
031700 2000-PROCESS-INPUT.                                              03170002
031800     IF PV-CURR-KEY NOT = PV-PREV-KEY                             03180002
031900         MOVE PV-CURR-KEY        TO PV-PREV-KEY                   03190002
032000         PERFORM 7000-GET-LOC-NAME                                03200002
032100         PERFORM 2200-PAGE-BREAK                                  03210002
032200     END-IF                                                       03220002
032300     PERFORM 2100-PRINT-DETAIL-LINE                               03230002
032400     PERFORM 8000-READ-EXTRACT-FILE.                              03240002
032500*                                                                 03250002
032600******************************************************************03260002
032700*  PRINTS THE DETAIL LINE OF THE REPORT                           03270002
032800******************************************************************03280002
032900*                                                                 03290002
033000 2100-PRINT-DETAIL-LINE.                                          03300002
033100*                                                                 03310002
033200     MOVE SU101-SHIPT-UNT-ID       TO DL1-CARTON-ID.              03320002
033300     MOVE SU101-ORGN-LOC-NBR       TO DL1-OPER-UNT.               03330002
033400     MOVE SU101-DEST-LOC-NBR       TO DL1-STORE-NM.               03340002
033500     MOVE SU101-TRN-NBR            TO DL1-PO-NUMBER.              03350002
033600     MOVE SU101-RCVR-SEQ-NBR       TO DL1-RCVR-SEQ.               03360002
033700     MOVE SU101-TRN-LNE-NBR        TO DL1-LINE-NBR.               03370002
033800     MOVE SU101-UPC-NBR            TO DL1-UPC-NBR.                03380002
033900     MOVE SU101-PKD-BY-USR-ID      TO DL1-USER-ID.                03390002
034000     MOVE SU101-PKD-TMST           TO DL1-TIMESTAMP.              03400002
034100     MOVE SU101-PKD-QTY            TO DL1-PACK-QTY.               03410002
034200     MOVE SU101-MODU-NBR           TO DL1-MOD-NBR.                03420002
034300     MOVE SU101-OTBND-TRIP-ID      TO DL1-TRIP-ID.                03430002
034400*                                                                 03440002
034500     WRITE REPORT-RECORD                                          03450002
034600       FROM DETAIL-LINE1                                          03460002
034700         AFTER ADVANCING 1 LINE.                                  03470002
034800*                                                                 03480002
034900     ADD +1 TO PV-LINE-COUNT.                                     03490002
035000     IF PV-LINE-COUNT > PV-MAX-LINE-COUNT                         03500002
035100         PERFORM 7000-GET-LOC-NAME                                03510002
035200         PERFORM 2200-PAGE-BREAK                                  03520002
035300     END-IF.                                                      03530002
035400*                                                                 03540002
035500     ADD 1                         TO PV-DETAIL-COUNT.            03550002
035600*                                                                 03560002
035700******************************************************************03570002
035800*  FETCHES RECORDS FROM THE DETAIL CURSOR                         03580002
035900******************************************************************03590002
036000*                                                                 03600002
036100 2200-PAGE-BREAK.                                                 03610002
036200*                                                                 03620002
036300     ADD +1                  TO PV-PAGE-COUNT.                    03630002
036400     MOVE PV-PAGE-COUNT      TO DP132O-PAGE-NUMBER.               03640002
036500*                                                                 03650002
036600     WRITE REPORT-RECORD                                          03660002
036700       FROM DP132O-STANDRD-HEADER-132-COLS                        03670002
036800         AFTER ADVANCING PAGE.                                    03680002
036900*                                                                 03690002
037000     WRITE REPORT-RECORD                                          03700002
037100       FROM HEADING-LINE-1                                        03710002
037200         AFTER ADVANCING 2 LINES.                                 03720002
037300*                                                                 03730002
037400     WRITE REPORT-RECORD                                          03740002
037500       FROM HEADING-LINE-2                                        03750002
037600         AFTER ADVANCING 1 LINE.                                  03760002
037700*                                                                 03770002
037800     WRITE REPORT-RECORD                                          03780002
037900       FROM HEADING-LINE-3                                        03790002
038000         AFTER ADVANCING 1 LINE.                                  03800002
038100*                                                                 03810002
038200     WRITE REPORT-RECORD                                          03820002
038300       FROM HEADING-LINE-4                                        03830002
038400         AFTER ADVANCING 2 LINE.                                  03840002
038500*                                                                 03850002
038600     WRITE REPORT-RECORD                                          03860002
038700       FROM HEADING-LINE-5                                        03870002
038800         AFTER ADVANCING 1 LINE.                                  03880002
038900*                                                                 03890002
039000     MOVE +8                 TO PV-LINE-COUNT.                    03900002
039100     MOVE PV-CURR-KEY        TO PV-PREV-KEY.                      03910002
039200*                                                                 03920002
039300******************************************************************03930002
039400*  SELECTS THE LOCATION NAME FROM THE XLT_LOC TABLE               03940002
039500******************************************************************03950002
039600*                                                                 03960002
039700 7000-GET-LOC-NAME.                                               03970002
039800*                                                                 03980002
039900     MOVE PV-OPER-UNT-ID     TO HL01-DC-NUM                       03990002
040000*                                                                 04000002
040100     EXEC SQL                                                     04010002
040200          SELECT LOC_NM                                           04020002
040300            INTO :XLT00010-LOC-NM                                 04030002
040400            FROM XLT_LOC                                          04040002
040500           WHERE LOC_NBR = :PV-OPER-UNT-ID                        04050002
040510           WITH UR                                                04051005
040600     END-EXEC.                                                    04060002
040700*                                                                 04070002
040800     EVALUATE TRUE                                                04080002
040900         WHEN SQLCODE EQUAL ZERO                                  04090002
041000              MOVE  XLT00010-LOC-NM       TO  HL01-DC-NAME        04100002
041100*                                                                 04110002
041200         WHEN OTHER                                               04120002
041300              DISPLAY 'OPER UNIT ID : '       HL01-DC-NAME        04130002
041400              MOVE  'UNKNOWN'             TO  HL01-DC-NAME        04140002
041500              PERFORM Z999-SQL-ERROR                              04150002
041600     END-EVALUATE.                                                04160002
041700*                                                                 04170002
041800******************************************************************04180002
041900*  READS THE RECORDS FROM THE INPUT FILE                          04190002
042000******************************************************************04200002
042100*                                                                 04210002
042200 8000-READ-EXTRACT-FILE.                                          04220002
042300*                                                                 04230002
042400     READ INPUT-FILE                                              04240002
042500       INTO SU101-EXTRACT-RECORD                                  04250002
042600         AT END                                                   04260002
042700           SET PS-END-OF-INPUT TO TRUE                            04270002
042800         NOT AT END                                               04280002
042900             ADD 1                    TO PV-READ-COUNT            04290002
043000             MOVE SU101-ORGN-LOC-NBR  TO PV-CURR-OPER             04300002
043100                                         PV-OPER-UNT-ID           04310002
043200             MOVE SU101-TRN-NBR       TO HL02-PO-NUM              04320002
043300     END-READ.                                                    04330002
043400*                                                                 04340002
043500******************************************************************04350002
043600*  END OF PROCESSING - PRINTS THE "END 0F REPORT" LINE, CLOSES THE04360002
043700*  INPUT & OUTPUT FILES. DISPLAYS THE RECORD COUNTS.              04370002
043800******************************************************************04380002
043900*                                                                 04390002
044000 9000-END.                                                        04400002
044100*                                                                 04410002
044200     WRITE REPORT-RECORD                                          04420002
044300       FROM END-OF-REPORT-LINE                                    04430002
044400         AFTER ADVANCING 2 LINES.                                 04440002
044500*                                                                 04450002
044600     CLOSE INPUT-FILE                                             04460002
044700           REPORT-FILE.                                           04470002
044800*                                                                 04480002
044900     MOVE PV-READ-COUNT               TO PV-DISP-NBR              04490002
045000     DISPLAY 'RECORDS READ         = ' PV-DISP-NBR.               04500002
045100*                                                                 04510002
045200     MOVE PV-DETAIL-COUNT             TO PV-DISP-NBR              04520002
045300     DISPLAY 'DETAIL LINES PRINTED = ' PV-DISP-NBR.               04530002
045400*                                                                 04540002
045500******************************************************************04550002
045600*  SQL ERROR HANDLING PARAGRAPH                                   04560002
045700******************************************************************04570002
045800*                                                                 04580002
045900 Z999-SQL-ERROR.                                                  04590002
046000*                                                                 04600002
046100     MOVE SQLCODE    TO SQLCODE2.                                 04610002
046200     MOVE SQLERRD(3) TO SQLERRD3.                                 04620002
046300     DISPLAY '** ABEND **       ** = SQLERROR'.                   04630002
046400     DISPLAY '** PROGRAM        ** = SUKRP061'.                   04640002
046500     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  04650002
046600     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  04660002
046700     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   04670002
046800     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  04680002
046900*                                                                 04690002
047000     COPY DPPD004.                                                04700002
047100*                                                                 04710002
047200     MOVE +4003 TO  ABEND-CODE.                                   04720002
047300     CALL 'ILBOABN0' USING ABEND-CODE.                            04730002
047400*                                                                 04740002
