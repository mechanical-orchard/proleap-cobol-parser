000100******************************************************************00010048
000200 IDENTIFICATION DIVISION.                                         00020048
000300******************************************************************00030048
000400                                                                  00040048
000500 PROGRAM-ID.             RVKCS108.                                00050048
000600 AUTHOR.                 DAN HINTZ.                               00060048
000700 INSTALLATION.           KOHLS.                                   00070048
000800 DATE-WRITTEN            DECEMBER 2003.                           00080048
000900 DATE-COMPILED.                                                   00090048
001000                                                                  00100048
001100*---------------------------------------------------------------* 00110048
001200*    T108 - RTV CARRIER SHIPPING LIST SCREEN PROGRAM            * 00120048
001300*                                                               * 00130048
001400*    THIS PROGRAM GENERATES A LIST OF LISTINGS THAT ARE         * 00140048
001500*    ASSOCIATED SHIPMENTS.  THE SHIPMENTS ARE LISTED IN         * 00150048
001600*    DESCENDING ORDER BY SHIPMENT DATE.                         * 00160048
001700*                                                               * 00170048
001800*---------------------------------------------------------------* 00180048
001900* CHANGED 11/04/2021    BY JIM HUNTER      WR: CHG0263627         00190048
002000* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00200048
002100* MAKING THE CALL DYNAMIC VS STATIC.                              00210048
002200*---------------------------------------------------------------* 00220048
002300*  CHANGED 11/07/2022    BY JIM HUNTER      WR: CHG0277924        00230048
002400*                                                                 00240048
002500*  ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL       00250048
002600*  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.      00260048
002700*-----------------------------------------------------------------00270048
002800 ENVIRONMENT DIVISION.                                            00280048
002900 DATA DIVISION.                                                   00290048
003000                                                                  00300048
003100 WORKING-STORAGE SECTION.                                         00310048
003200                                                                  00320048
003300 01  PC-PROGRAM-CONSTANTS.                                        00330048
003400     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00340048
003500                                                    'RV108A  '.   00350048
003600     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00360048
003700                                                    'RVKM108 '.   00370048
003800     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00380048
003900                                                    'RVKCS108'.   00390048
004000     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00400048
004100     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00410048
004200     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00420048
004300     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +14     00430048
004400                                                    COMP SYNC.    00440048
004500     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00450048
004600                                                    COMP SYNC.    00460048
004700     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00470048
004800                                                    +1000000      00480048
004900                                                    COMP-3.       00490048
005000     05  PC-ITM-NUMBER-LENGTH           PIC S9(04)  VALUE +7      00500048
005100                                                    COMP SYNC.    00510048
005200     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00520048
005300                                                    COMP-3.       00530048
005400     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00540048
005500     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00550048
005600     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00560048
005700     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00570048
005800     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    00580048
005900     05  PC-TYPE-CODES.                                           00590048
006000         10  PC-PRIMARY                 PIC  X(02)  VALUE '01'.   00600048
006100         10  PC-ALIAS                   PIC  X(02)  VALUE '02'.   00610048
006200         10  PC-LABEL                   PIC  X(02)  VALUE '03'.   00620048
006300         10  PC-SHORTNAME               PIC  X(02)  VALUE '04'.   00630048
006400                                                                  00640048
006500     05  PC-TSYMSG-NUMBERS.                                       00650048
006600         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00660048
006700         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00670048
006800         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00680048
006900         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00690048
007000         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00700048
007100         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00710048
007200         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00720048
007300         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00730048
007400         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  00740048
007500         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00750048
007600         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00760048
007700         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00770048
007800         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00780048
007900         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00790048
008000         10  PC-TSYMSG-03189            PIC  9(05)  VALUE 03189.  00800048
008100         10  PC-TSYMSG-03239            PIC  9(05)  VALUE 03239.  00810048
008200         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  00820048
008300                                                                  00830048
008400 01  PS-PROGRAM-SWITCHES.                                         00840048
008500     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00850048
008600         88  PS-NO-ERROR                            VALUE 'Y'.    00860048
008700         88  PS-ERROR                               VALUE 'N'.    00870048
008800     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00880048
008900         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00890048
009000         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00900048
009100     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    00910048
009200         88  PS-DONE                                VALUE 'Y'.    00920048
009300         88  PS-NOT-DONE                            VALUE 'N'.    00930048
009400                                                                  00940048
009500 01  PV-PROGRAM-VARIABLES.                                        00950048
009600     05  PV-SUB                         PIC S9(04)  VALUE +0      00960048
009700                                                    COMP SYNC.    00970048
009800     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00980048
009900                                                    COMP SYNC.    00990048
010000     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01000048
010100                                                    COMP-3.       01010048
010200     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01020048
010300                                                    COMP-3.       01030048
010400     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01040048
010500                                                    COMP-3.       01050048
010600     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01060048
010700                                                    COMP-3.       01070048
010800     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01080048
010900                                                    COMP-3.       01090048
011000     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01100048
011100                                                    COMP-3.       01110048
011200     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01120048
011300                                                    COMP-3.       01130048
011400     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01140048
011500                                                    COMP SYNC.    01150048
011600     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01160048
011700                                                    COMP SYNC.    01170048
011800     05  PV-ITEM                        PIC S9(04)  VALUE +0      01180048
011900                                                    COMP SYNC.    01190048
012000     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01200048
012100                                                    COMP SYNC.    01210048
012200     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01220048
012300                                                    COMP SYNC.    01230048
012400     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01240048
012500                                                    COMP SYNC.    01250048
012600     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01260048
012700                                                    COMP SYNC.    01270048
012800     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01280048
012900                                                    COMP SYNC.    01290048
013000     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01300048
013100                                                    COMP SYNC.    01310048
013200     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01320048
013300                                                    COMP SYNC.    01330048
013400     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01340048
013500                                                    COMP SYNC.    01350048
013600     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01360048
013700                                                    COMP SYNC.    01370048
013800     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01380048
013900                                                    COMP SYNC.    01390048
014000     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01400048
014100                                                    COMP SYNC.    01410048
014200     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01420048
014300                                                    COMP SYNC.    01430048
014400     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01440048
014500                                                    COMP SYNC.    01450048
014600     05  PV-PREV-DFCT-SHIPT-ID          PIC S9(09)  VALUE +0      01460048
014700                                                    COMP SYNC.    01470048
014800                                                                  01480048
014900******************************************************************01490048
015000**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01500048
015100**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **01510048
015200**  APPLICATION-SPECIFIC COMMAREA.                              **01520048
015300******************************************************************01530048
015400 01  LQW-LIST-QUEUE-WORK-AREA.                                    01540048
015500     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01550048
015600     05  LQW-ITEM-ENTRIES               OCCURS 14 TIMES           01560048
015700                                        INDEXED BY LQW-IDX.       01570048
015800         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01580048
015900         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01590048
016000         10  LQW-SELECTED-SW            PIC  X(01).               01600048
016100             88  LQW-SELECT                         VALUE 'S'.    01610048
016200             88  LQW-DESELECT                       VALUE ' '.    01620048
016300         10  LQW-SCAC-CDE               PIC  X(04).               01630048
016400         10  LQW-DFCT-SHIPT-ID          PIC  9(09).               01640048
016500         10  LQW-TRLR-ID                PIC  X(12).               01650048
016600         10  LQW-ACTL-SHIPT-DTE         PIC  X(10).               01660048
016700         10  LQW-DFCT-ORD-ID            PIC  9(12).               01670049
016800         10  LQW-VEND-NAME              PIC  X(25).               01680048
016900                                                                  01690048
017000*---------------------------------------------------------------* 01700048
017100*  RECORD LAYOUT FOR THE PRETICKET SELECTION TEMP STORAGE QUEUE.* 01710048
017200*---------------------------------------------------------------* 01720048
017300     COPY RVWS009.                                                01730048
017400                                                                  01740048
017500*---------------------------------------------------------------* 01750048
017600*    MAP LAYOUT                                                 * 01760048
017700*---------------------------------------------------------------* 01770048
017800     COPY RVKM108.                                                01780048
017900                                                                  01790048
018000 01  MR-OCCURS-LAYOUT                   REDEFINES  RV108AO.       01800048
018100     05  FILLER                         PIC X(48).                01810048
018200     05  MR-SCROLL-AREA                 OCCURS 14 TIMES.          01820048
018300         10  MR-SELECTL                 PIC S9(04) COMP.          01830048
018400         10  MR-SELECTA                 PIC  X(01).               01840048
018500         10  MR-SELECTC                 PIC  X(01).               01850048
018600         10  MR-SELECTH                 PIC  X(01).               01860048
018700         10  MR-SELECTI                 PIC  X(01).               01870048
018800                                                                  01880048
018900         10  MR-SCACL                   PIC S9(04) COMP.          01890048
019000         10  MR-SCACA                   PIC  X(01).               01900048
019100         10  MR-SCACC                   PIC  X(01).               01910048
019200         10  MR-SCACH                   PIC  X(01).               01920048
019300         10  MR-SCAC                    PIC  X(04).               01930048
019400                                                                  01940048
019500         10  MR-SHIPMENTL               PIC S9(04) COMP.          01950048
019600         10  MR-SHIPMENTA               PIC  X(01).               01960048
019700         10  MR-SHIPMENTC               PIC  X(01).               01970048
019800         10  MR-SHIPMENTH               PIC  X(01).               01980048
019900         10  MR-SHIPMENT                PIC  X(09).               01990048
020000                                                                  02000048
020100         10  MR-TRAILERL                PIC S9(04) COMP.          02010048
020200         10  MR-TRAILERA                PIC  X(01).               02020048
020300         10  MR-TRAILERC                PIC  X(01).               02030048
020400         10  MR-TRAILERH                PIC  X(01).               02040048
020500         10  MR-TRAILER                 PIC  X(12).               02050048
020600                                                                  02060048
020700         10  MR-SHIP-DATEL              PIC S9(04) COMP.          02070048
020800         10  MR-SHIP-DATEA              PIC  X(01).               02080048
020900         10  MR-SHIP-DATEC              PIC  X(01).               02090048
021000         10  MR-SHIP-DATEH              PIC  X(01).               02100048
021100         10  MR-SHIP-DATE               PIC  X(10).               02110048
021200                                                                  02120048
021300         10  MR-LISTING-NBRL            PIC S9(04) COMP.          02130048
021400         10  MR-LISTING-NBRA            PIC  X(01).               02140048
021500         10  MR-LISTING-NBRC            PIC  X(01).               02150048
021600         10  MR-LISTING-NBRH            PIC  X(01).               02160048
021700         10  MR-LISTING-NBR             PIC  X(12).               02170049
021800                                                                  02180048
021900         10  MR-VENDOR-NAMEL            PIC S9(04) COMP.          02190048
022000         10  MR-VENDOR-NAMEA            PIC  X(01).               02200048
022100         10  MR-VENDOR-NAMEC            PIC  X(01).               02210048
022200         10  MR-VENDOR-NAMEH            PIC  X(01).               02220048
022300         10  MR-VENDOR-NAME             PIC  X(25).               02230048
022400                                                                  02240048
022500                                                                  02250048
022600*---------------------------------------------------------------* 02260048
022700*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02270048
022800*---------------------------------------------------------------* 02280048
022900     COPY DPWS015.                                                02290048
023000                                                                  02300048
023100*---------------------------------------------------------------* 02310048
023200*    FUNCTION KEYS COPYBOOK.                                    * 02320048
023300*---------------------------------------------------------------* 02330048
023400     COPY DPWS016.                                                02340048
023500                                                                  02350048
023600*---------------------------------------------------------------* 02360048
023700*    NUMERIC EDIT LAYOUT.                                       * 02370048
023800*---------------------------------------------------------------* 02380048
023900     COPY DPWS010I.                                               02390048
024000                                                                  02400048
024100*---------------------------------------------------------------* 02410048
024200*    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02420048
024300*---------------------------------------------------------------* 02430048
024400     COPY DPWS030.                                                02440048
024500     COPY DPWS930.                                                02450048
024600                                                                  02460048
024700*---------------------------------------------------------------* 02470048
024800*    STANDARD COMMAREA.                                         * 02480048
024900*---------------------------------------------------------------* 02490048
025000     COPY DPWS020.                                                02500048
025100     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02510048
025200*---------------------------------------------------------------* 02520048
025300* INTER-APPLICATION COMMAREA.                                   * 02530048
025400*   RVWS008 - OUTPUT TO THE RTV LISTING UPDATE SCREEN           * 02540048
025500*---------------------------------------------------------------* 02550048
025600         10  INTER-APPL-COMM-AREA       PIC X(200).               02560048
025700     COPY RVWS008.                                                02570048
025800*---------------------------------------------------------------* 02580048
025900*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02590048
026000*---------------------------------------------------------------* 02600048
026100         10  ASC-SPECIFIC-COMMAREA.                               02610048
026200             15  ASC-PASSED-DFCT-ORD-ID              PIC S9(12)   02620049
026300                                                     COMP-3.      02630048
026400             15  ASC-DFCT-ORD-STAT-CDE               PIC  X(01).  02640048
026500             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                02650048
026600                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  02660048
026700                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   02670048
026800                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   02680048
026900                                                                  02690048
027000                 20  ASC-ITEM-ARRAY.                              02700048
027100                     25  ASC-ITEM-ENTRIES OCCURS 14 TIMES.        02710048
027200                         30  ASC-LIST-ITEM-NUMBER                 02720048
027300                                                     PIC S9(09)   02730048
027400                                                     COMP-3.      02740048
027500                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  02750048
027600                             88  ASC-VALID-SELECT    VALUE ' '    02760048
027700                                                           'S'    02770048
027800                                                           'B'    02780048
027900                                                           'E'.   02790048
028000                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   02800048
028100                             88  ASC-TEMP-SELECT     VALUE 'S'.   02810048
028200                             88  ASC-TEMP-BEGIN      VALUE 'B'.   02820048
028300                             88  ASC-TEMP-END        VALUE 'E'.   02830048
028400                         30  ASC-SELECTED-SW         PIC  X(01).  02840048
028500                             88  ASC-NO-SELECT       VALUE ' '.   02850048
028600                             88  ASC-SELECT          VALUE 'S'.   02860048
028700                             88  ASC-BEGIN           VALUE 'B'.   02870048
028800                             88  ASC-END             VALUE 'E'.   02880048
028900                         30  ASC-SCAC-CDE            PIC  X(04).  02890048
029000                         30  ASC-DFCT-SHIPT-ID.                   02900048
029100                             35  ASC-DFCT-SHIPT-ID-N PIC  9(09).  02910048
029200                         30  ASC-TRLR-ID             PIC  X(12).  02920048
029300                         30  ASC-ACTL-SHIPT-DTE      PIC  X(10).  02930048
029400                         30  ASC-DFCT-ORD-ID         PIC  9(12).  02940049
029500                         30  ASC-VEND-NAME           PIC  X(25).  02950048
029600                                                                  02960048
029700             15  ASC-BLK-SUB                         PIC S9(04)   02970048
029800                                                          COMP    02980048
029900                                                          SYNC.   02990048
030000             15  ASC-ITEM-SUB                        PIC S9(04)   03000048
030100                                                          COMP    03010048
030200                                                          SYNC.   03020048
030300             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   03030048
030400                                                          COMP-3. 03040048
030500             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   03050048
030600                                                          COMP-3. 03060048
030700             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03070048
030800                                                          COMP-3. 03080048
030900             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   03090048
031000                                                          COMP-3. 03100048
031100             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03110048
031200                                                          COMP-3. 03120048
031300             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   03130048
031400                                                          COMP    03140048
031500                                                          SYNC.   03150048
031600             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03160048
031700                                                          COMP-3. 03170048
031800             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03180048
031900                                                          COMP-3. 03190048
032000             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03200048
032100                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   03210048
032200                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   03220048
032300             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  03230048
032400                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   03240048
032500                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   03250048
032600             15  ASC-LIST-QUEUE-NAME.                             03260048
032700                 20  ASC-LIST-TERM-ID                PIC  X(04).  03270048
032800                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   03280048
032900                                                          COMP-3. 03290048
033000                 20  ASC-LIST-SEQ                    PIC  9(01).  03300048
033100             15  ASC-SEL-QUEUE-NAME.                              03310048
033200                 20  ASC-SEL-TERM-ID                 PIC  X(04).  03320048
033300                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   03330048
033400                                                          COMP-3. 03340048
033500                 20  ASC-SEL-SEQ                     PIC  9(01).  03350048
033600                                                                  03360048
033700             15  ASC-START-ITEM-REQUEST.                          03370048
033800                 20  ASC-START-ITEM-REQUEST-N        PIC  9(07).  03380048
033900         10  FILLER                                  PIC  X(100). 03390048
034000                                                                  03400048
034100*---------------------------------------------------------------* 03410048
034200*    ABEND PROCESSING COPYBOOK.                                 * 03420048
034300*---------------------------------------------------------------* 03430048
034400     COPY DPWS013.                                                03440048
034500                                                                  03450048
034600 EJECT                                                            03460048
034700                                                                  03470048
034800*---------------------------------------------------------------* 03480048
034900*    DB2 AREA DEFECTIVE ORDER HEADER TABLE                      * 03490048
035000*---------------------------------------------------------------* 03500048
035100     EXEC SQL                                                     03510048
035200          INCLUDE TDFCTOR                                         03520048
035300     END-EXEC.                                                    03530048
035400                                                                  03540048
035500                                                                  03550048
035600*---------------------------------------------------------------* 03560048
035700*    DB2 AREA FOR DEFECTIVE ORDERS SHIPMENT TABLE               * 03570048
035800*    (RVT_DFCT_SHIPT)                                           * 03580048
035900*---------------------------------------------------------------* 03590048
036000     EXEC SQL                                                     03600048
036100          INCLUDE RVT00000                                        03610048
036200     END-EXEC.                                                    03620048
036300                                                                  03630048
036400*---------------------------------------------------------------* 03640048
036500*    DB2 AREA FOR DEFECTIVE ORDERS SHIPMENT STATUS TABLE        * 03650048
036600*    (RVT_SHIPT_STAT)                                           * 03660048
036700*---------------------------------------------------------------* 03670048
036800     EXEC SQL                                                     03680048
036900          INCLUDE RVT00001                                        03690048
037000     END-EXEC.                                                    03700048
037100                                                                  03710048
037200*---------------------------------------------------------------* 03720048
037300*    DB2 AREA FOR COMMUNICATIONS                                * 03730048
037400*---------------------------------------------------------------* 03740048
037500     EXEC SQL                                                     03750048
037600          INCLUDE SQLCA                                           03760048
037700     END-EXEC.                                                    03770048
037800                                                                  03780048
037900***************************************************************** 03790048
038000*    SHIPMENT LISTING CURSOR                                      03800048
038100***************************************************************** 03810048
038200     EXEC SQL                                                     03820048
038300         DECLARE RTV-SHIPMENT-CSR CURSOR FOR                      03830048
038400             SELECT                                               03840048
038500                    A.DFCT_SHIPT_ID                               03850048
038600                  , A.TRLR_ID                                     03860048
038700                  , A.SCAC_CDE                                    03870048
038800                  , COALESCE(CHAR(A.ACTL_SHIPT_DTE,USA), '      ')03880048
038900                  , B.DFCT_ORD_ID                                 03890048
039000                  , B.VEND_NAME                                   03900048
039100                  , B.CARR_TRKG_ID                                03910048
039200               FROM                                               03920048
039300                    RVT_DFCT_SHIPT A                              03930048
039400                  , TDFCTOR        B                              03940048
039500                  , RVT_SHIPT_STAT C                              03950048
039600              WHERE                                               03960048
039700                    A.DFCT_SHIPT_ID = B.DFCT_SHIPT_ID             03970048
039800                AND A.DFCT_SHIPT_ID = C.DFCT_SHIPT_ID             03980048
039900                AND C.SHIPT_STAT_CDE = 'S'                        03990048
040000                AND C.CRE_TMST =                                  04000048
040100                   (SELECT                                        04010048
040200                           MAX(D.CRE_TMST)                        04020048
040300                      FROM                                        04030048
040400                           RVT_SHIPT_STAT D                       04040048
040500                     WHERE                                        04050048
040600                           D.DFCT_SHIPT_ID = A.DFCT_SHIPT_ID)     04060048
040700           ORDER BY                                               04070048
040800                    A.ACTL_SHIPT_DTE DESC                         04080048
040900                  , A.DFCT_SHIPT_ID                               04090048
041000                  , B.DFCT_ORD_ID                                 04100048
041100     END-EXEC.                                                    04110048
041200                                                                  04120048
041300 LINKAGE SECTION.                                                 04130048
041400                                                                  04140048
041500 01  DFHCOMMAREA.                                                 04150048
041600     05  FILLER                         OCCURS  1 TO 4072 TIMES   04160048
041700                                        DEPENDING ON EIBCALEN.    04170048
041800         10  FILLER                     PIC X.                    04180048
041900                                                                  04190048
042000 PROCEDURE DIVISION.                                              04200048
042100                                                                  04210048
042200     INITIALIZE DP030-CICS-API-FIELDS.                            04220048
042300     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04230048
042400     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04240048
042500     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04250048
042600     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04260048
042700     MOVE LENGTH OF RV108AI        TO DP030-MAP-LENGTH (1).       04270048
042800     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04280048
042900                                                                  04290048
043000     PERFORM 0001-CALL-CICS-ARCH-API.                             04300048
043100                                                                  04310048
043200     PERFORM 1000-CONTROL-PROCESSING                              04320048
043300                                                                  04330048
043400     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04340048
043500                                                                  04350048
043600     PERFORM 0001-CALL-CICS-ARCH-API.                             04360048
043700                                                                  04370048
043800******************************************************************04380048
043900**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **04390048
044000**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **04400048
044100******************************************************************04410048
044200 0001-CALL-CICS-ARCH-API.                                         04420048
044300                                                                  04430048
044400     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04440048
044500                                    DFHCOMMAREA                   04450048
044600                                    DP030-CICS-API-FIELDS         04460048
044700                                    DP020-STANDARD-COMMAREA       04470048
044800                                    RV108AI.                      04480048
044900                                                                  04490048
045000     IF DP030-RC-CALL-SUCCESSFUL                                  04500048
045100         CONTINUE                                                 04510048
045200     ELSE                                                         04520048
045300         SET DP013-NO-ROLLBACK                                    04530048
045400             DP013-XCTL-DISPLAY-RESTART                           04540048
045500             DP013-CICS-ABEND      TO TRUE                        04550048
045600         MOVE '0001-CALL-CICS-ARCH-API'                           04560048
045700                                   TO DP013-PARAGRAPH             04570048
045800         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04580048
045900-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04590048
046000         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      04600048
046100         PERFORM DP013-0000-PROCESS-ABEND.                        04610048
046200                                                                  04620048
046300*----------------------------------------------------------------*04630048
046400* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *04640048
046500* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *04650048
046600*----------------------------------------------------------------*04660048
046700 1000-CONTROL-PROCESSING.                                         04670048
046800                                                                  04680048
046900     EVALUATE TRUE                                                04690048
047000         WHEN DP020-NEXT-ACT-INITIAL                              04700048
047100             INITIALIZE ASC-SPECIFIC-COMMAREA                     04710048
047200                                                                  04720048
047300** FETCH THE LISTING NUMBER AND STATUS CODE FROM THE INTER APPL   04730048
047400** INTER APPL COMMAREA                                            04740048
047500             MOVE RV008-DFCT-ORD-ID     TO ASC-PASSED-DFCT-ORD-ID 04750048
047600             MOVE RV008-DFCT-ORD-STAT-CDE                         04760048
047700                                        TO ASC-DFCT-ORD-STAT-CDE  04770048
047800             MOVE EIBTRMID              TO ASC-LIST-TERM-ID       04780048
047900                                           ASC-SEL-TERM-ID        04790048
048000             MOVE DP020-SRC-TASK-NUMBER TO ASC-LIST-TASK-NUMBER   04800048
048100                                           ASC-SEL-TASK-NUMBER    04810048
048200             MOVE PC-LIST-QUEUE-SEQ     TO ASC-LIST-SEQ           04820048
048300             MOVE PC-SEL-QUEUE-SEQ      TO ASC-SEL-SEQ            04830048
048400                                                                  04840048
048500             SET PS-COMMAREA-VALID      TO TRUE                   04850048
048600             MOVE SPACE                 TO ASC-START-ITEM-REQUEST 04860048
048700                                                                  04870048
048800             PERFORM 4000-BUILD-INITIAL-PANEL                     04880048
048900                                                                  04890048
049000         WHEN DP020-NEXT-ACT-READ-MAP                             04900048
049100             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         04910048
049200                                                                  04920048
049300             PERFORM 2000-PROCESS-PANEL                           04930048
049400                                                                  04940048
049500         WHEN OTHER                                               04950048
049600             SET DP013-LOGIC-ABEND                                04960048
049700                 DP013-NO-ROLLBACK TO TRUE                        04970048
049800             MOVE '1000-CONTROL-PROCESSING' TO DP013-PARAGRAPH    04980048
049900             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    04990048
050000                                          TO DP013-MESSAGE-TEXT(1)05000048
050100             PERFORM DP013-0000-PROCESS-ABEND                     05010048
050200     END-EVALUATE.                                                05020048
050300                                                                  05030048
050400                                                                  05040048
050500*----------------------------------------------------------------*05050048
050600* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *05060048
050700* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *05070048
050800* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *05080048
050900* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *05090048
051000* FUNCTION KEYS CAN GET THIS FAR.                                *05100048
051100*----------------------------------------------------------------*05110048
051200 2000-PROCESS-PANEL.                                              05120048
051300                                                                  05130048
051400     EVALUATE TRUE                                                05140048
051500         WHEN DP020-SRC-AID = DP016-CLEAR                         05150048
051600              MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL               05160048
051700                                                                  05170048
051800              PERFORM 3000-EDIT-DATA-IN-COMMAREA                  05180048
051900                                                                  05190048
052000              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                05200048
052100                                                                  05210048
052200         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    05220048
052300              PERFORM 2050-DELETE-LIST-QUEUE                      05230048
052400                                                                  05240048
052500              PERFORM 4000-BUILD-INITIAL-PANEL                    05250048
052600                                                                  05260048
052700         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    05270048
052800              PERFORM 2140-DESELECT-ALL-ITEMS                     05280048
052900                                                                  05290048
053000              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                05300048
053100                                                                  05310048
053200         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  05320048
053300              PERFORM 2150-SELECT-ALL-ITEMS                       05330048
053400                                                                  05340048
053500              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                05350048
053600                                                                  05360048
053700         WHEN OTHER                                               05370048
053800              PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                05380048
053900                                                                  05390048
054000              PERFORM 3000-EDIT-DATA-IN-COMMAREA                  05400048
054100                                                                  05410048
054200              IF PS-NO-ERROR                                      05420048
054300                  SET DP030-CONTINUE-GO TO TRUE                   05430048
054400                                                                  05440048
054500                  PERFORM 2100-CHECK-FUNCTION-KEY                 05450048
054600              ELSE                                                05460048
054700                  SET DP030-OVERRIDE-GO TO TRUE                   05470048
054800              END-IF                                              05480048
054900     END-EVALUATE.                                                05490048
055000                                                                  05500048
055100*----------------------------------------------------------------*05510048
055200*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *05520048
055300*----------------------------------------------------------------*05530048
055400 2050-DELETE-LIST-QUEUE.                                          05540048
055500                                                                  05550048
055600     EXEC CICS                                                    05560048
055700         DELETEQ TS                                               05570048
055800             QUEUE (ASC-LIST-QUEUE-NAME)                          05580048
055900             RESP  (PV-CICS-RESP)                                 05590048
056000     END-EXEC.                                                    05600048
056100                                                                  05610048
056200     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       05620048
056300        (PV-CICS-RESP = DFHRESP(QIDERR))                          05630048
056400         CONTINUE                                                 05640048
056500     ELSE                                                         05650048
056600         SET DP013-CICS-ABEND                                     05660048
056700             DP013-NO-ROLLBACK TO TRUE                            05670048
056800                                                                  05680048
056900         MOVE '2050-DELETE-LIST-QUEUE'                            05690048
057000                                   TO DP013-PARAGRAPH             05700048
057100         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    05710048
057200                                   TO DP013-MESSAGE-TEXT (1)      05720048
057300         PERFORM DP013-0000-PROCESS-ABEND                         05730048
057400     END-IF.                                                      05740048
057500                                                                  05750048
057600     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  05760048
057700                                                                  05770048
057800*----------------------------------------------------------------*05780048
057900* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*05790048
058000* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *05800048
058100* CICS ARCHITECTURE API.                                         *05810048
058200*----------------------------------------------------------------*05820048
058300 2100-CHECK-FUNCTION-KEY.                                         05830048
058400                                                                  05840048
058500     EVALUATE TRUE                                                05850048
058600* **INCLUDE KEY WAS PRESSED **                                    05860048
058700*                                                                 05870048
058800*   NO MORE THAN ONE SHIPMENT CAN BE SELECTED.  IF MORE THAN ONE  05880048
058900*   IS SELECTED, DISPLAY AN ERROR MESSAGE ON THE SCREEN.          05890048
059000*   IF THE LISTING STATUS IS APPROVED ('A'), DO NOT ALLOW ANY     05900048
059100*   STATEMENTS TO BE SELECTED.  DISPLAY A MESSAGE ON THE SCREEN.  05910048
059200         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)               05920048
059300              IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO             05930048
059400                  IF  ASC-NUMBER-OF-SELECTED-ITEMS > 1            05940048
059500                      SET DP030-OVERRIDE-GO                       05950048
059600                          DP020-MSG-WARNING TO TRUE               05960048
059700                      MOVE PC-TSYMSG-03189  TO DP020-MSG-NUMBER   05970048
059800                      PERFORM 4400-MOVE-COMMAREA-TO-SCREEN        05980048
059900                  ELSE                                            05990048
060000                      IF  ASC-DFCT-ORD-STAT-CDE = 'A'             06000048
060100                          SET DP030-OVERRIDE-GO                   06010048
060200                              DP020-MSG-WARNING                   06020048
060300                                        TO TRUE                   06030048
060400                          MOVE PC-TSYMSG-03239                    06040048
060500                                        TO DP020-MSG-NUMBER       06050048
060600                          PERFORM 4400-MOVE-COMMAREA-TO-SCREEN    06060048
060700                      ELSE                                        06070048
060800                          INITIALIZE RV008-INTER-APPL-COMMAREA    06080048
060900                          MOVE ASC-PASSED-DFCT-ORD-ID             06090048
061000                                        TO RV008-DFCT-ORD-ID      06100048
061100                          MOVE ASC-DFCT-ORD-STAT-CDE              06110048
061200                                        TO RV008-DFCT-ORD-STAT-CDE06120048
061300                          PERFORM 5000-PREPARE-SEL-QUEUE          06130048
061400                      END-IF                                      06140048
061500                  END-IF                                          06150048
061600              ELSE                                                06160048
061700                  SET DP030-OVERRIDE-GO                           06170048
061800                      DP020-MSG-WARNING TO TRUE                   06180048
061900                  MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER       06190048
062000                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            06200048
062100             END-IF                                               06210048
062200                                                                  06220048
062300         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  06230048
062400             MOVE +1               TO PV-TOP-ITEM                 06240048
062500                                                                  06250048
062600             PERFORM 3200-RESET-ATTRIBUTES                        06260048
062700                                                                  06270048
062800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06280048
062900                                                                  06290048
063000         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   06300048
063100             PERFORM 2110-BROWSE-BACKWARD                         06310048
063200                                                                  06320048
063300             PERFORM 3200-RESET-ATTRIBUTES                        06330048
063400                                                                  06340048
063500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06350048
063600                                                                  06360048
063700         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   06370048
063800             PERFORM 2120-BROWSE-FORWARD                          06380048
063900                                                                  06390048
064000             PERFORM 3200-RESET-ATTRIBUTES                        06400048
064100                                                                  06410048
064200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06420048
064300                                                                  06430048
064400         WHEN DP020-SRC-AID = DP016-ENTER                         06440048
064500             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   06450048
064600             IF PS-ERROR                                          06460048
064700                 CONTINUE                                         06470048
064800             ELSE                                                 06480048
064900                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06490048
065000             END-IF                                               06500048
065100                                                                  06510048
065200         WHEN OTHER                                               06520048
065300             SET DP013-NO-ROLLBACK                                06530048
065400                 DP013-XCTL-DISPLAY-RESTART                       06540048
065500                 DP013-CICS-ABEND  TO TRUE                        06550048
065600             MOVE '2100-CHECK-FUNCTION-KEY'                       06560048
065700                                   TO DP013-PARAGRAPH             06570048
065800             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      06580048
065900                                   TO DP013-MESSAGE-TEXT (1)      06590048
066000             PERFORM DP013-0000-PROCESS-ABEND                     06600048
066100     END-EVALUATE.                                                06610048
066200                                                                  06620048
066300*----------------------------------------------------------------*06630048
066400*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *06640048
066500*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *06650048
066600*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *06660048
066700*    MESSAGE.                                                    *06670048
066800*----------------------------------------------------------------*06680048
066900 2110-BROWSE-BACKWARD.                                            06690048
067000                                                                  06700048
067100     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    06710048
067200         GIVING PV-TOP-ITEM.                                      06720048
067300                                                                  06730048
067400     IF  ((PV-TOP-ITEM < +1)                                      06740048
067500       OR (PV-TOP-ITEM = +1))                                     06750048
067600         MOVE +1                   TO PV-TOP-ITEM                 06760048
067700*        -- TOP OF LIST --                                        06770048
067800         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            06780048
067900         SET DP020-MSG-INFORMATIONAL TO TRUE                      06790048
068000     END-IF.                                                      06800048
068100                                                                  06810048
068200*----------------------------------------------------------------*06820048
068300*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *06830048
068400*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *06840048
068500*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *06850048
068600*----------------------------------------------------------------*06860048
068700 2120-BROWSE-FORWARD.                                             06870048
068800                                                                  06880048
068900     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              06890048
069000         GIVING PV-TOP-ITEM.                                      06900048
069100     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   06910048
069200         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            06920048
069300                                   TO PV-TOP-ITEM                 06930048
069400*        -- BOTTOM OF LIST --                                     06940048
069500         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            06950048
069600         SET DP020-MSG-INFORMATIONAL                              06960048
069700                                   TO TRUE                        06970048
069800     ELSE                                                         06980048
069900         COMPUTE PV-BOTTOM-ITEM =                                 06990048
070000             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 07000048
070100         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            07010048
070200*            -- BOTTOM OF LIST --                                 07020048
070300             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            07030048
070400             SET DP020-MSG-INFORMATIONAL                          07040048
070500                                   TO TRUE                        07050048
070600         END-IF                                                   07060048
070700     END-IF.                                                      07070048
070800                                                                  07080048
070900*----------------------------------------------------------------*07090048
071000*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *07100048
071100*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *07110048
071200*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *07120048
071300*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *07130048
071400*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *07140048
071500*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *07150048
071600*----------------------------------------------------------------*07160048
071700 2130-CHECK-FOR-JUMP-BROWSE.                                      07170048
071800                                                                  07180048
071900     SET PS-NO-ERROR               TO TRUE.                       07190048
072000     IF (ASC-START-ITEM-REQUEST = SPACE)                          07200048
072100         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07210048
072200                                   TO PV-TOP-ITEM                 07220048
072300     ELSE                                                         07230048
072400         MOVE ASC-START-ITEM-REQUEST                              07240048
072500                                   TO DP010I-UNEDITED-FIELD       07250048
072600         MOVE PC-ITM-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       07260048
072700         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     07270048
072800         SET DP010I-NEGATIVE-NOT-ALLOWED                          07280048
072900                                   TO TRUE                        07290048
073000         CALL DP010I-NUMERIC-EDIT-ROUTINE                         07300048
073100              USING DP010I-NUMERIC-EDIT-AREA                      07310048
073200                                                                  07320048
073300         IF  NOT DP010I-ERROR-DETECTED                            07330048
073400             MOVE DP010I-NUMERIC-FIELD                            07340048
073500                                   TO  ASC-START-ITEM-REQUEST-N   07350048
073600             IF  ASC-START-ITEM-REQUEST-N > ZERO                  07360048
073700                 IF  ASC-START-ITEM-REQUEST-N >                   07370048
073800                                          ASC-NUMBER-OF-ITEMS-READ07380048
073900                     MOVE SPACE TO ASC-START-ITEM-REQUEST         07390048
074000                     COMPUTE PV-TOP-ITEM =                        07400048
074100                             ASC-NUMBER-OF-ITEMS-READ             07410048
074200                             - PC-ITEMS-PER-PANEL + 1             07420048
074300                     IF  PV-TOP-ITEM < +1                         07430048
074400                         MOVE +1   TO PV-TOP-ITEM                 07440048
074500                         MOVE PC-TSYMSG-00070                     07450048
074600                                   TO DP020-MSG-NUMBER            07460048
074700                         SET DP020-MSG-INFORMATIONAL              07470048
074800                                   TO TRUE                        07480048
074900                     END-IF                                       07490048
075000                 ELSE                                             07500048
075100                     MOVE ASC-START-ITEM-REQUEST-N                07510048
075200                                   TO PV-TOP-ITEM                 07520048
075300                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      07530048
075400                     COMPUTE PV-BOTTOM-ITEM =                     07540048
075500                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     07550048
075600                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ07560048
075700*                        -- BOTTOM OF LIST --                     07570048
075800                         MOVE PC-TSYMSG-00070                     07580048
075900                                   TO DP020-MSG-NUMBER            07590048
076000                         SET DP020-MSG-INFORMATIONAL              07600048
076100                                   TO TRUE                        07610048
076200                     END-IF                                       07620048
076300                 END-IF                                           07630048
076400             ELSE                                                 07640048
076500*                --- VALUE OUT OF RANGE ----                      07650048
076600                 MOVE PC-TSYMSG-00101                             07660048
076700                                   TO DP020-MSG-NUMBER            07670048
076800                 MOVE -1           TO ASTRTITL                    07680048
076900                 SET DP030-SET-CURSOR-APPL-1                      07690048
077000                                   TO TRUE                        07700048
077100                 MOVE DP015-REVERSE                               07710048
077200                                   TO ASTRTITH                    07720048
077300                 MOVE DP015-RED    TO ASTRTITC                    07730048
077400                 MOVE DP015-UNP-NUM-BRT-MDT                       07740048
077500                                   TO ASTRTITA                    07750048
077600                 SET DP020-MSG-FATAL                              07760048
077700                                   TO TRUE                        07770048
077800                 SET PS-ERROR      TO TRUE                        07780048
077900             END-IF                                               07790048
078000                                                                  07800048
078100         ELSE                                                     07810048
078200             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            07820048
078300             MOVE -1               TO ASTRTITL                    07830048
078400             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07840048
078500             MOVE DP015-REVERSE    TO ASTRTITH                    07850048
078600             MOVE DP015-RED        TO ASTRTITC                    07860048
078700             MOVE DP015-UNP-NUM-BRT-MDT                           07870048
078800                                   TO ASTRTITA                    07880048
078900             SET DP020-MSG-FATAL   TO TRUE                        07890048
079000             SET PS-ERROR          TO TRUE                        07900048
079100         END-IF                                                   07910048
079200     END-IF.                                                      07920048
079300                                                                  07930048
079400*----------------------------------------------------------------*07940048
079500*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *07950048
079600*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *07960048
079700*----------------------------------------------------------------*07970048
079800 2140-DESELECT-ALL-ITEMS.                                         07980048
079900                                                                  07990048
080000     MOVE +1                       TO ASC-BLK-SUB.                08000048
080100                                                                  08010048
080200     PERFORM 2141-CLEAR-SELECTED-INDS                             08020048
080300         VARYING ASC-ITEM-SUB                                     08030048
080400         FROM 1 BY 1                                              08040048
080500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08050048
080600                                                                  08060048
080700     ADD +1                        TO ASC-BLK-SUB.                08070048
080800                                                                  08080048
080900     PERFORM 2141-CLEAR-SELECTED-INDS                             08090048
081000         VARYING ASC-ITEM-SUB                                     08100048
081100         FROM 1 BY 1                                              08110048
081200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08120048
081300                                                                  08130048
081400     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               08140048
081500                                   TO PV-LIST-ITEM-NUMBER.        08150048
081600                                                                  08160048
081700     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            08170048
081800         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    08180048
081900                                                                  08190048
082000     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     08200048
082100        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      08210048
082200         MOVE +1                   TO ASC-BLK-SUB                 08220048
082300                                                                  08230048
082400         PERFORM 5100-WRITE-TEMP-STORAGE                          08240048
082500                                                                  08250048
082600         MOVE +1                   TO PV-BLOCK-NUMBER             08260048
082700                                                                  08270048
082800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         08280048
082900             PV-FIRST-BLOCK-IN-ARRAY - 1                          08290048
083000                                                                  08300048
083100         PERFORM                                                  08310048
083200             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       08320048
083300                                                                  08330048
083400             PERFORM 4410-READ-TEMP-STORAGE                       08340048
083500                                                                  08350048
083600             PERFORM 2141-CLEAR-SELECTED-INDS                     08360048
083700                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 08370048
083800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          08380048
083900                                                                  08390048
084000             PERFORM 5100-WRITE-TEMP-STORAGE                      08400048
084100                                                                  08410048
084200             ADD +1                TO PV-BLOCK-NUMBER             08420048
084300                                                                  08430048
084400         END-PERFORM                                              08440048
084500                                                                  08450048
084600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         08460048
084700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     08470048
084800                                                                  08480048
084900         PERFORM                                                  08490048
085000             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       08500048
085100                   ASC-HIGHEST-BLOCK-WRITTEN                      08510048
085200                                                                  08520048
085300             MOVE PV-NEXT-BLOCK-IN-ARRAY                          08530048
085400                                   TO PV-BLOCK-NUMBER             08540048
085500                                                                  08550048
085600             PERFORM 4410-READ-TEMP-STORAGE                       08560048
085700                                                                  08570048
085800             PERFORM 2141-CLEAR-SELECTED-INDS                     08580048
085900                 VARYING ASC-ITEM-SUB                             08590048
086000                 FROM 1 BY 1                                      08600048
086100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          08610048
086200                                                                  08620048
086300             PERFORM 5100-WRITE-TEMP-STORAGE                      08630048
086400                                                                  08640048
086500             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      08650048
086600                                                                  08660048
086700         END-PERFORM                                              08670048
086800                                                                  08680048
086900         MOVE PV-FIRST-BLOCK-IN-ARRAY                             08690048
087000                                   TO PV-BLOCK-NUMBER             08700048
087100                                                                  08710048
087200         PERFORM 4410-READ-TEMP-STORAGE                           08720048
087300     END-IF.                                                      08730048
087400                                                                  08740048
087500                                                                  08750048
087600     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 08760048
087700     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.08770048
087800     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  08780048
087900                                                                  08790048
088000     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        08800048
088100                                                                  08810048
088200*----------------------------------------------------------------*08820048
088300*    MARK EACH ITEM AS BEING NOT SELECTED.                       *08830048
088400*----------------------------------------------------------------*08840048
088500 2141-CLEAR-SELECTED-INDS.                                        08850048
088600                                                                  08860048
088700     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           08870048
088800             NOT EQUAL ZERO                                       08880048
088900         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          08890048
089000             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          08900048
089100                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    08910048
089200                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  08920048
089300                                   TO TRUE                        08930048
089400         END-IF                                                   08940048
089500     END-IF.                                                      08950048
089600                                                                  08960048
089700*----------------------------------------------------------------*08970048
089800*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *08980048
089900*  FOR ALL ITEMS.                                                *08990048
090000*----------------------------------------------------------------*09000048
090100 2150-SELECT-ALL-ITEMS.                                           09010048
090200                                                                  09020048
090300     MOVE +1                       TO ASC-BLK-SUB.                09030048
090400                                                                  09040048
090500     PERFORM 2151-SET-SELECTED-INDS                               09050048
090600         VARYING ASC-ITEM-SUB                                     09060048
090700         FROM 1 BY 1                                              09070048
090800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09080048
090900                                                                  09090048
091000     ADD +1                        TO ASC-BLK-SUB.                09100048
091100                                                                  09110048
091200     PERFORM 2151-SET-SELECTED-INDS                               09120048
091300         VARYING ASC-ITEM-SUB                                     09130048
091400         FROM 1 BY 1                                              09140048
091500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09150048
091600                                                                  09160048
091700     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               09170048
091800                                   TO PV-LIST-ITEM-NUMBER.        09180048
091900                                                                  09190048
092000     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            09200048
092100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    09210048
092200                                                                  09220048
092300     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     09230048
092400        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    09240048
092500         MOVE +1                   TO ASC-BLK-SUB                 09250048
092600                                                                  09260048
092700         PERFORM 5100-WRITE-TEMP-STORAGE                          09270048
092800                                                                  09280048
092900         MOVE +1                   TO PV-BLOCK-NUMBER             09290048
093000                                                                  09300048
093100         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         09310048
093200             PV-FIRST-BLOCK-IN-ARRAY - 1                          09320048
093300                                                                  09330048
093400         PERFORM                                                  09340048
093500             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       09350048
093600                                                                  09360048
093700             PERFORM 4410-READ-TEMP-STORAGE                       09370048
093800                                                                  09380048
093900             PERFORM 2151-SET-SELECTED-INDS                       09390048
094000                 VARYING ASC-ITEM-SUB                             09400048
094100                 FROM 1 BY 1                                      09410048
094200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09420048
094300                                                                  09430048
094400             PERFORM 5100-WRITE-TEMP-STORAGE                      09440048
094500                                                                  09450048
094600             ADD +1                TO PV-BLOCK-NUMBER             09460048
094700                                                                  09470048
094800         END-PERFORM                                              09480048
094900                                                                  09490048
095000         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         09500048
095100             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     09510048
095200                                                                  09520048
095300         PERFORM                                                  09530048
095400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       09540048
095500                   ASC-HIGHEST-BLOCK-WRITTEN                      09550048
095600                                                                  09560048
095700             MOVE PV-NEXT-BLOCK-IN-ARRAY                          09570048
095800                                   TO PV-BLOCK-NUMBER             09580048
095900                                                                  09590048
096000             PERFORM 4410-READ-TEMP-STORAGE                       09600048
096100                                                                  09610048
096200             PERFORM 2151-SET-SELECTED-INDS                       09620048
096300                 VARYING ASC-ITEM-SUB                             09630048
096400                 FROM 1 BY 1                                      09640048
096500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09650048
096600                                                                  09660048
096700             PERFORM 5100-WRITE-TEMP-STORAGE                      09670048
096800                                                                  09680048
096900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      09690048
097000                                                                  09700048
097100         END-PERFORM                                              09710048
097200                                                                  09720048
097300         MOVE PV-FIRST-BLOCK-IN-ARRAY                             09730048
097400                                   TO PV-BLOCK-NUMBER             09740048
097500                                                                  09750048
097600         PERFORM 4410-READ-TEMP-STORAGE                           09760048
097700     END-IF.                                                      09770048
097800                                                                  09780048
097900                                                                  09790048
098000     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             09800048
098100                       ASC-NUMBER-OF-SELECTED-ITEMS.              09810048
098200                                                                  09820048
098300     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        09830048
098400                                                                  09840048
098500*----------------------------------------------------------------*09850048
098600*    MARK EACH ITEM AS BEING SELECTED.                           *09860048
098700*----------------------------------------------------------------*09870048
098800 2151-SET-SELECTED-INDS.                                          09880048
098900                                                                  09890048
099000     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           09900048
099100             NOT EQUAL ZERO                                       09910048
099200         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             09920048
099300             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             09930048
099400                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        09940048
099500                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  09950048
099600                               TO  TRUE                           09960048
099700         END-IF                                                   09970048
099800     END-IF.                                                      09980048
099900                                                                  09990048
100000******************************************************************10000048
100100** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **10010048
100200** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **10020048
100300******************************************************************10030048
100400 2200-MOVE-SCREEN-TO-COMMAREA.                                    10040048
100500                                                                  10050048
100600     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             10060048
100700     MOVE +1                       TO PV-SUB.                     10070048
100800                                                                  10080048
100900     PERFORM 3100-SET-SUBSCRIPTS.                                 10090048
101000     IF  ASTRTITL > ZERO                                          10100048
101100         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          10110048
101200     ELSE                                                         10120048
101300         IF  ASTRTITF = DP015-ERASE-EOF                           10130048
101400             INITIALIZE ASC-START-ITEM-REQUEST                    10140048
101500         END-IF                                                   10150048
101600     END-IF.                                                      10160048
101700     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          10170048
101800         VARYING PV-SUB                                           10180048
101900         FROM 1 BY 1                                              10190048
102000         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      10200048
102100                                                                  10210048
102200******************************************************************10220048
102300** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**10230048
102400******************************************************************10240048
102500 2210-MOVE-LINES-TO-COMMAREA.                                     10250048
102600                                                                  10260048
102700     IF  MR-SELECTL (PV-SUB) > ZERO                               10270048
102800         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             10280048
102900         MOVE MR-SELECTI (PV-SUB)                                 10290048
103000                                   TO ASC-TEMP-SELECTED-SW        10300048
103100                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      10310048
103200     ELSE                                                         10320048
103300         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                10330048
103400                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     10340048
103500                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        10350048
103600                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      10360048
103700         END-IF                                                   10370048
103800     END-IF.                                                      10380048
103900     ADD +1                        TO ASC-ITEM-SUB.               10390048
104000     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        10400048
104100         ADD +1                    TO ASC-BLK-SUB                 10410048
104200         MOVE +1                   TO ASC-ITEM-SUB                10420048
104300     END-IF.                                                      10430048
104400                                                                  10440048
104500******************************************************************10450048
104600** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **10460048
104700** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **10470048
104800******************************************************************10480048
104900 3000-EDIT-DATA-IN-COMMAREA.                                      10490048
105000                                                                  10500048
105100     SET PS-NO-ERROR               TO TRUE.                       10510048
105200     PERFORM 3200-RESET-ATTRIBUTES.                               10520048
105300     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     10530048
105400**                                                                10540048
105500* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              10550048
105600* EDITTING IS DONE FROM THE BOTTOM UP.                            10560048
105700**                                                                10570048
105800     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       10580048
105900         ASC-ITEMS-DISPLAYED - 1.                                 10590048
106000     PERFORM 3100-SET-SUBSCRIPTS.                                 10600048
106100     PERFORM 3300-EDIT-SELECTIONS                                 10610048
106200         VARYING PV-SUB                                           10620048
106300         FROM PV-SUB BY -1                                        10630048
106400         UNTIL PV-SUB < +1                                        10640048
106500                                                                  10650048
106600     IF  PS-NO-ERROR                                              10660048
106700         PERFORM 3400-CHECK-RANGE-SEQUENCE                        10670048
106800     END-IF.                                                      10680048
106900                                                                  10690048
107000     IF  ((PS-NO-ERROR)                                           10700048
107100       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   10710048
107200       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    10720048
107300             PERFORM 3500-MARK-RANGE-AS-SELECTED                  10730048
107400     END-IF.                                                      10740048
107500                                                                  10750048
107600*----------------------------------------------------------------*10760048
107700*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *10770048
107800*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*10780048
107900*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *10790048
108000*                                                                *10800048
108100*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *10810048
108200*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *10820048
108300*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *10830048
108400*    US IN THE 2ND BLOCK OF THE ARRAY.                           *10840048
108500*----------------------------------------------------------------*10850048
108600 3100-SET-SUBSCRIPTS.                                             10860048
108700                                                                  10870048
108800     COMPUTE ASC-ITEM-SUB =                                       10880048
108900         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        10890048
109000                                                                  10900048
109100     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         10910048
109200         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            10920048
109300                                                                  10930048
109400         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               10940048
109500     ELSE                                                         10950048
109600         MOVE +1                     TO ASC-BLK-SUB               10960048
109700     END-IF.                                                      10970048
109800                                                                  10980048
109900******************************************************************10990048
110000** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **11000048
110100** THE "SELECT" FIELD IS THE ONLY ENTERABLE FIELD ON THE MAP.   **11010048
110200** WHEN THERE ARE MULTIPLE LISTINGS FOR A SHIPMENT, WE ONLY     **11020048
110300** DISPLAY THE SHIPPING INFORMATION ONCE.  WE WANT TO DISPLAY   **11030048
110400** THE "SELECT" FIELD ON THE LINES WHERE WE DISPLAY THE SHIPPING**11040048
110500** INFORMATION.                                                 **11050048
110600******************************************************************11060048
110700 3200-RESET-ATTRIBUTES.                                           11070048
110800                                                                  11080048
110900     MOVE DP015-UNP-ALP-NOR-OFF TO ASTRTITA.                      11090048
111000     MOVE DP015-GREEN           TO ASTRTITC.                      11100048
111100     MOVE DP015-UNDERLINE       TO ASTRTITH.                      11110048
111200                                                                  11120048
111300     IF DP020-NEXT-ACT-RETURN OR                                  11130048
111400        DP020-NEXT-ACT-READ-MAP                                   11140048
111500         PERFORM VARYING PV-SUB  FROM 1 BY 1                      11150048
111600                 UNTIL   PV-SUB > ASC-ITEMS-DISPLAYED             11160048
111700                  IF  MR-SHIPMENT (PV-SUB) = SPACES               11170048
111800                      MOVE DP015-ASK-DRK-OFF                      11180048
111900                                       TO MR-SELECTA (PV-SUB)     11190048
112000                  ELSE                                            11200048
112100                      MOVE DP015-UNP-ALP-NOR-OFF                  11210048
112200                                       TO MR-SELECTA (PV-SUB)     11220048
112300                      MOVE DP015-GREEN TO MR-SELECTC (PV-SUB)     11230048
112400                      MOVE DP015-UNDERLINE                        11240048
112500                                       TO MR-SELECTH (PV-SUB)     11250048
112600                  END-IF                                          11260048
112700         END-PERFORM                                              11270048
112800     ELSE                                                         11280048
112900         PERFORM VARYING PV-SUB  FROM 1 BY 1                      11290048
113000                 UNTIL   PV-SUB > PC-ITEMS-PER-PANEL              11300048
113100                  MOVE DP015-UNP-ALP-NOR-OFF                      11310048
113200                                       TO MR-SELECTA (PV-SUB)     11320048
113300                  MOVE DP015-GREEN     TO MR-SELECTC (PV-SUB)     11330048
113400                  MOVE DP015-UNDERLINE TO MR-SELECTH (PV-SUB)     11340048
113500         END-PERFORM.                                             11350048
113600                                                                  11360048
113700******************************************************************11370048
113800** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **11380048
113900** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **11390048
114000** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **11400048
114100** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **11410048
114200******************************************************************11420048
114300 3300-EDIT-SELECTIONS.                                            11430048
114400                                                                  11440048
114500     EVALUATE TRUE                                                11450048
114600         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     11460048
114700             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         11470048
114800                 CONTINUE                                         11480048
114900         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         11490048
115000             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        11500048
115100                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   11510048
115200                 MOVE ASC-TEMP-SELECTED-SW                        11520048
115300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11530048
115400                                TO ASC-SELECTED-SW                11540048
115500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11550048
115600             END-IF                                               11560048
115700         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     11570048
115800                 = SPACE                                          11580048
115900             EVALUATE TRUE                                        11590048
116000                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       11600048
116100                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS11610048
116200                     MOVE SPACE TO ASC-SELECTED-SW                11620048
116300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11630048
116400                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        11640048
116500                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    11650048
116600                     MOVE SPACE TO ASC-SELECTED-SW                11660048
116700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11670048
116800                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          11680048
116900                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      11690048
117000                     MOVE SPACE TO ASC-SELECTED-SW                11700048
117100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11710048
117200             END-EVALUATE                                         11720048
117300         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           11730048
117400             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            11740048
117500                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    11750048
117600             END-IF                                               11760048
117700             PERFORM 3310-EDIT-RANGE                              11770048
117800         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             11780048
117900             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            11790048
118000                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    11800048
118100             END-IF                                               11810048
118200             PERFORM 3310-EDIT-RANGE                              11820048
118300         WHEN OTHER                                               11830048
118400             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           11840048
118500             SET DP020-MSG-FATAL    TO TRUE                       11850048
118600             MOVE -1                TO MR-SELECTL (PV-SUB)        11860048
118700             SET DP030-SET-CURSOR-APPL-1                          11870048
118800                                    TO TRUE                       11880048
118900             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        11890048
119000             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        11900048
119100             SET PS-ERROR TO TRUE                                 11910048
119200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            11920048
119300                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     11930048
119400                 MOVE SPACE         TO ASC-SELECTED-SW            11940048
119500                                        (ASC-BLK-SUB ASC-ITEM-SUB)11950048
119600             END-IF                                               11960048
119700     END-EVALUATE.                                                11970048
119800                                                                  11980048
119900     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 11990048
120000     SUBTRACT +1 FROM ASC-ITEM-SUB.                               12000048
120100     IF  ASC-ITEM-SUB < 1                                         12010048
120200         SUBTRACT +1 FROM ASC-BLK-SUB                             12020048
120300         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                12030048
120400     END-IF.                                                      12040048
120500                                                                  12050048
120600******************************************************************12060048
120700** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **12070048
120800** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **12080048
120900** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**12090048
121000** THE ENDING.                                                  **12100048
121100******************************************************************12110048
121200 3310-EDIT-RANGE.                                                 12120048
121300                                                                  12130048
121400     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                12140048
121500         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   12150048
121600             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)12160048
121700                                   TO ASC-SELECTED-SW             12170048
121800                                        (ASC-BLK-SUB ASC-ITEM-SUB)12180048
121900             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 12190048
122000         ELSE                                                     12200048
122100             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     12210048
122200                 CONTINUE                                         12220048
122300             ELSE                                                 12230048
122400*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        12240048
122500                 MOVE PC-TSYMSG-00054                             12250048
122600                                   TO DP020-MSG-NUMBER            12260048
122700                 SET DP020-MSG-FATAL                              12270048
122800                                   TO TRUE                        12280048
122900                 MOVE -1           TO MR-SELECTL (PV-SUB)         12290048
123000                 SET DP030-SET-CURSOR-APPL-1                      12300048
123100                                   TO TRUE                        12310048
123200                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         12320048
123300                 MOVE DP015-UNDERLINE                             12330048
123400                                   TO MR-SELECTH (PV-SUB)         12340048
123500                 SET PS-ERROR      TO TRUE                        12350048
123600             END-IF                                               12360048
123700         END-IF                                                   12370048
123800     ELSE                                                         12380048
123900         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     12390048
124000             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 12400048
124100                                   TO ASC-SELECTED-SW             12410048
124200                                     (ASC-BLK-SUB ASC-ITEM-SUB)   12420048
124300             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   12430048
124400         ELSE                                                     12440048
124500             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       12450048
124600                 CONTINUE                                         12460048
124700             ELSE                                                 12470048
124800*                -- ONLY ONE END-OF-RANGE ALLOWED --              12480048
124900                 MOVE PC-TSYMSG-00055                             12490048
125000                                   TO DP020-MSG-NUMBER            12500048
125100                 SET DP020-MSG-FATAL                              12510048
125200                                   TO TRUE                        12520048
125300                 MOVE -1           TO MR-SELECTL (PV-SUB)         12530048
125400                 SET DP030-SET-CURSOR-APPL-1                      12540048
125500                                   TO TRUE                        12550048
125600                 SET PS-ERROR      TO TRUE                        12560048
125700             END-IF                                               12570048
125800         END-IF                                                   12580048
125900     END-IF.                                                      12590048
126000                                                                  12600048
126100******************************************************************12610048
126200** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **12620048
126300** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **12630048
126400******************************************************************12640048
126500 3400-CHECK-RANGE-SEQUENCE.                                       12650048
126600                                                                  12660048
126700     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       12670048
126800       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      12680048
126900       AND  ASC-START-OF-SELECTED-RANGE >                         12690048
127000                                         ASC-END-OF-SELECTED-RANGE12700048
127100*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                12710048
127200         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 12720048
127300         SET DP020-MSG-FATAL TO TRUE                              12730048
127400         SET PS-ERROR TO TRUE                                     12740048
127500         PERFORM 3410-POSITION-AT-ERROR                           12750048
127600     END-IF.                                                      12760048
127700                                                                  12770048
127800******************************************************************12780048
127900** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **12790048
128000** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **12800048
128100** SHOULD BE POSITIONED ON A RANGE ERROR.                       **12810048
128200******************************************************************12820048
128300 3410-POSITION-AT-ERROR.                                          12830048
128400                                                                  12840048
128500     SET DP030-SET-CURSOR-APPL-1                                  12850048
128600                                   TO TRUE.                       12860048
128700     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 12870048
128800                    - PV-TOP-ITEM + 1.                            12880048
128900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      12890048
129000         CONTINUE                                                 12900048
129100     ELSE                                                         12910048
129200         MOVE -1                   TO MR-SELECTL (PV-SUB)         12920048
129300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         12930048
129400         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         12940048
129500     END-IF.                                                      12950048
129600                                                                  12960048
129700     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   12970048
129800                    - PV-TOP-ITEM + 1.                            12980048
129900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      12990048
130000         CONTINUE                                                 13000048
130100     ELSE                                                         13010048
130200         MOVE -1                   TO MR-SELECTL (PV-SUB)         13020048
130300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         13030048
130400         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         13040048
130500     END-IF.                                                      13050048
130600                                                                  13060048
130700*----------------------------------------------------------------*13070048
130800*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *13080048
130900*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *13090048
131000*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *13100048
131100*----------------------------------------------------------------*13110048
131200 3500-MARK-RANGE-AS-SELECTED.                                     13120048
131300                                                                  13130048
131400     MOVE +1                       TO  ASC-BLK-SUB.               13140048
131500     PERFORM 3510-MARK-SELECTED-INDS                              13150048
131600         VARYING ASC-ITEM-SUB                                     13160048
131700         FROM 1 BY 1                                              13170048
131800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13180048
131900                                                                  13190048
132000     ADD +1                        TO ASC-BLK-SUB.                13200048
132100     PERFORM 3510-MARK-SELECTED-INDS                              13210048
132200         VARYING ASC-ITEM-SUB                                     13220048
132300         FROM 1 BY 1                                              13230048
132400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13240048
132500                                                                  13250048
132600     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               13260048
132700                                   TO  PV-LIST-ITEM-NUMBER.       13270048
132800     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            13280048
132900         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         13290048
133000               PC-ITEMS-PER-PANEL).                               13300048
133100                                                                  13310048
133200     MOVE ASC-START-OF-SELECTED-RANGE                             13320048
133300                                   TO PV-START-OF-SELECTED-RANGE. 13330048
133400     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            13340048
133500         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  13350048
133600               PC-ITEMS-PER-PANEL).                               13360048
133700                                                                  13370048
133800     MOVE ASC-END-OF-SELECTED-RANGE                               13380048
133900                                   TO  PV-END-OF-SELECTED-RANGE.  13390048
134000     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             13400048
134100         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    13410048
134200               PC-ITEMS-PER-PANEL).                               13420048
134300     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             13430048
134400         PV-FIRST-BLOCK-IN-ARRAY + 1.                             13440048
134500                                                                  13450048
134600     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    13460048
134700        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        13470048
134800         MOVE +1                   TO ASC-BLK-SUB                 13480048
134900         PERFORM 5100-WRITE-TEMP-STORAGE                          13490048
135000         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         13500048
135100             PV-FIRST-BLOCK-IN-ARRAY - 1                          13510048
135200                                                                  13520048
135300         PERFORM                                                  13530048
135400             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      13540048
135500                   PV-PREV-BLOCK-IN-ARRAY                         13550048
135600             MOVE PV-FIRST-BLOCK-IN-RANGE                         13560048
135700                                   TO PV-BLOCK-NUMBER             13570048
135800             PERFORM 4410-READ-TEMP-STORAGE                       13580048
135900             PERFORM 3510-MARK-SELECTED-INDS                      13590048
136000                 VARYING ASC-ITEM-SUB                             13600048
136100                 FROM 1 BY 1                                      13610048
136200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13620048
136300             PERFORM 5100-WRITE-TEMP-STORAGE                      13630048
136400             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     13640048
136500         END-PERFORM                                              13650048
136600                                                                  13660048
136700         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         13670048
136800             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     13680048
136900         PERFORM                                                  13690048
137000             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       13700048
137100                   PV-LAST-BLOCK-IN-RANGE                         13710048
137200             MOVE PV-NEXT-BLOCK-IN-ARRAY                          13720048
137300                                   TO PV-BLOCK-NUMBER             13730048
137400             PERFORM 4410-READ-TEMP-STORAGE                       13740048
137500             PERFORM 3510-MARK-SELECTED-INDS                      13750048
137600                 VARYING ASC-ITEM-SUB                             13760048
137700                 FROM 1 BY 1                                      13770048
137800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13780048
137900             PERFORM 5100-WRITE-TEMP-STORAGE                      13790048
138000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      13800048
138100         END-PERFORM                                              13810048
138200                                                                  13820048
138300         MOVE PV-FIRST-BLOCK-IN-ARRAY                             13830048
138400                                   TO PV-BLOCK-NUMBER             13840048
138500         PERFORM 4410-READ-TEMP-STORAGE                           13850048
138600     END-IF.                                                      13860048
138700                                                                  13870048
138800     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 13880048
138900                                      ASC-END-OF-SELECTED-RANGE.  13890048
139000                                                                  13900048
139100*----------------------------------------------------------------*13910048
139200* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *13920048
139300*----------------------------------------------------------------*13930048
139400 3510-MARK-SELECTED-INDS.                                         13940048
139500                                                                  13950048
139600     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         13960048
139700                                ASC-ITEM-SUB) >                   13970048
139800         ASC-START-OF-SELECTED-RANGE)                             13980048
139900     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         13990048
140000                                ASC-ITEM-SUB) =                   14000048
140100         ASC-START-OF-SELECTED-RANGE)                             14010048
140200                                                                  14020048
140300         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     14030048
140400                                    ASC-ITEM-SUB) <               14040048
140500             ASC-END-OF-SELECTED-RANGE)                           14050048
140600         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     14060048
140700                                    ASC-ITEM-SUB) =               14070048
140800             ASC-END-OF-SELECTED-RANGE)                           14080048
140900                                                                  14090048
141000             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          14100048
141100                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   14110048
141200                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   14120048
141300                               TO TRUE                            14130048
141400                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              14140048
141500                               TO TRUE                            14150048
141600                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    14160048
141700             END-IF                                               14170048
141800         END-IF                                                   14180048
141900     END-IF.                                                      14190048
142000                                                                  14200048
142100*----------------------------------------------------------------*14210048
142200*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *14220048
142300*    INITIALIZE ALL COUNTERS AND FLAGS.                          *14230048
142400*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *14240048
142500*    DISPLAY THE PANEL TO USER.                                  *14250048
142600*----------------------------------------------------------------*14260048
142700 4000-BUILD-INITIAL-PANEL.                                        14270048
142800                                                                  14280048
142900     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            14290048
143000                                 ASC-BLOCK-ENTRIES (2).           14300048
143100     MOVE +1                 TO ASC-BLK-SUB.                      14310048
143200     SET ASC-ITEMS-LEFT-ON-DB                                     14320048
143300                             TO TRUE.                             14330048
143400                                                                  14340048
143500     MOVE +0                 TO ASC-ITEM-SUB                      14350048
143600                                ASC-NUMBER-OF-ITEMS-READ          14360048
143700                                ASC-NUMBER-OF-SELECTED-ITEMS      14370048
143800                                ASC-HIGHEST-BLOCK-WRITTEN         14380048
143900                                ASC-START-OF-SELECTED-RANGE       14390048
144000                                ASC-END-OF-SELECTED-RANGE         14400048
144100                                ASC-ITEM-AT-TOP-OF-PANEL.         14410048
144200                                                                  14420048
144300     PERFORM 4010-OPEN-CURSOR.                                    14430048
144400                                                                  14440048
144500     PERFORM 4200-READ-ITEMS-FROM-DB.                             14450048
144600                                                                  14460048
144700     PERFORM 4020-CLOSE-CURSOR.                                   14470048
144800                                                                  14480048
144900     MOVE +1                   TO  PV-TOP-ITEM.                   14490048
145000                                                                  14500048
145100     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          14510048
145200         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    14520048
145300         SET DP020-MSG-FATAL   TO  TRUE                           14530048
145400         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               14540048
145500     ELSE                                                         14550048
145600         MOVE -1               TO MR-SELECTL (1)                  14560048
145700         SET DP030-SET-CURSOR-APPL-1                              14570048
145800                               TO TRUE                            14580048
145900         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     14590048
146000     END-IF.                                                      14600048
146100                                                                  14610048
146200                                                                  14620048
146300*----------------------------------------------------------------*14630048
146400* OPEN  THE VENDOR   CURSOR.                                     *14640048
146500*----------------------------------------------------------------*14650048
146600 4010-OPEN-CURSOR.                                                14660048
146700                                                                  14670048
146800     PERFORM                                                      14680048
146900         WITH TEST AFTER                                          14690048
147000         VARYING PV-RETRY-COUNTER                                 14700048
147100         FROM 1 BY 1                                              14710048
147200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               14720048
147300                   OR (SQLCODE = ZERO))                           14730048
147400             MOVE 'CURSOR: RTV-SHIPMENT-CSR '                     14740048
147500                               TO DP013-MESSAGE-TEXT (2)          14750048
147600             EXEC SQL                                             14760048
147700                  OPEN RTV-SHIPMENT-CSR                           14770048
147800             END-EXEC                                             14780048
147900                                                                  14790048
148000         EVALUATE TRUE                                            14800048
148100             WHEN SQLCODE = ZERO                                  14810048
148200             WHEN SQLCODE = -904                                  14820048
148300             WHEN SQLCODE = -913                                  14830048
148400                 CONTINUE                                         14840048
148500             WHEN SQLWARN0 NOT = SPACES                           14850048
148600             WHEN SQLCODE < ZERO                                  14860048
148700             WHEN SQLCODE > ZERO                                  14870048
148800                 MOVE '4010-OPEN-CURSOR'                          14880048
148900                                   TO DP013-PARAGRAPH             14890048
149000                 MOVE 'OPEN VENDOR CURSOR - '                     14900048
149100                                   TO DP013-MESSAGE-TEXT (1)      14910048
149200                 MOVE SQLCA        TO DP013-SQLCA                 14920048
149300                 MOVE 'RVT_DFCT_SHIPT'                            14930048
149400                                   TO DP013-DB2-TABLE-NAME (1)    14940048
149500                 MOVE 'TDFCTOR '   TO DP013-DB2-TABLE-NAME (2)    14950048
149600                 MOVE 'RVT_SHIPT_STAT'                            14960048
149700                                   TO DP013-DB2-TABLE-NAME (3)    14970048
149800                 SET DP013-DB2-ABEND                              14980048
149900                     DP013-XCTL-DISPLAY-RESTART TO TRUE           14990048
150000                 PERFORM DP013-0000-PROCESS-ABEND                 15000048
150100         END-EVALUATE                                             15010048
150200     END-PERFORM.                                                 15020048
150300                                                                  15030048
150400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        15040048
150500         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             15050048
150600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   15060048
150700                                   TO DP013-MESSAGE-TEXT (1)      15070048
150800         MOVE SQLCA                TO DP013-SQLCA                 15080048
150900         MOVE 'RVT_DFCT_SHIPT'     TO DP013-DB2-TABLE-NAME (1)    15090048
151000         MOVE 'TDFCTOR '           TO DP013-DB2-TABLE-NAME (2)    15100048
151100         MOVE 'RVT_SHIPT_STAT'     TO DP013-DB2-TABLE-NAME (3)    15110048
151200         SET DP013-DB2-ABEND                                      15120048
151300             DP013-XCTL-DISPLAY-RESTART                           15130048
151400                                   TO TRUE                        15140048
151500         PERFORM DP013-0000-PROCESS-ABEND                         15150048
151600     END-IF.                                                      15160048
151700                                                                  15170048
151800*----------------------------------------------------------------*15180048
151900*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *15190048
152000*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *15200048
152100*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *15210048
152200*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *15220048
152300*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *15230048
152400*----------------------------------------------------------------*15240048
152500 4200-READ-ITEMS-FROM-DB.                                         15250048
152600                                                                  15260048
152700     PERFORM VARYING PV-READ-COUNT  FROM 1 BY 1                   15270048
152800             UNTIL   PV-READ-COUNT > PC-MAX-ITEMS OR              15280048
152900                     ASC-NO-ITEMS-LEFT-ON-DB                      15290048
153000                                                                  15300048
153100             PERFORM 4210-FETCH                                   15310048
153200                                                                  15320048
153300             IF ASC-ITEMS-LEFT-ON-DB                              15330048
153400                IF ASC-ITEM-SUB < PC-ITEMS-PER-PANEL              15340048
153500                    CONTINUE                                      15350048
153600                ELSE                                              15360048
153700                    ADD  +1 TO ASC-BLK-SUB                        15370048
153800                    MOVE +0 TO ASC-ITEM-SUB                       15380048
153900                    IF ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY       15390048
154000                        MOVE +1 TO ASC-BLK-SUB                    15400048
154100                        SET ASC-BLOCK-MODIFIED (1) TO TRUE        15410048
154200                                                                  15420048
154300                        PERFORM 5100-WRITE-TEMP-STORAGE           15430048
154400                                                                  15440048
154500                        MOVE ASC-BLOCK-ENTRIES                    15450048
154600                                          (PC-MAX-BLOCKS-IN-ARRAY)15460048
154700                                TO ASC-BLOCK-ENTRIES (ASC-BLK-SUB)15470048
154800                        ADD +1 TO ASC-BLK-SUB                     15480048
154900                        INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)15490048
155000                        SET ASC-BLOCK-NOT-MODIFIED   (ASC-BLK-SUB)15500048
155100                                                           TO TRUE15510048
155200                    END-IF                                        15520048
155300                END-IF                                            15530048
155400                PERFORM 4220-MOVE-DB-ITEMS                        15540048
155500             END-IF                                               15550048
155600     END-PERFORM.                                                 15560048
155700                                                                  15570048
155800     IF ASC-NUMBER-OF-ITEMS-READ > ZERO                           15580048
155900         MOVE +1 TO ASC-BLK-SUB                                   15590048
156000                                                                  15600048
156100         PERFORM 5100-WRITE-TEMP-STORAGE                          15610048
156200                                                                  15620048
156300         ADD  +1 TO ASC-BLK-SUB                                   15630048
156400                                                                  15640048
156500         PERFORM 5100-WRITE-TEMP-STORAGE                          15650048
156600                                                                  15660048
156700         MOVE 1  TO ASC-BLK-SUB                                   15670048
156800                    PV-BLOCK-NUMBER                               15680048
156900                                                                  15690048
157000         PERFORM 4410-READ-TEMP-STORAGE                           15700048
157100                                                                  15710048
157200         IF ASC-HIGHEST-BLOCK-WRITTEN > 1                         15720048
157300             MOVE 2 TO ASC-BLK-SUB                                15730048
157400                       PV-BLOCK-NUMBER                            15740048
157500                                                                  15750048
157600             PERFORM 4410-READ-TEMP-STORAGE                       15760048
157700         END-IF                                                   15770048
157800     END-IF.                                                      15780048
157900                                                                  15790048
158000 4210-FETCH.                                                      15800048
158100                                                                  15810048
158200     INITIALIZE DCLRVT00000                                       15820048
158300                DCLRVT00001                                       15830048
158400                DCLTDFCTOR.                                       15840048
158500                                                                  15850048
158600                                                                  15860048
158700     EXEC SQL                                                     15870048
158800          FETCH RTV-SHIPMENT-CSR                                  15880048
158900          INTO  :RVT00000-DFCT-SHIPT-ID                           15890048
159000               ,:RVT00000-TRLR-ID                                 15900048
159100               ,:RVT00000-SCAC-CDE                                15910048
159200               ,:RVT00000-ACTL-SHIPT-DTE                          15920048
159300               ,:DFCTOR-DFCT-ORD-ID                               15930048
159400               ,:DFCTOR-VEND-NAME                                 15940048
159500     END-EXEC                                                     15950048
159600                                                                  15960048
159700     EVALUATE TRUE                                                15970048
159800         WHEN SQLCODE = ZERO                                      15980048
159900         WHEN SQLCODE = +100                                      15990048
160000              CONTINUE                                            16000048
160100         WHEN SQLWARN0 NOT = SPACE                                16010048
160200         WHEN SQLCODE NOT = ZERO                                  16020048
160300              MOVE '4210-FETCH       '                            16030048
160400                               TO DP013-PARAGRAPH                 16040048
160500              MOVE 'FETCH TICKET TYPE CURSOR '                    16050048
160600                               TO DP013-MESSAGE-TEXT (1)          16060048
160700              MOVE 'RVT_DFCT_SHIPT'                               16070048
160800                               TO DP013-DB2-TABLE-NAME (1)        16080048
160900              MOVE 'TDFCTOR '  TO DP013-DB2-TABLE-NAME (2)        16090048
161000              MOVE 'RVT_SHIPT_STAT'                               16100048
161100                               TO DP013-DB2-TABLE-NAME (3)        16110048
161200              MOVE SQLCA       TO DP013-SQLCA                     16120048
161300              SET DP013-DB2-ABEND                                 16130048
161400                               TO TRUE                            16140048
161500              PERFORM DP013-0000-PROCESS-ABEND                    16150048
161600     END-EVALUATE.                                                16160048
161700                                                                  16170048
161800     IF  SQLCODE EQUAL +100                                       16180048
161900         SET ASC-NO-ITEMS-LEFT-ON-DB                              16190048
162000                                   TO TRUE                        16200048
162100     END-IF.                                                      16210048
162200                                                                  16220048
162300                                                                  16230048
162400 4220-MOVE-DB-ITEMS.                                              16240048
162500                                                                  16250048
162600     ADD +1                         TO ASC-ITEM-SUB               16260048
162700                                       ASC-NUMBER-OF-ITEMS-READ.  16270048
162800     MOVE ASC-NUMBER-OF-ITEMS-READ  TO ASC-LIST-ITEM-NUMBER       16280048
162900                                       (ASC-BLK-SUB ASC-ITEM-SUB).16290048
163000                                                                  16300048
163100* IF THERE ARE MULTIPLE LISTINGS ASSOCIATED WITH A SHIPMENT, THE  16310048
163200* SHIPPING INFORMATION (SCAC, SHIPMENT ID, TRAILER ID, AND SHIP   16320048
163300* DATE) SHOULD ONLY BE DISPLAYED ONCE.  THE SHIPPING INFORMATION  16330048
163400* WILL BE DISPLAYED IN THE FIRST LINE OF EACH SCREEN OF THE       16340048
163500* SHIPMENT LISTING.                                               16350048
163600     IF  RVT00000-DFCT-SHIPT-ID = PV-PREV-DFCT-SHIPT-ID           16360048
163700         IF  ASC-ITEM-SUB = 1                                     16370048
163800             MOVE RVT00000-DFCT-SHIPT-ID                          16380048
163900                                    TO PV-PREV-DFCT-SHIPT-ID      16390048
164000             MOVE RVT00000-SCAC-CDE TO ASC-SCAC-CDE               16400048
164100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16410048
164200             MOVE RVT00000-DFCT-SHIPT-ID                          16420048
164300                                    TO ASC-DFCT-SHIPT-ID-N        16430048
164400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16440048
164500             MOVE RVT00000-TRLR-ID  TO ASC-TRLR-ID                16450048
164600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16460048
164700             MOVE RVT00000-ACTL-SHIPT-DTE                         16470048
164800                                    TO ASC-ACTL-SHIPT-DTE         16480048
164900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16490048
165000         ELSE                                                     16500048
165100             MOVE SPACES            TO ASC-SCAC-CDE               16510048
165200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16520048
165300                                       ASC-DFCT-SHIPT-ID          16530048
165400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16540048
165500                                       ASC-TRLR-ID                16550048
165600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16560048
165700                                       ASC-ACTL-SHIPT-DTE         16570048
165800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16580048
165900         END-IF                                                   16590048
166000     ELSE                                                         16600048
166100         MOVE RVT00000-DFCT-SHIPT-ID                              16610048
166200                                    TO PV-PREV-DFCT-SHIPT-ID      16620048
166300         MOVE RVT00000-SCAC-CDE     TO ASC-SCAC-CDE               16630048
166400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16640048
166500         MOVE RVT00000-DFCT-SHIPT-ID                              16650048
166600                                    TO ASC-DFCT-SHIPT-ID-N        16660048
166700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16670048
166800         MOVE RVT00000-TRLR-ID      TO ASC-TRLR-ID                16680048
166900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16690048
167000         MOVE RVT00000-ACTL-SHIPT-DTE                             16700048
167100                                    TO ASC-ACTL-SHIPT-DTE         16710048
167200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16720048
167300     END-IF.                                                      16730048
167400                                                                  16740048
167500     MOVE DFCTOR-DFCT-ORD-ID        TO ASC-DFCT-ORD-ID            16750048
167600                                       (ASC-BLK-SUB ASC-ITEM-SUB).16760048
167700     MOVE DFCTOR-VEND-NAME          TO ASC-VEND-NAME              16770048
167800                                       (ASC-BLK-SUB ASC-ITEM-SUB).16780048
167900                                                                  16790048
168000                                                                  16800048
168100*----------------------------------------------------------------*16810048
168200* CLOSE THE VENDOR CURSOR.                                       *16820048
168300*----------------------------------------------------------------*16830048
168400 4020-CLOSE-CURSOR.                                               16840048
168500                                                                  16850048
168600     EXEC SQL                                                     16860048
168700         CLOSE RTV-SHIPMENT-CSR                                   16870048
168800     END-EXEC                                                     16880048
168900                                                                  16890048
169000     EVALUATE TRUE                                                16900048
169100         WHEN SQLCODE = ZERO                                      16910048
169200             CONTINUE                                             16920048
169300         WHEN SQLWARN0 NOT = SPACES                               16930048
169400         WHEN SQLCODE < ZERO                                      16940048
169500         WHEN SQLCODE > ZERO                                      16950048
169600             MOVE '4020-CLOSE-CURSOR'                             16960048
169700                               TO DP013-PARAGRAPH                 16970048
169800             MOVE 'CLOSE SHIPMENT CURSOR'                         16980048
169900                               TO DP013-MESSAGE-TEXT (1)          16990048
170000             MOVE SQLCA        TO DP013-SQLCA                     17000048
170100             MOVE 'RVT_DFCT_SHIPT'                                17010048
170200                               TO DP013-DB2-TABLE-NAME (1)        17020048
170300             MOVE 'TDFCTOR '   TO DP013-DB2-TABLE-NAME (2)        17030048
170400             MOVE 'RVT_SHIPT_STAT'                                17040048
170500                               TO DP013-DB2-TABLE-NAME (3)        17050048
170600             SET DP013-DB2-ABEND                                  17060048
170700                 DP013-XCTL-DISPLAY-RESTART TO TRUE               17070048
170800             PERFORM DP013-0000-PROCESS-ABEND                     17080048
170900     END-EVALUATE.                                                17090048
171000                                                                  17100048
171100*----------------------------------------------------------------*17110048
171200* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *17120048
171300*----------------------------------------------------------------*17130048
171400 4400-MOVE-COMMAREA-TO-SCREEN.                                    17140048
171500                                                                  17150048
171600     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             17160048
171700         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          17170048
171800         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          17180048
171900             MOVE +1    TO ASC-BLK-SUB                            17190048
172000             PERFORM 5100-WRITE-TEMP-STORAGE                      17200048
172100             ADD +1     TO ASC-BLK-SUB                            17210048
172200             PERFORM 5100-WRITE-TEMP-STORAGE                      17220048
172300             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             17230048
172400                 GIVING PV-BLOCK-NUMBER                           17240048
172500                 REMAINDER PV-REMAINDER                           17250048
172600             IF  PV-REMAINDER > ZERO                              17260048
172700                 ADD +1 TO PV-BLOCK-NUMBER                        17270048
172800             END-IF                                               17280048
172900             MOVE +1    TO ASC-BLK-SUB                            17290048
173000             PERFORM 4410-READ-TEMP-STORAGE                       17300048
173100             ADD +1     TO ASC-BLK-SUB                            17310048
173200                           PV-BLOCK-NUMBER                        17320048
173300             PERFORM 4410-READ-TEMP-STORAGE                       17330048
173400     END-IF.                                                      17340048
173500     MOVE +1            TO ASC-BLK-SUB.                           17350048
173600     COMPUTE ASC-ITEM-SUB =                                       17360048
173700         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              17370048
173800         + PC-ITEMS-PER-PANEL).                                   17380048
173900                                                                  17390048
174000     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        17400048
174100         ADD +1         TO ASC-BLK-SUB                            17410048
174200         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            17420048
174300     END-IF.                                                      17430048
174400                                                                  17440048
174500     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           17450048
174600         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                17460048
174700     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        17470048
174800     PERFORM 4420-FORMAT-LIST-LINES                               17480048
174900         VARYING PV-SUB                                           17490048
175000         FROM PC-ITEMS-PER-PANEL BY -1                            17500048
175100         UNTIL PV-SUB < +1.                                       17510048
175200                                                                  17520048
175300     COMPUTE ASC-ITEMS-DISPLAYED =                                17530048
175400         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          17540048
175500     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    17550048
175600                                      ASTRTITO.                   17560048
175700     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    17570048
175800     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    17580048
175900     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            17590048
176000                                   TO ASELITO.                    17600048
176100                                                                  17610048
176200     IF  DP020-MSG-NUMBER-X = SPACE                               17620048
176300         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  17630048
176400*            --- MORE ITEMS TO DISPLAY ----                       17640048
176500             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            17650048
176600             SET DP020-MSG-INFORMATIONAL TO TRUE                  17660048
176700         END-IF                                                   17670048
176800     END-IF.                                                      17680048
176900                                                                  17690048
177000*----------------------------------------------------------------*17700048
177100*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *17710048
177200*----------------------------------------------------------------*17720048
177300 4410-READ-TEMP-STORAGE.                                          17730048
177400                                                                  17740048
177500     EXEC CICS                                                    17750048
177600         READQ TS                                                 17760048
177700             QUEUE (ASC-LIST-QUEUE-NAME)                          17770048
177800             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               17780048
177900             ITEM  (PV-BLOCK-NUMBER)                              17790048
178000             RESP  (PV-CICS-RESP)                                 17800048
178100     END-EXEC.                                                    17810048
178200                                                                  17820048
178300     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       17830048
178400       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     17840048
178500         CONTINUE                                                 17850048
178600     ELSE                                                         17860048
178700         SET DP013-CICS-ABEND     TO TRUE                         17870048
178800         SET DP013-NO-ROLLBACK    TO TRUE                         17880048
178900         MOVE '4410-READ-TEMP-STORAGE'                            17890048
179000                                  TO DP013-PARAGRAPH              17900048
179100         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      17910048
179200                                  TO DP013-MESSAGE-TEXT(1)        17920048
179300         PERFORM DP013-0000-PROCESS-ABEND                         17930048
179400     END-IF.                                                      17940048
179500                                                                  17950048
179600     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             17960048
179700                                                                  17970048
179800     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         17980048
179900         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               17990048
180000     END-IF.                                                      18000048
180100                                                                  18010048
180200*----------------------------------------------------------------*18020048
180300*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *18030048
180400*----------------------------------------------------------------*18040048
180500 4420-FORMAT-LIST-LINES.                                          18050048
180600                                                                  18060048
180700     IF ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ       18070048
180800         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                18080048
180900         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA     (PV-SUB)       18090048
181000         MOVE SPACES             TO MR-SELECTI     (PV-SUB)       18100048
181100                                    MR-SCAC        (PV-SUB)       18110048
181200                                    MR-SHIPMENT    (PV-SUB)       18120048
181300                                    MR-TRAILER     (PV-SUB)       18130048
181400                                    MR-SHIP-DATE   (PV-SUB)       18140048
181500                                    MR-LISTING-NBR (PV-SUB)       18150048
181600                                    MR-VENDOR-NAME (PV-SUB)       18160048
181700     ELSE                                                         18170048
181800         IF ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)       18180048
181900                                                           > SPACE18190048
182000             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 18200048
182100                                           TO MR-SELECTI (PV-SUB) 18210048
182200         ELSE                                                     18220048
182300             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      18230048
182400                                           TO MR-SELECTI (PV-SUB) 18240048
182500         END-IF                                                   18250048
182600                                                                  18260048
182700         IF DP030-SET-CURSOR-TRAILER                              18270048
182800             IF ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)   18280048
182900                                                           > SPACE18290048
183000                OR PV-SUB = 1                                     18300048
183100                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              18310048
183200                 MOVE -1 TO MR-SELECTL (PV-SUB)                   18320048
183300             END-IF                                               18330048
183400         END-IF                                                   18340048
183500                                                                  18350048
183600         IF PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL            18360048
183700             MOVE ASC-SCAC-CDE      (ASC-BLK-SUB ASC-ITEM-SUB)    18370048
183800                                          TO MR-SCAC      (PV-SUB)18380048
183900             MOVE ASC-DFCT-SHIPT-ID (ASC-BLK-SUB ASC-ITEM-SUB)    18390048
184000                                          TO MR-SHIPMENT  (PV-SUB)18400048
184100             MOVE ASC-TRLR-ID       (ASC-BLK-SUB ASC-ITEM-SUB)    18410048
184200                                          TO MR-TRAILER   (PV-SUB)18420048
184300             MOVE ASC-ACTL-SHIPT-DTE (ASC-BLK-SUB ASC-ITEM-SUB)   18430048
184400                                          TO MR-SHIP-DATE (PV-SUB)18440048
184500             MOVE ASC-DFCT-ORD-ID   (ASC-BLK-SUB ASC-ITEM-SUB)    18450048
184600                                          TO MR-LISTING-NBR       18460048
184700                                                          (PV-SUB)18470048
184800             MOVE ASC-VEND-NAME     (ASC-BLK-SUB ASC-ITEM-SUB)    18480048
184900                                          TO MR-VENDOR-NAME       18490048
185000                                                          (PV-SUB)18500048
185100     END-IF.                                                      18510048
185200                                                                  18520048
185300** WE WANT TO DISPLAY THE "SELECT" FIELD ON THE LINES WHERE THE   18530048
185400** SHIPPING INFORMATION IS BEING DISPLAYED.                       18540048
185500     IF  ASC-DFCT-SHIPT-ID (ASC-BLK-SUB ASC-ITEM-SUB) = SPACES    18550048
185600     OR  ASC-DFCT-SHIPT-ID (ASC-BLK-SUB ASC-ITEM-SUB) = ZERO      18560048
185700         MOVE DP015-ASK-DRK-OFF           TO MR-SELECTA   (PV-SUB)18570048
185800     ELSE                                                         18580048
185900         MOVE DP015-UNP-ALP-NOR-OFF                               18590048
186000                                          TO MR-SELECTA   (PV-SUB)18600048
186100         MOVE DP015-GREEN                 TO MR-SELECTC   (PV-SUB)18610048
186200         MOVE DP015-UNDERLINE             TO MR-SELECTH   (PV-SUB)18620048
186300     END-IF.                                                      18630048
186400                                                                  18640048
186500     SUBTRACT +1 FROM ASC-ITEM-SUB.                               18650048
186600                                                                  18660048
186700     IF ASC-ITEM-SUB < + 1                                        18670048
186800         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  18680048
186900         MOVE +1                 TO ASC-BLK-SUB                   18690048
187000     END-IF.                                                      18700048
187100                                                                  18710048
187200******************************************************************18720048
187300** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **18730048
187400** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **18740048
187500** ISSUE A WARNING.                                             **18750048
187600******************************************************************18760048
187700 4430-CHECK-FOR-BEGIN-AND-END.                                    18770048
187800                                                                  18780048
187900     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       18790048
188000         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     18800048
188100*            -- NO END-OF-RANGE SPECFIED ---                      18810048
188200             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            18820048
188300             SET DP020-MSG-WARNING TO TRUE                        18830048
188400             PERFORM 4431-POSITION-AT-WARNING                     18840048
188500         END-IF                                                   18850048
188600     ELSE                                                         18860048
188700         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     18870048
188800*            -- NO BEGINNING-OF-RANGE SPECFIED ---                18880048
188900             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            18890048
189000             SET DP020-MSG-WARNING TO TRUE                        18900048
189100             PERFORM 4431-POSITION-AT-WARNING                     18910048
189200         END-IF                                                   18920048
189300     END-IF.                                                      18930048
189400                                                                  18940048
189500******************************************************************18950048
189600** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **18960048
189700** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **18970048
189800** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **18980048
189900** POSITION THE CURSOR THERE.                                   **18990048
190000******************************************************************19000048
190100 4431-POSITION-AT-WARNING.                                        19010048
190200                                                                  19020048
190300     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 19030048
190400                    - PV-TOP-ITEM + 1.                            19040048
190500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      19050048
190600         CONTINUE                                                 19060048
190700     ELSE                                                         19070048
190800         SET DP030-SET-CURSOR-APPL-1                              19080048
190900                                   TO TRUE                        19090048
191000         MOVE -1                   TO MR-SELECTL (PV-SUB)         19100048
191100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         19110048
191200         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         19120048
191300     END-IF.                                                      19130048
191400                                                                  19140048
191500     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   19150048
191600                    - PV-TOP-ITEM + 1.                            19160048
191700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      19170048
191800         CONTINUE                                                 19180048
191900     ELSE                                                         19190048
192000         SET DP030-SET-CURSOR-APPL-1                              19200048
192100                                   TO TRUE                        19210048
192200         MOVE -1                   TO MR-SELECTL (PV-SUB)         19220048
192300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         19230048
192400         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         19240048
192500     END-IF.                                                      19250048
192600                                                                  19260048
192700*----------------------------------------------------------------*19270048
192800* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *19280048
192900* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *19290048
193000* FOR THE SELECTED ITEMS QUEUE.                                  *19300048
193100*                                                                *19310048
193200* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *19320048
193300* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *19330048
193400* THE ARRAY IS FULL.                                             *19340048
193500*----------------------------------------------------------------*19350048
193600 5000-PREPARE-SEL-QUEUE.                                          19360048
193700                                                                  19370048
193800     MOVE +1                   TO  ASC-BLK-SUB.                   19380048
193900     PERFORM 5100-WRITE-TEMP-STORAGE.                             19390048
194000     ADD +1                    TO  ASC-BLK-SUB.                   19400048
194100     PERFORM 5100-WRITE-TEMP-STORAGE.                             19410048
194200                                                                  19420048
194300     SET ASC-UPDATE-TSQ        TO  TRUE.                          19430048
194400                                                                  19440048
194500     SET RV009-IDX             TO  1.                             19450048
194600     INITIALIZE RV009-SELECTED-ITEM-ARRAY.                        19460048
194700                                                                  19470048
194800     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           19480048
194900             VARYING PV-ITEM                                      19490048
195000             FROM 1 BY 1                                          19500048
195100             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     19510048
195200                                                                  19520048
195300*----------------------------------------------------------------*19530048
195400*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *19540048
195500*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *19550048
195600*----------------------------------------------------------------*19560048
195700 5100-WRITE-TEMP-STORAGE.                                         19570048
195800                                                                  19580048
195900     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     19590048
196000                                   TO PV-LIST-ITEM-NUMBER.        19600048
196100     COMPUTE PV-BLOCK-NUMBER =                                    19610048
196200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    19620048
196300                                                                  19630048
196400     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             19640048
196500     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             19650048
196600         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      19660048
196700             PERFORM 5105-REWRITE-ASC-LISTQ                       19670048
196800         END-IF                                                   19680048
196900     ELSE                                                         19690048
197000         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       19700048
197100         ASC-HIGHEST-BLOCK-WRITTEN + 1                            19710048
197200         PERFORM 5110-WRITE-ASC-LISTQ                             19720048
197300         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   19730048
197400     END-IF.                                                      19740048
197500                                                                  19750048
197600     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             19760048
197700******************************************************************19770048
197800** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **19780048
197900** SPECIFIC COMMAREA.                                           **19790048
198000******************************************************************19800048
198100 5105-REWRITE-ASC-LISTQ.                                          19810048
198200                                                                  19820048
198300     EXEC CICS                                                    19830048
198400         WRITEQ TS                                                19840048
198500             QUEUE (ASC-LIST-QUEUE-NAME)                          19850048
198600             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               19860048
198700             ITEM  (PV-BLOCK-NUMBER)                              19870048
198800             REWRITE                                              19880048
198900             RESP  (PV-CICS-RESP)                                 19890048
199000     END-EXEC.                                                    19900048
199100                                                                  19910048
199200     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           19920048
199300         CONTINUE                                                 19930048
199400     ELSE                                                         19940048
199500         SET DP013-CICS-ABEND            TO TRUE                  19950048
199600         SET DP013-NO-ROLLBACK           TO TRUE                  19960048
199700         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       19970048
199800         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     19980048
199900                                         TO DP013-MESSAGE-TEXT(1) 19990048
200000         PERFORM DP013-0000-PROCESS-ABEND                         20000048
200100     END-IF.                                                      20010048
200200                                                                  20020048
200300******************************************************************20030048
200400** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **20040048
200500** SPECIFIC COMMAREA.                                           **20050048
200600******************************************************************20060048
200700 5110-WRITE-ASC-LISTQ.                                            20070048
200800                                                                  20080048
200900     EXEC CICS                                                    20090048
201000         WRITEQ TS                                                20100048
201100             QUEUE (ASC-LIST-QUEUE-NAME)                          20110048
201200             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               20120048
201300             ITEM  (PV-BLOCK-NUMBER)                              20130048
201400             RESP  (PV-CICS-RESP)                                 20140048
201500     END-EXEC.                                                    20150048
201600     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      20160048
201700         SET DP013-CICS-ABEND      TO TRUE                        20170048
201800         SET DP013-NO-ROLLBACK     TO TRUE                        20180048
201900         MOVE '5110-WRITE-ASC-LISTQ'                              20190048
202000                                   TO DP013-PARAGRAPH             20200048
202100         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           20210048
202200                                   TO DP013-MESSAGE-TEXT(1)       20220048
202300         PERFORM DP013-0000-PROCESS-ABEND                         20230048
202400     END-IF.                                                      20240048
202500                                                                  20250048
202600*----------------------------------------------------------------*20260048
202700* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *20270048
202800* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *20280048
202900*----------------------------------------------------------------*20290048
203000 5200-FILL-SEL-QUEUE-RECORD.                                      20300048
203100                                                                  20310048
203200     PERFORM 6112-READ-LIST-QUEUE.                                20320048
203300                                                                  20330048
203400     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       20340048
203500         PERFORM                                                  20350048
203600         VARYING LQW-IDX                                          20360048
203700         FROM 1 BY 1                                              20370048
203800         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            20380048
203900           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          20390048
204000                                                                  20400048
204100             IF  LQW-SELECT (LQW-IDX)                             20410048
204200                 MOVE SPACE        TO RV009-ACTION-SW (RV009-IDX) 20420048
204300                 MOVE LQW-SCAC-CDE (LQW-IDX)                      20430048
204400                                   TO RV008-SCAC-CDE              20440048
204500                 MOVE LQW-DFCT-SHIPT-ID (LQW-IDX)                 20450048
204600                                   TO RV008-DFCT-SHIPT-ID         20460048
204700                 MOVE LQW-TRLR-ID (LQW-IDX)                       20470048
204800                                   TO RV008-TRLR-ID               20480048
204900                 MOVE LQW-ACTL-SHIPT-DTE (LQW-IDX)                20490048
205000                                   TO RV008-ACTL-SHIPT-DTE        20500048
205100             END-IF                                               20510048
205200         END-PERFORM                                              20520048
205300     END-IF.                                                      20530048
205400                                                                  20540048
205500*----------------------------------------------------------------*20550048
205600*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *20560048
205700*----------------------------------------------------------------*20570048
205800 5205-WRITE-SEL-QUEUE.                                            20580048
205900                                                                  20590048
206000     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            20600048
206100                                   TO RV009-SELECTED-ITEMS.       20610048
206200                                                                  20620048
206300     EXEC CICS                                                    20630048
206400          WRITEQ TS                                               20640048
206500              QUEUE (ASC-SEL-QUEUE-NAME)                          20650048
206600              FROM  (RV009-LINE-SEL-REC)                          20660048
206700              ITEM  (PV-SEL-QUEUE-ITEM)                           20670048
206800              RESP  (PV-CICS-RESP)                                20680048
206900     END-EXEC.                                                    20690048
207000                                                                  20700048
207100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          20710048
207200         CONTINUE                                                 20720048
207300     ELSE                                                         20730048
207400         SET DP013-CICS-ABEND      TO TRUE                        20740048
207500         SET DP013-NO-ROLLBACK     TO TRUE                        20750048
207600         MOVE '5205-WRITE-SEL-QUEUE'                              20760048
207700                                   TO DP013-PARAGRAPH             20770048
207800         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          20780048
207900                                   TO DP013-MESSAGE-TEXT(1)       20790048
208000         PERFORM DP013-0000-PROCESS-ABEND                         20800048
208100     END-IF.                                                      20810048
208200                                                                  20820048
208300******************************************************************20830048
208400** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **20840048
208500** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **20850048
208600** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **20860048
208700** THE USER.                                                    **20870048
208800******************************************************************20880048
208900*6000-REFRESH-PANEL-FROM-TEMP.                                    20890048
209000*                                                                 20900048
209100*    IF  ASC-UPDATE-TSQ                                           20910048
209200*        SET ASC-NO-TSQ-UPDATE TO TRUE                            20920048
209300*        MOVE ZERO                 TO PV-SAVE-ITEM                20930048
209400*                                     PV-SEL-QUEUE-ITEM           20940048
209500*        MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        20950048
209600*                                  TO PV-HOLD-SELECTED-ITEMS      20960048
209700*        PERFORM 6100-UPDATE-TSQ                                  20970048
209800*            UNTIL PV-ITEMS-PROCESSED >                           20980048
209900*                                    ASC-NUMBER-OF-SELECTED-ITEMS 20990048
210000*        PERFORM 6010-DELETE-SEL-QUEUE                            21000048
210100*        INITIALIZE ASC-BLOCK-ENTRIES (1)                         21010048
210200*                   ASC-BLOCK-ENTRIES (2)                         21020048
210300******ADDED                                                       21030048
210400*        DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                 21040048
210500*               GIVING PV-BLOCK-NUMBER                            21050048
210600*               REMAINDER PV-REMAINDER                            21060048
210700*        IF  PV-REMAINDER > ZERO                                  21070048
210800*            ADD +1     TO PV-BLOCK-NUMBER                        21080048
210900*        END-IF                                                   21090048
211000*        MOVE +1        TO ASC-BLK-SUB                            21100048
211100*        PERFORM 4410-READ-TEMP-STORAGE                           21110048
211200*        ADD +1         TO ASC-BLK-SUB                            21120048
211300*                          PV-BLOCK-NUMBER                        21130048
211400*        PERFORM 4410-READ-TEMP-STORAGE                           21140048
211500*                                                                 21150048
211600*    END-IF.                                                      21160048
211700*                                                                 21170048
211800******ADDED                                                       21180048
211900*                                                                 21190048
212000*----------------------------------------------------------------*21200048
212100*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *21210048
212200*----------------------------------------------------------------*21220048
212300*6010-DELETE-SEL-QUEUE.                                           21230048
212400*                                                                 21240048
212500*    EXEC CICS                                                    21250048
212600*        DELETEQ TS                                               21260048
212700*            QUEUE (ASC-SEL-QUEUE-NAME)                           21270048
212800*            RESP  (PV-CICS-RESP)                                 21280048
212900*    END-EXEC.                                                    21290048
213000*                                                                 21300048
213100*    IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      21310048
213200*       (PV-CICS-RESP = DFHRESP(QIDERR)))                         21320048
213300*        CONTINUE                                                 21330048
213400*    ELSE                                                         21340048
213500*        SET DP013-CICS-ABEND TO TRUE                             21350048
213600*        SET DP013-NO-ROLLBACK TO TRUE                            21360048
213700*        MOVE '6010-DELETE-SEL-QUEUE'                             21370048
213800*                       TO DP013-PARAGRAPH                        21380048
213900*        MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         21390048
214000*                       TO DP013-MESSAGE-TEXT (1)                 21400048
214100*        PERFORM DP013-0000-PROCESS-ABEND                         21410048
214200*    END-IF.                                                      21420048
214300*                                                                 21430048
214400*----------------------------------------------------------------*21440048
214500*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *21450048
214600*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *21460048
214700*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *21470048
214800*    THE TEMP QUEUE.                                             *21480048
214900*----------------------------------------------------------------*21490048
215000*6100-UPDATE-TSQ.                                                 21500048
215100*                                                                 21510048
215200*    ADD 1                     TO  PV-SEL-QUEUE-ITEM.             21520048
215300*    PERFORM 6105-READ-SEL-QUEUE.                                 21530048
215400*    PERFORM                                                      21540048
215500*        VARYING RV009-IDX                                        21550048
215600*        FROM 1 BY 1                                              21560048
215700*        UNTIL ((PV-ITEMS-PROCESSED >                             21570048
215800*                             PV-HOLD-SELECTED-ITEMS)             21580048
215900*        OR (RV009-IDX GREATER THAN RV009-MAX-ITEMS))             21590048
216000*        IF  RV009-ACTION-SW (RV009-IDX) > SPACE                  21600048
216100*            PERFORM 6110-PROCESS-ITEMS                           21610048
216200*        END-IF                                                   21620048
216300*        ADD +1                TO PV-ITEMS-PROCESSED              21630048
216400*    END-PERFORM.                                                 21640048
216500*                                                                 21650048
216600*    PERFORM 6111-WRITE-LIST-QUEUE.                               21660048
216700*                                                                 21670048
216800*----------------------------------------------------------------*21680048
216900*    READ THE LIST QUEUE RECORD.                                 *21690048
217000*----------------------------------------------------------------*21700048
217100*6105-READ-SEL-QUEUE.                                             21710048
217200*                                                                 21720048
217300*    EXEC CICS                                                    21730048
217400*         READQ TS                                                21740048
217500*             QUEUE (ASC-SEL-QUEUE-NAME)                          21750048
217600*             INTO  (RV009-LINE-SEL-REC)                          21760048
217700*             ITEM  (PV-SEL-QUEUE-ITEM)                           21770048
217800*             RESP  (PV-CICS-RESP)                                21780048
217900*    END-EXEC.                                                    21790048
218000*                                                                 21800048
218100*    IF  PV-CICS-RESP = DFHRESP (NORMAL)                          21810048
218200*        CONTINUE                                                 21820048
218300*    ELSE                                                         21830048
218400*        SET DP013-CICS-ABEND      TO  TRUE                       21840048
218500*        SET DP013-NO-ROLLBACK     TO  TRUE                       21850048
218600*        MOVE '6105-READ-SEL-QUEUE'                               21860048
218700*                                  TO  DP013-PARAGRAPH            21870048
218800*        MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           21880048
218900*                                  TO  DP013-MESSAGE-TEXT(1)      21890048
219000*        PERFORM DP013-0000-PROCESS-ABEND                         21900048
219100*    END-IF.                                                      21910048
219200*                                                                 21920048
219300*----------------------------------------------------------------*21930048
219400*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*21940048
219500*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*21950048
219600*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *21960048
219700*----------------------------------------------------------------*21970048
219800*6110-PROCESS-ITEMS.                                              21980048
219900*                                                                 21990048
220000*    COMPUTE PV-ITEM = 1 + ((RV009-ITEM (RV009-IDX) - 1)          22000048
220100*                    / PC-ITEMS-PER-PANEL).                       22010048
220200*                                                                 22020048
220300*    IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           22030048
220400*        IF  PV-SAVE-ITEM NOT EQUAL ZERO                          22040048
220500*            PERFORM 6111-WRITE-LIST-QUEUE                        22050048
220600*        END-IF                                                   22060048
220700*        MOVE PV-ITEM          TO PV-SAVE-ITEM                    22070048
220800*                                                                 22080048
220900*        PERFORM 6112-READ-LIST-QUEUE                             22090048
221000*        IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               22100048
221100*            CONTINUE                                             22110048
221200*        END-IF                                                   22120048
221300*    END-IF.                                                      22130048
221400*                                                                 22140048
221500*    COMPUTE PV-SUB = (RV009-ITEM (RV009-IDX)                     22150048
221600*                   - LQW-LIST-ITEM-NUMBER (1)) + 1.              22160048
221700*    SET LQW-DESELECT (PV-SUB) TO    TRUE                         22170048
221800*    MOVE LQW-SELECTED-SW (PV-SUB)                                22180048
221900*                              TO LQW-TEMP-SELECTED-SW (PV-SUB).  22190048
222000*                                                                 22200048
222100*    SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                22210048
222200*                                                                 22220048
222300*----------------------------------------------------------------*22230048
222400*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *22240048
222500*----------------------------------------------------------------*22250048
222600*6111-WRITE-LIST-QUEUE.                                           22260048
222700*                                                                 22270048
222800*    EXEC CICS                                                    22280048
222900*        WRITEQ TS                                                22290048
223000*            QUEUE (ASC-LIST-QUEUE-NAME)                          22300048
223100*            FROM  (LQW-LIST-QUEUE-WORK-AREA)                     22310048
223200*            ITEM  (PV-SAVE-ITEM)                                 22320048
223300*            REWRITE                                              22330048
223400*            RESP  (PV-CICS-RESP)                                 22340048
223500*    END-EXEC.                                                    22350048
223600*                                                                 22360048
223700*    IF  PV-CICS-RESP = DFHRESP (NORMAL)                          22370048
223800*        CONTINUE                                                 22380048
223900*    ELSE                                                         22390048
224000*        SET DP013-CICS-ABEND  TO  TRUE                           22400048
224100*        SET DP013-NO-ROLLBACK TO  TRUE                           22410048
224200*        MOVE '6111-WRITE-LIST-QUEUE'                             22420048
224300*                              TO  DP013-PARAGRAPH                22430048
224400*        MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  22440048
224500*                              TO  DP013-MESSAGE-TEXT(1)          22450048
224600*        PERFORM DP013-0000-PROCESS-ABEND                         22460048
224700*    END-IF.                                                      22470048
224800*                                                                 22480048
224900*----------------------------------------------------------------*22490048
225000*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*22500048
225100*----------------------------------------------------------------*22510048
225200 6112-READ-LIST-QUEUE.                                            22520048
225300                                                                  22530048
225400     EXEC CICS                                                    22540048
225500         READQ TS                                                 22550048
225600             QUEUE (ASC-LIST-QUEUE-NAME)                          22560048
225700             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     22570048
225800             ITEM  (PV-ITEM)                                      22580048
225900             RESP  (PV-CICS-RESP)                                 22590048
226000     END-EXEC.                                                    22600048
226100                                                                  22610048
226200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          22620048
226300         CONTINUE                                                 22630048
226400     ELSE                                                         22640048
226500         SET DP013-CICS-ABEND        TO TRUE                      22650048
226600         SET DP013-NO-ROLLBACK       TO TRUE                      22660048
226700         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           22670048
226800         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    22680048
226900                                     TO DP013-MESSAGE-TEXT(1)     22690048
227000         PERFORM DP013-0000-PROCESS-ABEND                         22700048
227100     END-IF.                                                      22710048
227200*                                                                 22720048
227300*----------------------------------------------------------------*22730048
227400*    ABEND PROCESSOR MODULE                                      *22740048
227500*----------------------------------------------------------------*22750048
227600     COPY DPPD013.                                                22760048
