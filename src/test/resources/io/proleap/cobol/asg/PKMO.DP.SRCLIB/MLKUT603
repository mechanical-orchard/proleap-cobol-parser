000100 IDENTIFICATION DIVISION.                                         00010000
000200                                                                  00020000
000300 PROGRAM-ID.              MLKUT603.                               00030000
000400 AUTHOR.                  DAVE METZGER.                           00040000
000500 INSTALLATION.            KOHLS DEPARTMENT STORES.                00050000
000600 DATE-WRITTEN.            06/21/98.                               00060000
000700 DATE-COMPILED.                                                   00070000
000800                                                                  00080000
000900******************************************************************00090000
001000*    GET THE ENDING INVENTORY COST AND RETAIL FOR THE END OF THE  00100000
001000*    PRIOR SEASON "THIS YR" AND "LAST YR" AS WELL AS THE CURRENT  00101018
001000*    MAX POSTING MONTH ENDING INVENTORY RETAIL (TY AND LY) AND    00101118
001000*    UPDATE THE EXTRACT FILE WITH THIS INFO.                      00101218
001100*                                                                 00110000
001200* THIS PROGRAM WILL READ A M/L VENDOR ANALYSIS RECORD AND UPDATE  00120000
001300* IT WITH THE ENDING INVENTORY COST AND RETAIL AMOUNTS FROM THE   00130000
001300* PRIOR SEASON FOR "THIS YR" AND "LAST YR" DATA.  THE ENDING      00131003
001300* INVENTORY AMOUNTS WILL BE RETRIEVED FROM THE DIFFERENT TABLES   00132003
001300* BASED ON VALUE IN THE CONTROL CARD (SEE BELOW).                 00133003
001800*                                                                 00134003
001800* IF CONTROL CARD EQUALS:                                         00180003
001800*            MCL ===> INVENTORY AMTS RETRIEVED FROM TVAMCL        00181003
001800*            DPT ===> INVENTORY AMTS RETRIEVED FROM TVADPT        00181103
001800*                                                                 00183003
003100******************************************************************00183253
003800* CHANGED BY:  D. METZGER         01-08-2000         WR#99999     00183353
003900* FIXED THE SQL TO GET THE 53RD WEEK LAST YEAR DATA FROM 8050-    00183453
001800* WHEN 8000- RETURNS A NOT FOUND (+100).                          00186053
001800*                                                                 00187053
001800*                                                                 00188053
001800*                                                                 00189053
001900******************************************************************00190000
002000                                                                  00200000
002100 ENVIRONMENT DIVISION.                                            00210000
002200                                                                  00220000
002300 CONFIGURATION SECTION.                                           00230000
002400                                                                  00240000
002500 SOURCE-COMPUTER. IBM-3090.                                       00250000
002600 OBJECT-COMPUTER. IBM-3090.                                       00260000
002700                                                                  00270000
002800 INPUT-OUTPUT SECTION.                                            00280000
002900                                                                  00290000
003000 FILE-CONTROL.                                                    00300000
003100                                                                  00310000
003200     SELECT DATE-EXTRACT-CNTL-FILE                                00320017
003300         ASSIGN TO INP01.                                         00330000
003700                                                                  00370000
003200     SELECT CONTROL-CARD-FILE                                     00371017
003300         ASSIGN TO INP02.                                         00371117
003700                                                                  00371217
003200     SELECT LEDGER-OLD-VA-FILE                                    00372002
003300         ASSIGN TO INP03.                                         00373017
003700                                                                  00374002
003800     SELECT LEDGER-NEW-VA-FILE                                    00380000
003900         ASSIGN TO OUT01.                                         00390000
004000                                                                  00400000
004100 DATA DIVISION.                                                   00410000
004200                                                                  00420000
004300 FILE SECTION.                                                    00430000
005000                                                                  00500000
005100 FD  DATE-EXTRACT-CNTL-FILE                                       00510017
005200     RECORDING MODE IS F                                          00520000
005300     LABEL RECORDS ARE STANDARD                                   00530000
005400     BLOCK CONTAINS 0 RECORDS.                                    00540000
005500 01  DATE-EXTRACT-CNTL-RECORD         PIC X(80).                  00550017
005000                                                                  00551017
005100 FD  CONTROL-CARD-FILE                                            00552017
005200     RECORDING MODE IS F                                          00553017
005300     LABEL RECORDS ARE STANDARD                                   00554017
005400     BLOCK CONTAINS 0 RECORDS.                                    00555017
005500 01  CONTROL-CARD-RECORD              PIC X(80).                  00556017
005600                                                                  00560000
005100 FD  LEDGER-OLD-VA-FILE                                           00562002
005200     RECORDING MODE IS F                                          00563002
005300     LABEL RECORDS ARE STANDARD                                   00564002
005400     BLOCK CONTAINS 0 RECORDS.                                    00565002
005500 01  LEDGER-OLD-VA-RECORD             PIC X(660).                 00566015
005600                                                                  00567002
005700 FD  LEDGER-NEW-VA-FILE                                           00570000
005800     RECORDING MODE IS F                                          00580000
005900     LABEL RECORDS ARE STANDARD                                   00590000
006000     BLOCK CONTAINS 0 RECORDS.                                    00600000
006100 01  LEDGER-NEW-VA-RECORD             PIC X(660).                 00610015
006200                                                                  00620000
006300 WORKING-STORAGE SECTION.                                         00630000
006400                                                                  00640000
007000****************************************************************  00700000
007100* RECORD LAYOUT FOR LEDGER/VENDOR ANALYSIS EXTRACT RECORD         00710000
007200****************************************************************  00720000
007300     COPY MLRD202.                                                00730000
007400                                                                  00740000
008000****************************************************************  00800000
008100*  ERROR MESSAGE AREA FOR DB2                                     00810000
008200****************************************************************  00820000
008300     COPY DPWS004.                                                00830000
008400                                                                  00840000
008500****************************************************************  00850000
008600* MISC WORKING STORAGE FIELDS                                     00860000
008700****************************************************************  00870000
008800                                                                  00880000
008900 01  PC-PROGRAM-CONSTANTS.                                        00890000
009000     05  PC-MAJ-CL-LEVEL              PIC X(03)    VALUE 'MCL'.   00900004
009000     05  PC-DEPT-LEVEL                PIC X(03)    VALUE 'DPT'.   00910004
009800                                                                  00972000
009900 01  PS-PROGRAM-SWITCHES.                                         00973000
010200     05  PS-END-OF-INPUT-SW           PIC X        VALUE 'N'.     00976004
010300         88  END-OF-INPUT                          VALUE 'Y'.     00977004
                                                                        00977107
011300                                                                  01050000
011400 01  PV-PROGRAM-VARIABLES.                                        01060000
011500     05  PV-DB2-OPER-ATTEMPTED        PIC X(30)    VALUE SPACES.  01070004
011600     05  PV-PARAGRAPH-NAME            PIC X(30)    VALUE SPACES.  01080004
011600     05  PV-TY-PREV-SEA-END-DTE       PIC X(10)    VALUE SPACES.  01081133
011600     05  PV-LY-PREV-SEA-END-DTE       PIC X(10)    VALUE SPACES.  01081233
011600     05  PV-LY-TY-FSCL-MN-END-DTE     PIC X(10)    VALUE SPACES.  01081333
011600     05  PV-END-INV-RTL-AMT           PIC S9(9)V99 VALUE +0       01084027
                                                         COMP-3.        01085017
013100     05  PV-INPUT-REC-CNT             PIC 9(11)    VALUE ZEROS    01250004
                                                         COMP-3.        01260004
013200     05  PV-OUTPUT-REC-CNT            PIC 9(11)    VALUE ZEROS    01270004
                                                         COMP-3.        01280004
013300     05  PV-INPUT-REC-CNT-DIS         PIC ZZ,ZZZ,ZZZ,ZZZ.         01310000
013400     05  PV-OUTPUT-REC-CNT-DIS        PIC ZZ,ZZZ,ZZZ,ZZZ.         01320000
013500                                                                  01340000
013600 01  ABEND-CODE                       PIC S9(04)   COMP           01350004
013700                                                   VALUE ZERO.    01360004
013900****************************************************************  01370103
014000* DATE EXTRACT CONTROL RECORD                                     01370217
014100****************************************************************  01370303
013600 01  PV-DATE-EXTR-CNTL-REC.                                       01371017
           05  PV-EXTRACT-DATE.                                         01371130
               10  PV-EXTRACT-CCYY          PIC X(04)   VALUE SPACES.   01371230
               10  FILLER                   PIC X(01)   VALUE SPACES.   01371330
               10  PV-EXTRACT-MN            PIC X(02)   VALUE SPACES.   01371430
               10  FILLER                   PIC X(01)   VALUE SPACES.   01371530
               10  PV-EXTRACT-DY            PIC X(02)   VALUE SPACES.   01371630
           05  FILLER                       PIC X(01)   VALUE SPACES.   01371730
           05  PV-EXTRACT-DATE-MN-NBR       PIC X(02)   VALUE SPACES.   01371830
           05  FILLER                       PIC X(77)   VALUE SPACES.   01371930
                                                                        01372030
013900****************************************************************  01372130
014000* CONTROL CARD RECORD                                             01372230
014100****************************************************************  01372330
013600 01  PV-CONTROL-CARD-REC.                                         01372430
           05  PV-REPORTING-LEVEL           PIC X(03)   VALUE SPACES.   01372530
           05  FILLER                       PIC X(77)   VALUE SPACES.   01372630
                                                                        01373017
013900****************************************************************  01380000
014000* M/L DATE ATTRIBUTE TABLE DCLGEN                                 01390003
014100****************************************************************  01400000
014200     EXEC SQL                                                     01410000
014300         INCLUDE TDTATTR                                          01420003
014400     END-EXEC.                                                    01430000
014500                                                                  01440000
013900****************************************************************  01450003
014000* M/L VENDOR ANALYSIS MAJOR CLASS LEVEL DCLGEN                    01460003
014100****************************************************************  01470003
014200     EXEC SQL                                                     01480003
014300         INCLUDE TVAMCL                                           01490003
014400     END-EXEC.                                                    01500003
014500                                                                  01510003
013900****************************************************************  01520003
014000* M/L VENDOR ANALYSIS DEPT LEVEL DCLGEN                           01530003
014100****************************************************************  01540003
014200     EXEC SQL                                                     01550003
014300         INCLUDE TVADPT                                           01560003
014400     END-EXEC.                                                    01570003
014500                                                                  01580003
018800****************************************************************  01870000
018900*  COMMUNICATION AREAS FOR DB2                                    01880000
019000****************************************************************  01890000
019100     EXEC SQL                                                     01900000
019200         INCLUDE SQLCA                                            01910000
019300     END-EXEC.                                                    01920000
019400                                                                  01930000
019500 LINKAGE SECTION.                                                 01940000
019600                                                                  01950000
019700 PROCEDURE DIVISION.                                              01960000
019800                                                                  01970000
019900***************************************************************** 01980000
020000*  MAIN MODULE - BEGINNING OF PGM LOGIC                           01990000
020100***************************************************************** 02000000
020200 0000-MAIN-MODULE.                                                02010007
020300                                                                  02020000
021000     PERFORM 1000-INITIALIZATION.                                 02091002
021100                                                                  02100000
021600     PERFORM 2000-BUILD-NEW-EXTRACT-FILE                          02150000
021700         UNTIL END-OF-INPUT.                                      02160000
021800                                                                  02170000
021900     MOVE PV-INPUT-REC-CNT     TO PV-INPUT-REC-CNT-DIS.           02180000
022000     MOVE PV-OUTPUT-REC-CNT    TO PV-OUTPUT-REC-CNT-DIS.          02190000
022100     DISPLAY ' '.                                                 02210000
022200     DISPLAY '***     MLKUT603 RECORD COUNTS     ***'             02220000
022300     DISPLAY '***  RECORDS READ      ' PV-INPUT-REC-CNT-DIS.      02230000
022400     DISPLAY '***  RECORDS WRITTEN   ' PV-OUTPUT-REC-CNT-DIS.     02240000
022100     DISPLAY ' '.                                                 02241000
022500                                                                  02243000
022600     CLOSE DATE-EXTRACT-CNTL-FILE                                 02244017
022600           CONTROL-CARD-FILE                                      02244117
022600           LEDGER-OLD-VA-FILE                                     02245003
022800           LEDGER-NEW-VA-FILE.                                    02246000
022900                                                                  02247000
023000     STOP RUN.                                                    02248000
023100                                                                  02249000
025100***************************************************************** 02440000
025200*  INITIALIZATION MODULE - OPEN FILES, FIRST READS, ...ETC        02450002
025300***************************************************************** 02460000
025400 1000-INITIALIZATION.                                             02470002
025500                                                                  02480000
020400     OPEN INPUT DATE-EXTRACT-CNTL-FILE                            02480117
020400                CONTROL-CARD-FILE                                 02480217
020400                LEDGER-OLD-VA-FILE                                02480317
020600         OUTPUT LEDGER-NEW-VA-FILE.                               02480417
                                                                        02480517
020700     PERFORM 7000-READ-DATE-EXTR-CNTL-FILE.                       02480617
020700     PERFORM 7100-READ-CONTROL-CARD-FILE.                         02480717
020700                                                                  02480817
           DISPLAY ' '.                                                 02480922
020700                                                                  02481022
044600     EVALUATE TRUE                                                02481117
044700       WHEN PV-REPORTING-LEVEL = PC-MAJ-CL-LEVEL                  02481217
               DISPLAY '*** PROCESSING DEPT/MCL/ENT-ID LVL - TVAMCL TBL'02481322
044700       WHEN PV-REPORTING-LEVEL = PC-DEPT-LEVEL                    02481417
               DISPLAY '*** PROCESSING DEPT/ENT-ID LVL - TVADPT TBL'    02481522
             WHEN OTHER                                                 02481817
               DISPLAY '***   CONTROL FILE RECORD IN ERROR   ***'       02481932
               DISPLAY '    THE CONTROL RECORD READ DID NOT'            02482017
               DISPLAY '    HAVE A MCL OR DPT STARTING IN '             02482141
               DISPLAY '    POSITION 1 FOR LENGTH OF 3. '               02482241
               DISPLAY '*** VERIFY THAT CNTL CARD IS CORRECT! ***'      02482322
               PERFORM 9999-ABEND                                       02482417
044600     END-EVALUATE.                                                02482517
                                                                        02482622
           DISPLAY ' '.                                                 02482722
                                                                        02482817
021000     PERFORM 7200-READ-OLD-EXTRACT-FILE.                          02482917
                                                                        02483033
025100***  GET PREV SEASON END INV DATE FOR CURRENT MONTH AND LAST YEAR 02483141
025100***  AT THIS TIME.  ALSO GET PREV YEAR FISCAL MONTH END DATE      02483241
           MOVE PV-EXTRACT-DATE         TO DTATTR-KY-DTE                02483341
021000     PERFORM 8000-GET-PREV-SEA-END-DATES.                         02483441
025500                                                                  02483733
025100***************************************************************** 02483833
025200*  BUILD NEW EXTRACT FILE WITH THE ADDITIONAL MBS INFO            02483933
025300***************************************************************** 02484033
025400 2000-BUILD-NEW-EXTRACT-FILE.                                     02484133
025500                                                                  02485002
025600     ADD 1 TO PV-INPUT-REC-CNT.                                   02490000
                                                                        02490133
044600     EVALUATE TRUE                                                02491033
044700       WHEN PV-REPORTING-LEVEL = PC-MAJ-CL-LEVEL                  02492033
025700          PERFORM 3000-MOVE-MCL-DATA                              02493033
                                                                        02499033
044700       WHEN PV-REPORTING-LEVEL = PC-DEPT-LEVEL                    02499133
025700          PERFORM 4000-MOVE-DPT-DATA                              02499233
025700          PERFORM 4100-CALC-TY-PURCHASES                          02499342
                                                                        02499433
044600     END-EVALUATE.                                                02499833
                                                                        02499933
035400***  WRITE EXTRACT RECORD WITH PREV SEA INVENTORY AMTS            02511003
025900     PERFORM 7300-WRITE-LEDGER-VA-EXTRACT.                        02520017
026000     ADD 1 TO PV-OUTPUT-REC-CNT.                                  02530000
026100                                                                  02540000
035400***  INITIALIZE RECORD LAYOUT AND READ NEXT RECORD.               02541003
           INITIALIZE ML202-VENDOR-EXTRACT.                             02550003
026400     PERFORM 7200-READ-OLD-EXTRACT-FILE.                          02570017
026500                                                                  02580000
026600***************************************************************** 02590000
026700*       ***   MAJOR CLASS LEVEL PROCESSING  ***                   02591041
026700*                                                                 02592041
026700* GET AND MOVE MCL LEVEL DATA TO OUTPUT RECORD.                   02600034
026900***************************************************************** 02620000
027000 3000-MOVE-MCL-DATA.                                              02630033
                                                                        02630149
           IF ML202-FSCL-MN-NBR = PV-EXTRACT-DATE-MN-NBR                02630449
027200***    GET THE "LAST YR" PREVIOUS SEASON ENDING                   02630549
              MOVE PV-LY-PREV-SEA-END-DTE   TO VAMCL-FSCL-MN-END-DTE    02630749
027700        PERFORM 8100-GET-MCL-END-INV                              02630849
027200        MOVE VAMCL-END-INV-RTL-AMT    TO ML202-LY-PREV-SEA-EI-RTL 02630949
              MOVE VAMCL-END-INV-COST-AMT   TO ML202-LY-PREV-SEA-EI-COST02631049
027200***    GET THE "THIS YR" PREVIOUS SEASON ENDING                   02631149
              MOVE PV-TY-PREV-SEA-END-DTE   TO VAMCL-FSCL-MN-END-DTE    02631349
027700        PERFORM 8100-GET-MCL-END-INV                              02631449
027200        MOVE VAMCL-END-INV-RTL-AMT    TO ML202-TY-PREV-SEA-EI-RTL 02631549
              MOVE VAMCL-END-INV-COST-AMT   TO ML202-TY-PREV-SEA-EI-COST02631649
027200***    GET "THIS YR" CURRENT MONTH ENDING INVENTORY RETAIL        02631749
028000***    AND CORRESPONDING "LAST YR" ENDING INVENTORY RETAIL        02631849
028000***    AND UPDATE TO EXTRACT RECORD (THIS IS DONE SO THAT WHEN    02631949
028000***    MULTIPLE MONTHS ARE PROCESSED ONLY THE CURRENT MONTH       02632049
028000***    ENDING INV RETAIL WILL BE DISPLAYED ON THE RPT FOR TY / LY 02632149
028000***    "THIS YEAR"                                                02632249
              MOVE PV-EXTRACT-DATE          TO VAMCL-FSCL-MN-END-DTE    02632349
027700        PERFORM 8100-GET-MCL-END-INV                              02632449
045700        MOVE VAMCL-END-INV-RTL-AMT    TO ML202-TY-END-INV-RTL-AMT 02632549
028000***    "LAST YEAR"                                                02632649
              MOVE DTATTR-LY-THIS-DAY-KY-DTE TO VAMCL-FSCL-MN-END-DTE   02632749
027700        PERFORM 8100-GET-MCL-END-INV                              02632849
045700        MOVE VAMCL-END-INV-RTL-AMT    TO ML202-LY-END-INV-RTL-AMT 02632949
           ELSE                                                         02633049
              MOVE ZEROS                    TO ML202-LY-PREV-SEA-EI-RTL 02633149
                                             ML202-LY-PREV-SEA-EI-COST  02633249
                                             ML202-TY-PREV-SEA-EI-RTL   02633349
                                             ML202-TY-PREV-SEA-EI-COST  02633449
                                             ML202-LY-END-INV-RTL-AMT   02633549
                                             ML202-LY-END-INV-COST-AMT  02633649
                                             ML202-TY-END-INV-RTL-AMT   02633749
                                             ML202-TY-END-INV-COST-AMT  02633849
           END-IF.                                                      02633949
                                                                        02797027
026600***************************************************************** 02797134
026700*           ***  DEPARTMENT LEVEL PROCESSING  ***                 02797241
026700*                                                                 02797341
026700* GET AND MOVE DPT LEVEL DATA TO OUTPUT RECORD.                   02797441
026900***************************************************************** 02797541
027000 4000-MOVE-DPT-DATA.                                              02820034
027100                                                                  02821037
027200***  GET THE "LAST YR" PREVIOUS SEASON ENDING                     02822037
028000***  INVENTORY AMOUNTS AND MOVE TO OUTPUT REC.                    02823037
           MOVE PV-LY-PREV-SEA-END-DTE TO VADPT-FSCL-MN-END-DTE.        02825037
027700     PERFORM 8200-GET-DPT-END-INV.                                02826041
027200     MOVE VADPT-END-INV-RTL-AMT  TO ML202-LY-PREV-SEA-EI-RTL.     02827038
           MOVE VADPT-END-INV-COST-AMT TO ML202-LY-PREV-SEA-EI-COST.    02828038
                                                                        02829437
027200***  GET THE "THIS YR" PREVIOUS SEASON ENDING                     02829541
028000***  INVENTORY AMOUNTS AND MOVE TO OUTPUT REC.                    02829641
           MOVE PV-TY-PREV-SEA-END-DTE TO VADPT-FSCL-MN-END-DTE.        02829937
027700     PERFORM 8200-GET-DPT-END-INV.                                02830041
027200     MOVE VADPT-END-INV-RTL-AMT  TO ML202-TY-PREV-SEA-EI-RTL.     02830138
           MOVE VADPT-END-INV-COST-AMT TO ML202-TY-PREV-SEA-EI-COST.    02830238
                                                                        02830637
027200***  GET "THIS YR" CURRENT MONTH ENDING INVENTORY RETAIL          02830737
028000***  AND CORRESPONDING "LAST YR" ENDING INVENTORY RETAIL          02830837
028000***  AND UPDATE TO EXTRACT RECORD (THIS IS DONE SO THAT WHEN      02830937
028000***  MULTIPLE MONTHS ARE PROCESSED ONLY THE CURRENT MONTH ENDING  02831037
028000***  INV RETAIL WILL BE DISPLAYED ON THE RPT FOR TY AND LY        02831137
028000***  " THIS YEAR"                                                 02831237
           MOVE PV-EXTRACT-DATE           TO VADPT-FSCL-MN-END-DTE.     02831440
027700     PERFORM 8200-GET-DPT-END-INV.                                02831541
045700     MOVE VADPT-END-INV-RTL-AMT     TO ML202-TY-END-INV-RTL-AMT.  02831638
045700     MOVE VADPT-END-INV-COST-AMT    TO ML202-TY-END-INV-COST-AMT. 02831747
                                                                        02831847
028000***  " LAST YEAR"                                                 02832137
           MOVE DTATTR-LY-THIS-DAY-KY-DTE TO VADPT-FSCL-MN-END-DTE.     02832337
027700     PERFORM 8200-GET-DPT-END-INV.                                02832441
045700     MOVE VADPT-END-INV-RTL-AMT     TO ML202-LY-END-INV-RTL-AMT.  02832538
045700     MOVE VADPT-END-INV-COST-AMT    TO ML202-LY-END-INV-COST-AMT. 02832647
                                                                        02833037
027100                                                                  02833134
026600***************************************************************** 02833234
026700* GET AND MOVE ENT LEVEL DATA TO OUTPUT RECORD.                   02833334
026900***************************************************************** 02834034
027000 4100-CALC-TY-PURCHASES.                                          02880042
                                                                        02880142
           COMPUTE ML202-TY-PURCHASES-FOR-SORT =                        02881043
                   ML202-TY-RCPT-RTL-AMT +                              02881143
                   ML202-TY-PADJ-RTL-AMT +                              02881243
                   ML202-TY-MKUP-RTL-AMT +                              02881343
                   ML202-TY-XFER-IN-RTL-AMT  -                          02881444
                   ML202-TY-XFER-OUT-RTL-AMT.                           02881544
                                                                        02881642
                                                                        02882042
027100                                                                  02890034
035400***************************************************************** 03540000
035500* READ THE DATE EXTRACT CONTROL FILE SO THAT THE PGM KNOWS WHAT   03550017
035500* MONTH TO GET THE ENDING INVENTORY RETAIL AMOUNT FOR.            03551017
035600***************************************************************** 03560000
035700 7000-READ-DATE-EXTR-CNTL-FILE.                                   03570017
035800                                                                  03580000
035900     READ DATE-EXTRACT-CNTL-FILE                                  03590017
036000          INTO PV-DATE-EXTR-CNTL-REC                              03600017
036100          AT END                                                  03610002
                   DISPLAY '*** NO DATE EXTRACT RECORD FOUND ***'       03611017
                   PERFORM 9999-ABEND.                                  03614002
036200                                                                  03620000
035400***************************************************************** 03621017
035500* READ THE CONTROL FILE TO GET THE REPORTING LEVEL SO THAT THE PGM03622017
035500* KNOWS WHAT TABLE TO RETRIEVE THE PREV SEASON ENDING INV FROM    03623017
035600***************************************************************** 03624017
035700 7100-READ-CONTROL-CARD-FILE.                                     03625017
035800                                                                  03626017
035900     READ CONTROL-CARD-FILE                                       03627017
036000          INTO PV-CONTROL-CARD-REC                                03628017
036100          AT END                                                  03629017
                   DISPLAY '*** NO CONTROL FILE RECORD FOUND ***'       03629117
                   DISPLAY '    MUST HAVE 1 CONTROL RECORD '            03629217
                   DISPLAY '    WITH MCL, DPT, OR ENT '                 03629317
                   PERFORM 9999-ABEND.                                  03629417
036200                                                                  03629517
036300***************************************************************** 03630000
036400* READ OLD EXTRACT SO A NEW EXTRACT WITH MBS INFO CAN BE CREATED  03640000
036500***************************************************************** 03650000
036600 7200-READ-OLD-EXTRACT-FILE.                                      03660017
036700                                                                  03670000
036800     READ LEDGER-OLD-VA-FILE                                      03680000
036900         INTO ML202-VENDOR-EXTRACT                                03690000
037000         AT END SET END-OF-INPUT TO TRUE.                         03700000
037100                                                                  03710000
037200***************************************************************** 03720000
037300*  WRITE NEW EXTRACT WITH THE ADDITIONAL MBS INFO                 03730000
037400***************************************************************** 03740000
037500 7300-WRITE-LEDGER-VA-EXTRACT.                                    03750017
037600                                                                  03760000
037700     WRITE LEDGER-NEW-VA-RECORD                                   03770000
037800         FROM ML202-VENDOR-EXTRACT.                               03780000
037900                                                                  03790000
038000***************************************************************** 03800041
038100* GET "THIS YEAR" AND "LAST YEAR" PREVIOUS SEASON ENDING          03800141
038100* INVENTORY DATES AND "LAST YEAR" FSCL MONTH END DATE             03800241
038200***************************************************************** 03800341
031300 8000-GET-PREV-SEA-END-DATES.                                     03800441
038400                                                                  03800541
038500     EXEC SQL                                                     03800641
038600        SELECT A.PREV_SEA_END_DTE                                 03800741
038600              ,A.LY_THIS_DAY_KY_DTE                               03800841
039700              ,B.PREV_SEA_END_DTE                                 03800941
039700        INTO  :PV-TY-PREV-SEA-END-DTE                             03801041
039700             ,:DTATTR-LY-THIS-DAY-KY-DTE                          03801141
039700             ,:PV-LY-PREV-SEA-END-DTE                             03801241
040800         FROM TDTATTR A                                           03801341
040800             ,TDTATTR B                                           03801441
041500        WHERE A.KY_DTE = :DTATTR-KY-DTE                           03801541
041500          AND B.KY_DTE = A.LY_THIS_DAY_KY_DTE                     03801652
044400     END-EXEC.                                                    03801851
044500                                                                  03801951
044600     EVALUATE TRUE                                                03802051
044700         WHEN SQLCODE = ZERO                                      03802151
044800             CONTINUE                                             03802251
044700         WHEN SQLCODE = +100                                      03802352
044800             PERFORM 8050-GET-PREV-SEA-END-DTE-53WK               03802452
045800         WHEN OTHER                                               03802552
045900             MOVE '8000-GET-PREV-SEA-END-DATES'                   03802652
046000                                    TO PV-PARAGRAPH-NAME          03802752
046100             MOVE 'SELECT ROW FROM TDTATTR'                       03802852
046200                                    TO PV-DB2-OPER-ATTEMPTED      03802952
046300             PERFORM 9998-SQL-ABEND                               03803052
046400     END-EVALUATE.                                                03803152
046500                                                                  03803252
038000***************************************************************** 03803352
038100* WHEN THERE IS A 53RD WEEK IN THE YEAR SO WE GET A +100 FROM     03803452
038100* THE 8000- CALL.                                                 03803552
038100* INVENTORY DATES AND "LAST YEAR" FSCL MONTH END DATE             03803652
038100* INVENTORY DATES AND "LAST YEAR" FSCL MONTH END DATE             03803752
038200***************************************************************** 03803852
031300 8050-GET-PREV-SEA-END-DTE-53WK.                                  03803952
038400                                                                  03804052
038500     EXEC SQL                                                     03804152
038600        SELECT A.PREV_SEA_END_DTE                                 03804252
038600              ,A.LY_THIS_DAY_KY_DTE                               03804352
039700              ,B.PREV_SEA_END_DTE                                 03804452
039700        INTO  :PV-TY-PREV-SEA-END-DTE                             03804552
039700             ,:DTATTR-LY-THIS-DAY-KY-DTE                          03804652
039700             ,:PV-LY-PREV-SEA-END-DTE                             03804752
040800         FROM TDTATTR A                                           03804852
040800             ,TDTATTR B                                           03804952
041500        WHERE A.KY_DTE = DATE(:DTATTR-KY-DTE) - 7 DAYS            03805052
041500          AND B.KY_DTE = A.LY_THIS_DAY_KY_DTE                     03805152
044400     END-EXEC.                                                    03805352
044500                                                                  03805452
044600     EVALUATE TRUE                                                03805552
044700         WHEN SQLCODE = ZERO                                      03805652
044800             CONTINUE                                             03805752
045800         WHEN OTHER                                               03805852
045900             MOVE '8050-GET-PREV-SEA-END-DTE-53WK'                03805954
046000                                    TO PV-PARAGRAPH-NAME          03806052
046100             MOVE 'SELECT ROW FROM TDTATTR'                       03806152
046200                                    TO PV-DB2-OPER-ATTEMPTED      03806252
046300             PERFORM 9998-SQL-ABEND                               03806352
046400     END-EVALUATE.                                                03806452
046500                                                                  03806552
038000***************************************************************** 03807052
038100* GET THE "MAJOR CLASS LEVEL" PREV SEASON ENDING INVENTORY AMTS   03810017
038100* (THIS CALL IS USED TO GET "THIS YR" AND "LAST YR" AMTS)         03811003
038200***************************************************************** 03820000
031300 8100-GET-MCL-END-INV.                                            03821041
038400                                                                  03840000
038500     EXEC SQL                                                     03850000
038600        SELECT END_INV_RTL_AMT                                    03860033
038700              ,END_INV_COST_AMT                                   03870033
039700        INTO  :VAMCL-END-INV-RTL-AMT                              03970033
039800             ,:VAMCL-END-INV-COST-AMT                             03980033
040800         FROM TVAMCL                                              04080033
042100        WHERE FSCL_MN_END_DTE = :VAMCL-FSCL-MN-END-DTE            04160035
042000          AND DEPT_NBR        = :ML202-DEPT-NBR                   04200035
042000          AND MAJ_CL_NBR      = :ML202-MAJ-CL-NBR                 04200135
042000          AND ENT_ID          = :ML202-ENT-ID                     04201035
044400     END-EXEC.                                                    04440000
044500                                                                  04450000
044600     EVALUATE TRUE                                                04460000
044700         WHEN SQLCODE = ZERO                                      04470000
044800             CONTINUE                                             04480003
044900         WHEN SQLCODE = +100                                      04490000
045700             MOVE ZEROS TO VAMCL-END-INV-RTL-AMT                  04570036
                                 VAMCL-END-INV-COST-AMT                 04571036
045800         WHEN OTHER                                               04580000
045900             MOVE '8100-GET-MCL-END-INV'                          04590041
046000                                    TO PV-PARAGRAPH-NAME          04600000
046100             MOVE 'SELECT ROW FROM TVAMCL'                        04610033
046200                                    TO PV-DB2-OPER-ATTEMPTED      04620000
046300             PERFORM 9998-SQL-ABEND                               04630000
046400     END-EVALUATE.                                                04640000
046500                                                                  04650035
038000***************************************************************** 04663017
038100* GET THE "DEPT LEVEL" PREV SEASON ENDING INVENTORY AMOUNTS       04670017
038100* (THIS CALL IS USED TO GET "THIS YR" AND "LAST YR" AMTS)         04680003
038200***************************************************************** 04690003
031300 8200-GET-DPT-END-INV.                                            04700041
038400                                                                  04710003
038500     EXEC SQL                                                     04720003
038600        SELECT END_INV_RTL_AMT                                    04722037
038700              ,END_INV_COST_AMT                                   04723037
039700        INTO  :VADPT-END-INV-RTL-AMT                              04729837
039800             ,:VADPT-END-INV-COST-AMT                             04729937
040800         FROM TVADPT                                              04730037
042100        WHERE FSCL_MN_END_DTE = :VADPT-FSCL-MN-END-DTE            04730137
042000          AND DEPT_NBR        = :ML202-DEPT-NBR                   04730237
042000          AND ENT_ID          = :ML202-ENT-ID                     04730437
044400     END-EXEC.                                                    04730537
044500                                                                  04730603
044600     EVALUATE TRUE                                                04730703
044700         WHEN SQLCODE = ZERO                                      04730803
044800             CONTINUE                                             04730903
044900         WHEN SQLCODE = +100                                      04731003
                   MOVE ZEROS TO VADPT-END-INV-RTL-AMT                  04731137
                                 VADPT-END-INV-COST-AMT                 04732037
045800         WHEN OTHER                                               05010003
045900             MOVE '8200-GET-DPT-END-INV'                          05020041
046000                                    TO PV-PARAGRAPH-NAME          05030003
046100             MOVE 'SELECT ROW FROM TDTATTR/TVADPT'                05040016
046200                                    TO PV-DB2-OPER-ATTEMPTED      05050003
046300             PERFORM 9998-SQL-ABEND                               05060003
046400     END-EVALUATE.                                                05070003
046500                                                                  05080003
055500***************************************************************** 05428000
055600* BUILD SQL ABEND INFO                                            05430000
055700***************************************************************** 05440000
055800 9998-SQL-ABEND.                                                  05450000
055900                                                                  05460000
056000     MOVE +4013 TO ABEND-CODE.                                    05470000
056100     DISPLAY ' '.                                                 05480000
056200     DISPLAY '** ABEND **         ** = SQLERROR'.                 05490000
056300     DISPLAY '** PROGRAM          ** = MLKUT603'.                 05500050
056400     DISPLAY '** PARAGRAPH        ** = ' PV-PARAGRAPH-NAME.       05510000
056500     DISPLAY '** OPERATION        ** = ' PV-DB2-OPER-ATTEMPTED.   05520000
056600                                                                  05530000
056700*    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE         05540000
056800*    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.        05550000
056900     COPY DPPD004.                                                05560000
057000                                                                  05570000
057100     PERFORM 9999-ABEND.                                          05580000
057200                                                                  05590000
057300***************************************************************** 05600000
057400* ABEND PROCESSING                                                05610000
057500***************************************************************** 05620000
057600 9999-ABEND.                                                      05630000
057700                                                                  05640000
057800     CALL 'ILBOABN0'  USING ABEND-CODE.                           05650000
