000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    RCKCS802.                                         00020000
000300 AUTHOR.        KAREN WALL                                        00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  10-16-99.                                         00050000
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800*---------------------------------------------------------------* 00080000
000900*    E802 - RECEIVER ADD DETAIL LIST PROGRAM                    * 00090000
001000*                                                               * 00100000
001100*    THIS PROGRAM HAS THE TWO FUNCTIONS:                        * 00110000
001200*           1.  IF THERE IS A LINE MISSING FROM A PACK ON THE   * 00120000
001300*    RECEIVING SIDE, BUT IS ON THE PO SIDE, IT WILL DISPLAY ALL * 00130000
001400*    OF THE LINES THAT ARE IN THE PACK ON THE PO SIDE BUT ARE   * 00140000
001500*    MISSING ON THE RECEIVING SIDE.                             * 00150000
001600*                                                               * 00160000
001700*           2.  IF AN ENTIRE PACK IS MISSING FROM A RECEIVER ON * 00170000
001800*    THE RECEIVING SIDE, BUT IS ON THE PO SIDE (OR IS IN A      * 00180000
001900*    DIFFERENT PACK ON THE PO SIDE THAN ON RECEIVING), ALL OF   * 00190000
002000*    THE LINES WITHIN THE PACK WILL DISPLAY.  WHEN THE USER     * 00200000
002100*    HITS F13 TO ADD, THIS PROGRAM WILL ADD ALL OF THE LINES    * 00210000
002200*    (OR UPDATE ALL OF THE LINES) ON RECITM.                    * 00220000
002300*                                                               * 00230000
002400*                                                               * 00240000
002500*---------------------------------------------------------------* 00250000
002600* MAINTENANCE:                                                  * 00260000
002610*    SUE BARTELT   01/03/14   SEBSEB                            * 00261099
002620*      MTK PROJECT - PACKAGE CODE CHANGES. CHG0081355.          * 00262099
002630*        CHANGES IN PARAGRAPHS:                                 * 00263099
002640*            9500-CALL-VALIDATION-MODULE                        * 00264099
002660*---------------------------------------------------------------* 00266099
002680* CHANGED 11/11/2021    BY JIM HUNTER      WR: CHG0263784         00268099
002690* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00269099
002700* MAKING THE CALL DYNAMIC VS STATIC.                              00270099
002710*---------------------------------------------------------------* 00271099
002800/                                                                 00280000
002900 ENVIRONMENT DIVISION.                                            00290000
003000                                                                  00300000
003100 DATA DIVISION.                                                   00310000
003200                                                                  00320000
003300 WORKING-STORAGE SECTION.                                         00330000
003400                                                                  00340000
003500 01  DK-DB2-KEYS.                                                 00350000
003600*    REQUIRED FIELDS                                              00360000
003700     05  DK-ORD-NBR                     PIC S9(09)  COMP.         00370000
003800     05  DK-REC-SEQ-NBR                 PIC S9(09)  COMP.         00380000
003900     05  DK-LINE-NBR                    PIC S9(04)  COMP.         00390000
004000     05  DK-OPER-UNT-ID                 PIC S9(04)  COMP.         00400000
004100     05  DK-FACT                        PIC S9(04)  COMP.         00410000
004200     05  DK-PACK-ID                     PIC S9(04)  COMP.         00420000
004300                                                                  00430000
004400     05  DK-TICKET-DESC               PIC X(20) VALUE SPACE.      00440000
004500     05  DK-DEPT-NBR                  PIC X(03) VALUE SPACES.     00450000
004600                                                                  00460000
004700*    OPTIONAL FIELDS                                              00470000
004800     05  DK-AGRMT-TYP-ID              PIC X(01)  VALUE SPACES.    00480000
004900     05  DK-TYP-CDE                   PIC S9(04) COMP VALUE +0.   00490000
005000     05  DK-MERCH-DEPT-NMBR           PIC X(03) VALUE SPACE.      00500000
005100     05  DK-MERCH-CLASS-NMBR          PIC X(03) VALUE SPACE.      00510000
005200     05  DK-SUBCLASS-NBR              PIC X(03) VALUE SPACE.      00520000
005300     05  DK-MAJCLASS-NBR              PIC X(02) VALUE SPACE.      00530000
005400     05  DK-TKT-TYP-SEQ-NBR           PIC S9(4) COMP VALUE +0.    00540000
005500                                                                  00550000
005600     05  DK-MDSEAR-ID                 PIC S9(9) COMP VALUE +0.    00560000
005700     05  DK-ENT-ID                    PIC S9(09)       COMP.      00570000
005710     05  DK-SKU-SEQ                   PIC X(03).                  00571099
005720     05  DK-ITM-NBR                   PIC S9(15)V COMP-3.         00572099
005730                                                                  00573099
005740 01  PC-PROGRAM-CONSTANTS.                                        00574099
005750     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00575099
005760                                                    'RC802A  '.   00576099
005770     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00577099
005780                                                    'RCKM802 '.   00578099
005790     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00579099
005800                                                    'RCKCS802'.   00580099
005810     05  PC-WMS-CONTROL-MOD           PIC X(8)  VALUE  'WSKCS305'.00581099
005900     05  PC-CURRENT-DATE              PIC X(10) VALUE SPACE.      00590099
006000     05  PC-APPL-MAP                    PIC S9(04)  VALUE  +1     00600099
006100                                                    COMP.         00610099
006200     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00620099
006300     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00630099
006400     05  PC-INTER-APPL-CODES.                                     00640099
006500         10 PC-INTER-APPL-PACK-ADD      PIC  X(01)  VALUE '1'.    00650099
006600         10 PC-INTER-APPL-PACK-LINE-ADD PIC  X(01)  VALUE '2'.    00660099
006700     05  PC-TROUBLE-RTN               PIC X(08)  VALUE 'TMKCS520'.00670099
006800     05  PC-LINE-TROUBLE-RTN-LENGTH   PIC S9(04) VALUE +600       00680099
006900                                                 COMP.            00690099
007000     05  PC-WORK-ORDER-DIST-SHEET       PIC  9(03)  VALUE 001.    00700099
007100     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +9      00710099
007200                                                    COMP SYNC.    00720099
007300     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00730099
007400                                                    COMP SYNC.    00740099
007500     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00750099
007600                                                    +1000000      00760099
007700                                                    COMP-3.       00770099
007800     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +7      00780099
007900                                                    COMP SYNC.    00790099
008000     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE +3      00800099
008100                                                    COMP-3.       00810099
008200     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    00820099
008300     05  PC-A                           PIC  X(01)  VALUE 'A'.    00830099
008400     05  PC-X                           PIC  X(01)  VALUE 'X'.    00840099
008500     05  PC-R                           PIC  X(01)  VALUE 'R'.    00850099
008600     05  PC-S                           PIC  X(01)  VALUE 'S'.    00860099
008700     05  PC-T                           PIC  X(01)  VALUE 'T'.    00870099
008800     05  PC-Y                           PIC  X(01)  VALUE 'Y'.    00880099
008900     05  PC-N                           PIC  X(01)  VALUE 'N'.    00890099
009000     05  PC-I                           PIC  X(01)  VALUE 'I'.    00900099
009100     05  PC-ADD                         PIC  X(03)  VALUE 'ADD'.  00910099
009200     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00920099
009300     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00930099
009400     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00940099
009500     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00950099
009600     05  PC-VE                          PIC  X(02)  VALUE 'VE'.   00960099
009700     05  PC-STAT-CDE-AP                 PIC  X(02)  VALUE 'AP'.   00970099
009800     05  PC-STAT-CDE-IP                 PIC  X(02)  VALUE 'IP'.   00980099
009900     05  PC-STAT-CDE-AC                 PIC  X(02)  VALUE 'AC'.   00990099
010000     05  PC-STAT-CDE-CM                 PIC  X(02)  VALUE 'CM'.   01000099
010100     05  PC-STAT-CDE-RV                 PIC  X(02)  VALUE 'RV'.   01010099
010200     05  PC-STAT-CDE-ACTIVE             PIC  X(01)  VALUE 'A'.    01020099
010300     05  PC-DEFAULT-TMST              PIC  X(26) VALUE            01030099
010400                             '9999-09-09-09.09.09.999999'.        01040099
010500     05  PC-DEFAULT-DATE              PIC X(10) VALUE             01050099
010600                                                '9999-09-09'.     01060099
010700     05  PC-LONG-ZERO                 PIC S9(9) VALUE +0          01070099
010800                                                COMP.             01080099
010900     05  PC-SUBCLASS-MDSELV-CDE      PIC X(03) VALUE 'SCL'.       01090099
011000     05  PC-MAJCLASS-MDSELV-CDE      PIC X(03) VALUE 'MCL'.       01100099
011100     05  PC-DPT-MDSELV-CDE           PIC X(03) VALUE 'DPT'.       01110099
011200     05  PC-VS-TICKET-TYPE-CDE       PIC S9(04) COMP              01120099
011300                                                VALUE +2.         01130099
011400                                                                  01140099
011500     05  PC-TSYMSG-NUMBERS.                                       01150099
011600         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  01160099
011700         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  01170099
011800         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  01180099
011900         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  01190099
012000         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  01200099
012100         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  01210099
012200         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  01220099
012300         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  01230099
012400         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  01240099
012500         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  01250099
012600         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  01260099
012700         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  01270099
012800         10  PC-TSYMSG-00117            PIC  9(05)  VALUE 00117.  01280099
012900         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01290099
013000         10  PC-TSYMSG-00551            PIC  9(05)  VALUE 00551.  01300099
013100         10  PC-TSYMSG-00883            PIC  9(05)  VALUE 00883.  01310099
013200*  P.O. NUMBER REQUIRED                                           01320099
013300         10  PC-TSYMSG-01002            PIC  9(05)  VALUE 01002.  01330099
013400*                                                                 01340099
013500         10  PC-TSYMSG-01293            PIC  9(05)  VALUE 01293.  01350099
013510         10  PC-TSYMSG-03546            PIC  9(05)  VALUE 03546.  01351099
013520         10  PC-TSYMSG-03138            PIC  9(05)  VALUE 03138.  01352099
013600*                                                                 01360099
013700         10  PC-TSYMSG-02161            PIC  9(05)  VALUE 02161.  01370099
013800*   UPDATE (S) SUCCESSFUL - REDISTRO PERFORMED                    01380099
013900         10  PC-TSYMSG-02167            PIC  9(05)  VALUE 02167.  01390099
014000*   ALL LINES WERE ADDED TO PACK, GO TO PACK DTL LIST TO MAINTAIN.01400099
014100         10  PC-TSYMSG-02229            PIC  9(05)  VALUE 02229.  01410099
014200*A PREPACK SYSTEM ERROR HAS OCCURRED (&VAR). PLEASE CONTACT HELP D01420099
014300         10  PC-TSYMSG-02239            PIC  9(05)  VALUE 02239.  01430099
014400*  UPDATE SUCCESSFUL - UNABLE TO REDISTO DUE TO TROUBLE           01440099
014500         10  PC-TSYMSG-02286            PIC  9(05)  VALUE 02286.  01450099
014600*  ALL LINES WERE ADDED TO PACK, GO TO PACK DTL LIST TO REVIEW.   01460099
014700                                                                  01470099
014800*----------------------------------------------------------------*01480099
014900* INCLUDED NEW CONSTANTS PC-000 AND PC-999.          WR # 230ZZ  *01490099
015000*----------------------------------------------------------------*01500099
015100     05  PC-000                       PIC X(03) VALUE '000'.      01510099
015200     05  PC-999                       PIC X(03) VALUE '999'.      01520099
015300*----------------------------------------------------------------*01530099
015400* CHANGES MADE FOR WR # 230ZZ ENDS HERE.                         *01540099
015500*----------------------------------------------------------------*01550099
015600 01  PS-PROGRAM-SWITCHES.                                         01560099
015700     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01570099
015800         88  PS-NO-ERROR                            VALUE 'Y'.    01580099
015900         88  PS-ERROR                               VALUE 'N'.    01590099
015910     05  PS-ORIG-ASN-PKSLIP-SW        PIC  X     VALUE 'N'.       01591099
015920         88  PS-ORIG-ASN-PKSLIP-YES              VALUE 'Y'.       01592099
015930         88  PS-ORIG-ASN-PKSLIP-NO               VALUE 'N'.       01593099
016000     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01600099
016100         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01610099
016200         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01620099
016300     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    01630099
016400         88  PS-DONE                                VALUE 'Y'.    01640099
016500         88  PS-NOT-DONE                            VALUE 'N'.    01650099
016600     05  PS-VERIFIED-RECEIVER-SW        PIC  X(01)  VALUE 'N'.    01660099
016700         88  PS-VERIFIED-RECEIVER                   VALUE 'Y'.    01670099
016800     05  PS-INACTIVE-EXISTS-SW        PIC X(01)  VALUE 'N'.       01680099
016900         88  PS-INACTIVE-EXISTS                  VALUE 'Y'.       01690099
017000     05  PS-PRETICKET-SW              PIC X      VALUE 'N'.       01700099
017100         88  PS-NOT-PRETICKET                    VALUE 'N'.       01710099
017200         88  PS-PRETICKET                        VALUE 'Y'.       01720099
017300     05  PS-VSM-SW                    PIC X      VALUE 'N'.       01730099
017400         88  PS-NOT-VSM                          VALUE 'N'.       01740099
017500         88  PS-VSM                              VALUE 'Y'.       01750099
017600     05  PS-PREV-PACK-UNTIED-SW       PIC X      VALUE 'N'.       01760099
017700         88  PS-PREV-PACK-TIED                   VALUE 'N'.       01770099
017800         88  PS-PREV-PACK-UNTIED                 VALUE 'Y'.       01780099
017900     05  PS-DUPLICATE-SW                PIC  X(01)  VALUE 'Y'.    01790099
018000         88  PS-NO-DUPLICATE                        VALUE 'Y'.    01800099
018100         88  PS-DUPLICATE                           VALUE 'N'.    01810099
018110     05  PS-ASNS-TO-WMS-SW            PIC X(01) VALUE 'N'.        01811099
018120         88  PS-ASNS-TO-WMS-YES                 VALUE 'Y'.        01812099
018130         88  PS-ASNS-TO-WMS-NO                  VALUE 'N'.        01813099
018200*----------------------------------------------------------------*01820099
018300*  INCLUDED PROGRAM SWITCHES FOR XLKUT001       **   WR # 230ZZ  *01830099
018400*----------------------------------------------------------------*01840099
018500     05  PS-CALL-API-SW                 PIC  X   VALUE 'N'.       01850099
018600         88  PS-CALL-API-NO                      VALUE 'N'.       01860099
018700         88  PS-CALL-API-YES                     VALUE 'Y'.       01870099
018800*----------------------------------------------------------------*01880099
018900* CHANGES MADE FOR WR # 230ZZ ENDS HERE.                         *01890099
018910*----------------------------------------------------------------*01891099
018920                                                                  01892099
018930                                                                  01893099
018940 01  PV-PROGRAM-VARIABLES.                                        01894099
018950     05  PV-SUB                         PIC S9(04)  VALUE +0      01895099
018960                                                    COMP SYNC.    01896099
018970     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01897099
018980                                                    COMP SYNC.    01898099
018990     05  PV-VALID-IDX                 PIC S9(04) VALUE +0         01899099
019000                                                 COMP SYNC.       01900099
019100     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01910099
019200                                                    COMP-3.       01920099
019300     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01930099
019400                                                    COMP-3.       01940099
019410     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     01941099
019420                                                     COMP SYNC.   01942099
019430     05  PV-CICS-MSG-AREA             PIC X(75)  VALUE SPACE.     01943099
019500     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01950099
019600                                                    COMP-3.       01960099
019700     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01970099
019800                                                    COMP-3.       01980099
019900     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01990099
020000                                                    COMP-3.       02000099
020100     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      02010099
020200                                                    COMP-3.       02020099
020300     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      02030099
020400                                                    COMP-3.       02040099
020500     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      02050099
020600                                                    COMP SYNC.    02060099
020700     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      02070099
020800                                                    COMP SYNC.    02080099
020900     05  PV-ITEM                        PIC S9(04)  VALUE +0      02090099
021000                                                    COMP SYNC.    02100099
021010     05  PV-ORIG-PKSL-ITM-QTY           PIC S9(9)   VALUE ZERO    02101099
021020                                                    COMP.         02102099
021100     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      02110099
021200                                                    COMP SYNC.    02120099
021300     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      02130099
021400                                                    COMP SYNC.    02140099
021500     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      02150099
021600                                                    COMP SYNC.    02160099
021700     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      02170099
021800                                                    COMP SYNC.    02180099
021900     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      02190099
022000                                                    COMP SYNC.    02200099
022100     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      02210099
022200                                                    COMP SYNC.    02220099
022300     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      02230099
022400                                                    COMP SYNC.    02240099
022500     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      02250099
022600                                                    COMP SYNC.    02260099
022700     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      02270099
022800                                                    COMP SYNC.    02280099
022900     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      02290099
023000                                                    COMP SYNC.    02300099
023100     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      02310099
023200                                                    COMP SYNC.    02320099
023300     05  PV-DB2-COUNT                   PIC S9(09)  VALUE +0      02330099
023400                                                    COMP-3.       02340099
023500     05  PV-UNRSLVD-TRBL-COUNT          PIC S9(09)  VALUE ZERO    02350099
023600                                                    COMP-3.       02360099
023700     05  PV-RSLVD-TRBL-COUNT            PIC S9(09)  VALUE ZERO    02370099
023800                                                    COMP-3.       02380099
023900     05  PV-VERIFY-ITM-QTY              PIC S9(05)  VALUE +0      02390099
024000                                                    COMP.         02400099
024100     05  PV-TROUBLE-COUNT             PIC 9(03)    VALUE ZEROS.   02410099
024200     05  PV-NOT-IN-TROUBLE-COUNT      PIC 9(03)    VALUE ZEROS.   02420099
024300     05  PV-PACK-BY-ST-IND            PIC X(01)    VALUE SPACE.   02430099
024400         88  PV-PACK-BY-ST-IND-YES                 VALUE 'Y'.     02440099
024500                                                                  02450099
024600     05  PV-PO-NBR                    PIC S9(09)   COMP           02460099
024700                                                   VALUE ZERO.    02470099
024800     05  PV-REC-SEQ-NBR               PIC S9(09)   COMP           02480099
024900                                                   VALUE ZERO.    02490099
025000     05  PV-DRIVER-LINE-NBR           PIC S9(04)  COMP.           02500099
025100     05  PV-NBR-OF-PIC-AD             PIC S9(04) COMP.            02510099
025200     05  PV-NULL-IND                  PIC S9(04) VALUE +0         02520099
025300                                                 COMP.            02530099
025310     05  PV-COUNTER                   PIC S9(04) VALUE +0         02531099
025320                                                 COMP.            02532099
025400     05  DN-TKT-FMT-ID                PIC S9(04) VALUE +0         02540099
025500                                                 COMP.            02550099
025600*----------------------------------------------------------------*02560099
025700*                                               WR # 230ZZ       *02570099
025800* COMMENTED EXISTING CODE FOR PV-SKU.                            *02580099
025900* ADDED CODE FOR PV-SKU, DASHES IN BETWEEN FIELDS HAVE BEEN      *02590099
026000* REPLACED WITH SPACES.                                          *02600099
026100* SEQUENCE NUMBER FIELD SIZE HAS BEEN INCREASED FROM 3 CHARACTERS*02610099
026200* TO 8 CHARACTERS.                                               *02620099
026210*                                                                *02621099
026220* ADDED TEMPORARY VARIABLE - PV-TEMP-SEQ-NBR.                    *02622099
026230* ADDED NEW VARIABLES - DK-SKU-SEQ, DK-ITM-NBR , PV-TEMP-TKT-TYPE*02623099
026240*----------------------------------------------------------------*02624099
026250*    05  PV-SKU.                                                  02625099
026260*        10  PV-SKU-DEPT               PIC X(03).                 02626099
026270*        10  FILLER                    PIC X(01)                  02627099
026280*                                             VALUE '-'.          02628099
026290*        10  PV-SKU-CL                 PIC X(02).                 02629099
026291*        10  FILLER                    PIC X(01)                  02629199
026292*                                             VALUE '-'.          02629299
026293*        10  PV-SKU-SEQ                PIC X(03).                 02629399
026294     05  PV-SKU.                                                  02629499
026295         10  PV-SKU-DEPT               PIC X(03).                 02629599
026296         10  FILLER                    PIC X(01)                  02629699
026297                                              VALUE SPACE.        02629799
026298         10  PV-SKU-CL                 PIC X(02).                 02629899
026299         10  FILLER                    PIC X(01)                  02629999
026300                                              VALUE SPACE.        02630099
026400         10  PV-SKU-SEQ                PIC X(08).                 02640099
026500     05  PV-DISP-CL-SKU.                                          02650099
026600         10  PV-DISP-CL                PIC X(02).                 02660099
026700         10  FILLER                    PIC X(01)                  02670099
026800                                              VALUE SPACE.        02680099
026900         10  PV-DISP-SKU               PIC X(08).                 02690099
027000     05  PV-TEMP-SEQ-NBR               PIC 9(8).                  02700099
027010     05  PV-DEPT-NBR                   PIC X(03).                 02701099
027011     05  PV-TEMP-TKT-TYPE              PIC X(20).                 02701199
027012*----------------------------------------------------------------*02701299
027013* CHANGES MADE FOR WR # 230ZZ ENDS HERE.                         *02701399
027014*----------------------------------------------------------------*02701499
027015     05  PV-CRE-TMST.                                             02701599
027016         10  FILLER                     PIC X(02).                02701699
027017         10  PV-CRE-YY                  PIC X(02).                02701799
027400         10  FILLER                     PIC X(01).                02740000
027500         10  PV-CRE-MM                  PIC X(02).                02750000
027600         10  FILLER                     PIC X(01).                02760000
027700         10  PV-CRE-DD                  PIC X(02).                02770000
027800         10  FILLER                     PIC X(01).                02780000
027900         10  PV-CRE-HRS                 PIC X(02).                02790000
028000         10  FILLER                     PIC X(01).                02800000
028100         10  PV-CRE-MIN                 PIC X(02).                02810000
028200         10  FILLER                     PIC X(10).                02820000
028300     05  PV-CREATE-DTE.                                           02830000
028400         10  PV-CREATE-MM               PIC X(02).                02840000
028500         10  FILLER                     PIC X(01) VALUE '/'.      02850000
028600         10  PV-CREATE-DD               PIC X(02).                02860000
028700         10  FILLER                     PIC X(01) VALUE '/'.      02870000
028800         10  PV-CREATE-YY               PIC X(02).                02880000
028900     05  PV-CREATE-TME.                                           02890000
029000         10  PV-CREATE-HRS              PIC X(02).                02900000
029100         10  FILLER                     PIC X(01) VALUE ':'.      02910000
029200         10  PV-CREATE-MIN              PIC X(02).                02920000
029300     05  PV-UNPACK-OPER-UNT-ID          PIC 9(04) VALUE ZERO.     02930099
030100     05  PV-RETRY-COUNTER             PIC S9(4) VALUE ZERO        03010000
030200                                                COMP SYNC.        03020000
030300     05  PV-RV-COUNTER                PIC S9(9) VALUE ZERO        03030000
030400                                                COMP-3.           03040000
030500     05  PV-NUMBER-OF-RV-ITEMS        PIC S9(2) VALUE ZERO.       03050000
030600                                                                  03060000
030700*---------------------------------------------------------------* 03070000
030800*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   * 03080000
030900*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           * 03090000
031000*   APPLICATION-SPECIFIC COMMAREA.                              * 03100000
031100*---------------------------------------------------------------* 03110000
031110*----------------------------------------------------------------*03111000
031120*                                                **   WR # 230ZZ *03112000
031130* CHANGE THE STRUCTURE OF LQW TO MATCH WITH ASC STRUCTURE        *03113000
031140*----------------------------------------------------------------*03114000
031200 01  LQW-LIST-QUEUE-WORK-AREA.                                    03120000
031300     05  LQW-BLOCK-MODIFIED             PIC X(01)   VALUE SPACE.  03130000
031400     05  LQW-ITEM-ENTRIES               OCCURS 9 TIMES            03140000
031500                                        INDEXED BY LQW-IDX.       03150000
031600         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       03160000
031700         10  LQW-TEMP-SELECTED-SW       PIC X(01).                03170000
031800         10  LQW-SELECTED-SW            PIC X(01).                03180000
031900             88  LQW-SELECT                         VALUE 'S'.    03190000
032000             88  LQW-DESELECT                       VALUE ' '.    03200000
032100         10  LQW-ACTION                 PIC X(3).                 03210000
032200         10  LQW-PACK-ID                PIC X(03).                03220000
032300         10  LQW-PACK-ID-N              REDEFINES                 03230000
032400             LQW-PACK-ID                PIC 9(03).                03240000
032500         10  LQW-PACK-DESC              PIC X(15).                03250000
032600         10  LQW-LINE-NUMBER            PIC 9(4).                 03260000
032700         10  LQW-ENT-ID                 PIC S9(09)                03270000
032800                                            COMP.                 03280000
032810*        10  LQW-SKU.                                             03281099
032820*            15  LQW-DEPT               PIC X(03).                03282099
032830*            15  FILLER                 PIC X(01).                03283099
032840*            15  LQW-CL                 PIC X(02).                03284099
032850*            15  FILLER                 PIC X(01).                03285099
032860*            15  LQW-SEQ                PIC X(03).                03286099
032870         10  LQW-SKU.                                             03287099
032880             15  LQW-DEPT               PIC X(03).                03288099
032890             15  FILLER                 PIC X(01).                03289099
032900             15  LQW-CL                 PIC X(02).                03290099
033000             15  FILLER                 PIC X(01).                03300099
033400             15  LQW-SEQ                PIC X(08).                03340099
033401                                                                  03340100
033500         10  LQW-SKU-DESC               PIC X(25).                03350000
033600         10  LQW-ITM-NBR                PIC S9(15)V               03360000
033700                                            COMP-3.               03370000
033800         10  LQW-VER-NBR                PIC S9(09)                03380000
033900                                            COMP.                 03390000
034000         10  LQW-PO-PACK-RATIO          PIC 9(3).                 03400000
034100         10  LQW-OTR                    PIC 9(5).                 03410000
034200         10  LQW-STATUS-CDE             PIC X(2).                 03420000
034300         10  LQW-CASE-PACK-QTY          PIC 9(03) COMP.           03430000
034400         10  LQW-PURITM-UNT-QTY         PIC S9(09)                03440000
034500                                            COMP.                 03450000
034600         10  LQW-PURITM-UNT-RTL-PR-AMT  PIC S9(06)V99             03460000
034700                                            COMP-3.               03470000
034800         10  LQW-PURITM-GP-RTL-AMT      PIC S9(05)V99             03480000
034900                                            COMP-3.               03490000
035000         10  LQW-PURITM-GP-QTY          PIC S9(04)                03500000
035100                                            COMP.                 03510000
035200         10  LQW-PURITM-VEND-STYL-NAME  PIC X(08).                03520000
035300         10  LQW-LINE-TRBL-SW           PIC X(01).                03530000
035400         10  LQW-LNE-REVISE-TRBL-SW     PIC X(01).                03540000
035500                                                                  03550000
035510*----------------------------------------------------------------*03551000
035520*   CHANGES MADE FOR WR # 230ZZ ENDS HERE.                        03552000
035530*----------------------------------------------------------------*03553000
035600                                                                  03560000
035700                                                                  03570000
035800*----------------------------------------------------------------*03580000
035900*    COPYBOOK FOR THE FIELDS PASSED TO THE TROUBLE SUBROUTINE     03590000
036000*----------------------------------------------------------------*03600000
036100     COPY TMWS500.                                                03610000
036200                                                                  03620000
036300/                                                                 03630000
036400*---------------------------------------------------------------* 03640000
036500*  RECORD LAYOUT FOR THE PACK VALIDATION MODULE.                * 03650000
036600*---------------------------------------------------------------* 03660000
036700                                                                  03670000
036800     COPY RCWS806.                                                03680000
036900                                                                  03690000
037000*---------------------------------------------------------------* 03700000
037100*  RECORD LAYOUT FOR THE PACK OPEN TO RECEIVE MODULE.           * 03710000
037200*---------------------------------------------------------------* 03720000
037300                                                                  03730000
037400     COPY DPWS277.                                                03740000
037500                                                                  03750000
037600*---------------------------------------------------------------* 03760000
037700*  RECORD LAYOUT FOR THE LIST SELECTION TEMP STORAGE QUEUE.     * 03770000
037800*---------------------------------------------------------------* 03780000
037900                                                                  03790000
038000     COPY RCWS801.                                                03800000
038100                                                                  03810000
038200*---------------------------------------------------------------* 03820000
038300*  RECORD LAYOUT FOR THE PACKSLIP SELECTION TEMP STORAGE QUEUE. * 03830000
038400*---------------------------------------------------------------* 03840000
038500                                                                  03850000
038600     COPY RCWS013.                                                03860000
038601/                                                                 03860199
038610***************************************************************** 03861099
038620* COPYBOOK FOR WMS VENDOR SHIPMENT CONTROL MODULE               * 03862099
038630***************************************************************** 03863099
038640     COPY WSWS001.                                                03864099
038700                                                                  03870000
038800/                                                                 03880000
038900*---------------------------------------------------------------* 03890000
039000*    MAP LAYOUT                                                 * 03900000
039100*---------------------------------------------------------------* 03910000
039200                                                                  03920000
039300     COPY RCKM802.                                                03930000
039400/                                                                 03940000
039410*----------------------------------------------------------------*03941000
039420*                                                    WR # 230ZZ  *03942000
039430* CHANGED THE FILLER OF MR-OCCURS-LAYOUT FROM X(138) TO X(146)   *03943099
039440* AS A NEW FIELD DEPT IS ADDED IN THE MAP RCKM802.               *03944000
039450*----------------------------------------------------------------*03945000
039500 01  MR-OCCURS-LAYOUT                   REDEFINES  RC802AO.       03950000
039600*    05  FILLER                         PIC X(138).               03960000
039610     05  FILLER                         PIC X(146).               03961099
039700     05  MR-SCROLL-AREA                 OCCURS 09 TIMES.          03970000
039800         10  MR-SELECTL                 PIC S9(04) COMP.          03980000
039900         10  MR-SELECTA                 PIC  X(01).               03990000
040000         10  MR-SELECTC                 PIC  X(01).               04000000
040100         10  MR-SELECTH                 PIC  X(01).               04010000
040200         10  MR-SELECT                  PIC  X(01).               04020000
040300                                                                  04030000
040400         10  MR-ACTL                    PIC S9(04) COMP.          04040000
040500         10  MR-ACTA                    PIC  X(01).               04050000
040600         10  MR-ACTC                    PIC  X(01).               04060000
040700         10  MR-ACTH                    PIC  X(01).               04070000
040800         10  MR-ACT                     PIC  X(03).               04080000
040900                                                                  04090000
041000         10  MR-PACK-IDL                PIC S9(04) COMP.          04100000
041100         10  MR-PACK-IDA                PIC  X(01).               04110000
041200         10  MR-PACK-IDC                PIC  X(01).               04120000
041300         10  MR-PACK-IDH                PIC  X(01).               04130000
041400         10  MR-PACK-ID                 PIC  X(03).               04140000
041500                                                                  04150000
041600         10  MR-PACK-DESCL              PIC S9(04) COMP.          04160000
041700         10  MR-PACK-DESCA              PIC  X(01).               04170000
041800         10  MR-PACK-DESCC              PIC  X(01).               04180000
041900         10  MR-PACK-DESCH              PIC  X(01).               04190000
042000         10  MR-PACK-DESC               PIC  X(15).               04200000
042100                                                                  04210000
042200         10  MR-LINEL                   PIC S9(04) COMP.          04220000
042300         10  MR-LINEA                   PIC  X(01).               04230000
042400         10  MR-LINEC                   PIC  X(01).               04240000
042500         10  MR-LINEH                   PIC  X(01).               04250000
042600         10  MR-LINE.                                             04260000
042700             15  MR-LINE-N              PIC  ZZZ9.                04270000
042800                                                                  04280000
042900         10  MR-STATUS-CDEL             PIC S9(04) COMP.          04290000
043000         10  MR-STATUS-CDEA             PIC  X(01).               04300000
043100         10  MR-STATUS-CDEC             PIC  X(01).               04310000
043200         10  MR-STATUS-CDEH             PIC  X(01).               04320000
043300         10  MR-STATUS-CDE              PIC  X(02).               04330000
043400                                                                  04340000
043500         10  MR-SKUL                    PIC S9(04) COMP.          04350000
043600         10  MR-SKUA                    PIC  X(01).               04360000
043700         10  MR-SKUC                    PIC  X(01).               04370000
043800         10  MR-SKUH                    PIC  X(01).               04380000
043900*        10  MR-SKU                     PIC  X(10).               04390000
043910         10  MR-SKU                     PIC  X(11).               04391000
044000                                                                  04400000
044100         10  MR-PO-PACK-RATIOL          PIC S9(04) COMP.          04410000
044200         10  MR-PO-PACK-RATIOA          PIC  X(01).               04420000
044300         10  MR-PO-PACK-RATIOC          PIC  X(01).               04430000
044400         10  MR-PO-PACK-RATIOH          PIC  X(01).               04440000
044500         10  MR-PO-PACK-RATIO.                                    04450000
044600             15  MR-PO-PACK-RATIO-N     PIC  ZZ9.                 04460000
044700                                                                  04470000
044800         10  MR-OTRL                    PIC S9(04) COMP.          04480000
044900         10  MR-OTRA                    PIC  X(01).               04490000
045000         10  MR-OTRC                    PIC  X(01).               04500000
045100         10  MR-OTRH                    PIC  X(01).               04510000
045200         10  MR-OTR                     PIC  X(05).               04520000
045300                                                                  04530000
045310*----------------------------------------------------------------*04531000
045320* CHANGES MADE FOR WR # 230ZZ ENDS HERE.                         *04532000
045330*----------------------------------------------------------------*04533000
045400     EJECT                                                        04540000
045500*---------------------------------------------------------------* 04550000
045600*    ATTRIBUTE SETTINGS COPYBOOK.                               * 04560000
045700*---------------------------------------------------------------* 04570000
045800                                                                  04580000
045900     COPY DPWS015.                                                04590000
046000                                                                  04600000
046100*---------------------------------------------------------------* 04610000
046200*    FUNCTION KEYS COPYBOOK.                                    * 04620000
046300*---------------------------------------------------------------* 04630000
046400                                                                  04640000
046500     COPY DPWS016.                                                04650000
046600                                                                  04660000
046700*---------------------------------------------------------------* 04670000
046800*    NUMERIC EDIT LAYOUT.                                       * 04680000
046900*---------------------------------------------------------------* 04690000
047000                                                                  04700000
047100     COPY DPWS010I.                                               04710000
047200                                                                  04720000
047300/                                                                 04730000
047400******************************************************************04740099
047500** THE CALLING PARAMETER LIST (DPWS030/DPWS930) FOR THE CICS    **04750099
047510** ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                    **04751099
047600******************************************************************04760099
047700                                                                  04770000
047800     COPY DPWS030.                                                04780000
047810     COPY DPWS930.                                                04781099
047900                                                                  04790000
048000/                                                                 04800000
048100*---------------------------------------------------------------* 04810000
048200*    STANDARD COMMAREA.                                         * 04820000
048300*---------------------------------------------------------------* 04830000
048400                                                                  04840000
048500     COPY DPWS020.                                                04850000
048600     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                04860000
048700                                                                  04870000
048800*---------------------------------------------------------------* 04880000
048900* INTER-APPLICATION COMMAREA.                                   * 04890000
049000* RCWS012 - INTER-APPLICATION COMMAREA FROM THE PACK SLIP UPDT  * 04900000
049100* RCWS015 - INTER-APPLICATION COMMAREA FROM THE PACK SLIP LIST  * 04910000
049200*---------------------------------------------------------------* 04920000
049300                                                                  04930000
049400         10  INTER-APPL-COMM-AREA       PIC X(200).               04940000
049500     COPY PCWS000.                                                04950000
049600     COPY RCWS800.                                                04960000
049700     COPY POWS017.                                                04970000
049800                                                                  04980000
049900     COPY RCWS012.                                                04990000
050000     COPY RCWS015.                                                05000000
050100*---------------------------------------------------------------* 05010000
050200*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 05020000
050300*---------------------------------------------------------------* 05030000
050400         10  ASC-SPECIFIC-COMMAREA.                               05040000
050500             15  ASC-LIST-KEYS.                                   05050000
050600                 20  ASC-PO-NBR             PIC 9(08).            05060000
050700                 20  ASC-REC-SEQ-NBR        PIC 9(03).            05070000
050800                 20  ASC-STAT               PIC X(02).            05080000
050900                 20  ASC-OPR-ID             PIC ZZZ9.             05090000
051000                 20  ASC-FACT               PIC ZZZ9.             05100000
051100                 20  ASC-FCLTY-DESC         PIC X(25).            05110000
051200                 20  ASC-DRIVER-PACK-ID     PIC 9(03).            05120000
051300                 20  ASC-DEPT-NBR       PIC X(03).                05130000
051310*---------------------------------------------------------------* 05131000
051320*                                              **   WR # 230ZZ  * 05132000
051330* INCREASED THE SIZE OF ASC-TPURITM-SKU-SEQ-NBR FROM X(3) TO    * 05133000
051340* X(8).                                                         * 05134000
051350*---------------------------------------------------------------* 05135000
051400             15  ASC-OTHER-TOP-OF-SCREEN-DATA.                    05140000
051500                 20  ASC-TRECEIV-DATA.                            05150000
051600                     25  ASC-PKNG-CDE                 PIC X.      05160000
051700                     25  ASC-TRECEIV-EXPTED-CART-CNT  PIC 9(5).   05170000
051800                     25  ASC-TRECEIV-ACTL-CART-CNT    PIC 9(5).   05180000
051900                     25  ASC-TPURITM-SKU.                         05190099
052000                         30  ASC-TPURCHS-DEPT-NBR     PIC X(3).   05200099
052100                         30  ASC-TPURITM-CL-NBR       PIC X(2).   05210099
052200                         30  ASC-TPURITM-SKU-SEQ-NBR  PIC X(3).   05220099
052210*                    25  ASC-TPURITM-SKU.                         05221099
052220*                        30  ASC-TPURCHS-DEPT-NBR     PIC X(3).   05222099
052230*                        30  ASC-TPURITM-CL-NBR       PIC X(2).   05223099
052240*                        30  ASC-TPURITM-SKU-SEQ-NBR  PIC X(8).   05224099
052300                     25  ASC-TPURITM-SKU-DESC         PIC X(25).  05230000
052400                     25  ASC-TPURITM-VEND-STYL-NAME   PIC X(20).  05240000
052410*----------------------------------------------------------------*05241000
052420* CHANGES MADE FOR WR # 230ZZ ENDS HERE.                         *05242000
052430*----------------------------------------------------------------*05243000
052500             15  ASC-BLOCK-ENTRIES      OCCURS 2 TIMES.           05250000
052600                 20  ASC-BLOCK-MODIFIED-SW                        05260000
052700                                        PIC X(01).                05270000
052800                     88  ASC-BLOCK-NOT-MODIFIED    VALUE 'N'.     05280000
052900                     88  ASC-BLOCK-MODIFIED        VALUE 'Y'.     05290000
053000                                                                  05300000
053100                 20  ASC-ITEM-ARRAY.                              05310000
053200                     25  ASC-ITEM-ENTRIES OCCURS 9 TIMES.         05320000
053300                         30  ASC-LIST-ITEM-NUMBER                 05330000
053400                                        PIC S9(09) COMP-3.        05340000
053500                         30  ASC-TEMP-SELECTED-SW                 05350000
053600                                        PIC X(01).                05360000
053700                             88  ASC-VALID-SELECT  VALUE ' '      05370000
053800                                                         'S'      05380000
053900                                                         'B'      05390000
054000                                                         'E'.     05400000
054100                             88  ASC-TEMP-NO-SELECT               05410000
054200                                                   VALUE ' '.     05420000
054300                             88  ASC-TEMP-SELECT   VALUE 'S'.     05430000
054400                             88  ASC-TEMP-BEGIN    VALUE 'B'.     05440000
054500                             88  ASC-TEMP-END      VALUE 'E'.     05450000
054600                         30  ASC-SELECTED-SW                      05460000
054700                                        PIC X(01).                05470000
054800                             88  ASC-NO-SELECT     VALUE ' '.     05480000
054900                             88  ASC-SELECT        VALUE 'S'.     05490000
055000                             88  ASC-BEGIN         VALUE 'B'.     05500000
055100                             88  ASC-END           VALUE 'E'.     05510000
055200                         30  ASC-ACTION            PIC X(03).     05520000
055300                         30  ASC-PACK-ID           PIC 9(03).     05530000
055400                         30  ASC-PACK-DESC         PIC X(15).     05540000
055500                         30  ASC-LINE-NUMBER       PIC 9(04).     05550000
055600                         30  ASC-ENT-ID            PIC S9(09)     05560000
055700                                                       COMP.      05570000
055710*----------------------------------------------------------------*05571000
055720*                                             WR # 230ZZ         *05572000
055731* CHANGED THE STRUCTURE OF ASC TO MATCH THE APPL COMMAREA.       *05573100
055733* ASC-SEQ FIELD IS INCREASED FROM X(03) TO X(08).                *05573300
055740*----------------------------------------------------------------*05574000
055750*                        30  ASC-SKU.                             05575099
055760*                            35  ASC-DEPT          PIC X(03).     05576099
055770*                            35  FILLER            PIC X(01).     05577099
055780*                            35  ASC-CL            PIC X(02).     05578099
055790*                            35  FILLER            PIC X(01).     05579099
055791*                            35  ASC-SEQ           PIC X(03).     05579199
055800                         30  ASC-SKU.                             05580099
055900                             35  ASC-DEPT          PIC X(03).     05590099
056000                             35  FILLER            PIC X(01).     05600099
056100                             35  ASC-CL            PIC X(02).     05610099
056200                             35  FILLER            PIC X(01).     05620099
056300                             35  ASC-SEQ           PIC X(08).     05630099
056310*----------------------------------------------------------------*05631000
056320* CHANGES MADE FOR WR # 230ZZ ENDS HERE.                         *05632000
056330*----------------------------------------------------------------*05633000
056400                         30  ASC-SKU-DESC          PIC X(25).     05640000
056500                         30  ASC-ITM-NBR           PIC S9(15)V    05650000
056600                                                       COMP-3.    05660000
056700                         30  ASC-VER-NBR           PIC S9(09)     05670000
056800                                                       COMP.      05680000
056900                         30  ASC-PO-PACK-RATIO     PIC ZZ9.       05690000
057000                         30  ASC-OTR               PIC X(5).      05700000
057100                         30  ASC-STATUS-CDE        PIC X(2).      05710000
057200                         30  ASC-CASE-PACK-QTY     PIC S9(3) COMP.05720000
057300                         30  ASC-FIELDS-TO-BE-PASSED.             05730000
057400                             35  ASC-PURITM-UNT-QTY               05740000
057500                                                   PIC S9(09)     05750000
057600                                                       COMP.      05760000
057700                             35  ASC-PURITM-UNT-RTL-PR-AMT        05770000
057800                                                   PIC S9(06)V99  05780000
057900                                                       COMP-3.    05790000
058000                             35  ASC-PURITM-GP-RTL-AMT            05800000
058100                                                   PIC S9(05)V99  05810000
058200                                                       COMP-3.    05820000
058300                             35  ASC-PURITM-GP-QTY PIC S9(04)     05830000
058400                                                       COMP.      05840000
058500                             35  ASC-PURITM-VEND-STYL-NAME        05850000
058600                                                   PIC X(08).     05860000
058700                         30  ASC-LINE-TRBL-SW                     05870000
058800                                        PIC X(01).                05880000
058900                             88  ASC-LINE-IN-TROUBLE  VALUE 'Y'.  05890000
059000                             88  ASC-LINE-DISTRO-TRBL VALUE 'D'.  05900000
059100                         30  ASC-LNE-REVISE-TRBL-SW   PIC X(01).  05910000
059200                             88  ASC-LNE-REVISE-TRBL  VALUE 'Y'.  05920000
059300                             88  ASC-NO-LNE-REVISE-TRBL           05930000
059400                                                      VALUE 'N'.  05940000
059500                                                                  05950000
059600             15  ASC-PURITM-PIC-ITM-IND            PIC X(01).     05960000
059700             15  ASC-TKT-DESC           PIC X(16).                05970000
059800             15  ASC-ODD-PACK-UNITS     PIC S9(06) COMP.          05980000
059900             15  ASC-TROUBLE-DESC       PIC X(26).                05990000
060000             15  ASC-PRE-TKT-IND        PIC X(01).                06000000
060100             15  ASC-BLK-SUB            PIC S9(04) COMP SYNC.     06010000
060200             15  ASC-ITEM-SUB           PIC S9(04) COMP SYNC.     06020000
060300             15  ASC-SEL-SUB            PIC S9(04) COMP.          06030000
060400             15  ASC-SEL-ITEM           PIC S9(04) COMP.          06040000
060500             15  ASC-NUMBER-OF-ITEMS-READ                         06050000
060600                                        PIC S9(09) COMP-3.        06060000
060700             15  ASC-NUMBER-OF-SELECTED-ITEMS                     06070000
060800                                        PIC S9(09) COMP-3.        06080000
060900             15  ASC-NUMBER-OF-TS-ITEMS PIC S9(05) COMP-3.        06090000
061000             15  ASC-ITEMS-DISPLAYED    PIC S9(03) COMP-3.        06100000
061100             15  ASC-PACKS-DISPLAYED    PIC S9(03) COMP-3.        06110000
061200             15  ASC-PREV-PACK-ID       PIC  9(03).               06120000
061300             15  ASC-PACK-REVISE-TRBL   PIC  9(03).               06130000
061400             15  ASC-ITEM-AT-TOP-OF-PANEL                         06140000
061500                                        PIC S9(09) COMP-3.        06150000
061600             15  ASC-ITEM-AT-BOT-OF-PANEL                         06160000
061700                                        PIC S9(09) COMP-3.        06170000
061800             15  ASC-HIGHEST-BLOCK-WRITTEN                        06180000
061900                                        PIC S9(04) COMP SYNC.     06190000
062000             15  ASC-START-OF-SELECTED-RANGE                      06200000
062100                                        PIC S9(09) COMP-3.        06210000
062200             15  ASC-END-OF-SELECTED-RANGE                        06220000
062300                                        PIC S9(09) COMP-3.        06230000
062400             15  ASC-ITEMS-LEFT-INDICATOR                         06240000
062500                                        PIC X(01).                06250000
062600                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     06260000
062700                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     06270000
062800             15  ASC-TEMP-QUEUE-UPDATE-SW                         06280000
062900                                        PIC X(01).                06290000
063000                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     06300000
063100                 88  ASC-UPDATE-TSQ2               VALUE '2'.     06310000
063200                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     06320000
063300             15  ASC-LIST-QUEUE-NAME.                             06330000
063400                 20  ASC-LIST-TERM-ID   PIC X(04).                06340000
063500                 20  ASC-LIST-TASK-NUMBER                         06350000
063600                                        PIC S9(05) COMP-3.        06360000
063700                 20  ASC-LIST-SEQ       PIC 9(01).                06370000
063800             15  ASC-SEL-QUEUE-NAME-IN   PIC X(08).               06380000
063900             15  ASC-SEL-QUEUE-NAME-OUT.                          06390000
064000                 20  ASC-SEL-TERM-ID-OUT PIC X(04).               06400000
064100                 20  ASC-SEL-TASK-NUMBER-OUT                      06410000
064200                                         PIC S9(05) COMP-3.       06420000
064300                 20  ASC-SEL-SEQ-OUT     PIC 9(01).               06430000
064400                                                                  06440000
064500             15  ASC-START-ITEM-REQUEST.                          06450000
064600                 20  ASC-START-ITEM-REQUEST-N  PIC 9(07).         06460000
064700             15  ASC-USE-SELECTION-QUEUE-IND   PIC X(01).         06470000
064800                 88  ASC-USE-SELECTION-QUEUE   VALUE 'Y'.         06480000
064900             15  ASC-HOLD-INTER-APPL           PIC X(200).        06490000
065000             15  ASC-INTER-APPL-CODE-IND       PIC X(01).         06500000
065100                 88 ASC-INTER-APPL-PKSL-LIST   VALUE 'P'.         06510000
065200             15  ASC-ADD-TYPE-SW               PIC X(01).         06520000
065300                 88  ASC-ADD-LINE                  VALUE 'Y'.     06530000
065400                 88  ASC-ADD-PACK                  VALUE 'N'.     06540000
065500             15  ASC-MSG-SPECIFIC-SW           PIC X(01).         06550000
065600                 88  ASC-USE-MAINTAIN-MSG          VALUE 'Y'.     06560000
065700                 88  ASC-USE-REVIEW-MSG            VALUE 'N'.     06570000
065800/                                                                 06580000
065900*---------------------------------------------------------------* 06590000
066000*    ABEND PROCESSING COPYBOOK.                                 * 06600000
066100*---------------------------------------------------------------* 06610000
066200                                                                  06620000
066300     COPY DPWS013.                                                06630000
066400                                                                  06640000
066500/                                                                 06650000
066600*---------------------------------------------------------------* 06660000
066700*    OPEN TO RECEIVE COPYBOOK.                                  * 06670000
066800*---------------------------------------------------------------* 06680000
066900                                                                  06690000
067000*    COPY PCWS020.                                                06700000
067100     COPY PCWS016.                                                06710000
067200/                                                                 06720000
067210*---------------------------------------------------------------* 06721000
067211* COPY BOOK FOR LOGISTICS DOMAIN LOCATION MODULE (XLKUT071)       06721199
067212*---------------------------------------------------------------* 06721200
067214                                                                  06721400
067215     COPY XLWS071.                                                06721599
067216                                                                  06721699
067217*---------------------------------------------------------------* 06721799
067218* COPY BOOK FOR LOGISTICS DOMAIN ITEM ACCESS MODULE  WR # 230ZZ * 06721899
067219*---------------------------------------------------------------* 06721999
067220                                                                  06722099
067221     COPY XLWS001.                                                06722199
067222*---------------------------------------------------------------* 06722299
067223* CHANGES MADE FOR WR # 230ZZ ENDS HERE.                        * 06722399
067230*---------------------------------------------------------------* 06723099
067240*---------------------------------------------------------------* 06724099
067250*    DB2 AREA                                                     06725099
067260*---------------------------------------------------------------* 06726099
067270     EXEC SQL                                                     06727099
067280          INCLUDE TKRPRPM                                         06728099
067290     END-EXEC.                                                    06729099
067300*---------------------------------------------------------------* 06730000
067400*    DB2 AREA FOR THE WORK ORDER TABLE                          * 06740000
067500*---------------------------------------------------------------* 06750000
067600     EXEC SQL                                                     06760000
067700          INCLUDE TWRKORD                                         06770000
067800     END-EXEC.                                                    06780000
067900                                                                  06790000
068600                                                                  06860000
068700******************************************************************06870000
068800*    DB2 DCLGEN FOR THE PACKSLIP TABLE                            06880099
068900******************************************************************06890000
069000     EXEC SQL                                                     06900000
069100          INCLUDE TPKSLIP                                         06910099
069200     END-EXEC.                                                    06920000
069300                                                                  06930099
069400******************************************************************06940099
069500*    DB2 DCLGEN FOR THE TMDSEAR TABLE                             06950099
069600******************************************************************06960099
069700     EXEC SQL                                                     06970099
069800          INCLUDE TMDSEAR                                         06980099
069900     END-EXEC.                                                    06990099
070000                                                                  07000099
070700******************************************************************07070000
070800*    DB2 DCLGEN FOR THE TVNDSTL TABLE                             07080000
070900******************************************************************07090000
071000     EXEC SQL                                                     07100000
071100          INCLUDE TVNDSTL                                         07110000
071200     END-EXEC.                                                    07120000
071300                                                                  07130000
071400******************************************************************07140000
071500*    DB2 DCLGEN FOR THE TMDARVS TABLE                             07150000
071600******************************************************************07160000
071700     EXEC SQL                                                     07170000
071800          INCLUDE TMDARVS                                         07180000
071900     END-EXEC.                                                    07190000
072000                                                                  07200000
072100*---------------------------------------------------------------* 07210000
072200*    DB2 AREA FOR THE PO AGREEMENT TABLE                        * 07220000
072300*---------------------------------------------------------------* 07230000
072400     EXEC SQL                                                     07240000
072500          INCLUDE TPOAGMT                                         07250000
072600     END-EXEC.                                                    07260000
072700                                                                  07270000
072800/                                                                 07280000
072900*---------------------------------------------------------------* 07290000
073000*    DB2 AREA FOR THE PRE TICKET REQUEST TABLE                  * 07300000
073100*---------------------------------------------------------------* 07310000
073200     EXEC SQL                                                     07320000
073300          INCLUDE TPTKREQ                                         07330000
073400     END-EXEC.                                                    07340000
073500                                                                  07350000
073600*---------------------------------------------------------------* 07360000
073700*    DB2 AREA FOR THE PRE TICKET LINE DETAIL TABLE              * 07370000
073800*---------------------------------------------------------------* 07380000
073900     EXEC SQL                                                     07390000
074000          INCLUDE TPTKLNE                                         07400000
074100     END-EXEC.                                                    07410000
074200                                                                  07420000
075100*----------------------------------------------------------------*07510000
075200*    DB2 DCLGEN FOR PURCHASE ORDER STATUS CODE TABLE              07520000
075300*----------------------------------------------------------------*07530000
075400     EXEC SQL                                                     07540000
075500          INCLUDE TSTATCD                                         07550000
075600     END-EXEC.                                                    07560000
075700                                                                  07570000
075800*----------------------------------------------------------------*07580000
075900*    DB2 DCLGEN FOR THE DEPT/CLASS TICKET FORMAT ASSIGNMENT       07590000
076000*----------------------------------------------------------------*07600000
076100     EXEC SQL                                                     07610000
076200          INCLUDE TDCTFAS                                         07620000
076300     END-EXEC.                                                    07630000
076400                                                                  07640000
076500/                                                                 07650000
076600*---------------------------------------------------------------* 07660000
076700*    DB2 AREA FOR THE RECEIVER                                  * 07670000
076800*---------------------------------------------------------------* 07680000
076900     EXEC SQL                                                     07690000
077000          INCLUDE TRECEIV                                         07700000
077100     END-EXEC.                                                    07710000
077200                                                                  07720000
077300/                                                                 07730000
077400*---------------------------------------------------------------* 07740000
077500*    DB2 AREA FOR THE PURCHASE ORDER TABLE                      * 07750000
077600*---------------------------------------------------------------* 07760000
077700     EXEC SQL                                                     07770000
077800          INCLUDE TPURCHS                                         07780000
077900     END-EXEC.                                                    07790000
078000                                                                  07800000
078100/                                                                 07810000
078200*---------------------------------------------------------------* 07820000
078300*    DB2 AREA FOR THE PURCHASE PREPACK TABLE                    * 07830000
078400*---------------------------------------------------------------* 07840000
078500     EXEC SQL                                                     07850000
078600          INCLUDE TPOPRPK                                         07860000
078700     END-EXEC.                                                    07870000
078800                                                                  07880000
078900/                                                                 07890000
079000*---------------------------------------------------------------* 07900000
079100*    DB2 AREA FOR THE PURCHASE ORDER ITEM TABLE                 * 07910000
079200*---------------------------------------------------------------* 07920000
079300     EXEC SQL                                                     07930000
079400          INCLUDE TPURITM                                         07940000
079500     END-EXEC.                                                    07950000
079600                                                                  07960000
079700/                                                                 07970000
079800*---------------------------------------------------------------* 07980000
079900*    DB2 AREA FOR THE RECEIPT ITEM TABLE                        * 07990000
080000*---------------------------------------------------------------* 08000000
080100     EXEC SQL                                                     08010000
080200          INCLUDE TRECITM                                         08020000
080300     END-EXEC.                                                    08030000
080400                                                                  08040000
080500******************************************************************08050000
080600*   DB2 DCLGEN FOR THE TICKET FORMAT TABLE                        08060000
080700******************************************************************08070000
080800     EXEC SQL                                                     08080000
080900          INCLUDE TTKTFMT                                         08090000
081000     END-EXEC.                                                    08100000
081100                                                                  08110000
081200/                                                                 08120000
081300*---------------------------------------------------------------* 08130000
081400*    DB2 AREA FOR THE TRECDIS TABLE                             * 08140000
081500*---------------------------------------------------------------* 08150000
081600     EXEC SQL                                                     08160000
081700          INCLUDE TRECDIS                                         08170000
081800     END-EXEC.                                                    08180000
081900                                                                  08190000
082000/                                                                 08200000
082100*----------------------------------------------------------------*08210000
082200*    DB2 DCLGEN FOR THE TROUBLE NOTIFICATION TABLE                08220000
082300*----------------------------------------------------------------*08230000
082400     EXEC SQL                                                     08240000
082500          INCLUDE TTRBNTF                                         08250000
082600     END-EXEC.                                                    08260000
082700                                                                  08270000
082800/                                                                 08280000
082900*----------------------------------------------------------------*08290000
083000*    DB2 DCLGEN FOR THE TROUBLE REASON TABLE                      08300000
083100*----------------------------------------------------------------*08310000
083200     EXEC SQL                                                     08320000
083300          INCLUDE TTRBRSN                                         08330000
083400     END-EXEC.                                                    08340000
083500                                                                  08350000
083600/                                                                 08360000
083700*---------------------------------------------------------------* 08370000
083800*    DB2 AREA FOR COMMUNICATIONS                                * 08380000
083900*---------------------------------------------------------------* 08390000
084000     EXEC SQL                                                     08400000
084100          INCLUDE SQLCA                                           08410000
084200     END-EXEC.                                                    08420000
084300                                                                  08430000
084400/                                                                 08440000
084500*---------------------------------------------------------------* 08450000
084600*  CURSOR TO LIST TPURITM                                       * 08460000
084700*---------------------------------------------------------------* 08470000
084800                                                                  08480000
084900                                                                  08490000
085000     EXEC SQL                                                     08500000
085100          DECLARE ADD-PACK-CSR CURSOR FOR                         08510000
085200           SELECT A.PO_NBR                                        08520000
085300                 ,A.VER_NBR                                       08530000
085400                 ,A.SKU_SEQ_NBR                                   08540000
085600                 ,A.ITM_NBR                                       08560000
085700                 ,A.SKU_DESC                                      08570000
085800                 ,A.APP_PO_LNE_NBR                                08580000
085900                 ,A.VEND_STYL_NAME                                08590000
086000                 ,A.UNT_QTY                                       08600000
086100                 ,A.UNT_RTL_PR_AMT                                08610000
086200                 ,A.GP_RTL_AMT                                    08620000
086300                 ,A.GP_QTY                                        08630000
086400                 ,A.PO_LNE_NBR                                    08640000
086500                 ,A.PO_PREPK_ID                                   08650000
086600                 ,A.PREPK_RATO_QTY                                08660000
086700                 ,A.STATUS_CDE                                    08670000
086800                 ,B.PREPK_DESC                                    08680000
086900                 ,B.OTPK_UNT_QTY                                  08690000
087000                 ,B.INPK_UNT_QTY                                  08700000
087100           FROM   TPURITM A                                       08710000
087200                 ,TPOPRPK B                                       08720000
087300           WHERE  A.PO_NBR          = :DK-ORD-NBR                 08730000
087400             AND  (A.STATUS_CDE     = :PC-STAT-CDE-AP             08740000
087500              OR   A.STATUS_CDE     = :PC-STAT-CDE-CM             08750000
087600              OR   A.STATUS_CDE     = :PC-STAT-CDE-AC             08760000
087700              OR   A.STATUS_CDE     = :PC-STAT-CDE-RV)            08770000
087800             AND   A.VER_STATUS_CDE = 'A'                         08780000
087900             AND   B.PO_NBR         = A.PO_NBR                    08790000
088000             AND   B.PO_PREPK_ID    = A.PO_PREPK_ID               08800000
088100             AND   B.PO_PREPK_ID NOT IN                           08810000
088200                  (SELECT C.PREPK_ID                              08820000
088300                   FROM  TRECITM C                                08830000
088400                   WHERE C.ORD_NBR        = A.PO_NBR              08840000
088500                     AND C.REC_SEQ_NBR    = :DK-REC-SEQ-NBR       08850000
088600                     AND C.OPER_UNT_ID      = :DK-OPER-UNT-ID     08860000
088700                     AND C.FCLTY_ID         = :DK-FACT            08870000
088800                     AND C.VER_STATUS_CDE = 'A')                  08880000
088900         ORDER BY PO_PREPK_ID                                     08890000
089000                 ,A.APP_PO_LNE_NBR                                08900000
089100     END-EXEC.                                                    08910000
089200                                                                  08920000
089300     EXEC SQL                                                     08930000
089400          DECLARE ALL-LINES-CSR CURSOR FOR                        08940000
089500           SELECT A.PO_NBR                                        08950000
089600                 ,A.VER_NBR                                       08960000
089700                 ,A.SKU_SEQ_NBR                                   08970000
089900                 ,A.ITM_NBR                                       08990000
090000                 ,A.SKU_DESC                                      09000000
090100                 ,A.APP_PO_LNE_NBR                                09010000
090200                 ,A.VEND_STYL_NAME                                09020000
090300                 ,A.UNT_QTY                                       09030000
090400                 ,A.UNT_RTL_PR_AMT                                09040000
090410                 ,A.UNT_COST_AMT                                  09041099
090500                 ,A.GP_RTL_AMT                                    09050000
090600                 ,A.GP_QTY                                        09060000
090700                 ,A.PO_LNE_NBR                                    09070000
090800                 ,A.PO_PREPK_ID                                   09080000
090900                 ,A.PREPK_RATO_QTY                                09090000
091000                 ,A.STATUS_CDE                                    09100000
091100                 ,B.PREPK_DESC                                    09110000
091200                 ,B.INPK_UNT_QTY                                  09120000
091300                 ,B.OTPK_UNT_QTY                                  09130000
091310                 ,A.INNR_PK_QTY                                   09131099
091400           FROM   TPURITM A                                       09140000
091500                 ,TPOPRPK B                                       09150000
091600           WHERE  A.PO_NBR          = :DK-ORD-NBR                 09160000
091700             AND  (A.STATUS_CDE     = :PC-STAT-CDE-AP             09170000
091800              OR   A.STATUS_CDE     = :PC-STAT-CDE-CM             09180000
091900              OR   A.STATUS_CDE     = :PC-STAT-CDE-AC             09190000
092000              OR   A.STATUS_CDE     = :PC-STAT-CDE-RV)            09200000
092100             AND   A.VER_STATUS_CDE = 'A'                         09210000
092200             AND   A.PO_PREPK_ID    = :DK-PACK-ID                 09220000
092300             AND   B.PO_NBR         = A.PO_NBR                    09230000
092400             AND   B.PO_PREPK_ID    = A.PO_PREPK_ID               09240000
092500         ORDER BY PO_PREPK_ID                                     09250000
092600                 ,A.APP_PO_LNE_NBR                                09260000
092700     END-EXEC.                                                    09270000
092800                                                                  09280000
092900     EXEC SQL                                                     09290000
093000          DECLARE ADD-LNE-CSR CURSOR FOR                          09300000
093100           SELECT A.PO_NBR                                        09310000
093200                 ,A.VER_NBR                                       09320000
093300                 ,A.SKU_SEQ_NBR                                   09330000
093500                 ,A.ITM_NBR                                       09350000
093600                 ,A.SKU_DESC                                      09360000
093700                 ,A.APP_PO_LNE_NBR                                09370000
093800                 ,A.VEND_STYL_NAME                                09380000
093900                 ,A.UNT_QTY                                       09390000
094000                 ,A.UNT_COST_AMT                                  09400099
094010                 ,A.UNT_RTL_PR_AMT                                09401099
094100                 ,A.GP_RTL_AMT                                    09410000
094200                 ,A.GP_QTY                                        09420000
094300                 ,A.PO_LNE_NBR                                    09430000
094400                 ,A.PO_PREPK_ID                                   09440000
094500                 ,A.PREPK_RATO_QTY                                09450000
094600                 ,A.STATUS_CDE                                    09460000
094700                 ,B.PREPK_DESC                                    09470000
094800           FROM   TPURITM A                                       09480000
094900                 ,TPOPRPK B                                       09490000
095000           WHERE  A.PO_NBR          = :DK-ORD-NBR                 09500000
095100             AND  (A.STATUS_CDE     = :PC-STAT-CDE-AP             09510000
095200              OR   A.STATUS_CDE     = :PC-STAT-CDE-CM             09520000
095300              OR   A.STATUS_CDE     = :PC-STAT-CDE-AC             09530000
095400              OR   A.STATUS_CDE     = :PC-STAT-CDE-RV)            09540000
095500             AND   A.PO_PREPK_ID    = :DK-PACK-ID                 09550000
095600             AND   A.VER_STATUS_CDE = 'A'                         09560000
095700             AND   B.PO_NBR         = A.PO_NBR                    09570000
095800             AND   B.PO_PREPK_ID    = A.PO_PREPK_ID               09580000
095900             AND   A.APP_PO_LNE_NBR NOT IN                        09590000
096000                  (SELECT B.ORD_LNE_NBR                           09600000
096100                   FROM TRECITM B                                 09610000
096200                   WHERE B.ORD_NBR        = A.PO_NBR              09620000
096300                     AND B.REC_SEQ_NBR    = :DK-REC-SEQ-NBR       09630000
096400                     AND B.OPER_UNT_ID    = :DK-OPER-UNT-ID       09640000
096500                     AND B.FCLTY_ID       = :DK-FACT              09650000
096600                     AND B.PREPK_ID       = A.PO_PREPK_ID         09660000
096700                     AND B.VER_STATUS_CDE = 'A')                  09670000
096800         ORDER BY PO_PREPK_ID                                     09680000
096900                 ,A.APP_PO_LNE_NBR                                09690000
097000     END-EXEC.                                                    09700000
097100                                                                  09710000
097200     EXEC SQL                                                     09720000
097300          DECLARE TKTFMT-CURSOR  CURSOR FOR                       09730000
097400           SELECT TKT_DESC,                                       09740000
097500                  A.ACTL_PRT_DTE,                                 09750000
097600                  A.PRT_TM                                        09760000
097700             FROM TPTKREQ A                                       09770000
097800                 ,TPTKLNE B                                       09780000
097900             WHERE A.PO_NBR     = :DK-ORD-NBR                     09790000
098000               AND A.PO_REQ_NBR = B.PO_REQ_NBR                    09800000
098100               AND B.PO_LNE_NBR = :DK-LINE-NBR                    09810000
098200         ORDER BY A.ACTL_PRT_DTE DESC, A.PRT_TM DESC              09820000
098300     END-EXEC.                                                    09830000
098400                                                                  09840000
098500/                                                                 09850000
098600 LINKAGE SECTION.                                                 09860000
098700                                                                  09870000
098800 01  DFHCOMMAREA.                                                 09880000
098900     05  FILLER                         OCCURS  1 TO 4072 TIMES   09890000
099000                                        DEPENDING ON EIBCALEN.    09900000
099100         10  FILLER                     PIC X.                    09910000
099200                                                                  09920000
099300/                                                                 09930000
099400 PROCEDURE DIVISION.                                              09940000
099500*---------------------------------------------------------------* 09950000
099600*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * 09960000
099700*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * 09970000
099800*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * 09980000
099900*---------------------------------------------------------------* 09990000
100000 0000-MAIN-MODULE.                                                10000000
100100                                                                  10010000
100200     INITIALIZE DP030-CICS-API-FIELDS.                            10020000
100300                                                                  10030000
100400     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       10040000
100500     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          10050000
100600     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         10060000
100700                                                                  10070000
100800     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       10080000
100900                                                                  10090000
101000     MOVE LENGTH OF RC802AI        TO DP030-MAP-LENGTH (1).       10100000
101100     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     10110000
101200                                                                  10120000
101300     PERFORM 0001-CALL-CICS-ARCH-API.                             10130000
101400     PERFORM 1000-CONTROL-PROCESSING                              10140000
101500                                                                  10150000
101600     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     10160000
101700     PERFORM 0001-CALL-CICS-ARCH-API.                             10170000
101800                                                                  10180000
101900                                                                  10190000
102000*---------------------------------------------------------------* 10200000
102100*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * 10210000
102200*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * 10220000
102300*---------------------------------------------------------------* 10230000
102400 0001-CALL-CICS-ARCH-API.                                         10240000
102510     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      10251099
102600                                    DFHCOMMAREA                   10260099
102700                                    DP030-CICS-API-FIELDS         10270099
102800                                    DP020-STANDARD-COMMAREA       10280099
102900                                    RC802AI.                      10290099
103000                                                                  10300000
103100     IF  DP030-RC-CALL-SUCCESSFUL OR                              10310000
103200         DP030-RC-APPL-ERROR                                      10320000
103300         CONTINUE                                                 10330000
103400     ELSE                                                         10340000
103500         SET DP013-NO-ROLLBACK                                    10350000
103600             DP013-XCTL-DISPLAY-RESTART                           10360000
103700             DP013-CICS-ABEND      TO TRUE                        10370000
103800         MOVE '0001-CALL-CICS-ARCH-API'                           10380000
103900                                   TO DP013-PARAGRAPH             10390000
103920         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN CODE O10392099
103930-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      10393099
104200         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      10420000
104300         PERFORM DP013-0000-PROCESS-ABEND                         10430000
104400     END-IF.                                                      10440000
104500                                                                  10450000
104600                                                                  10460000
104700*----------------------------------------------------------------*10470000
104800* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *10480000
104900* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *10490000
105000*                                                                *10500000
105100* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *10510000
105200*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *10520000
105300*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *10530000
105400*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *10540000
105500*----------------------------------------------------------------*10550000
105600                                                                  10560000
105700 1000-CONTROL-PROCESSING.                                         10570000
105800                                                                  10580000
105900     EVALUATE TRUE                                                10590000
106000         WHEN DP020-NEXT-ACT-INITIAL                              10600000
106100             INITIALIZE ASC-SPECIFIC-COMMAREA                     10610000
106200             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            10620000
106300                                      ASC-SEL-TERM-ID-OUT         10630000
106400             MOVE DP020-SRC-TASK-NUMBER                           10640000
106500                                   TO ASC-LIST-TASK-NUMBER        10650000
106600                                      ASC-SEL-TASK-NUMBER-OUT     10660000
106700             MOVE PC-LIST-QUEUE-SEQ                               10670000
106800                                   TO ASC-LIST-SEQ                10680000
106900             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ-OUT             10690000
107000             PERFORM 1100-PROCESS-INTER-APPL-COMM                 10700000
107100             IF  PS-COMMAREA-NOT-VALID                            10710000
107200                 SET DP020-MSG-FATAL                              10720000
107300                     DP020-NEXT-ACT-APPL-ERROR                    10730000
107400                                   TO TRUE                        10740000
107500             ELSE                                                 10750000
107600                 MOVE INTER-APPL-COMM-AREA                        10760000
107700                                   TO ASC-HOLD-INTER-APPL         10770000
107800                 PERFORM 4000-BUILD-INITIAL-PANEL                 10780000
107900             END-IF                                               10790000
108000                                                                  10800000
108100         WHEN DP020-NEXT-ACT-READ-MAP                             10810000
108200             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        10820000
108300                                   TO PV-TOP-ITEM                 10830000
108400             PERFORM 2000-PROCESS-PANEL                           10840000
108500                                                                  10850000
108600         WHEN DP020-NEXT-ACT-RETURN                               10860000
108700              MOVE ASC-ITEM-AT-TOP-OF-PANEL                       10870000
108800                                   TO PV-TOP-ITEM                 10880000
108900              MOVE ZERO            TO ASC-ITEM-AT-TOP-OF-PANEL    10890000
109000              PERFORM 6000-REFRESH-PANEL-FROM-TEMP                10900000
109100              PERFORM 4100-PREPARE-CURSOR                         10910000
109200              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                10920000
109300                                                                  10930000
109400         WHEN OTHER                                               10940000
109500             SET DP013-LOGIC-ABEND TO TRUE                        10950000
109600             SET DP013-NO-ROLLBACK TO TRUE                        10960000
109700             MOVE '1000-CONTROL-PROCESSING'                       10970000
109800                                   TO DP013-PARAGRAPH             10980000
109900             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    10990000
110000                                   TO DP013-MESSAGE-TEXT(1)       11000000
110100             PERFORM DP013-0000-PROCESS-ABEND                     11010000
110200     END-EVALUATE.                                                11020000
110300                                                                  11030000
110400/                                                                 11040000
110500*----------------------------------------------------------------*11050000
110600* MOVE DATA PASSED THROUGH THE INTER-APPL COMMAREA               *11060000
110700*----------------------------------------------------------------*11070000
110800                                                                  11080000
110900 1100-PROCESS-INTER-APPL-COMM.                                    11090000
111000                                                                  11100000
111100     SET PS-COMMAREA-VALID          TO TRUE.                      11110000
111200     MOVE SPACE                     TO ASC-START-ITEM-REQUEST.    11120000
111300                                                                  11130000
111400     SET ASC-USE-SELECTION-QUEUE   TO TRUE                        11140000
111500     MOVE RC800-NUMBER-OF-SELECTED-ITEMS                          11150000
111600                                   TO ASC-NUMBER-OF-SELECTED-ITEMS11160000
111700     MOVE RC800-NUMBER-OF-TS-ITEMS TO ASC-NUMBER-OF-TS-ITEMS      11170000
111800     MOVE RC800-SEL-QUEUE-NAME     TO ASC-SEL-QUEUE-NAME-IN       11180000
111900                                                                  11190000
112000                                                                  11200000
112100     EVALUATE DP020-INT-APPL-FORMAT-IND                           11210000
112200         WHEN PC-INTER-APPL-PACK-ADD                              11220000
112300             INITIALIZE ASC-LIST-KEYS                             11230000
112400             MOVE RC800-REC-NBR-N       TO ASC-PO-NBR             11240000
112500                                           DK-ORD-NBR             11250000
112600             MOVE RC800-REC-SEQ-NBR-N   TO ASC-REC-SEQ-NBR        11260000
112700                                           DK-REC-SEQ-NBR         11270000
112800             MOVE RC800-OPER-UNIT-ID    TO ASC-OPR-ID             11280000
112900                                           DK-OPER-UNT-ID         11290000
113000             MOVE RC800-FACILITY-ID     TO ASC-FACT               11300000
113100                                           DK-FACT                11310000
113200             SET RC801-INQ (ASC-SEL-SUB)                          11320000
113300                 ASC-ADD-PACK           TO TRUE                   11330000
113400                                                                  11340000
113500                                                                  11350000
113600         WHEN PC-INTER-APPL-PACK-LINE-ADD                         11360000
113700              MOVE RC801-MAX-ITEMS  TO ASC-SEL-SUB                11370000
113800              MOVE ZERO             TO ASC-SEL-ITEM               11380000
113900              SET ASC-ADD-LINE      TO TRUE                       11390000
114000              PERFORM 2400-GET-NEXT-PKSL-RECORD                   11400000
114100         END-EVALUATE.                                            11410000
114200                                                                  11420000
114300                                                                  11430000
114400/                                                                 11440000
114500*----------------------------------------------------------------*11450000
114600* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *11460000
114700* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *11470000
114800* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *11480000
114900* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *11490000
115000* FUNCTION KEYS CAN GET THIS FAR.                                *11500000
115100*----------------------------------------------------------------*11510000
115200                                                                  11520000
115300 2000-PROCESS-PANEL.                                              11530000
115400     EVALUATE TRUE                                                11540000
115500         WHEN DP020-SRC-AID = DP016-CLEAR                         11550000
115600             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    11560000
115700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   11570000
115800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11580000
115900                                                                  11590000
116000         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    11600000
116100             PERFORM 2050-DELETE-LIST-QUEUE                       11610000
116200             PERFORM 4000-BUILD-INITIAL-PANEL                     11620000
116300                                                                  11630000
116400         WHEN DP020-FK-DESELECT (DP020-SRC-AID)                   11640000
116500              MOVE +0             TO ASC-PREV-PACK-ID             11650000
116600              PERFORM 2140-DESELECT-ALL-ITEMS                     11660000
116700              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                11670000
116800                                                                  11680000
116900         WHEN DP020-FK-SELECT-ALL (DP020-SRC-AID)                 11690000
117000              MOVE +0             TO ASC-PREV-PACK-ID             11700000
117100              PERFORM 2150-SELECT-ALL-ITEMS                       11710000
117200              PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                11720000
117300              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                11730000
117400                                                                  11740000
117500         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             11750000
117600             IF ASC-USE-SELECTION-QUEUE                           11760000
117700                 PERFORM 6200-DEL-LIST-QUEUE                      11770000
117800                 PERFORM 2400-GET-NEXT-PKSL-RECORD                11780000
117900                 PERFORM 4000-BUILD-INITIAL-PANEL                 11790000
118000             ELSE                                                 11800000
118100*                --- BOTTOM OF LIST ---                           11810000
118200                 MOVE PC-TSYMSG-00070                             11820000
118300                                   TO DP020-MSG-NUMBER            11830000
118400                 SET DP020-MSG-INFORMATIONAL                      11840000
118500                                   TO TRUE                        11850000
118600             END-IF                                               11860000
118700                                                                  11870000
118800         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             11880000
118900             IF ASC-USE-SELECTION-QUEUE                           11890000
119000                 PERFORM 6200-DEL-LIST-QUEUE                      11900000
119100                 PERFORM 2310-GET-PREV-RECORD                     11910000
119200                 PERFORM 4000-BUILD-INITIAL-PANEL                 11920000
119300             ELSE                                                 11930000
119400*                --- TOP OF LIST ---                              11940000
119500                 MOVE PC-TSYMSG-00069                             11950000
119600                                   TO DP020-MSG-NUMBER            11960000
119700                 SET DP020-MSG-INFORMATIONAL                      11970000
119800                                   TO TRUE                        11980000
119900             END-IF                                               11990000
120000         WHEN OTHER                                               12000000
120100             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 12010000
120200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   12020000
120300             IF  PS-NO-ERROR                                      12030000
120400                 SET DP030-CONTINUE-GO TO TRUE                    12040000
120500                 PERFORM 2100-CHECK-FUNCTION-KEY                  12050000
120600             ELSE                                                 12060000
120700                 SET DP030-OVERRIDE-GO TO TRUE                    12070000
120800             END-IF                                               12080000
120900     END-EVALUATE.                                                12090000
121000                                                                  12100000
121100/                                                                 12110000
121200*----------------------------------------------------------------*12120000
121300*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *12130000
121400*----------------------------------------------------------------*12140000
121500 2050-DELETE-LIST-QUEUE.                                          12150000
121600                                                                  12160000
121700     EXEC CICS                                                    12170000
121800         DELETEQ TS                                               12180000
121900           QUEUE (ASC-LIST-QUEUE-NAME)                            12190000
122000            RESP (PV-CICS-RESP)                                   12200000
122100     END-EXEC.                                                    12210000
122200                                                                  12220000
122300     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       12230000
122400        (PV-CICS-RESP = DFHRESP(QIDERR))                          12240000
122500         CONTINUE                                                 12250000
122600     ELSE                                                         12260000
122700         SET DP013-CICS-ABEND      TO TRUE                        12270000
122800         SET DP013-NO-ROLLBACK     TO TRUE                        12280000
122900                                                                  12290000
123000         MOVE '2050-DELETE-LIST-QUEUE'                            12300000
123100                                   TO DP013-PARAGRAPH             12310000
123200         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    12320000
123300                                   TO DP013-MESSAGE-TEXT (1)      12330000
123400         PERFORM DP013-0000-PROCESS-ABEND                         12340000
123500     END-IF.                                                      12350000
123600                                                                  12360000
123700     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  12370000
123800                                                                  12380000
123900/                                                                 12390000
124000*----------------------------------------------------------------*12400000
124100* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*12410000
124200* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *12420000
124300* CICS ARCHITECTURE API.                                         *12430000
124400*----------------------------------------------------------------*12440000
124500 2100-CHECK-FUNCTION-KEY.                                         12450000
124600                                                                  12460000
124700     MOVE SPACES                       TO ASC-MSG-SPECIFIC-SW.    12470000
124800                                                                  12480000
124900     EVALUATE TRUE                                                12490000
125000* IF ADDING A PACK AND F13 WAS HIT, ADD ALL LINES TO THE PACK     12500000
125100* CHOSEN                                                          12510000
125200        WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)               12520000
125300             SET DP030-CONTINUE-GO     TO TRUE                    12530000
125400             IF ASC-NUMBER-OF-SELECTED-ITEMS = 0                  12540000
125500                SET DP030-OVERRIDE-GO                             12550000
125600                    DP020-MSG-WARNING  TO TRUE                    12560000
125700                MOVE PC-TSYMSG-00057   TO DP020-MSG-NUMBER        12570000
125800             ELSE                                                 12580000
125900                IF ASC-ADD-PACK                                   12590000
126000                   SET PS-NO-DUPLICATE TO TRUE                    12600000
126100                                                                  12610000
126200                   MOVE +0             TO ASC-PREV-PACK-ID        12620000
126300                                                                  12630000
126400                   MOVE +1             TO ASC-BLK-SUB             12640000
126500                   PERFORM 5100-WRITE-TEMP-STORAGE                12650000
126600                   ADD +1              TO ASC-BLK-SUB             12660000
126700                   PERFORM 5100-WRITE-TEMP-STORAGE                12670000
126800                                                                  12680000
126900                   PERFORM 2500-ADD-ALL-LINES-TO-PACK             12690000
127000                      VARYING PV-ITEM FROM 1 BY 1                 12700000
127100                      UNTIL PV-ITEM > ASC-HIGHEST-BLOCK-WRITTEN   12710000
127200                                                                  12720000
127300                   MOVE ASC-PO-NBR  TO RC800-REC-NBR-N            12730000
127400                   MOVE ASC-REC-SEQ-NBR                           12740000
127500                                    TO RC800-REC-SEQ-NBR-N        12750000
127600                   MOVE ASC-OPR-ID  TO RC800-OPER-UNIT-ID         12760000
127700                   MOVE ASC-FACT    TO RC800-FACILITY-ID          12770000
127800                   PERFORM 4030-GET-TROUBLE-DESC                  12780000
127900                                                                  12790000
128000                   MOVE +0         TO                             12800000
128100                                   ASC-NUMBER-OF-SELECTED-ITEMS   12810000
128200                                   ASC-NUMBER-OF-TS-ITEMS         12820000
128300                   IF PS-ERROR OR                                 12830000
128400                      PS-DUPLICATE                                12840000
128500                      MOVE 1       TO ASC-BLK-SUB                 12850000
128600                                      PV-BLOCK-NUMBER             12860000
128700                      PERFORM 4410-READ-TEMP-STORAGE              12870000
128800                      ADD +1       TO ASC-BLK-SUB                 12880000
128900                      PERFORM 4410-READ-TEMP-STORAGE              12890000
129000                                                                  12900000
129100                      PERFORM 4400-MOVE-COMMAREA-TO-SCREEN        12910000
129200                   ELSE                                           12920000
129300                   IF ASC-USE-MAINTAIN-MSG                        12930000
129400*   ALL LINES WERE ADDED TO PACK, GO TO PACK DTL LIST TO MAINTAIN.12940000
129500                      MOVE PC-TSYMSG-02167                        12950000
129600                                   TO DP020-MSG-NUMBER            12960000
129700                      SET DP020-MSG-WARNING                       12970000
129800                          PS-ERROR TO TRUE                        12980000
129900                   ELSE                                           12990000
130000*  ALL LINES WERE ADDED TO PACK, GO TO PACK DTL LIST TO REVIEW.   13000000
130100                      SET DP030-OVERRIDE-GO                       13010000
130200                          DP020-MSG-WARNING                       13020000
130300                                   TO TRUE                        13030000
130400                      MOVE PC-TSYMSG-02286                        13040000
130500                                   TO DP020-MSG-NUMBER            13050000
130600                   END-IF                                         13060000
130700                   MOVE 1          TO ASC-BLK-SUB                 13070000
130800                                      PV-BLOCK-NUMBER             13080000
130900                   PERFORM 4410-READ-TEMP-STORAGE                 13090000
131000                   ADD +1          TO ASC-BLK-SUB                 13100000
131100                   PERFORM 4410-READ-TEMP-STORAGE                 13110000
131200                                                                  13120000
131201                   IF PS-ASNS-TO-WMS-YES                          13120199
131210                      PERFORM 3604-CALL-WMS-MODULE                13121099
131220                   END-IF                                         13122099
131300                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN           13130000
131400                  END-IF                                          13140000
131500                ELSE                                              13150000
131600                   IF ASC-ADD-LINE                                13160000
131700                      PERFORM 2600-ADD-INDIVIDUAL-LINE            13170000
131800                   END-IF                                         13180000
131900               END-IF                                             13190000
132000             END-IF                                               13200000
132100                                                                  13210000
132200*** GO TO  PURCHASE LINE SUMMARY (POLINLN)                        13220000
132300         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              13230000
132400              MOVE ASC-PO-NBR      TO PO017-PO-NBR                13240000
132500                                                                  13250000
132600                                                                  13260000
132700*** GOTO STORE DISTRO BY PACK (RCLPKST)                           13270000
132800         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              13280000
132900          AND ASC-ADD-LINE                                        13290000
133000           PERFORM 5000-PREPARE-SEL-QUEUE                         13300000
133100           PERFORM 7000-FORMAT-COMMAREA                           13310000
133200                                                                  13320000
133300                                                                  13330000
133400*** GOTO TROUBLE LIST                                             13340000
133500         WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)              13350000
133600             PERFORM 5000-PREPARE-SEL-QUEUE                       13360000
133700             IF PC000-NUMBER-OF-SELECTED-ITEMS = 0                13370000
133800                PERFORM 4400-MOVE-COMMAREA-TO-SCREEN              13380000
133900                SET DP030-OVERRIDE-GO TO TRUE                     13390000
134000                MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER         13400000
134100                SET  PS-ERROR                                     13410000
134200                     DP020-MSG-FATAL  TO TRUE                     13420000
134300             ELSE                                                 13430000
134400                 PERFORM 7000-FORMAT-COMMAREA                     13440000
134500             END-IF                                               13450000
134600                                                                  13460000
134700*** GOTO PACK DETAIL LIST     (RCMPKDTL)                          13470000
134800         WHEN DP020-FK-LOCAL-FUNC-05 (DP020-SRC-AID)              13480000
134900             IF ASC-ADD-PACK                                      13490000
135000                IF  ASC-NUMBER-OF-SELECTED-ITEMS = 0              13500000
135100                    SET DP030-OVERRIDE-GO                         13510000
135200                                   TO TRUE                        13520000
135300                    MOVE PC-TSYMSG-00057                          13530000
135400                                   TO DP020-MSG-NUMBER            13540000
135500                    SET DP020-MSG-WARNING                         13550000
135600                                   TO TRUE                        13560000
135700                 ELSE                                             13570000
135800                    PERFORM 5000-PREPARE-SEL-QUEUE                13580000
135900                    PERFORM 7000-FORMAT-COMMAREA                  13590000
136000                 END-IF                                           13600000
136100             ELSE                                                 13610000
136200                 PERFORM 5000-PREPARE-SEL-QUEUE                   13620000
136300                 PERFORM 7000-FORMAT-COMMAREA                     13630000
136400             END-IF                                               13640000
136500                                                                  13650000
136600         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  13660000
136700             MOVE +1               TO PV-TOP-ITEM                 13670000
136800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 13680000
136900                                                                  13690000
137000         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   13700000
137100             PERFORM 2110-BROWSE-BACKWARD                         13710000
137200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 13720000
137300                                                                  13730000
137400         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   13740000
137500             MOVE +0         TO ASC-PREV-PACK-ID                  13750000
137600             PERFORM 2120-BROWSE-FORWARD                          13760000
137700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 13770000
137800                                                                  13780000
137900         WHEN DP020-SRC-AID = DP016-ENTER                         13790000
138000             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   13800000
138100             IF  PS-ERROR                                         13810000
138200                 CONTINUE                                         13820000
138300             ELSE                                                 13830000
138400                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             13840000
138500             END-IF                                               13850000
138600                                                                  13860000
138700         WHEN OTHER                                               13870000
138800             PERFORM 4000-BUILD-INITIAL-PANEL                     13880000
138900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 13890000
139000     END-EVALUATE.                                                13900000
139100                                                                  13910000
139200/                                                                 13920000
139300*----------------------------------------------------------------*13930000
139400*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *13940000
139500*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *13950000
139600*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *13960000
139700*    MESSAGE.                                                    *13970000
139800*----------------------------------------------------------------*13980000
139900                                                                  13990000
140000 2110-BROWSE-BACKWARD.                                            14000000
140100                                                                  14010000
140200     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    14020000
140300         GIVING PV-TOP-ITEM.                                      14030000
140400                                                                  14040000
140500     IF  ((PV-TOP-ITEM < +1)                                      14050000
140600       OR (PV-TOP-ITEM = +1))                                     14060000
140700         MOVE +1                   TO PV-TOP-ITEM                 14070000
140800*        -- TOP OF LIST --                                        14080000
140900         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            14090000
141000         SET DP020-MSG-INFORMATIONAL                              14100000
141100                                   TO TRUE                        14110000
141200     END-IF.                                                      14120000
141300                                                                  14130000
141400/                                                                 14140000
141500*----------------------------------------------------------------*14150000
141600*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *14160000
141700*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *14170000
141800*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *14180000
141900*----------------------------------------------------------------*14190000
142000                                                                  14200000
142100 2120-BROWSE-FORWARD.                                             14210000
142200                                                                  14220000
142300     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              14230000
142400         GIVING PV-TOP-ITEM.                                      14240000
142500                                                                  14250000
142600     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   14260000
142700         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            14270000
142800                                   TO PV-TOP-ITEM                 14280000
142900*        -- BOTTOM OF LIST --                                     14290000
143000         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            14300000
143100         SET DP020-MSG-INFORMATIONAL                              14310000
143200                                   TO TRUE                        14320000
143300     ELSE                                                         14330000
143400         COMPUTE PV-BOTTOM-ITEM =                                 14340000
143500             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 14350000
143600         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            14360000
143700*            -- BOTTOM OF LIST --                                 14370000
143800             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            14380000
143900             SET DP020-MSG-INFORMATIONAL                          14390000
144000                                   TO TRUE                        14400000
144100         END-IF                                                   14410000
144200     END-IF.                                                      14420000
144300                                                                  14430000
144400/                                                                 14440000
144500*----------------------------------------------------------------*14450000
144600*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *14460000
144700*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *14470000
144800*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *14480000
144900*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *14490000
145000*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *14500000
145100*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *14510000
145200*----------------------------------------------------------------*14520000
145300                                                                  14530000
145400 2130-CHECK-FOR-JUMP-BROWSE.                                      14540000
145500                                                                  14550000
145600     SET PS-NO-ERROR               TO TRUE.                       14560000
145700     IF (ASC-START-ITEM-REQUEST = SPACE)                          14570000
145800         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            14580000
145900                                   TO PV-TOP-ITEM                 14590000
146000     ELSE                                                         14600000
146100         MOVE ASC-START-ITEM-REQUEST                              14610000
146200                                   TO DP010I-UNEDITED-FIELD       14620000
146300         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       14630000
146400         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     14640000
146500         SET DP010I-NEGATIVE-NOT-ALLOWED                          14650000
146600                                   TO TRUE                        14660000
146710         CALL DP010I-NUMERIC-EDIT-ROUTINE                         14671099
146720              USING DP010I-NUMERIC-EDIT-AREA                      14672099
146800                                                                  14680000
146900         IF  NOT DP010I-ERROR-DETECTED                            14690000
147000             MOVE DP010I-NUMERIC-FIELD                            14700000
147100                                   TO ASC-START-ITEM-REQUEST-N    14710000
147200             IF  ASC-START-ITEM-REQUEST-N > ZERO                  14720000
147300                 IF  ASC-START-ITEM-REQUEST-N >                   14730000
147400                                          ASC-NUMBER-OF-ITEMS-READ14740000
147500                     MOVE SPACE TO ASC-START-ITEM-REQUEST         14750000
147600                     COMPUTE PV-TOP-ITEM =                        14760000
147700                             ASC-NUMBER-OF-ITEMS-READ             14770000
147800                             - PC-ITEMS-PER-PANEL + 1             14780000
147900                     IF  PV-TOP-ITEM < +1                         14790000
148000                         MOVE +1   TO PV-TOP-ITEM                 14800000
148100                         MOVE PC-TSYMSG-00070                     14810000
148200                                   TO DP020-MSG-NUMBER            14820000
148300                         SET DP020-MSG-INFORMATIONAL              14830000
148400                                   TO TRUE                        14840000
148500                     END-IF                                       14850000
148600                 ELSE                                             14860000
148700                     MOVE ASC-START-ITEM-REQUEST-N                14870000
148800                                   TO PV-TOP-ITEM                 14880000
148900                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      14890000
149000                     COMPUTE PV-BOTTOM-ITEM =                     14900000
149100                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     14910000
149200                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ14920000
149300*                        -- BOTTOM OF LIST --                     14930000
149400                         MOVE PC-TSYMSG-00070                     14940000
149500                                   TO DP020-MSG-NUMBER            14950000
149600                         SET DP020-MSG-INFORMATIONAL              14960000
149700                                   TO TRUE                        14970000
149800                     END-IF                                       14980000
149900                 END-IF                                           14990000
150000             ELSE                                                 15000000
150100*                --- VALUE OUT OF RANGE ----                      15010000
150200                 MOVE PC-TSYMSG-00101                             15020000
150300                                   TO DP020-MSG-NUMBER            15030000
150400                 MOVE -1           TO ASTRTITL                    15040000
150500                 SET DP030-SET-CURSOR-APPL-1                      15050000
150600                                   TO TRUE                        15060000
150700                 MOVE DP015-REVERSE                               15070000
150800                                   TO ASTRTITH                    15080000
150900                 MOVE DP015-RED    TO ASTRTITC                    15090000
151000                 MOVE DP015-UNP-NUM-BRT-MDT                       15100000
151100                                   TO ASTRTITA                    15110000
151200                 SET DP020-MSG-FATAL                              15120000
151300                                   TO TRUE                        15130000
151400                 SET PS-ERROR      TO TRUE                        15140000
151500             END-IF                                               15150000
151600                                                                  15160000
151700         ELSE                                                     15170000
151800             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            15180000
151900             MOVE -1               TO ASTRTITL                    15190000
152000             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  15200000
152100             MOVE DP015-REVERSE    TO ASTRTITH                    15210000
152200             MOVE DP015-RED        TO ASTRTITC                    15220000
152300             MOVE DP015-UNP-NUM-BRT-MDT                           15230000
152400                                   TO ASTRTITA                    15240000
152500             SET DP020-MSG-FATAL   TO TRUE                        15250000
152600             SET PS-ERROR          TO TRUE                        15260000
152700         END-IF                                                   15270000
152800     END-IF.                                                      15280000
152900                                                                  15290000
153000/                                                                 15300000
153100*----------------------------------------------------------------*15310000
153200*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *15320000
153300*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *15330000
153400*----------------------------------------------------------------*15340000
153500 2140-DESELECT-ALL-ITEMS.                                         15350000
153600                                                                  15360000
153700     MOVE +1                       TO ASC-BLK-SUB.                15370000
153800                                                                  15380000
153900     PERFORM 2141-CLEAR-SELECTED-INDS                             15390000
154000         VARYING ASC-ITEM-SUB                                     15400000
154100         FROM 1 BY 1                                              15410000
154200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15420000
154300                                                                  15430000
154400     ADD +1                        TO ASC-BLK-SUB.                15440000
154500                                                                  15450000
154600     PERFORM 2141-CLEAR-SELECTED-INDS                             15460000
154700         VARYING ASC-ITEM-SUB                                     15470000
154800         FROM 1 BY 1                                              15480000
154900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15490000
155000                                                                  15500000
155100     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               15510000
155200                                   TO PV-LIST-ITEM-NUMBER.        15520000
155300                                                                  15530000
155400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            15540000
155500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    15550000
155600                                                                  15560000
155700     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     15570000
155800        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      15580000
155900         MOVE +1                   TO ASC-BLK-SUB                 15590000
156000                                                                  15600000
156100         PERFORM 5100-WRITE-TEMP-STORAGE                          15610000
156200                                                                  15620000
156300         MOVE +1                   TO PV-BLOCK-NUMBER             15630000
156400                                                                  15640000
156500         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         15650000
156600             PV-FIRST-BLOCK-IN-ARRAY - 1                          15660000
156700                                                                  15670000
156800         PERFORM                                                  15680000
156900             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       15690000
157000                                                                  15700000
157100             PERFORM 4410-READ-TEMP-STORAGE                       15710000
157200                                                                  15720000
157300             PERFORM 2141-CLEAR-SELECTED-INDS                     15730000
157400                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 15740000
157500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15750000
157600                                                                  15760000
157700             PERFORM 5100-WRITE-TEMP-STORAGE                      15770000
157800                                                                  15780000
157900             ADD +1                TO PV-BLOCK-NUMBER             15790000
158000                                                                  15800000
158100         END-PERFORM                                              15810000
158200                                                                  15820000
158300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         15830000
158400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     15840000
158500                                                                  15850000
158600         PERFORM                                                  15860000
158700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       15870000
158800                   ASC-HIGHEST-BLOCK-WRITTEN                      15880000
158900                                                                  15890000
159000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          15900000
159100                                   TO PV-BLOCK-NUMBER             15910000
159200                                                                  15920000
159300             PERFORM 4410-READ-TEMP-STORAGE                       15930000
159400                                                                  15940000
159500             PERFORM 2141-CLEAR-SELECTED-INDS                     15950000
159600                 VARYING ASC-ITEM-SUB                             15960000
159700                 FROM 1 BY 1                                      15970000
159800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15980000
159900                                                                  15990000
160000             PERFORM 5100-WRITE-TEMP-STORAGE                      16000000
160100                                                                  16010000
160200             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      16020000
160300                                                                  16030000
160400         END-PERFORM                                              16040000
160500                                                                  16050000
160600         MOVE PV-FIRST-BLOCK-IN-ARRAY                             16060000
160700                                   TO PV-BLOCK-NUMBER             16070000
160800                                                                  16080000
160900         PERFORM 4410-READ-TEMP-STORAGE                           16090000
161000     END-IF.                                                      16100000
161100                                                                  16110000
161200     MOVE +0                       TO ASC-NUMBER-OF-SELECTED-ITEMS16120000
161300                                      ASC-START-OF-SELECTED-RANGE 16130000
161400                                      ASC-END-OF-SELECTED-RANGE.  16140000
161500                                                                  16150000
161600     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        16160000
161700                                                                  16170000
161800/                                                                 16180000
161900*----------------------------------------------------------------*16190000
162000*    MARK EACH ITEM AS BEING NOT SELECTED.                       *16200000
162100*----------------------------------------------------------------*16210000
162200                                                                  16220000
162300 2141-CLEAR-SELECTED-INDS.                                        16230000
162400                                                                  16240000
162500     IF  ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)          16250000
162600             NOT EQUAL ZERO                                       16260000
162700         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          16270000
162800             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          16280000
162900                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    16290000
163000                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  16300000
163100                                   TO TRUE                        16310000
163200         END-IF                                                   16320000
163300     END-IF.                                                      16330000
163400                                                                  16340000
163500/                                                                 16350000
163600*----------------------------------------------------------------*16360000
163700*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *16370000
163800*  FOR ALL ITEMS.                                                *16380000
163900*----------------------------------------------------------------*16390000
164000                                                                  16400000
164100 2150-SELECT-ALL-ITEMS.                                           16410000
164200                                                                  16420000
164300     MOVE +1                       TO ASC-BLK-SUB.                16430000
164400                                                                  16440000
164500     PERFORM 2151-SET-SELECTED-INDS                               16450000
164600         VARYING ASC-ITEM-SUB                                     16460000
164700         FROM 1 BY 1                                              16470000
164800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16480000
164900                                                                  16490000
165000     ADD +1                        TO ASC-BLK-SUB.                16500000
165100                                                                  16510000
165200     PERFORM 2151-SET-SELECTED-INDS                               16520000
165300         VARYING ASC-ITEM-SUB                                     16530000
165400         FROM 1 BY 1                                              16540000
165500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16550000
165600                                                                  16560000
165700     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               16570000
165800                                   TO PV-LIST-ITEM-NUMBER.        16580000
165900                                                                  16590000
166000     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            16600000
166100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    16610000
166200                                                                  16620000
166300     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     16630000
166400        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    16640000
166500         MOVE +1                   TO ASC-BLK-SUB                 16650000
166600                                                                  16660000
166700         PERFORM 5100-WRITE-TEMP-STORAGE                          16670000
166800                                                                  16680000
166900         MOVE +1                   TO PV-BLOCK-NUMBER             16690000
167000                                                                  16700000
167100         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         16710000
167200             PV-FIRST-BLOCK-IN-ARRAY - 1                          16720000
167300                                                                  16730000
167400         PERFORM                                                  16740000
167500             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       16750000
167600                                                                  16760000
167700             PERFORM 4410-READ-TEMP-STORAGE                       16770000
167800                                                                  16780000
167900             PERFORM 2151-SET-SELECTED-INDS                       16790000
168000                 VARYING ASC-ITEM-SUB                             16800000
168100                 FROM 1 BY 1                                      16810000
168200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16820000
168300                                                                  16830000
168400             PERFORM 5100-WRITE-TEMP-STORAGE                      16840000
168500                                                                  16850000
168600             ADD +1                TO PV-BLOCK-NUMBER             16860000
168700         END-PERFORM                                              16870000
168800                                                                  16880000
168900         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         16890000
169000             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     16900000
169100                                                                  16910000
169200         PERFORM                                                  16920000
169300             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       16930000
169400                   ASC-HIGHEST-BLOCK-WRITTEN                      16940000
169500                                                                  16950000
169600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          16960000
169700                                   TO PV-BLOCK-NUMBER             16970000
169800                                                                  16980000
169900             PERFORM 4410-READ-TEMP-STORAGE                       16990000
170000                                                                  17000000
170100             PERFORM 2151-SET-SELECTED-INDS                       17010000
170200                 VARYING ASC-ITEM-SUB                             17020000
170300                 FROM 1 BY 1                                      17030000
170400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          17040000
170500                                                                  17050000
170600             PERFORM 5100-WRITE-TEMP-STORAGE                      17060000
170700                                                                  17070000
170800             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      17080000
170900         END-PERFORM                                              17090000
171000                                                                  17100000
171100         MOVE PV-FIRST-BLOCK-IN-ARRAY                             17110000
171200                                   TO PV-BLOCK-NUMBER             17120000
171300                                                                  17130000
171400         PERFORM 4410-READ-TEMP-STORAGE                           17140000
171500     END-IF.                                                      17150000
171600                                                                  17160000
171700     COMPUTE ASC-NUMBER-OF-SELECTED-ITEMS =                       17170000
171800             ASC-NUMBER-OF-ITEMS-READ - PV-NUMBER-OF-RV-ITEMS.    17180000
171900                                                                  17190000
172000     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        17200000
172100                                                                  17210000
172200/                                                                 17220000
172300*----------------------------------------------------------------*17230000
172400*    MARK EACH ITEM AS BEING SELECTED.                           *17240000
172500*----------------------------------------------------------------*17250000
172600                                                                  17260000
172700 2151-SET-SELECTED-INDS.                                          17270000
172800                                                                  17280000
172900     IF ASC-ADD-PACK                                              17290000
173000        IF ASC-PREV-PACK-ID NOT = ASC-PACK-ID                     17300000
173100                             (ASC-BLK-SUB ASC-ITEM-SUB)  AND      17310000
173200           ASC-PACK-ID (ASC-BLK-SUB ASC-ITEM-SUB) > 0             17320000
173300           IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)            17330000
173400              IF NOT ASC-LNE-REVISE-TRBL                          17340000
173500                     (ASC-BLK-SUB ASC-ITEM-SUB)                   17350000
173600                 SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)         17360000
173700                     ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)    17370000
173800                     ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              17380000
173900                                     TO TRUE                      17390000
174000              ELSE                                                17400000
174100                 ADD 1 TO PV-NUMBER-OF-RV-ITEMS                   17410000
174200              END-IF                                              17420000
174300           END-IF                                                 17430000
174400         END-IF                                                   17440000
174500     ELSE                                                         17450000
174600     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           17460000
174700             NOT EQUAL ZERO                                       17470000
174800         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             17480000
174900              IF NOT ASC-STATUS-CDE(ASC-BLK-SUB ASC-ITEM-SUB)     17490000
175000                                       = PC-STAT-CDE-RV           17500000
175100                 SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)         17510000
175200                     ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)    17520000
175300                     ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              17530000
175400                                       TO TRUE                    17540000
175500              ELSE                                                17550000
175600                 ADD 1 TO PV-NUMBER-OF-RV-ITEMS                   17560000
175700         END-IF                                                   17570000
175800     END-IF.                                                      17580000
175900                                                                  17590000
176000/                                                                 17600000
176100*----------------------------------------------------------------*17610000
176200*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *17620000
176300*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *17630000
176400*----------------------------------------------------------------*17640000
176500 2200-MOVE-SCREEN-TO-COMMAREA.                                    17650000
176600                                                                  17660000
176700     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             17670000
176800     MOVE +1                       TO PV-SUB.                     17680000
176900                                                                  17690000
177000     PERFORM 3100-SET-SUBSCRIPTS.                                 17700000
177100                                                                  17710000
177200     IF  ASTRTITL > ZERO                                          17720000
177300         MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST      17730000
177400     ELSE                                                         17740000
177500         IF  ASTRTITF = DP015-ERASE-EOF                           17750000
177600             INITIALIZE ASC-START-ITEM-REQUEST                    17760000
177700         END-IF                                                   17770000
177800     END-IF.                                                      17780000
177900                                                                  17790000
178000     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          17800000
178100         VARYING PV-SUB                                           17810000
178200         FROM 1 BY 1                                              17820000
178300         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      17830000
178400                                                                  17840000
178500/                                                                 17850000
178600*----------------------------------------------------------------*17860000
178700*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *17870000
178800*----------------------------------------------------------------*17880000
178900 2210-MOVE-LINES-TO-COMMAREA.                                     17890000
179000                                                                  17900000
179100     IF  MR-SELECTL (PV-SUB) > ZERO                               17910000
179200         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     17920000
179300                                   TO TRUE                        17930000
179400         MOVE MR-SELECT (PV-SUB)   TO ASC-TEMP-SELECTED-SW        17940000
179500                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      17950000
179600     ELSE                                                         17960000
179700         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                17970000
179800             SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE         17980000
179900             MOVE SPACE            TO ASC-TEMP-SELECTED-SW        17990000
180000                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      18000000
180100         END-IF                                                   18010000
180200     END-IF.                                                      18020000
180300                                                                  18030000
180400     ADD +1                        TO ASC-ITEM-SUB.               18040000
180500                                                                  18050000
180600     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        18060000
180700         ADD +1                    TO ASC-BLK-SUB                 18070000
180800         MOVE +1                   TO ASC-ITEM-SUB                18080000
180900     END-IF.                                                      18090000
181000                                                                  18100000
181100/                                                                 18110000
181200******************************************************************18120000
181300* GET THE KEYS OF THE NEXT SELECTED OBJECT FROM THE              *18130000
181400* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *18140000
181500******************************************************************18150000
181600 2300-GET-NEXT-RECORD.                                            18160000
181700                                                                  18170000
181800     ADD +1                        TO ASC-SEL-SUB.                18180000
181900     IF ASC-SEL-SUB > RC801-MAX-ITEMS                             18190000
182000         ADD +1                    TO ASC-SEL-ITEM                18200000
182100         MOVE +1                   TO ASC-SEL-SUB                 18210000
182200     END-IF.                                                      18220000
182300     IF ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                 18230000
182400         PERFORM 9100-READ-SEL-QUEUE                              18240000
182500         IF RC801-ITEM (ASC-SEL-SUB) > ZERO                       18250000
182600             INITIALIZE ASC-LIST-KEYS                             18260000
182700             MOVE RC800-REC-NBR-N       TO ASC-PO-NBR             18270000
182800                                           DK-ORD-NBR             18280000
182900             MOVE RC800-REC-SEQ-NBR-N   TO ASC-REC-SEQ-NBR        18290000
183000                                           DK-REC-SEQ-NBR         18300000
183100             MOVE RC800-OPER-UNIT-ID    TO ASC-OPR-ID             18310000
183200                                           DK-OPER-UNT-ID         18320000
183300             MOVE RC800-FACILITY-ID     TO ASC-FACT               18330000
183400                                           DK-FACT                18340000
183500             MOVE RC800-PACK-ID         TO ASC-DRIVER-PACK-ID     18350000
183600                                           DK-PACK-ID             18360000
183700             SET RC801-INQ (ASC-SEL-SUB)                          18370000
183800                                        TO TRUE                   18380000
183900             PERFORM 9200-REWRITE-LIST-QUEUE                      18390000
184000         ELSE                                                     18400000
184100             SUBTRACT +1 FROM ASC-SEL-SUB                         18410000
184200*            --- BOTTOM OF LIST ---                               18420000
184300             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            18430000
184400             SET DP020-MSG-INFORMATIONAL                          18440000
184500                                   TO TRUE                        18450000
184600         END-IF                                                   18460000
184700     ELSE                                                         18470000
184800         SUBTRACT +1 FROM ASC-SEL-ITEM                            18480000
184900         MOVE RC801-MAX-ITEMS      TO ASC-SEL-SUB                 18490000
185000         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            18500000
185100         SET DP020-MSG-INFORMATIONAL                              18510000
185200                                   TO TRUE                        18520000
185300     END-IF.                                                      18530000
185400                                                                  18540000
185500/                                                                 18550000
185600******************************************************************18560000
185700* GET THE KEYS OF THE PREVIOUS SELECTED OBJECT FROM THE          *18570000
185800* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *18580000
185900******************************************************************18590000
186000 2310-GET-PREV-RECORD.                                            18600000
186100                                                                  18610000
186200     SUBTRACT +1 FROM ASC-SEL-SUB.                                18620000
186300     IF ASC-SEL-SUB < +1                                          18630000
186400         SUBTRACT +1 FROM ASC-SEL-ITEM                            18640000
186500         MOVE RC801-MAX-ITEMS      TO ASC-SEL-SUB                 18650000
186600     END-IF.                                                      18660000
186700                                                                  18670000
186800     IF ASC-SEL-ITEM > ZERO                                       18680000
186900         PERFORM 9100-READ-SEL-QUEUE                              18690000
187000         INITIALIZE ASC-LIST-KEYS                                 18700000
187100         MOVE RC800-REC-NBR-N      TO ASC-PO-NBR                  18710000
187200         MOVE RC800-REC-SEQ-NBR-N  TO ASC-REC-SEQ-NBR             18720000
187300         MOVE RC800-OPER-UNIT-ID   TO ASC-OPR-ID                  18730000
187400                                      DK-OPER-UNT-ID              18740000
187500         MOVE RC800-FACILITY-ID    TO ASC-FACT                    18750000
187600                                      DK-FACT                     18760000
187700         MOVE RC800-PACK-ID        TO ASC-DRIVER-PACK-ID          18770000
187800                                      DK-PACK-ID                  18780000
187900     ELSE                                                         18790000
188000         MOVE +1                   TO ASC-SEL-ITEM                18800000
188100                                      ASC-SEL-SUB                 18810000
188200*        --- TOP OF LIST ---                                      18820000
188300         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            18830000
188400         SET DP020-MSG-INFORMATIONAL                              18840000
188500                                   TO TRUE                        18850000
188600     END-IF.                                                      18860000
188700                                                                  18870000
188800/                                                                 18880000
188900******************************************************************18890000
189000* GET THE KEYS OF THE NEXT SELECTED PACKSLIP OBJECT FROM THE     *18900000
189100* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *18910000
189200******************************************************************18920000
189300 2400-GET-NEXT-PKSL-RECORD.                                       18930000
189400                                                                  18940000
189500     ADD +1                           TO ASC-SEL-SUB.             18950000
189600     IF ASC-SEL-SUB > RC801-MAX-ITEMS                             18960000
189700         ADD +1                       TO ASC-SEL-ITEM             18970000
189800         MOVE +1                      TO ASC-SEL-SUB              18980000
189900     END-IF.                                                      18990000
190000     IF ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                 19000000
190100         PERFORM 9300-READ-PKSL-SEL-QUEUE                         19010000
190200         IF RC800-REC-NBR-N     > ZERO                            19020000
190300             INITIALIZE ASC-LIST-KEYS                             19030000
190400             MOVE RC800-REC-NBR-N     TO ASC-PO-NBR               19040000
190500                                         DK-ORD-NBR               19050000
190600             MOVE RC800-REC-SEQ-NBR-N TO ASC-REC-SEQ-NBR          19060000
190700                                         DK-REC-SEQ-NBR           19070000
190800             MOVE RC800-OPER-UNIT-ID  TO ASC-OPR-ID               19080000
190900                                         DK-OPER-UNT-ID           19090000
191000             MOVE RC800-FACILITY-ID   TO ASC-FACT                 19100000
191100                                         DK-FACT                  19110000
191200             MOVE RC801-PACK-ID (ASC-SEL-SUB)                     19120000
191300                                      TO ASC-DRIVER-PACK-ID       19130000
191400                                         DK-PACK-ID               19140000
191500             MOVE RC801-PACK-DESC (ASC-SEL-SUB)                   19150000
191600                                      TO RC800-PREPACK-DESC       19160000
191700             SET RC801-INQ (ASC-SEL-SUB)                          19170000
191800                                      TO TRUE                     19180000
191900             PERFORM 9400-REWRITE-PKSL-LIST-QUEUE                 19190000
192000         ELSE                                                     19200000
192100             SUBTRACT +1 FROM ASC-SEL-SUB                         19210000
192200*            --- BOTTOM OF LIST ---                               19220000
192300             MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER         19230000
192400             SET DP020-MSG-INFORMATIONAL                          19240000
192500                                      TO TRUE                     19250000
192600         END-IF                                                   19260000
192700     ELSE                                                         19270000
192800         SUBTRACT +1 FROM ASC-SEL-ITEM                            19280000
192900         MOVE RC801-MAX-ITEMS         TO ASC-SEL-SUB              19290000
193000         MOVE PC-TSYMSG-00070         TO DP020-MSG-NUMBER         19300000
193100         SET DP020-MSG-INFORMATIONAL  TO TRUE                     19310000
193200     END-IF.                                                      19320000
193300                                                                  19330000
193400                                                                  19340000
193500/                                                                 19350000
193600******************************************************************19360000
193700* GET THE KEYS OF THE PREVIOUS SELECTED PACK SLIP OBJECT FROM THE*19370000
193800* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *19380000
193900******************************************************************19390000
194000 2410-GET-PREV-PKSL-RECORD.                                       19400000
194100                                                                  19410000
194200                                                                  19420000
194300     SUBTRACT +1 FROM ASC-SEL-SUB.                                19430000
194400     IF ASC-SEL-SUB < +1                                          19440000
194500         SUBTRACT +1 FROM ASC-SEL-ITEM                            19450000
194600         MOVE RC801-MAX-ITEMS      TO ASC-SEL-SUB                 19460000
194700     END-IF.                                                      19470000
194800                                                                  19480000
194900     IF ASC-SEL-ITEM > ZERO                                       19490000
195000         PERFORM 9300-READ-PKSL-SEL-QUEUE                         19500000
195100         INITIALIZE ASC-LIST-KEYS                                 19510000
195200         MOVE RC015-PO-NBR         TO ASC-PO-NBR                  19520000
195300         MOVE RC015-REC-SEQ-NBR    TO ASC-REC-SEQ-NBR             19530000
195400         MOVE RC015-OPER-UNT-ID    TO ASC-OPR-ID                  19540000
195500                                      DK-OPER-UNT-ID              19550000
195600         MOVE RC015-FCLTY-ID       TO ASC-FACT                    19560000
195700                                      DK-FACT                     19570000
195800     ELSE                                                         19580000
195900         MOVE +1                   TO ASC-SEL-ITEM                19590000
196000                                      ASC-SEL-SUB                 19600000
196100*        --- TOP OF LIST ---                                      19610000
196200         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            19620000
196300         SET DP020-MSG-INFORMATIONAL                              19630000
196400                                   TO TRUE                        19640000
196500     END-IF.                                                      19650000
196600                                                                  19660000
196700/                                                                 19670000
196800                                                                  19680000
196900                                                                  19690000
197000*---------------------------------------------------------------* 19700000
197100* CALL THE VALIDATION MODULE (RCKCS806) TO GET INFORMATION     -* 19710000
197200* SUCH AS ODD UNITS AND THE PACK DRIVER LINE TO UPDATE TRECITM -* 19720000
197300* WITH.                                                       '-* 19730000
197400*---------------------------------------------------------------* 19740000
197500 2450-CHECK-VALIDATION.                                           19750000
197600     MOVE +1                   TO PV-VALID-IDX.                   19760000
197700                                                                  19770000
197800     PERFORM 9500-CALL-VALIDATION-MODULE.                         19780000
197900                                                                  19790000
198000     PERFORM                                                      19800000
198100          VARYING PV-VALID-IDX                                    19810000
198200          FROM 1 BY 1                                             19820000
198300          UNTIL PV-VALID-IDX > RC806-NBR-OF-LINES                 19830000
198400             OR PV-VALID-IDX  > 500                               19840000
198500                                                                  19850000
198600          MOVE RC806-PKSL-LNE-NBR  (PV-VALID-IDX)                 19860000
198700                                  TO DK-LINE-NBR                  19870000
198800          PERFORM 2451-SELECT-ORIG-RECITM                         19880000
198900                                                                  19890000
199000          IF RC806-ODD-UNITS (PV-VALID-IDX) = +99999              19900000
199100             MOVE +9999           TO RECITM-PREPK-ODD-UNT-QTY     19910000
199200          ELSE                                                    19920000
199300             MOVE RC806-ODD-UNITS (PV-VALID-IDX)                  19930000
199400                                  TO RECITM-PREPK-ODD-UNT-QTY     19940000
199500          END-IF                                                  19950000
199600                                                                  19960000
199700          IF RC806-DRIVER-LNE-SUB  = PV-VALID-IDX                 19970000
199800                MOVE 'A'          TO RECITM-PREPK-DRV-LNE-CDE     19980000
199900                MOVE DK-LINE-NBR  TO PV-DRIVER-LINE-NBR           19990000
200000          ELSE                                                    20000000
200100             IF RECITM-PREPK-DRV-LNE-CDE = 'A'                    20010000
200200                MOVE 'I'          TO RECITM-PREPK-DRV-LNE-CDE     20020000
200300             END-IF                                               20030000
200400          END-IF                                                  20040000
200500                                                                  20050000
200600          EXEC SQL                                                20060000
200700              UPDATE TRECITM                                      20070000
200800              SET                                                 20080000
200900                  PREPK_ODD_UNT_QTY   = :RECITM-PREPK-ODD-UNT-QTY 20090000
201000                , PREPK_DRV_LNE_CDE   = :RECITM-PREPK-DRV-LNE-CDE 20100000
201100               WHERE ORD_NBR          = :DK-ORD-NBR               20110000
201200                 AND ORD_LNE_NBR      = :DK-LINE-NBR              20120000
201300                 AND REC_SEQ_NBR      = :DK-REC-SEQ-NBR           20130000
201400                 AND OPER_UNT_ID      = :DK-OPER-UNT-ID           20140000
201500                 AND FCLTY_ID         = :DK-FACT                  20150000
201600                 AND VER_STATUS_CDE   = 'A'                       20160000
201700                 AND PREPK_ID         = :DK-PACK-ID               20170000
201800            END-EXEC                                              20180000
201900            EVALUATE TRUE                                         20190000
202000              WHEN SQLCODE = ZERO                                 20200000
202100                   CONTINUE                                       20210000
202200                                                                  20220000
202300              WHEN SQLCODE = -904                                 20230000
202400              WHEN SQLCODE = -911                                 20240000
202500              WHEN SQLCODE = -913                                 20250000
202600                  PERFORM 9900-SOFT-ABORT                         20260000
202700                                                                  20270000
202800              WHEN SQLWARN0 NOT = SPACES                          20280000
202900              WHEN SQLCODE < +0                                   20290000
203000              WHEN SQLCODE > +0                                   20300000
203100                   MOVE '2450-CHECK-VALIDATION'                   20310000
203200                                    TO DP013-PARAGRAPH            20320000
203300                   MOVE 'UNSUCCESSFUL UPDATE FOR TRECITM'         20330000
203400                                    TO DP013-MESSAGE-TEXT (1)     20340000
203500                   MOVE SQLCA       TO DP013-SQLCA                20350000
203600                   MOVE 'TRECITM '  TO DP013-DB2-TABLE-NAME (1)   20360000
203700                   SET DP013-DB2-ABEND                            20370000
203800                       DP013-XCTL-DISPLAY-RESTART                 20380000
203900                                    TO TRUE                       20390000
204000                   PERFORM DP013-0000-PROCESS-ABEND               20400000
204100            END-EVALUATE                                          20410000
204200                                                                  20420000
204300     END-PERFORM.                                                 20430000
204400                                                                  20440000
204500                                                                  20450000
204600*---------------------------------------------------------------* 20460000
204700* SELECT THE ORIGINAL VALUES OF RECITM BEFORE ANY UPDATING     -* 20470000
204800* OCCURS.                                                      -* 20480000
204900*---------------------------------------------------------------* 20490000
205000 2451-SELECT-ORIG-RECITM.                                         20500000
205100                                                                  20510000
205200     EXEC SQL                                                     20520000
205300          SELECT ORD_NBR                                          20530000
205400                ,PREPK_ID                                         20540000
205500                ,PREPK_DRV_LNE_CDE                                20550000
205600            INTO :RECITM-ORD-NBR                                  20560000
205700                ,:RECITM-PREPK-ID                                 20570000
205800                ,:RECITM-PREPK-DRV-LNE-CDE                        20580000
205900            FROM TRECITM                                          20590000
206000           WHERE ORD_NBR        = :DK-ORD-NBR                     20600000
206100             AND ORD_LNE_NBR    = :DK-LINE-NBR                    20610000
206200             AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR                 20620000
206300             AND VER_STATUS_CDE = 'A'                             20630000
206400     END-EXEC.                                                    20640000
206500                                                                  20650000
206600     EVALUATE TRUE                                                20660000
206700         WHEN SQLCODE = +0                                        20670000
206800         WHEN SQLCODE = +100                                      20680000
206900              CONTINUE                                            20690000
207000                                                                  20700000
207100          WHEN SQLCODE = -904                                     20710000
207200          WHEN SQLCODE = -911                                     20720000
207300          WHEN SQLCODE = -913                                     20730000
207400               PERFORM 9900-SOFT-ABORT                            20740000
207500                                                                  20750000
207600         WHEN SQLWARN0 NOT = SPACES                               20760000
207700         WHEN SQLCODE < +0                                        20770000
207800         WHEN SQLCODE > +0                                        20780000
207900              MOVE '2451-SELECT-ORIG-RECITM'                      20790000
208000                               TO DP013-PARAGRAPH                 20800000
208100              MOVE 'UNSUCCESSFUL SELECT ON TRECITM'               20810000
208200                               TO DP013-MESSAGE-TEXT (1)          20820000
208300              MOVE SQLCA       TO DP013-SQLCA                     20830000
208400              MOVE 'TRECITM '  TO DP013-DB2-TABLE-NAME (1)        20840000
208500              SET DP013-DB2-ABEND                                 20850000
208600                  DP013-XCTL-DISPLAY-RESTART                      20860000
208700                               TO TRUE                            20870000
208800              PERFORM DP013-0000-PROCESS-ABEND                    20880000
208900     END-EVALUATE.                                                20890000
209000                                                                  20900000
209100                                                                  20910000
209200                                                                  20920000
209300*----------------------------------------------------------------*20930000
209400*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *20940000
209500*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *20950000
209600*----------------------------------------------------------------*20960000
209700 2500-ADD-ALL-LINES-TO-PACK.                                      20970000
209800                                                                  20980000
209900     PERFORM 6112-READ-LIST-QUEUE.                                20990000
210000                                                                  21000000
210100     IF PV-CICS-RESP = DFHRESP (NORMAL)                           21010000
210200         PERFORM                                                  21020000
210300           VARYING LQW-IDX  FROM 1 BY 1                           21030000
210400           UNTIL LQW-IDX > PC-ITEMS-PER-PANEL          OR         21040000
210500                 LQW-LIST-ITEM-NUMBER (LQW-IDX) = ZERO            21050000
210600                                                                  21060000
210700               IF LQW-SELECT (LQW-IDX) AND                        21070000
210800                  LQW-PACK-ID (LQW-IDX) NOT = ASC-PREV-PACK-ID    21080000
210900                                                                  21090000
211000                   INITIALIZE RC806-PRODUCT-PACK-VALIDATION       21100000
211100                   SET PS-PREV-PACK-TIED                          21110000
211200                       ASC-ITEMS-LEFT-ON-DB                       21120000
211300                                   TO TRUE                        21130000
211400                                                                  21140000
211500                   MOVE +0         TO ASC-SEL-ITEM                21150000
211600                   MOVE +1         TO PV-VALID-IDX                21160000
211700                   MOVE LQW-PACK-ID (LQW-IDX)                     21170000
211800                                   TO ASC-PREV-PACK-ID            21180000
211900                   PERFORM 4100-PREPARE-CURSOR                    21190000
212000                   MOVE LQW-PACK-ID (LQW-IDX)                     21200000
212100                                   TO DK-PACK-ID                  21210000
212200                   MOVE LQW-LINE-NUMBER (LQW-IDX)                 21220000
212300                                   TO DK-LINE-NBR                 21230000
212400                   PERFORM 2451-SELECT-ORIG-RECITM                21240000
212500                   IF RECITM-PREPK-ID = LQW-PACK-ID-N (LQW-IDX)   21250000
212600* CHECK IF THE PACK HAS BEEN ADDED ALREADY                        21260000
212700                       MOVE PC-TSYMSG-00117                       21270000
212800                                 TO DP020-MSG-NUMBER              21280000
212900                       SET DP020-MSG-FATAL                        21290000
213000                           DP030-OVERRIDE-GO                      21300000
213100                           PS-DUPLICATE  TO TRUE                  21310000
213200                       SET LQW-DESELECT (LQW-IDX)                 21320000
213300                                      TO TRUE                     21330000
213400                       MOVE LQW-SELECTED-SW (LQW-IDX)             21340000
213500                                      TO LQW-TEMP-SELECTED-SW     21350000
213600                                            (LQW-IDX)             21360000
213700                       MOVE SPACES    TO LQW-ACTION (LQW-IDX)     21370000
213800                       MOVE PV-ITEM   TO PV-SAVE-ITEM             21380000
213900                       PERFORM 6111-WRITE-LIST-QUEUE              21390000
214000                   ELSE                                           21400000
214100                      PERFORM 4360-GET-TPURCHS-INFO               21410000
214200                                                                  21420000
214300                      PERFORM 8010-OPEN-CURSOR                    21430000
214400                      PERFORM 8000-ADD-PACK-RECITM                21440000
214500                        UNTIL ASC-NO-ITEMS-LEFT-ON-DB             21450000
214600                      PERFORM 8030-CLOSE-CURSOR                   21460000
214700                                                                  21470000
214800                       ADD +1         TO ASC-SEL-ITEM             21480000
214900                                         ASC-SEL-SUB              21490000
215000                       IF ASC-USE-SELECTION-QUEUE                 21500000
215100                          PERFORM 5300-UPDATE-SELECTION-QUEUE     21510000
215200                       END-IF                                     21520000
215300                                                                  21530000
215400                       IF PV-PACK-BY-ST-IND = PC-Y                21540000
215500                          CONTINUE                                21550000
215600                       ELSE                                       21560000
215700                         SET DP030-OVERRIDE-GO                    21570000
215800                                       TO TRUE                    21580000
215900                       END-IF                                     21590000
216000                       MOVE LQW-PACK-ID (LQW-IDX)                 21600000
216100                                      TO DK-PACK-ID               21610000
216200                       PERFORM 2450-CHECK-VALIDATION              21620000
216300                                                                  21630000
216400                       SET LQW-DESELECT (LQW-IDX)                 21640000
216500                                      TO TRUE                     21650000
216600                       MOVE LQW-SELECTED-SW (LQW-IDX)             21660000
216700                                      TO LQW-TEMP-SELECTED-SW     21670000
216800                                            (LQW-IDX)             21680000
216900                       MOVE PV-ITEM   TO PV-SAVE-ITEM             21690000
217000                       MOVE PC-UPD    TO LQW-ACTION (LQW-IDX)     21700000
217100                       IF PS-DUPLICATE                            21710000
217200                          CONTINUE                                21720000
217300                       ELSE                                       21730000
217400                          IF PS-PREV-PACK-UNTIED                  21740000
217500                             PERFORM 9040-CHECK-FOR-TROUBLE       21750000
217600                          ELSE                                    21760000
217700                             SET ASC-USE-MAINTAIN-MSG             21770000
217800                                      TO TRUE                     21780000
217900                          END-IF                                  21790000
218000                       END-IF                                     21800000
218100                       PERFORM 6111-WRITE-LIST-QUEUE              21810000
218200                   ELSE                                           21820000
218300                      IF LQW-SELECT (LQW-IDX)                     21830000
218400                         CONTINUE                                 21840000
218500                      END-IF                                      21850000
218600                END-IF                                            21860000
218700          END-PERFORM.                                            21870000
218800                                                                  21880000
218900                                                                  21890000
219000*----------------------------------------------------------------*21900000
219100*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *21910000
219200*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *21920000
219300*----------------------------------------------------------------*21930000
219400 2600-ADD-INDIVIDUAL-LINE.                                        21940000
219500                                                                  21950000
219600      IF ASC-NUMBER-OF-SELECTED-ITEMS = 0                         21960000
219700         SET DP030-OVERRIDE-GO                                    21970000
219800             DP020-MSG-WARNING   TO TRUE                          21980000
219900         MOVE PC-TSYMSG-00057    TO DP020-MSG-NUMBER              21990000
220000      ELSE                                                        22000000
220100         PERFORM 5000-PREPARE-SEL-QUEUE                           22010000
220200         IF RC800-NUMBER-OF-SELECTED-ITEMS = 0                    22020000
220300            IF PS-VERIFIED-RECEIVER                               22030000
220400               SET DP030-OVERRIDE-GO                              22040000
220500                   DP020-MSG-WARNING     TO TRUE                  22050000
220600                MOVE PC-TSYMSG-00883     TO DP020-MSG-NUMBER      22060000
220700            ELSE                                                  22070000
220800                SET DP030-OVERRIDE-GO                             22080000
220900                    DP020-MSG-WARNING    TO TRUE                  22090000
221000                MOVE PC-TSYMSG-00883     TO DP020-MSG-NUMBER      22100000
221100            END-IF                                                22110000
221200         ELSE                                                     22120000
221300            PERFORM 7000-FORMAT-COMMAREA.                         22130000
221400                                                                  22140000
221500                                                                  22150000
221600                                                                  22160000
221700/                                                                 22170000
221800*----------------------------------------------------------------*22180000
221900*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *22190000
222000*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *22200000
222100*----------------------------------------------------------------*22210000
222200 3000-EDIT-DATA-IN-COMMAREA.                                      22220000
222300                                                                  22230000
222400     SET PS-NO-ERROR               TO TRUE.                       22240000
222500                                                                  22250000
222600     PERFORM 3200-RESET-ATTRIBUTES.                               22260000
222700                                                                  22270000
222800     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     22280000
222900**                                                                22290000
223000* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              22300000
223100* EDITTING IS DONE FROM THE BOTTOM UP.                            22310000
223200**                                                                22320000
223300     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       22330000
223400         ASC-ITEMS-DISPLAYED - 1.                                 22340000
223500                                                                  22350000
223600     PERFORM 3100-SET-SUBSCRIPTS.                                 22360000
223700     PERFORM 3300-EDIT-SELECTIONS                                 22370000
223800         VARYING PV-SUB                                           22380000
223900         FROM PV-SUB BY -1                                        22390000
224000         UNTIL PV-SUB < +1.                                       22400000
224100                                                                  22410000
224200/                                                                 22420000
224300*----------------------------------------------------------------*22430000
224400*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *22440000
224500*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*22450000
224600*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *22460000
224700*                                                                *22470000
224800*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *22480000
224900*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *22490000
225000*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *22500000
225100*    US IN THE 2ND BLOCK OF THE ARRAY.                           *22510000
225200*----------------------------------------------------------------*22520000
225300                                                                  22530000
225400 3100-SET-SUBSCRIPTS.                                             22540000
225500                                                                  22550000
225600     COMPUTE ASC-ITEM-SUB =                                       22560000
225700         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        22570000
225800                                                                  22580000
225900     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         22590000
226000         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            22600000
226100                                                                  22610000
226200         MOVE PC-MAX-BLOCKS-IN-ARRAY                              22620000
226300                                   TO ASC-BLK-SUB                 22630000
226400     ELSE                                                         22640000
226500         MOVE +1                   TO ASC-BLK-SUB                 22650000
226600     END-IF.                                                      22660000
226700                                                                  22670000
226800*----------------------------------------------------------------*22680000
226900*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *22690000
227000*----------------------------------------------------------------*22700000
227100                                                                  22710000
227200 3200-RESET-ATTRIBUTES.                                           22720000
227300                                                                  22730000
227400     MOVE DP015-UNP-ALP-NOR-OFF       TO ASTRTITA.                22740000
227500     MOVE DP015-GREEN                 TO ASTRTITC.                22750000
227600     MOVE DP015-UNDERLINE             TO ASTRTITH.                22760000
227700                                                                  22770000
227800     IF DP020-NEXT-ACT-RETURN                                     22780000
227900     OR DP020-NEXT-ACT-READ-MAP                                   22790000
228000        PERFORM                                                   22800000
228100            VARYING PV-SUB                                        22810000
228200            FROM 1 BY 1                                           22820000
228300            UNTIL PV-SUB > ASC-ITEMS-DISPLAYED                    22830000
228400            MOVE DP015-UNP-ALP-NOR-OFF                            22840000
228500                                      TO MR-SELECTA (PV-SUB)      22850000
228600            MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)      22860000
228700        END-PERFORM                                               22870000
228800     ELSE                                                         22880000
228900        PERFORM                                                   22890000
229000            VARYING PV-SUB                                        22900000
229100            FROM 1 BY 1                                           22910000
229200            UNTIL PV-SUB > PC-ITEMS-PER-PANEL                     22920000
229300            MOVE DP015-UNP-ALP-NOR-OFF                            22930000
229400                                      TO MR-SELECTA (PV-SUB)      22940000
229500            MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)      22950000
229600            MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)      22960000
229700        END-PERFORM                                               22970000
229800     END-IF.                                                      22980000
229900                                                                  22990000
230000/                                                                 23000000
230100*----------------------------------------------------------------*23010000
230200*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *23020000
230300*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *23030000
230400*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *23040000
230500*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *23050000
230600*----------------------------------------------------------------*23060000
230700 3300-EDIT-SELECTIONS.                                            23070000
230800                                                                  23080000
230900     EVALUATE TRUE                                                23090000
231000         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     23100000
231100             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         23110000
231200                 CONTINUE                                         23120000
231300                                                                  23130000
231400         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         23140000
231500             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        23150000
231600                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMS23160000
231700                 ADD  +1           TO ASC-PACKS-DISPLAYED         23170000
231800                 MOVE ASC-TEMP-SELECTED-SW                        23180000
231900                                     (ASC-BLK-SUB ASC-ITEM-SUB)   23190000
232000                                   TO ASC-SELECTED-SW             23200000
232100                                     (ASC-BLK-SUB ASC-ITEM-SUB)   23210000
232200             END-IF                                               23220000
232300                                                                  23230000
232400         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     23240000
232500                 = SPACE                                          23250000
232600             EVALUATE TRUE                                        23260000
232700                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       23270000
232800                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS23280000
232900                     SUBTRACT +1 FROM ASC-PACKS-DISPLAYED         23290000
233000                     MOVE SPACE    TO ASC-SELECTED-SW             23300000
233100                                     (ASC-BLK-SUB ASC-ITEM-SUB)   23310000
233200                                                                  23320000
233300                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        23330000
233400                     MOVE ZERO     TO ASC-START-OF-SELECTED-RANGE 23340000
233500                     MOVE SPACE    TO ASC-SELECTED-SW             23350000
233600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   23360000
233700                                                                  23370000
233800                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          23380000
233900                     MOVE ZERO     TO ASC-END-OF-SELECTED-RANGE   23390000
234000                     MOVE SPACE    TO ASC-SELECTED-SW             23400000
234100                                     (ASC-BLK-SUB ASC-ITEM-SUB)   23410000
234200             END-EVALUATE                                         23420000
234300                                                                  23430000
234400         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           23440000
234500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            23450000
234600                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    23460000
234700                 SUBTRACT +1 FROM ASC-PACKS-DISPLAYED             23470000
234800             END-IF                                               23480000
234900             PERFORM 3310-EDIT-RANGE                              23490000
235000                                                                  23500000
235100         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             23510000
235200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            23520000
235300                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    23530000
235400                 SUBTRACT +1 FROM ASC-PACKS-DISPLAYED             23540000
235500             END-IF                                               23550000
235600             PERFORM 3310-EDIT-RANGE                              23560000
235700                                                                  23570000
235800         WHEN OTHER                                               23580000
235900             MOVE PC-TSYMSG-00005  TO DP020-MSG-NUMBER            23590000
236000             SET DP020-MSG-FATAL   TO TRUE                        23600000
236100             MOVE -1               TO MR-SELECTL (PV-SUB)         23610000
236200             SET DP030-SET-CURSOR-APPL-1                          23620000
236300                                   TO TRUE                        23630000
236400             MOVE DP015-RED        TO MR-SELECTC (PV-SUB)         23640000
236500             MOVE DP015-REVERSE    TO MR-SELECTH (PV-SUB)         23650000
236600             SET PS-ERROR          TO TRUE                        23660000
236700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            23670000
236800                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     23680000
236900                 SUBTRACT +1 FROM ASC-PACKS-DISPLAYED             23690000
237000                 MOVE SPACE        TO ASC-SELECTED-SW             23700000
237100                                     (ASC-BLK-SUB ASC-ITEM-SUB)   23710000
237200             END-IF                                               23720000
237300     END-EVALUATE.                                                23730000
237400                                                                  23740000
237500     IF ASC-LNE-REVISE-TRBL (ASC-BLK-SUB ASC-ITEM-SUB)            23750000
237600     OR ASC-STATUS-CDE (ASC-BLK-SUB ASC-ITEM-SUB) = PC-STAT-CDE-RV23760000
237700         MOVE DP015-ASK-DRK-OFF TO MR-SELECTA (PV-SUB)            23770000
237800     END-IF.                                                      23780000
237900                                                                  23790000
238000     SUBTRACT +1 FROM PV-ITEM-IN-USE.                             23800000
238100     SUBTRACT +1 FROM ASC-ITEM-SUB.                               23810000
238200                                                                  23820000
238300     IF  ASC-ITEM-SUB < 1                                         23830000
238400         SUBTRACT +1 FROM ASC-BLK-SUB                             23840000
238500         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                23850000
238600     END-IF.                                                      23860000
238700                                                                  23870000
238800*----------------------------------------------------------------*23880000
238900*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *23890000
239000*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *23900000
239100*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *23910000
239200*  THE ENDING.                                                   *23920000
239300*----------------------------------------------------------------*23930000
239400 3310-EDIT-RANGE.                                                 23940000
239500                                                                  23950000
239600     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                23960000
239700         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   23970000
239800             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)23980000
239900                                   TO ASC-SELECTED-SW             23990000
240000                                        (ASC-BLK-SUB ASC-ITEM-SUB)24000000
240100             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 24010000
240200         ELSE                                                     24020000
240300             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     24030000
240400                 CONTINUE                                         24040000
240500             ELSE                                                 24050000
240600*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        24060000
240700                 MOVE PC-TSYMSG-00054                             24070000
240800                                   TO DP020-MSG-NUMBER            24080000
240900                 SET DP020-MSG-FATAL                              24090000
241000                                   TO TRUE                        24100000
241100                 MOVE -1           TO MR-SELECTL (PV-SUB)         24110000
241200                 SET DP030-SET-CURSOR-APPL-1                      24120000
241300                                   TO TRUE                        24130000
241400                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         24140000
241500                 MOVE DP015-UNDERLINE                             24150000
241600                                   TO MR-SELECTH (PV-SUB)         24160000
241700                 SET PS-ERROR      TO TRUE                        24170000
241800             END-IF                                               24180000
241900         END-IF                                                   24190000
242000     ELSE                                                         24200000
242100         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     24210000
242200             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 24220000
242300                                   TO ASC-SELECTED-SW             24230000
242400                                     (ASC-BLK-SUB ASC-ITEM-SUB)   24240000
242500             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   24250000
242600         ELSE                                                     24260000
242700             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       24270000
242800                 CONTINUE                                         24280000
242900             ELSE                                                 24290000
243000*                -- ONLY ONE END-OF-RANGE ALLOWED --              24300000
243100                 MOVE PC-TSYMSG-00055                             24310000
243200                                   TO DP020-MSG-NUMBER            24320000
243300                 SET DP020-MSG-FATAL                              24330000
243400                                   TO TRUE                        24340000
243500                 MOVE -1           TO MR-SELECTL (PV-SUB)         24350000
243600                 SET DP030-SET-CURSOR-APPL-1                      24360000
243700                                   TO TRUE                        24370000
243800                 SET PS-ERROR      TO TRUE                        24380000
243900             END-IF                                               24390000
244000         END-IF                                                   24400000
244100     END-IF.                                                      24410000
244200                                                                  24420000
244300*----------------------------------------------------------------*24430000
244400*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *24440000
244500*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *24450000
244600*----------------------------------------------------------------*24460000
244700 3400-CHECK-RANGE-SEQUENCE.                                       24470000
244800                                                                  24480000
244900     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       24490000
245000       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      24500000
245100       AND  ASC-START-OF-SELECTED-RANGE >                         24510000
245200                                         ASC-END-OF-SELECTED-RANGE24520000
245300*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                24530000
245400         MOVE PC-TSYMSG-00052      TO DP020-MSG-NUMBER            24540000
245500         SET DP020-MSG-FATAL       TO TRUE                        24550000
245600         SET PS-ERROR              TO TRUE                        24560000
245700         PERFORM 3410-POSITION-AT-ERROR                           24570000
245800     END-IF.                                                      24580000
245900                                                                  24590000
246000*----------------------------------------------------------------*24600000
246100*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *24610000
246200*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *24620000
246300*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *24630000
246400*----------------------------------------------------------------*24640000
246500 3410-POSITION-AT-ERROR.                                          24650000
246600                                                                  24660000
246700     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       24670000
246800                                                                  24680000
246900     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 24690000
247000                    - PV-TOP-ITEM + 1.                            24700000
247100                                                                  24710000
247200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      24720000
247300         CONTINUE                                                 24730000
247400     ELSE                                                         24740000
247500         MOVE -1                   TO MR-SELECTL (PV-SUB)         24750000
247600         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         24760000
247700         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         24770000
247800     END-IF.                                                      24780000
247900                                                                  24790000
248000     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   24800000
248100                    - PV-TOP-ITEM + 1.                            24810000
248200                                                                  24820000
248300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      24830000
248400         CONTINUE                                                 24840000
248500     ELSE                                                         24850000
248600         MOVE -1                   TO MR-SELECTL (PV-SUB)         24860000
248700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         24870000
248800         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         24880000
248900     END-IF.                                                      24890000
249000                                                                  24900000
249100/                                                                 24910000
249200*----------------------------------------------------------------*24920000
249300*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *24930000
249400*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *24940000
249500*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *24950000
249600*----------------------------------------------------------------*24960000
249700                                                                  24970000
249800 3500-MARK-RANGE-AS-SELECTED.                                     24980000
249900                                                                  24990000
250000     MOVE +1                       TO ASC-BLK-SUB.                25000000
250100                                                                  25010000
250200     PERFORM 3510-MARK-SELECTED-INDS                              25020000
250300         VARYING ASC-ITEM-SUB                                     25030000
250400         FROM 1 BY 1                                              25040000
250500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 25050000
250600                                                                  25060000
250700     ADD +1                        TO ASC-BLK-SUB.                25070000
250800                                                                  25080000
250900     PERFORM 3510-MARK-SELECTED-INDS                              25090000
251000         VARYING ASC-ITEM-SUB                                     25100000
251100         FROM 1 BY 1                                              25110000
251200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 25120000
251300                                                                  25130000
251400     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               25140000
251500                                   TO PV-LIST-ITEM-NUMBER.        25150000
251600                                                                  25160000
251700     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            25170000
251800         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         25180000
251900               PC-ITEMS-PER-PANEL).                               25190000
252000                                                                  25200000
252100     MOVE ASC-START-OF-SELECTED-RANGE                             25210000
252200                                   TO PV-START-OF-SELECTED-RANGE. 25220000
252300                                                                  25230000
252400     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            25240000
252500         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  25250000
252600               PC-ITEMS-PER-PANEL).                               25260000
252700                                                                  25270000
252800     MOVE ASC-END-OF-SELECTED-RANGE                               25280000
252900                                   TO PV-END-OF-SELECTED-RANGE.   25290000
253000                                                                  25300000
253100     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             25310000
253200         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    25320000
253300               PC-ITEMS-PER-PANEL).                               25330000
253400                                                                  25340000
253500     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             25350000
253600         PV-FIRST-BLOCK-IN-ARRAY + 1.                             25360000
253700                                                                  25370000
253800     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    25380000
253900        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        25390000
254000         MOVE +1                   TO ASC-BLK-SUB                 25400000
254100         PERFORM 5100-WRITE-TEMP-STORAGE                          25410000
254200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         25420000
254300             PV-FIRST-BLOCK-IN-ARRAY - 1                          25430000
254400                                                                  25440000
254500         PERFORM                                                  25450000
254600             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      25460000
254700                   PV-PREV-BLOCK-IN-ARRAY                         25470000
254800             MOVE PV-FIRST-BLOCK-IN-RANGE                         25480000
254900                                   TO PV-BLOCK-NUMBER             25490000
255000             PERFORM 4410-READ-TEMP-STORAGE                       25500000
255100             PERFORM 3510-MARK-SELECTED-INDS                      25510000
255200                 VARYING ASC-ITEM-SUB                             25520000
255300                 FROM 1 BY 1                                      25530000
255400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          25540000
255500             PERFORM 5100-WRITE-TEMP-STORAGE                      25550000
255600             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     25560000
255700         END-PERFORM                                              25570000
255800                                                                  25580000
255900         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         25590000
256000             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     25600000
256100         PERFORM                                                  25610000
256200             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       25620000
256300                   PV-LAST-BLOCK-IN-RANGE                         25630000
256400             MOVE PV-NEXT-BLOCK-IN-ARRAY                          25640000
256500                                   TO PV-BLOCK-NUMBER             25650000
256600             PERFORM 4410-READ-TEMP-STORAGE                       25660000
256700             PERFORM 3510-MARK-SELECTED-INDS                      25670000
256800                 VARYING ASC-ITEM-SUB                             25680000
256900                 FROM 1 BY 1                                      25690000
257000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          25700000
257100             PERFORM 5100-WRITE-TEMP-STORAGE                      25710000
257200             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      25720000
257300         END-PERFORM                                              25730000
257400                                                                  25740000
257500         MOVE PV-FIRST-BLOCK-IN-ARRAY                             25750000
257600                                   TO PV-BLOCK-NUMBER             25760000
257700         PERFORM 4410-READ-TEMP-STORAGE                           25770000
257800     END-IF.                                                      25780000
257900                                                                  25790000
258000     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 25800000
258100                                      ASC-END-OF-SELECTED-RANGE.  25810000
258200                                                                  25820000
258300/                                                                 25830000
258400*----------------------------------------------------------------*25840000
258500* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *25850000
258600*----------------------------------------------------------------*25860000
258700                                                                  25870000
258800 3510-MARK-SELECTED-INDS.                                         25880000
258900                                                                  25890000
259000     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) >         25900000
259100         ASC-START-OF-SELECTED-RANGE)                             25910000
259200     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =         25920000
259300         ASC-START-OF-SELECTED-RANGE)                             25930000
259400                                                                  25940000
259500         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) <     25950000
259600             ASC-END-OF-SELECTED-RANGE)                           25960000
259700         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =     25970000
259800             ASC-END-OF-SELECTED-RANGE)                           25980000
259900                                                                  25990000
260000             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          26000000
260100                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   26010000
260200                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   26020000
260300                                   TO TRUE                        26030000
260400                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              26040000
260500                                   TO TRUE                        26050000
260600                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMS26060000
260700                 ADD +1            TO ASC-PACKS-DISPLAYED         26070000
260800             END-IF                                               26080000
260900         END-IF                                                   26090000
261000     END-IF.                                                      26100000
261010 3601-CHECK-TKRPRPM-ASNDWN.                                       26101099
261020                                                                  26102099
261030     MOVE ASC-OPR-ID TO KRPRPM-LOC-ID.                            26103099
261040                                                                  26104099
261050     EXEC SQL                                                     26105099
261060          SELECT   FUNC_TXT                                       26106099
261070            INTO  :KRPRPM-FUNC-TXT                                26107099
261080            FROM                                                  26108099
261090                  TKRPRPM A                                       26109099
261091            WHERE                                                 26109199
261092                  LOC_ID            = :KRPRPM-LOC-ID              26109299
261093              AND SYS_PRC_FUNC_CDE  = 'ASNDWN'                    26109399
261094              AND FUNC_PRC_STAT_CDE = 'AC'                        26109499
261095              AND INTFC_SYS_CDE     = 'KHL'                       26109599
261096              AND FUNC_TXT          = 'Y'                         26109699
261097              AND FUNC_BEG_TMST    < CURRENT TIMESTAMP            26109799
261098     END-EXEC.                                                    26109899
261099     EVALUATE TRUE                                                26109999
261100         WHEN SQLCODE = ZERO                                      26110099
261101              SET PS-ASNS-TO-WMS-YES    TO TRUE                   26110199
261102         WHEN SQLCODE = +100                                      26110299
261103              SET PS-ASNS-TO-WMS-NO  TO TRUE                      26110399
261104         WHEN SQLWARN0 NOT = SPACES                               26110499
261105         WHEN SQLCODE  NOT = ZERO                                 26110599
261106             MOVE 'TKRPRPM     ' TO DP013-DB2-TABLE-NAME (1)      26110699
261107             SET DP013-DB2-ABEND                                  26110799
261108                                 TO TRUE                          26110899
261109             SET DP013-XCTL-DISPLAY-RESTART                       26110999
261110                                 TO TRUE                          26111099
261111             PERFORM DP013-0000-PROCESS-ABEND                     26111199
261112     END-EVALUATE.                                                26111299
261113                                                                  26111399
261114     EVALUATE TRUE                                                26111499
261115         WHEN SQLCODE = ZERO                                      26111599
261116            IF KRPRPM-FUNC-TXT = 'Y'                              26111699
261117               CONTINUE                                           26111799
261118            END-IF                                                26111899
261119         WHEN SQLCODE = +100                                      26111999
261120            CONTINUE                                              26112099
261121     END-EVALUATE.                                                26112199
261122/                                                                 26112299
261123*----------------------------------------------------------------*26112399
261124* LINK TO WMS VENDOR SHIPMENT CONTROL MODULE (WSKUT005) USING     26112499
261125*  COPYBOOK WSWS001.                                              26112599
261126*----------------------------------------------------------------*26112699
261127 3604-CALL-WMS-MODULE.                                            26112799
261128                                                                  26112899
261129     SET WS001-INSERT TO TRUE.                                    26112999
261130*    MOVE SHIPMT-TRIP-ID TO WS001-TRIP-ID.                        26113099
261140     MOVE ASC-OPR-ID TO WS001-OPER-UNT-ID.                        26114099
261150     MOVE DP020-USERID TO WS001-USER-ID.                          26115099
261160     MOVE ASC-PO-NBR TO WS001-PO-NBR.                             26116099
261170     MOVE ASC-REC-SEQ-NBR TO WS001-RCVR-NBR.                      26117099
261180     MOVE DK-PACK-ID TO WS001-PREPK-ID.                           26118099
261190     MOVE ZEROS TO WS001-SKU-NBR.                                 26119099
261200     MOVE ZEROS TO WS001-KOHLS-SHIPT-ID.                          26120099
261210     MOVE 'RC' TO WS001-SHIPMENT-SOURCE.                          26121099
261220     MOVE SPACES TO WS001-DTL-ASN-LEVEL-IND.                      26122099
261221     MOVE DP020-SRC-TASK-NUMBER TO WS001-SRC-TASK-NUMBER.         26122199
261222     MOVE PC-CURRENT-PROGRAM-NAME TO WS001-CALLING-PROGRAM-NAME.  26122299
261230                                                                  26123099
261240     MOVE LENGTH OF WS001-FIELDS  TO  PV-COMMAREA-LENGTH.         26124099
261250                                                                  26125099
261260     EXEC CICS                                                    26126099
261270         LINK PROGRAM  (PC-WMS-CONTROL-MOD)                       26127099
261271              COMMAREA (WS001-FIELDS)                             26127199
261272              LENGTH   (PV-COMMAREA-LENGTH)                       26127299
261273     END-EXEC.                                                    26127399
261274     EVALUATE TRUE                                                26127499
261275         WHEN WS001-SUCCESSFUL                                    26127599
261276              CONTINUE                                            26127699
261277         WHEN WS001-DATABASE-BUSY OR                              26127799
261278              WS001-INVALID-SQL                                   26127899
261279                  MOVE PC-TSYMSG-03546  TO DP020-MSG-NUMBER       26127999
261280                  SET DP020-MSG-WARNING TO TRUE                   26128099
261281                  SET DP030-OVERRIDE-GO TO TRUE                   26128199
261282                  SET PS-ERROR          TO TRUE                   26128299
261283                                                                  26128399
261284                                                                  26128499
261285              INITIALIZE PV-CICS-MSG-AREA                         26128599
261286              STRING 'RCKCS800-'                                  26128699
261287                     '3603-CALL-WMS-MODULE - '                    26128799
261288                                           DELIMITED BY SIZE      26128899
261289                                      INTO PV-CICS-MSG-AREA       26128999
261290              PERFORM 9903-WRITE-CICS-LOG                         26129099
261291                                                                  26129199
261292              INITIALIZE PV-CICS-MSG-AREA                         26129299
261293              STRING 'RCKCS800-'                                  26129399
261294                     WS001-CRA-RET-MSG                            26129499
261295                                           DELIMITED BY SIZE      26129599
261296                                      INTO PV-CICS-MSG-AREA       26129699
261297              PERFORM 9903-WRITE-CICS-LOG                         26129799
261298                                                                  26129899
261299                                                                  26129999
261300         WHEN WS001-ERROR                                         26130099
261301                  MOVE PC-TSYMSG-03138  TO DP020-MSG-NUMBER       26130199
261302                  SET DP020-MSG-WARNING TO TRUE                   26130299
261303                  SET DP030-OVERRIDE-GO TO TRUE                   26130399
261304                  SET PS-ERROR          TO TRUE                   26130499
261305                                                                  26130599
261306              INITIALIZE PV-CICS-MSG-AREA                         26130699
261307              STRING 'RCKCS800-'                                  26130799
261308                     '3603-CALL-WMS-MODULE - '                    26130899
261309                                           DELIMITED BY SIZE      26130999
261310                                      INTO PV-CICS-MSG-AREA       26131099
261311              PERFORM 9903-WRITE-CICS-LOG                         26131199
261312                                                                  26131299
261313              INITIALIZE PV-CICS-MSG-AREA                         26131399
261314              STRING 'RCKCS800-'                                  26131499
261315                     WS001-CRA-RET-MSG                            26131599
261316                                           DELIMITED BY SIZE      26131699
261317                                      INTO PV-CICS-MSG-AREA       26131799
261318              PERFORM 9903-WRITE-CICS-LOG                         26131899
261319                                                                  26131999
261320         WHEN OTHER                                               26132099
261321                                                                  26132199
261322              INITIALIZE PV-CICS-MSG-AREA                         26132299
261323              STRING 'RCKCS800-'                                  26132399
261324                     '3603-CALL-WMS-MODULE - '                    26132499
261325                                           DELIMITED BY SIZE      26132599
261326                                      INTO PV-CICS-MSG-AREA       26132699
261327              PERFORM 9903-WRITE-CICS-LOG                         26132799
261328                                                                  26132899
261329              INITIALIZE PV-CICS-MSG-AREA                         26132999
261330              STRING 'RCKCS800-'                                  26133099
261331                     WS001-CRA-RET-MSG                            26133199
261332                                           DELIMITED BY SIZE      26133299
261333                                      INTO PV-CICS-MSG-AREA       26133399
261334              PERFORM 9903-WRITE-CICS-LOG                         26133499
261335                                                                  26133599
261336             MOVE '3603-CALL-WMS-MODULE' TO DP013-PARAGRAPH       26133699
261337             MOVE 'UNSUCCESSFUL CALL TO WMS  MOD'                 26133799
261338                                         TO DP013-MESSAGE-TEXT (1)26133899
261339             MOVE WS001-SUCCESS-IND      TO DP013-MESSAGE-TEXT (2)26133999
261340*            MOVE WS001-SQLCA            TO DP013-SQLCA           26134099
261341             SET DP013-DB2-ABEND                                  26134199
261342                 DP013-XCTL-DISPLAY-RESTART  TO TRUE              26134299
261343             SET PS-ERROR                    TO TRUE              26134399
261344             PERFORM DP013-0000-PROCESS-ABEND                     26134499
261345                                                                  26134599
261346     END-EVALUATE.                                                26134699
261347                                                                  26134700
261348/                                                                 26134800
261350*----------------------------------------------------------------*26135000
261400*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *26140000
261500*    INITIALIZE ALL COUNTERS AND FLAGS.                          *26150000
261600*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *26160000
261700*    DISPLAY THE PANEL TO USER.                                  *26170000
261800*----------------------------------------------------------------*26180000
261900                                                                  26190000
262000 4000-BUILD-INITIAL-PANEL.                                        26200000
262100                                                                  26210000
262200     INITIALIZE ASC-BLOCK-ENTRIES (1)                             26220000
262300                ASC-BLOCK-ENTRIES (2).                            26230000
262400                                                                  26240000
262500     MOVE +1                       TO ASC-BLK-SUB.                26250000
262600                                                                  26260000
262700     SET ASC-ITEMS-LEFT-ON-DB      TO TRUE.                       26270000
262800                                                                  26280000
262900     MOVE +0                       TO ASC-ITEM-SUB                26290000
263000                                      ASC-NUMBER-OF-ITEMS-READ    26300000
263100                                      ASC-NUMBER-OF-SELECTED-ITEMS26310000
263200                                      ASC-PACKS-DISPLAYED         26320000
263300                                      ASC-HIGHEST-BLOCK-WRITTEN   26330000
263400                                      ASC-START-OF-SELECTED-RANGE 26340000
263500                                      ASC-END-OF-SELECTED-RANGE   26350000
263600                                      ASC-ITEM-AT-TOP-OF-PANEL.   26360000
263700     PERFORM 4100-PREPARE-CURSOR.                                 26370000
263800     PERFORM 4355-GET-TRECEIV-INFO.                               26380000
263900     EVALUATE TRUE                                                26390000
264000         WHEN SQLCODE = +100                                      26400000
264100              CONTINUE                                            26410000
264200         WHEN SQLCODE = +0                                        26420000
264300              PERFORM 4360-GET-TPURCHS-INFO                       26430000
264400              EVALUATE TRUE                                       26440000
264500                  WHEN SQLCODE = +100                             26450000
264600                       CONTINUE                                   26460000
264700                  WHEN SQLCODE = +0                               26470000
264800                       MOVE RECEIV-STATUS-CDE                     26480000
264900                               TO ASC-STAT                        26490000
265000                       MOVE RECEIV-EXPTED-CART-CNT                26500000
265100                               TO ASC-TRECEIV-EXPTED-CART-CNT     26510000
265200                       MOVE RECEIV-ACTL-CART-CNT                  26520000
265300                               TO ASC-TRECEIV-ACTL-CART-CNT       26530000
265400                       PERFORM 4010-GET-LOC-DESC                  26540099
265500                       MOVE XL071-LOC-NM                          26550099
265600                               TO ASC-FCLTY-DESC                  26560000
265700                       PERFORM 4100-PREPARE-CURSOR                26570000
265800                       PERFORM 4200-CALC-OPEN-TO-REC              26580000
265900                       PERFORM 4010-OPEN-CURSOR                   26590000
266000                       PERFORM 4300-READ-ITEMS-FROM-DB            26600000
266100                       PERFORM 4020-CLOSE-CURSOR                  26610000
266200              END-EVALUATE                                        26620000
266300     END-EVALUATE.                                                26630000
266400                                                                  26640000
266500     MOVE +1                       TO PV-TOP-ITEM.                26650000
266600                                                                  26660000
266700     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          26670000
266800         SET DP020-NEXT-ACT-APPL-ERROR                            26680000
266900                                   TO TRUE                        26690000
267000         SET DP020-MSG-FATAL       TO TRUE                        26700000
267100         MOVE PC-TSYMSG-00050      TO DP020-MSG-NUMBER            26710000
267200     ELSE                                                         26720000
267300         MOVE -1                   TO MR-SELECTL (1)              26730000
267400         SET DP030-SET-CURSOR-APPL-1                              26740000
267500                                   TO TRUE                        26750000
267600         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     26760000
267700     END-IF.                                                      26770000
267800                                                                  26780000
267900/                                                                 26790000
268000*----------------------------------------------------------------*26800000
268100* OPEN THE SHIPMENT CURSOR                                       *26810000
268200*----------------------------------------------------------------*26820000
268300                                                                  26830000
268400 4010-OPEN-CURSOR.                                                26840000
268500                                                                  26850000
268600     IF ASC-ADD-PACK                                              26860000
268700           EXEC SQL                                               26870000
268800               OPEN ADD-PACK-CSR                                  26880000
268900           END-EXEC                                               26890000
269000      ELSE IF ASC-ADD-LINE                                        26900000
269100           EXEC SQL                                               26910000
269200               OPEN ADD-LNE-CSR                                   26920000
269300           END-EXEC                                               26930000
269400     END-IF.                                                      26940000
269500                                                                  26950000
269600         EVALUATE TRUE                                            26960000
269700             WHEN SQLCODE = +0                                    26970000
269800                  CONTINUE                                        26980000
269900             WHEN SQLCODE = -904                                  26990000
270000             WHEN SQLCODE = -911                                  27000000
270100             WHEN SQLCODE = -913                                  27010000
270200                  PERFORM 9900-SOFT-ABORT                         27020000
270300             WHEN SQLWARN0 NOT = SPACE                            27030000
270400             WHEN SQLCODE  NOT = +0                               27040000
270500                  MOVE '4010-OPEN-CURSOR'                         27050000
270600                                   TO DP013-PARAGRAPH             27060000
270700                  MOVE 'OPEN CURSOR'                              27070000
270800                                   TO DP013-MESSAGE-TEXT (1)      27080000
270900                  MOVE SQLCA       TO DP013-SQLCA                 27090000
271000                  MOVE 'TPURITM'   TO DP013-DB2-TABLE-NAME (1)    27100000
271100                  SET DP013-DB2-ABEND                             27110000
271200                                   TO TRUE                        27120000
271300                  PERFORM DP013-0000-PROCESS-ABEND                27130000
271400         END-EVALUATE.                                            27140000
271500/                                                                 27150000
271600*----------------------------------------------------------------*27160000
271700* CLOSE THE SHIPMENT CURSOR                                      *27170000
271800*----------------------------------------------------------------*27180000
271900                                                                  27190000
272000 4020-CLOSE-CURSOR.                                               27200000
272100                                                                  27210000
272200     IF ASC-ADD-PACK                                              27220000
272300        EXEC SQL                                                  27230000
272400             CLOSE ADD-PACK-CSR                                   27240000
272500        END-EXEC                                                  27250000
272600      ELSE IF ASC-ADD-LINE                                        27260000
272700        EXEC SQL                                                  27270000
272800             CLOSE ADD-LNE-CSR                                    27280000
272900        END-EXEC                                                  27290000
273000     END-IF.                                                      27300000
273100                                                                  27310000
273200     EVALUATE TRUE                                                27320000
273300         WHEN SQLCODE = +0                                        27330000
273400              CONTINUE                                            27340000
273500         WHEN SQLCODE = -904                                      27350000
273600         WHEN SQLCODE = -911                                      27360000
273700         WHEN SQLCODE = -913                                      27370000
273800              PERFORM 9900-SOFT-ABORT                             27380000
273900         WHEN SQLWARN0 NOT = SPACE                                27390000
274000         WHEN SQLCODE  NOT = +0                                   27400000
274100              MOVE '4020-CLOSE-CURSOR'                            27410000
274200                                   TO DP013-PARAGRAPH             27420000
274300              MOVE 'CLOSE CURSOR'  TO DP013-MESSAGE-TEXT (1)      27430000
274400              MOVE SQLCA           TO DP013-SQLCA                 27440000
274500              MOVE 'TPURITM'       TO DP013-DB2-TABLE-NAME (1)    27450000
274600              SET DP013-DB2-ABEND  TO TRUE                        27460000
274700              PERFORM DP013-0000-PROCESS-ABEND                    27470000
274800     END-EVALUATE.                                                27480000
274900                                                                  27490000
275000                                                                  27500000
275100*---------------------------------------------------------------- 27510000
275200* CHECK IF THE PURCHASE ORDER LINE IS IN TROUBLE                * 27520000
275300*---------------------------------------------------------------- 27530000
275400                                                                  27540000
275500 4030-GET-TROUBLE-DESC.                                           27550000
275600                                                                  27560000
275700     EXEC SQL                                                     27570000
275800        SELECT  TRBL_LONG_DESC                                    27580000
275900          INTO :TRBRSN-TRBL-LONG-DESC                             27590000
276000          FROM  TTRBNTF A,                                        27600000
276100                TTRBRSN B                                         27610000
276200         WHERE  A.OPER_UNT_ID   = :DK-OPER-UNT-ID                 27620000
276300           AND  A.FCLTY_ID      = :DK-FACT                        27630000
276400           AND  A.PO_NBR        = :DK-ORD-NBR                     27640000
276500           AND  A.PO_LNE_NBR    = :DK-LINE-NBR                    27650000
276600           AND  A.REC_SEQ_NBR   = :DK-REC-SEQ-NBR                 27660000
276700           AND (A.RESOLVED_IND ^= :PC-A                           27670000
276800           AND  A.RESOLVED_IND ^= :PC-R)                          27680000
276900           AND  A.TRBL_RSN_CDE  = B.TRBL_RSN_CDE                  27690000
277000           AND  B.NOTIF_IND     = :PC-T                           27700000
277100     END-EXEC.                                                    27710000
277200                                                                  27720000
277300     EVALUATE TRUE                                                27730000
277400         WHEN SQLCODE = +0                                        27740000
277500             MOVE TRBRSN-TRBL-LONG-DESC                           27750000
277600                               TO ASC-TROUBLE-DESC                27760000
277700                                                                  27770000
277800         WHEN SQLCODE = +100                                      27780000
277900             MOVE SPACES       TO ASC-TROUBLE-DESC                27790000
278000                                                                  27800000
278100         WHEN SQLCODE = -811                                      27810000
278200             STRING TRBRSN-TRBL-LONG-DESC '*'                     27820000
278300                 DELIMITED BY SIZE                                27830000
278400                 INTO ASC-TROUBLE-DESC                            27840000
278500                                                                  27850000
278600          WHEN SQLCODE = -904                                     27860000
278700          WHEN SQLCODE = -911                                     27870000
278800          WHEN SQLCODE = -913                                     27880000
278900               PERFORM 9900-SOFT-ABORT                            27890000
279000                                                                  27900000
279100         WHEN SQLWARN0 NOT = SPACES                               27910000
279200         WHEN SQLCODE < +0                                        27920000
279300         WHEN SQLCODE > +0                                        27930000
279400             MOVE '4030-GET-TROUBLE-DESC'                         27940000
279500                               TO DP013-PARAGRAPH                 27950000
279600             MOVE 'SELECT TROUBLE LONG DESC '                     27960000
279700                               TO DP013-MESSAGE-TEXT (1)          27970000
279800             MOVE SQLCA        TO DP013-SQLCA                     27980000
279900             MOVE 'TTRBNTF'    TO DP013-DB2-TABLE-NAME (1)        27990000
280000             MOVE 'TTRBRSN'    TO DP013-DB2-TABLE-NAME (2)        28000000
280100             SET DP013-DB2-ABEND                                  28010000
280200                               TO TRUE                            28020000
280300             SET DP013-XCTL-DISPLAY-RESTART                       28030000
280400                               TO TRUE                            28040000
280500             PERFORM DP013-0000-PROCESS-ABEND                     28050000
280600     END-EVALUATE.                                                28060000
280700                                                                  28070000
280800/                                                                 28080000
280900*----------------------------------------------------------------*28090000
281000*    DEPENDING ON WHAT WAS PASSED IN THE COMMAREA, SETUP THE     *28100000
281100*    DB2 KEYS IN PREPARATION FOR THE OPEN CURSROR.               *28110000
281200*----------------------------------------------------------------*28120000
281300                                                                  28130000
281400 4100-PREPARE-CURSOR.                                             28140000
281500                                                                  28150000
281600     MOVE ASC-PO-NBR       TO DK-ORD-NBR                          28160000
281700     MOVE ASC-REC-SEQ-NBR  TO DK-REC-SEQ-NBR.                     28170000
281800     MOVE ASC-OPR-ID       TO DK-OPER-UNT-ID                      28180000
281900     MOVE ASC-FACT         TO DK-FACT.                            28190000
282000                                                                  28200000
282100     IF ASC-ADD-LINE                                              28210000
282200        MOVE ASC-DRIVER-PACK-ID                                   28220000
282300                           TO DK-PACK-ID.                         28230000
282400                                                                  28240000
282500/                                                                 28250000
282600                                                                  28260000
282700*----------------------------------------------------------------*28270000
282800*    PASS THE APPROPRIATE KEYS TO THE PACK OTR CALCULATION       *28280000
282900*    MODULE.                                                     *28290000
283000*----------------------------------------------------------------*28300000
283100 4200-CALC-OPEN-TO-REC.                                           28310000
283200                                                                  28320000
283300     SET DP277-LINE-LEVEL-OTR                                     28330000
283400         DP277-RECEIVER-OTR      TO TRUE.                         28340000
283500                                                                  28350000
283600     INITIALIZE DP277-KEYS                                        28360000
283700     MOVE DK-ORD-NBR             TO DP277-PO-NBR.                 28370000
283800     MOVE DK-LINE-NBR            TO DP277-PO-LNE-NBR.             28380000
283900     MOVE DK-REC-SEQ-NBR         TO DP277-REC-SEQ-NBR.            28390000
284000     MOVE DK-OPER-UNT-ID         TO DP277-OPER-UNT-ID.            28400000
284100     MOVE DK-FACT                TO DP277-FCLTY-ID.               28410000
284300* SEND A +0 AS PACK ID, SO THAT THE OTR PROGRAM KNOWS THAT THIS   28430000
284400* LINE IS BEING ADDED TO A PACK.                                  28440000
284500     MOVE +0                     TO DP277-PO-PREPK-ID.            28450000
284600                                                                  28460000
284700     COPY DPPD277.                                                28470000
284800                                                                  28480000
284900/                                                                 28490000
285000*----------------------------------------------------------------*28500000
285100*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *28510000
285200*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *28520000
285300*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *28530000
285400*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *28540000
285500*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *28550000
285600*                                                                *28560000
285700*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *28570000
285800*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *28580000
285900*    UPON INITIALIZATION.                                        *28590000
286000*----------------------------------------------------------------*28600000
286010*----------------------------------------------------------------*28601000
286020*                                               **   WR # 230ZZ  *28602000
286030* INITIALIZED   XL001-ITEM-COMMAREA                              *28603000
286040* ADDED CODE TO CHECK FOR THE DUMMY SKU AND CALL TO XLKUT001     *28604000
286050*----------------------------------------------------------------*28605000
286100 4300-READ-ITEMS-FROM-DB.                                         28610000
286200                                                                  28620000
286300     PERFORM                                                      28630000
286400         VARYING PV-READ-COUNT                                    28640000
286500         FROM 1 BY 1                                              28650000
286600         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    28660000
286700            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         28670000
286800                                                                  28680000
286810         INITIALIZE XL001-ITEM-COMMAREA                           28681000
286811                    PV-TEMP-TKT-TYPE                              28681100
286820                    PV-TEMP-SEQ-NBR                               28682000
286821                    PV-SKU-SEQ                                    28682199
286830                                                                  28683000
286900         PERFORM 4310-FETCH                                       28690000
286919                                                                  28691900
286920         IF (DK-SKU-SEQ = PC-000)                                 28692000
286921             MOVE '00000000' TO PV-SKU-SEQ                        28692100
286922         END-IF                                                   28692200
286923                                                                  28692300
286924         IF (DK-SKU-SEQ = PC-999)                                 28692400
286925             MOVE '99999999' TO PV-SKU-SEQ                        28692500
286926         END-IF                                                   28692600
286927                                                                  28692700
286928         IF    PS-CALL-API-YES          AND                       28692800
286929             ((DK-SKU-SEQ NOT = PC-000) AND                       28692900
286930              (DK-SKU-SEQ NOT = PC-999))                          28693000
286931                                                                  28693100
286940            PERFORM 4315-CALL-CICS-API-ARCH                       28694000
287000                                                                  28700000
287010         END-IF                                                   28701000
287100         IF  ASC-ITEMS-LEFT-ON-DB                                 28710000
287200             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                28720000
287300                 ADD +1            TO ASC-ITEM-SUB                28730000
287400             ELSE                                                 28740000
287500                 ADD +1            TO ASC-BLK-SUB                 28750000
287600                 MOVE +1           TO ASC-ITEM-SUB                28760000
287700                                                                  28770000
287800                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         28780000
287900                     MOVE +1       TO ASC-BLK-SUB                 28790000
288000                     SET ASC-BLOCK-MODIFIED (1)                   28800000
288100                                   TO TRUE                        28810000
288200                     PERFORM 5100-WRITE-TEMP-STORAGE              28820000
288300                     MOVE ASC-BLOCK-ENTRIES                       28830000
288400                               (PC-MAX-BLOCKS-IN-ARRAY)           28840000
288500                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 28850000
288600                     ADD +1        TO ASC-BLK-SUB                 28860000
288700                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   28870000
288800                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      28880000
288900                                   TO TRUE                        28890000
289000                 END-IF                                           28900000
289100             END-IF                                               28910000
289200             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    28920000
289300             MOVE ASC-NUMBER-OF-ITEMS-READ                        28930000
289400                                   TO ASC-LIST-ITEM-NUMBER        28940000
289500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  28950000
289610             MOVE PURCHS-DEPT-NBR       TO PV-DEPT-NBR            28961099
289611             MOVE PURCHS-DEPT-NBR       TO ASC-DEPT               28961199
289612                                      (ASC-BLK-SUB ASC-ITEM-SUB)  28961299
289613             MOVE PURCHS-ENT-ID         TO ASC-ENT-ID             28961399
289614                                      (ASC-BLK-SUB ASC-ITEM-SUB)  28961499
289640             IF ASC-ADD-PACK                                      28964099
289650                MOVE PURITM-PO-PREPK-ID TO ASC-PACK-ID            28965099
289660                                      (ASC-BLK-SUB ASC-ITEM-SUB)  28966099
289670                MOVE POPRPK-PREPK-DESC  TO ASC-PACK-DESC          28967099
289680                                      (ASC-BLK-SUB ASC-ITEM-SUB)  28968099
289690                IF POPRPK-INPK-UNT-QTY > POPRPK-OTPK-UNT-QTY OR   28969099
289700                   POPRPK-OTPK-UNT-QTY = 0                        28970099
289800                   MOVE +1              TO ASC-CASE-PACK-QTY      28980099
289900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  28990099
290000                ELSE                                              29000099
290100                   DIVIDE  POPRPK-OTPK-UNT-QTY BY                 29010099
290200                           POPRPK-INPK-UNT-QTY  GIVING            29020099
290300                                           ASC-CASE-PACK-QTY      29030099
290400                                        (ASC-BLK-SUB ASC-ITEM-SUB)29040099
290500                   IF ASC-CASE-PACK-QTY (ASC-BLK-SUB ASC-ITEM-SUB)29050099
290600                      NOT > 0                                     29060099
290700                      MOVE +1            TO ASC-CASE-PACK-QTY     29070099
290800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 29080099
290900                   END-IF                                         29090099
291000                END-IF                                            29100099
291100             END-IF                                               29110099
291200                                                                  29120099
291300             MOVE DK-LINE-NBR           TO ASC-LINE-NUMBER        29130099
291400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  29140099
291500             MOVE XL001-SUB-CL-NBR-2CH  TO PV-SKU-CL              29150099
291700             MOVE PURITM-SKU-DESC       TO ASC-SKU-DESC           29170099
291800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  29180099
291900             MOVE PURITM-ITM-NBR        TO ASC-ITM-NBR            29190099
292000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  29200099
292100             MOVE PURITM-VER-NBR        TO ASC-VER-NBR            29210099
292200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  29220099
292300             MOVE PV-SKU                TO ASC-SKU                29230099
292400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  29240099
292500             MOVE PURITM-VEND-STYL-NAME TO                        29250099
292600                                       ASC-PURITM-VEND-STYL-NAME  29260099
292700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  29270099
292800             MOVE PURITM-UNT-QTY        TO ASC-PURITM-UNT-QTY     29280099
292900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  29290099
293000             MOVE PURITM-UNT-RTL-PR-AMT TO                        29300099
293100                                       ASC-PURITM-UNT-RTL-PR-AMT  29310099
293200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  29320099
293300             MOVE PURITM-GP-RTL-AMT     TO ASC-PURITM-GP-RTL-AMT  29330099
293400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  29340099
293500             MOVE PURITM-GP-QTY         TO ASC-PURITM-GP-QTY      29350099
293600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  29360099
293700             MOVE PURITM-PREPK-RATO-QTY TO ASC-PO-PACK-RATIO      29370099
293800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  29380099
293900             MOVE PURITM-STATUS-CDE     TO ASC-STATUS-CDE         29390099
294000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  29400099
294100                                                                  29410099
294200*      GET OPEN TO RECEIVE TOTALS                                 29420099
294300             MOVE DK-LINE-NBR           TO DP277-SEARCH-NBR       29430099
294400             PERFORM 4210-SEARCH-OTR                              29440099
294500             MOVE DP277-OTR-OUT-X       TO ASC-OTR                29450099
294600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 29460099
294700                                                                  29470099
294800                                                                  29480099
294900             IF ASC-STAT NOT = PC-VE                              29490099
295000                 PERFORM 4370-FIND-LINE-TROUBLE                   29500099
295100                 EVALUATE TRUE                                    29510099
295200                     WHEN PV-UNRSLVD-TRBL-COUNT > ZERO            29520099
295300                         SET ASC-LINE-IN-TROUBLE                  29530099
295400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  29540099
295500                                   TO TRUE                        29550099
295600                     WHEN PV-RSLVD-TRBL-COUNT > ZERO              29560099
295700                         SET ASC-LINE-DISTRO-TRBL                 29570099
295800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  29580099
295900                                   TO TRUE                        29590099
296000                 END-EVALUATE                                     29600099
296100             END-IF                                               29610099
296200         END-IF                                                   29620099
296300     END-PERFORM.                                                 29630099
296400                                                                  29640099
296500     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          29650099
296600         MOVE +1                   TO ASC-BLK-SUB                 29660099
296700         PERFORM 5100-WRITE-TEMP-STORAGE                          29670099
296800         ADD +1                    TO ASC-BLK-SUB                 29680099
296900         PERFORM 5100-WRITE-TEMP-STORAGE                          29690099
297000                                                                  29700099
297100         MOVE 1                    TO ASC-BLK-SUB                 29710099
297200                                      PV-BLOCK-NUMBER             29720099
297300         PERFORM 4410-READ-TEMP-STORAGE                           29730099
297400         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             29740099
297500             MOVE 2                TO ASC-BLK-SUB                 29750099
297600                                      PV-BLOCK-NUMBER             29760099
297700             PERFORM 4410-READ-TEMP-STORAGE                       29770099
297800         END-IF                                                   29780099
297900     ELSE                                                         29790099
298000         SET DP020-NEXT-ACT-APPL-ERROR                            29800099
298100             DP020-MSG-FATAL       TO TRUE                        29810099
298200         MOVE PC-TSYMSG-00050      TO DP020-MSG-NUMBER            29820099
298300     END-IF.                                                      29830099
298310*----------------------------------------------------------------*29831099
298320* CHANGES MADE FOR WR # 230ZZ ENDS HERE.                         *29832099
298330*----------------------------------------------------------------*29833099
298400                                                                  29840099
298500/                                                                 29850099
298600*----------------------------------------------------------------*29860099
298700*    FETCH A TPURITM ROW                                         *29870099
298800*----------------------------------------------------------------*29880099
298810*----------------------------------------------------------------*29881099
298811*                                                   WR # 230ZZ   *29881199
298812* IF THE SQL STATEMENT IS SUCCESSFUL, THEN SET PS-CALL-API-YES   *29881299
298813* TO TRUE.                                                       *29881399
298814* ADDED A MOVE STATEMENT, TO MOVE VALUE OF PURITM-SKU-SEQ-NBR TO *29881499
298815* DK-SKU-SEQ.                                                    *29881599
298816* ADDED A MOVE STATEMENT, TO MOVE VALUE OF PURITM-ITM-NBR TO     *29881699
298817* DK-ITM-NBR.                                                    *29881799
298820*----------------------------------------------------------------*29882099
298900                                                                  29890099
299000 4310-FETCH.                                                      29900099
299100                                                                  29910099
299200     IF ASC-ADD-PACK                                              29920099
299300            EXEC SQL                                              29930099
300200              FETCH ADD-PACK-CSR                                  30020000
300300                 INTO :PURITM-PO-NBR                              30030000
300400                     ,:PURITM-VER-NBR                             30040000
300500                     ,:PURITM-SKU-SEQ-NBR                         30050000
300700                     ,:PURITM-ITM-NBR                             30070000
300800                     ,:PURITM-SKU-DESC                            30080000
300900                     ,:DK-LINE-NBR                                30090000
301000                     ,:PURITM-VEND-STYL-NAME                      30100000
301100                     ,:PURITM-UNT-QTY                             30110000
301200                     ,:PURITM-UNT-RTL-PR-AMT                      30120000
301300                     ,:PURITM-GP-RTL-AMT                          30130000
301400                     ,:PURITM-GP-QTY                              30140000
301500                     ,:PURITM-PO-LNE-NBR                          30150000
301600                     ,:PURITM-PO-PREPK-ID                         30160000
301700                     ,:PURITM-PREPK-RATO-QTY                      30170000
301800                     ,:PURITM-STATUS-CDE                          30180000
301900                     ,:POPRPK-PREPK-DESC                          30190000
302000                     ,:POPRPK-OTPK-UNT-QTY                        30200000
302100                     ,:POPRPK-INPK-UNT-QTY                        30210000
302200            END-EXEC                                              30220000
302300     ELSE                                                         30230000
302400     IF ASC-ADD-LINE                                              30240000
302500            EXEC SQL                                              30250000
302600              FETCH ADD-LNE-CSR                                   30260000
302700                 INTO :PURITM-PO-NBR                              30270000
302800                     ,:PURITM-VER-NBR                             30280000
302900                     ,:PURITM-SKU-SEQ-NBR                         30290000
303100                     ,:PURITM-ITM-NBR                             30310000
303200                     ,:PURITM-SKU-DESC                            30320000
303300                     ,:DK-LINE-NBR                                30330000
303400                     ,:PURITM-VEND-STYL-NAME                      30340000
303500                     ,:PURITM-UNT-QTY                             30350000
303600                     ,:PURITM-UNT-COST-AMT                        30360099
303610                     ,:PURITM-UNT-RTL-PR-AMT                      30361099
303700                     ,:PURITM-GP-RTL-AMT                          30370000
303800                     ,:PURITM-GP-QTY                              30380000
303900                     ,:PURITM-PO-LNE-NBR                          30390000
304000                     ,:PURITM-PO-PREPK-ID                         30400000
304100                     ,:PURITM-PREPK-RATO-QTY                      30410000
304200                     ,:PURITM-STATUS-CDE                          30420000
304300                     ,:POPRPK-PREPK-DESC                          30430000
304400          END-EXEC                                                30440000
304500     END-IF.                                                      30450000
304600                                                                  30460000
304700     EVALUATE TRUE                                                30470000
304800         WHEN SQLCODE = +0                                        30480000
304810              SET PS-CALL-API-YES     TO TRUE                     30481000
304820              MOVE PURITM-SKU-SEQ-NBR TO DK-SKU-SEQ               30482000
304830              MOVE PURITM-ITM-NBR     TO DK-ITM-NBR               30483000
304900              CONTINUE                                            30490000
305000                                                                  30500000
305100         WHEN SQLCODE = +100                                      30510000
305200              SET ASC-NO-ITEMS-LEFT-ON-DB                         30520000
305300                                   TO TRUE                        30530000
305400         WHEN SQLCODE = -904                                      30540000
305500         WHEN SQLCODE = -911                                      30550000
305600         WHEN SQLCODE = -913                                      30560000
305700              PERFORM 9900-SOFT-ABORT                             30570000
305800                                                                  30580000
305900         WHEN SQLWARN0 NOT = SPACE                                30590000
306000         WHEN SQLCODE < +0                                        30600000
306100         WHEN SQLCODE > +0                                        30610000
306200              MOVE '4310-FETCH'                                   30620000
306300                                   TO DP013-PARAGRAPH             30630000
306400              MOVE 'FETCH TPURITM CURSOR'                         30640000
306500                                   TO DP013-MESSAGE-TEXT (1)      30650000
306600              MOVE SQLCA           TO DP013-SQLCA                 30660000
306700              MOVE 'TPURITM'       TO DP013-DB2-TABLE-NAME (1)    30670000
306800              SET DP013-DB2-ABEND  TO TRUE                        30680000
306900              PERFORM DP013-0000-PROCESS-ABEND                    30690000
307000     END-EVALUATE.                                                30700000
307100                                                                  30710000
307110*----------------------------------------------------------------*30711000
307120* CHANGES MADE FOR WR # 230ZZ ENDS HERE.                         *30712000
307130*----------------------------------------------------------------*30713000
307200/                                                                 30720000
307210*----------------------------------------------------------------*30721000
307220*                                               **   WR # 230ZZ  *30722000
307230* CODE FOR ACCESSING LOGISTICS DOMAIN ITEM ACCESS MODULE         *30723000
307240*----------------------------------------------------------------*30724000
307250 4315-CALL-CICS-API-ARCH.                                         30725000
307260                                                                  30726000
307270        MOVE DK-ITM-NBR           TO XL001-KEY-ITM-NBR.           30727000
307280                                                                  30728000
307290        SET  XL001-BY-ITEM                                        30729000
307291             XL001-SELECT-SKU                                     30729100
307292             XL001-SELECT-VND-STYL   TO TRUE.                     30729200
307293                                                                  30729300
307294        CALL XL001-VSM-PGM USING  DFHEIBLK                        30729400
307295                                  XL001-COMMAREA                  30729500
307296                                  XL001-ITEM-COMMAREA.            30729600
307297        EVALUATE TRUE                                             30729700
307298                                                                  30729800
307299         WHEN XL001-SKU-SQLCODE = +0                              30729900
307300           MOVE XL001-SKU-NBR     TO  PV-TEMP-SEQ-NBR             30730000
307301           MOVE PV-TEMP-SEQ-NBR   TO  PV-SKU-SEQ                  30730100
307302                                                                  30730200
307304           PERFORM 4320-SELECT-VND-STYL                           30730400
307305                                                                  30730500
307306         WHEN XL001-SKU-SQLCODE = +100                            30730600
307307           MOVE ZEROES            TO  PV-TEMP-SEQ-NBR             30730799
307308           MOVE SPACES            TO  PV-SKU-SEQ                  30730899
307309           MOVE SPACES            TO  PV-TEMP-TKT-TYPE            30730999
307310                                                                  30731099
307311         WHEN XL001-SKU-SQLCODE = -904                            30731199
307312         WHEN XL001-SKU-SQLCODE = -911                            30731299
307313         WHEN XL001-SKU-SQLCODE = -913                            30731399
307314           PERFORM 9900-SOFT-ABORT                                30731499
307315                                                                  30731599
307316         WHEN XL001-INVALID-ACCESS                                30731699
307317           MOVE '4315-CALL-CICS-API-ARCH'                         30731799
307318                                TO DP013-PARAGRAPH                30731899
307319           MOVE 'ACCESS INFO FOR XLKUT001 INCORRECT'              30731999
307320                                TO DP013-MESSAGE-TEXT (1)         30732099
307321           MOVE SQLCA           TO DP013-SQLCA                    30732199
307322           MOVE 'XLV_SKU'       TO DP013-DB2-TABLE-NAME (1)       30732299
307323           SET DP013-DB2-ABEND  TO TRUE                           30732300
307324           PERFORM DP013-0000-PROCESS-ABEND                       30732400
307325                                                                  30732500
307326         WHEN OTHER                                               30732600
307327           MOVE '4315-CALL-CICS-API-ARCH'                         30732700
307328                                TO DP013-PARAGRAPH                30732800
307329           MOVE 'UNSUCCESSFUL SELECT OF ITEM NBR'                 30732900
307330                                TO DP013-MESSAGE-TEXT (1)         30733000
307331           MOVE XL001-SKU-SQLCODE                                 30733199
307332                                TO SQLCODE                        30733299
307333           MOVE SQLCA           TO DP013-SQLCA                    30733300
307334           MOVE 'XLV_SKU'       TO DP013-DB2-TABLE-NAME (1)       30733400
307335           SET DP013-DB2-ABEND  TO TRUE                           30733500
307336           PERFORM DP013-0000-PROCESS-ABEND                       30733600
307337        END-EVALUATE.                                             30733700
307338                                                                  30733800
307339 4320-SELECT-VND-STYL.                                            30733900
307340                                                                  30734000
307341        EVALUATE TRUE                                             30734100
307342                                                                  30734200
307343         WHEN XL001-VND-STYL-SQLCODE = +0                         30734300
307344           MOVE XL001-TKT-TYP-DESC  TO  PV-TEMP-TKT-TYPE          30734400
307345                                                                  30734500
307346         WHEN XL001-VND-STYL-SQLCODE = +100                       30734600
307347           MOVE SPACES              TO  PV-TEMP-TKT-TYPE          30734799
307348                                                                  30734800
307349         WHEN XL001-VND-STYL-SQLCODE = -904                       30734900
307350         WHEN XL001-VND-STYL-SQLCODE = -911                       30735000
307351         WHEN XL001-VND-STYL-SQLCODE = -913                       30735100
307353           PERFORM 9900-SOFT-ABORT                                30735300
307354                                                                  30735400
307355         WHEN XL001-INVALID-ACCESS                                30735500
307356           MOVE '4320-SELECT-VND-STYL'                            30735600
307357                                TO DP013-PARAGRAPH                30735700
307358           MOVE 'ACCESS INFO FOR XLKUT001 INCORRECT'              30735800
307359                                TO DP013-MESSAGE-TEXT (1)         30735900
307360           MOVE SQLCA           TO DP013-SQLCA                    30736000
307362           MOVE 'XLV_VND_STYL'  TO DP013-DB2-TABLE-NAME (1)       30736200
307363           SET DP013-DB2-ABEND  TO TRUE                           30736300
307364           PERFORM DP013-0000-PROCESS-ABEND                       30736400
307365                                                                  30736500
307366         WHEN OTHER                                               30736600
307367           MOVE '4320-SELECT-VND-STYL'                            30736700
307368                                TO DP013-PARAGRAPH                30736800
307371           MOVE 'FETCH TKT-TYP-DESC'                              30737100
307372                                TO DP013-MESSAGE-TEXT (1)         30737200
307373           MOVE XL001-VND-STYL-SQLCODE                            30737399
307374                                TO SQLCODE                        30737499
307375           MOVE SQLCA           TO DP013-SQLCA                    30737500
307376           MOVE 'XLV_VND_STYL'  TO DP013-DB2-TABLE-NAME (1)       30737600
307377           SET DP013-DB2-ABEND  TO TRUE                           30737700
307378           PERFORM DP013-0000-PROCESS-ABEND                       30737800
307379        END-EVALUATE.                                             30737900
307380                                                                  30738000
307383*----------------------------------------------------------------*30738300
307384* CHANGES MADE FOR WR # 230ZZ ENDS HERE.                         *30738400
307385*----------------------------------------------------------------*30738500
307390*----------------------------------------------------------------*30739000
307400*    GET TRECEIV INFO FOR THE TOP OF THE SCREEN                  *30740000
307500*----------------------------------------------------------------*30750000
307600 4355-GET-TRECEIV-INFO.                                           30760000
307700                                                                  30770000
307800         EXEC SQL                                                 30780000
307900              SELECT ORD_NBR                                      30790000
308000                    ,REC_SEQ_NBR                                  30800000
308100                    ,STATUS_CDE                                   30810000
308200                    ,EXPTED_CART_CNT                              30820000
308300                    ,ACTL_CART_CNT                                30830000
308400              INTO   :RECEIV-ORD-NBR                              30840000
308500                    ,:RECEIV-REC-SEQ-NBR                          30850000
308600                    ,:RECEIV-STATUS-CDE                           30860000
308700                    ,:RECEIV-EXPTED-CART-CNT                      30870000
308800                    ,:RECEIV-ACTL-CART-CNT                        30880000
308900                                                                  30890000
309000              FROM  TRECEIV                                       30900000
309100              WHERE ORD_NBR        = :DK-ORD-NBR                  30910000
309200                AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR              30920000
309300                AND OPER_UNT_ID    = :DK-OPER-UNT-ID              30930000
309400                AND FCLTY_ID       = :DK-FACT                     30940000
309500                AND VER_STATUS_CDE = 'A'                          30950000
309600         END-EXEC                                                 30960000
309700                                                                  30970000
309800         EVALUATE TRUE                                            30980000
309900             WHEN SQLCODE = +0                                    30990000
310000             WHEN SQLCODE = +100                                  31000000
310100                  CONTINUE                                        31010000
310200             WHEN SQLCODE = -904                                  31020000
310300             WHEN SQLCODE = -911                                  31030000
310400             WHEN SQLCODE = -913                                  31040000
310500                  PERFORM 9900-SOFT-ABORT                         31050000
310600                                                                  31060000
310700             WHEN SQLWARN0 NOT = SPACES                           31070000
310800             WHEN SQLCODE < +0                                    31080000
310900             WHEN SQLCODE > +0                                    31090000
311000                  MOVE '4355-GET-TRECIEV-INFO'                    31100000
311100                                  TO DP013-PARAGRAPH              31110000
311200                  MOVE 'UNSUCCESSFUL SELECT ON TRECEIV'           31120000
311300                                  TO DP013-MESSAGE-TEXT (1)       31130000
311400                  MOVE SQLCA      TO DP013-SQLCA                  31140000
311500                  MOVE 'TRECEIV ' TO DP013-DB2-TABLE-NAME (1)     31150000
311600                  SET DP013-DB2-ABEND                             31160000
311700                      DP013-XCTL-DISPLAY-RESTART                  31170000
311800                                  TO TRUE                         31180000
311900                  PERFORM DP013-0000-PROCESS-ABEND                31190000
312000         END-EVALUATE.                                            31200000
312100/                                                                 31210000
312200*----------------------------------------------------------------*31220000
312300*    GET TPURCHS INFO FOR THE TOP OF THE SCREEN                  *31230000
312400*----------------------------------------------------------------*31240000
312500 4360-GET-TPURCHS-INFO.                                           31250000
312600                                                                  31260000
312700         EXEC SQL                                                 31270000
312800              SELECT PO_NBR                                       31280000
312900                    ,DEPT_NBR                                     31290000
313000                    ,ENT_ID                                       31300000
313100              INTO   :PURCHS-PO-NBR                               31310000
313200                    ,:PURCHS-DEPT-NBR                             31320000
313300                    ,:PURCHS-ENT-ID                               31330000
313400              FROM  TPURCHS                                       31340000
313500              WHERE PO_NBR         = :DK-ORD-NBR                  31350000
313600                AND VER_STATUS_CDE = 'A'                          31360000
313700         END-EXEC                                                 31370000
313800                                                                  31380000
313900         EVALUATE TRUE                                            31390000
314000             WHEN SQLCODE = +0                                    31400000
314100             WHEN SQLCODE = +100                                  31410000
314200                  CONTINUE                                        31420000
314300             WHEN SQLCODE = -904                                  31430000
314400             WHEN SQLCODE = -911                                  31440000
314500             WHEN SQLCODE = -913                                  31450000
314600                  PERFORM 9900-SOFT-ABORT                         31460000
314700                                                                  31470000
314800             WHEN SQLWARN0 NOT = SPACES                           31480000
314900             WHEN SQLCODE < +0                                    31490000
315000             WHEN SQLCODE > +0                                    31500000
315100                  MOVE '4360-GET-TPURCHS-INFO'                    31510000
315200                                  TO DP013-PARAGRAPH              31520000
315300                  MOVE 'UNSUCCESSFUL SELECT ON TPURCHS'           31530000
315400                                  TO DP013-MESSAGE-TEXT (1)       31540000
315500                  MOVE SQLCA      TO DP013-SQLCA                  31550000
315600                  MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (1)     31560000
315700                  SET DP013-DB2-ABEND                             31570000
315800                      DP013-XCTL-DISPLAY-RESTART                  31580000
315900                                  TO TRUE                         31590000
316000                  PERFORM DP013-0000-PROCESS-ABEND                31600000
316100         END-EVALUATE.                                            31610000
316200/                                                                 31620000
316300*----------------------------------------------------------------*31630000
316400*    FIND IF THERE ARE ANY LINE LEVEL TROUBLES                   *31640000
316500*----------------------------------------------------------------*31650000
316600 4370-FIND-LINE-TROUBLE.                                          31660000
316700     MOVE ZERO                    TO PV-UNRSLVD-TRBL-COUNT        31670000
316800                                     PV-RSLVD-TRBL-COUNT          31680000
316900     EXEC SQL                                                     31690000
317000         SELECT COUNT(*)                                          31700000
317100         INTO :PV-UNRSLVD-TRBL-COUNT                              31710000
317200         FROM TTRBNTF A                                           31720000
317300         WHERE A.PO_NBR               = :DK-ORD-NBR               31730000
317400               AND A.REC_SEQ_NBR      = :DK-REC-SEQ-NBR           31740000
317500               AND A.PO_LNE_NBR       = :DK-LINE-NBR              31750000
317600               AND A.OPER_UNT_ID      = :DK-OPER-UNT-ID           31760000
317700               AND A.FCLTY_ID         = :DK-FACT                  31770000
317800               AND A.RESOLVED_IND IN (:PC-N, :PC-I)               31780000
317900     END-EXEC                                                     31790000
318000                                                                  31800000
318100     EVALUATE TRUE                                                31810000
318200         WHEN SQLCODE = ZERO                                      31820000
318300         WHEN SQLCODE = +100                                      31830000
318400             CONTINUE                                             31840000
318500         WHEN SQLCODE = -904                                      31850000
318600         WHEN SQLCODE = -911                                      31860000
318700         WHEN SQLCODE = -913                                      31870000
318800              PERFORM 9900-SOFT-ABORT                             31880000
318900                                                                  31890000
319000         WHEN SQLWARN0 NOT = SPACE                                31900000
319100         WHEN SQLCODE < ZERO                                      31910000
319200         WHEN SQLCODE > ZERO                                      31920000
319300             MOVE '4370-FIND-LINE-TROUBLE'                        31930000
319400                             TO DP013-PARAGRAPH                   31940000
319500             MOVE 'SELECT ON TTRBNTF'                             31950000
319600                             TO DP013-MESSAGE-TEXT (1)            31960000
319700             MOVE SQLCA          TO DP013-SQLCA                   31970000
319800             MOVE 'TTRBNTF'      TO DP013-DB2-TABLE-NAME (1)      31980000
319900             SET DP013-DB2-ABEND                                  31990000
320000                             TO TRUE                              32000000
320100             SET DP013-XCTL-DISPLAY-RESTART                       32010000
320200                             TO TRUE                              32020000
320300             PERFORM DP013-0000-PROCESS-ABEND                     32030000
320400     END-EVALUATE.                                                32040000
320500                                                                  32050000
320600     IF PV-UNRSLVD-TRBL-COUNT = ZERO AND SQLCODE = ZERO OR +100   32060000
320700         EXEC SQL                                                 32070000
320800             SELECT COUNT(*)                                      32080000
320900             INTO :PV-RSLVD-TRBL-COUNT                            32090000
321000             FROM TTRBNTF A                                       32100000
321100                , TTRBRSN B                                       32110000
321200             WHERE A.PO_NBR           = :DK-ORD-NBR               32120000
321300                   AND A.REC_SEQ_NBR  = :DK-REC-SEQ-NBR           32130000
321400                   AND A.PO_LNE_NBR   = :DK-LINE-NBR              32140000
321500                   AND A.OPER_UNT_ID  = :DK-OPER-UNT-ID           32150000
321600                   AND A.FCLTY_ID     = :DK-FACT                  32160000
321700                   AND A.RESOLVED_IND = :PC-R                     32170000
321800                   AND A.TRBL_RSN_CDE = B.TRBL_RSN_CDE            32180000
321900                   AND B.NOTIF_IND    = :PC-T                     32190000
322000         END-EXEC                                                 32200000
322100                                                                  32210000
322200         EVALUATE TRUE                                            32220000
322300             WHEN SQLCODE = ZERO                                  32230000
322400             WHEN SQLCODE = +100                                  32240000
322500                 CONTINUE                                         32250000
322600             WHEN SQLCODE = -904                                  32260000
322700             WHEN SQLCODE = -911                                  32270000
322800             WHEN SQLCODE = -913                                  32280000
322900                  PERFORM 9900-SOFT-ABORT                         32290000
323000                                                                  32300000
323100             WHEN SQLWARN0 NOT = SPACE                            32310000
323200             WHEN SQLCODE < ZERO                                  32320000
323300             WHEN SQLCODE > ZERO                                  32330000
323400                 MOVE '4370-FIND-LINE-TROUBLE'                    32340000
323500                                 TO DP013-PARAGRAPH               32350000
323600                 MOVE 'SELECT ON TTRBNTF - TTRBRSN'               32360000
323700                                 TO DP013-MESSAGE-TEXT (1)        32370000
323800                 MOVE SQLCA      TO DP013-SQLCA                   32380000
323900                 MOVE 'TTRBNTF'  TO DP013-DB2-TABLE-NAME (1)      32390000
324000                 MOVE 'TTRBRSN'  TO DP013-DB2-TABLE-NAME (2)      32400000
324100                 SET DP013-DB2-ABEND                              32410000
324200                                 TO TRUE                          32420000
324300                 SET DP013-XCTL-DISPLAY-RESTART                   32430000
324400                                 TO TRUE                          32440000
324500                 PERFORM DP013-0000-PROCESS-ABEND                 32450000
324600         END-EVALUATE                                             32460000
324700     END-IF.                                                      32470000
324800                                                                  32480000
324900                                                                  32490000
325000*----------------------------------------------------------------*32500000
325100* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *32510000
325200*----------------------------------------------------------------*32520000
325300 4400-MOVE-COMMAREA-TO-SCREEN.                                    32530000
325400                                                                  32540000
325500     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             32550000
325600         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          32560000
325700         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          32570000
325800             MOVE +1               TO ASC-BLK-SUB                 32580000
325900             PERFORM 5100-WRITE-TEMP-STORAGE                      32590000
326000             ADD +1                TO ASC-BLK-SUB                 32600000
326100             PERFORM 5100-WRITE-TEMP-STORAGE                      32610000
326200             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             32620000
326300                 GIVING PV-BLOCK-NUMBER                           32630000
326400                 REMAINDER PV-REMAINDER                           32640000
326500             IF  PV-REMAINDER > ZERO                              32650000
326600                 ADD +1            TO PV-BLOCK-NUMBER             32660000
326700             END-IF                                               32670000
326800             MOVE +1               TO ASC-BLK-SUB                 32680000
326900             PERFORM 4410-READ-TEMP-STORAGE                       32690000
327000             ADD +1                TO ASC-BLK-SUB                 32700000
327100                                      PV-BLOCK-NUMBER             32710000
327200             PERFORM 4410-READ-TEMP-STORAGE                       32720000
327300     END-IF.                                                      32730000
327400                                                                  32740000
327500     MOVE +1                       TO ASC-BLK-SUB.                32750000
327600                                                                  32760000
327700     COMPUTE ASC-ITEM-SUB =                                       32770000
327800         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              32780000
327900         + PC-ITEMS-PER-PANEL).                                   32790000
328000                                                                  32800000
328100     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        32810000
328200         ADD +1                    TO ASC-BLK-SUB                 32820000
328300         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            32830000
328400     END-IF.                                                      32840000
328500                                                                  32850000
328600     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           32860000
328700         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                32870000
328800                                                                  32880000
328900     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        32890000
329000     MOVE +0                       TO ASC-PREV-PACK-ID            32900000
329100     PERFORM 4420-FORMAT-LIST-LINES                               32910000
329200         VARYING PV-SUB                                           32920000
329300         FROM PC-ITEMS-PER-PANEL BY -1                            32930000
329400         UNTIL PV-SUB < +1.                                       32940000
329500                                                                  32950000
329600     IF ASC-ADD-PACK                                              32960000
329700        MOVE +1                TO ASC-ITEM-SUB                    32970000
329800        PERFORM 4425-FORMAT-ADD-PACK-LINES                        32980000
329900            VARYING PV-SUB                                        32990000
330000            FROM 1  BY 1                                          33000000
330100         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        33010000
330200         IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                    33020000
330300             MOVE +1                   TO ASC-BLK-SUB             33030000
330400         END-IF                                                   33040000
330500     ELSE                                                         33050000
330600     IF  ASC-ITEM-SUB < + 1                                       33060000
330700         MOVE +1                   TO ASC-BLK-SUB                 33070000
330800     END-IF.                                                      33080000
330900                                                                  33090000
331000     IF PV-SUB > PC-ITEMS-PER-PANEL                               33100000
331100         MOVE +1                   TO ASC-BLK-SUB.                33110000
331200                                                                  33120000
331300     COMPUTE ASC-ITEMS-DISPLAYED =                                33130000
331400         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          33140000
331500                                                                  33150000
331600     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    33160000
331700                                      ASTRTITO.                   33170000
331800                                                                  33180000
331900     MOVE ASC-PO-NBR                   TO APONBRO.                33190000
332000     MOVE ASC-REC-SEQ-NBR              TO ASEQNBRO.               33200000
332100     MOVE ASC-STAT                     TO ASTATO.                 33210000
332200     MOVE ASC-OPR-ID                   TO AOPUNTO.                33220000
332300     MOVE ASC-FACT                     TO AFACTYO.                33230000
332400     MOVE ASC-FCLTY-DESC               TO AOPNMEO.                33240000
332500                                                                  33250000
332510*----------------------------------------------------------------*33251000
332520*                                                    WR # 230ZZ  *33252000
332530* ADDED MOVE TO MAP OUTPUT VARIABLE                              *33253000
332540*----------------------------------------------------------------*33254000
332550*                                                                 33255000
332560     MOVE PV-DEPT-NBR TO ADEPTBRO.                                33256099
332570*                                                                 33257000
332580*----------------------------------------------------------------*33258000
332590* CHANGES MADE FOR WR # 230ZZ ENDS HERE.                         *33259000
332591*----------------------------------------------------------------*33259100
332600                                                                  33260000
332700     MOVE ASC-TRECEIV-EXPTED-CART-CNT  TO AEXQTYO.                33270000
332800     MOVE ASC-TRECEIV-ACTL-CART-CNT    TO AACQTYO.                33280000
332900                                                                  33290000
333000                                                                  33300000
333100     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    33310000
333200     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    33320000
333300     IF ASC-ADD-PACK                                              33330000
333400        MOVE ASC-PACKS-DISPLAYED   TO ASELITO                     33340000
333500     ELSE                                                         33350000
333600        MOVE ASC-NUMBER-OF-SELECTED-ITEMS                         33360000
333700                                   TO ASELITO.                    33370000
333800                                                                  33380000
333900     IF  DP020-MSG-NUMBER-X = SPACE                               33390000
334000         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  33400000
334100*            --- MORE ITEMS TO DISPLAY ----                       33410000
334200             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            33420000
334300             SET DP020-MSG-INFORMATIONAL                          33430000
334400                                   TO TRUE                        33440000
334500         END-IF                                                   33450000
334600     END-IF.                                                      33460000
334700                                                                  33470000
334800*---------------------------------------------------------------- 33480000
334900* CALL XLKUT071 TO GET THE LOCATION DESCRIPTION                   33490099
335000*---------------------------------------------------------------- 33500000
335100                                                                  33510000
335200 4010-GET-LOC-DESC.                                               33520099
335300     INITIALIZE XL071-COMMAREA-REC.                               33530099
335400     MOVE DK-OPER-UNT-ID        TO PV-UNPACK-OPER-UNT-ID.         33540099
335500     MOVE PV-UNPACK-OPER-UNT-ID TO XL071-LOCATION-NUMBER.         33550099
335600                                                                  33560099
335700     CALL XL071-LOCATION-MODULE USING DFHEIBLK                    33570099
335800                                      XL071-COMMAREA              33580099
335900                                      XL071-COMMAREA-REC.         33590099
336300                                                                  33630000
336400     EVALUATE TRUE                                                33640000
336500         WHEN XL071-NO-ERRORS                                     33650099
336600             CONTINUE                                             33660000
336700         WHEN XL071-LOC-NOT-FOUND                                 33670099
336710             SET PS-ERROR                                         33671099
336720                 DP020-MSG-FATAL         TO TRUE                  33672099
336730             MOVE PC-TSYMSG-00005        TO DP020-MSG-NUMBER      33673099
336740             MOVE DP015-UNP-ALP-BRT-OFF  TO AOPNMEA               33674099
336760             MOVE DP015-RED              TO AOPNMEC               33676099
336770             MOVE DP015-REVERSE          TO AOPNMEH               33677099
336780             MOVE -1                     TO AOPNMEL               33678099
336790             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  33679099
336900                                                                  33690000
337000          WHEN XL071-SQLCODE-N = -904                             33700099
337100          WHEN XL071-SQLCODE-N = -911                             33710099
337200          WHEN XL071-SQLCODE-N = -913                             33720099
337300               PERFORM 9900-SOFT-ABORT                            33730000
337400                                                                  33740000
337700         WHEN XL071-BAD-DB2-RETURN                                33770099
337800             MOVE '4010-GET-LOC-DESC' TO DP013-PARAGRAPH          33780099
338000             MOVE 'SELECT LOC. DESC'  TO DP013-MESSAGE-TEXT (1)   33800099
338200             MOVE XL071-SQLCA         TO DP013-SQLCA              33820099
338300             MOVE 'XLT_LOC'           TO DP013-DB2-TABLE-NAME (1) 33830099
338400             SET DP013-DB2-ABEND                                  33840099
338600                 DP013-XCTL-DISPLAY-RESTART TO TRUE               33860099
338800             PERFORM DP013-0000-PROCESS-ABEND                     33880000
338900     END-EVALUATE.                                                33890000
339000                                                                  33900000
340400*----------------------------------------------------------------*34040000
340500*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *34050000
340600*----------------------------------------------------------------*34060000
340700                                                                  34070000
340800 4410-READ-TEMP-STORAGE.                                          34080000
340900                                                                  34090000
341000     EXEC CICS                                                    34100000
341100         READQ TS                                                 34110000
341200             QUEUE (ASC-LIST-QUEUE-NAME)                          34120000
341300             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               34130000
341400             ITEM  (PV-BLOCK-NUMBER)                              34140000
341500             RESP  (PV-CICS-RESP)                                 34150000
341600     END-EXEC.                                                    34160000
341700                                                                  34170000
341800     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       34180000
341900       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     34190000
342000         CONTINUE                                                 34200000
342100     ELSE                                                         34210000
342200         SET DP013-CICS-ABEND      TO TRUE                        34220000
342300         SET DP013-NO-ROLLBACK     TO TRUE                        34230000
342400         MOVE '4410-READ-TEMP-STORAGE'                            34240000
342500                                   TO DP013-PARAGRAPH             34250000
342600         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      34260000
342700                                   TO DP013-MESSAGE-TEXT(1)       34270000
342800         PERFORM DP013-0000-PROCESS-ABEND                         34280000
342900     END-IF.                                                      34290000
343000                                                                  34300000
343100     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      34310000
343200                                   TO TRUE.                       34320000
343300                                                                  34330000
343400     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         34340000
343500         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               34350000
343600     END-IF.                                                      34360000
343700                                                                  34370000
343800/                                                                 34380000
343900*----------------------------------------------------------------*34390000
344000*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *34400000
344100*----------------------------------------------------------------*34410000
344200                                                                  34420000
344300 4420-FORMAT-LIST-LINES.                                          34430000
344400                                                                  34440000
344500     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      34450000
344600         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                34460000
344700         MOVE DP015-ASK-DRK-OFF    TO MR-SELECTA (PV-SUB)         34470000
344800         MOVE SPACES               TO MR-SELECT  (PV-SUB)         34480000
344900         MOVE SPACES               TO MR-SKU              (PV-SUB)34490000
345000                                      MR-LINE             (PV-SUB)34500000
345100                                      MR-PO-PACK-RATIO    (PV-SUB)34510000
345200                                      MR-OTR              (PV-SUB)34520000
345300                                      MR-STATUS-CDE       (PV-SUB)34530000
345400                                      MR-PACK-ID          (PV-SUB)34540000
345500                                      MR-PACK-DESC        (PV-SUB)34550000
345600     ELSE                                                         34560000
345700         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      34570000
345800                                                   > SPACE        34580000
345900             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 34590000
346000                                   TO MR-SELECT (PV-SUB)          34600000
346100         ELSE                                                     34610000
346200             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      34620000
346300                                   TO MR-SELECT (PV-SUB)          34630000
346400         END-IF                                                   34640000
346500                                                                  34650000
346600         IF  DP030-SET-CURSOR-TRAILER                             34660000
346700             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)34670000
346800                 > SPACE)                                         34680000
346900               OR (PV-SUB = 1))                                   34690000
347000                SET DP030-SET-CURSOR-APPL-1 TO TRUE               34700000
347100                MOVE -1            TO MR-SELECTL (PV-SUB)         34710000
347200             END-IF                                               34720000
347300         END-IF                                                   34730000
347400                                                                  34740000
347500         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           34750000
347600                                                                  34760000
347700             MOVE ASC-ACTION  (ASC-BLK-SUB ASC-ITEM-SUB)          34770000
347800                                  TO MR-ACT (PV-SUB)              34780000
347900             IF ASC-PACK-ID (ASC-BLK-SUB ASC-ITEM-SUB) NOT > +0   34790000
348000                MOVE SPACES       TO MR-PACK-ID (PV-SUB)          34800000
348100             ELSE                                                 34810000
348200                MOVE ASC-PACK-ID (ASC-BLK-SUB ASC-ITEM-SUB)       34820000
348300                                  TO MR-PACK-ID (PV-SUB)          34830000
348400             END-IF                                               34840000
348500                                                                  34850000
348600             MOVE ASC-PACK-DESC (ASC-BLK-SUB ASC-ITEM-SUB)        34860000
348700                                  TO MR-PACK-DESC (PV-SUB)        34870000
348800             MOVE ASC-LINE-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)      34880000
348900                                  TO MR-LINE-N (PV-SUB)           34890000
349000                                     DK-LINE-NBR                  34900000
349010*----------------------------------------------------------------*34901000
349020*                                                     WR # 230ZZ *34902000
349030*    ADDED NEW MOVES FOR MR-SKU                                  *34903000
349040*----------------------------------------------------------------*34904000
349201             MOVE ASC-CL  (ASC-BLK-SUB ASC-ITEM-SUB)              34920100
349202                                 TO PV-DISP-CL                    34920299
349203             MOVE ASC-SEQ (ASC-BLK-SUB ASC-ITEM-SUB)              34920300
349204                                 TO PV-DISP-SKU                   34920499
349205             MOVE PV-DISP-CL-SKU                                  34920599
349206                                  TO MR-SKU (PV-SUB)              34920600
349210*----------------------------------------------------------------*34921000
349220* CHANGES MADE FOR WR # 230ZZ ENDS HERE.                         *34922000
349230*----------------------------------------------------------------*34923000
349300             MOVE ASC-PO-PACK-RATIO (ASC-BLK-SUB ASC-ITEM-SUB)    34930000
349400                                  TO MR-PO-PACK-RATIO-N (PV-SUB)  34940000
349500             PERFORM 4100-PREPARE-CURSOR                          34950000
349600             PERFORM 4200-CALC-OPEN-TO-REC                        34960000
349700             MOVE DK-LINE-NBR           TO DP277-SEARCH-NBR       34970000
349800             PERFORM 4210-SEARCH-OTR                              34980000
349900             MOVE DP277-OTR-OUT-X TO ASC-OTR                      34990000
350000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 35000000
350100                                                                  35010000
350200             MOVE ASC-OTR (ASC-BLK-SUB ASC-ITEM-SUB)              35020000
350300                                  TO MR-OTR (PV-SUB)              35030000
350400             MOVE ASC-STATUS-CDE (ASC-BLK-SUB ASC-ITEM-SUB)       35040000
350500                                  TO MR-STATUS-CDE (PV-SUB)       35050000
350600         END-IF                                                   35060000
350700     END-IF.                                                      35070000
350800                                                                  35080000
350900     IF  ASC-ADD-LINE                                             35090000
351000     AND ASC-STATUS-CDE                                           35100000
351100         (ASC-BLK-SUB ASC-ITEM-SUB) = PC-STAT-CDE-RV              35110000
351200           MOVE DP015-ASK-DRK-OFF TO MR-SELECTA (PV-SUB)          35120000
351300     END-IF.                                                      35130000
351400                                                                  35140000
351500     SUBTRACT +1 FROM ASC-ITEM-SUB.                               35150000
351600                                                                  35160000
351700                                                                  35170000
351800     IF  ASC-ITEM-SUB < + 1                                       35180000
351900         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                35190000
352000     END-IF.                                                      35200000
352100                                                                  35210000
352600 4425-FORMAT-ADD-PACK-LINES.                                      35260000
352700                                                                  35270000
352800                                                                  35280000
352900     MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)                   35290000
353000                                  TO MR-ACT (PV-SUB)              35300000
353100                                                                  35310000
353200     IF ASC-PREV-PACK-ID NOT = ASC-PACK-ID                        35320000
353300                             (ASC-BLK-SUB ASC-ITEM-SUB)  AND      35330000
353400        ASC-PACK-ID (ASC-BLK-SUB ASC-ITEM-SUB) > 0                35340000
353500                                                                  35350000
353600          MOVE ASC-PACK-ID (ASC-BLK-SUB ASC-ITEM-SUB)             35360000
353700                                  TO ASC-PREV-PACK-ID             35370000
353800                                     MR-PACK-ID (PV-SUB)          35380000
353900                                     DK-PACK-ID                   35390000
354000          MOVE ASC-PACK-DESC (ASC-BLK-SUB ASC-ITEM-SUB)           35400000
354100                                  TO MR-PACK-DESC (PV-SUB)        35410000
354200          MOVE DP015-UNP-ALP-NOR-OFF                              35420000
354300                                  TO MR-SELECTA (PV-SUB)          35430000
354400          MOVE DP015-GREEN        TO MR-SELECTC (PV-SUB)          35440000
354500          MOVE DP015-UNDERLINE    TO MR-SELECTH (PV-SUB)          35450000
354600                                                                  35460000
354700          PERFORM 4440-UNCONFIRMED-LNE-CHECK                      35470000
354800          IF ASC-LNE-REVISE-TRBL (ASC-BLK-SUB ASC-ITEM-SUB)       35480000
354900              MOVE DP015-ASK-DRK-OFF TO MR-SELECTA (PV-SUB)       35490000
355000              MOVE ASC-PACK-ID (ASC-BLK-SUB ASC-ITEM-SUB)         35500000
355100                                     TO ASC-PACK-REVISE-TRBL      35510000
355200          END-IF                                                  35520000
355300     ELSE                                                         35530000
355400          MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA   (PV-SUB)        35540000
355500          MOVE SPACES             TO MR-SELECT    (PV-SUB)        35550000
355600                                     MR-ACT       (PV-SUB)        35560000
355700                                     MR-PACK-ID   (PV-SUB)        35570000
355800                                     MR-PACK-DESC (PV-SUB)        35580000
355900          IF ASC-PACK-ID (ASC-BLK-SUB ASC-ITEM-SUB) =             35590000
356000             ASC-PACK-REVISE-TRBL                                 35600000
356100              SET ASC-LNE-REVISE-TRBL (ASC-BLK-SUB ASC-ITEM-SUB)  35610000
356200                                        TO TRUE                   35620000
356300              MOVE DP015-ASK-DRK-OFF TO MR-SELECTA (PV-SUB)       35630000
356400          END-IF                                                  35640000
356500     END-IF.                                                      35650000
356600                                                                  35660000
356700     ADD +1 TO ASC-ITEM-SUB.                                      35670000
356800                                                                  35680000
356900     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        35690000
357000         MOVE +1                   TO ASC-ITEM-SUB                35700000
357100     END-IF.                                                      35710000
357200                                                                  35720000
357300                                                                  35730000
357400                                                                  35740000
357500                                                                  35750000
357600*----------------------------------------------------------------*35760000
357700*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *35770000
357800*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *35780000
357900*  ISSUE A WARNING.                                              *35790000
358000*----------------------------------------------------------------*35800000
358100 4430-CHECK-FOR-BEGIN-AND-END.                                    35810000
358200                                                                  35820000
358300     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       35830000
358400         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     35840000
358500*            -- NO END-OF-RANGE SPECFIED ---                      35850000
358600             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            35860000
358700             SET DP020-MSG-WARNING TO TRUE                        35870000
358800             PERFORM 4431-POSITION-AT-WARNING                     35880000
358900         END-IF                                                   35890000
359000     ELSE                                                         35900000
359100         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     35910000
359200*            -- NO BEGINNING-OF-RANGE SPECFIED ---                35920000
359300             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            35930000
359400             SET DP020-MSG-WARNING TO TRUE                        35940000
359500             PERFORM 4431-POSITION-AT-WARNING                     35950000
359600         END-IF                                                   35960000
359700     END-IF.                                                      35970000
359800                                                                  35980000
359900*----------------------------------------------------------------*35990000
360000* CHECK IF ANY ITEMS HAVE AN UNCONFIRMED RV STATUS                36000000
360100*----------------------------------------------------------------*36010000
360200 4440-UNCONFIRMED-LNE-CHECK.                                      36020000
360300                                                                  36030000
360400     EXEC SQL                                                     36040000
360500          SELECT COUNT(*)                                         36050000
360600          INTO   :PV-RV-COUNTER                                   36060000
360700          FROM   TPURITM                                          36070000
360800          WHERE  PO_NBR         = :DK-ORD-NBR                     36080000
360900            AND  PO_PREPK_ID    = :DK-PACK-ID                     36090000
361000            AND  VER_STATUS_CDE = :PC-STAT-CDE-ACTIVE             36100000
361100            AND  STATUS_CDE     = :PC-STAT-CDE-RV                 36110000
361200     END-EXEC.                                                    36120000
361300                                                                  36130000
361400     EVALUATE TRUE                                                36140000
361500         WHEN SQLCODE = +0                                        36150000
361600              IF PV-RV-COUNTER > 0                                36160000
361700                 SET ASC-LNE-REVISE-TRBL                          36170000
361800                     (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE           36180000
361900              END-IF                                              36190000
362000         WHEN SQLCODE = +100                                      36200000
362100              CONTINUE                                            36210000
362200          WHEN SQLCODE = -904                                     36220000
362300          WHEN SQLCODE = -911                                     36230000
362400          WHEN SQLCODE = -913                                     36240000
362500               PERFORM 9900-SOFT-ABORT                            36250000
362600                                                                  36260000
362700         WHEN SQLWARN0 NOT = SPACES                               36270000
362800         WHEN SQLCODE < +0                                        36280000
362900         WHEN SQLCODE > +0                                        36290000
363000              MOVE '4440-UNCONFIRMED-LNE-CHECK'                   36300000
363100                               TO DP013-PARAGRAPH                 36310000
363200              MOVE 'UNSUCCESSFUL COUNT OF RV LINES'               36320000
363300                               TO DP013-MESSAGE-TEXT (1)          36330000
363400              MOVE SQLCA       TO DP013-SQLCA                     36340000
363500              MOVE 'TPURITM '  TO DP013-DB2-TABLE-NAME (1)        36350000
363600              SET DP013-DB2-ABEND                                 36360000
363700                  DP013-XCTL-DISPLAY-RESTART                      36370000
363800                               TO TRUE                            36380000
363900              PERFORM DP013-0000-PROCESS-ABEND                    36390000
364000     END-EVALUATE.                                                36400000
364100                                                                  36410000
364200*----------------------------------------------------------------*36420000
364300*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *36430000
364400*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *36440000
364500*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *36450000
364600*  POSITION THE CURSOR THERE.                                    *36460000
364700*----------------------------------------------------------------*36470000
364800 4431-POSITION-AT-WARNING.                                        36480000
364900                                                                  36490000
365000     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 36500000
365100                    - PV-TOP-ITEM + 1.                            36510000
365200                                                                  36520000
365300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      36530000
365400         CONTINUE                                                 36540000
365500     ELSE                                                         36550000
365600         SET DP030-SET-CURSOR-APPL-1                              36560000
365700                                   TO TRUE                        36570000
365800         MOVE -1                   TO MR-SELECTL (PV-SUB)         36580000
365900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         36590000
366000         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         36600000
366100     END-IF.                                                      36610000
366200                                                                  36620000
366300     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   36630000
366400                    - PV-TOP-ITEM + 1.                            36640000
366500                                                                  36650000
366600     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      36660000
366700         CONTINUE                                                 36670000
366800     ELSE                                                         36680000
366900         SET DP030-SET-CURSOR-APPL-1                              36690000
367000                                   TO TRUE                        36700000
367100         MOVE -1                   TO MR-SELECTL (PV-SUB)         36710000
367200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         36720000
367300         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         36730000
367400     END-IF.                                                      36740000
367500                                                                  36750000
367600/                                                                 36760000
367700*----------------------------------------------------------------*36770000
367800* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *36780000
367900* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *36790000
368000* FOR THE SELECTED ITEMS QUEUE.                                  *36800000
368100*                                                                *36810000
368200* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *36820000
368300* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *36830000
368400* THE ARRAY IS FULL.                                             *36840000
368500*----------------------------------------------------------------*36850000
368600                                                                  36860000
368700 5000-PREPARE-SEL-QUEUE.                                          36870000
368800                                                                  36880000
368900     MOVE +1                       TO ASC-BLK-SUB.                36890000
369000     PERFORM 5100-WRITE-TEMP-STORAGE.                             36900000
369100     ADD +1                        TO ASC-BLK-SUB.                36910000
369200     PERFORM 5100-WRITE-TEMP-STORAGE.                             36920000
369300                                                                  36930000
369400     EVALUATE TRUE                                                36940000
369500* GOTO TROUBLE LIST                                               36950000
369600      WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)                 36960000
369700         MOVE ASC-SEL-QUEUE-NAME-OUT                              36970000
369800                                 TO PC000-SEL-QUEUE-NAME          36980000
369900         PERFORM 6010-DELETE-SEL-QUEUE                            36990000
370000         SET ASC-UPDATE-TSQ2     TO TRUE                          37000000
370100         SET PC016-IDX           TO 1                             37010000
370200         MOVE ZERO               TO PC000-NUMBER-OF-TS-ITEMS      37020000
370300                                 PC000-NUMBER-OF-SELECTED-ITEMS   37030000
370400         INITIALIZE PC016-SELECTED-ITEM-ARRAY                     37040000
370500                                                                  37050000
370600          PERFORM 5210-FILL-SEL-QUEUE-RECORD                      37060000
370700                 VARYING PV-ITEM                                  37070000
370800             FROM 1 BY 1                                          37080000
370900             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN      37090000
371000         IF  PC016-IDX > 1                                        37100000
371100             PERFORM 5206-WRITE-SEL-QUEUE                         37110000
371200             ADD +1              TO PC000-NUMBER-OF-TS-ITEMS      37120000
371300         END-IF                                                   37130000
371400                                                                  37140000
371500     WHEN OTHER                                                   37150000
371600         MOVE ASC-SEL-QUEUE-NAME-OUT   TO RC800-SEL-QUEUE-NAME    37160000
371700         PERFORM 6010-DELETE-SEL-QUEUE                            37170000
371800         SET ASC-UPDATE-TSQ        TO TRUE                        37180000
371900         SET RC801-IDX             TO 1                           37190000
372000         MOVE ZERO                 TO RC800-NUMBER-OF-TS-ITEMS    37200000
372100                                   RC800-NUMBER-OF-SELECTED-ITEMS 37210000
372200         INITIALIZE RC801-SELECTED-ITEM-ARRAY                     37220000
372300                                                                  37230000
372400         PERFORM 5200-FILL-SEL-QUEUE-RECORD                       37240000
372500            VARYING PV-ITEM                                       37250000
372600             FROM 1 BY 1                                          37260000
372700             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN      37270000
372800         IF  RC801-IDX > 1                                        37280000
372900             PERFORM 5205-WRITE-SEL-QUEUE                         37290000
373000             ADD +1                TO RC800-NUMBER-OF-TS-ITEMS    37300000
373100         END-IF                                                   37310000
373200     END-EVALUATE.                                                37320000
373300                                                                  37330000
373400/                                                                 37340000
373500*----------------------------------------------------------------*37350000
373600*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *37360000
373700*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *37370000
373800*----------------------------------------------------------------*37380000
373900                                                                  37390000
374000 5100-WRITE-TEMP-STORAGE.                                         37400000
374100                                                                  37410000
374200     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     37420000
374300                                   TO PV-LIST-ITEM-NUMBER.        37430000
374400     COMPUTE PV-BLOCK-NUMBER =                                    37440000
374500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    37450000
374600                                                                  37460000
374700     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             37470000
374800     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             37480000
374900         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      37490000
375000             PERFORM 5105-REWRITE-ASC-LISTQ                       37500000
375100         END-IF                                                   37510000
375200     ELSE                                                         37520000
375300         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       37530000
375400         ASC-HIGHEST-BLOCK-WRITTEN + 1                            37540000
375500         PERFORM 5110-WRITE-ASC-LISTQ                             37550000
375600         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   37560000
375700     END-IF.                                                      37570000
375800                                                                  37580000
375900     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      37590000
376000                                   TO TRUE.                       37600000
376100                                                                  37610000
376200/                                                                 37620000
376300*----------------------------------------------------------------*37630000
376400*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *37640000
376500*  SPECIFIC COMMAREA.                                            *37650000
376600*----------------------------------------------------------------*37660000
376700 5105-REWRITE-ASC-LISTQ.                                          37670000
376800                                                                  37680000
376900     EXEC CICS                                                    37690000
377000         WRITEQ TS                                                37700000
377100             QUEUE (ASC-LIST-QUEUE-NAME)                          37710000
377200             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               37720000
377300             ITEM  (PV-BLOCK-NUMBER)                              37730000
377400             REWRITE                                              37740000
377500             RESP  (PV-CICS-RESP)                                 37750000
377600     END-EXEC.                                                    37760000
377700                                                                  37770000
377800     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           37780000
377900         CONTINUE                                                 37790000
378000     ELSE                                                         37800000
378100         SET DP013-CICS-ABEND      TO TRUE                        37810000
378200         SET DP013-NO-ROLLBACK     TO TRUE                        37820000
378300         MOVE '5105-REWRITE-ASC-LISTQ'                            37830000
378400                                   TO DP013-PARAGRAPH             37840000
378500         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     37850000
378600                                   TO DP013-MESSAGE-TEXT(1)       37860000
378700         PERFORM DP013-0000-PROCESS-ABEND                         37870000
378800     END-IF.                                                      37880000
378900                                                                  37890000
379000/                                                                 37900000
379100*----------------------------------------------------------------*37910000
379200*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *37920000
379300*  SPECIFIC COMMAREA.                                            *37930000
379400*----------------------------------------------------------------*37940000
379500 5110-WRITE-ASC-LISTQ.                                            37950000
379600                                                                  37960000
379700     EXEC CICS                                                    37970000
379800         WRITEQ TS                                                37980000
379900             QUEUE (ASC-LIST-QUEUE-NAME)                          37990000
380000             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               38000000
380100             ITEM  (PV-BLOCK-NUMBER)                              38010000
380200             RESP  (PV-CICS-RESP)                                 38020000
380300     END-EXEC.                                                    38030000
380400                                                                  38040000
380500     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      38050000
380600         SET DP013-CICS-ABEND      TO TRUE                        38060000
380700         SET DP013-NO-ROLLBACK     TO TRUE                        38070000
380800         MOVE '5110-WRITE-ASC-LISTQ'                              38080000
380900                                   TO DP013-PARAGRAPH             38090000
381000         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           38100000
381100                                   TO DP013-MESSAGE-TEXT(1)       38110000
381200         PERFORM DP013-0000-PROCESS-ABEND                         38120000
381300     END-IF.                                                      38130000
381400                                                                  38140000
381500/                                                                 38150000
381600*----------------------------------------------------------------*38160000
381700* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *38170000
381800* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *38180000
381900*----------------------------------------------------------------*38190000
382000                                                                  38200000
382100 5200-FILL-SEL-QUEUE-RECORD.                                      38210000
382200                                                                  38220000
382300     PERFORM 6112-READ-LIST-QUEUE.                                38230000
382400                                                                  38240000
382500* SINCE IT IS NOT REQUIRED TO SELECT A LINE TO GOT THE PACK       38250000
382600* DETAIL LIST, THE PROGRAM WILL "PRETEND" THAT A LINE WAS         38260000
382700* SELECTED TO SAVE ON CODE.                                       38270000
382800                                                                  38280000
382900     IF (DP020-FK-LOCAL-FUNC-05 (DP020-SRC-AID)  OR               38290000
383000         DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)) AND              38300000
383100         ASC-ADD-LINE                                             38310000
383200           SET LQW-IDX            TO +1                           38320000
383300           MOVE ASC-DRIVER-PACK-ID                                38330000
383400                                  TO LQW-PACK-ID (LQW-IDX)        38340000
383500           SET LQW-SELECT (LQW-IDX)                               38350000
383600                                  TO TRUE.                        38360000
383700                                                                  38370000
383800     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        38380000
383900        PERFORM                                                   38390000
384000         VARYING LQW-IDX                                          38400000
384100         FROM 1 BY 1                                              38410000
384200         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            38420000
384300           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          38430000
384400                                                                  38440000
384500            IF LQW-SELECT (LQW-IDX)                               38450000
384600               ADD +1 TO RC800-NUMBER-OF-SELECTED-ITEMS           38460000
384700               MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)                38470000
384800                                  TO RC801-ITEM (RC801-IDX)       38480000
384900               MOVE SPACE         TO RC801-ACTION-SW (RC801-IDX)  38490000
385000               MOVE ASC-OPR-ID    TO RC800-OPER-UNIT-ID           38500000
385100               MOVE ASC-FACT      TO RC800-FACILITY-ID            38510000
385200               MOVE ASC-PO-NBR    TO RC800-REC-NBR-N              38520000
385300               MOVE ASC-REC-SEQ-NBR                               38530000
385400                                  TO RC800-REC-SEQ-NBR-N          38540000
385500               MOVE LQW-PACK-ID (LQW-IDX)                         38550000
385600                                  TO RC801-PACK-ID (RC801-IDX)    38560000
385700               MOVE LQW-PACK-DESC (LQW-IDX)                       38570000
385800                                  TO RC801-PACK-DESC              38580000
385900                                                   (RC801-IDX)    38590000
386000                                                                  38600000
386100               IF DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID) AND      38610000
386200                  ASC-ADD-LINE                                    38620000
386300                  PERFORM 4100-PREPARE-CURSOR                     38630000
386400                  PERFORM 5214-RETRIEVE-DRIVER-LINE               38640000
386500                  MOVE RECITM-ORD-LNE-NBR                         38650000
386600                                  TO RC801-REC-LNE-NBR            38660000
386700                                                   (RC801-IDX)    38670000
386800               ELSE                                               38680000
386900                  MOVE LQW-LINE-NUMBER (LQW-IDX)                  38690000
387000                                  TO RC801-REC-LNE-NBR            38700000
387100                                                   (RC801-IDX)    38710000
387200               END-IF                                             38720000
387300               SET RC801-IDX UP BY 1                              38730000
387400               IF  RC801-IDX > RC801-MAX-ITEMS                    38740000
387500                   PERFORM 5205-WRITE-SEL-QUEUE                   38750000
387600                   ADD +1        TO RC800-NUMBER-OF-TS-ITEMS      38760000
387700                   INITIALIZE RC801-SELECTED-ITEM-ARRAY           38770000
387800                   SET RC801-IDX TO 1                             38780000
387900               END-IF                                             38790000
388000           END-IF                                                 38800000
388100         END-PERFORM                                              38810000
388200     END-IF.                                                      38820000
388300                                                                  38830000
388400     MOVE PV-ITEM TO PV-SAVE-ITEM.                                38840000
388500     PERFORM 6111-WRITE-LIST-QUEUE.                               38850000
388600                                                                  38860000
388700*----------------------------------------------------------------*38870000
388800*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *38880000
388900*----------------------------------------------------------------*38890000
389000                                                                  38900000
389100 5205-WRITE-SEL-QUEUE.                                            38910000
389200                                                                  38920000
389300     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            38930000
389400                                   TO RC801-SELECTED-ITEMS.       38940000
389500                                                                  38950000
389600     EXEC CICS                                                    38960000
389700          WRITEQ TS                                               38970000
389800              QUEUE (ASC-SEL-QUEUE-NAME-OUT)                      38980000
389900              FROM  (RC801-PREPACK-SELECT-RECORD)                 38990000
390000              ITEM  (PV-SEL-QUEUE-ITEM)                           39000000
390100              RESP  (PV-CICS-RESP)                                39010000
390200     END-EXEC.                                                    39020000
390300                                                                  39030000
390400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          39040000
390500         CONTINUE                                                 39050000
390600     ELSE                                                         39060000
390700         SET DP013-CICS-ABEND      TO TRUE                        39070000
390800         SET DP013-NO-ROLLBACK     TO TRUE                        39080000
390900         MOVE '5205-WRITE-SEL-QUEUE'                              39090000
391000                                   TO DP013-PARAGRAPH             39100000
391100         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          39110000
391200                                   TO DP013-MESSAGE-TEXT(1)       39120000
391300         PERFORM DP013-0000-PROCESS-ABEND                         39130000
391400     END-IF.                                                      39140000
391500                                                                  39150000
391600                                                                  39160000
391700*----------------------------------------------------------------*39170000
391800*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *39180000
391900*----------------------------------------------------------------*39190000
392000 5206-WRITE-SEL-QUEUE.                                            39200000
392100                                                                  39210000
392200     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            39220000
392300                                   TO RC801-SELECTED-ITEMS.       39230000
392400                                                                  39240000
392500     EXEC CICS                                                    39250000
392600          WRITEQ TS                                               39260000
392700              QUEUE (ASC-SEL-QUEUE-NAME-OUT)                      39270000
392800              FROM  (PC016-TS-SEL-REC)                            39280000
392900              ITEM  (PV-SEL-QUEUE-ITEM)                           39290000
393000              RESP  (PV-CICS-RESP)                                39300000
393100     END-EXEC.                                                    39310000
393200                                                                  39320000
393300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          39330000
393400         CONTINUE                                                 39340000
393500     ELSE                                                         39350000
393600         SET DP013-CICS-ABEND      TO TRUE                        39360000
393700         SET DP013-NO-ROLLBACK     TO TRUE                        39370000
393800         MOVE '5206-WRITE-SEL-QUEUE'                              39380000
393900                                   TO DP013-PARAGRAPH             39390000
394000         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          39400000
394100                                   TO DP013-MESSAGE-TEXT(1)       39410000
394200         PERFORM DP013-0000-PROCESS-ABEND                         39420000
394300     END-IF.                                                      39430000
394400                                                                  39440000
394900 5210-FILL-SEL-QUEUE-RECORD.                                      39490000
395000                                                                  39500000
395100     PERFORM 6112-READ-LIST-QUEUE.                                39510000
395200                                                                  39520000
395300     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       39530000
395400         PERFORM                                                  39540000
395500         VARYING LQW-IDX                                          39550000
395600         FROM 1 BY 1                                              39560000
395700         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            39570000
395800           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          39580000
395900                                                                  39590000
396000             IF  (LQW-SELECT (LQW-IDX))                           39600000
396100                 ADD +1 TO PC000-NUMBER-OF-SELECTED-ITEMS         39610000
396200                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              39620000
396300                                    TO PC016-ITEM (PC016-IDX)     39630000
396400                 MOVE SPACE         TO PC016-ACTION-SW (PC016-IDX)39640000
396500                 MOVE ASC-OPR-ID    TO PC016-OPER-UNT-ID          39650000
396600                                                       (PC016-IDX)39660000
396700                 MOVE ASC-FACT      TO PC016-FCLTY-ID             39670000
396800                                                       (PC016-IDX)39680000
396900                 MOVE ASC-PO-NBR    TO PC016-PO-NBR-N  (PC016-IDX)39690000
397000                 MOVE ASC-REC-SEQ-NBR                             39700000
397100                                    TO PC016-REC-SEQ-NBR-N        39710000
397200                                                       (PC016-IDX)39720000
397300                 MOVE LQW-PACK-ID (LQW-IDX)                       39730000
397400                                     TO DK-PACK-ID                39740000
397500                 MOVE LQW-LINE-NUMBER (LQW-IDX)                   39750000
397600                                    TO PC016-LINE-NBR-N(PC016-IDX)39760000
397700                 MOVE PC-Y          TO PC016-MRKG-APRON-REQ-IND   39770000
397800                                                       (PC016-IDX)39780000
397900                                                                  39790000
398000                 SET PC016-IDX UP BY 1                            39800000
398100                 IF  PC016-IDX > PC016-MAX-ITEMS                  39810000
398200                     PERFORM 5206-WRITE-SEL-QUEUE                 39820000
398300                     ADD +1        TO PC000-NUMBER-OF-TS-ITEMS    39830000
398400                     INITIALIZE PC016-SELECTED-ITEM-ARRAY         39840000
398500                     SET PC016-IDX TO 1                           39850000
398600                 END-IF                                           39860000
398700             END-IF                                               39870000
398800         END-PERFORM                                              39880000
398900     END-IF.                                                      39890000
399000                                                                  39900000
399100     MOVE PV-ITEM TO PV-SAVE-ITEM.                                39910000
399200     PERFORM 6111-WRITE-LIST-QUEUE.                               39920000
399300                                                                  39930000
399400                                                                  39940000
399500*----------------------------------------------------------------*39950000
399600*    RETRIEVE THE DRIVER LINE INFORMATION                        *39960000
399700*----------------------------------------------------------------*39970000
399800 5214-RETRIEVE-DRIVER-LINE.                                       39980000
399900                                                                  39990000
400000     EXEC SQL                                                     40000000
400100           SELECT DISTINCT                                        40010000
400200                  ORD_NBR                                         40020000
400300                , ORD_LNE_NBR                                     40030000
400400           INTO                                                   40040000
400500                 :RECITM-ORD-NBR                                  40050000
400600                ,:RECITM-ORD-LNE-NBR                              40060000
400700           FROM                                                   40070000
400800                  TRECITM                                         40080000
400900           WHERE                                                  40090000
401000                  ORD_NBR           = :DK-ORD-NBR                 40100000
401100             AND  REC_SEQ_NBR       = :DK-REC-SEQ-NBR             40110000
401200             AND  VER_STATUS_CDE    = 'A'                         40120000
401300             AND  OPER_UNT_ID       = :DK-OPER-UNT-ID             40130000
401400             AND  FCLTY_ID          = :DK-FACT                    40140000
401500             AND  PREPK_ID          = :DK-PACK-ID                 40150000
401600             AND  PREPK_DRV_LNE_CDE = 'A'                         40160000
401700     END-EXEC.                                                    40170000
401800                                                                  40180000
401900     EVALUATE TRUE                                                40190000
402000         WHEN SQLCODE = +0                                        40200000
402100         WHEN SQLCODE = +100                                      40210000
402200              CONTINUE                                            40220000
402300          WHEN SQLCODE = -904                                     40230000
402400          WHEN SQLCODE = -911                                     40240000
402500          WHEN SQLCODE = -913                                     40250000
402600               PERFORM 9900-SOFT-ABORT                            40260000
402700                                                                  40270000
402800         WHEN SQLWARN0 NOT = SPACES                               40280000
402900         WHEN SQLCODE < +0                                        40290000
403000         WHEN SQLCODE > +0                                        40300000
403100              MOVE '5412-RETRIEVE-DRIVER-LINE'                    40310000
403200                               TO DP013-PARAGRAPH                 40320000
403300              MOVE 'UNSUCCESSFUL SELECT ON PO ITEM'               40330000
403400                               TO DP013-MESSAGE-TEXT (1)          40340000
403500              MOVE SQLCA       TO DP013-SQLCA                     40350000
403600              MOVE 'TRECITM '  TO DP013-DB2-TABLE-NAME (1)        40360000
403700              SET DP013-DB2-ABEND                                 40370000
403800                  DP013-XCTL-DISPLAY-RESTART                      40380000
403900                               TO TRUE                            40390000
404000              PERFORM DP013-0000-PROCESS-ABEND                    40400000
404100     END-EVALUATE.                                                40410000
404200                                                                  40420000
404300                                                                  40430000
404400                                                                  40440000
404500/                                                                 40450000
404600*----------------------------------------------------------------*40460000
404700*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *40470000
404800*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *40480000
404900*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *40490000
405000*  THE USER.                                                     *40500000
405100*----------------------------------------------------------------*40510000
405200                                                                  40520000
405300 6000-REFRESH-PANEL-FROM-TEMP.                                    40530000
405400                                                                  40540000
405500     IF (ASC-UPDATE-TSQ                                           40550000
405600     OR  ASC-UPDATE-TSQ2)                                         40560000
405700         MOVE ZERO                 TO PV-SAVE-ITEM                40570000
405800                                      PV-SEL-QUEUE-ITEM           40580000
405900         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        40590000
406000                                   TO PV-HOLD-SELECTED-ITEMS      40600000
406100         IF  ASC-UPDATE-TSQ                                       40610000
406200             PERFORM 6100-UPDATE-TSQ                              40620000
406300                 UNTIL PV-ITEMS-PROCESSED >                       40630000
406400                                     ASC-NUMBER-OF-SELECTED-ITEMS 40640000
406500         ELSE                                                     40650000
406600             PERFORM 6101-UPDATE-TSQ2                             40660000
406700                 UNTIL PV-ITEMS-PROCESSED >                       40670000
406800                                     ASC-NUMBER-OF-SELECTED-ITEMS 40680000
406900         END-IF                                                   40690000
407000                                                                  40700000
407100         PERFORM 6010-DELETE-SEL-QUEUE                            40710000
407200         SET ASC-NO-TSQ-UPDATE TO TRUE                            40720000
407300         INITIALIZE ASC-BLOCK-ENTRIES (1)                         40730000
407400                    ASC-BLOCK-ENTRIES (2)                         40740000
407500                                                                  40750000
407600         DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                 40760000
407700                GIVING PV-BLOCK-NUMBER                            40770000
407800                REMAINDER PV-REMAINDER                            40780000
407900         IF  PV-REMAINDER > ZERO                                  40790000
408000             ADD +1     TO PV-BLOCK-NUMBER                        40800000
408100         END-IF                                                   40810000
408200         MOVE +1        TO ASC-BLK-SUB                            40820000
408300         PERFORM 4410-READ-TEMP-STORAGE                           40830000
408400         ADD +1         TO ASC-BLK-SUB                            40840000
408500                           PV-BLOCK-NUMBER                        40850000
408600         PERFORM 4410-READ-TEMP-STORAGE                           40860000
408700     END-IF.                                                      40870000
408800/                                                                 40880000
408900*----------------------------------------------------------------*40890000
409000*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *40900000
409100*----------------------------------------------------------------*40910000
409200 6010-DELETE-SEL-QUEUE.                                           40920000
409300                                                                  40930000
409400     EXEC CICS                                                    40940000
409500         DELETEQ TS                                               40950000
409600             QUEUE (ASC-SEL-QUEUE-NAME-OUT)                       40960000
409700             RESP  (PV-CICS-RESP)                                 40970000
409800     END-EXEC.                                                    40980000
409900                                                                  40990000
410000     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      41000000
410100         (PV-CICS-RESP = DFHRESP(QIDERR)))                        41010000
410200         CONTINUE                                                 41020000
410300     ELSE                                                         41030000
410400         SET DP013-CICS-ABEND      TO TRUE                        41040000
410500         SET DP013-NO-ROLLBACK     TO TRUE                        41050000
410600         MOVE '6010-DELETE-SEL-QUEUE'                             41060000
410700                                   TO DP013-PARAGRAPH             41070000
410800         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         41080000
410900                                   TO DP013-MESSAGE-TEXT (1)      41090000
411000         PERFORM DP013-0000-PROCESS-ABEND                         41100000
411100     END-IF.                                                      41110000
411200/                                                                 41120000
411300*----------------------------------------------------------------*41130000
411400*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *41140000
411500*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *41150000
411600*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *41160000
411700*    THE TEMP QUEUE.                                             *41170000
411800*----------------------------------------------------------------*41180000
411900                                                                  41190000
412000 6100-UPDATE-TSQ.                                                 41200000
412100                                                                  41210000
412200     ADD 1                         TO PV-SEL-QUEUE-ITEM.          41220000
412300     PERFORM 6105-READ-SEL-QUEUE.                                 41230000
412400                                                                  41240000
412500     PERFORM                                                      41250000
412600         VARYING RC801-IDX                                        41260000
412700         FROM 1 BY 1                                              41270000
412800         UNTIL ((PV-ITEMS-PROCESSED >                             41280000
412900                              PV-HOLD-SELECTED-ITEMS)             41290000
413000         OR (RC801-IDX GREATER THAN RC801-MAX-ITEMS))             41300000
413100         IF  RC801-ACTION-SW (RC801-IDX) > SPACE                  41310000
413200             PERFORM 6110-PROCESS-ITEMS                           41320000
413300         END-IF                                                   41330000
413400         ADD +1                    TO PV-ITEMS-PROCESSED          41340000
413500     END-PERFORM.                                                 41350000
413600                                                                  41360000
413700     PERFORM 6111-WRITE-LIST-QUEUE.                               41370000
413800/                                                                 41380000
413900*----------------------------------------------------------------*41390000
414000*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *41400000
414100*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *41410000
414200*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *41420000
414300*    THE TEMP QUEUE.                                             *41430000
414400*----------------------------------------------------------------*41440000
414500                                                                  41450000
414600 6101-UPDATE-TSQ2.                                                41460000
414700                                                                  41470000
414800     ADD 1                         TO PV-SEL-QUEUE-ITEM.          41480000
414900     PERFORM 6106-READ-SEL-QUEUE2.                                41490000
415000                                                                  41500000
415100     PERFORM                                                      41510000
415200         VARYING PC016-IDX                                        41520000
415300         FROM 1 BY 1                                              41530000
415400         UNTIL ((PV-ITEMS-PROCESSED >                             41540000
415500                              PV-HOLD-SELECTED-ITEMS)             41550000
415600         OR (PC016-IDX GREATER THAN PC016-MAX-ITEMS))             41560000
415700             IF  PC016-ACTION-SW (RC801-IDX) > SPACE              41570000
415800                 PERFORM 6109-PROCESS-ITEMS2                      41580000
415900             END-IF                                               41590000
416000         ADD +1                    TO PV-ITEMS-PROCESSED          41600000
416100     END-PERFORM.                                                 41610000
416200                                                                  41620000
416300     PERFORM 6111-WRITE-LIST-QUEUE.                               41630000
416400/                                                                 41640000
416500*----------------------------------------------------------------*41650000
416600*    READ THE LIST QUEUE RECORD.                                 *41660000
416700*----------------------------------------------------------------*41670000
416800                                                                  41680000
416900 6105-READ-SEL-QUEUE.                                             41690000
417000                                                                  41700000
417100     EXEC CICS                                                    41710000
417200          READQ TS                                                41720000
417300              QUEUE (ASC-SEL-QUEUE-NAME-OUT)                      41730000
417400              INTO  (RC801-PREPACK-SELECT-RECORD)                 41740000
417500              ITEM  (PV-SEL-QUEUE-ITEM)                           41750000
417600              RESP  (PV-CICS-RESP)                                41760000
417700     END-EXEC.                                                    41770000
417800                                                                  41780000
417900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          41790000
418000         CONTINUE                                                 41800000
418100     ELSE                                                         41810000
418200         SET DP013-CICS-ABEND      TO TRUE                        41820000
418300         SET DP013-NO-ROLLBACK     TO TRUE                        41830000
418400         MOVE '6105-READ-SEL-QUEUE'                               41840000
418500                                   TO DP013-PARAGRAPH             41850000
418600         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           41860000
418700                                   TO DP013-MESSAGE-TEXT(1)       41870000
418800         PERFORM DP013-0000-PROCESS-ABEND                         41880000
418900     END-IF.                                                      41890000
419000                                                                  41900000
419100/                                                                 41910000
419200*----------------------------------------------------------------*41920000
419300*    READ THE LIST QUEUE RECORD.                                 *41930000
419400*----------------------------------------------------------------*41940000
419500                                                                  41950000
419600 6106-READ-SEL-QUEUE2.                                            41960000
419700                                                                  41970000
419800     EXEC CICS                                                    41980000
419900          READQ TS                                                41990000
420000              QUEUE (ASC-SEL-QUEUE-NAME-OUT)                      42000000
420100              INTO  (PC016-TS-SEL-REC)                            42010000
420200              ITEM  (PV-SEL-QUEUE-ITEM)                           42020000
420300              RESP  (PV-CICS-RESP)                                42030000
420400     END-EXEC.                                                    42040000
420500                                                                  42050000
420600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          42060000
420700         CONTINUE                                                 42070000
420800     ELSE                                                         42080000
420900         SET DP013-CICS-ABEND      TO TRUE                        42090000
421000         SET DP013-NO-ROLLBACK     TO TRUE                        42100000
421100         MOVE '6106-READ-SEL-QUEUE2'                              42110000
421200                                   TO DP013-PARAGRAPH             42120000
421300         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           42130000
421400                                   TO DP013-MESSAGE-TEXT(1)       42140000
421500         PERFORM DP013-0000-PROCESS-ABEND                         42150000
421600     END-IF.                                                      42160000
421700/                                                                 42170000
421800*----------------------------------------------------------------*42180000
421900*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*42190000
422000*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*42200000
422100*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *42210000
422200*----------------------------------------------------------------*42220000
422300                                                                  42230000
422400 6109-PROCESS-ITEMS2.                                             42240000
422500                                                                  42250000
422600     COMPUTE PV-ITEM = 1 + ((PC016-ITEM (PC016-IDX) - 1)          42260000
422700                     / PC-ITEMS-PER-PANEL).                       42270000
422800                                                                  42280000
422900     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           42290000
423000         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          42300000
423100             PERFORM 6111-WRITE-LIST-QUEUE                        42310000
423200         END-IF                                                   42320000
423300         MOVE PV-ITEM              TO PV-SAVE-ITEM                42330000
423400                                                                  42340000
423500         PERFORM 6112-READ-LIST-QUEUE                             42350000
423600         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               42360000
423700             CONTINUE                                             42370000
423800         END-IF                                                   42380000
423900     END-IF.                                                      42390000
424000                                                                  42400000
424100     COMPUTE PV-SUB = (PC016-ITEM (PC016-IDX)                     42410000
424200                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              42420000
424300                                                                  42430000
424400     SET LQW-DESELECT (PV-SUB)     TO TRUE.                       42440000
424500     MOVE LQW-SELECTED-SW (PV-SUB) TO LQW-TEMP-SELECTED-SW        42450000
424600                                     (PV-SUB).                    42460000
424700     EVALUATE TRUE                                                42470000
424800         WHEN PC016-INQ (PC016-IDX)                               42480000
424900              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             42490000
425000                                                                  42500000
425100         WHEN PC016-UPD (PC016-IDX)                               42510000
425200              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             42520000
425300                                                                  42530000
425400         WHEN PC016-DEL (PC016-IDX)                               42540000
425500              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             42550000
425600                                                                  42560000
425700         WHEN PC016-ERR (PC016-IDX)                               42570000
425800              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             42580000
425900     END-EVALUATE.                                                42590000
426000                                                                  42600000
426100     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                42610000
426200     SUBTRACT 1 FROM ASC-PACKS-DISPLAYED.                         42620000
426300                                                                  42630000
426400/                                                                 42640000
426500*----------------------------------------------------------------*42650000
426600*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*42660000
426700*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*42670000
426800*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *42680000
426900*----------------------------------------------------------------*42690000
427000                                                                  42700000
427100 6110-PROCESS-ITEMS.                                              42710000
427200                                                                  42720000
427300     COMPUTE PV-ITEM = 1 + ((RC801-ITEM (RC801-IDX) - 1)          42730000
427400                     / PC-ITEMS-PER-PANEL).                       42740000
427500                                                                  42750000
427600     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           42760000
427700         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          42770000
427800             PERFORM 6111-WRITE-LIST-QUEUE                        42780000
427900         END-IF                                                   42790000
428000         MOVE PV-ITEM              TO PV-SAVE-ITEM                42800000
428100                                                                  42810000
428200         PERFORM 6112-READ-LIST-QUEUE                             42820000
428300         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               42830000
428400             CONTINUE                                             42840000
428500         END-IF                                                   42850000
428600     END-IF.                                                      42860000
428700                                                                  42870000
428800     COMPUTE PV-SUB = (RC801-ITEM (RC801-IDX)                     42880000
428900                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              42890000
429000                                                                  42900000
429100     SET LQW-DESELECT (PV-SUB)     TO TRUE.                       42910000
429200     MOVE LQW-SELECTED-SW (PV-SUB) TO LQW-TEMP-SELECTED-SW        42920000
429300                                     (PV-SUB).                    42930000
429400     EVALUATE TRUE                                                42940000
429500         WHEN RC801-INQ (RC801-IDX)                               42950000
429600              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             42960000
429700                                                                  42970000
429800         WHEN RC801-UPD (RC801-IDX)                               42980000
429900              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             42990000
430000              MOVE RC801-PACK-ID (RC801-IDX)                      43000000
430100                                TO LQW-PACK-ID  (PV-SUB)          43010000
430200              MOVE RC801-PACK-DESC (RC801-IDX)                    43020000
430300                                TO LQW-PACK-DESC (PV-SUB)         43030000
430400                                                                  43040000
430500         WHEN RC801-DEL (RC801-IDX)                               43050000
430600              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             43060000
430700                                                                  43070000
430800         WHEN RC801-ERR (RC801-IDX)                               43080000
430900              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             43090000
431000     END-EVALUATE.                                                43100000
431100                                                                  43110000
431200     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                43120000
431300     SUBTRACT 1 FROM ASC-PACKS-DISPLAYED.                         43130000
431400                                                                  43140000
431500                                                                  43150000
431600/                                                                 43160000
431700*----------------------------------------------------------------*43170000
431800*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *43180000
431900*----------------------------------------------------------------*43190000
432000                                                                  43200000
432100 6111-WRITE-LIST-QUEUE.                                           43210000
432200                                                                  43220000
432300     EXEC CICS                                                    43230000
432400         WRITEQ TS                                                43240000
432500             QUEUE (ASC-LIST-QUEUE-NAME)                          43250000
432600             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     43260000
432700             ITEM  (PV-SAVE-ITEM)                                 43270000
432800             REWRITE                                              43280000
432900             RESP  (PV-CICS-RESP)                                 43290000
433000     END-EXEC.                                                    43300000
433100                                                                  43310000
433200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          43320000
433300         CONTINUE                                                 43330000
433400     ELSE                                                         43340000
433500         SET DP013-CICS-ABEND      TO TRUE                        43350000
433600         SET DP013-NO-ROLLBACK     TO TRUE                        43360000
433700         MOVE '6111-WRITE-LIST-QUEUE'                             43370000
433800                                   TO DP013-PARAGRAPH             43380000
433900         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  43390000
434000                                   TO DP013-MESSAGE-TEXT(1)       43400000
434100         PERFORM DP013-0000-PROCESS-ABEND                         43410000
434200     END-IF.                                                      43420000
434300                                                                  43430000
434400/                                                                 43440000
434500*----------------------------------------------------------------*43450000
434600*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*43460000
434700*----------------------------------------------------------------*43470000
434800                                                                  43480000
434900 6112-READ-LIST-QUEUE.                                            43490000
435000                                                                  43500000
435100     EXEC CICS                                                    43510000
435200         READQ TS                                                 43520000
435300             QUEUE (ASC-LIST-QUEUE-NAME)                          43530000
435400             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     43540000
435500             ITEM  (PV-ITEM)                                      43550000
435600             RESP  (PV-CICS-RESP)                                 43560000
435700     END-EXEC.                                                    43570000
435800                                                                  43580000
435900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          43590000
436000         CONTINUE                                                 43600000
436100     ELSE                                                         43610000
436200         SET DP013-CICS-ABEND      TO TRUE                        43620000
436300         SET DP013-NO-ROLLBACK     TO TRUE                        43630000
436400         MOVE '6112-READ-LIST-QUEUE'                              43640000
436500                                   TO DP013-PARAGRAPH             43650000
436600         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    43660000
436700                                   TO DP013-MESSAGE-TEXT(1)       43670000
436800         PERFORM DP013-0000-PROCESS-ABEND                         43680000
436900     END-IF.                                                      43690000
437000                                                                  43700000
437100/                                                                 43710000
437200*----------------------------------------------------------------*43720000
437300* DELETE THE LIST QUEUE WHEN PREV-SEL OR NEXT-SEL WAS ENTERED.   *43730000
437400*----------------------------------------------------------------*43740000
437500 6200-DEL-LIST-QUEUE.                                             43750000
437600                                                                  43760000
437700     EXEC CICS                                                    43770000
437800         DELETEQ TS                                               43780000
437900             QUEUE (ASC-LIST-QUEUE-NAME)                          43790000
438000             RESP  (PV-CICS-RESP)                                 43800000
438100     END-EXEC.                                                    43810000
438200                                                                  43820000
438300     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      43830000
438400        (PV-CICS-RESP = DFHRESP(QIDERR)))                         43840000
438500         CONTINUE                                                 43850000
438600     ELSE                                                         43860000
438700        SET DP013-CICS-ABEND       TO TRUE                        43870000
438800        SET DP013-NO-ROLLBACK      TO TRUE                        43880000
438900        MOVE '6200-DEL-LIST-QUEUE' TO DP013-PARAGRAPH             43890000
439000        MOVE 'ERROR TRYING TO DELETE LIST TS QUEUE'               43900000
439100                                   TO DP013-MESSAGE-TEXT (1)      43910000
439200        PERFORM DP013-0000-PROCESS-ABEND                          43920000
439300     END-IF.                                                      43930000
439400                                                                  43940000
439500/                                                                 43950000
439600*----------------------------------------------------------------*43960000
439700* LOAD THE COMMAREA INTO THE RC800 COMMAREA                      *43970000
439800*----------------------------------------------------------------*43980000
439900 7000-FORMAT-COMMAREA.                                            43990000
440000                                                                  44000000
440100     MOVE 1                      TO PV-BLOCK-NUMBER               44010000
440200                                                                  44020000
440300     MOVE ASC-OPR-ID             TO RC800-OPER-UNIT-ID            44030000
440400     MOVE ASC-FACT               TO RC800-FACILITY-ID.            44040000
440500     MOVE ASC-PO-NBR             TO RC800-REC-NBR-N.              44050000
440600     MOVE ASC-REC-SEQ-NBR        TO RC800-REC-SEQ-NBR-N.          44060000
440700     MOVE ASC-DRIVER-PACK-ID     TO RC800-PACK-ID.                44070000
440800                                                                  44080000
440900     PERFORM VARYING PV-SUB FROM 1 BY 1                           44090000
441000             UNTIL PV-SUB > PC-ITEMS-PER-PANEL                    44100000
441100         IF ASC-SELECTED-SW  (PV-BLOCK-NUMBER PV-SUB) = 'S'       44110000
441200            MOVE ASC-LINE-NUMBER       (PV-BLOCK-NUMBER PV-SUB)   44120000
441300                                 TO RC800-LINE-NBR-N              44130000
441400**-->       ** UPON THE 1ST HIT, END THE LOOP BY BUMPING UP PV-SUB44140000
441500            COMPUTE PV-SUB = PC-ITEMS-PER-PANEL + 1               44150000
441600         END-IF                                                   44160000
441700     END-PERFORM.                                                 44170000
441800                                                                  44180000
441900*---------------------------------------------------------------* 44190000
442000*-  ADD ALL LINES OF A PACK TO THE PACK.                       -* 44200000
442100*---------------------------------------------------------------* 44210000
442200 8000-ADD-PACK-RECITM.                                            44220000
442300                                                                  44230000
442400     PERFORM 8020-FETCH.                                          44240000
442500                                                                  44250000
442600     IF  ASC-ITEMS-LEFT-ON-DB                                     44260000
442700     IF SQLCODE = +0                                              44270000
442800                                                                  44280000
442900                                                                  44290000
443000        MOVE ASC-PO-NBR           TO RECITM-ORD-NBR               44300000
443100                                     DK-ORD-NBR                   44310000
443200        MOVE DK-LINE-NBR          TO RECITM-ORD-LNE-NBR           44320000
443300        MOVE ASC-OPR-ID           TO RECITM-OPER-UNT-ID           44330000
443400        MOVE ASC-FACT             TO RECITM-FCLTY-ID              44340000
443500        MOVE ASC-REC-SEQ-NBR      TO RECITM-REC-SEQ-NBR           44350000
443600                                     DK-REC-SEQ-NBR               44360000
443700                                                                  44370000
443800        PERFORM 2451-SELECT-ORIG-RECITM                           44380000
443900        IF RECITM-PREPK-ID = 99                                   44390000
444000           SET PS-PREV-PACK-UNTIED                                44400000
444100                                  TO TRUE                         44410000
444200        END-IF                                                    44420000
444300                                                                  44430000
444400        IF PS-NO-DUPLICATE                                        44440000
444500           MOVE PURITM-PO-PREPK-ID   TO RECITM-PREPK-ID           44450000
444600           MOVE PURITM-VER-NBR       TO RECITM-PO-VER-NBR         44460000
444700           MOVE PURITM-ITM-NBR       TO RECITM-ITM-NBR            44470000
444800           INITIALIZE PV-DB2-COUNT                                44480000
444900           MOVE 4                   TO DK-AGRMT-TYP-ID            44490000
445000           MOVE 1                   TO DK-TYP-CDE                 44500000
445100                                                                  44510000
445200           PERFORM 8003-CHECK-PO-SERVICE-INFO                     44520000
445300                                                                  44530000
445400           IF PV-DB2-COUNT > +0                                   44540000
445500              MOVE 'Y'               TO RECITM-PRE-TKT-IND        44550000
445600           ELSE                                                   44560000
445700              MOVE 'N'               TO RECITM-PRE-TKT-IND        44570000
445800           END-IF                                                 44580000
445900                                                                  44590000
446000           MOVE SPACES               TO RECITM-TKT-FMT-ID         44600000
446100           MOVE SPACES               TO RECITM-RTV-IND            44610000
446200           MOVE PC-STAT-CDE-IP       TO RECITM-STATUS-CDE         44620000
446300           MOVE +0                   TO RECITM-PKSL-ITM-QTY       44630000
446400           MOVE +0                   TO RECITM-DTL-CK-ITM-QTY     44640000
446500                                                                  44650000
446600* DETERMINE THE INNER PACK QTY                                    44660000
446710**GB 4/2/12       MOVE XL001-INNR-PACK-QTY TO                     44671099
446720**GB 4/2/12   RECITM-INNR-PACK-QTY                                44672099
446730             MOVE PURITM-INNR-PK-QTY  TO                          44673099
446740              RECITM-INNR-PACK-QTY                                44674099
446800                                                                  44680000
446900           IF ASC-ADD-PACK                                        44690000
447000              IF POPRPK-INPK-UNT-QTY > POPRPK-OTPK-UNT-QTY OR     44700000
447100                 POPRPK-OTPK-UNT-QTY = 0                          44710000
447200                 MOVE +1              TO RECITM-CASE-PACK-QTY     44720000
447300              ELSE                                                44730000
447400                 DIVIDE  POPRPK-OTPK-UNT-QTY BY                   44740000
447500                         POPRPK-INPK-UNT-QTY  GIVING              44750000
447600                                           RECITM-CASE-PACK-QTY   44760000
447700                 IF RECITM-CASE-PACK-QTY NOT > 0                  44770000
447800                    MOVE +1            TO RECITM-CASE-PACK-QTY    44780000
447900                 END-IF                                           44790000
448000              END-IF                                              44800000
448100           END-IF                                                 44810000
448200           MOVE ZERO                 TO RECITM-RTV-QTY            44820000
448300           MOVE ZERO                 TO RECITM-EXPTED-CART-CNT    44830000
448400           MOVE ZERO                 TO RECITM-ACTL-CART-CNT      44840000
448500           MOVE PURITM-UNT-COST-AMT  TO RECITM-UNT-COST-AMT       44850099
448501           MOVE PURITM-UNT-RTL-PR-AMT TO RECITM-UNT-RTL-AMT       44850199
448502           MOVE PURITM-GP-RTL-AMT    TO RECITM-GP-RTL-AMT         44850299
448503           MOVE PURITM-GP-QTY        TO RECITM-GP-QTY             44850399
448510                                                                  44851099
448600           MOVE SPACES               TO RECITM-COLOR-DESC         44860000
448700           MOVE SPACES               TO RECITM-SIZE-DESC          44870000
448800           MOVE SPACES               TO RECITM-VEND-STYL-NAME     44880000
448900           MOVE SPACES               TO RECITM-VEND-DESC          44890000
449000           MOVE SPACES               TO RECITM-PKSL-NBR           44900000
449100           MOVE ZERO                 TO RECITM-REC-INV-LNE-NBR    44910000
449200                                        RECITM-DMG-ITM-QTY        44920000
449300           MOVE PC-DEFAULT-TMST      TO RECITM-MKING-APRON-TMST   44930000
449400                                        RECITM-VERFYD-TMST        44940000
449500           MOVE ASC-DEPT-NBR         TO DK-DEPT-NBR               44950000
449600           MOVE ASC-OPR-ID           TO DK-OPER-UNT-ID            44960000
449700           MOVE ASC-FACT             TO DK-FACT                   44970000
449800           MOVE PURITM-PREPK-RATO-QTY                             44980000
449900                                     TO RECITM-PREPK-RATO-QTY     44990000
450000           MOVE ASC-ODD-PACK-UNITS   TO RECITM-PREPK-ODD-UNT-QTY  45000000
450100                                                                  45010000
450200           PERFORM 5014-GET-TICKET-TYPE                           45020000
450300                                                                  45030000
450400           MOVE ASC-TKT-DESC         TO DK-TICKET-DESC            45040000
450500                                                                  45050000
450600           PERFORM 5005-SELECT-TKT-FMT-ID                         45060000
450700           PERFORM 4100-PREPARE-CURSOR                            45070000
450800                                                                  45080000
450900           PERFORM 9007-SELECT-ORPHANS                            45090000
451000           IF SQLCODE = +0                                        45100000
451100              PERFORM 9006-UPDATE-RECITM                          45110000
451200           ELSE                                                   45120000
451300              IF SQLCODE = +100                                   45130000
451400                 PERFORM 9005-SELECT-INACTIVE                     45140000
451500                 IF SQLCODE = +100                                45150000
451600                    PERFORM 9010-INSERT-RECITM                    45160000
451700                 ELSE                                             45170000
451800                    PERFORM 9006-UPDATE-RECITM                    45180000
451900                 END-IF                                           45190000
452000              END-IF                                              45200000
452100           END-IF                                                 45210000
452200                                                                  45220000
452300           PERFORM 8005-LOAD-VALIDATION.                          45230000
452400                                                                  45240000
452500     IF  SQLCODE = +0  AND                                        45250000
452600         PS-NO-DUPLICATE                                          45260000
452700         PERFORM 5010-CHECK-PACK-BY-STORE                         45270000
452800         IF PV-PACK-BY-ST-IND = PC-Y                              45280000
452900            SET DP020-MSG-INFORMATIONAL                           45290000
453000                                 TO  TRUE                         45300000
453100            MOVE PC-TSYMSG-01293 TO DP020-MSG-NUMBER              45310000
453200         END-IF.                                                  45320000
457500                                                                  45750000
457600/                                                                 45760000
457700*----------------------------------------------------------------*45770000
457800*    CHECK TO SEE WHAT TYPES OF SERVICES THIS PO HAS             *45780000
457900*----------------------------------------------------------------*45790000
458000 8003-CHECK-PO-SERVICE-INFO.                                      45800000
458100                                                                  45810000
458200     EXEC SQL                                                     45820000
458300          SELECT COUNT(*)                                         45830000
458400            INTO :PV-DB2-COUNT                                    45840000
458500            FROM TPOAGMT                                          45850000
458600           WHERE PO_NBR         = :DK-ORD-NBR                     45860000
458700             AND AGRMT_TYP_ID   = :DK-AGRMT-TYP-ID                45870000
458800             AND VER_STATUS_CDE = 'A'                             45880000
458900             AND TYP_CDE        = :DK-TYP-CDE                     45890000
459000     END-EXEC.                                                    45900000
459100                                                                  45910000
459200     EVALUATE TRUE                                                45920000
459300         WHEN SQLCODE = +0                                        45930000
459400         WHEN SQLCODE = +100                                      45940000
459500              CONTINUE                                            45950000
459600                                                                  45960000
459700          WHEN SQLCODE = -904                                     45970000
459800          WHEN SQLCODE = -911                                     45980000
459900          WHEN SQLCODE = -913                                     45990000
460000               PERFORM 9900-SOFT-ABORT                            46000000
460100                                                                  46010000
460200         WHEN SQLWARN0 NOT = SPACES                               46020000
460300         WHEN SQLCODE < +0                                        46030000
460400         WHEN SQLCODE > +0                                        46040000
460500              MOVE '8003-CHECK-PO-SERVICE-INFO'                   46050000
460600                              TO DP013-PARAGRAPH                  46060000
460700              MOVE 'UNSUCCESSFUL SELECT PURCHASE AGREEMENT'       46070000
460800                              TO DP013-MESSAGE-TEXT (1)           46080000
460900              MOVE SQLCA      TO DP013-SQLCA                      46090000
461000              MOVE 'TPOAGMT ' TO DP013-DB2-TABLE-NAME (1)         46100000
461100              SET DP013-DB2-ABEND                                 46110000
461200                  DP013-XCTL-DISPLAY-RESTART                      46120000
461300                              TO TRUE                             46130000
461400              PERFORM DP013-0000-PROCESS-ABEND                    46140000
461500     END-EVALUATE.                                                46150000
461600                                                                  46160000
461700                                                                  46170000
461800*----------------------------------------------------------------*46180000
461900*    LOAD ALL LINES OF THE PACK ID INTO VALIDATION FIELDS        *46190000
462000*----------------------------------------------------------------*46200000
462100 8005-LOAD-VALIDATION.                                            46210000
462200                                                                  46220000
462300     MOVE DK-LINE-NBR            TO RC806-PKSL-LNE-NBR            46230000
462400                                             (PV-VALID-IDX).      46240000
462500                                                                  46250000
462600     IF RECITM-DTL-CK-ITM-QTY > 0                                 46260000
462700        MOVE RECITM-DTL-CK-ITM-QTY                                46270000
462800                                 TO RC806-RCVG-QTY(PV-VALID-IDX)  46280000
462900     ELSE                                                         46290000
463000        MOVE RECITM-PKSL-ITM-QTY TO RC806-RCVG-QTY (PV-VALID-IDX).46300000
463100                                                                  46310000
463200* INCASE WE ARE MAKING A LINE ACTIVE FROM INACTIVE STATUS, THERE  46320000
463300* MAY BE SOME OTR TO WORK WITH ALREADY                            46330000
463400                                                                  46340000
463500*      GET OPEN TO RECEIVE TOTALS                                 46350000
463600     MOVE DK-LINE-NBR            TO DP277-SEARCH-NBR.             46360000
463700     PERFORM 4210-SEARCH-OTR.                                     46370000
463800     MOVE DP277-OTR-OUT          TO RC806-UNIT-QTY (PV-VALID-IDX).46380000
463900                                                                  46390000
464000     MOVE RECITM-PREPK-RATO-QTY  TO RC806-RC-RATIO (PV-VALID-IDX) 46400000
464100                                    RC806-PO-RATIO(PV-VALID-IDX). 46410000
464200                                                                  46420000
464300     ADD  +1                     TO RC806-NBR-OF-LINES            46430000
464400                                    PV-VALID-IDX.                 46440000
464500                                                                  46450099
465000 8010-OPEN-CURSOR.                                                46500000
465100                                                                  46510000
465200     EXEC SQL                                                     46520000
465300          OPEN ALL-LINES-CSR                                      46530000
465400     END-EXEC                                                     46540000
465500                                                                  46550000
465600     EVALUATE TRUE                                                46560000
465700         WHEN SQLCODE = +0                                        46570000
465800              CONTINUE                                            46580000
465900         WHEN SQLCODE = -904                                      46590000
466000         WHEN SQLCODE = -911                                      46600000
466100         WHEN SQLCODE = -913                                      46610000
466200              PERFORM 9900-SOFT-ABORT                             46620000
466300         WHEN SQLWARN0 NOT = SPACE                                46630000
466400         WHEN SQLCODE  NOT = +0                                   46640000
466500              MOVE '8010-OPEN-CURSOR'                             46650000
466600                                   TO DP013-PARAGRAPH             46660000
466700              MOVE 'OPEN CURSOR'                                  46670000
466800                                   TO DP013-MESSAGE-TEXT (1)      46680000
466900              MOVE SQLCA       TO DP013-SQLCA                     46690000
467000              MOVE 'TPURITM'   TO DP013-DB2-TABLE-NAME (1)        46700000
467100              SET DP013-DB2-ABEND                                 46710000
467200                                   TO TRUE                        46720000
467300              PERFORM DP013-0000-PROCESS-ABEND                    46730000
467400         END-EVALUATE.                                            46740000
467500                                                                  46750000
467600*----------------------------------------------------------------*46760000
467700*    FETCH A TPURITM ROW                                         *46770000
467800*----------------------------------------------------------------*46780000
467900                                                                  46790000
468000 8020-FETCH.                                                      46800000
468100                                                                  46810000
468200     EXEC SQL                                                     46820000
468300       FETCH ALL-LINES-CSR                                        46830000
468400         INTO :PURITM-PO-NBR                                      46840000
468500             ,:PURITM-VER-NBR                                     46850000
468600             ,:PURITM-SKU-SEQ-NBR                                 46860000
468800             ,:PURITM-ITM-NBR                                     46880000
468900             ,:PURITM-SKU-DESC                                    46890000
469000             ,:DK-LINE-NBR                                        46900000
469100             ,:PURITM-VEND-STYL-NAME                              46910000
469200             ,:PURITM-UNT-QTY                                     46920000
469300             ,:PURITM-UNT-RTL-PR-AMT                              46930000
469310             ,:PURITM-UNT-COST-AMT                                46931099
469400             ,:PURITM-GP-RTL-AMT                                  46940000
469500             ,:PURITM-GP-QTY                                      46950000
469600             ,:PURITM-PO-LNE-NBR                                  46960000
469700             ,:PURITM-PO-PREPK-ID                                 46970000
469800             ,:PURITM-PREPK-RATO-QTY                              46980000
469900             ,:PURITM-STATUS-CDE                                  46990000
470000             ,:POPRPK-PREPK-DESC                                  47000000
470100             ,:POPRPK-INPK-UNT-QTY                                47010000
470200             ,:POPRPK-OTPK-UNT-QTY                                47020000
470210             ,:PURITM-INNR-PK-QTY                                 47021099
470300     END-EXEC.                                                    47030000
470400                                                                  47040000
470500     EVALUATE TRUE                                                47050000
470600         WHEN SQLCODE = +0                                        47060000
470700              CONTINUE                                            47070000
470800         WHEN SQLCODE = +100                                      47080000
470900              SET ASC-NO-ITEMS-LEFT-ON-DB                         47090000
471000                                   TO TRUE                        47100000
471100         WHEN SQLCODE = -904                                      47110000
471200         WHEN SQLCODE = -911                                      47120000
471300         WHEN SQLCODE = -913                                      47130000
471400              PERFORM 9900-SOFT-ABORT                             47140000
471500                                                                  47150000
471600         WHEN SQLWARN0 NOT = SPACE                                47160000
471700         WHEN SQLCODE < +0                                        47170000
471800         WHEN SQLCODE > +0                                        47180000
471900              MOVE '8020-FETCH'    TO DP013-PARAGRAPH             47190000
472000              MOVE 'FETCH TPURITM CURSOR'                         47200000
472100                                   TO DP013-MESSAGE-TEXT (1)      47210000
472200              MOVE SQLCA           TO DP013-SQLCA                 47220000
472300              MOVE 'TPURITM'       TO DP013-DB2-TABLE-NAME (1)    47230000
472400              SET DP013-DB2-ABEND  TO TRUE                        47240000
472500              PERFORM DP013-0000-PROCESS-ABEND                    47250000
472600     END-EVALUATE.                                                47260000
472700                                                                  47270000
472800/                                                                 47280000
472900*----------------------------------------------------------------*47290000
473000* CLOSE THE PO CURSOR                                            *47300000
473100*----------------------------------------------------------------*47310000
473200                                                                  47320000
473300 8030-CLOSE-CURSOR.                                               47330000
473400                                                                  47340000
473500     EXEC SQL                                                     47350000
473600          CLOSE ALL-LINES-CSR                                     47360000
473700     END-EXEC.                                                    47370000
473800                                                                  47380000
473900     EVALUATE TRUE                                                47390000
474000         WHEN SQLCODE = +0                                        47400000
474100              CONTINUE                                            47410000
474200         WHEN SQLCODE = -904                                      47420000
474300         WHEN SQLCODE = -911                                      47430000
474400         WHEN SQLCODE = -913                                      47440000
474500              PERFORM 9900-SOFT-ABORT                             47450000
474600         WHEN SQLWARN0 NOT = SPACE                                47460000
474700         WHEN SQLCODE  NOT = +0                                   47470000
474800              MOVE '8030-CLOSE-CURSOR'                            47480000
474900                                   TO DP013-PARAGRAPH             47490000
475000              MOVE 'CLOSE CURSOR'  TO DP013-MESSAGE-TEXT (1)      47500000
475100              MOVE SQLCA           TO DP013-SQLCA                 47510000
475200              MOVE 'TPURITM'       TO DP013-DB2-TABLE-NAME (1)    47520000
475300              SET DP013-DB2-ABEND  TO TRUE                        47530000
475400              PERFORM DP013-0000-PROCESS-ABEND                    47540000
475500     END-EVALUATE.                                                47550000
475600                                                                  47560000
476100  5005-SELECT-TKT-FMT-ID.                                         47610000
476200      EXEC SQL                                                    47620000
476300          SELECT DISTINCT TKT_FMT_ID                              47630000
476400                INTO :TKTFMT-TKT-FMT-ID                           47640000
476500              FROM TTKTFMT                                        47650000
476600           WHERE                                                  47660000
476700              TKT_FMT_DESC = :DK-TICKET-DESC                      47670000
476800     END-EXEC                                                     47680000
476900                                                                  47690000
477000     EVALUATE TRUE                                                47700000
477100           WHEN SQLCODE = +0                                      47710000
477200             MOVE TKTFMT-TKT-FMT-ID  TO RECITM-TKT-FMT-ID         47720000
477300           WHEN SQLCODE = +100                                    47730000
477400                  MOVE SPACES    TO RECITM-TKT-FMT-ID             47740000
477500          WHEN SQLCODE = -904                                     47750000
477600          WHEN SQLCODE = -911                                     47760000
477700          WHEN SQLCODE = -913                                     47770000
477800               PERFORM 9900-SOFT-ABORT                            47780000
477900                                                                  47790000
478000             WHEN SQLWARN0 NOT = SPACES                           47800000
478100             WHEN SQLCODE  NOT = ZERO                             47810000
478200                  MOVE '4065-SELECT-TKT-FMT-ID'                   47820000
478300                                 TO DP013-PARAGRAPH               47830000
478400                  MOVE 'UNSUCCESSFUL SELECT OF TTKTFMG'           47840000
478500                                 TO DP013-MESSAGE-TEXT (1)        47850000
478600                  MOVE DK-TICKET-DESC                             47860000
478700                                 TO DP013-MESSAGE-TEXT (2)        47870000
478800                  MOVE SQLCA     TO DP013-SQLCA                   47880000
478900                  MOVE 'TTKTFMT' TO DP013-DB2-TABLE-NAME (1)      47890000
479000                  SET DP013-DB2-ABEND                             47900000
479100                      DP013-XCTL-DISPLAY-RESTART                  47910000
479200                                 TO TRUE                          47920000
479300                  PERFORM DP013-0000-PROCESS-ABEND                47930000
479400         END-EVALUATE.                                            47940000
479500                                                                  47950000
479600                                                                  47960000
479700*----------------------------------------------------------------*47970000
479800**   GET THE CURRENT ROW FOR PROCESSING.                         *47980000
479900*----------------------------------------------------------------*47990000
480000                                                                  48000000
480100 5010-CHECK-PACK-BY-STORE.                                        48010000
480200     MOVE ASC-PO-NBR              TO PV-PO-NBR.                   48020000
480300     MOVE ASC-REC-SEQ-NBR         TO PV-REC-SEQ-NBR.              48030000
480400                                                                  48040000
480500     EXEC SQL                                                     48050000
480600          SELECT PACK_BY_ST_IND                                   48060000
480700                ,PKGNG_CDE                                        48070000
480800            INTO :PV-PACK-BY-ST-IND                               48080000
480900                ,:RECEIV-PKGNG-CDE                                48090000
481000            FROM TRECEIV                                          48100000
481100           WHERE ORD_NBR         =  :PV-PO-NBR                    48110000
481200             AND REC_SEQ_NBR     =  :PV-REC-SEQ-NBR               48120000
481300             AND OPER_UNT_ID     =  :DK-OPER-UNT-ID               48130000
481400             AND FCLTY_ID        =  :DK-FACT                      48140000
481500             AND VER_STATUS_CDE  =  :PC-A                         48150000
481600     END-EXEC.                                                    48160000
481700                                                                  48170000
481800     EVALUATE TRUE                                                48180000
481900         WHEN SQLCODE = ZERO                                      48190000
482000              MOVE RECEIV-PKGNG-CDE    TO ASC-PKNG-CDE            48200000
482100          WHEN SQLCODE = -904                                     48210000
482200          WHEN SQLCODE = -911                                     48220000
482300          WHEN SQLCODE = -913                                     48230000
482400               PERFORM 9900-SOFT-ABORT                            48240000
482500                                                                  48250000
482600         WHEN SQLWARN0 NOT = SPACE                                48260000
482700         WHEN SQLCODE NOT = ZERO                                  48270000
482800              MOVE '2130-CHECK-PACK-BY-STORE'                     48280000
482900                               TO DP013-PARAGRAPH                 48290000
483000              MOVE 'SELECT TRECEIV'                               48300000
483100                               TO DP013-MESSAGE-TEXT (1)          48310000
483200              MOVE SQLCA       TO DP013-SQLCA                     48320000
483300              MOVE 'TRECEIV '  TO DP013-DB2-TABLE-NAME (1)        48330000
483400              SET DP013-DB2-ABEND                                 48340000
483500                               TO TRUE                            48350000
483600              PERFORM DP013-0000-PROCESS-ABEND                    48360000
483700     END-EVALUATE.                                                48370000
483800                                                                  48380000
485910   5014-GET-TICKET-TYPE.                                          48591000
485920                                                                  48592000
485930     PERFORM 5015-OPEN-TKTFMT-CURSOR                              48593000
485940     PERFORM 5016-FETCH-TKTFMT-CURSOR                             48594000
485960     PERFORM 5017-CLOSE-TKTFMT-CURSOR                             48596000
485970                                                                  48597000
485980     IF PS-PRETICKET                                              48598000
485990        MOVE PTKLNE-TKT-DESC        TO    ASC-TKT-DESC            48599000
485991     ELSE                                                         48599100
485992        MOVE PV-TEMP-TKT-TYPE       TO    ASC-TKT-DESC            48599200
485993     END-IF.                                                      48599300
485994                                                                  48599400
486000*----------------------------------------------------------------*48600000
486001*  CHANGES MADE FOR WR # 230ZZ ENDS HERE.                        *48600100
486010*----------------------------------------------------------------*48601000
486020*----------------------------------------------------------------*48602000
486100* OPEN THE CURSOR                                                *48610000
486200*----------------------------------------------------------------*48620000
486300 5015-OPEN-TKTFMT-CURSOR.                                         48630000
486400                                                                  48640000
486500         EXEC SQL                                                 48650000
486600             OPEN TKTFMT-CURSOR                                   48660000
486700         END-EXEC                                                 48670000
486800                                                                  48680000
486900         EVALUATE TRUE                                            48690000
487000             WHEN SQLCODE = ZERO                                  48700000
487100                 CONTINUE                                         48710000
487200             WHEN SQLCODE = -904                                  48720000
487300             WHEN SQLCODE = -913                                  48730000
487400             WHEN SQLCODE = -911                                  48740000
487500                 PERFORM 9900-SOFT-ABORT                          48750000
487600             WHEN SQLWARN0 NOT = SPACES                           48760000
487700             WHEN SQLCODE < ZERO                                  48770000
487800             WHEN SQLCODE > ZERO                                  48780000
487900                 MOVE '5015-OPEN-TKTYPE-CURSOR'                   48790000
488000                                   TO DP013-PARAGRAPH             48800000
488100                 MOVE 'OPEN TKTFMT CURSOR'                        48810000
488200                                   TO DP013-MESSAGE-TEXT (1)      48820000
488300                 MOVE SQLCA        TO DP013-SQLCA                 48830000
488400                 MOVE 'TPTKREQ '   TO DP013-DB2-TABLE-NAME (1)    48840000
488500                 MOVE 'TPTKLNE '   TO DP013-DB2-TABLE-NAME (2)    48850000
488600                 SET DP013-DB2-ABEND                              48860000
488700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           48870000
488800                 PERFORM DP013-0000-PROCESS-ABEND                 48880000
488900     END-EVALUATE.                                                48890000
489000                                                                  48900000
489010*----------------------------------------------------------------*48901000
489020*                                               **   WR # 230ZZ  *48902000
489030* ADDED CODE TO SET PS-PRETICKET TO TRUE , WHEN SQLCODE IS       *48903000
489040* EQUAL TO ZERO.                                                 *48904000
489100*----------------------------------------------------------------*48910000
489200* FETCH THE CURSOR                                               *48920000
489300*----------------------------------------------------------------*48930000
489400 5016-FETCH-TKTFMT-CURSOR.                                        48940000
489500                                                                  48950000
489600     EXEC SQL                                                     48960000
489700          FETCH TKTFMT-CURSOR                                     48970000
489800          INTO  :PTKLNE-TKT-DESC                                  48980000
489900     END-EXEC                                                     48990000
490000                                                                  49000000
490100     EVALUATE TRUE                                                49010000
490200         WHEN SQLCODE = ZERO                                      49020000
490210              SET PS-PRETICKET TO TRUE                            49021000
490300         WHEN SQLCODE = +100                                      49030000
490400              CONTINUE                                            49040000
490500         WHEN SQLWARN0 NOT = SPACE                                49050000
490600         WHEN SQLCODE NOT = ZERO                                  49060000
490700              MOVE '5016-FETCH-TKTFMT-CURSOR'                     49070000
490800                               TO DP013-PARAGRAPH                 49080000
490900              MOVE 'FETCH TKTFMT-CURSOR '                         49090000
491000                               TO DP013-MESSAGE-TEXT (1)          49100000
491100              MOVE SQLCA       TO DP013-SQLCA                     49110000
491200              SET DP013-DB2-ABEND                                 49120000
491300                               TO TRUE                            49130000
491400              PERFORM DP013-0000-PROCESS-ABEND                    49140000
491500     END-EVALUATE.                                                49150000
491600                                                                  49160000
491610*----------------------------------------------------------------*49161000
491620*  CHANGES MADE FOR WR # 230ZZ ENDS HERE.                        *49162000
491630*----------------------------------------------------------------*49163000
491700*----------------------------------------------------------------*49170000
491800* CLOSE THE TKT-FMT-CURSOR.                                      *49180000
491900*----------------------------------------------------------------*49190000
492000                                                                  49200000
492100 5017-CLOSE-TKTFMT-CURSOR.                                        49210000
492200                                                                  49220000
492300     EXEC SQL                                                     49230000
492400         CLOSE TKTFMT-CURSOR                                      49240000
492500     END-EXEC                                                     49250000
492600                                                                  49260000
492700     EVALUATE TRUE                                                49270000
492800         WHEN SQLCODE = ZERO                                      49280000
492900             CONTINUE                                             49290000
493000         WHEN SQLWARN0 NOT = SPACES                               49300000
493100         WHEN SQLCODE < ZERO                                      49310000
493200         WHEN SQLCODE > ZERO                                      49320000
493300             MOVE '5017-CLOSE-TKTFMT-CURSOR'                      49330000
493400                               TO DP013-PARAGRAPH                 49340000
493500             MOVE 'CLOSE PO_ITEM_CURSOR'                          49350000
493600                               TO DP013-MESSAGE-TEXT (1)          49360000
493700             MOVE SQLCA        TO DP013-SQLCA                     49370000
493800             MOVE 'TPTKREQ '   TO DP013-DB2-TABLE-NAME (1)        49380000
493900             MOVE 'TPTKLNE '   TO DP013-DB2-TABLE-NAME (2)        49390000
494000             SET DP013-DB2-ABEND                                  49400000
494100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               49410000
494200             PERFORM DP013-0000-PROCESS-ABEND                     49420000
494300     END-EVALUATE.                                                49430000
494400                                                                  49440000
527800 5050-CHECK-IF-IN-TROUBLE.                                        52780000
527900                                                                  52790000
528000     MOVE ZERO           TO  PV-DB2-COUNT.                        52800000
528100         EXEC SQL                                                 52810000
528200              SELECT COUNT(*)                                     52820000
528300                INTO :PV-DB2-COUNT :PV-NULL-IND                   52830000
528400                FROM TTRBNTF A                                    52840000
528500               WHERE A.PO_NBR        = :DK-ORD-NBR                52850000
528600                 AND A.REC_SEQ_NBR   = :DK-REC-SEQ-NBR            52860000
528700                 AND A.PO_LNE_NBR    = :PC-LONG-ZERO              52870000
528800                 AND A.OPER_UNT_ID   = :DK-OPER-UNT-ID            52880000
528900                 AND A.FCLTY_ID      = :DK-FACT                   52890000
529000                 AND A.PREPK_ID      = :PC-LONG-ZERO              52900000
529100                 AND A.RESOLVED_IND IN ('N','I')                  52910000
529200         END-EXEC                                                 52920000
529300                                                                  52930000
529400         EVALUATE TRUE                                            52940000
529500             WHEN SQLCODE = +0                                    52950000
529600             WHEN SQLCODE = +100                                  52960000
529700                  CONTINUE                                        52970000
529800             WHEN SQLCODE = -904                                  52980000
529900             WHEN SQLCODE = -911                                  52990000
530000             WHEN SQLCODE = -913                                  53000000
530100                  PERFORM 9900-SOFT-ABORT                         53010000
530200                                                                  53020000
530300             WHEN SQLWARN0 NOT = SPACES                           53030000
530400             WHEN SQLCODE < +0                                    53040000
530500             WHEN SQLCODE > +0                                    53050000
530600                  MOVE '5050-CHECK-IF-IN-TROUBLE'                 53060000
530700                                  TO DP013-PARAGRAPH              53070000
530800                  MOVE 'UNSUCCESSFUL SELECT TROUBLE COUNT'        53080000
530900                                  TO DP013-MESSAGE-TEXT (1)       53090000
531000                  MOVE SQLCA      TO DP013-SQLCA                  53100000
531100                  MOVE 'TTRBNTF ' TO DP013-DB2-TABLE-NAME (1)     53110000
531200                  SET DP013-DB2-ABEND                             53120000
531300                      DP013-XCTL-DISPLAY-RESTART                  53130000
531400                                  TO TRUE                         53140000
531500                  PERFORM DP013-0000-PROCESS-ABEND                53150000
531600         END-EVALUATE.                                            53160000
531700                                                                  53170000
532200 5100-SELECT-TDCTFAS.                                             53220000
532300                                                                  53230000
532400     EXEC SQL                                                     53240000
532500          SELECT TKT_FMT_ID                                       53250000
532600            INTO :DCTFAS-TKT-FMT-ID                               53260000
532700                   :DN-TKT-FMT-ID                                 53270000
532800            FROM TDCTFAS A                                        53280000
532900           WHERE A.OPER_UNT_ID = :DK-OPER-UNT-ID                  53290000
533000             AND A.FCLTY_ID    = :DK-FACT                         53300000
533100             AND A.DEPT_NBR    = :DK-DEPT-NBR                     53310000
533200             AND A.RANK_NBR    = 1                                53320000
533300             AND A.CL_NBR            =                            53330000
533400                (SELECT MIN(B.CL_NBR)                             53340000
533500                  FROM TPURITM B                                  53350000
533600                 WHERE B.PO_NBR      = :DK-ORD-NBR                53360000
533700                   AND B.VER_STATUS_CDE = 'A')                    53370000
533800     END-EXEC.                                                    53380000
533900                                                                  53390000
534000     EVALUATE TRUE                                                53400000
534100         WHEN SQLCODE = +0                                        53410000
534200              IF  DN-TKT-FMT-ID = -1                              53420000
534300                  MOVE SPACES        TO RECITM-TKT-FMT-ID         53430000
534400              ELSE                                                53440000
534500                  MOVE DCTFAS-TKT-FMT-ID                          53450000
534600                                     TO RECITM-TKT-FMT-ID         53460000
534700              END-IF                                              53470000
534800                                                                  53480000
534900         WHEN SQLCODE = +100                                      53490000
535000              MOVE SPACES            TO RECITM-TKT-FMT-ID         53500000
535100                                                                  53510000
535200         WHEN SQLCODE = -904                                      53520000
535300         WHEN SQLCODE = -911                                      53530000
535400         WHEN SQLCODE = -913                                      53540000
535500              PERFORM 9900-SOFT-ABORT                             53550000
535600                                                                  53560000
535700         WHEN SQLWARN0 NOT = SPACES                               53570000
535800         WHEN SQLCODE < +0                                        53580000
535900         WHEN SQLCODE > +0                                        53590000
536000              MOVE '5100-SELECT-TDCTFAS'                          53600000
536100                              TO DP013-PARAGRAPH                  53610000
536200              MOVE 'UNSUCCESSFUL SELECT ON TDCTFAS TABLE'         53620000
536300                              TO DP013-MESSAGE-TEXT (1)           53630000
536400              MOVE SQLCA      TO DP013-SQLCA                      53640000
536500              MOVE 'TDCTFAS ' TO DP013-DB2-TABLE-NAME (1)         53650000
536600              SET DP013-DB2-ABEND                                 53660000
536700                  DP013-XCTL-DISPLAY-RESTART                      53670000
536800                              TO TRUE                             53680000
536900              PERFORM DP013-0000-PROCESS-ABEND                    53690000
537000     END-EVALUATE.                                                53700000
537100                                                                  53710000
537200                                                                  53720000
537300                                                                  53730000
537400*---------------------------------------------------------------- 53740000
537500*   UPDATE THE TEMP STORAGE QUEUE                               * 53750000
537600*---------------------------------------------------------------- 53760000
537700 5300-UPDATE-SELECTION-QUEUE.                                     53770000
537800                                                                  53780000
537900     INITIALIZE RC801-SELECTED-ITEM-ARRAY                         53790000
538000     PERFORM 9100-READ-SEL-QUEUE.                                 53800000
538100                                                                  53810000
538200     SET RC801-UPD (ASC-SEL-SUB)   TO TRUE.                       53820000
538300     MOVE +1                 TO ASC-SEL-ITEM.                     53830000
538400                                                                  53840000
538500     PERFORM 9200-REWRITE-LIST-QUEUE.                             53850000
538600                                                                  53860000
538700                                                                  53870000
538800                                                                  53880000
538900*---------------------------------------------------------------- 53890000
539000*   INSERT A RECEIPT ITEM ROW                                   * 53900000
539100*---------------------------------------------------------------- 53910000
539200 9005-SELECT-INACTIVE.                                            53920000
539300                                                                  53930000
539400     EXEC SQL                                                     53940000
539500          SELECT ORD_NBR                                          53950000
539600            INTO :RECITM-ORD-NBR                                  53960000
539700            FROM TRECITM                                          53970000
539800           WHERE ORD_NBR        = :DK-ORD-NBR                     53980000
539900             AND ORD_LNE_NBR    = :DK-LINE-NBR                    53990000
540000             AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR                 54000000
540100             AND VER_STATUS_CDE = 'I'                             54010000
540200     END-EXEC.                                                    54020000
540300                                                                  54030000
540400     EVALUATE TRUE                                                54040000
540500         WHEN SQLCODE = +0                                        54050000
540600              SET PS-INACTIVE-EXISTS TO TRUE                      54060000
540700         WHEN SQLCODE = +100                                      54070000
540800              CONTINUE                                            54080000
540900                                                                  54090000
541000          WHEN SQLCODE = -904                                     54100000
541100          WHEN SQLCODE = -911                                     54110000
541200          WHEN SQLCODE = -913                                     54120000
541300               PERFORM 9900-SOFT-ABORT                            54130000
541400                                                                  54140000
541500         WHEN SQLWARN0 NOT = SPACES                               54150000
541600         WHEN SQLCODE < +0                                        54160000
541700         WHEN SQLCODE > +0                                        54170000
541800              MOVE '9010-SELECT-INACTIVE'                         54180000
541900                               TO DP013-PARAGRAPH                 54190000
542000              MOVE 'UNSUCCESSFUL SELECT ON TRECITM'               54200000
542100                               TO DP013-MESSAGE-TEXT (1)          54210000
542200              MOVE SQLCA       TO DP013-SQLCA                     54220000
542300              MOVE 'TRECITM '  TO DP013-DB2-TABLE-NAME (1)        54230000
542400              SET DP013-DB2-ABEND                                 54240000
542500                  DP013-XCTL-DISPLAY-RESTART                      54250000
542600                               TO TRUE                            54260000
542700              PERFORM DP013-0000-PROCESS-ABEND                    54270000
542800     END-EVALUATE.                                                54280000
542900                                                                  54290000
543400 9006-UPDATE-RECITM.                                              54340000
543500                                                                  54350000
543600     EXEC SQL                                                     54360000
543700          UPDATE TRECITM                                          54370000
543800             SET DTL_CK_ITM_QTY    = :RECITM-DTL-CK-ITM-QTY       54380000
543900                ,PO_VER_NBR        = :PURITM-VER-NBR              54390000
544000                ,PREPK_ID          = :RECITM-PREPK-ID             54400000
544100                ,PREPK_RATO_QTY    = :RECITM-PREPK-RATO-QTY       54410000
544200                ,PREPK_ODD_UNT_QTY = :RECITM-PREPK-ODD-UNT-QTY    54420000
544300                ,VER_STATUS_CDE    = 'A'                          54430000
544400           WHERE                                                  54440000
544500                 ORD_NBR        = :DK-ORD-NBR                     54450000
544600             AND ORD_LNE_NBR    = :DK-LINE-NBR                    54460000
544700             AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR                 54470000
544800     END-EXEC.                                                    54480000
544900                                                                  54490000
545000     EVALUATE TRUE                                                54500000
545100         WHEN SQLCODE = +0                                        54510000
545200              CONTINUE                                            54520000
545300                                                                  54530000
545400          WHEN SQLCODE = -904                                     54540000
545500          WHEN SQLCODE = -911                                     54550000
545600          WHEN SQLCODE = -913                                     54560000
545700               PERFORM 9900-SOFT-ABORT                            54570000
545800                                                                  54580000
545900         WHEN SQLWARN0 NOT = SPACES                               54590000
546000         WHEN SQLCODE < +0                                        54600000
546100         WHEN SQLCODE > +0                                        54610000
546200              MOVE '9010-SELECT-INACTIVE'                         54620000
546300                               TO DP013-PARAGRAPH                 54630000
546400              MOVE 'UNSUCCESSFUL SELECT ON TRECITM'               54640000
546500                               TO DP013-MESSAGE-TEXT (1)          54650000
546600              MOVE SQLCA       TO DP013-SQLCA                     54660000
546700              MOVE 'TRECITM '  TO DP013-DB2-TABLE-NAME (1)        54670000
546800              SET DP013-DB2-ABEND                                 54680000
546900                  DP013-XCTL-DISPLAY-RESTART                      54690000
547000                               TO TRUE                            54700000
547100              PERFORM DP013-0000-PROCESS-ABEND                    54710000
547200     END-EVALUATE.                                                54720000
547300                                                                  54730000
547400                                                                  54740000
547500*---------------------------------------------------------------- 54750000
547600*   DETERMINE IF THE LINE HAS BEEN TRANSCRIPTED ALREADY AND IS  * 54760000
547700*   IN ANOTHER PACK IN RECEIVING SYSTEM                         * 54770000
547800*---------------------------------------------------------------- 54780000
547900 9007-SELECT-ORPHANS.                                             54790000
548000                                                                  54800000
548100     EXEC SQL                                                     54810000
548200          SELECT ORD_NBR                                          54820000
548300            INTO :RECITM-ORD-NBR                                  54830000
548400            FROM TRECITM                                          54840000
548500           WHERE ORD_NBR        = :DK-ORD-NBR                     54850000
548600             AND ORD_LNE_NBR    = :DK-LINE-NBR                    54860000
548700             AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR                 54870000
548800             AND PREPK_ID       > 0                               54880000
548900             AND VER_STATUS_CDE = 'A'                             54890000
549000     END-EXEC.                                                    54900000
549100                                                                  54910000
549200     EVALUATE TRUE                                                54920000
549300         WHEN SQLCODE = +0                                        54930000
549400              SET PS-INACTIVE-EXISTS TO TRUE                      54940000
549500         WHEN SQLCODE = +100                                      54950000
549600              CONTINUE                                            54960000
549700                                                                  54970000
549800          WHEN SQLCODE = -904                                     54980000
549900          WHEN SQLCODE = -911                                     54990000
550000          WHEN SQLCODE = -913                                     55000000
550100               PERFORM 9900-SOFT-ABORT                            55010000
550200                                                                  55020000
550300         WHEN SQLWARN0 NOT = SPACES                               55030000
550400         WHEN SQLCODE < +0                                        55040000
550500         WHEN SQLCODE > +0                                        55050000
550600              MOVE '9007-SELECT-ORPHANS'                          55060000
550700                               TO DP013-PARAGRAPH                 55070000
550800              MOVE 'UNSUCCESSFUL SELECT ON TRECITM'               55080000
550900                               TO DP013-MESSAGE-TEXT (1)          55090000
551000              MOVE SQLCA       TO DP013-SQLCA                     55100000
551100              MOVE 'TRECITM '  TO DP013-DB2-TABLE-NAME (1)        55110000
551200              SET DP013-DB2-ABEND                                 55120000
551300                  DP013-XCTL-DISPLAY-RESTART                      55130000
551400                               TO TRUE                            55140000
551500              PERFORM DP013-0000-PROCESS-ABEND                    55150000
551600     END-EVALUATE.                                                55160000
551700                                                                  55170000
552300 9010-INSERT-RECITM.                                              55230000
552410                                                                  55241099
552420*TCR  AUTOVE                                                      55242099
552430         SET PS-ORIG-ASN-PKSLIP-NO   TO TRUE.                     55243099
552440         PERFORM 9015-CHECK-ASN.                                  55244099
552450         MOVE 0 TO PV-ORIG-PKSL-ITM-QTY.                          55245099
552460         IF PS-ORIG-ASN-PKSLIP-YES                                55246099
552470            MOVE RECITM-PKSL-ITM-QTY TO PV-ORIG-PKSL-ITM-QTY      55247099
552480         END-IF.                                                  55248099
552490*TCR  AUTOVE                                                      55249099
552491                                                                  55249199
552500     EXEC SQL                                                     55250000
552600          INSERT INTO TRECITM                                     55260000
552700                 (ORD_NBR,                                        55270000
552800                  ORD_LNE_NBR,                                    55280000
552900                  REC_SEQ_NBR,                                    55290000
553000                  OPER_UNT_ID,                                    55300000
553100                  FCLTY_ID,                                       55310000
553200                  CRE_TMST,                                       55320000
553300                  CRE_UID,                                        55330000
553400                  PO_VER_NBR,                                     55340000
553500                  ITM_NBR,                                        55350000
553600                  PRE_TKT_IND,                                    55360000
553700                  TKT_FMT_ID,                                     55370000
553800                  RTV_IND,                                        55380000
553900                  STATUS_CDE,                                     55390000
554000                  VER_STATUS_CDE,                                 55400000
554100                  PKSL_ITM_QTY,                                   55410000
554200                  DTL_CK_ITM_QTY,                                 55420000
554300                  INNR_PACK_QTY,                                  55430000
554400                  CASE_PACK_QTY,                                  55440000
554500                  RTV_QTY,                                        55450000
554600                  EXPTED_CART_CNT,                                55460000
554700                  ACTL_CART_CNT,                                  55470000
554800                  MKING_APRON_TMST,                               55480000
554900                  UNT_COST_AMT,                                   55490000
555000                  COLOR_DESC,                                     55500000
555100                  SIZE_DESC,                                      55510000
555200                  VEND_STYL_NAME,                                 55520000
555300                  VEND_DESC,                                      55530000
555400                  VERFYD_TMST,                                    55540000
555500                  PKSL_NBR,                                       55550000
555600                  REC_INV_LNE_NBR,                                55560000
555700                  DMG_ITM_QTY,                                    55570000
555800                  UPD_PGM_ID,                                     55580000
555900                  LAST_TRSCP_TMST,                                55590000
556000                  LAST_TRSCP_USR_ID,                              55600000
556100                  PREPK_ID,                                       55610000
556200                  PREPK_RATO_QTY,                                 55620000
556300                  PREPK_ODD_UNT_QTY,                              55630099
556310                  UNT_RTL_AMT,                                    55631099
556320                  GP_RTL_AMT,                                     55632099
556330                  GP_QTY,                                         55633099
556340                  ORIG_PKSL_ITM_QTY)                              55634099
556400          VALUES (:RECITM-ORD-NBR,                                55640000
556500                  :RECITM-ORD-LNE-NBR,                            55650000
556600                  :RECITM-REC-SEQ-NBR,                            55660000
556700                  :RECITM-OPER-UNT-ID,                            55670000
556800                  :RECITM-FCLTY-ID,                               55680000
556900                   CURRENT TIMESTAMP,                             55690000
557000                  :DP020-USERID,                                  55700000
557100                  :RECITM-PO-VER-NBR,                             55710000
557200                  :RECITM-ITM-NBR,                                55720000
557300                  :RECITM-PRE-TKT-IND,                            55730000
557400                  :RECITM-TKT-FMT-ID,                             55740000
557500                  :RECITM-RTV-IND,                                55750000
557600                  :RECITM-STATUS-CDE,                             55760000
557700                  :PC-A,                                          55770000
557800                  :RECITM-PKSL-ITM-QTY,                           55780000
557900                  :RECITM-DTL-CK-ITM-QTY,                         55790000
558000                  :RECITM-INNR-PACK-QTY,                          55800000
558100                  :RECITM-CASE-PACK-QTY,                          55810000
558200                  :RECITM-RTV-QTY,                                55820000
558300                  :RECITM-EXPTED-CART-CNT,                        55830000
558400                  :RECITM-ACTL-CART-CNT,                          55840000
558500                  :RECITM-MKING-APRON-TMST,                       55850000
558600                  :RECITM-UNT-COST-AMT,                           55860000
558700                  :RECITM-COLOR-DESC,                             55870000
558800                  :RECITM-SIZE-DESC,                              55880000
558900                  :RECITM-VEND-STYL-NAME,                         55890000
559000                  :RECITM-VEND-DESC,                              55900000
559100                  :RECITM-VERFYD-TMST,                            55910000
559200                  :RECITM-PKSL-NBR,                               55920000
559300                  :RECITM-REC-INV-LNE-NBR,                        55930000
559400                  :RECITM-DMG-ITM-QTY,                            55940000
559500                  :PC-CURRENT-PROGRAM-NAME,                       55950000
559600                  CURRENT TIMESTAMP,                              55960000
559700                  :DP020-USERID,                                  55970000
559800                  :RECITM-PREPK-ID,                               55980000
559900                  :RECITM-PREPK-RATO-QTY,                         55990000
560000                  :RECITM-PREPK-ODD-UNT-QTY,                      56000099
560010                  :RECITM-UNT-RTL-AMT,                            56001099
560020                  :RECITM-GP-RTL-AMT,                             56002099
560030                  :RECITM-GP-QTY,                                 56003099
560040                  :PV-ORIG-PKSL-ITM-QTY)                          56004099
560100     END-EXEC.                                                    56010000
560200                                                                  56020000
560300     EVALUATE TRUE                                                56030000
560400         WHEN SQLCODE = +0                                        56040000
560500         WHEN SQLCODE = +100                                      56050000
560600              CONTINUE                                            56060000
560700                                                                  56070000
560800         WHEN SQLCODE = -803                                      56080000
560900            MOVE PC-TSYMSG-00117                                  56090000
561000                           TO DP020-MSG-NUMBER                    56100000
561100            SET DP020-MSG-INFORMATIONAL                           56110000
561200                DP030-OVERRIDE-GO                                 56120000
561300                             TO TRUE                              56130000
561400          WHEN SQLCODE = -904                                     56140000
561500          WHEN SQLCODE = -911                                     56150000
561600          WHEN SQLCODE = -913                                     56160000
561700               PERFORM 9900-SOFT-ABORT                            56170000
561800                                                                  56180000
561900         WHEN SQLWARN0 NOT = SPACES                               56190000
562000         WHEN SQLCODE < +0                                        56200000
562100         WHEN SQLCODE > +0                                        56210000
562200              MOVE '9010-INSERT-RECITM'                           56220000
562300                               TO DP013-PARAGRAPH                 56230000
562400              MOVE 'UNSUCCESSFUL INSERT FOR TRECITM'              56240000
562500                               TO DP013-MESSAGE-TEXT (1)          56250000
562600              MOVE SQLCA       TO DP013-SQLCA                     56260000
562700              MOVE 'TRECITM '  TO DP013-DB2-TABLE-NAME (1)        56270000
562800              SET DP013-DB2-ABEND                                 56280000
562900                  DP013-XCTL-DISPLAY-RESTART                      56290000
563000                               TO TRUE                            56300000
563100              PERFORM DP013-0000-PROCESS-ABEND                    56310000
563200     END-EVALUATE.                                                56320000
563300                                                                  56330000
563410******************************************************************56341099
563420**  CHECK TO SEE IF ASN IS ORIGINAL (CRE_UID = RCKUP006)        **56342099
563430******************************************************************56343099
563440 9015-CHECK-ASN.                                                  56344099
563450                                                                  56345099
563451         MOVE 0 TO PV-COUNTER                                     56345199
563452                   PV-NULL-IND.                                   56345299
563453                                                                  56345399
563460         EXEC SQL                                                 56346099
563470           SELECT COUNT(CRE_UID)                                  56347099
563480           INTO  :PV-COUNTER:PV-NULL-IND                          56348099
563490           FROM   TPKSLIP                                         56349099
563491           WHERE  PO_NBR       = :DK-ORD-NBR                      56349199
563492             AND  REC_SEQ_NBR  = :PV-REC-SEQ-NBR                  56349299
563494             AND  CRE_UID      = 'RCKUP006'                       56349499
563495         END-EXEC.                                                56349599
563496                                                                  56349699
563497         EVALUATE TRUE                                            56349799
563498             WHEN SQLCODE = ZERO                                  56349899
563499                  IF PV-COUNTER > 0                               56349999
563500                     SET PS-ORIG-ASN-PKSLIP-YES  TO TRUE          56350099
563501                  END-IF                                          56350199
563502             WHEN SQLCODE = +100                                  56350299
563503                  CONTINUE                                        56350399
563504             WHEN SQLCODE = -904                                  56350499
563505             WHEN SQLCODE = -911                                  56350599
563506             WHEN SQLCODE = -913                                  56350699
563507                  PERFORM 9900-SOFT-ABORT                         56350799
563508                                                                  56350899
563509             WHEN SQLWARN0 NOT = SPACES                           56350999
563510             WHEN SQLCODE  NOT = ZERO                             56351099
563511                  MOVE '9015-CHECK-ASN'                           56351199
563512                               TO DP013-PARAGRAPH                 56351299
563513                  MOVE 'UNSUCCESSFUL SELECT FOR TPKSLIP'          56351399
563514                               TO DP013-MESSAGE-TEXT (1)          56351499
563515                  MOVE SQLCA       TO DP013-SQLCA                 56351599
563516                  MOVE 'TPKSLIP '  TO DP013-DB2-TABLE-NAME (1)    56351699
563517                  SET DP013-DB2-ABEND                             56351799
563518                      DP013-XCTL-DISPLAY-RESTART                  56351899
563519                                   TO TRUE                        56351999
563520                  PERFORM DP013-0000-PROCESS-ABEND                56352099
563538         END-EVALUATE.                                            56353899
563539                                                                  56353999
563540                                                                  56354000
563600**----------------------------------------------------------------56360000
563700*  TROUBLE WILL ONLY BE CALLED WHEN ADDING A PACK WHERE THE      *56370000
563800*  PREVIOUS PACK ID = 99 (UNTIED PACK)                           *56380000
563900*----------------------------------------------------------------*56390000
564000 9040-CHECK-FOR-TROUBLE.                                          56400000
564100                                                                  56410000
564200     INITIALIZE TM500-FIELDS.                                     56420000
564300                                                                  56430000
564400* TM500-REDISTRO-YES NEEDS TO BE SET TO INSURE RECEIVER OTR IS    56440000
564500*  CORRECT.                                                       56450000
564600     SET  TM500-PREPACK-EDIT-ONLY                                 56460000
564700          TM500-NO-DETAILS                                        56470000
564800          TM500-REDISTRO-YES                                      56480000
564900          TM500-CREATE-DC-BAD-PACK                                56490000
565000          TM500-PACK-LEVEL         TO TRUE.                       56500000
565100                                                                  56510000
565200     PERFORM 4100-PREPARE-CURSOR.                                 56520000
565300     PERFORM 5214-RETRIEVE-DRIVER-LINE.                           56530000
565400     MOVE RECITM-ORD-LNE-NBR       TO TM500-PO-LNE-NBR.           56540000
565500     MOVE DK-ORD-NBR               TO TM500-PO-NBR.               56550000
565600     MOVE ASC-OPR-ID               TO TM500-OPER-UNT-ID.          56560000
565700     MOVE ASC-FACT                 TO TM500-FCLTY-ID.             56570000
565800     MOVE ASC-REC-SEQ-NBR          TO TM500-REC-SEQ-NBR.          56580000
565900     MOVE LQW-PACK-ID (LQW-IDX)    TO TM500-PREPK-ID.             56590000
566000                                                                  56600000
566100     MOVE PC-CURRENT-PROGRAM-NAME  TO TM500-NOTIF-UID.            56610000
566200                                                                  56620000
566300     PERFORM 9045-GET-PURITM.                                     56630000
566400                                                                  56640000
566500     IF PV-NBR-OF-PIC-AD > 0                                      56650000
566600        MOVE 'Y'                   TO TM500-AD-SW                 56660000
566700     ELSE                                                         56670000
566800        MOVE 'N'                   TO TM500-AD-SW.                56680000
566900                                                                  56690000
567000*  TM500-RTV-SW IS LOADED BY TMKCS505 ONLY                        56700000
567200                                                                  56720000
567300                                                                  56730000
567400     EXEC CICS                                                    56740000
567500         LINK PROGRAM  (PC-TROUBLE-RTN)                           56750000
567600              COMMAREA (TM500-FIELDS)                             56760000
567700              LENGTH   (PC-LINE-TROUBLE-RTN-LENGTH)               56770000
567800     END-EXEC.                                                    56780000
567900                                                                  56790000
568000     EVALUATE TRUE                                                56800000
568100         WHEN TM500-CALL-SUCCESSFUL                               56810000
568200         WHEN TM500-DUPLICATE-TROUBLE                             56820000
568300         WHEN TM500-TTRBNTF-UPDATE-NOT-FND                        56830000
568400         WHEN TM500-DIDNT-ALLOC-DUE-TO-TRBL                       56840000
568500         WHEN TM500-INVALID-PRORATION                             56850000
568600           CONTINUE                                               56860000
568700                                                                  56870000
568800         WHEN TM500-PREPACK-DB2-TIMEOUT                           56880000
568900              PERFORM 9900-SOFT-ABORT                             56890000
569000                                                                  56900000
569100         WHEN OTHER                                               56910000
569200           EXEC CICS                                              56920000
569300               SYNCPOINT ROLLBACK                                 56930000
569400           END-EXEC                                               56940000
569500           STRING TM500-PREPACK-PGM-NBR '-'                       56950000
569600                  TM500-PREPACK-ERROR-NBR                         56960000
569700                  DELIMITED BY SIZE                               56970000
569800                                        INTO DP020-MSG-TEXT       56980000
569900           MOVE PC-TSYMSG-02229         TO DP020-MSG-NUMBER       56990000
570000           SET DP020-MSG-FATAL                                    57000000
570100               PS-ERROR                 TO TRUE                   57010000
570200                                                                  57020000
570300     END-EVALUATE.                                                57030000
570400                                                                  57040000
570900 9045-GET-PURITM.                                                 57090000
571000                                                                  57100000
571100     EXEC SQL                                                     57110000
571200          SELECT DISTINCT                                         57120000
571300                 COUNT (*)                                        57130000
571400            INTO                                                  57140000
571500                 :PV-NBR-OF-PIC-AD                                57150000
571600            FROM TPURCHS A,                                       57160000
571700                 TPURITM B,                                       57170000
571800                 TRECITM C                                        57180000
571900           WHERE A.PO_NBR         = :DK-ORD-NBR                   57190000
572000             AND A.VER_STATUS_CDE = 'A'                           57200000
572100             AND A.PO_NBR         = B.PO_NBR                      57210000
572200             AND A.PO_NBR         = C.ORD_NBR                     57220000
572300             AND B.PO_PREPK_ID    = :DK-PACK-ID                   57230000
572400             AND B.PIC_ITM_IND    = 'Y'                           57240000
572500             AND C.ORD_LNE_NBR    = B.APP_PO_LNE_NBR              57250000
572600             AND C.PREPK_ID       = B.PO_PREPK_ID                 57260000
572700             AND C.VER_STATUS_CDE = 'A'                           57270000
572800     END-EXEC.                                                    57280000
572900                                                                  57290000
573000     EVALUATE TRUE                                                57300000
573100         WHEN SQLCODE = +0                                        57310000
573200         WHEN SQLCODE = +100                                      57320000
573300              CONTINUE                                            57330000
573400          WHEN SQLCODE = -904                                     57340000
573500          WHEN SQLCODE = -911                                     57350000
573600          WHEN SQLCODE = -913                                     57360000
573700               PERFORM 9900-SOFT-ABORT                            57370000
573800                                                                  57380000
573900         WHEN SQLWARN0 NOT = SPACES                               57390000
574000         WHEN SQLCODE < +0                                        57400000
574100         WHEN SQLCODE > +0                                        57410000
574200              MOVE '6150-GET-PURITM'                              57420000
574300                               TO DP013-PARAGRAPH                 57430000
574400              MOVE 'UNSUCCESSFUL SELECT ON PO ITEM'               57440000
574500                               TO DP013-MESSAGE-TEXT (1)          57450000
574600              MOVE SQLCA       TO DP013-SQLCA                     57460000
574700              MOVE 'TPURITM '  TO DP013-DB2-TABLE-NAME (1)        57470000
574800              SET DP013-DB2-ABEND                                 57480000
574900                  DP013-XCTL-DISPLAY-RESTART                      57490000
575000                               TO TRUE                            57500000
575100              PERFORM DP013-0000-PROCESS-ABEND                    57510000
575200     END-EVALUATE.                                                57520000
575300                                                                  57530000
575400                                                                  57540000
575500/                                                                 57550000
575600******************************************************************57560000
575700* READ AN ITEM FROM THE INPUT SELECTED ITEMS TEMP STORAGE QUEUE. *57570000
575800******************************************************************57580000
575900 9100-READ-SEL-QUEUE.                                             57590000
576000     EXEC CICS                                                    57600000
576100         READQ TS                                                 57610000
576200             QUEUE (ASC-SEL-QUEUE-NAME-IN)                        57620000
576300             INTO  (RC801-PREPACK-SELECT-RECORD)                  57630000
576400             ITEM  (ASC-SEL-ITEM)                                 57640000
576500             RESP  (PV-CICS-RESP)                                 57650000
576600     END-EXEC.                                                    57660000
576700                                                                  57670000
576800     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        57680000
576900         CONTINUE                                                 57690000
577000     ELSE                                                         57700000
577100         SET DP013-LOGIC-ABEND                                    57710000
577200             DP013-NO-ROLLBACK     TO TRUE                        57720000
577300         MOVE '9100-READ-SEL-QUEUE'                               57730000
577400                                   TO DP013-PARAGRAPH             57740000
577500         MOVE 'ATTEMPTING TO READ TO LIST SELECTIONS TS QUEUE'    57750000
577600                                   TO DP013-MESSAGE-TEXT (1)      57760000
577700         PERFORM DP013-0000-PROCESS-ABEND                         57770000
577800     END-IF.                                                      57780000
577900                                                                  57790000
578000/                                                                 57800000
578100******************************************************************57810000
578200* UPDATE AN ITEM IN THE INPUT SELECTED ITEMS TEMP STORAGE QUEUE. *57820000
578300******************************************************************57830000
578400 9200-REWRITE-LIST-QUEUE.                                         57840000
578500     EXEC CICS                                                    57850000
578600          WRITEQ TS                                               57860000
578700              QUEUE   (ASC-SEL-QUEUE-NAME-IN)                     57870000
578800              FROM    (RC801-PREPACK-SELECT-RECORD)               57880000
578900              ITEM    (ASC-SEL-ITEM)                              57890000
579000              RESP    (PV-CICS-RESP)                              57900000
579100              REWRITE                                             57910000
579200     END-EXEC.                                                    57920000
579300                                                                  57930000
579400     IF PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                    57940000
579500         SET DP013-CICS-ABEND                                     57950000
579600             DP013-NO-ROLLBACK     TO TRUE                        57960000
579700         MOVE '9200-REWRITE-LIST-QUEUE'                           57970000
579800                                   TO DP013-PARAGRAPH             57980000
579900         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   57990000
580000                                   TO DP013-MESSAGE-TEXT (1)      58000000
580100         PERFORM DP013-0000-PROCESS-ABEND                         58010000
580200     END-IF.                                                      58020000
580300                                                                  58030000
580400/                                                                 58040000
580500******************************************************************58050000
580600* READ AN ITEM FROM THE INPUT SELECTED PACK SLIP ITEMS           *58060000
580700* TEMP STORAGE QUEUE.                                            *58070000
580800******************************************************************58080000
580900 9300-READ-PKSL-SEL-QUEUE.                                        58090000
581000                                                                  58100000
581100     EXEC CICS                                                    58110000
581200         READQ TS                                                 58120000
581300             QUEUE (ASC-SEL-QUEUE-NAME-IN)                        58130000
581400             INTO  (RC801-PREPACK-SELECT-RECORD)                  58140000
581500             ITEM  (ASC-SEL-ITEM)                                 58150000
581600             RESP  (PV-CICS-RESP)                                 58160000
581700     END-EXEC.                                                    58170000
581800                                                                  58180000
581900     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        58190000
582000         CONTINUE                                                 58200000
582100     ELSE                                                         58210000
582200         SET DP013-LOGIC-ABEND                                    58220000
582300             DP013-NO-ROLLBACK     TO TRUE                        58230000
582400         MOVE '9300-READ-PKSL-SEL-QUEUE'                          58240000
582500                                   TO DP013-PARAGRAPH             58250000
582600         MOVE 'ATTEMPTING TO READ TO LIST SELECTIONS TS QUEUE'    58260000
582700                                   TO DP013-MESSAGE-TEXT (1)      58270000
582800         PERFORM DP013-0000-PROCESS-ABEND                         58280000
582900     END-IF.                                                      58290000
583000                                                                  58300000
583100/                                                                 58310000
583200******************************************************************58320000
583300* UPDATE AN ITEM IN THE INPUT SELECTED PACK SLIP ITEMS           *58330000
583400* TEMP STORAGE QUEUE.                                            *58340000
583500******************************************************************58350000
583600 9400-REWRITE-PKSL-LIST-QUEUE.                                    58360000
583700                                                                  58370000
583800     EXEC CICS                                                    58380000
583900          WRITEQ TS                                               58390000
584000              QUEUE   (ASC-SEL-QUEUE-NAME-IN)                     58400000
584100              FROM    (RC801-PREPACK-SELECT-RECORD)               58410000
584200              ITEM    (ASC-SEL-ITEM)                              58420000
584300              RESP    (PV-CICS-RESP)                              58430000
584400              REWRITE                                             58440000
584500     END-EXEC.                                                    58450000
584600                                                                  58460000
584700     IF PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                    58470000
584800         SET DP013-CICS-ABEND                                     58480000
584900             DP013-NO-ROLLBACK     TO TRUE                        58490000
585000         MOVE '9400-REWRITE-PKSL-LIST-QUEUE'                      58500000
585100                                   TO DP013-PARAGRAPH             58510000
585200         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   58520000
585300                                   TO DP013-MESSAGE-TEXT (1)      58530000
585400         PERFORM DP013-0000-PROCESS-ABEND                         58540000
585500     END-IF.                                                      58550000
585600                                                                  58560000
585700                                                                  58570000
585800*----------------------------------------------------------------*58580000
585900*  CALL THE PACK VALIDATION MODULE TO VALIDATE THE RATIO THAT    *58590000
586000*  WAS ENTERED, DETERMINE BEST CASE, ODD UNITS, AND % VARIANCE.  *58600000
586100*----------------------------------------------------------------*58610000
586200 9500-CALL-VALIDATION-MODULE.                                     58620000
586300                                                                  58630000
586400     IF ASC-PKNG-CDE  = 'I'                                       58640000
586500        MOVE RECITM-CASE-PACK-QTY   TO RC806-INNER-PACK-QTY       58650099
586510     ELSE                                                         58651099
586520        IF ASC-PKNG-CDE = 'M'                                     58652099
586530           IF RECITM-CASE-PACK-QTY > 1                            58653099
586540              MOVE RECITM-CASE-PACK-QTY TO RC806-INNER-PACK-QTY   58654099
586550           END-IF                                                 58655099
586560        END-IF                                                    58656099
586570     END-IF.                                                      58657099
586600                                                                  58660000
586700     MOVE '3'                       TO RC806-FUNCTION.            58670000
586800     PERFORM 9510-LINK-TO-VALIDATION-MODULE.                      58680000
586900                                                                  58690000
587000                                                                  58700000
587100     MOVE RC806-ODD-UNITS (PV-VALID-IDX)                          58710000
587200                                  TO RECITM-PREPK-ODD-UNT-QTY     58720000
587300                                     ASC-ODD-PACK-UNITS.          58730000
587400                                                                  58740000
587500                                                                  58750000
587600*----------------------------------------------------------------*58760000
587700*  LINK TO THE PACK VALIDATION MODULE AND CHECK THE RETURN CODES *58770000
587800*----------------------------------------------------------------*58780000
587900 9510-LINK-TO-VALIDATION-MODULE.                                  58790000
588000                                                                  58800000
588100     EXEC CICS LINK                                               58810000
588200         PROGRAM  ('RCKCS806')                                    58820000
588300         COMMAREA (RC806-PRODUCT-PACK-VALIDATION)                 58830000
588400         RESP     (PV-CICS-RESP)                                  58840000
588500     END-EXEC.                                                    58850000
588600                                                                  58860000
588700*  CHECK CICS RETURN CODE                                         58870000
588800     IF PV-CICS-RESP = DFHRESP(NORMAL)                            58880000
588900         CONTINUE                                                 58890000
589000     ELSE                                                         58900000
589100         SET DP013-CICS-ABEND                                     58910000
589200             DP013-NO-ROLLBACK   TO TRUE                          58920000
589300         MOVE '4422-LINK-TO-VALIDATION-MODULE'                    58930000
589400                                 TO DP013-PARAGRAPH               58940000
589500         MOVE 'ATTEMPTING TO LINK TO PROGRAM RCKCS806'            58950000
589600                                 TO DP013-MESSAGE-TEXT (1)        58960000
589700         PERFORM DP013-0000-PROCESS-ABEND                         58970000
589800     END-IF.                                                      58980000
589900                                                                  58990000
590000*  CHECK RC806-ERROR-FLAG                                         59000000
590100     EVALUATE TRUE                                                59010000
590200     WHEN RC806-NO-ERRORS                                         59020000
590300         CONTINUE                                                 59030000
590400     WHEN OTHER                                                   59040000
590500         EVALUATE TRUE                                            59050000
590600         WHEN RC806-INV-LINE-DATA                                 59060000
590700         WHEN RC806-INV-FUNCTION-CD                               59070000
590800         WHEN RC806-INV-NBR-OF-LINES                              59080000
590900                                                                  59090000
591000              MOVE 'Y'             TO DP020-MSG-SEVERITY-IND      59100000
591100              MOVE +551            TO DP020-MSG-NUMBER            59110000
591200                                                                  59120000
591300              EXEC CICS                                           59130000
591400                   SYNCPOINT ROLLBACK                             59140000
591500              END-EXEC                                            59150000
591600     END-EVALUATE.                                                59160000
591700                                                                  59170000
591800                                                                  59180000
591900/                                                                 59190000
591910 9903-WRITE-CICS-LOG.                                             59191099
591920                                                                  59192099
591930     EXEC CICS                                                    59193099
591940         WRITEQ TD                                                59194099
591950             QUEUE  ('CSSL')                                      59195099
591960             FROM   (PV-CICS-MSG-AREA)                            59196099
591970             RESP   (PV-CICS-RESP)                                59197099
591980     END-EXEC.                                                    59198099
591990     MOVE SPACES                  TO PV-CICS-MSG-AREA.            59199099
591991/                                                                 59199199
592000*----------------------------------------------------------------*59200000
592100*    THE DB2 RESOURCE IS NOT AVAILABLE, SET THE ERROR MESSAGE    *59210000
592200*    AND THE ERROR SWITCHES.                                     *59220000
592300*----------------------------------------------------------------*59230000
592400 9900-SOFT-ABORT.                                                 59240000
592500     SET PS-ERROR         TO TRUE.                                59250000
592600     SET DP020-MSG-FATAL  TO TRUE.                                59260000
592700     MOVE PC-TSYMSG-00551 TO DP020-MSG-NUMBER.                    59270000
592800     SET  DP020-NEXT-ACT-APPL-ERROR TO TRUE.                      59280000
592900     MOVE 'PROGRAM EXIT CALL'    TO DP013-MESSAGE-TEXT (1).       59290000
593000     PERFORM 0001-CALL-CICS-ARCH-API.                             59300000
593100                                                                  59310000
593200*----------------------------------------------------------------*59320000
593300*    ABEND PROCESSOR MODULE                                      *59330000
593400*----------------------------------------------------------------*59340000
593500                                                                  59350000
593600     COPY DPPD013.                                                59360000
