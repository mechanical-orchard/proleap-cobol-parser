000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    PCKCS754.                                         00040000
000500 AUTHOR.        PATRICK BURKE.                                    00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  NOVEMBER, 2001.                                   00070000
000800 DATE-COMPILED.                                                   00080000
000900*---------------------------------------------------------------* 00090000
001000*  S749 - UNITS WORKED PROJECT - PC-SHIFT HOURS BY DC             00100000
001100*---------------------------------------------------------------* 00110000
001110* DATE  11/04/2021                                                00111007
001120*            - CHANGE CALL OF 'DPKUT100' TO                     * 00112007
001130*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00113007
001140*              MAKING THE CALL DYNAMIC VS STATIC                * 00114007
001150*     MADE BY: GERMAN BANDA            WR/IR #: CHG0264232        00115008
001160*-----------------------------------------------------------------00116007
1122RM* DATE  11/07/2022                                              * 00117009
1122RM*            - ADD COPYBOOK DPWS930                             * 00118009
1122RM*              CHANGE CALL TO DPWS030 FROM STATIC TO            * 00119009
1122RM*              DYNAMIC.                                         * 00119109
1122RM*     MADE BY: BOB MCASEY              WR/IR #: CHG0277910      * 00119209
1122RM*-----------------------------------------------------------------00119309
001200 ENVIRONMENT DIVISION.                                            00120000
001300 DATA DIVISION.                                                   00130000
001400                                                                  00140000
001500 WORKING-STORAGE SECTION.                                         00150000
001600 01  DK-DB2-KEYS.                                                 00160000
001700     05  DK-OPER-UNT-ID                 PIC S9(04)  VALUE ZERO    00170000
001800                                                    COMP.         00180000
001900     05  DK-FROM-DATE                   PIC X(10).                00190000
002000     05  DK-FROM-DATE-X.                                          00200000
002100         10  DK-FROM-YY                 PIC X(04) VALUE SPACES.   00210000
002200         10  FILLER                     PIC X(01) VALUE '-'.      00220000
002300         10  DK-FROM-MM                 PIC X(02) VALUE SPACES.   00230000
002400         10  FILLER                     PIC X(01) VALUE '-'.      00240000
002500         10  DK-FROM-DD                 PIC X(02) VALUE SPACES.   00250000
002600     05  DK-TO-DATE                     PIC X(10).                00260000
002700     05  DK-TO-DATE-X.                                            00270000
002800         10  DK-TO-YY                   PIC X(04) VALUE SPACES.   00280000
002900         10  FILLER                     PIC X(01) VALUE '-'.      00290000
003000         10  DK-TO-MM                   PIC X(02) VALUE SPACES.   00300000
003100         10  FILLER                     PIC X(01) VALUE '-'.      00310000
003200         10  DK-TO-DD                   PIC X(02) VALUE SPACES.   00320000
003300     05  DK-FISCAL-WEEK.                                          00330000
003400         10  DK-FISCAL-YEAR             PIC X(04) VALUE SPACES.   00340000
003500         10  DK-FISCAL-WK               PIC X(02) VALUE SPACES.   00350000
003600     05  DK-FISCAL-MONTH.                                         00360000
003700         10  DK-FISCAL-YR               PIC X(04) VALUE SPACES.   00370000
003800         10  DK-FISCAL-MN               PIC X(02) VALUE SPACES.   00380000
003900     05  DK-DATE-NM                     PIC X(09) VALUE SPACES.   00390000
004000     05  DK-PERCENT-FORMAT.                                       00400000
004100         10  DK-NUMBER                  PIC ZZ9.9 VALUE ZEROES.   00410000
004200         10  DK-PERCENT                 PIC X(01) VALUE '%'.      00420000
004300                                                                  00430000
004400 01  PC-PROGRAM-CONSTANTS.                                        00440000
004500     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE 'PC754A  '.  00450000
004600     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE 'PCKM754'.   00460000
004700     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE 'PCKCS754'.  00470000
004800     05  PC-LIST-QUEUE-SEQ         PIC  9(01)  VALUE 1.           00480000
004900     05  PC-SEL-QUEUE-SEQ          PIC  9(01)  VALUE 2.           00490000
005000     05  PC-CRIT-SPEC-FORMAT       PIC  X(01)  VALUE '1'.         00500000
005100     05  PC-PROCESS-AREA-FORMAT    PIC  X(01)  VALUE '3'.         00510000
005200     05  PC-PROCSS-GROUP-FORMAT    PIC  X(01)  VALUE '4'.         00520000
005300     05  PC-ITEMS-PER-PANEL        PIC S9(04)  VALUE +15          00530005
005400                                               COMP SYNC.         00540000
005500     05  PC-MAX-BLOCKS-IN-ARRAY    PIC S9(04)  VALUE +2           00550000
005600                                               COMP SYNC.         00560000
005700     05  PC-MAX-ITEMS              PIC S9(09)  VALUE +1000000     00570000
005800                                               COMP-3.            00580000
005900     05  PC-MSG-NUMBER-LENGTH      PIC S9(04)  VALUE +5           00590000
006000                                               COMP SYNC.         00600000
006100     05  PC-MAX-RETRIES            PIC S9(03)  VALUE 3            00610000
006200                                               COMP-3.            00620000
006300     05  PC-INQ                    PIC  X(03)  VALUE 'INQ'.       00630000
006400     05  PC-DEL                    PIC  X(03)  VALUE 'DEL'.       00640000
006500     05  PC-UPD                    PIC  X(03)  VALUE 'UPD'.       00650000
006600     05  PC-ERR                    PIC  X(03)  VALUE 'ERR'.       00660000
006700     05  PC-SLASH                  PIC  X(01)  VALUE '/'.         00670000
006800     05  PC-ZERO                   PIC S9(04)  VALUE ZEROES       00680000
006900                                               COMP.              00690000
007000     05  PC-01                     PIC  X(02)  VALUE '01'.        00700000
007100     05  PC-1                      PIC  S9(4) COMP VALUE 1.       00710000
007200     05  PC-2                      PIC  S9(4) COMP VALUE 2.       00720000
007300     05  PC-3                      PIC  S9(4) COMP VALUE 3.       00730000
007400     05  PC-A                      PIC  X(01)  VALUE 'A'.         00740000
007500*                                                                 00750000
007600*----------------------------------------------------------------*00760000
007700*  SYSTEM MESSAGES                                               *00770000
007800*----------------------------------------------------------------*00780000
007900*   00005 = INVALID VALUE                                        *00790000
008000*   00007 = REQUIRED ENTRY                                        00800000
008100*   00008 = MUST BE NUMERIC                                      *00810000
008200*   00050 - NO LIST ITEMS WERE FOUND FOR THE CRITERIA SPECIFIED  *00820000
008300*   00051 - NO END OF RANGE HAS BEEN SPECIFIED                   *00830000
008400*   00052 - END OF RANGE PRECEDES START OF RANGE                 *00840000
008500*   00053 - NO START OF RANGE HAS BEEN SPECIFIED                 *00850000
008600*   00054 - ONLY ONE START OF RANGE INDICATOR MAY BE SPECIFIED   *00860000
008700*   00055 - ONLY ONE END OF RANGE INDICATOR MAY BE SPECIFIED     *00870000
008800*   00057 - A LIST ITEM MUST BE SELECTED FOR THIS FUNCTION       *00880000
008900*   00069 - TOP OF LIST                                          *00890000
009000*   00070 - BOTTOM OF LIST                                       *00900000
009100*   00101 - VALUE MUST BE > ZERO AND  < 1,000,000                *00910000
009200*   00551 - WAIT 15 SECONDS;RETRY FUNCTION AGAIN; IF UNSUCCESSFUL*00920000
009300*   00279 - MORE ITEMS TO DISPLAY                                *00930000
009400*   00840 - YOU ARE NOT AUTHORIZED TO VIEW THIS INFORMATION      *00940000
009500*   00984 - DATABASE IS BUSY, TRY AGAIN IN A FEW MINUTES         *00950000
009600*   02227 = APPLICATION UNAVAILABLE AT THIS TIME                 *00960000
009700*   99901 = INVALID COMMAND WAS ENTERED                          *00970000
009800*----------------------------------------------------------------*00980000
009900     05  PC-TSYMSG-NUMBERS.                                       00990000
010000         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  01000000
010100         10  PC-TSYMSG-00007            PIC  9(05)  VALUE 00007.  01010000
010200         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  01020000
010300         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  01030000
010400         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  01040000
010500         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  01050000
010600         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  01060000
010700         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  01070000
010800         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  01080000
010900         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  01090000
011000         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  01100000
011100         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  01110000
011200         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  01120000
011300         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01130000
011400         10  PC-TSYMSG-00551            PIC  9(05)  VALUE 00551.  01140000
011500         10  PC-TSYMSG-00749            PIC  9(05)  VALUE 00749.  01150000
011600         10  PC-TSYMSG-00840            PIC  9(05)  VALUE 00840.  01160000
011700         10  PC-TSYMSG-01563            PIC  9(05)  VALUE 01563.  01170000
011800         10  PC-TSYMSG-00984            PIC  9(05)  VALUE 00984.  01180000
011900         10  PC-TSYMSG-02227            PIC  9(05)  VALUE 02227.  01190000
012000         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  01200000
012100*                                                                 01210000
012200 01  PS-PROGRAM-SWITCHES.                                         01220000
012300     05  PS-BLOCK-ERROR-SW              PIC  X(01)  VALUE 'Y'.    01230000
012400         88  PS-NO-BLOCK-ERROR                      VALUE 'Y'.    01240000
012500         88  PS-BLOCK-ERROR                         VALUE 'N'.    01250000
012600     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01260000
012700         88  PS-NO-ERROR                            VALUE 'Y'.    01270000
012800         88  PS-ERROR                               VALUE 'N'.    01280000
012900     05  PS-SOFT-ABORT-ERROR-SW         PIC  X(01)  VALUE  'N'.   01290000
013000         88  PS-SOFT-ABORT-ERROR                    VALUE  'Y'.   01300000
013100         88  PS-NO-SOFT-ABORT-ERROR                 VALUE  'N'.   01310000
013200     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01320000
013300         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01330000
013400         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01340000
013500     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    01350000
013600         88  PS-DONE                                VALUE 'Y'.    01360000
013700         88  PS-NOT-DONE                            VALUE 'N'.    01370000
013800     05  PS-LIST-END-SW                 PIC  X(01)  VALUE  'N'.   01380000
013900         88  PS-LIST-END                            VALUE  'Y'.   01390000
014000         88  PS-NO-LIST-END                         VALUE  'N'.   01400000
014100     05  PS-ACCESS-SW                   PIC  X(01)  VALUE  'N'.   01410000
014200         88  PS-ACCESS-ALLOWED                      VALUE  'Y'.   01420000
014300         88  PS-ACCESS-NOT-ALLOWED                  VALUE  'N'.   01430000
014400     05  PS-CURSOR-SW                   PIC  X(01)  VALUE  ' '.   01440000
014500         88  PS-OPER-NAME-CSR                       VALUE  'A'.   01450000
014600         88  PS-UK-OPER-NAME-CSR                    VALUE  'B'.   01460000
014700         88  PS-UNITS-BY-OPER-CSR                   VALUE  'C'.   01470000
014800     05  PS-OPER-NBR-SW                 PIC  X(01)  VALUE  'N'.   01480000
014900         88  PS-OPER-NBR-SAME                       VALUE  'Y'.   01490000
015000         88  PS-OPER-NBR-NOT-SAME                   VALUE  'N'.   01500000
015100     05  PS-INITIAL-FETCH-SW            PIC  X(01)  VALUE  'N'.   01510000
015200         88  PS-INITIAL-FETCH                       VALUE  'Y'.   01520000
015300         88  PS-NOT-INITIAL-FETCH                   VALUE  'N'.   01530000
015400*                                                                 01540000
015500 01  PV-PROGRAM-VARIABLES.                                        01550000
015600     05  PV-ORIGINAL-BLOCK               PIC S9(04)  VALUE +0     01560000
015700                                                     COMP SYNC.   01570000
015800     05  PV-ITEMS-HOLD                   PIC S9(03)  COMP-3.      01580000
015900     05  PV-ITEMS-DIFF                   PIC S9(03)  COMP-3.      01590000
016000     05  PV-RACF-ERROR-CODE             PIC  9(04)  VALUE ZEROES. 01600000
016100     05  PV-CICS-RESPONSE               PIC S9(08)  VALUE ZEROES  01610000
016200                                        COMP SYNC.                01620000
016300     05  PV-SUB                         PIC S9(04)  VALUE +0      01630000
016400                                                    COMP SYNC.    01640000
016500     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01650000
016600                                                    COMP SYNC.    01660000
016700     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01670000
016800                                                    COMP-3.       01680000
016900     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01690000
017000                                                    COMP-3.       01700000
017100     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01710000
017200                                                    COMP-3.       01720000
017300     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01730000
017400                                                    COMP-3.       01740000
017500     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01750000
017600                                                    COMP-3.       01760000
017700     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01770000
017800                                                    COMP-3.       01780000
017900     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01790000
018000                                                    COMP-3.       01800000
018100     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01810000
018200                                                    COMP SYNC.    01820000
018300     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01830000
018400                                                    COMP SYNC.    01840000
018500     05  PV-ITEM                        PIC S9(04)  VALUE +0      01850000
018600                                                    COMP SYNC.    01860000
018700     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01870000
018800                                                    COMP SYNC.    01880000
018900     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01890000
019000                                                    COMP SYNC.    01900000
019100     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01910000
019200                                                    COMP SYNC.    01920000
019300     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01930000
019400                                                    COMP SYNC.    01940000
019500     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01950000
019600                                                    COMP SYNC.    01960000
019700     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01970000
019800                                                    COMP SYNC.    01980000
019900     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01990000
020000                                                    COMP SYNC.    02000000
020100     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      02010000
020200                                                    COMP SYNC.    02020000
020300     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      02030000
020400                                                    COMP SYNC.    02040000
020500     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      02050000
020600                                                    COMP SYNC.    02060000
020700     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      02070000
020800                                                    COMP SYNC.    02080000
020900     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      02090000
021000                                                    COMP SYNC.    02100000
021100     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      02110000
021200                                                    COMP SYNC.    02120000
021300     05  PV-NULL-IND-1                  PIC S9(04)  VALUE +0      02130000
021400                                                    COMP.         02140000
021500     05  PV-NULL-IND-2                  PIC S9(04)  VALUE +0      02150000
021600                                                    COMP.         02160000
021700     05  PV-NULL-IND-3                  PIC S9(04)  VALUE +0      02170000
021800                                                    COMP.         02180000
021900     05  PV-SOFT-ABORT-MSG.                                       02190000
022000         10  FILLER            PIC X(12) VALUE ' PCKCS754 - '.    02200000
022100         10  FILLER            PIC X(09) VALUE 'SQLCODE: '.       02210000
022200         10  PV-SOFT-SQLCODE   PIC ZZZZZZZZ9-.                    02220000
022300         10  FILLER            PIC X(12) VALUE ' PARAGRAPH: '.    02230000
022400         10  PV-SOFT-PARAGRAPH PIC X(30).                         02240000
022500     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     02250000
022600                                                     COMP SYNC.   02260000
022700     05  PV-CICS-MSG-AREA                PIC  X(80)  VALUE SPACE. 02270000
022800     05  PV-CICS-MSG-AREA2               PIC  X(100) VALUE SPACE. 02280000
022900     05  PV-CICS-MSG-HOLD.                                        02290000
023000         10  FILLER                      PIC  X(01)  VALUE SPACE. 02300000
023100         10  PV-CICS-MSG-DATA            PIC  X(79)  VALUE SPACE. 02310000
023200     05  PV-CICS-MSG-HOLD2.                                       02320000
023300         10  FILLER                      PIC  X(01)  VALUE SPACE. 02330000
023400         10  PV-CICS-MSG-DATA2           PIC  X(99)  VALUE SPACE. 02340000
023500                                                                  02350000
023600     05  PV-TMST                 PIC X(26)   VALUE SPACES.        02360000
023700     05  PV-TMST-R REDEFINES  PV-TMST.                            02370000
023800         10   PV-TMST-YY                PIC  X(04).               02380000
023900         10   FILLER                    PIC  X(01).               02390000
024000         10   PV-TMST-MM                PIC  X(02).               02400000
024100         10   FILLER                    PIC  X(01).               02410000
024200         10   PV-TMST-DD                PIC  X(02).               02420000
024300         10   FILLER                    PIC  X(01).               02430000
024400         10   PV-TMST-HRS               PIC  X(02).               02440000
024500         10   FILLER                    PIC  X(01).               02450000
024600         10   PV-TMST-MIN               PIC  X(02).               02460000
024700         10   FILLER                    PIC  X(01).               02470000
024800         10   PV-TMST-SEC               PIC  X(02).               02480000
024900         10   FILLER                    PIC  X(07).               02490000
025000     05  PV-DISPLAY-DATE                PIC  X(45) VALUE SPACES.  02500000
025100     05  PV-SELECT-LIST-SEQ             PIC  X(01) VALUE SPACES.  02510000
025200     05  PV-NBR-ITEMS                   PIC  9(05) VALUE ZEROES.  02520000
025300     05  PV-SEL-TERM-ID                 PIC  X(04).               02530000
025400     05  PV-SEL-TASK-NUMBER             PIC  9(05).               02540000
025500     05  PV-SEL-SEQ                     PIC  9(01).               02550000
025600     05  PV-TOT-UNITS                   PIC  9(09)   VALUE ZEROS. 02560000
025700     05  PV-3RD-UNITS                   PIC  9(09)   VALUE ZEROS. 02570000
025800     05  PV-1ST-UNITS                   PIC  9(09)   VALUE ZEROS. 02580000
025900     05  PV-2ND-UNITS                   PIC  9(09)   VALUE ZEROS. 02590000
026000     05  PV-3RD-PCT                     PIC  9(05)V9 VALUE ZEROS. 02600000
026100     05  PV-1ST-PCT                     PIC  9(05)V9 VALUE ZEROS. 02610000
026200     05  PV-2ND-PCT                     PIC  9(05)V9 VALUE ZEROS. 02620000
026300                                                                  02630000
026410     05  PV-OPER-NBR                    PIC  X(04).               02641001
026500     05  PV-OPER-DESC                   PIC  X(05).               02650000
026600     05  PV-TIMEZONE                    PIC  X(09).               02660000
026700     05  PV-3RD-STRTM                   PIC  X(08).               02670000
026800     05  PV-3RD-ENDTM                   PIC  X(08).               02680000
026900     05  PV-1ST-STRTM                   PIC  X(08).               02690000
027000     05  PV-1ST-ENDTM                   PIC  X(08).               02700000
027100     05  PV-2ND-STRTM                   PIC  X(08).               02710000
027200     05  PV-2ND-ENDTM                   PIC  X(08).               02720000
027300     05  PV-FUNC-QTY                    PIC  S9(9) COMP           02730000
027400                                                   VALUE ZEROS.   02740000
027500     05  PV-PREV-OPER-NBR               PIC  X(04).               02750000
027600     05  PV-PREV-OPER-DESC              PIC  X(05).               02760000
027700     05  PV-PREV-TIMEZONE               PIC  X(09).               02770000
027800     05  PV-PREV-3RD-STRTM              PIC  X(08).               02780000
027900     05  PV-PREV-3RD-ENDTM              PIC  X(08).               02790000
028000     05  PV-PREV-1ST-STRTM              PIC  X(08).               02800000
028100     05  PV-PREV-1ST-ENDTM              PIC  X(08).               02810000
028200     05  PV-PREV-2ND-STRTM              PIC  X(08).               02820000
028300     05  PV-PREV-2ND-ENDTM              PIC  X(08).               02830000
028400     05  PV-PREV-FUNC-QTY               PIC  X(01).               02840000
028500                                                                  02850000
028600******************************************************************02860000
028700**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **02870000
028800**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **02880000
028900**  APPLICATION-SPECIFIC COMMAREA.                              **02890000
029000******************************************************************02900000
029100 01  LQW-LIST-QUEUE-WORK-AREA.                                    02910000
029200     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  02920000
029300     05  LQW-ITEM-ENTRIES               OCCURS 15 TIMES           02930000
029400                                        INDEXED BY LQW-IDX.       02940000
029500         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       02950000
029600         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               02960000
029700         10  LQW-SELECTED-SW            PIC  X(01).               02970000
029800             88  LQW-SELECT                         VALUE 'S'.    02980000
029900             88  LQW-DESELECT                       VALUE ' '.    02990000
030000         10  LQW-ACTION                 PIC  X(03).               03000000
030100             88  LQW-DEL                            VALUE 'DEL'.  03010000
030200             88  LQW-INQ                            VALUE 'INQ'.  03020000
030300             88  LQW-UPD                            VALUE 'UPD'.  03030000
030400             88  LQW-ERR                            VALUE 'ERR'.  03040000
030500         10  LQW-OPERNBR                PIC  X(04).               03050000
030600         10  LQW-OPERDESC               PIC  X(05).               03060000
030700         10  LQW-TMZONE                 PIC  X(09).               03070000
030800         10  LQW-3RDSTRTM               PIC  X(08).               03080000
030900         10  LQW-3RDENDTM               PIC  X(08).               03090000
031000         10  LQW-1STSTRTM               PIC  X(08).               03100000
031100         10  LQW-1STENDTM               PIC  X(08).               03110000
031200         10  LQW-2NDSTRTM               PIC  X(08).               03120000
031300         10  LQW-2NDENDTM               PIC  X(08).               03130000
031400                                                                  03140000
031500*---------------------------------------------------------------* 03150000
031600* SELECTION QUEUE LAYOUT                                        * 03160000
031700*---------------------------------------------------------------* 03170000
031800     COPY PCWS215.                                                03180000
031900                                                                  03190000
032000*---------------------------------------------------------------* 03200000
032100*    MAP LAYOUT                                                 * 03210000
032200*---------------------------------------------------------------* 03220000
032300     COPY PCKM754.                                                03230000
032400*                                                                 03240000
032500 01  MR-OCCURS-LAYOUT                   REDEFINES  PC754AO.       03250000
032600     05  FILLER                         PIC X(12).                03260000
032700     05  MR-SCROLL-AREA                 OCCURS 15 TIMES.          03270000
032800                                                                  03280000
032900*        10  MR-SELECTL                 PIC S9(04) COMP.          03290000
033000*        10  MR-SELECTA                 PIC  X(01).               03300000
033100*        10  MR-SELECTC                 PIC  X(01).               03310000
033200*        10  MR-SELECTH                 PIC  X(01).               03320000
033300*        10  MR-SELECTI                 PIC  X(01).               03330000
033400                                                                  03340000
033500*        10  MR-ACTIONL                 PIC S9(04) COMP.          03350000
033600*        10  MR-ACTIONA                 PIC  X(01).               03360000
033700*        10  MR-ACTIONC                 PIC  X(01).               03370000
033800*        10  MR-ACTIONH                 PIC  X(01).               03380000
033900*        10  MR-ACTION                  PIC  X(03).               03390000
034000                                                                  03400000
034100         10  MR-OPERIDL                 PIC S9(04) COMP.          03410000
034200         10  MR-OPERIDA                 PIC  X(01).               03420000
034300         10  MR-OPERIDC                 PIC  X(01).               03430000
034400         10  MR-OPERIDH                 PIC  X(01).               03440000
034500         10  MR-OPERID                  PIC  X(04).               03450000
034600                                                                  03460000
034700         10  MR-OPER-DESCL              PIC S9(04) COMP.          03470000
034800         10  MR-OPER-DESCA              PIC  X(01).               03480000
034900         10  MR-OPER-DESCC              PIC  X(01).               03490000
035000         10  MR-OPER-DESCH              PIC  X(01).               03500000
035100         10  MR-OPER-DESC               PIC  X(05).               03510000
035200                                                                  03520000
035300         10  MR-TIMEZONEL              PIC S9(04) COMP.           03530000
035400         10  MR-TIMEZONEA              PIC  X(01).                03540000
035500         10  MR-TIMEZONEC              PIC  X(01).                03550000
035600         10  MR-TIMEZONEH              PIC  X(01).                03560000
035700         10  MR-TIMEZONE               PIC  X(08).                03570000
035800                                                                  03580000
035900         10  MR-3RD-STRTML              PIC S9(04) COMP.          03590000
036000         10  MR-3RD-STRTMA              PIC  X(01).               03600000
036100         10  MR-3RD-STRTMC              PIC  X(01).               03610000
036200         10  MR-3RD-STRTMH              PIC  X(01).               03620000
036300         10  MR-3RD-STRTM               PIC  X(08).               03630000
036400                                                                  03640000
036500         10  MR-3RD-ENDTML              PIC S9(04) COMP.          03650000
036600         10  MR-3RD-ENDTMA              PIC  X(01).               03660000
036700         10  MR-3RD-ENDTMC              PIC  X(01).               03670000
036800         10  MR-3RD-ENDTMH              PIC  X(01).               03680000
036900         10  MR-3RD-ENDTM               PIC  X(08).               03690000
037000                                                                  03700000
037100         10  MR-1ST-STRTML              PIC S9(04) COMP.          03710000
037200         10  MR-1ST-STRTMA              PIC  X(01).               03720000
037300         10  MR-1ST-STRTMC              PIC  X(01).               03730000
037400         10  MR-1ST-STRTMH              PIC  X(01).               03740000
037500         10  MR-1ST-STRTM               PIC  X(08).               03750000
037600                                                                  03760000
037700         10  MR-1ST-ENDTML              PIC S9(04) COMP.          03770000
037800         10  MR-1ST-ENDTMA              PIC  X(01).               03780000
037900         10  MR-1ST-ENDTMC              PIC  X(01).               03790000
038000         10  MR-1ST-ENDTMH              PIC  X(01).               03800000
038100         10  MR-1ST-ENDTM               PIC  X(08).               03810000
038200                                                                  03820000
038300         10  MR-2ND-STRTML              PIC S9(04) COMP.          03830000
038400         10  MR-2ND-STRTMA              PIC  X(01).               03840000
038500         10  MR-2ND-STRTMC              PIC  X(01).               03850000
038600         10  MR-2ND-STRTMH              PIC  X(01).               03860000
038700         10  MR-2ND-STRTM               PIC  X(08).               03870000
038800                                                                  03880000
038900         10  MR-2ND-ENDTML              PIC S9(04) COMP.          03890000
039000         10  MR-2ND-ENDTMA              PIC  X(01).               03900000
039100         10  MR-2ND-ENDTMC              PIC  X(01).               03910000
039200         10  MR-2ND-ENDTMH              PIC  X(01).               03920000
039300         10  MR-2ND-ENDTM               PIC  X(08).               03930000
039400                                                                  03940000
039500*---------------------------------------------------------------* 03950000
039600*    ATTRIBUTE SETTINGS COPYBOOK.                               * 03960000
039700*---------------------------------------------------------------* 03970000
039800     COPY DPWS015.                                                03980000
039900                                                                  03990000
040000*---------------------------------------------------------------* 04000000
040100*    FUNCTION KEYS COPYBOOK.                                    * 04010000
040200*---------------------------------------------------------------* 04020000
040300     COPY DPWS016.                                                04030000
040400                                                                  04040000
040500*---------------------------------------------------------------* 04050000
040600*    NUMERIC EDIT LAYOUT.                                       * 04060000
040700*---------------------------------------------------------------* 04070000
040800     COPY DPWS010I.                                               04080000
040900                                                                  04090000
041000*---------------------------------------------------------------* 04100000
041100*    PARAMETERS FOR CALLING CICS ARCHITECTURE API (DPKCS030).   * 04110000
041200*---------------------------------------------------------------* 04120000
041300     COPY DPWS030.                                                04130000
1122RM     COPY DPWS930.                                                04131009
041400                                                                  04140000
041500*---------------------------------------------------------------* 04150000
041600*    STANDARD COMMAREA.                                         * 04160000
041700*---------------------------------------------------------------* 04170000
041800     COPY DPWS020.                                                04180000
041900     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                04190000
042000                                                                  04200000
042100*---------------------------------------------------------------* 04210000
042200* INTER-APPLICATION COMMAREA.                                   * 04220000
042300*   PCWS213 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 04230000
042400*             SPEC SCREEN.                                      * 04240000
042500*   PCWS214 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 04250000
042600*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 04260000
042700*---------------------------------------------------------------* 04270000
042800         10  INTER-APPL-COMM-AREA       PIC X(200).               04280000
042900     COPY PCWS213.                                                04290000
043000     COPY PCWS214.                                                04300000
043100                                                                  04310000
043200*---------------------------------------------------------------* 04320000
043300*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 04330000
043400*---------------------------------------------------------------* 04340000
043500         10  ASC-SPECIFIC-COMMAREA.                               04350000
043600             15  ASC-OPER-NBR-X              PIC  X(04).          04360000
043700             15  ASC-OPER-NBR-X              PIC  X(04).          04370000
043800             15  ASC-OPER-NBR-N REDEFINES ASC-OPER-NBR-X.         04380000
043900                 20  ASC-OPER-NBR            PIC  9(04).          04390000
044000                                                                  04400000
044100             15  ASC-OPERID                  PIC  X(04).          04410000
044200             15  ASC-OPER-DESC               PIC  X(05).          04420000
044300             15  ASC-TIMEZONE                PIC  X(07).          04430000
044400             15  ASC-3RD-STRTM               PIC  X(08).          04440000
044500             15  ASC-3RD-ENDTM               PIC  X(08).          04450000
044600             15  ASC-1ST-STRTM               PIC  X(08).          04460000
044700             15  ASC-1ST-ENDTM               PIC  X(08).          04470000
044800             15  ASC-2ND-STRTM               PIC  X(08).          04480000
044900             15  ASC-2ND-ENDTM               PIC  X(08).          04490000
045000                                                                  04500000
045100             15  ASC-BUSN-DATE.                                   04510000
045200                 20  ASC-BUSN-YY             PIC  X(04).          04520000
045300                 20  ASC-BUSN-MM             PIC  X(02).          04530000
045400                 20  ASC-BUSN-DD             PIC  X(02).          04540000
045500             15  ASC-FROM-DATE.                                   04550000
045600                 20  ASC-FROM-MN             PIC  X(02).          04560000
045700                 20  ASC-FROM-DY             PIC  X(02).          04570000
045800                 20  ASC-FROM-YR             PIC  X(04).          04580000
045900             15  ASC-TO-DATE.                                     04590000
046000                 20  ASC-TO-MN               PIC  X(02).          04600000
046100                 20  ASC-TO-DY               PIC  X(02).          04610000
046200                 20  ASC-TO-YR               PIC  X(04).          04620000
046300             15  ASC-FISCAL-WEEK             PIC  X(06).          04630000
046400             15  ASC-FISCAL-MONTH            PIC  X(06).          04640000
046500             15  ASC-PRINTER-ID              PIC  X(08).          04650000
046600             15  ASC-PROCESS-GROUP           PIC  X(06).          04660000
046700             15  ASC-PROCESS-AREA            PIC  X(06).          04670000
046800             15  ASC-TOT-UNITS               PIC  9(09).          04680000
046900             15  ASC-3RD-UNITS               PIC  9(09).          04690000
047000             15  ASC-3RD-PCT                 PIC  9(05)V9.        04700000
047100             15  ASC-1ST-PCT                 PIC  9(05)V9.        04710000
047200             15  ASC-2ND-PCT                 PIC  9(05)V9.        04720000
047300             15  ASC-TOT-PCT                 PIC  9(05)V9.        04730000
047400             15  FILLER                      PIC  X(025).         04740000
047500*-----------------------------------------------------------------04750000
047600             15  ASC-BLK-SUB                  PIC S9(04) COMP     04760000
047700                                                         SYNC.    04770000
047800             15  ASC-ITEM-SUB                 PIC S9(04) COMP     04780000
047900                                                         SYNC.    04790000
048000             15  ASC-NUMBER-OF-ITEMS-READ     PIC S9(09) COMP-3.  04800000
048100             15  ASC-NUMBER-OF-SELECTED-ITEMS PIC S9(09) COMP-3.  04810000
048200             15  ASC-ITEMS-DISPLAYED          PIC S9(03) COMP-3.  04820000
048300             15  ASC-ITEM-AT-TOP-OF-PANEL     PIC S9(09) COMP-3.  04830000
048400             15  ASC-ITEM-AT-BOT-OF-PANEL     PIC S9(09) COMP-3.  04840000
048500             15  ASC-HIGHEST-BLOCK-WRITTEN    PIC S9(04) COMP     04850000
048600                                                         SYNC.    04860000
048700             15  ASC-START-OF-SELECTED-RANGE  PIC S9(09) COMP-3.  04870000
048800             15  ASC-END-OF-SELECTED-RANGE    PIC S9(09) COMP-3.  04880000
048900             15  ASC-ITEMS-LEFT-INDICATOR     PIC  X(01).         04890000
049000                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     04900000
049100                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     04910000
049200             15  ASC-TEMP-QUEUE-UPDATE-SW     PIC  X(01).         04920000
049300                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     04930000
049400                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     04940000
049500             15  ASC-LIST-QUEUE-NAME.                             04950000
049600                 20  ASC-LIST-TERM-ID         PIC  X(04).         04960000
049700                 20  ASC-LIST-TASK-NUMBER     PIC S9(05) COMP-3.  04970000
049800                 20  ASC-LIST-SEQ             PIC  9(01).         04980000
049900                                                                  04990000
050000             15  ASC-START-ITEM-REQUEST.                          05000000
050100                 20  ASC-START-ITEM-REQUEST-N PIC  9(05).         05010000
050200                                                                  05020000
050300             15  ASC-SEL-SUB                  PIC S9(4) COMP.     05030000
050400             15  ASC-SEL-ITEM                 PIC S9(4) COMP.     05040000
050500             15  ASC-USE-SELECTION-QUEUE-IND  PIC  X(1).          05050000
050600                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 05060000
050700             15  ASC-SEL-QUEUE-NAME.                              05070000
050800                 20  ASC-SEL-TERM-ID          PIC  X(04).         05080000
050900                 20  ASC-SEL-TASK-NUMBER      PIC S9(05) COMP-3.  05090000
051000                 20  ASC-SEL-SEQ              PIC  9(01).         05100000
051100             15  ASC-NUMBER-OF-TS-ITEMS       PIC S9(09) COMP-3.  05110000
051200                                                                  05120000
051300*-----------------------------------------------------------------05130000
051400             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                05140000
051500                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  05150000
051600                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   05160000
051700                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   05170000
051800                                                                  05180000
051900                 20  ASC-ITEM-ARRAY.                              05190000
052000                     25  ASC-ITEM-ENTRIES OCCURS 15 TIMES.        05200000
052100                         30  ASC-LIST-ITEM-NUMBER                 05210000
052200                                                     PIC S9(09)   05220000
052300                                                     COMP-3.      05230000
052400                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  05240000
052500                             88  ASC-VALID-SELECT    VALUE ' '    05250000
052600                                                           'S'    05260000
052700                                                           'B'    05270000
052800                                                           'E'.   05280000
052900                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   05290000
053000                             88  ASC-TEMP-SELECT     VALUE 'S'.   05300000
053100                             88  ASC-TEMP-BEGIN      VALUE 'B'.   05310000
053200                             88  ASC-TEMP-END        VALUE 'E'.   05320000
053300                         30  ASC-SELECTED-SW         PIC  X(01).  05330000
053400                             88  ASC-NO-SELECT       VALUE ' '.   05340000
053500                             88  ASC-SELECT          VALUE 'S'.   05350000
053600                             88  ASC-BEGIN           VALUE 'B'.   05360000
053700                             88  ASC-END             VALUE 'E'.   05370000
053800                         30  ASC-OPERNBR            PIC  X(04).   05380000
053900                         30  ASC-OPERDESC           PIC  X(05).   05390000
054000                         30  ASC-TIMZN              PIC  X(09).   05400000
054100                         30  ASC-3RDSTRTM           PIC  X(08).   05410000
054200                         30  ASC-3RDENDTM           PIC  X(08).   05420000
054300                         30  ASC-1STSTRTM           PIC  X(08).   05430000
054400                         30  ASC-1STENDTM           PIC  X(08).   05440000
054500                         30  ASC-2NDSTRTM           PIC  X(08).   05450000
054600                         30  ASC-2NDENDTM           PIC  X(08).   05460000
054700                                                                  05470000
054800*---------------------------------------------------------------* 05480000
054900*    ABEND PROCESSING COPYBOOK.                                 * 05490000
055000*---------------------------------------------------------------* 05500000
055100     COPY DPWS013.                                                05510000
055200                                                                  05520000
055300*---------------------------------------------------------------* 05530000
055400*    PCT_SHFT - SHIFT TRACKING TABLE                              05540000
055500*---------------------------------------------------------------* 05550000
055600     EXEC SQL                                                     05560000
055700          INCLUDE PCT00004                                        05570000
055800     END-EXEC.                                                    05580000
055900                                                                  05590000
056000*---------------------------------------------------------------* 05600000
056100*    TKRPRPM -                                                    05610000
056200*---------------------------------------------------------------* 05620000
056300     EXEC SQL                                                     05630000
056400          INCLUDE TKRPRPM                                         05640000
056500     END-EXEC.                                                    05650000
056600                                                                  05660000
056700*---------------------------------------------------------------* 05670000
056800*    TKRPRCD -                                                    05680000
056900*---------------------------------------------------------------* 05690000
057000     EXEC SQL                                                     05700000
057100          INCLUDE TKRPRCD                                         05710000
057200     END-EXEC.                                                    05720000
057300                                                                  05730000
057400*---------------------------------------------------------------* 05740000
057500*    PCT_SUM_WRKD - SUMMARY OF UNITS WORKED INFORMATION           05750000
057600*---------------------------------------------------------------* 05760000
057700     EXEC SQL                                                     05770000
057800          INCLUDE PCT00005                                        05780000
057900     END-EXEC.                                                    05790000
058000                                                                  05800000
058100*---------------------------------------------------------------* 05810000
058200*    XLT_LOC - LOCATION TABLE                                     05820004
058300*---------------------------------------------------------------* 05830000
058400     EXEC SQL                                                     05840000
058500          INCLUDE XLT00010                                        05850004
058600     END-EXEC.                                                    05860000
058700                                                                  05870000
058800*---------------------------------------------------------------* 05880000
058900*    TDTATTR - DATE TABLE                                         05890000
059000*---------------------------------------------------------------* 05900000
059100     EXEC SQL                                                     05910000
059200          INCLUDE TDTATTR                                         05920000
059300     END-EXEC.                                                    05930000
059400                                                                  05940000
059500*---------------------------------------------------------------* 05950000
059600*    DB2 AREA FOR COMMUNICATIONS                                * 05960000
059700*---------------------------------------------------------------* 05970000
059800     EXEC SQL                                                     05980000
059900          INCLUDE SQLCA                                           05990000
060000     END-EXEC.                                                    06000000
060100                                                                  06010000
060200*---------------------------------------------------------------* 06020000
060300*    SHIFT CURSOR                                                 06030000
060400*---------------------------------------------------------------* 06040000
060500     EXEC SQL                                                     06050000
060600          DECLARE SHIFT-CSR CURSOR FOR                            06060000
060700              SELECT  A.OPER_UNT_ID                               06070000
060800                     ,A.SHFT_NBR                                  06080000
060900                     ,A.SHFT_BEG_TM                               06090000
061000                     ,A.SHFT_END_TM                               06100000
061100                     ,B.LOC_5_ABBR_NM                             06110004
061200                     ,C.FUNC_QTY                                  06120000
061300                FROM  PCT_SHFT A                                  06130000
061400                     ,XLT_LOC  B                                  06140004
061500                     ,TKRPRPM  C                                  06150000
061600               WHERE  A.OPER_UNT_ID      =  B.LOC_NBR             06160004
061700                 AND  B.LOC_TYP_CDE      =  'DC'                  06170004
061800                 AND  C.LOC_ID           =  B.LOC_NBR             06180004
061900                 AND  C.SYS_PRC_FUNC_CDE =  'TIMEZN'              06190000
062000          ORDER BY                                                06200000
062100                A.OPER_UNT_ID                                     06210000
062200     END-EXEC.                                                    06220000
062300                                                                  06230000
062400*-----------------------------------------------------------------06240000
062500 LINKAGE SECTION.                                                 06250000
062600                                                                  06260000
062700 01  DFHCOMMAREA.                                                 06270000
062800     05  FILLER                         OCCURS  1 TO 4072 TIMES   06280000
062900                                        DEPENDING ON EIBCALEN.    06290000
063000         10  FILLER                     PIC X.                    06300000
063100                                                                  06310000
063200                                                                  06320000
063300 PROCEDURE DIVISION.                                              06330000
063400******************************************************************06340000
063500**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **06350000
063600**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **06360000
063700**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **06370000
063800******************************************************************06380000
063900 0000-MAIN-MODULE.                                                06390000
064000     INITIALIZE DP030-CICS-API-FIELDS.                            06400000
064100     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       06410000
064200     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          06420000
064300     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         06430000
064400     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       06440000
064500     MOVE LENGTH OF PC754AI        TO DP030-MAP-LENGTH (1).       06450000
064600     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     06460000
064700     PERFORM 0001-CALL-CICS-ARCH-API.                             06470000
064800*                                                                 06480000
064900     PERFORM 1000-CONTROL-PROCESSING                              06490000
065000*                                                                 06500000
065100     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     06510000
065200     PERFORM 0001-CALL-CICS-ARCH-API.                             06520000
065300                                                                  06530000
065400******************************************************************06540000
065500**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **06550000
065600**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **06560000
065700******************************************************************06570000
065800 0001-CALL-CICS-ARCH-API.                                         06580000
1122RM*    CALL 'DPKCS030' USING DFHEIBLK                               06590009
1122RM     CALL DP930-CICS-ARCH-API                                     06591009
1122RM                     USING DFHEIBLK                               06592009
066000                           DFHCOMMAREA                            06600000
066100                           DP030-CICS-API-FIELDS                  06610000
066200                           DP020-STANDARD-COMMAREA                06620000
066300                           PC754AI.                               06630000
066400*                                                                 06640000
066500     IF  DP030-RC-CALL-SUCCESSFUL                                 06650000
066600         CONTINUE                                                 06660000
066700     ELSE                                                         06670000
066800         SET DP013-NO-ROLLBACK                                    06680000
066900             DP013-XCTL-DISPLAY-RESTART                           06690000
067000             DP013-CICS-ABEND      TO TRUE                        06700000
067100         MOVE '0001-CALL-CICS-ARCH-API' TO DP013-PARAGRAPH        06710000
1122RM*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX06720009
1122RM*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      06730009
1122rm         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O06731009
1122RM-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      06732009
067400         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      06740000
067500         PERFORM DP013-0000-PROCESS-ABEND                         06750000
067600     END-IF.                                                      06760000
067700                                                                  06770000
067800*----------------------------------------------------------------*06780000
067900* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *06790000
068000* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *06800000
068100*                                                                *06810000
068200* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *06820000
068300*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *06830000
068400*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *06840000
068500*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *06850000
068600*----------------------------------------------------------------*06860000
068700 1000-CONTROL-PROCESSING.                                         06870000
068800                                                                  06880000
068900     EVALUATE TRUE                                                06890000
069000         WHEN DP020-NEXT-ACT-INITIAL                              06900000
069100             INITIALIZE ASC-SPECIFIC-COMMAREA                     06910000
069200             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            06920000
069300                                      ASC-SEL-TERM-ID             06930000
069400             MOVE DP020-SRC-TASK-NUMBER TO ASC-LIST-TASK-NUMBER   06940000
069500                                           ASC-SEL-TASK-NUMBER    06950000
069600             MOVE PC-LIST-QUEUE-SEQ  TO ASC-LIST-SEQ              06960000
069700             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 06970000
069800             PERFORM 1100-PROCESS-INTER-APPL-COMM                 06980000
069900***-----$TEMPLATE NOTE$-------------------------------------------06990000
070000*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,07000000
070100*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  07010000
070200*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.07020000
070300***---------------------------------------------------------------07030000
070400             IF  PS-COMMAREA-NOT-VALID                            07040000
070500                 SET DP020-NEXT-ACT-APPL-ERROR TO TRUE            07050000
070600             ELSE                                                 07060000
070700                 PERFORM 4000-BUILD-INITIAL-PANEL                 07070000
070800             END-IF                                               07080000
070900                                                                  07090000
071000         WHEN DP020-NEXT-ACT-READ-MAP                             07100000
071100             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         07110000
071200             PERFORM 2000-PROCESS-PANEL                           07120000
071300                                                                  07130000
071400         WHEN DP020-NEXT-ACT-RETURN                               07140000
071500             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         07150000
071600             MOVE ZERO  TO ASC-ITEM-AT-TOP-OF-PANEL               07160000
071700             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 07170000
071800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07180000
071900                                                                  07190000
072000         WHEN OTHER                                               07200000
072100             SET DP013-LOGIC-ABEND TO TRUE                        07210000
072200             SET DP013-NO-ROLLBACK TO TRUE                        07220000
072300             MOVE '1000-CONTROL-PROCESSING' TO DP013-PARAGRAPH    07230000
072400             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    07240000
072500                                   TO DP013-MESSAGE-TEXT(1)       07250000
072600             PERFORM DP013-0000-PROCESS-ABEND                     07260000
072700     END-EVALUATE.                                                07270000
072800                                                                  07280000
072900*----------------------------------------------------------------*07290000
073000* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *07300000
073100* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *07310000
073200*----------------------------------------------------------------*07320000
073300 1100-PROCESS-INTER-APPL-COMM.                                    07330000
073400                                                                  07340000
073500     SET PS-COMMAREA-VALID         TO TRUE.                       07350000
073600     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     07360000
073700     MOVE '1'                      TO DP020-INT-APPL-FORMAT-IND.  07370000
073800                                                                  07380000
073900     IF  DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT          07390000
074000         MOVE PC213-OPER-UNT-ID       TO ASC-OPER-NBR             07400000
074100                                         DK-OPER-UNT-ID           07410000
074200         MOVE PC213-CRNT-BUS-DTE      TO ASC-BUSN-DATE            07420000
074300         MOVE PC213-FROM-DATE         TO ASC-FROM-DATE            07430000
074400         MOVE PC213-TO-DATE           TO ASC-TO-DATE              07440000
074500         MOVE PC213-FISCAL-WEEK       TO ASC-FISCAL-WEEK          07450000
074600         MOVE PC213-FISCAL-MONTH      TO ASC-FISCAL-MONTH         07460000
074700         MOVE PC213-PRINTER-ID        TO ASC-PRINTER-ID           07470000
074800     ELSE                                                         07480000
074900         MOVE PC214-OPER-UNT-ID       TO ASC-OPER-NBR             07490000
075000                                         DK-OPER-UNT-ID           07500000
075100         MOVE PC214-FROM-DATE         TO ASC-FROM-DATE            07510000
075200         MOVE PC214-TO-DATE           TO ASC-TO-DATE              07520000
075300         MOVE PC214-PROCESS-GROUP     TO ASC-PROCESS-GROUP        07530000
075400         MOVE PC214-PROCESS-AREA      TO ASC-PROCESS-AREA         07540000
075500     END-IF.                                                      07550000
075600                                                                  07560000
075700*-----------------------------------------------------------------07570000
075800 1120-PREPARE-LIST-ENTRY.                                         07580000
075900                                                                  07590000
076000     MOVE PC215-MAX-ITEMS          TO ASC-SEL-SUB.                07600000
076100     MOVE ZERO                     TO ASC-SEL-ITEM.               07610000
076200     PERFORM 1130-GET-NEXT-RECORD.                                07620000
076300                                                                  07630000
076400*-----------------------------------------------------------------07640000
076500*    GET THE NEXT RECORD IF A LIST OF RECORDS ARE BEING PROCESSED*07650000
076600*-----------------------------------------------------------------07660000
076700 1130-GET-NEXT-RECORD.                                            07670000
076800                                                                  07680000
076900     ADD +1                       TO ASC-SEL-SUB.                 07690000
077000                                                                  07700000
077100     IF  ASC-SEL-SUB > PC215-MAX-ITEMS                            07710000
077200         ADD +1                   TO ASC-SEL-ITEM                 07720000
077300         MOVE +1                  TO ASC-SEL-SUB                  07730000
077400     END-IF.                                                      07740000
077500                                                                  07750000
077600     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                07760000
077700         PERFORM 9100-READ-SEL-QUEUE                              07770000
077800         IF  PC215-ITEM (ASC-SEL-SUB) > ZERO                      07780000
077900             MOVE PC215-OPER-DESC (ASC-SEL-SUB) TO ASC-OPER-DESC  07790000
078000             MOVE PC215-3RD-UNITS (ASC-SEL-SUB) TO ASC-3RD-UNITS  07800000
078100             MOVE PC215-3RD-PCT (ASC-SEL-SUB)   TO ASC-3RD-PCT    07810000
078200             MOVE PC215-1ST-PCT (ASC-SEL-SUB)   TO ASC-1ST-PCT    07820000
078300             MOVE PC215-2ND-PCT (ASC-SEL-SUB)   TO ASC-2ND-PCT    07830000
078400             MOVE PC215-TOT-UNITS (ASC-SEL-SUB) TO ASC-TOT-UNITS  07840000
078500             MOVE PC215-TOT-PCT (ASC-SEL-SUB)   TO ASC-TOT-PCT    07850000
078600             SET PC215-INQ (ASC-SEL-SUB) TO TRUE                  07860000
078700             PERFORM 9200-REWRITE-SEL-QUEUE                       07870000
078800         ELSE                                                     07880000
078900             SUBTRACT +1 FROM ASC-SEL-SUB                         07890000
079000             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             07900000
079100             SET DP020-MSG-INFORMATIONAL                          07910000
079200                 PS-LIST-END             TO TRUE                  07920000
079300         END-IF                                                   07930000
079400     ELSE                                                         07940000
079500         SUBTRACT +1 FROM ASC-SEL-ITEM                            07950000
079600         MOVE PC215-MAX-ITEMS     TO ASC-SEL-SUB                  07960000
079700         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             07970000
079800         SET DP020-MSG-INFORMATIONAL                              07980000
079900             PS-LIST-END             TO TRUE                      07990000
080000     END-IF.                                                      08000000
080100                                                                  08010000
080200*-----------------------------------------------------------------08020000
080300*    GET THE PREVIOUS RECORD IF A LIST OF RECORDS ARE BEING      *08030000
080400*    PROCESSED.                                                  *08040000
080500*-----------------------------------------------------------------08050000
080600 1140-GET-PREV-RECORD.                                            08060000
080700                                                                  08070000
080800     SUBTRACT +1 FROM ASC-SEL-SUB.                                08080000
080900                                                                  08090000
081000     IF  ASC-SEL-SUB < +1                                         08100000
081100         SUBTRACT +1 FROM ASC-SEL-ITEM                            08110000
081200         MOVE PC215-MAX-ITEMS     TO ASC-SEL-SUB                  08120000
081300     END-IF.                                                      08130000
081400                                                                  08140000
081500     IF  ASC-SEL-ITEM > ZERO                                      08150000
081600         PERFORM 9100-READ-SEL-QUEUE                              08160000
081700         MOVE PC215-OPER-DESC (ASC-SEL-SUB) TO ASC-OPER-DESC      08170000
081800         MOVE PC215-3RD-UNITS (ASC-SEL-SUB) TO ASC-3RD-UNITS      08180000
081900         MOVE PC215-3RD-PCT (ASC-SEL-SUB)   TO ASC-3RD-PCT        08190000
082000         MOVE PC215-1ST-PCT (ASC-SEL-SUB)   TO ASC-1ST-PCT        08200000
082100         MOVE PC215-2ND-PCT (ASC-SEL-SUB)   TO ASC-2ND-PCT        08210000
082200         MOVE PC215-TOT-UNITS (ASC-SEL-SUB) TO ASC-TOT-UNITS      08220000
082300         MOVE PC215-TOT-PCT (ASC-SEL-SUB)   TO ASC-TOT-PCT        08230000
082400         SET PC215-INQ (ASC-SEL-SUB) TO TRUE                      08240000
082500         PERFORM 9200-REWRITE-SEL-QUEUE                           08250000
082600     ELSE                                                         08260000
082700         MOVE +1                  TO ASC-SEL-ITEM                 08270000
082800                                     ASC-SEL-SUB                  08280000
082900         MOVE PC-TSYMSG-00069     TO DP020-MSG-NUMBER             08290000
083000         SET DP020-MSG-INFORMATIONAL                              08300000
083100             PS-LIST-END             TO TRUE                      08310000
083200     END-IF.                                                      08320000
083300                                                                  08330000
083400*----------------------------------------------------------------*08340000
083500* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *08350000
083600* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *08360000
083700* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *08370000
083800* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *08380000
083900* FUNCTION KEYS CAN GET THIS FAR.                                *08390000
084000*----------------------------------------------------------------*08400000
084100 2000-PROCESS-PANEL.                                              08410000
084200     EVALUATE TRUE                                                08420000
084300         WHEN DP020-SRC-AID = DP016-CLEAR                         08430000
084400             MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                08440000
084500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   08450000
084600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08460000
084700                                                                  08470000
084800         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    08480000
084900             PERFORM 2050-DELETE-LIST-QUEUE                       08490000
085000             PERFORM 4000-BUILD-INITIAL-PANEL                     08500000
085100                                                                  08510000
085200         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    08520000
085300             PERFORM 2140-DESELECT-ALL-ITEMS                      08530000
085400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08540000
085500                                                                  08550000
085600         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  08560000
085700             PERFORM 2150-SELECT-ALL-ITEMS                        08570000
085800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08580000
085900                                                                  08590000
086000         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             08600000
086100             IF  ASC-USE-SELECTION-QUEUE                          08610000
086200                 PERFORM 1130-GET-NEXT-RECORD                     08620000
086300                 IF PS-LIST-END                                   08630000
086400                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         08640000
086500                     SET PS-NO-LIST-END TO TRUE                   08650000
086600                 ELSE                                             08660000
086700                     PERFORM 2050-DELETE-LIST-QUEUE               08670000
086800                     PERFORM 3200-RESET-ATTRIBUTES                08680000
086900                     PERFORM 4000-BUILD-INITIAL-PANEL             08690000
087000                 END-IF                                           08700000
087100              ELSE                                                08710000
087200                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08720000
087300*                --- BOTTOM OF LIST ---                           08730000
087400                 MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER         08740000
087500                 SET DP020-MSG-INFORMATIONAL TO TRUE              08750000
087600             END-IF                                               08760000
087700                                                                  08770000
087800         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             08780000
087900             IF  ASC-USE-SELECTION-QUEUE                          08790000
088000                 PERFORM 1140-GET-PREV-RECORD                     08800000
088100                 IF PS-LIST-END                                   08810000
088200                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         08820000
088300                     SET PS-NO-LIST-END TO TRUE                   08830000
088400                 ELSE                                             08840000
088500                     PERFORM 2050-DELETE-LIST-QUEUE               08850000
088600                     PERFORM 3200-RESET-ATTRIBUTES                08860000
088700                     PERFORM 4000-BUILD-INITIAL-PANEL             08870000
088800                 END-IF                                           08880000
088900             ELSE                                                 08890000
089000                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08900000
089100                 MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER         08910000
089200                 SET DP020-MSG-INFORMATIONAL TO TRUE              08920000
089300             END-IF                                               08930000
089400                                                                  08940000
089500         WHEN OTHER                                               08950000
089600             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 08960000
089700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   08970000
089800                                                                  08980000
089900             IF  PS-NO-ERROR                                      08990000
090000                 SET DP030-CONTINUE-GO TO TRUE                    09000000
090100                 PERFORM 2100-CHECK-FUNCTION-KEY                  09010000
090200             ELSE                                                 09020000
090300                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             09030000
090400                 SET DP030-OVERRIDE-GO TO TRUE                    09040000
090500             END-IF                                               09050000
090600     END-EVALUATE.                                                09060000
090700                                                                  09070000
090800*----------------------------------------------------------------*09080000
090900*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *09090000
091000*----------------------------------------------------------------*09100000
091100 2050-DELETE-LIST-QUEUE.                                          09110000
091200                                                                  09120000
091300     EXEC CICS                                                    09130000
091400         DELETEQ TS                                               09140000
091500             QUEUE (ASC-LIST-QUEUE-NAME)                          09150000
091600             RESP  (PV-CICS-RESP)                                 09160000
091700     END-EXEC.                                                    09170000
091800                                                                  09180000
091900     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       09190000
092000        (PV-CICS-RESP = DFHRESP(QIDERR))                          09200000
092100         CONTINUE                                                 09210000
092200     ELSE                                                         09220000
092300         SET DP013-CICS-ABEND      TO TRUE                        09230000
092400         SET DP013-NO-ROLLBACK     TO TRUE                        09240000
092500                                                                  09250000
092600         MOVE '2050-DELETE-LIST-QUEUE' TO DP013-PARAGRAPH         09260000
092700         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    09270000
092800                                   TO DP013-MESSAGE-TEXT (1)      09280000
092900         PERFORM DP013-0000-PROCESS-ABEND                         09290000
093000     END-IF.                                                      09300000
093100                                                                  09310000
093200     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  09320000
093300                                                                  09330000
093400*----------------------------------------------------------------*09340000
093500* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*09350000
093600* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *09360000
093700* CICS ARCHITECTURE API.                                         *09370000
093800*----------------------------------------------------------------*09380000
093900 2100-CHECK-FUNCTION-KEY.                                         09390000
094000                                                                  09400000
094100     EVALUATE TRUE                                                09410000
094200*                                                                 09420000
094300* F17 - UNITS WORKED BY PO                                        09430000
094400         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              09440000
094500             IF PS-NO-ERROR                                       09450000
094600                 IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO          09460000
094700                     SET ASC-USE-SELECTION-QUEUE TO TRUE          09470000
094800                     INITIALIZE PC214-INTER-APPL-COMMAREA         09480000
094900                     MOVE ASC-NUMBER-OF-SELECTED-ITEMS            09490000
095000                                TO PC214-NUMBER-OF-SELECTED-ITEMS 09500000
095100                     MOVE ASC-NUMBER-OF-TS-ITEMS                  09510000
095200                                      TO PC214-NUMBER-OF-TS-ITEMS 09520000
095300                     MOVE ASC-SEL-QUEUE-NAME                      09530000
095400                                           TO PC214-SEL-QUEUE-NAME09540000
095500                     MOVE ASC-OPER-NBR    TO PC214-OPER-UNT-ID    09550000
095600                     MOVE ASC-FROM-DATE   TO PC214-FROM-DATE      09560000
095700                     MOVE ASC-TO-DATE     TO PC214-TO-DATE        09570000
095800                     PERFORM 5000-PREPARE-SEL-QUEUE               09580000
095900                 ELSE                                             09590000
096000                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         09600000
096100                     SET DP030-OVERRIDE-GO TO TRUE                09610000
096200                     MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER     09620000
096300                     SET DP020-MSG-WARNING TO TRUE                09630000
096400                 END-IF                                           09640000
096500             END-IF                                               09650000
096600                                                                  09660000
096700*                                                                 09670000
096800* F18 - UNITS WORKED BY PROCESS AREA                              09680000
096900         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              09690000
097000             IF PS-NO-ERROR                                       09700000
097100                 IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO          09710000
097200                     SET ASC-USE-SELECTION-QUEUE TO TRUE          09720000
097300                     INITIALIZE PC214-INTER-APPL-COMMAREA         09730000
097400                     MOVE ASC-NUMBER-OF-SELECTED-ITEMS            09740000
097500                                TO PC214-NUMBER-OF-SELECTED-ITEMS 09750000
097600                     MOVE ASC-NUMBER-OF-TS-ITEMS                  09760000
097700                                      TO PC214-NUMBER-OF-TS-ITEMS 09770000
097800                     MOVE ASC-SEL-QUEUE-NAME                      09780000
097900                                           TO PC214-SEL-QUEUE-NAME09790000
098000                     MOVE ASC-OPER-NBR    TO PC214-OPER-UNT-ID    09800000
098100                     MOVE ASC-FROM-DATE   TO PC214-FROM-DATE      09810000
098200                     MOVE ASC-TO-DATE     TO PC214-TO-DATE        09820000
098300                     PERFORM 5000-PREPARE-SEL-QUEUE               09830000
098400                 ELSE                                             09840000
098500                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         09850000
098600                     SET DP030-OVERRIDE-GO TO TRUE                09860000
098700                     MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER     09870000
098800                     SET DP020-MSG-WARNING TO TRUE                09880000
098900                 END-IF                                           09890000
099000             END-IF                                               09900000
099100                                                                  09910000
099200* F22 - COMPARE PREVIOUS YEAR TO CURRENT YEAR                     09920000
099300         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              09930000
099400             IF PS-NO-ERROR                                       09940000
099500                 IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO          09950000
099600                     SET ASC-USE-SELECTION-QUEUE TO TRUE          09960000
099700                     INITIALIZE PC214-INTER-APPL-COMMAREA         09970000
099800                     MOVE ASC-NUMBER-OF-SELECTED-ITEMS            09980000
099900                                TO PC214-NUMBER-OF-SELECTED-ITEMS 09990000
100000                     MOVE ASC-NUMBER-OF-TS-ITEMS                  10000000
100100                                      TO PC214-NUMBER-OF-TS-ITEMS 10010000
100200                     MOVE ASC-SEL-QUEUE-NAME                      10020000
100300                                           TO PC214-SEL-QUEUE-NAME10030000
100400                     MOVE ASC-OPER-NBR    TO PC214-OPER-UNT-ID    10040000
100500                     MOVE ASC-FROM-DATE   TO PC214-FROM-DATE      10050000
100600                     MOVE ASC-TO-DATE     TO PC214-TO-DATE        10060000
100700                     PERFORM 5000-PREPARE-SEL-QUEUE               10070000
100800                 ELSE                                             10080000
100900                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         10090000
101000                     SET DP030-OVERRIDE-GO TO TRUE                10100000
101100                     MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER     10110000
101200                     SET DP020-MSG-WARNING TO TRUE                10120000
101300                 END-IF                                           10130000
101400             END-IF                                               10140000
101500                                                                  10150000
101600* F23 - UNITS WORKED BY PROCESS GROUP                             10160000
101700         WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)              10170000
101800             IF PS-NO-ERROR                                       10180000
101900                 IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO          10190000
102000                     SET ASC-USE-SELECTION-QUEUE TO TRUE          10200000
102100                     INITIALIZE PC214-INTER-APPL-COMMAREA         10210000
102200                     MOVE ASC-NUMBER-OF-SELECTED-ITEMS            10220000
102300                                TO PC214-NUMBER-OF-SELECTED-ITEMS 10230000
102400                     MOVE ASC-NUMBER-OF-TS-ITEMS                  10240000
102500                                      TO PC214-NUMBER-OF-TS-ITEMS 10250000
102600                     MOVE ASC-SEL-QUEUE-NAME                      10260000
102700                                           TO PC214-SEL-QUEUE-NAME10270000
102800                     MOVE ASC-OPER-NBR    TO PC214-OPER-UNT-ID    10280000
102900                     MOVE ASC-FROM-DATE   TO PC214-FROM-DATE      10290000
103000                     MOVE ASC-TO-DATE     TO PC214-TO-DATE        10300000
103100                     PERFORM 5000-PREPARE-SEL-QUEUE               10310000
103200                 ELSE                                             10320000
103300                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         10330000
103400                     SET DP030-OVERRIDE-GO TO TRUE                10340000
103500                     MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER     10350000
103600                     SET DP020-MSG-WARNING TO TRUE                10360000
103700                 END-IF                                           10370000
103800             END-IF                                               10380000
103900                                                                  10390000
104000* F24 - PRINT A REPORT                                            10400000
104100         WHEN DP020-FK-LOCAL-FUNC-05 (DP020-SRC-AID)              10410000
104200             IF PS-NO-ERROR                                       10420000
104300                 IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO          10430000
104400                     SET ASC-USE-SELECTION-QUEUE TO TRUE          10440000
104500                     INITIALIZE PC214-INTER-APPL-COMMAREA         10450000
104600                     MOVE ASC-NUMBER-OF-SELECTED-ITEMS            10460000
104700                                TO PC214-NUMBER-OF-SELECTED-ITEMS 10470000
104800                     MOVE ASC-NUMBER-OF-TS-ITEMS                  10480000
104900                                      TO PC214-NUMBER-OF-TS-ITEMS 10490000
105000                     MOVE ASC-SEL-QUEUE-NAME                      10500000
105100                                           TO PC214-SEL-QUEUE-NAME10510000
105200                     MOVE ASC-OPER-NBR    TO PC214-OPER-UNT-ID    10520000
105300                     MOVE ASC-FROM-DATE   TO PC214-FROM-DATE      10530000
105400                     MOVE ASC-TO-DATE     TO PC214-TO-DATE        10540000
105500                     PERFORM 5000-PREPARE-SEL-QUEUE               10550000
105600                 ELSE                                             10560000
105700                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         10570000
105800                     SET DP030-OVERRIDE-GO TO TRUE                10580000
105900                     MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER     10590000
106000                     SET DP020-MSG-WARNING TO TRUE                10600000
106100                 END-IF                                           10610000
106200             END-IF                                               10620000
106300                                                                  10630000
106400*                                                                 10640000
106500* F6 - FIRST PAGE                                                 10650000
106600         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  10660000
106700             MOVE +1               TO PV-TOP-ITEM                 10670000
106800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10680000
106900*                                                                 10690000
107000* F7 - PREVIOUS PAGE                                              10700000
107100         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   10710000
107200             PERFORM 2110-BROWSE-BACKWARD                         10720000
107300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10730000
107400*                                                                 10740000
107500* F8 - NEXT PAGE                                                  10750000
107600         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   10760000
107700             PERFORM 2120-BROWSE-FORWARD                          10770000
107800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10780000
107900*                                                                 10790000
108000* ENTER KEY                                                       10800000
108100         WHEN DP020-SRC-AID = DP016-ENTER                         10810000
108200             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   10820000
108300             IF  PS-ERROR                                         10830000
108400                 CONTINUE                                         10840000
108500             ELSE                                                 10850000
108600                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             10860000
108700             END-IF                                               10870000
108800                                                                  10880000
108900         WHEN OTHER                                               10890000
109000             SET DP013-NO-ROLLBACK                                10900000
109100                 DP013-XCTL-DISPLAY-RESTART                       10910000
109200                 DP013-CICS-ABEND  TO TRUE                        10920000
109300             MOVE '2100-CHECK-FUNCTION-KEY'                       10930000
109400                                   TO DP013-PARAGRAPH             10940000
109500             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      10950000
109600                                   TO DP013-MESSAGE-TEXT (1)      10960000
109700             PERFORM DP013-0000-PROCESS-ABEND                     10970000
109800     END-EVALUATE.                                                10980000
109900*                                                                 10990000
110000*----------------------------------------------------------------*11000000
110100*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *11010000
110200*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *11020000
110300*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *11030000
110400*    MESSAGE.                                                    *11040000
110500*----------------------------------------------------------------*11050000
110600 2110-BROWSE-BACKWARD.                                            11060000
110700     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    11070000
110800         GIVING PV-TOP-ITEM.                                      11080000
110900*                                                                 11090000
111000     IF  ((PV-TOP-ITEM < +1)                                      11100000
111100       OR (PV-TOP-ITEM = +1))                                     11110000
111200         MOVE +1                   TO PV-TOP-ITEM                 11120000
111300*        -- TOP OF LIST --                                        11130000
111400         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            11140000
111500         SET DP020-MSG-INFORMATIONAL TO TRUE                      11150000
111600     END-IF.                                                      11160000
111700                                                                  11170000
111800*----------------------------------------------------------------*11180000
111900*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *11190000
112000*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *11200000
112100*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *11210000
112200*----------------------------------------------------------------*11220000
112300 2120-BROWSE-FORWARD.                                             11230000
112400                                                                  11240000
112500     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              11250000
112600         GIVING PV-TOP-ITEM.                                      11260000
112700     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   11270000
112800         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             11280000
112900*        -- BOTTOM OF LIST --                                     11290000
113000         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            11300000
113100         SET DP020-MSG-INFORMATIONAL  TO TRUE                     11310000
113200     ELSE                                                         11320000
113300         COMPUTE PV-BOTTOM-ITEM =                                 11330000
113400             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 11340000
113500         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            11350000
113600*            -- BOTTOM OF LIST --                                 11360000
113700             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            11370000
113800             SET DP020-MSG-INFORMATIONAL TO TRUE                  11380000
113900         END-IF                                                   11390000
114000     END-IF.                                                      11400000
114100                                                                  11410000
114200*----------------------------------------------------------------*11420000
114300*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *11430000
114400*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *11440000
114500*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *11450000
114600*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *11460000
114700*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *11470000
114800*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *11480000
114900*----------------------------------------------------------------*11490000
115000 2130-CHECK-FOR-JUMP-BROWSE.                                      11500000
115100     SET PS-NO-ERROR               TO TRUE.                       11510000
115200     IF (ASC-START-ITEM-REQUEST = SPACE)                          11520000
115300         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             11530000
115400     ELSE                                                         11540000
115500         MOVE ASC-START-ITEM-REQUEST TO DP010I-UNEDITED-FIELD     11550000
115600         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       11560000
115700         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     11570000
115800         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  11580000
115910         CALL DP010I-NUMERIC-EDIT-ROUTINE                         11591006
115920                         USING DP010I-NUMERIC-EDIT-AREA           11592006
116000                                                                  11600000
116100         IF  NOT DP010I-ERROR-DETECTED                            11610000
116200             MOVE DP010I-NUMERIC-FIELD TO ASC-START-ITEM-REQUEST-N11620000
116300             IF  ASC-START-ITEM-REQUEST-N > ZERO                  11630000
116400                 IF  ASC-START-ITEM-REQUEST-N >                   11640000
116500                                          ASC-NUMBER-OF-ITEMS-READ11650000
116600                     MOVE SPACE TO ASC-START-ITEM-REQUEST         11660000
116700                     COMPUTE PV-TOP-ITEM =                        11670000
116800                             ASC-NUMBER-OF-ITEMS-READ             11680000
116900                             - PC-ITEMS-PER-PANEL + 1             11690000
117000                     IF  PV-TOP-ITEM < +1                         11700000
117100                         MOVE +1   TO PV-TOP-ITEM                 11710000
117200                         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER 11720000
117300                         SET DP020-MSG-INFORMATIONAL TO TRUE      11730000
117400                     END-IF                                       11740000
117500                 ELSE                                             11750000
117600                     MOVE ASC-START-ITEM-REQUEST-N TO PV-TOP-ITEM 11760000
117700                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      11770000
117800                     COMPUTE PV-BOTTOM-ITEM =                     11780000
117900                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     11790000
118000                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ11800000
118100*                        -- BOTTOM OF LIST --                     11810000
118200                         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER 11820000
118300                         SET DP020-MSG-INFORMATIONAL TO TRUE      11830000
118400                     END-IF                                       11840000
118500                 END-IF                                           11850000
118600             ELSE                                                 11860000
118700*                --- VALUE OUT OF RANGE ----                      11870000
118800                 MOVE PC-TSYMSG-00101  TO DP020-MSG-NUMBER        11880000
118900*                MOVE -1           TO ASTRTITL                    11890000
119000*                SET DP030-SET-CURSOR-APPL-1 TO TRUE              11900000
119100*                MOVE DP015-REVERSE TO ASTRTITH                   11910000
119200*                MOVE DP015-RED    TO ASTRTITC                    11920000
119300*                MOVE DP015-UNP-NUM-BRT-MDT TO ASTRTITA           11930000
119400                 SET DP020-MSG-FATAL                              11940000
119500                     PS-ERROR        TO TRUE                      11950000
119600             END-IF                                               11960000
119700                                                                  11970000
119800         ELSE                                                     11980000
119900             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            11990000
120000*            MOVE -1               TO ASTRTITL                    12000000
120100*            SET DP030-SET-CURSOR-APPL-1 TO TRUE                  12010000
120200*            MOVE DP015-REVERSE    TO ASTRTITH                    12020000
120300*            MOVE DP015-RED        TO ASTRTITC                    12030000
120400*            MOVE DP015-UNP-NUM-BRT-MDT TO ASTRTITA               12040000
120500             SET DP020-MSG-FATAL   TO TRUE                        12050000
120600             SET PS-ERROR          TO TRUE                        12060000
120700         END-IF                                                   12070000
120800     END-IF.                                                      12080000
120900                                                                  12090000
121000*----------------------------------------------------------------*12100000
121100*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *12110000
121200*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *12120000
121300*----------------------------------------------------------------*12130000
121400 2140-DESELECT-ALL-ITEMS.                                         12140000
121500     MOVE +1                       TO ASC-BLK-SUB.                12150000
121600                                                                  12160000
121700     PERFORM 2141-CLEAR-SELECTED-INDS                             12170000
121800         VARYING ASC-ITEM-SUB                                     12180000
121900         FROM 1 BY 1                                              12190000
122000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12200000
122100                                                                  12210000
122200     ADD +1                        TO ASC-BLK-SUB.                12220000
122300                                                                  12230000
122400     PERFORM 2141-CLEAR-SELECTED-INDS                             12240000
122500         VARYING ASC-ITEM-SUB                                     12250000
122600         FROM 1 BY 1                                              12260000
122700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12270000
122800                                                                  12280000
122900     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               12290000
123000                                   TO PV-LIST-ITEM-NUMBER.        12300000
123100                                                                  12310000
123200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            12320000
123300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    12330000
123400                                                                  12340000
123500     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     12350000
123600        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      12360000
123700         MOVE +1                   TO ASC-BLK-SUB                 12370000
123800                                                                  12380000
123900         PERFORM 5100-WRITE-TEMP-STORAGE                          12390000
124000         MOVE +2                   TO ASC-BLK-SUB                 12400000
124100         PERFORM 5100-WRITE-TEMP-STORAGE                          12410000
124200         MOVE +1                   TO ASC-BLK-SUB                 12420000
124300                                                                  12430000
124400         MOVE +1                   TO PV-BLOCK-NUMBER             12440000
124500                                                                  12450000
124600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         12460000
124700             PV-FIRST-BLOCK-IN-ARRAY - 1                          12470000
124800                                                                  12480000
124900         PERFORM                                                  12490000
125000             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       12500000
125100                                                                  12510000
125200             PERFORM 4410-READ-TEMP-STORAGE                       12520000
125300                                                                  12530000
125400             PERFORM 2141-CLEAR-SELECTED-INDS                     12540000
125500                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 12550000
125600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12560000
125700                                                                  12570000
125800             PERFORM 5100-WRITE-TEMP-STORAGE                      12580000
125900                                                                  12590000
126000             ADD +1                TO PV-BLOCK-NUMBER             12600000
126100                                                                  12610000
126200         END-PERFORM                                              12620000
126300                                                                  12630000
126400         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         12640000
126500             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     12650000
126600                                                                  12660000
126700         PERFORM                                                  12670000
126800             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       12680000
126900                   ASC-HIGHEST-BLOCK-WRITTEN                      12690000
127000                                                                  12700000
127100             MOVE PV-NEXT-BLOCK-IN-ARRAY                          12710000
127200                                   TO PV-BLOCK-NUMBER             12720000
127300                                                                  12730000
127400             PERFORM 4410-READ-TEMP-STORAGE                       12740000
127500                                                                  12750000
127600             PERFORM 2141-CLEAR-SELECTED-INDS                     12760000
127700                 VARYING ASC-ITEM-SUB                             12770000
127800                 FROM 1 BY 1                                      12780000
127900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12790000
128000                                                                  12800000
128100             PERFORM 5100-WRITE-TEMP-STORAGE                      12810000
128200                                                                  12820000
128300             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      12830000
128400         END-PERFORM                                              12840000
128500                                                                  12850000
128600         MOVE PV-FIRST-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER          12860000
128700         PERFORM 4410-READ-TEMP-STORAGE                           12870000
128800     END-IF.                                                      12880000
128900                                                                  12890000
129000                                                                  12900000
129100     MOVE +0                      TO ASC-NUMBER-OF-SELECTED-ITEMS.12910000
129200     MOVE +0                      TO ASC-START-OF-SELECTED-RANGE. 12920000
129300     MOVE +0                      TO ASC-END-OF-SELECTED-RANGE.   12930000
129400                                                                  12940000
129500     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        12950000
129600                                                                  12960000
129700*----------------------------------------------------------------*12970000
129800*    MARK EACH ITEM AS BEING NOT SELECTED.                       *12980000
129900*----------------------------------------------------------------*12990000
130000 2141-CLEAR-SELECTED-INDS.                                        13000000
130100                                                                  13010000
130200     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           13020000
130300             NOT EQUAL ZERO                                       13030000
130400         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          13040000
130500             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          13050000
130600                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    13060000
130700                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  13070000
130800                                   TO TRUE                        13080000
130900         END-IF                                                   13090000
131000     END-IF.                                                      13100000
131100                                                                  13110000
131200*----------------------------------------------------------------*13120000
131300*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *13130000
131400*  FOR ALL ITEMS.                                                *13140000
131500*----------------------------------------------------------------*13150000
131600 2150-SELECT-ALL-ITEMS.                                           13160000
131700                                                                  13170000
131800     MOVE +1                       TO ASC-BLK-SUB.                13180000
131900                                                                  13190000
132000     PERFORM 2151-SET-SELECTED-INDS                               13200000
132100         VARYING ASC-ITEM-SUB                                     13210000
132200         FROM 1 BY 1                                              13220000
132300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13230000
132400                                                                  13240000
132500     ADD +1                        TO ASC-BLK-SUB.                13250000
132600                                                                  13260000
132700     PERFORM 2151-SET-SELECTED-INDS                               13270000
132800         VARYING ASC-ITEM-SUB                                     13280000
132900         FROM 1 BY 1                                              13290000
133000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13300000
133100                                                                  13310000
133200     MOVE ASC-LIST-ITEM-NUMBER(1 1) TO PV-LIST-ITEM-NUMBER.       13320000
133300                                                                  13330000
133400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            13340000
133500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    13350000
133600                                                                  13360000
133700     IF  PV-FIRST-BLOCK-IN-ARRAY  = +1                            13370000
133800         MOVE +1                   TO ASC-BLK-SUB                 13380000
133900                                                                  13390000
134000         PERFORM 5100-WRITE-TEMP-STORAGE                          13400000
134100         MOVE +2                   TO ASC-BLK-SUB                 13410000
134200         PERFORM 5100-WRITE-TEMP-STORAGE                          13420000
134300         MOVE +1                   TO ASC-BLK-SUB                 13430000
134400         MOVE +1                   TO PV-BLOCK-NUMBER             13440000
134500     END-IF.                                                      13450000
134600*                                                                 13460000
134700     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     13470000
134800        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    13480000
134900         MOVE +1                   TO ASC-BLK-SUB                 13490000
135000                                                                  13500000
135100         PERFORM 5100-WRITE-TEMP-STORAGE                          13510000
135200         MOVE +2                   TO ASC-BLK-SUB                 13520000
135300         PERFORM 5100-WRITE-TEMP-STORAGE                          13530000
135400         MOVE +1                   TO ASC-BLK-SUB                 13540000
135500         MOVE +1                   TO PV-BLOCK-NUMBER             13550000
135600                                                                  13560000
135700         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         13570000
135800             PV-FIRST-BLOCK-IN-ARRAY - 1                          13580000
135900                                                                  13590000
136000         PERFORM                                                  13600000
136100             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       13610000
136200                                                                  13620000
136300             PERFORM 4410-READ-TEMP-STORAGE                       13630000
136400                                                                  13640000
136500             PERFORM 2151-SET-SELECTED-INDS                       13650000
136600                 VARYING ASC-ITEM-SUB                             13660000
136700                 FROM 1 BY 1                                      13670000
136800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13680000
136900                                                                  13690000
137000             PERFORM 5100-WRITE-TEMP-STORAGE                      13700000
137100                                                                  13710000
137200             ADD +1                TO PV-BLOCK-NUMBER             13720000
137300                                                                  13730000
137400         END-PERFORM                                              13740000
137500                                                                  13750000
137600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         13760000
137700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     13770000
137800                                                                  13780000
137900         PERFORM                                                  13790000
138000             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       13800000
138100                   ASC-HIGHEST-BLOCK-WRITTEN                      13810000
138200                                                                  13820000
138300             MOVE PV-NEXT-BLOCK-IN-ARRAY                          13830000
138400                                   TO PV-BLOCK-NUMBER             13840000
138500                                                                  13850000
138600             PERFORM 4410-READ-TEMP-STORAGE                       13860000
138700                                                                  13870000
138800             PERFORM 2151-SET-SELECTED-INDS                       13880000
138900                 VARYING ASC-ITEM-SUB                             13890000
139000                 FROM 1 BY 1                                      13900000
139100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13910000
139200                                                                  13920000
139300             PERFORM 5100-WRITE-TEMP-STORAGE                      13930000
139400                                                                  13940000
139500             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      13950000
139600                                                                  13960000
139700         END-PERFORM                                              13970000
139800                                                                  13980000
139900         MOVE PV-FIRST-BLOCK-IN-ARRAY                             13990000
140000                                   TO PV-BLOCK-NUMBER             14000000
140100                                                                  14010000
140200         PERFORM 4410-READ-TEMP-STORAGE                           14020000
140300     END-IF.                                                      14030000
140400                                                                  14040000
140500                                                                  14050000
140600     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             14060000
140700                       ASC-NUMBER-OF-SELECTED-ITEMS.              14070000
140800                                                                  14080000
140900     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        14090000
141000                                                                  14100000
141100*----------------------------------------------------------------*14110000
141200*    MARK EACH ITEM AS BEING SELECTED.                           *14120000
141300*----------------------------------------------------------------*14130000
141400 2151-SET-SELECTED-INDS.                                          14140000
141500                                                                  14150000
141600     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           14160000
141700             NOT EQUAL ZERO                                       14170000
141800         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             14180000
141900             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             14190000
142000                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        14200000
142100                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  14210000
142200                               TO  TRUE                           14220000
142300         END-IF                                                   14230000
142400     END-IF.                                                      14240000
142500                                                                  14250000
142600******************************************************************14260000
142700** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **14270000
142800** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **14280000
142900******************************************************************14290000
143000 2200-MOVE-SCREEN-TO-COMMAREA.                                    14300000
143100                                                                  14310000
143200     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             14320000
143300     MOVE +1                       TO PV-SUB.                     14330000
143400*                                                                 14340000
143500     PERFORM 3100-SET-SUBSCRIPTS.                                 14350000
143600*    IF  ASTRTITL > ZERO                                          14360000
143700*        MOVE ASTRTITI        TO ASC-START-ITEM-REQUEST           14370000
143800*    ELSE                                                         14380000
143900*        IF  ASTRTITF = DP015-ERASE-EOF                           14390000
144000*            INITIALIZE ASC-START-ITEM-REQUEST                    14400000
144100*        END-IF                                                   14410000
144200*    END-IF.                                                      14420000
144300                                                                  14430000
144400     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          14440000
144500         VARYING PV-SUB                                           14450000
144600         FROM 1 BY 1                                              14460000
144700         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      14470000
144800******************************************************************14480000
144900** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**14490000
145000******************************************************************14500000
145100 2210-MOVE-LINES-TO-COMMAREA.                                     14510000
145200*    IF  MR-SELECTL (PV-SUB) > ZERO                               14520000
145300*        SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             14530000
145400*        MOVE MR-SELECTI (PV-SUB)                                 14540000
145500*                                  TO ASC-TEMP-SELECTED-SW        14550000
145600*                                (ASC-BLK-SUB, ASC-ITEM-SUB)      14560000
145700*    ELSE                                                         14570000
145800*        IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                14580000
145900*                SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     14590000
146000*                MOVE SPACE        TO ASC-TEMP-SELECTED-SW        14600000
146100*                                (ASC-BLK-SUB, ASC-ITEM-SUB)      14610000
146200*        END-IF                                                   14620000
146300*    END-IF.                                                      14630000
146400     ADD +1                        TO ASC-ITEM-SUB.               14640000
146500     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        14650000
146600         ADD +1                    TO ASC-BLK-SUB                 14660000
146700         MOVE +1                   TO ASC-ITEM-SUB                14670000
146800     END-IF.                                                      14680000
146900******************************************************************14690000
147000** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **14700000
147100** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **14710000
147200******************************************************************14720000
147300 3000-EDIT-DATA-IN-COMMAREA.                                      14730000
147400     SET PS-NO-ERROR               TO TRUE.                       14740000
147500     PERFORM 3200-RESET-ATTRIBUTES.                               14750000
147600     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     14760000
147700                                                                  14770000
147800**                                                                14780000
147900* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              14790000
148000* EDITTING IS DONE FROM THE BOTTOM UP.                            14800000
148100**                                                                14810000
148200     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       14820000
148300         ASC-ITEMS-DISPLAYED - 1.                                 14830000
148400     PERFORM 3100-SET-SUBSCRIPTS.                                 14840000
148500                                                                  14850000
148600     IF  PS-NO-ERROR                                              14860000
148700         PERFORM 3005-EDIT-COMMAREA-BLOCKS                        14870000
148800     END-IF.                                                      14880000
148900*                                                                 14890000
149000     IF  PS-NO-ERROR                                              14900000
149100         PERFORM 3400-CHECK-RANGE-SEQUENCE                        14910000
149200     END-IF.                                                      14920000
149300*                                                                 14930000
149400     IF  ((PS-NO-ERROR)                                           14940000
149500       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   14950000
149600       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    14960000
149700             PERFORM 3500-MARK-RANGE-AS-SELECTED                  14970000
149800     END-IF.                                                      14980000
149900                                                                  14990000
150000*----------------------------------------------------------------*15000000
150100*   3005-EDIT-COMMAREA-BLOCKS                                    *15010000
150200*----------------------------------------------------------------*15020000
150300 3005-EDIT-COMMAREA-BLOCKS.                                       15030000
150400     MOVE +1                       TO PV-BLOCK-NUMBER.            15040000
150500     MOVE +1                       TO ASC-BLK-SUB.                15050000
150600     MOVE PC-ITEMS-PER-PANEL       TO ASC-ITEM-SUB.               15060000
150700                                                                  15070000
150800     COMPUTE PV-BLOCK-NUMBER  =                                   15080000
150900        1 + ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) /                 15090000
151000            PC-ITEMS-PER-PANEL.                                   15100000
151100                                                                  15110000
151200     MOVE  PV-BLOCK-NUMBER         TO PV-ORIGINAL-BLOCK.          15120000
151300                                                                  15130000
151400     PERFORM                                                      15140000
151500       UNTIL PV-BLOCK-NUMBER > ASC-HIGHEST-BLOCK-WRITTEN          15150000
151600          OR PS-ERROR                                             15160000
151700          OR PS-BLOCK-ERROR                                       15170000
151800                                                                  15180000
151900             COMPUTE PV-ITEMS-HOLD  =                             15190000
152000                     ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +        15200000
152100                     PC-ITEMS-PER-PANEL - 1                       15210000
152200                                                                  15220000
152300             IF  PV-ITEMS-HOLD  >  ASC-NUMBER-OF-ITEMS-READ       15230000
152400                 SUBTRACT  ASC-NUMBER-OF-ITEMS-READ               15240000
152500                     FROM  PV-ITEMS-HOLD                          15250000
152600                   GIVING  PV-ITEMS-DIFF                          15260000
152700                 SUBTRACT  PV-ITEMS-DIFF                          15270000
152800                     FROM  PC-ITEMS-PER-PANEL                     15280000
152900                   GIVING  PV-ITEMS-HOLD                          15290000
153000                     MOVE  PV-ITEMS-HOLD  TO  PV-SUB              15300000
153100                                              ASC-ITEM-SUB        15310000
153200                                              ASC-ITEMS-DISPLAYED 15320000
153300             ELSE                                                 15330000
153400                 MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB              15340000
153500                 MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB        15350000
153600             END-IF                                               15360000
153700                                                                  15370000
153800             PERFORM 3300-EDIT-SELECTIONS                         15380000
153900                     VARYING PV-SUB                               15390000
154000                        FROM PV-SUB BY -1                         15400000
154100                       UNTIL PV-SUB < +1                          15410000
154200                                                                  15420000
154300             MOVE +1               TO ASC-BLK-SUB                 15430000
154400                                                                  15440000
154500             PERFORM 5105-REWRITE-ASC-LISTQ                       15450000
154600                                                                  15460000
154700             MOVE +1                TO ASC-BLK-SUB                15470000
154800                                                                  15480000
154900             IF  PS-BLOCK-ERROR                                   15490000
155000                 SET  PS-ERROR     TO TRUE                        15500000
155100                 MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)        15510000
155200                                   TO PV-TOP-ITEM                 15520000
155300             ELSE                                                 15530000
155400                 ADD  +1           TO PV-BLOCK-NUMBER             15540000
155500                 IF  PV-BLOCK-NUMBER >                            15550000
155600                     ASC-HIGHEST-BLOCK-WRITTEN                    15560000
155700                     MOVE +2       TO ASC-BLK-SUB                 15570000
155800                     PERFORM 4410-READ-TEMP-STORAGE               15580000
155900                     MOVE +1       TO ASC-BLK-SUB                 15590000
156000                 ELSE                                             15600000
156100                     PERFORM 4410-READ-TEMP-STORAGE               15610000
156200                     ADD  +1        TO PV-BLOCK-NUMBER            15620000
156300                     MOVE +2        TO ASC-BLK-SUB                15630000
156400                     PERFORM 4410-READ-TEMP-STORAGE               15640000
156500                     SUBTRACT +1  FROM PV-BLOCK-NUMBER            15650000
156600                     MOVE +1        TO ASC-BLK-SUB                15660000
156700                 END-IF                                           15670000
156800             END-IF                                               15680000
156900     END-PERFORM.                                                 15690000
157000                                                                  15700000
157100     IF  PV-ORIGINAL-BLOCK  = +1    OR                            15710000
157200         PS-ERROR                   OR                            15720000
157300         PS-BLOCK-ERROR                                           15730000
157400         CONTINUE                                                 15740000
157500     ELSE                                                         15750000
157600         MOVE +1                 TO PV-BLOCK-NUMBER               15760000
157700         MOVE +1                 TO ASC-BLK-SUB                   15770000
157800         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  15780000
157900         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEMS-DISPLAYED           15790000
158000         PERFORM 4410-READ-TEMP-STORAGE                           15800000
158100                                                                  15810000
158200         PERFORM                                                  15820000
158300           UNTIL PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK              15830000
158400              OR PS-ERROR                                         15840000
158500              OR PS-BLOCK-ERROR                                   15850000
158600                                                                  15860000
158700                 COMPUTE PV-ITEMS-HOLD  =                         15870000
158800                         ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +    15880000
158900                         PC-ITEMS-PER-PANEL - 1                   15890000
159000                                                                  15900000
159100                 IF  PV-ITEMS-HOLD > ASC-NUMBER-OF-ITEMS-READ     15910000
159200                     SUBTRACT  ASC-NUMBER-OF-ITEMS-READ           15920000
159300                         FROM  PV-ITEMS-HOLD                      15930000
159400                       GIVING  PV-ITEMS-DIFF                      15940000
159500                     SUBTRACT  PV-ITEMS-DIFF                      15950000
159600                         FROM  PC-ITEMS-PER-PANEL                 15960000
159700                       GIVING  PV-ITEMS-HOLD                      15970000
159800                         MOVE  PV-ITEMS-HOLD TO PV-SUB            15980000
159900                                                ASC-ITEM-SUB      15990000
160000                                               ASC-ITEMS-DISPLAYED16000000
160100                 ELSE                                             16010000
160200                     MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB          16020000
160300                     MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB    16030000
160400                 END-IF                                           16040000
160500                                                                  16050000
160600                 PERFORM 3300-EDIT-SELECTIONS                     16060000
160700                         VARYING PV-SUB                           16070000
160800                            FROM PV-SUB BY -1                     16080000
160900                           UNTIL PV-SUB < +1                      16090000
161000                                                                  16100000
161100                 MOVE +1               TO ASC-BLK-SUB             16110000
161200                                                                  16120000
161300                 PERFORM 5105-REWRITE-ASC-LISTQ                   16130000
161400                                                                  16140000
161500                 MOVE +1                TO ASC-BLK-SUB            16150000
161600                                                                  16160000
161700                 IF  PS-BLOCK-ERROR                               16170000
161800                     SET  PS-ERROR     TO TRUE                    16180000
161900                     MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)    16190000
162000                                       TO PV-TOP-ITEM             16200000
162100                 ELSE                                             16210000
162200                     ADD  +1            TO PV-BLOCK-NUMBER        16220000
162300                     IF  PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK      16230000
162400                         MOVE +2        TO ASC-BLK-SUB            16240000
162500                         PERFORM 4410-READ-TEMP-STORAGE           16250000
162600                         MOVE +1        TO ASC-BLK-SUB            16260000
162700                     ELSE                                         16270000
162800                         PERFORM 4410-READ-TEMP-STORAGE           16280000
162900                         ADD  +1        TO PV-BLOCK-NUMBER        16290000
163000                         MOVE +2        TO ASC-BLK-SUB            16300000
163100                         PERFORM 4410-READ-TEMP-STORAGE           16310000
163200                         SUBTRACT +1  FROM PV-BLOCK-NUMBER        16320000
163300                         MOVE +1        TO ASC-BLK-SUB            16330000
163400                     END-IF                                       16340000
163500                 END-IF                                           16350000
163600     END-PERFORM.                                                 16360000
163700                                                                  16370000
163800*----------------------------------------------------------------*16380000
163900*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *16390000
164000*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*16400000
164100*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *16410000
164200*                                                                *16420000
164300*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *16430000
164400*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *16440000
164500*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *16450000
164600*    US IN THE 2ND BLOCK OF THE ARRAY.                           *16460000
164700*----------------------------------------------------------------*16470000
164800 3100-SET-SUBSCRIPTS.                                             16480000
164900                                                                  16490000
165000     COMPUTE ASC-ITEM-SUB =                                       16500000
165100         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        16510000
165200                                                                  16520000
165300     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         16530000
165400         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            16540000
165500         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               16550000
165600     ELSE                                                         16560000
165700         MOVE +1                     TO ASC-BLK-SUB               16570000
165800     END-IF.                                                      16580000
165900******************************************************************16590000
166000** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **16600000
166100******************************************************************16610000
166200 3200-RESET-ATTRIBUTES.                                           16620000
166300*    MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   16630000
166400*    MOVE DP015-GREEN              TO ASTRTITC.                   16640000
166500*    MOVE DP015-UNDERLINE          TO ASTRTITH.                   16650000
166600                                                                  16660000
166700*    PERFORM                                                      16670000
166800*        VARYING PV-SUB                                           16680000
166900*        FROM 1 BY 1                                              16690000
167000*        UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        16700000
167100*            MOVE DP015-UNP-ALP-NOR-OFF TO MR-SELECTA (PV-SUB)    16710000
167200*            MOVE DP015-GREEN         TO MR-SELECTC (PV-SUB)      16720000
167300*            MOVE DP015-UNDERLINE     TO MR-SELECTH (PV-SUB)      16730000
167400*    END-PERFORM.                                                 16740000
167500                                                                  16750000
167600******************************************************************16760000
167700** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **16770000
167800** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **16780000
167900** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **16790000
168000** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **16800000
168100******************************************************************16810000
168200 3300-EDIT-SELECTIONS.                                            16820000
168300     EVALUATE TRUE                                                16830000
168400         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     16840000
168500             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         16850000
168600                 CONTINUE                                         16860000
168700         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         16870000
168800             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        16880000
168900                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   16890000
169000                 MOVE ASC-TEMP-SELECTED-SW                        16900000
169100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16910000
169200                                TO ASC-SELECTED-SW                16920000
169300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16930000
169400             END-IF                                               16940000
169500         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     16950000
169600                 = SPACE                                          16960000
169700             EVALUATE TRUE                                        16970000
169800                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       16980000
169900                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS16990000
170000                     MOVE SPACE TO ASC-SELECTED-SW                17000000
170100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  17010000
170200                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        17020000
170300                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    17030000
170400                     MOVE SPACE TO ASC-SELECTED-SW                17040000
170500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  17050000
170600                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          17060000
170700                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      17070000
170800                     MOVE SPACE TO ASC-SELECTED-SW                17080000
170900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  17090000
171000             END-EVALUATE                                         17100000
171100         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           17110000
171200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            17120000
171300                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    17130000
171400             END-IF                                               17140000
171500             PERFORM 3310-EDIT-RANGE                              17150000
171600         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             17160000
171700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            17170000
171800                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    17180000
171900             END-IF                                               17190000
172000             PERFORM 3310-EDIT-RANGE                              17200000
172100         WHEN OTHER                                               17210000
172200             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           17220000
172300             SET DP020-MSG-FATAL    TO TRUE                       17230000
172400*            MOVE -1                TO MR-SELECTL (PV-SUB)        17240000
172500             SET DP030-SET-CURSOR-APPL-1                          17250000
172600                                    TO TRUE                       17260000
172700*            MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        17270000
172800*            MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        17280000
172900             SET PS-ERROR TO TRUE                                 17290000
173000             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            17300000
173100                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     17310000
173200                 MOVE SPACE         TO ASC-SELECTED-SW            17320000
173300                                        (ASC-BLK-SUB ASC-ITEM-SUB)17330000
173400             END-IF                                               17340000
173500     END-EVALUATE.                                                17350000
173600                                                                  17360000
173700     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 17370000
173800     SUBTRACT +1 FROM ASC-ITEM-SUB.                               17380000
173900     IF  ASC-ITEM-SUB < 1                                         17390000
174000         SUBTRACT +1 FROM ASC-BLK-SUB                             17400000
174100         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                17410000
174200     END-IF.                                                      17420000
174300                                                                  17430000
174400******************************************************************17440000
174500** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **17450000
174600** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **17460000
174700** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**17470000
174800** THE ENDING.                                                  **17480000
174900******************************************************************17490000
175000 3310-EDIT-RANGE.                                                 17500000
175100     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                17510000
175200         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   17520000
175300             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)17530000
175400                                   TO ASC-SELECTED-SW             17540000
175500                                        (ASC-BLK-SUB ASC-ITEM-SUB)17550000
175600             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 17560000
175700         ELSE                                                     17570000
175800             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     17580000
175900                 CONTINUE                                         17590000
176000             ELSE                                                 17600000
176100*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        17610000
176200                 MOVE PC-TSYMSG-00054                             17620000
176300                                       TO DP020-MSG-NUMBER        17630000
176400*                MOVE -1               TO MR-SELECTL (PV-SUB)     17640000
176500*                MOVE DP015-RED        TO MR-SELECTC (PV-SUB)     17650000
176600*                MOVE DP015-UNDERLINE  TO MR-SELECTH (PV-SUB)     17660000
176700                 SET DP020-MSG-FATAL                              17670000
176800                     DP030-SET-CURSOR-APPL-1                      17680000
176900                     PS-ERROR          TO TRUE                    17690000
177000             END-IF                                               17700000
177100         END-IF                                                   17710000
177200     ELSE                                                         17720000
177300         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     17730000
177400             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 17740000
177500                                   TO ASC-SELECTED-SW             17750000
177600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   17760000
177700             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   17770000
177800         ELSE                                                     17780000
177900             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       17790000
178000                 CONTINUE                                         17800000
178100             ELSE                                                 17810000
178200*                -- ONLY ONE END-OF-RANGE ALLOWED --              17820000
178300                 MOVE PC-TSYMSG-00055                             17830000
178400                                        TO DP020-MSG-NUMBER       17840000
178500*                MOVE -1                TO MR-SELECTL (PV-SUB)    17850000
178600                 SET DP020-MSG-FATAL                              17860000
178700                     DP030-SET-CURSOR-APPL-1                      17870000
178800                     PS-ERROR           TO TRUE                   17880000
178900             END-IF                                               17890000
179000         END-IF                                                   17900000
179100     END-IF.                                                      17910000
179200*                                                                 17920000
179300******************************************************************17930000
179400** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **17940000
179500** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **17950000
179600******************************************************************17960000
179700 3400-CHECK-RANGE-SEQUENCE.                                       17970000
179800     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       17980000
179900       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      17990000
180000       AND  ASC-START-OF-SELECTED-RANGE >                         18000000
180100                                         ASC-END-OF-SELECTED-RANGE18010000
180200*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                18020000
180300         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 18030000
180400         SET DP020-MSG-FATAL TO TRUE                              18040000
180500         SET PS-ERROR TO TRUE                                     18050000
180600         PERFORM 3410-POSITION-AT-ERROR                           18060000
180700     END-IF.                                                      18070000
180800******************************************************************18080000
180900** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **18090000
181000** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **18100000
181100** SHOULD BE POSITIONED ON A RANGE ERROR.                       **18110000
181200******************************************************************18120000
181300 3410-POSITION-AT-ERROR.                                          18130000
181400     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       18140000
181500     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 18150000
181600                    - PV-TOP-ITEM + 1.                            18160000
181700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      18170000
181800         CONTINUE                                                 18180000
181900*    ELSE                                                         18190000
182000*        MOVE -1                   TO MR-SELECTL (PV-SUB)         18200000
182100*        MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         18210000
182200*        MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         18220000
182300     END-IF.                                                      18230000
182400*                                                                 18240000
182500     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   18250000
182600                    - PV-TOP-ITEM + 1.                            18260000
182700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      18270000
182800         CONTINUE                                                 18280000
182900*    ELSE                                                         18290000
183000*        MOVE -1                   TO MR-SELECTL (PV-SUB)         18300000
183100*        MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         18310000
183200*        MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         18320000
183300     END-IF.                                                      18330000
183400                                                                  18340000
183500*----------------------------------------------------------------*18350000
183600*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *18360000
183700*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *18370000
183800*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *18380000
183900*----------------------------------------------------------------*18390000
184000 3500-MARK-RANGE-AS-SELECTED.                                     18400000
184100     MOVE +1                       TO  ASC-BLK-SUB.               18410000
184200     PERFORM 3510-MARK-SELECTED-INDS                              18420000
184300         VARYING ASC-ITEM-SUB                                     18430000
184400         FROM 1 BY 1                                              18440000
184500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 18450000
184600                                                                  18460000
184700     ADD +1                        TO ASC-BLK-SUB.                18470000
184800     PERFORM 3510-MARK-SELECTED-INDS                              18480000
184900         VARYING ASC-ITEM-SUB                                     18490000
185000         FROM 1 BY 1                                              18500000
185100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 18510000
185200                                                                  18520000
185300     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               18530000
185400                                   TO  PV-LIST-ITEM-NUMBER.       18540000
185500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            18550000
185600         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         18560000
185700               PC-ITEMS-PER-PANEL).                               18570000
185800                                                                  18580000
185900     MOVE ASC-START-OF-SELECTED-RANGE                             18590000
186000                                   TO PV-START-OF-SELECTED-RANGE. 18600000
186100     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            18610000
186200         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  18620000
186300               PC-ITEMS-PER-PANEL).                               18630000
186400                                                                  18640000
186500     MOVE ASC-END-OF-SELECTED-RANGE                               18650000
186600                                   TO  PV-END-OF-SELECTED-RANGE.  18660000
186700     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             18670000
186800         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    18680000
186900               PC-ITEMS-PER-PANEL).                               18690000
187000     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             18700000
187100         PV-FIRST-BLOCK-IN-ARRAY + 1.                             18710000
187200                                                                  18720000
187300     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    18730000
187400        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        18740000
187500         MOVE +1                   TO ASC-BLK-SUB                 18750000
187600         PERFORM 5100-WRITE-TEMP-STORAGE                          18760000
187700         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         18770000
187800             PV-FIRST-BLOCK-IN-ARRAY - 1                          18780000
187900                                                                  18790000
188000         PERFORM                                                  18800000
188100             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      18810000
188200                   PV-PREV-BLOCK-IN-ARRAY                         18820000
188300             MOVE PV-FIRST-BLOCK-IN-RANGE                         18830000
188400                                   TO PV-BLOCK-NUMBER             18840000
188500             PERFORM 4410-READ-TEMP-STORAGE                       18850000
188600             PERFORM 3510-MARK-SELECTED-INDS                      18860000
188700                 VARYING ASC-ITEM-SUB                             18870000
188800                 FROM 1 BY 1                                      18880000
188900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          18890000
189000             PERFORM 5100-WRITE-TEMP-STORAGE                      18900000
189100             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     18910000
189200         END-PERFORM                                              18920000
189300                                                                  18930000
189400         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         18940000
189500             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     18950000
189600         PERFORM                                                  18960000
189700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       18970000
189800                   PV-LAST-BLOCK-IN-RANGE                         18980000
189900             MOVE PV-NEXT-BLOCK-IN-ARRAY                          18990000
190000                                   TO PV-BLOCK-NUMBER             19000000
190100             PERFORM 4410-READ-TEMP-STORAGE                       19010000
190200             PERFORM 3510-MARK-SELECTED-INDS                      19020000
190300                 VARYING ASC-ITEM-SUB                             19030000
190400                 FROM 1 BY 1                                      19040000
190500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          19050000
190600             PERFORM 5100-WRITE-TEMP-STORAGE                      19060000
190700             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      19070000
190800         END-PERFORM                                              19080000
190900                                                                  19090000
191000         MOVE PV-FIRST-BLOCK-IN-ARRAY                             19100000
191100                                   TO PV-BLOCK-NUMBER             19110000
191200         PERFORM 4410-READ-TEMP-STORAGE                           19120000
191300     END-IF.                                                      19130000
191400                                                                  19140000
191500     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 19150000
191600                                      ASC-END-OF-SELECTED-RANGE.  19160000
191700                                                                  19170000
191800*----------------------------------------------------------------*19180000
191900* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *19190000
192000*----------------------------------------------------------------*19200000
192100 3510-MARK-SELECTED-INDS.                                         19210000
192200                                                                  19220000
192300     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         19230000
192400                                ASC-ITEM-SUB) >                   19240000
192500         ASC-START-OF-SELECTED-RANGE)                             19250000
192600     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         19260000
192700                                ASC-ITEM-SUB) =                   19270000
192800         ASC-START-OF-SELECTED-RANGE)                             19280000
192900                                                                  19290000
193000         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     19300000
193100                                    ASC-ITEM-SUB) <               19310000
193200             ASC-END-OF-SELECTED-RANGE)                           19320000
193300         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     19330000
193400                                    ASC-ITEM-SUB) =               19340000
193500             ASC-END-OF-SELECTED-RANGE)                           19350000
193600                                                                  19360000
193700             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          19370000
193800                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   19380000
193900                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   19390000
194000                               TO TRUE                            19400000
194100                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              19410000
194200                               TO TRUE                            19420000
194300                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    19430000
194400             END-IF                                               19440000
194500         END-IF                                                   19450000
194600     END-IF.                                                      19460000
194700                                                                  19470000
194800*----------------------------------------------------------------*19480000
194900*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *19490000
195000*    INITIALIZE ALL COUNTERS AND FLAGS.                          *19500000
195100*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *19510000
195200*    DISPLAY THE PANEL TO USER.                                  *19520000
195300*----------------------------------------------------------------*19530000
195400 4000-BUILD-INITIAL-PANEL.                                        19540000
195500                                                                  19550000
195600     INITIALIZE        ASC-BLOCK-ENTRIES (1)                      19560000
195700                       ASC-BLOCK-ENTRIES (2).                     19570000
195800     MOVE +1                   TO ASC-BLK-SUB.                    19580000
195900     SET ASC-ITEMS-LEFT-ON-DB  TO TRUE.                           19590000
196000                                                                  19600000
196100     MOVE +0           TO ASC-ITEM-SUB                            19610000
196200                          ASC-NUMBER-OF-ITEMS-READ                19620000
196300                          ASC-NUMBER-OF-SELECTED-ITEMS            19630000
196400                          ASC-HIGHEST-BLOCK-WRITTEN               19640000
196500                          ASC-START-OF-SELECTED-RANGE             19650000
196600                          ASC-END-OF-SELECTED-RANGE               19660000
196700                          ASC-ITEM-AT-TOP-OF-PANEL.               19670000
196800                                                                  19680000
196900     PERFORM 4010-OPEN-SHIFT-CURSOR.                              19690000
197000     PERFORM 4300-READ-ITEMS-FROM-DB.                             19700000
197100     PERFORM 4020-CLOSE-SHIFT-CURSOR.                             19710000
197200                                                                  19720000
197300     MOVE +1                   TO  PV-TOP-ITEM.                   19730000
197400     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          19740000
197500         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    19750000
197600         SET DP020-MSG-FATAL   TO  TRUE                           19760000
197700         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               19770000
197800     ELSE                                                         19780000
197900*        MOVE -1               TO MR-SELECTL (1)                  19790000
198000         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      19800000
198100         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     19810000
198200     END-IF.                                                      19820000
198300                                                                  19830000
198400*----------------------------------------------------------------*19840000
198500* OPEN THE SHIFT CURSOR                                           19850000
198600*----------------------------------------------------------------*19860000
198700 4010-OPEN-SHIFT-CURSOR.                                          19870000
198800     PERFORM                                                      19880000
198900         WITH TEST AFTER                                          19890000
199000         VARYING PV-RETRY-COUNTER                                 19900000
199100         FROM 1 BY 1                                              19910000
199200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               19920000
199300                   OR (SQLCODE = ZERO))                           19930000
199400                                                                  19940000
199500                 EXEC SQL                                         19950000
199600                      OPEN SHIFT-CSR                              19960000
199700                 END-EXEC                                         19970000
199800                                                                  19980000
199900         EVALUATE TRUE                                            19990000
200000             WHEN SQLCODE = ZERO                                  20000000
200100                  SET  PS-INITIAL-FETCH  TO TRUE                  20010000
200200             WHEN SQLCODE = -904                                  20020000
200300             WHEN SQLCODE = -913                                  20030000
200400                 CONTINUE                                         20040000
200500             WHEN SQLWARN0 NOT = SPACES                           20050000
200600             WHEN SQLCODE < ZERO                                  20060000
200700             WHEN SQLCODE > ZERO                                  20070000
200800                 MOVE '4010-OPEN-SHIFT-CURSOR' TO DP013-PARAGRAPH 20080000
200900                 MOVE 'OPEN CURSOR PROBLEM    - '                 20090000
201000                                   TO DP013-MESSAGE-TEXT (1)      20100000
201100                 MOVE SQLCA        TO DP013-SQLCA                 20110000
201200                 MOVE 'PCT_SHFT ' TO DP013-DB2-TABLE-NAME (1)     20120000
201300                 SET DP013-DB2-ABEND                              20130000
201400                     DP013-XCTL-DISPLAY-RESTART TO TRUE           20140000
201500                 PERFORM DP013-0000-PROCESS-ABEND                 20150000
201600         END-EVALUATE                                             20160000
201700     END-PERFORM.                                                 20170000
201800*                                                                 20180000
201900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        20190000
202000         MOVE '4010-OPEN-SHIFT-CURSOR'   TO DP013-PARAGRAPH       20200000
202100         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   20210000
202200                                   TO DP013-MESSAGE-TEXT (1)      20220000
202300         MOVE SQLCA                TO DP013-SQLCA                 20230000
202400         MOVE 'PCT_SHFT '      TO DP013-DB2-TABLE-NAME (1)        20240000
202500         SET DP013-DB2-ABEND                                      20250000
202600             DP013-XCTL-DISPLAY-RESTART TO TRUE                   20260000
202700         PERFORM DP013-0000-PROCESS-ABEND                         20270000
202800     END-IF.                                                      20280000
202900                                                                  20290000
203000*----------------------------------------------------------------*20300000
203100* CLOSE THE SHIFT CURSOR.                                         20310000
203200*----------------------------------------------------------------*20320000
203300 4020-CLOSE-SHIFT-CURSOR.                                         20330000
203400                                                                  20340000
203500             EXEC SQL                                             20350000
203600                 CLOSE SHIFT-CSR                                  20360000
203700             END-EXEC                                             20370000
203800                                                                  20380000
203900     EVALUATE TRUE                                                20390000
204000         WHEN SQLCODE = ZERO                                      20400000
204100         WHEN SQLCODE = +100                                      20410000
204200             CONTINUE                                             20420000
204300         WHEN SQLWARN0 NOT = SPACES                               20430000
204400         WHEN SQLCODE < ZERO                                      20440000
204500         WHEN SQLCODE > ZERO                                      20450000
204600             MOVE '4020-CLOSE-SHIFT-CURSOR' TO DP013-PARAGRAPH    20460000
204700             MOVE 'CLOSE CURSOR PROBLEM   '                       20470000
204800                               TO DP013-MESSAGE-TEXT (1)          20480000
204900             MOVE SQLCA        TO DP013-SQLCA                     20490000
205000             MOVE 'PCT_SHFT ' TO DP013-DB2-TABLE-NAME (1)         20500000
205100             SET DP013-DB2-ABEND                                  20510000
205200                 DP013-XCTL-DISPLAY-RESTART TO TRUE               20520000
205300             PERFORM DP013-0000-PROCESS-ABEND                     20530000
205400     END-EVALUATE.                                                20540000
205500*                                                                 20550000
205600*----------------------------------------------------------------*20560000
205700*    INITIAL FETCH                                                20570000
205800*----------------------------------------------------------------*20580000
205900 4030-INITIAL-FETCH.                                              20590000
206000             EXEC SQL                                             20600000
206100                  FETCH SHIFT-CSR                                 20610000
206200                 INTO  :PCT00004-OPER-UNT-ID                      20620000
206300                      ,:PCT00004-SHFT-NBR                         20630000
206400                      ,:PCT00004-SHFT-BEG-TM                      20640000
206500                      ,:PCT00004-SHFT-END-TM                      20650000
206600                      ,:XLT00010-LOC-5-ABBR-NM                    20660004
206700                      ,:KRPRPM-FUNC-QTY                           20670000
206800             END-EXEC                                             20680000
206900                                                                  20690000
207000     EVALUATE TRUE                                                20700000
207100         WHEN SQLCODE = ZERO                                      20710000
207200              MOVE PCT00004-OPER-UNT-ID     TO PV-OPER-NBR        20720000
207300                                               DK-OPER-UNT-ID     20730000
207400              SET PS-OPER-NBR-SAME          TO TRUE               20740000
207500              MOVE XLT00010-LOC-5-ABBR-NM   TO PV-OPER-DESC       20750004
207600              MOVE KRPRPM-FUNC-QTY          TO PV-FUNC-QTY        20760000
207700              PERFORM 4330-CHECK-TIMEZONE                         20770000
207800*             PERFORM 4320-CHECK-SHIFT                            20780002
207900         WHEN SQLCODE = +100                                      20790000
208000              CONTINUE                                            20800000
208100         WHEN SQLWARN0 NOT = SPACE                                20810000
208200         WHEN SQLCODE NOT = ZERO                                  20820000
208300              MOVE '4030-INITIAL-FETCH' TO DP013-PARAGRAPH        20830000
208400              MOVE 'FETCH CURSOR PROBLEM '                        20840000
208500                               TO DP013-MESSAGE-TEXT (1)          20850000
208600              MOVE SQLCA       TO DP013-SQLCA                     20860000
208700              MOVE 'PCT_SHFT'   TO DP013-DB2-TABLE-NAME (1)       20870000
208710              MOVE 'XLT_LOC '   TO DP013-DB2-TABLE-NAME (2)       20871004
208800              SET DP013-DB2-ABEND TO TRUE                         20880000
208900              PERFORM DP013-0000-PROCESS-ABEND                    20890000
209000     END-EVALUATE.                                                20900000
209100                                                                  20910000
209200     IF  SQLCODE EQUAL +100                                       20920000
209300         SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                      20930000
209400     END-IF.                                                      20940000
209500                                                                  20950000
209600*----------------------------------------------------------------*20960000
209700*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *20970000
209800*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *20980000
209900*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *20990000
210000*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *21000000
210100*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *21010000
210200*                                                                *21020000
210300*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *21030000
210400*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *21040000
210500*    UPON INITIALIZATION.                                        *21050000
210600*----------------------------------------------------------------*21060000
210700 4300-READ-ITEMS-FROM-DB.                                         21070000
210800                                                                  21080000
210900     PERFORM                                                      21090000
211000         VARYING PV-READ-COUNT                                    21100000
211100         FROM 1 BY 1                                              21110000
211200         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    21120000
211300            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         21130000
211400                                                                  21140000
211500         IF PS-INITIAL-FETCH                                      21150000
211600            PERFORM 4030-INITIAL-FETCH                            21160000
211700            SET PS-NOT-INITIAL-FETCH         TO TRUE              21170000
211800            MOVE PV-OPER-NBR      TO PV-PREV-OPER-NBR             21180000
211810            MOVE PV-OPER-DESC     TO PV-PREV-OPER-DESC            21181002
211820            MOVE PV-TIMEZONE      TO PV-PREV-TIMEZONE             21182002
211900         ELSE                                                     21190000
212000            PERFORM 4310-FETCH                                    21200000
212100         END-IF                                                   21210000
212200                                                                  21220000
212300                                                                  21230000
212400         IF PS-OPER-NBR-SAME                                      21240000
212610             PERFORM 4320-CHECK-SHIFT                             21261002
213300         ELSE                                                     21330000
213400*            IF  ASC-ITEMS-LEFT-ON-DB                             21340002
213500                 IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL            21350000
213600                     ADD +1            TO ASC-ITEM-SUB            21360000
213700                 ELSE                                             21370000
213800                     ADD +1            TO ASC-BLK-SUB             21380000
213900                     MOVE +1           TO ASC-ITEM-SUB            21390000
214000                                                                  21400000
214100                     IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY     21410000
214200                         MOVE +1       TO ASC-BLK-SUB             21420000
214300                         SET ASC-BLOCK-MODIFIED (1) TO TRUE       21430000
214400                         PERFORM 5100-WRITE-TEMP-STORAGE          21440000
214500                         MOVE ASC-BLOCK-ENTRIES                   21450000
214600                                       (PC-MAX-BLOCKS-IN-ARRAY)   21460000
214700                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 21470000
214800                         ADD +1        TO ASC-BLK-SUB             21480000
214900                       INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB) 21490000
215000                       SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)    21500000
215100                                                          TO TRUE 21510000
215200                     END-IF                                       21520000
215300                  END-IF                                          21530000
215400*             END-IF                                              21540002
215500             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    21550000
215600             SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB) TO TRUE          21560000
215700             MOVE ASC-NUMBER-OF-ITEMS-READ                        21570000
215800                                   TO ASC-LIST-ITEM-NUMBER        21580000
215900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  21590000
216000             MOVE PV-PREV-OPER-NBR                                21600000
216100                       TO ASC-OPERNBR  (ASC-BLK-SUB ASC-ITEM-SUB) 21610000
216200             MOVE PV-PREV-OPER-DESC                               21620000
216300                       TO ASC-OPERDESC (ASC-BLK-SUB ASC-ITEM-SUB) 21630000
216400             MOVE PV-PREV-TIMEZONE                                21640000
216500                        TO ASC-TIMZN   (ASC-BLK-SUB ASC-ITEM-SUB) 21650000
216600             MOVE PV-3RD-STRTM                                    21660001
216700                        TO ASC-3RDSTRTM (ASC-BLK-SUB ASC-ITEM-SUB)21670000
216800             MOVE PV-3RD-ENDTM                                    21680001
216900                        TO ASC-3RDENDTM (ASC-BLK-SUB ASC-ITEM-SUB)21690000
217000             MOVE PV-1ST-STRTM                                    21700001
217100                        TO ASC-1STSTRTM (ASC-BLK-SUB ASC-ITEM-SUB)21710000
217200             MOVE PV-1ST-ENDTM                                    21720001
217300                        TO ASC-1STENDTM (ASC-BLK-SUB ASC-ITEM-SUB)21730000
217400             MOVE PV-2ND-STRTM                                    21740001
217500                        TO ASC-2NDSTRTM (ASC-BLK-SUB ASC-ITEM-SUB)21750000
217600             MOVE PV-2ND-ENDTM                                    21760001
217700                        TO ASC-2NDENDTM (ASC-BLK-SUB ASC-ITEM-SUB)21770000
217800                                                                  21780000
217880                                                                  21788001
217890             PERFORM 4330-CHECK-TIMEZONE                          21789002
217900             MOVE PV-OPER-NBR    TO PV-PREV-OPER-NBR              21790001
217920             MOVE PV-TIMEZONE    TO PV-PREV-TIMEZONE              21792002
217921             MOVE PV-OPER-DESC   TO PV-PREV-OPER-DESC             21792102
217930             PERFORM 4340-INITIALIZE                              21793002
217940             PERFORM 4320-CHECK-SHIFT                             21794002
218800         END-IF                                                   21880000
218900     END-PERFORM.                                                 21890000
219000                                                                  21900000
219100     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          21910000
219200         MOVE +1               TO ASC-BLK-SUB                     21920000
219300         PERFORM 5100-WRITE-TEMP-STORAGE                          21930000
219400         ADD +1                TO ASC-BLK-SUB                     21940000
219500         PERFORM 5100-WRITE-TEMP-STORAGE                          21950000
219600                                                                  21960000
219700         MOVE 1                TO ASC-BLK-SUB                     21970000
219800                                  PV-BLOCK-NUMBER                 21980000
219900         PERFORM 4410-READ-TEMP-STORAGE                           21990000
220000         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             22000000
220100             MOVE 2            TO ASC-BLK-SUB                     22010000
220200                                  PV-BLOCK-NUMBER                 22020000
220300             PERFORM 4410-READ-TEMP-STORAGE                       22030000
220400         END-IF                                                   22040000
220500     END-IF.                                                      22050000
220650*                                                                 22065002
220700*----------------------------------------------------------------*22070000
220800*    FETCH THE CURSOR                                             22080000
220900*----------------------------------------------------------------*22090000
221000 4310-FETCH.                                                      22100000
221100             EXEC SQL                                             22110000
221200                  FETCH SHIFT-CSR                                 22120000
221300                 INTO  :PCT00004-OPER-UNT-ID                      22130000
221400                      ,:PCT00004-SHFT-NBR                         22140000
221500                      ,:PCT00004-SHFT-BEG-TM                      22150000
221600                      ,:PCT00004-SHFT-END-TM                      22160000
221700                      ,:XLT00010-LOC-5-ABBR-NM                    22170004
221800                      ,:KRPRPM-FUNC-QTY                           22180000
221900             END-EXEC                                             22190000
222000                                                                  22200000
222100     EVALUATE TRUE                                                22210000
222200         WHEN SQLCODE = ZERO                                      22220000
222300              MOVE PCT00004-OPER-UNT-ID     TO PV-OPER-NBR        22230000
222400                                               DK-OPER-UNT-ID     22240000
222500              IF PV-OPER-NBR    = PV-PREV-OPER-NBR                22250000
222600                 SET PS-OPER-NBR-SAME    TO TRUE                  22260000
222700              ELSE                                                22270000
222800                 SET PS-OPER-NBR-NOT-SAME    TO TRUE              22280000
222900              END-IF                                              22290000
223000              MOVE XLT00010-LOC-5-ABBR-NM   TO PV-OPER-DESC       22300004
223100              MOVE KRPRPM-FUNC-QTY          TO PV-FUNC-QTY        22310000
223400         WHEN SQLCODE = +100                                      22340000
223500              SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                 22350003
223600              SET PS-OPER-NBR-NOT-SAME    TO TRUE                 22360003
224700         WHEN SQLWARN0 NOT = SPACE                                22470000
224800         WHEN SQLCODE NOT = ZERO                                  22480000
224900              MOVE '4310-FETCH-CURSOR' TO DP013-PARAGRAPH         22490000
225000              MOVE 'FETCH CURSOR PROBLEM '                        22500000
225100                               TO DP013-MESSAGE-TEXT (1)          22510000
225200              MOVE SQLCA       TO DP013-SQLCA                     22520000
225300              MOVE 'PCT_SHFT'   TO DP013-DB2-TABLE-NAME (1)       22530000
225310              MOVE 'XLT_LOC '   TO DP013-DB2-TABLE-NAME (2)       22531004
225400              SET DP013-DB2-ABEND TO TRUE                         22540000
225500              PERFORM DP013-0000-PROCESS-ABEND                    22550000
225600     END-EVALUATE.                                                22560000
225700                                                                  22570000
226300*----------------------------------------------------------------*22630000
226400*    CHECK SHIFT NUMBER.                                          22640000
226500*----------------------------------------------------------------*22650000
226600 4320-CHECK-SHIFT.                                                22660000
226700                                                                  22670000
226800     EVALUATE TRUE                                                22680000
226900         WHEN PCT00004-SHFT-NBR  = 1                              22690000
227000              MOVE PCT00004-SHFT-BEG-TM  TO PV-1ST-STRTM          22700000
227100              MOVE PCT00004-SHFT-END-TM  TO PV-1ST-ENDTM          22710000
227200                                                                  22720000
227300         WHEN PCT00004-SHFT-NBR  = 2                              22730000
227400              MOVE PCT00004-SHFT-BEG-TM  TO PV-2ND-STRTM          22740000
227500              MOVE PCT00004-SHFT-END-TM  TO PV-2ND-ENDTM          22750000
227600                                                                  22760000
227700         WHEN PCT00004-SHFT-NBR  = 3                              22770000
227800              MOVE PCT00004-SHFT-BEG-TM  TO PV-3RD-STRTM          22780000
227900              MOVE PCT00004-SHFT-END-TM  TO PV-3RD-ENDTM          22790000
228000     END-EVALUATE.                                                22800000
228100*----------------------------------------------------------------*22810000
228200*    CHECK TIMEZONE.                                              22820000
228300*----------------------------------------------------------------*22830000
228400 4330-CHECK-TIMEZONE.                                             22840000
228500                                                                  22850000
228600     EVALUATE TRUE                                                22860000
228700         WHEN PV-FUNC-QTY    = 1                                  22870000
228800              MOVE 'EASTERN'      TO PV-TIMEZONE                  22880000
228900                                                                  22890000
229000         WHEN PV-FUNC-QTY    = 0                                  22900000
229100              MOVE 'CENTRAL'      TO PV-TIMEZONE                  22910000
229200                                                                  22920000
229300         WHEN PV-FUNC-QTY    = -1                                 22930000
229400              MOVE 'MOUNTAIN'     TO PV-TIMEZONE                  22940000
229500                                                                  22950000
229600         WHEN PV-FUNC-QTY    = -2                                 22960000
229700              MOVE 'PACIFIC'      TO PV-TIMEZONE                  22970000
229800     END-EVALUATE.                                                22980000
229900                                                                  22990000
229901*----------------------------------------------------------------*22990101
229902 4340-INITIALIZE.                                                 22990201
229903                                                                  22990301
229910             INITIALIZE     PV-3RD-STRTM                          22991001
229920                            PV-3RD-ENDTM                          22992001
229930                            PV-1ST-STRTM                          22993001
229940                            PV-1ST-ENDTM                          22994001
229950                            PV-2ND-STRTM                          22995001
229960                            PV-2ND-ENDTM.                         22996001
229970                                                                  22997001
230000*----------------------------------------------------------------*23000000
230100* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *23010000
230200*----------------------------------------------------------------*23020000
230300 4400-MOVE-COMMAREA-TO-SCREEN.                                    23030000
230400     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             23040000
230500         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          23050000
230600         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          23060000
230700             MOVE +1    TO ASC-BLK-SUB                            23070000
230800             PERFORM 5100-WRITE-TEMP-STORAGE                      23080000
230900             ADD +1     TO ASC-BLK-SUB                            23090000
231000             PERFORM 5100-WRITE-TEMP-STORAGE                      23100000
231100             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             23110000
231200                 GIVING PV-BLOCK-NUMBER                           23120000
231300                 REMAINDER PV-REMAINDER                           23130000
231400             IF  PV-REMAINDER > ZERO                              23140000
231500                 ADD +1 TO PV-BLOCK-NUMBER                        23150000
231600             END-IF                                               23160000
231700             MOVE +1    TO ASC-BLK-SUB                            23170000
231800             PERFORM 4410-READ-TEMP-STORAGE                       23180000
231900             ADD +1     TO ASC-BLK-SUB                            23190000
232000                           PV-BLOCK-NUMBER                        23200000
232100             PERFORM 4410-READ-TEMP-STORAGE                       23210000
232200     END-IF.                                                      23220000
232300     MOVE +1            TO ASC-BLK-SUB.                           23230000
232400     COMPUTE ASC-ITEM-SUB =                                       23240000
232500         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              23250000
232600         + PC-ITEMS-PER-PANEL).                                   23260000
232700*                                                                 23270000
232800     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        23280000
232900         ADD +1         TO ASC-BLK-SUB                            23290000
233000         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            23300000
233100     END-IF.                                                      23310000
233200*                                                                 23320000
233300     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           23330000
233400         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                23340000
233500     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        23350000
233600     PERFORM 4420-FORMAT-LIST-LINES                               23360000
233700         VARYING PV-SUB                                           23370000
233800         FROM PC-ITEMS-PER-PANEL BY -1                            23380000
233900         UNTIL PV-SUB < +1.                                       23390000
234000*                                                                 23400000
234100     COMPUTE ASC-ITEMS-DISPLAYED =                                23410000
234200         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          23420000
234300     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    23430000
234400*                                     ASTRTITO.                   23440000
234500*    MOVE ASC-OPERNBR               TO AOPID01O.                  23450000
234600*    MOVE ASC-OPERDESC              TO AOPDS01O.                  23460000
234700*    MOVE ASC-TIMZN                 TO ATMZN01O.                  23470000
234800                                                                  23480000
234900*    MOVE ASC-3RDSTRTM              TO AST3D01O.                  23490000
235000*    MOVE ASC-3RDENDTM              TO AEN3D01O.                  23500000
235100*    MOVE ASC-1STSTRTM              TO AST1D01O.                  23510000
235200*    MOVE ASC-1STENDTM              TO AEN1D01O.                  23520000
235300*    MOVE ASC-2NDSTRTM              TO AST2D01O.                  23530000
235400*    MOVE ASC-2NDENDTM              TO AST2D01O.                  23540000
235500                                                                  23550000
235600     IF  DP020-MSG-NUMBER-X = SPACE                               23560000
235700         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  23570000
235800*            --- MORE ITEMS TO DISPLAY ----                       23580000
235900             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            23590000
236000             SET DP020-MSG-INFORMATIONAL TO TRUE                  23600000
236100         END-IF                                                   23610000
236200     END-IF.                                                      23620000
236300                                                                  23630000
236400*----------------------------------------------------------------*23640000
236500*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *23650000
236600*----------------------------------------------------------------*23660000
236700 4410-READ-TEMP-STORAGE.                                          23670000
236800                                                                  23680000
236900     EXEC CICS                                                    23690000
237000         READQ TS                                                 23700000
237100             QUEUE (ASC-LIST-QUEUE-NAME)                          23710000
237200             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               23720000
237300             ITEM  (PV-BLOCK-NUMBER)                              23730000
237400             RESP  (PV-CICS-RESP)                                 23740000
237500     END-EXEC.                                                    23750000
237600                                                                  23760000
237700     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       23770000
237800       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     23780000
237900         CONTINUE                                                 23790000
238000     ELSE                                                         23800000
238100         SET DP013-CICS-ABEND     TO TRUE                         23810000
238200         SET DP013-NO-ROLLBACK    TO TRUE                         23820000
238300         MOVE '4410-READ-TEMP-STORAGE'                            23830000
238400                                  TO DP013-PARAGRAPH              23840000
238500         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      23850000
238600                                  TO DP013-MESSAGE-TEXT(1)        23860000
238700         PERFORM DP013-0000-PROCESS-ABEND                         23870000
238800     END-IF.                                                      23880000
238900                                                                  23890000
239000     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             23900000
239100*                                                                 23910000
239200     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         23920000
239300         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               23930000
239400     END-IF.                                                      23940000
239500                                                                  23950000
239600*----------------------------------------------------------------*23960000
239700*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *23970000
239800*----------------------------------------------------------------*23980000
239900 4420-FORMAT-LIST-LINES.                                          23990000
240000     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      24000000
240100         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                24010000
240200*        MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           24020000
240300*        MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           24030000
240400*        MOVE SPACE              TO MR-SELECTI (PV-SUB)           24040000
240500*                                   MR-ACTION (PV-SUB)            24050000
240600         MOVE SPACE              TO MR-OPERID (PV-SUB)            24060000
240700                                    MR-OPER-DESC (PV-SUB)         24070000
240800                                    MR-TIMEZONE (PV-SUB)          24080000
240900                                    MR-3RD-STRTM (PV-SUB)         24090000
241000                                    MR-3RD-ENDTM (PV-SUB)         24100000
241100                                    MR-1ST-STRTM (PV-SUB)         24110000
241200                                    MR-1ST-ENDTM (PV-SUB)         24120000
241300                                    MR-2ND-STRTM (PV-SUB)         24130000
241400                                    MR-2ND-ENDTM (PV-SUB)         24140000
241500     ELSE                                                         24150000
241600*        IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      24160000
241700*                                                  > SPACE        24170000
241800*            MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 24180000
241900*                                TO MR-SELECTI (PV-SUB)           24190000
242000*        ELSE                                                     24200000
242100*            MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      24210000
242200*                                TO MR-SELECTI (PV-SUB)           24220000
242300*        END-IF                                                   24230000
242400         IF  DP030-SET-CURSOR-TRAILER                             24240000
242500             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)24250000
242600                 > SPACE)                                         24260000
242700               OR (PV-SUB = 1))                                   24270000
242800                SET DP030-SET-CURSOR-APPL-1 TO TRUE               24280000
242900*               MOVE -1               TO MR-SELECTL (PV-SUB)      24290000
243000             END-IF                                               24300000
243100         END-IF                                                   24310000
243200*                                                                 24320000
243300*        MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)               24330000
243400*                                          TO MR-ACTION (PV-SUB)  24340000
243500         MOVE ASC-OPERNBR  (ASC-BLK-SUB ASC-ITEM-SUB)             24350000
243600                                       TO  MR-OPERID (PV-SUB)     24360000
243700         MOVE ASC-OPERDESC (ASC-BLK-SUB ASC-ITEM-SUB)             24370000
243800                                       TO  MR-OPER-DESC (PV-SUB)  24380000
243900         MOVE ASC-TIMZN    (ASC-BLK-SUB ASC-ITEM-SUB)             24390000
244000                                       TO  MR-TIMEZONE (PV-SUB)   24400000
244100         MOVE ASC-3RDSTRTM (ASC-BLK-SUB ASC-ITEM-SUB)             24410000
244200                                        TO MR-3RD-STRTM (PV-SUB)  24420000
244300         MOVE ASC-3RDENDTM (ASC-BLK-SUB ASC-ITEM-SUB)             24430000
244400                                         TO MR-3RD-ENDTM (PV-SUB) 24440000
244500         MOVE ASC-1STSTRTM (ASC-BLK-SUB ASC-ITEM-SUB)             24450000
244600                                        TO MR-1ST-STRTM (PV-SUB)  24460000
244700         MOVE ASC-1STENDTM (ASC-BLK-SUB ASC-ITEM-SUB)             24470000
244800                                         TO MR-1ST-ENDTM (PV-SUB) 24480000
244900         MOVE ASC-2NDSTRTM (ASC-BLK-SUB ASC-ITEM-SUB)             24490000
245000                                        TO MR-2ND-STRTM (PV-SUB)  24500000
245100         MOVE ASC-2NDENDTM (ASC-BLK-SUB ASC-ITEM-SUB)             24510000
245200                                         TO MR-2ND-ENDTM (PV-SUB) 24520000
245300     END-IF.                                                      24530000
245400     SUBTRACT +1 FROM ASC-ITEM-SUB                                24540000
245500     IF  ASC-ITEM-SUB < + 1                                       24550000
245600         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  24560000
245700         MOVE +1                 TO ASC-BLK-SUB                   24570000
245800     END-IF.                                                      24580000
245900                                                                  24590000
246000******************************************************************24600000
246100** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **24610000
246200** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **24620000
246300** ISSUE A WARNING.                                             **24630000
246400******************************************************************24640000
246500 4430-CHECK-FOR-BEGIN-AND-END.                                    24650000
246600     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       24660000
246700         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     24670000
246800*            -- NO END-OF-RANGE SPECFIED ---                      24680000
246900             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            24690000
247000             SET DP020-MSG-WARNING TO TRUE                        24700000
247100             PERFORM 4431-POSITION-AT-WARNING                     24710000
247200         END-IF                                                   24720000
247300     ELSE                                                         24730000
247400         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     24740000
247500*            -- NO BEGINNING-OF-RANGE SPECFIED ---                24750000
247600             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            24760000
247700             SET DP020-MSG-WARNING TO TRUE                        24770000
247800             PERFORM 4431-POSITION-AT-WARNING                     24780000
247900         END-IF                                                   24790000
248000     END-IF.                                                      24800000
248100******************************************************************24810000
248200** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **24820000
248300** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **24830000
248400** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **24840000
248500** POSITION THE CURSOR THERE.                                   **24850000
248600******************************************************************24860000
248700 4431-POSITION-AT-WARNING.                                        24870000
248800     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 24880000
248900                    - PV-TOP-ITEM + 1.                            24890000
249000     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      24900000
249100         CONTINUE                                                 24910000
249200     ELSE                                                         24920000
249300         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      24930000
249400*        MOVE -1                   TO MR-SELECTL (PV-SUB)         24940000
249500*        MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         24950000
249600*        MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         24960000
249700     END-IF.                                                      24970000
249800*                                                                 24980000
249900     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   24990000
250000                    - PV-TOP-ITEM + 1.                            25000000
250100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      25010000
250200         CONTINUE                                                 25020000
250300     ELSE                                                         25030000
250400         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      25040000
250500*        MOVE -1                   TO MR-SELECTL (PV-SUB)         25050000
250600*        MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         25060000
250700*        MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         25070000
250800     END-IF.                                                      25080000
250900                                                                  25090000
251000*----------------------------------------------------------------*25100000
251100* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *25110000
251200* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *25120000
251300* FOR THE SELECTED ITEMS QUEUE.                                  *25130000
251400*                                                                *25140000
251500* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *25150000
251600* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *25160000
251700* THE ARRAY IS FULL.                                             *25170000
251800*----------------------------------------------------------------*25180000
251900 5000-PREPARE-SEL-QUEUE.                                          25190000
252000                                                                  25200000
252100     MOVE +1                   TO  ASC-BLK-SUB.                   25210000
252200     PERFORM 5100-WRITE-TEMP-STORAGE.                             25220000
252300     ADD +1                    TO  ASC-BLK-SUB.                   25230000
252400     PERFORM 5100-WRITE-TEMP-STORAGE.                             25240000
252500                                                                  25250000
252600     MOVE ASC-SEL-QUEUE-NAME   TO  PC214-SEL-QUEUE-NAME.          25260000
252700     PERFORM 6010-DELETE-SEL-QUEUE.                               25270000
252800                                                                  25280000
252900     SET ASC-UPDATE-TSQ        TO  TRUE.                          25290000
253000                                                                  25300000
253100     SET PC215-IDX             TO  1.                             25310000
253200     MOVE ZERO                 TO PC214-NUMBER-OF-TS-ITEMS.       25320000
253300     INITIALIZE PC215-SELECTED-ITEM-ARRAY.                        25330000
253400                                                                  25340000
253500     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           25350000
253600             VARYING PV-ITEM                                      25360000
253700             FROM 1 BY 1                                          25370000
253800             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     25380000
253900                                                                  25390000
254000     IF  PC215-IDX > 1                                            25400000
254100         PERFORM 5205-WRITE-SEL-QUEUE                             25410000
254200         ADD +1                TO PC214-NUMBER-OF-TS-ITEMS        25420000
254300     END-IF.                                                      25430000
254400*----------------------------------------------------------------*25440000
254500*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *25450000
254600*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *25460000
254700*----------------------------------------------------------------*25470000
254800 5100-WRITE-TEMP-STORAGE.                                         25480000
254900     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     25490000
255000                                   TO PV-LIST-ITEM-NUMBER.        25500000
255100     COMPUTE PV-BLOCK-NUMBER =                                    25510000
255200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    25520000
255300                                                                  25530000
255400     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             25540000
255500     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             25550000
255600         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      25560000
255700             PERFORM 5105-REWRITE-ASC-LISTQ                       25570000
255800         END-IF                                                   25580000
255900     ELSE                                                         25590000
256000         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       25600000
256100         ASC-HIGHEST-BLOCK-WRITTEN + 1                            25610000
256200         PERFORM 5110-WRITE-ASC-LISTQ                             25620000
256300         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   25630000
256400     END-IF.                                                      25640000
256500                                                                  25650000
256600     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             25660000
256700                                                                  25670000
256800******************************************************************25680000
256900** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **25690000
257000** SPECIFIC COMMAREA.                                           **25700000
257100******************************************************************25710000
257200 5105-REWRITE-ASC-LISTQ.                                          25720000
257300     EXEC CICS                                                    25730000
257400         WRITEQ TS                                                25740000
257500             QUEUE (ASC-LIST-QUEUE-NAME)                          25750000
257600             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               25760000
257700             ITEM  (PV-BLOCK-NUMBER)                              25770000
257800             REWRITE                                              25780000
257900             RESP  (PV-CICS-RESP)                                 25790000
258000     END-EXEC.                                                    25800000
258100                                                                  25810000
258200     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           25820000
258300         CONTINUE                                                 25830000
258400     ELSE                                                         25840000
258500         SET DP013-CICS-ABEND            TO TRUE                  25850000
258600         SET DP013-NO-ROLLBACK           TO TRUE                  25860000
258700         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       25870000
258800         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     25880000
258900                                         TO DP013-MESSAGE-TEXT(1) 25890000
259000         PERFORM DP013-0000-PROCESS-ABEND                         25900000
259100     END-IF.                                                      25910000
259200                                                                  25920000
259300******************************************************************25930000
259400** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **25940000
259500** SPECIFIC COMMAREA.                                           **25950000
259600******************************************************************25960000
259700 5110-WRITE-ASC-LISTQ.                                            25970000
259800     EXEC CICS                                                    25980000
259900         WRITEQ TS                                                25990000
260000             QUEUE (ASC-LIST-QUEUE-NAME)                          26000000
260100             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               26010000
260200             ITEM  (PV-BLOCK-NUMBER)                              26020000
260300             RESP  (PV-CICS-RESP)                                 26030000
260400     END-EXEC.                                                    26040000
260500     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      26050000
260600         SET DP013-CICS-ABEND      TO TRUE                        26060000
260700         SET DP013-NO-ROLLBACK     TO TRUE                        26070000
260800         MOVE '5110-WRITE-ASC-LISTQ'                              26080000
260900                                   TO DP013-PARAGRAPH             26090000
261000         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           26100000
261100                                   TO DP013-MESSAGE-TEXT(1)       26110000
261200         PERFORM DP013-0000-PROCESS-ABEND                         26120000
261300     END-IF.                                                      26130000
261400                                                                  26140000
261500*----------------------------------------------------------------*26150000
261600* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *26160000
261700* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *26170000
261800*----------------------------------------------------------------*26180000
261900 5200-FILL-SEL-QUEUE-RECORD.                                      26190000
262000                                                                  26200000
262100     PERFORM 6112-READ-LIST-QUEUE.                                26210000
262200                                                                  26220000
262300     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       26230000
262400         PERFORM                                                  26240000
262500         VARYING LQW-IDX                                          26250000
262600         FROM 1 BY 1                                              26260000
262700         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            26270000
262800           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          26280000
262900                                                                  26290000
263000             IF  LQW-SELECT (LQW-IDX)                             26300000
263100                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              26310000
263200                                   TO PC215-ITEM (PC215-IDX)      26320000
263300                 MOVE SPACE        TO PC215-ACTION-SW (PC215-IDX) 26330000
263400                                                                  26340000
263500                 MOVE LQW-OPERNBR  (LQW-IDX)                      26350000
263600                                   TO PC215-OPER-DESC (PC215-IDX) 26360000
263700                 MOVE LQW-OPERDESC  (LQW-IDX)                     26370000
263800                                   TO PC215-OPER-DESC (PC215-IDX) 26380000
263900                 MOVE LQW-3RDSTRTM (LQW-IDX)                      26390000
264000                                   TO PC215-3RD-UNITS (PC215-IDX) 26400000
264100                 MOVE LQW-3RDENDTM(LQW-IDX)                       26410000
264200                                     TO PC215-3RD-PCT (PC215-IDX) 26420000
264300                 MOVE LQW-1STSTRTM  (LQW-IDX)                     26430000
264400                                   TO PC215-1ST-UNITS (PC215-IDX) 26440000
264500                 MOVE LQW-1STENDTM (LQW-IDX)                      26450000
264600                                     TO PC215-1ST-PCT (PC215-IDX) 26460000
264700                 MOVE LQW-2NDSTRTM  (LQW-IDX)                     26470000
264800                                   TO PC215-2ND-UNITS (PC215-IDX) 26480000
264900                 MOVE LQW-2NDENDTM (LQW-IDX)                      26490000
265000                                     TO PC215-2ND-PCT (PC215-IDX) 26500000
265100                                                                  26510000
265200                 SET PC215-IDX UP BY 1                            26520000
265300                 IF  PC215-IDX > PC215-MAX-ITEMS                  26530000
265400                     PERFORM 5205-WRITE-SEL-QUEUE                 26540000
265500                     ADD +1        TO PC214-NUMBER-OF-TS-ITEMS    26550000
265600                     INITIALIZE PC215-SELECTED-ITEM-ARRAY         26560000
265700                     SET PC215-IDX TO  1                          26570000
265800                 END-IF                                           26580000
265900             END-IF                                               26590000
266000         END-PERFORM                                              26600000
266100     END-IF.                                                      26610000
266200                                                                  26620000
266300*----------------------------------------------------------------*26630000
266400*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *26640000
266500*----------------------------------------------------------------*26650000
266600 5205-WRITE-SEL-QUEUE.                                            26660000
266700                                                                  26670000
266800     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            26680000
266900                                   TO PC215-SELECTED-ITEMS.       26690000
267000                                                                  26700000
267100     EXEC CICS                                                    26710000
267200          WRITEQ TS                                               26720000
267300              QUEUE (ASC-SEL-QUEUE-NAME)                          26730000
267400              FROM  (PC215-SELECT-RECORD)                         26740000
267500              ITEM  (PV-SEL-QUEUE-ITEM)                           26750000
267600              RESP  (PV-CICS-RESP)                                26760000
267700     END-EXEC.                                                    26770000
267800                                                                  26780000
267900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          26790000
268000         CONTINUE                                                 26800000
268100     ELSE                                                         26810000
268200         SET DP013-CICS-ABEND      TO TRUE                        26820000
268300         SET DP013-NO-ROLLBACK     TO TRUE                        26830000
268400         MOVE '5205-WRITE-SEL-QUEUE'                              26840000
268500                                   TO DP013-PARAGRAPH             26850000
268600         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          26860000
268700                                   TO DP013-MESSAGE-TEXT(1)       26870000
268800         PERFORM DP013-0000-PROCESS-ABEND                         26880000
268900     END-IF.                                                      26890000
269000******************************************************************26900000
269100** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **26910000
269200** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **26920000
269300** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **26930000
269400** THE USER.                                                    **26940000
269500******************************************************************26950000
269600 6000-REFRESH-PANEL-FROM-TEMP.                                    26960000
269700     IF  ASC-UPDATE-TSQ                                           26970000
269800         SET ASC-NO-TSQ-UPDATE TO TRUE                            26980000
269900         MOVE ZERO                 TO PV-SAVE-ITEM                26990000
270000                                      PV-SEL-QUEUE-ITEM           27000000
270100         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        27010000
270200                                   TO PV-HOLD-SELECTED-ITEMS      27020000
270300         MOVE +1                   TO PV-ITEMS-PROCESSED          27030000
270400         PERFORM 6100-UPDATE-TSQ                                  27040000
270500             UNTIL PV-ITEMS-PROCESSED >                           27050000
270600                                     PV-HOLD-SELECTED-ITEMS       27060000
270700         INITIALIZE ASC-BLOCK-ENTRIES (1)                         27070000
270800                    ASC-BLOCK-ENTRIES (2)                         27080000
270900     END-IF.                                                      27090000
271000                                                                  27100000
271100*----------------------------------------------------------------*27110000
271200*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *27120000
271300*----------------------------------------------------------------*27130000
271400 6010-DELETE-SEL-QUEUE.                                           27140000
271500                                                                  27150000
271600     EXEC CICS                                                    27160000
271700         DELETEQ TS                                               27170000
271800             QUEUE (ASC-SEL-QUEUE-NAME)                           27180000
271900             RESP  (PV-CICS-RESP)                                 27190000
272000     END-EXEC.                                                    27200000
272100*                                                                 27210000
272200     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      27220000
272300        (PV-CICS-RESP = DFHRESP(QIDERR)))                         27230000
272400         CONTINUE                                                 27240000
272500     ELSE                                                         27250000
272600         SET DP013-CICS-ABEND TO TRUE                             27260000
272700         SET DP013-NO-ROLLBACK TO TRUE                            27270000
272800         MOVE '6010-DELETE-SEL-QUEUE'                             27280000
272900                        TO DP013-PARAGRAPH                        27290000
273000         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         27300000
273100                        TO DP013-MESSAGE-TEXT (1)                 27310000
273200         PERFORM DP013-0000-PROCESS-ABEND                         27320000
273300     END-IF.                                                      27330000
273400                                                                  27340000
273500*----------------------------------------------------------------*27350000
273600*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *27360000
273700*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *27370000
273800*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *27380000
273900*    THE TEMP QUEUE.                                             *27390000
274000*----------------------------------------------------------------*27400000
274100 6100-UPDATE-TSQ.                                                 27410000
274200                                                                  27420000
274300     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             27430000
274400     PERFORM 6150-READ-SEL-QUEUE.                                 27440000
274500     PERFORM                                                      27450000
274600         VARYING PC215-IDX                                        27460000
274700         FROM 1 BY 1                                              27470000
274800         UNTIL ((PV-ITEMS-PROCESSED > PV-HOLD-SELECTED-ITEMS)     27480000
274900         OR (PC215-IDX GREATER THAN PC215-MAX-ITEMS))             27490000
275000         IF  PC215-ACTION-SW (PC215-IDX) > SPACE                  27500000
275100             PERFORM 6110-PROCESS-ITEMS                           27510000
275200         END-IF                                                   27520000
275300         ADD +1                TO PV-ITEMS-PROCESSED              27530000
275400     END-PERFORM.                                                 27540000
275500     PERFORM 6111-WRITE-LIST-QUEUE.                               27550000
275600                                                                  27560000
275700*----------------------------------------------------------------*27570000
275800*    READ THE LIST QUEUE RECORD.                                 *27580000
275900*----------------------------------------------------------------*27590000
276000 6150-READ-SEL-QUEUE.                                             27600000
276100                                                                  27610000
276200     EXEC CICS                                                    27620000
276300          READQ TS                                                27630000
276400              QUEUE (ASC-SEL-QUEUE-NAME)                          27640000
276500              INTO  (PC215-SELECT-RECORD)                         27650000
276600              ITEM  (PV-SEL-QUEUE-ITEM)                           27660000
276700              RESP  (PV-CICS-RESP)                                27670000
276800     END-EXEC.                                                    27680000
276900*                                                                 27690000
277000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          27700000
277100         CONTINUE                                                 27710000
277200     ELSE                                                         27720000
277300         SET DP013-CICS-ABEND      TO  TRUE                       27730000
277400         SET DP013-NO-ROLLBACK     TO  TRUE                       27740000
277500         MOVE '6150-READ-SEL-QUEUE' TO  DP013-PARAGRAPH           27750000
277600         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           27760000
277700                                   TO  DP013-MESSAGE-TEXT(1)      27770000
277800         PERFORM DP013-0000-PROCESS-ABEND                         27780000
277900     END-IF.                                                      27790000
278000                                                                  27800000
278100*----------------------------------------------------------------*27810000
278200*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*27820000
278300*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*27830000
278400*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *27840000
278500*----------------------------------------------------------------*27850000
278600 6110-PROCESS-ITEMS.                                              27860000
278700                                                                  27870000
278800     COMPUTE PV-ITEM = 1 + ((PC215-ITEM (PC215-IDX) - 1)          27880000
278900                     / PC-ITEMS-PER-PANEL).                       27890000
279000                                                                  27900000
279100     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           27910000
279200         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          27920000
279300             PERFORM 6111-WRITE-LIST-QUEUE                        27930000
279400         END-IF                                                   27940000
279500         MOVE PV-ITEM          TO PV-SAVE-ITEM                    27950000
279600                                                                  27960000
279700         PERFORM 6112-READ-LIST-QUEUE                             27970000
279800         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               27980000
279900             CONTINUE                                             27990000
280000         END-IF                                                   28000000
280100     END-IF.                                                      28010000
280200                                                                  28020000
280300     COMPUTE PV-SUB = (PC215-ITEM (PC215-IDX)                     28030000
280400                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              28040000
280500     SET LQW-DESELECT (PV-SUB) TO    TRUE                         28050000
280600     MOVE LQW-SELECTED-SW (PV-SUB)                                28060000
280700                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  28070000
280800                                                                  28080000
280900     EVALUATE TRUE                                                28090000
281000         WHEN PC215-INQ (PC215-IDX)                               28100000
281100              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             28110000
281200                                                                  28120000
281300         WHEN PC215-UPD (PC215-IDX)                               28130000
281400              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             28140000
281500                                                                  28150000
281600         WHEN PC215-DEL (PC215-IDX)                               28160000
281700              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             28170000
281800                                                                  28180000
281900         WHEN PC215-ERR (PC215-IDX)                               28190000
282000              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             28200000
282100     END-EVALUATE.                                                28210000
282200                                                                  28220000
282300     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                28230000
282400                                                                  28240000
282500*----------------------------------------------------------------*28250000
282600*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *28260000
282700*----------------------------------------------------------------*28270000
282800 6111-WRITE-LIST-QUEUE.                                           28280000
282900                                                                  28290000
283000     EXEC CICS                                                    28300000
283100         WRITEQ TS                                                28310000
283200             QUEUE (ASC-LIST-QUEUE-NAME)                          28320000
283300             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     28330000
283400             ITEM  (PV-SAVE-ITEM)                                 28340000
283500             REWRITE                                              28350000
283600             RESP  (PV-CICS-RESP)                                 28360000
283700     END-EXEC.                                                    28370000
283800*                                                                 28380000
283900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          28390000
284000         CONTINUE                                                 28400000
284100     ELSE                                                         28410000
284200         SET DP013-CICS-ABEND  TO  TRUE                           28420000
284300         SET DP013-NO-ROLLBACK TO  TRUE                           28430000
284400         MOVE '6111-WRITE-LIST-QUEUE'                             28440000
284500                               TO  DP013-PARAGRAPH                28450000
284600         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  28460000
284700                               TO  DP013-MESSAGE-TEXT(1)          28470000
284800         PERFORM DP013-0000-PROCESS-ABEND                         28480000
284900     END-IF.                                                      28490000
285000                                                                  28500000
285100*----------------------------------------------------------------*28510000
285200*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*28520000
285300*----------------------------------------------------------------*28530000
285400 6112-READ-LIST-QUEUE.                                            28540000
285500                                                                  28550000
285600     EXEC CICS                                                    28560000
285700         READQ TS                                                 28570000
285800             QUEUE (ASC-LIST-QUEUE-NAME)                          28580000
285900             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     28590000
286000             ITEM  (PV-ITEM)                                      28600000
286100             RESP  (PV-CICS-RESP)                                 28610000
286200     END-EXEC.                                                    28620000
286300*                                                                 28630000
286400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          28640000
286500         CONTINUE                                                 28650000
286600     ELSE                                                         28660000
286700         SET DP013-CICS-ABEND        TO TRUE                      28670000
286800         SET DP013-NO-ROLLBACK       TO TRUE                      28680000
286900         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           28690000
287000         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    28700000
287100                                     TO DP013-MESSAGE-TEXT(1)     28710000
287200         PERFORM DP013-0000-PROCESS-ABEND                         28720000
287300     END-IF.                                                      28730000
287400                                                                  28740000
287500*-----------------------------------------------------------------28750000
287600*  READ THE LIST QUEUE RECORD                                     28760000
287700*-----------------------------------------------------------------28770000
287800 9100-READ-SEL-QUEUE.                                             28780000
287900                                                                  28790000
288000     EXEC CICS                                                    28800000
288100         READQ TS                                                 28810000
288200             QUEUE (ASC-SEL-QUEUE-NAME)                           28820000
288300             INTO  (PC215-SELECT-RECORD)                          28830000
288400             ITEM  (ASC-SEL-ITEM)                                 28840000
288500             RESP  (PV-CICS-RESP)                                 28850000
288600     END-EXEC.                                                    28860000
288700     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        28870000
288800         CONTINUE                                                 28880000
288900     ELSE                                                         28890000
289000         SET DP013-LOGIC-ABEND                                    28900000
289100             DP013-NO-ROLLBACK   TO   TRUE                        28910000
289200         MOVE '9100-READ-SEL-QUEUE' TO   DP013-PARAGRAPH          28920000
289300         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   28930000
289400                                 TO   DP013-MESSAGE-TEXT (1)      28940000
289500         PERFORM DP013-0000-PROCESS-ABEND                         28950000
289600     END-IF.                                                      28960000
289700                                                                  28970000
289800*-----------------------------------------------------------------28980000
289900* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *28990000
290000*-----------------------------------------------------------------29000000
290100 9200-REWRITE-SEL-QUEUE.                                          29010000
290200                                                                  29020000
290300     EXEC CICS                                                    29030000
290400          WRITEQ TS                                               29040000
290500              QUEUE  (ASC-SEL-QUEUE-NAME)                         29050000
290600              FROM   (PC215-SELECT-RECORD)                        29060000
290700              ITEM   (ASC-SEL-ITEM)                               29070000
290800              RESP   (PV-CICS-RESP)                               29080000
290900              REWRITE                                             29090000
291000     END-EXEC.                                                    29100000
291100                                                                  29110000
291200     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   29120000
291300         SET DP013-CICS-ABEND                                     29130000
291400             DP013-NO-ROLLBACK     TO TRUE                        29140000
291500         MOVE '9200-REWRITE-SEL-QUEUE'                            29150000
291600                                   TO DP013-PARAGRAPH             29160000
291700         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   29170000
291800                                   TO DP013-MESSAGE-TEXT (1)      29180000
291900         PERFORM DP013-0000-PROCESS-ABEND                         29190000
292000     END-IF.                                                      29200000
292100                                                                  29210000
292200*----------------------------------------------------------------*29220000
292300*    THE DB2 RESOURCE IS NOT AVAILABLE, DISPLAY A MESSAGE ON     *29230000
292400*    THE TERMINAL INDICATING THAT THE RESOURCE IS UNAVAILABLE.   *29240000
292500*----------------------------------------------------------------*29250000
292600 9900-SOFT-ABORT.                                                 29260000
292700                                                                  29270000
292800     EXEC CICS SYNCPOINT                                          29280000
292900          ROLLBACK                                                29290000
293000     END-EXEC.                                                    29300000
293100                                                                  29310000
293200     SET  PS-ERROR                                                29320000
293300          PS-SOFT-ABORT-ERROR                                     29330000
293400          DP020-MSG-FATAL       TO  TRUE.                         29340000
293500                                                                  29350000
293600*----------------------------------------------------------------*29360000
293700*    ABEND PROCESSOR MODULE                                      *29370000
293800*----------------------------------------------------------------*29380000
293900                                                                  29390000
294000     COPY DPPD013.                                                29400000
