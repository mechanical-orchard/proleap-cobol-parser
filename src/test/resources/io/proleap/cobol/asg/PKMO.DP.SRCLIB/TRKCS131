000100 IDENTIFICATION DIVISION.                                         00010008
000200 PROGRAM-ID.    TRKCS131.                                         00020009
000300 AUTHOR.        BARB SCHULTZ.                                     00030009
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040009
000500 DATE-WRITTEN.  AUGUST 2017.                                      00050009
000600 DATE-COMPILED.                                                   00060009
000700*---------------------------------------------------------------  00070009
000800*    TRAN Y131 for webservice arriveInboundTrailer                00080009
000900*---------------------------------------------------------------  00090009
AV0409*  April, 2021 - PRB0076404 - Anil Veduruparthi                   00100014
AV0409*    Adding logic to change SCAC-CDE, TRAILER-ID and USER-ID of   00110014
AV0409*    TRRD069 to Uppercase.                                        00120014
AV0409*---------------------------------------------------------------  00130014
001000*    May, 2018 - CHG0206901 - Jim Hunter                          00131014
001100*    Adding logic to create a Trailer and trip if the trailer     00132014
001200*    and scac entered is not found.                               00133014
001300*---------------------------------------------------------------  00134014
001400*    Oct, 2018 - CHG0209285 - Jim Hunter                          00140009
001500*    Changing definition of PV-CURR-FAC-AREA-ID from numeric to   00150009
001600*    character because it was causing zeroes to be set instead    00160009
001700*    of spaces.                                                   00170009
001800*---------------------------------------------------------------  00180009
001900*    Oct, 2018 - CHG0211077 - Added logic to update Manifest      00190009
002000*    number when not populated from creation.                     00200009
002100*    Format AG@MMDDYYYYAR as manifest and update TVHTRIP.         00210009
002200*---------------------------------------------------------------  00220009
002300*    JANUARY, 2019 - CHG0213345      Jim Hunter                   00230009
002400*    Moving "Update(s) Successful" message to message text        00240009
002500*    field when the call to get the message fails and the         00250009
002600*    message code = 00059 in paragraph 9910-READ-SYSTEM-MESSAGE.  00260009
002700*    The call failed immediately after CICS was brought up        00270009
002800*    following an IPL.                                            00280009
002900*---------------------------------------------------------------  00290009
003000*    March, 2019   - CHG0220844      Jim Hunter                   00300009
003100*    Adding edit of PV-USAGE-CDE.  If value is spaces, move       00310009
003200*    'RCS' to VEHICL-USAGE-CDE instead in Paragraph               00320009
003300*    2800-UPDATE-TVEHICL.                                         00330009
003400*---------------------------------------------------------------  00340009
003500                                                                  00350009
003600 ENVIRONMENT DIVISION.                                            00360009
003700                                                                  00370009
003800 DATA DIVISION.                                                   00380009
003900                                                                  00390009
004000 WORKING-STORAGE SECTION.                                         00400009
004100 01  PC-PROGRAM-CONSTANTS.                                        00410009
004200     05  PC-ZERO                    PIC S9(04)  VALUE +0   COMP.  00420009
004300     05  PC-997                     PIC S9(04)  VALUE +997 COMP.  00430009
004400     05  PC-998                     PIC S9(04)  VALUE +998 COMP.  00440009
004500     05  PC-999                     PIC S9(04)  VALUE +999 COMP.  00450009
004600     05  PC-I                       PIC  X(01)  VALUE 'I'.        00460009
004700     05  PC-N                       PIC  X(01)  VALUE 'N'.        00470009
004800     05  PC-CREATE-AUTO-MSG         PIC X(42) VALUE               00480009
004900         'CREATED AUTOMATICALLY WHEN TRAILER ARRIVED'.            00490009
005000     05  PC-RESOLVE-AUTO-MSG        PIC X(43) VALUE               00500009
005100         'RESOLVED AUTOMATICALLY WHEN TRAILER ARRIVED'.           00510009
005200     05  PC-TMKCS520                PIC X(08) VALUE 'TMKCS520'.   00520009
005300     05  PC-CURRENT-PROGRAM-NAME    PIC X(10) VALUE 'TRKCS131'.   00530009
005400     05  PC-DEFAULT-DATE            PIC X(10) VALUE  '0001-01-01'.00540009
005500     05  PC-DEFAULT-TIME            PIC X(08) VALUE  '00.00.00'.  00550009
005600     05  PC-RANDNBR-PGM             PIC X(08) VALUE  'DPKUT902'.  00560009
005700                                                                  00570009
AV0409     05  PV-UPPER-TRAILER-ID        PIC X(12) VALUE SPACES.       00571017
AV0409     05  PV-UPPER-SCAC-CDE          PIC X(04) VALUE SPACES.       00572017
AV0409     05  PV-UPPER-USER-ID           PIC X(08) VALUE SPACES.       00573017
005700                                                                  00574016
005800     05  PC-TSYMSG-NUMBERS.                                       00580009
005900         10  PC-TSYMSG-00007            PIC  9(05)  VALUE  00007. 00590009
006000*  REQUIRED ENTRY                                                 00600009
006100         10  PC-TSYMSG-00059            PIC  9(05)  VALUE  00059. 00610009
006200*  UPDATE(S) SUCCESSFUL                                           00620009
006300         10  PC-TSYMSG-01020            PIC  9(05)  VALUE  01020. 00630009
006400*  TRAILER ALREADY EXISTS                                         00640009
006500         10  PC-TSYMSG-01550            PIC  9(05)  VALUE  01550. 00650009
006600*  NO DATA EXISTS FOR THE REQUESTED SCAC/TRAILER NUMBER           00660009
006700         10  PC-TSYMSG-02609            PIC  9(05)  VALUE  02609. 00670009
006800*  INVALID SCAC CODE                                              00680009
006900         10  PC-TSYMSG-03389            PIC  9(05)  VALUE  03389. 00690009
007000*  TRAILER NUMBER IS REQUIRED WHEN ARRIVING                       00700009
007100         10  PC-TSYMSG-01570            PIC  9(05)  VALUE  01570. 00710009
007200*  A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK                00720009
007300         10  PC-TSYMSG-01668            PIC  9(05)  VALUE  01668. 00730009
007400*  TRAILER ARRIVED, BUT UNABLE TO RESOLVE/CREATE TRBLE - MUST     00740009
007500*  DO MANUALLY                                                    00750009
007600         10  PC-TSYMSG-01669            PIC  9(05)  VALUE  01669. 00760009
007700*  TRAILER ARRIVED, BUT ERROR IN TROUBLE PROCESSING - CONTACT     00770009
007800*  SYSTEMS                                                        00780009
007900         10  PC-TSYMSG-02319            PIC  9(05)  VALUE  02319. 00790009
008000*  INVALID DISTRIBUTION CENTER                                    00800009
008100         10  PC-TSYMSG-02816            PIC  9(05)  VALUE  02816. 00810009
008200*  INVALID TRAILER STATUS FOR UPDATE FUNCTION                     00820009
008300         10  PC-TSYMSG-03577            PIC  9(05)  VALUE  03577. 00830009
008400*  DC IS LIVE ON WMS - CAN ONLY CHANGE TRIP STATUS TO DEPARTED    00840009
008500         10  PC-TSYMSG-03731            PIC  9(05)  VALUE  03731. 00850009
008600*  FUNCTION DID NOT WORK - PARM VALUE NOT DEFINED                 00860009
008700         10  PC-TSYMSG-03787            PIC  9(05)  VALUE  03787. 00870009
008800*  FUNCTION IS CURRENTLY UNAVAILABLE                              00880009
008810         10  PC-TSYMSG-02999            PIC  9(05)  VALUE  02999. 00881010
008820*  WRONG OPERATING UNIT/FACILITY FOR THIS TRIP ID                 00882010
008900                                                                  00890009
009000 01  PS-SWITCHES.                                                 00900009
009100     05  PS-ASNS-TO-WMS-SW              PIC  X(01)  VALUE 'N'.    00910009
009200         88  PS-ASNS-TO-WMS-YES                     VALUE 'Y'.    00920009
009300         88  PS-ASNS-TO-WMS-NO                      VALUE 'N'.    00930009
009400     05  PS-NO-MORE-RECEIVRS-SW         PIC  X(01)  VALUE 'N'.    00940009
009500             88  PS-NO-MORE-RECEIVRS                VALUE 'Y'.    00950009
009600     05  PS-DC-PLANNING-SW              PIC  X(01)  VALUE 'Y'.    00960009
009700         88  PS-DC-PLANNING-YES                     VALUE 'Y'.    00970009
009800         88  PS-DC-PLANNING-NO                      VALUE 'N'.    00980009
009900     05  PS-SHIPMENT-CURSOR-SW          PIC  X(01)  VALUE 'N'.    00990009
010000         88  PS-NO-MORE-SHIPMENTS                   VALUE 'Y'.    01000009
010100     05  PS-TRBL-CREATED-SW             PIC  X(01)  VALUE 'N'.    01010009
010200         88  PS-NO-TRBL-CREATED-ONSITE              VALUE 'N'.    01020009
010300         88  PS-TRBL-CREATED-ONSITE                 VALUE 'Y'.    01030009
010400     05  PS-TRBL-ACCESS-TRBL-SW         PIC  X(01)  VALUE 'N'.    01040009
010500         88  PS-NO-TRBL-ACCESS-TRBL                 VALUE 'N'.    01050009
010600         88  PS-TRBL-ACCESS-TRBL-W                  VALUE 'W'.    01060009
010700         88  PS-TRBL-ACCESS-TRBL-F                  VALUE 'F'.    01070009
010800     05  PS-UPDATE-MANIFEST-SW          PIC  X(01)  VALUE 'N'.    01080009
010900         88  PS-UPDATE-MANIFEST-YES                 VALUE 'Y'.    01090009
011000         88  PS-UPDATE-MANIFEST-NO                  VALUE 'N'.    01100009
011100     05  PS-CREATE-TRAILER-ID-SW        PIC  X(01)  VALUE 'N'.    01110009
011200         88  PS-CREATE-TRAILER-ID-NO                VALUE 'N'.    01120009
011300         88  PS-CREATE-TRAILER-ID-YES               VALUE 'Y'.    01130009
011400     05  PS-END-TRIP-FOUND-SW           PIC  X(01)  VALUE 'N'.    01140009
011500         88  PS-END-TRIP-FOUND-NO                   VALUE 'N'.    01150009
011600         88  PS-END-TRIP-FOUND-YES                  VALUE 'Y'.    01160009
011700                                                                  01170009
011800******************************************************************01180009
011900 01  PV-PROGRAM-VARIABLES.                                        01190009
012000     05  PV-TSYMSG-NUMBER            PIC 9(05)  VALUE  0.         01200009
012100     05  PV-SQLCODE                  PIC 9(09)  VALUE  0.         01210009
012200     05  PV-DISPLAY-DC               PIC 9(04)  VALUE  0.         01220009
012201     05  PV-DISPLAY-OPER             PIC 9(04)  VALUE  0.         01220110
012300     05  PV-DISP-FCLTY               PIC 99     VALUE  0.         01230009
012400     05  PV-RCV-ORD-NBR              PIC 9(9)   VALUE  0.         01240009
012500     05  PV-RCV-REC-SEQ-NBR          PIC 9(9)   VALUE  0.         01250009
012600     05  PV-VEH-SIZE-CDE             PIC X(02)  VALUE SPACES.     01260009
012700     05  PV-CURR-STAT-DTE            PIC X(10)  VALUE SPACES.     01270009
012800     05  PV-CURR-STAT-TME            PIC X(08)  VALUE SPACES.     01280009
012900     05  PV-CURR-FAC-AREA-ID         PIC X(6)   VALUE SPACES.     01290009
013000     05  PV-CURR-TRIP-ID             PIC S9(09) VALUE +0 COMP-3.  01300009
013100     05  PV-DEFAULT-MANIFEST.                                     01310009
013200         10  PV-DFLT-MAN-PREFIX      PIC X(3)   VALUE 'AG@'.      01320009
013300         10  PV-DFLT-MAN-MM          PIC X(2)   VALUE  SPACES.    01330009
013400         10  PV-DFLT-MAN-DD          PIC X(2)   VALUE  SPACES.    01340009
013500         10  PV-DFLT-MAN-CCYY        PIC X(4)   VALUE  SPACES.    01350009
013600         10  PV-DFLT-MAN-AR          PIC X(2)   VALUE  SPACES.    01360009
013700     05  PV-SELECT-DATE              PIC X(10)  VALUE  SPACES.    01370009
013800     05  PV-VHTRIP-COUNT             PIC S9(09) VALUE  +0 COMP-3. 01380009
013900     05  PV-VEH-NBR                  PIC X(10)  VALUE  SPACES.    01390009
014000     05  PV-OWNER-SCAC-ID            PIC X(04)  VALUE  SPACES.    01400009
014100     05  PV-TRIP-STATUS-CDE          PIC X(02)  VALUE SPACES.     01410009
014200     05  PV-FCLTY-ID                 PIC S9(4) COMP VALUE ZEROES. 01420009
014300     05  PV-FCLTY-AREA               PIC X(6)   VALUE SPACES.     01430009
014400     05  PV-STATUS-DTE               PIC X(10)  VALUE SPACES.     01440009
014500     05  PV-STATUS-TME               PIC X(8)   VALUE SPACES.     01450009
014600     05  PV-VEH-TYP-CDE              PIC X(02)  VALUE SPACES.     01460009
014700     05  PV-TRBL-RSLV-CT             PIC S9(04) VALUE +0 COMP-3.  01470009
014800     05  PV-REC-TMST                 PIC X(26)  VALUE SPACES.     01480009
014900     05  PV-CMPR-STATUS-DTE             PIC X(10)  VALUE SPACES.  01490009
015000     05  PV-CMPR-STATUS-TME.                                      01500009
015100         10  PV-CMPR-STATUS-TME-HH      PIC 9(02).                01510009
015200         10  FILLER                     PIC X(01).                01520009
015300         10  PV-CMPR-STATUS-TME-MM      PIC 9(02).                01530009
015400         10  FILLER                     PIC X(01).                01540009
015500         10  PV-CMPR-STATUS-TME-SS      PIC 9(02).                01550009
015600     05  PV-ABSTIME                     PIC S9(15)  COMP.         01560009
015700     05  PV-TRIPST-DTE.                                           01570009
015800         10  FILLER                     PIC X(02).                01580009
015900         10  PV-TRIPST-YY               PIC X(02).                01590009
016000         10  FILLER                     PIC X(01).                01600009
016100         10  PV-TRIPST-MM               PIC X(02).                01610009
016200         10  FILLER                     PIC X(01).                01620009
016300         10  PV-TRIPST-DD               PIC X(02).                01630009
016400                                                                  01640009
016500     05  PV-TRIPST-TME.                                           01650009
016600         10  PV-TRIPST-HH               PIC X(02).                01660009
016700         10  FILLER                     PIC X(01).                01670009
016800         10  PV-TRIPST-MIN              PIC X(02).                01680009
016900         10  FILLER                     PIC X(03).                01690009
017000                                                                  01700009
017100     05  PV-TRIP-MMDDYY.                                          01710009
017200         10  PV-TRIP-MM                 PIC X(02).                01720009
017300         10  FILLER                     PIC X(01)  VALUE '/'.     01730009
017400         10  PV-TRIP-DD                 PIC X(02).                01740009
017500         10  FILLER                     PIC X(01)  VALUE '/'.     01750009
017600         10  PV-TRIP-YY                 PIC X(02).                01760009
017700                                                                  01770009
017800     05  PV-TRIP-TME.                                             01780009
017900         10  PV-TRIP-HH                 PIC X(02).                01790009
018000         10  FILLER                     PIC X(01)  VALUE ':'.     01800009
018100         10  PV-TRIP-MIN                PIC X(02).                01810009
018200                                                                  01820009
018300     05  PV-TRBL-MSG-NO              PIC 9(05)  VALUE 0.          01830009
018400     05  PV-DB2-HOST-DATE            PIC X(10)  VALUE SPACES.     01840009
018500     05  PV-DB2-HOST-DATE-30         PIC X(10)  VALUE SPACES.     01850009
018600     05  PV-DB2-HOST-TIME            PIC X(08)  VALUE SPACES.     01860009
018700     05  PV-CICS-MSG-AREA.                                        01870009
018800         10 PV-PROGRAM-NAME          PIC X(10) VALUE ' TRKCS131 '.01880009
018900         10 PV-PARA-NAME             PIC X(25) VALUE SPACES.      01890009
019000         10 PV-ERROR-MSG             PIC X(85) VALUE SPACES.      01900009
019100     05  PV-COMMAREA-LENGTH          PIC S9(04) VALUE +0          01910009
019200                                                COMP SYNC.        01920009
019300     05  PV-CICS-RESPONSE            PIC S9(08) VALUE ZEROS       01930009
019400                                                COMP SYNC.        01940009
019500     05  PV-DB2-COUNT-NON-AP-RCVRS   PIC S9(09) VALUE +0          01950009
019600                                                COMP-3.           01960009
019700     05  PV-DC-NBR               PIC S9(4) VALUE ZERO COMP.       01970009
019800     05  PV-KEY-OWNER-SCAC-ID    PIC X(04) VALUE SPACES.          01980009
019900     05  PV-LENGTH               PIC X(02)  VALUE SPACES.         01990009
020000     05  PV-TRIP-ID              PIC S9(09) VALUE +0 COMP.        02000009
020100     05  PV-TRIP-ID-DIS          PIC 9(09)  VALUE ZERO.           02010009
020200     05  PV-USAGE-CDE            PIC X(03)  VALUE SPACES.         02020009
020300     05  PV-CURR-OPER-UNT-ID     PIC X(04)  VALUE SPACES.         02030009
020400     05  PV-CURR-OPER-UNT-ID-N REDEFINES                          02040009
020500         PV-CURR-OPER-UNT-ID     PIC 9(04).                       02050009
020600     05  PV-CURR-FCLTY-ID        PIC X(04)  VALUE SPACES.         02060009
020700     05  PV-CURR-FCLTY-ID-N REDEFINES                             02070009
020800         PV-CURR-FCLTY-ID        PIC 9(04).                       02080009
020900     05  PV-SHIPT-ID             PIC S9(9) COMP VALUE ZERO.       02090009
021000     05  PV-SHIPT-ID-DIS         PIC  9(9)      VALUE ZERO.       02100009
021100     05  PV-CURR-STATUS-CCYYMMDD.                                 02110009
021200         10  PV-CURR-STATUS-CC          PIC X(02).                02120009
021300         10  PV-CURR-STATUS-DTE         PIC X(08).                02130009
021400         10  FILLER REDEFINES PV-CURR-STATUS-DTE.                 02140009
021500             15  PV-CURR-STATUS-YY      PIC X(02).                02150009
021600             15  FILLER                 PIC X(06).                02160009
021700     05  PV-CURR-STATUS-TME             PIC X(08)  VALUE SPACES.  02170009
021800                                                                  02180009
021900 01  PV-SWITCHES.                                                 02190009
022000     05  PV-VEHICLE-SETUP-PREV-SW       PIC X(01).                02200009
022100         88  PV-VEHICLE-NOT-SETUP-PREV  VALUE 'N'.                02210009
022200         88  PV-VEHICLE-NULL-TRIP       VALUE 'L'.                02220009
022300         88  PV-VEHICLE-SETUP-PREV      VALUE 'Y'.                02230009
022400     05  PV-VEHICLE-STATUS-SW           PIC X(02).                02240009
022500         88  PV-VEHICLE-ARRIVED         VALUE 'AR'.               02250009
022600         88  PV-VEHICLE-BEG-UNLD        VALUE 'UG'.               02260009
022700         88  PV-VEHICLE-BEG-LOAD        VALUE 'LG'.               02270009
022800         88  PV-VEHICLE-DEPARTED        VALUE 'DP'.               02280009
022900         88  PV-VEHICLE-ENROUTE         VALUE 'EN'.               02290009
023000         88  PV-VEHICLE-LOADED          VALUE 'LD'.               02300009
023100         88  PV-VEHICLE-UNLD            VALUE 'UN'.               02310009
023200                                                                  02320009
023300 01  DK-DB2-KEYS.                                                 02330009
023400     05  DK-OWNER-SCAC-ID          PIC  X(04)  VALUE SPACE.       02340009
023500     05  DK-VEH-NBR                PIC  X(10)  VALUE SPACE.       02350009
023600     05  DK-OPER-UNT-ID            PIC S9(04)  VALUE +0 COMP.     02360009
023700     05  DK-FCLTY-ID               PIC S9(04)  VALUE +0 COMP.     02370009
023800     05  DK-TRIP-ID                PIC S9(09)  VALUE +0 COMP.     02380009
023900     05  DK-ARRIVAL-DTE            PIC  X(10)  VALUE SPACE.       02390009
024000                                                                  02400009
024100 01  DN-NULL-INDICATORS.                                          02410009
024200     05  DN-CURR-TRIP-ID           PIC S9(04) COMP VALUE +0.      02420009
024300     05  DN-VEH-NBR                PIC S9(4) COMP VALUE +0.       02430009
024400     05  DN-EST-AR-TMST            PIC S9(4) COMP VALUE +0.       02440009
024500                                                                  02450009
024600                                                                  02460009
024700*---------------------------------------------------------------* 02470009
024800* INPUT MESSAGE FROM KIOSK                                        02480009
024900*---------------------------------------------------------------* 02490009
025000     COPY TRRD069.                                                02500009
025100                                                                  02510009
025200*---------------------------------------------------------------* 02520009
025300* OUTPUT MESSAGE BACK TO KIOSK                                    02530009
025400*---------------------------------------------------------------* 02540009
025500     COPY TRRD070.                                                02550009
025600                                                                  02560009
025700*----------------------------------------------------------------*02570009
025800*  THIS IS THE INPUT RECORD DESCRIPTION FOR THE SYSTEM           *02580009
025900*  MESSAGES FILE USED FOR CICS MESSAGES.                         *02590009
026000*----------------------------------------------------------------*02600009
026100     COPY DPRD507I.                                               02610009
026200                                                                  02620009
026300*---------------------------------------------------------------* 02630009
026400*  COMMUNICATION AREA PASSED TO WRITE INFORMATION                 02640009
026500*  TO THE EAI EXPORT TABLES (XLKUP033)                            02650009
026600*---------------------------------------------------------------* 02660009
026700     COPY XLWS072.                                                02670009
026800                                                                  02680009
026900*----------------------------------------------------------------*02690009
027000*  COMMAREA FOR TMKCS520 -- TROUBLE PROCESSING MODULE            *02700009
027100*----------------------------------------------------------------*02710009
027200     COPY TMWS500.                                                02720009
027300                                                                  02730009
027400*----------------------------------------------------------------*02740009
027500*  WORK AREA PASSED IN CALL TO DPKUT902                          *02750009
027600*----------------------------------------------------------------*02760009
027700     COPY DPWS902.                                                02770009
027800                                                                  02780009
027900                                                                  02790009
028000                                                                  02800009
028100     EXEC SQL                                                     02810009
028200         INCLUDE SQLCA                                            02820009
028300     END-EXEC.                                                    02830009
028400                                                                  02840009
028500*---------------------------------------------------------------* 02850009
028600*    PARM TABLE                                                 * 02860009
028700*---------------------------------------------------------------* 02870009
028800     EXEC SQL                                                     02880009
028900         INCLUDE TKRPRPM                                          02890009
029000     END-EXEC.                                                    02900009
029100                                                                  02910009
029200*---------------------------------------------------------------* 02920009
029300*    DB2 AREA FOR THE SHIPMT PO TABLE                           * 02930009
029400*---------------------------------------------------------------* 02940009
029500     EXEC SQL                                                     02950009
029600          INCLUDE TSHPTPO                                         02960009
029700     END-EXEC.                                                    02970009
029800                                                                  02980009
029900*---------------------------------------------------------------* 02990009
030000*    DB2 AREA FOR THE RECEIVER TABLE                            * 03000009
030100*---------------------------------------------------------------* 03010009
030200     EXEC SQL                                                     03020009
030300          INCLUDE TRECEIV                                         03030009
030400     END-EXEC.                                                    03040009
030500                                                                  03050009
030600*---------------------------------------------------------------* 03060009
030700*    DB2 AREA FOR THE TRIP STATUS CODE TABLE                    * 03070009
030800*---------------------------------------------------------------* 03080009
030900     EXEC SQL                                                     03090009
031000          INCLUDE TTRSTYP                                         03100009
031100     END-EXEC.                                                    03110009
031200                                                                  03120009
031300*---------------------------------------------------------------* 03130009
031400*    DB2 AREA FOR THE SHIPMENT TABLE                            * 03140009
031500*---------------------------------------------------------------* 03150009
031600     EXEC SQL                                                     03160009
031700          INCLUDE TSHIPMT                                         03170009
031800     END-EXEC.                                                    03180009
031900                                                                  03190009
032000*---------------------------------------------------------------* 03200009
032100*    DB2 AREA FOR THE EXTERNAL ENTERPRISE TABLE                 * 03210009
032200*---------------------------------------------------------------* 03220009
032300     EXEC SQL                                                     03230009
032400          INCLUDE TEXTENT                                         03240009
032500     END-EXEC.                                                    03250009
032600                                                                  03260009
032700*---------------------------------------------------------------* 03270009
032800*    DB2 AREA FOR THE VEHICLE TABLE                             * 03280009
032900*---------------------------------------------------------------* 03290009
033000     EXEC SQL                                                     03300009
033100          INCLUDE TVEHICL                                         03310009
033200     END-EXEC.                                                    03320009
033300                                                                  03330009
033400*---------------------------------------------------------------* 03340009
033500*    DB2 AREA FOR VEHICLE TRIP TABLE                            * 03350009
033600*---------------------------------------------------------------* 03360009
033700     EXEC SQL                                                     03370009
033800          INCLUDE TVHTRIP                                         03380009
033900     END-EXEC.                                                    03390009
034000                                                                  03400009
034100*---------------------------------------------------------------* 03410009
034200*    DB2 AREA FOR VEHICLE TRIP AUDIT TABLE                      * 03420009
034300*---------------------------------------------------------------* 03430009
034400     EXEC SQL                                                     03440009
034500          INCLUDE TAUTRIP                                         03450009
034600     END-EXEC.                                                    03460009
034700                                                                  03470009
034800*---------------------------------------------------------------* 03480009
034900*    DB2 AREA FOR SUT_TRLR_RPLN_CART                            * 03490009
035000*---------------------------------------------------------------* 03500009
035100     EXEC SQL                                                     03510009
035200          INCLUDE SUT00113                                        03520009
035300     END-EXEC.                                                    03530009
035400                                                                  03540009
035500*---------------------------------------------------------------* 03550009
035600*    DB2 AREA FOR THE TRIP STATUS TABLE                         * 03560009
035700*---------------------------------------------------------------* 03570009
035800     EXEC SQL                                                     03580009
035900          INCLUDE TTRIPST                                         03590009
036000     END-EXEC.                                                    03600009
036100                                                                  03610009
036200*---------------------------------------------------------------* 03620009
036300*    DB2 AREA FOR THE SHIPMENT STATUS CODE TABLE                * 03630009
036400*---------------------------------------------------------------* 03640009
036500     EXEC SQL                                                     03650009
036600          INCLUDE TSHSTYP                                         03660009
036700     END-EXEC.                                                    03670009
036800                                                                  03680009
036900*---------------------------------------------------------------* 03690009
037000*    DB2 AREA FOR THE SHIPMENT STATUS TABLE                     * 03700009
037100*---------------------------------------------------------------* 03710009
037200     EXEC SQL                                                     03720009
037300          INCLUDE TSHIPST                                         03730009
037400     END-EXEC.                                                    03740009
037500                                                                  03750009
037600*---------------------------------------------------------------* 03760009
037700*    DB2 AREA FOR VEHICLE AUDIT TABLE                           * 03770009
037800*---------------------------------------------------------------* 03780009
037900     EXEC SQL                                                     03790009
038000          INCLUDE TAUVHCL                                         03800009
038100     END-EXEC.                                                    03810009
038200                                                                  03820009
038300*---------------------------------------------------------------* 03830009
038400*    DB2 AREA FOR LOGISTICS LOCATION TABLE - XLT_LOC            * 03840009
038500*---------------------------------------------------------------* 03850009
038600     EXEC SQL                                                     03860009
038700          INCLUDE XLT00010                                        03870009
038800     END-EXEC.                                                    03880009
038900                                                                  03890009
039000*---------------------------------------------------------------* 03900009
039100*    DB2 AREA FOR TROUBLE NOTIFICATION TABLE                    * 03910009
039200*---------------------------------------------------------------* 03920009
039300     EXEC SQL                                                     03930009
039400          INCLUDE TTRBNTF                                         03940009
039500     END-EXEC.                                                    03950009
039600                                                                  03960009
039700*---------------------------------------------------------------* 03970009
039800*  CURSOR TO LIST RECEIVERS FOR A TRIP                          * 03980009
039900*---------------------------------------------------------------* 03990009
040000     EXEC SQL                                                     04000009
040100          DECLARE RECEIVR-CSR CURSOR FOR                          04010009
040200           SELECT C.ORD_NBR                                       04020009
040300                , C.REC_SEQ_NBR                                   04030009
040400                , C.STATUS_CDE                                    04040009
040500                , C.CRE_TMST                                      04050009
040600            FROM  TSHIPMT A                                       04060009
040700                , TSHPTPO B                                       04070009
040800                , TRECEIV C                                       04080009
040900           WHERE  A.TRIP_ID     = :PV-TRIP-ID                     04090009
041000             AND  A.TRIP_ID IS NOT NULL                           04100009
041100             AND  A.SHIPT_ID    = B.SHIPT_ID                      04110009
041200             AND  B.REC_SEQ_NBR > :PC-ZERO                        04120009
041300             AND  B.REC_SEQ_NBR = C.REC_SEQ_NBR                   04130009
041400             AND  B.PO_NBR      = C.ORD_NBR                       04140009
041500     END-EXEC.                                                    04150009
041600                                                                  04160009
041700***************************************************************** 04170009
041800*  CURSOR TO LIST SHIPMENTS FOR A TRIP                          * 04180009
041900***************************************************************** 04190009
042000                                                                  04200009
042100     EXEC SQL                                                     04210009
042200          DECLARE SHIPMENT-CSR CURSOR FOR                         04220009
042300           SELECT SHIPT_ID                                        04230009
042400            FROM  TSHIPMT                                         04240009
042500           WHERE (TRIP_ID = :PV-TRIP-ID                           04250009
042600             AND  TRIP_ID IS NOT NULL)                            04260009
042700         ORDER BY SHIPT_ID                                        04270009
042800     END-EXEC.                                                    04280009
042900                                                                  04290009
043000******************************************************************04300009
043100 LINKAGE SECTION.                                                 04310009
043200                                                                  04320009
043300 01  DFHCOMMAREA.                                                 04330009
043400     05  FILLER                         OCCURS  1 TO 32000 TIMES  04340009
043500                                        DEPENDING ON EIBCALEN.    04350009
043600         10  FILLER                     PIC X.                    04360009
043700                                                                  04370009
043800 PROCEDURE DIVISION.                                              04380009
043900***************************************************************** 04390009
044000** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 04400009
044100***************************************************************** 04410009
044200 0000-MAIN-MODULE.                                                04420009
044300                                                                  04430009
044400     PERFORM 1000-INITIALIZE.                                     04440009
044500     IF EIBCALEN > 0                                              04450009
044600        MOVE DFHCOMMAREA(1:28)     TO TR069-INP-ARRIVE-INB-TLR    04460009
044700        PERFORM 1100-CHECK-WEBSERV-AVAIL                          04470009
044800        PERFORM 1200-VALIDATE-DC-NBR                              04480009
044900        PERFORM 1300-VALIDATE-SCAC-CDE                            04490009
045000        PERFORM 1400-VALIDATE-USER-ID                             04500009
045100        PERFORM 1500-VALIDATE-TRAILER-ID                          04510009
045200                                                                  04520009
045300        IF PS-END-TRIP-FOUND-YES                                  04530009
045400           PERFORM 5000-ADD-VEHICLE                               04540009
045500        END-IF                                                    04550009
045600                                                                  04560009
045700        IF PV-VEHICLE-NOT-SETUP-PREV                              04570009
045800**          WHEN A TRAILER IS NOT FOUND ON INITIAL EXEC OF        04580009
045900**          PARA 1500-VALIDATE-TRAILER ID, IT WILL EXECUTE        04590009
046000**          5000- SERIES OF PARAGRAPHS TO CREATE A TRAILER        04600009
046100**          SET TO A STATUS OF 'EN'.  EXECUTE 1500- AGAIN         04610009
046200**          TO BEGIN THE PROCESS OF ARRIVING THE CREATED          04620009
046300**          TRAILER.                                              04630009
046400            PERFORM 1500-VALIDATE-TRAILER-ID                      04640009
046500        END-IF                                                    04650009
046600                                                                  04660009
046700        IF PV-VEHICLE-SETUP-PREV AND PS-CREATE-TRAILER-ID-NO      04670009
046800           PERFORM 1600-VALIDATE-MANIFEST-NBR                     04680009
046900        END-IF                                                    04690009
047000*                                                                 04700009
047100        PERFORM 2100-SELECT-TKRPRPM-DC                            04710009
047200        PERFORM 2200-CHECK-AP-ON-TRECEIV                          04720009
047300                                                                  04730009
047400        IF PS-ASNS-TO-WMS-YES                                     04740009
047500            IF PV-DB2-COUNT-NON-AP-RCVRS > 0                      04750009
047600                MOVE PC-TSYMSG-03577   TO PV-TSYMSG-NUMBER        04760009
047700*               DC IS LIVE ON WMS -                               04770009
047800*               CAN ONLY CHANGE TRIP STATUS TO DEPARTED           04780009
047900                MOVE TR069-DC-NBR               TO PV-DISPLAY-DC  04790009
048000                STRING 'STATUS MUST BE DP FOR WMS AND '           04800009
048100                       'NON AP RCVRS'                             04810009
048200                      ' TLR ' TR069-TRAILER-ID                    04820009
048300                      ' SCAC ' TR069-TRLR-SCAC-CDE                04830009
048400                      ' ' PV-DISPLAY-DC                           04840009
048500                      ' ' TR069-USER-ID                           04850009
048600                    DELIMITED BY SIZE INTO  PV-ERROR-MSG          04860009
048700                MOVE '0000-MAIN-MODULE         ' TO PV-PARA-NAME  04870009
048800                PERFORM 9500-CSSL-LOG                             04880009
048900                PERFORM 9800-ROLLBACK                             04890009
049000                PERFORM 9900-RETURN-TRAN                          04900009
049100            END-IF                                                04910009
049200        END-IF                                                    04920009
049300                                                                  04930009
049400        PERFORM 2300-UPDATE-TRIP-STATUS                           04940009
049500        PERFORM 2600-UPDATE-RECEIVERS                             04950009
049600        PERFORM 2700-CHECK-FOR-PLANNING                           04960009
049700        PERFORM 2800-UPDATE-TVEHICL                               04970009
049800        PERFORM 2850-AUDIT-TVEHICL                                04980009
049900        IF PS-UPDATE-MANIFEST-YES                                 04990009
050000           PERFORM 2890-SET-MANIFEST-NBR                          05000009
050100           PERFORM 2900-UPDATE-TVHTRIP                            05010009
050200           PERFORM 5600-AUDIT-TVHTRIP                             05020009
050300        END-IF                                                    05030009
050400        PERFORM 3000-SHIPMENT-PROCESSING                          05040009
050500     ELSE                                                         05050009
050600        MOVE PC-TSYMSG-00007             TO PV-TSYMSG-NUMBER      05060009
050700*       REQUIRED ENTRY                                            05070009
050800        MOVE ' EIBCALEN = ZERO, NO DATA RECEIVED'                 05080009
050900                                         TO PV-ERROR-MSG          05090009
051000        MOVE '0000-MAIN-MODULE         ' TO PV-PARA-NAME          05100009
051100        PERFORM 9500-CSSL-LOG                                     05110009
051200        PERFORM 9800-ROLLBACK                                     05120009
051300        PERFORM 9900-RETURN-TRAN                                  05130009
051400     END-IF.                                                      05140009
051500                                                                  05150009
051600     MOVE TR069-DC-NBR                   TO PV-DISPLAY-DC.        05160009
051700     MOVE '0000-MAIN-MODULE 2'           TO PV-PARA-NAME.         05170009
051800     STRING ' ARRIVAL COMPLETED FOR'                              05180009
051900            ' TLR ' TR069-TRAILER-ID                              05190009
052000            ' SCAC ' TR069-TRLR-SCAC-CDE                          05200009
052100            ' ' PV-DISPLAY-DC                                     05210009
052200            ' ' TR069-USER-ID                                     05220009
052300            DELIMITED BY SIZE INTO  PV-ERROR-MSG.                 05230009
052400     PERFORM 9500-CSSL-LOG.                                       05240009
052500     MOVE PC-TSYMSG-00059                TO PV-TSYMSG-NUMBER.     05250009
052600*    UPDATE(S) SUCCESSFUL                                         05260009
052700     PERFORM 9900-RETURN-TRAN.                                    05270009
052800                                                                  05280009
052900                                                                  05290009
053000***************************************************************** 05300009
053100* INITIALIZE THE INPUT AND OUTPUT RECORDS                         05310009
053200***************************************************************** 05320009
053300                                                                  05330009
053400 1000-INITIALIZE.                                                 05340009
053500     INITIALIZE TR069-INP-ARRIVE-INB-TLR                          05350009
053600                TR070-OUT-ARRIVE-INB-TLR.                         05360009
053700                                                                  05370009
053800***************************************************************** 05380009
053900* CHECK TO SEE THAT THE WEBSERVICE IS AVAILABLE                   05390009
054000***************************************************************** 05400009
054100 1100-CHECK-WEBSERV-AVAIL.                                        05410009
054200                                                                  05420009
054300      EXEC SQL                                                    05430009
054400        SELECT FUNC_TXT                                           05440009
054500          INTO :KRPRPM-FUNC-TXT                                   05450009
054600          FROM TKRPRPM                                            05460009
054700        WHERE LOC_ID            = 90                              05470009
054800          AND INTFC_SYS_CDE     = 'KHL'                           05480009
054900          AND SYS_PRC_FUNC_CDE  = 'STWEB9'                        05490009
055000          AND FUNC_PRC_STAT_CDE = 'AC'                            05500009
055100          AND FUNC_BEG_TMST    <=  CURRENT TIMESTAMP              05510009
055200          AND FUNC_END_TMST    >=  CURRENT TIMESTAMP              05520009
055300          AND FUNC_TXT          = 'Y'                             05530009
055400        WITH UR                                                   05540009
055500      END-EXEC.                                                   05550009
055600                                                                  05560009
055700      EVALUATE TRUE                                               05570009
055800         WHEN SQLCODE = ZERO                                      05580009
055900            CONTINUE                                              05590009
056000         WHEN SQLCODE = +100                                      05600009
056100            MOVE PC-TSYMSG-03787            TO PV-TSYMSG-NUMBER   05610009
056200*           FUNCTION IS CURRENTLY UNAVAILABLE                     05620009
056300            MOVE '1100-CHECK-WEBSERV-AVAIL' TO PV-PARA-NAME       05630009
056400            MOVE TR069-DC-NBR               TO PV-DISPLAY-DC      05640009
056500            STRING 'WEB SERVICE STWEB9 NOT AVAILABLE'             05650009
056600                   ' TLR ' TR069-TRAILER-ID                       05660009
056700                   ' SCAC ' TR069-TRLR-SCAC-CDE                   05670009
056800                   ' ' PV-DISPLAY-DC                              05680009
056900                   ' ' TR069-USER-ID                              05690009
057000                 DELIMITED BY SIZE INTO  PV-ERROR-MSG             05700009
057100            PERFORM 9500-CSSL-LOG                                 05710009
057200            PERFORM 9800-ROLLBACK                                 05720009
057300            PERFORM 9900-RETURN-TRAN                              05730009
057400         WHEN OTHER                                               05740009
057500            MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER   05750009
057600*           A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK       05760009
057700            MOVE SQLCODE                    TO PV-SQLCODE         05770009
057800            MOVE TR069-DC-NBR               TO PV-DISPLAY-DC      05780009
057900            MOVE '1100-CHECK-WEBSERV-AVAIL' TO PV-PARA-NAME       05790009
058000            STRING 'SELECT TKRPRPM - STWEB9 FAILED WITH SQL '     05800009
058100                     PV-SQLCODE                                   05810009
058200                   ' TLR ' TR069-TRAILER-ID                       05820009
058300                   ' SCAC ' TR069-TRLR-SCAC-CDE                   05830009
058400                   ' ' PV-DISPLAY-DC                              05840009
058500                   ' ' TR069-USER-ID                              05850009
058600                 DELIMITED BY SIZE INTO  PV-ERROR-MSG             05860009
058700            PERFORM 9500-CSSL-LOG                                 05870009
058800            PERFORM 9800-ROLLBACK                                 05880009
058900            PERFORM 9900-RETURN-TRAN                              05890009
059000     END-EVALUATE.                                                05900009
059100                                                                  05910009
059200***************************************************************** 05920009
059300* VALIDATE DISTRIBUTION NUMBER                                    05930009
059400***************************************************************** 05940009
059500 1200-VALIDATE-DC-NBR.                                            05950009
059600                                                                  05960009
059700     IF TR069-DC-NBR = ZEROES                                     05970009
059800          MOVE PC-TSYMSG-02319           TO PV-TSYMSG-NUMBER      05980009
059900*         INVALID DISTRIBUTION CENTER                             05990009
060000          MOVE '1200-VALIDATE-DC-NBR '   TO PV-PARA-NAME          06000009
060100          MOVE TR069-DC-NBR              TO PV-DISPLAY-DC         06010009
060200          STRING 'DC NUMBER MUST BE > ZERO - IS '                 06020009
060300                  PV-DISPLAY-DC                                   06030009
060400                 ' TRAILER ' TR069-TRAILER-ID                     06040009
060500                 ' SCAC ' TR069-TRLR-SCAC-CDE                     06050009
060600                 ' ' TR069-USER-ID                                06060009
060700                  DELIMITED BY SIZE INTO  PV-ERROR-MSG            06070009
060800          PERFORM 9500-CSSL-LOG                                   06080009
060900          PERFORM 9800-ROLLBACK                                   06090009
061000          PERFORM 9900-RETURN-TRAN                                06100009
061100     END-IF.                                                      06110009
061200                                                                  06120009
061300     MOVE TR069-DC-NBR TO PV-DC-NBR.                              06130009
061400                                                                  06140009
061500     EXEC SQL                                                     06150009
061600         SELECT LOC_TYP_CDE                                       06160009
061700         INTO :XLT00010-LOC-TYP-CDE                               06170009
061800         FROM XLT_LOC                                             06180009
061900         WHERE LOC_NBR     = :PV-DC-NBR                           06190009
062000           AND LOC_TYP_CDE = 'DC'                                 06200009
062100           AND OPN_DTE     < CURRENT DATE + 1 DAY                 06210009
062200           AND CLO_DTE     > CURRENT DATE                         06220009
062300     END-EXEC.                                                    06230009
062400                                                                  06240009
062500     EVALUATE TRUE                                                06250009
062600         WHEN SQLCODE = ZERO                                      06260009
062700             CONTINUE                                             06270009
062800                                                                  06280009
062900         WHEN SQLCODE = +100                                      06290009
063000              MOVE PC-TSYMSG-02319           TO PV-TSYMSG-NUMBER  06300009
063100*             INVALID DISTRIBUTION CENTER                         06310009
063200              MOVE '1200-VALIDATE-DC-NBR '   TO PV-PARA-NAME      06320009
063300              MOVE SQLCODE                   TO PV-SQLCODE        06330009
063400              MOVE TR069-DC-NBR              TO PV-DISPLAY-DC     06340009
063500              STRING 'DC ' PV-DISPLAY-DC                          06350009
063600                     ' INVALID ON XLT-LOC '                       06360009
063700                       PV-SQLCODE                                 06370009
063800                     ' TLR ' TR069-TRAILER-ID                     06380009
063900                     ' SCAC ' TR069-TRLR-SCAC-CDE                 06390009
064000                     ' ' TR069-USER-ID                            06400009
064100                      DELIMITED BY SIZE INTO  PV-ERROR-MSG        06410009
064200              PERFORM 9500-CSSL-LOG                               06420009
064300              PERFORM 9800-ROLLBACK                               06430009
064400              PERFORM 9900-RETURN-TRAN                            06440009
064500                                                                  06450009
064600         WHEN OTHER                                               06460009
064700             MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER  06470009
064800*            A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK      06480009
064900             MOVE SQLCODE                    TO PV-SQLCODE        06490009
065000             MOVE '1200-VALIDATE-DC-NBR'     TO PV-PARA-NAME      06500009
065100             MOVE TR069-DC-NBR               TO PV-DISPLAY-DC     06510009
065200             STRING 'SELECT ON XLT_LOC FAILED WITH SQL '          06520009
065300                     PV-SQLCODE 'FOR ' PV-DISPLAY-DC              06530009
065400                    ' TLR ' TR069-TRAILER-ID                      06540009
065500                    ' SCAC ' TR069-TRLR-SCAC-CDE                  06550009
065600                    ' ' TR069-USER-ID                             06560009
065700                DELIMITED BY SIZE INTO  PV-ERROR-MSG              06570009
065800             PERFORM 9500-CSSL-LOG                                06580009
065900             PERFORM 9800-ROLLBACK                                06590009
066000             PERFORM 9900-RETURN-TRAN                             06600009
066100     END-EVALUATE.                                                06610009
066200                                                                  06620009
066300                                                                  06630009
066400***************************************************************** 06640009
066500* VALIDATE SCAC CODE                                              06650009
066600***************************************************************** 06660009
066700 1300-VALIDATE-SCAC-CDE.                                          06670009
066800                                                                  06680009
066900     IF TR069-TRLR-SCAC-CDE = SPACES                              06690009
067000          MOVE PC-TSYMSG-02609           TO PV-TSYMSG-NUMBER      06700009
067100*         INVALID SCAC CODE                                       06710009
067200          MOVE '1300-VALIDATE-SCAC-CDE'  TO PV-PARA-NAME          06720009
067300          MOVE TR069-DC-NBR              TO PV-DISPLAY-DC         06730009
067400          STRING 'SCAC REQUIRED - IS SPACES'                      06740009
067500                  ' TLR ' TR069-TRAILER-ID                        06750009
067600                  ' SCAC ' TR069-TRLR-SCAC-CDE                    06760009
067700                  ' ' PV-DISPLAY-DC                               06770009
067800                  ' ' TR069-USER-ID                               06780009
067900                DELIMITED BY SIZE INTO  PV-ERROR-MSG              06790009
068000          PERFORM 9500-CSSL-LOG                                   06800009
068100          PERFORM 9800-ROLLBACK                                   06810009
068200          PERFORM 9900-RETURN-TRAN                                06820009
068300     END-IF.                                                      06830009
068400                                                                  06840009
AV0409     MOVE FUNCTION UPPER-CASE(TR069-TRLR-SCAC-CDE)                06850016
AV0409       TO PV-UPPER-SCAC-CDE.                                      06850116
068400                                                                  06850315
AV0409     MOVE PV-UPPER-SCAC-CDE   TO TR069-TRLR-SCAC-CDE.             06851016
068500     MOVE TR069-TRLR-SCAC-CDE TO PV-OWNER-SCAC-ID.                06852016
068600                                                                  06860009
068700     EXEC SQL                                                     06870009
068800         SELECT  SCAC_CDE                                         06880009
068900           INTO :EXTENT-SCAC-CDE                                  06890009
069000           FROM  TEXTENT                                          06900009
069100          WHERE  SCAC_CDE    = :PV-OWNER-SCAC-ID                  06910009
069200            AND  CARRIER_IND = 'Y'                                06920009
069300          WITH UR                                                 06930009
069400      END-EXEC.                                                   06940009
069500                                                                  06950009
069600      EVALUATE TRUE                                               06960009
069700          WHEN SQLCODE = +0                                       06970009
069800          WHEN SQLCODE = -811                                     06980009
069900              CONTINUE                                            06990009
070000          WHEN SQLCODE = +100                                     07000009
070100            MOVE PC-TSYMSG-02609            TO PV-TSYMSG-NUMBER   07010009
070200*           INVALID SCAC CODE                                     07020009
070300            MOVE SQLCODE                    TO PV-SQLCODE         07030009
070400            MOVE '1300-VALIDATE-SCAC-CDE'   TO PV-PARA-NAME       07040009
070500            MOVE TR069-DC-NBR               TO PV-DISPLAY-DC      07050009
070600            STRING 'SCAC NOT FOUND ON TEXTENT - SQL '             07060009
070700                    PV-SQLCODE                                    07070009
070800                    ' TLR ' TR069-TRAILER-ID                      07080009
070900                    ' SCAC ' TR069-TRLR-SCAC-CDE                  07090009
071000                    ' ' PV-DISPLAY-DC                             07100009
071100                    ' ' TR069-USER-ID                             07110009
071200               DELIMITED BY SIZE INTO  PV-ERROR-MSG               07120009
071300            PERFORM 9500-CSSL-LOG                                 07130009
071400            PERFORM 9800-ROLLBACK                                 07140009
071500            PERFORM 9900-RETURN-TRAN                              07150009
071600          WHEN OTHER                                              07160009
071700            MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER   07170009
071800*           A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK       07180009
071900            MOVE SQLCODE                    TO PV-SQLCODE         07190009
072000            MOVE '1300-VALIDATE-SCAC-CDE'   TO PV-PARA-NAME       07200009
072100            MOVE TR069-DC-NBR               TO PV-DISPLAY-DC      07210009
072200            STRING 'SCAC TEXTENT READ FAILED WITH SQL '           07220009
072300                    PV-SQLCODE                                    07230009
072400                    ' TLR ' TR069-TRAILER-ID                      07240009
072500                    ' SCAC ' TR069-TRLR-SCAC-CDE                  07250009
072600                    ' ' PV-DISPLAY-DC                             07260009
072700                    ' ' TR069-USER-ID                             07270009
072800               DELIMITED BY SIZE INTO  PV-ERROR-MSG               07280009
072900            PERFORM 9500-CSSL-LOG                                 07290009
073000            PERFORM 9800-ROLLBACK                                 07300009
073100            PERFORM 9900-RETURN-TRAN                              07310009
073200     END-EVALUATE.                                                07320009
073300                                                                  07330009
073400                                                                  07340009
073500***************************************************************   07350009
073600* VALIDATE USER ID - IF SPACES, SET IT TO 'KIOSK' DEFAULT.        07360009
073700***************************************************************   07370009
073800 1400-VALIDATE-USER-ID.                                           07380009
073900     IF TR069-USER-ID = SPACES                                    07390009
074000         MOVE 'KIOSK' TO TR069-USER-ID                            07400009
074100     END-IF.                                                      07410009
AV0409     MOVE FUNCTION UPPER-CASE(TR069-USER-ID)                      07411016
AV0409       TO PV-UPPER-USER-ID.                                       07412016
AV0409     MOVE PV-UPPER-USER-ID TO TR069-USER-ID.                      07413016
074300                                                                  07430009
074400***************************************************************** 07440009
074500* VALIDATE TRAILER ID                                             07450009
074600***************************************************************** 07460009
074700 1500-VALIDATE-TRAILER-ID.                                        07470009
074800                                                                  07480009
074900     IF TR069-TRAILER-ID  = SPACES                                07490009
075000          MOVE PC-TSYMSG-03389             TO PV-TSYMSG-NUMBER    07500009
075100*         TRAILER NUMBER IS REQUIRED WHEN ARRIVING                07510009
075200          MOVE '1500-VALIDATE-TRAILER-ID'  TO PV-PARA-NAME        07520009
075300          MOVE TR069-DC-NBR                TO PV-DISPLAY-DC       07530009
075400          STRING 'TRAILER ID REQUIRED - IS SPACES'                07540009
075500                  ' TLR ' TR069-TRAILER-ID                        07550009
075600                  ' SCAC ' TR069-TRLR-SCAC-CDE                    07560009
075700                  ' ' PV-DISPLAY-DC                               07570009
075800                  ' ' TR069-USER-ID                               07580009
075900                DELIMITED BY SIZE INTO  PV-ERROR-MSG              07590009
076000          PERFORM 9500-CSSL-LOG                                   07600009
076100          PERFORM 9800-ROLLBACK                                   07610009
076200          PERFORM 9900-RETURN-TRAN                                07620009
076300     END-IF.                                                      07630009
076400                                                                  07640009
AV0409     MOVE FUNCTION UPPER-CASE(TR069-TRAILER-ID)                   07641016
AV0409       TO PV-UPPER-TRAILER-ID                                     07642016
AV0409     MOVE PV-UPPER-TRAILER-ID TO TR069-TRAILER-ID.                07643016
076500     MOVE TR069-TRAILER-ID    TO PV-VEH-NBR.                      07650016
076600                                                                  07660009
076700     EXEC SQL                                                     07670009
076800       SELECT  A.OWNER_SCAC_ID                                    07680009
076900              ,A.VEH_NBR                                          07690009
077000              ,A.USAGE_CDE                                        07700009
077100              ,A.VEH_SIZE_CDE                                     07710009
077200              ,A.CURR_STATUS_CDE                                  07720009
077300              ,A.CURR_STATUS_DTE                                  07730009
077400              ,A.CURR_STATUS_TME                                  07740009
077500              ,A.CURR_OPER_UNT_ID                                 07750009
077600              ,A.CURR_FCLTY_ID                                    07760009
077700              ,A.CURR_FAC_AREA_ID                                 07770009
077800              ,A.CURR_TRIP_ID                                     07780009
077900              ,A.VEH_TYP_CDE                                      07790009
078000              ,B.DESC                                             07800009
078100              ,B.PRTY_CDE                                         07810009
078200        INTO  :VEHICL-OWNER-SCAC-ID                               07820009
078300             ,:VEHICL-VEH-NBR                                     07830009
078400             ,:VEHICL-USAGE-CDE                                   07840009
078500             ,:VEHICL-VEH-SIZE-CDE                                07850009
078600             ,:VEHICL-CURR-STATUS-CDE                             07860009
078700             ,:VEHICL-CURR-STATUS-DTE                             07870009
078800             ,:VEHICL-CURR-STATUS-TME                             07880009
078900             ,:VEHICL-CURR-OPER-UNT-ID                            07890009
079000             ,:VEHICL-CURR-FCLTY-ID                               07900009
079100             ,:VEHICL-CURR-FAC-AREA-ID                            07910009
079200             ,:VEHICL-CURR-TRIP-ID  :DN-CURR-TRIP-ID              07920009
079300             ,:VEHICL-VEH-TYP-CDE                                 07930009
079400             ,:TRSTYP-DESC                                        07940009
079500             ,:TRSTYP-PRTY-CDE                                    07950009
079600        FROM   TVEHICL A                                          07960009
079700             , TTRSTYP B                                          07970009
079800        WHERE  A.VEH_NBR       = :PV-VEH-NBR                      07980009
079900          AND  A.OWNER_SCAC_ID = :PV-OWNER-SCAC-ID                07990009
080000          AND  A.CURR_STATUS_CDE = B.TRIP_STATUS_CDE              08000009
080100     END-EXEC.                                                    08010009
080200                                                                  08020009
080300     EVALUATE TRUE                                                08030009
080400        WHEN SQLCODE = +0                                         08040009
080500           IF (VEHICL-CURR-STATUS-CDE NOT = 'EN' AND              08050009
080600              VEHICL-CURR-STATUS-CDE NOT = 'ET' )                 08060009
080700               MOVE PC-TSYMSG-02816         TO PV-TSYMSG-NUMBER   08070009
080800***            INVALID TRAILER STATUS FOR UPDATE FUNCTION         08080009
080900               MOVE '1500-VALIDATE-TRAILER-ID' TO PV-PARA-NAME    08090009
081000               MOVE TR069-DC-NBR               TO PV-DISPLAY-DC   08100009
081100               STRING 'STATUS NOT ENROUTE - IS '                  08110009
081200                      VEHICL-CURR-STATUS-CDE                      08120009
081300                    ' TLR ' TR069-TRAILER-ID                      08130009
081400                    ' SCAC ' TR069-TRLR-SCAC-CDE                  08140009
081500                    ' ' PV-DISPLAY-DC                             08150009
081600                    ' ' TR069-USER-ID                             08160009
081700                   DELIMITED BY SIZE INTO  PV-ERROR-MSG           08170009
081800               PERFORM 9500-CSSL-LOG                              08180009
081900               PERFORM 9800-ROLLBACK                              08190009
082000               PERFORM 9900-RETURN-TRAN                           08200009
082100           END-IF                                                 08210009
082110*                                                                 08211009
082120*** add check for trlr in EN status - make sure that the          08212009
082130*** vehicl Curr Oper matches the DC that is trying to             08213009
082131*** arrive the trip (DMH 8/20/2020)                               08213109
082132*                                                                 08213209
082133           IF  VEHICL-CURR-STATUS-CDE = 'EN'    AND               08213309
082134               VEHICL-CURR-OPER-UNT-ID not = 0  AND               08213409
082135               TR069-DC-NBR       NOT = VEHICL-CURR-OPER-UNT-ID   08213509
082137               MOVE PC-TSYMSG-02999         TO PV-TSYMSG-NUMBER   08213709
082138***            WRONG OPERATING UNIT/FACILITY FOR THIS TRIP ID     08213809
082139               MOVE '1500-VALIDATE-TRAILER-ID' TO PV-PARA-NAME    08213909
082140               MOVE TR069-DC-NBR               TO PV-DISPLAY-DC   08214009
082141               MOVE VEHICL-CURR-OPER-UNT-ID    TO PV-DISPLAY-OPER 08214109
082142               STRING 'TRIP IS FOR DIFFERENT DC:'                 08214212
082143                    ' SCAC:'   TR069-TRLR-SCAC-CDE                08214312
082144                    ' TLR:'    TR069-TRAILER-ID                   08214412
082145                    ' AT DC:'  PV-DISPLAY-DC                      08214512
082146                    ' ' TR069-USER-ID                             08214609
082147                    ' FOR:'    PV-DISPLAY-OPER                    08214712
082148                   DELIMITED BY SIZE INTO  PV-ERROR-MSG           08214809
082149               PERFORM 9500-CSSL-LOG                              08214909
082150               PERFORM 9800-ROLLBACK                              08215009
082151               PERFORM 9900-RETURN-TRAN                           08215109
082152           END-IF                                                 08215209
082154*                                                                 08215409
082155*** add check for trlr in EN status & curr oper = 0 &             08215509
082156*** vehicl vehicl # is not spaces, then error this trailer        08215613
082157*** coc will have to fix this.  EDI 214 are coming in             08215713
082158*** without the oper (DMH 8/20/2020)                              08215809
082159*                                                                 08215909
082160           IF  VEHICL-CURR-STATUS-CDE  = 'EN'    AND              08216009
082161               VEHICL-CURR-OPER-UNT-ID = 0       AND              08216109
082162               VEHICL-VEH-NBR          > SPACES                   08216209
082192               MOVE TR069-DC-NBR               TO PV-DISPLAY-DC   08219209
082193               MOVE VEHICL-CURR-OPER-UNT-ID    TO PV-DISPLAY-OPER 08219309
082194               MOVE PC-TSYMSG-02999         TO PV-TSYMSG-NUMBER   08219413
082196               MOVE '1500-VALIDATE-TRAILER-ID' TO PV-PARA-NAME    08219613
082197               STRING 'TRIP OPER 0 IS BEING IGNORED:'             08219713
082198                    ' SCAC:'   TR069-TRLR-SCAC-CDE                08219812
082199                    ' TLR:'    TR069-TRAILER-ID                   08219912
082200                    ' AT DC:'  PV-DISPLAY-DC                      08220012
082201                    ' ' TR069-USER-ID                             08220109
082202                    ' FOR DC:'  PV-DISPLAY-OPER                   08220212
082203                   DELIMITED BY SIZE INTO  PV-ERROR-MSG           08220309
082204               PERFORM 9500-CSSL-LOG                              08220409
082205               PERFORM 9800-ROLLBACK                              08220513
082206               PERFORM 9900-RETURN-TRAN                           08220613
082207           END-IF                                                 08220709
082208*                                                                 08220809
082210           IF VEHICL-CURR-STATUS-CDE = 'ET'                       08221009
082300              SET PS-END-TRIP-FOUND-YES TO TRUE                   08230009
082400           END-IF                                                 08240009
082500           IF DN-CURR-TRIP-ID = -1                                08250009
082600              SET PV-VEHICLE-NULL-TRIP TO TRUE                    08260009
082700           ELSE                                                   08270009
082800              SET PV-VEHICLE-SETUP-PREV TO TRUE                   08280009
082900           END-IF                                                 08290009
083000           MOVE VEHICL-CURR-TRIP-ID TO PV-TRIP-ID                 08300009
083100           MOVE VEHICL-CURR-STATUS-CDE                            08310009
083200                          TO PV-TRIP-STATUS-CDE                   08320009
083300           MOVE VEHICL-OWNER-SCAC-ID TO PV-OWNER-SCAC-ID          08330009
083400           MOVE VEHICL-VEH-NBR       TO PV-VEH-NBR                08340009
083500           MOVE VEHICL-USAGE-CDE     TO PV-USAGE-CDE              08350009
083600           MOVE VEHICL-VEH-SIZE-CDE  TO PV-VEH-SIZE-CDE           08360009
083700           MOVE VEHICL-CURR-STATUS-DTE  TO PV-CURR-STAT-DTE       08370009
083800           MOVE VEHICL-CURR-STATUS-TME  TO PV-CURR-STAT-TME       08380009
083900           MOVE VEHICL-CURR-OPER-UNT-ID TO PV-CURR-OPER-UNT-ID    08390009
084000           MOVE VEHICL-CURR-FCLTY-ID    TO PV-CURR-FCLTY-ID       08400009
084100           MOVE VEHICL-CURR-FAC-AREA-ID TO PV-CURR-FAC-AREA-ID    08410009
084200           MOVE VEHICL-VEH-TYP-CDE      TO PV-VEH-TYP-CDE         08420009
084300                                                                  08430009
084400        WHEN SQLCODE = +100                                       08440009
084500          SET PV-VEHICLE-NOT-SETUP-PREV   TO TRUE                 08450009
084600******************************************************            08460009
084700          PERFORM 5000-ADD-VEHICLE                                08470009
084800******************************************************            08480009
084900*         MOVE PC-TSYMSG-01550            TO PV-TSYMSG-NUMBER     08490009
085000**        NO DATA EXISTS FOR THE REQUESTED SCAC/TRAILER NUMBER    08500009
085100*         MOVE SQLCODE                    TO PV-SQLCODE           08510009
085200*         MOVE '1500-VALIDATE-TRAILER-ID' TO PV-PARA-NAME         08520009
085300*         MOVE TR069-DC-NBR               TO PV-DISPLAY-DC        08530009
085400*         STRING 'SQL ' PV-SQLCODE ' NOT FOUND '                  08540009
085500*                ' TVEHICL, TTRSTYP'                              08550009
085600*                ' TLR ' TR069-TRAILER-ID                         08560009
085700*                ' SCAC ' TR069-TRLR-SCAC-CDE                     08570009
085800*                ' ' PV-DISPLAY-DC                                08580009
085900*                ' ' TR069-USER-ID                                08590009
086000*              DELIMITED BY SIZE INTO  PV-ERROR-MSG               08600009
086100*         PERFORM 9500-CSSL-LOG                                   08610009
086200*         PERFORM 9800-ROLLBACK                                   08620009
086300*         PERFORM 9900-RETURN-TRAN                                08630009
086400                                                                  08640009
086500        WHEN OTHER                                                08650009
086600          MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER     08660009
086700*         A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK         08670009
086800          MOVE SQLCODE                    TO PV-SQLCODE           08680009
086900          MOVE '1500-VALIDATE-TRAILER-ID' TO PV-PARA-NAME         08690009
087000          MOVE TR069-DC-NBR               TO PV-DISPLAY-DC        08700009
087100          STRING 'SQL ' PV-SQLCODE ' FOR'                         08710009
087200                 ' TVEHICL, TTRSTYP'                              08720009
087300                 ' TLR ' TR069-TRAILER-ID                         08730009
087400                 ' SCAC ' TR069-TRLR-SCAC-CDE                     08740009
087500                 ' ' PV-DISPLAY-DC                                08750009
087600                 ' ' TR069-USER-ID                                08760009
087700               DELIMITED BY SIZE INTO  PV-ERROR-MSG               08770009
087800            PERFORM 9500-CSSL-LOG                                 08780009
087900            PERFORM 9800-ROLLBACK                                 08790009
088000            PERFORM 9900-RETURN-TRAN                              08800009
088100     END-EVALUATE.                                                08810009
088200                                                                  08820009
088300 1600-VALIDATE-MANIFEST-NBR.                                      08830009
088400                                                                  08840009
088500     SET PS-UPDATE-MANIFEST-NO TO TRUE                            08850009
088600     INITIALIZE VHTRIP-MANIFEST-NBR                               08860009
088700                                                                  08870009
088800     EXEC SQL                                                     08880009
088900       SELECT  A.MANIFEST_NBR                                     08890009
089000        INTO  :VHTRIP-MANIFEST-NBR                                08900009
089100        FROM   TVHTRIP A                                          08910009
089200        WHERE  A.VEH_NBR       = :PV-VEH-NBR                      08920009
089300          AND  A.OWNER_SCAC_ID = :PV-OWNER-SCAC-ID                08930009
089400          AND  A.TRIP_ID       = :VEHICL-CURR-TRIP-ID             08940009
089500     END-EXEC.                                                    08950009
089600                                                                  08960009
089700     EVALUATE TRUE                                                08970009
089800        WHEN SQLCODE = +0                                         08980009
089900             IF VHTRIP-MANIFEST-NBR = SPACES                      08990009
090000                SET PS-UPDATE-MANIFEST-YES TO TRUE                09000009
090100             END-IF                                               09010009
090200        WHEN SQLCODE = +100                                       09020009
090300             CONTINUE                                             09030009
090400        WHEN OTHER                                                09040009
090500          MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER     09050009
090600*         A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK         09060009
090700          MOVE SQLCODE                    TO PV-SQLCODE           09070009
090800          MOVE '1600-VALIDATE-MANIFEST'   TO PV-PARA-NAME         09080009
090900          MOVE TR069-DC-NBR               TO PV-DISPLAY-DC        09090009
091000          STRING 'SQL ' PV-SQLCODE ' FOR'                         09100009
091100                 ' TVHTRIP '                                      09110009
091200                 ' TLR ' TR069-TRAILER-ID                         09120009
091300                 ' SCAC ' TR069-TRLR-SCAC-CDE                     09130009
091400                 ' ' PV-DISPLAY-DC                                09140009
091500                 ' ' TR069-USER-ID                                09150009
091600               DELIMITED BY SIZE INTO  PV-ERROR-MSG               09160009
091700            PERFORM 9500-CSSL-LOG                                 09170009
091800            PERFORM 9800-ROLLBACK                                 09180009
091900            PERFORM 9900-RETURN-TRAN                              09190009
092000     END-EVALUATE.                                                09200009
092100                                                                  09210009
092200******************************************************************09220009
092300* CHECK PARM TABLE TO SEE IF DC IS TURNED ON TO DOWNLOAD ASN'S   *09230009
092400* TO WMS.                                                        *09240009
092500******************************************************************09250009
092600 2100-SELECT-TKRPRPM-DC.                                          09260009
092700                                                                  09270009
092800     MOVE TR069-DC-NBR TO PV-DC-NBR.                              09280009
092900                                                                  09290009
093000     EXEC SQL                                                     09300009
093100       SELECT  FUNC_TXT                                           09310009
093200         INTO :KRPRPM-FUNC-TXT                                    09320009
093300         FROM  TKRPRPM A                                          09330009
093400              ,TTRIPST B                                          09340009
093500        WHERE A.LOC_ID            = :PV-DC-NBR                    09350009
093600          AND A.SYS_PRC_FUNC_CDE  = 'ASNDWN'                      09360009
093700          AND A.FUNC_PRC_STAT_CDE = 'AC'                          09370009
093800          AND A.INTFC_SYS_CDE     = 'KHL'                         09380009
093900          AND A.FUNC_TXT          = 'Y'                           09390009
094000          AND A.FUNC_BEG_TMST     < CURRENT TIMESTAMP             09400009
094100          AND B.TRIP_ID           = :PV-TRIP-ID                   09410009
094200          AND B.TRIP_STATUS_CDE   = 'EN'                          09420009
094300          AND B.CRE_TMST         >= A.FUNC_BEG_TMST               09430009
094400     END-EXEC.                                                    09440009
094500                                                                  09450009
094600     EVALUATE TRUE                                                09460009
094700         WHEN SQLCODE = +0                                        09470009
094800            SET PS-ASNS-TO-WMS-YES    TO TRUE                     09480009
094900         WHEN SQLCODE = +100                                      09490009
095000            SET PS-ASNS-TO-WMS-NO     TO TRUE                     09500009
095100         WHEN OTHER                                               09510009
095200            MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER   09520009
095300*           A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK       09530009
095400            MOVE SQLCODE                    TO PV-SQLCODE         09540009
095500            MOVE '2100-SELECT-TKRPRPM-DC'   TO PV-PARA-NAME       09550009
095600                MOVE TR069-DC-NBR           TO PV-DISPLAY-DC      09560009
095700                STRING ' TKRPRPM / TTRIPST READ FAILED WITH '     09570009
095800                        PV-SQLCODE                                09580009
095900                      ' TLR ' TR069-TRAILER-ID                    09590009
096000                      ' SCAC ' TR069-TRLR-SCAC-CDE                09600009
096100                      ' DC ' PV-DISPLAY-DC                        09610009
096200                      ' ' TR069-USER-ID                           09620009
096300                    DELIMITED BY SIZE INTO  PV-ERROR-MSG          09630009
096400            PERFORM 9500-CSSL-LOG                                 09640009
096500            PERFORM 9800-ROLLBACK                                 09650009
096600            PERFORM 9900-RETURN-TRAN                              09660009
096700     END-EVALUATE.                                                09670009
096800                                                                  09680009
096900                                                                  09690009
097000******************************************************************09700009
097100*  CHECK IF ALL OF THE RECEIVERS FOR A TRIP ARE AP RECEIVERS.     09710009
097200*  THIS IS DONE BY CHECKING TO SEE IF THERE ARE OTHER TYPES OF    09720009
097300*  RECEIVERS ON THIS TRIP.  IF THE COUNT FROM THIS SQL IS GREATER 09730009
097400*  THAN ZERO, THE RECEIVERS FOR THIS TRIP ARE NOT ALL TYPE AP     09740009
097500*  RECEIVERS.                                                     09750009
097600******************************************************************09760009
097700 2200-CHECK-AP-ON-TRECEIV.                                        09770009
097800                                                                  09780009
097900     INITIALIZE PV-DB2-COUNT-NON-AP-RCVRS.                        09790009
098000                                                                  09800009
098100     EXEC SQL                                                     09810009
098200         SELECT COUNT(*)                                          09820009
098300            INTO :PV-DB2-COUNT-NON-AP-RCVRS                       09830009
098400         FROM  TSHIPMT A                                          09840009
098500             , TSHPTPO B                                          09850009
098600             , TRECEIV C                                          09860009
098700         WHERE  A.TRIP_ID        = :PV-TRIP-ID                    09870009
098800           AND  A.TRIP_ID IS NOT NULL                             09880009
098900           AND  A.SHIPT_ID       = B.SHIPT_ID                     09890009
099000           AND  B.REC_SEQ_NBR    > :PC-ZERO                       09900009
099100           AND  B.REC_SEQ_NBR    = C.REC_SEQ_NBR                  09910009
099200           AND  B.PO_NBR         = C.ORD_NBR                      09920009
099300           AND  C.REC_TYP_CDE   <> 'AP'                           09930009
099400           AND  C.VER_STATUS_CDE = 'A'                            09940009
099500     END-EXEC.                                                    09950009
099600                                                                  09960009
099700     EVALUATE TRUE                                                09970009
099800        WHEN SQLCODE = +0                                         09980009
099900        WHEN SQLCODE = +100                                       09990009
100000            CONTINUE                                              10000009
100100        WHEN OTHER                                                10010009
100200            MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER   10020009
100300*           A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK       10030009
100400            MOVE SQLCODE                    TO PV-SQLCODE         10040009
100500            MOVE '2200-CHECK-AP-ON-TRECEIV' TO PV-PARA-NAME       10050009
100600            MOVE TR069-DC-NBR           TO PV-DISPLAY-DC          10060009
100700            MOVE PV-TRIP-ID             TO PV-TRIP-ID-DIS         10070009
100800            STRING ' TSHIPMT READ FAILED WITH '                   10080009
100900                        PV-SQLCODE                                10090009
101000                      ' TLR ' TR069-TRAILER-ID                    10100009
101100                      ' SCAC ' TR069-TRLR-SCAC-CDE                10110009
101200                      ' TRIP ' PV-TRIP-ID-DIS                     10120009
101300                      ' ' PV-DISPLAY-DC                           10130009
101400                      ' ' TR069-USER-ID                           10140009
101500                    DELIMITED BY SIZE INTO  PV-ERROR-MSG          10150009
101600            PERFORM 9500-CSSL-LOG                                 10160009
101700            PERFORM 9800-ROLLBACK                                 10170009
101800            PERFORM 9900-RETURN-TRAN                              10180009
101900      END-EVALUATE.                                               10190009
102000                                                                  10200009
102100*----------------------------------------------------------------*10210009
102200*  SELECT CURRENT TRIP STATUS ROW                                *10220009
102300*  UPDATE TRIP STATUS TO 'AR'                                    *10230009
102400*----------------------------------------------------------------*10240009
102500 2300-UPDATE-TRIP-STATUS.                                         10250009
102600                                                                  10260009
102700     PERFORM 2400-SELECT-TTRIPST.                                 10270009
102800     MOVE 'AR'                  TO PV-TRIP-STATUS-CDE.            10280009
102900     MOVE TRIPST-STATUS-DTE     TO PV-STATUS-DTE                  10290009
103000                                   PV-DB2-HOST-DATE.              10300009
103100     MOVE TRIPST-STATUS-TME     TO PV-STATUS-TME                  10310009
103200                                   PV-DB2-HOST-TIME.              10320009
103300                                                                  10330009
103400     PERFORM 2500-INSERT-TTRIPST.                                 10340009
103500                                                                  10350009
103600                                                                  10360009
103700******************************************************************10370009
103800*  SELECT CURRENT TRIP STATUS ROW      6150-                     *10380009
103900******************************************************************10390009
104000 2400-SELECT-TTRIPST.                                             10400009
104100     EXEC SQL                                                     10410009
104200        SELECT  A.TRIP_ID                                         10420009
104300               ,A.TRIP_STATUS_CDE                                 10430009
104400               ,A.STATUS_DTE                                      10440009
104500               ,A.STATUS_TME                                      10450009
104600               ,A.STATUS_UID                                      10460009
104700               ,A.OPER_UNT_ID                                     10470009
104800               ,A.FCLTY_ID                                        10480009
104900               ,A.FCLTY_AREA_ID                                   10490009
105000         INTO                                                     10500009
105100                :TRIPST-TRIP-ID                                   10510009
105200               ,:TRIPST-TRIP-STATUS-CDE                           10520009
105300               ,:TRIPST-STATUS-DTE                                10530009
105400               ,:TRIPST-STATUS-TME                                10540009
105500               ,:TRIPST-STATUS-UID                                10550009
105600               ,:TRIPST-OPER-UNT-ID                               10560009
105700               ,:TRIPST-FCLTY-ID                                  10570009
105800               ,:TRIPST-FCLTY-AREA-ID                             10580009
105900         FROM   TTRIPST A                                         10590009
106000               ,TTRSTYP B                                         10600009
106100         WHERE  A.TRIP_ID          = :PV-TRIP-ID                  10610009
106200           AND  A.TRIP_STATUS_CDE ^= 'DE'                         10620009
106300           AND  B.PRTY_CDE =                                      10630009
106400                (SELECT MAX(D.PRTY_CDE)                           10640009
106500                   FROM TTRIPST C                                 10650009
106600                       ,TTRSTYP D                                 10660009
106700                 WHERE C.TRIP_ID         = A.TRIP_ID              10670009
106800                   AND C.TRIP_STATUS_CDE = D.TRIP_STATUS_CDE)     10680009
106900                   AND A.TRIP_STATUS_CDE = B.TRIP_STATUS_CDE      10690009
107000     END-EXEC.                                                    10700009
107100                                                                  10710009
107200     EVALUATE TRUE                                                10720009
107300         WHEN SQLCODE = +0                                        10730009
107400            MOVE TRIPST-FCLTY-ID       TO PV-FCLTY-ID             10740009
107500            MOVE TRIPST-FCLTY-AREA-ID  TO PV-FCLTY-AREA           10750009
107600            MOVE TRIPST-STATUS-DTE     TO PV-STATUS-DTE           10760009
107700            MOVE TRIPST-STATUS-TME     TO PV-STATUS-TME           10770009
107800                                                                  10780009
107900         WHEN OTHER                                               10790009
108000            MOVE PV-TRIP-ID TO PV-TRIP-ID-DIS                     10800009
108100            MOVE PC-TSYMSG-01570       TO PV-TSYMSG-NUMBER        10810009
108200*           A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK       10820009
108300            MOVE SQLCODE               TO PV-SQLCODE              10830009
108400            MOVE '2400-SELECT-TTRIPST' TO PV-PARA-NAME            10840009
108500            MOVE TR069-DC-NBR           TO PV-DISPLAY-DC          10850009
108600            STRING ' TTRIPST READ FAILED WITH '                   10860009
108700                     PV-SQLCODE                                   10870009
108800                   ' TLR ' TR069-TRAILER-ID                       10880009
108900                   ' SCAC ' TR069-TRLR-SCAC-CDE                   10890009
109000                   ' TRIP ' PV-TRIP-ID-DIS                        10900009
109100                   ' ' PV-DISPLAY-DC                              10910009
109200                   ' ' TR069-USER-ID                              10920009
109300                    DELIMITED BY SIZE INTO  PV-ERROR-MSG          10930009
109400            PERFORM 9500-CSSL-LOG                                 10940009
109500            PERFORM 9800-ROLLBACK                                 10950009
109600            PERFORM 9900-RETURN-TRAN                              10960009
109700      END-EVALUATE.                                               10970009
109800                                                                  10980009
109900*----------------------------------------------------------------*10990009
110000*  INSERT A ROW ON THE VEHICLE TRIP STATUS TABLE                 *11000009
110100*----------------------------------------------------------------*11010009
110200 2500-INSERT-TTRIPST.                                             11020009
110300                                                                  11030009
110400     EXEC SQL                                                     11040009
110500         SET :PV-DB2-HOST-DATE      = CURRENT DATE                11050009
110600     END-EXEC.                                                    11060009
110700                                                                  11070009
110800     EXEC SQL                                                     11080009
110900         SET :PV-DB2-HOST-TIME      = CURRENT TIME                11090009
111000     END-EXEC.                                                    11100009
111100                                                                  11110009
111200*    IF THE CURRENT TIME IS LESS THAN OR EQUAL TO THE TIME OF THE 11120009
111300*    PREVIOUSLY INSERTED ROW (MEANING TWO OR MORE RECORDS HAVE BEE11130009
111400*    ADDED IN ON SECOND) ADD A SECOND TO THE PREVIOUS TIME TO KEEP11140009
111500*    TIMES UNIQUE.                                                11150009
111600                                                                  11160009
111700     MOVE TRIPST-STATUS-TME TO PV-CMPR-STATUS-TME.                11170009
111800     MOVE TRIPST-STATUS-DTE TO PV-CMPR-STATUS-DTE.                11180009
111900                                                                  11190009
112000     IF PV-DB2-HOST-DATE   = PV-CMPR-STATUS-DTE                   11200009
112100         IF  PV-DB2-HOST-TIME          <= PV-CMPR-STATUS-TME      11210009
112200            ADD +1                     TO PV-CMPR-STATUS-TME-SS   11220009
112300            IF PV-CMPR-STATUS-TME-SS    > 59                      11230009
112400               ADD +1                  TO PV-CMPR-STATUS-TME-MM   11240009
112500               MOVE ZEROS              TO PV-CMPR-STATUS-TME-SS   11250009
112600               IF PV-CMPR-STATUS-TME-MM > 59                      11260009
112700                  ADD +1               TO PV-CMPR-STATUS-TME-HH   11270009
112800                  MOVE ZEROS           TO PV-CMPR-STATUS-TME-MM   11280009
112900                  IF PV-CMPR-STATUS-TME-HH                        11290009
113000                                        > 23                      11300009
113100                     MOVE ZEROS        TO PV-CMPR-STATUS-TME-HH   11310009
113200                  END-IF                                          11320009
113300               END-IF                                             11330009
113400            END-IF                                                11340009
113500            MOVE PV-CMPR-STATUS-TME    TO PV-DB2-HOST-TIME        11350009
113600         ELSE                                                     11360009
113700            MOVE PV-DB2-HOST-TIME      TO PV-CMPR-STATUS-TME      11370009
113800         END-IF                                                   11380009
113900     END-IF.                                                      11390009
114000                                                                  11400009
114100     MOVE 'AR'                  TO PV-TRIP-STATUS-CDE.            11410009
114200     MOVE TR069-DC-NBR          TO TRIPST-OPER-UNT-ID.            11420009
114300                                                                  11430009
114400     EXEC SQL                                                     11440009
114500         INSERT  INTO TTRIPST                                     11450009
114600                (TRIP_ID                                          11460009
114700                ,TRIP_STATUS_CDE                                  11470009
114800                ,STATUS_DTE                                       11480009
114900                ,STATUS_TME                                       11490009
115000                ,STATUS_UID                                       11500009
115100                ,OPER_UNT_ID                                      11510009
115200                ,FCLTY_ID                                         11520009
115300                ,FCLTY_AREA_ID)                                   11530009
115400        VALUES  (:TRIPST-TRIP-ID                                  11540009
115500                ,:PV-TRIP-STATUS-CDE                              11550009
115600                ,:PV-DB2-HOST-DATE                                11560009
115700                ,:PV-DB2-HOST-TIME                                11570009
115800                ,:TR069-USER-ID                                   11580009
115900                ,:TRIPST-OPER-UNT-ID                              11590009
116000                ,:TRIPST-FCLTY-ID                                 11600009
116100                ,:TRIPST-FCLTY-AREA-ID)                           11610009
116200      END-EXEC.                                                   11620009
116300                                                                  11630009
116400      EVALUATE TRUE                                               11640009
116500          WHEN SQLCODE = +0                                       11650009
116600              MOVE PV-DB2-HOST-DATE                               11660009
116700                                  TO PV-TRIPST-DTE                11670009
116800              MOVE PV-TRIPST-YY   TO PV-TRIP-YY                   11680009
116900              MOVE PV-TRIPST-MM   TO PV-TRIP-MM                   11690009
117000              MOVE PV-TRIPST-DD   TO PV-TRIP-DD                   11700009
117100              MOVE PV-DB2-HOST-TIME                               11710009
117200                                  TO PV-TRIPST-TME                11720009
117300              MOVE PV-TRIPST-HH   TO PV-TRIP-HH                   11730009
117400              MOVE PV-TRIPST-MIN  TO PV-TRIP-MIN                  11740009
117500                                                                  11750009
117600          WHEN OTHER                                              11760009
117700            MOVE PC-TSYMSG-01570       TO PV-TSYMSG-NUMBER        11770009
117800*           A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK       11780009
117900            MOVE SQLCODE               TO PV-SQLCODE              11790009
118000            MOVE '2500-INSERT-TTRIPST' TO PV-PARA-NAME            11800009
118100            MOVE TR069-DC-NBR           TO PV-DISPLAY-DC          11810009
118200            MOVE TRIPST-TRIP-ID         TO PV-TRIP-ID-DIS         11820009
118300            STRING ' TTRIPST INSERT FAILED WITH '                 11830009
118400                     PV-SQLCODE                                   11840009
118500                   ' TLR ' TR069-TRAILER-ID                       11850009
118600                   ' SCAC ' TR069-TRLR-SCAC-CDE                   11860009
118700                   ' TRIP ' PV-TRIP-ID-DIS                        11870009
118800                   ' ' PV-DISPLAY-DC                              11880009
118900                   ' ' TR069-USER-ID                              11890009
119000                    DELIMITED BY SIZE INTO  PV-ERROR-MSG          11900009
119100            PERFORM 9500-CSSL-LOG                                 11910009
119200            PERFORM 9800-ROLLBACK                                 11920009
119300            PERFORM 9900-RETURN-TRAN                              11930009
119400     END-EVALUATE.                                                11940009
119500                                                                  11950009
119600                                                                  11960009
119700*----------------------------------------------------------------*11970009
119800*  UPDATE RECEIVED TIMESTAMP ON RECEIVERS.                        11980009
119900*----------------------------------------------------------------*11990009
120000 2600-UPDATE-RECEIVERS.                                           12000009
120100     STRING PV-DB2-HOST-DATE  DELIMITED BY SIZE,                  12010009
120200            '-' DELIMITED BY SIZE,                                12020009
120300            PV-DB2-HOST-TIME  DELIMITED BY SIZE,                  12030009
120400            '.000000' DELIMITED BY SIZE                           12040009
120500            INTO                PV-REC-TMST                       12050009
120600     END-STRING.                                                  12060009
120700     MOVE 'N'               TO PS-NO-MORE-RECEIVRS-SW.            12070009
120800     SET PS-NO-TRBL-CREATED-ONSITE                                12080009
120900         PS-NO-TRBL-ACCESS-TRBL    TO TRUE.                       12090009
121000     MOVE ZEROS TO PV-TRBL-RSLV-CT                                12100009
121100                   PV-TRBL-MSG-NO.                                12110009
121200     PERFORM 2610-OPEN-RECEIVR-CSR.                               12120009
121300     PERFORM 2620-FETCH-RECEIVR-CSR.                              12130009
121400     PERFORM UNTIL PS-NO-MORE-RECEIVRS                            12140009
121500         PERFORM 2640-UPDATE-RECEIV                               12150009
121600         PERFORM 2650-CHK4-STORAGE-TRBL                           12160009
121700         PERFORM 2620-FETCH-RECEIVR-CSR                           12170009
121800     END-PERFORM.                                                 12180009
121900     PERFORM 2630-CLOSE-RECEIVR-CSR.                              12190009
122000                                                                  12200009
122100****************************************************************  12210009
122200* OPEN RECEIVR-CSR                                                12220009
122300****************************************************************  12230009
122400 2610-OPEN-RECEIVR-CSR.                                           12240009
122500                                                                  12250009
122600     EXEC SQL                                                     12260009
122700          OPEN RECEIVR-CSR                                        12270009
122800     END-EXEC                                                     12280009
122900                                                                  12290009
123000     EVALUATE TRUE                                                12300009
123100         WHEN SQLCODE = +0                                        12310009
123200              CONTINUE                                            12320009
123300         WHEN OTHER                                               12330009
123400             MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER  12340009
123500*            A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK      12350009
123600             MOVE SQLCODE                    TO PV-SQLCODE        12360009
123700             MOVE '2610-OPEN-RECEIVR-CSR'    TO PV-PARA-NAME      12370009
123800             MOVE TR069-DC-NBR           TO PV-DISPLAY-DC         12380009
123900             STRING ' OPEN RECEIVER CURSOR FAILED WITH '          12390009
124000                     PV-SQLCODE                                   12400009
124100                   ' TLR ' TR069-TRAILER-ID                       12410009
124200                   ' SCAC ' TR069-TRLR-SCAC-CDE                   12420009
124300                   ' DC ' PV-DISPLAY-DC                           12430009
124400                   ' ' TR069-USER-ID                              12440009
124500                    DELIMITED BY SIZE INTO  PV-ERROR-MSG          12450009
124600             PERFORM 9500-CSSL-LOG                                12460009
124700             PERFORM 9800-ROLLBACK                                12470009
124800             PERFORM 9900-RETURN-TRAN                             12480009
124900     END-EVALUATE.                                                12490009
125000                                                                  12500009
125100******************************************************************12510009
125200*    FETCH A RECEIVR ROW                                          12520009
125300******************************************************************12530009
125400                                                                  12540009
125500 2620-FETCH-RECEIVR-CSR.                                          12550009
125600                                                                  12560009
125700     EXEC SQL                                                     12570009
125800          FETCH RECEIVR-CSR                                       12580009
125900          INTO :RECEIV-ORD-NBR                                    12590009
126000             , :RECEIV-REC-SEQ-NBR                                12600009
126100             , :RECEIV-STATUS-CDE                                 12610009
126200             , :RECEIV-CRE-TMST                                   12620009
126300     END-EXEC.                                                    12630009
126400                                                                  12640009
126500     EVALUATE TRUE                                                12650009
126600         WHEN SQLCODE = +0                                        12660009
126700              CONTINUE                                            12670009
126800                                                                  12680009
126900         WHEN SQLCODE = +100                                      12690009
127000              SET PS-NO-MORE-RECEIVRS TO TRUE                     12700009
127100                                                                  12710009
127200         WHEN OTHER                                               12720009
127300             MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER  12730009
127400*            A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK      12740009
127500             MOVE SQLCODE                    TO PV-SQLCODE        12750009
127600             MOVE '2620-FETCH-RECEIVR-CSR'   TO PV-PARA-NAME      12760009
127700             MOVE TR069-DC-NBR           TO PV-DISPLAY-DC         12770009
127800             STRING ' FETCH RECEIVER CURSOR FAILED WITH '         12780009
127900                     PV-SQLCODE                                   12790009
128000                   ' TLR ' TR069-TRAILER-ID                       12800009
128100                   ' SCAC ' TR069-TRLR-SCAC-CDE                   12810009
128200                   ' DC ' PV-DISPLAY-DC                           12820009
128300                   ' ' TR069-USER-ID                              12830009
128400                    DELIMITED BY SIZE INTO  PV-ERROR-MSG          12840009
128500             PERFORM 9500-CSSL-LOG                                12850009
128600             PERFORM 9800-ROLLBACK                                12860009
128700             PERFORM 9900-RETURN-TRAN                             12870009
128800     END-EVALUATE.                                                12880009
128900                                                                  12890009
129000******************************************************************12900009
129100* CLOSE THE RECEIVR CURSOR                                       *12910009
129200******************************************************************12920009
129300 2630-CLOSE-RECEIVR-CSR.                                          12930009
129400                                                                  12940009
129500     EXEC SQL                                                     12950009
129600          CLOSE RECEIVR-CSR                                       12960009
129700     END-EXEC                                                     12970009
129800                                                                  12980009
129900     EVALUATE TRUE                                                12990009
130000         WHEN SQLCODE = +0                                        13000009
130100              CONTINUE                                            13010009
130200         WHEN OTHER                                               13020009
130300             MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER  13030009
130400*            A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK      13040009
130500             MOVE SQLCODE                    TO PV-SQLCODE        13050009
130600             MOVE '2630-CLOSE-RECEIVR-CSR'   TO PV-PARA-NAME      13060009
130700             MOVE TR069-DC-NBR           TO PV-DISPLAY-DC         13070009
130800             STRING ' CLOSE RECEIVER CURSOR FAILED WITH '         13080009
130900                     PV-SQLCODE                                   13090009
131000                   ' TLR ' TR069-TRAILER-ID                       13100009
131100                   ' SCAC ' TR069-TRLR-SCAC-CDE                   13110009
131200                   ' DC ' PV-DISPLAY-DC                           13120009
131300                   ' ' TR069-USER-ID                              13130009
131400                    DELIMITED BY SIZE INTO  PV-ERROR-MSG          13140009
131500             PERFORM 9500-CSSL-LOG                                13150009
131600             PERFORM 9800-ROLLBACK                                13160009
131700             PERFORM 9900-RETURN-TRAN                             13170009
131800     END-EVALUATE.                                                13180009
131900                                                                  13190009
132000******************************************************************13200009
132100*  TAKE A SNAPSHOT OF THE AFTER  IMAGE OF TVEHICL AND WRITE      *13210009
132200*  TO THE AUDIT TABLE.                                           *13220009
132300******************************************************************13230009
132400 2640-UPDATE-RECEIV.                                              13240009
132500                                                                  13250009
132600     EXEC SQL                                                     13260009
132700       UPDATE TRECEIV                                             13270009
132800          SET REC_TMST      = :PV-REC-TMST                        13280009
132900       WHERE  ORD_NBR       = :RECEIV-ORD-NBR                     13290009
133000         AND  REC_SEQ_NBR   = :RECEIV-REC-SEQ-NBR                 13300009
133100         AND  CRE_TMST      = :RECEIV-CRE-TMST                    13310009
133200     END-EXEC.                                                    13320009
133300                                                                  13330009
133400     EVALUATE TRUE                                                13340009
133500         WHEN SQLCODE = +0                                        13350009
133600             CONTINUE                                             13360009
133700                                                                  13370009
133800         WHEN OTHER                                               13380009
133900             MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER  13390009
134000*            A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK      13400009
134100             MOVE SQLCODE                    TO PV-SQLCODE        13410009
134200             MOVE '2640-UPDATE-RECEIV'       TO PV-PARA-NAME      13420009
134300             MOVE TR069-DC-NBR           TO PV-DISPLAY-DC         13430009
134400             MOVE RECEIV-ORD-NBR         TO PV-RCV-ORD-NBR        13440009
134500             MOVE RECEIV-REC-SEQ-NBR     TO PV-RCV-REC-SEQ-NBR    13450009
134600             STRING ' UPDT TRECEIV FAILED '                       13460009
134700                     PV-SQLCODE                                   13470009
134800                   ' TLR ' TR069-TRAILER-ID                       13480009
134900                   ' SCAC ' TR069-TRLR-SCAC-CDE                   13490009
135000                   ' DC ' PV-DISPLAY-DC                           13500009
135100                    DELIMITED BY SIZE INTO  PV-ERROR-MSG          13510009
135200             PERFORM 9500-CSSL-LOG                                13520009
135300             STRING ' UPDT TRECEIV CONT '                         13530009
135400                   ' ORD ' PV-RCV-ORD-NBR                         13540009
135500                   ' SEQ ' PV-RCV-REC-SEQ-NBR                     13550009
135600                   ' TIME ' RECEIV-CRE-TMST                       13560009
135700                   ' USER ' TR069-USER-ID                         13570009
135800                    DELIMITED BY SIZE INTO  PV-ERROR-MSG          13580009
135900             PERFORM 9500-CSSL-LOG                                13590009
136000             PERFORM 9800-ROLLBACK                                13600009
136100             PERFORM 9900-RETURN-TRAN                             13610009
136200     END-EVALUATE.                                                13620009
136300                                                                  13630009
136400***************************************************************** 13640009
136500* SELECT TTRBNTF TABLE                                            13650009
136600***************************************************************** 13660009
136700 2650-CHK4-STORAGE-TRBL.                                          13670009
136800                                                                  13680009
136900     EXEC SQL                                                     13690009
137000         SELECT OPER_UNT_ID                                       13700009
137100              , FCLTY_ID                                          13710009
137200              , PO_NBR                                            13720009
137300              , REC_SEQ_NBR                                       13730009
137400              , TRBL_RSN_CDE                                      13740009
137500          INTO  :TRBNTF-OPER-UNT-ID                               13750009
137600              , :TRBNTF-FCLTY-ID                                  13760009
137700              , :TRBNTF-PO-NBR                                    13770009
137800              , :TRBNTF-REC-SEQ-NBR                               13780009
137900              , :TRBNTF-TRBL-RSN-CDE                              13790009
138000          FROM  TTRBNTF                                           13800009
138100          WHERE PO_NBR        = :RECEIV-ORD-NBR                   13810009
138200            AND REC_SEQ_NBR   = :RECEIV-REC-SEQ-NBR               13820009
138300            AND TRBL_RSN_CDE  IN (:PC-997, :PC-998)               13830009
138400                   AND RESOLVED_IND  IN (:PC-I, :PC-N)            13840009
138500     END-EXEC.                                                    13850009
138600                                                                  13860009
138700     EVALUATE TRUE                                                13870009
138800         WHEN SQLCODE = +0                                        13880009
138900             SET PS-NO-TRBL-ACCESS-TRBL TO TRUE                   13890009
139000             PERFORM 2660-CHK-TRBL-RSN                            13900009
139100         WHEN SQLCODE = +100                                      13910009
139200             SET PS-NO-TRBL-ACCESS-TRBL TO TRUE                   13920009
139300         WHEN OTHER                                               13930009
139400             MOVE PC-TSYMSG-01570        TO PV-TSYMSG-NUMBER      13940009
139500*            A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK      13950009
139600             MOVE SQLCODE                TO PV-SQLCODE            13960009
139700             MOVE '2650-CHK4-STORAGE-TRBL' TO PV-PARA-NAME        13970009
139800             MOVE TR069-DC-NBR           TO PV-DISPLAY-DC         13980009
139900             MOVE RECEIV-ORD-NBR         TO PV-RCV-ORD-NBR        13990009
140000             MOVE RECEIV-REC-SEQ-NBR     TO PV-RCV-REC-SEQ-NBR    14000009
140100             STRING ' TTRBNTF READ FAILED '                       14010009
140200                     PV-SQLCODE                                   14020009
140300                   ' TLR ' TR069-TRAILER-ID                       14030009
140400                   ' SCAC ' TR069-TRLR-SCAC-CDE                   14040009
140500                   ' ORD ' PV-RCV-ORD-NBR                         14050009
140600                   ' SEQ ' PV-RCV-REC-SEQ-NBR                     14060009
140700                   ' ' PV-DISPLAY-DC                              14070009
140800                   ' ' TR069-USER-ID                              14080009
140900                    DELIMITED BY SIZE INTO  PV-ERROR-MSG          14090009
141000             PERFORM 9500-CSSL-LOG                                14100009
141100             PERFORM 9800-ROLLBACK                                14110009
141200             PERFORM 9900-RETURN-TRAN                             14120009
141300     END-EVALUATE.                                                14130009
141400                                                                  14140009
141500***************************************************************** 14150009
141600* CHECK TROUBLE REASON                                          * 14160009
141700* TRBL-RSN-CDES 997 OR 998 ARE TO BE RESOLVED WHEN A TRAILER    * 14170009
141800* IS PLACED IN 'ARRIVED' STATUS                                 * 14180009
141900***************************************************************** 14190009
142000 2660-CHK-TRBL-RSN.                                               14200009
142100     IF TRBNTF-TRBL-RSN-CDE = 997 OR 998                          14210009
142200         SET TM500-RESOLVE-MANUAL                                 14220009
142300             TM500-PO-LEVEL                                       14230009
142400             TM500-ADD-DETAILS TO TRUE                            14240009
142500         MOVE TRBNTF-OPER-UNT-ID  TO TM500-OPER-UNT-ID            14250009
142600         MOVE TRBNTF-FCLTY-ID     TO TM500-FCLTY-ID               14260009
142700         MOVE TRBNTF-PO-NBR       TO TM500-PO-NBR                 14270009
142800         MOVE TRBNTF-REC-SEQ-NBR  TO TM500-REC-SEQ-NBR            14280009
142900         MOVE TRBNTF-TRBL-RSN-CDE TO TM500-TRBL-RSN-CDE           14290009
143000         MOVE ZERO                TO TM500-PO-LNE-NBR             14300009
143100         MOVE TR069-USER-ID       TO TM500-RESOLVED-UID           14310009
143200         MOVE PC-RESOLVE-AUTO-MSG TO TM500-FREEFORM-TEXT          14320009
143300         PERFORM 2670-TRBL-UPDATE                                 14330009
143400         IF TM500-CALL-SUCCESSFUL                                 14340009
143500             ADD +1 TO PV-TRBL-RSLV-CT                            14350009
143600         END-IF                                                   14360009
143700     END-IF.                                                      14370009
143800                                                                  14380009
143900**** AFTER A SUCCESSFUL RESOLUTION OF TRBL-RSN-CDE 998,           14390009
144000**** TRBL-RSN-CDE 999 IS CREATED FOR THE 'ARRIVED' TRAILER        14400009
144100**** INDICATING THAT THIS TRAILER STILL HAS STORAGE TROUBLE       14410009
144200     IF TM500-CALL-SUCCESSFUL                                     14420009
144300         IF TRBNTF-TRBL-RSN-CDE = 998                             14430009
144400             SET TM500-CREATE-MANUAL                              14440009
144500                 TM500-PO-LEVEL                                   14450009
144600                 TM500-ADD-DETAILS                                14460009
144700                 PS-TRBL-CREATED-ONSITE TO TRUE                   14470009
144800             MOVE PC-999             TO TM500-TRBL-RSN-CDE        14480009
144900             MOVE TR069-USER-ID      TO TM500-NOTIF-UID           14490009
145000                                        TM500-CRE-UID             14500009
145100             MOVE TRBNTF-OPER-UNT-ID TO TM500-OPER-UNT-ID         14510009
145200             MOVE TRBNTF-FCLTY-ID    TO TM500-FCLTY-ID            14520009
145300             MOVE TRBNTF-PO-NBR      TO TM500-PO-NBR              14530009
145400             MOVE TRBNTF-PO-LNE-NBR  TO TM500-PO-LNE-NBR          14540009
145500             MOVE TRBNTF-REC-SEQ-NBR TO TM500-REC-SEQ-NBR         14550009
145600             MOVE PC-CREATE-AUTO-MSG TO                           14560009
145700                                     TM500-FREEFORM-TEXT          14570009
145800             PERFORM 2670-TRBL-UPDATE                             14580009
145900         END-IF                                                   14590009
146000     ELSE                                                         14600009
146100         SET PS-TRBL-ACCESS-TRBL-F TO TRUE                        14610009
146200         MOVE PC-TSYMSG-01669 TO PV-TRBL-MSG-NO                   14620009
146300                                 PV-TSYMSG-NUMBER                 14630009
146400*        TRAILER ARRIVED, BUT ERROR IN TROUBLE PROCESSING         14640009
146500*        - CONTACT SYSTEMS                                        14650009
146600         MOVE TR069-DC-NBR           TO PV-DISPLAY-DC             14660009
146700         MOVE RECEIV-ORD-NBR         TO PV-RCV-ORD-NBR            14670009
146800         MOVE RECEIV-REC-SEQ-NBR     TO PV-RCV-REC-SEQ-NBR        14680009
146900         STRING ' ERROR IN TROUBLE - RC = '                       14690009
147000                  TM500-RETURN-CODE                               14700009
147100                ' TLR ' TR069-TRAILER-ID                          14710009
147200                ' SCAC ' TR069-TRLR-SCAC-CDE                      14720009
147300                ' ORD ' PV-RCV-ORD-NBR                            14730009
147400                ' SEQ ' PV-RCV-REC-SEQ-NBR                        14740009
147500                ' ' PV-DISPLAY-DC                                 14750009
147600                ' ' TR069-USER-ID                                 14760009
147700                 DELIMITED BY SIZE INTO  PV-ERROR-MSG             14770009
147800     END-IF.                                                      14780009
147900                                                                  14790009
148000***************************************************************** 14800009
148100* UPDATE TROUBLE                                                * 14810009
148200***************************************************************** 14820009
148300 2670-TRBL-UPDATE.                                                14830009
148400     PERFORM 2680-LINK-TO-UPDATE.                                 14840009
148500     IF TM500-CALL-SUCCESSFUL                                     14850009
148600         CONTINUE                                                 14860009
148700     ELSE                                                         14870009
148800         SET PS-TRBL-ACCESS-TRBL-F TO TRUE                        14880009
148900         MOVE PC-TSYMSG-01669 TO PV-TRBL-MSG-NO                   14890009
149000                                 PV-TSYMSG-NUMBER                 14900009
149100*        TRAILER ARRIVED, BUT ERROR IN TROUBLE PROCESSING         14910009
149200*        - CONTACT SYSTEMS                                        14920009
149300         MOVE SQLCODE                    TO PV-SQLCODE            14930009
149400         MOVE '2670-TRBL-UPDATE'         TO PV-PARA-NAME          14940009
149500         MOVE TR069-DC-NBR           TO PV-DISPLAY-DC             14950009
149600         MOVE RECEIV-ORD-NBR         TO PV-RCV-ORD-NBR            14960009
149700         MOVE RECEIV-REC-SEQ-NBR     TO PV-RCV-REC-SEQ-NBR        14970009
149800         STRING ' ERROR IN TROUBLE - RC = '                       14980009
149900                  TM500-RETURN-CODE                               14990009
150000                ' TLR ' TR069-TRAILER-ID                          15000009
150100                ' SCAC ' TR069-TRLR-SCAC-CDE                      15010009
150200                ' ORD ' PV-RCV-ORD-NBR                            15020009
150300                ' SEQ ' PV-RCV-REC-SEQ-NBR                        15030009
150400                ' ' PV-DISPLAY-DC                                 15040009
150500                ' ' TR069-USER-ID                                 15050009
150600                 DELIMITED BY SIZE INTO  PV-ERROR-MSG             15060009
150700         PERFORM 9500-CSSL-LOG                                    15070009
150800         PERFORM 9800-ROLLBACK                                    15080009
150900         PERFORM 9900-RETURN-TRAN                                 15090009
151000     END-IF.                                                      15100009
151100                                                                  15110009
151200***************************************************************** 15120009
151300* LINK TO TMKCS520                                              * 15130009
151400***************************************************************** 15140009
151500 2680-LINK-TO-UPDATE.                                             15150009
151600                                                                  15160009
151700     EXEC CICS LINK                                               15170009
151800         PROGRAM  (PC-TMKCS520)                                   15180009
151900         COMMAREA (TM500-FIELDS)                                  15190009
152000         RESP     (PV-CICS-RESPONSE)                              15200009
152100     END-EXEC.                                                    15210009
152200                                                                  15220009
152300     IF PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)                15230009
152400         MOVE PC-TSYMSG-01669            TO PV-TSYMSG-NUMBER      15240009
152500*        TRAILER ARRIVED, BUT ERROR IN TROUBLE PROCESSING         15250009
152600*        - CONTACT SYSTEMS                                        15260009
152700         MOVE SQLCODE                    TO PV-SQLCODE            15270009
152800         MOVE '2680-LINK-TO-UPDATE'      TO PV-PARA-NAME          15280009
152900         STRING 'LINK TO UPDATE FAILED WITH SQLCODE:'             15290009
153000                PV-SQLCODE DELIMITED BY SIZE INTO  PV-ERROR-MSG   15300009
153100         MOVE TR069-DC-NBR           TO PV-DISPLAY-DC             15310009
153200         MOVE RECEIV-ORD-NBR         TO PV-RCV-ORD-NBR            15320009
153300         MOVE RECEIV-REC-SEQ-NBR     TO PV-RCV-REC-SEQ-NBR        15330009
153400         STRING ' LINK TO TMKCS520 FAIL SQL= '                    15340009
153500                  PV-SQLCODE                                      15350009
153600                ' TLR ' TR069-TRAILER-ID                          15360009
153700                ' SCAC ' TR069-TRLR-SCAC-CDE                      15370009
153800                ' ORD ' PV-RCV-ORD-NBR                            15380009
153900                ' SEQ ' PV-RCV-REC-SEQ-NBR                        15390009
154000                ' ' PV-DISPLAY-DC                                 15400009
154100                ' ' TR069-USER-ID                                 15410009
154200                 DELIMITED BY SIZE INTO  PV-ERROR-MSG             15420009
154300         PERFORM 9500-CSSL-LOG                                    15430009
154400         PERFORM 9800-ROLLBACK                                    15440009
154500         PERFORM 9900-RETURN-TRAN                                 15450009
154600     END-IF.                                                      15460009
154700                                                                  15470009
154800******************************************************************15480009
154900* CALL TO XLKUP033 FOR LABOR FOR ARRIVALS                         15490009
155000******************************************************************15500009
155100 2700-CHECK-FOR-PLANNING.                                         15510009
155200     PERFORM 2710-CHECK-DC-PLANNING-PARM.                         15520009
155300     IF PS-DC-PLANNING-YES                                        15530009
155400         PERFORM 2720-CALL-XLKUP033-EAI                           15540009
155500     END-IF.                                                      15550009
155600                                                                  15560009
155700                                                                  15570009
155800****************************************************************  15580009
155900*  CHECK DC PLANNING PARM ON TKRPRPM TABLE                        15590009
156000****************************************************************  15600009
156100 2710-CHECK-DC-PLANNING-PARM.                                     15610009
156200                                                                  15620009
156300     MOVE TR069-DC-NBR        TO  KRPRPM-LOC-ID.                  15630009
156400                                                                  15640009
156500     EXEC SQL                                                     15650009
156600          SELECT FUNC_TXT                                         15660009
156700          INTO  :KRPRPM-FUNC-TXT                                  15670009
156800          FROM   TKRPRPM                                          15680009
156900          WHERE  SYS_PRC_FUNC_CDE  = 'PLNCRE'                     15690009
157000            AND  LOC_ID            = :KRPRPM-LOC-ID               15700009
157100            AND  INTFC_SYS_CDE     = 'DLX'                        15710009
157200            AND  FUNC_PRC_STAT_CDE = 'AC'                         15720009
157300            AND  FUNC_TXT          = 'Y'                          15730009
157400     END-EXEC.                                                    15740009
157500                                                                  15750009
157600     EVALUATE TRUE                                                15760009
157700         WHEN SQLCODE = +0                                        15770009
157800             SET PS-DC-PLANNING-YES TO TRUE                       15780009
157900         WHEN SQLCODE = +100                                      15790009
158000             SET PS-DC-PLANNING-NO  TO TRUE                       15800009
158100         WHEN OTHER                                               15810009
158200            MOVE PC-TSYMSG-01570       TO PV-TSYMSG-NUMBER        15820009
158300*           A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK       15830009
158400            MOVE SQLCODE               TO PV-SQLCODE              15840009
158500            MOVE '2710-CHECK-DC-PLANNING-PARM' TO PV-PARA-NAME    15850009
158600            MOVE TR069-DC-NBR           TO PV-DISPLAY-DC          15860009
158700            STRING ' TKRPRPM PLNCRE CALL FAILED - SQL = '         15870009
158800                  PV-SQLCODE                                      15880009
158900                ' TLR ' TR069-TRAILER-ID                          15890009
159000                ' SCAC ' TR069-TRLR-SCAC-CDE                      15900009
159100                ' ' PV-DISPLAY-DC                                 15910009
159200                ' ' TR069-USER-ID                                 15920009
159300                 DELIMITED BY SIZE INTO  PV-ERROR-MSG             15930009
159400            PERFORM 9500-CSSL-LOG                                 15940009
159500            PERFORM 9800-ROLLBACK                                 15950009
159600            PERFORM 9900-RETURN-TRAN                              15960009
159700     END-EVALUATE.                                                15970009
159800                                                                  15980009
159900****************************************************************  15990009
160000* CALL XLKUP033                                                   16000009
160100****************************************************************  16010009
160200 2720-CALL-XLKUP033-EAI.                                          16020009
160300                                                                  16030009
160400     INITIALIZE XL072-EAI-EXPORT-COMMAREA.                        16040009
160500     SET XL072-SU-APP-ID                                          16050009
160600         XL072-COMMIT-UPDATE      TO TRUE.                        16060009
160700                                                                  16070009
160800     MOVE 'RECEIVING'             TO XL072-EVNT-OBJ-TXT.          16080009
160900     MOVE 'TRAILER ARRIVAL'       TO XL072-EVNT-OBJ-ACTN-TXT.     16090009
161000     MOVE TR069-USER-ID           TO XL072-CRE-BY-USR-ID.         16100009
161100     MOVE PC-CURRENT-PROGRAM-NAME TO XL072-CRE-PGM-NM.            16110009
161200                                                                  16120009
161300     MOVE PV-TRIP-ID              TO XL072-EVNT-KY-1-NBR.         16130009
161400                                                                  16140009
161500     MOVE TRIPST-OPER-UNT-ID      TO XL072-EVNT-KY-2-NBR.         16150009
161600     MOVE PV-REC-TMST             TO XL072-EVNT-KY-1-TMST.        16160009
161700     MOVE PV-KEY-OWNER-SCAC-ID    TO XL072-EVNT-KY-1-TXT.         16170009
161800     MOVE PV-VEH-NBR              TO XL072-EVNT-KY-2-TXT.         16180009
161900                                                                  16190009
162000     SET XL072-COPYBOOK-NOT-USED  TO TRUE.                        16200009
162100                                                                  16210009
162200     CALL XL072-USER-PGM USING DFHEIBLK                           16220009
162300                              XL072-COMMAREA                      16230009
162400                              XL072-EAI-EXPORT-COMMAREA.          16240009
162500                                                                  16250009
162600     EVALUATE TRUE                                                16260009
162700         WHEN XL072-SUCCESSFUL                                    16270009
162800              CONTINUE                                            16280009
162900         WHEN OTHER                                               16290009
163000            MOVE PC-TSYMSG-01570       TO PV-TSYMSG-NUMBER        16300009
163100*           A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK       16310009
163200            MOVE SQLCODE               TO PV-SQLCODE              16320009
163300            MOVE '2720-CALL-XLKUP033-EAI' TO PV-PARA-NAME         16330009
163400            MOVE TR069-DC-NBR          TO PV-DISPLAY-DC           16340009
163500            STRING 'CALL TO XLKUP033 LABOR ERROR - RET CDE = '    16350009
163600                  XL072-RETURN-CODE                               16360009
163700                ' TLR ' TR069-TRAILER-ID                          16370009
163800                ' SCAC ' TR069-TRLR-SCAC-CDE                      16380009
163900                ' ' PV-DISPLAY-DC                                 16390009
164000                ' ' TR069-USER-ID                                 16400009
164100                 DELIMITED BY SIZE INTO  PV-ERROR-MSG             16410009
164200            PERFORM 9500-CSSL-LOG                                 16420009
164300            PERFORM 9800-ROLLBACK                                 16430009
164400            PERFORM 9900-RETURN-TRAN                              16440009
164500      END-EVALUATE.                                               16450009
164600                                                                  16460009
164700****************************************************************  16470009
164800* UPDATE THE LOCATION AND STATUS OF THE VEHICLE                   16480009
164900****************************************************************  16490009
165000 2800-UPDATE-TVEHICL.                                             16500009
165100     MOVE PV-TRIP-STATUS-CDE     TO VEHICL-CURR-STATUS-CDE.       16510009
165200                                                                  16520009
165300     MOVE PV-CURR-FAC-AREA-ID    TO VEHICL-CURR-FAC-AREA-ID.      16530009
165400                                                                  16540009
165500**   MOVE PV-CURR-OPER-UNT-ID    TO VEHICL-CURR-OPER-UNT-ID.      16550009
165600     MOVE TR069-DC-NBR           TO VEHICL-CURR-OPER-UNT-ID.      16560009
165700                                                                  16570009
165800     MOVE PV-TRIP-ID             TO VEHICL-CURR-TRIP-ID.          16580009
165900     MOVE PV-CURR-FCLTY-ID       TO VEHICL-CURR-FCLTY-ID.         16590009
166000     IF PV-USAGE-CDE = SPACES                                     16600009
166100         MOVE 'RCV'              TO VEHICL-USAGE-CDE              16610009
166200     ELSE                                                         16620009
166300         MOVE PV-USAGE-CDE       TO VEHICL-USAGE-CDE              16630009
166400     END-IF.                                                      16640009
166500     MOVE PV-LENGTH              TO VEHICL-VEH-SIZE-CDE.          16650009
166600     MOVE SPACES                 TO VEHICL-CURR-STATUS-DTE.       16660009
166700     MOVE SPACES                 TO VEHICL-CURR-STATUS-TME.       16670009
166800     MOVE PV-VEH-TYP-CDE         TO VEHICL-VEH-TYP-CDE.           16680009
166900     IF VEHICL-CURR-TRIP-ID = ZERO                                16690009
167000         MOVE -1 TO DN-CURR-TRIP-ID                               16700009
167100     ELSE                                                         16710009
167200         MOVE +1 TO DN-CURR-TRIP-ID                               16720009
167300     END-IF.                                                      16730009
167400                                                                  16740009
167500     IF VEHICL-CURR-STATUS-DTE = SPACES OR                        16750009
167600        VEHICL-CURR-STATUS-TME = SPACES                           16760009
167700         EXEC CICS ASKTIME                                        16770009
167800              ABSTIME (PV-ABSTIME)                                16780009
167900         END-EXEC                                                 16790009
168000         EXEC CICS FORMATTIME                                     16800009
168100              ABSTIME (PV-ABSTIME)                                16810009
168200              DATESEP ('-') YYMMDD  (PV-CURR-STATUS-DTE)          16820009
168300              TIME (PV-CURR-STATUS-TME) TIMESEP                   16830009
168400         END-EXEC                                                 16840009
168500         IF PV-CURR-STATUS-YY > 60                                16850009
168600             MOVE '19'   TO PV-CURR-STATUS-CC                     16860009
168700         ELSE                                                     16870009
168800             MOVE '20'   TO PV-CURR-STATUS-CC                     16880009
168900         END-IF                                                   16890009
169000         MOVE PV-CURR-STATUS-CCYYMMDD  TO                         16900009
169100                              VEHICL-CURR-STATUS-DTE              16910009
169200         MOVE PV-CURR-STAT-TME TO                                 16920009
169300                              VEHICL-CURR-STATUS-TME              16930009
169400     END-IF.                                                      16940009
169500                                                                  16950009
169600     EXEC SQL                                                     16960009
169700       UPDATE TVEHICL                                             16970009
169800          SET LAST_UPD_DTE     = CURRENT DATE                     16980009
169900             ,LAST_UPD_TME     = CURRENT TIME                     16990009
170000             ,LAST_UPD_UID     = :TR069-USER-ID                   17000009
170100             ,USAGE_CDE        = :VEHICL-USAGE-CDE                17010009
170200             ,VEH_TYP_CDE      = :VEHICL-VEH-TYP-CDE              17020009
170300             ,VEH_SIZE_CDE     = :VEHICL-VEH-SIZE-CDE             17030009
170400             ,CURR_STATUS_DTE  = :VEHICL-CURR-STATUS-DTE          17040009
170500             ,CURR_STATUS_TME  = :VEHICL-CURR-STATUS-TME          17050009
170600             ,CURR_STATUS_CDE  = :VEHICL-CURR-STATUS-CDE          17060009
170700             ,CURR_FAC_AREA_ID = :VEHICL-CURR-FAC-AREA-ID         17070009
170800             ,CURR_OPER_UNT_ID = :VEHICL-CURR-OPER-UNT-ID         17080009
170900             ,CURR_FCLTY_ID    = :VEHICL-CURR-FCLTY-ID            17090009
171000             ,CURR_TRIP_ID     = :VEHICL-CURR-TRIP-ID             17100009
171100                                 :DN-CURR-TRIP-ID                 17110009
171200       WHERE  VEH_NBR       = :PV-VEH-NBR                         17120009
171300         AND  OWNER_SCAC_ID = :PV-OWNER-SCAC-ID                   17130009
171400     END-EXEC.                                                    17140009
171500                                                                  17150009
171600     EVALUATE TRUE                                                17160009
171700         WHEN SQLCODE = +0                                        17170009
171800             CONTINUE                                             17180009
171900                                                                  17190009
172000         WHEN OTHER                                               17200009
172100             MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER  17210009
172200*            A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK      17220009
172300             MOVE SQLCODE                    TO PV-SQLCODE        17230009
172400             MOVE '2800-UPDATE-TVEHICL'      TO PV-PARA-NAME      17240009
172500             MOVE TR069-DC-NBR          TO PV-DISPLAY-DC          17250009
172600             STRING 'UPDATE TVEHICL FAILED WITH SQL '             17260009
172700                   PV-SQLCODE                                     17270009
172800                 ' TLR ' TR069-TRAILER-ID                         17280009
172900                 ' SCAC ' TR069-TRLR-SCAC-CDE                     17290009
173000                 ' ' PV-DISPLAY-DC                                17300009
173100                 ' ' TR069-USER-ID                                17310009
173200                  DELIMITED BY SIZE INTO  PV-ERROR-MSG            17320009
173300             PERFORM 9500-CSSL-LOG                                17330009
173400             PERFORM 9800-ROLLBACK                                17340009
173500             PERFORM 9900-RETURN-TRAN                             17350009
173600     END-EVALUATE.                                                17360009
173700                                                                  17370009
173800******************************************************************17380009
173900*  TAKE A SNAPSHOT OF THE AFTER  IMAGE OF TVEHICL AND WRITE      *17390009
174000*  TO THE AUDIT TABLE.                                           *17400009
174100******************************************************************17410009
174200 2850-AUDIT-TVEHICL.                                              17420009
174300                                                                  17430009
174400     INITIALIZE DCLTAUVHCL.                                       17440009
174500                                                                  17450009
174600     EXEC SQL                                                     17460009
174700         SELECT  OWNER_SCAC_ID                                    17470009
174800                ,VEH_NBR                                          17480009
174900                ,CRT_SRC_CDE                                      17490009
175000                ,LAST_UPD_DTE                                     17500009
175100                ,LAST_UPD_TME                                     17510009
175200                ,LAST_UPD_UID                                     17520009
175300                ,USAGE_CDE                                        17530009
175400                ,VEH_TYP_CDE                                      17540009
175500                ,CURR_STATUS_CDE                                  17550009
175600                ,CURR_STATUS_DTE                                  17560009
175700                ,CURR_STATUS_TME                                  17570009
175800                ,CURR_OPER_UNT_ID                                 17580009
175900                ,CURR_FCLTY_ID                                    17590009
176000                ,CURR_FAC_AREA_ID                                 17600009
176100                ,CURR_LOC_DTE                                     17610009
176200                ,CURR_LOC_TME                                     17620009
176300                ,CURR_TRIP_ID                                     17630009
176400                ,VEH_SIZE_CDE                                     17640009
176500        INTO     :VEHICL-OWNER-SCAC-ID                            17650009
176600                ,:VEHICL-VEH-NBR                                  17660009
176700                ,:VEHICL-CRT-SRC-CDE                              17670009
176800                ,:VEHICL-LAST-UPD-DTE                             17680009
176900                ,:VEHICL-LAST-UPD-TME                             17690009
177000                ,:VEHICL-LAST-UPD-UID                             17700009
177100                ,:VEHICL-USAGE-CDE                                17710009
177200                ,:VEHICL-VEH-TYP-CDE                              17720009
177300                ,:VEHICL-CURR-STATUS-CDE                          17730009
177400                ,:VEHICL-CURR-STATUS-DTE                          17740009
177500                ,:VEHICL-CURR-STATUS-TME                          17750009
177600                ,:VEHICL-CURR-OPER-UNT-ID                         17760009
177700                ,:VEHICL-CURR-FCLTY-ID                            17770009
177800                ,:VEHICL-CURR-FAC-AREA-ID                         17780009
177900                ,:VEHICL-CURR-LOC-DTE                             17790009
178000                ,:VEHICL-CURR-LOC-TME                             17800009
178100                ,:VEHICL-CURR-TRIP-ID                             17810009
178200                   :DN-CURR-TRIP-ID                               17820009
178300                ,:VEHICL-VEH-SIZE-CDE                             17830009
178400       FROM   TVEHICL                                             17840009
178500       WHERE  VEH_NBR       = :PV-VEH-NBR                         17850009
178600         AND  OWNER_SCAC_ID = :PV-OWNER-SCAC-ID                   17860009
178700     END-EXEC.                                                    17870009
178800                                                                  17880009
178900     EVALUATE TRUE                                                17890009
179000         WHEN SQLCODE = +0                                        17900009
179100             CONTINUE                                             17910009
179200                                                                  17920009
179300         WHEN OTHER                                               17930009
179400             MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER  17940009
179500*            A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK      17950009
179600             MOVE SQLCODE                    TO PV-SQLCODE        17960009
179700             MOVE '2850-AUDIT-TVEHICL 1'     TO PV-PARA-NAME      17970009
179800             MOVE TR069-DC-NBR          TO PV-DISPLAY-DC          17980009
179900             STRING 'TVEHICL READ FAILED WITH SQL '               17990009
180000                   PV-SQLCODE                                     18000009
180100                 ' TLR ' TR069-TRAILER-ID                         18010009
180200                 ' SCAC ' TR069-TRLR-SCAC-CDE                     18020009
180300                 ' ' PV-DISPLAY-DC                                18030009
180400                 ' ' TR069-USER-ID                                18040009
180500                  DELIMITED BY SIZE INTO  PV-ERROR-MSG            18050009
180600             PERFORM 9500-CSSL-LOG                                18060009
180700             PERFORM 9800-ROLLBACK                                18070009
180800             PERFORM 9900-RETURN-TRAN                             18080009
180900     END-EVALUATE.                                                18090009
181000                                                                  18100009
181100     EXEC SQL                                                     18110009
181200         INSERT  INTO TAUVHCL                                     18120009
181300                (OWNER_SCAC_ID                                    18130009
181400                ,VEH_NBR                                          18140009
181500                ,CRT_SRC_CDE                                      18150009
181600                ,LAST_UPD_DTE                                     18160009
181700                ,LAST_UPD_TME                                     18170009
181800                ,LAST_UPD_UID                                     18180009
181900                ,USAGE_CDE                                        18190009
182000                ,VEH_TYP_CDE                                      18200009
182100                ,CURR_STATUS_CDE                                  18210009
182200                ,CURR_STATUS_DTE                                  18220009
182300                ,CURR_STATUS_TME                                  18230009
182400                ,CURR_OPER_UNT_ID                                 18240009
182500                ,CURR_FCLTY_ID                                    18250009
182600                ,CURR_FAC_AREA_ID                                 18260009
182700                ,CURR_LOC_DTE                                     18270009
182800                ,CURR_LOC_TME                                     18280009
182900                ,CURR_TRIP_ID                                     18290009
183000                ,VEH_SIZE_CDE)                                    18300009
183100        VALUES  (:VEHICL-OWNER-SCAC-ID                            18310009
183200                ,:VEHICL-VEH-NBR                                  18320009
183300                ,:VEHICL-CRT-SRC-CDE                              18330009
183400                ,:VEHICL-LAST-UPD-DTE                             18340009
183500                ,:VEHICL-LAST-UPD-TME                             18350009
183600                ,:VEHICL-LAST-UPD-UID                             18360009
183700                ,:VEHICL-USAGE-CDE                                18370009
183800                ,:VEHICL-VEH-TYP-CDE                              18380009
183900                ,:VEHICL-CURR-STATUS-CDE                          18390009
184000                ,:VEHICL-CURR-STATUS-DTE                          18400009
184100                ,:VEHICL-CURR-STATUS-TME                          18410009
184200                ,:VEHICL-CURR-OPER-UNT-ID                         18420009
184300                ,:VEHICL-CURR-FCLTY-ID                            18430009
184400                ,:VEHICL-CURR-FAC-AREA-ID                         18440009
184500                ,:VEHICL-CURR-LOC-DTE                             18450009
184600                ,:VEHICL-CURR-LOC-TME                             18460009
184700                ,:VEHICL-CURR-TRIP-ID                             18470009
184800                   :DN-CURR-TRIP-ID                               18480009
184900                ,:VEHICL-VEH-SIZE-CDE)                            18490009
185000     END-EXEC.                                                    18500009
185100                                                                  18510009
185200     EVALUATE TRUE                                                18520009
185300         WHEN SQLCODE = +0                                        18530009
185400             CONTINUE                                             18540009
185500                                                                  18550009
185600         WHEN OTHER                                               18560009
185700             MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER  18570009
185800*            A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK      18580009
185900             MOVE SQLCODE                    TO PV-SQLCODE        18590009
186000             MOVE '2850-AUDIT-TVEHICL 2'     TO PV-PARA-NAME      18600009
186100             MOVE TR069-DC-NBR          TO PV-DISPLAY-DC          18610009
186200             STRING 'TAUVHCL INSERT FAILED WITH SQL '             18620009
186300                   PV-SQLCODE                                     18630009
186400                 ' TLR ' TR069-TRAILER-ID                         18640009
186500                 ' SCAC ' TR069-TRLR-SCAC-CDE                     18650009
186600                 ' ' PV-DISPLAY-DC                                18660009
186700                 ' ' TR069-USER-ID                                18670009
186800                  DELIMITED BY SIZE INTO  PV-ERROR-MSG            18680009
186900             PERFORM 9500-CSSL-LOG                                18690009
187000             PERFORM 9800-ROLLBACK                                18700009
187100             PERFORM 9900-RETURN-TRAN                             18710009
187200     END-EVALUATE.                                                18720009
187300***********************************************************       18730000
187400*  SET DEFUALT MANIFEST WHEN MANIFEST NUMBER CREATED AS   *       18740000
187500*  AS SPACES. Using Date, Format AG@MMDDYYYYAR            *       18750000
187600***********************************************************       18760000
187700 2890-SET-MANIFEST-NBR.                                           18770000
187800                                                                  18780000
187900     EXEC SQL                                                     18790000
188000         SET :PV-DB2-HOST-DATE      = CURRENT DATE                18800000
188100     END-EXEC.                                                    18810000
188200                                                                  18820000
188300     MOVE PV-DB2-HOST-DATE(1:4)    TO PV-DFLT-MAN-CCYY.           18830000
188400     MOVE PV-DB2-HOST-DATE(6:2)    TO PV-DFLT-MAN-MM.             18840000
188500     MOVE PV-DB2-HOST-DATE(9:2)    TO PV-DFLT-MAN-DD.             18850000
188600     MOVE 'AR'                     TO PV-DFLT-MAN-AR              18860000
188700     MOVE PV-DEFAULT-MANIFEST      TO VHTRIP-MANIFEST-NBR.        18870000
188800                                                                  18880000
188900***********************************************************       18890000
189000*  UPDATE MANFEST NUMBER WITH FORMATED VALUE              *       18900000
189100*  Format AG@MMDDYYYYAR                                   *       18910000
189200***********************************************************       18920000
189300 2900-UPDATE-TVHTRIP.                                             18930000
189400                                                                  18940000
189500     EXEC SQL                                                     18950000
189600       UPDATE TVHTRIP                                             18960000
189700          SET MANIFEST_NBR     = :VHTRIP-MANIFEST-NBR             18970000
189800             ,LAST_UPD_DTE     = CURRENT DATE                     18980000
189900             ,LAST_UPD_TME     = CURRENT TIME                     18990000
190000             ,LAST_UPD_UID     = :TR069-USER-ID                   19000000
190100       WHERE  VEH_NBR          = :PV-VEH-NBR                      19010000
190200         AND  OWNER_SCAC_ID    = :PV-OWNER-SCAC-ID                19020000
190300         AND  TRIP_ID          = :PV-TRIP-ID                      19030000
190400     END-EXEC.                                                    19040000
190500                                                                  19050000
190600     EVALUATE TRUE                                                19060000
190700         WHEN SQLCODE = +0                                        19070000
190800             MOVE PV-VEH-NBR       TO DK-VEH-NBR                  19080000
190900             MOVE PV-OWNER-SCAC-ID TO DK-OWNER-SCAC-ID            19090000
191000             MOVE PV-TRIP-ID       TO DK-TRIP-ID                  19100000
191100         WHEN OTHER                                               19110000
191200             MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER  19120000
191300*            A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK      19130000
191400             MOVE SQLCODE                    TO PV-SQLCODE        19140000
191500             MOVE '2900-UPDATE-TVHTRIP'      TO PV-PARA-NAME      19150000
191600             MOVE TR069-DC-NBR          TO PV-DISPLAY-DC          19160000
191700             STRING 'UPDATE TVEHICL FAILED WITH SQL '             19170000
191800                   PV-SQLCODE                                     19180000
191900                 ' TLR ' TR069-TRAILER-ID                         19190000
192000                 ' SCAC ' TR069-TRLR-SCAC-CDE                     19200000
192100                 ' ' PV-DISPLAY-DC                                19210000
192200                 ' ' TR069-USER-ID                                19220000
192300                  DELIMITED BY SIZE INTO  PV-ERROR-MSG            19230000
192400             PERFORM 9500-CSSL-LOG                                19240000
192500             PERFORM 9800-ROLLBACK                                19250000
192600             PERFORM 9900-RETURN-TRAN                             19260000
192700     END-EVALUATE.                                                19270000
192800                                                                  19280000
192900***************************************************************** 19290000
193000* SHIPMENT PROCESSING                                             19300000
193100***************************************************************** 19310000
193200 3000-SHIPMENT-PROCESSING.                                        19320000
193300     MOVE 'N'                TO PS-SHIPMENT-CURSOR-SW.            19330000
193400     PERFORM 3010-OPEN-SHIPMENT-CSR.                              19340000
193500     PERFORM 3020-FETCH-SHIPMENT-CSR.                             19350000
193600     PERFORM UNTIL PS-NO-MORE-SHIPMENTS                           19360000
193700         MOVE SHIPMT-SHIPT-ID  TO PV-SHIPT-ID                     19370000
193800         PERFORM 3040-SELECT-TSHIPST                              19380000
193900         MOVE PV-TRIP-STATUS-CDE TO SHIPST-SHIPT-STATUS-CDE       19390000
194000         PERFORM 3050-INSERT-TSHIPST                              19400000
194100         PERFORM 3020-FETCH-SHIPMENT-CSR                          19410000
194200     END-PERFORM.                                                 19420000
194300     PERFORM 3030-CLOSE-SHIPMENT-CSR.                             19430000
194400                                                                  19440000
194500                                                                  19450000
194600***************************************************************** 19460000
194700* OPEN THE SHIPMENT CURSOR                                        19470000
194800***************************************************************** 19480000
194900 3010-OPEN-SHIPMENT-CSR.                                          19490000
195000                                                                  19500000
195100     EXEC SQL                                                     19510000
195200          OPEN SHIPMENT-CSR                                       19520000
195300     END-EXEC                                                     19530000
195400                                                                  19540000
195500     EVALUATE TRUE                                                19550000
195600         WHEN SQLCODE = +0                                        19560000
195700              CONTINUE                                            19570000
195800         WHEN OTHER                                               19580000
195900             MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER  19590000
196000*            A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK      19600000
196100             MOVE SQLCODE                    TO PV-SQLCODE        19610000
196200             MOVE '3010-OPEN-SHIPMENT-CSR'   TO PV-PARA-NAME      19620000
196300             MOVE TR069-DC-NBR          TO PV-DISPLAY-DC          19630000
196400             MOVE PV-TRIP-ID            TO PV-TRIP-ID-DIS         19640000
196500             STRING 'SHIPMENT-CSR OPEN FAILED WITH SQL '          19650000
196600                   PV-SQLCODE                                     19660000
196700                 ' TLR ' TR069-TRAILER-ID                         19670000
196800                 ' SCAC ' TR069-TRLR-SCAC-CDE                     19680000
196900                 ' TRIP ' PV-TRIP-ID-DIS                          19690000
197000                 ' ' PV-DISPLAY-DC                                19700000
197100                 ' ' TR069-USER-ID                                19710000
197200                  DELIMITED BY SIZE INTO  PV-ERROR-MSG            19720000
197300             PERFORM 9500-CSSL-LOG                                19730000
197400             PERFORM 9800-ROLLBACK                                19740000
197500             PERFORM 9900-RETURN-TRAN                             19750000
197600     END-EVALUATE.                                                19760000
197700                                                                  19770000
197800******************************************************************19780000
197900*    FETCH A SHIPMENT ROW                                        *19790000
198000******************************************************************19800000
198100 3020-FETCH-SHIPMENT-CSR.                                         19810000
198200                                                                  19820000
198300     EXEC SQL                                                     19830000
198400          FETCH SHIPMENT-CSR                                      19840000
198500          INTO :SHIPMT-SHIPT-ID                                   19850000
198600     END-EXEC                                                     19860000
198700                                                                  19870000
198800     EVALUATE TRUE                                                19880000
198900         WHEN SQLCODE = +0                                        19890000
199000             MOVE SHIPMT-SHIPT-ID TO PV-SHIPT-ID                  19900000
199100                                                                  19910000
199200         WHEN SQLCODE = +100                                      19920000
199300              SET PS-NO-MORE-SHIPMENTS TO TRUE                    19930000
199400                                                                  19940000
199500         WHEN OTHER                                               19950000
199600             MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER  19960000
199700*            A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK      19970000
199800             MOVE SQLCODE                    TO PV-SQLCODE        19980000
199900             MOVE '3020-FETCH-SHIPMENT-CSR'  TO PV-PARA-NAME      19990000
200000             MOVE TR069-DC-NBR          TO PV-DISPLAY-DC          20000000
200100             MOVE PV-TRIP-ID            TO PV-TRIP-ID-DIS         20010000
200200             STRING 'SHIPMENT-CSR FETCH FAILED WITH SQL '         20020000
200300                   PV-SQLCODE                                     20030000
200400                 ' TLR ' TR069-TRAILER-ID                         20040000
200500                 ' SCAC ' TR069-TRLR-SCAC-CDE                     20050000
200600                 ' DC ' PV-DISPLAY-DC                             20060000
200700                 ' TRIP ' PV-TRIP-ID-DIS                          20070000
200800                 ' ' PV-DISPLAY-DC                                20080000
200900                 ' ' TR069-USER-ID                                20090000
201000                  DELIMITED BY SIZE INTO  PV-ERROR-MSG            20100000
201100             PERFORM 9500-CSSL-LOG                                20110000
201200             PERFORM 9800-ROLLBACK                                20120000
201300             PERFORM 9900-RETURN-TRAN                             20130000
201400     END-EVALUATE.                                                20140000
201500                                                                  20150000
201600******************************************************************20160000
201700* CLOSE THE SHIPMENT CURSOR                                      *20170000
201800******************************************************************20180000
201900 3030-CLOSE-SHIPMENT-CSR.                                         20190000
202000                                                                  20200000
202100     EXEC SQL                                                     20210000
202200          CLOSE SHIPMENT-CSR                                      20220000
202300     END-EXEC                                                     20230000
202400                                                                  20240000
202500     EVALUATE TRUE                                                20250000
202600         WHEN SQLCODE = +0                                        20260000
202700              CONTINUE                                            20270000
202800         WHEN SQLWARN0 NOT = SPACE                                20280000
202900         WHEN SQLCODE  NOT = +0                                   20290000
203000             MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER  20300000
203100*            A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK      20310000
203200             MOVE SQLCODE                    TO PV-SQLCODE        20320000
203300             MOVE '3030-CLOSE-SHIPMENT-CSR'  TO PV-PARA-NAME      20330000
203400             MOVE TR069-DC-NBR          TO PV-DISPLAY-DC          20340000
203500             MOVE PV-TRIP-ID            TO PV-TRIP-ID-DIS         20350000
203600             STRING 'SHIPMENT-CSR CLOSE FAILED WITH SQL '         20360000
203700                   PV-SQLCODE                                     20370000
203800                 ' TLR ' TR069-TRAILER-ID                         20380000
203900                 ' SCAC ' TR069-TRLR-SCAC-CDE                     20390000
204000                 ' TRIP ' PV-TRIP-ID-DIS                          20400000
204100                 ' ' PV-DISPLAY-DC                                20410000
204200                 ' ' TR069-USER-ID                                20420000
204300                  DELIMITED BY SIZE INTO  PV-ERROR-MSG            20430000
204400             PERFORM 9500-CSSL-LOG                                20440000
204500             PERFORM 9800-ROLLBACK                                20450000
204600             PERFORM 9900-RETURN-TRAN                             20460000
204700     END-EVALUATE.                                                20470000
204800                                                                  20480000
204900******************************************************************20490000
205000*  SELECT LATEST SHIPMENT STATUS ROW                             *20500000
205100******************************************************************20510000
205200 3040-SELECT-TSHIPST.                                             20520000
205300                                                                  20530000
205400     EXEC SQL                                                     20540000
205500         SELECT  A.SHIPT_ID                                       20550000
205600                ,A.SHIPT_STATUS_CDE                               20560000
205700                ,A.STATUS_DTE                                     20570000
205800                ,A.STATUS_TME                                     20580000
205900                ,A.STATUS_UID                                     20590000
206000                ,A.DELAY_RSN_CDE                                  20600000
206100                ,A.CARR_STATUS_CDE                                20610000
206200                ,A.TIME_ZONE_CDE                                  20620000
206300                ,A.CITY_NAME                                      20630000
206400                ,A.STATE_CDE                                      20640000
206500         INTO    :SHIPST-SHIPT-ID                                 20650000
206600                ,:SHIPST-SHIPT-STATUS-CDE                         20660000
206700                ,:SHIPST-STATUS-DTE                               20670000
206800                ,:SHIPST-STATUS-TME                               20680000
206900                ,:SHIPST-STATUS-UID                               20690000
207000                ,:SHIPST-DELAY-RSN-CDE                            20700000
207100                ,:SHIPST-CARR-STATUS-CDE                          20710000
207200                ,:SHIPST-TIME-ZONE-CDE                            20720000
207300                ,:SHIPST-CITY-NAME                                20730000
207400                ,:SHIPST-STATE-CDE                                20740000
207500       FROM   TSHIPST A                                           20750000
207600             ,TSHSTYP B                                           20760000
207700       WHERE  A.SHIPT_ID = :PV-SHIPT-ID                           20770000
207800         AND  B.PRTY_CDE =                                        20780000
207900              (SELECT MAX(D.PRTY_CDE)                             20790000
208000                 FROM TSHIPST C                                   20800000
208100                     ,TSHSTYP D                                   20810000
208200                WHERE C.SHIPT_ID         = A.SHIPT_ID             20820000
208300                  AND C.SHIPT_STATUS_CDE = D.SHIPT_STATUS_CDE)    20830000
208400         AND  A.SHIPT_STATUS_CDE = B.SHIPT_STATUS_CDE             20840000
208500     END-EXEC.                                                    20850000
208600                                                                  20860000
208700     EVALUATE TRUE                                                20870000
208800         WHEN SQLCODE = +0                                        20880000
208900             CONTINUE                                             20890000
209000                                                                  20900000
209100         WHEN OTHER                                               20910000
209200             MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER  20920000
209300*            A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK      20930000
209400             MOVE SQLCODE                    TO PV-SQLCODE        20940000
209500             MOVE '3040-SELECT-TSHIPST'      TO PV-PARA-NAME      20950000
209600             MOVE TR069-DC-NBR          TO PV-DISPLAY-DC          20960000
209700             MOVE PV-SHIPT-ID           TO PV-SHIPT-ID-DIS        20970000
209800             STRING 'TSHIPST READ FAILED - SQL '                  20980000
209900                   PV-SQLCODE                                     20990000
210000                 ' TLR ' TR069-TRAILER-ID                         21000000
210100                 ' SCAC ' TR069-TRLR-SCAC-CDE                     21010000
210200                 ' SHIP ' PV-SHIPT-ID-DIS                         21020000
210300                 ' ' PV-DISPLAY-DC                                21030000
210400                 ' ' TR069-USER-ID                                21040000
210500                  DELIMITED BY SIZE INTO  PV-ERROR-MSG            21050000
210600             PERFORM 9500-CSSL-LOG                                21060000
210700             PERFORM 9800-ROLLBACK                                21070000
210800             PERFORM 9900-RETURN-TRAN                             21080000
210900     END-EVALUATE.                                                21090000
211000                                                                  21100000
211100*----------------------------------------------------------------*21110000
211200*  INSERT A SHIPMENT STATUS ROW                                  *21120000
211300*----------------------------------------------------------------*21130000
211400 3050-INSERT-TSHIPST.                                             21140000
211500                                                                  21150000
211600     IF PV-DB2-HOST-DATE = SPACES OR                              21160000
211700        PV-DB2-HOST-TIME = SPACES                                 21170000
211800         EXEC SQL                                                 21180000
211900             SET :PV-DB2-HOST-DATE      = CURRENT DATE            21190000
212000         END-EXEC                                                 21200000
212100                                                                  21210000
212200         EXEC SQL                                                 21220000
212300             SET :PV-DB2-HOST-TIME      = CURRENT TIME            21230000
212400         END-EXEC                                                 21240000
212500     END-IF.                                                      21250000
212600                                                                  21260000
212700     EXEC SQL                                                     21270000
212800         INSERT  INTO TSHIPST                                     21280000
212900                (SHIPT_ID                                         21290000
213000                ,SHIPT_STATUS_CDE                                 21300000
213100                ,STATUS_DTE                                       21310000
213200                ,STATUS_TME                                       21320000
213300                ,STATUS_UID                                       21330000
213400                ,DELAY_RSN_CDE                                    21340000
213500                ,CARR_STATUS_CDE                                  21350000
213600                ,TIME_ZONE_CDE                                    21360000
213700                ,CITY_NAME                                        21370000
213800                ,STATE_CDE )                                      21380000
213900        VALUES  (:SHIPST-SHIPT-ID                                 21390000
214000                ,:SHIPST-SHIPT-STATUS-CDE                         21400000
214100                ,:PV-DB2-HOST-DATE                                21410000
214200                ,:PV-DB2-HOST-TIME                                21420000
214300                ,:TR069-USER-ID                                   21430000
214400                ,:SHIPST-DELAY-RSN-CDE                            21440000
214500                ,:SHIPST-CARR-STATUS-CDE                          21450000
214600                ,:SHIPST-TIME-ZONE-CDE                            21460000
214700                ,:SHIPST-CITY-NAME                                21470000
214800                ,:SHIPST-STATE-CDE )                              21480000
214900     END-EXEC                                                     21490000
215000                                                                  21500000
215100     EVALUATE TRUE                                                21510000
215200         WHEN SQLCODE = +0                                        21520000
215300             CONTINUE                                             21530000
215400                                                                  21540000
215500         WHEN OTHER                                               21550000
215600             MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER  21560000
215700*            A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK      21570000
215800             MOVE SQLCODE                    TO PV-SQLCODE        21580000
215900             MOVE '3050-INSERT-TSHIPST'      TO PV-PARA-NAME      21590000
216000             MOVE TR069-DC-NBR          TO PV-DISPLAY-DC          21600000
216100             MOVE PV-SHIPT-ID           TO PV-SHIPT-ID-DIS        21610000
216200             STRING 'TSHIPST INSERT FAILED - SQL '                21620000
216300                   PV-SQLCODE                                     21630000
216400                 ' TLR ' TR069-TRAILER-ID                         21640000
216500                 ' SCAC ' TR069-TRLR-SCAC-CDE                     21650000
216600                 ' SHIP ' PV-SHIPT-ID-DIS                         21660000
216700                 ' ' PV-DISPLAY-DC                                21670000
216800                 ' ' TR069-USER-ID                                21680000
216900                  DELIMITED BY SIZE INTO  PV-ERROR-MSG            21690000
217000             PERFORM 9500-CSSL-LOG                                21700000
217100             PERFORM 9800-ROLLBACK                                21710000
217200             PERFORM 9900-RETURN-TRAN                             21720000
217300     END-EVALUATE.                                                21730000
217400                                                                  21740000
217500                                                                  21750011
217510*----------------------------------------------------------------*21751011
217600* 5000- series of paragraphs added in May of 2018 to add a       *21760000
217700* trailer and trip id if the scac and trailer passed are         *21770000
217800* not found.  COPIED FROM RCKCS224.                              *21780000
217900*----------------------------------------------------------------*21790000
218000* ADD A VEHICLE                                                  *21800000
218100*----------------------------------------------------------------*21810000
218200 5000-ADD-VEHICLE.                                                21820000
218300     INITIALIZE DCLTVEHICL                                        21830000
218400                DCLTVHTRIP                                        21840000
218500                DCLTTRIPST.                                       21850000
218600                                                                  21860000
218700     SET  PS-CREATE-TRAILER-ID-YES TO TRUE                        21870000
218800     MOVE TR069-TRLR-SCAC-CDE      TO DK-OWNER-SCAC-ID.           21880000
218900     MOVE TR069-TRAILER-ID         TO DK-VEH-NBR.                 21890000
219000     MOVE TR069-DC-NBR             TO DK-OPER-UNT-ID.             21900000
219100                                                                  21910000
219200     MOVE 'CE'                     TO VEHICL-CRT-SRC-CDE          21920000
219300                                      VHTRIP-CRT-SRC-CDE.         21930000
219400     MOVE 'RCV'                    TO VEHICL-USAGE-CDE.           21940000
219500     MOVE 'TR'                     TO VEHICL-VEH-TYP-CDE.         21950000
219600     MOVE 'EN'                     TO VEHICL-CURR-STATUS-CDE      21960000
219700                                      TRIPST-TRIP-STATUS-CDE      21970000
219800                                      PV-TRIP-STATUS-CDE.         21980000
219900     MOVE TR069-DC-NBR             TO VEHICL-CURR-OPER-UNT-ID     21990000
220000                                      TRIPST-OPER-UNT-ID.         22000000
220100     MOVE 1                        TO VEHICL-CURR-FCLTY-ID        22010000
220200                                      TRIPST-FCLTY-ID             22020000
220300                                      DK-FCLTY-ID.                22030000
220400     MOVE SPACES                   TO VEHICL-CURR-FAC-AREA-ID     22040000
220500                                      VEHICL-VEH-SIZE-CDE.        22050000
220600                                                                  22060000
220700     EXEC SQL                                                     22070000
220800         SET :PV-DB2-HOST-DATE      = CURRENT DATE                22080000
220900     END-EXEC.                                                    22090000
221000                                                                  22100000
221100     MOVE PV-DB2-HOST-DATE(1:4)    TO PV-DFLT-MAN-CCYY.           22110000
221200     MOVE PV-DB2-HOST-DATE(6:2)    TO PV-DFLT-MAN-MM.             22120000
221300     MOVE PV-DB2-HOST-DATE(9:2)    TO PV-DFLT-MAN-DD.             22130000
221400     MOVE PV-DEFAULT-MANIFEST      TO VHTRIP-MANIFEST-NBR.        22140000
221500                                                                  22150000
221600     PERFORM 5050-GET-RANDOM-NUMBER                               22160000
221700         WITH TEST AFTER                                          22170000
221800         UNTIL PV-VHTRIP-COUNT = 0.                               22180000
221900                                                                  22190000
222000     MOVE PV-CURR-TRIP-ID         TO VEHICL-CURR-TRIP-ID          22200000
222100                                     VHTRIP-TRIP-ID               22210000
222200                                     VHTRIP-REF-TRIP-ID           22220000
222300                                     TRIPST-TRIP-ID               22230000
222400                                     PV-TRIP-ID.                  22240000
222500     MOVE +1                      TO DN-EST-AR-TMST.              22250000
222600     IF PS-END-TRIP-FOUND-YES                                     22260000
222700        PERFORM 2800-UPDATE-TVEHICL                               22270000
222800        PERFORM 2850-AUDIT-TVEHICL                                22280000
222900     ELSE                                                         22290000
223000        PERFORM 5100-INSERT-TVEHICL                               22300000
223100        PERFORM 5500-AUDIT-TVEHICL                                22310000
223200     END-IF                                                       22320000
223300                                                                  22330000
223400     MOVE +1                  TO DN-VEH-NBR.                      22340000
223500     PERFORM 5300-INSERT-TVHTRIP.                                 22350000
223600     MOVE VHTRIP-TRIP-ID      TO DK-TRIP-ID.                      22360000
223700     PERFORM 5600-AUDIT-TVHTRIP.                                  22370000
223800     PERFORM 5400-INSERT-TTRIPST.                                 22380000
223900     PERFORM 5700-UP-VEH-INFO.                                    22390000
224000                                                                  22400000
224100                                                                  22410000
224200*----------------------------------------------------------------*22420000
224300*  GET A RANDOM NUMBER FROM THE RANDOM NUMBER GENERATOR          *22430000
224400*----------------------------------------------------------------*22440000
224500 5050-GET-RANDOM-NUMBER.                                          22450000
224600     INITIALIZE DP902-RANDNBR-ROUTINE-FIELDS.                     22460000
224700                                                                  22470000
224800     CALL PC-RANDNBR-PGM USING DFHEIBLK                           22480000
224900                               DFHCOMMAREA                        22490000
225000                               DP902-RANDNBR-ROUTINE-FIELDS.      22500000
225100                                                                  22510000
225200     IF  DP902-SUCCESSFUL                                         22520000
225300         MOVE DP902-RANDOM-NUMBER      TO PV-CURR-TRIP-ID         22530000
225400         MOVE +1                       TO DN-CURR-TRIP-ID         22540000
225500     ELSE                                                         22550000
225600         MOVE PC-TSYMSG-01570          TO PV-TSYMSG-NUMBER        22560000
225700*        A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK          22570000
225800         MOVE SQLCODE                  TO PV-SQLCODE              22580000
225900         MOVE '5050-GET-RANDOM-NUMBER' TO PV-PARA-NAME            22590000
226000         MOVE TR069-DC-NBR             TO PV-DISPLAY-DC           22600000
226100         STRING ' CALL TO DPKUT902 FAILED WITH CODE '             22610000
226200                     DP902-RETURN-CODE                            22620000
226300             ' TLR ' TR069-TRAILER-ID                             22630000
226400             ' SCAC ' TR069-TRLR-SCAC-CDE                         22640000
226500             ' ' PV-DISPLAY-DC                                    22650000
226600             ' ' TR069-USER-ID                                    22660000
226700              DELIMITED BY SIZE INTO  PV-ERROR-MSG                22670000
226800         PERFORM 9500-CSSL-LOG                                    22680000
226900         PERFORM 9800-ROLLBACK                                    22690000
227000         PERFORM 9900-RETURN-TRAN                                 22700000
227100     END-IF.                                                      22710000
227200                                                                  22720000
227300     PERFORM 5070-READ-DUPL-TVHTRIP.                              22730000
227400                                                                  22740000
227500                                                                  22750000
227600*----------------------------------------------------------------*22760000
227700*  GET A RANDOM NUMBER FROM THE RANDOM NUMBER GENERATOR          *22770000
227800*----------------------------------------------------------------*22780000
227900 5070-READ-DUPL-TVHTRIP.                                          22790000
228000                                                                  22800000
228100     EXEC SQL                                                     22810000
228200          SELECT COUNT(*)                                         22820000
228300           INTO :PV-VHTRIP-COUNT                                  22830000
228400            FROM  TVHTRIP                                         22840000
228500           WHERE (TRIP_ID         = :PV-CURR-TRIP-ID)             22850000
228600     END-EXEC                                                     22860000
228700                                                                  22870000
228800     EVALUATE TRUE                                                22880000
228900         WHEN SQLCODE = +0                                        22890000
229000             CONTINUE                                             22900000
229100                                                                  22910000
229200         WHEN OTHER                                               22920000
229300             MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER  22930000
229400*            A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK      22940000
229500             MOVE SQLCODE                    TO PV-SQLCODE        22950000
229600             MOVE '5070-READ-DUPL-TVHTRIP'   TO PV-PARA-NAME      22960000
229700             MOVE TR069-DC-NBR               TO PV-DISPLAY-DC     22970000
229800             MOVE PV-CURR-TRIP-ID            TO PV-TRIP-ID-DIS    22980000
229900             STRING 'GET COUNT OF TVHTRIP TRIPS FAILED - SQL '    22990000
230000                   PV-SQLCODE                                     23000000
230100                 ' TLR ' TR069-TRAILER-ID                         23010000
230200                 ' SCAC ' TR069-TRLR-SCAC-CDE                     23020000
230300                 ' TRIP ' PV-TRIP-ID-DIS                          23030000
230400                 ' ' PV-DISPLAY-DC                                23040000
230500                 ' ' TR069-USER-ID                                23050000
230600                  DELIMITED BY SIZE INTO  PV-ERROR-MSG            23060000
230700             PERFORM 9500-CSSL-LOG                                23070000
230800             PERFORM 9800-ROLLBACK                                23080000
230900             PERFORM 9900-RETURN-TRAN                             23090000
231000     END-EVALUATE.                                                23100000
231100                                                                  23110000
231200                                                                  23120000
231300*----------------------------------------------------------------*23130000
231400*  INSERT A ROW ON THE VEHICLE TABLE                             *23140000
231500*----------------------------------------------------------------*23150000
231600 5100-INSERT-TVEHICL.                                             23160000
231700                                                                  23170000
231800     EXEC SQL                                                     23180000
231900         INSERT  INTO TVEHICL                                     23190000
232000                (OWNER_SCAC_ID                                    23200000
232100                ,VEH_NBR                                          23210000
232200                ,CRT_SRC_CDE                                      23220000
232300                ,LAST_UPD_DTE                                     23230000
232400                ,LAST_UPD_TME                                     23240000
232500                ,LAST_UPD_UID                                     23250000
232600                ,USAGE_CDE                                        23260000
232700                ,VEH_TYP_CDE                                      23270000
232800                ,CURR_STATUS_CDE                                  23280000
232900                ,CURR_STATUS_DTE                                  23290000
233000                ,CURR_STATUS_TME                                  23300000
233100                ,CURR_OPER_UNT_ID                                 23310000
233200                ,CURR_FCLTY_ID                                    23320000
233300                ,CURR_FAC_AREA_ID                                 23330000
233400                ,CURR_LOC_DTE                                     23340000
233500                ,CURR_LOC_TME                                     23350000
233600                ,CURR_TRIP_ID                                     23360000
233700                ,VEH_SIZE_CDE)                                    23370000
233800        VALUES  (:DK-OWNER-SCAC-ID                                23380000
233900                ,:DK-VEH-NBR                                      23390000
234000                ,:VEHICL-CRT-SRC-CDE                              23400000
234100                ,CURRENT DATE                                     23410000
234200                ,CURRENT TIME                                     23420000
234300                ,:TR069-USER-ID                                   23430000
234400                ,:VEHICL-USAGE-CDE                                23440000
234500                ,:VEHICL-VEH-TYP-CDE                              23450000
234600                ,:VEHICL-CURR-STATUS-CDE                          23460000
234700                ,CURRENT DATE                                     23470000
234800                ,CURRENT TIME                                     23480000
234900                ,:DK-OPER-UNT-ID                                  23490000
235000                ,:DK-FCLTY-ID                                     23500000
235100                ,:VEHICL-CURR-FAC-AREA-ID                         23510000
235200                ,CURRENT DATE                                     23520000
235300                ,CURRENT TIME                                     23530000
235400                ,:VEHICL-CURR-TRIP-ID                             23540000
235500                   :DN-CURR-TRIP-ID                               23550000
235600                ,:VEHICL-VEH-SIZE-CDE)                            23560000
235700     END-EXEC                                                     23570000
235800                                                                  23580000
235900     EVALUATE TRUE                                                23590000
236000         WHEN SQLCODE = +0                                        23600000
236100             CONTINUE                                             23610000
236200                                                                  23620000
236300         WHEN OTHER                                               23630000
236400             IF SQLCODE = -803                                    23640000
236500                 MOVE PC-TSYMSG-01020        TO PV-TSYMSG-NUMBER  23650000
236600*                TRAILER ALREADY EXISTS                           23660000
236700             ELSE                                                 23670000
236800                 MOVE PC-TSYMSG-01570        TO PV-TSYMSG-NUMBER  23680000
236900*                A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK  23690000
237000             END-IF                                               23700000
237100             MOVE SQLCODE                    TO PV-SQLCODE        23710000
237200             MOVE '5100-INSERT-TVEHICL'      TO PV-PARA-NAME      23720000
237300             MOVE TR069-DC-NBR               TO PV-DISPLAY-DC     23730000
237400             MOVE PV-CURR-TRIP-ID            TO PV-TRIP-ID-DIS    23740000
237500             MOVE DK-FCLTY-ID                TO PV-DISP-FCLTY     23750000
237600             STRING 'TVEHICL INSERT FAILED - SQL '                23760000
237700                   PV-SQLCODE                                     23770000
237800                 ' TLR ' TR069-TRAILER-ID                         23780000
237900                 ' SCAC ' TR069-TRLR-SCAC-CDE                     23790000
238000                 ' TRIP ' PV-TRIP-ID-DIS                          23800000
238100                 ' ' PV-DISPLAY-DC                                23810000
238200                 ' ' TR069-USER-ID                                23820000
238300                 ' ' VEHICL-CURR-STATUS-CDE                       23830000
238400                 ' ' PV-DISP-FCLTY                                23840000
238500                  DELIMITED BY SIZE INTO  PV-ERROR-MSG            23850000
238600             PERFORM 9500-CSSL-LOG                                23860000
238700             PERFORM 9800-ROLLBACK                                23870000
238800             PERFORM 9900-RETURN-TRAN                             23880000
238900     END-EVALUATE.                                                23890000
239000                                                                  23900000
239100                                                                  23910000
239200*----------------------------------------------------------------*23920000
239300*  INSERT A ROW ON THE VEHICLE TRIP TABLE                        *23930000
239400*----------------------------------------------------------------*23940000
239500 5300-INSERT-TVHTRIP.                                             23950000
239600                                                                  23960000
239700     EXEC SQL                                                     23970000
239800         INSERT  INTO TVHTRIP                                     23980000
239900                (OWNER_SCAC_ID                                    23990000
240000                ,VEH_NBR                                          24000000
240100                ,TRIP_ID                                          24010000
240200                ,TRIP_BEG_DTE                                     24020000
240300                ,TRIP_BEG_TME                                     24030000
240400                ,CRT_SRC_CDE                                      24040000
240500                ,LAST_UPD_DTE                                     24050000
240600                ,LAST_UPD_TME                                     24060000
240700                ,LAST_UPD_UID                                     24070000
240800                ,MANIFEST_NBR                                     24080000
240900                ,PLND_TRIP_SEQ                                    24090000
241000                ,REF_TRIP_ID                                      24100000
241100                ,EST_AR_TMST                                      24110000
241200                ,SPLT_XMIT_IND                                    24120000
241300                ,SPLT_XMIT_DTE                                    24130000
241400                ,SPLT_XMIT_TM )                                   24140000
241500        VALUES  (:DK-OWNER-SCAC-ID                                24150000
241600                ,:DK-VEH-NBR                                      24160000
241700                   :DN-VEH-NBR                                    24170000
241800                ,:VHTRIP-TRIP-ID                                  24180000
241900                ,CURRENT DATE                                     24190000
242000                ,CURRENT TIME                                     24200000
242100                ,:VHTRIP-CRT-SRC-CDE                              24210000
242200                ,CURRENT DATE                                     24220000
242300                ,CURRENT TIME                                     24230000
242400                ,:TR069-USER-ID                                   24240000
242500                ,:VHTRIP-MANIFEST-NBR                             24250000
242600                ,:VHTRIP-PLND-TRIP-SEQ                            24260000
242700                ,:VHTRIP-REF-TRIP-ID                              24270000
242800                ,CURRENT TIMESTAMP                                24280000
242900                ,:VHTRIP-SPLT-XMIT-IND                            24290000
243000                ,:PC-DEFAULT-DATE                                 24300000
243100                ,:PC-DEFAULT-TIME )                               24310000
243200     END-EXEC                                                     24320000
243300                                                                  24330000
243400     EVALUATE TRUE                                                24340000
243500         WHEN SQLCODE = +0                                        24350000
243600             CONTINUE                                             24360000
243700                                                                  24370000
243800         WHEN OTHER                                               24380000
243900             MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER  24390000
244000*            A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK      24400000
244100             MOVE SQLCODE                    TO PV-SQLCODE        24410000
244200             MOVE '5300-INSERT-TVHTRIP'      TO PV-PARA-NAME      24420000
244300             MOVE TR069-DC-NBR               TO PV-DISPLAY-DC     24430000
244400             MOVE PV-CURR-TRIP-ID            TO PV-TRIP-ID-DIS    24440000
244500             STRING 'TVHTRIP INSERT FAILED - SQL '                24450000
244600                   PV-SQLCODE                                     24460000
244700                 ' TLR ' TR069-TRAILER-ID                         24470000
244800                 ' SCAC ' TR069-TRLR-SCAC-CDE                     24480000
244900                 ' TRIP ' PV-TRIP-ID-DIS                          24490000
245000                 ' ' PV-DISPLAY-DC                                24500000
245100                 ' ' TR069-USER-ID                                24510000
245200                  DELIMITED BY SIZE INTO  PV-ERROR-MSG            24520000
245300             PERFORM 9500-CSSL-LOG                                24530000
245400             PERFORM 9800-ROLLBACK                                24540000
245500             PERFORM 9900-RETURN-TRAN                             24550000
245600     END-EVALUATE.                                                24560000
245700                                                                  24570000
245800*----------------------------------------------------------------*24580000
245900*  INSERT A ROW ON THE VEHICLE TRIP STATUS TABLE                 *24590000
246000*----------------------------------------------------------------*24600000
246100 5400-INSERT-TTRIPST.                                             24610000
246200                                                                  24620000
246300     EXEC SQL                                                     24630000
246400         INSERT  INTO TTRIPST                                     24640000
246500                (TRIP_ID                                          24650000
246600                ,TRIP_STATUS_CDE                                  24660000
246700                ,STATUS_DTE                                       24670000
246800                ,STATUS_TME                                       24680000
246900                ,STATUS_UID                                       24690000
247000                ,OPER_UNT_ID                                      24700000
247100                ,FCLTY_ID                                         24710000
247200                ,FCLTY_AREA_ID)                                   24720000
247300        VALUES  (:TRIPST-TRIP-ID                                  24730000
247400                ,:TRIPST-TRIP-STATUS-CDE                          24740000
247500                ,CURRENT DATE                                     24750000
247600                ,CURRENT TIME                                     24760000
247700                ,:TR069-USER-ID                                   24770000
247800                ,:TRIPST-OPER-UNT-ID                              24780000
247900                ,:TRIPST-FCLTY-ID                                 24790000
248000                ,:TRIPST-FCLTY-AREA-ID)                           24800000
248100     END-EXEC                                                     24810000
248200                                                                  24820000
248300     EVALUATE TRUE                                                24830000
248400         WHEN SQLCODE = +0                                        24840000
248500             CONTINUE                                             24850000
248600                                                                  24860000
248700         WHEN OTHER                                               24870000
248800             MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER  24880000
248900*            A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK      24890000
249000             MOVE SQLCODE                    TO PV-SQLCODE        24900000
249100             MOVE '5400-INSERT-TTRIPST'      TO PV-PARA-NAME      24910000
249200             MOVE TR069-DC-NBR               TO PV-DISPLAY-DC     24920000
249300             MOVE PV-CURR-TRIP-ID            TO PV-TRIP-ID-DIS    24930000
249400             STRING 'TTRIPST INSERT FAILED - SQL '                24940000
249500                   PV-SQLCODE                                     24950000
249600                 ' TLR ' TR069-TRAILER-ID                         24960000
249700                 ' SCAC ' TR069-TRLR-SCAC-CDE                     24970000
249800                 ' TRIP ' PV-TRIP-ID-DIS                          24980000
249900                 ' STAT ' TRIPST-TRIP-STATUS-CDE                  24990000
250000                 ' ' PV-DISPLAY-DC                                25000000
250100                 ' ' TR069-USER-ID                                25010000
250200                  DELIMITED BY SIZE INTO  PV-ERROR-MSG            25020000
250300             PERFORM 9500-CSSL-LOG                                25030000
250400             PERFORM 9800-ROLLBACK                                25040000
250500             PERFORM 9900-RETURN-TRAN                             25050000
250600     END-EVALUATE.                                                25060000
250700                                                                  25070000
250800*----------------------------------------------------------------*25080000
250900*  TAKE A SNAPSHOT OF THE AFTER  IMAGE OF TVEHICL AND WRITE      *25090000
251000*  TO THE AUDIT TABLE.                                           *25100000
251100*----------------------------------------------------------------*25110000
251200 5500-AUDIT-TVEHICL.                                              25120000
251300                                                                  25130000
251400     INITIALIZE DCLTAUVHCL.                                       25140000
251500                                                                  25150000
251600     EXEC SQL                                                     25160000
251700         SELECT  A.OWNER_SCAC_ID                                  25170000
251800                ,A.VEH_NBR                                        25180000
251900                ,A.CRT_SRC_CDE                                    25190000
252000                ,A.LAST_UPD_DTE                                   25200000
252100                ,A.LAST_UPD_TME                                   25210000
252200                ,A.LAST_UPD_UID                                   25220000
252300                ,A.USAGE_CDE                                      25230000
252400                ,A.VEH_TYP_CDE                                    25240000
252500                ,A.CURR_STATUS_CDE                                25250000
252600                ,A.CURR_STATUS_DTE                                25260000
252700                ,A.CURR_STATUS_TME                                25270000
252800                ,A.CURR_OPER_UNT_ID                               25280000
252900                ,A.CURR_FCLTY_ID                                  25290000
253000                ,A.CURR_FAC_AREA_ID                               25300000
253100                ,A.CURR_LOC_DTE                                   25310000
253200                ,A.CURR_LOC_TME                                   25320000
253300                ,A.CURR_TRIP_ID                                   25330000
253400                ,A.VEH_SIZE_CDE                                   25340000
253500        INTO     :VEHICL-OWNER-SCAC-ID                            25350000
253600                ,:VEHICL-VEH-NBR                                  25360000
253700                ,:VEHICL-CRT-SRC-CDE                              25370000
253800                ,:VEHICL-LAST-UPD-DTE                             25380000
253900                ,:VEHICL-LAST-UPD-TME                             25390000
254000                ,:VEHICL-LAST-UPD-UID                             25400000
254100                ,:VEHICL-USAGE-CDE                                25410000
254200                ,:VEHICL-VEH-TYP-CDE                              25420000
254300                ,:VEHICL-CURR-STATUS-CDE                          25430000
254400                ,:VEHICL-CURR-STATUS-DTE                          25440000
254500                ,:VEHICL-CURR-STATUS-TME                          25450000
254600                ,:VEHICL-CURR-OPER-UNT-ID                         25460000
254700                ,:VEHICL-CURR-FCLTY-ID                            25470000
254800                ,:VEHICL-CURR-FAC-AREA-ID                         25480000
254900                ,:VEHICL-CURR-LOC-DTE                             25490000
255000                ,:VEHICL-CURR-LOC-TME                             25500000
255100                ,:VEHICL-CURR-TRIP-ID                             25510000
255200                   :DN-CURR-TRIP-ID                               25520000
255300                ,:VEHICL-VEH-SIZE-CDE                             25530000
255400       FROM   TVEHICL A                                           25540000
255500       WHERE  A.VEH_NBR       = :DK-VEH-NBR                       25550000
255600         AND  A.OWNER_SCAC_ID = :DK-OWNER-SCAC-ID                 25560000
255700     END-EXEC                                                     25570000
255800                                                                  25580000
255900     EVALUATE TRUE                                                25590000
256000         WHEN SQLCODE = +0                                        25600000
256100             CONTINUE                                             25610000
256200                                                                  25620000
256300         WHEN OTHER                                               25630000
256400             MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER  25640000
256500*            A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK      25650000
256600             MOVE SQLCODE                    TO PV-SQLCODE        25660000
256700             MOVE '5500-AUDIT-TVEHICL'       TO PV-PARA-NAME      25670000
256800             MOVE TR069-DC-NBR               TO PV-DISPLAY-DC     25680000
256900             STRING 'TVEHICL SELECT FAILED - SQL '                25690000
257000                   PV-SQLCODE                                     25700000
257100                 ' TLR ' TR069-TRAILER-ID                         25710000
257200                 ' SCAC ' TR069-TRLR-SCAC-CDE                     25720000
257300                 ' ' PV-DISPLAY-DC                                25730000
257400                 ' ' TR069-USER-ID                                25740000
257500                  DELIMITED BY SIZE INTO  PV-ERROR-MSG            25750000
257600             PERFORM 9500-CSSL-LOG                                25760000
257700             PERFORM 9800-ROLLBACK                                25770000
257800             PERFORM 9900-RETURN-TRAN                             25780000
257900     END-EVALUATE.                                                25790000
258000                                                                  25800000
258100     EXEC SQL                                                     25810000
258200         INSERT  INTO TAUVHCL                                     25820000
258300                (OWNER_SCAC_ID                                    25830000
258400                ,VEH_NBR                                          25840000
258500                ,CRT_SRC_CDE                                      25850000
258600                ,LAST_UPD_DTE                                     25860000
258700                ,LAST_UPD_TME                                     25870000
258800                ,LAST_UPD_UID                                     25880000
258900                ,USAGE_CDE                                        25890000
259000                ,VEH_TYP_CDE                                      25900000
259100                ,CURR_STATUS_CDE                                  25910000
259200                ,CURR_STATUS_DTE                                  25920000
259300                ,CURR_STATUS_TME                                  25930000
259400                ,CURR_OPER_UNT_ID                                 25940000
259500                ,CURR_FCLTY_ID                                    25950000
259600                ,CURR_FAC_AREA_ID                                 25960000
259700                ,CURR_LOC_DTE                                     25970000
259800                ,CURR_LOC_TME                                     25980000
259900                ,CURR_TRIP_ID                                     25990000
260000                ,VEH_SIZE_CDE)                                    26000000
260100        VALUES  (:VEHICL-OWNER-SCAC-ID                            26010000
260200                ,:VEHICL-VEH-NBR                                  26020000
260300                ,:VEHICL-CRT-SRC-CDE                              26030000
260400                ,:VEHICL-LAST-UPD-DTE                             26040000
260500                ,:VEHICL-LAST-UPD-TME                             26050000
260600                ,:VEHICL-LAST-UPD-UID                             26060000
260700                ,:VEHICL-USAGE-CDE                                26070000
260800                ,:VEHICL-VEH-TYP-CDE                              26080000
260900                ,:VEHICL-CURR-STATUS-CDE                          26090000
261000                ,:VEHICL-CURR-STATUS-DTE                          26100000
261100                ,:VEHICL-CURR-STATUS-TME                          26110000
261200                ,:VEHICL-CURR-OPER-UNT-ID                         26120000
261300                ,:VEHICL-CURR-FCLTY-ID                            26130000
261400                ,:VEHICL-CURR-FAC-AREA-ID                         26140000
261500                ,:VEHICL-CURR-LOC-DTE                             26150000
261600                ,:VEHICL-CURR-LOC-TME                             26160000
261700                ,:VEHICL-CURR-TRIP-ID                             26170000
261800                   :DN-CURR-TRIP-ID                               26180000
261900                ,:VEHICL-VEH-SIZE-CDE)                            26190000
262000     END-EXEC                                                     26200000
262100                                                                  26210000
262200     EVALUATE TRUE                                                26220000
262300         WHEN SQLCODE = +0                                        26230000
262400             CONTINUE                                             26240000
262500                                                                  26250000
262600         WHEN OTHER                                               26260000
262700             MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER  26270000
262800*            A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK      26280000
262900             MOVE SQLCODE                    TO PV-SQLCODE        26290000
263000             MOVE '5500-AUDIT-TVEHICL'       TO PV-PARA-NAME      26300000
263100             MOVE TR069-DC-NBR               TO PV-DISPLAY-DC     26310000
263200             STRING 'TAUVHCL INSERT FAILED - SQL '                26320000
263300                   PV-SQLCODE                                     26330000
263400                 ' TLR ' TR069-TRAILER-ID                         26340000
263500                 ' SCAC ' TR069-TRLR-SCAC-CDE                     26350000
263600                 ' ' PV-DISPLAY-DC                                26360000
263700                 ' ' TR069-USER-ID                                26370000
263800                  DELIMITED BY SIZE INTO  PV-ERROR-MSG            26380000
263900             PERFORM 9500-CSSL-LOG                                26390000
264000             PERFORM 9800-ROLLBACK                                26400000
264100             PERFORM 9900-RETURN-TRAN                             26410000
264200     END-EVALUATE.                                                26420000
264300                                                                  26430000
264400                                                                  26440000
264500*----------------------------------------------------------------*26450000
264600*  TAKE A SNAPSHOT OF THE AFTER  IMAGE OF TVHTRIP AND WRITE      *26460000
264700*  TO THE AUDIT TABLE.                                           *26470000
264800*----------------------------------------------------------------*26480000
264900 5600-AUDIT-TVHTRIP.                                              26490000
265000                                                                  26500000
265100     INITIALIZE DCLTAUTRIP.                                       26510000
265200                                                                  26520000
265300     EXEC SQL                                                     26530000
265400         SELECT  OWNER_SCAC_ID                                    26540000
265500                ,VEH_NBR                                          26550000
265600                ,TRIP_ID                                          26560000
265700                ,TRIP_BEG_DTE                                     26570000
265800                ,TRIP_BEG_TME                                     26580000
265900                ,CRT_SRC_CDE                                      26590000
266000                ,LAST_UPD_DTE                                     26600000
266100                ,LAST_UPD_TME                                     26610000
266200                ,LAST_UPD_UID                                     26620000
266300                ,MANIFEST_NBR                                     26630000
266400                ,PLND_TRIP_SEQ                                    26640000
266500                ,PLND_ACTVY_CDE                                   26650000
266600                ,OWNR_SCAC_SHIP_DTE                               26660000
266700                ,REF_TRIP_ID                                      26670000
266800                ,EST_AR_TMST                                      26680000
266900                ,SPLT_XMIT_IND                                    26690000
267000                ,SPLT_XMIT_DTE                                    26700000
267100                ,SPLT_XMIT_TM                                     26710000
267200        INTO     :VHTRIP-OWNER-SCAC-ID                            26720000
267300                ,:VHTRIP-VEH-NBR                                  26730000
267400                   :DN-VEH-NBR                                    26740000
267500                ,:VHTRIP-TRIP-ID                                  26750000
267600                ,:VHTRIP-TRIP-BEG-DTE                             26760000
267700                ,:VHTRIP-TRIP-BEG-TME                             26770000
267800                ,:VHTRIP-CRT-SRC-CDE                              26780000
267900                ,:VHTRIP-LAST-UPD-DTE                             26790000
268000                ,:VHTRIP-LAST-UPD-TME                             26800000
268100                ,:VHTRIP-LAST-UPD-UID                             26810000
268200                ,:VHTRIP-MANIFEST-NBR                             26820000
268300                ,:VHTRIP-PLND-TRIP-SEQ                            26830000
268400                ,:VHTRIP-PLND-ACTVY-CDE                           26840000
268500                ,:VHTRIP-OWNR-SCAC-SHIP-DTE                       26850000
268600                ,:VHTRIP-REF-TRIP-ID                              26860000
268700                ,:VHTRIP-EST-AR-TMST                              26870000
268800                       :DN-EST-AR-TMST                            26880000
268900                ,:VHTRIP-SPLT-XMIT-IND                            26890000
269000                ,:VHTRIP-SPLT-XMIT-DTE                            26900000
269100                ,:VHTRIP-SPLT-XMIT-TM                             26910000
269200       FROM   TVHTRIP                                             26920000
269300       WHERE  OWNER_SCAC_ID = :DK-OWNER-SCAC-ID                   26930000
269400         AND  VEH_NBR       IS NOT NULL                           26940000
269500         AND  VEH_NBR       = :DK-VEH-NBR                         26950000
269600         AND  TRIP_ID       = :DK-TRIP-ID                         26960000
269700     END-EXEC                                                     26970000
269800                                                                  26980000
269900     EVALUATE TRUE                                                26990000
270000         WHEN SQLCODE = +0                                        27000000
270100             CONTINUE                                             27010000
270200                                                                  27020000
270300         WHEN OTHER                                               27030000
270400             MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER  27040000
270500*            A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK      27050000
270600             MOVE SQLCODE                    TO PV-SQLCODE        27060000
270700             MOVE '5600-AUDIT-TVHTRIP'       TO PV-PARA-NAME      27070000
270800             MOVE TR069-DC-NBR               TO PV-DISPLAY-DC     27080000
270900             MOVE PV-CURR-TRIP-ID            TO PV-TRIP-ID-DIS    27090000
271000             STRING 'TVHTRIP SELECT FAILED - SQL '                27100000
271100                   PV-SQLCODE                                     27110000
271200                 ' TLR ' TR069-TRAILER-ID                         27120000
271300                 ' SCAC ' TR069-TRLR-SCAC-CDE                     27130000
271400                 ' TRIP ' PV-TRIP-ID-DIS                          27140000
271500                 ' ' PV-DISPLAY-DC                                27150000
271600                 ' ' TR069-USER-ID                                27160000
271700                  DELIMITED BY SIZE INTO  PV-ERROR-MSG            27170000
271800             PERFORM 9500-CSSL-LOG                                27180000
271900             PERFORM 9800-ROLLBACK                                27190000
272000             PERFORM 9900-RETURN-TRAN                             27200000
272100     END-EVALUATE.                                                27210000
272200                                                                  27220000
272300     MOVE 'CE'                     TO VHTRIP-CRT-SRC-CDE.         27230000
272400                                                                  27240000
272500     EXEC SQL                                                     27250000
272600         INSERT  INTO TAUTRIP                                     27260000
272700                (OWNER_SCAC_ID                                    27270000
272800                ,VEH_NBR                                          27280000
272900                ,TRIP_ID                                          27290000
273000                ,TRIP_BEG_DTE                                     27300000
273100                ,TRIP_BEG_TME                                     27310000
273200                ,CRT_SRC_CDE                                      27320000
273300                ,LAST_UPD_DTE                                     27330000
273400                ,LAST_UPD_TME                                     27340000
273500                ,LAST_UPD_UID                                     27350000
273600                ,MANIFEST_NBR                                     27360000
273700                ,PLND_TRIP_SEQ                                    27370000
273800                ,PLND_ACTVY_CDE                                   27380000
273900                ,OWNR_SCAC_SHIP_DTE                               27390000
274000                ,REF_TRIP_ID                                      27400000
274100                ,EST_AR_TMST                                      27410000
274200                ,AUD_STATUS_CDE                                   27420000
274300                ,SPLT_XMIT_IND                                    27430000
274400                ,SPLT_XMIT_DTE                                    27440000
274500                ,SPLT_XMIT_TM )                                   27450000
274600        VALUES  (:VHTRIP-OWNER-SCAC-ID                            27460000
274700                ,:VHTRIP-VEH-NBR                                  27470000
274800                   :DN-VEH-NBR                                    27480000
274900                ,:VHTRIP-TRIP-ID                                  27490000
275000                ,:VHTRIP-TRIP-BEG-DTE                             27500000
275100                ,:VHTRIP-TRIP-BEG-TME                             27510000
275200                ,:VHTRIP-CRT-SRC-CDE                              27520000
275300                ,:VHTRIP-LAST-UPD-DTE                             27530000
275400                ,:VHTRIP-LAST-UPD-TME                             27540000
275500                ,:VHTRIP-LAST-UPD-UID                             27550000
275600                ,:VHTRIP-MANIFEST-NBR                             27560000
275700                ,:VHTRIP-PLND-TRIP-SEQ                            27570000
275800                ,:VHTRIP-PLND-ACTVY-CDE                           27580000
275900                ,:VHTRIP-OWNR-SCAC-SHIP-DTE                       27590000
276000                ,:VHTRIP-REF-TRIP-ID                              27600000
276100                ,:VHTRIP-EST-AR-TMST                              27610000
276200                       :DN-EST-AR-TMST                            27620000
276300                ,:TRIPST-TRIP-STATUS-CDE                          27630000
276400                ,:VHTRIP-SPLT-XMIT-IND                            27640000
276500                ,:VHTRIP-SPLT-XMIT-DTE                            27650000
276600                ,:VHTRIP-SPLT-XMIT-TM )                           27660000
276700     END-EXEC                                                     27670000
276800                                                                  27680000
276900     EVALUATE TRUE                                                27690000
277000         WHEN SQLCODE = +0                                        27700000
277100             CONTINUE                                             27710000
277200                                                                  27720000
277300         WHEN OTHER                                               27730000
277400             MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER  27740000
277500*            A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK      27750000
277600             MOVE SQLCODE                    TO PV-SQLCODE        27760000
277700             MOVE '5600-AUDIT-TVHTRIP'       TO PV-PARA-NAME      27770000
277800             MOVE TR069-DC-NBR               TO PV-DISPLAY-DC     27780000
277900             MOVE PV-CURR-TRIP-ID            TO PV-TRIP-ID-DIS    27790000
278000             STRING 'TAUTRIP INSERT FAILED - SQL '                27800000
278100                   PV-SQLCODE                                     27810000
278200                 ' TLR ' TR069-TRAILER-ID                         27820000
278300                 ' SCAC ' TR069-TRLR-SCAC-CDE                     27830000
278400                 ' TRIP ' PV-TRIP-ID-DIS                          27840000
278500                 ' ' PV-DISPLAY-DC                                27850000
278600                 ' ' TR069-USER-ID                                27860000
278700                  DELIMITED BY SIZE INTO  PV-ERROR-MSG            27870000
278800             PERFORM 9500-CSSL-LOG                                27880000
278900             PERFORM 9800-ROLLBACK                                27890000
279000             PERFORM 9900-RETURN-TRAN                             27900000
279100     END-EVALUATE.                                                27910000
279200                                                                  27920000
279300                                                                  27930000
279400*----------------------------------------------------------------*27940000
279500*  UPDATE THE VEHICLE INFO ON THE SUT_TRLR_RPLN_CART TABLE.      *27950000
279600*----------------------------------------------------------------*27960000
279700 5700-UP-VEH-INFO.                                                27970000
279800                                                                  27980000
279900     PERFORM 5710-GET-PARM-DATE.                                  27990000
280000                                                                  28000000
280100     EXEC SQL                                                     28010000
280200       UPDATE SUT_TRLR_RPLN_CART                                  28020000
280300          SET LAST_UPD_TMST    = CURRENT TIMESTAMP                28030000
280400             ,LAST_UPD_USR_ID  = :TR069-USER-ID                   28040000
280500             ,INBND_TRIP_ID    = :PV-CURR-TRIP-ID                 28050000
280600        WHERE  VEH_NBR         = :DK-VEH-NBR                      28060000
280700          AND  OPER_UNT_ID     = :DK-OPER-UNT-ID                  28070000
280800          AND  SCAC_CDE        = :DK-OWNER-SCAC-ID                28080000
280900          AND  INBND_TRIP_ID   = 0                                28090000
281000          AND  DATE(CRE_TMST) >= :PV-SELECT-DATE                  28100000
281100     END-EXEC.                                                    28110000
281200                                                                  28120000
281300     EVALUATE TRUE                                                28130000
281400         WHEN SQLCODE = +0                                        28140000
281500         WHEN SQLCODE = +100                                      28150000
281600             CONTINUE                                             28160000
281700                                                                  28170000
281800         WHEN OTHER                                               28180000
281900             MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER  28190000
282000*            A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK      28200000
282100             MOVE SQLCODE                    TO PV-SQLCODE        28210000
282200             MOVE '5700-UP-VEH-INFO '        TO PV-PARA-NAME      28220000
282300             MOVE TR069-DC-NBR               TO PV-DISPLAY-DC     28230000
282400             MOVE PV-CURR-TRIP-ID            TO PV-TRIP-ID-DIS    28240000
282500             STRING 'UPDATE SUT_TRLR_RPLN_CART FAILED - SQL '     28250000
282600                   PV-SQLCODE                                     28260000
282700                 ' TLR ' TR069-TRAILER-ID                         28270000
282800                 ' SCAC ' TR069-TRLR-SCAC-CDE                     28280000
282900                 ' TRIP ' PV-TRIP-ID-DIS                          28290000
283000                 ' DATE ' PV-SELECT-DATE                          28300000
283100                 ' ' PV-DISPLAY-DC                                28310000
283200                 ' ' TR069-USER-ID                                28320000
283300                  DELIMITED BY SIZE INTO  PV-ERROR-MSG            28330000
283400             PERFORM 9500-CSSL-LOG                                28340000
283500             PERFORM 9800-ROLLBACK                                28350000
283600             PERFORM 9900-RETURN-TRAN                             28360000
283700         END-EVALUATE.                                            28370000
283800                                                                  28380000
283900                                                                  28390000
284000*----------------------------------------------------------------*28400000
284100*  DETERMINE THE START DATE BASED ON THE PARM DAYS IN TKRPRPM.   *28410000
284200*----------------------------------------------------------------*28420000
284300 5710-GET-PARM-DATE.                                              28430000
284400                                                                  28440000
284500      EXEC SQL                                                    28450000
284600         SELECT CURRENT DATE - FUNC_QTY DAYS                      28460000
284700           INTO :PV-SELECT-DATE                                   28470000
284800           FROM TKRPRPM                                           28480000
284900         WHERE LOC_ID             = 90                            28490000
285000            AND INTFC_SYS_CDE     = 'KHL'                         28500000
285100            AND SYS_PRC_FUNC_CDE  = 'PTCASG'                      28510000
285200            AND FUNC_PRC_STAT_CDE = 'AC'                          28520000
285300            WITH UR                                               28530000
285400      END-EXEC.                                                   28540000
285500                                                                  28550000
285600      EVALUATE TRUE                                               28560000
285700          WHEN SQLCODE = 0                                        28570000
285800               CONTINUE                                           28580000
285900                                                                  28590000
286000          WHEN OTHER                                              28600000
286100             MOVE PC-TSYMSG-01570            TO PV-TSYMSG-NUMBER  28610000
286200*            A SYSTEM ERROR HAS OCCURRED - CONTACT HELP DESK      28620000
286300             MOVE SQLCODE                    TO PV-SQLCODE        28630000
286400             MOVE '5710-GET-PARM-DATE'       TO PV-PARA-NAME      28640000
286500             MOVE TR069-DC-NBR               TO PV-DISPLAY-DC     28650000
286600             MOVE PV-CURR-TRIP-ID            TO PV-TRIP-ID-DIS    28660000
286700             STRING 'TKRPRPM SELECT FAILED - SQL '                28670000
286800                   PV-SQLCODE ' FOR FUNC PTCASG'                  28680000
286900                 ' TLR ' TR069-TRAILER-ID                         28690000
287000                 ' SCAC ' TR069-TRLR-SCAC-CDE                     28700000
287100                 ' TRIP ' PV-TRIP-ID-DIS                          28710000
287200                 ' ' PV-DISPLAY-DC                                28720000
287300                 ' ' TR069-USER-ID                                28730000
287400                  DELIMITED BY SIZE INTO  PV-ERROR-MSG            28740000
287500             PERFORM 9500-CSSL-LOG                                28750000
287600             PERFORM 9800-ROLLBACK                                28760000
287700             PERFORM 9900-RETURN-TRAN                             28770000
287800          END-EVALUATE.                                           28780000
287900                                                                  28790000
288000                                                                  28800000
288100*----------------------------------------------------------------*28810000
288200*  WRITE TO THE CICS LOG.                                        *28820000
288300*----------------------------------------------------------------*28830000
288400 9500-CSSL-LOG.                                                   28840000
288500                                                                  28850000
288600      MOVE LENGTH OF PV-CICS-MSG-AREA  TO PV-COMMAREA-LENGTH.     28860000
288700                                                                  28870000
288800      EXEC CICS                                                   28880000
288900           WRITEQ TD                                              28890000
289000            QUEUE   ('CSSL')                                      28900000
289100             FROM   (PV-CICS-MSG-AREA)                            28910000
289200           LENGTH   (PV-COMMAREA-LENGTH)                          28920000
289300             RESP   (PV-CICS-RESPONSE)                            28930000
289400      END-EXEC.                                                   28940000
289500                                                                  28950000
289600                                                                  28960000
289700*----------------------------------------------------------------*28970000
289800* ROLLBACK ALL DB2 CHANGES WHEN A PROBLEM IS ENCOUNTERED AND     *28980000
289900* THE SHIPPING PROCESS CAN'T BE COMPLETED.                       *28990000
290000*----------------------------------------------------------------*29000000
290100 9800-ROLLBACK.                                                   29010000
290200                                                                  29020000
290300     EXEC CICS SYNCPOINT                                          29030000
290400          ROLLBACK                                                29040000
290500     END-EXEC.                                                    29050000
290600                                                                  29060000
290700                                                                  29070000
290800 9900-RETURN-TRAN.                                                29080000
290900                                                                  29090000
291000     MOVE TR069-DC-NBR             TO TR070-DC-NBR.               29100000
291100     MOVE TR069-TRLR-SCAC-CDE      TO TR070-TRLR-SCAC-CDE.        29110000
291200     MOVE TR069-TRAILER-ID         TO TR070-TRAILER-ID.           29120000
291300     MOVE PV-TSYMSG-NUMBER         TO DP507I-MSG-NUMBER           29130000
291400                                      TR070-MSG-ID.               29140000
291500                                                                  29150000
291600     PERFORM 9910-READ-SYSTEM-MESSAGE.                            29160000
291700     MOVE DP507I-MSG-TEXT(1:70)    TO TR070-MSG-TEXT.             29170000
291800     MOVE TR070-OUT-ARRIVE-INB-TLR TO DFHCOMMAREA.                29180000
291900                                                                  29190000
292000     EXEC CICS RETURN END-EXEC.                                   29200000
292100                                                                  29210000
292200 9910-READ-SYSTEM-MESSAGE.                                        29220000
292300     EXEC CICS READ                                               29230000
292400               DATASET ('DPSYSMSG')                               29240000
292500               RIDFLD  (DP507I-MSG-NUMBER)                        29250000
292600               INTO    (DP507I-MESSAGES-INPUT-RECORD)             29260000
292700               RESP    (PV-CICS-RESPONSE)                         29270000
292800     END-EXEC.                                                    29280000
292900                                                                  29290000
293000     IF  PV-CICS-RESPONSE NOT = 0                                 29300000
293100         IF DP507I-MSG-NUMBER = 00059                             29310004
293200             MOVE 'UPDATE(S) SUCCESSFUL'                          29320004
293300                                TO DP507I-MSG-TEXT                29330004
293400         ELSE                                                     29340004
293500             MOVE 'UNABLE TO TRANSLATE MESSAGE NUMBER'            29350004
293600                                TO DP507I-MSG-TEXT                29360000
293700         END-IF                                                   29370004
293800     END-IF.                                                      29380004
293900                                                                  29390000
