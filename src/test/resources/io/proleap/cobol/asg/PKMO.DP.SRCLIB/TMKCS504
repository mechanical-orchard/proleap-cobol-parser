000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    TMKCS504.                                         00040000
000500 AUTHOR.        M. FURLICK - STRATAGEM                            00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  04/94.                                            00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000*---------------------------------------------------------------* 00100000
001100*    E504 - NOTIFICATION/TROUBLE LIST - DETAILS.                * 00110000
001200*                                                               * 00120000
001300*    THIS PROGRAM GENERATES A LIST OF THE DETAILS FOR SELECTED  * 00130000
001400*    NOTIFICATION/TROUBLE ITEMS.                                * 00140000
001500*                                                               * 00150000
001600*---------------------------------------------------------------* 00160000
001700* Change History                                                * 00170008
001800*    CHANGES                                                    * 00180001
001900*     MADE BY: PRITHIVIRAJ SUBRAMANIAN (COGNIZANT)              * 00190001
002000*     DATE:    10/06/2014                                       * 00200001
002100*                                                               * 00210001
002200*      CHANGES THRU OUT THE PROGRAM TO INCREASE THE SIZE OF PO# * 00220001
002300*      FROM 7 DIGITS TO 8 DIGITS. TAGGED WITH *PS 10/06/2014    * 00230002
002310*                                                               * 00231006
002311*     MADE BY: CHERI PARMLEY                                    * 00231106
002312*     DATE:    04/08/2015                                       * 00231206
002313*                                                               * 00231306
002320*      CHANGE WAS MADE IN 1100-FIND-OBJECT-KEYS TO MOVE THE PO# * 00232006
002330*      TO A DISPLAY VARIABLE AND THEN MOVING THE VARIABLE TO    * 00233006
002340*      THE KEY. THE CODE HAD NOT BEEN EXECUTED SINCE THE DETAILS* 00234007
002341*      SCREEN IS NOT DIRECTLY COMING FROM THE CRIT SPEC, IT IS  * 00234107
002342*      PASSED FROM THE UNRESOLVED TROUBLE LIST INSTEAD.         * 00234207
002350*      THE OLD TROUBLE CRIT SPEC (TMKCS501) NO LONGER EXISTS.   * 00235007
002360*      NEEDED TO CHANGE THIS TO ALLOW FOR RCKCS838 TO COME TO   * 00236007
002370*      THIS SCREEN WITH VALID PO DATA.                           *00237007
002380*      NOTE: RECEIVER MUST BE ENTERED WITH PO# FOR THIS SCREEN  * 00238006
002390*            TO DISPLAY DATA WHEN COMING FROM RCKCS838.         * 00239006
002400*---------------------------------------------------------------* 00240001
263627* CHANGED 11/04/2021    BY JIM HUNTER      WR: CHG0263627         00242016
263627* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00243016
263627* MAKING THE CALL DYNAMIC VS STATIC.                              00244016
263627*---------------------------------------------------------------* 00245016
CICS  * CHANGED 11/09/2022    BY JIM HUNTER      WR: CHG0278008         00246017
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00247017
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00248017
CICS  *-----------------------------------------------------------------00249017
002500/                                                                 00250000
002600 ENVIRONMENT DIVISION.                                            00260000
002700                                                                  00270000
002800 DATA DIVISION.                                                   00280000
002900                                                                  00290000
003000 WORKING-STORAGE SECTION.                                         00300000
003100                                                                  00310000
003200 01  PC-PROGRAM-CONSTANTS.                                        00320000
003300     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00330000
003400                                                    'TM504A  '.   00340000
003500     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00350000
003600                                                    'TMKM504 '.   00360000
003700     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00370000
003800                                                    'TMKCS504'.   00380000
003900     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00390000
004000     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 3.      00400000
004100     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +11     00410000
004200                                                    COMP SYNC.    00420000
004300     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00430000
004400                                                    COMP SYNC.    00440000
004500     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00450000
004600                                                    +1000000      00460000
004700                                                    COMP-3.       00470000
004800     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00480000
004900                                                    COMP SYNC.    00490000
005000     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00500000
005100                                                    COMP-3.       00510000
005200     05  PC-ZERO                        PIC S9(04)  VALUE ZERO    00520000
005300                                                    COMP SYNC.    00530000
005400     05  PC-NINES                       PIC S9(04)  VALUE +9999   00540000
005500                                                    COMP SYNC.    00550000
005600     05  PC-A                           PIC  X(01)  VALUE 'A'.    00560000
005700     05  PC-AC                          PIC  X(02)  VALUE 'AC'.   00570000
005800     05  PC-R                           PIC  X(01)  VALUE 'R'.    00580000
005900     05  PC-I                           PIC  X(01)  VALUE 'I'.    00590000
006000     05  PC-N                           PIC  X(01)  VALUE 'N'.    00600000
006100     05  PC-03                          PIC  X(02)  VALUE '03'.   00610000
006200                                                                  00620000
006300     05  PC-INTER-APPL-CODES.                                     00630000
006400         10  PC-INTER-APPL-CRIT-SPEC                              00640000
006500                                  PIC  X(01)  VALUE '1'.          00650000
006600         10  PC-INTER-APPL-LIST   PIC  X(01)  VALUE '2'.          00660000
006700         10  PC-INTER-APPL-LIST-PO                                00670000
006800                                  PIC  X(01)  VALUE '3'.          00680000
006900         10  PC-INTER-APPL-VERIFY-QTY                             00690000
007000                                  PIC  X(01)  VALUE '4'.          00700000
007100                                                                  00710000
007200     05  PC-TSYMSG-NUMBERS.                                       00720000
007300         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00730000
007400         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00740000
007500         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00750000
007600         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00760000
007700         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00770000
007800         10  PC-TSYMSG-00148            PIC  9(05)  VALUE 00148.  00780000
007900         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00790000
008000         10  PC-TSYMSG-00551            PIC  9(05)  VALUE 00551.  00800000
008100         10  PC-TSYMSG-00986            PIC  9(05)  VALUE 00986.  00810000
008200         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00820000
008300         10  PC-TSYMSG-02184            PIC  9(05)  VALUE 02184.  00830000
008400         10  PC-TSYMSG-02185            PIC  9(05)  VALUE 02185.  00840000
008500         10  PC-TSYMSG-02186            PIC  9(05)  VALUE 02186.  00850000
008600*                                                                 00860000
008700 01  PS-PROGRAM-SWITCHES.                                         00870000
008800     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00880000
008900         88  PS-NO-ERROR                            VALUE 'Y'.    00890000
009000         88  PS-ERROR                               VALUE 'N'.    00900000
009100     05  PS-END-OF-TTRBDTL-CSR-SW       PIC  X(01)  VALUE 'Y'.    00910000
009200         88  END-OF-TTRBDTL-CSR                     VALUE 'Y'.    00920000
009300     05  PS-DETAILS-EXIST-SW            PIC  X(01)  VALUE 'N'.    00930000
009400         88  NO-DETAILS-EXIST                       VALUE 'N'.    00940000
009500         88  DETAILS-EXIST                          VALUE 'Y'.    00950000
009600     05  PS-DATA-OK-SW                  PIC  X(01)  VALUE 'N'.    00960000
009700         88  PS-DATA-OK                             VALUE 'Y'.    00970000
009800         88  PS-DATA-NOT-OK                         VALUE 'N'.    00980000
009900     05  PS-ALL-PREPACK-SW              PIC  X(01)  VALUE 'N'.    00990000
010000         88  PS-ALL-PREPACK-YES                     VALUE 'Y'.    01000000
010100         88  PS-ALL-PREPACK-NO                      VALUE 'N'.    01010000
010200     05  PS-USE-SW                      PIC  X(01)  VALUE ' '.    01020000
010300         88  PS-USE-SELECTION                       VALUE 'S'.    01030000
010400         88  PS-USE-ACTIVE                          VALUE 'A'.    01040000
010500         88  PS-USE-RESOLVED                        VALUE 'R'.    01050000
010600         88  PS-USE-ACKNOWLG                        VALUE 'K'.    01060000
010700*                                                                 01070000
010800 01  PV-PROGRAM-VARIABLES.                                        01080000
010900     05  PV-SUB                         PIC S9(04)  VALUE +0      01090000
011000                                                    COMP SYNC.    01100000
011100     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01110000
011200                                                    COMP SYNC.    01120000
011300     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01130000
011400                                                    COMP-3.       01140000
011500     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01150000
011600                                                    COMP-3.       01160000
011700     05  PV-ITEM                        PIC S9(09)  VALUE +0      01170000
011800                                                    COMP-3.       01180000
011900     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01190000
012000                                                    COMP-3.       01200000
012100     05  PV-SEL-QUEUE-ITEM              PIC S9(09)  VALUE +0      01210000
012200                                                    COMP-3.       01220000
012300     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01230000
012400                                                    COMP-3.       01240000
012500     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01250000
012600                                                    COMP SYNC.    01260000
012700     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01270000
012800                                                    COMP SYNC.    01280000
012900     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01290000
013000                                                    COMP SYNC.    01300000
013100     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01310000
013200                                                    COMP SYNC.    01320000
013300     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01330000
013400                                                    COMP SYNC.    01340000
013500     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01350000
013600                                                    COMP SYNC.    01360000
013700     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01370000
013800                                                    COMP SYNC.    01380000
013900     05  PV-RSN-CDE-LO                  PIC S9(04)  VALUE +0      01390000
014000                                                    COMP SYNC.    01400000
014100     05  PV-RSN-CDE-HI                  PIC S9(04)  VALUE +9999   01410000
014200                                                    COMP SYNC.    01420000
014300     05  PV-UNPACK-NUMERIC              PIC 9(04).                01430000
014400     05  PV-UNPACK-NUMERIC-8            PIC 9(08).                01440000
014500     05  PV-RESOLVED-IND                PIC X(01).                01450000
014600     05  PV-RESOLVED-TMST               PIC X(26).                01460000
014700     05  PV-RESOLVED-UID                PIC X(08).                01470000
014800     05  PV-ACKNOWLG-TMST               PIC X(26).                01480000
014900     05  PV-ACKNOWLG-UID                PIC X(08).                01490000
015000     05  PV-TRBL-SHT-DESC               PIC X(10).                01500000
015100     05  PV-TRBL-LONG-DESC              PIC X(20).                01510000
015200     05  PV-TRBL-RSN-CPLT-DESC          PIC X(60).                01520000
015300     05  PV-NTF-TMST                    PIC X(26).                01530000
015400     05  PV-UNPACK-OPER-UNT-ID          PIC 9(04).                01540000
015500     05  PV-NTF-UID                     PIC X(08).                01550000
015600*PS 10/06/2014 CHANGES STARTS                                     01560002
015700     05  PV-PO-NBR                      PIC 9(08).                01570001
015800*PS 10/06/2014 CHANGES ENDS                                       01580002
015900     05  PV-REC-SEQ-NBR                 PIC 9(07).                01590000
016000     05  PV-PO-LNE-NBR                  PIC 9(07).                01600000
016100     05  PV-TEMP-TMST                   PIC X(26).                01610000
016200     05  PV-TMP-UID                     PIC X(08).                01620000
016300     05  PV-TEMP-UID.                                             01630000
016400         10  PV-TEMP-UID-PREFIX         PIC X(02).                01640000
016500         10  PV-TEMP-UID-OTHERS         PIC X(06).                01650000
016600     05  PV-FREEFORM-TEXT               PIC X(250).               01660000
016700     05  PV-TEXT-50  REDEFINES  PV-FREEFORM-TEXT                  01670000
016800                     OCCURS 5           PIC X(50).                01680000
016900     05  PV-PO-REC.                                               01690000
017000*PS 10/06/2014 CHANGES STARTS                                     01700002
017100         10  PV-PR-PO                   PIC  9(08).               01710001
017200*PS 10/06/2014 CHANGES ENDS                                       01720002
017300         10  FILLER                     PIC  X(01)  VALUE '-'.    01730000
017400         10  PV-PR-REC                  PIC  9(04).               01740000
017500     05  PV-PO-REC-ALL.                                           01750000
017600*PS 10/06/2014 CHANGES STARTS                                     01760002
017700         10  PV-PR-PO-ALL               PIC  9(08).               01770001
017800*PS 10/06/2014 CHANGES ENDS                                       01780002
017900         10  FILLER                     PIC  X(01)  VALUE '/'.    01790000
018000         10  PV-PR-REC-ALL              PIC  9(04).               01800000
018100         10  FILLER                     PIC  X(01)  VALUE '/'.    01810000
018200         10  PV-LINE-ALL                PIC  X(04).               01820000
018300         10  FILLER                     PIC  X(01)  VALUE '/'.    01830000
018400         10  PV-PACK-ALL                PIC  9(04).               01840000
018500         10  FILLER                     PIC  X(01)  VALUE '/'.    01850000
018600         10  PV-SKU-ALL                 PIC  9(08).               01860000
018700     05  PV-WORK-TMST.                                            01870000
018800         10  FILLER                     PIC  X(02).               01880000
018900         10  PV-WT-YY                   PIC  X(02).               01890000
019000         10  FILLER                     PIC  X(01).               01900000
019100         10  PV-WT-MO                   PIC  X(02).               01910000
019200         10  FILLER                     PIC  X(01).               01920000
019300         10  PV-WT-DA                   PIC  X(02).               01930000
019400         10  FILLER                     PIC  X(01).               01940000
019500         10  PV-WT-HH                   PIC  X(02).               01950000
019600         10  FILLER                     PIC  X(01).               01960000
019700         10  PV-WT-MM                   PIC  X(02).               01970000
019800         10  FILLER                     PIC  X(10).               01980000
019900     05  PV-SCREEN-DISPLAY-DATE.                                  01990000
020000         10  PV-SD-MO                   PIC  X(02).               02000000
020100         10  FILLER                     PIC  X(01)   VALUE '/'.   02010000
020200         10  PV-SD-DA                   PIC  X(02).               02020000
020300         10  FILLER                     PIC  X(01)   VALUE '/'.   02030000
020400         10  PV-SD-YR                   PIC  X(02).               02040000
020500     05  PV-SCREEN-DISPLAY-TIME.                                  02050000
020600         10  PV-SD-HH                   PIC  X(02).               02060000
020700         10  FILLER                     PIC  X(01)   VALUE ':'.   02070000
020800         10  PV-SD-MM                   PIC  X(02).               02080000
020900     05  PV-WORK-DETAIL-LINE.                                     02090000
021000         10  PV-WD-DATE                 PIC  X(08).               02100000
021100         10  FILLER                     PIC  X(01)   VALUE SPACE. 02110000
021200         10  PV-WD-TIME                 PIC  X(05).               02120000
021300         10  FILLER                     PIC  X(01)   VALUE SPACE. 02130000
021400         10  PV-WD-TEXT                 PIC  X(64).               02140000
021620     05  PV-DISPLAY-PO-X          PIC  X(08).                     02162004
021640     05  PV-RPA-DESCR.                                            02164012
021650         49 PV-RPA-DESCR-LEN      PIC S9(4) COMP.                 02165012
021660         49 PV-RPA-DESCR-TEXT     PIC X(50).                      02166012
021700/                                                                 02170000
021800*---------------------------------------------------------------* 02180000
021900*  TEMP ASSOC INFO  - CALLED MODULE PARAMETERS.                 * 02190000
022000*---------------------------------------------------------------* 02200000
022100                                                                  02210000
022200     COPY XLWS067.                                                02220000
022300                                                                  02230000
022400/                                                                 02240000
022500*---------------------------------------------------------------* 02250000
022600*  LOGISTICS LOCATION DOMAIN MODULE PARAMETERS. (XLKUT071)      * 02260000
022700*---------------------------------------------------------------* 02270000
022800                                                                  02280000
022900     COPY XLWS071.                                                02290000
023000                                                                  02300000
023100/                                                                 02310000
023200*---------------------------------------------------------------* 02320000
023300*  RECORD LAYOUT FOR THE INPUT SELECTION QUEUE.                 * 02330000
023400*---------------------------------------------------------------* 02340000
023500                                                                  02350000
023600     COPY TMWS002.                                                02360000
023700                                                                  02370000
023800/                                                                 02380000
023900*---------------------------------------------------------------* 02390000
024000*  RECORD LAYOUT FOR THE RECEIVING INPUT SELECTION QUEUE.         02400000
024100*---------------------------------------------------------------* 02410000
024200                                                                  02420000
024300     COPY RCWS013.                                                02430000
024400                                                                  02440000
024500/                                                                 02450000
024600*---------------------------------------------------------------* 02460000
024700*    MAP LAYOUT                                                 * 02470000
024800*---------------------------------------------------------------* 02480000
024900                                                                  02490000
025000     COPY TMKM504.                                                02500000
025100*                                                                 02510000
025200 01  MR-OCCURS-LAYOUT                   REDEFINES  TM504AO.       02520000
025300** CHG0094517  CHANGED FILLER FROM 238 TO 239                     02530003
025400     05  FILLER                         PIC X(239).               02540003
025500     05  MR-SCROLL-AREA                 OCCURS 11 TIMES.          02550000
025600         10  MR-DETAIL-LINEL            PIC S9(04) COMP.          02560000
025700         10  MR-DETAIL-LINEA            PIC  X(01).               02570000
025800         10  MR-DETAIL-LINEC            PIC  X(01).               02580000
025900         10  MR-DETAIL-LINEH            PIC  X(01).               02590000
026000         10  MR-DETAIL-LINE             PIC  X(77).               02600000
026100/                                                                 02610000
026200*---------------------------------------------------------------* 02620000
026300*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02630000
026400*---------------------------------------------------------------* 02640000
026500                                                                  02650000
026600     COPY DPWS015.                                                02660000
026700                                                                  02670000
026800*---------------------------------------------------------------* 02680000
026900*    FUNCTION KEYS COPYBOOK.                                    * 02690000
027000*---------------------------------------------------------------* 02700000
027100                                                                  02710000
027200     COPY DPWS016.                                                02720000
027300                                                                  02730000
027400*---------------------------------------------------------------* 02740000
027500*    NUMERIC EDIT LAYOUT.                                       * 02750000
027600*---------------------------------------------------------------* 02760000
027700                                                                  02770000
027800     COPY DPWS010I.                                               02780000
027900/                                                                 02790000
028000*---------------------------------------------------------------* 02800000
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02810017
028200*---------------------------------------------------------------* 02820000
028300                                                                  02830000
028400     COPY DPWS030.                                                02840000
CICS       COPY DPWS930.                                                02841017
028500/                                                                 02850000
028600*---------------------------------------------------------------* 02860000
028700*    PARAMETERS FOR CALLING XLKUT001 ITECTURE API.              * 02870017
028800*---------------------------------------------------------------* 02880000
028900                                                                  02890000
029000     COPY XLWS001.                                                02900000
029100/                                                                 02910000
029200*---------------------------------------------------------------* 02920000
029300*    STANDARD COMMAREA.                                         * 02930000
029400*---------------------------------------------------------------* 02940000
029500                                                                  02950000
029600     COPY DPWS020.                                                02960000
029700     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02970000
029800                                                                  02980000
029900         10  INTER-APPL-COMM-AREA       PIC X(200).               02990000
030000     COPY POWS017.                                                03000000
030100     COPY TMWS001.                                                03010000
030200     COPY RCWS015.                                                03020000
030210* LAYOUT TO GO TO RCKCS218 - PF22                               * 03021008
030300     COPY PCWS000.                                                03030008
030310* TEMP STORAGE FOR PREPACK AND RECEIVING AREA                   * 03031008
030400     COPY RCWS800.                                                03040008
030500*---------------------------------------------------------------* 03050000
030600*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03060000
030700*        COMMAREA LENGTH IN MNEMONIC IS 2500.                   * 03070000
030800*        ASC-AVAILABLE-FILLER IS WHAT IS LEFT TO USE.           * 03080000
030900*---------------------------------------------------------------* 03090000
031000                                                                  03100000
031100         10  ASC-SPECIFIC-COMMAREA.                               03110000
031200             15  ASC-LIST-KEYS.                                   03120000
031300                 20  ASC-KEY-NOTIF-NBR               PIC S9(09)   03130000
031400                                                     COMP.        03140000
031500                 20  ASC-KEY-OPER-UNT-ID             PIC S9(04)   03150000
031600                                                     COMP.        03160000
031700                 20  ASC-KEY-FCLTY-ID                PIC S9(04)   03170000
031800                                                     COMP.        03180000
031900                 20  ASC-KEY-PO-NBR                  PIC S9(09)   03190000
032000                                                     COMP.        03200000
032100                 20  ASC-KEY-REC-SEQ-NBR             PIC S9(09)   03210000
032200                                                     COMP.        03220000
032300                 20  ASC-KEY-PO-LNE-NBR              PIC S9(04)   03230000
032400                                                     COMP.        03240000
032500                 20  ASC-KEY-PREPK-ID                PIC S9(04)   03250000
032600                                                     COMP.        03260000
032700                 20  ASC-TRBL-LVL-IND                PIC X(01).   03270000
032800                 20  ASC-NEW-STR-IND                 PIC X(01).   03280000
032900                 20  ASC-SEASET-SHRT-NM              PIC X(05).   03290000
033000                 20  ASC-TROUBLE                     PIC X(60).   03300000
033100                 20  ASC-PK-SKU-NBR                  PIC S9(8)    03310000
033200                                                     COMP-3.      03320000
033300                 20  ASC-ITM-NBR                     PIC S9(15)   03330000
033400                                                     COMP-3.      03340000
033500                 20  ASC-SHTG                        PIC X(01).   03350000
033600                 20  ASC-OVRG                        PIC X(01).   03360000
033700                 20  ASC-EXST                        PIC X(01).   03370000
033800             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03380000
033900                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03390000
034000                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03400000
034100                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03410000
034200                                                                  03420000
034300                 20  ASC-ITEM-ARRAY.                              03430000
034400                     25  ASC-ITEM-ENTRIES OCCURS 11 TIMES.        03440000
034500                         30  ASC-LIST-ITEM-NUMBER                 03450000
034600                                                     PIC S9(09)   03460000
034700                                                     COMP-3.      03470000
034800                                                                  03480000
034900                         30  ASC-SCREEN-LINE         PIC  X(78).  03490000
035000                                                                  03500000
035100                                                                  03510000
035200             15  ASC-BLK-SUB                         PIC S9(04)   03520000
035300                                                          COMP    03530000
035400                                                          SYNC.   03540000
035500             15  ASC-ITEM-SUB                        PIC S9(04)   03550000
035600                                                          COMP    03560000
035700                                                          SYNC.   03570000
035800             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   03580000
035900                                                          COMP-3. 03590000
036000             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   03600000
036100                                                          COMP-3. 03610000
036200             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03620000
036300                                                          COMP-3. 03630000
036400             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   03640000
036500                                                          COMP-3. 03650000
036600             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03660000
036700                                                          COMP-3. 03670000
036800             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   03680000
036900                                                          COMP    03690000
037000                                                          SYNC.   03700000
037100             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03710000
037200                                                          COMP-3. 03720000
037300             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03730000
037400                                                          COMP-3. 03740000
037500             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03750000
037600                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   03760000
037700                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   03770000
037800             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  03780000
037900                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   03790000
038000                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   03800000
038100             15  ASC-LIST-QUEUE-NAME.                             03810000
038200                 20  ASC-LIST-TERM-ID                PIC  X(04).  03820000
038300                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   03830000
038400                                                          COMP-3. 03840000
038500                 20  ASC-LIST-SEQ                    PIC  9(01).  03850000
038600             15  ASC-SEL-QUEUE-NAME                  PIC X(08).   03860000
038700             15  ASC-SEL-QUEUE-NAME-OUT.                          03870000
038800                 20  ASC-SEL-TERM-ID                 PIC  X(04).  03880000
038900                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   03890000
039000                                                          COMP-3. 03900000
039100                 20  ASC-SEL-SEQ                     PIC  9(01).  03910000
039200                                                                  03920000
039300             15  ASC-INT-APPL-FORMAT-IND             PIC  X(01).  03930000
039400             15  ASC-USE-SELECTION-QUEUE-IND                      03940000
039500                                           PIC  X(01).            03950000
039600                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 03960000
039700             15  ASC-NUMBER-OF-TS-ITEMS    PIC S9(05)  COMP-3.    03970000
039800             15  ASC-SEL-SUB               PIC S9(04)  COMP.      03980000
039900             15  ASC-SEL-ITEM              PIC S9(04)  COMP.      03990000
040000             15  ASC-FCLTY-NME             PIC  X(25).            04000000
040100             15  ASC-ENT-NAME-DESC         PIC  X(25).            04010000
040200                                                                  04020000
040300             15  ASC-CURSOR-SW                       PIC  X(01).  04030000
040400                 88  ASC-NO-CURSOR                   VALUE 'Z'.   04040000
040500                 88  ASC-SYSTEM-ID-CURSOR            VALUE 'S'.   04050000
040600                 88  ASC-MESSAGE-NUMBER-CURSOR       VALUE 'N'.   04060000
040700                 88  ASC-MESSAGE-TEXT-CURSOR         VALUE 'T'.   04070000
040800             15  ASC-START-ITEM-REQUEST.                          04080000
040900                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  04090000
041000             15  ASC-HOLD-INTER-APPL                 PIC X(200).  04100000
041100             15  ASC-AVAILABLE-FILLER                PIC X(239).  04110000
041200     COPY RCWS801.                                                04120000
041300/                                                                 04130000
041400*---------------------------------------------------------------* 04140000
041500*    ABEND PROCESSING COPYBOOK.                                 * 04150000
041600*---------------------------------------------------------------* 04160000
041700                                                                  04170000
041800     COPY DPWS013.                                                04180000
041900                                                                  04190000
042000/                                                                 04200000
042100*---------------------------------------------------------------* 04210000
042200*    DB2 AREA FOR TROUBLE NOTIFICATION                          * 04220000
042300*---------------------------------------------------------------* 04230000
042400     EXEC SQL                                                     04240000
042500          INCLUDE TTRBNTF                                         04250000
042600     END-EXEC.                                                    04260000
042700*---------------------------------------------------------------* 04270000
042800*    DB2 AREA FOR TROUBLE DETAIL                                * 04280000
042900*---------------------------------------------------------------* 04290000
043000     EXEC SQL                                                     04300000
043100          INCLUDE TTRBDTL                                         04310000
043200     END-EXEC.                                                    04320000
043300*---------------------------------------------------------------* 04330000
043400*    DB2 AREA FOR TROUBLE REASONS                               * 04340000
043500*---------------------------------------------------------------* 04350000
043600     EXEC SQL                                                     04360000
043700          INCLUDE TTRBRSN                                         04370000
043800     END-EXEC.                                                    04380000
043900*---------------------------------------------------------------* 04390000
044000*    DB2 AREA FOR ENTITY NAME                                   * 04400000
044100*---------------------------------------------------------------* 04410000
044200     EXEC SQL                                                     04420000
044300          INCLUDE TENTNME                                         04430000
044400     END-EXEC.                                                    04440000
044500*---------------------------------------------------------------* 04450000
044600*    DB2 AREA FOR RECEIVER ITEM                                 * 04460000
044700*---------------------------------------------------------------* 04470000
044800     EXEC SQL                                                     04480000
044900          INCLUDE TRECITM                                         04490000
045000     END-EXEC.                                                    04500000
045100*---------------------------------------------------------------* 04510000
045200*    DB2 AREA FOR PURCHASE ITEM                                 * 04520000
045300*---------------------------------------------------------------* 04530000
045400     EXEC SQL                                                     04540000
045500          INCLUDE TPURITM                                         04550000
045600     END-EXEC.                                                    04560000
045700*---------------------------------------------------------------* 04570000
045800*    DB2 AREA FOR                                               * 04580000
045900*---------------------------------------------------------------* 04590000
046000     EXEC SQL                                                     04600000
046100          INCLUDE TALLPLN                                         04610000
046200     END-EXEC.                                                    04620000
046300*---------------------------------------------------------------* 04630000
046400*    DB2 AREA FOR PURCHASE ORDER TABLE                          * 04640000
046500*---------------------------------------------------------------* 04650000
046600     EXEC SQL                                                     04660000
046700          INCLUDE TPURCHS                                         04670000
046800     END-EXEC.                                                    04680000
046900*---------------------------------------------------------------* 04690000
047000*    DB2 AREA FOR                                               * 04700000
047100*---------------------------------------------------------------* 04710000
047200     EXEC SQL                                                     04720000
047300          INCLUDE TPOPRPK                                         04730000
047400     END-EXEC.                                                    04740000
047500*---------------------------------------------------------------* 04750000
047600*    DB2 AREA FOR                                               * 04760000
047700*---------------------------------------------------------------* 04770000
047800     EXEC SQL                                                     04780000
047900          INCLUDE TRECEIV                                         04790000
048000     END-EXEC.                                                    04800000
048001                                                                  04800110
048010*---------------------------------------------------------------* 04801010
048020*  SQL AND COBOL DECLARATIONS FOR WST_INTGRTN_TYP                 04802010
048021*---------------------------------------------------------------* 04802110
048040     EXEC SQL                                                     04804010
048050          INCLUDE WST00008                                        04805010
048060     END-EXEC.                                                    04806010
048070                                                                  04807010
048071*---------------------------------------------------------------* 04807110
048080*  SQL AND COBOL DECLARATIONS FOR WST_ATTR_DEFN                   04808010
048081*---------------------------------------------------------------* 04808110
048091     EXEC SQL                                                     04809110
048092          INCLUDE WST00009                                        04809210
048093     END-EXEC.                                                    04809310
048094                                                                  04809410
048095*---------------------------------------------------------------* 04809510
048096*  SQL AND COBOL DECLARATIONS FOR WST_ATTR_ELEM                   04809610
048097*---------------------------------------------------------------* 04809710
048099     EXEC SQL                                                     04809910
048100          INCLUDE WST00010                                        04810010
048101     END-EXEC.                                                    04810110
048102                                                                  04810210
048110*---------------------------------------------------------------* 04811000
048200*    DB2 AREA FOR COMMUNICATIONS                                * 04820000
048300*---------------------------------------------------------------* 04830000
048400     EXEC SQL                                                     04840000
048500          INCLUDE SQLCA                                           04850000
048600     END-EXEC.                                                    04860000
048700/                                                                 04870000
048800*---------------------------------------------------------------* 04880000
048900*    CURSOR DECLARATION FOR ACTIVE ROWS; INPUT FROM CRITERIA    * 04890000
049000*    SPEC SCREEN.                                               * 04900000
049100*---------------------------------------------------------------* 04910000
049200     EXEC SQL                                                     04920000
049300          DECLARE CRIT-ACTIVE-CSR CURSOR                          04930000
049400          FOR SELECT                                              04940000
049500                C.TRBL_SHT_DESC                                   04950000
049600              , C.TRBL_LONG_DESC                                  04960000
049700              , C.TRBL_RSN_CPLT_DESC                              04970000
049800              , A.NOTIF_NBR                                       04980000
049900              , A.NOTIF_TMST                                      04990000
050000              , A.NOTIF_UID                                       05000000
050100          FROM                                                    05010000
050200                TTRBNTF A                                         05020000
050300              , TTRBRSN C                                         05030000
050400          WHERE                                                   05040000
050500                A.PO_NBR           = :ASC-KEY-PO-NBR              05050000
050600                                                                  05060000
050700           AND  ((A.PO_LNE_NBR     = :ASC-KEY-PO-LNE-NBR          05070000
050800           AND   C.TRBL_LVL_IND   <> 'M')                         05080000
050900           OR   (A.PREPK_ID        = :ASC-KEY-PREPK-ID            05090000
051000           AND   C.TRBL_LVL_IND    = 'M'))                        05100000
051100                                                                  05110000
051200           AND  A.REC_SEQ_NBR      = :ASC-KEY-REC-SEQ-NBR         05120000
051300           AND (RESOLVED_IND       = :PC-I                        05130000
051400            OR  RESOLVED_IND       = :PC-N)                       05140000
051500           AND (A.TRBL_RSN_CDE BETWEEN :PV-RSN-CDE-LO             05150000
051600                      AND              :PV-RSN-CDE-HI)            05160000
051700           AND  A.TRBL_RSN_CDE     = C.TRBL_RSN_CDE               05170000
051800          ORDER BY                                                05180000
051900                A.NOTIF_TMST                                      05190000
052000     END-EXEC.                                                    05200000
052100                                                                  05210000
052200*---------------------------------------------------------------* 05220000
052300*    CURSOR DECLARATION FOR RESOLVED ROWS.  INPUT FROM THE      * 05230000
052400*    CRITERIA SPEC SCREEN.                                      * 05240000
052500*---------------------------------------------------------------* 05250000
052600                                                                  05260000
052700     EXEC SQL                                                     05270000
052800          DECLARE CRIT-RESOLVED-CSR CURSOR                        05280000
052900          FOR SELECT                                              05290000
053000                C.TRBL_SHT_DESC                                   05300000
053100              , C.TRBL_LONG_DESC                                  05310000
053200              , C.TRBL_RSN_CPLT_DESC                              05320000
053300              , A.NOTIF_NBR                                       05330000
053400              , A.NOTIF_TMST                                      05340000
053500              , A.NOTIF_UID                                       05350000
053600              , A.RESOLVED_TMST                                   05360000
053700              , A.RESOLVED_UID                                    05370000
053800          FROM                                                    05380000
053900                TTRBNTF A                                         05390000
054000              , TTRBRSN C                                         05400000
054100          WHERE                                                   05410000
054200                PO_NBR             = :ASC-KEY-PO-NBR              05420000
054300                                                                  05430000
054400           AND  ((A.PO_LNE_NBR     = :ASC-KEY-PO-LNE-NBR          05440000
054500           AND   C.TRBL_LVL_IND   <> 'M')                         05450000
054600           OR   (A.PREPK_ID        = :ASC-KEY-PREPK-ID            05460000
054700           AND   C.TRBL_LVL_IND    = 'M'))                        05470000
054800                                                                  05480000
054900           AND  PO_LNE_NBR         = :ASC-KEY-PO-LNE-NBR          05490000
055000           AND  REC_SEQ_NBR        = :ASC-KEY-REC-SEQ-NBR         05500000
055100           AND  RESOLVED_IND       = :PC-R                        05510000
055200           AND (A.TRBL_RSN_CDE BETWEEN :PV-RSN-CDE-LO             05520000
055300                      AND              :PV-RSN-CDE-HI)            05530000
055400           AND  A.TRBL_RSN_CDE     = C.TRBL_RSN_CDE               05540000
055500          ORDER BY                                                05550000
055600                A.RESOLVED_TMST                                   05560000
055700     END-EXEC.                                                    05570000
055800                                                                  05580000
055900*---------------------------------------------------------------* 05590000
056000*    CURSOR DECLARATION FOR ACKNOWLEGED ROWS.  INPUT FROM THE   * 05600000
056100*    CRITERIA SPEC SCREEN.                                      * 05610000
056200*---------------------------------------------------------------* 05620000
056300                                                                  05630000
056400     EXEC SQL                                                     05640000
056500          DECLARE CRIT-ACKNOWLG-CSR CURSOR                        05650000
056600          FOR SELECT                                              05660000
056700                C.TRBL_SHT_DESC                                   05670000
056800              , C.TRBL_LONG_DESC                                  05680000
056900              , C.TRBL_RSN_CPLT_DESC                              05690000
057000              , A.NOTIF_NBR                                       05700000
057100              , A.NOTIF_TMST                                      05710000
057200              , A.NOTIF_UID                                       05720000
057300              , A.RESOLVED_TMST                                   05730000
057400              , A.RESOLVED_UID                                    05740000
057500              , A.ACKNOWLG_TMST                                   05750000
057600              , A.ACKNOWLG_UID                                    05760000
057700          FROM                                                    05770000
057800                TTRBNTF A                                         05780000
057900              , TTRBRSN C                                         05790000
058000          WHERE                                                   05800000
058100                PO_NBR             =  :ASC-KEY-PO-NBR             05810000
058200                                                                  05820000
058300           AND  ((A.PO_LNE_NBR     = :ASC-KEY-PO-LNE-NBR          05830000
058400           AND   C.TRBL_LVL_IND   <> 'M')                         05840000
058500           OR   (A.PREPK_ID        = :ASC-KEY-PREPK-ID            05850000
058600           AND   C.TRBL_LVL_IND    = 'M'))                        05860000
058700                                                                  05870000
058800           AND  PO_LNE_NBR         =  :ASC-KEY-PO-LNE-NBR         05880000
058900           AND  REC_SEQ_NBR        =  :ASC-KEY-REC-SEQ-NBR        05890000
059000           AND  RESOLVED_IND       =  :PC-A                       05900000
059100           AND (A.TRBL_RSN_CDE BETWEEN :PV-RSN-CDE-LO             05910000
059200                      AND              :PV-RSN-CDE-HI)            05920000
059300           AND  A.TRBL_RSN_CDE     =  C.TRBL_RSN_CDE              05930000
059400          ORDER BY                                                05940000
059500                A.ACKNOWLG_TMST                                   05950000
059600     END-EXEC.                                                    05960000
059700*---------------------------------------------------------------* 05970000
059800*    CURSOR DECLARATION FOR DETAIL LINES                        * 05980000
059900*---------------------------------------------------------------* 05990000
060000                                                                  06000000
060100     EXEC SQL                                                     06010000
060200          DECLARE TTRBDTL-CSR CURSOR                              06020000
060300          FOR SELECT                                              06030000
060400                CRE_TMST                                          06040000
060500              , CRE_UID                                           06050000
060600              , FREEFORM_TEXT                                     06060000
060700          FROM  TTRBDTL B                                         06070000
060800          WHERE NOTIF_NBR        =  :ASC-KEY-NOTIF-NBR            06080000
060900          ORDER BY                                                06090000
061000                B.CRE_TMST                                        06100000
061100     END-EXEC.                                                    06110000
061200                                                                  06120000
061300/                                                                 06130000
061400 LINKAGE SECTION.                                                 06140000
061500                                                                  06150000
061600 01  DFHCOMMAREA.                                                 06160000
061700     05  FILLER                         OCCURS  1 TO 4072 TIMES   06170000
061800                                        DEPENDING ON EIBCALEN.    06180000
061900         10  FILLER                     PIC X.                    06190000
062000                                                                  06200000
062100 PROCEDURE DIVISION.                                              06210000
062200**--------------------------------------------------------------**06220000
062300**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **06230000
062400**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **06240000
062500**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **06250000
062600**--------------------------------------------------------------**06260000
062700                                                                  06270000
062800 0000-MAIN-MODULE.                                                06280000
062900                                                                  06290000
063000     INITIALIZE DP030-CICS-API-FIELDS.                            06300000
063100     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       06310000
063200     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          06320000
063300     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         06330000
063400     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       06340000
063500                                                                  06350000
063600     MOVE LENGTH OF TM504AI        TO DP030-MAP-LENGTH (1).       06360000
063700     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     06370000
063800     PERFORM 0001-CALL-CICS-ARCH-API.                             06380000
063900                                                                  06390000
064000     PERFORM 1000-CONTROL-PROCESSING                              06400000
064100                                                                  06410000
064200     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     06420000
064300     PERFORM 0001-CALL-CICS-ARCH-API.                             06430000
064400                                                                  06440000
064500*----------------------------------------------------------------*06450000
064600*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *06460000
064700*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *06470000
064800*----------------------------------------------------------------*06480000
064900                                                                  06490000
065000 0001-CALL-CICS-ARCH-API.                                         06500000
065100                                                                  06510000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      06520017
065300                                    DFHCOMMAREA                   06530017
065400                                    DP030-CICS-API-FIELDS         06540017
065500                                    DP020-STANDARD-COMMAREA       06550017
065600                                    TM504AI.                      06560017
065700                                                                  06570000
065800     IF  DP030-RC-CALL-SUCCESSFUL                                 06580000
065900         CONTINUE                                                 06590000
066000     ELSE                                                         06600000
066100         SET DP013-NO-ROLLBACK                                    06610000
066200             DP013-XCTL-DISPLAY-RESTART                           06620000
066300             DP013-CICS-ABEND      TO TRUE                        06630000
066400         MOVE '0001-CALL-CICS-ARCH-API'                           06640000
066500                                   TO DP013-PARAGRAPH             06650000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O06651017
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      06652017
066800         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      06680000
066900         PERFORM DP013-0000-PROCESS-ABEND                         06690000
067000     END-IF.                                                      06700000
067100                                                                  06710000
067200*----------------------------------------------------------------*06720000
067300* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *06730000
067400* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *06740000
067500*                                                                *06750000
067600* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *06760000
067700*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *06770000
067800*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *06780000
067900*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *06790000
068000*----------------------------------------------------------------*06800000
068100                                                                  06810000
068200 1000-CONTROL-PROCESSING.                                         06820000
068300                                                                  06830000
068400     EVALUATE TRUE                                                06840000
068500         WHEN DP020-NEXT-ACT-INITIAL                              06850000
068600              PERFORM 1100-FIND-OBJECT-KEYS                       06860000
068700              IF  PS-ERROR                                        06870000
068800                  CONTINUE                                        06880000
068900              ELSE                                                06890000
069000                  MOVE INTER-APPL-COMM-AREA                       06900000
069100                                   TO  ASC-HOLD-INTER-APPL        06910000
069200                  MOVE EIBTRMID    TO ASC-LIST-TERM-ID            06920000
069300                  MOVE DP020-SRC-TASK-NUMBER                      06930000
069400                                   TO ASC-LIST-TASK-NUMBER        06940000
069500                  MOVE PC-LIST-QUEUE-SEQ                          06950000
069600                                   TO ASC-LIST-SEQ                06960000
069700                                                                  06970000
069800                  PERFORM 4000-BUILD-INITIAL-PANEL THRU 4000-EXIT 06980000
069900                  IF  ASC-NUMBER-OF-ITEMS-READ = ZERO             06990000
070000                      SET DP020-NEXT-ACT-APPL-ERROR TO TRUE       07000000
070100                  END-IF                                          07010000
070200              END-IF                                              07020000
070300                                                                  07030000
070400         WHEN DP020-NEXT-ACT-READ-MAP                             07040000
070500              MOVE ASC-ITEM-AT-TOP-OF-PANEL                       07050000
070600                                   TO PV-TOP-ITEM                 07060000
070700              PERFORM 2000-PROCESS-PANEL                          07070000
070800                                                                  07080000
070900         WHEN DP020-NEXT-ACT-RETURN                               07090000
071000              MOVE ASC-ITEM-AT-TOP-OF-PANEL                       07100000
071100                                   TO PV-TOP-ITEM                 07110000
071200              MOVE ZERO            TO ASC-ITEM-AT-TOP-OF-PANEL    07120000
071300              MOVE ASC-HOLD-INTER-APPL                            07130000
071400                                   TO INTER-APPL-COMM-AREA        07140000
071500              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                07150000
071600                                                                  07160000
071700         WHEN OTHER                                               07170000
071800              SET DP013-LOGIC-ABEND TO TRUE                       07180000
071900              SET DP013-NO-ROLLBACK TO TRUE                       07190000
072000              MOVE '1000-CONTROL-PROCESSING'                      07200000
072100                                   TO DP013-PARAGRAPH             07210000
072200              MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'   07220000
072300                                   TO DP013-MESSAGE-TEXT(1)       07230000
072400              PERFORM DP013-0000-PROCESS-ABEND                    07240000
072500     END-EVALUATE.                                                07250000
072600                                                                  07260000
072700*----------------------------------------------------------------*07270000
072800*  DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE    *07280000
072900*  INTER-APPLICATION FORMAT CODE.                                *07290000
073000*----------------------------------------------------------------*07300000
073100                                                                  07310000
073200 1100-FIND-OBJECT-KEYS.                                           07320000
073300                                                                  07330000
073400     INITIALIZE ASC-SPECIFIC-COMMAREA.                            07340000
073500     MOVE DP020-INT-APPL-FORMAT-IND                               07350000
073600                                   TO  ASC-INT-APPL-FORMAT-IND.   07360000
073700                                                                  07370000
073800     EVALUATE TRUE                                                07380000
073900         WHEN DP020-INT-APPL-FORMAT-IND = PC-INTER-APPL-CRIT-SPEC 07390000
074000             MOVE TM001-OPER-UNT-ID-N  TO  ASC-KEY-OPER-UNT-ID    07400000
074100             MOVE TM001-FCLTY-ID-N     TO  ASC-KEY-FCLTY-ID       07410000
074200***CLP 04/08/15 START                                             07420006
074210             MOVE TM001-PO-NBR-N  TO  PV-DISPLAY-PO-X             07421004
074220             MOVE PV-DISPLAY-PO-X TO  ASC-KEY-PO-NBR              07422004
074230***CLP 04/08/15 END                                               07423006
074300             MOVE TM001-RCVR-SEQ-NBR-N TO  ASC-KEY-REC-SEQ-NBR    07430000
074400             MOVE TM001-PO-LINE-NBR-N  TO  ASC-KEY-PO-LNE-NBR     07440000
074500             MOVE TM001-FCLTY-NME      TO  ASC-FCLTY-NME          07450000
074600             MOVE TM001-VENDOR-NME     TO  ASC-ENT-NAME-DESC      07460000
074700             PERFORM 7030-GET-PREPK-DATA                          07470000
074800             PERFORM 7033-SELECT-TALLPLN                          07480000
074900                                                                  07490000
075000         WHEN DP020-INT-APPL-FORMAT-IND = PC-INTER-APPL-LIST      07500000
075100                      OR PC-INTER-APPL-LIST-PO                    07510000
075200              SET ASC-USE-SELECTION-QUEUE TO TRUE                 07520000
075300              MOVE TM001-NUMBER-OF-TS-ITEMS                       07530000
075400                                   TO  ASC-NUMBER-OF-TS-ITEMS     07540000
075500              MOVE TM001-SEL-QUEUE-NAME                           07550000
075600                                   TO  ASC-SEL-QUEUE-NAME         07560000
075700              PERFORM 1120-PREPARE-LIST-ENTRY                     07570000
075800                                                                  07580000
075900         WHEN DP020-INT-APPL-FORMAT-IND =                         07590000
076000                                         PC-INTER-APPL-VERIFY-QTY 07600000
076100             MOVE RC015-OPER-UNT-ID                               07610000
076200                                   TO  ASC-KEY-OPER-UNT-ID        07620000
076300             MOVE RC015-FCLTY-ID  TO  ASC-KEY-FCLTY-ID            07630000
076400             MOVE RC015-PO-NBR    TO  ASC-KEY-PO-NBR              07640000
076500             MOVE RC015-REC-SEQ-NBR                               07650000
076600                                   TO  ASC-KEY-REC-SEQ-NBR        07660000
076700             MOVE RC015-PKSL-LNE-NBR                              07670000
076800                                   TO  ASC-KEY-PO-LNE-NBR         07680000
076900*            MOVE TM001-FCLTY-NME TO  ASC-FCLTY-NME               07690000
077000*            MOVE TM001-VENDOR-NME                                07700000
077100*                                  TO  ASC-ENT-NAME-DESC          07710000
077200             MOVE RC015-ADJ-CYC-NBR                               07720000
077300                                   TO ASC-KEY-NOTIF-NBR           07730000
077400             PERFORM 7030-GET-PREPK-DATA                          07740000
077500             PERFORM 7033-SELECT-TALLPLN                          07750000
077600                                                                  07760000
077700         WHEN OTHER                                               07770000
077800              MOVE PC-TSYMSG-00148 TO  DP020-MSG-NUMBER           07780000
077900              SET DP020-MSG-FATAL                                 07790000
078000                  DP020-FK-RETURN (DP020-SRC-AID)                 07800000
078100                  PS-ERROR                                        07810000
078200                                   TO TRUE                        07820000
078300     END-EVALUATE.                                                07830000
078400     IF PS-NO-ERROR                                               07840000
078500         PERFORM 1130-GET-NEW-STR-IND                             07850000
078600     END-IF.                                                      07860000
078700                                                                  07870000
078800*----------------------------------------------------------------*07880000
078900* ENTRY IS FROM A LIST.  GET THE MESSAGE NUMBER FROM THE TEMP    *07890000
079000* STORAGE QUEUE PASSED FROM THE LIST.                            *07900000
079100*----------------------------------------------------------------*07910000
079200                                                                  07920000
079300 1120-PREPARE-LIST-ENTRY.                                         07930000
079400                                                                  07940000
079500     MOVE TM002-MAX-ITEMS          TO ASC-SEL-SUB.                07950000
079600     MOVE ZERO                     TO ASC-SEL-ITEM.               07960000
079700     PERFORM 2101-GET-NEXT-AREA.                                  07970000
079800                                                                  07980000
079900 1130-GET-NEW-STR-IND.                                            07990000
080000     PERFORM                                                      08000000
080100         WITH TEST AFTER                                          08010000
080200         VARYING PV-RETRY-COUNTER                                 08020000
080300         FROM 1 BY 1                                              08030000
080400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08040000
080500             OR (SQLCODE = +0)                                    08050000
080600             OR (SQLCODE = +100))                                 08060000
080700                                                                  08070000
080800         EXEC SQL                                                 08080000
080900              SELECT NEW_STR_PO_IND                               08090000
081000                    ,SEASET_SHRT_NM                               08100000
081100                INTO :PURCHS-NEW-STR-PO-IND                       08110000
081200                    ,:PURCHS-SEASET-SHRT-NM                       08120000
081300                FROM TPURCHS A                                    08130000
081400               WHERE PO_NBR         = :ASC-KEY-PO-NBR             08140000
081500                 AND VER_STATUS_CDE = 'A'                         08150000
081600         END-EXEC                                                 08160000
081700                                                                  08170000
081800         EVALUATE TRUE                                            08180000
081900             WHEN SQLCODE = +0                                    08190000
082000                  MOVE PURCHS-NEW-STR-PO-IND                      08200000
082100                                  TO ASC-NEW-STR-IND              08210000
082200                  MOVE PURCHS-SEASET-SHRT-NM                      08220000
082300                                  TO ASC-SEASET-SHRT-NM           08230000
082400                                                                  08240000
082500             WHEN SQLCODE = +100                                  08250000
082600             WHEN SQLCODE = -811                                  08260000
082700                  MOVE SPACES     TO ASC-NEW-STR-IND              08270000
082800                                     ASC-SEASET-SHRT-NM           08280000
082900                                                                  08290000
083000             WHEN SQLCODE = -904                                  08300000
083100             WHEN SQLCODE = -913                                  08310000
083200                  CONTINUE                                        08320000
083300                                                                  08330000
083400             WHEN SQLWARN0 NOT = SPACES                           08340000
083500             WHEN SQLCODE < +0                                    08350000
083600             WHEN SQLCODE > +0                                    08360000
083700                  MOVE '1130-GET-NEW-STR-IND'                     08370000
083800                                  TO DP013-PARAGRAPH              08380000
083900                  MOVE 'UNSUCCESSFUL SELECT NEW-STR-PO-IND'       08390000
084000                                  TO DP013-MESSAGE-TEXT (1)       08400000
084100                  MOVE SQLCA      TO DP013-SQLCA                  08410000
084200                  MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (1)     08420000
084300                  SET DP013-DB2-ABEND                             08430000
084400                      DP013-XCTL-DISPLAY-RESTART                  08440000
084500                                  TO TRUE                         08450000
084600                  PERFORM DP013-0000-PROCESS-ABEND                08460000
084700         END-EVALUATE                                             08470000
084800     END-PERFORM.                                                 08480000
084900                                                                  08490000
085000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08500000
085100             AND (SQLCODE = -904 OR -913)                         08510000
085200         MOVE '1130-GET-NEW-STR-IND'                              08520000
085300                                  TO DP013-PARAGRAPH              08530000
085400         MOVE 'MAX RETRIES EXCEEDED ON SELECT'                    08540000
085500                                  TO DP013-MESSAGE-TEXT (1)       08550000
085600         MOVE SQLCA               TO DP013-SQLCA                  08560000
085700         MOVE 'TPURCHS '          TO DP013-DB2-TABLE-NAME (1)     08570000
085800         SET DP013-DB2-ABEND                                      08580000
085900             DP013-XCTL-DISPLAY-RESTART                           08590000
086000                                  TO TRUE                         08600000
086100         PERFORM DP013-0000-PROCESS-ABEND                         08610000
086200     END-IF.                                                      08620000
086300/                                                                 08630000
086400*----------------------------------------------------------------*08640000
086500* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *08650000
086600* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *08660000
086700* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *08670000
086800* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *08680000
086900* FUNCTION KEYS CAN GET THIS FAR.                                *08690000
087000*----------------------------------------------------------------*08700000
087100                                                                  08710000
087200 2000-PROCESS-PANEL.                                              08720000
087300                                                                  08730000
087400     MOVE ASC-HOLD-INTER-APPL      TO INTER-APPL-COMM-AREA.       08740000
087500                                                                  08750000
087600     EVALUATE TRUE                                                08760000
087700                                                                  08770000
087800         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              08780000
087900             MOVE ASC-KEY-PO-NBR   TO PO017-PO-NBR                08790000
088000                                                                  08800000
088100         WHEN DP020-SRC-AID = DP016-CLEAR                         08810000
088200             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    08820000
088300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08830000
088400                                                                  08840000
088500         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    08850000
088600             MOVE ASC-HOLD-INTER-APPL                             08860000
088700                                   TO INTER-APPL-COMM-AREA        08870000
088800             PERFORM 2050-DELETE-LIST-QUEUE                       08880000
088900             PERFORM 4000-BUILD-INITIAL-PANEL THRU 4000-EXIT      08890000
089000                                                                  08900000
089100         WHEN OTHER                                               08910000
089200              PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                08920000
089300              SET DP030-CONTINUE-GO                               08930000
089400                                 TO TRUE                          08940000
089500              PERFORM 2100-CHECK-FUNCTION-KEY                     08950000
089600     END-EVALUATE.                                                08960000
089700/                                                                 08970000
089800*----------------------------------------------------------------*08980000
089900*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *08990000
090000*----------------------------------------------------------------*09000000
090100 2050-DELETE-LIST-QUEUE.                                          09010000
090200                                                                  09020000
090300     EXEC CICS                                                    09030000
090400         DELETEQ TS                                               09040000
090500             QUEUE (ASC-LIST-QUEUE-NAME)                          09050000
090600             RESP  (PV-CICS-RESP)                                 09060000
090700     END-EXEC.                                                    09070000
090800                                                                  09080000
090900     IF (PV-CICS-RESP = DFHRESP(NORMAL)                           09090000
091000     OR  PV-CICS-RESP = DFHRESP(QIDERR))                          09100000
091100         CONTINUE                                                 09110000
091200     ELSE                                                         09120000
091300         SET DP013-CICS-ABEND      TO TRUE                        09130000
091400         SET DP013-NO-ROLLBACK     TO TRUE                        09140000
091500                                                                  09150000
091600         MOVE '2050-DELETE-LIST-QUEUE'                            09160000
091700                                   TO DP013-PARAGRAPH             09170000
091800         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    09180000
091900                                   TO DP013-MESSAGE-TEXT (1)      09190000
092000         PERFORM DP013-0000-PROCESS-ABEND                         09200000
092100     END-IF.                                                      09210000
092200                                                                  09220000
092300     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  09230000
092400/                                                                 09240000
092500*----------------------------------------------------------------*09250000
092600* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*09260000
092700* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *09270000
092800* CICS ARCHITECTURE API.                                         *09280000
092900*----------------------------------------------------------------*09290000
093000                                                                  09300000
093100 2100-CHECK-FUNCTION-KEY.                                         09310000
093200                                                                  09320000
093300     EVALUATE TRUE                                                09330000
093400                                                                  09340000
093500         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  09350000
093600              MOVE +1               TO PV-TOP-ITEM                09360000
093700              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                09370000
093800                                                                  09380000
093900         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   09390000
094000              PERFORM 2110-BROWSE-BACKWARD                        09400000
094100              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                09410000
094200                                                                  09420000
094300         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   09430000
094400              PERFORM 2120-BROWSE-FORWARD                         09440000
094500              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                09450000
094600                                                                  09460000
094700         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             09470000
094800              IF  ASC-USE-SELECTION-QUEUE                         09480000
094900                  PERFORM 2101-GET-NEXT-AREA                      09490000
095000                  PERFORM 4000-BUILD-INITIAL-PANEL THRU 4000-EXIT 09500000
095100              ELSE                                                09510000
095200*                 --- BOTTOM OF LIST ---                          09520000
095300                  MOVE PC-TSYMSG-00070                            09530000
095400                                   TO DP020-MSG-NUMBER            09540000
095500                  SET DP020-MSG-INFORMATIONAL                     09550000
095600                                   TO TRUE                        09560000
095700                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            09570000
095800              END-IF                                              09580000
095900                                                                  09590000
096000         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             09600000
096100              IF  ASC-USE-SELECTION-QUEUE                         09610000
096200                  PERFORM 2102-GET-PREV-AREA                      09620000
096300                  PERFORM 4000-BUILD-INITIAL-PANEL THRU 4000-EXIT 09630000
096400              ELSE                                                09640000
096500*                 --- TOP OF LIST ---                             09650000
096600                  MOVE PC-TSYMSG-00069                            09660000
096700                                   TO DP020-MSG-NUMBER            09670000
096800                  SET DP020-MSG-INFORMATIONAL                     09680000
096900                                   TO TRUE                        09690000
097000                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            09700000
097100              END-IF                                              09710000
097200                                                                  09720000
097300         WHEN DP020-SRC-AID = DP016-ENTER                         09730000
097400              PERFORM 2130-CHECK-FOR-JUMP-BROWSE                  09740000
097500              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                09750000
097600                                                                  09760000
097700         WHEN DP020-SRC-AID = DP016-PF22                          09770000
097800**            DCDISTRO - RCKCS218                                 09780000
097900                                                                  09790000
098000              IF (RECEIV-PKGNG-CDE = 'M' OR 'I') OR               09800000
098100                 ASC-KEY-PO-LNE-NBR = 0                           09810000
098200                 MOVE PC-TSYMSG-02184  TO DP020-MSG-NUMBER        09820000
098300                 SET DP030-OVERRIDE-GO                            09830000
098400                     DP020-MSG-FATAL TO TRUE                      09840000
098500              ELSE                                                09850000
098600                 MOVE ASC-KEY-PO-NBR   TO PC000-PO-NBR-N          09860000
098700                 MOVE ASC-KEY-PO-LNE-NBR   TO PC000-LINE-NBR-N    09870000
098800                 MOVE ASC-SEL-QUEUE-NAME                          09880000
098900                                   TO PC000-SEL-QUEUE-NAME        09890000
099000                 MOVE ASC-KEY-REC-SEQ-NBR                         09900000
099100                                   TO PC000-REC-SEQ-NBR-N         09910000
099200                 MOVE ASC-KEY-OPER-UNT-ID                         09920000
099300                                   TO PC000-OPERATING-UNIT-ID     09930000
099400                 MOVE ASC-KEY-FCLTY-ID TO PC000-FACILITY-ID       09940000
099500                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                09950000
099600                               TO PC000-NUMBER-OF-SELECTED-ITEMS  09960000
099700                 MOVE ASC-NUMBER-OF-TS-ITEMS                      09970000
099800                                   TO PC000-NUMBER-OF-TS-ITEMS    09980000
099900              END-IF                                              09990000
100000                                                                  10000000
100100                                                                  10010000
100200         WHEN DP020-SRC-AID = DP016-PF23                          10020000
100300*          --- PF23 = PKITEM ---                                  10030000
100400                                                                  10040000
100500              IF ASC-KEY-PO-LNE-NBR = 0 AND                       10050000
100600                 ASC-KEY-PREPK-ID   = 0                           10060000
100700                 MOVE PC-TSYMSG-02185  TO DP020-MSG-NUMBER        10070000
100800                 SET DP030-OVERRIDE-GO                            10080000
100900                     DP020-MSG-WARNING TO TRUE                    10090000
101000              ELSE                                                10100000
101100                 PERFORM 2160-CHECK-TRECEIV-PKGNG-CDE             10110000
101200                 IF (RECEIV-PKGNG-CDE = 'M' OR 'I')               10120000
101300*****               MUST BE A PREPACK TO GO TO RCKCS801 - RCMSPDTL10130000
101400                    INITIALIZE RC800-INTER-APPL-COMMAREA          10140000
101500                    MOVE 1 TO RC800-NUMBER-OF-SELECTED-ITEMS      10150000
101600                              RC800-NUMBER-OF-TS-ITEMS            10160000
101700                    MOVE ASC-KEY-PO-NBR TO RC800-REC-NBR-N        10170000
101800                    MOVE ASC-KEY-REC-SEQ-NBR                      10180000
101900                      TO RC800-REC-SEQ-NBR-N                      10190000
102000                    MOVE ASC-KEY-OPER-UNT-ID                      10200000
102100                      TO RC800-OPER-UNIT-ID                       10210000
102200                    MOVE ASC-KEY-FCLTY-ID TO RC800-FACILITY-ID    10220000
102300                                                                  10230000
102400                    PERFORM 5800-PREP-SEL-QUEUE-PKITEM            10240000
102500                                                                  10250000
102600                    IF PS-ERROR                                   10260000
102700                        MOVE ASC-ITEM-AT-TOP-OF-PANEL             10270000
102800                          TO PV-TOP-ITEM                          10280000
102900                        MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL     10290000
103000                        MOVE +1 TO ASC-BLK-SUB                    10300000
103100                        PERFORM 4410-READ-TEMP-STORAGE            10310000
103200                        ADD +1 TO ASC-BLK-SUB                     10320000
103300                                  PV-BLOCK-NUMBER                 10330000
103400                        PERFORM 4410-READ-TEMP-STORAGE            10340000
103500                        PERFORM 4400-MOVE-COMMAREA-TO-SCREEN      10350000
103600                        SET DP030-OVERRIDE-GO                     10360000
103700                            DP020-MSG-WARNING TO TRUE             10370000
103800                    END-IF                                        10380000
103900                 ELSE                                             10390000
104000                     SET DP030-OVERRIDE-GO TO TRUE                10400000
104100                     SET DP020-MSG-FATAL   TO TRUE                10410000
104200                     MOVE PC-TSYMSG-02185  TO DP020-MSG-NUMBER    10420000
104300                 END-IF                                           10430000
104400              END-IF                                              10440000
104500                                                                  10450000
104600         WHEN OTHER                                               10460000
104700              SET DP013-NO-ROLLBACK                               10470000
104800                  DP013-XCTL-DISPLAY-RESTART                      10480000
104900                  DP013-CICS-ABEND TO TRUE                        10490000
105000              MOVE '2100-CHECK-FUNCTION-KEY'                      10500000
105100                                   TO DP013-PARAGRAPH             10510000
105200              MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'     10520000
105300                                   TO DP013-MESSAGE-TEXT (1)      10530000
105400              PERFORM DP013-0000-PROCESS-ABEND                    10540000
105500     END-EVALUATE.                                                10550000
105600                                                                  10560000
105700*----------------------------------------------------------------*10570000
105800*    RETRIEVE THE NEXT KEY FOR PROCESSING.                       *10580000
105900*----------------------------------------------------------------*10590000
106000                                                                  10600000
106100 2101-GET-NEXT-AREA.                                              10610000
106200                                                                  10620000
106300     ADD +1                        TO  ASC-SEL-SUB.               10630000
106400     IF  ASC-SEL-SUB > TM002-MAX-ITEMS                            10640000
106500         ADD +1                    TO  ASC-SEL-ITEM               10650000
106600         MOVE +1                   TO  ASC-SEL-SUB                10660000
106700     END-IF.                                                      10670000
106800                                                                  10680000
106900     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                10690000
107000         PERFORM 9100-READ-SEL-QUEUE                              10700000
107100         IF DP020-INT-APPL-FORMAT-IND = PC-INTER-APPL-VERIFY-QTY  10710000
107200             IF RC013-ITEM (ASC-SEL-SUB) > ZERO                   10720000
107300                 MOVE RC013-TRIP-ID(ASC-SEL-SUB)                  10730000
107400                                   TO  ASC-KEY-NOTIF-NBR          10740000
107500             END-IF                                               10750000
107600         ELSE                                                     10760000
107700         IF  TM002-ITEM (ASC-SEL-SUB) > ZERO                      10770000
107800             SET TM002-INQ (ASC-SEL-SUB) TO TRUE                  10780000
107900             MOVE TM002-NOTIF-NBR (ASC-SEL-SUB)                   10790000
108000                                   TO ASC-KEY-NOTIF-NBR           10800000
108100             MOVE TM002-PO-NBR (ASC-SEL-SUB)                      10810000
108200                                   TO ASC-KEY-PO-NBR              10820000
108300             MOVE TM002-RCVR-SEQ (ASC-SEL-SUB)                    10830000
108400                                   TO ASC-KEY-REC-SEQ-NBR         10840000
108500             MOVE TM002-PO-LNE-NBR (ASC-SEL-SUB)                  10850000
108600                                   TO ASC-KEY-PO-LNE-NBR          10860000
108700             MOVE TM002-PREPK-ID (ASC-SEL-SUB)                    10870000
108800                                   TO ASC-KEY-PREPK-ID            10880000
108900             MOVE TM002-OPER-UNT-ID (ASC-SEL-SUB)                 10890000
109000                                   TO ASC-KEY-OPER-UNT-ID         10900000
109100             MOVE TM002-FCLTY-ID (ASC-SEL-SUB)                    10910000
109200                                   TO ASC-KEY-FCLTY-ID            10920000
109300             PERFORM 7030-GET-PREPK-DATA                          10930000
109400             PERFORM 7033-SELECT-TALLPLN                          10940000
109500             PERFORM 9200-REWRITE-LIST-QUEUE                      10950000
109600         ELSE                                                     10960000
109700             SUBTRACT +1 FROM ASC-SEL-SUB                         10970000
109800*            --- BOTTOM OF LIST ---                               10980000
109900             MOVE PC-TSYMSG-00070  TO  DP020-MSG-NUMBER           10990000
110000             SET DP020-MSG-INFORMATIONAL                          11000000
110100                                   TO  TRUE                       11010000
110200         END-IF                                                   11020000
110300         END-IF                                                   11030000
110400     ELSE                                                         11040000
110500         SUBTRACT +1 FROM ASC-SEL-ITEM                            11050000
110600         MOVE TM002-MAX-ITEMS      TO  ASC-SEL-SUB                11060000
110700         MOVE PC-TSYMSG-00070      TO  DP020-MSG-NUMBER           11070000
110800         SET DP020-MSG-INFORMATIONAL                              11080000
110900                                   TO  TRUE                       11090000
111000     END-IF.                                                      11100000
111100                                                                  11110000
111200*----------------------------------------------------------------*11120000
111300*    RETRIEVE THE PREVIOUS KEY FOR PROCESSING.                   *11130000
111400*----------------------------------------------------------------*11140000
111500                                                                  11150000
111600 2102-GET-PREV-AREA.                                              11160000
111700                                                                  11170000
111800     SUBTRACT +1 FROM ASC-SEL-SUB.                                11180000
111900     IF  ASC-SEL-SUB < +1                                         11190000
112000         SUBTRACT +1 FROM ASC-SEL-ITEM                            11200000
112100         MOVE TM002-MAX-ITEMS      TO ASC-SEL-SUB                 11210000
112200     END-IF.                                                      11220000
112300                                                                  11230000
112400     IF  ASC-SEL-ITEM > ZERO                                      11240000
112500         PERFORM 9100-READ-SEL-QUEUE                              11250000
112600         MOVE TM002-NOTIF-NBR(ASC-SEL-SUB)                        11260000
112700                                   TO ASC-KEY-NOTIF-NBR           11270000
112800     ELSE                                                         11280000
112900         MOVE +1                   TO ASC-SEL-ITEM                11290000
113000                                      ASC-SEL-SUB                 11300000
113100*        --- TOP OF LIST ---                                      11310000
113200         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            11320000
113300         SET DP020-MSG-INFORMATIONAL                              11330000
113400                                   TO TRUE                        11340000
113500     END-IF.                                                      11350000
113600                                                                  11360000
113700*----------------------------------------------------------------*11370000
113800*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *11380000
113900*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *11390000
114000*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *11400000
114100*    MESSAGE.                                                    *11410000
114200*----------------------------------------------------------------*11420000
114300                                                                  11430000
114400 2110-BROWSE-BACKWARD.                                            11440000
114500                                                                  11450000
114600     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    11460000
114700         GIVING PV-TOP-ITEM.                                      11470000
114800                                                                  11480000
114900     IF  ((PV-TOP-ITEM < +1)                                      11490000
115000       OR (PV-TOP-ITEM = +1))                                     11500000
115100         MOVE +1                   TO PV-TOP-ITEM                 11510000
115200*        -- TOP OF LIST --                                        11520000
115300         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            11530000
115400         SET DP020-MSG-INFORMATIONAL TO TRUE                      11540000
115500     END-IF.                                                      11550000
115600                                                                  11560000
115700/                                                                 11570000
115800*----------------------------------------------------------------*11580000
115900*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *11590000
116000*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *11600000
116100*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *11610000
116200*----------------------------------------------------------------*11620000
116300                                                                  11630000
116400 2120-BROWSE-FORWARD.                                             11640000
116500                                                                  11650000
116600     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              11660000
116700         GIVING PV-TOP-ITEM.                                      11670000
116800     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   11680000
116900         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            11690000
117000                                   TO PV-TOP-ITEM                 11700000
117100*        -- BOTTOM OF LIST --                                     11710000
117200         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            11720000
117300         SET DP020-MSG-INFORMATIONAL                              11730000
117400                                   TO TRUE                        11740000
117500     ELSE                                                         11750000
117600         COMPUTE PV-BOTTOM-ITEM =                                 11760000
117700             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 11770000
117800         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            11780000
117900*            -- BOTTOM OF LIST --                                 11790000
118000             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            11800000
118100             SET DP020-MSG-INFORMATIONAL                          11810000
118200                                   TO TRUE                        11820000
118300         END-IF                                                   11830000
118400     END-IF.                                                      11840000
118500/                                                                 11850000
118600*----------------------------------------------------------------*11860000
118700*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *11870000
118800*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *11880000
118900*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *11890000
119000*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *11900000
119100*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *11910000
119200*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *11920000
119300*----------------------------------------------------------------*11930000
119400                                                                  11940000
119500 2130-CHECK-FOR-JUMP-BROWSE.                                      11950000
119600                                                                  11960000
119700     SET PS-NO-ERROR               TO TRUE.                       11970000
119800     IF (ASC-START-ITEM-REQUEST = SPACE)                          11980000
119900         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            11990000
120000                                   TO PV-TOP-ITEM                 12000000
120100     ELSE                                                         12010000
120200         MOVE ASC-START-ITEM-REQUEST                              12020000
120300                                   TO DP010I-UNEDITED-FIELD       12030000
120400         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       12040000
120500         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     12050000
120600         SET DP010I-NEGATIVE-NOT-ALLOWED                          12060000
120700                                   TO TRUE                        12070000
263627         CALL DP010I-NUMERIC-EDIT-ROUTINE                         12081016
263627              USING DP010I-NUMERIC-EDIT-AREA                      12082016
120900                                                                  12090000
121000         IF  NOT DP010I-ERROR-DETECTED                            12100000
121100             MOVE DP010I-NUMERIC-FIELD                            12110000
121200                                   TO  ASC-START-ITEM-REQUEST-N   12120000
121300             IF  ASC-START-ITEM-REQUEST-N > ZERO                  12130000
121400                 IF  ASC-START-ITEM-REQUEST-N >                   12140000
121500                                          ASC-NUMBER-OF-ITEMS-READ12150000
121600                     MOVE SPACE TO ASC-START-ITEM-REQUEST         12160000
121700                     COMPUTE PV-TOP-ITEM =                        12170000
121800                             ASC-NUMBER-OF-ITEMS-READ             12180000
121900                             - PC-ITEMS-PER-PANEL + 1             12190000
122000                     IF  PV-TOP-ITEM < +1                         12200000
122100                         MOVE +1   TO PV-TOP-ITEM                 12210000
122200                         MOVE PC-TSYMSG-00070                     12220000
122300                                   TO DP020-MSG-NUMBER            12230000
122400                         SET DP020-MSG-INFORMATIONAL              12240000
122500                                   TO TRUE                        12250000
122600                     END-IF                                       12260000
122700                 ELSE                                             12270000
122800                     MOVE ASC-START-ITEM-REQUEST-N                12280000
122900                                   TO PV-TOP-ITEM                 12290000
123000                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      12300000
123100                     COMPUTE PV-BOTTOM-ITEM =                     12310000
123200                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     12320000
123300                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ12330000
123400*                        -- BOTTOM OF LIST --                     12340000
123500                         MOVE PC-TSYMSG-00070                     12350000
123600                                   TO DP020-MSG-NUMBER            12360000
123700                         SET DP020-MSG-INFORMATIONAL              12370000
123800                                   TO TRUE                        12380000
123900                     END-IF                                       12390000
124000                 END-IF                                           12400000
124100             ELSE                                                 12410000
124200*                --- VALUE OUT OF RANGE ----                      12420000
124300                 MOVE PC-TSYMSG-00101                             12430000
124400                                   TO DP020-MSG-NUMBER            12440000
124500                 MOVE DP015-REVERSE                               12450000
124600                                   TO ASTRTITH                    12460000
124700                 MOVE DP015-RED    TO ASTRTITC                    12470000
124800                 MOVE DP015-UNP-NUM-BRT-OFF                       12480000
124900                                   TO ASTRTITA                    12490000
125000                 SET DP020-MSG-FATAL                              12500000
125100                                   TO TRUE                        12510000
125200                 SET PS-ERROR      TO TRUE                        12520000
125300             END-IF                                               12530000
125400                                                                  12540000
125500         ELSE                                                     12550000
125600             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            12560000
125700             MOVE DP015-REVERSE    TO ASTRTITH                    12570000
125800             MOVE DP015-RED        TO ASTRTITC                    12580000
125900             MOVE DP015-UNP-NUM-BRT-OFF                           12590000
126000                                   TO ASTRTITA                    12600000
126100             SET DP020-MSG-FATAL   TO TRUE                        12610000
126200             SET PS-ERROR          TO TRUE                        12620000
126300         END-IF                                                   12630000
126400     END-IF.                                                      12640000
126500                                                                  12650000
126600**#######                                                         12660000
126700                                                                  12670000
126800******************************************************************12680000
126900** ON PF22-HIT, VERIFY ORDER IS NOT A "PREPACK" (ERROR).        **12690000
127000******************************************************************12700000
127100 2160-CHECK-TRECEIV-PKGNG-CDE.                                    12710000
127200                                                                  12720000
127300     INITIALIZE DCLTRECEIV.                                       12730000
127400                                                                  12740000
127500     EXEC SQL                                                     12750000
127600         SELECT PKGNG_CDE                                         12760000
127700           INTO :RECEIV-PKGNG-CDE                                 12770000
127800           FROM TRECEIV                                           12780000
127900          WHERE ORD_NBR        = :ASC-KEY-PO-NBR                  12790000
128000            AND REC_SEQ_NBR    = :ASC-KEY-REC-SEQ-NBR             12800000
128100     END-EXEC.                                                    12810000
128200                                                                  12820000
128300     EVALUATE TRUE                                                12830000
128400       WHEN SQLCODE = ZERO                                        12840000
128500           CONTINUE                                               12850000
128600                                                                  12860000
128700       WHEN SQLWARN0 NOT = SPACE                                  12870000
128800       WHEN SQLCODE  NOT = ZERO                                   12880000
128900           MOVE '2160-CHECK-TRECEIV-PKGNG-CDE' TO DP013-PARAGRAPH 12890000
129000           MOVE 'SELECT TRECEIV' TO DP013-MESSAGE-TEXT (1)        12900000
129100                                                                  12910000
129200           MOVE ASC-KEY-PO-NBR   TO PV-PO-NBR                     12920000
129300           MOVE ASC-KEY-REC-SEQ-NBR   TO PV-REC-SEQ-NBR           12930000
129400           STRING ' RCVR: '            DELIMITED BY SIZE          12940000
129500                  PV-PO-NBR            DELIMITED BY SIZE          12950000
129600                  '-'                  DELIMITED BY SIZE          12960000
129700                  PV-REC-SEQ-NBR DELIMITED BY SIZE                12970000
129800                               INTO DP013-MESSAGE-TEXT (2)        12980000
129900           MOVE SQLCA            TO DP013-SQLCA                   12990000
130000           MOVE 'TRECEIV '       TO DP013-DB2-TABLE-NAME (1)      13000000
130100           SET DP013-DB2-ABEND   TO TRUE                          13010000
130200           PERFORM DP013-0000-PROCESS-ABEND                       13020000
130300     END-EVALUATE.                                                13030000
130400                                                                  13040000
130500                                                                  13050000
130600                                                                  13060000
130700**#######                                                         13070000
130800                                                                  13080000
130900*----------------------------------------------------------------*13090000
131000*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *13100000
131100*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *13110000
131200*----------------------------------------------------------------*13120000
131300                                                                  13130000
131400 2200-MOVE-SCREEN-TO-COMMAREA.                                    13140000
131500                                                                  13150000
131600     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             13160000
131700     MOVE +1                       TO PV-SUB.                     13170000
131800                                                                  13180000
131900     IF  ASTRTITL > ZERO                                          13190000
132000         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          13200000
132100     ELSE                                                         13210000
132200         IF  ASTRTITF EQUAL DP015-ERASE-EOF                       13220000
132300             INITIALIZE ASC-START-ITEM-REQUEST                    13230000
132400         END-IF                                                   13240000
132500     END-IF.                                                      13250000
132600/                                                                 13260000
132700*----------------------------------------------------------------*13270000
132800*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *13280000
132900*    INITIALIZE ALL COUNTERS AND FLAGS.                          *13290000
133000*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *13300000
133100*    DISPLAY THE PANEL TO USER.                                  *13310000
133200*----------------------------------------------------------------*13320000
133300                                                                  13330000
133400 4000-BUILD-INITIAL-PANEL.                                        13340000
133500                                                                  13350000
133600     PERFORM 5120-DELETE-ASC-LISTQ.                               13360000
133700     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            13370000
133800                                 ASC-BLOCK-ENTRIES (2).           13380000
133900     MOVE +1                 TO  ASC-BLK-SUB.                     13390000
134000     SET ASC-ITEMS-LEFT-ON-DB                                     13400000
134100         DP030-SET-CURSOR-TRAILER                                 13410000
134200                             TO  TRUE.                            13420000
134300                                                                  13430000
134400     MOVE +0                 TO  ASC-ITEM-SUB                     13440000
134500                                 ASC-NUMBER-OF-ITEMS-READ         13450000
134600                                 ASC-NUMBER-OF-SELECTED-ITEMS     13460000
134700                                 ASC-HIGHEST-BLOCK-WRITTEN        13470000
134800                                 ASC-START-OF-SELECTED-RANGE      13480000
134900                                 ASC-END-OF-SELECTED-RANGE        13490000
135000                                 ASC-ITEM-AT-TOP-OF-PANEL.        13500000
135100                                                                  13510000
135200*                                                                 13520000
135300*    DUE TO THE DESIGN OF THE TROUBLE NOTIFICATION TABLES, 3      13530000
135400*    PASSES MUST BE MADE IN ORDER TO OBTAIN THE DATA IN THE       13540000
135500*    DESIRED SEQUENCE.  WHEN USING A SELECTION LIST, GET THE      13550000
135600*    PO NUMBER, PO LINE NUMBER, AND RECVR SEQUENCE NUMBER         13560000
135700*    FROM TTRBNTF USING THE NOTIF-NBR AS THE KEY.                 13570000
135800*                                                                 13580000
135900     IF DP020-INT-APPL-FORMAT-IND =  PC-INTER-APPL-VERIFY-QTY     13590000
136000         PERFORM 4350-GET-ONE-DETAIL                              13600000
136100         GO TO 4000-CONTINUE                                      13610000
136200     END-IF.                                                      13620000
136300                                                                  13630000
136400     IF ASC-USE-SELECTION-QUEUE                                   13640000
136500         IF DP020-INT-APPL-FORMAT-IND = PC-INTER-APPL-LIST-PO     13650000
136600           AND ((ASC-KEY-PO-LNE-NBR > ZERO)                       13660000
136700            OR (ASC-KEY-PREPK-ID > ZERO))                         13670000
136800             SET PS-ERROR          TO  TRUE                       13680000
136900             SET DP020-MSG-FATAL   TO  TRUE                       13690000
137000             SET DP020-FK-RETURN (DP020-SRC-AID) TO TRUE          13700000
137100             MOVE PC-TSYMSG-00986  TO  DP020-MSG-NUMBER           13710000
137200             GO TO 4000-EXIT                                      13720000
137300         ELSE                                                     13730000
137400             PERFORM 4200-GET-FIRST-DATA                          13740000
137500             MOVE TRBNTF-TRBL-RSN-CDE TO PV-RSN-CDE-LO            13750000
137600                                        PV-RSN-CDE-HI             13760000
137700             IF PS-DATA-OK                                        13770000
137800                 CONTINUE                                         13780000
137900             ELSE                                                 13790000
138000                 SET DP020-MSG-FATAL TO TRUE                      13800000
138100                 SET DP020-FK-RETURN (DP020-SRC-AID) TO TRUE      13810000
138200                 MOVE PC-TSYMSG-00050 TO DP020-MSG-NUMBER         13820000
138300             END-IF                                               13830000
138400     ELSE                                                         13840000
138500         MOVE PC-ZERO              TO PV-RSN-CDE-LO               13850000
138600         MOVE PC-NINES             TO PV-RSN-CDE-HI               13860000
138700     END-IF.                                                      13870000
138800                                                                  13880000
138900     IF DP020-INT-APPL-FORMAT-IND =  PC-INTER-APPL-VERIFY-QTY     13890000
139000         CONTINUE                                                 13900000
139100     ELSE                                                         13910000
139200         SET PS-USE-ACTIVE         TO  TRUE                       13920000
139300         PERFORM 4010-OPEN-CURSOR                                 13930000
139400         PERFORM 4300-READ-ITEMS-FROM-DB                          13940000
139500         PERFORM 4020-CLOSE-CURSOR                                13950000
139600         PERFORM 4200-GET-FIRST-DATA                              13960000
139700                                                                  13970000
139800         SET PS-USE-RESOLVED                                      13980000
139900             ASC-ITEMS-LEFT-ON-DB  TO  TRUE                       13990000
140000         PERFORM 4010-OPEN-CURSOR                                 14000000
140100         PERFORM 4300-READ-ITEMS-FROM-DB                          14010000
140200         PERFORM 4020-CLOSE-CURSOR                                14020000
140300                                                                  14030000
140400         SET PS-USE-ACKNOWLG                                      14040000
140500             ASC-ITEMS-LEFT-ON-DB  TO  TRUE                       14050000
140600         PERFORM 4010-OPEN-CURSOR                                 14060000
140700         PERFORM 4300-READ-ITEMS-FROM-DB                          14070000
140800         PERFORM 4020-CLOSE-CURSOR                                14080000
140900                                                                  14090000
141000         PERFORM 4200-GET-FIRST-DATA                              14100000
141100         PERFORM 4302-CHECK-TSQ-WRITE                             14110000
141200                                                                  14120000
141300     END-IF.                                                      14130000
141400                                                                  14140000
141500 4000-CONTINUE.                                                   14150000
141600     MOVE +1                   TO  PV-TOP-ITEM.                   14160000
141700     MOVE SPACE                TO  ASC-START-ITEM-REQUEST.        14170000
141800     IF ASC-USE-SELECTION-QUEUE                                   14180000
141900       AND DP020-INT-APPL-FORMAT-IND = PC-INTER-APPL-LIST-PO      14190000
142000       AND ((ASC-KEY-PO-LNE-NBR > ZERO)                           14200000
142100        OR (ASC-KEY-PREPK-ID > ZERO))                             14210000
142200         NEXT SENTENCE                                            14220000
142300     ELSE                                                         14230000
142400     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          14240000
142500         SET DP020-MSG-FATAL   TO  TRUE                           14250000
142600         SET DP020-FK-RETURN (DP020-SRC-AID) TO TRUE              14260000
142700         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               14270000
142800     ELSE                                                         14280000
142900         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     14290000
143000     END-IF.                                                      14300000
143100 4000-EXIT.                                                       14310000
143200     EXIT.                                                        14320000
143300/                                                                 14330000
143400*----------------------------------------------------------------*14340000
143500* OPEN THE CURSOR.                                               *14350000
143600*----------------------------------------------------------------*14360000
143700                                                                  14370000
143800 4010-OPEN-CURSOR.                                                14380000
143900                                                                  14390000
144000     PERFORM                                                      14400000
144100         WITH TEST AFTER                                          14410000
144200         VARYING PV-RETRY-COUNTER                                 14420000
144300         FROM 1 BY 1                                              14430000
144400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               14440000
144500                   OR (SQLCODE = ZERO ))                          14450000
144600                                                                  14460000
144700         EVALUATE TRUE                                            14470000
144800             WHEN PS-USE-ACTIVE                                   14480000
144900                  EXEC SQL                                        14490000
145000                       OPEN CRIT-ACTIVE-CSR                       14500000
145100                  END-EXEC                                        14510000
145200                                                                  14520000
145300             WHEN PS-USE-RESOLVED                                 14530000
145400                  EXEC SQL                                        14540000
145500                       OPEN CRIT-RESOLVED-CSR                     14550000
145600                  END-EXEC                                        14560000
145700                                                                  14570000
145800             WHEN PS-USE-ACKNOWLG                                 14580000
145900                  EXEC SQL                                        14590000
146000                       OPEN CRIT-ACKNOWLG-CSR                     14600000
146100                  END-EXEC                                        14610000
146200         END-EVALUATE                                             14620000
146300                                                                  14630000
146400         EVALUATE TRUE                                            14640000
146500             WHEN SQLCODE = ZERO                                  14650000
146600             WHEN SQLCODE = -904                                  14660000
146700             WHEN SQLCODE = -911                                  14670000
146800             WHEN SQLCODE = -913                                  14680000
146900                  CONTINUE                                        14690000
147000             WHEN SQLWARN0 NOT = SPACES                           14700000
147100             WHEN SQLCODE < ZERO                                  14710000
147200             WHEN SQLCODE > ZERO                                  14720000
147300                  MOVE '4010-OPEN-CURSOR'                         14730000
147400                                       TO DP013-PARAGRAPH         14740000
147500                  MOVE 'OPEN LINE CURSOR - '                      14750000
147600                                       TO DP013-MESSAGE-TEXT (1)  14760000
147700                  MOVE SQLCA       TO DP013-SQLCA                 14770000
147800                  MOVE 'TTRBNTF '  TO DP013-DB2-TABLE-NAME (1)    14780000
147900                  MOVE 'TTRBRSN '  TO DP013-DB2-TABLE-NAME (2)    14790000
148000                  SET DP013-DB2-ABEND                             14800000
148100                      DP013-XCTL-DISPLAY-RESTART TO TRUE          14810000
148200                  PERFORM DP013-0000-PROCESS-ABEND                14820000
148300         END-EVALUATE                                             14830000
148400     END-PERFORM.                                                 14840000
148500                                                                  14850000
148600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        14860000
148700         MOVE '4010-OPEN-CURSOR'       TO DP013-PARAGRAPH         14870000
148800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     14880000
148900                                   TO DP013-MESSAGE-TEXT (1)      14890000
149000         MOVE SQLCA                TO DP013-SQLCA                 14900000
149100         MOVE 'TTRBNTF '           TO DP013-DB2-TABLE-NAME (1)    14910000
149200         MOVE 'TTRBRSN '           TO DP013-DB2-TABLE-NAME (2)    14920000
149300         SET DP013-DB2-ABEND                                      14930000
149400              DP013-XCTL-DISPLAY-RESTART TO TRUE                  14940000
149500         PERFORM DP013-0000-PROCESS-ABEND                         14950000
149600     END-IF.                                                      14960000
149700                                                                  14970000
149800/                                                                 14980000
149900*----------------------------------------------------------------*14990000
150000*                                                                *15000000
150100*    CLOSE THE LINE CURSOR.                                      *15010000
150200*                                                                *15020000
150300*----------------------------------------------------------------*15030000
150400                                                                  15040000
150500 4020-CLOSE-CURSOR.                                               15050000
150600                                                                  15060000
150700     EVALUATE TRUE                                                15070000
150800         WHEN PS-USE-ACTIVE                                       15080000
150900              EXEC SQL                                            15090000
151000                   CLOSE CRIT-ACTIVE-CSR                          15100000
151100              END-EXEC                                            15110000
151200                                                                  15120000
151300         WHEN PS-USE-RESOLVED                                     15130000
151400              EXEC SQL                                            15140000
151500                   CLOSE CRIT-RESOLVED-CSR                        15150000
151600              END-EXEC                                            15160000
151700                                                                  15170000
151800         WHEN PS-USE-ACKNOWLG                                     15180000
151900              EXEC SQL                                            15190000
152000                   CLOSE CRIT-ACKNOWLG-CSR                        15200000
152100              END-EXEC                                            15210000
152200     END-EVALUATE.                                                15220000
152300                                                                  15230000
152400                                                                  15240000
152500     EVALUATE TRUE                                                15250000
152600         WHEN SQLCODE = ZERO                                      15260000
152700             CONTINUE                                             15270000
152800         WHEN SQLWARN0 NOT = SPACES                               15280000
152900         WHEN SQLCODE < ZERO                                      15290000
153000         WHEN SQLCODE > ZERO                                      15300000
153100             MOVE '4020-CLOSE-CURSOR'                             15310000
153200                               TO DP013-PARAGRAPH                 15320000
153300             MOVE 'CLOSE CURSOR '                                 15330000
153400                               TO DP013-MESSAGE-TEXT (1)          15340000
153500             MOVE SQLCA        TO DP013-SQLCA                     15350000
153600             MOVE 'TTRBNTF '   TO DP013-DB2-TABLE-NAME (1)        15360000
153700             MOVE 'TTRBRSN '   TO DP013-DB2-TABLE-NAME (2)        15370000
153800             SET DP013-DB2-ABEND                                  15380000
153900                 DP013-XCTL-DISPLAY-RESTART TO TRUE               15390000
154000             PERFORM DP013-0000-PROCESS-ABEND                     15400000
154100     END-EVALUATE.                                                15410000
154200/                                                                 15420000
154300*----------------------------------------------------------------*15430000
154400*    GET THE 'STATIC' INFORMATION FOR THE TOP OF THE SCREEN.     *15440000
154500*    1ST - ENSURE THE DATA EXISTS.                               *15450000
154600*----------------------------------------------------------------*15460000
154700                                                                  15470000
154800 4200-GET-FIRST-DATA.                                             15480000
154900                                                                  15490000
155000     SET PS-DATA-OK            TO  TRUE.                          15500000
155100                                                                  15510000
155200     PERFORM 4210-GET-TROUBLE-DATA.                               15520000
155300     PERFORM 4220-GET-FACLTY-DATA.                                15530000
155400     PERFORM 4230-GET-ENTNME-DATA.                                15540000
155500     PERFORM 4340-GET-PK-SKU-DATA.                                15550000
155600                                                                  15560000
155700 4210-GET-TROUBLE-DATA.                                           15570000
155800                                                                  15580000
155900     PERFORM                                                      15590000
156000       WITH TEST AFTER                                            15600000
156100         VARYING PV-RETRY-COUNTER FROM 1 BY 1                     15610000
156200           UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)             15620000
156300              OR (SQLCODE = ZERO OR +100))                        15630000
156400                                                                  15640000
156500         EXEC SQL                                                 15650000
156600             SELECT A.PO_NBR                                      15660000
156700                  , A.PO_LNE_NBR                                  15670000
156800                  , A.PREPK_ID                                    15680000
156900                  , A.REC_SEQ_NBR                                 15690000
157000                  , A.OPER_UNT_ID                                 15700000
157100                  , A.FCLTY_ID                                    15710000
157200                  , A.ENT_ID                                      15720000
157300                  , A.TRBL_RSN_CDE                                15730000
157400                  , C.TRBL_LVL_IND                                15740000
157500               INTO :ASC-KEY-PO-NBR                               15750000
157600                  , :ASC-KEY-PO-LNE-NBR                           15760000
157700                  , :ASC-KEY-PREPK-ID                             15770000
157800                  , :ASC-KEY-REC-SEQ-NBR                          15780000
157900                  , :ASC-KEY-OPER-UNT-ID                          15790000
158000                  , :ASC-KEY-FCLTY-ID                             15800000
158100                  , :TRBNTF-ENT-ID                                15810000
158200                  , :TRBNTF-TRBL-RSN-CDE                          15820000
158300                  , :ASC-TRBL-LVL-IND                             15830000
158400               FROM TTRBNTF A                                     15840000
158500                  , TTRBRSN C                                     15850000
158600              WHERE NOTIF_NBR       = :ASC-KEY-NOTIF-NBR          15860000
158700                AND A.TRBL_RSN_CDE  = C.TRBL_RSN_CDE              15870000
158800         END-EXEC                                                 15880000
158900                                                                  15890000
159000         EVALUATE TRUE                                            15900000
159100             WHEN SQLCODE = ZERO                                  15910000
159200             WHEN SQLCODE = -904                                  15920000
159300             WHEN SQLCODE = -911                                  15930000
159400             WHEN SQLCODE = -913                                  15940000
159500                  CONTINUE                                        15950000
159600             WHEN SQLCODE = +100                                  15960000
159700                  SET PS-DATA-NOT-OK TO TRUE                      15970000
159800             WHEN SQLWARN0 NOT = SPACE                            15980000
159900             WHEN SQLCODE NOT = ZERO                              15990000
160000                  MOVE '4210-GET-TROUBLE-DATA'                    16000000
160100                                   TO DP013-PARAGRAPH             16010000
160200                  MOVE 'SELECT HEADER INFORMATION'                16020000
160300                                   TO DP013-MESSAGE-TEXT (1)      16030000
160400                  MOVE SQLCA   TO DP013-SQLCA                     16040000
160500                  MOVE 'TTRBNTF ' TO DP013-DB2-TABLE-NAME (1)     16050000
160600                  MOVE 'TTRBRSN ' TO DP013-DB2-TABLE-NAME (2)     16060000
160700                  SET DP013-DB2-ABEND                             16070000
160800                                   TO TRUE                        16080000
160900                  PERFORM DP013-0000-PROCESS-ABEND                16090000
161000         END-EVALUATE                                             16100000
161100                                                                  16110000
161200     END-PERFORM.                                                 16120000
161300                                                                  16130000
161400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        16140000
161500         MOVE '4210-GET-TRBNTF-DATA'                              16150000
161600                           TO DP013-PARAGRAPH                     16160000
161700         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     16170000
161800                                   TO DP013-MESSAGE-TEXT (1)      16180000
161900         MOVE SQLCA           TO DP013-SQLCA                      16190000
162000         MOVE 'TTRBNTF ' TO DP013-DB2-TABLE-NAME (1)              16200000
162100         SET DP013-DB2-ABEND                                      16210000
162200                           TO TRUE                                16220000
162300         PERFORM DP013-0000-PROCESS-ABEND                         16230000
162400     END-IF.                                                      16240000
162500                                                                  16250000
162600/                                                                 16260000
162700 4220-GET-FACLTY-DATA.                                            16270000
162800                                                                  16280000
162900     INITIALIZE XL071-COMMAREA-REC.                               16290000
163000                                                                  16300000
163100     MOVE ASC-KEY-OPER-UNT-ID   TO PV-UNPACK-OPER-UNT-ID.         16310000
163200     MOVE PV-UNPACK-OPER-UNT-ID TO XL071-LOCATION-NUMBER.         16320000
163300                                                                  16330000
163400                                                                  16340000
163500     CALL XL071-LOCATION-MODULE USING DFHEIBLK                    16350000
163600                                      XL071-COMMAREA              16360000
163700                                      XL071-COMMAREA-REC.         16370000
163800                                                                  16380000
163900     EVALUATE TRUE                                                16390000
164000         WHEN XL071-NO-ERRORS                                     16400000
164100             MOVE XL071-LOC-NM  TO ASC-FCLTY-NME                  16410000
164200         WHEN XL071-LOC-NOT-FOUND                                 16420000
164300         WHEN XL071-SQLCODE-N = -904                              16430000
164400         WHEN XL071-SQLCODE-N = -911                              16440000
164500         WHEN XL071-SQLCODE-N = -913                              16450000
164600             MOVE SPACES TO ASC-FCLTY-NME                         16460000
164700         WHEN XL071-BAD-DB2-RETURN                                16470000
164800             MOVE '4220-GET-FACLTY-DATA'                          16480000
164900                              TO DP013-PARAGRAPH                  16490000
165000             MOVE 'SELECT HEADER INFORMATION'                     16500000
165100                              TO DP013-MESSAGE-TEXT (1)           16510000
165200             MOVE XL071-SQLCA    TO DP013-SQLCA                   16520000
165300             MOVE 'XLT_LOC ' TO DP013-DB2-TABLE-NAME (1)          16530000
165400             SET DP013-DB2-ABEND TO TRUE                          16540000
165500             PERFORM DP013-0000-PROCESS-ABEND                     16550000
165600     END-EVALUATE.                                                16560000
165700                                                                  16570000
165800/                                                                 16580000
165900 4230-GET-ENTNME-DATA.                                            16590000
166000                                                                  16600000
166100     PERFORM                                                      16610000
166200         WITH TEST AFTER                                          16620000
166300         VARYING PV-RETRY-COUNTER                                 16630000
166400         FROM 1 BY 1                                              16640000
166500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               16650000
166600                   OR (SQLCODE = ZERO OR +100))                   16660000
166700                                                                  16670000
166800         EXEC SQL                                                 16680000
166900              SELECT                                              16690000
167000                    ENT_NAME_DESC                                 16700000
167100              INTO :ASC-ENT-NAME-DESC                             16710000
167200              FROM TENTNME                                        16720000
167300              WHERE ENT_ID = :TRBNTF-ENT-ID                       16730000
167400              AND TYPE_CDE = '01'                                 16740000
167500         END-EXEC                                                 16750000
167600                                                                  16760000
167700         EVALUATE TRUE                                            16770000
167800             WHEN SQLCODE = ZERO                                  16780000
167900             WHEN SQLCODE = -904                                  16790000
168000             WHEN SQLCODE = -911                                  16800000
168100             WHEN SQLCODE = -913                                  16810000
168200                  CONTINUE                                        16820000
168300             WHEN SQLCODE = +100                                  16830000
168400                  MOVE SPACES TO ASC-ENT-NAME-DESC                16840000
168500             WHEN SQLWARN0 NOT = SPACE                            16850000
168600             WHEN SQLCODE NOT = ZERO                              16860000
168700                  MOVE '4230-GET-ENTNME-DATA'                     16870000
168800                                   TO DP013-PARAGRAPH             16880000
168900                  MOVE 'SELECT HEADER INFORMATION'                16890000
169000                                   TO DP013-MESSAGE-TEXT (1)      16900000
169100                  MOVE SQLCA   TO DP013-SQLCA                     16910000
169200                  MOVE 'TENTNME ' TO DP013-DB2-TABLE-NAME (1)     16920000
169300                  SET DP013-DB2-ABEND                             16930000
169400                                   TO TRUE                        16940000
169500                  PERFORM DP013-0000-PROCESS-ABEND                16950000
169600         END-EVALUATE                                             16960000
169700     END-PERFORM.                                                 16970000
169800                                                                  16980000
169900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        16990000
170000         MOVE '4220-GET-FACLTY-DATA'                              17000000
170100                                   TO DP013-PARAGRAPH             17010000
170200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     17020000
170300                                   TO DP013-MESSAGE-TEXT (1)      17030000
170400         MOVE SQLCA           TO DP013-SQLCA                      17040000
170500         MOVE 'TENTNME ' TO DP013-DB2-TABLE-NAME (1)              17050000
170600         SET DP013-DB2-ABEND                                      17060000
170700                           TO TRUE                                17070000
170800         PERFORM DP013-0000-PROCESS-ABEND                         17080000
170900     END-IF.                                                      17090000
171000/                                                                 17100000
171100*----------------------------------------------------------------*17110000
171200*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *17120000
171300*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *17130000
171400*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *17140000
171500*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *17150000
171600*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *17160000
171700*                                                                *17170000
171800*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *17180000
171900*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *17190000
172000*    UPON INITIALIZATION.                                        *17200000
172100*----------------------------------------------------------------*17210000
172200                                                                  17220000
172300 4300-READ-ITEMS-FROM-DB.                                         17230000
172400                                                                  17240000
172500     PERFORM                                                      17250000
172600         VARYING PV-READ-COUNT                                    17260000
172700         FROM 1 BY 1                                              17270000
172800         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    17280000
172900            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         17290000
173000                                                                  17300000
173100         PERFORM 4310-FETCH                                       17310000
173200         IF  ASC-ITEMS-LEFT-ON-DB                                 17320000
173300             MOVE PV-NTF-TMST TO PV-TEMP-TMST                     17330000
173400             MOVE PV-NTF-UID  TO PV-TEMP-UID                      17340000
173500             MOVE SPACES      TO PV-FREEFORM-TEXT                 17350000
173600             PERFORM 4320-FORMAT-DETAIL-LINE                      17360000
173700             PERFORM 4303-GET-TRBDTL-ROWS                         17370000
173800             IF PS-USE-ACKNOWLG OR                                17380000
173900               (PS-USE-SELECTION AND                              17390000
174000                PV-RESOLVED-IND = 'A')                            17400000
174100                 MOVE PV-ACKNOWLG-TMST TO PV-TEMP-TMST            17410000
174200                 MOVE PV-ACKNOWLG-UID  TO PV-TEMP-UID             17420000
174300                 MOVE SPACES           TO PV-FREEFORM-TEXT        17430000
174400                 MOVE 'ACKNOWLEDGED'   TO PV-FREEFORM-TEXT        17440000
174500                 PERFORM 4320-FORMAT-DETAIL-LINE                  17450000
174600             END-IF                                               17460000
174700         END-IF                                                   17470000
174800     END-PERFORM.                                                 17480000
174900                                                                  17490000
175000 4301-CHECK-BLOCK.                                                17500000
175100                                                                  17510000
175200     IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                        17520000
175300         ADD +1            TO  ASC-ITEM-SUB                       17530000
175400     ELSE                                                         17540000
175500         ADD +1            TO  ASC-BLK-SUB                        17550000
175600         MOVE +1           TO  ASC-ITEM-SUB                       17560000
175700                                                                  17570000
175800         IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY                 17580000
175900             MOVE +1       TO  ASC-BLK-SUB                        17590000
176000             SET ASC-BLOCK-MODIFIED (1)                           17600000
176100                           TO  TRUE                               17610000
176200             PERFORM 5100-WRITE-TEMP-STORAGE                      17620000
176300             MOVE ASC-BLOCK-ENTRIES(PC-MAX-BLOCKS-IN-ARRAY)       17630000
176400                           TO  ASC-BLOCK-ENTRIES(ASC-BLK-SUB)     17640000
176500             ADD +1        TO  ASC-BLK-SUB                        17650000
176600             INITIALIZE ASC-BLOCK-ENTRIES(ASC-BLK-SUB)            17660000
176700             SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)              17670000
176800                           TO TRUE                                17680000
176900         END-IF                                                   17690000
177000     END-IF.                                                      17700000
177100                                                                  17710000
177200 4302-CHECK-TSQ-WRITE.                                            17720000
177300                                                                  17730000
177400     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          17740000
177500         MOVE +1               TO ASC-BLK-SUB                     17750000
177600         PERFORM 5100-WRITE-TEMP-STORAGE                          17760000
177700         ADD +1                TO ASC-BLK-SUB                     17770000
177800         PERFORM 5100-WRITE-TEMP-STORAGE                          17780000
177900                                                                  17790000
178000         MOVE 1                TO ASC-BLK-SUB                     17800000
178100                                  PV-BLOCK-NUMBER                 17810000
178200         PERFORM 4410-READ-TEMP-STORAGE                           17820000
178300         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             17830000
178400             MOVE 2            TO ASC-BLK-SUB                     17840000
178500                                  PV-BLOCK-NUMBER                 17850000
178600             PERFORM 4410-READ-TEMP-STORAGE                       17860000
178700         END-IF                                                   17870000
178800     END-IF.                                                      17880000
178900 4303-GET-TRBDTL-ROWS.                                            17890000
179000                                                                  17900000
179100     PERFORM                                                      17910000
179200         WITH TEST AFTER                                          17920000
179300         VARYING PV-RETRY-COUNTER                                 17930000
179400         FROM 1 BY 1                                              17940000
179500         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES)                17950000
179600                   OR SQLCODE = ZERO                              17960000
179700                                                                  17970000
179800         EXEC SQL                                                 17980000
179900             OPEN TTRBDTL-CSR                                     17990000
180000         END-EXEC                                                 18000000
180100                                                                  18010000
180200         EVALUATE TRUE                                            18020000
180300             WHEN SQLCODE = ZERO                                  18030000
180400             WHEN SQLCODE = -904                                  18040000
180500             WHEN SQLCODE = -911                                  18050000
180600             WHEN SQLCODE = -913                                  18060000
180700                  CONTINUE                                        18070000
180800             WHEN SQLWARN0 NOT = SPACES                           18080000
180900             WHEN SQLCODE < ZERO                                  18090000
181000             WHEN SQLCODE > ZERO                                  18100000
181100                  MOVE '4303-GET-TRBDTL-ROWS'                     18110000
181200                                       TO DP013-PARAGRAPH         18120000
181300                  MOVE 'OPEN LINE CURSOR - '                      18130000
181400                                       TO DP013-MESSAGE-TEXT (1)  18140000
181500                  MOVE SQLCA       TO DP013-SQLCA                 18150000
181600                  MOVE 'TTRBDTL '  TO DP013-DB2-TABLE-NAME (1)    18160000
181700                  SET DP013-DB2-ABEND                             18170000
181800                      DP013-XCTL-DISPLAY-RESTART TO TRUE          18180000
181900                  PERFORM DP013-0000-PROCESS-ABEND                18190000
182000         END-EVALUATE                                             18200000
182100     END-PERFORM.                                                 18210000
182200                                                                  18220000
182300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        18230000
182400         MOVE '4303-GET-TRBDTL-ROWS'                              18240000
182500                                   TO DP013-PARAGRAPH             18250000
182600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     18260000
182700                                   TO DP013-MESSAGE-TEXT (1)      18270000
182800         MOVE SQLCA           TO DP013-SQLCA                      18280000
182900         MOVE 'TTRBDTL ' TO DP013-DB2-TABLE-NAME (1)              18290000
183000         SET          DP013-DB2-ABEND                             18300000
183100                      DP013-XCTL-DISPLAY-RESTART                  18310000
183200                           TO TRUE                                18320000
183300         PERFORM DP013-0000-PROCESS-ABEND                         18330000
183400     END-IF.                                                      18340000
183500                                                                  18350000
183600     MOVE 'N' TO PS-END-OF-TTRBDTL-CSR-SW                         18360000
183700                 PS-DETAILS-EXIST-SW                              18370000
183800                                                                  18380000
183900     PERFORM                                                      18390000
184000         VARYING PV-READ-COUNT                                    18400000
184100         FROM PV-READ-COUNT BY 1                                  18410000
184200         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    18420000
184300            OR (END-OF-TTRBDTL-CSR))                              18430000
184400                                                                  18440000
184500         PERFORM 4304-FETCH                                       18450000
184600                                                                  18460000
184700         IF SQLCODE = +0                                          18470000
184800             MOVE PV-NTF-TMST TO PV-TEMP-TMST                     18480000
184900             MOVE PV-NTF-UID  TO PV-TEMP-UID                      18490000
185000             PERFORM 4320-FORMAT-DETAIL-LINE                      18500000
185100         END-IF                                                   18510000
185200     END-PERFORM.                                                 18520000
185300                                                                  18530000
185400     EXEC SQL                                                     18540000
185500        CLOSE TTRBDTL-CSR                                         18550000
185600     END-EXEC                                                     18560000
185700                                                                  18570000
185800     EVALUATE TRUE                                                18580000
185900         WHEN SQLCODE = ZERO                                      18590000
186000              CONTINUE                                            18600000
186100         WHEN SQLWARN0 NOT = SPACES                               18610000
186200         WHEN SQLCODE < ZERO                                      18620000
186300         WHEN SQLCODE > ZERO                                      18630000
186400              MOVE '4303-GET-TRBDTL-ROWS'                         18640000
186500                                   TO DP013-PARAGRAPH             18650000
186600              MOVE 'CLOSE CURSOR       '                          18660000
186700                                   TO DP013-MESSAGE-TEXT (1)      18670000
186800              MOVE SQLCA           TO DP013-SQLCA                 18680000
186900              MOVE 'TTRBDTL '      TO DP013-DB2-TABLE-NAME (1)    18690000
187000              SET DP013-DB2-ABEND                                 18700000
187100                  DP013-XCTL-DISPLAY-RESTART TO TRUE              18710000
187200              PERFORM DP013-0000-PROCESS-ABEND                    18720000
187300     END-EVALUATE.                                                18730000
187400                                                                  18740000
187500/                                                                 18750000
187600 4304-FETCH.                                                      18760000
187700                                                                  18770000
187800     EXEC SQL                                                     18780000
187900          FETCH TTRBDTL-CSR                                       18790000
188000          INTO  :PV-NTF-TMST                                      18800000
188100              , :PV-NTF-UID                                       18810000
188200              , :PV-FREEFORM-TEXT                                 18820000
188300     END-EXEC.                                                    18830000
188400                                                                  18840000
188500     EVALUATE TRUE                                                18850000
188600         WHEN SQLCODE = ZERO                                      18860000
188700              SET DETAILS-EXIST TO TRUE                           18870000
188800         WHEN SQLCODE = +100                                      18880000
188900              SET END-OF-TTRBDTL-CSR         TO TRUE              18890000
189000         WHEN SQLWARN0 NOT = SPACE                                18900000
189100         WHEN SQLCODE NOT = ZERO                                  18910000
189200              MOVE '4304-FETCH-CURSOR'                            18920000
189300                               TO DP013-PARAGRAPH                 18930000
189400              MOVE 'FETCH TRDDTL'                                 18940000
189500                               TO DP013-MESSAGE-TEXT (1)          18950000
189600              MOVE SQLCA       TO DP013-SQLCA                     18960000
189700              MOVE 'TTRBDTL '  TO DP013-DB2-TABLE-NAME (1)        18970000
189800              SET DP013-DB2-ABEND                                 18980000
189900                               TO TRUE                            18990000
190000              PERFORM DP013-0000-PROCESS-ABEND                    19000000
190100     END-EVALUATE.                                                19010000
190200/                                                                 19020000
190300*----------------------------------------------------------------*19030000
190400*    FETCH THE CURSOR.                                           *19040000
190500*----------------------------------------------------------------*19050000
190600                                                                  19060000
190700 4310-FETCH.                                                      19070000
190800                                                                  19080000
190900     EVALUATE TRUE                                                19090000
191000         WHEN PS-USE-ACTIVE                                       19100000
191100              PERFORM 4312-GET-ACTIVE-CURSOR                      19110000
191200                                                                  19120000
191300         WHEN PS-USE-RESOLVED                                     19130000
191400              PERFORM 4313-GET-RESOLVED-CURSOR                    19140000
191500                                                                  19150000
191600         WHEN PS-USE-ACKNOWLG                                     19160000
191700              PERFORM 4314-GET-ACKNOWLG-CURSOR                    19170000
191800     END-EVALUATE.                                                19180000
191900                                                                  19190000
192000     EVALUATE TRUE                                                19200000
192100         WHEN SQLCODE = ZERO                                      19210000
192200              IF PV-TRBL-RSN-CPLT-DESC = SPACES                   19220000
192300                 MOVE PV-TRBL-LONG-DESC TO ASC-TROUBLE            19230000
192400              ELSE                                                19240000
192500                 MOVE PV-TRBL-RSN-CPLT-DESC TO ASC-TROUBLE        19250000
192600              END-IF                                              19260000
192700                                                                  19270000
192800         WHEN SQLCODE = +100                                      19280000
192900              SET ASC-NO-ITEMS-LEFT-ON-DB                         19290000
193000                               TO TRUE                            19300000
193100         WHEN SQLWARN0 NOT = SPACE                                19310000
193200         WHEN SQLCODE NOT = ZERO                                  19320000
193300              MOVE '4310-FETCH-CURSOR'                            19330000
193400                               TO DP013-PARAGRAPH                 19340000
193500              MOVE 'FETCH ONE OF FOUR CURSORS'                    19350000
193600                               TO DP013-MESSAGE-TEXT (1)          19360000
193700              MOVE SQLCA       TO DP013-SQLCA                     19370000
193800              MOVE 'TTRBNTF '  TO DP013-DB2-TABLE-NAME (1)        19380000
193900              MOVE 'TTRBRSN '  TO DP013-DB2-TABLE-NAME (2)        19390000
194000              SET DP013-DB2-ABEND                                 19400000
194100                               TO TRUE                            19410000
194200              PERFORM DP013-0000-PROCESS-ABEND                    19420000
194300     END-EVALUATE.                                                19430000
194400/                                                                 19440000
194500 4312-GET-ACTIVE-CURSOR.                                          19450000
194600                                                                  19460000
194700     EXEC SQL                                                     19470000
194800          FETCH                                                   19480000
194900                CRIT-ACTIVE-CSR                                   19490000
195000          INTO                                                    19500000
195100                :PV-TRBL-SHT-DESC                                 19510000
195200              , :PV-TRBL-LONG-DESC                                19520000
195300              , :PV-TRBL-RSN-CPLT-DESC                            19530000
195400              , :ASC-KEY-NOTIF-NBR                                19540000
195500              , :PV-NTF-TMST                                      19550000
195600              , :PV-NTF-UID                                       19560000
195700     END-EXEC.                                                    19570000
195800                                                                  19580000
195900 4313-GET-RESOLVED-CURSOR.                                        19590000
196000                                                                  19600000
196100     EXEC SQL                                                     19610000
196200          FETCH                                                   19620000
196300                CRIT-RESOLVED-CSR                                 19630000
196400          INTO                                                    19640000
196500                :PV-TRBL-SHT-DESC                                 19650000
196600              , :PV-TRBL-LONG-DESC                                19660000
196700              , :PV-TRBL-RSN-CPLT-DESC                            19670000
196800              , :ASC-KEY-NOTIF-NBR                                19680000
196900              , :PV-NTF-TMST                                      19690000
197000              , :PV-NTF-UID                                       19700000
197100              , :PV-RESOLVED-TMST                                 19710000
197200              , :PV-RESOLVED-UID                                  19720000
197300     END-EXEC.                                                    19730000
197400                                                                  19740000
197500 4314-GET-ACKNOWLG-CURSOR.                                        19750000
197600                                                                  19760000
197700     EXEC SQL                                                     19770000
197800          FETCH                                                   19780000
197900                CRIT-ACKNOWLG-CSR                                 19790000
198000          INTO                                                    19800000
198100                :PV-TRBL-SHT-DESC                                 19810000
198200              , :PV-TRBL-LONG-DESC                                19820000
198300              , :PV-TRBL-RSN-CPLT-DESC                            19830000
198400              , :ASC-KEY-NOTIF-NBR                                19840000
198500              , :PV-NTF-TMST                                      19850000
198600              , :PV-NTF-UID                                       19860000
198700              , :PV-RESOLVED-TMST                                 19870000
198800              , :PV-RESOLVED-UID                                  19880000
198900              , :PV-ACKNOWLG-TMST                                 19890000
199000              , :PV-ACKNOWLG-UID                                  19900000
199100     END-EXEC.                                                    19910000
199200                                                                  19920000
199300 4315-GET-USER-NAME.                                              19930000
199400                                                                  19940000
199500     INITIALIZE XL067-USER-COMMAREA.                              19950000
199600                                                                  19960000
199700     SET XL067-BY-USER-ID            TO TRUE.                     19970000
199800     SET XL067-SELECT-KOHLS-USER     TO TRUE.                     19980000
199900                                                                  19990000
200000     MOVE PV-TMP-UID            TO XL067-KEY-USER-ID.             20000000
200100                                                                  20010000
200200     CALL XL067-USER-PGM USING DFHEIBLK                           20020000
200300                               XL067-COMMAREA                     20030000
200400                               XL067-USER-COMMAREA.               20040000
200500                                                                  20050000
200600     EVALUATE TRUE                                                20060000
200700         WHEN XL067-SUCCESSFUL                                    20070000
200800             CONTINUE                                             20080000
200900         WHEN OTHER                                               20090000
201000              DISPLAY '***********************************'       20100000
201100              DISPLAY '****     TMKCS504  ABEND       ****'       20110000
201200              DISPLAY '***********************************'       20120000
201300              DISPLAY '**  PARAGRAPH 4315-GET-USER-NAME **'       20130000
201400              DISPLAY '**  UNSUCCESSFUL CALL TO XLKUT067**'       20140000
201500              DISPLAY '**  SEE PROD COPYBOOK XLWS067    **'       20150000
201600              DISPLAY '**  XL067-RETURN-CODE:'  XL067-RETURN-CODE 20160000
201700              DISPLAY '***********************************'       20170000
201800              MOVE '4315-GET-USER-NAME' TO DP013-PARAGRAPH        20180000
201900              MOVE 'GET NAME OF USER'   TO DP013-MESSAGE-TEXT (1) 20190000
202000              MOVE SQLCA                TO DP013-SQLCA            20200000
202100              MOVE 'MODULE '           TO DP013-DB2-TABLE-NAME (1)20210000
202200              SET DP013-DB2-ABEND       TO TRUE                   20220000
202300              PERFORM DP013-0000-PROCESS-ABEND                    20230000
202400     END-EVALUATE.                                                20240000
202500                                                                  20250000
202600 4320-FORMAT-DETAIL-LINE.                                         20260000
202700                                                                  20270000
202800     IF PV-TEMP-UID-PREFIX = 'TK'                                 20280000
202900     OR PV-TEMP-UID-PREFIX = 'TC'                                 20290000
203000     OR PV-TEMP-UID-PREFIX = 'TV'                                 20300000
203100         MOVE PV-TEMP-UID TO PV-TMP-UID                           20310000
203200         PERFORM 4315-GET-USER-NAME                               20320000
203300         IF XL067-KOHLS-NOT-FOUND                                 20330000
203400            MOVE PV-TMP-UID            TO XL067-FIRST-NAME        20340000
203500            MOVE SPACES                TO XL067-LAST-NAME         20350000
203600         END-IF                                                   20360000
203700     ELSE                                                         20370000
203710         PERFORM 4325-CHECK-IF-RPA-USERID                         20371010
203720                                                                  20372010
204100     END-IF.                                                      20410000
204200                                                                  20420000
204300     PERFORM 4301-CHECK-BLOCK                                     20430000
204400     ADD +1            TO ASC-NUMBER-OF-ITEMS-READ                20440000
204500     MOVE ASC-NUMBER-OF-ITEMS-READ                                20450000
204600                           TO ASC-LIST-ITEM-NUMBER                20460000
204700                              (ASC-BLK-SUB ASC-ITEM-SUB)          20470000
204800                                                                  20480000
204900     MOVE SPACES           TO  PV-WORK-DETAIL-LINE                20490000
205000     MOVE PV-TEMP-TMST     TO  PV-WORK-TMST                       20500000
205100     MOVE PV-WT-MO         TO  PV-SD-MO                           20510000
205200     MOVE PV-WT-DA         TO  PV-SD-DA                           20520000
205300     MOVE PV-WT-YY         TO  PV-SD-YR                           20530000
205400     MOVE PV-WT-HH         TO  PV-SD-HH                           20540000
205500     MOVE PV-WT-MM         TO  PV-SD-MM                           20550000
205600                                                                  20560000
205700     MOVE PV-SCREEN-DISPLAY-DATE                                  20570000
205800                           TO  PV-WD-DATE                         20580000
205900     MOVE PV-SCREEN-DISPLAY-TIME                                  20590000
206000                           TO  PV-WD-TIME                         20600000
206100     STRING XL067-FIRST-NAME   DELIMITED BY '  '                  20610000
206200            ' '                DELIMITED BY SIZE                  20620000
206300            XL067-LAST-NAME    DELIMITED BY SIZE                  20630000
206400                         INTO  PV-WD-TEXT                         20640000
206500     MOVE PV-WORK-DETAIL-LINE                                     20650000
206600                           TO  ASC-SCREEN-LINE                    20660000
206700                               (ASC-BLK-SUB ASC-ITEM-SUB)         20670000
206800*                                                                 20680000
206900*    LOAD THE FREEFORM TEXT                                       20690000
207000*                                                                 20700000
207100     MOVE SPACES           TO  PV-WORK-DETAIL-LINE                20710000
207200                                                                  20720000
207300     PERFORM VARYING PV-SUB                                       20730000
207400         FROM 1 BY 1                                              20740000
207500         UNTIL (PV-SUB GREATER THAN 5                             20750000
207600           OR   PV-TEXT-50 (PV-SUB) EQUAL SPACES)                 20760000
207700                                                                  20770000
207800         PERFORM 4301-CHECK-BLOCK                                 20780000
207900         ADD +1            TO ASC-NUMBER-OF-ITEMS-READ            20790000
208000         MOVE ASC-NUMBER-OF-ITEMS-READ                            20800000
208100                           TO ASC-LIST-ITEM-NUMBER                20810000
208200                              (ASC-BLK-SUB ASC-ITEM-SUB)          20820000
208300         MOVE PV-TEXT-50 (PV-SUB)                                 20830000
208400                           TO  PV-WD-TEXT (5:50)                  20840000
208500         MOVE PV-WORK-DETAIL-LINE                                 20850000
208600                           TO  ASC-SCREEN-LINE                    20860000
208700                               (ASC-BLK-SUB ASC-ITEM-SUB)         20870000
208800     END-PERFORM.                                                 20880000
208801                                                                  20880110
208810 4325-CHECK-IF-RPA-USERID.                                        20881010
208900                                                                  20890000
208901     MOVE PV-TEMP-UID TO WST00010-ATTR-ELEM-TXT-TEXT.             20890113
208902     MOVE length of PV-TEMP-UID                                   20890215
208903                      TO WST00010-ATTR-ELEM-TXT-len.              20890315
208904     MOVE SPACES      to PV-RPA-DESCR                             20890415
208905                                                                  20890515
208906     EXEC SQL                                                     20890615
208907         SELECT  E.ATTR_ELEM_TXT                                  20890715
208908           INTO :PV-RPA-DESCR                                     20890815
208909           FROM                                                   20890915
208910                 WST_INTGRTN_TYP  A                               20891015
208911              ,  WST_ATTR_DEFN    B                               20891115
208912              ,  WST_ATTR_ELEM    C                               20891215
208913              ,  WST_ATTR_ELEM    D                               20891315
208914              ,  WST_ATTR_ELEM    E                               20891415
208915           WHERE                                                  20891515
208916                 A.INTGRTN_TYP_CDE   = 'RPAUSERID'                20891615
208917             AND A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE          20891715
208918             AND B.ATTR_DEFN_SEQ_NBR = 1                          20891815
208919             AND B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE          20891915
208920             AND C.ATTR_DEFN_SEQ_NBR = 1                          20892015
208921             AND B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE          20892115
208922             AND D.ATTR_DEFN_SEQ_NBR = 2                          20892215
208923             AND B.INTGRTN_TYP_CDE   = E.INTGRTN_TYP_CDE          20892315
208924             AND E.ATTR_DEFN_SEQ_NBR = 3                          20892415
208925             AND C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR        20892515
208926             AND C.ATTR_ELEM_SEQ_NBR = E.ATTR_ELEM_SEQ_NBR        20892615
208927             AND C.ATTR_ELEM_TXT                                  20892715
208928                                 = :WST00010-ATTR-ELEM-TXT        20892815
208935     END-EXEC.                                                    20893510
208936                                                                  20893610
208937     EVALUATE TRUE                                                20893710
208938         WHEN SQLCODE = ZERO                                      20893810
208939              MOVE SPACES            TO XL067-FIRST-NAME          20893912
208940              MOVE PV-RPA-DESCR-TEXT TO XL067-FIRST-NAME          20894012
208941              MOVE SPACES            TO XL067-LAST-NAME           20894112
208942                                                                  20894210
208943         WHEN SQLCODE = +100                                      20894310
208944         WHEN SQLCODE = -305                                      20894410
208945              MOVE SPACES       TO XL067-FIRST-NAME               20894510
208946              MOVE 'SYSTEM'     TO XL067-FIRST-NAME               20894610
208947              MOVE SPACES       TO XL067-LAST-NAME                20894710
208948                                                                  20894810
208949         WHEN SQLWARN0 NOT = SPACE                                20894910
208950         WHEN SQLCODE NOT = ZERO                                  20895010
208951              MOVE '4325-CHECK-IF-RPA-USERID'                     20895110
208952                               TO DP013-PARAGRAPH                 20895210
208953              MOVE 'CHECK IF USERID IS RPA'                       20895310
208954                               TO DP013-MESSAGE-TEXT (1)          20895410
208955              MOVE WST00010-ATTR-ELEM-TXT-TEXT                    20895513
208956                               TO DP013-MESSAGE-TEXT (2)          20895613
208957              MOVE SQLCA       TO DP013-SQLCA                     20895710
208958              MOVE 'WST_INTGRTN_TYP' TO DP013-DB2-TABLE-NAME (1)  20895810
208959              MOVE 'WST_ATTR_DEFN  ' TO DP013-DB2-TABLE-NAME (2)  20895910
208960              MOVE 'WST_ATTR_ELEM  ' TO DP013-DB2-TABLE-NAME (3)  20896013
208961              SET DP013-DB2-ABEND                                 20896110
208962                               TO TRUE                            20896210
208963              PERFORM DP013-0000-PROCESS-ABEND                    20896310
208964     END-EVALUATE.                                                20896410
208965                                                                  20896510
209001                                                                  20900110
209010 4340-GET-PK-SKU-DATA.                                            20901010
209100                                                                  20910000
209200     IF ASC-KEY-PREPK-ID = 0                                      20920000
209300        PERFORM 7035-GET-TRECITM                                  20930000
209400     ELSE                                                         20940000
209500        PERFORM 4348-GET-PK-SKU-NBR                               20950000
209600     END-IF.                                                      20960000
209700                                                                  20970000
209800 4344-CALL-XLKUT001.                                              20980000
209900                                                                  20990000
210000     INITIALIZE XL001-ITEM-COMMAREA.                              21000000
210100                                                                  21010000
210200     MOVE ASC-ITM-NBR  TO  XL001-KEY-ITM-NBR.                     21020000
210300                                                                  21030000
210400     SET XL001-BY-ITEM                                            21040000
210500         XL001-SELECT-SKU  TO TRUE.                               21050000
210600                                                                  21060000
210700     CALL XL001-VSM-PGM USING DFHEIBLK                            21070000
210800                              XL001-COMMAREA                      21080000
210900                              XL001-ITEM-COMMAREA.                21090000
211000                                                                  21100000
211100     EVALUATE XL001-SKU-SQLCODE                                   21110000
211200       WHEN +0                                                    21120000
211300           MOVE XL001-SKU-NBR TO ASC-PK-SKU-NBR                   21130000
211400                                                                  21140000
211500       WHEN +100                                                  21150000
211600           MOVE 0 TO ASC-PK-SKU-NBR                               21160000
211700                                                                  21170000
211800       WHEN -904                                                  21180000
211900       WHEN -911                                                  21190000
212000       WHEN -913                                                  21200000
212100            CONTINUE                                              21210000
212200                                                                  21220000
212300       WHEN OTHER                                                 21230000
212400            MOVE '4344-CALL-XLKUT001 '                            21240000
212500                             TO DP013-PARAGRAPH                   21250000
212600            MOVE 'GET PACK SKU NBR'                               21260000
212700                             TO DP013-MESSAGE-TEXT (1)            21270000
212800            MOVE XL001-SKU-SQLCODE TO DP013-SQLCA                 21280000
212900            MOVE 'XLKUT001' TO DP013-DB2-TABLE-NAME (1)           21290000
213000            SET DP013-DB2-ABEND                                   21300000
213100                             TO TRUE                              21310000
213200            PERFORM DP013-0000-PROCESS-ABEND                      21320000
213300                                                                  21330000
213400     END-EVALUATE.                                                21340000
213500                                                                  21350000
213600                                                                  21360000
213700 4348-GET-PK-SKU-NBR.                                             21370000
213800                                                                  21380000
213900     PERFORM                                                      21390000
214000         WITH TEST AFTER                                          21400000
214100         VARYING PV-RETRY-COUNTER                                 21410000
214200         FROM 1 BY 1                                              21420000
214300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               21430000
214400                   OR (SQLCODE = ZERO OR +100))                   21440000
214500                                                                  21450000
214600         EXEC SQL                                                 21460000
214700              SELECT                                              21470000
214800                     PK_SKU_NBR                                   21480000
214900                   , PREPK_DESC                                   21490000
215000              INTO                                                21500000
215100                    :POPRPK-PK-SKU-NBR                            21510000
215200                   ,:POPRPK-PREPK-DESC                            21520000
215300              FROM TPOPRPK                                        21530000
215400                                                                  21540000
215500             WHERE PO_NBR      = :ASC-KEY-PO-NBR                  21550000
215600               AND PO_PREPK_ID = :ASC-KEY-PREPK-ID                21560000
215700                                                                  21570000
215800         END-EXEC                                                 21580000
215900                                                                  21590000
216000         EVALUATE TRUE                                            21600000
216100             WHEN SQLCODE = ZERO                                  21610000
216200                  MOVE POPRPK-PK-SKU-NBR TO ASC-PK-SKU-NBR        21620000
216300                                                                  21630000
216400             WHEN SQLCODE = +100                                  21640000
216500                  MOVE 0 TO ASC-PK-SKU-NBR                        21650000
216600                                                                  21660000
216700             WHEN SQLCODE = -904                                  21670000
216800             WHEN SQLCODE = -911                                  21680000
216900             WHEN SQLCODE = -913                                  21690000
217000                  CONTINUE                                        21700000
217100                                                                  21710000
217200             WHEN SQLWARN0 NOT = SPACE                            21720000
217300             WHEN SQLCODE NOT = ZERO                              21730000
217400                  MOVE '4348-GET-PK-SKU-NBR'                      21740000
217500                                   TO DP013-PARAGRAPH             21750000
217600                  MOVE 'GET PACK SKU NBR'                         21760000
217700                                   TO DP013-MESSAGE-TEXT (1)      21770000
217800                  MOVE SQLCA   TO DP013-SQLCA                     21780000
217900                  MOVE 'TPOPRPK' TO DP013-DB2-TABLE-NAME (1)      21790000
218000                  SET DP013-DB2-ABEND                             21800000
218100                                   TO TRUE                        21810000
218200                  PERFORM DP013-0000-PROCESS-ABEND                21820000
218300         END-EVALUATE                                             21830000
218400     END-PERFORM.                                                 21840000
218500                                                                  21850000
218600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        21860000
218700         MOVE '4348-GET-PK-SKU-NBR'                               21870000
218800                                   TO DP013-PARAGRAPH             21880000
218900         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     21890000
219000                                   TO DP013-MESSAGE-TEXT (1)      21900000
219100         MOVE SQLCA   TO DP013-SQLCA                              21910000
219200         MOVE 'TPOPRPK' TO DP013-DB2-TABLE-NAME (1)               21920000
219300         SET DP013-DB2-ABEND       TO TRUE                        21930000
219400         PERFORM DP013-0000-PROCESS-ABEND                         21940000
219500     END-IF.                                                      21950000
219600                                                                  21960000
219700/                                                                 21970000
219800 4350-GET-ONE-DETAIL.                                             21980000
219900     PERFORM 7000-GET-TTRBDTL.                                    21990000
220000     IF  ASC-ITEMS-LEFT-ON-DB                                     22000000
220100         PERFORM 4220-GET-FACLTY-DATA                             22010000
220200         PERFORM 7010-GET-ENTNME-DATA                             22020000
220300         PERFORM 7020-GET-TTRBRSN-DESC                            22030000
220400         MOVE PV-NTF-TMST TO PV-TEMP-TMST                         22040000
220500         MOVE PV-NTF-UID  TO PV-TEMP-UID                          22050000
220600         PERFORM 4320-FORMAT-DETAIL-LINE.                         22060000
220700                                                                  22070000
220800/                                                                 22080000
220900*----------------------------------------------------------------*22090000
221000* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *22100000
221100*----------------------------------------------------------------*22110000
221200                                                                  22120000
221300 4400-MOVE-COMMAREA-TO-SCREEN.                                    22130000
221400                                                                  22140000
221500     MOVE ASC-FCLTY-NME            TO  AFCLTNMO.                  22150000
221600     MOVE ASC-ENT-NAME-DESC        TO  AVENDNMO.                  22160000
221700     STRING ASC-OVRG '/'                                          22170000
221800            ASC-SHTG '/'                                          22180000
221900            ASC-EXST                                              22190000
222000            DELIMITED BY SIZE                                     22200000
222100            INTO AOVSHTHO.                                        22210000
222200                                                                  22220000
222300     IF ASC-NEW-STR-IND = 'N'                                     22230000
222400        MOVE SPACES TO ANEWSTRO                                   22240000
222500     ELSE                                                         22250000
222600        MOVE 'NEW STORE' TO ANEWSTRO                              22260000
222700     END-IF.                                                      22270000
222800     MOVE ASC-SEASET-SHRT-NM       TO  ASEASONO.                  22280000
222900                                                                  22290000
223000     MOVE ASC-TROUBLE TO ATROUBLO.                                22300000
223100                                                                  22310000
223200     MOVE ASC-KEY-PO-NBR           TO  PV-PR-PO.                  22320000
223300     MOVE ASC-KEY-REC-SEQ-NBR      TO  PV-PR-REC.                 22330000
223400     MOVE PV-PR-PO                 TO  PV-PR-PO-ALL.              22340000
223500     MOVE PV-PR-REC                TO  PV-PR-REC-ALL.             22350000
223600                                                                  22360000
223700     IF (ASC-TRBL-LVL-IND = 'M')                                  22370000
223800         MOVE '0000'               TO  PV-LINE-ALL                22380000
223900         MOVE ASC-KEY-PREPK-ID     TO  PV-UNPACK-NUMERIC          22390000
224000         MOVE PV-UNPACK-NUMERIC    TO  PV-PACK-ALL                22400000
224100     ELSE                                                         22410000
224200         MOVE ASC-KEY-PO-LNE-NBR   TO  PV-UNPACK-NUMERIC          22420000
224300         MOVE PV-UNPACK-NUMERIC    TO  PV-LINE-ALL                22430000
224400         MOVE '0000'               TO  PV-PACK-ALL                22440000
224500     END-IF.                                                      22450000
224600                                                                  22460000
224700     MOVE ASC-PK-SKU-NBR       TO  PV-UNPACK-NUMERIC-8.           22470000
224800     MOVE PV-UNPACK-NUMERIC-8  TO  PV-SKU-ALL.                    22480000
224900     MOVE PV-PO-REC-ALL        TO  APORECO.                       22490000
225000                                                                  22500000
225100     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             22510000
225200         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          22520000
225300         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          22530000
225400             MOVE +1    TO ASC-BLK-SUB                            22540000
225500             PERFORM 5100-WRITE-TEMP-STORAGE                      22550000
225600             ADD +1     TO ASC-BLK-SUB                            22560000
225700             PERFORM 5100-WRITE-TEMP-STORAGE                      22570000
225800             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             22580000
225900                 GIVING PV-BLOCK-NUMBER                           22590000
226000                 REMAINDER PV-REMAINDER                           22600000
226100             IF  PV-REMAINDER > ZERO                              22610000
226200                 ADD +1 TO PV-BLOCK-NUMBER                        22620000
226300             END-IF                                               22630000
226400             MOVE +1    TO ASC-BLK-SUB                            22640000
226500             PERFORM 4410-READ-TEMP-STORAGE                       22650000
226600             ADD +1     TO ASC-BLK-SUB                            22660000
226700                           PV-BLOCK-NUMBER                        22670000
226800             PERFORM 4410-READ-TEMP-STORAGE                       22680000
226900     END-IF.                                                      22690000
227000                                                                  22700000
227100     MOVE +1            TO ASC-BLK-SUB.                           22710000
227200     COMPUTE ASC-ITEM-SUB =                                       22720000
227300         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              22730000
227400         + PC-ITEMS-PER-PANEL).                                   22740000
227500                                                                  22750000
227600     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        22760000
227700         ADD +1         TO ASC-BLK-SUB                            22770000
227800         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            22780000
227900     END-IF.                                                      22790000
228000                                                                  22800000
228100     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           22810000
228200         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                22820000
228300     PERFORM 4420-FORMAT-LIST-LINES                               22830000
228400         VARYING PV-SUB                                           22840000
228500         FROM PC-ITEMS-PER-PANEL BY -1                            22850000
228600         UNTIL PV-SUB < +1.                                       22860000
228700                                                                  22870000
228800     COMPUTE ASC-ITEMS-DISPLAYED =                                22880000
228900         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          22890000
229000     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL.   22900000
229100     IF  PS-NO-ERROR                                              22910000
229200         MOVE PV-TOP-ITEM          TO ASTRTITO                    22920000
229300     END-IF.                                                      22930000
229400     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    22940000
229500     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    22950000
229600     MOVE SPACE                    TO  ASC-START-ITEM-REQUEST.    22960000
229700                                                                  22970000
229800     IF  DP020-MSG-NUMBER-X = SPACE                               22980000
229900         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  22990000
230000*            --- MORE ITEMS TO DISPLAY ----                       23000000
230100             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            23010000
230200             SET DP020-MSG-INFORMATIONAL TO TRUE                  23020000
230300         END-IF                                                   23030000
230400     END-IF.                                                      23040000
230500                                                                  23050000
230600*----------------------------------------------------------------*23060000
230700*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *23070000
230800*----------------------------------------------------------------*23080000
230900                                                                  23090000
231000 4410-READ-TEMP-STORAGE.                                          23100000
231100                                                                  23110000
231200     EXEC CICS                                                    23120000
231300         READQ TS                                                 23130000
231400             QUEUE (ASC-LIST-QUEUE-NAME)                          23140000
231500             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               23150000
231600             ITEM  (PV-BLOCK-NUMBER)                              23160000
231700             RESP  (PV-CICS-RESP)                                 23170000
231800     END-EXEC.                                                    23180000
231900                                                                  23190000
232000     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       23200000
232100       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     23210000
232200         CONTINUE                                                 23220000
232300     ELSE                                                         23230000
232400         SET DP013-CICS-ABEND     TO TRUE                         23240000
232500         SET DP013-NO-ROLLBACK    TO TRUE                         23250000
232600         MOVE '4410-READ-TEMP-STORAGE'                            23260000
232700                                  TO DP013-PARAGRAPH              23270000
232800         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      23280000
232900                                  TO DP013-MESSAGE-TEXT(1)        23290000
233000         PERFORM DP013-0000-PROCESS-ABEND                         23300000
233100     END-IF.                                                      23310000
233200                                                                  23320000
233300     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             23330000
233400                                                                  23340000
233500     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         23350000
233600         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               23360000
233700     END-IF.                                                      23370000
233800/                                                                 23380000
233900*----------------------------------------------------------------*23390000
234000*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *23400000
234100*----------------------------------------------------------------*23410000
234200                                                                  23420000
234300 4420-FORMAT-LIST-LINES.                                          23430000
234400                                                                  23440000
234500     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      23450000
234600         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                23460000
234700         MOVE DP015-ASK-DRK-OFF  TO MR-DETAIL-LINEA   (PV-SUB)    23470000
234800         MOVE SPACE              TO MR-DETAIL-LINE    (PV-SUB)    23480000
234900     ELSE                                                         23490000
235000         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           23500000
235100             MOVE DP015-ASK-NOR-OFF TO MR-DETAIL-LINEA(PV-SUB)    23510000
235200             MOVE ASC-SCREEN-LINE (ASC-BLK-SUB ASC-ITEM-SUB)      23520000
235300                                 TO MR-DETAIL-LINE (PV-SUB)       23530000
235400         END-IF                                                   23540000
235500     END-IF.                                                      23550000
235600                                                                  23560000
235700     SUBTRACT +1 FROM ASC-ITEM-SUB                                23570000
235800     IF  ASC-ITEM-SUB < + 1                                       23580000
235900         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  23590000
236000         MOVE +1                 TO ASC-BLK-SUB                   23600000
236100     END-IF.                                                      23610000
236200                                                                  23620000
236300/                                                                 23630000
236400*----------------------------------------------------------------*23640000
236500*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *23650000
236600*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *23660000
236700*----------------------------------------------------------------*23670000
236800                                                                  23680000
236900 5100-WRITE-TEMP-STORAGE.                                         23690000
237000                                                                  23700000
237100     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     23710000
237200                                   TO PV-LIST-ITEM-NUMBER.        23720000
237300     COMPUTE PV-BLOCK-NUMBER =                                    23730000
237400         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    23740000
237500                                                                  23750000
237600     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             23760000
237700     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             23770000
237800         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      23780000
237900             PERFORM 6105-REWRITE-ASC-LISTQ                       23790000
238000         END-IF                                                   23800000
238100     ELSE                                                         23810000
238200         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       23820000
238300         ASC-HIGHEST-BLOCK-WRITTEN + 1                            23830000
238400         PERFORM 6110-WRITE-ASC-LISTQ                             23840000
238500         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   23850000
238600     END-IF.                                                      23860000
238700                                                                  23870000
238800     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             23880000
238900/                                                                 23890000
239000******************************************************************23900000
239100** DELETE THE LIST TEMP STORAGE QUEUE.                          **23910000
239200******************************************************************23920000
239300                                                                  23930000
239400 5120-DELETE-ASC-LISTQ.                                           23940000
239500                                                                  23950000
239600     EXEC CICS                                                    23960000
239700          DELETEQ TS                                              23970000
239800             QUEUE (ASC-LIST-QUEUE-NAME)                          23980000
239900             RESP  (PV-CICS-RESP)                                 23990000
240000     END-EXEC.                                                    24000000
240100                                                                  24010000
240200     IF (PV-CICS-RESP = DFHRESP (NORMAL)                          24020000
240300     OR  PV-CICS-RESP = DFHRESP (QIDERR))                         24030000
240400         CONTINUE                                                 24040000
240500     ELSE                                                         24050000
240600         SET DP013-CICS-ABEND      TO TRUE                        24060000
240700         SET DP013-NO-ROLLBACK     TO TRUE                        24070000
240800         MOVE '5120-DELETE-ASC-LISTQ'                             24080000
240900                                   TO DP013-PARAGRAPH             24090000
241000         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           24100000
241100                                   TO DP013-MESSAGE-TEXT(1)       24110000
241200         PERFORM DP013-0000-PROCESS-ABEND                         24120000
241300     END-IF.                                                      24130000
241400                                                                  24140000
241500**############                                                    24150000
241600                                                                  24160000
241700                                                                  24170000
241800                                                                  24180000
241900*----------------------------------------------------------------*24190000
242000*----------------------------------------------------------------*24200000
242100 5800-PREP-SEL-QUEUE-PKITEM.                                      24210000
242200                                                                  24220000
242300     MOVE +1                     TO ASC-BLK-SUB.                  24230000
242400     PERFORM 5100-WRITE-TEMP-STORAGE.                             24240000
242500     ADD +1                      TO ASC-BLK-SUB.                  24250000
242600     PERFORM 5100-WRITE-TEMP-STORAGE.                             24260000
242700                                                                  24270000
242800     MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ.                        24280000
242900     MOVE ASC-SEL-QUEUE-NAME-OUT TO RC800-SEL-QUEUE-NAME.         24290000
243000     PERFORM 6010-DELETE-SEL-QUEUE.                               24300000
243100                                                                  24310000
243200     SET ASC-UPDATE-TSQ          TO TRUE.                         24320000
243300                                                                  24330000
243400     SET RC801-IDX               TO 1.                            24340000
243500     MOVE ZERO                   TO RC800-NUMBER-OF-TS-ITEMS.     24350000
243600     INITIALIZE RC801-SELECTED-ITEM-ARRAY.                        24360000
243700                                                                  24370000
243800     PERFORM 5810-FILL-SEL-QUEUE-PKITEM                           24380000
243900       VARYING PV-ITEM FROM 1 BY 1                                24390000
244000         UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.         24400000
244100                                                                  24410000
244200**   IF RC801-IDX > 1                                             24420000
244300**     AND PS-NO-ERROR                                            24430000
244400         PERFORM 5820-WRITE-SEL-QUEUE-PKITEM.                     24440000
244500         ADD +1                  TO RC800-NUMBER-OF-TS-ITEMS.     24450000
244600**   END-IF.                                                      24460000
244700                                                                  24470000
244800 5810-FILL-SEL-QUEUE-PKITEM.                                      24480000
244900                                                                  24490000
245000     MOVE ASC-ITM-NBR                                             24500000
245100       TO RC801-ITEM(RC801-IDX).                                  24510000
245200     MOVE ASC-KEY-PO-LNE-NBR                                      24520000
245300       TO RC801-REC-LNE-NBR (RC801-IDX).                          24530000
245400     MOVE ASC-KEY-NOTIF-NBR                                       24540000
245500       TO RC801-TRBL-NOTIF-NBR (RC801-IDX).                       24550000
245600     IF ASC-KEY-PO-LNE-NBR = ZEROES                               24560000
245700         MOVE ASC-KEY-PREPK-ID                                    24570000
245800           TO RC801-PACK-ID (RC801-IDX)                           24580000
245900     ELSE                                                         24590000
246000         MOVE ASC-KEY-PREPK-ID                                    24600000
246100           TO RC801-PACK-ID (RC801-IDX)                           24610000
246200     END-IF.                                                      24620000
246300                                                                  24630000
246400 5820-WRITE-SEL-QUEUE-PKITEM.                                     24640000
246500                                                                  24650000
246600     MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO RC801-SELECTED-ITEMS.   24660000
246700                                                                  24670000
246800     EXEC CICS                                                    24680000
246900         WRITEQ TS                                                24690000
247000             QUEUE (ASC-SEL-QUEUE-NAME-OUT)                       24700000
247100              FROM (RC801-PREPACK-SELECT-RECORD)                  24710000
247200              ITEM (PV-SEL-QUEUE-ITEM)                            24720000
247300              RESP (PV-CICS-RESP)                                 24730000
247400     END-EXEC.                                                    24740000
247500                                                                  24750000
247600     IF PV-CICS-RESP = DFHRESP (NORMAL)                           24760000
247700         CONTINUE                                                 24770000
247800     ELSE                                                         24780000
247900         SET DP013-CICS-ABEND  TO TRUE                            24790000
248000         SET DP013-NO-ROLLBACK TO TRUE                            24800000
248100         MOVE '5820-WRITE-SEL-QUEUE-PKITEM'                       24810000
248200                               TO DP013-PARAGRAPH                 24820000
248300         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          24830000
248400                               TO DP013-MESSAGE-TEXT(1)           24840000
248500         PERFORM DP013-0000-PROCESS-ABEND                         24850000
248600     END-IF.                                                      24860000
248700                                                                  24870000
248800 6010-DELETE-SEL-QUEUE.                                           24880000
248900                                                                  24890000
249000     EXEC CICS                                                    24900000
249100         DELETEQ TS                                               24910000
249200             QUEUE (ASC-SEL-QUEUE-NAME-OUT)                       24920000
249300             RESP  (PV-CICS-RESP)                                 24930000
249400     END-EXEC.                                                    24940000
249500*                                                                 24950000
249600     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      24960000
249700        (PV-CICS-RESP = DFHRESP(QIDERR)))                         24970000
249800         CONTINUE                                                 24980000
249900     ELSE                                                         24990000
250000         SET DP013-CICS-ABEND TO TRUE                             25000000
250100         SET DP013-NO-ROLLBACK TO TRUE                            25010000
250200         MOVE '6010-DELETE-SEL-QUEUE'                             25020000
250300                        TO DP013-PARAGRAPH                        25030000
250400         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         25040000
250500                        TO DP013-MESSAGE-TEXT (1)                 25050000
250600         PERFORM DP013-0000-PROCESS-ABEND                         25060000
250700     END-IF.                                                      25070000
250800                                                                  25080000
250900                                                                  25090000
251000**############                                                    25100000
251100                                                                  25110000
251200******************************************************************25120000
251300** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **25130000
251400** SPECIFIC COMMAREA.                                           **25140000
251500******************************************************************25150000
251600                                                                  25160000
251700 6105-REWRITE-ASC-LISTQ.                                          25170000
251800                                                                  25180000
251900     EXEC CICS                                                    25190000
252000         WRITEQ TS                                                25200000
252100             QUEUE (ASC-LIST-QUEUE-NAME)                          25210000
252200             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               25220000
252300             ITEM  (PV-BLOCK-NUMBER)                              25230000
252400             REWRITE                                              25240000
252500             RESP  (PV-CICS-RESP)                                 25250000
252600     END-EXEC.                                                    25260000
252700                                                                  25270000
252800     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           25280000
252900         CONTINUE                                                 25290000
253000     ELSE                                                         25300000
253100         SET DP013-CICS-ABEND            TO TRUE                  25310000
253200         SET DP013-NO-ROLLBACK           TO TRUE                  25320000
253300         MOVE '6105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       25330000
253400         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     25340000
253500                                         TO DP013-MESSAGE-TEXT(1) 25350000
253600         PERFORM DP013-0000-PROCESS-ABEND                         25360000
253700     END-IF.                                                      25370000
253800/                                                                 25380000
253900******************************************************************25390000
254000** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **25400000
254100** SPECIFIC COMMAREA.                                           **25410000
254200******************************************************************25420000
254300                                                                  25430000
254400 6110-WRITE-ASC-LISTQ.                                            25440000
254500                                                                  25450000
254600     EXEC CICS                                                    25460000
254700         WRITEQ TS                                                25470000
254800             QUEUE (ASC-LIST-QUEUE-NAME)                          25480000
254900             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               25490000
255000             ITEM  (PV-BLOCK-NUMBER)                              25500000
255100             RESP  (PV-CICS-RESP)                                 25510000
255200     END-EXEC.                                                    25520000
255300     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      25530000
255400         SET DP013-CICS-ABEND      TO TRUE                        25540000
255500         SET DP013-NO-ROLLBACK     TO TRUE                        25550000
255600         MOVE '6110-WRITE-ASC-LISTQ'                              25560000
255700                                   TO DP013-PARAGRAPH             25570000
255800         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           25580000
255900                                   TO DP013-MESSAGE-TEXT(1)       25590000
256000         PERFORM DP013-0000-PROCESS-ABEND                         25600000
256100     END-IF.                                                      25610000
256200/                                                                 25620000
256300 7000-GET-TTRBDTL.                                                25630000
256400     EXEC SQL                                                     25640000
256500         SELECT                                                   25650000
256600             CRE_TMST                                             25660000
256700           , CRE_UID                                              25670000
256800           , FREEFORM_TEXT                                        25680000
256900          INTO                                                    25690000
257000             :PV-NTF-TMST                                         25700000
257100           , :PV-NTF-UID                                          25710000
257200           , :PV-FREEFORM-TEXT                                    25720000
257300          FROM  TTRBDTL                                           25730000
257400          WHERE NOTIF_NBR        =  :ASC-KEY-NOTIF-NBR            25740000
257500     END-EXEC.                                                    25750000
257600                                                                  25760000
257700     EVALUATE TRUE                                                25770000
257800         WHEN SQLCODE = ZERO                                      25780000
257900         WHEN SQLCODE = -811                                      25790000
258000             CONTINUE                                             25800000
258100         WHEN SQLCODE = +100                                      25810000
258200              SET ASC-NO-ITEMS-LEFT-ON-DB                         25820000
258300                               TO TRUE                            25830000
258400         WHEN SQLWARN0 NOT = SPACE                                25840000
258500         WHEN SQLCODE NOT = ZERO                                  25850000
258600              MOVE '7000-GET-TTRBDTL'                             25860000
258700                               TO DP013-PARAGRAPH                 25870000
258800              MOVE 'SELECT TROUBLE DETAIL'                        25880000
258900                               TO DP013-MESSAGE-TEXT (1)          25890000
259000              MOVE SQLCA       TO DP013-SQLCA                     25900000
259100              MOVE 'TTRBDTL '  TO DP013-DB2-TABLE-NAME (1)        25910000
259200              SET DP013-DB2-ABEND                                 25920000
259300                               TO TRUE                            25930000
259400              PERFORM DP013-0000-PROCESS-ABEND                    25940000
259500     END-EVALUATE.                                                25950000
259600/                                                                 25960000
259700 7010-GET-ENTNME-DATA.                                            25970000
259800                                                                  25980000
259900     EXEC SQL                                                     25990000
260000          SELECT                                                  26000000
260100                A.ENT_NAME_DESC                                   26010000
260200          INTO :ASC-ENT-NAME-DESC                                 26020000
260300          FROM TENTNME A                                          26030000
260400             , TTRBNTF B                                          26040000
260500          WHERE A.ENT_ID = B.ENT_ID                               26050000
260600          AND B.NOTIF_NBR = :ASC-KEY-NOTIF-NBR                    26060000
260700          AND A.TYPE_CDE = '01'                                   26070000
260800     END-EXEC                                                     26080000
260900                                                                  26090000
261000     EVALUATE TRUE                                                26100000
261100         WHEN SQLCODE = ZERO                                      26110000
261200                  CONTINUE                                        26120000
261300         WHEN SQLCODE = +100                                      26130000
261400                  MOVE SPACES TO ASC-ENT-NAME-DESC                26140000
261500         WHEN SQLWARN0 NOT = SPACE                                26150000
261600         WHEN SQLCODE NOT = ZERO                                  26160000
261700              MOVE '7010-GET-ENTNME-DATA'                         26170000
261800                                   TO DP013-PARAGRAPH             26180000
261900              MOVE 'SELECT HEADER INFORMATION'                    26190000
262000                                   TO DP013-MESSAGE-TEXT (1)      26200000
262100              MOVE SQLCA   TO DP013-SQLCA                         26210000
262200              MOVE 'TENTNME ' TO DP013-DB2-TABLE-NAME (1)         26220000
262300              SET DP013-DB2-ABEND  TO TRUE                        26230000
262400                  PERFORM DP013-0000-PROCESS-ABEND                26240000
262500     END-EVALUATE.                                                26250000
262600/                                                                 26260000
262700 7020-GET-TTRBRSN-DESC.                                           26270000
262800     EXEC SQL                                                     26280000
262900         SELECT                                                   26290000
263000             B.TRBL_LONG_DESC                                     26300000
263100            ,B.TRBL_SHT_DESC                                      26310000
263200            ,B.TRBL_RSN_CPLT_DESC                                 26320000
263300          INTO                                                    26330000
263400             :PV-TRBL-LONG-DESC                                   26340000
263500            ,:PV-TRBL-SHT-DESC                                    26350000
263600            ,:PV-TRBL-RSN-CPLT-DESC                               26360000
263700          FROM                                                    26370000
263800             TTRBNTF A                                            26380000
263900           , TTRBRSN B                                            26390000
264000          WHERE A.NOTIF_NBR        = :ASC-KEY-NOTIF-NBR           26400000
264100            AND A.TRBL_RSN_CDE     = B.TRBL_RSN_CDE               26410000
264200     END-EXEC.                                                    26420000
264300                                                                  26430000
264400     EVALUATE TRUE                                                26440000
264500         WHEN SQLCODE = ZERO                                      26450000
264600         WHEN SQLCODE = -811                                      26460000
264700             CONTINUE                                             26470000
264800         WHEN SQLCODE = +100                                      26480000
264900              MOVE ALL '?'     TO PV-TRBL-SHT-DESC                26490000
265000         WHEN SQLWARN0 NOT = SPACE                                26500000
265100         WHEN SQLCODE NOT = ZERO                                  26510000
265200              MOVE '7020-GET-TTRBRSN-DESC'                        26520000
265300                               TO DP013-PARAGRAPH                 26530000
265400              MOVE 'SELECT TROUBLE DETAIL'                        26540000
265500                               TO DP013-MESSAGE-TEXT (1)          26550000
265600              MOVE SQLCA       TO DP013-SQLCA                     26560000
265700              MOVE 'TTRBNTF '  TO DP013-DB2-TABLE-NAME (1)        26570000
265800              MOVE 'TTRBRSN '  TO DP013-DB2-TABLE-NAME (2)        26580000
265900              SET DP013-DB2-ABEND                                 26590000
266000                               TO TRUE                            26600000
266100              PERFORM DP013-0000-PROCESS-ABEND                    26610000
266200     END-EVALUATE.                                                26620000
266300/                                                                 26630000
266400 7030-GET-PREPK-DATA.                                             26640000
266500                                                                  26650000
266600     IF ASC-KEY-PO-LNE-NBR NOT > ZERO                             26660000
266700       AND ASC-KEY-PREPK-ID > ZERO                                26670000
266800         PERFORM 7031-GET-DRIVER-LINE                             26680000
266900     END-IF.                                                      26690000
267000                                                                  26700000
267100     IF ASC-KEY-PO-LNE-NBR > ZERO                                 26710000
267200         EXEC SQL                                                 26720000
267300             SELECT  A.PO_PREPK_ID                                26730000
267400               INTO  :ASC-KEY-PREPK-ID                            26740000
267500               FROM  TPURITM A                                    26750000
267600              WHERE  A.PO_NBR          = :ASC-KEY-PO-NBR          26760000
267700                AND  A.APP_PO_LNE_NBR  = :ASC-KEY-PO-LNE-NBR      26770000
267800                AND  A.VER_STATUS_CDE  = 'A'                      26780000
267900         END-EXEC                                                 26790000
268000                                                                  26800000
268100         EVALUATE TRUE                                            26810000
268200           WHEN SQLCODE = ZERO                                    26820000
268300               CONTINUE                                           26830000
268400           WHEN SQLCODE = +100                                    26840000
268500           WHEN SQLCODE = -811                                    26850000
268600           WHEN SQLWARN0 NOT = SPACE                              26860000
268700           WHEN SQLCODE  NOT = ZERO                               26870000
268800               MOVE '7030-GET-PREPK-DATA' TO DP013-PARAGRAPH      26880000
268900               MOVE 'SELECT PURCHASE ITEM'                        26890000
269000                                   TO DP013-MESSAGE-TEXT (1)      26900000
269100               MOVE SQLCA          TO DP013-SQLCA                 26910000
269200               MOVE 'TPURITM '     TO DP013-DB2-TABLE-NAME (1)    26920000
269300               SET DP013-DB2-ABEND TO TRUE                        26930000
269400               PERFORM DP013-0000-PROCESS-ABEND                   26940000
269500         END-EVALUATE                                             26950000
269600     END-IF.                                                      26960000
269700                                                                  26970000
269800 7031-GET-DRIVER-LINE.                                            26980000
269900                                                                  26990000
270000     EXEC SQL                                                     27000000
270100         SELECT DISTINCT                                          27010000
270200                ORD_LNE_NBR                                       27020000
270300           INTO :ASC-KEY-PO-LNE-NBR                               27030000
270400           FROM TRECITM                                           27040000
270500          WHERE ORD_NBR            = :ASC-KEY-PO-NBR              27050000
270600            AND REC_SEQ_NBR        = :ASC-KEY-REC-SEQ-NBR         27060000
270700            AND OPER_UNT_ID        = :ASC-KEY-OPER-UNT-ID         27070000
270800            AND PREPK_ID           = :ASC-KEY-PREPK-ID            27080000
270900            AND PREPK_DRV_LNE_CDE  = 'A'                          27090000
271000     END-EXEC.                                                    27100000
271100                                                                  27110000
271200     EVALUATE TRUE                                                27120000
271300       WHEN SQLCODE = ZERO OR -811                                27130000
271400           CONTINUE                                               27140000
271500                                                                  27150000
271600       WHEN SQLCODE = +100                                        27160000
271700           PERFORM 7032-GET-MIN-LINE                              27170000
271800                                                                  27180000
271900       WHEN SQLWARN0 NOT = SPACE                                  27190000
272000       WHEN SQLCODE  NOT = ZERO                                   27200000
272100           MOVE '7031-GET-DRIVER-LINE' TO DP013-PARAGRAPH         27210000
272200           MOVE 'SELECT RECEIVER ITEM' TO DP013-MESSAGE-TEXT (1)  27220000
272300           MOVE SQLCA      TO DP013-SQLCA                         27230000
272400           MOVE 'TRECITM ' TO DP013-DB2-TABLE-NAME (1)            27240000
272500           SET DP013-DB2-ABEND         TO TRUE                    27250000
272600           PERFORM DP013-0000-PROCESS-ABEND                       27260000
272700     END-EVALUATE.                                                27270000
272800                                                                  27280000
272900 7032-GET-MIN-LINE.                                               27290000
273000                                                                  27300000
273100     EXEC SQL                                                     27310000
273200         SELECT DISTINCT                                          27320000
273300                MIN(PO_LNE_NBR)                                   27330000
273400           INTO :ASC-KEY-PO-LNE-NBR                               27340000
273500           FROM TPURITM                                           27350000
273600          WHERE PO_NBR            = :ASC-KEY-PO-NBR               27360000
273700            AND PO_PREPK_ID       = :ASC-KEY-PREPK-ID             27370000
273800            AND VER_STATUS_CDE    = 'A'                           27380000
273900     END-EXEC.                                                    27390000
274000                                                                  27400000
274100     EVALUATE TRUE                                                27410000
274200       WHEN SQLCODE = ZERO OR -811                                27420000
274300           CONTINUE                                               27430000
274400       WHEN SQLCODE = -305                                        27440000
274500           MOVE +0 TO ASC-KEY-PO-LNE-NBR                          27450000
274600                                                                  27460000
274700       WHEN SQLCODE = +100                                        27470000
274800       WHEN SQLWARN0 NOT = SPACE                                  27480000
274900       WHEN SQLCODE  NOT = ZERO                                   27490000
275000           MOVE '7032-GET-MIN-LINE   ' TO DP013-PARAGRAPH         27500000
275100           MOVE 'SELECT PURITM ITEM  ' TO DP013-MESSAGE-TEXT (1)  27510000
275200           MOVE SQLCA      TO DP013-SQLCA                         27520000
275300           MOVE 'TPURITM ' TO DP013-DB2-TABLE-NAME (1)            27530000
275400           SET DP013-DB2-ABEND         TO TRUE                    27540000
275500           PERFORM DP013-0000-PROCESS-ABEND                       27550000
275600     END-EVALUATE.                                                27560000
275700                                                                  27570000
275800 7033-SELECT-TALLPLN.                                             27580000
275900                                                                  27590000
276000     EXEC SQL                                                     27600000
276100         SELECT  SHTG_PRRT_OPT_CDE                                27610000
276200                ,OVRG_PRRT_OPT_CDE                                27620000
276300                ,EXST_SHTG_THRS_IND                               27630000
276400           INTO  :ALLPLN-SHTG-PRRT-OPT-CDE                        27640000
276500                ,:ALLPLN-OVRG-PRRT-OPT-CDE                        27650000
276600                ,:ALLPLN-EXST-SHTG-THRS-IND                       27660000
276700                                                                  27670000
276800           FROM  TPURITM A                                        27680000
276900                ,TALLPLN B                                        27690000
277000                                                                  27700000
277100          WHERE  A.PO_NBR          = :ASC-KEY-PO-NBR              27710000
277200            AND  A.APP_PO_LNE_NBR  = :ASC-KEY-PO-LNE-NBR          27720000
277300            AND  A.VER_STATUS_CDE  = :PC-A                        27730000
277400            AND  B.STATUS_CDE      = :PC-AC                       27740000
277500            AND  A.PO_NBR          = B.PO_NBR                     27750000
277600            AND  A.PO_LNE_NBR      = B.PO_LNE_NBR                 27760000
277700            AND  B.DEST_NBR        = :ASC-KEY-OPER-UNT-ID         27770000
277800     END-EXEC                                                     27780000
277900                                                                  27790000
278000     EVALUATE TRUE                                                27800000
278100       WHEN SQLCODE = ZERO                                        27810000
278200           MOVE ALLPLN-SHTG-PRRT-OPT-CDE  TO ASC-SHTG             27820000
278300           MOVE ALLPLN-OVRG-PRRT-OPT-CDE  TO ASC-OVRG             27830000
278400           MOVE ALLPLN-EXST-SHTG-THRS-IND TO ASC-EXST             27840000
278500           STRING ALLPLN-OVRG-PRRT-OPT-CDE  '/'                   27850000
278600                  ALLPLN-SHTG-PRRT-OPT-CDE  '/'                   27860000
278700                  ALLPLN-EXST-SHTG-THRS-IND                       27870000
278800                  DELIMITED BY SIZE                               27880000
278900                  INTO AOVSHTHO                                   27890000
279000                                                                  27900000
279100       WHEN SQLCODE = +100                                        27910000
279200           MOVE SPACES TO AOVSHTHO                                27920000
279300                                                                  27930000
279400       WHEN SQLCODE = -811                                        27940000
279500       WHEN SQLWARN0 NOT = SPACE                                  27950000
279600       WHEN SQLCODE  NOT = ZERO                                   27960000
279700           MOVE '7033-SELECT-TALLPLN' TO DP013-PARAGRAPH          27970000
279800           MOVE 'SELECT              '                            27980000
279900                               TO DP013-MESSAGE-TEXT (1)          27990000
280000           MOVE SQLCA          TO DP013-SQLCA                     28000000
280100           MOVE 'TALLPLN '     TO DP013-DB2-TABLE-NAME (1)        28010000
280200           SET DP013-DB2-ABEND TO TRUE                            28020000
280300           PERFORM DP013-0000-PROCESS-ABEND                       28030000
280400     END-EVALUATE.                                                28040000
280500                                                                  28050000
280600 7035-GET-TRECITM.                                                28060000
280700                                                                  28070000
280800     EXEC SQL                                                     28080000
280900         SELECT                                                   28090000
281000                ITM_NBR                                           28100000
281100               ,PREPK_ID                                          28110000
281200           INTO                                                   28120000
281300                :ASC-ITM-NBR                                      28130000
281400               ,:ASC-KEY-PREPK-ID                                 28140000
281500           FROM TRECITM                                           28150000
281600          WHERE ORD_NBR            = :ASC-KEY-PO-NBR              28160000
281700            AND ORD_LNE_NBR        = :ASC-KEY-PO-LNE-NBR          28170000
281800            AND REC_SEQ_NBR        = :ASC-KEY-REC-SEQ-NBR         28180000
281900            AND OPER_UNT_ID        = :ASC-KEY-OPER-UNT-ID         28190000
282000            AND FCLTY_ID           = :ASC-KEY-FCLTY-ID            28200000
282100            AND VER_STATUS_CDE     = :PC-A                        28210000
282200     END-EXEC.                                                    28220000
282300                                                                  28230000
282400     EVALUATE TRUE                                                28240000
282500       WHEN SQLCODE = ZERO OR -811                                28250000
282600            PERFORM 4344-CALL-XLKUT001                            28260000
282700                                                                  28270000
282800       WHEN SQLCODE = +100                                        28280000
282900            CONTINUE                                              28290000
283000                                                                  28300000
283100       WHEN SQLWARN0 NOT = SPACE                                  28310000
283200       WHEN SQLCODE  NOT = ZERO                                   28320000
283300           MOVE '7035-GET-TRECITM    ' TO DP013-PARAGRAPH         28330000
283400           MOVE 'SELECT RECEIVER ITEM' TO DP013-MESSAGE-TEXT (1)  28340000
283500           MOVE SQLCA      TO DP013-SQLCA                         28350000
283600           MOVE 'TRECITM ' TO DP013-DB2-TABLE-NAME (1)            28360000
283700           SET DP013-DB2-ABEND         TO TRUE                    28370000
283800           PERFORM DP013-0000-PROCESS-ABEND                       28380000
283900     END-EVALUATE.                                                28390000
284000                                                                  28400000
284100*----------------------------------------------------------------*28410000
284200* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *28420000
284300*----------------------------------------------------------------*28430000
284400                                                                  28440000
284500 9100-READ-SEL-QUEUE.                                             28450000
284600                                                                  28460000
284700     IF DP020-INT-APPL-FORMAT-IND =  PC-INTER-APPL-VERIFY-QTY     28470000
284800     EXEC CICS                                                    28480000
284900         READQ TS                                                 28490000
285000             QUEUE (ASC-SEL-QUEUE-NAME)                           28500000
285100             INTO  (RC013-DC-SELECT-RECORD)                       28510000
285200             ITEM  (ASC-SEL-ITEM)                                 28520000
285300             RESP  (PV-CICS-RESP)                                 28530000
285400     END-EXEC                                                     28540000
285500     ELSE                                                         28550000
285600     EXEC CICS                                                    28560000
285700         READQ TS                                                 28570000
285800             QUEUE (ASC-SEL-QUEUE-NAME)                           28580000
285900             INTO  (TM002-MESSAGE-SEL-REC)                        28590000
286000             ITEM  (ASC-SEL-ITEM)                                 28600000
286100             RESP  (PV-CICS-RESP)                                 28610000
286200     END-EXEC                                                     28620000
286300     END-IF                                                       28630000
286400                                                                  28640000
286500     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       28650000
286600         CONTINUE                                                 28660000
286700     ELSE                                                         28670000
286800         SET DP013-LOGIC-ABEND                                    28680000
286900             DP013-NO-ROLLBACK     TO TRUE                        28690000
287000         MOVE '9100-READ-SEL-QUEUE'                               28700000
287100                                   TO DP013-PARAGRAPH             28710000
287200         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   28720000
287300                                   TO DP013-MESSAGE-TEXT (1)      28730000
287400         PERFORM DP013-0000-PROCESS-ABEND                         28740000
287500     END-IF.                                                      28750000
287600                                                                  28760000
287700*----------------------------------------------------------------*28770000
287800* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *28780000
287900*----------------------------------------------------------------*28790000
288000                                                                  28800000
288100 9200-REWRITE-LIST-QUEUE.                                         28810000
288200                                                                  28820000
288300     EXEC CICS                                                    28830000
288400          WRITEQ TS                                               28840000
288500              QUEUE  (ASC-SEL-QUEUE-NAME)                         28850000
288600              FROM   (TM002-MESSAGE-SEL-REC)                      28860000
288700              ITEM   (ASC-SEL-ITEM)                               28870000
288800              RESP   (PV-CICS-RESP)                               28880000
288900              REWRITE                                             28890000
289000     END-EXEC.                                                    28900000
289100                                                                  28910000
289200     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   28920000
289300         SET DP013-CICS-ABEND                                     28930000
289400             DP013-NO-ROLLBACK     TO TRUE                        28940000
289500         MOVE '9200-REWRITE-LIST-QUEUE'                           28950000
289600                                   TO DP013-PARAGRAPH             28960000
289700         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   28970000
289800                                   TO DP013-MESSAGE-TEXT (1)      28980000
289900         PERFORM DP013-0000-PROCESS-ABEND                         28990000
290000     END-IF.                                                      29000000
290100/                                                                 29010000
290200*----------------------------------------------------------------*29020000
290300*    THE DB2 RESOURCE IS NOT AVAILABLE, SET THE ERROR MESSAGE    *29030000
290400*    AND THE ERROR SWITCHES.                                     *29040000
290500*----------------------------------------------------------------*29050000
290600                                                                  29060000
290700 9900-SOFT-ABORT.                                                 29070000
290800                                                                  29080000
290900     SET PS-ERROR                TO  TRUE.                        29090000
291000     SET DP020-MSG-FATAL         TO  TRUE.                        29100000
291100     MOVE PC-TSYMSG-00551        TO  DP020-MSG-NUMBER.            29110000
291200/                                                                 29120000
291300*----------------------------------------------------------------*29130000
291400*    ABEND PROCESSOR MODULE                                      *29140000
291500*----------------------------------------------------------------*29150000
291600                                                                  29160000
291700     COPY DPPD013.                                                29170000
