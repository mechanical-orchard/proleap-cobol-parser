000100*-----------------------*                                         00010004
000200 IDENTIFICATION DIVISION.                                         00020004
000300*-----------------------*                                         00030004
000400 PROGRAM-ID.    CNKCS234.                                         00040004
000500 AUTHOR.        DENISE HAHN                                       00050005
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060004
000700 DATE-WRITTEN.  AUGUST, 2012                                      00070005
000800 DATE-COMPILED.                                                   00080004
000900*---------------------------------------------------------------* 00090004
001000*    Y234 - DC-PARM CODE DEFINITION (TKRPRCD) - ADD -OR- UPDATE   00100011
001100*    THIS PROGRAM WILL PROCESS THE CODE ADD, UPDATE.              00110006
001200*    WHEN THE ASSOCIATE SELECTS F13-ADD, OR F15-UPDATE, FROM      00120004
001300*    THE CRIT SPEC SCREEN (CNKCS233). OR THEY CAN GO TO F17-LIST  00130006
001400*    F17 - CODE LIST  (CNKCS234)                                  00140006
001500*---------------------------------------------------------------* 00150004
CICS  * CHANGED 10/25/2022    BY JIM HUNTER      WR: CHG0276961         00151038
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00152038
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00153038
CICS  *-----------------------------------------------------------------00154038
001600 ENVIRONMENT DIVISION.                                            00160004
001700 DATA DIVISION.                                                   00170004
001800                                                                  00180004
001900 WORKING-STORAGE SECTION.                                         00190004
002000                                                                  00200004
002100 01  DK-DB2-KEYS.                                                 00210004
002200     05  DK-PARM-CODE             PIC   X(06)       VALUE SPACES. 00220011
002300                                                                  00230004
002400 01  PC-PROGRAM-CONSTANTS.                                        00240004
002500     05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'CNKCS234'.  00250004
002600     05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'CNK234  '.  00260004
002700     05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'CNKM234 '.  00270004
002800     05  PC-APPL-MAP              PIC S9(04)  VALUE  +1           00280004
002900                                              COMP.               00290004
003000     05  PC-MAX-RETRIES           PIC S9(04)  VALUE  +3           00300004
003100                                              COMP.               00310004
003200     05  PC-INTER-APPL-CODES.                                     00320004
003300         10  PC-INTER-APPL-CRIT-SPEC-UPD  PIC  X(01)  VALUE '1'.  00330004
003400         10  PC-INTER-APPL-CRIT-SPEC-ADD  PIC  X(01)  VALUE '1'.  00340004
003500         10  PC-INTER-APPL-LIST-ADD       PIC  X(01)  VALUE '1'.  00350004
003600         10  PC-INTER-APPL-LIST-UPDATE    PIC  X(01)  VALUE '2'.  00360004
003700     05  PC-D                     PIC  X(01)  VALUE  'D'.         00370004
003800     05  PC-I                     PIC  X(01)  VALUE  'I'.         00380004
003900     05  PC-L                     PIC  X(01)  VALUE  'L'.         00390004
004000     05  PC-N                     PIC  X(01)  VALUE  'N'.         00400004
004100     05  PC-UPDATE                PIC  X(02)  VALUE  'UP'.        00410019
004200     05  PC-SPACE                 PIC  X(03)  VALUE  '   '.       00420004
004300     05  PC-01                    PIC  X(02)  VALUE  '01'.        00430004
004400     05  PC-DC                    PIC  X(02)  VALUE  'DC'.        00440004
004500     05  PC-DS                    PIC  X(02)  VALUE  'DS'.        00450004
004600     05  PC-SH                    PIC  X(02)  VALUE  'SH'.        00460004
004700     05  PC-DEFAULT-TIMESTAMP     PIC  X(26)                      00470004
004800                          VALUE  '9999-09-09-09.09.09.999999'.    00480004
004900                                                                  00490004
005000*----------------------------------------------------------------*00500004
005100*  SYSTEM MESSAGES                                                00510004
005200*----------------------------------------------------------------*00520004
005300*   00005 - INVALID VALUE                                         00530004
005400*   00007 - REQUIRED ENTRY                                        00540004
005500*   00008 - MUST BE NUMERIC                                       00550004
005600*   00034 - ADD SUCCESSFUL                                        00560004
005700*   00045 - INVALID FUNCTION                                      00570004
005800*   00059 - UPDATE(S) SUCCESSFUL                                  00580004
005900*   00069 - TOP OF LIST                                           00590004
006000*   00070 - BOTTOM OF LIST                                        00600004
006100*   00115 - DELETE SUCCESSFUL                                     00610004
006200*   00354 - DELETE PENDING - PRESS PF2 TO CONFIRM                 00620004
006300*   00527 - TYPE CODE DOES NOT EXIST                              00630004
006400*   02571 - UNABLE TO UPD - CURRENT OPER UNT AND OPER UNIT ID ENTE00640004
006500*   02574 - UPDATE FUNCTION INVALID - DOOR IS CURRENTLY NOT DEFINE00650004
006600*   02575 - STORE ASSIGNMNT FUNCTION ONLY VALID FOR DOOR TYPES SHI00660004
006700*   02576 - UPDATING DOOR DEFINITION - PRESS F2 TO CONFIRM        00670004
006800*   02577 - CANNOT CHANGE DOOR TYPE - DOOR ASSIGNED TO A NON-STORE00680004
006900*   02578 - CANNOT CHANGE DOOR TYPE - DOOR ASSIGNED TO A NON-DC LO00690004
007000*   02579 - CANNOT CHANGE DOOR TYPE-DOOR CURRENTLY ASSIGNED TO A D00700004
007010*   02612 - YOU DO NOT HAVE AUTHORITY TO UPDATE                   00701036
007100*   02620 - DOORS SHARING SAME CONVEYOR DIVERT CANNOT HAVE SAME ST00710004
007300*   02936 - SHARED DIVERT & LANE ASSIGNMENT ONLY VALID FOR SHIPPIN00730004
007400*   03264 - LABEL SEQUENCE MUST BE UNIQUE - DOOR &VAR IS THIS SEQU00740004
007500*   03266 - DOOR LABEL SEQUENCE IS ONLY VALID FOR SHIPPING DOORS  00750004
007600*   03267 - SHIPPING DOOR LABEL SEQUENCE MUST BE GREATER THAN 0   00760004
007611*   03707 - ADD FUNCTION INVALID - FUNCTION CODE ALREADY DEFINED  00761130
007620*   03708 - UPDATE FUNCTION INVALID - FUNCTION CODE IS NOT DEFINED00762030
007650*   03709 - ADD FUNCTION INVALID - PARM CODE ALREADY DEFINED      00765030
007660*   03710 - UPDATE FUNCTION INVALID - PARM CODE IS NOT DEFINED    00766030
007670*   03721 - ADD PARM INVALID - CODE IS NOT DEFINED                00767030
007680*   03722 - UPDATE PARM INVALID - CODE IS NOT DEFINED             00768030
007690*   03724 - YOU DO NOT HAVE AUTHORITY TO ADD                      00769036
007700*   05046 - LAND ASSGNMT AND DIVERT LOCATION ID REQUIRED FOR SH   00770004
007800*   99901 - INVALID COMMAND WAS ENTERED                           00780004
007900*----------------------------------------------------------------*00790004
008000     05  PC-TSYMSG-NUMBERS.                                       00800004
008100         10  PC-TSYMSG-00005      PIC  9(05)  VALUE  00005.       00810004
008200         10  PC-TSYMSG-00007      PIC  9(05)  VALUE  00007.       00820004
008300         10  PC-TSYMSG-00008      PIC  9(05)  VALUE  00008.       00830004
008400         10  PC-TSYMSG-00034      PIC  9(05)  VALUE  00034.       00840004
008500         10  PC-TSYMSG-00045      PIC  9(05)  VALUE  00045.       00850004
008600         10  PC-TSYMSG-00059      PIC  9(05)  VALUE  00059.       00860004
008700         10  PC-TSYMSG-00069      PIC  9(05)  VALUE  00069.       00870004
008800         10  PC-TSYMSG-00070      PIC  9(05)  VALUE  00070.       00880004
008900         10  PC-TSYMSG-00115      PIC  9(05)  VALUE  00115.       00890004
009000         10  PC-TSYMSG-00354      PIC  9(05)  VALUE  00354.       00900004
009100         10  PC-TSYMSG-00527      PIC  9(05)  VALUE  00527.       00910004
009200         10  PC-TSYMSG-02571      PIC  9(05)  VALUE  02571.       00920004
009300         10  PC-TSYMSG-02574      PIC  9(05)  VALUE  02574.       00930004
009400         10  PC-TSYMSG-02575      PIC  9(05)  VALUE  02575.       00940004
009500         10  PC-TSYMSG-02576      PIC  9(05)  VALUE  02576.       00950004
009600         10  PC-TSYMSG-02577      PIC  9(05)  VALUE  02577.       00960004
009700         10  PC-TSYMSG-02578      PIC  9(05)  VALUE  02578.       00970004
009800         10  PC-TSYMSG-02579      PIC  9(05)  VALUE  02579.       00980004
009810         10  PC-TSYMSG-02612      PIC  9(05)  VALUE  02612.       00981036
009900         10  PC-TSYMSG-02620      PIC  9(05)  VALUE  02620.       00990004
010100         10  PC-TSYMSG-02936      PIC  9(05)  VALUE  02936.       01010004
010200         10  PC-TSYMSG-02937      PIC  9(05)  VALUE  02937.       01020004
010300         10  PC-TSYMSG-03046      PIC  9(05)  VALUE  03046.       01030004
010400         10  PC-TSYMSG-03264      PIC  9(05)  VALUE  03264.       01040004
010500         10  PC-TSYMSG-03266      PIC  9(05)  VALUE  03266.       01050004
010600         10  PC-TSYMSG-03267      PIC  9(05)  VALUE  03267.       01060004
010610         10  PC-TSYMSG-03707      PIC  9(05)  VALUE  03707.       01061022
010620         10  PC-TSYMSG-03708      PIC  9(05)  VALUE  03708.       01062022
010630         10  PC-TSYMSG-03709      PIC  9(05)  VALUE  03709.       01063022
010640         10  PC-TSYMSG-03710      PIC  9(05)  VALUE  03710.       01064022
010650         10  PC-TSYMSG-03721      PIC  9(05)  VALUE  03721.       01065030
010660         10  PC-TSYMSG-03722      PIC  9(05)  VALUE  03722.       01066030
010670         10  PC-TSYMSG-03724      PIC  9(05)  VALUE  03724.       01067036
010700         10  PC-TSYMSG-99901      PIC  9(05)  VALUE  99901.       01070004
010800*                                                                 01080004
010900 01  PS-PROGRAM-SWITCHES.                                         01090004
011000     05  PS-ERROR-SW              PIC  X(01)  VALUE  'N'.         01100004
011100         88  PS-ERROR                         VALUE  'Y'.         01110004
011200         88  PS-NO-ERROR                      VALUE  'N'.         01120004
011300     05  PS-COMMAREA-SW           PIC  X(01)  VALUE  'N'.         01130004
011400         88  PS-COMMAREA-VALID                VALUE  'Y'.         01140004
011500         88  PS-COMMAREA-NOT-VALID            VALUE  'N'.         01150004
011600     05  PS-LIST-END-SW           PIC  X(01)  VALUE  'N'.         01160004
011700         88  PS-LIST-END                      VALUE  'Y'.         01170004
011800         88  PS-NO-LIST-END                   VALUE  'N'.         01180004
011900     05  PS-STORE-SW              PIC  X(01)  VALUE  'N'.         01190004
012000         88  PS-STORES-EXIST                  VALUE  'Y'.         01200004
012100         88  PS-NO-STORES-EXIST               VALUE  'N'.         01210004
012200     05  PS-DIVERT-SW             PIC  X(01)  VALUE  'N'.         01220004
012300         88  PS-DUP-DIVERT-EXIST              VALUE  'Y'.         01230004
012400         88  PS-NO-DUP-DIVERT-EXIST           VALUE  'N'.         01240004
012500     05  PS-DUPLICATE-STORE-SW    PIC  X(01)  VALUE  'N'.         01250004
012600         88  PS-DUP-STORE-ASGNMT              VALUE  'Y'.         01260004
012700         88  PS-NO-DUP-STORE-ASGNMT           VALUE  'N'.         01270004
012800     05  PS-LBL-SEQ-OPER-EXISTS-SW PIC X(01)  VALUE  'N'.         01280004
012900         88  PS-LBL-SEQ-OPER-EXISTS-YES       VALUE  'Y'.         01290004
013000         88  PS-LBL-SEQ-OPER-EXISTS-NO        VALUE  'N'.         01300004
013100     05  PS-TYPE-CHANGED-SW        PIC X(01)  VALUE  'N'.         01310004
013200         88  PS-TYPE-CHANGED-YES              VALUE  'Y'.         01320004
013300         88  PS-TYPE-CHANGED-NO               VALUE  'N'.         01330004
013310     05  PS-FUNCTION-ALLOWED-SW    PIC X(01)  VALUE  'N'.         01331036
013320         88  PS-FUNCTION-ALLOWED              VALUE  'Y'.         01332036
013330         88  PS-FUNCTION-NOT-ALLOWED         VALUE  'N'.          01333036
013400                                                                  01340004
013500 01  PV-PROGRAM-VARIABLES.                                        01350004
013600     05  PV-CICS-RESPONSE         PIC S9(04)  VALUE +0            01360004
013700                                              COMP SYNC.          01370004
013800     05  PV-RETRY-COUNTER         PIC S9(04)  VALUE +0            01380004
013900                                              COMP SYNC.          01390004
014000     05  PV-INPUT-SPACE-CNT       PIC S9(04)  VALUE +0            01400004
014100                                              COMP SYNC.          01410004
014200     05  PV-READ-COUNT            PIC S9(09)  VALUE +0            01420004
014300                                              COMP-3.             01430004
014400     05  PV-READ-STORES-COUNT     PIC S9(09)  VALUE +0            01440004
014500                                              COMP-3.             01450004
014600     05  PC-MAX-ITEMS             PIC S9(09)  VALUE +3            01460004
014700                                              COMP-3.             01470004
014800     05  PV-LANE-ASSGN-NUM        PIC  9(09)  VALUE ZEROES.       01480004
014900     05  PV-LABEL-SEQ             PIC S9(04) COMP.                01490004
015000     05  PV-LABEL-SEQ-COUNT       PIC S9(09)  VALUE +0            01500004
015100                                              COMP-3.             01510004
015200******************************************************************01520004
015300*PV-INP VARIABLES HOLD COMMAREA VALUES                            01530004
015400*       ONLY PV-INP VARIABLES READ FROM AND WRITE TO ASC-'S       01540004
015500******************************************************************01550004
015600     05  PV-INP-FUNCTION              PIC  X(01).                 01560004
015700     05  PV-INP-PARM-CODE             PIC  X(06).                 01570011
015800     05  PV-INP-PARM-DESC             PIC  X(40).                 01580011
015900     05  PV-INP-PARM-TYPE             PIC  X(02).                 01590013
016000                                                                  01600004
016010*----------------------------------------------------------------*01601036
016020**  SECURITY SUBROUTINE PARAMETERS                                01602036
016030*----------------------------------------------------------------*01603036
016040     COPY DPWS008.                                                01604036
016050                                                                  01605036
016060                                                                  01606036
016100*---------------------------------------------------------------* 01610004
016200* SELECTON QUEUE LAYOUT                                         * 01620004
016300*---------------------------------------------------------------* 01630004
016400     COPY CNWS019.                                                01640007
016500                                                                  01650004
016600*----------------------------------------------------------------*01660004
016700*    MAP LAYOUT                                                  *01670004
016800*----------------------------------------------------------------*01680004
016900     COPY CNKM234.                                                01690004
017000                                                                  01700004
017100*----------------------------------------------------------------*01710004
017200*    ATTRIBUTE SETTINGS COPYBOOK.                                *01720004
017300*----------------------------------------------------------------*01730004
017400     COPY DPWS015.                                                01740004
017500                                                                  01750004
017600*----------------------------------------------------------------*01760004
017700*    FUNCTION KEYS COPYBOOK                                      *01770004
017800*----------------------------------------------------------------*01780004
017900     COPY DPWS016.                                                01790004
018000                                                                  01800004
018100**--------------------------------------------------------------**01810004
018200** THE CVLLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **01820004
018300** SUB-ROUTINE (DPKUT100).                                      **01830004
018400**--------------------------------------------------------------**01840004
018500     COPY DPWS010I.                                               01850004
018600                                                                  01860004
018700**--------------------------------------------------------------**01870004
018800** THE CALLING PARAMETER LIST (DPWS030) FOR THE CICS ARCHITECTURE*01880004
018900** APPLICATION PROGRAMMING INTERFACE MODULE.                    **01890038
019000**--------------------------------------------------------------**01900004
019100     COPY DPWS030.                                                01910004
CICS       COPY DPWS930.                                                01911038
019200                                                                  01920004
019300**--------------------------------------------------------------**01930004
019400*    STANDARD COMMAREA.                                           01940004
019500**--------------------------------------------------------------**01950004
019600     COPY DPWS020.                                                01960004
019700     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01970004
019800                                                                  01980004
019900*---------------------------------------------------------------* 01990004
020000* INTER-APPLICATION COMMAREA.                                     02000004
020100*   CNWS014 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 02010007
020200*             SPEC SCREEN.                                        02020004
020300*   CNWS018 - IS THE INPUT LAYOUT THAT WILL BE PASSED FROM        02030007
020400*             THE LIST SCREEN                                     02040004
020500*---------------------------------------------------------------* 02050004
020600                                                                  02060004
020700         10  INTER-APPL-COMM-AREA PIC X(200).                     02070004
020800     COPY CNWS014.                                                02080007
020900     COPY CNWS018.                                                02090007
021000***************************************************************** 02100004
021100*    SPECIFIC COMMMAREA FOR CNKCS234.                             02110004
021200***************************************************************** 02120004
021300         10  ASC-SPECIFIC-COMMAREA.                               02130004
021400             15  ASC-INT-APPL-FORMAT-IND   PIC  X(01).            02140013
021500             15  ASC-ACTION-SW          PIC X(03).                02150013
021600                 88  ASC-ADD            VALUE 'ADD'.              02160013
021700                 88  ASC-DELETE         VALUE 'DEL'.              02170013
021800                 88  ASC-UPDATE         VALUE 'UPD'.              02180013
021900             15  ASC-FUNCTION              PIC  X(02).            02190013
022000                 88  ASC-FUNCTION-NONE             VALUE ' '.     02200007
022100                 88  ASC-ADD-CODE                  VALUE 'AC'.    02210007
022200                 88  ASC-UPD-CODE                  VALUE 'UC'.    02220007
022300                 88  ASC-ADD-PARM                  VALUE 'AP'.    02230007
022400                 88  ASC-UPD-PARM                  VALUE 'UP'.    02240007
022500             15  ASC-PARM-CODE                PIC  X(06).         02250013
022600             15  ASC-PARM-DESC                PIC  X(40).         02260007
022700             15  ASC-PARM-TYPE                PIC  X(02).         02270007
022800                 88  ASC-VALID-TYPE                VALUE 'DT',    02280007
022900                                                         'PC',    02290007
023000                                                         'QT',    02300007
023100                                                         'TX'.    02310007
023200                 88  ASC-TYPE-DATE                 VALUE 'DT'.    02320007
023300                 88  ASC-TYPE-PCNT                 VALUE 'PC'.    02330007
023400                 88  ASC-TYPE-QTY                  VALUE 'QT'.    02340007
023500                 88  ASC-TYPE-TEXT                 VALUE 'TX'.    02350007
023600*                                                                 02360007
023700             15  ASC-USE-SELECTION-QUEUE-IND                      02370004
023800                                           PIC  X(01).            02380004
023900                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 02390004
024000             15  ASC-SEL-QUEUE-NAME        PIC  X(08).            02400004
024100             15  ASC-NUMBER-OF-TS-ITEMS    PIC S9(05)  COMP-3.    02410004
024200             15  ASC-NUMBER-OF-SELECTED-ITEMS                     02420004
024300                                           PIC S9(09)  COMP-3.    02430004
024400             15  ASC-ITEM-SUB                 PIC S9(04)  COMP    02440004
024500                                                          SYNC.   02450004
024600             15  ASC-SEL-SUB               PIC S9(04)  COMP.      02460004
024700             15  ASC-SEL-ITEM              PIC S9(04)  COMP.      02470004
024800             15  ASC-TEMP-QUEUE-UPDATE-SW  PIC  X(01).            02480004
024900                 88  ASC-UPDATE-TSQ                   VALUE 'Y'.  02490004
025000                 88  ASC-NO-TSQ-UPDATE                VALUE ' '.  02500004
025100                                                                  02510004
025200             15  ASC-TKRPRCD-INSERTED-SW  PIC  X(01).             02520007
025300                 88  ASC-TKRPRCD-INSERTED             VALUE  'Y'. 02530007
025400                 88  ASC-TKRPRCD-NOT-INSERTED         VALUE  'N'. 02540007
025500             15  ASC-TKRPRCD-UPDATED-SW   PIC  X(01).             02550007
025600                 88  ASC-TKRPRCD-UPDATED              VALUE  'Y'. 02560007
025700                 88  ASC-TKRPRCD-NOT-UPDATED          VALUE  'N'. 02570007
025800             15  ASC-ITEMS-LEFT-INDICATOR     PIC  X(01).         02580004
025900                 88  ASC-ITEMS-LEFT-ON-DB             VALUE 'Y'.  02590004
026000                 88  ASC-NO-ITEMS-LEFT-ON-DB          VALUE 'N'.  02600004
026100             15  ASC-F2-CONFIRM-SW            PIC  X(01).         02610004
026200                 88  ASC-F2-CONFIRM-YES               VALUE 'Y'.  02620004
026300                 88  ASC-F2-CONFIRM-NO                VALUE 'N'.  02630004
026400                                                                  02640004
026500*----------------------------------------------------------------*02650004
026600*    ABEND PROCESSING COPYBOOK.                                  *02660004
026700*----------------------------------------------------------------*02670004
026800     COPY DPWS013.                                                02680004
026900                                                                  02690004
027000*----------------------------------------------------------------*02700004
027100*    DB2 TABLE FOR PARM CODE - TKRPRCD                            02710007
027200*----------------------------------------------------------------*02720004
027300     EXEC SQL                                                     02730004
027400          INCLUDE TKRPRCD                                         02740007
027500     END-EXEC.                                                    02750004
027600                                                                  02760004
027700                                                                  02770004
027800*----------------------------------------------------------------*02780004
027900*    DB2 AREA FOR COMMUNICATIONS                                  02790004
028000*----------------------------------------------------------------*02800004
028100     EXEC SQL                                                     02810004
028200          INCLUDE SQLCA                                           02820004
028300     END-EXEC.                                                    02830004
028400                                                                  02840004
028500*----------------------------------------------------------------*02850004
028600 LINKAGE SECTION.                                                 02860004
028700                                                                  02870004
028800 01  DFHCOMMAREA.                                                 02880004
028900     05  FILLER                         OCCURS  1 TO 4072 TIMES   02890004
029000                                        DEPENDING ON EIBCALEN.    02900004
029100         10  FILLER                     PIC X.                    02910004
029200                                                                  02920004
029300 PROCEDURE DIVISION.                                              02930004
029400***************************************************************** 02940004
029500** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 02950004
029600** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 02960004
029700** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 02970004
029800**                                                             ** 02980004
029900** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 02990004
030000** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 03000004
030100***************************************************************** 03010004
030200 0000-MAIN-MODULE.                                                03020004
030300     INITIALIZE DP030-CICS-API-FIELDS.                            03030004
030400     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03040004
030500     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03050004
030600     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03060004
030700     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03070004
030800     MOVE LENGTH OF CNK234I        TO DP030-MAP-LENGTH (1).       03080004
030900     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03090004
031000     PERFORM 0001-CALL-CICS-ARCH-API.                             03100004
031100                                                                  03110004
031200     PERFORM 1000-CONTROL-PROCESSING                              03120004
031300                                                                  03130004
031400     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03140004
031500     PERFORM 0001-CALL-CICS-ARCH-API.                             03150004
031600                                                                  03160004
031700 0001-CALL-CICS-ARCH-API.                                         03170004
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03180038
031900                                    DFHCOMMAREA                   03190038
032000                                    DP030-CICS-API-FIELDS         03200038
032100                                    DP020-STANDARD-COMMAREA       03210038
032200                                    CNK234I.                      03220038
032300                                                                  03230004
032400     IF  DP030-RC-CALL-SUCCESSFUL                                 03240004
032500         CONTINUE                                                 03250004
032600     ELSE                                                         03260004
032700         SET DP013-NO-ROLLBACK                                    03270004
032800             DP013-XCTL-DISPLAY-RESTART                           03280004
032900             DP013-CICS-ABEND      TO TRUE                        03290004
033000         MOVE 'BEFORE 0000-MAIN-MODULE'                           03300004
033100                                   TO DP013-PARAGRAPH             03310004
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O03311038
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      03312038
033400         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      03340004
033500         PERFORM DP013-0000-PROCESS-ABEND                         03350004
033600     END-IF.                                                      03360004
033700*                                                                 03370004
033800*----------------------------------------------------------------*03380004
033900*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *03390004
034000*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *03400004
034100*----------------------------------------------------------------*03410004
034200 1000-CONTROL-PROCESSING.                                         03420004
034300                                                                  03430004
034400     EVALUATE TRUE                                                03440004
034500         WHEN DP020-NEXT-ACT-INITIAL                              03450004
034600              INITIALIZE ASC-SPECIFIC-COMMAREA                    03460004
034700              PERFORM 1100-PROCESS-INTER-APPL-COMM                03470004
034800                                                                  03480004
034900              IF  PS-COMMAREA-NOT-VALID                           03490004
035000                  SET DP020-NEXT-ACT-APPL-ERROR TO TRUE           03500004
035100              ELSE                                                03510004
035200                  PERFORM 4000-BUILD-INITIAL-PANEL                03520004
035300                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            03530004
035400                  PERFORM 3200-RESET-ATTRIBUTES                   03540004
035500              END-IF                                              03550004
035600                                                                  03560004
035700         WHEN DP020-NEXT-ACT-READ-MAP                             03570004
035800             PERFORM 2000-PROCESS-PANEL                           03580004
035900*F3-END                                                           03590004
036000         WHEN DP020-NEXT-ACT-RETURN                               03600004
036100             PERFORM 4000-BUILD-INITIAL-PANEL                     03610004
036200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   03620004
036300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03630004
036400             MOVE -1                   TO APMCODEL                03640027
036500                                                                  03650004
036600         WHEN OTHER                                               03660004
036700             SET DP013-LOGIC-ABEND TO TRUE                        03670004
036800             SET DP013-NO-ROLLBACK TO TRUE                        03680004
036900             MOVE '1000-CONTROL-PROCESSING'                       03690004
037000                                   TO DP013-PARAGRAPH             03700004
037100             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    03710004
037200                                   TO DP013-MESSAGE-TEXT(1)       03720004
037300             MOVE DP020-NEXT-APPL-ACTIVITY                        03730004
037400                                   TO DP013-MESSAGE-TEXT(2)       03740004
037500             PERFORM DP013-0000-PROCESS-ABEND                     03750004
037600     END-EVALUATE.                                                03760004
037700*                                                                 03770004
037800******************************************************************03780004
037900** DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE   **03790004
038000** INTER-APPLICATION FORMAT CODE.                               **03800004
038100******************************************************************03810004
038200 1100-PROCESS-INTER-APPL-COMM.                                    03820004
038300     INITIALIZE ASC-SPECIFIC-COMMAREA.                            03830004
038400     MOVE DP020-INT-APPL-FORMAT-IND                               03840004
038500                                   TO ASC-INT-APPL-FORMAT-IND.    03850004
038600                                                                  03860004
038700     SET PS-COMMAREA-VALID                                        03870004
038800         ASC-F2-CONFIRM-NO         TO TRUE.                       03880004
038810                                                                  03881014
038820*WHEN COMING FROM CRIT SPEC        (CNKCS233 - F13=ADD CODE)      03882015
039000*WHEN COMING FROM CRIT SPEC        (CNKCS233 - F15=UPD CODE)      03900007
039100*WHEN COMING FROM CODE LIST SCREEN (CNKCS236 - F13=ADD CODE)      03910015
039110                                                                  03911014
039200     EVALUATE ASC-INT-APPL-FORMAT-IND                             03920004
039300         WHEN PC-INTER-APPL-CRIT-SPEC-ADD                         03930015
039400         WHEN PC-INTER-APPL-CRIT-SPEC-UPD                         03940004
039500         WHEN PC-INTER-APPL-LIST-ADD                              03950015
039600             MOVE CN014-FUNCTION          TO ASC-FUNCTION         03960007
039700             MOVE CN014-PARM-NAME         TO ASC-PARM-CODE        03970013
039800             MOVE CN014-PARM-DESC         TO ASC-PARM-DESC        03980013
039900             MOVE CN014-PARM-TYPE         TO ASC-PARM-TYPE        03990013
039910             IF  ASC-UPD-CODE                                     03991015
040000                 PERFORM 3000-EDIT-DATA-IN-COMMAREA               04000015
040010             END-IF                                               04001015
040100             PERFORM 4500-MOVE-COMMAREA-TO-TEMP                   04010004
040296                                                                  04029614
040300*WHEN COMING FROM CODE LIST (CNKCS236 - F15=UPD CODE)             04030007
040400         WHEN PC-INTER-APPL-LIST-UPDATE                           04040004
040500           IF CN018-NUMBER-OF-SELECTED-ITEMS > 0                  04050007
040600             SET ASC-USE-SELECTION-QUEUE TO TRUE                  04060004
040700             MOVE CN018-NUMBER-OF-SELECTED-ITEMS                  04070007
040800                                   TO ASC-NUMBER-OF-SELECTED-ITEMS04080004
040900             MOVE CN018-NUMBER-OF-TS-ITEMS                        04090007
041000                                   TO ASC-NUMBER-OF-TS-ITEMS      04100004
041100             MOVE CN018-SEL-QUEUE-NAME                            04110007
041200                                   TO ASC-SEL-QUEUE-NAME          04120004
041300             MOVE CN018-FUNCTION         TO ASC-FUNCTION          04130007
041400             MOVE 'UPD' TO  ASC-ACTION-SW                         04140004
041500             PERFORM 1120-PREPARE-LIST-ENTRY                      04150004
041600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04160004
041700             PERFORM 4500-MOVE-COMMAREA-TO-TEMP                   04170004
041800         END-IF                                                   04180004
041900     END-EVALUATE.                                                04190004
042000                                                                  04200004
042100*----------------------------------------------------------------*04210004
042200* ENTRY IS FROM A LIST.  GET THE MESSAGE NUMBER FROM THE TEMP    *04220004
042300* STORAGE QUEUE PASSED FROM THE LIST.                            *04230004
042400*----------------------------------------------------------------*04240004
042500 1120-PREPARE-LIST-ENTRY.                                         04250004
042600     MOVE CN019-MAX-ITEMS          TO ASC-SEL-SUB.                04260007
042700     MOVE ZERO                     TO ASC-SEL-ITEM.               04270004
042800     PERFORM 1130-GET-NEXT-RECORD.                                04280004
042900                                                                  04290004
043000*---------------------------------------------------------------- 04300004
043100*    GET THE NEXT RECORD IF A LIST OF RECORDS ARE BEING PROCESSED*04310004
043200*---------------------------------------------------------------- 04320004
043300 1130-GET-NEXT-RECORD.                                            04330004
043400     ADD +1                        TO ASC-SEL-SUB.                04340004
043500                                                                  04350004
043600     SET ASC-UPDATE-TSQ TO TRUE.                                  04360004
043700                                                                  04370004
043800     IF  ASC-SEL-SUB > CN019-MAX-ITEMS                            04380007
043900         ADD +1                    TO ASC-SEL-ITEM                04390004
044000         MOVE +1                   TO ASC-SEL-SUB                 04400004
044100     END-IF.                                                      04410004
044200                                                                  04420004
044300     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                04430004
044400         PERFORM 9100-READ-SEL-QUEUE                              04440004
044500         IF  CN019-ITEM (ASC-SEL-SUB) > ZERO                      04450007
044600             MOVE CN019-FUNC-CODE(ASC-SEL-SUB)  TO ASC-PARM-CODE  04460013
044700             MOVE CN019-FUNC-DESC(ASC-SEL-SUB)  TO ASC-PARM-DESC  04470013
044800             MOVE CN019-FUNC-TYPE(ASC-SEL-SUB)  TO ASC-PARM-TYPE  04480013
044900             SET CN019-INQ (ASC-SEL-SUB) TO TRUE                  04490007
045000             PERFORM 9200-REWRITE-SEL-QUEUE                       04500004
045100         ELSE                                                     04510004
045200             SUBTRACT +1 FROM ASC-SEL-SUB                         04520004
045300             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            04530004
045400             SET DP020-MSG-INFORMATIONAL                          04540004
045500                 PS-LIST-END       TO TRUE                        04550004
045600         END-IF                                                   04560004
045700     ELSE                                                         04570004
045800         SUBTRACT +1 FROM ASC-SEL-ITEM                            04580004
045900         MOVE CN019-MAX-ITEMS      TO ASC-SEL-SUB                 04590007
046000         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            04600004
046100         SET DP020-MSG-INFORMATIONAL                              04610004
046200                 PS-LIST-END       TO TRUE                        04620004
046300     END-IF.                                                      04630004
046400                                                                  04640004
046500******************************************************************04650004
046600*  GET THE PREVIOUS RECORD IF A LIST OF RECORDS ARE BEING         04660004
046700*  PROCESSED.                                                     04670004
046800******************************************************************04680004
046900 1140-GET-PREV-RECORD.                                            04690004
047000     SUBTRACT +1 FROM ASC-SEL-SUB.                                04700004
047100                                                                  04710004
047200     IF  ASC-SEL-SUB < +1                                         04720004
047300         SUBTRACT +1 FROM ASC-SEL-ITEM                            04730004
047400         MOVE CN019-MAX-ITEMS      TO ASC-SEL-SUB                 04740007
047500     END-IF.                                                      04750004
047600                                                                  04760004
047700     IF  ASC-SEL-ITEM > ZERO                                      04770004
047800         PERFORM 9100-READ-SEL-QUEUE                              04780004
047900         IF  CN019-ITEM (ASC-SEL-SUB) > ZERO                      04790007
048000             MOVE CN019-FUNC-CODE(ASC-SEL-SUB)  TO ASC-PARM-CODE  04800013
048100             MOVE CN019-FUNC-DESC(ASC-SEL-SUB)  TO ASC-PARM-DESC  04810013
048200             MOVE CN019-FUNC-TYPE(ASC-SEL-SUB)  TO ASC-PARM-TYPE  04820013
048300         END-IF                                                   04830004
048400                                                                  04840004
048500         SET CN019-INQ (ASC-SEL-SUB) TO TRUE                      04850007
048600         PERFORM 9200-REWRITE-SEL-QUEUE                           04860004
048700     ELSE                                                         04870004
048800         MOVE +1                   TO ASC-SEL-ITEM                04880004
048900                                      ASC-SEL-SUB                 04890004
049000         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            04900004
049100         SET DP020-MSG-INFORMATIONAL                              04910004
049200             PS-LIST-END             TO TRUE                      04920004
049300     END-IF.                                                      04930004
049400                                                                  04940004
049500*----------------------------------------------------------------*04950004
049600* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *04960004
049700* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *04970004
049800* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *04980004
049900* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *04990004
050000* FUNCTION KEYS CAN GET THIS FAR.                                *05000004
050100*----------------------------------------------------------------*05010004
050200 2000-PROCESS-PANEL.                                              05020004
050300                                                                  05030004
050400     EVALUATE TRUE                                                05040004
050500                                                                  05050004
050600         WHEN DP020-SRC-AID = DP016-CLEAR                         05060004
050700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05070004
050800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05080004
050900                                                                  05090004
051000*F5 REFRESH -                                                     05100004
051100         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     05110004
051200              SET  ASC-F2-CONFIRM-NO     TO  TRUE                 05120013
051300              PERFORM 4000-BUILD-INITIAL-PANEL                    05130004
051400              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                05140004
051500              PERFORM 3200-RESET-ATTRIBUTES                       05150004
051600                                                                  05160004
051700*F20-NEXT SEL                                                     05170004
051800         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             05180004
051900             MOVE DP020-INT-APPL-FORMAT-IND                       05190004
052000                                      TO ASC-INT-APPL-FORMAT-IND  05200004
052100             IF ASC-INT-APPL-FORMAT-IND = '2'                     05210004
052200               IF  ASC-USE-SELECTION-QUEUE                        05220004
052300                   PERFORM 1130-GET-NEXT-RECORD                   05230004
052400                   PERFORM 3000-EDIT-DATA-IN-COMMAREA             05240004
052500                   IF PS-LIST-END                                 05250004
052600                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN       05260004
052700                       SET PS-NO-LIST-END TO TRUE                 05270004
052800                   ELSE                                           05280004
052900                       PERFORM 4000-BUILD-INITIAL-PANEL           05290004
053000                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN       05300004
053100                       PERFORM 3200-RESET-ATTRIBUTES              05310004
053200                   END-IF                                         05320004
053300               ELSE                                               05330004
053400*                --- BOTTOM OF LIST ---                           05340004
053500                   MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER       05350004
053600                   SET DP020-MSG-INFORMATIONAL TO TRUE            05360004
053700               END-IF                                             05370004
053800           ELSE                                                   05380004
053900               MOVE PC-TSYMSG-00045 TO DP020-MSG-NUMBER           05390004
054000               SET DP020-MSG-FATAL TO TRUE                        05400004
054100           END-IF                                                 05410004
054200                                                                  05420004
054300*F19-PREV SEL                                                     05430004
054400         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             05440004
054500             MOVE DP020-INT-APPL-FORMAT-IND                       05450004
054600                                      TO ASC-INT-APPL-FORMAT-IND  05460004
054700             IF ASC-INT-APPL-FORMAT-IND = '2'                     05470004
054800                IF  ASC-USE-SELECTION-QUEUE                       05480004
054900                   PERFORM 1140-GET-PREV-RECORD                   05490004
055000                   PERFORM 3000-EDIT-DATA-IN-COMMAREA             05500004
055100                   IF PS-LIST-END                                 05510004
055200                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN       05520004
055300                       SET PS-NO-LIST-END TO TRUE                 05530004
055400                   ELSE                                           05540004
055500                       PERFORM 4000-BUILD-INITIAL-PANEL           05550004
055600                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN       05560004
055700                       PERFORM 3200-RESET-ATTRIBUTES              05570004
055800                   END-IF                                         05580004
055900               ELSE                                               05590004
056000                   MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER       05600004
056100                   SET DP020-MSG-INFORMATIONAL TO TRUE            05610004
056200               END-IF                                             05620004
056300           ELSE                                                   05630004
056400               MOVE PC-TSYMSG-00045 TO DP020-MSG-NUMBER           05640004
056500               SET DP020-MSG-FATAL TO TRUE                        05650004
056600           END-IF                                                 05660004
056700                                                                  05670004
056800         WHEN OTHER                                               05680004
056900             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 05690004
057000             PERFORM 3200-RESET-ATTRIBUTES                        05700004
057100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05710004
057200             IF PS-NO-ERROR                                       05720004
057300                 PERFORM 4500-MOVE-COMMAREA-TO-TEMP               05730004
057400                 PERFORM 2100-CHECK-FUNCTION-KEY                  05740004
057500                 IF PS-NO-ERROR                                   05750004
057600                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         05760004
057700                     SET DP030-CONTINUE-GO TO TRUE                05770004
057800                 ELSE                                             05780004
057900                     SET DP030-OVERRIDE-GO TO TRUE                05790004
058000                 END-IF                                           05800004
058100             ELSE                                                 05810004
058200                 SET DP030-OVERRIDE-GO TO TRUE                    05820004
058300             END-IF                                               05830004
058400     END-EVALUATE.                                                05840004
058500                                                                  05850004
058600*----------------------------------------------------------------*05860004
058700* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED       *05870004
058800* FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED   *05880004
058900* FROM THE CICS ARCHITECTURE API.                                *05890004
059000*----------------------------------------------------------------*05900004
059100 2100-CHECK-FUNCTION-KEY.                                         05910004
059200     EVALUATE TRUE                                                05920004
059300         WHEN DP020-SRC-AID = DP016-ENTER                         05930004
059400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05940004
059500                                                                  05950004
059600*-F02 = CONFIRM UPDATE                                            05960004
059700         WHEN DP020-FK-CONFIRM  (DP020-SRC-AID)  AND              05970012
059800              ASC-F2-CONFIRM-YES                                  05980012
059900                 IF  ASC-ACTION-SW = 'UPD'                        05990012
060000                     PERFORM 9100-READ-SEL-QUEUE                  06000012
060100                     SET CN019-UPD (ASC-SEL-SUB) TO TRUE          06010012
060200                     MOVE ASC-PARM-CODE                           06020012
060300                                  TO CN019-FUNC-CODE (ASC-SEL-SUB)06030012
060400                     MOVE ASC-PARM-DESC                           06040012
060500                                  TO CN019-FUNC-DESC (ASC-SEL-SUB)06050012
060600                     MOVE ASC-PARM-TYPE                           06060012
060700                                 TO CN019-FUNC-TYPE (ASC-SEL-SUB) 06070012
060800                     PERFORM 9200-REWRITE-SEL-QUEUE               06080012
060900                 END-IF                                           06090012
061000                                                                  06100004
061100                 IF  PS-NO-ERROR                                  06110012
061200                     PERFORM 5100-PROCESS-UPDATE                  06120012
061300                     IF  PS-NO-ERROR                              06130012
061400                         PERFORM 2110-PREPARE-INTER-APPL-COMM     06140012
061500                     END-IF                                       06150012
061600                 END-IF                                           06160012
061700                                                                  06170004
061800*-F13 = ADD PARM CODE                                             06180012
061900         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              06190004
061910              SET ASC-ADD-CODE  TO TRUE                           06191031
062000              IF  ASC-PARM-CODE  = SPACES                         06200012
062100                  SET PS-ERROR                                    06210012
062200                      DP020-MSG-FATAL         TO TRUE             06220012
062300                  MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER 06230012
062400                  MOVE DP015-UNP-ALP-BRT-OFF  TO APMCODEA         06240012
062500                  MOVE DP015-RED              TO APMCODEC         06250012
062600                  MOVE DP015-REVERSE          TO APMCODEH         06260012
062700                  MOVE -1                     TO APMCODEL         06270012
062800                  SET DP030-SET-CURSOR-APPL-1 TO TRUE             06280012
062900              END-IF                                              06290012
063000                                                                  06300012
063100              IF  ASC-PARM-DESC = SPACES                          06310012
063200                  SET PS-ERROR                                    06320012
063300                      DP020-MSG-FATAL         TO TRUE             06330012
063400                  MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER 06340012
063500                  MOVE DP015-UNP-ALP-BRT-OFF  TO APMDESCA         06350012
063600                  MOVE DP015-RED              TO APMDESCC         06360012
063700                  MOVE DP015-REVERSE          TO APMDESCH         06370012
063800                  MOVE -1                     TO APMDESCL         06380012
063900                  MOVE +1                     TO APMCODEL         06390012
064000                  SET DP030-SET-CURSOR-APPL-1 TO TRUE             06400012
064100            END-IF                                                06410012
064200                                                                  06420012
064300            IF  ASC-PARM-TYPE  = SPACES                           06430012
064400                  SET PS-ERROR                                    06440012
064500                      DP020-MSG-FATAL         TO TRUE             06450012
064600                  MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER 06460012
064700                  MOVE DP015-UNP-ALP-BRT-OFF  TO APMTYPEA         06470012
064800                  MOVE DP015-RED              TO APMTYPEC         06480012
064900                  MOVE DP015-REVERSE          TO APMTYPEH         06490012
065000                  MOVE -1                     TO APMTYPEL         06500012
065100                  MOVE +1                     TO APMCODEL         06510012
065200                  MOVE +1                     TO APMDESCL         06520012
065300                  SET DP030-SET-CURSOR-APPL-1 TO TRUE             06530012
065400            END-IF                                                06540012
065500                                                                  06550004
065510            SET  PS-FUNCTION-NOT-ALLOWED  TO  TRUE                06551036
065511            MOVE 'CNACODE '              TO DP008-FUNCTION-NAME   06551136
065520            PERFORM 2105-RACF-ACCESS                              06552036
065530            IF  PS-FUNCTION-ALLOWED                               06553036
065540                CONTINUE                                          06554036
065550            ELSE                                                  06555036
065551                SET PS-ERROR                                      06555136
065552                    DP020-MSG-FATAL         TO TRUE               06555236
065553                MOVE PC-TSYMSG-03724        TO DP020-MSG-NUMBER   06555336
065554                MOVE DP015-UNP-ALP-BRT-OFF  TO APMCODEA           06555436
065555                MOVE DP015-RED              TO APMCODEC           06555536
065556                MOVE DP015-REVERSE          TO APMCODEH           06555636
065557                MOVE -1                     TO APMCODEL           06555736
065560                SET DP030-SET-CURSOR-APPL-1 TO TRUE               06556036
065561            END-IF                                                06556136
065570                                                                  06557036
065600           IF  PS-NO-ERROR                                        06560004
065700               PERFORM 5000-PROCESS-ADD                           06570004
065800               IF  PS-NO-ERROR                                    06580004
065900                   PERFORM 2110-PREPARE-INTER-APPL-COMM           06590004
066000                   MOVE DP015-PRO-NOR-OFF        TO APMCODEA      06600008
066100                                                    APMDESCA      06610012
066200                                                    APMTYPEA      06620012
066300                   MOVE DP015-BLUE               TO APMCODEC      06630008
066400                                                    APMDESCC      06640012
066500                                                    APMTYPEC      06650012
066600                   MOVE DP015-HL-OFF             TO APMCODEH      06660008
066700                                                    APMDESCH      06670012
066800                                                    APMTYPEH      06680012
066900               END-IF                                             06690004
067000           END-IF                                                 06700004
067100                                                                  06710004
067200*-F15 = UPDATE PARM CODE                                          06720012
067300         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              06730016
067310              SET ASC-UPD-CODE      TO TRUE                       06731031
067400              SET ASC-F2-CONFIRM-NO TO TRUE                       06740012
067500                                                                  06750004
067600              IF  ASC-PARM-CODE  = SPACES                         06760012
067700                  SET PS-ERROR                                    06770012
067800                      DP020-MSG-FATAL         TO TRUE             06780012
067900                  MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER 06790012
068000                  MOVE DP015-UNP-ALP-BRT-OFF  TO APMCODEA         06800012
068100                  MOVE DP015-RED              TO APMCODEC         06810012
068200                  MOVE DP015-REVERSE          TO APMCODEH         06820012
068300                  MOVE -1                     TO APMCODEL         06830012
068400                  SET DP030-SET-CURSOR-APPL-1 TO TRUE             06840012
068500              END-IF                                              06850012
068600                                                                  06860012
068700              IF  ASC-PARM-DESC  =  SPACES                        06870012
068800                  SET PS-ERROR                                    06880012
068900                      DP020-MSG-FATAL         TO TRUE             06890012
069000                  MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER 06900012
069100                  MOVE DP015-UNP-ALP-BRT-OFF  TO APMDESCA         06910012
069200                  MOVE DP015-RED              TO APMDESCC         06920012
069300                  MOVE DP015-REVERSE          TO APMDESCH         06930012
069400                  MOVE -1                     TO APMDESCL         06940012
069500                  MOVE +1                     TO APMCODEL         06950012
069600                  SET DP030-SET-CURSOR-APPL-1 TO TRUE             06960012
069700              END-IF                                              06970012
069800                                                                  06980012
069900              IF  ASC-PARM-TYPE  =  SPACES                        06990012
070000                  SET PS-ERROR                                    07000012
070100                      DP020-MSG-FATAL         TO TRUE             07010012
070200                  MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER 07020012
070300                  MOVE DP015-UNP-ALP-BRT-OFF  TO APMTYPEA         07030012
070400                  MOVE DP015-RED              TO APMTYPEC         07040012
070500                  MOVE DP015-REVERSE          TO APMTYPEH         07050012
070600                  MOVE -1                     TO APMTYPEL         07060012
070700                  MOVE +1                     TO APMCODEL         07070012
070800                  MOVE +1                     TO APMDESCL         07080012
070900                  SET DP030-SET-CURSOR-APPL-1 TO TRUE             07090012
071000              END-IF                                              07100012
071010                                                                  07101036
071020            SET  PS-FUNCTION-NOT-ALLOWED  TO  TRUE                07102036
071030            MOVE 'CNUCODE '              TO DP008-FUNCTION-NAME   07103036
071040            PERFORM 2105-RACF-ACCESS                              07104036
071050            IF  PS-FUNCTION-ALLOWED                               07105036
071060                CONTINUE                                          07106036
071070            ELSE                                                  07107036
071080                SET PS-ERROR                                      07108036
071090                    DP020-MSG-FATAL         TO TRUE               07109036
071091                MOVE PC-TSYMSG-02612        TO DP020-MSG-NUMBER   07109136
071092                MOVE DP015-UNP-ALP-BRT-OFF  TO APMCODEA           07109236
071093                MOVE DP015-RED              TO APMCODEC           07109336
071094                MOVE DP015-REVERSE          TO APMCODEH           07109436
071095                MOVE -1                     TO APMCODEL           07109536
071096                SET DP030-SET-CURSOR-APPL-1 TO TRUE               07109636
071097            END-IF                                                07109736
071098                                                                  07109836
071100                                                                  07110012
071200             IF  PS-NO-ERROR                                      07120012
071300                 SET ASC-F2-CONFIRM-YES      TO TRUE              07130012
071400                 SET PS-ERROR                TO TRUE              07140012
071500                 SET DP020-MSG-FATAL         TO TRUE              07150012
071600                 MOVE PC-TSYMSG-02576        TO DP020-MSG-NUMBER  07160012
071700                 MOVE DP015-PRO-NOR-OFF      TO APMCODEA          07170012
071800                 MOVE DP015-BLUE             TO APMCODEC          07180012
071900                 MOVE -1                     TO APMDESCL          07190012
072000                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              07200012
072100            END-IF                                                07210012
072200                                                                  07220004
072300*-F17 = ADD PARM -- (CNKCS235)                                    07230012
072400         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              07240016
072410              SET  ASC-ADD-PARM   TO TRUE                         07241029
072420              PERFORM 3040-CHECK-4-ROW-ON-KRPRCD                  07242030
072430              IF  PS-NO-ERROR                                     07243035
072440                  PERFORM 2110-PREPARE-INTER-APPL-COMM            07244035
072450              END-IF                                              07245035
072600                                                                  07260004
072700*F24  = PARM LIST - (CNKCS237)                                    07270012
072800         WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)              07280016
072810              SET  ASC-FUNCTION-NONE   TO TRUE                    07281032
072900              IF  ASC-PARM-CODE  =  SPACES                        07290012
073000                  SET PS-ERROR                                    07300012
073100                      DP020-MSG-FATAL         TO TRUE             07310012
073200                  MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER 07320012
073300                  MOVE DP015-UNP-ALP-BRT-OFF  TO APMCODEA         07330012
073400                  MOVE DP015-RED              TO APMCODEC         07340012
073500                  MOVE DP015-REVERSE          TO APMCODEH         07350012
073600                  MOVE -1                     TO APMCODEL         07360012
073700                  SET DP030-SET-CURSOR-APPL-1 TO TRUE             07370012
073800              END-IF                                              07380012
073900                                                                  07390012
074000              IF  ASC-PARM-DESC  =  SPACES                        07400012
074100                  SET PS-ERROR                                    07410012
074200                      DP020-MSG-FATAL         TO TRUE             07420012
074300                  MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER 07430012
074400                  MOVE DP015-UNP-ALP-BRT-OFF  TO APMDESCA         07440012
074500                  MOVE DP015-RED              TO APMDESCC         07450012
074600                  MOVE DP015-REVERSE          TO APMDESCH         07460012
074700                  MOVE -1                     TO APMDESCL         07470012
074800                  MOVE +1                     TO APMCODEL         07480012
074900                  SET DP030-SET-CURSOR-APPL-1 TO TRUE             07490012
075000              END-IF                                              07500012
075100                                                                  07510012
075200              IF  PS-NO-ERROR                                     07520012
075700                  PERFORM 2110-PREPARE-INTER-APPL-COMM            07570031
076000              END-IF                                              07600012
076100              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                07610012
076200                                                                  07620004
076300         WHEN DP020-FK-CONFIRM  (DP020-SRC-AID) AND               07630004
076400              ASC-F2-CONFIRM-NO                                   07640004
076500                  MOVE PC-TSYMSG-00045 TO DP020-MSG-NUMBER        07650012
076600                  SET DP020-MSG-FATAL TO TRUE                     07660012
076700                                                                  07670012
076800         WHEN OTHER                                               07680004
076900              SET DP013-NO-ROLLBACK                               07690012
077000                  DP013-XCTL-DISPLAY-RESTART                      07700012
077100                  DP013-CICS-ABEND      TO TRUE                   07710012
077200              MOVE '2000-PROCESS-PANEL' TO DP013-PARAGRAPH        07720012
077300              MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'     07730012
077400                                    TO DP013-MESSAGE-TEXT (1)     07740012
077500              PERFORM DP013-0000-PROCESS-ABEND                    07750012
077600                                                                  07760004
077700     END-EVALUATE.                                                07770004
077800                                                                  07780004
077801                                                                  07780136
077810*----------------------------------------------------------------*07781036
077820* CHECK TO SEE IF USER HAS RACF AUTHORIZATION FOR FUNCTION       *07782036
077830*----------------------------------------------------------------*07783036
077840 2105-RACF-ACCESS.                                                07784036
077850                                                                  07785036
077860      SET DP008-RSRC-TYPE-FUNC           TO TRUE                  07786036
077880      SET DP008-ACCESS-TYPE-USE          TO TRUE                  07788036
077890                                                                  07789036
077891      EXEC CICS                                                   07789136
077892         LINK PROGRAM (DP008-SECURITY-SUBROUTINE)                 07789236
077893              COMMAREA (DP008-SECURITY-COMMAREA)                  07789336
077894              LENGTH (DP008-SECURITY-COMMAREA-LENGTH)             07789436
077895      END-EXEC                                                    07789536
077896                                                                  07789636
077897      IF DP008-CALL-SUCCESSFUL                                    07789736
077898         IF DP008-ACCESS-ALLOWED                                  07789836
077899             SET PS-FUNCTION-ALLOWED TO TRUE                      07789936
077900         ELSE                                                     07790036
077901             SET PS-FUNCTION-NOT-ALLOWED TO TRUE                  07790136
077902         END-IF                                                   07790236
077903     ELSE                                                         07790336
077904         MOVE '2105-RACF-ACCESS'                                  07790436
077905                               TO DP013-PARAGRAPH                 07790536
077906          MOVE 'UNABLE TO ACCESS CICS'                            07790636
077907                               TO DP013-MESSAGE-TEXT (1)          07790736
077908          MOVE SQLCA                 TO DP013-SQLCA               07790836
077909          SET DP013-DB2-ABEND                                     07790936
077910              DP013-XCTL-DISPLAY-RESTART                          07791036
077911                               TO TRUE                            07791136
077912          PERFORM DP013-0000-PROCESS-ABEND                        07791236
077913      END-IF.                                                     07791336
077914                                                                  07791436
077915                                                                  07791536
077920******************************************************************07792004
078000** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **07800004
078100** INTER-APPLICATION COMMAREA.                                  **07810004
078200******************************************************************07820004
078300 2110-PREPARE-INTER-APPL-COMM.                                    07830004
078400                                                                  07840004
078500     INITIALIZE CN014-INTER-APPL-COMMAREA.                        07850007
078600                                                                  07860004
078700     MOVE ASC-FUNCTION             TO CN014-FUNCTION.             07870007
078800     MOVE ASC-PARM-CODE            TO CN014-PARM-NAME.            07880013
078900     MOVE ASC-PARM-DESC            TO CN014-PARM-DESC.            07890013
079000     MOVE ASC-PARM-TYPE            TO CN014-PARM-TYPE.            07900013
079100                                                                  07910004
079200*----------------------------------------------------------------*07920004
079300* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS   *07930004
079400* IN THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN   *07940004
079500* THE APPLICATION-SPECIFIC COMMAERA, NOT ON THE SCREEN.          *07950004
079600* THIS PARAGRAPH DOES NOT USE TEMPORARY VARIABLES.               *07960004
079700*----------------------------------------------------------------*07970004
079800 2200-MOVE-SCREEN-TO-COMMAREA.                                    07980004
079810     SET  ASC-FUNCTION-NONE        TO TRUE.                       07981034
079900*PARM CODE                                                        07990013
080000     IF  APMCODEL > ZERO                                          08000034
080100         MOVE APMCODEI             TO ASC-PARM-CODE               08010034
080200         MOVE ASC-PARM-CODE        TO PV-INP-PARM-CODE            08020034
080300     ELSE                                                         08030034
080400         IF  APMCODEF = DP015-ERASE-EOF                           08040034
080500             MOVE SPACES           TO ASC-PARM-CODE               08050034
080600         END-IF                                                   08060034
080700     END-IF.                                                      08070034
080800                                                                  08080004
080900*PARM DESCRIPTION                                                 08090013
081000     IF  APMDESCL > ZERO                                          08100034
081100         MOVE APMDESCI             TO ASC-PARM-DESC               08110034
081200     ELSE                                                         08120034
081300         IF  APMDESCF = DP015-ERASE-EOF                           08130034
081400             MOVE SPACES           TO ASC-PARM-DESC               08140034
081500         END-IF                                                   08150034
081600     END-IF.                                                      08160034
081700                                                                  08170004
081800*PARM TYPE                                                        08180034
081900     IF  APMTYPEL > ZERO                                          08190034
082000         MOVE APMTYPEI             TO ASC-PARM-TYPE               08200034
082100     ELSE                                                         08210034
082200         IF  APMTYPEF = DP015-ERASE-EOF                           08220034
082300             MOVE SPACES           TO ASC-PARM-TYPE               08230034
082400         END-IF                                                   08240034
082500     END-IF.                                                      08250034
082600                                                                  08260004
082700                                                                  08270004
082800*----------------------------------------------------------------*08280004
082900* PERFORM EDITS ON EACH FIELD ENTERED BY THE USER.  IF AN ERROR  *08290004
083000* IS FOUND, THE CURSOR IS POSITIONED AT THAT FIELD AND AN        *08300004
083100* APPROPRIATE ERROR MESSAGE IS DISPLAYED.                        *08310004
083200*----------------------------------------------------------------*08320004
083300 3000-EDIT-DATA-IN-COMMAREA.                                      08330004
083400                                                                  08340004
083500     IF  ASC-PARM-CODE  >  SPACES                                 08350027
083600         PERFORM 3040-CHECK-4-ROW-ON-KRPRCD                       08360013
083700     ELSE                                                         08370004
083800         SET PS-ERROR                                             08380013
083900             DP020-MSG-FATAL         TO TRUE                      08390013
084000         MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER          08400013
084100         MOVE DP015-UNP-ALP-BRT-OFF  TO APMCODEA                  08410013
084200         MOVE DP015-RED              TO APMCODEC                  08420013
084300         MOVE DP015-REVERSE          TO APMCODEH                  08430013
084400         MOVE -1                     TO APMCODEL                  08440013
084500         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      08450013
084600     END-IF.                                                      08460004
084700                                                                  08470004
084800     IF  PS-NO-ERROR                                              08480004
085100         IF  ASC-PARM-DESC  >  SPACES                             08510013
085200             CONTINUE                                             08520013
085300         ELSE                                                     08530013
085400             SET PS-ERROR                                         08540013
085500                 DP020-MSG-FATAL         TO TRUE                  08550013
085600             MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER      08560013
085700             MOVE DP015-UNP-ALP-BRT-OFF  TO APMDESCA              08570013
085800             MOVE DP015-RED              TO APMDESCC              08580013
085900             MOVE DP015-REVERSE          TO APMDESCH              08590013
086000             MOVE -1                     TO APMDESCL              08600013
086100             MOVE +1                     TO APMCODEL              08610013
086200             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08620013
086300     END-IF.                                                      08630004
086400                                                                  08640004
086500     IF  PS-NO-ERROR                                              08650004
086600         IF  ASC-PARM-TYPE  >  SPACES                             08660013
086700             IF  ASC-VALID-TYPE                                   08670013
086800                 CONTINUE                                         08680013
086900             ELSE                                                 08690013
087000                 SET PS-ERROR                                     08700013
087100                     DP020-MSG-FATAL         TO TRUE              08710013
087200                 MOVE PC-TSYMSG-00005        TO DP020-MSG-NUMBER  08720037
087300                 MOVE DP015-UNP-ALP-BRT-OFF  TO APMTYPEA          08730013
087400                 MOVE DP015-RED              TO APMTYPEC          08740013
087500                 MOVE DP015-REVERSE          TO APMTYPEH          08750013
087600                 MOVE -1                     TO APMTYPEL          08760013
087610                 MOVE +1                     TO APMCODEL          08761037
087700                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              08770013
087800             END-IF                                               08780013
087900         ELSE                                                     08790013
088000             SET PS-ERROR                                         08800013
088100                 DP020-MSG-FATAL         TO TRUE                  08810013
088200             MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER      08820013
088300             MOVE DP015-UNP-ALP-BRT-OFF  TO APMTYPEA              08830013
088400             MOVE DP015-RED              TO APMTYPEC              08840013
088500             MOVE DP015-REVERSE          TO APMTYPEH              08850013
088600             MOVE -1                     TO APMTYPEL              08860013
088700             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08870013
088800         END-IF.                                                  08880013
088900                                                                  08890013
089000*                                                                 08900004
089100******************************************************************08910004
089200** A ROW MUST EXIST ON TKRPRCD.                                   08920011
089300******************************************************************08930004
089400 3040-CHECK-4-ROW-ON-KRPRCD.                                      08940011
089500      MOVE ASC-PARM-CODE     TO DK-PARM-CODE.                     08950011
089600                                                                  08960004
089700        EXEC SQL                                                  08970004
089800          SELECT                                                  08980011
089900                  SYS_PRC_FUNC_CDE                                08990011
090000                 ,SYS_PRC_FUNC_DESC                               09000011
090100                 ,PRC_FUNC_TYP_CDE                                09010011
090200            INTO                                                  09020011
090300                 :KRPRCD-SYS-PRC-FUNC-CDE                         09030013
090400                ,:KRPRCD-SYS-PRC-FUNC-DESC                        09040011
090500                ,:KRPRCD-PRC-FUNC-TYP-CDE                         09050011
090600            FROM  TKRPRCD                                         09060011
090700           WHERE  SYS_PRC_FUNC_CDE = :DK-PARM-CODE                09070011
090800        END-EXEC                                                  09080004
090900                                                                  09090004
091000        EVALUATE TRUE                                             09100004
091100            WHEN SQLCODE = +0                                     09110004
091120                 IF  ASC-ADD-CODE                                 09112017
091130                     SET PS-ERROR                                 09113017
091140                         DP020-MSG-FATAL         TO TRUE          09114017
091150                     MOVE PC-TSYMSG-03707    TO DP020-MSG-NUMBER  09115024
091160                     MOVE DP015-UNP-ALP-BRT-OFF  TO APMCODEA      09116017
091170                     MOVE DP015-RED              TO APMCODEC      09117017
091180                     MOVE DP015-REVERSE          TO APMCODEH      09118017
091190                     MOVE -1                     TO APMCODEL      09119017
091191                     SET DP030-SET-CURSOR-APPL-1 TO TRUE          09119117
091420                 END-IF                                           09142017
091500                                                                  09150012
091600            WHEN SQLCODE = +100                                   09160004
091601                                                                  09160130
091610                 IF  ASC-ADD-CODE  OR                             09161033
091611                     ASC-FUNCTION-NONE                            09161133
091620                     CONTINUE                                     09162017
091630                 ELSE                                             09163017
091900                     SET PS-ERROR                                 09190017
092000                         DP020-MSG-FATAL         TO TRUE          09200017
092010                     EVALUATE TRUE                                09201030
092020                         WHEN ASC-ADD-PARM                        09202030
092100                              MOVE PC-TSYMSG-03721                09210030
092101                                             TO DP020-MSG-NUMBER  09210130
092102                         WHEN OTHER                               09210230
092110                              MOVE PC-TSYMSG-03708                09211030
092120                                             TO DP020-MSG-NUMBER  09212030
092130                     END-EVALUATE                                 09213030
092200                     MOVE DP015-UNP-ALP-BRT-OFF  TO APMCODEA      09220017
092300                     MOVE DP015-RED              TO APMCODEC      09230017
092400                     MOVE DP015-REVERSE          TO APMCODEH      09240017
092500                     MOVE -1                     TO APMCODEL      09250017
092600                     SET DP030-SET-CURSOR-APPL-1 TO TRUE          09260017
092610                 END-IF                                           09261017
092700                                                                  09270012
092800            WHEN SQLWARN0 NOT = SPACES                            09280004
092900            WHEN SQLCODE < +0                                     09290004
093000            WHEN SQLCODE > +0                                     09300004
093100                MOVE '3040-CHECK-4-ROW-ON-KRPRCD'                 09310011
093200                                          TO DP013-PARAGRAPH      09320004
093300                MOVE 'PROBLEM WITH RETRIEVING ROW'                09330004
093400                                    TO DP013-MESSAGE-TEXT (1)     09340004
093500                MOVE SQLCA      TO DP013-SQLCA                    09350004
093600                MOVE 'TKRPRCD'  TO DP013-DB2-TABLE-NAME (1)       09360011
093700                SET DP013-DB2-ABEND                               09370004
093800                    DP013-XCTL-DISPLAY-RESTART TO TRUE            09380004
093900                PERFORM DP013-0000-PROCESS-ABEND                  09390004
094000        END-EVALUATE.                                             09400004
094100                                                                  09410004
094200******************************************************************09420004
094300*  PARM TYPE CODE MUST BE VALID VALUE                             09430012
094400******************************************************************09440004
094500 3050-CHECK-VALID-TYPE.                                           09450012
094600     IF  ASC-VALID-TYPE                                           09460012
094700         CONTINUE                                                 09470012
094800     ELSE                                                         09480012
094900          SET PS-ERROR                                            09490004
095000              DP020-MSG-FATAL         TO TRUE                     09500004
095100          MOVE PC-TSYMSG-02575        TO DP020-MSG-NUMBER         09510004
095200          MOVE DP015-UNP-ALP-BRT-OFF  TO APMDESCA                 09520012
095300          MOVE DP015-RED              TO APMDESCC                 09530012
095400          MOVE DP015-REVERSE          TO APMDESCH                 09540012
095500          MOVE -1                     TO APMDESCL                 09550012
095600          MOVE +1                     TO APMCODEL                 09560008
095700          SET DP030-SET-CURSOR-APPL-1 TO TRUE                     09570004
095800     END-IF.                                                      09580004
095900                                                                  09590004
096000*----------------------------------------------------------------*09600004
096100* MOVE THE DEFAULT ATTRIBUTE VALUES TO THE ENTERABLE FIELDS ON   *09610004
096200* MAP.                                                           *09620004
096300*----------------------------------------------------------------*09630004
096400 3200-RESET-ATTRIBUTES.                                           09640004
096500     IF PS-NO-ERROR                                               09650004
096600         IF ASC-FUNCTION = PC-UPDATE                              09660019
096700             MOVE DP015-PRO-NOR-OFF        TO APMCODEA            09670008
096800             MOVE DP015-BLUE               TO APMCODEC            09680008
096900             MOVE DP015-HL-OFF             TO APMCODEH            09690008
097000             SET DP030-SET-CURSOR-APPL-1   TO TRUE                09700004
097100             MOVE -1                       TO APMDESCL            09710012
097200         ELSE                                                     09720004
097300             MOVE DP015-UNP-ALP-NOR-OFF    TO APMCODEA            09730008
097400                                              APMDESCA            09740013
097500                                              APMTYPEA            09750013
097600             MOVE DP015-GREEN              TO APMCODEC            09760008
097700                                              APMDESCC            09770013
097800                                              APMTYPEC            09780013
097900             MOVE DP015-UNDERLINE          TO APMCODEH            09790008
098000                                              APMDESCH            09800013
098100                                              APMTYPEH            09810013
098200             SET DP030-SET-CURSOR-APPL-1   TO TRUE                09820004
098300             MOVE -1                       TO APMCODEL            09830008
098400         END-IF                                                   09840004
098600         MOVE DP015-UNP-ALP-NOR-OFF    TO APMDESCA                09860020
098700                                          APMTYPEA                09870013
098900         MOVE DP015-GREEN              TO APMDESCC                09890021
099000                                          APMTYPEC                09900013
099200         MOVE DP015-UNDERLINE          TO APMDESCH                09920021
099300                                          APMTYPEH                09930013
099400     END-IF.                                                      09940004
099500                                                                  09950004
099600*----------------------------------------------------------------*09960004
099700*    VALIDATE THE QUEUE WAS PASSED AND DISPLAY FOR THE FIRST     *09970004
099800*    ENTRY.                                                      *09980004
099900*----------------------------------------------------------------*09990004
100000 4000-BUILD-INITIAL-PANEL.                                        10000004
100100     IF ASC-FUNCTION = PC-UPDATE                                  10010019
100200         MOVE DP015-PRO-NOR-OFF       TO APMCODEA                 10020008
100300                                         APMDESCA                 10030013
100400                                         APMTYPEA                 10040013
100500         MOVE DP015-BLUE              TO APMCODEC                 10050008
100600                                         APMDESCC                 10060013
100700                                         APMTYPEC                 10070013
100800         MOVE DP015-HL-OFF            TO APMCODEH                 10080008
100900                                         APMDESCH                 10090013
101000                                         APMTYPEH                 10100013
101100         MOVE -1                      TO APMDESCL                 10110012
101200         SET DP030-SET-CURSOR-APPL-1  TO TRUE                     10120004
101300     ELSE                                                         10130004
101400         IF ASC-PARM-CODE  = SPACES                               10140013
101500             SET DP030-SET-CURSOR-APPL-1  TO TRUE                 10150004
101600             MOVE -1                      TO APMCODEL             10160008
101700         ELSE                                                     10170004
101800             IF ASC-PARM-DESC  = SPACES                           10180013
101900                 SET DP030-SET-CURSOR-APPL-1  TO TRUE             10190004
102000                 MOVE -1                      TO APMDESCL         10200012
102100             ELSE                                                 10210004
102200                 SET DP030-SET-CURSOR-APPL-1  TO TRUE             10220004
102300                 MOVE -1                      TO APMTYPEL         10230012
102400             END-IF                                               10240004
102500         END-IF                                                   10250004
102600     END-IF.                                                      10260004
102700                                                                  10270004
102800                                                                  10280004
102900*----------------------------------------------------------------*10290004
103000*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *10300004
103100*----------------------------------------------------------------*10310004
103200 4400-MOVE-COMMAREA-TO-SCREEN.                                    10320004
103300     MOVE ASC-PARM-CODE            TO APMCODEO.                   10330013
103400     MOVE ASC-PARM-DESC            TO APMDESCO.                   10340013
103500     MOVE ASC-PARM-TYPE            TO APMTYPEO.                   10350013
103600                                                                  10360004
103700*------------------------------------------------------------     10370004
103800*  MOVE COMMAREA TO TEMP AREA                                     10380004
103900*------------------------------------------------------------     10390004
104000 4500-MOVE-COMMAREA-TO-TEMP.                                      10400004
104100     MOVE ASC-PARM-CODE           TO PV-INP-PARM-CODE.            10410013
104200     MOVE ASC-PARM-DESC           TO PV-INP-PARM-DESC.            10420013
104300     MOVE ASC-PARM-TYPE           TO PV-INP-PARM-TYPE.            10430013
104400                                                                  10440004
104500*----------------------------------------------------------------*10450004
104600* PROCESS TABLE INSERTS                                          *10460004
104700*----------------------------------------------------------------*10470004
104800 5000-PROCESS-ADD.                                                10480004
104900     MOVE SPACES         TO  PV-INP-PARM-CODE.                    10490013
105000     MOVE ASC-PARM-CODE  TO  PV-INP-PARM-CODE.                    10500013
105100                                                                  10510004
105200     PERFORM 6100-INSERT-TKRPRCD                                  10520011
105300                                                                  10530004
105400     IF PS-NO-ERROR                                               10540004
105500         IF ASC-TKRPRCD-INSERTED                                  10550011
105600             MOVE PC-TSYMSG-00034  TO DP020-MSG-NUMBER            10560004
105700             SET DP020-MSG-INFORMATIONAL TO TRUE                  10570004
105800         END-IF                                                   10580004
105900     END-IF.                                                      10590004
106000                                                                  10600004
106100*----------------------------------------------------------------*10610004
106200* PROCESS TABLE UPDATES                                          *10620004
106300*----------------------------------------------------------------*10630004
106400 5100-PROCESS-UPDATE.                                             10640004
106500     PERFORM 7100-UPDATE-TKRPRCD                                  10650011
106600                                                                  10660004
106700     IF ASC-TKRPRCD-UPDATED                                       10670011
106800        SET ASC-F2-CONFIRM-NO       TO TRUE                       10680004
106900        MOVE PC-TSYMSG-00059 TO DP020-MSG-NUMBER                  10690004
107000        SET DP020-MSG-INFORMATIONAL TO TRUE                       10700004
107100        MOVE DP015-PRO-NOR-OFF       TO APMCODEA                  10710008
107200                                        APMDESCA                  10720013
107300                                        APMTYPEA                  10730013
107400        MOVE DP015-BLUE              TO APMCODEC                  10740008
107500                                        APMDESCC                  10750013
107600                                        APMTYPEC                  10760013
107700        MOVE DP015-HL-OFF            TO APMCODEH                  10770008
107800                                        APMDESCH                  10780013
107900                                        APMTYPEH                  10790013
108000        MOVE -1                      TO APMCODEL                  10800013
108100        SET DP030-SET-CURSOR-APPL-1  TO TRUE                      10810004
108200     END-IF.                                                      10820004
108300                                                                  10830004
108400*----------------------------------------------------------------*10840004
108500* INSERT A ROW INTO THE CONTROL DC DOOR TABLE                    *10850004
108600*----------------------------------------------------------------*10860004
108700 6100-INSERT-TKRPRCD.                                             10870011
108800         EXEC SQL                                                 10880004
108900                 INSERT INTO TKRPRCD                              10890011
109000                 (                                                10900004
109100                  SYS_PRC_FUNC_CDE                                10910013
109200                 ,SYS_PRC_FUNC_DESC                               10920013
109300                 ,PRC_FUNC_TYP_CDE                                10930013
109400                 )                                                10940004
109500                 VALUES                                           10950004
109600                 (                                                10960004
109700                  :PV-INP-PARM-CODE                               10970013
109800                 ,:PV-INP-PARM-DESC                               10980013
109900                 ,:PV-INP-PARM-TYPE                               10990013
110000                 )                                                11000004
110100         END-EXEC.                                                11010004
110200                                                                  11020004
110300         EVALUATE TRUE                                            11030004
110400             WHEN SQLCODE = +0                                    11040004
110500                 SET ASC-TKRPRCD-INSERTED TO TRUE                 11050011
110600                 MOVE PV-INP-PARM-CODE    TO ASC-PARM-CODE        11060013
110700                 MOVE PV-INP-PARM-DESC    TO ASC-PARM-DESC        11070013
110800                 MOVE PV-INP-PARM-TYPE    TO ASC-PARM-TYPE        11080013
110900             WHEN SQLCODE = -803                                  11090004
111000                 MOVE PV-INP-PARM-CODE        TO APMCODEO         11100013
111100                 MOVE PC-TSYMSG-03709         TO DP020-MSG-NUMBER 11110016
111200                 SET DP020-MSG-FATAL                              11120004
111300                     PS-ERROR                 TO TRUE             11130004
111400                 MOVE DP015-RED               TO APMCODEC         11140008
111500                 MOVE DP015-REVERSE           TO APMCODEH         11150008
111600                 MOVE -1                      TO APMCODEL         11160008
111700                 SET DP030-SET-CURSOR-APPL-1  TO TRUE             11170004
111800             WHEN SQLWARN0 NOT = SPACES                           11180004
111900             WHEN SQLCODE < +0                                    11190004
112000             WHEN SQLCODE > +0                                    11200004
112100                 MOVE '6100-INSERT-TKRPRCD' TO DP013-PARAGRAPH    11210011
112200                 MOVE 'ERROR INSERTING ROW TO TKRPRCD'            11220011
112300                                   TO DP013-MESSAGE-TEXT (1)      11230004
112400                 MOVE SQLCA        TO DP013-SQLCA                 11240004
112500                 MOVE 'TKRPRCD'    TO DP013-DB2-TABLE-NAME (1)    11250011
112600                 SET DP013-DB2-ABEND                              11260004
112700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           11270004
112800                 PERFORM DP013-0000-PROCESS-ABEND                 11280004
112900         END-EVALUATE.                                            11290004
113000                                                                  11300004
113100******************************************************************11310004
113200** UPDATE A ROW ON THE PARM CODE TABLE - TKRPRCD                  11320013
113300******************************************************************11330004
113400 7100-UPDATE-TKRPRCD.                                             11340011
113500     MOVE ASC-PARM-CODE    TO KRPRCD-SYS-PRC-FUNC-CDE.            11350013
113600     MOVE ASC-PARM-DESC    TO KRPRCD-SYS-PRC-FUNC-DESC.           11360013
113700     MOVE ASC-PARM-TYPE    TO KRPRCD-PRC-FUNC-TYP-CDE.            11370013
113800                                                                  11380004
113900     PERFORM                                                      11390004
114000         WITH TEST AFTER                                          11400004
114100         VARYING PV-RETRY-COUNTER                                 11410004
114200         FROM 1 BY 1                                              11420004
114300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               11430004
114400         OR     (SQLCODE = ZERO)                                  11440004
114500         OR     (SQLCODE = +100))                                 11450004
114600                                                                  11460004
114700         EXEC SQL                                                 11470004
114800             UPDATE TKRPRCD                                       11480011
114900               SET                                                11490004
115000                  SYS_PRC_FUNC_DESC  = :KRPRCD-SYS-PRC-FUNC-DESC  11500013
115100                 ,PRC_FUNC_TYP_CDE   = :KRPRCD-PRC-FUNC-TYP-CDE   11510013
115200            WHERE SYS_PRC_FUNC_CDE   = :KRPRCD-SYS-PRC-FUNC-CDE   11520013
115300         END-EXEC                                                 11530004
115400                                                                  11540004
115500         EVALUATE TRUE                                            11550004
115600             WHEN SQLCODE = +0                                    11560004
115700                 SET ASC-TKRPRCD-UPDATED TO TRUE                  11570011
115800             WHEN SQLWARN0 NOT = SPACES                           11580004
115900             WHEN SQLCODE < +0                                    11590004
116000             WHEN SQLCODE > +0                                    11600004
116100                 MOVE '7100-UPDATE-TKRPRCD' TO DP013-PARAGRAPH    11610011
116200                 MOVE 'ERROR UPDATING THE DC DOOR TABLE'          11620004
116300                                   TO DP013-MESSAGE-TEXT (1)      11630004
116400                 MOVE SQLCA        TO DP013-SQLCA                 11640004
116500                 MOVE 'TKRPRCD'    TO DP013-DB2-TABLE-NAME (1)    11650011
116600                 SET DP013-DB2-ABEND                              11660004
116700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           11670004
116800                 PERFORM DP013-0000-PROCESS-ABEND                 11680004
116900         END-EVALUATE                                             11690004
117000     END-PERFORM.                                                 11700004
117100                                                                  11710004
117200     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         11720004
117300         MOVE '7100-UPDATE-TKRPRCD' TO DP013-PARAGRAPH            11730011
117400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     11740004
117500                                       TO DP013-MESSAGE-TEXT (1)  11750004
117600         MOVE SQLCA          TO DP013-SQLCA                       11760004
117700         MOVE 'TKRPRCD'      TO DP013-DB2-TABLE-NAME (1)          11770011
117800         SET DP013-DB2-ABEND                                      11780004
117900             DP013-XCTL-DISPLAY-RESTART TO TRUE                   11790004
118000         PERFORM DP013-0000-PROCESS-ABEND                         11800004
118100     END-IF.                                                      11810004
118200     MOVE +0 TO PV-RETRY-COUNTER.                                 11820004
118300                                                                  11830004
118400*----------------------------------------------------------------*11840004
118500* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *11850004
118600*----------------------------------------------------------------*11860004
118700 9100-READ-SEL-QUEUE.                                             11870004
118800     EXEC CICS                                                    11880004
118900         READQ TS                                                 11890004
119000             QUEUE (ASC-SEL-QUEUE-NAME)                           11900004
119100             INTO  (CN019-SELECT-RECORD)                          11910007
119200             ITEM  (ASC-SEL-ITEM)                                 11920004
119300             RESP  (PV-CICS-RESPONSE)                             11930004
119400     END-EXEC.                                                    11940004
119500                                                                  11950004
119600     IF  PV-CICS-RESPONSE = DFHRESP(NORMAL)                       11960004
119700         CONTINUE                                                 11970004
119800     ELSE                                                         11980004
119900         SET DP013-LOGIC-ABEND                                    11990004
120000             DP013-NO-ROLLBACK     TO TRUE                        12000004
120100         MOVE '9100-READ-SEL-QUEUE' TO DP013-PARAGRAPH            12010004
120200         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   12020004
120300                                   TO DP013-MESSAGE-TEXT (1)      12030004
120400         PERFORM DP013-0000-PROCESS-ABEND                         12040004
120500     END-IF.                                                      12050004
120600                                                                  12060004
120700*----------------------------------------------------------------*12070004
120800* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *12080004
120900*----------------------------------------------------------------*12090004
121000 9200-REWRITE-SEL-QUEUE.                                          12100004
121100     EXEC CICS                                                    12110004
121200          WRITEQ TS                                               12120004
121300              QUEUE  (ASC-SEL-QUEUE-NAME)                         12130004
121400              FROM   (CN019-SELECT-RECORD)                        12140007
121500              ITEM   (ASC-SEL-ITEM)                               12150004
121600              RESP   (PV-CICS-RESPONSE)                           12160004
121700              REWRITE                                             12170004
121800     END-EXEC.                                                    12180004
121900                                                                  12190004
122000     IF  PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                   12200004
122100         SET DP013-CICS-ABEND                                     12210004
122200             DP013-NO-ROLLBACK     TO TRUE                        12220004
122300         MOVE '9200-REWRITE-SEL-QUEUE'  TO DP013-PARAGRAPH        12230004
122400         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   12240004
122500                                   TO DP013-MESSAGE-TEXT (1)      12250004
122600         PERFORM DP013-0000-PROCESS-ABEND                         12260004
122700     END-IF.                                                      12270004
122800                                                                  12280004
122900     COPY DPPD013.                                                12290004
123000*----------------------------------------------------------------*12300004
123100*    ABEND PROCESSOR MODULE                                      *12310004
123200*----------------------------------------------------------------*12320004
