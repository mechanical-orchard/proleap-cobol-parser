000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.    TRKUP089.                                         00050000
000600 AUTHOR.        DENISE HAHN.                                      00060000
000700 INSTALLATION.  KOHLS.                                            00070000
000800 DATE-WRITTEN   NOVEMBER 2018                                     00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*  THIS PROGRAM IS USED TO CLEAN UP OLD INBOUND TRIPS.            00120000
001300*  INPUT FILES CREATED BY TRKUT089 CONTAINING OLD TRIPS THAT NEED 00130000
001400*  TO BE CLEANED UP.  ALSO CREATED FILE OF ASSOCIATED SHIPMENTS   00140000
001410*  THAT ALSO NEED TO BE CLEANED UP.                               00141000
001420*                                                                 00142000
001421*  THIS PROGRAM WILL TAKE BOTH FILE (TRIP & SHIPMENT) AND CREATE  00142100
001422*  DP (DEPARTED) & ET (END TRIP) INSERT SQL STATEMENTS FOR        00142200
001423*  TTRIPST & TSHIPST TABLES.                                      00142300
001426*                                                                 00142600
001427******************************************************************00142700
001428******************************************************************00142800
001429 ENVIRONMENT DIVISION.                                            00142900
001430******************************************************************00143000
001440                                                                  00144000
001450 CONFIGURATION SECTION.                                           00145000
001460                                                                  00146000
001470 SOURCE-COMPUTER.        IBM-3090.                                00147000
001480 OBJECT-COMPUTER.        IBM-3090.                                00148000
001490                                                                  00149000
001500 INPUT-OUTPUT SECTION.                                            00150000
001600                                                                  00160000
001700 FILE-CONTROL.                                                    00170000
001800                                                                  00180000
001900     SELECT TRIP-FILE                                             00190000
002000         ASSIGN TO INP01.                                         00200000
002100                                                                  00210000
002200     SELECT SHIP-FILE                                             00220000
002300         ASSIGN TO INP02.                                         00230000
002400                                                                  00240000
002700******************************************************************00270000
002800 DATA DIVISION.                                                   00280000
002900******************************************************************00290000
003000                                                                  00300000
003100 FILE SECTION.                                                    00310000
003200                                                                  00320000
003300 FD  TRIP-FILE                                                    00330000
003400     RECORDING MODE IS F                                          00340000
003500     LABEL RECORDS ARE STANDARD                                   00350000
003600     BLOCK CONTAINS 0 RECORDS.                                    00360000
003700*                                                                 00370000
003800 01  TRIP-RECORD.                                                 00380000
003900     05  FILLER                  PIC X(125).                      00390000
004000                                                                  00400000
004100 FD  SHIP-FILE                                                    00410000
004200     RECORDING MODE IS F                                          00420000
004300     LABEL RECORDS ARE STANDARD                                   00430000
004400     BLOCK CONTAINS 0 RECORDS.                                    00440000
004500*                                                                 00450000
004600 01  SHIP-RECORD.                                                 00460000
004700     05  FILLER                  PIC X(100).                      00470000
004800                                                                  00480000
004810                                                                  00481000
004890*                                                                 00489000
004900******************************************************************00490000
005000 WORKING-STORAGE SECTION.                                         00500000
005100******************************************************************00510000
005800*                                                                 00580000
005900******************************************************************00590000
006000*  TRIP FILE                                                      00600000
006100******************************************************************00610000
006200     COPY TRRD074.                                                00620000
006300*                                                                 00630000
006400******************************************************************00640000
006500*  SHPMT FILE                                                     00650000
006600******************************************************************00660000
006610     COPY TRRD075.                                                00661000
006620*                                                                 00662000
006630*                                                                 00663000
006640 01  ABEND-CODE                      PIC S9(04)    VALUE +0       00664000
006650                                                   COMP SYNC.     00665000
006660                                                                  00666000
006670 01  PC-PROGRAM-CONSTANTS.                                        00667000
006680     05  PC-TRKUP089                 PIC X(08) VALUE 'TRKUP089'.  00668000
006681                                                                  00668100
006682 01  PS-PROGRAM-SWITCHES.                                         00668200
006683     05  PS-EOF-TRIP-SW              PIC  X(01)    VALUE 'N'.     00668300
006690         88  PS-EOF-TRIP                           VALUE 'Y'.     00669000
006700         88  PS-MORE-TRIP                          VALUE 'N'.     00670000
006800     05  PS-EOF-SHIP-SW              PIC  X(01)    VALUE 'N'.     00680000
006900         88  PS-EOF-SHIP                           VALUE 'Y'.     00690000
007000         88  PS-MORE-SHIP                          VALUE 'N'.     00700000
007100                                                                  00710000
007110 01  DK-DB2-KEYS.                                                 00711000
007120     05  DK-TRIP-ID                  PIC  S9(9) COMP VALUE ZEROES.00712000
007121                                                                  00712100
007130 01  PROGRAM-VARIABLES.                                           00713000
007140     05  PV-DISP-OPER-UNT            PIC  9(04).                  00714000
007141     05  PV-DISP-TRIP-ID             PIC  9(09).                  00714100
007142     05  PV-DISP-SHIPMT-ID           PIC  9(09).                  00714200
007143     05  PV-TRIP-COUNT               PIC  9(09).                  00714300
007144     05  PV-TTRIPST-CNT              PIC  9(09).                  00714400
007145     05  PV-TSHIPST-CNT              PIC  9(09).                  00714500
007146     05  PV-COMMIT-CNT               PIC  9(09).                  00714600
007150     05  PV-SHPMT-COUNT              PIC S9(09)  VALUE ZEROES     00715000
007160                                                 COMP.            00716000
007170     05  PV-NULL-IND-1               PIC S9(04)  VALUE ZEROS      00717000
007180                                                 COMP SYNC.       00718000
007190     05  PV-NULL-IND-2               PIC S9(04)  VALUE ZEROS      00719000
007191                                                 COMP SYNC.       00719100
007192     05  PV-DISP-TRIP                PIC  Z(10)  VALUE ZEROS.     00719200
007193     05  PV-DISP-OPER                PIC  Z(03)  VALUE ZERO.      00719300
007194                                                                  00719400
007196     05  PV-ITEM-NBR                 PIC  9(15)    VALUE ZERO.    00719600
007197     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  00719700
007198     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  00719800
007200     05  PV-VEHICL-COUNT             PIC S9(09)    VALUE ZERO.    00720000
007201     05  PV-SHIP-COUNT               PIC S9(09)    VALUE ZERO.    00720100
007202     05  PV-READ-COUNTER             PIC S9(09)    VALUE ZERO     00720200
007203                                                   COMP SYNC.     00720300
007204     05  PV-WRITE-COUNTER            PIC S9(09)    VALUE ZERO     00720400
007205                                                   COMP SYNC.     00720500
007206     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.             00720600
007207                                                                  00720700
007208     05  PV-DB2-COUNT                PIC S9(09)    VALUE ZERO     00720800
007209                                                   COMP-3.        00720900
007210     05  PV-TMST-HOLD                PIC X(26).                   00721000
007211     05  PV-TMST-HOLD-R REDEFINES PV-TMST-HOLD.                   00721100
007213         10  PV-TMST-DATE            PIC X(10).                   00721300
007214         10  PV-TMST-TIME            PIC X(16).                   00721400
007215             88 PV-DP-TIME      VALUE '-00.01.00.000000'.         00721500
007216             88 PV-ET-TIME      VALUE '-00.02.00.000000'.         00721600
007217                                                                  00721700
007218 01  PV-ABEND-FIELDS.                                             00721803
007219     05  PV-ABEND-PROGRAM             PIC X(8)   VALUE 'TRKUP089'.00721903
007220     05  PV-ABEND-CODE               PIC S9(04)  VALUE +0         00722003
007221                                                 COMP SYNC.       00722103
007222     05  PV-PARAGRAPH-NAME           PIC  X(30)  VALUE SPACES.    00722203
007223     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)  VALUE SPACES.    00722303
007224     05  PV-ABEND-PARAGRAPH          PIC  X(30)  VALUE SPACES.    00722403
007225     05  PV-ABEND-OPERATION          PIC  X(30)  VALUE SPACES.    00722503
007226     05  PV-DB2-OPER-ATTEMPTED       PIC  X(30)  VALUE SPACES.    00722603
007227     05  PV-DB2-OPERATION-MESSAGE-1  PIC  X(79)  VALUE SPACES.    00722703
007228     05  PV-DB2-OPERATION-MESSAGE-2  PIC  X(79)  VALUE SPACES.    00722803
007229     05  PV-DB2-OPERATION-MESSAGE-3  PIC  X(79)  VALUE SPACES.    00722903
007230     05  PV-DB2-OPERATION-MESSAGE-4  PIC  X(79)  VALUE SPACES.    00723003
007231     05  PV-SQLCODE                  PIC -Z(03)  VALUE ZERO.      00723103
007232     05  PV-NEW-STATUS-DTE           PIC  X(10)  VALUE SPACES.    00723203
007233                                                                  00723303
007240                                                                  00724000
009098***************************************************************** 00909800
009099*    SQL ABEND ROUTINE WORKING STORAGE                          * 00909900
009100***************************************************************** 00910000
009200     COPY DPWS004.                                                00920000
009210                                                                  00921000
009260     EXEC SQL                                                     00926000
009270        INCLUDE TTRIPST                                           00927000
009271     END-EXEC.                                                    00927100
009284                                                                  00928400
009285     EXEC SQL                                                     00928500
009286        INCLUDE TSHIPST                                           00928600
009287     END-EXEC.                                                    00928700
009288                                                                  00928800
009289***************************************************************** 00928900
009290*   DB2 SQL COMMUNICATION AREA                                  * 00929000
009291***************************************************************** 00929100
009292     EXEC SQL                                                     00929200
009293          INCLUDE SQLCA                                           00929300
009294     END-EXEC.                                                    00929400
009295                                                                  00929500
009299                                                                  00929900
009300******************************************************************00930000
009400 PROCEDURE DIVISION.                                              00940000
009500******************************************************************00950000
009600                                                                  00960000
009700 0000-PROGRAM-MAINLINE.                                           00970000
009800******************************************************************00980000
009900* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     00990000
010000*      PROGRAM.                                                   01000000
010100******************************************************************01010000
010200                                                                  01020000
010300     PERFORM 1000-INITIALIZE.                                     01030000
010400                                                                  01040000
010500     IF PS-MORE-TRIP                                              01050000
010600         PERFORM 2000-PROCESS-TRIP                                01060000
010700            UNTIL PS-EOF-TRIP                                     01070000
010800     END-IF.                                                      01080000
010900                                                                  01090000
010910     SET  PS-MORE-SHIP  TO  TRUE.                                 01091000
010911                                                                  01091100
010912     IF PS-MORE-SHIP                                              01091200
010913         PERFORM 2100-PROCESS-SHIP                                01091300
010914            UNTIL PS-EOF-SHIP                                     01091400
010915     END-IF.                                                      01091500
010916                                                                  01091600
010917     PERFORM 9000-EOJ-ROUTINE.                                    01091700
010918                                                                  01091800
010919     STOP RUN.                                                    01091900
010920                                                                  01092000
010930 1000-INITIALIZE.                                                 01093000
010940******************************************************************01094000
010950*  DO FIRST TIME PROGRAM INITIALIZATION TASKS.                    01095000
010960*    -- OPEN FILES                                                01096000
010970******************************************************************01097000
010980                                                                  01098000
010990     OPEN INPUT TRIP-FILE                                         01099000
011000                SHIP-FILE.                                        01100002
011200                                                                  01120000
011300 2000-PROCESS-TRIP.                                               01130000
011400******************************************************************01140000
011500*  PROCESS THE TRIP FILE.                                         01150000
011600******************************************************************01160000
011700                                                                  01170000
011800     PERFORM 8000-READ-TRIP.                                      01180000
011900                                                                  01190000
012000     IF PS-EOF-TRIP                                               01200000
012100         CONTINUE                                                 01210000
012200     ELSE                                                         01220000
012300         IF  TR074-TRIP-STATUS-CDE  = 'DP'                        01230000
012310             MOVE TR074-TRIP-ID        TO TRIPST-TRIP-ID          01231000
012320             MOVE 'ET'                 TO TRIPST-TRIP-STATUS-CDE  01232000
012330             MOVE TR074-NEW-STATUS-DTE TO TRIPST-STATUS-DTE       01233000
012340             MOVE '00:02:00'           TO TRIPST-STATUS-TME       01234000
012350             MOVE PC-TRKUP089          TO TRIPST-STATUS-UID       01235000
012360             MOVE TR074-OPER-UNT-ID    TO TRIPST-OPER-UNT-ID      01236000
012370             MOVE 1                    TO TRIPST-FCLTY-ID         01237000
012380             MOVE SPACES               TO TRIPST-FCLTY-AREA-ID    01238000
013231             MOVE TR074-NEW-STATUS-DTE TO PV-TMST-DATE            01323100
013232             SET  PV-ET-TIME           TO TRUE                    01323200
013233             MOVE PV-TMST-HOLD         TO TRIPST-CRE-TMST         01323300
013234                                                                  01323400
013235             PERFORM 8200-INSERT-TTRIPST                          01323500
013236         ELSE                                                     01323600
013237             MOVE TR074-TRIP-ID        TO TRIPST-TRIP-ID          01323700
013238             MOVE 'DP'                 TO TRIPST-TRIP-STATUS-CDE  01323800
013239             MOVE TR074-NEW-STATUS-DTE TO TRIPST-STATUS-DTE       01323900
013240             MOVE '00:01:00'           TO TRIPST-STATUS-TME       01324000
013241             MOVE PC-TRKUP089          TO TRIPST-STATUS-UID       01324100
013242             MOVE TR074-OPER-UNT-ID    TO TRIPST-OPER-UNT-ID      01324200
013243             MOVE 1                    TO TRIPST-FCLTY-ID         01324300
013244             MOVE SPACES               TO TRIPST-FCLTY-AREA-ID    01324400
013245             MOVE TR074-NEW-STATUS-DTE TO PV-TMST-DATE            01324500
013246             SET  PV-DP-TIME           TO TRUE                    01324600
013247             MOVE PV-TMST-HOLD         TO TRIPST-CRE-TMST         01324700
013248                                                                  01324800
013249             PERFORM 8200-INSERT-TTRIPST                          01324900
013252                                                                  01325200
013253             MOVE TR074-TRIP-ID        TO TRIPST-TRIP-ID          01325300
013254             MOVE 'ET'                 TO TRIPST-TRIP-STATUS-CDE  01325400
013255             MOVE TR074-NEW-STATUS-DTE TO TRIPST-STATUS-DTE       01325500
013256             MOVE '00:02:00'           TO TRIPST-STATUS-TME       01325600
013257             MOVE PC-TRKUP089          TO TRIPST-STATUS-UID       01325700
013258             MOVE TR074-OPER-UNT-ID    TO TRIPST-OPER-UNT-ID      01325800
013259             MOVE 1                    TO TRIPST-FCLTY-ID         01325900
013260             MOVE SPACES               TO TRIPST-FCLTY-AREA-ID    01326000
013261             MOVE TR074-NEW-STATUS-DTE TO PV-TMST-DATE            01326100
013262             SET  PV-ET-TIME           TO TRUE                    01326200
013263             MOVE PV-TMST-HOLD         TO TRIPST-CRE-TMST         01326300
013264                                                                  01326400
013265             PERFORM 8200-INSERT-TTRIPST                          01326500
013267                                                                  01326700
013285         END-IF                                                   01328500
013286                                                                  01328600
013340     END-IF.                                                      01334000
013341                                                                  01334104
013342     IF  PV-COMMIT-CNT > 50                                       01334204
013343         PERFORM 8500-COMMIT                                      01334304
013344         MOVE ZEROES TO PV-COMMIT-CNT                             01334404
013345     END-IF.                                                      01334504
013350                                                                  01335000
013360                                                                  01336000
013370 2100-PROCESS-SHIP.                                               01337000
013380******************************************************************01338000
013390*  PROCESS THE SHIPMENT FILE.                                     01339000
013400******************************************************************01340000
013500                                                                  01350000
013600     PERFORM 8100-READ-SHIP.                                      01360000
013610                                                                  01361000
013620     IF PS-EOF-SHIP                                               01362000
013630         CONTINUE                                                 01363000
013640     ELSE                                                         01364000
013650         IF  TR075-SHIPT-STATUS-CDE = 'DP'                        01365000
013651             MOVE TR075-SHIPT-ID        TO SHIPST-SHIPT-ID        01365100
013652             MOVE 'ET'                  TO SHIPST-SHIPT-STATUS-CDE01365200
013653             MOVE TR075-NEW-STATUS-DTE  TO SHIPST-STATUS-DTE      01365303
013654             MOVE '00:02:00'            TO SHIPST-STATUS-TME      01365400
013655             MOVE PC-TRKUP089           TO SHIPST-STATUS-UID      01365500
013656             MOVE SPACES                TO SHIPST-DELAY-RSN-CDE   01365600
013657             MOVE SPACES                TO SHIPST-CARR-STATUS-CDE 01365700
013658             MOVE SPACES                TO SHIPST-TIME-ZONE-CDE   01365800
013659             MOVE SPACES                TO SHIPST-CITY-NAME       01365900
013660             MOVE SPACES                TO SHIPST-STATE-CDE       01366000
013698             MOVE TR075-NEW-STATUS-DTE  TO PV-TMST-DATE           01369800
013699             SET  PV-ET-TIME            TO TRUE                   01369900
013700             MOVE PV-TMST-HOLD          TO SHIPST-CRE-TMST        01370000
013701                                                                  01370100
013702             PERFORM 8400-INSERT-TSHIPST                          01370200
013703         ELSE                                                     01370300
013704             MOVE TR075-SHIPT-ID        TO SHIPST-SHIPT-ID        01370400
013705             MOVE 'DP'                  TO SHIPST-SHIPT-STATUS-CDE01370500
013706             MOVE TR075-NEW-STATUS-DTE  TO SHIPST-STATUS-DTE      01370603
013707             MOVE '00:01:00'            TO SHIPST-STATUS-TME      01370700
013708             MOVE PC-TRKUP089           TO SHIPST-STATUS-UID      01370800
013709             MOVE SPACES                TO SHIPST-DELAY-RSN-CDE   01370900
013710             MOVE SPACES                TO SHIPST-CARR-STATUS-CDE 01371000
013711             MOVE SPACES                TO SHIPST-TIME-ZONE-CDE   01371100
013712             MOVE SPACES                TO SHIPST-CITY-NAME       01371200
013713             MOVE SPACES                TO SHIPST-STATE-CDE       01371300
013714             MOVE TR075-NEW-STATUS-DTE  TO PV-TMST-DATE           01371400
013715             SET  PV-DP-TIME            TO TRUE                   01371500
013716             MOVE PV-TMST-HOLD          TO SHIPST-CRE-TMST        01371600
013717                                                                  01371700
013733             PERFORM 8400-INSERT-TSHIPST                          01373300
013734                                                                  01373400
013735             MOVE TR075-SHIPT-ID        TO SHIPST-SHIPT-ID        01373500
013736             MOVE 'ET'                  TO SHIPST-SHIPT-STATUS-CDE01373600
013737             MOVE TR075-NEW-STATUS-DTE  TO SHIPST-STATUS-DTE      01373703
013738             MOVE '00:02:00'            TO SHIPST-STATUS-TME      01373800
013739             MOVE PC-TRKUP089           TO SHIPST-STATUS-UID      01373900
013740             MOVE SPACES                TO SHIPST-DELAY-RSN-CDE   01374000
013741             MOVE SPACES                TO SHIPST-CARR-STATUS-CDE 01374100
013742             MOVE SPACES                TO SHIPST-TIME-ZONE-CDE   01374200
013743             MOVE SPACES                TO SHIPST-CITY-NAME       01374300
013744             MOVE SPACES                TO SHIPST-STATE-CDE       01374400
013745             MOVE TR075-NEW-STATUS-DTE  TO PV-TMST-DATE           01374500
013746             SET  PV-ET-TIME            TO TRUE                   01374600
013747             MOVE PV-TMST-HOLD          TO SHIPST-CRE-TMST        01374700
013748                                                                  01374800
013749             PERFORM 8400-INSERT-TSHIPST                          01374900
013766         END-IF                                                   01376600
013767                                                                  01376700
013768     END-IF.                                                      01376800
013769                                                                  01376904
013770     IF  PV-COMMIT-CNT > 50                                       01377004
013771         PERFORM 8500-COMMIT                                      01377104
013772         MOVE ZEROES TO PV-COMMIT-CNT                             01377204
013773     END-IF.                                                      01377304
013774                                                                  01377404
013775                                                                  01377500
013776                                                                  01377600
013777 8000-READ-TRIP.                                                  01377700
013778******************************************************************01377800
013780*  READ THE TRIP DATA                                             01378000
013790******************************************************************01379000
013800     READ TRIP-FILE                                               01380000
013900          INTO  TR074-RECORD                                      01390000
014000          AT END                                                  01400000
014100             SET PS-EOF-TRIP TO TRUE.                             01410000
014200                                                                  01420000
014300     IF  PS-EOF-TRIP                                              01430000
014310         DISPLAY ' '                                              01431000
014400         CONTINUE                                                 01440000
014500     ELSE                                                         01450000
014600         ADD +1 TO PV-TRIP-COUNT                                  01460000
014610                                                                  01461000
014611         MOVE TR074-TRIP-ID     TO PV-DISP-TRIP-ID                01461100
014612         MOVE TR074-OPER-UNT-ID TO PV-DISP-OPER-UNT               01461200
014620         DISPLAY  'TTRIPST: '                                     01462000
014621                  TR074-OWNER-SCAC-ID   '/'                       01462100
014630                  TR074-VEH-NBR         ' '                       01463000
014640                  PV-DISP-TRIP-ID       ' '                       01464000
014660                  TR074-TRIP-STATUS-CDE ' '                       01466000
014670                  TR074-TRIP-STATUS-DTE ' '                       01467000
014680                  TR074-TRIP-STATUS-TME ' '                       01468000
014690                  TR074-TRIP-STATUS-UID ' '                       01469000
014691                  PV-DISP-OPER-UNT                                01469100
014700     END-IF.                                                      01470000
014800                                                                  01480000
014900                                                                  01490000
015000 8100-READ-SHIP.                                                  01500000
015010******************************************************************01501000
015020*  READ THE SHIP DATA                                             01502000
015030******************************************************************01503000
015040     READ SHIP-FILE                                               01504000
015050          INTO  TR075-RECORD                                      01505000
015060          AT END                                                  01506000
015070             SET PS-EOF-SHIP TO TRUE.                             01507000
015080                                                                  01508000
015090     IF  PS-EOF-SHIP                                              01509000
015091         DISPLAY ' '                                              01509100
015092         CONTINUE                                                 01509200
015093     ELSE                                                         01509300
015094         ADD +1 TO PV-SHIP-COUNT                                  01509400
015095                                                                  01509500
015096         MOVE TR075-TRIP-ID     TO PV-DISP-TRIP-ID                01509600
015097         MOVE TR075-SHIPT-ID    TO PV-DISP-SHIPMT-ID              01509700
015098         DISPLAY  'TSHIPST: '                                     01509800
015099                  PV-DISP-TRIP-ID        ' '                      01509900
015100                  PV-DISP-SHIPMT-ID      ' '                      01510000
015101                  TR075-SHIPT-STATUS-CDE ' '                      01510100
015102                  TR075-STATUS-DTE       ' '                      01510200
015103                  TR075-STATUS-TME       ' '                      01510300
015107     END-IF.                                                      01510700
015108                                                                  01510800
015109                                                                  01510900
015110******************************************************************01511000
015111* TTRIPST INSERTS                                                 01511100
015112******************************************************************01511200
015120 8200-INSERT-TTRIPST.                                             01512003
015200                                                                  01520000
015210     EXEC SQL                                                     01521000
015300          INSERT                                                  01530000
015310            INTO TTRIPST                                          01531000
015500                ( TRIP_ID                                         01550000
015600                , TRIP_STATUS_CDE                                 01560000
015700                , STATUS_DTE                                      01570000
015800                , STATUS_TME                                      01580000
015900                , STATUS_UID                                      01590000
016000                , OPER_UNT_ID                                     01600000
016100                , FCLTY_ID                                        01610000
016200                , FCLTY_AREA_ID                                   01620000
016300                , CRE_TMST)                                       01630000
016400          VALUES                                                  01640000
016500                (:TRIPST-TRIP-ID                                  01650000
016600                ,:TRIPST-TRIP-STATUS-CDE                          01660000
016700                ,:TRIPST-STATUS-DTE                               01670000
016800                ,:TRIPST-STATUS-TME                               01680000
016900                ,:TRIPST-STATUS-UID                               01690000
017000                ,:TRIPST-OPER-UNT-ID                              01700000
017100                ,:TRIPST-FCLTY-ID                                 01710000
017200                ,:TRIPST-FCLTY-AREA-ID                            01720000
017210                , CURRENT TIMESTAMP                               01721005
017300                )                                                 01730000
017400     END-EXEC.                                                    01740000
017500                                                                  01750000
017600     EVALUATE TRUE                                                01760000
017700         WHEN SQLCODE = ZERO                                      01770000
017710         WHEN SQLCODE = -803                                      01771000
017720              ADD +1 TO PV-TTRIPST-CNT                            01772000
017730                        PV-COMMIT-CNT                             01773000
018100                                                                  01810000
018400         WHEN OTHER                                               01840000
018500             MOVE '8200-WRITE-TTRIPST-SQL'                        01850000
018600                                       TO PV-ABEND-PARAGRAPH      01860000
018700             MOVE 'INSERT TTRIPST'     TO PV-ABEND-OPERATION      01870000
018800             PERFORM 9900-DB2-ABEND                               01880000
018900     END-EVALUATE.                                                01890000
019000                                                                  01900000
019100                                                                  01910000
019800                                                                  01980000
020410                                                                  02041000
020420******************************************************************02042000
020430* TSHIPST INSERTS                                                 02043000
020431******************************************************************02043100
020432 8400-INSERT-TSHIPST.                                             02043200
020433                                                                  02043300
020434     EXEC SQL                                                     02043400
020435          INSERT                                                  02043500
020436            INTO TSHIPST                                          02043600
020437                (SHIPT_ID                                         02043700
020438                ,SHIPT_STATUS_CDE                                 02043800
020439                ,STATUS_DTE                                       02043900
020440                ,STATUS_TME                                       02044000
020441                ,STATUS_UID                                       02044100
020442                ,DELAY_RSN_CDE                                    02044200
020450                ,CARR_STATUS_CDE                                  02045000
020460                ,TIME_ZONE_CDE                                    02046000
020470                ,CITY_NAME                                        02047000
020480                ,STATE_CDE                                        02048000
020490                ,CRE_TMST)                                        02049000
020491          VALUES                                                  02049100
020492                (:SHIPST-SHIPT-ID                                 02049200
020493                ,:SHIPST-SHIPT-STATUS-CDE                         02049300
020494                ,:SHIPST-STATUS-DTE                               02049400
020495                ,:SHIPST-STATUS-TME                               02049500
020496                ,:SHIPST-STATUS-UID                               02049600
020497                ,:SHIPST-DELAY-RSN-CDE                            02049700
020498                ,:SHIPST-CARR-STATUS-CDE                          02049800
020499                ,:SHIPST-TIME-ZONE-CDE                            02049900
020500                ,:SHIPST-CITY-NAME                                02050000
020501                ,:SHIPST-STATE-CDE                                02050100
020502                , CURRENT TIMESTAMP                               02050205
020503                )                                                 02050300
020504     END-EXEC.                                                    02050400
020505                                                                  02050500
020506     EVALUATE TRUE                                                02050600
020507         WHEN SQLCODE = ZERO                                      02050700
020508         WHEN SQLCODE = -803                                      02050800
020509              ADD +1 TO PV-TSHIPST-CNT                            02050900
020510                        PV-COMMIT-CNT                             02051000
020515                                                                  02051500
020516         WHEN OTHER                                               02051600
020517             MOVE '8400-INSERT-TSHIPST   '                        02051700
020518                                       TO PV-ABEND-PARAGRAPH      02051800
020519             MOVE 'INSERT TSHIPST'     TO PV-ABEND-OPERATION      02051900
020520             PERFORM 9900-DB2-ABEND                               02052000
020521     END-EVALUATE.                                                02052100
020522                                                                  02052204
020523                                                                  02052304
020524                                                                  02052404
020525******************************************************************02052504
020526*  COMMIT                                                         02052604
020527******************************************************************02052704
020528 8500-COMMIT.                                                     02052804
020529                                                                  02052904
020530     EXEC SQL                                                     02053004
020531         COMMIT                                                   02053104
020532     END-EXEC.                                                    02053204
020533                                                                  02053304
020534     DISPLAY ' '.                                                 02053404
020535     DISPLAY 'COMMIT'                                             02053504
020536     DISPLAY ' '.                                                 02053604
020537                                                                  02053704
020540                                                                  02054000
020541******************************************************************02054100
020542*  CLOSE OUTPUT FILE.                                             02054200
020543******************************************************************02054300
020544 9000-EOJ-ROUTINE.                                                02054400
020600     CLOSE TRIP-FILE                                              02060000
020700           SHIP-FILE.                                             02070000
020900                                                                  02090000
021000     DISPLAY 'TRKUP089 COUNTS'.                                   02100000
021100     DISPLAY ' '.                                                 02110000
021200     MOVE PV-TRIP-COUNT           TO PV-DISPLAY-COUNT             02120000
021300     DISPLAY 'TOTAL TRIP CNT:   '    PV-DISPLAY-COUNT.            02130000
021400     MOVE PV-TTRIPST-CNT          TO PV-DISPLAY-COUNT             02140000
021500     DISPLAY 'TTRIPST INSERTS:  '    PV-DISPLAY-COUNT.            02150000
021501     DISPLAY ' '.                                                 02150100
021510                                                                  02151000
021600     MOVE PV-SHIP-COUNT   TO PV-DISPLAY-COUNT                     02160000
021700     DISPLAY 'TOTAL SHIPMT CNT: '    PV-DISPLAY-COUNT.            02170000
021701     MOVE PV-TSHIPST-CNT          TO PV-DISPLAY-COUNT             02170100
021702     DISPLAY 'TSHIPST INSERTS:  '    PV-DISPLAY-COUNT.            02170200
021703     DISPLAY ' '.                                                 02170300
021710                                                                  02171000
021800***********************************************************       02180000
021900*                                                         *       02190000
022000***********************************************************       02200000
022100 9900-DB2-ABEND.                                                  02210000
022200                                                                  02220000
022300     MOVE SQLCODE TO PV-SQLCODE.                                  02230000
022400     DISPLAY '*** DB2 ERROR '.                                    02240000
022500     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       02250000
022600     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 02260000
022700     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               02270000
022800     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               02280000
022900     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       02290000
023000     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       02300000
023100     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       02310000
023200                                                                  02320000
023300     COPY DPPD004.                                                02330000
023400                                                                  02340000
023500     IF SQLCODE NOT = -911                                        02350000
023600         EXEC SQL                                                 02360000
023700              ROLLBACK                                            02370000
023800         END-EXEC                                                 02380000
023900     END-IF.                                                      02390000
024000                                                                  02400000
024100     MOVE +4013                  TO PV-ABEND-CODE.                02410000
024200     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         02420000
024300                                                                  02430000
