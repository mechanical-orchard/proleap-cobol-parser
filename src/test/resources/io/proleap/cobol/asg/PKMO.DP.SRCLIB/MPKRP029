000100******************************************************************00010005
000200 IDENTIFICATION DIVISION.                                         00020005
000300******************************************************************00030005
000400                                                                  00040005
000500 PROGRAM-ID.             MPKRP029.                                00050005
000600 AUTHOR.                 MARY SARDINA.                            00060005
000700 INSTALLATION.           KOHLS.                                   00070005
000800 DATE-WRITTEN            OCTOBER, 1995.                           00080005
000900 DATE-COMPILED.                                                   00090005
001000                                                                  00100005
001100******************************************************************00110005
001200*       THIS PROGRAM REPORTS BY AREA AND OPERATION ID             00120005
001300*       THE NUMBER OF UPCS THAT HAVE NOT BEEN CERTIFIED.          00130005
001400******************************************************************00140005
001500                                                                  00150005
001600******************************************************************00160005
001700 ENVIRONMENT DIVISION.                                            00170005
001800******************************************************************00180005
001900                                                                  00190005
002000 CONFIGURATION SECTION.                                           00200005
002100                                                                  00210005
002200 SOURCE-COMPUTER.        IBM-3090.                                00220005
002300 OBJECT-COMPUTER.        IBM-3090.                                00230005
002400                                                                  00240005
002500 INPUT-OUTPUT SECTION.                                            00250005
002600                                                                  00260005
002700 FILE-CONTROL.                                                    00270005
002800                                                                  00280005
002900     SELECT MP-EXTRACT-FILE                                       00290005
003000         ASSIGN TO INP01.                                         00300005
003100                                                                  00310005
003200     SELECT MP-REPORT-FILE                                        00320005
003300         ASSIGN TO RPT01.                                         00330005
003400                                                                  00340005
003500******************************************************************00350005
003600 DATA DIVISION.                                                   00360005
003700******************************************************************00370005
003800                                                                  00380005
003900 FILE SECTION.                                                    00390005
004000                                                                  00400005
004100 FD  MP-EXTRACT-FILE                                              00410005
004200     RECORDING MODE IS F                                          00420005
004300     LABEL RECORDS ARE STANDARD                                   00430005
004400     BLOCK CONTAINS 0 RECORDS.                                    00440005
004500                                                                  00450005
004600 01  MP-EXTRACT-RECORD                   PIC  X(150).             00460005
004700                                                                  00470005
004800 FD  MP-REPORT-FILE                                               00480005
004900     RECORDING MODE IS F                                          00490005
005000     LABEL RECORDS ARE STANDARD                                   00500005
005100     BLOCK CONTAINS 0 RECORDS.                                    00510005
005200                                                                  00520005
005300 01  MP-REPORT-LINE                      PIC  X(132).             00530005
005400                                                                  00540005
005500******************************************************************00550005
005600 WORKING-STORAGE SECTION.                                         00560005
005700******************************************************************00570005
005800                                                                  00580005
005900*                                                                 00590005
006000*  STANDARD REPORT HEADER FOR A 132 COLUMN REPORT.                00600005
006100*                                                                 00610005
006200     COPY DPWS132O.                                               00620005
006300*                                                                 00630005
006400*  WORK AREA FOR FISCAL CALENDAR ROUTINE.                         00640005
006500*                                                                 00650005
006600     COPY DPWS500.                                                00660005
006700                                                                  00670005
006800*                                                                 00680005
006900*  WORK AREA FOR THE NUMERIC EDIT SUBROUTINE.                     00690005
007000*                                                                 00700005
007100     COPY DPWS010I.                                               00710005
007200                                                                  00720005
007300 01  ABEND-CODE                          PIC S9(04) VALUE +0      00730005
007400                                                     COMP SYNC.   00740005
007500                                                                  00750005
007600*                                                                 00760005
007700*  WORK AREA FOR SQL ERROR ROUTINE 'DSNTIAR'                      00770005
007800*                                                                 00780005
007900     COPY DPWS004.                                                00790005
008000                                                                  00800005
008100 01  CC-CONTROL-CARD.                                             00810005
008200     05  CC-CONTROL                      PIC  X(07) VALUE SPACE.  00820005
008300     05  FILLER                          PIC  X(01) VALUE SPACE.  00830005
008400     05  CC-START-DATE.                                           00840005
008500         10  CC-START-MONTH              PIC  9(02).              00850005
008600         10  CC-START-DAY                PIC  9(02).              00860005
008700         10  CC-START-CENTURY            PIC  9(02).              00870005
008800         10  CC-START-YEAR               PIC  9(02).              00880005
008900     05  FILLER                          PIC  X(01) VALUE SPACE.  00890005
009000     05  CC-END-DATE.                                             00900005
009100         10  CC-END-MONTH                PIC  9(02).              00910005
009200         10  CC-END-DAY                  PIC  9(02).              00920005
009300         10  CC-END-CENTURY              PIC  9(02).              00930005
009400         10  CC-END-YEAR                 PIC  9(02).              00940005
009500                                                                  00950005
009600                                                                  00960005
009700 01  PH2-PAGE-HEADING-2.                                          00970005
009800     05  FILLER                          PIC  X(55)  VALUE SPACE. 00980005
009900     05  FILLER                          PIC  X(23)  VALUE        00990005
010000         'WEEKLY EXCEPTION REPORT'.                               01000005
010100     05  FILLER                          PIC  X(54)  VALUE SPACE. 01010005
010200                                                                  01020005
010300 01  PH3-PAGE-HEADING-3.                                          01030005
010400     05  FILLER                          PIC  X(53)  VALUE SPACE. 01040005
010500     05  FILLER                          PIC  X(16)  VALUE        01050005
010600         'FOR WEEK ENDING '.                                      01060005
010700     05  PH3-WEEK-END-DATE               PIC  X(10)  VALUE SPACE. 01070005
010800     05  FILLER                          PIC  X(53)  VALUE SPACE. 01080005
010900                                                                  01090005
011000 01  PH4-PAGE-HEADING-4.                                          01100005
011100     05  FILLER                          PIC  X(19)  VALUE        01110005
011200         ' OPERATING UNIT:   '.                                   01120005
011300     05  PH4-OPER-UNT                    PIC  ZZZ9   VALUE ZERO.  01130005
011400     05  FILLER                          PIC  X(03)  VALUE ' - '. 01140005
011500     05  PH4-OPER-UNT-DESC               PIC  X(40)  VALUE SPACE. 01150008
011600     05  FILLER                          PIC  X(65)  VALUE SPACE. 01160008
011700                                                                  01170005
011800 01  PH5-PAGE-HEADING-5.                                          01180005
011900     05  FILLER                          PIC  X(19)  VALUE        01190005
012000         ' PROCESSING AREA:  '.                                   01200005
012100     05  PH5-PROC-AREA                   PIC  X(04)  VALUE SPACE. 01210005
012200     05  FILLER                          PIC  X(109) VALUE SPACE. 01220005
012300                                                                  01230005
012400 01  DH1-DETAIL-HEADING-1.                                        01240005
012500     05  FILLER                          PIC  X(26)  VALUE        01250005
012600         '  ARRIVAL  PO/RECEIVER    '.                            01260005
012700     05  FILLER                          PIC  X(33)  VALUE        01270005
012800         'PBS                              '.                     01280005
012900     05  FILLER                          PIC  X(19)  VALUE        01290005
013000         'PO                 '.                                   01300005
013100     05  FILLER                          PIC  X(25)  VALUE        01310005
013200         '      UPC REQ''G CERTFCTN '.                            01320005
013300     05  FILLER                          PIC  X(27)  VALUE SPACE. 01330005
013400                                                                  01340005
013500 01  DH2-DETAIL-HEADING-2.                                        01350005
013600*  DH2-DETAIL-HEADING-2 IS ADJUSTED TO ADD DEPT & CL  WR # 230ZZ *01360005
013700     05  FILLER                          PIC  X(31)  VALUE        01370005
013800         '   DATE      SEQ NBR      IND  '.                       01380005
013900     05  FILLER                          PIC  X(27)  VALUE        01390005
014000         'VENDOR NAME                '.                           01400005
014100     05  FILLER                          PIC  X(46)  VALUE        01410005
014200         'LINE   DEPT CL SKU        (BUT NOT CERTIFIED) '.        01420005
014300     05  FILLER                          PIC  X(26)  VALUE SPACE. 01430005
014400                                                                  01440005
014500*----------------------------------------------------------------*01450005
014600* NEW PROGRAM VARIABLES ARE ADDED DL-DEPT & DL-CLASS WITH FILLER *01460005
014700* DL-SKU CHANGED TO PIC X(08) FROM PIC(10)                       *01470005
014800* FILLER IS UPDATED FROM X(32) TO PIC(27)          WR # 230ZZ    *01480005
014900*----------------------------------------------------------------*01490005
015000 01  DL-DETAIL-LINE.                                              01500005
015100     05  FILLER                          PIC  X(01)  VALUE SPACE. 01510005
015200     05  DL-ARRIVAL-DATE                 PIC  X(08)  VALUE SPACE. 01520005
015300     05  FILLER                          PIC  X(02)  VALUE SPACE. 01530005
015400     05  DL-PO                           PIC  X(08)  VALUE SPACE. 01540005
015500     05  FILLER                          PIC  X(01)  VALUE '-'.   01550005
015600     05  DL-RECEIVER-SEQ-NBR             PIC  X(04)  VALUE SPACE. 01560005
015700     05  FILLER                          PIC  X(03)  VALUE SPACE. 01570005
015800     05  DL-PBS-IND                      PIC  X(01)  VALUE SPACE. 01580005
015900     05  FILLER                          PIC  X(03)  VALUE SPACE. 01590005
016000     05  DL-VENDOR-NAME                  PIC  X(25)  VALUE SPACE. 01600005
016100     05  FILLER                          PIC  X(03)  VALUE SPACE. 01610005
016200     05  DL-PO-LINE                      PIC  X(03)  VALUE SPACE. 01620005
016300     05  FILLER                          PIC  X(04)  VALUE SPACE. 01630005
016400     05  DL-DEPT                         PIC  X(03)  VALUE SPACE. 01640005
016500     05  FILLER                          PIC  X(01)  VALUE SPACE. 01650005
016600     05  DL-CLASS                        PIC  X(02)  VALUE SPACE. 01660005
016700     05  FILLER                          PIC  X(01)  VALUE SPACE. 01670005
016800     05  DL-SKU                          PIC  X(08)  VALUE SPACE. 01680005
016900     05  FILLER                          PIC  X(03)  VALUE SPACE. 01690005
017000     05  DL-REQ-CERT                     PIC  X(17)  VALUE SPACE. 01700005
017100     05  FILLER                          PIC  X(27)  VALUE SPACE. 01710005
017200*----------------------------------------------------------------*01720005
017300* CHANGES MADE FOR WR # 230ZZ ENDS HERE.                         *01730005
017400*----------------------------------------------------------------*01740005
017500                                                                  01750005
017600 01  TL-TOTAL-LINE                      PIC X(132) VALUE SPACES.  01760005
017700                                                                  01770005
017800 01  TL-TOTAL-LINE1.                                              01780005
017900     05  FILLER                          PIC  X(45)  VALUE        01790005
018000         '  NUMBER OF UPCS REQUIRING CERTIFICATION FOR '.         01800005
018100     05  TL-CONTROL-AREA1               PIC  X(05)  VALUE SPACES. 01810005
018200     05  FILLER                         PIC  X(04)  VALUE         01820005
018300         ':   '.                                                  01830005
018400     05  TL-UPCS-REQ-CERT               PIC  ZZZ,ZZ9.             01840005
018500     05  FILLER                         PIC  X(72) VALUE SPACE.   01850005
018600                                                                  01860005
018700 01  TL-TOTAL-LINE2.                                              01870005
018800     05  FILLER                         PIC  X(45)  VALUE         01880005
018900         '            NUMBER OF UPCS NOT CERTIFIED FOR '.         01890005
019000     05  TL-CONTROL-AREA2               PIC  X(05)  VALUE SPACE.  01900005
019100     05  FILLER                         PIC  X(04)  VALUE         01910005
019200         ':   '.                                                  01920005
019300     05  TL-UPCS                        PIC  ZZZ,ZZ9.             01930005
019400     05  FILLER                         PIC  X(72) VALUE SPACE.   01940005
019500                                                                  01950005
019600 01  TL-TOTAL-LINE3.                                              01960005
019700     05  FILLER                          PIC  X(45)  VALUE        01970005
019800         '           PERCENT OF UPCS NOT CERTIFIED FOR '.         01980005
019900     05  TL-CONTROL-AREA3                PIC  X(05)  VALUE SPACE. 01990005
020000     05  FILLER                          PIC  X(04)  VALUE        02000005
020100         ':   '.                                                  02010005
020200     05  TL-UPCS-PERC-NOT-CERT           PIC  ZZZ,ZZ9.            02020005
020300     05  FILLER                          PIC  X(01) VALUE '%'.    02030005
020400     05  FILLER                          PIC  X(72) VALUE SPACE.  02040005
020500                                                                  02050005
020600                                                                  02060005
020700 01  BLANK-LINE.                                                  02070005
020800     05  FILLER                          PIC  X(132) VALUE SPACE. 02080005
020900                                                                  02090005
021000 01  CD-CC-DISPLAY-LINE.                                          02100005
021100     05  CD-CONTROL-FIELD-DESC           PIC  X(35)  VALUE SPACE. 02110005
021200     05  FILLER                          PIC  X(02)  VALUE ': '.  02120005
021300     05  CD-CONTROL-FIELD-VALUE          PIC  X(50)  VALUE SPACE. 02130005
021400                                                                  02140005
021500 01  CD-CC-DISPLAY-LINE1.                                         02150005
021600     05  FILLER                          PIC  X(50)  VALUE        02160005
021700         '  THE FOLLOWING CONTROL CARD CREATED THIS REPORT: '.    02170005
021800                                                                  02180005
021900 01  END-OF-REPORT-LINE.                                          02190005
022000     05  FILLER                          PIC  X(88)  VALUE SPACE. 02200005
022100     05  FILLER                          PIC  X(25)  VALUE        02210005
022200         '***** END OF REPORT *****'.                             02220005
022300     05  FILLER                          PIC  X(87)  VALUE SPACE. 02230005
022400                                                                  02240005
022500 01  ER-EMPTY-REPORT-LINE.                                        02250005
022600     05  FILLER                          PIC  X(42)  VALUE SPACE. 02260005
022700     05  FILLER                          PIC  X(48)  VALUE        02270005
022800         '*** NO DATA SATISFIES THE DATES SELECTED     ***'.      02280005
022900     05  FILLER                          PIC  X(42)  VALUE SPACE. 02290005
023000                                                                  02300005
023100 01  PA-PROC-ACCUMULATORS.                                        02310005
023200     05  PA-TOT-PROC-10-RECORDS          PIC S9(07)               02320005
023300                                                     VALUE +0     02330005
023400                                                     COMP-3.      02340005
023500     05  PA-TOT-PROC-ALL-RECORDS         PIC S9(07)               02350005
023600                                                     VALUE +0     02360005
023700                                                     COMP-3.      02370005
023800 01  PA-OPER-ACCUMULATORS.                                        02380005
023900     05  PA-TOT-OPER-10-RECORDS          PIC S9(07)               02390005
024000                                                     VALUE +0     02400005
024100                                                     COMP-3.      02410005
024200     05  PA-TOT-OPER-ALL-RECORDS         PIC S9(07)               02420005
024300                                                     VALUE +0     02430005
024400                                                     COMP-3.      02440005
024500 01  PA-COMP-ACCUMULATORS.                                        02450005
024600     05  PA-TOT-COMP-10-RECORDS          PIC S9(07)               02460005
024700                                                     VALUE +0     02470005
024800                                                     COMP-3.      02480005
024900     05  PA-TOT-COMP-ALL-RECORDS         PIC S9(07)               02490005
025000                                                     COMP-3.      02500005
025100 01  PC-PERCENT-FIELDS.                                           02510005
025200     05  PC-PERCENT-UPC-NC               PIC S999V99              02520005
025300                                                     VALUE +0.    02530005
025400                                                                  02540005
025500 01  PC-CONSTANTS.                                                02550005
025600     05  PC-MASCO-OPER-UNT-ID            PIC S9(04)  VALUE +85    02560005
025700                                                     COMP SYNC.   02570005
025800     05  PC-FINDLAY-OPER-UNT-ID          PIC S9(04)  VALUE +810   02580005
025900                                                     COMP SYNC.   02590005
026000     05  PC-MAX-REFERRAL-CODES           PIC S9(04)  VALUE +7     02600005
026100                                                     COMP SYNC.   02610005
026200* 6 LPI -- 14 X 8.5 PAPER (6 * 8.5 = 51)                          02620005
026300     05  PC-MAX-REPORT-LINES             PIC S9(04)  VALUE +50    02630005
026400                                                     COMP SYNC.   02640005
026500     05  PC-ROW-NOT-FOUND                PIC S9(04)  VALUE  100   02650005
026600                                                     COMP SYNC.   02660005
026700     05  PC-ZERO                         PIC  9(01)  VALUE 0.     02670005
026800     05  PC-ONE                          PIC  9(01)  VALUE 1.     02680005
026900     05  PC-TWO                          PIC  9(01)  VALUE 2.     02690005
027000     05  PC-THREE                        PIC  9(01)  VALUE 3.     02700005
027100     05  PC-FOUR                         PIC  9(01)  VALUE 4.     02710005
027200     05  PC-FIVE                         PIC  9(01)  VALUE 5.     02720005
027300     05  PC-SIX                          PIC  9(01)  VALUE 6.     02730005
027400     05  PC-SEVEN                        PIC  9(01)  VALUE 7.     02740005
027500     05  PC-EIGHT                        PIC  9(01)  VALUE 8.     02750005
027600     05  PC-NINE                         PIC  9(01)  VALUE 9.     02760005
027700     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        02770005
027800         'MPKRP029'.                                              02780005
027900     05  PC-DPKUT500                     PIC  X(10)  VALUE        02790005
028000         'DPKUT500  '.                                            02800005
028100     05 PC-MBS-SYSTEM-CODE-RV            PIC  X(02)  VALUE 'MP'.  02810005
028200     05 PC-MBS-OP-CO-03                  PIC  X(02)  VALUE '03'.  02820005
028300     05 PC-PGM-DPKUT039                  PIC  X(08)               02830005
028400                                         VALUE 'DPKUT039'.        02840005
028500     05 PC-ORD-ID-CDE-D                  PIC  X(01)  VALUE 'D'.   02850005
028600     05 PC-ORD-ID-CDE-M                  PIC  X(01)  VALUE 'M'.   02860005
028700     05 PC-TYPE                          PIC X(02)   VALUE 'DC'.  02870005
028800     05 PC-MAX-RETRIES                   PIC 9(03)   VALUE 3.     02880005
028900                                                                  02890005
029000 01  DA-DISPLAY-AREAS.                                            02900005
029100     05  DA-SORT-RECORD-COUNT            PIC  ZZZ,ZZZ,ZZ9         02910005
029200                                                     VALUE ZERO.  02920005
029300                                                                  02930005
029400 01  PS-PROGRAM-SWITCHES.                                         02940005
029500     05  PS-NEW-LINE-IND                 PIC  X(01)  VALUE 'N'.   02950005
029600         88  PS-NEW-LINE                             VALUE 'Y'.   02960005
029700         88  PS-NO-NEW-LINE                          VALUE 'N'.   02970005
029800                                                                  02980005
029900     05  PS-VALID-DATE-SW                PIC  X(01)  VALUE 'N'.   02990005
030000         88  PS-VALID-DATE                           VALUE 'Y'.   03000005
030100         88  PS-INVALID-DATE                         VALUE 'N'.   03010005
030200                                                                  03020005
030300     05  PS-DC-OCCURS-FOUND-SW           PIC X(01)   VALUE 'Y'.   03030005
030400         88  PS-DC-OCCURS-FOUND                      VALUE 'Y'.   03040005
030500         88  PS-DC-OCCURS-NOT-FOUND                  VALUE 'N'.   03050005
030600                                                                  03060005
030700     05  PS-STORE-ROWS-IND               PIC  X(01)  VALUE 'N'.   03070005
030800         88  PS-NO-MORE-STORE-ROWS                   VALUE 'Y'.   03080005
030900         88  PS-MORE-STORE-ROWS                      VALUE 'N'.   03090005
031000                                                                  03100005
031100     05  PS-END-OF-EXTRACT-FILE-SW       PIC  X(01)  VALUE 'N'.   03110005
031200         88  PS-END-OF-EXTRACT-FILE                  VALUE 'Y'.   03120005
031300         88  PS-NOT-END-OF-EXTRACT-FILE              VALUE 'N'.   03130005
031400                                                                  03140005
031500     05  PS-NO-DATA-IND                  PIC  X(01)  VALUE 'N'.   03150005
031600         88  PS-NO-DATA                              VALUE 'Y'.   03160005
031700                                                                  03170005
031800 01  PV-DC-NAMES.                                                 03180005
031900     05  DC-INDEX-LIMIT          PIC S9(04) VALUE 50              03190009
032000                                             COMP SYNC.           03200005
032100     05  DC-INDEX-MAX            PIC S9(04) VALUE ZEROS           03210005
032200                                             COMP SYNC.           03220005
032300     05  PV-DC-TABLE OCCURS 50 TIMES INDEXED BY DC-INDEX.         03230009
032400         10 PV-DC                  PIC 9(04).                     03240005
032500         10 PV-DC-DESCRIPTIONS     PIC X(40).                     03250008
032600                                                                  03260005
032700     05  PV-OPER-CONTROL-AREA.                                    03270005
032800         10  PV-OPER-CONTROL               PIC  9(04) VALUE ZERO. 03280005
032900                                                                  03290005
033000     05  PV-OPER-CONTROL-AREA-DISP.                               03300005
033100         10  FILLER                       PIC  X(01) VALUE SPACE. 03310005
033200         10  PV-OPER-CONTROL-DISP         PIC  ZZZ9.              03320005
033300                                                                  03330005
033400     05  PV-SQL-SUB                        PIC 9(03)  VALUE ZERO. 03340005
033500                                                                  03350005
033600     05  PV-PROC-CONTROL-AREA.                                    03360005
033700         10  FILLER                          PIC  X VALUE SPACE.  03370005
033800         10  PV-PROC-CONTROL-AREA-4          PIC  X(4).           03380005
033900                                                                  03390005
034000     05  PV-COMP-CONTROL-AREA.                                    03400005
034100         10  FILLER                          PIC  X(5) VALUE      03410005
034200             'KOHLS'.                                             03420005
034300                                                                  03430005
034400     05  PV-PAGE-COUNT                   PIC S9(04)  VALUE +0     03440005
034500                                                     COMP SYNC.   03450005
034600     05  PV-LINE-COUNT                   PIC S9(04)  VALUE +0     03460005
034700                                                     COMP SYNC.   03470005
034800     05  PV-DATE-HIGH.                                            03480005
034900         10 PV-HIGH-CENTURY              PIC  9(02)  VALUE ZEROES.03490005
035000         10 PV-HIGH-YEAR                 PIC  9(02)  VALUE ZEROES.03500005
035100         10 PV-HIGH-MONTH                PIC  9(02)  VALUE ZEROES.03510005
035200         10 PV-HIGH-DAY                  PIC  9(02)  VALUE ZEROES.03520005
035300     05  PV-DATE-LOW.                                             03530005
035400         10 PV-LOW-CENTURY               PIC  9(02)  VALUE ZEROES.03540005
035500         10 PV-LOW-YEAR                  PIC  9(02)  VALUE ZEROES.03550005
035600         10 PV-LOW-MONTH                 PIC  9(02)  VALUE ZEROES.03560005
035700         10 PV-LOW-DAY                   PIC  9(02)  VALUE ZEROES.03570005
035800                                                                  03580005
035900     05  PV-HOLD-OPER-UNT-ID             PIC  S9(04) COMP-3.      03590005
036000     05  PV-HOLD-PRC-AREA-CDE            PIC  X9(04).             03600005
036100     05  PV-HOLD-VNDUN-NMBR              PIC  X(09).              03610005
036200     05  PV-HOLD-VENDOR-NAME             PIC  X(25).              03620005
036300     05  PV-HOLD-CR8-DATE.                                        03630005
036400         10  PV-HOLD-CR8-CENTURY         PIC  9(02).              03640005
036500         10  PV-HOLD-CR8-YEAR            PIC  9(02).              03650005
036600         10  FILLER                      PIC  X(01) VALUE '-'.    03660005
036700         10  PV-HOLD-CR8-MONTH           PIC  9(02).              03670005
036800         10  FILLER                      PIC  X(01) VALUE '-'.    03680005
036900         10  PV-HOLD-CR8-DAY             PIC  9(02).              03690005
037000     05  PV-HOLD-STAT-DATE.                                       03700005
037100         10  PV-HOLD-STAT-CENTURY        PIC  9(02).              03710005
037200         10  PV-HOLD-STAT-YEAR           PIC  9(02).              03720005
037300         10  FILLER                      PIC  X(01) VALUE '-'.    03730005
037400         10  PV-HOLD-STAT-MONTH          PIC  9(02).              03740005
037500         10  FILLER                      PIC  X(01) VALUE '-'.    03750005
037600         10  PV-HOLD-STAT-DAY            PIC  9(02).              03760005
037700     05  PV-CURRENT-DATE                 PIC  X(10).              03770005
037800     05  PV-CURR-DATE.                                            03780005
037900         10  PV-CURR-CENTURY             PIC  9(02).              03790005
038000         10  PV-CURR-YEAR                PIC  9(02).              03800005
038100         10  FILLER                      PIC  X(01) VALUE '-'.    03810005
038200         10  PV-CURR-MONTH               PIC  9(02).              03820005
038300         10  FILLER                      PIC  X(01) VALUE '-'.    03830005
038400         10  PV-CURR-DAY                 PIC  9(02).              03840005
038500                                                                  03850005
038600     05  PV-PREVIOUS-DATE                PIC  X(10).              03860005
038700     05  PV-HOLD-LNE-NBR.                                         03870005
038800         10  PV-HOLD-LNE-NBR-1           PIC  9(06) VALUE ZEROES. 03880005
038900         10  PV-HOLD-LNE-NBR-2           PIC  9(03) VALUE ZEROES. 03890005
039000     05  PV-HOLD-REC-SEQ-NBR.                                     03900005
039100         10  PV-HOLD-REC-SEQ-NBR-1       PIC  9(06) VALUE ZEROES. 03910005
039200         10  PV-HOLD-REC-SEQ-NBR-2       PIC  9(03) VALUE ZEROES. 03920005
039300     05  PV-HOLD-PO-NBR.                                          03930005
039400         10  PV-HOLD-PO-NBR-1            PIC  9(01) VALUE ZEROES. 03940005
039500         10  PV-HOLD-PO-NBR-2            PIC  9(08) VALUE ZEROES. 03950005
039600     05  PV-HOLD-SKU-NMBR.                                        03960005
039700         10  PV-HOLD-DEPT-NMBR           PIC  X(03).              03970005
039800         10  PV-HOLD-CLASS-NMBR          PIC  X(02).              03980005
039900         10  PV-HOLD-SEQ-NMBR            PIC  X(03).              03990005
040000     05  PV-HOLD-SKU-DESC                PIC  X(25).              04000005
040100     05  PV-HOLD-UPC-NMBR.                                        04010005
040200         10  PV-HOLD-UPC-0               PIC  9(01) VALUE 0.      04020005
040300         10  PV-HOLD-UPC-1               PIC  9(02) VALUE 0.      04030005
040400         10  PV-HOLD-UPC-2               PIC  9(05) VALUE 0.      04040005
040500         10  PV-HOLD-UPC-3               PIC  9(05) VALUE 0.      04050005
040600         10  PV-HOLD-UPC-4               PIC  9(02) VALUE 0.      04060005
040700     05  PV-WORK-UPC-NMBR.                                        04070005
040800         10  PV-WORK-UPC-1               PIC  X(02).              04080005
040900         10  FILLER                      PIC  X(01) VALUE '-'.    04090005
041000         10  PV-WORK-UPC-2               PIC  X(05).              04100005
041100         10  FILLER                      PIC  X(01) VALUE '-'.    04110005
041200         10  PV-WORK-UPC-3               PIC  X(05).              04120005
041300         10  FILLER                      PIC  X(01) VALUE '-'.    04130005
041400         10  PV-WORK-UPC-4               PIC  X(02).              04140005
041500                                                                  04150005
041600     05  PV-HOLD-FILE-DATE.                                       04160005
041700         10  PV-HOLD-FILE-CENTURY        PIC  9(02).              04170005
041800         10  PV-HOLD-FILE-YEAR           PIC  9(02).              04180005
041900         10  PV-HOLD-FILE-MONTH          PIC  9(02).              04190005
042000         10  PV-HOLD-FILE-DAY            PIC  9(02).              04200005
042100                                                                  04210005
042200     05  PV-HOLD-WORK-DATE.                                       04220005
042300         10  PV-HOLD-WORK-MONTH          PIC  9(02).              04230005
042400         10  FILLER                      PIC  X(01) VALUE '/'.    04240005
042500         10  PV-HOLD-WORK-DAY            PIC  9(02).              04250005
042600         10  FILLER                      PIC  X(01) VALUE '/'.    04260005
042700         10  PV-HOLD-WORK-YEAR           PIC  9(02).              04270005
042800                                                                  04280005
042900     05  PV-PARAGRAPH-NAME               PIC  X(30)  VALUE SPACE. 04290005
043000     05  PV-DB2-OPER-ATTEMPTED           PIC  X(30)  VALUE SPACE. 04300005
043100     05  PV-START-DATE.                                           04310005
043200         10  PV-START-MONTH              PIC  9(02).              04320005
043300         10  FILLER                      PIC  X(01) VALUE '/'.    04330005
043400         10  PV-START-DAY                PIC  9(02).              04340005
043500         10  FILLER                      PIC  X(01) VALUE '/'.    04350005
043600         10  PV-START-CENTURY            PIC  9(02).              04360005
043700         10  PV-START-YEAR               PIC  9(02).              04370005
043800     05  PV-WEEK-END-DATE.                                        04380005
043900         10  PV-END-MONTH                PIC  9(02).              04390005
044000         10  FILLER                      PIC  X(01) VALUE '/'.    04400005
044100         10  PV-END-DAY                  PIC  9(02).              04410005
044200         10  FILLER                      PIC  X(01) VALUE '/'.    04420005
044300         10  PV-END-CENTURY              PIC  9(02).              04430005
044400         10  PV-END-YEAR                 PIC  9(02).              04440005
044500     05  PV-WORK-DATE.                                            04450005
044600         10  PV-WORK-MONTH               PIC  9(02).              04460005
044700         10  FILLER                      PIC  X(01) VALUE '/'.    04470005
044800         10  PV-WORK-DAY                 PIC  9(02).              04480005
044900         10  FILLER                      PIC  X(01) VALUE '/'.    04490005
045000         10  PV-WORK-YEAR                PIC  9(02).              04500005
045100                                                                  04510005
045200 01  SD-SYSTEM-DATE.                                              04520005
045300     05  SD-SYSTEM-YEAR                  PIC  9(02)  VALUE ZEROS. 04530005
045400     05  SD-SYSTEM-MONTH                 PIC  9(02)  VALUE ZEROS. 04540005
045500     05  SD-SYSTEM-DAY                   PIC  9(02)  VALUE ZEROS. 04550005
045600                                                                  04560005
045700 01  ST-SYSTEM-TIME.                                              04570005
045800     05  ST-SYSTEM-HOUR                  PIC  9(02)  VALUE ZEROS. 04580005
045900     05  ST-SYSTEM-MINUTE                PIC  9(02)  VALUE ZEROS. 04590005
046000                                                                  04600005
046100*                                                                 04610005
046200******************************************************************04620005
046300*  WORK FIELDS FOR THE MBS SUBROUTINE                             04630005
046400******************************************************************04640005
046500     COPY DPWS003.                                                04650005
046600*                                                                 04660005
046700******************************************************************04670005
046800***  WORK FIELDS FOR THE CERTIFICATION EXTRACT FILE.              04680005
046900******************************************************************04690005
047000     COPY MPRD051.                                                04700005
047100*                                                                 04710005
047200******************************************************************04720005
047300*  DB2 COMMUNICATION AREA.                                        04730005
047400******************************************************************04740005
047500     EXEC SQL                                                     04750005
047600          INCLUDE SQLCA                                           04760005
047700     END-EXEC.                                                    04770005
047800*                                                                 04780005
047900******************************************************************04790005
048000*  DB2 TABLE XLT_LOC                                              04800008
048100******************************************************************04810005
048200     EXEC SQL                                                     04820005
048300          INCLUDE XLT00010                                        04830008
048400     END-EXEC.                                                    04840005
048500 EJECT                                                            04850005
048600*                                                                 04860005
048700*                                                                 04870005
048800*   DB2 COMMUNICATIONS AREA2                                      04880005
048900*                                                                 04890005
049000     COPY SQLCA2.                                                 04900005
049100                                                                  04910005
049200 EJECT                                                            04920005
049300***************************************************************** 04930005
049400*   SELECT ALL OF THE DCS IN ORDER TO GET THE DC DESCRIPTION      04940005
049500*                                                                 04950005
049600***************************************************************** 04960005
049700                                                                  04970005
049800     EXEC SQL                                                     04980005
049900        DECLARE STORE_CURSOR CURSOR FOR                           04990005
050000           SELECT LOC_NBR                                         05000008
050100             ,    LOC_NM                                          05010008
050200           FROM XLT_LOC                                           05020008
050300           WHERE LOC_TYP_CDE = 'DC'                               05030008
050400     END-EXEC.                                                    05040005
050500                                                                  05050005
050600                                                                  05060005
050700* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 05070005
050800 PROCEDURE DIVISION.                                              05080005
050900* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 05090005
051000                                                                  05100005
051100******************************************************************05110005
051200*  0000-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE PROGRAM    05120005
051300******************************************************************05130005
051400 0000-PROGRAM-MAINLINE.                                           05140005
051500                                                                  05150005
051600     PERFORM 1000-HOUSEKEEPING.                                   05160005
051700                                                                  05170005
051800     PERFORM 2000-MAIN-PROCESSING UNTIL                           05180005
051900                    PS-END-OF-EXTRACT-FILE.                       05190005
052000                                                                  05200005
052100     PERFORM 9000-EOJ-ROUTINE.                                    05210005
052200     STOP RUN.                                                    05220005
052300*0000-EXIT.                                                       05230005
052400                                                                  05240005
052500******************************************************************05250005
052600*  1000-HOUSEKEEPING -OPENS ALL THE REPORT FILE, ACCEPTS, EDITS,  05260005
052700*  AND DISPLAYS CONTROL CARD INFORMATION, OPENS AND FETCHES FIRST 05270005
052800*  OCCURANCE OF DB2 CURSOR, PRINTS INITIAL PAGE HEADING TO REPORT 05280005
052900*  FILE.                                                          05290005
053000******************************************************************05300005
053100 1000-HOUSEKEEPING.                                               05310005
053200     PERFORM 1050-GET-DATES.                                      05320005
053300     PERFORM 1060-FILL-DATES.                                     05330005
053400     PERFORM 1200-OPEN-FILES.                                     05340005
053500     PERFORM 1250-INITIAL-READ.                                   05350005
053600     IF PS-NO-DATA                                                05360005
053700         PERFORM 8300-WRITE-PAGE-HEADING                          05370005
053800     ELSE                                                         05380005
053900         PERFORM 1300-LOAD-DC-NAMES                               05390005
054000         PERFORM 1350-GET-FIRST-DC                                05400005
054100         PERFORM 1500-INITIAL-HEADINGS                            05410005
054200     END-IF.                                                      05420005
054300                                                                  05430005
054400******************************************************************05440005
054500*  1050-GET-DATES - GETS CURRENT-DATE AND CURRENT DATE +1 YEAR    05450005
054600*  FROM DB2.                                                      05460005
054700******************************************************************05470005
054800 1050-GET-DATES.                                                  05480005
054900                                                                  05490005
055000     EXEC SQL                                                     05500005
055100         SELECT                                                   05510005
055200                 CURRENT DATE                                     05520005
055300*              , CURRENT DATE - 1 YEAR                            05530006
055400           INTO                                                   05540005
055500                 :PV-CURRENT-DATE                                 05550005
055600*              , :PV-PREVIOUS-DATE                                05560006
055700           FROM  TDFORCR                                          05570005
055800     END-EXEC.                                                    05580005
055900                                                                  05590005
056000     EVALUATE TRUE                                                05600005
056100         WHEN SQLWARN0 NOT = SPACES                               05610005
056200         WHEN SQLCODE < ZERO                                      05620005
056300         WHEN SQLCODE > ZERO                                      05630005
056400              MOVE '1050-GET-DATES'                               05640005
056500                               TO  PV-PARAGRAPH-NAME              05650005
056600              MOVE 'SELECT DATES FROM DEFECT ITEM NUMBER TABLES'  05660005
056700                               TO  PV-DB2-OPER-ATTEMPTED          05670005
056800              PERFORM 9100-SQL-ABEND                              05680005
056900         WHEN SQLCODE = ZERO                                      05690005
057000             MOVE PV-CURRENT-DATE    TO PV-CURR-DATE              05700005
057100             MOVE PV-CURR-YEAR       TO SD-SYSTEM-YEAR            05710005
057200             MOVE PV-CURR-MONTH      TO SD-SYSTEM-MONTH           05720005
057300             MOVE PV-CURR-DAY        TO SD-SYSTEM-DAY             05730005
057400     END-EVALUATE.                                                05740005
057500                                                                  05750005
057600                                                                  05760005
057700                                                                  05770005
057800*1050-EXIT.                                                       05780005
057900                                                                  05790005
058000******************************************************************05800005
058100*1060-GET-DATES.                                                  05810005
058200******************************************************************05820005
058300 1060-FILL-DATES.                                                 05830005
058400                                                                  05840005
058500     ACCEPT CC-CONTROL-CARD FROM SYSIN.                           05850005
058600     DISPLAY 'CONTROL CARD = ' CC-CONTROL-CARD.                   05860005
058700                                                                  05870005
058800     PERFORM 1100-VALIDATE-CONTROL-CARD.                          05880005
058900                                                                  05890005
059000                                                                  05900005
059100     MOVE CC-END-MONTH           TO PV-END-MONTH                  05910005
059200                                    PV-HIGH-MONTH.                05920005
059300     MOVE CC-END-DAY             TO PV-END-DAY                    05930005
059400                                    PV-HIGH-DAY.                  05940005
059500     MOVE CC-END-CENTURY         TO PV-END-CENTURY                05950005
059600                                    PV-HIGH-CENTURY.              05960005
059700     MOVE CC-END-YEAR            TO PV-END-YEAR                   05970005
059800                                    PV-HIGH-YEAR.                 05980005
059900                                                                  05990005
060000     MOVE CC-START-MONTH         TO PV-START-MONTH                06000005
060100                                    PV-LOW-MONTH.                 06010005
060200     MOVE CC-START-DAY           TO PV-START-DAY                  06020005
060300                                    PV-LOW-DAY.                   06030005
060400     MOVE CC-START-CENTURY       TO PV-START-CENTURY              06040005
060500                                    PV-LOW-CENTURY.               06050005
060600     MOVE CC-START-YEAR          TO PV-START-YEAR                 06060005
060700                                    PV-LOW-YEAR.                  06070005
060800                                                                  06080005
060900     MOVE PV-WEEK-END-DATE       TO PH3-WEEK-END-DATE.            06090005
061000     DISPLAY 'DATES: ' PV-DATE-LOW ' ' PV-DATE-HIGH.              06100005
061100                                                                  06110005
061200     MOVE SD-SYSTEM-YEAR   TO DP132O-RUN-YEAR.                    06120005
061300     MOVE SD-SYSTEM-MONTH  TO DP132O-RUN-MONTH.                   06130005
061400     MOVE SD-SYSTEM-DAY    TO DP132O-RUN-DAY.                     06140005
061500                                                                  06150005
061600     ACCEPT ST-SYSTEM-TIME FROM TIME.                             06160005
061700     MOVE ST-SYSTEM-HOUR   TO DP132O-RUN-HOUR.                    06170005
061800     MOVE ST-SYSTEM-MINUTE TO DP132O-RUN-MINUTE.                  06180005
061900                                                                  06190005
062000******************************************************************06200005
062100* 1100-VALIDATE-CONTROL-CARD - VERIFIES THAT THE DATE RANGE SUP-  06210005
062200* PLIED IS NUMERIC AND WITHIN VALID VALUES.                       06220005
062300******************************************************************06230005
062400 1100-VALIDATE-CONTROL-CARD.                                      06240005
062500                                                                  06250005
062600     PERFORM 1200-VALIDATE-DATES.                                 06260005
062700                                                                  06270005
062800******************************************************************06280005
062900* 1200-VALIDATE-DATES - USES CALLED MODULE DPKUT500 TO VALIDATE   06290005
063000*     THE BEGIN AND END DATES.                                    06300005
063100******************************************************************06310005
063200 1200-VALIDATE-DATES.                                             06320005
063300                                                                  06330005
063400     MOVE SD-SYSTEM-DATE            TO DPG51-SYSTEM-DATE.         06340005
063500     SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                      06350005
063600                                                                  06360005
063700     MOVE CC-START-DATE             TO DPG52-LK-DATE-INPUT.       06370005
063800     SET DPG52-LK-DTE-GREG-CC       TO TRUE.                      06380005
063900                                                                  06390005
064000     MOVE CC-END-DATE               TO DPG53-LK-CMPR-DATE-INPUT.  06400005
064100     SET DPG53-LK-CMPR-DTE-GREG-CC  TO TRUE.                      06410005
064200                                                                  06420005
064300     CALL PC-DPKUT500 USING DPG51 DPG52 DPG53                     06430005
064400                            DPG54 DPG55 DPG56.                    06440005
064500                                                                  06450005
064600     EVALUATE TRUE                                                06460005
064700         WHEN DPG54-DATE-INVALID                                  06470005
064800             DISPLAY '** ABEND **'                                06480005
064900             DISPLAY '** PROGRAM = MPKRP029 -- CALLED MODULE '    06490005
065000                     'DPKUT500 **'                                06500005
065100             DISPLAY '** PARAGRAPH = 1200-VALIDATE-DATES. **'     06510005
065200             DISPLAY '** INVALID START DATE: ' CC-START-DATE      06520005
065300             DISPLAY '** ERROR MESSAGE FROM CALLED MODULE:   '    06530005
065400             DISPLAY DPG54-ERROR-MESSAGE                          06540005
065500             MOVE +4003 TO ABEND-CODE                             06550005
065600             CALL 'ILBOABN0' USING ABEND-CODE                     06560005
065700                                                                  06570005
065800         WHEN DPG54-CMPR-DATE-INVALID                             06580005
065900             DISPLAY '** ABEND **'                                06590005
066000             DISPLAY '** PROGRAM = MPKRP029 -- CALLED MODULE '    06600005
066100                     'DPKUT500 **'                                06610005
066200             DISPLAY '** PARAGRAPH = 1200-VALIDATE-DATES. **'     06620005
066300             DISPLAY '** INVALID END DATE: ' CC-END-DATE          06630005
066400             DISPLAY '** ERROR MESSAGE FROM CALLED MODULE:   '    06640005
066500             DISPLAY DPG54-ERROR-MESSAGE                          06650005
066600             MOVE +4003 TO ABEND-CODE                             06660005
066700             CALL 'ILBOABN0' USING ABEND-CODE                     06670005
066800                                                                  06680005
066900         WHEN DPG55-DAYS-DIFFERENCE > ZERO                        06690005
067000             DISPLAY '** ABEND **'                                06700005
067100             DISPLAY '** PROGRAM = MPKRP029 -- CALLED MODULE '    06710005
067200                     'DPKUT500 **'                                06720005
067300             DISPLAY '** PARAGRAPH = 1200-VALIDATE-DATES. **'     06730005
067400             DISPLAY '** END DATE IS NOT AFTER START DATE **'     06740005
067500             DISPLAY '** ERROR MESSAGE FROM CALLED MODULE:   '    06750005
067600             DISPLAY DPG54-ERROR-MESSAGE                          06760005
067700             MOVE +4003 TO ABEND-CODE                             06770005
067800             CALL 'ILBOABN0' USING ABEND-CODE                     06780005
067900                                                                  06790005
068000         WHEN OTHER                                               06800005
068100             DISPLAY DPG54-ERROR-MESSAGE                          06810005
068200                                                                  06820005
068300     END-EVALUATE.                                                06830005
068400                                                                  06840005
068500******************************************************************06850005
068600*1200-OPEN-FILES.                                                 06860005
068700******************************************************************06870005
068800 1200-OPEN-FILES.                                                 06880005
068900     OPEN INPUT  MP-EXTRACT-FILE.                                 06890005
069000     OPEN OUTPUT MP-REPORT-FILE.                                  06900005
069100                                                                  06910005
069200     MOVE 'MPKRP029'       TO DP132O-PROGRAM-NAME.                06920005
069300     MOVE 1                TO DP132O-REPORT-NUMBER.               06930005
069400                                                                  06940005
069500******************************************************************06950005
069600*1250-INITIAL-READ.                                               06960005
069700******************************************************************06970005
069800 1250-INITIAL-READ.                                               06980005
069900     SET PS-INVALID-DATE TO TRUE.                                 06990005
070000                                                                  07000005
070100     PERFORM 6000-READ-EXTRACT-FILE UNTIL                         07010005
070200        PS-VALID-DATE OR PS-END-OF-EXTRACT-FILE.                  07020005
070300                                                                  07030005
070400     IF PS-END-OF-EXTRACT-FILE                                    07040005
070500         SET PS-NO-DATA TO TRUE                                   07050005
070600     ELSE                                                         07060005
070700         MOVE MP051O-OPER-UNT-ID                                  07070005
070800                                   TO  PV-OPER-CONTROL-AREA       07080005
070900                                       PV-HOLD-OPER-UNT-ID        07090005
071000         MOVE MP051O-MDSE-PRC-AREA-CDE TO                         07100005
071100                                      PV-PROC-CONTROL-AREA-4      07110005
071200                                      PV-HOLD-PRC-AREA-CDE        07120005
071300     END-IF.                                                      07130005
071400******************************************************************07140005
071500*    LOAD THE DC-TABLE WITH THE DC NUMBERS.                       07150005
071600******************************************************************07160005
071700 1300-LOAD-DC-NAMES.                                              07170005
071800                                                                  07180005
071900     SET PS-DC-OCCURS-NOT-FOUND TO TRUE.                          07190005
072000     SET DC-INDEX TO 1.                                           07200005
072100     PERFORM  7000-OPEN-STORE-CURSOR.                             07210005
072200                                                                  07220005
072300     PERFORM UNTIL PS-NO-MORE-STORE-ROWS                          07230005
072400         PERFORM  7100-FETCH-STORE-CURSOR                         07240005
072500            MOVE XLT00010-LOC-NBR                                 07250008
072600                                    TO PV-DC (DC-INDEX)           07260005
072700            MOVE XLT00010-LOC-NM                                  07270008
072800                            TO PV-DC-DESCRIPTIONS (DC-INDEX)      07280005
072900            SET DC-INDEX UP BY 1                                  07290005
073000            ADD +1 TO DC-INDEX-MAX                                07300005
073100            IF DC-INDEX-MAX > DC-INDEX-LIMIT                      07310005
073200                DISPLAY '** ABEND ** IN MPKRP029'                 07320005
073300                DISPLAY 'PV-DC-TABLE INDEX EXCEEDS TABLE LIMT'    07330005
073400                MOVE +4004 TO ABEND-CODE                          07340005
073500                CALL 'ILBOABN0' USING ABEND-CODE                  07350005
073600            END-IF                                                07360005
073700     END-PERFORM.                                                 07370005
073800                                                                  07380005
073900     PERFORM  7200-CLOSE-STORE-CURSOR.                            07390005
074000******************************************************************07400005
074100*1350-GET-FIRST-DC.                                               07410005
074200******************************************************************07420005
074300 1350-GET-FIRST-DC.                                               07430005
074400                                                                  07440005
074500     SET DC-INDEX TO 1.                                           07450005
074600     SET PS-DC-OCCURS-NOT-FOUND TO TRUE.                          07460005
074700     PERFORM 1400-GET-DC-NAMES                                    07470005
074800        UNTIL PS-DC-OCCURS-FOUND                                  07480005
074900        OR DC-INDEX GREATER THAN                                  07490005
075000        DC-INDEX-LIMIT.                                           07500005
075100                                                                  07510005
075200******************************************************************07520005
075300*1400-GET-DC-NAMES.                                               07530005
075400******************************************************************07540005
075500 1400-GET-DC-NAMES.                                               07550005
075600      IF PV-OPER-CONTROL-AREA = PV-DC (DC-INDEX)                  07560005
075700          MOVE PV-DC-DESCRIPTIONS (DC-INDEX) TO                   07570005
075800                                          PH4-OPER-UNT-DESC       07580005
075900          SET PS-DC-OCCURS-FOUND TO TRUE                          07590005
076000      ELSE                                                        07600005
076100          SET DC-INDEX UP BY 1                                    07610005
076200          IF DC-INDEX GREATER THAN DC-INDEX-LIMIT                 07620005
076300              DISPLAY '** ABEND ** IN MPKRP029'                   07630005
076400              DISPLAY '*** DC NOT FOUND ON STORE TABLE '          07640005
076500              DISPLAY  PV-OPER-CONTROL                            07650005
076600              MOVE +4005 TO ABEND-CODE                            07660005
076700              CALL 'ILBOABN0' USING ABEND-CODE                    07670005
076800          END-IF                                                  07680005
076900      END-IF.                                                     07690005
077000                                                                  07700005
077100******************************************************************07710005
077200*1500-INITIAL-HEADINGS.                                           07720005
077300******************************************************************07730005
077400 1500-INITIAL-HEADINGS.                                           07740005
077500     PERFORM 8300-WRITE-PAGE-HEADING.                             07750005
077600     PERFORM 8350-WRITE-PROC-AREA-HEADING.                        07760005
077700     PERFORM 8400-WRITE-COLUMN-HEADING.                           07770005
077800                                                                  07780005
077900     INITIALIZE DL-DETAIL-LINE                                    07790005
078000                PA-PROC-ACCUMULATORS                              07800005
078100                PA-OPER-ACCUMULATORS                              07810005
078200                PA-COMP-ACCUMULATORS.                             07820005
078300******************************************************************07830005
078400* 2000-MAIN-PROCESSING                                            07840005
078500* PROCESS:  THIS WILL PERFORM THE MAIN PROCESSING OF THE PROGRAM  07850005
078600******************************************************************07860005
078700 2000-MAIN-PROCESSING.                                            07870005
078800                                                                  07880005
078900     IF MP051O-OPER-UNT-ID =  PV-HOLD-OPER-UNT-ID                 07890005
079000         IF MP051O-MDSE-PRC-AREA-CDE = PV-HOLD-PRC-AREA-CDE       07900005
079100             PERFORM 3000-ACCUM-PROC-AREA-TOTALS                  07910005
079200         ELSE                                                     07920005
079300             PERFORM 3100-ACCUM-OPER-ID-TOTALS                    07930005
079400             PERFORM 4100-SETUP-PRC-TOTAL-LINE                    07940005
079500             INITIALIZE PA-PROC-ACCUMULATORS                      07950005
079600             PERFORM 8350-WRITE-PROC-AREA-HEADING                 07960005
079700             PERFORM 8400-WRITE-COLUMN-HEADING                    07970005
079800             PERFORM 3000-ACCUM-PROC-AREA-TOTALS                  07980005
079900     ELSE                                                         07990005
080000         PERFORM 3100-ACCUM-OPER-ID-TOTALS                        08000005
080100         PERFORM 3200-ACCUM-COMP-TOTALS                           08010005
080200         PERFORM 4100-SETUP-PRC-TOTAL-LINE                        08020005
080300         PERFORM 8200-WRITE-BLANK-LINE                            08030005
080400         PERFORM 4200-SETUP-OPER-TOTAL-LINE                       08040005
080500         INITIALIZE PA-PROC-ACCUMULATORS                          08050005
080600         INITIALIZE PA-OPER-ACCUMULATORS                          08060005
080700         PERFORM 8300-WRITE-PAGE-HEADING                          08070005
080800         PERFORM 8350-WRITE-PROC-AREA-HEADING                     08080005
080900         PERFORM 8400-WRITE-COLUMN-HEADING                        08090005
081000         PERFORM 3000-ACCUM-PROC-AREA-TOTALS                      08100005
081100     END-IF.                                                      08110005
081200                                                                  08120005
081300     SET PS-INVALID-DATE TO TRUE.                                 08130005
081400                                                                  08140005
081500     PERFORM 6000-READ-EXTRACT-FILE UNTIL                         08150005
081600        PS-VALID-DATE OR PS-END-OF-EXTRACT-FILE.                  08160005
081700                                                                  08170005
081800******************************************************************08180005
081900* 3000-ACCUMULATE-TOTALS FOR A PROCESSING AREA AND PRINT A LINE   08190005
082000*      FOR ALL ACT-CDE'S = '10'.                                  08200005
082100******************************************************************08210005
082200 3000-ACCUM-PROC-AREA-TOTALS.                                     08220005
082300      IF MP051O-ACT-CDE = '10'                                    08230005
082400          ADD +1 TO  PA-TOT-PROC-10-RECORDS                       08240005
082500          ADD +1 TO  PA-TOT-PROC-ALL-RECORDS                      08250005
082600          PERFORM 4000-SET-UP-DETAIL-LINE                         08260005
082700      ELSE                                                        08270005
082800          ADD +1 TO  PA-TOT-PROC-ALL-RECORDS                      08280005
082900      END-IF.                                                     08290005
083000                                                                  08300005
083100******************************************************************08310005
083200* 3100-ACCUMULATE-TOTALS FOR THE OPERATING ID                     08320005
083300******************************************************************08330005
083400 3100-ACCUM-OPER-ID-TOTALS.                                       08340005
083500      ADD PA-TOT-PROC-10-RECORDS TO                               08350005
083600                                    PA-TOT-OPER-10-RECORDS.       08360005
083700      ADD PA-TOT-PROC-ALL-RECORDS TO                              08370005
083800                                    PA-TOT-OPER-ALL-RECORDS.      08380005
083900                                                                  08390005
084000******************************************************************08400005
084100* 3200-ACCUMULATE TOTALS FOR THE COMPANY.                         08410005
084200******************************************************************08420005
084300 3200-ACCUM-COMP-TOTALS.                                          08430005
084400      ADD PA-TOT-OPER-10-RECORDS TO                               08440005
084500                                    PA-TOT-COMP-10-RECORDS.       08450005
084600      ADD PA-TOT-OPER-ALL-RECORDS TO                              08460005
084700                                    PA-TOT-COMP-ALL-RECORDS.      08470005
084800                                                                  08480005
084900*3000-EXIT.                                                       08490005
085000******************************************************************08500005
085100* 4000-SET-UP-DETAIL-LINE.                                        08510005
085200* PROCESS:  THIS PARAGRAPH WILL MOVE THE DETAIL INFORMATION THAT  08520005
085300* WHEN THERE IS A CHANGE IN OPERATOR ID NUMBER.                   08530005
085400******************************************************************08540005
085500 4000-SET-UP-DETAIL-LINE.                                         08550005
085600                                                                  08560005
085700*----------------------------------------------------------------*08570005
085800* MOVE STATEMENT,  PV-WORK-DEPT-NMBR IS REPLACED WITH DL-DEPT    *08580005
085900*                  PV-WORK-CLASS-NMBR IS REPLACED WITH DL-CLASS  *08590005
086000*                  PV-WORK-SEQ-NMBR IS REPLACED WITH DL-SKU      *08600005
086100*                                                  WR # 230ZZ    *08610005
086200*----------------------------------------------------------------*08620005
086300     MOVE MP051O-REC-TMST              TO PV-HOLD-FILE-DATE.      08630005
086400     MOVE PV-HOLD-FILE-YEAR            TO PV-HOLD-WORK-YEAR.      08640005
086500     MOVE PV-HOLD-FILE-MONTH           TO PV-HOLD-WORK-MONTH.     08650005
086600     MOVE PV-HOLD-FILE-DAY             TO PV-HOLD-WORK-DAY.       08660005
086700     MOVE PV-HOLD-WORK-DATE            TO DL-ARRIVAL-DATE.        08670005
086800                                                                  08680005
086900     MOVE MP051O-PO-NBR                TO PV-HOLD-PO-NBR.         08690005
087000     MOVE PV-HOLD-PO-NBR-2             TO DL-PO.                  08700005
087100                                                                  08710005
087200     MOVE MP051O-REC-SEQ-NBR           TO PV-HOLD-REC-SEQ-NBR.    08720005
087300     MOVE PV-HOLD-REC-SEQ-NBR-2        TO DL-RECEIVER-SEQ-NBR.    08730005
087400                                                                  08740005
087500     MOVE MP051O-PACK-BY-ST-IND        TO DL-PBS-IND.             08750005
087600                                                                  08760005
087700     MOVE MP051O-ENT-NAME-DESC         TO DL-VENDOR-NAME.         08770005
087800                                                                  08780005
087900     MOVE MP051O-PO-LNE-NBR            TO PV-HOLD-LNE-NBR.        08790005
088000                                                                  08800005
088100     MOVE PV-HOLD-LNE-NBR-2            TO DL-PO-LINE.             08810005
088200                                                                  08820005
088300     MOVE MP051O-MERCH-DEPT-NMBR       TO DL-DEPT.                08830005
088400     MOVE MP051O-MERCH-CLASS-NMBR      TO DL-CLASS.               08840005
088500     MOVE MP051O-SKU-NMBR              TO DL-SKU.                 08850005
088600                                                                  08860005
088700     MOVE MP051O-UPC-NBR               TO PV-HOLD-UPC-NMBR.       08870005
088800     MOVE PV-HOLD-UPC-1                TO PV-WORK-UPC-1.          08880005
088900     MOVE PV-HOLD-UPC-2                TO PV-WORK-UPC-2.          08890005
089000     MOVE PV-HOLD-UPC-3                TO PV-WORK-UPC-3.          08900005
089100     MOVE PV-HOLD-UPC-4                TO PV-WORK-UPC-4.          08910005
089200     MOVE PV-WORK-UPC-NMBR             TO DL-REQ-CERT.            08920005
089300                                                                  08930005
089400     PERFORM 8000-WRITE-DETAIL-LINE.                              08940005
089500                                                                  08950005
089600*----------------------------------------------------------------*08960005
089700* CHANGES MADE FOR WR # 230ZZ ENDS HERE.                         *08970005
089800*----------------------------------------------------------------*08980005
089900******************************************************************08990005
090000* 4100-SET-UP-TOTAL-LINE.                                         09000005
090100* PROCESS:  THIS PARAGRAPH WILL MOVE THE DETAIL INFORMATION THAT  09010005
090200* WHEN THERE IS A CHANGE IN OPERATOR ID NUMBER.                   09020005
090300******************************************************************09030005
090400 4100-SETUP-PRC-TOTAL-LINE.                                       09040005
090500                                                                  09050005
090600     MOVE PV-PROC-CONTROL-AREA         TO TL-CONTROL-AREA1        09060005
090700                                          TL-CONTROL-AREA2        09070005
090800                                          TL-CONTROL-AREA3.       09080005
090900                                                                  09090005
091000     MOVE PA-TOT-PROC-ALL-RECORDS      TO TL-UPCS-REQ-CERT.       09100005
091100     MOVE TL-TOTAL-LINE1               TO TL-TOTAL-LINE.          09110005
091200     PERFORM 8100-WRITE-TOTAL-LINE.                               09120005
091300     MOVE PA-TOT-PROC-10-RECORDS       TO TL-UPCS.                09130005
091400     MOVE TL-TOTAL-LINE2               TO TL-TOTAL-LINE.          09140005
091500     PERFORM 8100-WRITE-TOTAL-LINE.                               09150005
091600     COMPUTE PC-PERCENT-UPC-NC  =                                 09160005
091700        PA-TOT-PROC-10-RECORDS / PA-TOT-PROC-ALL-RECORDS  * 100   09170005
091800        ON SIZE ERROR  MOVE ZEROES TO PC-PERCENT-UPC-NC.          09180005
091900     MOVE PC-PERCENT-UPC-NC            TO TL-UPCS-PERC-NOT-CERT.  09190005
092000     MOVE TL-TOTAL-LINE3               TO TL-TOTAL-LINE.          09200005
092100     PERFORM 8100-WRITE-TOTAL-LINE.                               09210005
092200     MOVE MP051O-MDSE-PRC-AREA-CDE TO                             09220005
092300                                        PV-PROC-CONTROL-AREA-4    09230005
092400                                        PV-HOLD-PRC-AREA-CDE.     09240005
092500     ADD PC-EIGHT TO PV-LINE-COUNT.                               09250005
092600*4100-EXIT.                                                       09260005
092700                                                                  09270005
092800******************************************************************09280005
092900* 4200-SET-UP-OPER-TOTAL-LINE.                                    09290005
093000* PROCESS:  THIS PARAGRAPH WILL MOVE THE DETAIL INFORMATION THAT  09300005
093100* WHEN THERE IS A CHANGE IN OPERATOR ID NUMBER.                   09310005
093200******************************************************************09320005
093300 4200-SETUP-OPER-TOTAL-LINE.                                      09330005
093400                                                                  09340005
093500     MOVE PV-OPER-CONTROL         TO PV-OPER-CONTROL-DISP.        09350005
093600     MOVE PV-OPER-CONTROL-AREA-DISP    TO TL-CONTROL-AREA1        09360005
093700                                          TL-CONTROL-AREA2        09370005
093800                                          TL-CONTROL-AREA3.       09380005
093900                                                                  09390005
094000     MOVE PA-TOT-OPER-ALL-RECORDS      TO TL-UPCS-REQ-CERT.       09400005
094100     MOVE TL-TOTAL-LINE1               TO TL-TOTAL-LINE.          09410005
094200     PERFORM 8100-WRITE-TOTAL-LINE.                               09420005
094300     MOVE PA-TOT-OPER-10-RECORDS       TO TL-UPCS.                09430005
094400     MOVE TL-TOTAL-LINE2               TO TL-TOTAL-LINE.          09440005
094500     PERFORM 8100-WRITE-TOTAL-LINE.                               09450005
094600     COMPUTE PC-PERCENT-UPC-NC  =                                 09460005
094700        PA-TOT-OPER-10-RECORDS / PA-TOT-OPER-ALL-RECORDS  * 100   09470005
094800        ON SIZE ERROR  MOVE ZEROES TO PC-PERCENT-UPC-NC.          09480005
094900     MOVE PC-PERCENT-UPC-NC            TO TL-UPCS-PERC-NOT-CERT.  09490005
095000     MOVE TL-TOTAL-LINE3               TO TL-TOTAL-LINE.          09500005
095100     PERFORM 8100-WRITE-TOTAL-LINE.                               09510005
095200     MOVE MP051O-OPER-UNT-ID       TO  PV-OPER-CONTROL-AREA       09520005
095300                                       PV-HOLD-OPER-UNT-ID.       09530005
095400     SET DC-INDEX TO 1.                                           09540005
095500     SET PS-DC-OCCURS-NOT-FOUND TO TRUE.                          09550005
095600     PERFORM 1400-GET-DC-NAMES                                    09560005
095700        UNTIL PS-DC-OCCURS-FOUND                                  09570005
095800        OR DC-INDEX GREATER THAN                                  09580005
095900        DC-INDEX-LIMIT.                                           09590005
096000*4200-EXIT.                                                       09600005
096100*                                                                 09610005
096200******************************************************************09620005
096300* 4300-SET-UP-COMP-TOTAL-LINE.                                    09630005
096400* PROCESS:  THIS PARAGRAPH WILL MOVE THE DETAIL INFORMATION THAT  09640005
096500* WHEN THERE IS A CHANGE IN OPERATOR ID NUMBER.                   09650005
096600******************************************************************09660005
096700 4300-SETUP-COMP-TOTAL-LINE.                                      09670005
096800                                                                  09680005
096900     MOVE PV-COMP-CONTROL-AREA         TO TL-CONTROL-AREA1        09690005
097000                                          TL-CONTROL-AREA2        09700005
097100                                          TL-CONTROL-AREA3.       09710005
097200                                                                  09720005
097300     MOVE PA-TOT-COMP-ALL-RECORDS      TO TL-UPCS-REQ-CERT.       09730005
097400     MOVE TL-TOTAL-LINE1               TO TL-TOTAL-LINE.          09740005
097500     PERFORM 8100-WRITE-TOTAL-LINE.                               09750005
097600     MOVE PA-TOT-COMP-10-RECORDS       TO TL-UPCS.                09760005
097700     MOVE TL-TOTAL-LINE2               TO TL-TOTAL-LINE.          09770005
097800     PERFORM 8100-WRITE-TOTAL-LINE.                               09780005
097900     COMPUTE PC-PERCENT-UPC-NC  =                                 09790005
098000        PA-TOT-COMP-10-RECORDS / PA-TOT-COMP-ALL-RECORDS  * 100   09800005
098100        ON SIZE ERROR  MOVE ZEROES TO PC-PERCENT-UPC-NC.          09810005
098200     MOVE PC-PERCENT-UPC-NC            TO TL-UPCS-PERC-NOT-CERT.  09820005
098300     MOVE TL-TOTAL-LINE3               TO TL-TOTAL-LINE.          09830005
098400     PERFORM 8100-WRITE-TOTAL-LINE.                               09840005
098500*4300-EXIT.                                                       09850005
098600*                                                                 09860005
098700 6000-READ-EXTRACT-FILE.                                          09870005
098800******************************************************************09880005
098900*  READ A RECORD FROM THE CERTIFICATION EXTRACT FILE.             09890005
099000******************************************************************09900005
099100     READ MP-EXTRACT-FILE                                         09910005
099200         INTO MP051O-CERTIFICATN-REQ-RECORD                       09920005
099300            AT END SET PS-END-OF-EXTRACT-FILE TO TRUE.            09930005
099400     IF PS-END-OF-EXTRACT-FILE                                    09940005
099500         CONTINUE                                                 09950005
099600     ELSE                                                         09960005
099700         IF MP051O-REC-TMST < PV-DATE-LOW OR                      09970005
099800            MP051O-REC-TMST  > PV-DATE-HIGH                       09980005
099900             SET PS-INVALID-DATE TO TRUE                          09990005
100000         ELSE                                                     10000005
100100             SET PS-VALID-DATE TO TRUE                            10010005
100200     END-IF.                                                      10020005
100300*                                                                 10030005
100400******************************************************************10040005
100500*    OPEN THE CURSOR WHICH WILL RETRIEVE DC NAME FROM THE         10050005
100600*    STORE TABLE.                                                 10060005
100700******************************************************************10070005
100800 7000-OPEN-STORE-CURSOR.                                          10080005
100900                                                                  10090005
101000     PERFORM                                                      10100005
101100         WITH TEST AFTER                                          10110005
101200         VARYING PV-SQL-SUB                                       10120005
101300         FROM 1 BY 1                                              10130005
101400         UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       10140005
101500                   OR SQLCODE = 0                                 10150005
101600                   OR SQLCODE = +100)                             10160005
101700                                                                  10170005
101800         EXEC SQL                                                 10180005
101900             OPEN STORE_CURSOR                                    10190005
102000         END-EXEC                                                 10200005
102100                                                                  10210005
102200         EVALUATE TRUE                                            10220005
102300             WHEN SQLCODE = -904                                  10230005
102400             WHEN SQLCODE = -911                                  10240005
102500             WHEN SQLCODE = 0                                     10250005
102600                 CONTINUE                                         10260005
102700             WHEN SQLCODE = +100                                  10270005
102800                 SET PS-NO-MORE-STORE-ROWS TO TRUE                10280005
102900             WHEN SQLWARN NOT = SPACES                            10290005
103000             WHEN SQLCODE NOT = ZERO                              10300005
103100                 MOVE '7000-OPEN-STORE-CURSOR'                    10310005
103200                               TO  PV-PARAGRAPH-NAME              10320005
103300                 MOVE 'OPEN ON CURSOR'                            10330005
103400                               TO  PV-DB2-OPER-ATTEMPTED          10340005
103500                 PERFORM 9100-SQL-ABEND                           10350005
103600         END-EVALUATE                                             10360005
103700     END-PERFORM.                                                 10370005
103800*                                                                 10380005
103900     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        10390005
104000         MOVE '7000-OPEN-STORE-CURSOR'                            10400005
104100                               TO  PV-PARAGRAPH-NAME              10410005
104200         MOVE 'OPEN RETRIES EXCEEDED'                             10420005
104300                               TO  PV-DB2-OPER-ATTEMPTED          10430005
104400         PERFORM 9100-SQL-ABEND                                   10440005
104500     END-IF.                                                      10450005
104600                                                                  10460005
104700*                                                                 10470005
104800******************************************************************10480005
104900*    FETCH THE NEXT ROW OF THE STRORE CURSOR.  .                  10490005
105000*                                                                 10500005
105100******************************************************************10510005
105200 7100-FETCH-STORE-CURSOR.                                         10520005
105300                                                                  10530005
105400     EXEC SQL                                                     10540005
105500         FETCH STORE_CURSOR                                       10550005
105600         INTO  :XLT00010-LOC-NBR                                  10560008
105700             , :XLT00010-LOC-NM                                   10570008
105800     END-EXEC.                                                    10580005
105900                                                                  10590005
106000     IF SQLCODE = +100                                            10600005
106100         SET PS-NO-MORE-STORE-ROWS TO TRUE                        10610005
106200     ELSE                                                         10620005
106300         IF SQLCODE NOT = 0                                       10630005
106400              MOVE '7100-FETCH-STORE-CURSOR'                      10640005
106500                                       TO PV-PARAGRAPH-NAME       10650005
106600              MOVE 'FETCH ROW FROM STORE CURSOR    '              10660005
106700                                      TO PV-DB2-OPER-ATTEMPTED    10670005
106800             PERFORM 9100-SQL-ABEND                               10680005
106900         END-IF                                                   10690005
107000     END-IF.                                                      10700005
107100*                                                                 10710005
107200******************************************************************10720005
107300*    CLOSE THE STORE CURSOR.                                      10730005
107400******************************************************************10740005
107500 7200-CLOSE-STORE-CURSOR.                                         10750005
107600                                                                  10760005
107700     PERFORM                                                      10770005
107800         WITH TEST AFTER                                          10780005
107900         VARYING PV-SQL-SUB                                       10790005
108000         FROM 1 BY 1                                              10800005
108100         UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       10810005
108200                   OR SQLCODE = 0)                                10820005
108300                                                                  10830005
108400         EXEC SQL                                                 10840005
108500             CLOSE STORE_CURSOR                                   10850005
108600         END-EXEC                                                 10860005
108700                                                                  10870005
108800         EVALUATE TRUE                                            10880005
108900             WHEN SQLCODE = -904                                  10890005
109000             WHEN SQLCODE = -911                                  10900005
109100             WHEN SQLCODE = 0                                     10910005
109200                 CONTINUE                                         10920005
109300             WHEN SQLWARN NOT = SPACES                            10930005
109400             WHEN SQLCODE NOT = ZERO                              10940005
109500                 MOVE '7200-CLOSE-STORE-CURSOR  '                 10950005
109600                               TO  PV-PARAGRAPH-NAME              10960005
109700                 MOVE 'CLOSE ON CURSOR'                           10970005
109800                               TO  PV-DB2-OPER-ATTEMPTED          10980005
109900                 PERFORM 9100-SQL-ABEND                           10990005
110000         END-EVALUATE                                             11000005
110100     END-PERFORM.                                                 11010005
110200*                                                                 11020005
110300     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        11030005
110400         MOVE '7200-CLOSE-STORE-CURSOR  '                         11040005
110500                               TO  PV-PARAGRAPH-NAME              11050005
110600         MOVE 'CLOSE RETRIES EXCEEDED'                            11060005
110700                               TO  PV-DB2-OPER-ATTEMPTED          11070005
110800         PERFORM 9100-SQL-ABEND                                   11080005
110900     END-IF.                                                      11090005
111000*                                                                 11100005
111100*                                                                 11110005
111200******************************************************************11120005
111300* 8000-WRITE-DETAIL-LINE - CHECKS IF THE PAGE SIZE HAS BEEN EX-   11130005
111400* CEEDED.  IF SO, THE HEADING LINES ARE WRITTEN AND THE LINE COUNT11140005
111500* INITIALIZED.  THE DETAIL LINE IS THEN WRITTEN.                  11150005
111600******************************************************************11160005
111700 8000-WRITE-DETAIL-LINE.                                          11170005
111800                                                                  11180005
111900     ADD +1 TO PV-LINE-COUNT.                                     11190005
112000                                                                  11200005
112100     IF PV-LINE-COUNT >= PC-MAX-REPORT-LINES                      11210005
112200         PERFORM 8300-WRITE-PAGE-HEADING                          11220005
112300         PERFORM 8350-WRITE-PROC-AREA-HEADING                     11230005
112400         PERFORM 8400-WRITE-COLUMN-HEADING                        11240005
112500         SET PS-NEW-LINE           TO TRUE                        11250005
112600     END-IF.                                                      11260005
112700                                                                  11270005
112800                                                                  11280005
112900                                                                  11290005
113000     WRITE MP-REPORT-LINE                                         11300005
113100         FROM DL-DETAIL-LINE                                      11310005
113200         AFTER ADVANCING 1 LINES.                                 11320005
113300                                                                  11330005
113400*8000-EXIT.                                                       11340005
113500                                                                  11350005
113600******************************************************************11360005
113700* 8100-WRITE-TOTAL-LINE - WRITE THE CONTROL BREAK TOTAL LINES     11370005
113800******************************************************************11380005
113900 8100-WRITE-TOTAL-LINE.                                           11390005
114000                                                                  11400005
114100     IF ( PV-LINE-COUNT + 6 ) > PC-MAX-REPORT-LINES               11410005
114200         PERFORM 8300-WRITE-PAGE-HEADING                          11420005
114300         PERFORM 8400-WRITE-COLUMN-HEADING                        11430005
114400         SET PS-NEW-LINE           TO TRUE                        11440005
114500     END-IF.                                                      11450005
114600                                                                  11460005
114700     WRITE MP-REPORT-LINE                                         11470005
114800         FROM TL-TOTAL-LINE                                       11480005
114900         AFTER ADVANCING 2 LINES.                                 11490005
115000                                                                  11500005
115100*8100-EXIT.                                                       11510005
115200                                                                  11520005
115300******************************************************************11530005
115400* 8200-WRITE-BLANK-LINE - WRITES A BLANK LINE TO THE REPORT.      11540005
115500******************************************************************11550005
115600 8200-WRITE-BLANK-LINE.                                           11560005
115700                                                                  11570005
115800     WRITE MP-REPORT-LINE                                         11580005
115900         FROM BLANK-LINE                                          11590005
116000         AFTER ADVANCING 1 LINES.                                 11600005
116100                                                                  11610005
116200     ADD +1                        TO PV-LINE-COUNT.              11620005
116300                                                                  11630005
116400*8200-EXIT.                                                       11640005
116500                                                                  11650005
116600******************************************************************11660005
116700* 8250-WRITE-BLANK-LINE - WRITES A BLANK LINE TO THE REPORT.      11670005
116800******************************************************************11680005
116900 8250-WRITE-UNDERLINE-LINE.                                       11690005
117000                                                                  11700005
117100                                                                  11710005
117200     PERFORM 8200-WRITE-BLANK-LINE.                               11720005
117300                                                                  11730005
117400     ADD +1                        TO PV-LINE-COUNT.              11740005
117500*8200-EXIT.                                                       11750005
117600******************************************************************11760005
117700* 8300-WRITE-PAGE-HEADING - WRITE THE PAGE AND DETAIL HEADINGS FOR11770005
117800* THE DEFECTIVE ITEM REPORT.                                      11780005
117900******************************************************************11790005
118000 8300-WRITE-PAGE-HEADING.                                         11800005
118100                                                                  11810005
118200     ADD 1 TO PV-PAGE-COUNT.                                      11820005
118300     MOVE PV-PAGE-COUNT TO DP132O-PAGE-NUMBER.                    11830005
118400                                                                  11840005
118500     WRITE MP-REPORT-LINE                                         11850005
118600         FROM DP132O-STANDRD-HEADER-132-COLS                      11860005
118700         AFTER ADVANCING PAGE.                                    11870005
118800                                                                  11880005
118900     WRITE MP-REPORT-LINE                                         11890005
119000         FROM PH2-PAGE-HEADING-2                                  11900005
119100         AFTER ADVANCING 1 LINES.                                 11910005
119200                                                                  11920005
119300     WRITE MP-REPORT-LINE                                         11930005
119400         FROM PH3-PAGE-HEADING-3                                  11940005
119500         AFTER ADVANCING 1 LINES.                                 11950005
119600                                                                  11960005
119700     MOVE PV-OPER-CONTROL          TO PH4-OPER-UNT.               11970005
119800                                                                  11980005
119900     WRITE MP-REPORT-LINE                                         11990005
120000         FROM PH4-PAGE-HEADING-4                                  12000005
120100         AFTER ADVANCING 2 LINES.                                 12010005
120200                                                                  12020005
120300     MOVE PC-SIX TO PV-LINE-COUNT.                                12030005
120400*8300-EXIT.                                                       12040005
120500                                                                  12050005
120600******************************************************************12060005
120700* 8350-WRITE-PROCESSING AREA HEADING.                             12070005
120800******************************************************************12080005
120900 8350-WRITE-PROC-AREA-HEADING.                                    12090005
121000                                                                  12100005
121100     MOVE MP051O-MDSE-PRC-AREA-CDE TO PH5-PROC-AREA.              12110005
121200                                                                  12120005
121300     IF ( PV-LINE-COUNT + 6 ) > PC-MAX-REPORT-LINES               12130005
121400         PERFORM 8300-WRITE-PAGE-HEADING                          12140005
121500         PERFORM 8400-WRITE-COLUMN-HEADING                        12150005
121600         SET PS-NEW-LINE           TO TRUE                        12160005
121700     ELSE                                                         12170005
121800         WRITE MP-REPORT-LINE                                     12180005
121900            FROM PH5-PAGE-HEADING-5                               12190005
122000            AFTER ADVANCING 2 LINES                               12200005
122100         ADD PC-THREE TO PV-LINE-COUNT                            12210005
122200     END-IF.                                                      12220005
122300******************************************************************12230005
122400* 8400-WRITE-COLUMN-HEADING - WRITE THE COLUMN HEADINGS FOR       12240005
122500* THE DEFECTIVE ITEM REPORT.                                      12250005
122600******************************************************************12260005
122700 8400-WRITE-COLUMN-HEADING.                                       12270005
122800                                                                  12280005
122900     WRITE MP-REPORT-LINE                                         12290005
123000         FROM DH1-DETAIL-HEADING-1                                12300005
123100         AFTER ADVANCING 2 LINES.                                 12310005
123200                                                                  12320005
123300     WRITE MP-REPORT-LINE                                         12330005
123400         FROM DH2-DETAIL-HEADING-2                                12340005
123500         AFTER ADVANCING 1 LINES.                                 12350005
123600                                                                  12360005
123700     PERFORM 8200-WRITE-BLANK-LINE.                               12370005
123800                                                                  12380005
123900     ADD PC-THREE TO PV-LINE-COUNT.                               12390005
124000*8400-EXIT.                                                       12400005
124100                                                                  12410005
124200                                                                  12420005
124300******************************************************************12430005
124400* 8900-EMPTY-DEFECT-RPT - IF THERE WAS NO DATA THAT SATISFIED THE 12440005
124500* SELECTION CRITERIA, DISPLAY THE CONTROL CARD VALUES IN A MORE   12450005
124600* READABLE FORMAT.                                                12460005
124700******************************************************************12470005
124800 8900-EMPTY-CERTIFICATION-RPT.                                    12480005
124900                                                                  12490005
125000     DISPLAY '*** NO INFORMATION WAS FOUND TO MATCH THE '         12500005
125100             'SELECTION CRITERIA ***'                             12510005
125200     DISPLAY '*** THE CONTROL CARD CONTAINED THE FOLLOWING '      12520005
125300             'INFORMATION: ***'                                   12530005
125400                                                                  12540005
125500                                                                  12550005
125600*    PERFORM 8300-WRITE-PAGE-HEADING.                             12560005
125700                                                                  12570005
125800     WRITE MP-REPORT-LINE                                         12580005
125900         FROM ER-EMPTY-REPORT-LINE                                12590005
126000         AFTER ADVANCING 1 LINES.                                 12600005
126100                                                                  12610005
126200*8900-EXIT.                                                       12620005
126300                                                                  12630005
126400******************************************************************12640005
126500* 9000-EOJ-ROUTINE - PRINTS A GRAND TOTAL, AND CLOSES THE DRIVER  12650005
126600* CURSOR AND THE REPORT FILE.                                     12660005
126700******************************************************************12670005
126800 9000-EOJ-ROUTINE.                                                12680005
126900                                                                  12690005
127000     IF PS-NO-DATA                                                12700005
127100         PERFORM 8900-EMPTY-CERTIFICATION-RPT                     12710005
127200     ELSE                                                         12720005
127300         PERFORM 4100-SETUP-PRC-TOTAL-LINE                        12730005
127400         PERFORM 8300-WRITE-PAGE-HEADING                          12740005
127500         PERFORM 3100-ACCUM-OPER-ID-TOTALS                        12750005
127600         PERFORM 4200-SETUP-OPER-TOTAL-LINE                       12760005
127700         PERFORM 8250-WRITE-UNDERLINE-LINE                        12770005
127800         PERFORM 3200-ACCUM-COMP-TOTALS                           12780005
127900         PERFORM 8200-WRITE-BLANK-LINE                            12790005
128000         PERFORM 4300-SETUP-COMP-TOTAL-LINE                       12800005
128100     END-IF.                                                      12810005
128200                                                                  12820005
128300     PERFORM 8200-WRITE-BLANK-LINE.                               12830005
128400                                                                  12840005
128500     WRITE MP-REPORT-LINE                                         12850005
128600         FROM END-OF-REPORT-LINE                                  12860005
128700         AFTER ADVANCING 1 LINES.                                 12870005
128800                                                                  12880005
128900     CLOSE MP-EXTRACT-FILE                                        12890005
129000           MP-REPORT-FILE.                                        12900005
129100*9000-EXIT.                                                       12910005
129200******************************************************************12920005
129300* 9100-SQL-ABEND - PERFORMS THE ABEND FOR THE PROGRAM IN THE      12930005
129400* EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS.                 12940005
129500******************************************************************12950005
129600 9100-SQL-ABEND.                                                  12960005
129700     DISPLAY '** ABEND     **'.                                   12970005
129800     DISPLAY '** PROGRAM   ** = MPKRP029'.                        12980005
129900     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              12990005
130000     DISPLAY '** OPERATION ** = ' PV-DB2-OPER-ATTEMPTED.          13000005
130100                                                                  13010005
130200******************************************************************13020005
130300* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    13030005
130400* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         13040005
130500* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     13050005
130600* FORMAT.                                                         13060005
130700******************************************************************13070005
130800*    COPY DPPD004.                                                13080005
130900     COPY DPPD004.                                                13090005
131000                                                                  13100005
131100     MOVE +4013 TO ABEND-CODE.                                    13110005
131200     CALL 'ILBOABN0' USING ABEND-CODE.                            13120005
131300*9100-EXIT.                                                       13130005
