000100 IDENTIFICATION DIVISION.                                         00010005
000200 PROGRAM-ID.     APKUP260.                                        00020005
000300 AUTHOR.         LEN LEWANDOWSKI (CPU)                            00030005
000400*DATE-WRITTEN.   MAR  27, 1995.                                   00040005
000500*DATE-COMPILED.                                                   00050005
000600*************************************************************     00060005
000700*    COBOL 2 WITH SQL                                       *     00070005
000800*                                                           *     00080005
000900*    UPDATE STATUS CODE IN THE PO/STORES TABLE BASED ON     *     00090005
001000*    CONTROL CARD INPUT                                     *     00100005
001100*                                                           *     00110005
001200* INPUT:                                                    *     00120005
001300* 1.  CONTROL CARD                                          *     00130005
001400*                                                           *     00140005
001500* OUTPUT:                                                   *     00150005
001600* 1.  UPDATE DB2 TPOSTRR TABLE                              *     00160005
001700*                                                           *     00170005
001800*************************************************************     00180005
001900* CHANGE LOG:                                               *     00190005
002000*                                                           *     00200005
002100* 03/27/95    INITIAL VERSION.                              *     00210005
002200*                                                           *     00220005
002300* 05/24/95    NANCY EILBES.                                 *     00230005
002400* MODIFIED LOGIC IN B200 SO THE PROGRAM WOULD ABEND IF ANY  *     00240005
002500* CONTROL CARDS WERE INVALID, RATHER THAN JUST DISPLAYING   *     00250005
002600* AN ERROR MESSAGE.                                         *     00260005
002700*                                                           *     00270005
002710* 03/28/02    NANCY EILBES.                                 *     00271005
002720* MODIFIED CONTROL CARD FORMAT TO ADD IMBEDDED SPACES THAT  *     00272005
002730* SPUFI AUTOMATICALLY INSERTS BETWEEN SELECTED COLUMNS SO   *     00273005
002740* THAT SPUFI CAN BE USED TO BUILD THE CONTROL CARD.         *     00274005
002741* RESTRUCTURED AND REPLACED DISPLAYS THROUGHOUT WITH END    *     00274105
002742* OF PROGRAM COUNTS.                                        *     00274205
002743*                                                           *     00274305
002744* 03/11/07                                                  *     00274406
002745*      THE CONTROL CARD HAS BEEN MODIFIED TO INCLUDE THE    *     00274505
002746*      MATCH LEVEL CODE OF THE PO BEING PROCESSED.  THIS    *     00274605
002747*      VALUE IS TO BE INCLUDED WITH THE RECORDS INSERTED    *     00274705
002748*      INTO TPOSTRR.  THIS CHANGE WAS APPLIED FOR THE MATCH *     00274805
002749*      BY DC PROJECT.                                       *     00274905
002750*      MADE BY: MICHELE RINDFLEISCH     WR/IR #: WR21578    *     00275005
002751*                                                           *     00275107
002752* DATE  11/04/2014                                          *     00275207
002753*     CHANGE MADE: PO EXTENDED DIGIT CHANGES.               *     00275308
002754*     EXTENDED PO# FROM 7 TO 9.                             *     00275407
002755*     MADE BY: COGNIZANT               WR/IR #: CHG0094517  *     00275507
002756*************************************************************     00275605
002757                                                                  00275705
002758 ENVIRONMENT DIVISION.                                            00275805
002759                                                                  00275905
002760 INPUT-OUTPUT SECTION.                                            00276005
002761                                                                  00276105
002762 FILE-CONTROL.                                                    00276205
002763                                                                  00276305
002764     SELECT INP01-FILE           ASSIGN  TO  UT-S-INP01.          00276405
002765                                                                  00276505
002770 DATA DIVISION.                                                   00277005
002780                                                                  00278005
002790 FILE SECTION.                                                    00279005
002800                                                                  00280005
002900 FD  INP01-FILE                                                   00290005
003000     LABEL RECORDS  ARE STANDARD                                  00300005
003100     RECORDING MODE IS  F                                         00310005
003200     DATA RECORD    IS  INP01-RECORD.                             00320005
003300                                                                  00330005
003400 01  INP01-RECORD                PIC X(80).                       00340005
003500                                                                  00350005
003600 EJECT                                                            00360005
003700 WORKING-STORAGE SECTION.                                         00370005
003800                                                                  00380005
003900 01  FILLER                      PIC X(25) VALUE                  00390005
004000     'WS FOR APKUP260 BEGINS==>'.                                 00400005
004100 01  ABEND-CODE                    PIC S9(4) COMP SYNC            00410005
004200                                             VALUE ZEROS.         00420005
004300     88 AP-DB2-ERROR               VALUE +4013.                   00430005
004400                                                                  00440005
004500 01  COUNTERS.                                                    00450005
004600     05  INPUT-COUNT               PIC 9(07)  VALUE ZERO.         00460005
004700     05  UPDATE-COUNT              PIC 9(07)  VALUE ZERO.         00470005
004800     05  INSERT-COUNT              PIC 9(07)  VALUE ZERO.         00480005
004900     05  BYPASS-COUNT              PIC 9(07)  VALUE ZERO.         00490005
005000                                                                  00500005
005100 01  WS-SWITCH-AREA.                                              00510005
005200     05  WS-INPUT-END-SW           PIC X(01)  VALUE 'N'.          00520005
005300         88  WS-END-OF-INPUT                  VALUE 'Y'.          00530005
005400         88  WS-NOT-END-OF-INPUT              VALUE 'N'.          00540005
005500     05  WS-INPUT-ERROR-SW         PIC X(01)  VALUE 'N'.          00550005
005600         88  WS-INPUT-ERROR                   VALUE 'Y'.          00560005
005700         88  WS-INPUT-OK                      VALUE 'N'.          00570005
005800                                                                  00580005
005900******************************************************************00590005
006000*  CONTROL CARD AREA                                              00600005
006100*                                                                 00610005
006200* SAMPLE FORMAT:                                                  00620005
006300*  ----+----1----+----2----+----3----+----4----+----5----+----6   00630005
006400*  PO=  1234567  ,STORE=  1234  ,STATUS=X                         00640005
006500*                                                                 00650005
006600******************************************************************00660005
006700 01  WS-CONTROL-CARD.                                             00670005
006800     05  WS-CC-PO-LIT              PIC X(05).                     00680005
006900     05  WS-CC-PO-NBR.                                            00690005
007000         10 WS-CC-PO-NBR-9         PIC 9(09).                     00700007
007100     05  FILLER                    PIC X(03).                     00710005
007200     05  WS-CC-STR-LIT             PIC X(08).                     00720005
007300     05  WS-CC-STR-NBR.                                           00730005
007400         10 WS-CC-STR-NBR-9        PIC 9(04).                     00740005
007500     05  FILLER                    PIC X(03).                     00750005
007600     05  WS-CC-STATUS-LIT          PIC X(07).                     00760005
007700     05  WS-CC-STATUS-CDE          PIC X(01).                     00770005
007800     05  FILLER                    PIC X(03).                     00780005
007900     05  WS-CC-MTCH-LVL-CDE-LIT    PIC X(09).                     00790005
007901     05  WS-CC-MTCH-LVL-CDE        PIC X(01).                     00790105
007902     05  FILLER                    PIC X(27).                     00790208
007903                                                                  00790305
007904 01  WS-ABEND-FIELDS.                                             00790405
007905     05  WS-ABEND-PROGRAM             PIC X(8)  VALUE 'APKUP260'. 00790505
007906     05  WS-ABEND-PARAGRAPH           PIC X(50) VALUE SPACES.     00790605
007907     05  WS-ABEND-OPERATION           PIC X(50) VALUE SPACES.     00790705
007908     05  WS-ABEND-STRUCTURE-1         PIC X(8)  VALUE SPACES.     00790805
007909     05  WS-ABEND-STRUCTURE-2         PIC X(8)  VALUE SPACES.     00790905
007910     05  WS-ABEND-STATUS              PIC XX    VALUE SPACES.     00791005
007920                                                                  00792005
007930     COPY DPWS004.                                                00793005
007940                                                                  00794005
007950 01  FILLER                      PIC X(35)  VALUE                 00795005
007960     'END OF AP WORK RECORD AREA       **'.                       00796005
007970                                                                  00797005
007980                                                                  00798005
007990******************************************************************00799005
008000*  COMMUNICATIONS AREA2 FOR DB2                                   00800005
008100******************************************************************00810005
008200                                                                  00820005
008300     COPY SQLCA2.                                                 00830005
008400                                                                  00840005
008500     EXEC SQL                                                     00850005
008600          INCLUDE SQLCA                                           00860005
008700     END-EXEC.                                                    00870005
008800                                                                  00880005
008900     EXEC SQL                                                     00890005
009000          INCLUDE TPOSTRR                                         00900005
009100     END-EXEC.                                                    00910005
009200                                                                  00920005
009300 01  FILLER                        PIC X(25) VALUE                00930005
009400     '<====WS FOR APKUP260 ENDS'.                                 00940005
009500                                                                  00950005
009600*LINKAGE SECTION.                                                 00960005
009700                                                                  00970005
009800 EJECT                                                            00980005
009900 PROCEDURE DIVISION.                                              00990005
010000                                                                  01000005
010100 A000-MAINLINE.                                                   01010005
010200                                                                  01020005
010300     PERFORM B100-BEGIN.                                          01030005
010400                                                                  01040005
010500     PERFORM B200-PROCESS                                         01050005
010600         UNTIL WS-END-OF-INPUT.                                   01060005
010700                                                                  01070005
010800     PERFORM B300-END.                                            01080005
010900                                                                  01090005
011000     GOBACK.                                                      01100005
011100                                                                  01110005
011200 B100-BEGIN.                                                      01120005
011300                                                                  01130005
011400*  OPEN FILES                                                     01140005
011500                                                                  01150005
011600     OPEN INPUT INP01-FILE.                                       01160005
011700                                                                  01170005
011800     PERFORM R100-READ-CONTROL-CARD.                              01180005
011900                                                                  01190005
012000 EJECT                                                            01200005
012100***************************************************************** 01210005
012200* PROCESS CONTROL CARDS UNTIL EOF                                 01220005
012300***************************************************************** 01230005
012400 B200-PROCESS.                                                    01240005
012500                                                                  01250005
012600     SET WS-INPUT-OK TO TRUE.                                     01260005
012700     PERFORM C100-EDIT-CONTROL-CARD.                              01270005
012800                                                                  01280005
012900     MOVE WS-CC-PO-NBR-9  TO POSTRR-PO-NBR.                       01290005
013000     MOVE WS-CC-STR-NBR-9 TO POSTRR-STR-NBR.                      01300005
013100                                                                  01310005
013200     IF WS-CC-STR-NBR = 'ALL '                                    01320005
013300        PERFORM U100-UPDATE-ALL-STORES                            01330005
013400     ELSE                                                         01340005
013500        PERFORM U200-UPDATE-SPECIFIC-STORE                        01350005
013600     END-IF.                                                      01360005
013700                                                                  01370005
013800     PERFORM R100-READ-CONTROL-CARD.                              01380005
013900                                                                  01390005
014000 EJECT                                                            01400005
014100 B300-END.                                                        01410005
014200                                                                  01420005
014300     CLOSE INP01-FILE.                                            01430005
014400                                                                  01440005
014500     DISPLAY '*** END OF PROGRAM APKUP260 ***'.                   01450005
014600     DISPLAY '   INPUT COUNT = ' INPUT-COUNT.                     01460005
014700     DISPLAY '   UPDATE COUNT = ' UPDATE-COUNT.                   01470005
014800     DISPLAY '   INSERT COUNT = ' INSERT-COUNT.                   01480005
014900     DISPLAY '   BYPASS COUNT = ' BYPASS-COUNT.                   01490005
015000                                                                  01500005
015100                                                                  01510005
015200 C100-EDIT-CONTROL-CARD.                                          01520005
015300                                                                  01530005
015400     DISPLAY 'WS-CONTROL-CARD: ' WS-CONTROL-CARD                  01540005
015500                                                                  01550005
015600     IF WS-CC-PO-NBR NUMERIC                                      01560005
015700         NEXT SENTENCE                                            01570005
015800     ELSE                                                         01580005
015900         DISPLAY '    PO NUMBER NOT NUMERIC'                      01590005
016000         SET WS-INPUT-ERROR      TO   TRUE.                       01600005
016100                                                                  01610005
016200     IF WS-CC-STR-NBR NUMERIC OR                                  01620005
016300        WS-CC-STR-NBR = 'ALL '                                    01630005
016400         NEXT SENTENCE                                            01640005
016500     ELSE                                                         01650005
016600         DISPLAY '    STORE NUMBER NOT NUMERIC'                   01660005
016700         SET WS-INPUT-ERROR      TO   TRUE.                       01670005
016800                                                                  01680005
016900     IF WS-CC-STATUS-CDE = SPACE OR 'P' OR 'I'                    01690005
017000         NEXT SENTENCE                                            01700005
017100     ELSE                                                         01710005
017200         DISPLAY '    STATUS CODE MUST BE BLANK, P OR I'          01720005
017300         SET WS-INPUT-ERROR      TO   TRUE.                       01730005
017400                                                                  01740005
017500     IF WS-CC-MTCH-LVL-CDE = 'S' OR 'P' OR 'D'                    01750005
017600         NEXT SENTENCE                                            01760005
017700     ELSE                                                         01770005
017800         DISPLAY '    MATCH LEVEL CODE MUST BE S, P OR D'         01780005
017900         SET WS-INPUT-ERROR      TO   TRUE                        01790005
018000     END-IF.                                                      01800005
018100                                                                  01810005
018200                                                                  01820005
018300     IF WS-INPUT-ERROR                                            01830005
018400        MOVE 'C100-EDIT-CONTROL-CARD'  TO   WS-ABEND-PARAGRAPH    01840005
018500        MOVE '* INVALID CONTROL CARD DATA *'                      01850005
018600                                 TO   WS-ABEND-OPERATION          01860005
018700        PERFORM Z998-ERROR                                        01870005
018800     END-IF.                                                      01880005
018900                                                                  01890005
019000 R100-READ-CONTROL-CARD.                                          01900005
019100                                                                  01910005
019200     READ INP01-FILE INTO WS-CONTROL-CARD                         01920005
019300         AT END SET WS-END-OF-INPUT TO TRUE.                      01930005
019400                                                                  01940005
019500     IF WS-END-OF-INPUT                                           01950005
019600        CONTINUE                                                  01960005
019700     ELSE                                                         01970005
019800        ADD 1 TO INPUT-COUNT                                      01980005
019900     END-IF.                                                      01990005
020000                                                                  02000005
020100 U100-UPDATE-ALL-STORES.                                          02010005
020200                                                                  02020005
020300     EXEC SQL                                                     02030005
020400       UPDATE TPOSTRR                                             02040005
020500          SET STATUS_CDE = :WS-CC-STATUS-CDE                      02050005
020600        WHERE PO_NBR     = :POSTRR-PO-NBR                         02060005
020700     END-EXEC.                                                    02070005
020800                                                                  02080005
020900     EVALUATE TRUE                                                02090005
021000         WHEN SQLCODE = ZERO                                      02100005
021100              ADD 1 TO UPDATE-COUNT                               02110005
021200         WHEN SQLCODE = +100                                      02120005
021300              ADD 1 TO BYPASS-COUNT                               02130005
021400              DISPLAY 'PO ' POSTRR-PO-NBR ' NOT FOUND - ANY STORE'02140005
021500         WHEN SQLWARN0 NOT = SPACES                               02150005
021600         WHEN SQLCODE  NOT = ZERO                                 02160005
021700              MOVE 'U100-UPDATE-ALL-STORES'                       02170005
021800                             TO   WS-ABEND-PARAGRAPH              02180005
021900              MOVE 'UNSUCCESSFUL UPDATE PO/STORES'                02190005
022000                             TO   WS-ABEND-OPERATION              02200005
022100              MOVE 'TPOSTRR' TO   WS-ABEND-STRUCTURE-1            02210005
022200              MOVE SPACE     TO   WS-ABEND-STRUCTURE-2            02220005
022300              PERFORM Z999-SQL-ERROR                              02230005
022400     END-EVALUATE.                                                02240005
022500                                                                  02250005
022600 U200-UPDATE-SPECIFIC-STORE.                                      02260005
022700                                                                  02270005
022800     EXEC SQL                                                     02280005
022900       UPDATE TPOSTRR                                             02290005
023000          SET STATUS_CDE = :WS-CC-STATUS-CDE                      02300005
023100        WHERE PO_NBR  = :POSTRR-PO-NBR                            02310005
023200          AND STR_NBR = :POSTRR-STR-NBR                           02320005
023300     END-EXEC.                                                    02330005
023400                                                                  02340005
023500     EVALUATE TRUE                                                02350005
023600         WHEN SQLCODE = ZERO                                      02360005
023700              ADD 1 TO UPDATE-COUNT                               02370005
023800         WHEN SQLCODE = +100                                      02380005
023900              PERFORM U300-INSERT-POSTRR-ROW                      02390005
024000         WHEN SQLWARN0 NOT = SPACES                               02400005
024100         WHEN SQLCODE  NOT = ZERO                                 02410005
024200              MOVE 'B200-PROCESS'                                 02420005
024300                             TO   WS-ABEND-PARAGRAPH              02430005
024400              MOVE 'UNSUCCESSFUL UPDATE PO/STORES'                02440005
024500                             TO   WS-ABEND-OPERATION              02450005
024600              MOVE 'TPOSTRR' TO   WS-ABEND-STRUCTURE-1            02460005
024700              MOVE SPACE     TO   WS-ABEND-STRUCTURE-2            02470005
024800              PERFORM Z999-SQL-ERROR                              02480005
024900     END-EVALUATE.                                                02490005
025000                                                                  02500005
025100                                                                  02510005
025200 U300-INSERT-POSTRR-ROW.                                          02520005
025300                                                                  02530005
025400*  INSERT A ROW IF REQUESTED PO/STORE NOT FOUND                   02540005
025500                                                                  02550005
025600     EXEC SQL                                                     02560005
025700       INSERT INTO TPOSTRR                                        02570005
025800              (PO_NBR,                                            02580005
025900               STR_NBR,                                           02590005
026000               PAYT_RLSE_TMST,                                    02600005
026100               CRE_PRC_CDE,                                       02610005
026200               STATUS_CDE,                                        02620005
026300               PAYT_RLSE_USR_ID,                                  02630005
026400               TOLR_ADJ_CDE,                                      02640005
026500               TOLR_ADJ_AMT,                                      02650005
026600               WEIGHTED_DISC_PCT,                                 02660005
026700               TOTAL_DISC_AMT,                                    02670005
026800               MTCH_LVL_CDE)                                      02680005
026900       VALUES                                                     02690005
027000             (:POSTRR-PO-NBR,                                     02700005
027100              :POSTRR-STR-NBR,                                    02710005
027200              CURRENT TIMESTAMP,                                  02720005
027300              'B',                                                02730005
027400              :WS-CC-STATUS-CDE,                                  02740005
027500              'APKUP260',                                         02750005
027600              '  ',                                               02760005
027700              0.00,                                               02770005
027800              0.00,                                               02780005
027900              0.00,                                               02790005
028000              :WS-CC-MTCH-LVL-CDE)                                02800005
028100     END-EXEC.                                                    02810005
028200                                                                  02820005
028300     EVALUATE TRUE                                                02830005
028400         WHEN SQLCODE = ZERO                                      02840005
028500              ADD 1 TO INSERT-COUNT                               02850005
028600         WHEN SQLWARN0 NOT = SPACES                               02860005
028700         WHEN SQLCODE  NOT = ZERO                                 02870005
028800              MOVE 'U300-INSERT-POSTRR-ROW'                       02880005
028900                                 TO   WS-ABEND-PARAGRAPH          02890005
029000              MOVE 'UNSUCCESSFUL INSERT PO/STORES'                02900005
029100                                 TO   WS-ABEND-OPERATION          02910005
029200              MOVE 'TPOSTRR'     TO   WS-ABEND-STRUCTURE-1        02920005
029300              MOVE SPACE         TO   WS-ABEND-STRUCTURE-2        02930005
029400              PERFORM Z999-SQL-ERROR                              02940005
029500     END-EVALUATE.                                                02950005
029600                                                                  02960005
029700 Z998-ERROR.                                                      02970005
029800                                                                  02980005
029900     MOVE +4014 TO ABEND-CODE.                                    02990005
030000     DISPLAY ABEND-CODE.                                          03000005
030100     DISPLAY '*** PROGRAM   = ' WS-ABEND-PROGRAM.                 03010005
030200     DISPLAY '*** PARAGRAPH = ' WS-ABEND-PARAGRAPH.               03020005
030300     DISPLAY WS-ABEND-OPERATION.                                  03030005
030400     CALL 'ILBOABN0'            USING ABEND-CODE.                 03040005
030500                                                                  03050005
030600 Z999-SQL-ERROR.                                                  03060005
030700*                                                                 03070005
030800***************************************************************** 03080005
030900*     PROCESS DB2 ABENDS                                          03090005
031000***************************************************************** 03100005
031100*                                                                 03110005
031200     DISPLAY ' '.                                                 03120005
031300     DISPLAY '*** DB2 ERROR '.                                    03130005
031400     DISPLAY '*** PROGRAM   = ' WS-ABEND-PROGRAM.                 03140005
031500     DISPLAY '*** PARAGRAPH = ' WS-ABEND-PARAGRAPH.               03150005
031600     DISPLAY '*** OPERATION = ' WS-ABEND-OPERATION.               03160005
031700     DISPLAY '*** TABLE 1   = ' WS-ABEND-STRUCTURE-1.             03170005
031800     IF WS-ABEND-STRUCTURE-2 > SPACES                             03180005
031900         DISPLAY '*** TABLE 2   = ' WS-ABEND-STRUCTURE-2.         03190005
032000                                                                  03200005
032100     MOVE +4013                  TO   ABEND-CODE.                 03210005
032200                                                                  03220005
032300     COPY DPPD004.                                                03230005
032400                                                                  03240005
032500     CALL 'ILBOABN0'            USING ABEND-CODE.                 03250005
032600                                                                  03260005
