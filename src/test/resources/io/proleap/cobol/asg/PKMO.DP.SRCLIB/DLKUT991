000100 IDENTIFICATION DIVISION.                                         00010000
000200******************************************************************00020000
000300                                                                  00030000
000400 PROGRAM-ID.    DLKUT991.                                         00040000
000500 AUTHOR.        RON KRIER.                                        00050000
000600 INSTALLATION.  KOHLS.                                            00060000
000700 DATE-WRITTEN   NOVEMBER 2016.                                    00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000******************************************************************00100000
001100* THE PURPOSE OF THIS PROGRAM IS TO BUILD AN OUTPUT FILE WHICH    00110000
001200* CAN BE SENT TO A LOWER LEVEL MANHATTAN LM INSTANCE TO ASSIST    00120000
001300* WITH TESTING.                                                   00130000
001400******************************************************************00140000
001500******************************************************************00150000
001600* PROGRAM WILL TAKE IN 3 INPUT FILES.  THE FIRST BEING A FILE OF  00160000
001700* PRODUCTION LABOR EVENTS UPLOADED FROM A PRODUCTION TIBCO SERVER.00170000
001800* THE SECOND BEING A CONTROL FILE TO INDICATE IF WE SHOULD RESET  00180000
001900* THE TRANSACTION NUMBER AND IF SO, WHAT IS THE STARTING          00190000
002000* TRANSACTION NUMBER TO USE.  THE SECOND FILE WILL ALSO HAVE AN   00200000
002100* INDICATOR TO IDENTIFY IF WE USE THE ENTIRE FIRST INPUT FILE TO  00210000
002200* WRITE TO THE OUTPUT OR IF WE WANT TO FILTER ONLY SPECIFIC USER  00220000
002300* ID'S FROM THE FILE.  IF WE WANT ALL USER ID'S ON THE FILE,      00230000
002400* THEN THE THIRD FILE IS NOT NEEDED.  IF WE WANT TO FILTER ONLY   00240000
002500* CERTAIN USER ID'S, THEN THE THIRD FILE WILL CONTAIN THE USER    00250000
002600* ID'S TO SELECT.                                                 00260000
002610* FOR MORE INFORMATION, LOOK FOR THE ENTRY IN THE WD FAQ          00261008
002620* SPREADSHEET (LOOK FOR DLKUT991) ON HOW TO RUN THIS AND GET THE  00262008
002630* DATA FOR THE PROGRAM.                                           00263008
002700******************************************************************00270000
002800******************************************************************00280000
002900 ENVIRONMENT DIVISION.                                            00290000
003000******************************************************************00300000
003100 CONFIGURATION SECTION.                                           00310000
003200 SOURCE-COMPUTER.        IBM-3090.                                00320000
003300 OBJECT-COMPUTER.        IBM-3090.                                00330000
003400                                                                  00340000
003500 INPUT-OUTPUT SECTION.                                            00350000
003600 FILE-CONTROL.                                                    00360000
003700                                                                  00370000
003800     SELECT PROD-EVENT-FILE                                       00380000
003900         ASSIGN TO INP01.                                         00390000
004000                                                                  00400000
004100     SELECT CONTROL-FILE                                          00410000
004200         ASSIGN TO INP02.                                         00420000
004300                                                                  00430000
004400     SELECT USER-ID-FILTER-FILE                                   00440000
004500         ASSIGN TO INP03.                                         00450000
004600                                                                  00460000
004700     SELECT TEST-EVENT-OUT-FILE                                   00470000
004800         ASSIGN TO OUT01.                                         00480000
004900                                                                  00490000
005000******************************************************************00500000
005100 DATA DIVISION.                                                   00510000
005200******************************************************************00520000
005300                                                                  00530000
005400 FILE SECTION.                                                    00540000
005500                                                                  00550000
005600 FD  PROD-EVENT-FILE                                              00560000
005700     RECORDING MODE IS F                                          00570000
005800     LABEL RECORDS ARE STANDARD                                   00580000
005900     RECORD CONTAINS 513                                          00590000
006000     BLOCK CONTAINS 0 RECORDS                                     00600000
006100     DATA RECORD IS PROD-EVENT-RECORD.                            00610003
006200                                                                  00620000
006300 01  PROD-EVENT-RECORD         PIC  X(513).                       00630000
006400                                                                  00640000
006500 FD  CONTROL-FILE                                                 00650000
006600     RECORDING MODE IS F                                          00660000
006700     LABEL RECORDS ARE STANDARD                                   00670000
006800     RECORD CONTAINS 80                                           00680000
006900     BLOCK CONTAINS 0 RECORDS                                     00690000
007000     DATA RECORD IS CONTROL-RECORD.                               00700003
007100                                                                  00710000
007200 01  CONTROL-RECORD            PIC  X(80).                        00720000
007300                                                                  00730000
007400 FD  USER-ID-FILTER-FILE                                          00740000
007500     RECORDING MODE IS F                                          00750000
007600     LABEL RECORDS ARE STANDARD                                   00760000
007700     RECORD CONTAINS 80                                           00770000
007800     BLOCK CONTAINS 0 RECORDS                                     00780000
007900     DATA RECORD IS USER-ID-FILTER-RECORD.                        00790003
008000                                                                  00800000
008100 01  USER-ID-FILTER-RECORD     PIC  X(80).                        00810000
008200                                                                  00820000
008300 FD  TEST-EVENT-OUT-FILE                                          00830000
008400     RECORDING MODE IS F                                          00840000
008500     LABEL RECORDS ARE STANDARD                                   00850000
008600     RECORD CONTAINS 512                                          00860000
008700     BLOCK CONTAINS 0 RECORDS                                     00870000
008800     DATA RECORD IS OUTPUT-RECORD1.                               00880000
008900                                                                  00890000
009000 01  TEST-EVENT-OUT-RECORD     PIC  X(512).                       00900000
009100                                                                  00910000
009200******************************************************************00920000
009300 WORKING-STORAGE SECTION.                                         00930000
009400******************************************************************00940000
009500 01  PS-PROGRAM-SWITCHES.                                         00950000
009600     05  PS-EOF-EVENT-SW              PIC X(01)  VALUE 'N'.       00960000
009700         88  PS-EOF-EVENT                        VALUE 'Y'.       00970000
009800         88  PS-NOT-EOF-EVENT                    VALUE 'N'.       00980000
009900     05  PS-EOF-USER-SW               PIC X(01)  VALUE 'N'.       00990000
010000         88  PS-EOF-USER                         VALUE 'Y'.       01000000
010100         88  PS-NOT-EOF-USER                     VALUE 'N'.       01010000
010200     05  PS-EOF-CONTROL-SW            PIC X(01)  VALUE 'N'.       01020001
010300         88  PS-EOF-CONTROL                      VALUE 'Y'.       01030001
010400         88  PS-NOT-EOF-CONTROL                  VALUE 'N'.       01040001
010410     05  PS-USER-MATCH-SW             PIC X(01)  VALUE 'N'.       01041001
010420         88  PS-USER-MATCHED                     VALUE 'Y'.       01042001
010430         88  PS-USER-NOT-MATCHED                 VALUE 'N'.       01043001
010440         88  PS-USER-MATCH-END                   VALUE 'E'.       01044001
010500     05  PS-OUTPUT-RECORD-TYPE        PIC X(01)  VALUE ' '.       01050000
010600         88  PS-JOB0100-RECORD                   VALUE 'J'.       01060000
010700         88  PS-WMS0102-RECORD                   VALUE 'W'.       01070000
010800         88  PS-EMP0101-RECORD                   VALUE 'E'.       01080000
010900                                                                  01090000
011000 01  IR-PROD-EVENT-RECORD.                                        01100001
011100      05 IR-PROD-EVENT-DATA.                                      01110000
011200         10 IR-PROD-EVENT-DATA-TYPE     PIC X(07).                01120000
011300            88  IR-PROD-EVENT-DATA-JOB0100       VALUE 'JOB0100'. 01130000
011400            88  IR-PROD-EVENT-DATA-EMP0101       VALUE 'EMP0101'. 01140000
011500            88  IR-PROD-EVENT-DATA-WMS0102       VALUE 'WMS0102'. 01150000
011600         10 IR-PROD-EVENT-DATA-REST     PIC X(505).               01160000
011700      05 IR-PROD-EVENT-END              PIC X(01).                01170000
011800                                                                  01180000
011900 01  IR-CONTROL-RECORD.                                           01190001
012000      05 IR-RENUMBER-TRN-NBR-SW         PIC X(01).                01200000
012100         88 IR-RENUMBER-TRN-YES                   VALUE 'Y'.      01210000
012200         88 IR-RENUMBER-TRN-NO                    VALUE 'N'.      01220000
012300      05 FILLER                         PIC X(01) VALUE SPACE.    01230000
012400      05 IR-STARTING-TRN-NBR            PIC 9(09).                01240000
012410      05 FILLER                         PIC X(01) VALUE SPACE.    01241004
012500      05 IR-FILTER-USER-SW              PIC X(01).                01250000
012600         88 IR-FILTER-USER-YES                    VALUE 'Y'.      01260000
012700         88 IR-FILTER-USER-NO                     VALUE 'N'.      01270000
012800      05 FILLER                         PIC X(67) VALUE SPACE.    01280004
012900                                                                  01290000
013000 01  IR-USER-ID-FILTER-RECORD.                                    01300001
013100      05 IR-USER-ID-FILTER              PIC X(08).                01310000
013200      05 FILLER                         PIC X(72) VALUE SPACE.    01320000
013300                                                                  01330000
013400 01  PC-PROGRAM-CONSTANTS.                                        01340000
013500     05  PC-PROGRAM-NAME              PIC X(08) VALUE 'DLKUT991'. 01350000
013600     05  PC-DEFAULT-TMST              PIC X(26) VALUE             01360000
013700                                     '9999-99-99-99.99.99.999999'.01370000
013800     05  PC-A                         PIC X(01) VALUE 'A'.        01380000
013900     05  PC-B                         PIC X(01) VALUE 'B'.        01390000
014000     05  PC-C                         PIC X(01) VALUE 'C'.        01400000
014100     05  PC-I                         PIC X(01) VALUE 'I'.        01410000
014200     05  PC-M                         PIC X(01) VALUE 'M'.        01420000
014300     05  PC-N                         PIC X(01) VALUE 'N'.        01430000
014400     05  PC-S                         PIC X(01) VALUE 'S'.        01440000
014500     05  PC-Y                         PIC X(01) VALUE 'Y'.        01450000
014600                                                                  01460000
014700 01  PV-PROGRAM-VARIABLES.                                        01470000
014800     05  PV-TRAN-NBR                  PIC 9(09)  VALUE ZERO.      01480000
014900     05  PV-RECORDS-PROD-EVENT        PIC 9(09)  VALUE ZERO.      01490000
015000     05  PV-RECORDS-CONTROL           PIC 9(09)  VALUE ZERO.      01500000
015100     05  PV-RECORDS-USER-FILTER       PIC 9(09)  VALUE ZERO.      01510000
015200     05  PV-RECORDS-WRITTEN           PIC 9(09)  VALUE ZERO.      01520000
015201     05  PV-JOB0100-RECORDS-WRITTEN   PIC 9(09)  VALUE ZERO.      01520101
015202     05  PV-WMS0102-RECORDS-WRITTEN   PIC 9(09)  VALUE ZERO.      01520201
015203     05  PV-EMP0101-RECORDS-WRITTEN   PIC 9(09)  VALUE ZERO.      01520301
015210     05  PV-USER-EVENT-MATCHES        PIC 9(09)  VALUE ZERO.      01521001
015220     05  PV-USER-EVENT-NO-MATCHES     PIC 9(09)  VALUE ZERO.      01522001
015300     05  PV-SUB                       PIC S9(04) VALUE 0 COMP.    01530000
015400     05  PV-MAX-SUB                   PIC S9(04)  VALUE 0 COMP.   01540001
015500     05  PV-HOLD-USER-ID              PIC  X(08)  VALUE SPACES.   01550001
015600     05  PV-DISPLAY-NBR-9             PIC ZZZ,ZZZ,ZZ9.            01560005
015700     05  PV-USER-ID-TABLE             OCCURS 100 TIMES.           01570000
015800         10 PV-USER-ID                PIC  X(08)  VALUE SPACES.   01580000
015900         10 PV-USER-ID-REC-COUNT      PIC  9(09)  VALUE ZEROS.    01590000
016000                                                                  01600000
016100 01  PV-ABEND-FIELDS.                                             01610000
016200     05  PV-ABEND-CODE                PIC  S9(4) VALUE +0         01620000
016300                                                 COMP SYNC.       01630000
016400     05  PV-SQLCODE                   PIC  Z(08)9-.               01640000
016500     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    01650000
016600     05  PV-ABEND-OPERATION           PIC  X(50) VALUE SPACES.    01660000
016700     05  PV-ABEND-STRUCTURE-1         PIC  X(08) VALUE SPACES.    01670000
016800     05  PV-ABEND-STRUCTURE-2         PIC  X(08) VALUE SPACES.    01680000
016900     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    01690000
017000     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    01700000
017100     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    01710000
017200     05  PV-DB2-TABLE-NAME            PIC X(12)  VALUE SPACE.     01720000
017300                                                                  01730000
017400******************************************************************01740000
017500*  COPYBOOK DLRD001 (JOB0100 OUTPUT FILE LAYOUT)                  01750000
017600******************************************************************01760000
017700     COPY DLRD001.                                                01770000
017800*                                                                 01780000
017900******************************************************************01790000
018000*  COPYBOOK DLRD002 (WMS0102 OUTPUT FILE LAYOUT)                  01800000
018100******************************************************************01810000
018200     COPY DLRD002.                                                01820000
018300*                                                                 01830000
018400******************************************************************01840000
018500*  COPYBOOK DLRD006 (EMP0101 OUTPUT FILE LAYOUT)                  01850000
018600******************************************************************01860000
018700     COPY DLRD006.                                                01870000
018710*                                                                 01871001
018720******************************************************************01872001
018730*  COPYBOOK DLRD016 (COMBINED LABOR FILE LAYOUT WILL ALL THREE    01873001
018731*                    RECORDS TYPES)                               01873101
018740******************************************************************01874001
018750     COPY DLRD016.                                                01875001
018800*                                                                 01880000
018900******************************************************************01890000
019000 PROCEDURE DIVISION.                                              01900000
019100******************************************************************01910000
019200 0000-PROGRAM-MAINLINE.                                           01920000
019300                                                                  01930000
019400     OPEN INPUT  PROD-EVENT-FILE                                  01940001
019500          INPUT  CONTROL-FILE                                     01950001
019600          INPUT  USER-ID-FILTER-FILE                              01960001
019700          OUTPUT TEST-EVENT-OUT-FILE.                             01970001
019800                                                                  01980000
020100     PERFORM 1000-READ-CONTROL-FILE.                              02010001
020200                                                                  02020001
020300     IF  PS-EOF-CONTROL                                           02030001
020400         DISPLAY '*****************************************'      02040001
020500         DISPLAY '**       PROGRAM DID NOT EXECUTE       **'      02050001
020600         DISPLAY '**       CONTROL FILE WAS EMPTY        **'      02060002
020700         DISPLAY '*****************************************'      02070001
020800         PERFORM 9000-EOJ                                         02080001
021100     END-IF.                                                      02110001
021200                                                                  02120000
021300     IF  IR-RENUMBER-TRN-YES                                      02130001
021400         IF  IR-STARTING-TRN-NBR = ' '                            02140001
021500         OR  IR-STARTING-TRN-NBR = 0                              02150001
021600             DISPLAY '*****************************************'  02160001
021700             DISPLAY '**       PROGRAM DID NOT EXECUTE       **'  02170001
021800             DISPLAY '** STARTING TRAN NUMBER ZERO OR SPACE  **'  02180002
021900             DISPLAY '*****************************************'  02190001
022000             DISPLAY 'STARTING TRAN NUMBER IS:  '                 02200001
022100             DISPLAY IR-STARTING-TRN-NBR                          02210001
022200             PERFORM 9000-EOJ                                     02220001
022300     END-IF.                                                      02230001
022400                                                                  02240001
022500     IF  IR-RENUMBER-TRN-YES                                      02250001
022600         IF  IR-STARTING-TRN-NBR >= 1                             02260001
022700         AND IR-STARTING-TRN-NBR <= 999999999                     02270001
022800             MOVE IR-STARTING-TRN-NBR TO PV-TRAN-NBR              02280001
022900             DISPLAY 'RENUMBER TRAN OPTION IS YES'                02290001
023000             DISPLAY 'STARTING TRAN NUMBER IS:  '                 02300001
023100             DISPLAY IR-STARTING-TRN-NBR                          02310001
023200         ELSE                                                     02320001
023300             DISPLAY '*****************************************'  02330001
023400             DISPLAY '**       PROGRAM DID NOT EXECUTE       **'  02340001
023500             DISPLAY '**   STARTING TRAN NUMBER NOT NUMERIC  **'  02350002
023600             DISPLAY '*****************************************'  02360001
023700             DISPLAY 'STARTING TRAN NUMBER IS:  '                 02370001
023800             DISPLAY IR-STARTING-TRN-NBR                          02380001
023900             PERFORM 9000-EOJ                                     02390001
024000         END-IF                                                   02400001
024100     ELSE                                                         02410001
024200         DISPLAY 'RENUMBER TRAN OPTION IS NO'                     02420001
024300     END-IF.                                                      02430001
024400                                                                  02440001
024500     IF  IR-FILTER-USER-YES                                       02450001
024600         DISPLAY 'USER ID FILTER IS BEING USED'                   02460001
024700         PERFORM 1200-LOAD-USER-ID-TABLE                          02470001
024800     ELSE                                                         02480001
024900         DISPLAY 'USER ID FILTER IS NOT BEING USED'               02490001
025000     END-IF.                                                      02500001
025100                                                                  02510001
025200     PERFORM 8000-READ-PROD-EVENT-FILE.                           02520001
025300                                                                  02530001
025400     PERFORM 2000-PROCESS-EVENT-FILE                              02540001
025500         UNTIL PS-EOF-EVENT.                                      02550001
025600                                                                  02560000
025700     PERFORM 9000-EOJ.                                            02570000
026000                                                                  02600000
026100******************************************************************02610000
026200* READ RECORD FROM THE INPUT CONTROL FILE TO SEE WHAT THE         02620001
026300* PROGRAM ALL NEES TO DO                                          02630001
026400******************************************************************02640000
026500 1000-READ-CONTROL-FILE.                                          02650001
026600                                                                  02660000
026700     READ CONTROL-FILE                                            02670001
026800          INTO IR-CONTROL-RECORD                                  02680003
026900            AT END                                                02690000
027000               SET PS-EOF-CONTROL   TO TRUE                       02700001
027200            NOT AT END                                            02720000
027300               SET PS-NOT-EOF-CONTROL TO TRUE                     02730001
027400               ADD +1 TO PV-RECORDS-CONTROL                       02740001
027500     END-READ.                                                    02750000
027600                                                                  02760000
027700******************************************************************02770001
027800* THIS PARAGRAPH WILL LOAD THE INTERNAL USER ID TABLE WHICH WILL  02780001
027900* BE USED TO LIMIT DATA FROM THE INPUT EVENTS FILE TO BE WRITTEN  02790001
028000* TO THE OUTPUT EVENTS FILE.                                      02800001
028100******************************************************************02810001
028200 1200-LOAD-USER-ID-TABLE.                                         02820001
028300                                                                  02830001
028400     PERFORM 1400-READ-USER-ID-FILE.                              02840001
028500                                                                  02850001
028600     IF  PS-EOF-USER                                              02860001
028700         DISPLAY '*****************************************'      02870001
028800         DISPLAY '**       PROGRAM DID NOT EXECUTE       **'      02880001
028900         DISPLAY '**       USER ID FILE WAS EMPTY        **'      02890002
029000         DISPLAY '*****************************************'      02900001
029100         PERFORM 9000-EOJ                                         02910001
029200     ELSE                                                         02920001
029300         MOVE 1 TO PV-SUB                                         02930001
029400         MOVE IR-USER-ID-FILTER TO PV-USER-ID (PV-SUB)            02940001
029500         MOVE ZEROS TO PV-USER-ID-REC-COUNT (PV-SUB)              02950001
029600         DISPLAY 'USER ID LOADED TO TABLE: ' IR-USER-ID-FILTER    02960001
029700         PERFORM 1300-LOAD-REST-OF-TABLE                          02970001
029800           UNTIL PS-EOF-USER                                      02980001
029900     END-IF.                                                      02990001
030000                                                                  03000001
030100 1300-LOAD-REST-OF-TABLE.                                         03010001
030200                                                                  03020001
030300     PERFORM 1400-READ-USER-ID-FILE.                              03030001
030400                                                                  03040001
030500     IF  PS-EOF-USER                                              03050001
030600         MOVE PV-SUB TO PV-DISPLAY-NBR-9                          03060001
030700         DISPLAY 'USER TABLE LOAD COMPLETE'                       03070001
030800         DISPLAY 'NUMBER OF ENTRIES IS:  ' PV-DISPLAY-NBR-9       03080001
030900         MOVE PV-SUB TO PV-MAX-SUB                                03090001
031000     ELSE                                                         03100001
031100         IF  PV-SUB < 100                                         03110001
031200             ADD +1 TO PV-SUB                                     03120001
031300             MOVE IR-USER-ID-FILTER TO PV-USER-ID (PV-SUB)        03130001
031400             MOVE ZEROS TO PV-USER-ID-REC-COUNT (PV-SUB)          03140001
031500             DISPLAY 'USER ID LOADED TO TABLE: ' IR-USER-ID-FILTER03150001
031600         ELSE                                                     03160001
031700             DISPLAY '*****************************************'  03170001
031800             DISPLAY '**       PROGRAM DID NOT EXECUTE       **'  03180001
031900             DISPLAY '** TRIED TO LOAD MORE THAN 100 USER ID **'  03190002
032000             DISPLAY '*****************************************'  03200001
032100             PERFORM 9000-EOJ                                     03210001
032200         END-IF                                                   03220001
032300     END-IF.                                                      03230001
032400                                                                  03240001
032500 1400-READ-USER-ID-FILE.                                          03250001
032600                                                                  03260001
032700     READ USER-ID-FILTER-FILE                                     03270001
032800          INTO IR-USER-ID-FILTER-RECORD                           03280001
032900            AT END                                                03290001
033000               SET PS-EOF-USER TO TRUE                            03300001
033100            NOT AT END                                            03310001
033200               SET PS-NOT-EOF-USER TO TRUE                        03320001
033300               ADD +1 TO PV-RECORDS-USER-FILTER                   03330001
033400     END-READ.                                                    03340001
033500                                                                  03350001
033600******************************************************************03360000
033700* PROCESS INPUT RECORDS                                          *03370000
033800******************************************************************03380000
033900 2000-PROCESS-EVENT-FILE.                                         03390001
034000                                                                  03400000
034100     IF  IR-PROD-EVENT-DATA-JOB0100                               03410001
034200         MOVE IR-PROD-EVENT-DATA TO DL001-RECORD                  03420001
034300         MOVE DL001-JOB0100-USR-ID TO PV-HOLD-USER-ID             03430001
034310         MOVE DL001-RECORD TO DL016-EXTRACT-RECORD                03431001
034400     ELSE                                                         03440001
034500         IF  IR-PROD-EVENT-DATA-EMP0101                           03450001
034600             MOVE IR-PROD-EVENT-DATA TO DL006-RECORD              03460001
034700             MOVE DL006-EMP0101-USER-ID TO PV-HOLD-USER-ID        03470001
034710             MOVE DL006-RECORD TO DL016-EXTRACT-RECORD            03471001
034800         ELSE                                                     03480001
034900             IF  IR-PROD-EVENT-DATA-WMS0102                       03490001
035000                 MOVE IR-PROD-EVENT-DATA TO DL002-RECORD          03500001
035100                 MOVE DL002-WMS0102-USR-ID TO PV-HOLD-USER-ID     03510001
035101                 MOVE DL002-RECORD TO DL016-EXTRACT-RECORD        03510101
035110             ELSE                                                 03511001
035120                 DISPLAY '***********************************'    03512001
035130                 DISPLAY '**    PROGRAM DID NOT EXECUTE    **'    03513001
035140                 DISPLAY '**   INVALID EVENT RECORD TYPE   **'    03514002
035150                 DISPLAY '***********************************'    03515001
035151                 DISPLAY 'RECORD TYPE ON EVENT:  '                03515101
035152                         IR-PROD-EVENT-DATA-TYPE                  03515201
035160                 PERFORM 9000-EOJ                                 03516001
035170             END-IF                                               03517001
035180         END-IF                                                   03518001
035190     END-IF.                                                      03519001
035200                                                                  03520001
035210     IF  IR-FILTER-USER-YES                                       03521001
035211         MOVE ZERO TO PV-SUB                                      03521101
035212         SET PS-USER-NOT-MATCHED TO TRUE                          03521201
035220         PERFORM 2400-CHECK-USER-MATCH                            03522001
035230           UNTIL PS-USER-MATCHED                                  03523001
035240              OR PS-USER-MATCH-END                                03524001
035241     ELSE                                                         03524101
035242         SET PS-USER-MATCHED TO TRUE                              03524201
035250     END-IF.                                                      03525001
035260                                                                  03526001
035270     IF  PS-USER-MATCHED                                          03527001
035280         IF  IR-RENUMBER-TRN-YES                                  03528001
035290             PERFORM 2800-UPDATE-TRAN-NBR                         03529001
035291             PERFORM 7000-WRITE-OUTPUT                            03529102
035292         ELSE                                                     03529201
035293             PERFORM 7000-WRITE-OUTPUT                            03529302
035294         END-IF                                                   03529401
035295     END-IF.                                                      03529501
046600                                                                  04660000
046610     PERFORM 8000-READ-PROD-EVENT-FILE.                           04661001
046800                                                                  04680000
046810 2400-CHECK-USER-MATCH.                                           04681001
046820                                                                  04682001
046830     ADD +1 TO PV-SUB.                                            04683001
046840                                                                  04684001
046850     IF  PV-HOLD-USER-ID = PV-USER-ID (PV-SUB)                    04685001
046860         ADD +1 TO PV-USER-ID-REC-COUNT (PV-SUB)                  04686001
046861         ADD +1 TO PV-USER-EVENT-MATCHES                          04686101
046870         SET PS-USER-MATCHED TO TRUE                              04687002
046880     ELSE                                                         04688001
046890         IF  PV-SUB = PV-MAX-SUB                                  04689001
046891             SET PS-USER-MATCH-END TO TRUE                        04689101
046892             ADD +1 TO PV-USER-EVENT-NO-MATCHES                   04689201
046893         END-IF                                                   04689301
046894     END-IF.                                                      04689401
046895                                                                  04689501
046896 2800-UPDATE-TRAN-NBR.                                            04689601
046903                                                                  04690301
046904     IF  DL016-WMS0102-REC-TYP                                    04690401
046905         MOVE PV-TRAN-NBR TO DL016-WMS0102-TRANS-NBR              04690501
046906     ELSE                                                         04690601
046907         IF  DL016-JOB0100-REC-TYP                                04690701
046908             MOVE PV-TRAN-NBR TO DL016-JOB0100-TRANS-NBR          04690801
046909         ELSE                                                     04690901
046910             IF  DL016-EMP0101-REC-TYP                            04691001
046911                 MOVE PV-TRAN-NBR TO DL016-EMP0101-TRANS-NBR      04691101
046912             END-IF                                               04691201
046913         END-IF                                                   04691301
046914     END-IF.                                                      04691401
046915                                                                  04691506
046916     IF  PV-TRAN-NBR = 999999999                                  04691606
046917         MOVE +1 TO PV-TRAN-NBR                                   04691706
046918     ELSE                                                         04691806
046919         ADD +1 TO PV-TRAN-NBR                                    04691906
046920     END-IF.                                                      04692006
046921                                                                  04692101
046922****************************************************************  04692201
046923*                                                              *  04692301
046924*                                                              *  04692401
046925****************************************************************  04692501
046930 7000-WRITE-OUTPUT.                                               04693001
340500                                                                  34050000
340510     WRITE TEST-EVENT-OUT-RECORD                                  34051001
340520      FROM DL016-EXTRACT-RECORD.                                  34052001
340530                                                                  34053001
340531     ADD +1 TO PV-RECORDS-WRITTEN.                                34053101
340532                                                                  34053201
340540     IF  DL016-WMS0102-REC-TYP                                    34054001
340550         ADD +1 TO PV-WMS0102-RECORDS-WRITTEN                     34055001
340560     ELSE                                                         34056001
340570         IF  DL016-JOB0100-REC-TYP                                34057001
340580             ADD +1 TO PV-JOB0100-RECORDS-WRITTEN                 34058001
340590         ELSE                                                     34059001
340591             IF  DL016-EMP0101-REC-TYP                            34059101
340592                 ADD +1 TO PV-EMP0101-RECORDS-WRITTEN             34059201
340593             END-IF                                               34059301
340594         END-IF                                                   34059401
340595     END-IF.                                                      34059501
340596                                                                  34059601
340600****************************************************************  34060000
340700*                                                              *  34070000
340800*                                                              *  34080000
340900****************************************************************  34090000
341000 8000-READ-PROD-EVENT-FILE.                                       34100001
341100                                                                  34110000
341200     READ PROD-EVENT-FILE                                         34120001
341300          INTO IR-PROD-EVENT-RECORD                               34130001
341400            AT END                                                34140001
341500               SET PS-EOF-EVENT TO TRUE                           34150001
341600            NOT AT END                                            34160001
341700               SET PS-NOT-EOF-EVENT TO TRUE                       34170001
341800               ADD +1 TO PV-RECORDS-PROD-EVENT                    34180001
341900     END-READ.                                                    34190001
342000                                                                  34200001
349100****************************************************************  34910001
349200*                                                              *  34920001
349210*                                                              *  34921001
349220****************************************************************  34922001
349300 9000-EOJ.                                                        34930000
349500                                                                  34950000
349600     CLOSE PROD-EVENT-FILE                                        34960001
349700           CONTROL-FILE                                           34970001
349800           USER-ID-FILTER-FILE                                    34980001
349900           TEST-EVENT-OUT-FILE.                                   34990001
350000                                                                  35000000
350010     MOVE PV-RECORDS-CONTROL TO PV-DISPLAY-NBR-9.                 35001001
350100     DISPLAY ' RECORDS READ FROM CONTROL FILE:  '                 35010001
350110             PV-DISPLAY-NBR-9.                                    35011001
350120                                                                  35012001
350130     MOVE PV-RECORDS-USER-FILTER TO PV-DISPLAY-NBR-9.             35013001
350140     DISPLAY ' RECORDS READ FROM USER FILE   :  '                 35014001
350150             PV-DISPLAY-NBR-9.                                    35015001
350151                                                                  35015101
350152     MOVE PV-RECORDS-PROD-EVENT TO PV-DISPLAY-NBR-9.              35015201
350153     DISPLAY ' RECORDS READ FROM EVENT FILE  :  '                 35015301
350154             PV-DISPLAY-NBR-9.                                    35015401
350155                                                                  35015501
350156     MOVE PV-JOB0100-RECORDS-WRITTEN TO PV-DISPLAY-NBR-9.         35015601
350157     DISPLAY ' JOB0100 RECORDS WRITTEN       :  '                 35015701
350158             PV-DISPLAY-NBR-9.                                    35015801
350160                                                                  35016001
350170     MOVE PV-WMS0102-RECORDS-WRITTEN TO PV-DISPLAY-NBR-9.         35017001
350180     DISPLAY ' WMS0102 RECORDS WRITTEN       :  '                 35018001
350190             PV-DISPLAY-NBR-9.                                    35019001
350200                                                                  35020001
350300     MOVE PV-EMP0101-RECORDS-WRITTEN TO PV-DISPLAY-NBR-9.         35030001
350400     DISPLAY ' EMP0101 RECORDS WRITTEN       :  '                 35040001
350500             PV-DISPLAY-NBR-9.                                    35050001
350510                                                                  35051001
350520     MOVE PV-RECORDS-WRITTEN TO PV-DISPLAY-NBR-9.                 35052001
350530     DISPLAY ' TOTAL RECORDS WRITTEN         :  '                 35053001
350540             PV-DISPLAY-NBR-9.                                    35054001
350550                                                                  35055001
350551     IF  IR-FILTER-USER-YES                                       35055101
350552         MOVE 1 TO PV-SUB                                         35055201
350560         PERFORM 9100-EOJ-USER-DISPLAY                            35056002
350570           UNTIL PV-SUB > PV-MAX-SUB                              35057001
350571     END-IF.                                                      35057101
350572                                                                  35057207
350573     STOP RUN.                                                    35057307
350580                                                                  35058001
350581 9100-EOJ-USER-DISPLAY.                                           35058101
350582                                                                  35058201
350583     MOVE PV-USER-ID-REC-COUNT (PV-SUB) TO PV-DISPLAY-NBR-9.      35058301
350584     DISPLAY ' RECORDS WRITTEN FOR USER ID:     '                 35058401
350585             PV-USER-ID (PV-SUB) ' IS:  '                         35058501
350586             PV-DISPLAY-NBR-9.                                    35058601
350587     ADD +1 TO PV-SUB.                                            35058701
350590                                                                  35059001
350600                                                                  35060001
