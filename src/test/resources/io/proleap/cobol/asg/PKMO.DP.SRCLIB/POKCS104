000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    POKCS104.                                         00020000
000300 AUTHOR.        DAVE COLOMBO - COMPUWARE.                         00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  06-10-99.                                         00050000
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800*---------------------------------------------------------------* 00080000
000900*    W104 - PO SET SELECTION LIST                               * 00090000
001000*                                                               * 00100000
001100*    THIS PROGRAM GENERATES A LIST OF PO'S BASED ON CRITERIA    * 00110000
001200*    PASSED FROM THE CRITERIA SPEC SCREEN.                      * 00120000
001300*                                                               * 00130000
001400*---------------------------------------------------------------* 00140000
001500* DATE     WHO      DESCRIPTION                                 * 00150080
001600* 08222000 TKMA340  WR21369                                     * 00160081
001700*                   ADD WARNING MESSAGE, F2 CONFIRM, F5 REFRESH * 00170081
001800*                   FOR PO'S WHICH ARE ALREADY HAVE A SEASONAL  * 00180081
001900*                   SET CODE.                                   * 00190081
002000*---------------------------------------------------------------* 00200000
002100* 05/15/02  TKMA609    ADD LOGIC TO BRIDGE DB2 UPDATES TO RMS   * 00210000
002200*                      BY SENDING AN MQ TRIGGER MESSAGE TO THE  * 00220000
002300*                      PO STAGING QUEUE (PO.BRIDGE.TO.RMS.Q).   * 00230000
002400*---------------------------------------------------------------* 00240000
002500* 05/14/03 - S PRABHAKAR RAO, IGSI - WR NO. 24803                 00250000
002600*    - REPLACED DEPARTMENT, CLASS AND 3 DIGIT SEQUENCE NUMBER     00260000
002700*      WITH DEPARTMENT, SUB CLASS, MAJOR CLASS AND SKU NUMBER     00270000
002800*      RESPECTIVELY FOR NI SKU CONVERSION.                        00280000
002900*    - REMOVED VARIABLES DK-CL-NBR-BEG AND DK-CL-NBR-END.         00290000
003000*    - NEW VARIABLES PV-SUB-CL, PV-SUB-CLASS, PV-MAJ-CL,          00300000
003100*      PV-MAJ-CLASS AND PV-SKU-NBR ARE ADDED.                     00310000
003200*    - XLT_SKU AND XLT_VND_STYL TABLES ARE ADDED.                 00320000
003300*---------------------------------------------------------------* 00330000
003400* 11/18/13 - SHEBENA   CHANGE TAG - P5207, CR NO - CHG0081355     00340079
003500*    - MODIFIED THE PROGRAM AS TO COMMENT OUT THE PROGRAM CALL    00350076
003600*      OF POKCS127                                                00360076
003700*                                                                 00370076
003800*---------------------------------------------------------------* 00380076
003900* 11/10/14 - LINDA FRIESS          - CHG0098147                   00390080
004000*    - EXPANDED PO NUMBER TO 9 DIGITS IN MAP AND COMMAREA.        00400080
004100*---------------------------------------------------------------* 00410080
004110* DATE  10/27/2021                                                00411087
004120*            - CHANGE CALL OF 'DPKUT100' TO                       00412087
004130*              CALL DP010I-NUMERIC-EDIT-ROUTINE                   00413087
004140*              MAKING THE CALL DYNAMIC VS STATIC                  00414087
004150*     MADE BY: GERMAN BANDA            WR/IR #: CHG0263126        00415088
004160*                                                                 00416087
004170*-----------------------------------------------------------      00417087
004200 ENVIRONMENT DIVISION.                                            00420000
004300                                                                  00430000
004400 DATA DIVISION.                                                   00440000
004500                                                                  00450000
004600 WORKING-STORAGE SECTION.                                         00460000
004700                                                                  00470000
004800 01  DK-DB2-KEYS.                                                 00480000
004900     05  DK-PO-NBR                      PIC S9(9)   VALUE +0 COMP.00490000
005000     05  DK-STR-NBR                     PIC S9(04)  VALUE +0 COMP.00500000
005100     05  DK-DEPT-NBR                    PIC X(03)   VALUE SPACES. 00510000
005200     05  DK-DMA-NBR                     PIC X(02)   VALUE SPACES. 00520000
005300     05  DK-GMA-NBR                     PIC X(02)   VALUE SPACES. 00530000
005400                                                                  00540000
005500 01  PC-PROGRAM-CONSTANTS.                                        00550000
005600     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00560000
005700                                                    'PO104A  '.   00570000
005800     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00580000
005900                                                    'POKM104 '.   00590000
006000     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00600000
006100                                                    'POKCS104'.   00610000
006200     05  PC-PO027-CS104-PO-TABLE-MAX    PIC S9(04)  VALUE +100    00620000
006300                                                    COMP.         00630000
006400*LENGTH OF NON TABLE FIELDS THAT ARE USED SPECIFICALLY FOR 104    00640000
006500     05  PC-LNGTH-STATIC-102-FLDS       PIC S9(04)  VALUE +9      00650000
006600                                                    COMP.         00660000
006700     05  PC-APPL-MAP                    PIC S9(04)  VALUE  +1     00670000
006800                                                    COMP.         00680000
006900     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00690000
007000     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00700000
007100     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00710000
007200     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +13     00720000
007300                                                    COMP SYNC.    00730000
007400     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00740000
007500                                                    COMP SYNC.    00750000
007600     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00760000
007700                                                    +1000000      00770000
007800                                                    COMP-3.       00780000
007900     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +7      00790000
008000                                                    COMP SYNC.    00800000
008100     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE +3      00810000
008200                                                    COMP-3.       00820000
008300     05  PC-CNT-MINUS-2                 PIC S9(04)  VALUE -2      00830000
008400                                                    COMP SYNC.    00840000
008500     05  PC-CNT-6                       PIC S9(04)  VALUE +6      00850000
008600                                                    COMP SYNC.    00860000
008700     05  PC-CNT-7                       PIC S9(04)  VALUE +7      00870000
008800                                                    COMP SYNC.    00880000
008900     05  PC-ACT                         PIC  X(03)  VALUE 'ACT'.  00890000
009000     05  PC-CMP                         PIC  X(03)  VALUE 'CMP'.  00900000
009100     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    00910000
009200     05  PC-QUOTE                       PIC  X(01)  VALUE X'7D'.  00920000
009300                                                                  00930000
009400                                                                  00940000
009500     05  PC-TSYMSG-NUMBERS.                                       00950000
009600         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00960000
009700         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00970000
009800         10  PC-TSYMSG-00014            PIC  9(05)  VALUE 00014.  00980000
009900         10  PC-TSYMSG-00017            PIC  9(05)  VALUE 00017.  00990000
010000         10  PC-TSYMSG-00045            PIC  9(05)  VALUE 00045.  01000000
010100         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  01010000
010200         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  01020000
010300         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  01030000
010400         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  01040000
010500         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  01050000
010600         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  01060000
010700         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  01070000
010800         10  PC-TSYMSG-00059            PIC  9(05)  VALUE 00059.  01080000
010900         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  01090000
011000         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  01100000
011100         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  01110000
011200         10  PC-TSYMSG-00168            PIC  9(05)  VALUE 00168.  01120000
011300         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01130000
011400         10  PC-TSYMSG-00310            PIC  9(05)  VALUE 00310.  01140000
011500         10  PC-TSYMSG-00331            PIC  9(05)  VALUE 00331.  01150000
011600         10  PC-TSYMSG-00419            PIC  9(05)  VALUE 00419.  01160057
011700         10  PC-TSYMSG-00486            PIC  9(05)  VALUE 00486.  01170000
011800         10  PC-TSYMSG-00587            PIC  9(05)  VALUE 00587.  01180000
011900         10  PC-TSYMSG-00588            PIC  9(05)  VALUE 00588.  01190000
012000         10  PC-TSYMSG-00620            PIC  9(05)  VALUE 00620.  01200000
012100         10  PC-TSYMSG-00621            PIC  9(05)  VALUE 00621.  01210000
012200         10  PC-TSYMSG-02518            PIC  9(05)  VALUE 02518.  01220000
012300         10  PC-TSYMSG-02670            PIC  9(05)  VALUE 02670.  01230000
012400         10  PC-TSYMSG-02671            PIC  9(05)  VALUE 02671.  01240000
012500         10  PC-TSYMSG-03068            PIC  9(05)  VALUE 03068.  01250000
012600         10  PC-TSYMSG-03069            PIC  9(05)  VALUE 03069.  01260000
012700         10  PC-TSYMSG-03070            PIC  9(05)  VALUE 03070.  01270000
012800         10  PC-TSYMSG-03071            PIC  9(05)  VALUE 03071.  01280000
012900         10  PC-TSYMSG-03072            PIC  9(05)  VALUE 03072.  01290000
013000         10  PC-TSYMSG-03073            PIC  9(05)  VALUE 03073.  01300000
013100         10  PC-TSYMSG-03081            PIC  9(05)  VALUE 03081.  01310057
013200         10  PC-TSYMSG-03494            PIC  9(05)  VALUE 03494.  01320070
013300                                                                  01330000
013400 01  PS-PROGRAM-SWITCHES.                                         01340000
013500     05  PS-PURITM-SW                   PIC  X(01)  VALUE 'Y'.    01350000
013600         88  PS-206-PURITM                          VALUE 'Y'.    01360000
013700         88  PS-000-PURITM                          VALUE 'N'.    01370000
013800     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01380000
013900         88  PS-NO-ERROR                            VALUE 'Y'.    01390000
014000         88  PS-ERROR                               VALUE 'N'.    01400000
014100     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01410000
014200         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01420000
014300         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01430000
014400     05  PS-SKIP-SW                     PIC  X(01)  VALUE 'N'.    01440000
014500         88  PS-DONT-SKIP                           VALUE 'N'.    01450000
014600         88  PS-SKIP                                VALUE 'Y'.    01460000
014700     05  PS-TPURITM-SW                  PIC  X(01)  VALUE 'N'.    01470000
014800         88  PS-DONT-USE-TPURITM                    VALUE 'N'.    01480000
014900         88  PS-USE-TPURITM                         VALUE 'Y'.    01490000
015000     05  PS-TENTNME-SW                  PIC  X(01)  VALUE 'N'.    01500000
015100         88  PS-DONT-USE-TENTNME                    VALUE 'N'.    01510000
015200         88  PS-USE-TENTNME                         VALUE 'Y'.    01520000
015300     05  PS-PROCESS-SELECTION-SW        PIC  X(01)  VALUE 'N'.    01530000
015400         88  PS-EDIT-SELECTION                      VALUE 'N'.    01540000
015500         88  PS-ADD-SELECTION                       VALUE 'Y'.    01550000
015600         88  PS-CHECK-SELECTION                     VALUE 'C'.    01560000
015610     05  PS-RACF-FUNC-SW                PIC  X(01)  VALUE 'N'.    01561083
015620         88  PS-RACF-FUNC-NO                        VALUE 'N'.    01562083
015630         88  PS-RACF-FUNC-YES                       VALUE 'Y'.    01563083
015700                                                                  01570000
015800 01  PV-PROGRAM-VARIABLES.                                        01580000
015900     05  PV-HOLD-CC                     PIC X(02).                01590000
016000     05  PV-SUB                         PIC S9(04)  VALUE +0      01600000
016100                                                    COMP SYNC.    01610000
016200     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01620000
016300                                                    COMP SYNC.    01630000
016400     05  PV-SELECT-BYTES                PIC S9(04)  VALUE +78     01640000
016500                                                    COMP SYNC.    01650000
016600     05  PV-STRING-POINTER-FROM         PIC S9(04)  VALUE +0      01660000
016700                                                    COMP   SYNC.  01670000
016800     05  PV-STRING-POINTER-WHERE        PIC S9(04)  VALUE +0      01680000
016900                                                    COMP   SYNC.  01690000
017000     05  PV-TALLY-1                     PIC S9(04)  VALUE +0      01700000
017100                                                    COMP   SYNC.  01710000
017200     05  PV-TALLY-2                     PIC S9(04)  VALUE +0      01720000
017300                                                    COMP   SYNC.  01730000
017400     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01740000
017500                                                    COMP-3.       01750000
017600     05  PV-COUNT-ITEMS-READ            PIC S9(09)  VALUE +0      01760000
017700                                                    COMP-3.       01770000
017800     05  PV-COUNT-ITEMS-SELECTED        PIC S9(09)  VALUE +0      01780000
017900                                                    COMP-3.       01790000
018000     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01800000
018100                                                    COMP-3.       01810000
018200     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01820000
018300                                                    COMP-3.       01830000
018400     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01840000
018500                                                    COMP-3.       01850000
018600     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01860000
018700                                                    COMP-3.       01870000
018800     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01880000
018900                                                    COMP-3.       01890000
019000     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01900000
019100                                                    COMP-3.       01910000
019200     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01920000
019300                                                    COMP SYNC.    01930000
019400     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01940000
019500                                                    COMP SYNC.    01950000
019600     05  PV-ITEM                        PIC S9(04)  VALUE +0      01960000
019700                                                    COMP SYNC.    01970000
019800     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01980000
019900                                                    COMP SYNC.    01990000
020000     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      02000000
020100                                                    COMP SYNC.    02010000
020200     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      02020000
020300                                                    COMP SYNC.    02030000
020400     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      02040000
020500                                                    COMP SYNC.    02050000
020600     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      02060000
020700                                                    COMP SYNC.    02070000
020800     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      02080000
020900                                                    COMP SYNC.    02090000
021000     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      02100000
021100                                                    COMP SYNC.    02110000
021200     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      02120000
021300                                                    COMP SYNC.    02130000
021400     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      02140000
021500                                                    COMP SYNC.    02150000
021600     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      02160000
021700                                                    COMP SYNC.    02170000
021800     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      02180000
021900                                                    COMP SYNC.    02190000
022000     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      02200000
022100                                                    COMP SYNC.    02210000
022200                                                                  02220000
022300     05  PV-NULL-IND                    PIC S9(04)  VALUE +0 COMP.02230000
022400                                                                  02240000
022500     05  PV-DB2-COUNT                   PIC S9(09)  VALUE +0      02250000
022600                                                    COMP-3.       02260000
022700     05  PV-DB2-COUNT2                  PIC S9(09)  VALUE +0      02270000
022800                                                    COMP-3.       02280000
022900     05  PV-DB2-DATE                    PIC  X(10).               02290000
023000     05  FILLER  REDEFINES PV-DB2-DATE.                           02300000
023100         10  PV-DB2-DATE-CC             PIC  X(02).               02310000
023200         10  PV-DB2-DATE-YY             PIC  X(02).               02320000
023300         10  FILLER                     PIC  X(01).               02330000
023400         10  PV-DB2-DATE-MM             PIC  X(02).               02340000
023500         10  FILLER                     PIC  X(01).               02350000
023600         10  PV-DB2-DATE-DD             PIC  X(02).               02360000
023700     05  PV-DISPLAY-DATE.                                         02370000
023800         10  PV-DISPLAY-DATE-MM         PIC  X(02).               02380000
023900         10  FILLER                     PIC  X(01) VALUE '/'.     02390000
024000         10  PV-DISPLAY-DATE-DD         PIC  X(02).               02400000
024100         10  FILLER                     PIC  X(01) VALUE '/'.     02410000
024200         10  PV-DISPLAY-DATE-YY         PIC  X(02).               02420000
024300     05  PV-DONT-SHIP-BEF-DTE           PIC  X(08).               02430000
024400     05  PV-CAN-IFNOT-SHIP-DTE          PIC  X(08).               02440000
024500     05  PV-AD-EVNT-DTE                 PIC  X(08).               02450073
024600     05  PV-LAST-UPD-TMESTMP            PIC  X(26).               02460000
024700                                                                  02470000
024800     05  PV-PCT-AREA                    PIC S9(04)V999            02480000
024900                                                      COMP-3.     02490000
025000                                                                  02500000
025100     05  PV-TABLE-QUALIFIER.                                      02510000
025200         10 FILLER                      PIC X(03) VALUE 'DB2'.    02520000
025300         10 PV-QUALIFIER                PIC X(01) VALUE ' '.      02530062
025400         10 FILLER                      PIC X(03) VALUE 'DBA'.    02540000
025500         10 FILLER                      PIC X(01) VALUE '.'.      02550000
025600                                                                  02560000
025700     05  PV-TABLE-QUALIFIER-COMMA.                                02570000
025800         10 FILLER                      PIC X(04) VALUE ',DB2'.   02580000
025900         10 PV-QUALIFIER-COMMA          PIC X(01) VALUE ' '.      02590062
026000         10 FILLER                      PIC X(03) VALUE 'DBA'.    02600000
026100         10 FILLER                      PIC X(01) VALUE '.'.      02610000
026200                                                                  02620000
026300     05  PV-IMPRT-AGNT-PO-NBR           PIC 9(09) VALUE ZEROS.    02630000
026400     05  PV-PO-NBR                      PIC 9(09) VALUE ZEROS.    02640000
026500     05  PV-PO-NBR-B                    PIC S9(09) VALUE +0       02650000
026600                                                  COMP.           02660000
026700     05  PV-ENT-NAME-DESC               PIC X(32) VALUE SPACES.   02670000
026800     05  PV-VEND-STYL-NME               PIC X(22) VALUE SPACES.   02680000
026900                                                                  02690000
027000     05  PV-SYSTEM-ID.                                            02700000
027100         10  FILLER                     PIC  X(04)  VALUE SPACE.  02710000
027200         10  PV-REGION-IND              PIC  X(01).               02720000
027300             88  PV-TEST-CICS                 VALUE 'T'.          02730000
027400             88  PV-QA-CICS                   VALUE 'Q'.          02740000
027500             88  PV-PROD-CICS                 VALUE 'P'.          02750000
027600             88  PV-LEARN-CICS                VALUE 'L'.          02760000
027700         10  FILLER                     PIC X(01)    VALUE SPACES.02770000
027800     05  FILLER                         PIC X(02)    VALUE SPACES.02780000
027900                                                                  02790000
028000     05  PV-MSG-TEXT                    PIC  ZZZZ9  VALUE ZEROES. 02800000
028100     05  PV-ERROR-MESSAGE-AREA.                                   02810000
028200         10  PV-ERROR-MSG-1.                                      02820000
028300             15  FILLER                 PIC X(21)    VALUE        02830000
028400                 'UNSUCCESSFUL CALL TO '.                         02840000
028500             15  PV-ERROR-PGM-NAME      PIC X(08).                02850000
028600             15  FILLER                 PIC X(11)    VALUE        02860000
028700                 ' IN PARA:  '.                                   02870000
028800             15  PV-ERROR-PARA-NAME     PIC X(30).                02880000
028900         10  PV-ERROR-MSG-2.                                      02890000
029000             15  PV-ERROR-MESSAGE       PIC X(57).                02900000
029100         10  PV-ERROR-MSG-3.                                      02910000
029200             15  PV-ERROR-TYPE          PIC X(15).                02920000
029300             15  PV-OPTIONAL-TEXT       PIC X(10).                02930000
029400             15  PV-ERROR-REASON        PIC X(30).                02940000
029500     05 PV-SUB-CL.                                                02950000
029600         10 FILLER                      PIC 9(02)   VALUE ZERO.   02960000
029700         10 PV-SUB-CL-3-4               PIC 9(02).                02970000
029800     05 PV-SUB-CLASS REDEFINES PV-SUB-CL  PIC 9(04).              02980000
029900     05 PV-MAJ-CL.                                                02990000
030000         10 FILLER                      PIC 9(02)   VALUE ZERO.   03000000
030100         10 PV-MAJ-CL-3-4.                                        03010055
030200           15 PV-MAJ-CL-3               PIC 9.                    03020055
030300           15 FILLER                    PIC 9      VALUE ZERO.    03030055
030400         10 PV-MJ-CL REDEFINES PV-MAJ-CL-3-4                      03040055
030500                                        PIC 9(02).                03050055
030600     05 PV-MAJ-CLASS REDEFINES PV-MAJ-CL                          03060000
030700                                        PIC 9(04).                03070000
030800     05 PV-SKU-NBR                      PIC 9(08)   VALUE ZERO.   03080000
030900*---------------------------------------------------------------* 03090000
031000*  WORKING STORAGE AREA USED TO BUILD SQL STATEMENTS            * 03100000
031100*---------------------------------------------------------------* 03110000
031200                                                                  03120000
031300 01  PV-SQL-STMT.                                                 03130000
031400     49  PV-SQL-STMT-LEN                PIC S9(04)  COMP  VALUE 0.03140000
031500*        SELECT 078 LENGTH PLUS                                   03150000
031600*        FROM   100 LENGTH PLUS  (MAX)                            03160000
031700*        WHERE 1100 LENGTH       (MAX)                            03170000
031800     49  PV-SQL-STMT-TEXT               PIC X(1600)  VALUE SPACES.03180000
031900                                                                  03190000
032000 01  PV-BUILD-SELECT-REC.                                         03200000
032100     05  PV-BUILD-SELECT-LEN            PIC S9(04)  COMP  VALUE 0 03210000
032200                                                          SYNC.   03220000
032300     05  PV-BUILD-SELECT-STMT.                                    03230000
032400         10  FILLER                     PIC  X(07)                03240000
032500                         VALUE 'SELECT '.                         03250000
032600         10  FILLER                     PIC  X(09)                03260000
032700                         VALUE 'DISTINCT '.                       03270000
032800         10  FILLER                     PIC  X(08)                03280000
032900                         VALUE 'A.PO_NBR'.                        03290000
033000         10  FILLER                     PIC  X(14)                03300000
033100                         VALUE ',A.OTB_PER_NBR'.                  03310000
033200         10  FILLER                     PIC  X(11)                03320000
033300                         VALUE ',A.DEPT_NBR'.                     03330000
033400         10  FILLER                     PIC  X(09)                03340000
033500                         VALUE ',A.ENT_ID'.                       03350000
033600         10  FILLER                     PIC  X(20)                03360000
033700                         VALUE ',C.DONT_SHIP_BEF_DTE'.            03370000
033800     05  PV-FROM-CLAUSE.                                          03380000
033900         10  FILLER                     PIC  X(250).              03390060
034000                                                                  03400000
034100     05  PV-WHERE-CLAUSE.                                         03410000
034200         10  FILLER                     PIC  X(1200).             03420060
034300                                                                  03430000
034400*---------------------------------------------------------------* 03440000
034500*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   * 03450000
034600*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           * 03460000
034700*   APPLICATION-SPECIFIC COMMAREA.                              * 03470000
034800*---------------------------------------------------------------* 03480000
034900 01  LQW-LIST-QUEUE-WORK-AREA.                                    03490000
035000     05  LQW-BLOCK-MODIFIED             PIC X(01)   VALUE SPACE.  03500000
035100     05  LQW-ITEM-ENTRIES               OCCURS 13 TIMES           03510000
035200                                        INDEXED BY LQW-IDX.       03520000
035300         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       03530000
035400         10  LQW-TEMP-SELECTED-SW       PIC X(01).                03540000
035500         10  LQW-SELECTED-SW            PIC X(01).                03550000
035600             88  LQW-SELECT                         VALUE 'S'.    03560000
035700             88  LQW-DESELECT                       VALUE ' '.    03570000
035800         10  LQW-PO-NBR                 PIC 9(09).                03580080
035900         10  LQW-DEPT-NBR               PIC X(03).                03590000
036000         10  LQW-VENDOR-NAME            PIC X(10).                03600000
036100         10  LQW-STATUS                 PIC X(02).                03610000
036200         10  LQW-OTB                    PIC X(04).                03620000
036300         10  LQW-SHIP-DATE              PIC X(08).                03630000
036400         10  LQW-CANCEL-DATE            PIC X(08).                03640000
036500         10  LQW-TOT-UNIT-ORDERED       PIC 9(07).                03650000
036600         10  LQW-SHRT-NM                PIC X(05).                03660000
036700         10  LQW-AD-EVNT-DATE           PIC X(08).                03670073
036800         10  LQW-IP-IND                 PIC X(01).                03680000
036900                                                                  03690000
037000                                                                  03700081
037010*----------------------------------------------------------------*03701081
037020**  SECURITY SUBROUTINE PARAMETERS                                03702081
037030*----------------------------------------------------------------*03703081
037040     COPY DPWS008.                                                03704081
037050                                                                  03705081
037060                                                                  03706081
037100*---------------------------------------------------------------* 03710000
037200*    MAP LAYOUT                                                 * 03720000
037300*---------------------------------------------------------------* 03730000
037400                                                                  03740000
037500     COPY POKM104.                                                03750000
037600                                                                  03760000
037700 01  MR-OCCURS-LAYOUT                   REDEFINES  PO104AO.       03770000
037800     05  FILLER                         PIC X(67).                03780000
037900                                                                  03790000
038000     05  MR-SCROLL-AREA                 OCCURS 13 TIMES.          03800000
038100         10  MR-SELECTL                 PIC S9(04) COMP.          03810000
038200         10  MR-SELECTA                 PIC X(01).                03820000
038300         10  MR-SELECTC                 PIC X(01).                03830000
038400         10  MR-SELECTH                 PIC X(01).                03840000
038500         10  MR-SELECT                  PIC X(01).                03850000
038600                                                                  03860000
038700         10  MR-PO-NBRL                 PIC S9(04) COMP.          03870000
038800         10  MR-PO-NBRA                 PIC X(01).                03880000
038900         10  MR-PO-NBRC                 PIC X(01).                03890000
039000         10  MR-PO-NBRH                 PIC X(01).                03900000
039100         10  MR-PO-NBR-X.                                         03910000
039200             15  MR-PO-NBR              PIC ZZZZZZZZZ.            03920080
039300                                                                  03930000
039400         10  FILLER                     PIC X(05).                03940000
039500         10  MR-DEPT-NBR                PIC X(03).                03950000
039600                                                                  03960000
039700         10  FILLER                     PIC X(05).                03970000
039800         10  MR-VENDOR-NAME             PIC X(10).                03980000
039900                                                                  03990000
040000         10  FILLER                     PIC X(05).                04000000
040100         10  MR-STATUS                  PIC X(02).                04010000
040200                                                                  04020000
040300         10  FILLER                     PIC X(05).                04030000
040400         10  MR-AD-DATE                 PIC X(08).                04040071
040500                                                                  04050000
040600         10  FILLER                     PIC X(05).                04060000
040700         10  MR-SHIP-DATE               PIC X(08).                04070000
040800                                                                  04080000
040900         10  FILLER                     PIC X(05).                04090000
041000         10  MR-CANCEL-DATE             PIC X(08).                04100000
041100                                                                  04110000
041200         10  FILLER                     PIC X(05).                04120000
041300         10  MR-UNITS-ORDERED-X.                                  04130000
041400             15  MR-UNITS-ORDERED       PIC ZZZZZZ9.              04140000
041500                                                                  04150000
041600         10  FILLER                     PIC X(05).                04160000
041700         10  MR-SHRT-NM                 PIC X(05).                04170000
041800                                                                  04180000
041900     05  FILLER                         PIC X(05).                04190000
042000     05  MR-UNITS-ORDERED-TOT           PIC ZZZZZZ9.              04200000
042100                                                                  04210000
042200 EJECT                                                            04220000
042300*---------------------------------------------------------------* 04230000
042400*    ATTRIBUTE SETTINGS COPYBOOK.                               * 04240000
042500*---------------------------------------------------------------* 04250000
042600                                                                  04260000
042700     COPY DPWS015.                                                04270000
042800                                                                  04280000
042900*---------------------------------------------------------------* 04290000
043000*    FUNCTION KEYS COPYBOOK.                                    * 04300000
043100*---------------------------------------------------------------* 04310000
043200                                                                  04320000
043300     COPY DPWS016.                                                04330000
043400                                                                  04340000
043500*---------------------------------------------------------------* 04350000
043600*    NUMERIC EDIT LAYOUT.                                       * 04360000
043700*---------------------------------------------------------------* 04370000
043800                                                                  04380000
043900     COPY DPWS010I.                                               04390000
044000                                                                  04400000
044100 EJECT                                                            04410000
044200*---------------------------------------------------------------* 04420000
044300*    PARAMETERS FOR CALLING CICS ARCHITECTURE API.              * 04430091
044400*---------------------------------------------------------------* 04440000
044500                                                                  04450000
044600     COPY DPWS030.                                                04460000
044610     COPY DPWS930.                                                04461091
044700                                                                  04470000
044800 EJECT                                                            04480000
044900*---------------------------------------------------------------* 04490000
045000*    STANDARD COMMAREA.                                         * 04500000
045100*---------------------------------------------------------------* 04510000
045200                                                                  04520000
045300     COPY DPWS020.                                                04530000
045400     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                04540000
045500                                                                  04550000
045600*---------------------------------------------------------------* 04560000
045700* INTER-APPLICATION COMMAREA.                                   * 04570000
045800*---------------------------------------------------------------* 04580000
045900                                                                  04590000
046000         10  INTER-APPL-COMM-AREA       PIC X(200).               04600000
046100                                                                  04610000
046200     COPY POWS079.                                                04620063
046300*---------------------------------------------------------------* 04630000
046400*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 04640000
046500*---------------------------------------------------------------* 04650000
046600         10  ASC-SPECIFIC-COMMAREA.                               04660000
046700             15  ASC-LIST-KEYS.                                   04670000
046800                 20  ASC-KEY-PO-NBR       PIC S9(9) COMP.         04680000
046900                 20  ASC-KEY-IMPRT-AGNT-PO-NBR                    04690000
047000                                          PIC S9(9) COMP.         04700000
047100                 20  ASC-KEY-DEPT-NBR     PIC X(3).               04710000
047200                 20  ASC-KEY-MAJ-CL-NBR   PIC 9(4).               04720000
047300                 20  ASC-KEY-SUB-CL-NBR   PIC 9(4).               04730000
047400                 20  ASC-KEY-SKU-NBR      PIC 9(8).               04740000
047500                 20  ASC-KEY-STATUS-CDE   PIC X(2).               04750000
047600                 20  ASC-KEY-STATUS-CLS   PIC X(3).               04760000
047700                 20  ASC-KEY-PO-TYP-CDE   PIC X(2).               04770000
047800                 20  ASC-KEY-STR-NBR      PIC S9(04) COMP.        04780000
047900                 20  ASC-KEY-NEW-STR-IND       PIC X(1).          04790000
048000                 20  ASC-KEY-PACK-BY-STORE-IND PIC X(1).          04800000
048100                 20  ASC-KEY-AD-EVNT-DTE  PIC X(10).              04810000
048200                 20  ASC-KEY-OTB-PER-NBR-BEG PIC X(06).           04820000
048300                 20  ASC-KEY-OTB-PER-NBR-END PIC X(06).           04830000
048400                 20  ASC-KEY-DONT-SHIP-BEF-DTE-B                  04840000
048500                                             PIC X(10).           04850000
048600                 20  ASC-KEY-DONT-SHIP-BEF-DTE-E                  04860000
048700                                             PIC X(10).           04870000
048800                 20  ASC-KEY-ENT-NAME-DESC   PIC X(30).           04880000
048900                 20  ASC-KEY-VEND-STYL-NME   PIC X(20).           04890000
049000             15  ASC-BLOCK-ENTRIES      OCCURS 2 TIMES.           04900000
049100                 20  ASC-BLOCK-MODIFIED-SW                        04910000
049200                                        PIC X(01).                04920000
049300                     88  ASC-BLOCK-NOT-MODIFIED    VALUE 'N'.     04930000
049400                     88  ASC-BLOCK-MODIFIED        VALUE 'Y'.     04940000
049500                                                                  04950000
049600                 20  ASC-ITEM-ARRAY.                              04960000
049700                     25  ASC-ITEM-ENTRIES OCCURS 13 TIMES.        04970000
049800                         30  ASC-LIST-ITEM-NUMBER                 04980000
049900                                        PIC S9(09) COMP-3.        04990000
050000                         30  ASC-TEMP-SELECTED-SW                 05000000
050100                                        PIC X(01).                05010000
050200                             88  ASC-VALID-SELECT  VALUE ' '      05020000
050300                                                         'S'      05030000
050400                                                         'B'      05040000
050500                                                         'E'.     05050000
050600                             88  ASC-TEMP-NO-SELECT               05060000
050700                                                   VALUE ' '.     05070000
050800                             88  ASC-TEMP-SELECT   VALUE 'S'.     05080000
050900                             88  ASC-TEMP-BEGIN    VALUE 'B'.     05090000
051000                             88  ASC-TEMP-END      VALUE 'E'.     05100000
051100                         30  ASC-SELECTED-SW                      05110000
051200                                        PIC X(01).                05120000
051300                             88  ASC-NO-SELECT     VALUE ' '.     05130000
051400                             88  ASC-SELECT        VALUE 'S'.     05140000
051500                             88  ASC-BEGIN         VALUE 'B'.     05150000
051600                             88  ASC-END           VALUE 'E'.     05160000
051700                         30  ASC-PO-NBR            PIC 9(09).     05170080
051800                         30  ASC-DEPT-NBR          PIC X(03).     05180000
051900                         30  ASC-VENDOR-NAME       PIC X(10).     05190000
052000                         30  ASC-STATUS            PIC X(02).     05200000
052100                         30  ASC-OTB               PIC X(04).     05210000
052200                         30  ASC-SHIP-DATE         PIC X(08).     05220000
052300                         30  ASC-CANCEL-DATE       PIC X(08).     05230000
052400                         30  ASC-TOT-UNIT-ORDERED  PIC 9(07).     05240000
052500                         30  ASC-SHRT-NM           PIC X(05).     05250000
052600                         30  ASC-AD-EVNT-DTE       PIC X(08).     05260073
052700                         30  ASC-IP-IND            PIC X(01).     05270000
052800                                                                  05280000
052900             15  ASC-BLK-SUB            PIC S9(04) COMP SYNC.     05290000
053000             15  ASC-ITEM-SUB           PIC S9(04) COMP SYNC.     05300000
053100             15  ASC-NUMBER-OF-ITEMS-READ                         05310000
053200                                        PIC S9(09) COMP-3.        05320000
053300             15  ASC-NUMBER-OF-SELECTED-ITEMS                     05330000
053400                                        PIC S9(09) COMP-3.        05340000
053500             15  ASC-ITEMS-DISPLAYED    PIC S9(03) COMP-3.        05350000
053600             15  ASC-ITEM-AT-TOP-OF-PANEL                         05360000
053700                                        PIC S9(09) COMP-3.        05370000
053800             15  ASC-ITEM-AT-BOT-OF-PANEL                         05380000
053900                                        PIC S9(09) COMP-3.        05390000
054000             15  ASC-HIGHEST-BLOCK-WRITTEN                        05400000
054100                                        PIC S9(04) COMP SYNC.     05410000
054200             15  ASC-START-OF-SELECTED-RANGE                      05420000
054300                                        PIC S9(09) COMP-3.        05430000
054400             15  ASC-END-OF-SELECTED-RANGE                        05440000
054500                                        PIC S9(09) COMP-3.        05450000
054600             15  ASC-ITEMS-LEFT-INDICATOR                         05460000
054700                                        PIC X(01).                05470000
054800                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     05480000
054900                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     05490000
055000             15  ASC-LIST-QUEUE-NAME.                             05500000
055100                 20  ASC-LIST-TERM-ID   PIC X(04).                05510000
055200                 20  ASC-LIST-TASK-NUMBER                         05520000
055300                                        PIC S9(05) COMP-3.        05530000
055400                 20  ASC-LIST-SEQ       PIC 9(01).                05540000
055500                                                                  05550000
055600             15  ASC-START-ITEM-REQUEST.                          05560000
055700                 20  ASC-START-ITEM-REQUEST-N                     05570000
055800                                        PIC 9(07).                05580000
055900             15  ASC-UNIT-ORD-TOT       PIC S9(08).               05590000
056000             15  ASC-SET-FIELDS.                                  05600000
056100                 20  ASC-SET-YEAR       PIC X(04).                05610000
056200                 20  ASC-SET-SHORT-NME  PIC X(05).                05620000
056300             15  ASC-CONFIRM-SWITCH        PIC X.                 05630000
056400                 88  ASC-CONFIRM           VALUE 'Y'.             05640000
056500                 88  ASC-NOT-CONFIRM       VALUE 'N'.             05650000
056600             15  ASC-CONTINUE-SWITCH       PIC X.                 05660000
056700                 88  ASC-CONTINUE-UPDT     VALUE 'Y'.             05670000
056800                 88  ASC-NOT-CONTINUE-UPDT VALUE 'N'.             05680000
056900 EJECT                                                            05690000
057000*---------------------------------------------------------------* 05700000
057100*    ABEND PROCESSING COPYBOOK.                                 * 05710000
057200*---------------------------------------------------------------* 05720000
057300                                                                  05730000
057400     COPY DPWS013.                                                05740000
057500                                                                  05750000
057600 EJECT                                                            05760000
057700*---------------------------------------------------------------* 05770000
057800*    DB2 AREA FOR THE PURCHASE ORDER TABLE                      * 05780000
057900*---------------------------------------------------------------* 05790000
058000     EXEC SQL                                                     05800000
058100          INCLUDE TPURCHS                                         05810000
058200     END-EXEC.                                                    05820000
058300                                                                  05830000
058400 EJECT                                                            05840000
058500*---------------------------------------------------------------* 05850000
058600*    DB2 AREA FOR THE PURCHASE ORDER LINE ITEM TABLE            * 05860000
058700*---------------------------------------------------------------* 05870000
058800     EXEC SQL                                                     05880000
058900          INCLUDE TPURITM                                         05890000
059000     END-EXEC.                                                    05900000
059100                                                                  05910000
059200 EJECT                                                            05920000
059300*---------------------------------------------------------------* 05930000
059400*    DB2 AREA FOR THE PLANNED SHIPMENTS TABLE                   * 05940000
059500*---------------------------------------------------------------* 05950000
059600     EXEC SQL                                                     05960000
059700          INCLUDE TPLNSHP                                         05970000
059800     END-EXEC.                                                    05980000
059900                                                                  05990000
060000 EJECT                                                            06000000
060100*---------------------------------------------------------------* 06010000
060200*    DB2 AREA FOR THE ENTERPRISE NAME TABLE                     * 06020000
060300*---------------------------------------------------------------* 06030000
060400     EXEC SQL                                                     06040000
060500          INCLUDE TENTNME                                         06050000
060600     END-EXEC.                                                    06060000
060700                                                                  06070000
060800 EJECT                                                            06080000
060900*---------------------------------------------------------------* 06090000
061000*    DB2 AREA FOR THE MERCHANDISE STORE DISTRIBUTION            * 06100000
061100*---------------------------------------------------------------* 06110000
061200     EXEC SQL                                                     06120000
061300          INCLUDE TMESTDS                                         06130000
061400     END-EXEC.                                                    06140000
061500                                                                  06150000
061600 EJECT                                                            06160000
061700*---------------------------------------------------------------* 06170000
061800*    DB2 AREA FOR THE STATUS CODE TABLE                         * 06180000
061900*---------------------------------------------------------------* 06190000
062000     EXEC SQL                                                     06200000
062100          INCLUDE TSTATCD                                         06210000
062200     END-EXEC.                                                    06220000
062300                                                                  06230000
062400 EJECT                                                            06240000
062500*---------------------------------------------------------------* 06250000
062600*    DB2 AREA FOR THE TYPE CODE TABLE                           * 06260000
062700*---------------------------------------------------------------* 06270000
062800     EXEC SQL                                                     06280000
062900          INCLUDE TPOTYCD                                         06290000
063000     END-EXEC.                                                    06300000
063100                                                                  06310000
063200 EJECT                                                            06320000
063300*---------------------------------------------------------------* 06330000
063400*    DB2 AREA FOR THE MERCHANDISING LOCATION TABLE              * 06340063
063500*---------------------------------------------------------------* 06350000
063600     EXEC SQL                                                     06360000
063700          INCLUDE XMT00001                                        06370063
063800     END-EXEC.                                                    06380000
063900                                                                  06390000
064000 EJECT                                                            06400000
064100*---------------------------------------------------------------* 06410000
064200*    DB2 AREA FOR THE RECEIVING TABLE                          *  06420000
064300*---------------------------------------------------------------* 06430000
064400                                                                  06440000
064500     EXEC SQL                                                     06450000
064600         INCLUDE TRECEIV                                          06460000
064700     END-EXEC.                                                    06470000
064800                                                                  06480000
064900 EJECT                                                            06490000
065000*---------------------------------------------------------------* 06500000
065100*    DB2 AREA FOR THE MERCHANDISE AREA TABLE                    * 06510000
065200*---------------------------------------------------------------* 06520000
065300                                                                  06530000
065400     EXEC SQL                                                     06540000
065500         INCLUDE TMDSEAR                                          06550000
065600     END-EXEC.                                                    06560000
065700                                                                  06570000
065800 EJECT                                                            06580000
065900*---------------------------------------------------------------* 06590000
066000*    DB2 AREA FOR THE RESPONSIBILITY AREA TABLE                 * 06600000
066100*---------------------------------------------------------------* 06610000
066200                                                                  06620000
066300     EXEC SQL                                                     06630000
066400         INCLUDE TRSPBAR                                          06640000
066500     END-EXEC.                                                    06650000
066600                                                                  06660000
066700 EJECT                                                            06670000
066800*---------------------------------------------------------------* 06680000
066900*    DB2 AREA FOR THE WORKER TABLE                              * 06690000
067000*---------------------------------------------------------------* 06700000
067100                                                                  06710000
067200     EXEC SQL                                                     06720000
067300         INCLUDE TWORKER                                          06730000
067400     END-EXEC.                                                    06740000
067500*---------------------------------------------------------------* 06750000
067600*    DB2 AREA FOR THE XLT_SKU TABLE                             * 06760000
067700*---------------------------------------------------------------* 06770000
067800                                                                  06780000
067900     EXEC SQL                                                     06790000
068000         INCLUDE XLT00003                                         06800000
068100     END-EXEC.                                                    06810000
068200*---------------------------------------------------------------* 06820000
068300*    DB2 AREA FOR THE XLT_VND_STYL TABLE                        * 06830000
068400*---------------------------------------------------------------* 06840000
068500                                                                  06850000
068600     EXEC SQL                                                     06860000
068700         INCLUDE XLT00004                                         06870000
068800     END-EXEC.                                                    06880000
068900                                                                  06890000
069000 EJECT                                                            06900000
069100*---------------------------------------------------------------* 06910000
069200*    DB2 AREA FOR COMMUNICATIONS                                * 06920000
069300*---------------------------------------------------------------* 06930000
069400     EXEC SQL                                                     06940000
069500          INCLUDE SQLCA                                           06950000
069600     END-EXEC.                                                    06960000
069700                                                                  06970000
069800 EJECT                                                            06980000
069900 LINKAGE SECTION.                                                 06990000
070000                                                                  07000000
070100 01  DFHCOMMAREA.                                                 07010000
070200     05  FILLER                         OCCURS  1 TO 4072 TIMES   07020000
070300                                        DEPENDING ON EIBCALEN.    07030000
070400         10  FILLER                     PIC X.                    07040000
070500                                                                  07050000
070600 EJECT                                                            07060000
070700 PROCEDURE DIVISION.                                              07070000
070800*---------------------------------------------------------------* 07080000
070900*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * 07090000
071000*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * 07100000
071100*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * 07110000
071200*---------------------------------------------------------------* 07120000
071300 0000-MAIN-MODULE.                                                07130000
071400                                                                  07140000
071500     INITIALIZE DP030-CICS-API-FIELDS.                            07150000
071600                                                                  07160000
071700     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       07170000
071800     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          07180000
071900     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         07190000
072000                                                                  07200000
072100     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       07210000
072200                                                                  07220000
072300     MOVE LENGTH OF PO104AI        TO DP030-MAP-LENGTH (1).       07230000
072400     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     07240000
072500                                                                  07250000
072600     PERFORM 0001-CALL-CICS-ARCH-API.                             07260000
072700     PERFORM 1000-CONTROL-PROCESSING                              07270000
072800                                                                  07280000
072900     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     07290000
073000     PERFORM 0001-CALL-CICS-ARCH-API.                             07300000
073100                                                                  07310000
073200*---------------------------------------------------------------* 07320000
073300*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * 07330000
073400*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * 07340000
073500*---------------------------------------------------------------* 07350000
073600 0001-CALL-CICS-ARCH-API.                                         07360000
073700     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      07370091
073800                                    DFHCOMMAREA                   07380091
073900                                    DP030-CICS-API-FIELDS         07390091
074000                                    DP020-STANDARD-COMMAREA       07400091
074100                                    PO104AI.                      07410091
074200                                                                  07420000
074300     IF  DP030-RC-CALL-SUCCESSFUL                                 07430000
074400         CONTINUE                                                 07440000
074500     ELSE                                                         07450000
074600         SET DP013-NO-ROLLBACK                                    07460000
074700             DP013-XCTL-DISPLAY-RESTART                           07470000
074800             DP013-CICS-ABEND      TO TRUE                        07480000
074900         MOVE '0001-CALL-CICS-ARCH-API'                           07490000
075000                                   TO DP013-PARAGRAPH             07500000
075010         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O07501090
075020-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      07502090
075300         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      07530000
075400         PERFORM DP013-0000-PROCESS-ABEND                         07540000
075500     END-IF.                                                      07550000
075600                                                                  07560000
075700*----------------------------------------------------------------*07570000
075800* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *07580000
075900* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *07590000
076000*                                                                *07600000
076100* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *07610000
076200*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *07620000
076300*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *07630000
076400*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *07640000
076500*----------------------------------------------------------------*07650000
076600                                                                  07660000
076700 1000-CONTROL-PROCESSING.                                         07670000
076800                                                                  07680000
076900     EVALUATE TRUE                                                07690000
077000         WHEN DP020-NEXT-ACT-INITIAL                              07700000
077100             INITIALIZE ASC-SPECIFIC-COMMAREA                     07710000
077200                                                                  07720000
077300             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            07730000
077400             MOVE DP020-SRC-TASK-NUMBER                           07740000
077500                                   TO ASC-LIST-TASK-NUMBER        07750000
077600             MOVE PC-LIST-QUEUE-SEQ                               07760000
077700                                   TO ASC-LIST-SEQ                07770000
077800             PERFORM 1100-PROCESS-INTER-APPL-COMM                 07780000
077900             IF  PS-COMMAREA-NOT-VALID                            07790000
078000                 SET DP020-NEXT-ACT-APPL-ERROR                    07800000
078100                                   TO TRUE                        07810000
078200             ELSE                                                 07820000
078300                 PERFORM 4000-BUILD-INITIAL-PANEL                 07830000
078400             END-IF                                               07840000
078500                                                                  07850000
078600         WHEN DP020-NEXT-ACT-READ-MAP                             07860000
078700             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        07870000
078800                                   TO PV-TOP-ITEM                 07880000
078900             PERFORM 2000-PROCESS-PANEL                           07890000
079000                                                                  07900000
079100         WHEN DP020-NEXT-ACT-RETURN                               07910000
079200             SET ASC-NOT-CONFIRM   TO TRUE                        07920000
079300             MOVE ASC-SET-YEAR     TO ASETYRO                     07930000
079400             MOVE ASC-SET-SHORT-NME                               07940000
079500                                   TO ASETNMEO                    07950000
079600             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        07960000
079700                                   TO PV-TOP-ITEM                 07970000
079800             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    07980000
079900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07990000
080000                                                                  08000000
080100         WHEN OTHER                                               08010000
080200             SET DP013-LOGIC-ABEND TO TRUE                        08020000
080300             SET DP013-NO-ROLLBACK TO TRUE                        08030000
080400             MOVE '1000-CONTROL-PROCESSING'                       08040000
080500                                   TO DP013-PARAGRAPH             08050000
080600             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    08060000
080700                                   TO DP013-MESSAGE-TEXT(1)       08070000
080800             PERFORM DP013-0000-PROCESS-ABEND                     08080000
080900     END-EVALUATE.                                                08090000
081000                                                                  08100000
081100 EJECT                                                            08110000
081200*----------------------------------------------------------------*08120000
081300* MOVE DATA PASSED THROUGH THE INTER-APPL COMMAREA               *08130000
081400*----------------------------------------------------------------*08140000
081500                                                                  08150000
081600 1100-PROCESS-INTER-APPL-COMM.                                    08160000
081700                                                                  08170000
081800     SET PS-COMMAREA-VALID         TO TRUE.                       08180000
081900     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     08190000
082000     MOVE PO079-SET-YEAR           TO ASC-SET-YEAR.               08200000
082100     MOVE PO079-SET-SHORT-NME      TO ASC-SET-SHORT-NME.          08210000
082200                                                                  08220000
082300     IF PO079-PO-NBR > ZEROS                                      08230000
082400         CONTINUE                                                 08240000
082500     ELSE                                                         08250000
082600         IF  PO079-DEPT-NBR > SPACES                              08260000
082700             INITIALIZE PV-DB2-COUNT                              08270000
082800             PERFORM 1110-VALIDATE-DEPT                           08280000
082900             IF  PV-DB2-COUNT = +0                                08290000
083000                 MOVE PC-TSYMSG-00588                             08300000
083100                                     TO DP020-MSG-NUMBER          08310000
083200                  SET PS-ERROR                                    08320000
083300                      PS-COMMAREA-NOT-VALID                       08330000
083400                      DP020-MSG-FATAL                             08340000
083500                                     TO TRUE                      08350000
083600             END-IF                                               08360000
083700         ELSE                                                     08370000
083800             IF  PO079-OTB-PER-NBR-BEG = SPACES                   08380067
083900             AND PO079-OTB-PER-NBR-END = SPACES                   08390067
084000                 MOVE PC-TSYMSG-03494    TO DP020-MSG-NUMBER      08400070
084100                 SET PS-ERROR                                     08410067
084200                     PS-COMMAREA-NOT-VALID                        08420067
084300                     DP020-MSG-FATAL     TO TRUE                  08430067
084400             END-IF                                               08440067
084500         END-IF                                                   08450067
084600     END-IF.                                                      08460000
084700                                                                  08470000
084800     IF  PS-NO-ERROR                                              08480055
084900        AND PO079-MAJ-CL-NBR > SPACES                             08490055
085000       IF  (PO079-DEPT-NBR IS NOT NUMERIC)                        08500055
085100          MOVE PC-TSYMSG-00588    TO DP020-MSG-NUMBER             08510055
085200          SET PS-ERROR                                            08520055
085300              PS-COMMAREA-NOT-VALID                               08530055
085400              DP020-MSG-FATAL     TO TRUE                         08540055
085500       END-IF                                                     08550055
085600       IF PO079-MAJ-CL-NBR (1:1) IS NUMERIC                       08560055
085700         IF PO079-MAJ-CL-NBR (1:2) IS NUMERIC                     08570055
085800            MOVE PO079-MAJ-CL-NBR TO PV-MJ-CL                     08580055
085900         ELSE                                                     08590055
086000            MOVE PO079-MAJ-CL-NBR (1:1)                           08600055
086100                                  TO PV-MAJ-CL-3                  08610055
086200         END-IF                                                   08620055
086300       ELSE                                                       08630055
086400         MOVE PO079-MAJ-CL-NBR (2:1)                              08640055
086500                                  TO PV-MAJ-CL-3                  08650055
086600       END-IF                                                     08660055
086700       PERFORM 1170-VALIDATE-MAJOR-CLASS                          08670055
086800       IF  PV-DB2-COUNT = 0                                       08680055
086900          MOVE PC-TSYMSG-03070  TO DP020-MSG-NUMBER               08690055
087000          SET PS-ERROR                                            08700055
087100              PS-COMMAREA-NOT-VALID                               08710055
087200              DP020-MSG-FATAL   TO TRUE                           08720055
087300       END-IF                                                     08730055
087400     END-IF                                                       08740055
087500*                                                                 08750055
087600     IF PS-NO-ERROR                                               08760055
087700       AND PO079-CL-NBR > SPACES                                  08770055
087800       IF  PO079-CL-NBR (1:1) IS NUMERIC AND                      08780055
087900           PO079-CL-NBR (2:1) IS NUMERIC                          08790055
088000         IF PO079-DEPT-NBR = SPACES                               08800055
088100           IF  PO079-MAJ-CL-NBR = SPACES                          08810055
088200              MOVE PC-TSYMSG-03072 TO DP020-MSG-NUMBER            08820055
088300                                                                  08830055
088400              SET PS-ERROR                                        08840055
088500                  PS-COMMAREA-NOT-VALID                           08850055
088600                  DP020-MSG-FATAL  TO TRUE                        08860055
088700           ELSE                                                   08870055
088800              MOVE PC-TSYMSG-00588 TO DP020-MSG-NUMBER            08880055
088900                                                                  08890055
089000              SET PS-ERROR                                        08900055
089100                  PS-COMMAREA-NOT-VALID                           08910055
089200                  DP020-MSG-FATAL  TO TRUE                        08920055
089300           END-IF                                                 08930055
089400         ELSE                                                     08940055
089500           IF  PO079-MAJ-CL-NBR = SPACES                          08950055
089600              MOVE PC-TSYMSG-03070 TO DP020-MSG-NUMBER            08960055
089700                                                                  08970055
089800              SET PS-ERROR                                        08980055
089900                  PS-COMMAREA-NOT-VALID                           08990055
090000                  DP020-MSG-FATAL TO TRUE                         09000055
090100           ELSE                                                   09010055
090200             IF PO079-MAJ-CL-NBR (1:1) > ZEROS                    09020055
090300               MOVE PO079-MAJ-CL-NBR (1:2)                        09030055
090400                                      TO PV-MJ-CL                 09040055
090500             ELSE                                                 09050055
090600               IF PO079-MAJ-CL-NBR (2:1) > ZEROS                  09060055
090700                 MOVE PO079-MAJ-CL-NBR(2:1)                       09070055
090800                                         TO PV-MAJ-CL-3           09080055
090900               END-IF                                             09090055
091000             END-IF                                               09100055
091100             PERFORM 1160-VALIDATE-MAJCL-SUBCL                    09110055
091200             IF PV-DB2-COUNT = 0                                  09120055
091300               MOVE PC-TSYMSG-03073 TO DP020-MSG-NUMBER           09130055
091400               SET PS-ERROR                                       09140055
091500                   PS-COMMAREA-NOT-VALID                          09150055
091600                   DP020-MSG-FATAL  TO TRUE                       09160055
091700             END-IF                                               09170055
091800           END-IF                                                 09180055
091900         END-IF                                                   09190055
092000       ELSE                                                       09200055
092100         MOVE PC-TSYMSG-03069 TO DP020-MSG-NUMBER                 09210055
092200                                                                  09220055
092300         SET PS-ERROR                                             09230055
092400             PS-COMMAREA-NOT-VALID                                09240055
092500             DP020-MSG-FATAL  TO TRUE                             09250055
092600       END-IF                                                     09260055
092700     END-IF                                                       09270055
092800*                                                                 09280055
092900     IF  PS-NO-ERROR                                              09290060
093000     AND PO079-SKU-NBR > SPACES                                   09300060
093100         IF PO079-SKU-NBR (6:3) = '000'                           09310072
093200         OR PO079-SKU-NBR (6:3) = '999'                           09320060
093300            MOVE PC-TSYMSG-03081         TO DP020-MSG-NUMBER      09330060
093400            SET PS-ERROR                                          09340060
093500                PS-COMMAREA-NOT-VALID                             09350060
093600                DP020-MSG-FATAL          TO TRUE                  09360060
093700         ELSE                                                     09370060
093800            PERFORM 1180-VALIDATE-SKU                             09380060
093900            IF PV-DB2-COUNT = 0                                   09390060
094000               MOVE PC-TSYMSG-00419       TO DP020-MSG-NUMBER     09400060
094100               SET PS-ERROR                                       09410060
094200                   PS-COMMAREA-NOT-VALID                          09420060
094300                   DP020-MSG-FATAL        TO TRUE                 09430060
094400            END-IF                                                09440060
094500         END-IF                                                   09450060
094600     END-IF                                                       09460057
094700*                                                                 09470057
094800     IF  PS-NO-ERROR                                              09480057
094900       AND PO079-SKU-NBR > SPACES                                 09490057
095000       IF  PO079-DEPT-NBR = SPACES                                09500057
095100             MOVE PC-TSYMSG-00486     TO DP020-MSG-NUMBER         09510057
095200             SET PS-ERROR                                         09520057
095300                 PS-COMMAREA-NOT-VALID                            09530000
095400                 DP020-MSG-FATAL      TO TRUE                     09540000
095500       ELSE                                                       09550000
095600         IF PO079-MAJ-CL-NBR = SPACES                             09560050
095700            MOVE PC-TSYMSG-03070 TO DP020-MSG-NUMBER              09570050
095800            SET PS-ERROR                                          09580050
095900                PS-COMMAREA-NOT-VALID                             09590050
096000                DP020-MSG-FATAL  TO TRUE                          09600050
096100         ELSE                                                     09610000
096200           IF PO079-CL-NBR = SPACES                               09620000
096300              OR PO079-CL-NBR (1:1) IS NOT NUMERIC                09630000
096400              OR PO079-CL-NBR (1:2) IS NOT NUMERIC                09640000
096500                 MOVE PC-TSYMSG-03069 TO DP020-MSG-NUMBER         09650000
096600                 SET PS-ERROR                                     09660000
096700                     PS-COMMAREA-NOT-VALID                        09670000
096800                     DP020-MSG-FATAL  TO TRUE                     09680000
096900           ELSE                                                   09690000
097000             IF PO079-MAJ-CL-NBR (1:1) > ZEROS                    09700000
097100                MOVE PO079-MAJ-CL-NBR                             09710055
097200                                          TO PV-MJ-CL             09720054
097300             ELSE                                                 09730000
097400               IF PO079-MAJ-CL-NBR (2:1) > ZEROS                  09740000
097500                   MOVE PO079-MAJ-CL-NBR(2:1)                     09750000
097600                                          TO PV-MAJ-CL-3          09760000
097700               END-IF                                             09770000
097800             END-IF                                               09780000
097900             PERFORM 1150-VALIDATE-MAJCL-SUBCL-SKU                09790000
098000             IF  PV-DB2-COUNT = 0                                 09800000
098100                MOVE PC-TSYMSG-03071  TO DP020-MSG-NUMBER         09810000
098200                SET PS-ERROR                                      09820000
098300                    PS-COMMAREA-NOT-VALID                         09830000
098400                    DP020-MSG-FATAL   TO TRUE                     09840000
098500             END-IF                                               09850000
098600           END-IF                                                 09860000
098700         END-IF                                                   09870000
098800       END-IF                                                     09880000
098900     END-IF                                                       09890000
099000*                                                                 09900055
099100                                                                  09910000
099200     IF  PS-NO-ERROR                                              09920000
099300     AND PO079-STR-NBR > ZERO                                     09930000
099400         INITIALIZE PV-DB2-COUNT                                  09940000
099500         PERFORM 1120-VALIDATE-STORE                              09950000
099600         IF  PV-DB2-COUNT = +0                                    09960000
099700             MOVE PC-TSYMSG-00017                                 09970000
099800                             TO DP020-MSG-NUMBER                  09980000
099900              SET PS-ERROR                                        09990000
100000                  PS-COMMAREA-NOT-VALID                           10000000
100100                  DP020-MSG-FATAL                                 10010000
100200                             TO TRUE                              10020000
100300         END-IF                                                   10030000
100400     END-IF.                                                      10040000
100500                                                                  10050000
100600     IF  PS-NO-ERROR                                              10060000
100700     AND PO079-STATUS-CDE   > SPACES                              10070000
100800         INITIALIZE PV-DB2-COUNT                                  10080000
100900         MOVE PO079-STATUS-CDE                                    10090000
101000                             TO STATCD-STATUS-CDE                 10100000
101100         PERFORM 1130-VALIDATE-STATUS-CODE                        10110000
101200         IF  PV-DB2-COUNT = +0                                    10120000
101300             MOVE PC-TSYMSG-00168                                 10130000
101400                             TO DP020-MSG-NUMBER                  10140000
101500              SET PS-ERROR                                        10150000
101600                  PS-COMMAREA-NOT-VALID                           10160000
101700                  DP020-MSG-FATAL                                 10170000
101800                             TO TRUE                              10180000
101900         END-IF                                                   10190000
102000     END-IF.                                                      10200000
102100                                                                  10210000
102200     IF  PS-NO-ERROR                                              10220000
102300     AND PO079-PO-TYP-CDE > SPACES                                10230000
102400         INITIALIZE PV-DB2-COUNT                                  10240000
102500         PERFORM 1140-VALIDATE-PO-TYPE-CODE                       10250000
102600         IF  PV-DB2-COUNT = +0                                    10260000
102700             MOVE PC-TSYMSG-00587                                 10270000
102800                             TO DP020-MSG-NUMBER                  10280000
102900              SET PS-ERROR                                        10290000
103000                  PS-COMMAREA-NOT-VALID                           10300000
103100                  DP020-MSG-FATAL                                 10310000
103200                             TO TRUE                              10320000
103300         END-IF                                                   10330000
103400     END-IF.                                                      10340000
103500                                                                  10350000
103600     IF  PS-NO-ERROR                                              10360000
103700         MOVE PO079-PO-NBR       TO ASC-KEY-PO-NBR                10370000
103800         MOVE PO079-IMPRT-AGNT-PO-NBR                             10380000
103900                                 TO ASC-KEY-IMPRT-AGNT-PO-NBR     10390000
104000         MOVE PO079-DEPT-NBR     TO ASC-KEY-DEPT-NBR              10400000
104100         MOVE PO079-PO-TYP-CDE   TO ASC-KEY-PO-TYP-CDE            10410000
104200         MOVE PO079-STATUS-CDE   TO ASC-KEY-STATUS-CDE            10420000
104300         MOVE PO079-STATUS-GRP   TO ASC-KEY-STATUS-CLS            10430000
104400         MOVE PO079-NEW-STR-IND  TO ASC-KEY-NEW-STR-IND           10440000
104500         IF  PO079-MAJ-CL-NBR > ZERO                              10450000
104600             IF  PO079-MAJ-CL-NBR (1:1) IS NUMERIC                10460000
104700                 MOVE PO079-MAJ-CL-NBR (1:2)                      10470054
104800                                 TO PV-MJ-CL                      10480054
104900             ELSE                                                 10490000
105000                 IF  PO079-MAJ-CL-NBR (2:1) IS NUMERIC            10500000
105100                     MOVE PO079-MAJ-CL-NBR(2:1)                   10510000
105200                                 TO PV-MAJ-CL-3                   10520000
105300                 END-IF                                           10530000
105400             END-IF                                               10540000
105500             MOVE PV-MAJ-CL      TO ASC-KEY-MAJ-CL-NBR            10550000
105600         ELSE                                                     10560000
105700             MOVE ZEROS          TO ASC-KEY-MAJ-CL-NBR            10570000
105800         END-IF                                                   10580000
105900         IF  PO079-CL-NBR > SPACES                                10590000
106000             MOVE PO079-CL-NBR   TO PV-SUB-CL-3-4                 10600000
106100             MOVE PV-SUB-CLASS   TO ASC-KEY-SUB-CL-NBR            10610000
106200         ELSE                                                     10620000
106300             MOVE ZEROS          TO ASC-KEY-SUB-CL-NBR            10630000
106400         END-IF                                                   10640000
106500         IF  PO079-SKU-NBR > SPACES                               10650000
106600             MOVE PO079-SKU-NBR  TO ASC-KEY-SKU-NBR               10660000
106700         ELSE                                                     10670000
106800             MOVE ZEROS          TO  ASC-KEY-SKU-NBR              10680000
106900         END-IF                                                   10690000
107000         MOVE PO079-STR-NBR      TO ASC-KEY-STR-NBR               10700000
107100         MOVE PO079-AD-EVNT-DTE-ISO                               10710000
107200                                 TO ASC-KEY-AD-EVNT-DTE           10720000
107300         MOVE PO079-VEND-STYL-NME TO ASC-KEY-VEND-STYL-NME        10730000
107400         MOVE PO079-ENT-NAME-DESC TO ASC-KEY-ENT-NAME-DESC        10740000
107500         IF  PO079-OTB-PER-NBR-BEG > SPACES                       10750000
107600         AND PO079-OTB-PER-NBR-END = SPACES                       10760000
107700             MOVE PO079-OTB-PER-NBR-BEG                           10770000
107800                                 TO PO079-OTB-PER-NBR-END         10780000
107900         END-IF                                                   10790000
108000         IF  PO079-OTB-PER-NBR-END > SPACES                       10800000
108100         AND PO079-OTB-PER-NBR-BEG = SPACES                       10810000
108200             MOVE PO079-OTB-PER-NBR-END                           10820000
108300                                 TO PO079-OTB-PER-NBR-BEG         10830000
108400         END-IF                                                   10840000
108500         IF PO079-OTB-PER-NBR-BEG(1:2) > SPACES                   10850000
108600            IF PO079-OTB-PER-NBR-BEG(1:2) > 80                    10860000
108700               MOVE '19' TO PV-HOLD-CC                            10870000
108800            ELSE                                                  10880000
108900               MOVE '20' TO PV-HOLD-CC                            10890000
109000            END-IF                                                10900000
109100         END-IF                                                   10910000
109200              STRING PV-HOLD-CC DELIMITED BY SIZE                 10920000
109300                     PO079-OTB-PER-NBR-BEG DELIMITED BY SIZE      10930000
109400                     INTO ASC-KEY-OTB-PER-NBR-BEG                 10940000
109500         IF PO079-OTB-PER-NBR-END(1:2) > SPACES                   10950000
109600            IF PO079-OTB-PER-NBR-END(1:2) > 80                    10960000
109700               MOVE '19' TO PV-HOLD-CC                            10970000
109800            ELSE                                                  10980000
109900               MOVE '20' TO PV-HOLD-CC                            10990000
110000            END-IF                                                11000000
110100         END-IF                                                   11010000
110200              STRING PV-HOLD-CC DELIMITED BY SIZE                 11020000
110300                     PO079-OTB-PER-NBR-END DELIMITED BY SIZE      11030000
110400                     INTO ASC-KEY-OTB-PER-NBR-END                 11040000
110500         IF  PO079-DONT-SHIP-BEF-DTE > SPACES                     11050067
110600             MOVE PO079-DONT-SHIP-BEF-DTE                         11060067
110700                                 TO ASC-KEY-DONT-SHIP-BEF-DTE-B   11070067
110800         END-IF                                                   11080067
110900         IF  PO079-CAN-IFNOT-SHIP-DTE > SPACES                    11090067
111000             MOVE PO079-CAN-IFNOT-SHIP-DTE                        11100067
111100                                 TO ASC-KEY-DONT-SHIP-BEF-DTE-E   11110067
111200         END-IF                                                   11120067
111300     END-IF.                                                      11130000
111400                                                                  11140000
111500 EJECT                                                            11150000
111600 1110-VALIDATE-DEPT.                                              11160000
111700                                                                  11170000
111800     PERFORM                                                      11180000
111900         WITH TEST AFTER                                          11190000
112000         VARYING PV-RETRY-COUNTER                                 11200000
112100         FROM 1 BY 1                                              11210000
112200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               11220000
112300             OR (SQLCODE = +0)                                    11230000
112400             OR (SQLCODE = +100))                                 11240000
112500                                                                  11250000
112600         EXEC SQL                                                 11260000
112700              SELECT COUNT(*)                                     11270000
112800                INTO :PV-DB2-COUNT                                11280000
112900                FROM TMDSEAR                                      11290000
113000               WHERE DEPT_NBR   = :PO079-DEPT-NBR                 11300000
113100                 AND OPERCO_NBR = '03'                            11310000
113200                 AND MDSELV_CDE = 'DPT'                           11320000
113300                 AND STRT_DTE  <= CURRENT DATE                    11330000
113400                 AND END_DTE   >= CURRENT DATE                    11340000
113500         END-EXEC                                                 11350000
113600                                                                  11360000
113700         EVALUATE TRUE                                            11370000
113800             WHEN SQLCODE = +0                                    11380000
113900             WHEN SQLCODE = +100                                  11390000
114000             WHEN SQLCODE = -904                                  11400000
114100             WHEN SQLCODE = -913                                  11410000
114200                  CONTINUE                                        11420000
114300                                                                  11430000
114400             WHEN SQLWARN0 NOT = SPACES                           11440000
114500             WHEN SQLCODE < +0                                    11450000
114600             WHEN SQLCODE > +0                                    11460000
114700                  MOVE '1110-VALIDATE-DEPT'                       11470000
114800                                  TO DP013-PARAGRAPH              11480000
114900                  MOVE 'UNSUCCESSFUL COUNT ON DEPARTMENT'         11490000
115000                                  TO DP013-MESSAGE-TEXT (1)       11500000
115100                  MOVE SQLCA      TO DP013-SQLCA                  11510000
115200                  MOVE 'TMDSEAR ' TO DP013-DB2-TABLE-NAME (1)     11520000
115300                  SET DP013-DB2-ABEND                             11530000
115400                      DP013-XCTL-DISPLAY-RESTART                  11540000
115500                                  TO TRUE                         11550000
115600                  PERFORM DP013-0000-PROCESS-ABEND                11560000
115700         END-EVALUATE                                             11570000
115800     END-PERFORM.                                                 11580000
115900                                                                  11590000
116000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        11600000
116100         MOVE '1110-VALIDATE-DEPT'                                11610000
116200                                  TO DP013-PARAGRAPH              11620000
116300         MOVE 'MAX RETRIES EXCEEDED ON COUNT ON TMDSEAR'          11630000
116400                                  TO DP013-MESSAGE-TEXT (1)       11640000
116500         MOVE SQLCA               TO DP013-SQLCA                  11650000
116600         MOVE 'TMDSEAR '          TO DP013-DB2-TABLE-NAME (1)     11660000
116700         SET DP013-DB2-ABEND                                      11670000
116800             DP013-XCTL-DISPLAY-RESTART                           11680000
116900                                  TO TRUE                         11690000
117000         PERFORM DP013-0000-PROCESS-ABEND                         11700000
117100     END-IF.                                                      11710000
117200                                                                  11720000
117300 EJECT                                                            11730000
117400 1120-VALIDATE-STORE.                                             11740000
117500                                                                  11750000
117600     PERFORM                                                      11760000
117700         WITH TEST AFTER                                          11770000
117800         VARYING PV-RETRY-COUNTER                                 11780000
117900         FROM 1 BY 1                                              11790000
118000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               11800000
118100             OR (SQLCODE = +0)                                    11810000
118200             OR (SQLCODE = +100))                                 11820000
118300                                                                  11830000
118400         EXEC SQL                                                 11840000
118500              SELECT COUNT(*)                                     11850000
118600                INTO :PV-DB2-COUNT                                11860000
118700                FROM XMT_LOC                                      11870063
118800               WHERE LOC_NBR = :PO079-STR-NBR                     11880064
118900         END-EXEC                                                 11890000
119000                                                                  11900000
119100         EVALUATE TRUE                                            11910000
119200             WHEN SQLCODE = +0                                    11920000
119300             WHEN SQLCODE = +100                                  11930000
119400             WHEN SQLCODE = -904                                  11940000
119500             WHEN SQLCODE = -913                                  11950000
119600                  CONTINUE                                        11960000
119700                                                                  11970000
119800             WHEN SQLWARN0 NOT = SPACES                           11980000
119900             WHEN SQLCODE < +0                                    11990000
120000             WHEN SQLCODE > +0                                    12000000
120100                  MOVE '1120-VALIDATE-STORE'                      12010000
120200                                  TO DP013-PARAGRAPH              12020000
120300                  MOVE 'UNSUCCESSFUL COUNT ON STORE'              12030000
120400                                  TO DP013-MESSAGE-TEXT (1)       12040000
120500                  MOVE SQLCA      TO DP013-SQLCA                  12050000
120600                  MOVE 'XMT00001' TO DP013-DB2-TABLE-NAME (1)     12060065
120700                  SET DP013-DB2-ABEND                             12070000
120800                      DP013-XCTL-DISPLAY-RESTART                  12080000
120900                                  TO TRUE                         12090000
121000                  PERFORM DP013-0000-PROCESS-ABEND                12100000
121100         END-EVALUATE                                             12110000
121200     END-PERFORM.                                                 12120000
121300                                                                  12130000
121400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        12140000
121500         MOVE '1120-VALIDATE-STORE'                               12150000
121600                                  TO DP013-PARAGRAPH              12160000
121700         MOVE 'MAX RETRIES EXCEEDED ON COUNT ON XMT00001'         12170065
121800                                  TO DP013-MESSAGE-TEXT (1)       12180000
121900         MOVE SQLCA               TO DP013-SQLCA                  12190000
122000         MOVE 'XMT00001'          TO DP013-DB2-TABLE-NAME (1)     12200065
122100         SET DP013-DB2-ABEND                                      12210000
122200             DP013-XCTL-DISPLAY-RESTART                           12220000
122300                                  TO TRUE                         12230000
122400         PERFORM DP013-0000-PROCESS-ABEND                         12240000
122500     END-IF.                                                      12250000
122600                                                                  12260000
122700 EJECT                                                            12270000
122800 1130-VALIDATE-STATUS-CODE.                                       12280000
122900                                                                  12290000
123000     PERFORM                                                      12300000
123100         WITH TEST AFTER                                          12310000
123200         VARYING PV-RETRY-COUNTER                                 12320000
123300         FROM 1 BY 1                                              12330000
123400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               12340000
123500             OR (SQLCODE = +0)                                    12350000
123600             OR (SQLCODE = +100))                                 12360000
123700                                                                  12370000
123800         EXEC SQL                                                 12380000
123900              SELECT COUNT(*)                                     12390000
124000                INTO :PV-DB2-COUNT                                12400000
124100                FROM TSTATCD                                      12410000
124200               WHERE STATUS_TYP_CDE = 'P'                         12420000
124300                 AND STATUS_CDE     = :STATCD-STATUS-CDE          12430000
124400         END-EXEC                                                 12440000
124500                                                                  12450000
124600         EVALUATE TRUE                                            12460000
124700             WHEN SQLCODE = +0                                    12470000
124800             WHEN SQLCODE = +100                                  12480000
124900             WHEN SQLCODE = -904                                  12490000
125000             WHEN SQLCODE = -913                                  12500000
125100                  CONTINUE                                        12510000
125200                                                                  12520000
125300             WHEN SQLWARN0 NOT = SPACES                           12530000
125400             WHEN SQLCODE < +0                                    12540000
125500             WHEN SQLCODE > +0                                    12550000
125600                  MOVE '1130-VALIDATE-STATUS-CODE'                12560000
125700                                  TO DP013-PARAGRAPH              12570000
125800                  MOVE 'UNSUCCESSFUL COUNT ON STATUS CODE'        12580000
125900                                  TO DP013-MESSAGE-TEXT (1)       12590000
126000                  MOVE SQLCA      TO DP013-SQLCA                  12600000
126100                  MOVE 'TSTATCD ' TO DP013-DB2-TABLE-NAME (1)     12610000
126200                  SET DP013-DB2-ABEND                             12620000
126300                      DP013-XCTL-DISPLAY-RESTART                  12630000
126400                                  TO TRUE                         12640000
126500                  PERFORM DP013-0000-PROCESS-ABEND                12650000
126600         END-EVALUATE                                             12660000
126700     END-PERFORM.                                                 12670000
126800                                                                  12680000
126900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        12690000
127000         MOVE '1130-VALIDATE-STATUS-CODE'                         12700000
127100                                  TO DP013-PARAGRAPH              12710000
127200         MOVE 'MAX RETRIES EXCEEDED ON COUNT ON TSTATCD'          12720000
127300                                  TO DP013-MESSAGE-TEXT (1)       12730000
127400         MOVE SQLCA               TO DP013-SQLCA                  12740000
127500         MOVE 'TSTATCD '          TO DP013-DB2-TABLE-NAME (1)     12750000
127600         SET DP013-DB2-ABEND                                      12760000
127700             DP013-XCTL-DISPLAY-RESTART                           12770000
127800                                  TO TRUE                         12780000
127900         PERFORM DP013-0000-PROCESS-ABEND                         12790000
128000     END-IF.                                                      12800000
128100                                                                  12810000
128200 EJECT                                                            12820000
128300 1140-VALIDATE-PO-TYPE-CODE.                                      12830000
128400                                                                  12840000
128500     PERFORM                                                      12850000
128600         WITH TEST AFTER                                          12860000
128700         VARYING PV-RETRY-COUNTER                                 12870000
128800         FROM 1 BY 1                                              12880000
128900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               12890000
129000             OR (SQLCODE = +0)                                    12900000
129100             OR (SQLCODE = +100))                                 12910000
129200                                                                  12920000
129300         EXEC SQL                                                 12930000
129400              SELECT COUNT(*)                                     12940000
129500                INTO :PV-DB2-COUNT                                12950000
129600                FROM TPOTYCD                                      12960000
129700               WHERE PO_VARIETY_CDE = 'T'                         12970000
129800                 AND PO_TYP_CDE     = :PO079-PO-TYP-CDE           12980000
129900         END-EXEC                                                 12990000
130000                                                                  13000000
130100         EVALUATE TRUE                                            13010000
130200             WHEN SQLCODE = +0                                    13020000
130300             WHEN SQLCODE = +100                                  13030000
130400             WHEN SQLCODE = -904                                  13040000
130500             WHEN SQLCODE = -913                                  13050000
130600                  CONTINUE                                        13060000
130700                                                                  13070000
130800             WHEN SQLWARN0 NOT = SPACES                           13080000
130900             WHEN SQLCODE < +0                                    13090000
131000             WHEN SQLCODE > +0                                    13100000
131100                  MOVE '1140-VALIDATE-PO-TYPE-CODE'               13110000
131200                                  TO DP013-PARAGRAPH              13120000
131300                  MOVE 'UNSUCCESSFUL COUNT ON TYPE CODE'          13130000
131400                                  TO DP013-MESSAGE-TEXT (1)       13140000
131500                  MOVE SQLCA      TO DP013-SQLCA                  13150000
131600                  MOVE 'TPOTYCD ' TO DP013-DB2-TABLE-NAME (1)     13160000
131700                  SET DP013-DB2-ABEND                             13170000
131800                      DP013-XCTL-DISPLAY-RESTART                  13180000
131900                                  TO TRUE                         13190000
132000                  PERFORM DP013-0000-PROCESS-ABEND                13200000
132100         END-EVALUATE                                             13210000
132200     END-PERFORM.                                                 13220000
132300                                                                  13230000
132400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        13240000
132500         MOVE '1140-VALIDATE-PO-TYPE-CODE'                        13250000
132600                                  TO DP013-PARAGRAPH              13260000
132700         MOVE 'MAX RETRIES EXCEEDED ON COUNT ON TPOTYCD'          13270000
132800                                  TO DP013-MESSAGE-TEXT (1)       13280000
132900         MOVE SQLCA               TO DP013-SQLCA                  13290000
133000         MOVE 'TPOTYCD '          TO DP013-DB2-TABLE-NAME (1)     13300000
133100         SET DP013-DB2-ABEND                                      13310000
133200             DP013-XCTL-DISPLAY-RESTART                           13320000
133300                                  TO TRUE                         13330000
133400         PERFORM DP013-0000-PROCESS-ABEND                         13340000
133500     END-IF.                                                      13350000
133600                                                                  13360000
133700 EJECT                                                            13370000
133800 1150-VALIDATE-MAJCL-SUBCL-SKU.                                   13380000
133900     MOVE 0              TO PV-DB2-COUNT                          13390000
134000     MOVE PV-MAJ-CLASS   TO XLT00004-MAJ-CL-NBR                   13400000
134100     MOVE PO079-CL-NBR   TO PV-SUB-CL-3-4                         13410000
134200     MOVE PV-SUB-CLASS   TO XLT00004-SUB-CL-NBR                   13420000
134300     MOVE PO079-SKU-NBR  TO PV-SKU-NBR                            13430000
134400     MOVE PV-SKU-NBR       TO XLT00003-SKU-NBR                    13440000
134500     PERFORM                                                      13450000
134600        WITH TEST AFTER                                           13460000
134700        VARYING PV-RETRY-COUNTER                                  13470000
134800        FROM 1 BY 1                                               13480000
134900        UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                13490000
135000              OR (SQLCODE = +0)                                   13500000
135100              OR (SQLCODE = +100))                                13510000
135200                                                                  13520000
135300        EXEC SQL                                                  13530000
135400            SELECT COUNT(*)                                       13540000
135500               INTO :PV-DB2-COUNT                                 13550000
135600            FROM  XLT_SKU S,                                      13560000
135700               XLT_VND_STYL V                                     13570000
135800            WHERE MAJ_CL_NBR = :XLT00004-MAJ-CL-NBR               13580000
135900              AND SUB_CL_NBR = :XLT00004-SUB-CL-NBR               13590000
136000              AND SKU_NBR    = :XLT00003-SKU-NBR                  13600000
136100              AND S.STYL_ID  = V.STYL_ID                          13610000
136200        END-EXEC                                                  13620000
136300                                                                  13630000
136400        EVALUATE TRUE                                             13640000
136500           WHEN SQLCODE = +0                                      13650000
136600           WHEN SQLCODE = +100                                    13660000
136700           WHEN SQLCODE = -904                                    13670000
136800           WHEN SQLCODE = -913                                    13680000
136900               CONTINUE                                           13690000
137000           WHEN SQLWARN0 NOT = SPACES                             13700000
137100           WHEN SQLCODE < +0                                      13710000
137200           WHEN SQLCODE > +0                                      13720000
137300               MOVE '1150-VALIDATE-MAJCL-SUBCL-SKU'               13730000
137400                                  TO DP013-PARAGRAPH              13740000
137500           MOVE 'UNSUCCESSFUL COUNT ON MAJ CL , SUB CL AND SKU'   13750000
137600                                  TO DP013-MESSAGE-TEXT (1)       13760000
137700             MOVE SQLCA           TO DP013-SQLCA                  13770000
137800             MOVE 'XLT_SKU '      TO DP013-DB2-TABLE-NAME (1)     13780000
137900             MOVE 'XLT_VND_STYL ' TO DP013-DB2-TABLE-NAME (2)     13790000
138000             SET DP013-DB2-ABEND                                  13800000
138100                 DP013-XCTL-DISPLAY-RESTART  TO TRUE              13810000
138200             PERFORM DP013-0000-PROCESS-ABEND                     13820000
138300        END-EVALUATE                                              13830000
138400      END-PERFORM.                                                13840000
138500                                                                  13850000
138600      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                       13860000
138700        MOVE '1150-VALIDATE-MAJCL-SUBCL-SKU'                      13870000
138800                                  TO DP013-PARAGRAPH              13880000
138900        MOVE 'MAX RETRIES EXCEEDED ON COUNT ON XLT_SKU'           13890000
139000                                  TO DP013-MESSAGE-TEXT (1)       13900000
139100        MOVE SQLCA                TO DP013-SQLCA                  13910000
139200        MOVE 'XLT_SKU '           TO DP013-DB2-TABLE-NAME (1)     13920000
139300        MOVE 'XLT_VND_STYL '      TO DP013-DB2-TABLE-NAME (2)     13930000
139400        SET DP013-DB2-ABEND                                       13940000
139500            DP013-XCTL-DISPLAY-RESTART TO TRUE                    13950000
139600        PERFORM DP013-0000-PROCESS-ABEND                          13960000
139700      END-IF.                                                     13970000
139800*                                                                 13980055
139900 1160-VALIDATE-MAJCL-SUBCL.                                       13990000
140000     MOVE +0              TO PV-DB2-COUNT                         14000000
140100     MOVE PV-MAJ-CLASS    TO XLT00004-MAJ-CL-NBR                  14010000
140200     MOVE PO079-CL-NBR    TO PV-SUB-CL-3-4                        14020000
140300     MOVE PV-SUB-CLASS    TO XLT00004-SUB-CL-NBR                  14030000
140400     PERFORM                                                      14040000
140500         WITH TEST AFTER                                          14050000
140600         VARYING PV-RETRY-COUNTER                                 14060000
140700         FROM 1 BY 1                                              14070000
140800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               14080000
140900               OR (SQLCODE = +0)                                  14090000
141000               OR (SQLCODE = +100))                               14100000
141100                                                                  14110000
141200         EXEC SQL                                                 14120000
141300             SELECT COUNT(*)                                      14130000
141400                INTO :PV-DB2-COUNT                                14140000
141500             FROM  XLT_VND_STYL V                                 14150000
141600             WHERE MAJ_CL_NBR = :XLT00004-MAJ-CL-NBR              14160000
141700               AND SUB_CL_NBR = :XLT00004-SUB-CL-NBR              14170000
141800         END-EXEC                                                 14180000
141900                                                                  14190000
142000         EVALUATE TRUE                                            14200000
142100             WHEN SQLCODE = +0                                    14210000
142200             WHEN SQLCODE = +100                                  14220000
142300             WHEN SQLCODE = -904                                  14230000
142400             WHEN SQLCODE = -913                                  14240000
142500                 CONTINUE                                         14250000
142600             WHEN SQLWARN0 NOT = SPACES                           14260000
142700             WHEN SQLCODE < +0                                    14270000
142800             WHEN SQLCODE > +0                                    14280000
142900                 MOVE '1160-VALIDATE-MAJCL-SUBCL'                 14290000
143000                                      TO DP013-PARAGRAPH          14300000
143100            MOVE 'UNSUCCESSFUL COUNT ON MAJ CLASS  AND SUB CLASS' 14310000
143200                                      TO DP013-MESSAGE-TEXT (1)   14320000
143300                 MOVE SQLCA           TO DP013-SQLCA              14330000
143400                 MOVE 'XLT_VND_STYL ' TO DP013-DB2-TABLE-NAME (1) 14340000
143500                 SET DP013-DB2-ABEND                              14350000
143600                     DP013-XCTL-DISPLAY-RESTART  TO TRUE          14360000
143700                 PERFORM DP013-0000-PROCESS-ABEND                 14370000
143800         END-EVALUATE                                             14380000
143900      END-PERFORM.                                                14390000
144000                                                                  14400000
144100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        14410000
144200         MOVE '1160-VALIDATE-MAJCL-SUBCL'                         14420000
144300                                      TO DP013-PARAGRAPH          14430000
144400         MOVE 'MAX RETRIES EXCEEDED ON COUNT ON XLT_VND_STYL'     14440000
144500                                      TO DP013-MESSAGE-TEXT (1)   14450000
144600         MOVE SQLCA                   TO DP013-SQLCA              14460000
144700         MOVE 'XLT_VND_STYL '         TO DP013-DB2-TABLE-NAME (1) 14470000
144800         SET DP013-DB2-ABEND                                      14480000
144900             DP013-XCTL-DISPLAY-RESTART  TO TRUE                  14490000
145000         PERFORM DP013-0000-PROCESS-ABEND                         14500000
145100     END-IF.                                                      14510000
145200*                                                                 14520055
145300 1170-VALIDATE-MAJOR-CLASS.                                       14530055
145400     MOVE +0              TO PV-DB2-COUNT                         14540055
145500     MOVE PV-MAJ-CLASS    TO XLT00004-MAJ-CL-NBR                  14550055
145600     PERFORM                                                      14560055
145700         WITH TEST AFTER                                          14570055
145800         VARYING PV-RETRY-COUNTER                                 14580055
145900         FROM 1 BY 1                                              14590055
146000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               14600055
146100               OR (SQLCODE = +0)                                  14610055
146200               OR (SQLCODE = +100))                               14620055
146300                                                                  14630055
146400         EXEC SQL                                                 14640055
146500             SELECT COUNT(*)                                      14650055
146600                INTO :PV-DB2-COUNT                                14660055
146700             FROM  XLT_VND_STYL                                   14670055
146800             WHERE MAJ_CL_NBR = :XLT00004-MAJ-CL-NBR              14680055
146900         END-EXEC                                                 14690055
147000                                                                  14700055
147100         EVALUATE TRUE                                            14710055
147200             WHEN SQLCODE = +0                                    14720055
147300             WHEN SQLCODE = +100                                  14730055
147400             WHEN SQLCODE = -904                                  14740055
147500             WHEN SQLCODE = -913                                  14750055
147600                 CONTINUE                                         14760055
147700             WHEN SQLWARN0 NOT = SPACES                           14770055
147800             WHEN SQLCODE < +0                                    14780055
147900             WHEN SQLCODE > +0                                    14790055
148000                 MOVE '1170-VALIDATE-MAJOR-CLASS'                 14800055
148100                                      TO DP013-PARAGRAPH          14810055
148200            MOVE 'UNSUCCESSFUL COUNT ON MAJ CLASS'                14820055
148300                                      TO DP013-MESSAGE-TEXT (1)   14830055
148400                 MOVE SQLCA           TO DP013-SQLCA              14840055
148500                 MOVE 'XLT_VND_STYL ' TO DP013-DB2-TABLE-NAME (1) 14850055
148600                 SET DP013-DB2-ABEND                              14860055
148700                     DP013-XCTL-DISPLAY-RESTART  TO TRUE          14870055
148800                 PERFORM DP013-0000-PROCESS-ABEND                 14880055
148900         END-EVALUATE                                             14890055
149000      END-PERFORM.                                                14900055
149100                                                                  14910055
149200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        14920055
149300         MOVE '1170-VALIDATE-MAJOR-CLASS'                         14930055
149400                                      TO DP013-PARAGRAPH          14940055
149500         MOVE 'MAX RETRIES EXCEEDED ON COUNT ON XLT_VND_STYL'     14950055
149600                                      TO DP013-MESSAGE-TEXT (1)   14960055
149700         MOVE SQLCA                   TO DP013-SQLCA              14970055
149800         MOVE 'XLT_VND_STYL '         TO DP013-DB2-TABLE-NAME (1) 14980055
149900         SET DP013-DB2-ABEND                                      14990055
150000             DP013-XCTL-DISPLAY-RESTART  TO TRUE                  15000055
150100         PERFORM DP013-0000-PROCESS-ABEND                         15010055
150200     END-IF.                                                      15020055
150300*                                                                 15030057
150400 1180-VALIDATE-SKU.                                               15040057
150500     MOVE +0              TO PV-DB2-COUNT                         15050057
150600     MOVE PO079-SKU-NBR   TO PV-SKU-NBR                           15060057
150700     MOVE PV-SKU-NBR      TO XLT00003-SKU-NBR                     15070057
150800     PERFORM                                                      15080057
150900         WITH TEST AFTER                                          15090057
151000         VARYING PV-RETRY-COUNTER                                 15100057
151100         FROM 1 BY 1                                              15110057
151200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15120057
151300               OR (SQLCODE = +0)                                  15130057
151400               OR (SQLCODE = +100))                               15140057
151500                                                                  15150057
151600         EXEC SQL                                                 15160057
151700             SELECT COUNT(*)                                      15170057
151800                INTO :PV-DB2-COUNT                                15180057
151900             FROM  XLT_SKU                                        15190057
152000             WHERE SKU_NBR = :XLT00003-SKU-NBR                    15200057
152100         END-EXEC                                                 15210057
152200                                                                  15220057
152300         EVALUATE TRUE                                            15230057
152400             WHEN SQLCODE = +0                                    15240057
152500             WHEN SQLCODE = +100                                  15250057
152600             WHEN SQLCODE = -904                                  15260057
152700             WHEN SQLCODE = -913                                  15270057
152800                 CONTINUE                                         15280057
152900             WHEN SQLWARN0 NOT = SPACES                           15290057
153000             WHEN SQLCODE < +0                                    15300057
153100             WHEN SQLCODE > +0                                    15310057
153200                 MOVE '1180-VALIDATE-SKU'                         15320057
153300                                      TO DP013-PARAGRAPH          15330057
153400            MOVE 'UNSUCCESSFUL COUNT ON SKU NUMBER'               15340057
153500                                      TO DP013-MESSAGE-TEXT (1)   15350057
153600                 MOVE SQLCA           TO DP013-SQLCA              15360057
153700                 MOVE 'XLT_SKU'       TO DP013-DB2-TABLE-NAME (1) 15370057
153800                 SET DP013-DB2-ABEND                              15380057
153900                     DP013-XCTL-DISPLAY-RESTART  TO TRUE          15390057
154000                 PERFORM DP013-0000-PROCESS-ABEND                 15400057
154100         END-EVALUATE                                             15410057
154200      END-PERFORM.                                                15420057
154300                                                                  15430057
154400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        15440057
154500         MOVE '1180-VALIDATE-SKU'                                 15450057
154600                                      TO DP013-PARAGRAPH          15460057
154700         MOVE 'MAX RETRIES EXCEEDED ON COUNT ON XLT_SKU'          15470057
154800                                      TO DP013-MESSAGE-TEXT (1)   15480057
154900         MOVE SQLCA                   TO DP013-SQLCA              15490057
155000         MOVE 'XLT_SKU'               TO DP013-DB2-TABLE-NAME (1) 15500057
155100         SET DP013-DB2-ABEND                                      15510057
155200             DP013-XCTL-DISPLAY-RESTART  TO TRUE                  15520057
155300         PERFORM DP013-0000-PROCESS-ABEND                         15530057
155400     END-IF.                                                      15540057
155500*                                                                 15550057
155600*----------------------------------------------------------------*15560057
155700* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *15570057
155800* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *15580057
155900* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *15590000
156000* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *15600000
156100* FUNCTION KEYS CAN GET THIS FAR.                                *15610000
156200*----------------------------------------------------------------*15620000
156300                                                                  15630000
156400 2000-PROCESS-PANEL.                                              15640000
156500     EVALUATE TRUE                                                15650000
156600         WHEN DP020-SRC-AID = DP016-CLEAR                         15660000
156700             SET ASC-NOT-CONFIRM   TO TRUE                        15670000
156800             MOVE ZERO              TO ASC-ITEM-AT-TOP-OF-PANEL   15680000
156900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   15690000
157000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 15700000
157100             MOVE ASC-SET-YEAR      TO ASETYRO                    15710000
157200             MOVE ASC-SET-SHORT-NME TO ASETNMEO                   15720000
157300                                                                  15730000
157400         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    15740000
157500             SET ASC-NOT-CONFIRM   TO TRUE                        15750000
157600             PERFORM 2050-DELETE-LIST-QUEUE                       15760000
157700             PERFORM 4000-BUILD-INITIAL-PANEL                     15770000
157800                                                                  15780000
157900         WHEN DP020-FK-DESELECT (DP020-SRC-AID)                   15790000
158000             SET ASC-NOT-CONFIRM   TO TRUE                        15800000
158100             PERFORM 2140-DESELECT-ALL-ITEMS                      15810000
158200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 15820000
158300                                                                  15830000
158400         WHEN DP020-FK-SELECT-ALL (DP020-SRC-AID)                 15840000
158500             SET ASC-NOT-CONFIRM   TO TRUE                        15850000
158600             PERFORM 2150-SELECT-ALL-ITEMS                        15860000
158700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 15870000
158800                                                                  15880000
158900         WHEN OTHER                                               15890000
159000             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 15900000
159100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   15910000
159200             IF  PS-NO-ERROR                                      15920000
159300                 SET DP030-CONTINUE-GO TO TRUE                    15930000
159400                 PERFORM 2100-CHECK-FUNCTION-KEY                  15940000
159500             ELSE                                                 15950000
159600                 SET DP030-OVERRIDE-GO TO TRUE                    15960000
159700             END-IF                                               15970000
159800     END-EVALUATE.                                                15980000
159900                                                                  15990000
160000 EJECT                                                            16000000
160100*----------------------------------------------------------------*16010000
160200*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *16020000
160300*----------------------------------------------------------------*16030000
160400 2050-DELETE-LIST-QUEUE.                                          16040000
160500                                                                  16050000
160600     EXEC CICS                                                    16060000
160700         DELETEQ TS                                               16070000
160800           QUEUE (ASC-LIST-QUEUE-NAME)                            16080000
160900            RESP (PV-CICS-RESP)                                   16090000
161000     END-EXEC.                                                    16100000
161100                                                                  16110000
161200     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       16120000
161300        (PV-CICS-RESP = DFHRESP(QIDERR))                          16130000
161400         CONTINUE                                                 16140000
161500     ELSE                                                         16150000
161600         SET DP013-CICS-ABEND      TO TRUE                        16160000
161700         SET DP013-NO-ROLLBACK     TO TRUE                        16170000
161800                                                                  16180000
161900         MOVE '2050-DELETE-LIST-QUEUE'                            16190000
162000                                   TO DP013-PARAGRAPH             16200000
162100         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    16210000
162200                                   TO DP013-MESSAGE-TEXT (1)      16220000
162300         PERFORM DP013-0000-PROCESS-ABEND                         16230000
162400     END-IF.                                                      16240000
162500                                                                  16250000
162600     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  16260000
162700                                                                  16270000
162800 EJECT                                                            16280000
162900*----------------------------------------------------------------*16290000
163000* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*16300000
163100* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *16310000
163200* CICS ARCHITECTURE API.                                         *16320000
163300*----------------------------------------------------------------*16330000
163400 2100-CHECK-FUNCTION-KEY.                                         16340000
163500                                                                  16350000
163600     EVALUATE TRUE                                                16360000
163700                                                                  16370000
163800         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  16380000
163900             SET ASC-NOT-CONFIRM   TO TRUE                        16390000
164000             MOVE +1               TO PV-TOP-ITEM                 16400000
164100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 16410000
164200             PERFORM 3200-RESET-ATTRIBUTES                        16420000
164300                                                                  16430000
164400         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   16440000
164500             SET ASC-NOT-CONFIRM   TO TRUE                        16450000
164600             PERFORM 2110-BROWSE-BACKWARD                         16460000
164700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 16470000
164800             PERFORM 3200-RESET-ATTRIBUTES                        16480000
164900                                                                  16490000
165000         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   16500000
165100             SET ASC-NOT-CONFIRM   TO TRUE                        16510000
165200             PERFORM 2120-BROWSE-FORWARD                          16520000
165300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 16530000
165400             PERFORM 3200-RESET-ATTRIBUTES                        16540000
165500                                                                  16550000
165600         WHEN DP020-SRC-AID = DP016-ENTER                         16560000
165700             SET ASC-NOT-CONFIRM   TO TRUE                        16570000
165800             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   16580000
165900             IF  PS-ERROR                                         16590000
166000                 CONTINUE                                         16600000
166100             ELSE                                                 16610000
166200                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             16620000
166300             END-IF                                               16630000
166400                                                                  16640000
166500         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)               16650000
166600              SET ASC-NOT-CONTINUE-UPDT                           16660000
166700                  ASC-NOT-CONFIRM   TO TRUE                       16670000
166800              IF ASC-NUMBER-OF-SELECTED-ITEMS >                   16680000
166900                 PC-PO027-CS104-PO-TABLE-MAX                      16690000
167000                SET DP020-MSG-FATAL TO TRUE                       16700000
167100                MOVE PC-TSYMSG-02670 TO DP020-MSG-NUMBER          16710000
167200                MOVE PC-PO027-CS104-PO-TABLE-MAX TO PV-MSG-TEXT   16720000
167300                MOVE PV-MSG-TEXT TO DP020-MSG-TEXT                16730000
167400                PERFORM 4400-MOVE-COMMAREA-TO-SCREEN              16740000
167500              ELSE                                                16750000
167600                IF ASC-NUMBER-OF-SELECTED-ITEMS > ZERO            16760000
167700                    PERFORM 5000-PROCESS-ADDITIONS                16770000
167800                  IF ASC-NOT-CONFIRM                              16780000
167900                      IF PS-NO-ERROR                              16790000
168000                          PERFORM 4400-MOVE-COMMAREA-TO-SCREEN    16800000
168100                          SET DP020-MSG-INFORMATIONAL             16810000
168200                                    TO TRUE                       16820000
168300                          MOVE PC-TSYMSG-00059                    16830000
168400                                    TO DP020-MSG-NUMBER           16840000
168500                      END-IF                                      16850000
168600                  END-IF                                          16860000
168700                ELSE                                              16870000
168800                 SET DP020-MSG-FATAL                              16880000
168900                                   TO TRUE                        16890000
169000                 MOVE PC-TSYMSG-00057                             16900000
169100                                   TO DP020-MSG-NUMBER            16910000
169200                END-IF                                            16920000
169300              END-IF                                              16930000
169400                                                                  16940000
169500         WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                    16950000
169600             IF ASC-CONFIRM                                       16960000
169700                 SET ASC-CONTINUE-UPDT TO TRUE                    16970000
169800                 PERFORM 5000-PROCESS-ADDITIONS                   16980000
169900                 IF PS-NO-ERROR                                   16990000
170000                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         17000000
170100                     SET DP020-MSG-INFORMATIONAL TO TRUE          17010000
170200                     MOVE PC-TSYMSG-00331 TO DP020-MSG-NUMBER     17020000
170300                 END-IF                                           17030000
170400                 SET ASC-NOT-CONFIRM TO TRUE                      17040000
170500             ELSE                                                 17050000
170600                 SET DP020-MSG-FATAL                              17060000
170700                                   TO TRUE                        17070000
170800                 MOVE PC-TSYMSG-00045                             17080000
170900                                   TO DP020-MSG-NUMBER            17090000
171000             END-IF                                               17100000
171100                                                                  17110000
171200         WHEN OTHER                                               17120000
171300             SET DP013-NO-ROLLBACK                                17130000
171400                 DP013-XCTL-DISPLAY-RESTART                       17140000
171500                 DP013-CICS-ABEND  TO TRUE                        17150000
171600             MOVE '2100-CHECK-FUNCTION-KEY'                       17160000
171700                                   TO DP013-PARAGRAPH             17170000
171800             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      17180000
171900                                   TO DP013-MESSAGE-TEXT (1)      17190000
172000             PERFORM DP013-0000-PROCESS-ABEND                     17200000
172100     END-EVALUATE.                                                17210000
172200                                                                  17220000
172300 EJECT                                                            17230000
172400*----------------------------------------------------------------*17240000
172500*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *17250000
172600*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *17260000
172700*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *17270000
172800*    MESSAGE.                                                    *17280000
172900*----------------------------------------------------------------*17290000
173000                                                                  17300000
173100 2110-BROWSE-BACKWARD.                                            17310000
173200                                                                  17320000
173300     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    17330000
173400         GIVING PV-TOP-ITEM.                                      17340000
173500                                                                  17350000
173600     IF  ((PV-TOP-ITEM < +1)                                      17360000
173700       OR (PV-TOP-ITEM = +1))                                     17370000
173800         MOVE +1                   TO PV-TOP-ITEM                 17380000
173900*        -- TOP OF LIST --                                        17390000
174000         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            17400000
174100         SET DP020-MSG-INFORMATIONAL                              17410000
174200                                   TO TRUE                        17420000
174300     END-IF.                                                      17430000
174400                                                                  17440000
174500 EJECT                                                            17450000
174600*----------------------------------------------------------------*17460000
174700*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *17470000
174800*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *17480000
174900*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *17490000
175000*----------------------------------------------------------------*17500000
175100                                                                  17510000
175200 2120-BROWSE-FORWARD.                                             17520000
175300                                                                  17530000
175400     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              17540000
175500         GIVING PV-TOP-ITEM.                                      17550000
175600                                                                  17560000
175700     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   17570000
175800         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            17580000
175900                                   TO PV-TOP-ITEM                 17590000
176000*        -- BOTTOM OF LIST --                                     17600000
176100         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            17610000
176200         SET DP020-MSG-INFORMATIONAL                              17620000
176300                                   TO TRUE                        17630000
176400     ELSE                                                         17640000
176500         COMPUTE PV-BOTTOM-ITEM =                                 17650000
176600             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 17660000
176700         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            17670000
176800*            -- BOTTOM OF LIST --                                 17680000
176900             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            17690000
177000             SET DP020-MSG-INFORMATIONAL                          17700000
177100                                   TO TRUE                        17710000
177200         END-IF                                                   17720000
177300     END-IF.                                                      17730000
177400                                                                  17740000
177500 EJECT                                                            17750000
177600*----------------------------------------------------------------*17760000
177700*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *17770000
177800*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *17780000
177900*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *17790000
178000*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *17800000
178100*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *17810000
178200*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *17820000
178300*----------------------------------------------------------------*17830000
178400                                                                  17840000
178500 2130-CHECK-FOR-JUMP-BROWSE.                                      17850000
178600                                                                  17860000
178700     SET PS-NO-ERROR               TO TRUE.                       17870000
178800     IF (ASC-START-ITEM-REQUEST = SPACE)                          17880000
178900         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            17890000
179000                                   TO PV-TOP-ITEM                 17900000
179100     ELSE                                                         17910000
179200         MOVE ASC-START-ITEM-REQUEST                              17920000
179300                                   TO DP010I-UNEDITED-FIELD       17930000
179400         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       17940000
179500         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     17950000
179600         SET DP010I-NEGATIVE-NOT-ALLOWED                          17960000
179700                                   TO TRUE                        17970000
179810         CALL DP010I-NUMERIC-EDIT-ROUTINE                         17981086
179820                         USING DP010I-NUMERIC-EDIT-AREA           17982086
179900                                                                  17990000
180000         IF  NOT DP010I-ERROR-DETECTED                            18000000
180100             MOVE DP010I-NUMERIC-FIELD                            18010000
180200                                   TO ASC-START-ITEM-REQUEST-N    18020000
180300             IF  ASC-START-ITEM-REQUEST-N > ZERO                  18030000
180400                 IF  ASC-START-ITEM-REQUEST-N >                   18040000
180500                                          ASC-NUMBER-OF-ITEMS-READ18050000
180600                     MOVE SPACE TO ASC-START-ITEM-REQUEST         18060000
180700                     COMPUTE PV-TOP-ITEM =                        18070000
180800                             ASC-NUMBER-OF-ITEMS-READ             18080000
180900                             - PC-ITEMS-PER-PANEL + 1             18090000
181000                     IF  PV-TOP-ITEM < +1                         18100000
181100                         MOVE +1   TO PV-TOP-ITEM                 18110000
181200                         MOVE PC-TSYMSG-00070                     18120000
181300                                   TO DP020-MSG-NUMBER            18130000
181400                         SET DP020-MSG-INFORMATIONAL              18140000
181500                                   TO TRUE                        18150000
181600                     END-IF                                       18160000
181700                 ELSE                                             18170000
181800                     MOVE ASC-START-ITEM-REQUEST-N                18180000
181900                                   TO PV-TOP-ITEM                 18190000
182000                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      18200000
182100                     COMPUTE PV-BOTTOM-ITEM =                     18210000
182200                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     18220000
182300                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ18230000
182400*                        -- BOTTOM OF LIST --                     18240000
182500                         MOVE PC-TSYMSG-00070                     18250000
182600                                   TO DP020-MSG-NUMBER            18260000
182700                         SET DP020-MSG-INFORMATIONAL              18270000
182800                                   TO TRUE                        18280000
182900                     END-IF                                       18290000
183000                 END-IF                                           18300000
183100             ELSE                                                 18310000
183200*                --- VALUE OUT OF RANGE ----                      18320000
183300                 MOVE PC-TSYMSG-00101                             18330000
183400                                   TO DP020-MSG-NUMBER            18340000
183500                 MOVE -1           TO ASTRTITL                    18350000
183600                 SET DP030-SET-CURSOR-APPL-1                      18360000
183700                                   TO TRUE                        18370000
183800                 MOVE DP015-REVERSE                               18380000
183900                                   TO ASTRTITH                    18390000
184000                 MOVE DP015-RED    TO ASTRTITC                    18400000
184100                 MOVE DP015-UNP-NUM-BRT-MDT                       18410000
184200                                   TO ASTRTITA                    18420000
184300                 SET DP020-MSG-FATAL                              18430000
184400                                   TO TRUE                        18440000
184500                 SET PS-ERROR      TO TRUE                        18450000
184600             END-IF                                               18460000
184700                                                                  18470000
184800         ELSE                                                     18480000
184900             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            18490000
185000             MOVE -1               TO ASTRTITL                    18500000
185100             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  18510000
185200             MOVE DP015-REVERSE    TO ASTRTITH                    18520000
185300             MOVE DP015-RED        TO ASTRTITC                    18530000
185400             MOVE DP015-UNP-NUM-BRT-MDT                           18540000
185500                                   TO ASTRTITA                    18550000
185600             SET DP020-MSG-FATAL   TO TRUE                        18560000
185700             SET PS-ERROR          TO TRUE                        18570000
185800         END-IF                                                   18580000
185900     END-IF.                                                      18590000
186000                                                                  18600000
186100 EJECT                                                            18610000
186200*----------------------------------------------------------------*18620000
186300*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *18630000
186400*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *18640000
186500*----------------------------------------------------------------*18650000
186600 2140-DESELECT-ALL-ITEMS.                                         18660000
186700                                                                  18670000
186800     MOVE +1                       TO ASC-BLK-SUB.                18680000
186900                                                                  18690000
187000     PERFORM 2141-CLEAR-SELECTED-INDS                             18700000
187100         VARYING ASC-ITEM-SUB                                     18710000
187200         FROM 1 BY 1                                              18720000
187300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 18730000
187400                                                                  18740000
187500     ADD +1                        TO ASC-BLK-SUB.                18750000
187600                                                                  18760000
187700     PERFORM 2141-CLEAR-SELECTED-INDS                             18770000
187800         VARYING ASC-ITEM-SUB                                     18780000
187900         FROM 1 BY 1                                              18790000
188000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 18800000
188100                                                                  18810000
188200     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               18820000
188300                                   TO PV-LIST-ITEM-NUMBER.        18830000
188400                                                                  18840000
188500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            18850000
188600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    18860000
188700                                                                  18870000
188800     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     18880000
188900        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      18890000
189000         MOVE +1                   TO ASC-BLK-SUB                 18900000
189100                                                                  18910000
189200         PERFORM 5100-WRITE-TEMP-STORAGE                          18920000
189300                                                                  18930000
189400         MOVE +1                   TO PV-BLOCK-NUMBER             18940000
189500                                                                  18950000
189600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         18960000
189700             PV-FIRST-BLOCK-IN-ARRAY - 1                          18970000
189800                                                                  18980000
189900         PERFORM                                                  18990000
190000             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       19000000
190100                                                                  19010000
190200             PERFORM 4410-READ-TEMP-STORAGE                       19020000
190300                                                                  19030000
190400             PERFORM 2141-CLEAR-SELECTED-INDS                     19040000
190500                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 19050000
190600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          19060000
190700                                                                  19070000
190800             PERFORM 5100-WRITE-TEMP-STORAGE                      19080000
190900                                                                  19090000
191000             ADD +1                TO PV-BLOCK-NUMBER             19100000
191100                                                                  19110000
191200         END-PERFORM                                              19120000
191300                                                                  19130000
191400         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         19140000
191500             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     19150000
191600                                                                  19160000
191700         PERFORM                                                  19170000
191800             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       19180000
191900                   ASC-HIGHEST-BLOCK-WRITTEN                      19190000
192000                                                                  19200000
192100             MOVE PV-NEXT-BLOCK-IN-ARRAY                          19210000
192200                                   TO PV-BLOCK-NUMBER             19220000
192300                                                                  19230000
192400             PERFORM 4410-READ-TEMP-STORAGE                       19240000
192500                                                                  19250000
192600             PERFORM 2141-CLEAR-SELECTED-INDS                     19260000
192700                 VARYING ASC-ITEM-SUB                             19270000
192800                 FROM 1 BY 1                                      19280000
192900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          19290000
193000                                                                  19300000
193100             PERFORM 5100-WRITE-TEMP-STORAGE                      19310000
193200                                                                  19320000
193300             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      19330000
193400                                                                  19340000
193500         END-PERFORM                                              19350000
193600                                                                  19360000
193700         MOVE PV-FIRST-BLOCK-IN-ARRAY                             19370000
193800                                   TO PV-BLOCK-NUMBER             19380000
193900                                                                  19390000
194000         PERFORM 4410-READ-TEMP-STORAGE                           19400000
194100     END-IF.                                                      19410000
194200                                                                  19420000
194300                                                                  19430000
194400     MOVE +0                       TO ASC-NUMBER-OF-SELECTED-ITEMS19440000
194500     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.19450000
194600     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  19460000
194700                                                                  19470000
194800                                                                  19480000
194900 EJECT                                                            19490000
195000*----------------------------------------------------------------*19500000
195100*    MARK EACH ITEM AS BEING NOT SELECTED.                       *19510000
195200*----------------------------------------------------------------*19520000
195300                                                                  19530000
195400 2141-CLEAR-SELECTED-INDS.                                        19540000
195500                                                                  19550000
195600     IF  ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)          19560000
195700             NOT EQUAL ZERO                                       19570000
195800         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          19580000
195900             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          19590000
196000                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    19600000
196100                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  19610000
196200                                   TO TRUE                        19620000
196300         END-IF                                                   19630000
196400     END-IF.                                                      19640000
196500                                                                  19650000
196600 EJECT                                                            19660000
196700*----------------------------------------------------------------*19670000
196800*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *19680000
196900*  FOR ALL ITEMS.                                                *19690000
197000*----------------------------------------------------------------*19700000
197100                                                                  19710000
197200 2150-SELECT-ALL-ITEMS.                                           19720000
197300                                                                  19730000
197400     MOVE +1                       TO ASC-BLK-SUB.                19740000
197500     MOVE ZERO                     TO PV-COUNT-ITEMS-SELECTED.    19750000
197600                                                                  19760000
197700     PERFORM 2151-SET-SELECTED-INDS                               19770000
197800         VARYING ASC-ITEM-SUB                                     19780000
197900         FROM 1 BY 1                                              19790000
198000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 19800000
198100                                                                  19810000
198200     ADD +1                        TO ASC-BLK-SUB.                19820000
198300                                                                  19830000
198400     PERFORM 2151-SET-SELECTED-INDS                               19840000
198500         VARYING ASC-ITEM-SUB                                     19850000
198600         FROM 1 BY 1                                              19860000
198700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 19870000
198800                                                                  19880000
198900     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               19890000
199000                                   TO PV-LIST-ITEM-NUMBER.        19900000
199100                                                                  19910000
199200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            19920000
199300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    19930000
199400                                                                  19940000
199500     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     19950000
199600        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    19960000
199700         MOVE +1                   TO ASC-BLK-SUB                 19970000
199800                                                                  19980000
199900         PERFORM 5100-WRITE-TEMP-STORAGE                          19990000
200000                                                                  20000000
200100         MOVE +1                   TO PV-BLOCK-NUMBER             20010000
200200                                                                  20020000
200300         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         20030000
200400             PV-FIRST-BLOCK-IN-ARRAY - 1                          20040000
200500                                                                  20050000
200600         PERFORM                                                  20060000
200700             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       20070000
200800                                                                  20080000
200900             PERFORM 4410-READ-TEMP-STORAGE                       20090000
201000                                                                  20100000
201100             PERFORM 2151-SET-SELECTED-INDS                       20110000
201200                 VARYING ASC-ITEM-SUB                             20120000
201300                 FROM 1 BY 1                                      20130000
201400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          20140000
201500                                                                  20150000
201600             PERFORM 5100-WRITE-TEMP-STORAGE                      20160000
201700                                                                  20170000
201800             ADD +1                TO PV-BLOCK-NUMBER             20180000
201900         END-PERFORM                                              20190000
202000                                                                  20200000
202100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         20210000
202200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     20220000
202300                                                                  20230000
202400         PERFORM                                                  20240000
202500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       20250000
202600                   ASC-HIGHEST-BLOCK-WRITTEN                      20260000
202700                                                                  20270000
202800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          20280000
202900                                   TO PV-BLOCK-NUMBER             20290000
203000                                                                  20300000
203100             PERFORM 4410-READ-TEMP-STORAGE                       20310000
203200                                                                  20320000
203300             PERFORM 2151-SET-SELECTED-INDS                       20330000
203400                 VARYING ASC-ITEM-SUB                             20340000
203500                 FROM 1 BY 1                                      20350000
203600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          20360000
203700                                                                  20370000
203800             PERFORM 5100-WRITE-TEMP-STORAGE                      20380000
203900                                                                  20390000
204000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      20400000
204100         END-PERFORM                                              20410000
204200                                                                  20420000
204300         MOVE PV-FIRST-BLOCK-IN-ARRAY                             20430000
204400                                   TO PV-BLOCK-NUMBER             20440000
204500                                                                  20450000
204600         PERFORM 4410-READ-TEMP-STORAGE                           20460000
204700     END-IF.                                                      20470000
204800                                                                  20480000
204900     MOVE PV-COUNT-ITEMS-SELECTED  TO                             20490000
205000*    MOVE ASC-NUMBER-OF-ITEMS-READ TO                             20500000
205100          ASC-NUMBER-OF-SELECTED-ITEMS.                           20510000
205200                                                                  20520000
205300                                                                  20530000
205400 EJECT                                                            20540000
205500*----------------------------------------------------------------*20550000
205600*    MARK EACH ITEM AS BEING SELECTED.                           *20560000
205700*----------------------------------------------------------------*20570000
205800                                                                  20580000
205900 2151-SET-SELECTED-INDS.                                          20590000
206000                                                                  20600000
206100     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           20610000
206200             NOT EQUAL ZERO                                       20620000
206300          IF PV-COUNT-ITEMS-SELECTED = PC-PO027-CS104-PO-TABLE-MAX20630000
206400            SET DP020-MSG-WARNING       TO TRUE                   20640000
206500            MOVE PC-TSYMSG-02671        TO DP020-MSG-NUMBER       20650000
206600            MOVE PC-PO027-CS104-PO-TABLE-MAX TO PV-MSG-TEXT       20660000
206700            MOVE PV-MSG-TEXT            TO DP020-MSG-TEXT         20670000
206800          ELSE                                                    20680000
206900            IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)           20690000
207000                SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          20700000
207100                    ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)     20710000
207200                    ASC-BLOCK-MODIFIED(ASC-BLK-SUB)               20720000
207300                                      TO TRUE                     20730000
207400            END-IF                                                20740000
207500            ADD +1 TO PV-COUNT-ITEMS-SELECTED                     20750000
207600          END-IF                                                  20760000
207700     END-IF.                                                      20770000
207800                                                                  20780000
207900 EJECT                                                            20790000
208000*----------------------------------------------------------------*20800000
208100*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *20810000
208200*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *20820000
208300*----------------------------------------------------------------*20830000
208400 2200-MOVE-SCREEN-TO-COMMAREA.                                    20840000
208500                                                                  20850000
208600     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             20860000
208700     MOVE +1                       TO PV-SUB.                     20870000
208800                                                                  20880000
208900     PERFORM 3100-SET-SUBSCRIPTS.                                 20890000
209000                                                                  20900000
209100     IF  ASTRTITL > ZERO                                          20910000
209200         MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST      20920000
209300     ELSE                                                         20930000
209400         IF  ASTRTITF = DP015-ERASE-EOF                           20940000
209500             INITIALIZE ASC-START-ITEM-REQUEST                    20950000
209600         END-IF                                                   20960000
209700     END-IF.                                                      20970000
209800                                                                  20980000
209900     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          20990000
210000         VARYING PV-SUB                                           21000000
210100         FROM 1 BY 1                                              21010000
210200         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      21020000
210300                                                                  21030000
210400 EJECT                                                            21040000
210500*----------------------------------------------------------------*21050000
210600*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *21060000
210700*----------------------------------------------------------------*21070000
210800 2210-MOVE-LINES-TO-COMMAREA.                                     21080000
210900                                                                  21090000
211000     IF  MR-SELECTL (PV-SUB) > ZERO                               21100000
211100         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     21110000
211200                                   TO TRUE                        21120000
211300         MOVE MR-SELECT (PV-SUB)   TO ASC-TEMP-SELECTED-SW        21130000
211400                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      21140000
211500     ELSE                                                         21150000
211600         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                21160000
211700             SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE         21170000
211800             MOVE SPACE            TO ASC-TEMP-SELECTED-SW        21180000
211900                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      21190000
212000         END-IF                                                   21200000
212100     END-IF.                                                      21210000
212200                                                                  21220000
212300     ADD +1                        TO ASC-ITEM-SUB.               21230000
212400                                                                  21240000
212500     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        21250000
212600         ADD +1                    TO ASC-BLK-SUB                 21260000
212700         MOVE +1                   TO ASC-ITEM-SUB                21270000
212800     END-IF.                                                      21280000
212900                                                                  21290000
213000 EJECT                                                            21300000
213100*----------------------------------------------------------------*21310000
213200*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *21320000
213300*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *21330000
213400*----------------------------------------------------------------*21340000
213500 3000-EDIT-DATA-IN-COMMAREA.                                      21350000
213600                                                                  21360000
213700     SET PS-NO-ERROR               TO TRUE.                       21370000
213800                                                                  21380000
213900     PERFORM 3200-RESET-ATTRIBUTES.                               21390000
214000                                                                  21400000
214100     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     21410000
214200**                                                                21420000
214300* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              21430000
214400* EDITTING IS DONE FROM THE BOTTOM UP.                            21440000
214500**                                                                21450000
214600     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       21460000
214700         ASC-ITEMS-DISPLAYED - 1.                                 21470000
214800                                                                  21480000
214900     PERFORM 3100-SET-SUBSCRIPTS.                                 21490000
215000     PERFORM 3300-EDIT-SELECTIONS                                 21500000
215100         VARYING PV-SUB                                           21510000
215200         FROM PV-SUB BY -1                                        21520000
215300         UNTIL PV-SUB < +1                                        21530000
215400                                                                  21540000
215500     IF  PS-NO-ERROR                                              21550000
215600         PERFORM 3400-CHECK-RANGE-SEQUENCE                        21560000
215700     END-IF.                                                      21570000
215800                                                                  21580000
215900     IF  ((PS-NO-ERROR)                                           21590000
216000       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   21600000
216100       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    21610000
216200             PERFORM 3500-MARK-RANGE-AS-SELECTED                  21620000
216300     END-IF.                                                      21630000
216400                                                                  21640000
216500 EJECT                                                            21650000
216600*----------------------------------------------------------------*21660000
216700*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *21670000
216800*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*21680000
216900*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *21690000
217000*                                                                *21700000
217100*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *21710000
217200*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *21720000
217300*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *21730000
217400*    US IN THE 2ND BLOCK OF THE ARRAY.                           *21740000
217500*----------------------------------------------------------------*21750000
217600                                                                  21760000
217700 3100-SET-SUBSCRIPTS.                                             21770000
217800                                                                  21780000
217900     COMPUTE ASC-ITEM-SUB =                                       21790000
218000         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        21800000
218100                                                                  21810000
218200     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         21820000
218300         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            21830000
218400                                                                  21840000
218500         MOVE PC-MAX-BLOCKS-IN-ARRAY                              21850000
218600                                   TO ASC-BLK-SUB                 21860000
218700     ELSE                                                         21870000
218800         MOVE +1                   TO ASC-BLK-SUB                 21880000
218900     END-IF.                                                      21890000
219000                                                                  21900000
219100*----------------------------------------------------------------*21910000
219200*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *21920000
219300*----------------------------------------------------------------*21930000
219400                                                                  21940000
219500 3200-RESET-ATTRIBUTES.                                           21950000
219600                                                                  21960000
219700     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   21970000
219800     MOVE DP015-GREEN              TO ASTRTITC.                   21980000
219900     MOVE DP015-UNDERLINE          TO ASTRTITH.                   21990000
220000                                                                  22000000
220100     IF DP020-NEXT-ACT-RETURN                                     22010000
220200     OR DP020-NEXT-ACT-READ-MAP                                   22020000
220300        PERFORM                                                   22030000
220400            VARYING PV-SUB                                        22040000
220500            FROM 1 BY 1                                           22050000
220600            UNTIL PV-SUB > ASC-ITEMS-DISPLAYED                    22060000
220700            MOVE DP015-UNP-ALP-NOR-OFF                            22070000
220800                                      TO MR-SELECTA (PV-SUB)      22080000
220900            MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)      22090000
221000            MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)      22100000
221100        END-PERFORM                                               22110000
221200     ELSE                                                         22120000
221300        PERFORM                                                   22130000
221400            VARYING PV-SUB                                        22140000
221500            FROM 1 BY 1                                           22150000
221600            UNTIL PV-SUB > PC-ITEMS-PER-PANEL                     22160000
221700            MOVE DP015-UNP-ALP-NOR-OFF                            22170000
221800                                      TO MR-SELECTA (PV-SUB)      22180000
221900            MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)      22190000
222000            MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)      22200000
222100        END-PERFORM                                               22210000
222200     END-IF.                                                      22220000
222300                                                                  22230000
222400 EJECT                                                            22240000
222500*----------------------------------------------------------------*22250000
222600*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *22260000
222700*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *22270000
222800*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *22280000
222900*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *22290000
223000*----------------------------------------------------------------*22300000
223100 3300-EDIT-SELECTIONS.                                            22310000
223200                                                                  22320000
223300     EVALUATE TRUE                                                22330000
223400         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     22340000
223500             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         22350000
223600                 CONTINUE                                         22360000
223700                                                                  22370000
223800         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         22380000
223900             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        22390000
224000                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMS22400000
224100                 MOVE ASC-TEMP-SELECTED-SW                        22410000
224200                                     (ASC-BLK-SUB ASC-ITEM-SUB)   22420000
224300                                   TO ASC-SELECTED-SW             22430000
224400                                     (ASC-BLK-SUB ASC-ITEM-SUB)   22440000
224500             END-IF                                               22450000
224600                                                                  22460000
224700         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     22470000
224800                 = SPACE                                          22480000
224900             EVALUATE TRUE                                        22490000
225000                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       22500000
225100                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS22510000
225200                     MOVE SPACE    TO ASC-SELECTED-SW             22520000
225300                                     (ASC-BLK-SUB ASC-ITEM-SUB)   22530000
225400                                                                  22540000
225500                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        22550000
225600                     MOVE ZERO     TO ASC-START-OF-SELECTED-RANGE 22560000
225700                     MOVE SPACE    TO ASC-SELECTED-SW             22570000
225800                                     (ASC-BLK-SUB ASC-ITEM-SUB)   22580000
225900                                                                  22590000
226000                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          22600000
226100                     MOVE ZERO     TO ASC-END-OF-SELECTED-RANGE   22610000
226200                     MOVE SPACE    TO ASC-SELECTED-SW             22620000
226300                                     (ASC-BLK-SUB ASC-ITEM-SUB)   22630000
226400             END-EVALUATE                                         22640000
226500                                                                  22650000
226600         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           22660000
226700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            22670000
226800                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    22680000
226900             END-IF                                               22690000
227000             PERFORM 3310-EDIT-RANGE                              22700000
227100                                                                  22710000
227200         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             22720000
227300             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            22730000
227400                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    22740000
227500             END-IF                                               22750000
227600             PERFORM 3310-EDIT-RANGE                              22760000
227700                                                                  22770000
227800         WHEN OTHER                                               22780000
227900             MOVE PC-TSYMSG-00005  TO DP020-MSG-NUMBER            22790000
228000             SET DP020-MSG-FATAL   TO TRUE                        22800000
228100             MOVE -1               TO MR-SELECTL (PV-SUB)         22810000
228200             SET DP030-SET-CURSOR-APPL-1                          22820000
228300                                   TO TRUE                        22830000
228400             MOVE DP015-RED        TO MR-SELECTC (PV-SUB)         22840000
228500             MOVE DP015-REVERSE    TO MR-SELECTH (PV-SUB)         22850000
228600             SET PS-ERROR          TO TRUE                        22860000
228700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            22870000
228800                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     22880000
228900                 MOVE SPACE        TO ASC-SELECTED-SW             22890000
229000                                     (ASC-BLK-SUB ASC-ITEM-SUB)   22900000
229100             END-IF                                               22910000
229200     END-EVALUATE.                                                22920000
229300                                                                  22930000
229400     SUBTRACT +1 FROM PV-ITEM-IN-USE.                             22940000
229500     SUBTRACT +1 FROM ASC-ITEM-SUB.                               22950000
229600                                                                  22960000
229700     IF  ASC-ITEM-SUB < 1                                         22970000
229800         SUBTRACT +1 FROM ASC-BLK-SUB                             22980000
229900         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                22990000
230000     END-IF.                                                      23000000
230100                                                                  23010000
230200*----------------------------------------------------------------*23020000
230300*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *23030000
230400*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *23040000
230500*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *23050000
230600*  THE ENDING.                                                   *23060000
230700*----------------------------------------------------------------*23070000
230800 3310-EDIT-RANGE.                                                 23080000
230900                                                                  23090000
231000     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                23100000
231100         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   23110000
231200             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)23120000
231300                                   TO ASC-SELECTED-SW             23130000
231400                                        (ASC-BLK-SUB ASC-ITEM-SUB)23140000
231500             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 23150000
231600         ELSE                                                     23160000
231700             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     23170000
231800                 CONTINUE                                         23180000
231900             ELSE                                                 23190000
232000*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        23200000
232100                 MOVE PC-TSYMSG-00054                             23210000
232200                                   TO DP020-MSG-NUMBER            23220000
232300                 SET DP020-MSG-FATAL                              23230000
232400                                   TO TRUE                        23240000
232500                 MOVE -1           TO MR-SELECTL (PV-SUB)         23250000
232600                 SET DP030-SET-CURSOR-APPL-1                      23260000
232700                                   TO TRUE                        23270000
232800                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         23280000
232900                 MOVE DP015-UNDERLINE                             23290000
233000                                   TO MR-SELECTH (PV-SUB)         23300000
233100                 SET PS-ERROR      TO TRUE                        23310000
233200             END-IF                                               23320000
233300         END-IF                                                   23330000
233400     ELSE                                                         23340000
233500         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     23350000
233600             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 23360000
233700                                   TO ASC-SELECTED-SW             23370000
233800                                     (ASC-BLK-SUB ASC-ITEM-SUB)   23380000
233900             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   23390000
234000         ELSE                                                     23400000
234100             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       23410000
234200                 CONTINUE                                         23420000
234300             ELSE                                                 23430000
234400*                -- ONLY ONE END-OF-RANGE ALLOWED --              23440000
234500                 MOVE PC-TSYMSG-00055                             23450000
234600                                   TO DP020-MSG-NUMBER            23460000
234700                 SET DP020-MSG-FATAL                              23470000
234800                                   TO TRUE                        23480000
234900                 MOVE -1           TO MR-SELECTL (PV-SUB)         23490000
235000                 SET DP030-SET-CURSOR-APPL-1                      23500000
235100                                   TO TRUE                        23510000
235200                 SET PS-ERROR      TO TRUE                        23520000
235300             END-IF                                               23530000
235400         END-IF                                                   23540000
235500     END-IF.                                                      23550000
235600                                                                  23560000
235700*----------------------------------------------------------------*23570000
235800*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *23580000
235900*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *23590000
236000*----------------------------------------------------------------*23600000
236100 3400-CHECK-RANGE-SEQUENCE.                                       23610000
236200                                                                  23620000
236300     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       23630000
236400       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      23640000
236500       AND  ASC-START-OF-SELECTED-RANGE >                         23650000
236600                                         ASC-END-OF-SELECTED-RANGE23660000
236700*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                23670000
236800         MOVE PC-TSYMSG-00052      TO DP020-MSG-NUMBER            23680000
236900         SET DP020-MSG-FATAL       TO TRUE                        23690000
237000         SET PS-ERROR              TO TRUE                        23700000
237100         PERFORM 3410-POSITION-AT-ERROR                           23710000
237200     END-IF.                                                      23720000
237300                                                                  23730000
237400*----------------------------------------------------------------*23740000
237500*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *23750000
237600*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *23760000
237700*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *23770000
237800*----------------------------------------------------------------*23780000
237900 3410-POSITION-AT-ERROR.                                          23790000
238000                                                                  23800000
238100     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       23810000
238200                                                                  23820000
238300     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 23830000
238400                    - PV-TOP-ITEM + 1.                            23840000
238500                                                                  23850000
238600     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      23860000
238700         CONTINUE                                                 23870000
238800     ELSE                                                         23880000
238900         MOVE -1                   TO MR-SELECTL (PV-SUB)         23890000
239000         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         23900000
239100         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         23910000
239200     END-IF.                                                      23920000
239300                                                                  23930000
239400     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   23940000
239500                    - PV-TOP-ITEM + 1.                            23950000
239600                                                                  23960000
239700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      23970000
239800         CONTINUE                                                 23980000
239900     ELSE                                                         23990000
240000         MOVE -1                   TO MR-SELECTL (PV-SUB)         24000000
240100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         24010000
240200         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         24020000
240300     END-IF.                                                      24030000
240400                                                                  24040000
240500 EJECT                                                            24050000
240600*----------------------------------------------------------------*24060000
240700*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *24070000
240800*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *24080000
240900*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *24090000
241000*----------------------------------------------------------------*24100000
241100                                                                  24110000
241200 3500-MARK-RANGE-AS-SELECTED.                                     24120000
241300                                                                  24130000
241400     MOVE +1                       TO ASC-BLK-SUB.                24140000
241500                                                                  24150000
241600     PERFORM 3510-MARK-SELECTED-INDS                              24160000
241700         VARYING ASC-ITEM-SUB                                     24170000
241800         FROM 1 BY 1                                              24180000
241900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 24190000
242000                                                                  24200000
242100     ADD +1                        TO ASC-BLK-SUB.                24210000
242200                                                                  24220000
242300     PERFORM 3510-MARK-SELECTED-INDS                              24230000
242400         VARYING ASC-ITEM-SUB                                     24240000
242500         FROM 1 BY 1                                              24250000
242600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 24260000
242700                                                                  24270000
242800     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               24280000
242900                                   TO PV-LIST-ITEM-NUMBER.        24290000
243000                                                                  24300000
243100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            24310000
243200         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         24320000
243300               PC-ITEMS-PER-PANEL).                               24330000
243400                                                                  24340000
243500     MOVE ASC-START-OF-SELECTED-RANGE                             24350000
243600                                   TO PV-START-OF-SELECTED-RANGE. 24360000
243700                                                                  24370000
243800     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            24380000
243900         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  24390000
244000               PC-ITEMS-PER-PANEL).                               24400000
244100                                                                  24410000
244200     MOVE ASC-END-OF-SELECTED-RANGE                               24420000
244300                                   TO PV-END-OF-SELECTED-RANGE.   24430000
244400                                                                  24440000
244500     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             24450000
244600         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    24460000
244700               PC-ITEMS-PER-PANEL).                               24470000
244800                                                                  24480000
244900     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             24490000
245000         PV-FIRST-BLOCK-IN-ARRAY + 1.                             24500000
245100                                                                  24510000
245200     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    24520000
245300        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        24530000
245400         MOVE +1                   TO ASC-BLK-SUB                 24540000
245500         PERFORM 5100-WRITE-TEMP-STORAGE                          24550000
245600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         24560000
245700             PV-FIRST-BLOCK-IN-ARRAY - 1                          24570000
245800                                                                  24580000
245900         PERFORM                                                  24590000
246000             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      24600000
246100                   PV-PREV-BLOCK-IN-ARRAY                         24610000
246200             MOVE PV-FIRST-BLOCK-IN-RANGE                         24620000
246300                                   TO PV-BLOCK-NUMBER             24630000
246400             PERFORM 4410-READ-TEMP-STORAGE                       24640000
246500             PERFORM 3510-MARK-SELECTED-INDS                      24650000
246600                 VARYING ASC-ITEM-SUB                             24660000
246700                 FROM 1 BY 1                                      24670000
246800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          24680000
246900             PERFORM 5100-WRITE-TEMP-STORAGE                      24690000
247000             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     24700000
247100         END-PERFORM                                              24710000
247200                                                                  24720000
247300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         24730000
247400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     24740000
247500         PERFORM                                                  24750000
247600             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       24760000
247700                   PV-LAST-BLOCK-IN-RANGE                         24770000
247800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          24780000
247900                                   TO PV-BLOCK-NUMBER             24790000
248000             PERFORM 4410-READ-TEMP-STORAGE                       24800000
248100             PERFORM 3510-MARK-SELECTED-INDS                      24810000
248200                 VARYING ASC-ITEM-SUB                             24820000
248300                 FROM 1 BY 1                                      24830000
248400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          24840000
248500             PERFORM 5100-WRITE-TEMP-STORAGE                      24850000
248600             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      24860000
248700         END-PERFORM                                              24870000
248800                                                                  24880000
248900         MOVE PV-FIRST-BLOCK-IN-ARRAY                             24890000
249000                                   TO PV-BLOCK-NUMBER             24900000
249100         PERFORM 4410-READ-TEMP-STORAGE                           24910000
249200     END-IF.                                                      24920000
249300                                                                  24930000
249400     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 24940000
249500                                      ASC-END-OF-SELECTED-RANGE.  24950000
249600                                                                  24960000
249700 EJECT                                                            24970000
249800*----------------------------------------------------------------*24980000
249900* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *24990000
250000*----------------------------------------------------------------*25000000
250100                                                                  25010000
250200 3510-MARK-SELECTED-INDS.                                         25020000
250300                                                                  25030000
250400     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) >         25040000
250500         ASC-START-OF-SELECTED-RANGE)                             25050000
250600     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =         25060000
250700         ASC-START-OF-SELECTED-RANGE)                             25070000
250800                                                                  25080000
250900         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) <     25090000
251000             ASC-END-OF-SELECTED-RANGE)                           25100000
251100         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =     25110000
251200             ASC-END-OF-SELECTED-RANGE)                           25120000
251300                                                                  25130000
251400             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          25140000
251500                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   25150000
251600                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   25160000
251700                                   TO TRUE                        25170000
251800                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              25180000
251900                                   TO TRUE                        25190000
252000                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMS25200000
252100             END-IF                                               25210000
252200         END-IF                                                   25220000
252300     END-IF.                                                      25230000
252400                                                                  25240000
252500*----------------------------------------------------------------*25250000
252600*    CHECK TO SEE IF THE PO IS ALREADY ASSIGNED TO A SEASONAL SET*25260000
252700*----------------------------------------------------------------*25270000
252800                                                                  25280000
252900 3520-CHECK-IF-SEASET.                                            25290000
253000                                                                  25300000
253100     EXEC SQL                                                     25310000
253200         SELECT SEASET_SHRT_NM                                    25320000
253300           INTO :PURCHS-SEASET-SHRT-NM                            25330000
253400         FROM TPURCHS                                             25340000
253500           WHERE PO_NBR = :PV-PO-NBR-B                            25350000
253600             AND VER_STATUS_CDE = 'A'                             25360000
253700             AND PO_CATEG_CDE = 'MR'                              25370000
253800     END-EXEC.                                                    25380000
253900                                                                  25390000
254000     EVALUATE TRUE                                                25400000
254100         WHEN SQLCODE = +0                                        25410000
254200         WHEN SQLCODE = -904                                      25420000
254300         WHEN SQLCODE = -913                                      25430000
254400             CONTINUE                                             25440000
254500         WHEN SQLWARN0 NOT = SPACE                                25450000
254600         WHEN SQLCODE < +0                                        25460000
254700         WHEN SQLCODE > +0                                        25470000
254800             MOVE '3520-CHECK-IF-SEASET' TO DP013-PARAGRAPH       25480000
254900             MOVE 'SELECT ON PURCHASE HEADER TABLE'               25490000
255000               TO DP013-MESSAGE-TEXT(1)                           25500000
255100             MOVE SQLCA TO DP013-SQLCA                            25510000
255200             MOVE 'TPURCHS' TO DP013-DB2-TABLE-NAME (1)           25520000
255300               SET DP013-DB2-ABEND                                25530000
255400                   DP013-XCTL-DISPLAY-RESTART                     25540000
255500                     TO TRUE                                      25550000
255600             PERFORM DP013-0000-PROCESS-ABEND                     25560000
255700         END-EVALUATE.                                            25570000
255800                                                                  25580000
255900                                                                  25590000
256000 EJECT                                                            25600000
256100*----------------------------------------------------------------*25610000
256200*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *25620000
256300*    INITIALIZE ALL COUNTERS AND FLAGS.                          *25630000
256400*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *25640000
256500*    DISPLAY THE PANEL TO USER.                                  *25650000
256600*----------------------------------------------------------------*25660000
256700                                                                  25670000
256800 4000-BUILD-INITIAL-PANEL.                                        25680000
256900                                                                  25690000
257000     INITIALIZE ASC-BLOCK-ENTRIES (1)                             25700000
257100                ASC-BLOCK-ENTRIES (2).                            25710000
257200                                                                  25720000
257300     MOVE +1                       TO ASC-BLK-SUB                 25730000
257400                                      PV-STRING-POINTER-FROM      25740000
257500                                      PV-STRING-POINTER-WHERE.    25750000
257600                                                                  25760000
257700     SET ASC-ITEMS-LEFT-ON-DB      TO TRUE.                       25770000
257800                                                                  25780000
257900     MOVE +0                       TO ASC-ITEM-SUB                25790000
258000                                      ASC-NUMBER-OF-ITEMS-READ    25800000
258100                                      ASC-NUMBER-OF-SELECTED-ITEMS25810000
258200                                      ASC-HIGHEST-BLOCK-WRITTEN   25820000
258300                                      ASC-START-OF-SELECTED-RANGE 25830000
258400                                      ASC-END-OF-SELECTED-RANGE   25840000
258500                                      ASC-UNIT-ORD-TOT            25850049
258600                                      ASC-ITEM-AT-TOP-OF-PANEL.   25860000
258700                                                                  25870000
258800     EXEC CICS ASSIGN                                             25880000
258900               APPLID(PV-SYSTEM-ID)                               25890000
259000     END-EXEC.                                                    25900000
259100                                                                  25910000
259200*    IF  PV-TEST-CICS                                             25920062
259300*      MOVE '04'          TO PV-QUALIFIER                         25930062
259400*                            PV-QUALIFIER-COMMA                   25940062
259500*    ELSE                                                         25950062
259600       MOVE PV-REGION-IND TO PV-QUALIFIER                         25960000
259700                             PV-QUALIFIER-COMMA                   25970051
259800*    END-IF.                                                      25980062
259900     MOVE SPACES        TO PV-FROM-CLAUSE                         25990000
260000                           PV-WHERE-CLAUSE.                       26000000
260100                                                                  26010000
260200     PERFORM 4100-BUILD-CURSOR.                                   26020000
260300     PERFORM 4150-COMBINE-SQL.                                    26030000
260400                                                                  26040000
260500     MOVE ZERO TO PV-COUNT-ITEMS-READ.                            26050000
260600     PERFORM 4010-DECLARE-CURSOR.                                 26060000
260700     PERFORM 4020-PREPARE-CURSOR.                                 26070000
260800     PERFORM 4030-OPEN-CURSOR.                                    26080000
260900                                                                  26090000
261000     PERFORM 4300-READ-ITEMS-FROM-DB.                             26100000
261100                                                                  26110000
261200     PERFORM 4040-CLOSE-CURSOR.                                   26120000
261300                                                                  26130000
261400     IF PV-COUNT-ITEMS-READ > PC-PO027-CS104-PO-TABLE-MAX         26140000
261500       SET DP020-MSG-INFORMATIONAL TO TRUE                        26150000
261600       MOVE PC-TSYMSG-02670 TO DP020-MSG-NUMBER                   26160000
261700       MOVE PC-PO027-CS104-PO-TABLE-MAX TO PV-MSG-TEXT            26170000
261800       MOVE PV-MSG-TEXT TO DP020-MSG-TEXT                         26180000
261900     END-IF.                                                      26190000
262000                                                                  26200000
262100     MOVE +1                       TO PV-TOP-ITEM.                26210000
262200                                                                  26220000
262300     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          26230000
262400         SET DP020-NEXT-ACT-APPL-ERROR                            26240000
262500                                   TO TRUE                        26250000
262600         SET DP020-MSG-FATAL       TO TRUE                        26260000
262700         MOVE PC-TSYMSG-00050      TO DP020-MSG-NUMBER            26270000
262800     ELSE                                                         26280000
262900         MOVE -1                   TO MR-SELECTL (1)              26290000
263000         SET DP030-SET-CURSOR-APPL-1                              26300000
263100                                   TO TRUE                        26310000
263200         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     26320000
263300     END-IF.                                                      26330000
263400                                                                  26340000
263500     MOVE ASC-SET-YEAR             TO ASETYRO.                    26350000
263600     MOVE ASC-SET-SHORT-NME        TO ASETNMEO.                   26360000
263700                                                                  26370000
263800 EJECT                                                            26380000
263900*----------------------------------------------------------------*26390000
264000* DECLARE THE CURSOR FOR DYNAMIC SQL CALL                        *26400000
264100*----------------------------------------------------------------*26410000
264200 4010-DECLARE-CURSOR.                                             26420000
264300                                                                  26430000
264400     EXEC SQL                                                     26440000
264500         DECLARE PO-CSR CURSOR FOR                                26450000
264600                 PO-SELECT                                        26460000
264700     END-EXEC.                                                    26470000
264701                                                                  26470185
264710     EVALUATE TRUE                                                26471085
264720         WHEN SQLCODE = +0                                        26472085
264730              CONTINUE                                            26473085
264740     END-EVALUATE.                                                26474085
264800                                                                  26480000
264900 EJECT                                                            26490000
265000*----------------------------------------------------------------*26500000
265100* OPEN THE PO CURSOR                                             *26510000
265200*----------------------------------------------------------------*26520000
265300 4020-PREPARE-CURSOR.                                             26530000
265400                                                                  26540000
265500     EXEC SQL                                                     26550000
265600         PREPARE PO-SELECT FROM :PV-SQL-STMT                      26560000
265700     END-EXEC.                                                    26570000
265800                                                                  26580000
265900     EVALUATE TRUE                                                26590000
266000         WHEN SQLCODE = +0                                        26600000
266100              CONTINUE                                            26610000
266200         WHEN SQLCODE = -206                                      26620000
266300           SET PS-206-PURITM         TO TRUE                      26630000
266400         WHEN SQLWARN0 NOT = SPACE                                26640000
266500         WHEN SQLCODE  NOT = 0                                    26650000
266600              MOVE '4020-PREPARE-CURSOR'                          26660000
266700                               TO DP013-PARAGRAPH                 26670000
266800              MOVE 'PREPARE PO-CSR    '                           26680000
266900                               TO DP013-MESSAGE-TEXT (1)          26690000
267000              MOVE SQLCA       TO DP013-SQLCA                     26700000
267100              MOVE 'TPURCHS'   TO DP013-DB2-TABLE-NAME (1)        26710000
267200              MOVE 'TPURITM'   TO DP013-DB2-TABLE-NAME (2)        26720000
267300              MOVE 'TPLNSHP'   TO DP013-DB2-TABLE-NAME (3)        26730000
267400              MOVE 'TSTATCD'   TO DP013-DB2-TABLE-NAME (4)        26740000
267500              SET DP013-DB2-ABEND                                 26750000
267600                               TO TRUE                            26760000
267700              PERFORM DP013-0000-PROCESS-ABEND                    26770000
267800     END-EVALUATE.                                                26780000
267900 EJECT                                                            26790000
268000*----------------------------------------------------------------*26800000
268100* OPEN THE PO CURSOR                                             *26810000
268200*----------------------------------------------------------------*26820000
268300                                                                  26830000
268400 4030-OPEN-CURSOR.                                                26840000
268500                                                                  26850000
268600     PERFORM                                                      26860000
268700         WITH TEST AFTER                                          26870000
268800         VARYING PV-RETRY-COUNTER                                 26880000
268900         FROM 1 BY 1                                              26890000
269000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               26900000
269100            OR (SQLCODE = +0))                                    26910000
269200                                                                  26920000
269300         EXEC SQL                                                 26930000
269400             OPEN PO-CSR                                          26940000
269500         END-EXEC                                                 26950000
269600                                                                  26960000
269700         EVALUATE TRUE                                            26970000
269800             WHEN SQLCODE = +0                                    26980000
269900                  CONTINUE                                        26990000
270000             WHEN SQLCODE = -904                                  27000000
270100             WHEN SQLCODE = -913                                  27010000
270200                  CONTINUE                                        27020000
270300             WHEN SQLWARN0 NOT = SPACE                            27030000
270400             WHEN SQLCODE  NOT = +0                               27040000
270500                  MOVE '4010-OPEN-CURSOR'                         27050000
270600                                   TO DP013-PARAGRAPH             27060000
270700                  MOVE 'OPEN PO-CSR CURSOR'                       27070000
270800                                   TO DP013-MESSAGE-TEXT (1)      27080000
270900                  MOVE SQLCA       TO DP013-SQLCA                 27090000
271000                  MOVE 'TPURCHS'   TO DP013-DB2-TABLE-NAME (1)    27100000
271100                  MOVE 'TPURITM'   TO DP013-DB2-TABLE-NAME (2)    27110000
271200                  MOVE 'TPLNSHP'   TO DP013-DB2-TABLE-NAME (3)    27120000
271300                  MOVE 'TENTNME'   TO DP013-DB2-TABLE-NAME (4)    27130000
271400                  MOVE 'XLT_SKU'   TO DP013-DB2-TABLE-NAME (5)    27140000
271500                  SET DP013-DB2-ABEND                             27150000
271600                                   TO TRUE                        27160000
271700                  PERFORM DP013-0000-PROCESS-ABEND                27170000
271800         END-EVALUATE                                             27180000
271900     END-PERFORM.                                                 27190000
272000                                                                  27200000
272100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        27210000
272200         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             27220000
272300         MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'              27230000
272400                                   TO DP013-MESSAGE-TEXT (1)      27240000
272500         MOVE SQLCA                TO DP013-SQLCA                 27250000
272600         SET DP013-DB2-ABEND       TO TRUE                        27260000
272700         PERFORM DP013-0000-PROCESS-ABEND                         27270000
272800     END-IF.                                                      27280000
272900                                                                  27290000
273000 EJECT                                                            27300000
273100*----------------------------------------------------------------*27310000
273200* CLOSE THE PO CURSOR                                            *27320000
273300*----------------------------------------------------------------*27330000
273400                                                                  27340000
273500 4040-CLOSE-CURSOR.                                               27350000
273600                                                                  27360000
273700     EXEC SQL                                                     27370000
273800         CLOSE PO-CSR                                             27380000
273900     END-EXEC.                                                    27390000
274000                                                                  27400000
274100     EVALUATE TRUE                                                27410000
274200         WHEN SQLCODE = +0                                        27420000
274300              CONTINUE                                            27430000
274400         WHEN SQLWARN0 NOT = SPACE                                27440000
274500         WHEN SQLCODE  NOT = +0                                   27450000
274600              MOVE '4020-CLOSE-CURSOR'                            27460000
274700                                   TO DP013-PARAGRAPH             27470000
274800              MOVE 'CLOSE PO-CSR CURSOR'                          27480000
274900                                   TO DP013-MESSAGE-TEXT (1)      27490000
275000              MOVE SQLCA           TO DP013-SQLCA                 27500000
275100              MOVE 'TPURCHS'       TO DP013-DB2-TABLE-NAME (1)    27510000
275200              MOVE 'TPURITM'       TO DP013-DB2-TABLE-NAME (2)    27520000
275300              MOVE 'TPLNSHP'       TO DP013-DB2-TABLE-NAME (3)    27530000
275400              MOVE 'TENTNME'       TO DP013-DB2-TABLE-NAME (4)    27540000
275500              MOVE 'XLT_SKU'       TO DP013-DB2-TABLE-NAME (5)    27550000
275600              SET DP013-DB2-ABEND  TO TRUE                        27560000
275700              PERFORM DP013-0000-PROCESS-ABEND                    27570000
275800     END-EVALUATE.                                                27580000
275900                                                                  27590000
276000 EJECT                                                            27600000
276100*----------------------------------------------------------------*27610000
276200*    DEPENDING ON WHAT WAS PASSED IN THE COMMAREA, SETUP THE     *27620000
276300*    DB2 KEYS IN PREPARATION FOR THE OPEN CURSROR.               *27630000
276400*----------------------------------------------------------------*27640000
276500                                                                  27650000
276600 4100-BUILD-CURSOR.                                               27660000
276700                                                                  27670000
276800     IF  ASC-KEY-PO-NBR > ZEROS                                   27680000
276900         PERFORM 4106-PO-NBR.                                     27690000
277000                                                                  27700000
277100     IF  ASC-KEY-IMPRT-AGNT-PO-NBR > ZEROES                       27710000
277200         PERFORM 4101-IMPRT-AGNT-PO-NBR.                          27720000
277300                                                                  27730000
277400     IF  ASC-KEY-DEPT-NBR > SPACES                                27740000
277500         PERFORM 4102-DEPT-NBR.                                   27750000
277600                                                                  27760000
277700     IF  ASC-KEY-PO-TYP-CDE > SPACES                              27770000
277800         PERFORM 4103-PO-TYP-CDE.                                 27780000
277900                                                                  27790000
278000     IF  ASC-KEY-STATUS-CDE > SPACES                              27800000
278100         PERFORM 4104-STATUS-CDE.                                 27810000
278200                                                                  27820000
278300     IF  ASC-KEY-STATUS-CLS > SPACES                              27830000
278400         PERFORM 4105-STATUS-CLS.                                 27840000
278500                                                                  27850000
278600     IF  ASC-KEY-NEW-STR-IND > SPACES                             27860000
278700         PERFORM 4108-NEW-STR-IND.                                27870000
278800                                                                  27880000
278900     IF  ASC-KEY-SKU-NBR NOT = ZERO                               27890000
279000         SET PS-USE-TPURITM TO TRUE                               27900000
279100         PERFORM 4111-SKU-NBR                                     27910000
279200     ELSE                                                         27920000
279300         IF  ASC-KEY-MAJ-CL-NBR NOT = ZERO                        27930000
279400             SET PS-USE-TPURITM TO TRUE                           27940000
279500             PERFORM 4110-MAJ-CL-NBR                              27950000
279600         END-IF                                                   27960000
279700         IF  ASC-KEY-SUB-CL-NBR NOT = ZERO                        27970000
279800             SET PS-USE-TPURITM TO TRUE                           27980000
279900             PERFORM 4109-SUB-CL-NBR                              27990000
280000         END-IF                                                   28000000
280100     END-IF.                                                      28010000
280200                                                                  28020000
280300     IF  ASC-KEY-AD-EVNT-DTE > SPACES                             28030000
280400         SET PS-USE-TPURITM TO TRUE                               28040000
280500         PERFORM 4112-AD-EVNT-DTE.                                28050000
280600                                                                  28060000
280700     IF  ASC-KEY-OTB-PER-NBR-BEG > SPACES AND                     28070000
280800         ASC-KEY-OTB-PER-NBR-END > SPACES                         28080000
280900         IF ASC-KEY-OTB-PER-NBR-BEG = ASC-KEY-OTB-PER-NBR-END     28090000
281000            IF ASC-KEY-OTB-PER-NBR-BEG < '199903'                 28100000
281100               MOVE '199903'  TO ASC-KEY-OTB-PER-NBR-BEG          28110000
281200            END-IF                                                28120000
281300            PERFORM 4113-OTB-PER-ONE                              28130000
281400         ELSE                                                     28140000
281500            IF ASC-KEY-OTB-PER-NBR-BEG < '199903'                 28150000
281600               MOVE '199903'  TO ASC-KEY-OTB-PER-NBR-BEG          28160000
281700            END-IF                                                28170000
281800            IF ASC-KEY-OTB-PER-NBR-END < '199903'                 28180000
281900               MOVE '199903'  TO ASC-KEY-OTB-PER-NBR-END          28190000
282000            END-IF                                                28200000
282100            PERFORM 4114-OTB-PER-NBR-BEG-END                      28210000
282200         END-IF                                                   28220000
282300     ELSE                                                         28230000
282400        IF  ASC-KEY-OTB-PER-NBR-BEG > SPACES                      28240000
282500            MOVE HIGH-VALUES TO ASC-KEY-OTB-PER-NBR-END           28250000
282600            IF ASC-KEY-OTB-PER-NBR-BEG < '199903'                 28260000
282700               MOVE '199903' TO ASC-KEY-OTB-PER-NBR-BEG           28270000
282800            END-IF                                                28280000
282900            PERFORM 4115-OTB-PER-BEG                              28290000
283000        ELSE                                                      28300000
283100           IF  ASC-KEY-OTB-PER-NBR-END > SPACES                   28310000
283200               MOVE '199903'     TO ASC-KEY-OTB-PER-NBR-BEG       28320000
283300               IF ASC-KEY-OTB-PER-NBR-END < '199903'              28330000
283400                   MOVE '199903' TO ASC-KEY-OTB-PER-NBR-END       28340000
283500               END-IF                                             28350000
283600               PERFORM 4116-OTB-PER-END                           28360000
283700           ELSE                                                   28370000
283800               MOVE '199903'    TO ASC-KEY-OTB-PER-NBR-BEG        28380000
283900               MOVE '999999'    TO ASC-KEY-OTB-PER-NBR-END        28390000
284000               PERFORM 4116-OTB-PER-END                           28400000
284100           END-IF                                                 28410000
284200        END-IF                                                    28420000
284300     END-IF.                                                      28430000
284400                                                                  28440000
284500     IF  ASC-KEY-DONT-SHIP-BEF-DTE-B > SPACES AND                 28450000
284600         ASC-KEY-DONT-SHIP-BEF-DTE-E > SPACES                     28460000
284700         IF ASC-KEY-DONT-SHIP-BEF-DTE-B =                         28470000
284800            ASC-KEY-DONT-SHIP-BEF-DTE-E                           28480000
284900            PERFORM 4117-DONT-SHIP-BEF-DTE-ONE                    28490000
285000         ELSE                                                     28500000
285100            PERFORM 4118-DONT-SHIP-BEF-DTE-B-E                    28510000
285200         END-IF                                                   28520000
285300     ELSE                                                         28530000
285400        IF  ASC-KEY-DONT-SHIP-BEF-DTE-B > SPACES                  28540000
285500            PERFORM 4117-DONT-SHIP-BEF-DTE-ONE                    28550068
285600        ELSE                                                      28560000
285700           IF  ASC-KEY-DONT-SHIP-BEF-DTE-E > SPACES               28570000
285800               PERFORM 4119-CAN-IFNOT-SHP-DTE-ONE                 28580069
285900           END-IF                                                 28590000
286000        END-IF                                                    28600000
286100     END-IF.                                                      28610000
286200                                                                  28620000
286300     IF  ASC-KEY-ENT-NAME-DESC > SPACES                           28630000
286400         SET PS-USE-TENTNME TO TRUE                               28640000
286500         PERFORM 4121-ENT-NAME-DESC.                              28650000
286600                                                                  28660000
286700     IF  ASC-KEY-VEND-STYL-NME > SPACES                           28670000
286800         SET PS-USE-TPURITM TO TRUE                               28680000
286900         PERFORM 4122-VEND-STYL-NME.                              28690000
287000                                                                  28700000
287100     STRING                                                       28710000
287200         ' AND A.VER_STATUS_CDE = '           DELIMITED BY SIZE,  28720000
287300         PC-QUOTE                             DELIMITED BY SIZE,  28730000
287400         'A'                                  DELIMITED BY SIZE,  28740000
287500         PC-QUOTE                             DELIMITED BY SIZE,  28750000
287600                                                                  28760000
287700         ' AND C.VER_STATUS_CDE = '           DELIMITED BY SIZE,  28770000
287800         PC-QUOTE                             DELIMITED BY SIZE,  28780000
287900         'A'                                  DELIMITED BY SIZE,  28790000
288000         PC-QUOTE                             DELIMITED BY SIZE,  28800000
288100                                                                  28810000
288200         ' AND A.PO_CATEG_CDE = '             DELIMITED BY SIZE,  28820000
288300         PC-QUOTE                             DELIMITED BY SIZE,  28830000
288400         'MR'                                 DELIMITED BY SIZE,  28840000
288500         PC-QUOTE                             DELIMITED BY SIZE,  28850000
288600                                                                  28860000
288700         ' AND A.PO_NBR = C.PO_NBR'           DELIMITED BY SIZE,  28870000
288800                                                                  28880000
288900         ' AND E.STATUS_TYP_CDE = '           DELIMITED BY SIZE,  28890000
289000         PC-QUOTE                             DELIMITED BY SIZE,  28900000
289100         'P'                                  DELIMITED BY SIZE,  28910000
289200         PC-QUOTE                             DELIMITED BY SIZE,  28920000
289300                                                                  28930000
289400         ' AND A.STATUS_CDE = E.STATUS_CDE'   DELIMITED BY SIZE   28940000
289500     INTO                                                         28950000
289600         PV-WHERE-CLAUSE                                          28960000
289700     WITH                                                         28970000
289800         POINTER PV-STRING-POINTER-WHERE.                         28980000
289900                                                                  28990000
290000     IF PS-USE-TPURITM OR PS-206-PURITM                           29000000
290100        STRING                                                    29010000
290200            ' AND B.VER_STATUS_CDE = '        DELIMITED BY SIZE,  29020000
290300            PC-QUOTE                          DELIMITED BY SIZE,  29030000
290400            'A'                               DELIMITED BY SIZE,  29040000
290500            PC-QUOTE                          DELIMITED BY SIZE,  29050000
290600                                                                  29060000
290700            ' AND A.PO_NBR = B.PO_NBR'        DELIMITED BY SIZE,  29070061
290800        INTO                                                      29080000
290900            PV-WHERE-CLAUSE                                       29090000
291000        WITH                                                      29100000
291100            POINTER PV-STRING-POINTER-WHERE.                      29110000
291200                                                                  29120000
291300     IF PS-USE-TENTNME                                            29130000
291400        STRING                                                    29140000
291500            ' AND A.ENT_ID = D.ENT_ID'        DELIMITED BY SIZE   29150000
291600        INTO                                                      29160000
291700            PV-WHERE-CLAUSE                                       29170000
291800        WITH                                                      29180000
291900            POINTER PV-STRING-POINTER-WHERE.                      29190000
292000                                                                  29200000
292100     STRING                                                       29210000
292200         ' ORDER BY'                          DELIMITED BY SIZE,  29220000
292300         ' A.OTB_PER_NBR DESC'                DELIMITED BY SIZE,  29230000
292400         ',A.ENT_ID'                          DELIMITED BY SIZE,  29240000
292500         ',A.DEPT_NBR'                        DELIMITED BY SIZE,  29250000
292600         ',C.DONT_SHIP_BEF_DTE DESC'          DELIMITED BY SIZE,  29260000
292700         ',A.PO_NBR'                          DELIMITED BY SIZE   29270000
292800     INTO                                                         29280000
292900         PV-WHERE-CLAUSE                                          29290000
293000     WITH                                                         29300000
293100         POINTER PV-STRING-POINTER-WHERE.                         29310000
293200                                                                  29320000
293300* THE FOLLOWING CODE WILL SETUP THE FROM CLAUSE                   29330000
293400                                                                  29340000
293500     STRING                                                       29350000
293600         PV-TABLE-QUALIFIER                   DELIMITED BY SIZE,  29360000
293700         'TPURCHS A'                          DELIMITED BY SIZE,  29370000
293800         PV-TABLE-QUALIFIER-COMMA             DELIMITED BY SIZE,  29380000
293900         'TPLNSHP C'                          DELIMITED BY SIZE,  29390000
294000         PV-TABLE-QUALIFIER-COMMA             DELIMITED BY SIZE,  29400000
294100         'TSTATCD E'                          DELIMITED BY SIZE   29410000
294200        INTO                                                      29420000
294300            PV-FROM-CLAUSE                                        29430000
294400        WITH                                                      29440000
294500            POINTER PV-STRING-POINTER-FROM.                       29450000
294600                                                                  29460000
294700     IF PS-USE-TPURITM OR PS-206-PURITM                           29470000
294800        STRING                                                    29480000
294900            PV-TABLE-QUALIFIER-COMMA          DELIMITED BY SIZE,  29490060
295000            'TPURITM B '                      DELIMITED BY SIZE,  29500060
295100            'LEFT OUTER JOIN '                DELIMITED BY SIZE,  29510060
295200            PV-TABLE-QUALIFIER                DELIMITED BY SIZE,  29520060
295300            'XLT_SKU S '                      DELIMITED BY SIZE,  29530060
295400            'ON B.ITM_NBR = S.ITM_NBR '       DELIMITED BY SIZE,  29540060
295500            'LEFT OUTER JOIN '                DELIMITED BY SIZE,  29550060
295600            PV-TABLE-QUALIFIER                DELIMITED BY SIZE,  29560060
295700            'XLT_VND_STYL V '                 DELIMITED BY SIZE,  29570060
295800            'ON S.STYL_ID = V.STYL_ID '       DELIMITED BY SIZE   29580060
295900        INTO                                                      29590000
296000            PV-FROM-CLAUSE                                        29600000
296100        WITH                                                      29610000
296200            POINTER PV-STRING-POINTER-FROM.                       29620000
296300                                                                  29630000
296400     IF PS-USE-TENTNME                                            29640000
296500        STRING                                                    29650000
296600            PV-TABLE-QUALIFIER-COMMA          DELIMITED BY SIZE,  29660000
296700            'TENTNME D'                       DELIMITED BY SIZE   29670000
296800        INTO                                                      29680000
296900            PV-FROM-CLAUSE                                        29690000
297000        WITH                                                      29700000
297100            POINTER PV-STRING-POINTER-FROM.                       29710000
297200                                                                  29720000
297300 4101-IMPRT-AGNT-PO-NBR.                                          29730000
297400                                                                  29740000
297500     MOVE ASC-KEY-IMPRT-AGNT-PO-NBR TO PV-IMPRT-AGNT-PO-NBR.      29750000
297600                                                                  29760000
297700     IF PV-STRING-POINTER-WHERE > 1                               29770000
297800        STRING                                                    29780000
297900            ' AND '                           DELIMITED BY SIZE   29790000
298000        INTO                                                      29800000
298100            PV-WHERE-CLAUSE                                       29810000
298200        WITH                                                      29820000
298300            POINTER PV-STRING-POINTER-WHERE.                      29830000
298400                                                                  29840000
298500     STRING                                                       29850000
298600         'A.IMPRT_AGNT_PO_NBR = '             DELIMITED BY SIZE,  29860000
298700          PV-IMPRT-AGNT-PO-NBR                DELIMITED BY SIZE   29870000
298800     INTO                                                         29880000
298900         PV-WHERE-CLAUSE                                          29890000
299000     WITH                                                         29900000
299100         POINTER PV-STRING-POINTER-WHERE.                         29910000
299200                                                                  29920000
299300 4102-DEPT-NBR.                                                   29930000
299400                                                                  29940000
299500     IF PV-STRING-POINTER-WHERE > 1                               29950000
299600        STRING                                                    29960000
299700            ' AND '                           DELIMITED BY SIZE   29970000
299800        INTO                                                      29980000
299900            PV-WHERE-CLAUSE                                       29990000
300000        WITH                                                      30000000
300100            POINTER PV-STRING-POINTER-WHERE.                      30010000
300200                                                                  30020000
300300     STRING                                                       30030000
300400         'A.DEPT_NBR = '                      DELIMITED BY SIZE,  30040000
300500         PC-QUOTE                             DELIMITED BY SIZE,  30050000
300600         ASC-KEY-DEPT-NBR                     DELIMITED BY SIZE,  30060000
300700         PC-QUOTE                             DELIMITED BY SIZE   30070000
300800     INTO                                                         30080000
300900         PV-WHERE-CLAUSE                                          30090000
301000     WITH                                                         30100000
301100         POINTER PV-STRING-POINTER-WHERE.                         30110000
301200                                                                  30120000
301300 4103-PO-TYP-CDE.                                                 30130000
301400                                                                  30140000
301500     IF PV-STRING-POINTER-WHERE > 1                               30150000
301600        STRING                                                    30160000
301700            ' AND '                           DELIMITED BY SIZE   30170000
301800        INTO                                                      30180000
301900            PV-WHERE-CLAUSE                                       30190000
302000        WITH                                                      30200000
302100            POINTER PV-STRING-POINTER-WHERE.                      30210000
302200                                                                  30220000
302300     STRING                                                       30230000
302400         'A.PO_TYP_CDE = '                    DELIMITED BY SIZE,  30240000
302500         PC-QUOTE                             DELIMITED BY SIZE,  30250000
302600         ASC-KEY-PO-TYP-CDE                   DELIMITED BY SIZE,  30260000
302700         PC-QUOTE                             DELIMITED BY SIZE   30270000
302800     INTO                                                         30280000
302900         PV-WHERE-CLAUSE                                          30290000
303000     WITH                                                         30300000
303100         POINTER PV-STRING-POINTER-WHERE.                         30310000
303200                                                                  30320000
303300 4104-STATUS-CDE.                                                 30330000
303400                                                                  30340000
303500     IF PV-STRING-POINTER-WHERE > 1                               30350000
303600        STRING                                                    30360000
303700            ' AND '                           DELIMITED BY SIZE   30370000
303800        INTO                                                      30380000
303900            PV-WHERE-CLAUSE                                       30390000
304000        WITH                                                      30400000
304100            POINTER PV-STRING-POINTER-WHERE.                      30410000
304200                                                                  30420000
304300     STRING                                                       30430000
304400         'A.STATUS_CDE = '                    DELIMITED BY SIZE,  30440000
304500         PC-QUOTE                             DELIMITED BY SIZE,  30450000
304600         ASC-KEY-STATUS-CDE                   DELIMITED BY SIZE,  30460000
304700         PC-QUOTE                             DELIMITED BY SIZE   30470000
304800     INTO                                                         30480000
304900         PV-WHERE-CLAUSE                                          30490000
305000     WITH                                                         30500000
305100         POINTER PV-STRING-POINTER-WHERE.                         30510000
305200                                                                  30520000
305300 4105-STATUS-CLS.                                                 30530000
305400                                                                  30540000
305500     IF PV-STRING-POINTER-WHERE > 1                               30550000
305600        STRING                                                    30560000
305700            ' AND '                           DELIMITED BY SIZE   30570000
305800        INTO                                                      30580000
305900            PV-WHERE-CLAUSE                                       30590000
306000        WITH                                                      30600000
306100            POINTER PV-STRING-POINTER-WHERE.                      30610000
306200                                                                  30620000
306300     IF ASC-KEY-STATUS-CLS = 'BTH'                                30630000
306400         STRING                                                   30640000
306500             'E.STATUS_CLS IN ('              DELIMITED BY SIZE,  30650000
306600             PC-QUOTE                         DELIMITED BY SIZE,  30660000
306700             PC-ACT                           DELIMITED BY SIZE,  30670000
306800             PC-QUOTE                         DELIMITED BY SIZE,  30680000
306900             ','                              DELIMITED BY SIZE,  30690000
307000             PC-QUOTE                         DELIMITED BY SIZE,  30700000
307100             PC-CMP                           DELIMITED BY SIZE,  30710000
307200             PC-QUOTE                         DELIMITED BY SIZE,  30720000
307300             ')'                              DELIMITED BY SIZE   30730000
307400         INTO                                                     30740000
307500             PV-WHERE-CLAUSE                                      30750000
307600         WITH                                                     30760000
307700             POINTER PV-STRING-POINTER-WHERE                      30770000
307800     ELSE                                                         30780000
307900         STRING                                                   30790000
308000             'E.STATUS_CLS = '                DELIMITED BY SIZE,  30800000
308100             PC-QUOTE                         DELIMITED BY SIZE,  30810000
308200             ASC-KEY-STATUS-CLS               DELIMITED BY SIZE,  30820000
308300             PC-QUOTE                         DELIMITED BY SIZE   30830000
308400         INTO                                                     30840000
308500             PV-WHERE-CLAUSE                                      30850000
308600         WITH                                                     30860000
308700             POINTER PV-STRING-POINTER-WHERE                      30870000
308800     END-IF.                                                      30880000
308900                                                                  30890000
309000 4106-PO-NBR.                                                     30900000
309100                                                                  30910000
309200     MOVE ASC-KEY-PO-NBR            TO PV-PO-NBR.                 30920000
309300                                                                  30930000
309400     IF PV-STRING-POINTER-WHERE > 1                               30940000
309500        STRING                                                    30950000
309600            ' AND '                           DELIMITED BY SIZE   30960000
309700        INTO                                                      30970000
309800            PV-WHERE-CLAUSE                                       30980000
309900        WITH                                                      30990000
310000            POINTER PV-STRING-POINTER-WHERE.                      31000000
310100                                                                  31010000
310200     STRING                                                       31020000
310300         'A.PO_NBR = '                        DELIMITED BY SIZE,  31030000
310400          PV-PO-NBR                           DELIMITED BY SIZE   31040000
310500     INTO                                                         31050000
310600         PV-WHERE-CLAUSE                                          31060000
310700     WITH                                                         31070000
310800         POINTER PV-STRING-POINTER-WHERE.                         31080000
310900                                                                  31090000
311000                                                                  31100000
311100                                                                  31110000
311200 4108-NEW-STR-IND.                                                31120000
311300                                                                  31130000
311400     IF PV-STRING-POINTER-WHERE > 1                               31140000
311500        STRING                                                    31150000
311600            ' AND '                           DELIMITED BY SIZE   31160000
311700        INTO                                                      31170000
311800            PV-WHERE-CLAUSE                                       31180000
311900        WITH                                                      31190000
312000            POINTER PV-STRING-POINTER-WHERE.                      31200000
312100                                                                  31210000
312200     STRING                                                       31220000
312300         'A.NEW_STR_PO_IND = '                DELIMITED BY SIZE,  31230000
312400         PC-QUOTE                             DELIMITED BY SIZE,  31240000
312500         ASC-KEY-NEW-STR-IND                  DELIMITED BY SIZE,  31250000
312600         PC-QUOTE                             DELIMITED BY SIZE   31260000
312700     INTO                                                         31270000
312800         PV-WHERE-CLAUSE                                          31280000
312900     WITH                                                         31290000
313000         POINTER PV-STRING-POINTER-WHERE.                         31300000
313100                                                                  31310000
313200 4109-SUB-CL-NBR.                                                 31320000
313300     IF PV-STRING-POINTER-WHERE > 1                               31330000
313400        STRING                                                    31340000
313500            ' AND '                           DELIMITED BY SIZE   31350000
313600        INTO                                                      31360000
313700            PV-WHERE-CLAUSE                                       31370000
313800        WITH                                                      31380000
313900            POINTER PV-STRING-POINTER-WHERE                       31390000
314000     END-IF.                                                      31400000
314100                                                                  31410000
314200     STRING                                                       31420000
314300         'V.SUB_CL_NBR = '                    DELIMITED BY SIZE,  31430000
314400         ASC-KEY-SUB-CL-NBR                   DELIMITED BY SIZE   31440000
314500         INTO                                                     31450000
314600             PV-WHERE-CLAUSE                                      31460000
314700         WITH                                                     31470000
314800             POINTER PV-STRING-POINTER-WHERE.                     31480000
314900*                                                                 31490000
315000 4110-MAJ-CL-NBR.                                                 31500000
315100     IF PV-STRING-POINTER-WHERE > 1                               31510000
315200        STRING                                                    31520000
315300            ' AND '                           DELIMITED BY SIZE   31530000
315400        INTO                                                      31540000
315500            PV-WHERE-CLAUSE                                       31550000
315600        WITH                                                      31560000
315700            POINTER PV-STRING-POINTER-WHERE                       31570000
315800     END-IF.                                                      31580000
315900                                                                  31590000
316000     STRING                                                       31600000
316100         'V.MAJ_CL_NBR = '                    DELIMITED BY SIZE,  31610000
316200         ASC-KEY-MAJ-CL-NBR                   DELIMITED BY SIZE   31620000
316300         INTO                                                     31630000
316400               PV-WHERE-CLAUSE                                    31640000
316500       WITH                                                       31650000
316600               POINTER PV-STRING-POINTER-WHERE.                   31660000
316700*                                                                 31670000
316800 4111-SKU-NBR.                                                    31680000
316900     IF PV-STRING-POINTER-WHERE > 1                               31690000
317000        STRING                                                    31700000
317100            ' AND '                           DELIMITED BY SIZE   31710000
317200        INTO                                                      31720000
317300            PV-WHERE-CLAUSE                                       31730000
317400        WITH                                                      31740000
317500            POINTER PV-STRING-POINTER-WHERE                       31750000
317600     END-IF.                                                      31760000
317700                                                                  31770000
317800     STRING                                                       31780000
317900         'S.SKU_NBR = '                       DELIMITED BY SIZE,  31790000
318000         ASC-KEY-SKU-NBR                      DELIMITED BY SIZE,  31800000
318100     INTO                                                         31810000
318200         PV-WHERE-CLAUSE                                          31820000
318300     WITH                                                         31830000
318400         POINTER PV-STRING-POINTER-WHERE.                         31840000
318500*                                                                 31850050
318600 4112-AD-EVNT-DTE.                                                31860000
318700                                                                  31870000
318800     IF PV-STRING-POINTER-WHERE > 1                               31880000
318900        STRING                                                    31890000
319000            ' AND '                           DELIMITED BY SIZE   31900000
319100        INTO                                                      31910000
319200            PV-WHERE-CLAUSE                                       31920000
319300        WITH                                                      31930000
319400            POINTER PV-STRING-POINTER-WHERE.                      31940000
319500                                                                  31950000
319600     STRING                                                       31960000
319700         'B.AD_EVNT_DTE = '                   DELIMITED BY SIZE,  31970000
319800         PC-QUOTE                             DELIMITED BY SIZE,  31980000
319900         ASC-KEY-AD-EVNT-DTE                  DELIMITED BY SIZE,  31990000
320000         PC-QUOTE                             DELIMITED BY SIZE   32000000
320100     INTO                                                         32010000
320200         PV-WHERE-CLAUSE                                          32020000
320300     WITH                                                         32030000
320400         POINTER PV-STRING-POINTER-WHERE.                         32040000
320500                                                                  32050000
320600 4113-OTB-PER-ONE.                                                32060000
320700                                                                  32070000
320800     IF PV-STRING-POINTER-WHERE > 1                               32080000
320900        STRING                                                    32090000
321000            ' AND '                           DELIMITED BY SIZE   32100000
321100        INTO                                                      32110000
321200            PV-WHERE-CLAUSE                                       32120000
321300        WITH                                                      32130000
321400            POINTER PV-STRING-POINTER-WHERE.                      32140000
321500                                                                  32150000
321600     STRING                                                       32160000
321700         'A.OTB_PER_NBR = '                   DELIMITED BY SIZE,  32170000
321800         PC-QUOTE                             DELIMITED BY SIZE,  32180000
321900         ASC-KEY-OTB-PER-NBR-BEG              DELIMITED BY SIZE,  32190000
322000         PC-QUOTE                             DELIMITED BY SIZE   32200000
322100     INTO                                                         32210000
322200         PV-WHERE-CLAUSE                                          32220000
322300     WITH                                                         32230000
322400         POINTER PV-STRING-POINTER-WHERE.                         32240000
322500                                                                  32250000
322600 4114-OTB-PER-NBR-BEG-END.                                        32260000
322700                                                                  32270000
322800     IF PV-STRING-POINTER-WHERE > 1                               32280000
322900        STRING                                                    32290000
323000            ' AND '                           DELIMITED BY SIZE   32300000
323100        INTO                                                      32310000
323200            PV-WHERE-CLAUSE                                       32320000
323300        WITH                                                      32330000
323400            POINTER PV-STRING-POINTER-WHERE.                      32340000
323500                                                                  32350000
323600     STRING                                                       32360000
323700         '(A.OTB_PER_NBR BETWEEN '            DELIMITED BY SIZE,  32370000
323800         PC-QUOTE                             DELIMITED BY SIZE,  32380000
323900         ASC-KEY-OTB-PER-NBR-BEG              DELIMITED BY SIZE,  32390000
324000         PC-QUOTE                             DELIMITED BY SIZE,  32400000
324100         ' AND '                              DELIMITED BY SIZE,  32410000
324200         PC-QUOTE                             DELIMITED BY SIZE,  32420000
324300         ASC-KEY-OTB-PER-NBR-END              DELIMITED BY SIZE,  32430000
324400         PC-QUOTE                             DELIMITED BY SIZE,  32440000
324500         ')'                                  DELIMITED BY SIZE   32450000
324600     INTO                                                         32460000
324700         PV-WHERE-CLAUSE                                          32470000
324800     WITH                                                         32480000
324900         POINTER PV-STRING-POINTER-WHERE.                         32490000
325000                                                                  32500000
325100 4115-OTB-PER-BEG.                                                32510000
325200                                                                  32520000
325300     IF PV-STRING-POINTER-WHERE > 1                               32530000
325400        STRING                                                    32540000
325500            ' AND '                           DELIMITED BY SIZE   32550000
325600        INTO                                                      32560000
325700            PV-WHERE-CLAUSE                                       32570000
325800        WITH                                                      32580000
325900            POINTER PV-STRING-POINTER-WHERE.                      32590000
326000                                                                  32600000
326100     STRING                                                       32610000
326200         '(A.OTB_PER_NBR BETWEEN '            DELIMITED BY SIZE,  32620000
326300         PC-QUOTE                             DELIMITED BY SIZE,  32630000
326400         ASC-KEY-OTB-PER-NBR-BEG              DELIMITED BY SIZE,  32640000
326500         PC-QUOTE                             DELIMITED BY SIZE,  32650000
326600         ' AND '                              DELIMITED BY SIZE,  32660000
326700         PC-QUOTE                             DELIMITED BY SIZE,  32670000
326800         ASC-KEY-OTB-PER-NBR-END              DELIMITED BY SIZE,  32680000
326900         PC-QUOTE                             DELIMITED BY SIZE,  32690000
327000         ')'                                  DELIMITED BY SIZE   32700000
327100     INTO                                                         32710000
327200         PV-WHERE-CLAUSE                                          32720000
327300     WITH                                                         32730000
327400         POINTER PV-STRING-POINTER-WHERE.                         32740000
327500                                                                  32750000
327600 4116-OTB-PER-END.                                                32760000
327700                                                                  32770000
327800     IF PV-STRING-POINTER-WHERE > 1                               32780000
327900        STRING                                                    32790000
328000            ' AND '                           DELIMITED BY SIZE   32800000
328100        INTO                                                      32810000
328200            PV-WHERE-CLAUSE                                       32820000
328300        WITH                                                      32830000
328400            POINTER PV-STRING-POINTER-WHERE.                      32840000
328500                                                                  32850000
328600     STRING                                                       32860000
328700         '(A.OTB_PER_NBR BETWEEN '            DELIMITED BY SIZE,  32870000
328800         PC-QUOTE                             DELIMITED BY SIZE,  32880000
328900         ASC-KEY-OTB-PER-NBR-BEG              DELIMITED BY SIZE,  32890000
329000         PC-QUOTE                             DELIMITED BY SIZE,  32900000
329100         ' AND '                              DELIMITED BY SIZE,  32910000
329200         PC-QUOTE                             DELIMITED BY SIZE,  32920000
329300         ASC-KEY-OTB-PER-NBR-END              DELIMITED BY SIZE,  32930000
329400         PC-QUOTE                             DELIMITED BY SIZE,  32940000
329500         ')'                                  DELIMITED BY SIZE   32950000
329600     INTO                                                         32960000
329700         PV-WHERE-CLAUSE                                          32970000
329800     WITH                                                         32980000
329900         POINTER PV-STRING-POINTER-WHERE.                         32990000
330000                                                                  33000000
330100 4117-DONT-SHIP-BEF-DTE-ONE.                                      33010000
330200                                                                  33020000
330300     IF PV-STRING-POINTER-WHERE > 1                               33030000
330400        STRING                                                    33040000
330500            ' AND '                           DELIMITED BY SIZE   33050000
330600        INTO                                                      33060000
330700            PV-WHERE-CLAUSE                                       33070000
330800        WITH                                                      33080000
330900            POINTER PV-STRING-POINTER-WHERE.                      33090000
331000                                                                  33100000
331100     STRING                                                       33110000
331200         'C.DONT_SHIP_BEF_DTE = '             DELIMITED BY SIZE,  33120000
331300         PC-QUOTE                             DELIMITED BY SIZE,  33130000
331400         ASC-KEY-DONT-SHIP-BEF-DTE-B          DELIMITED BY SIZE,  33140000
331500         PC-QUOTE                             DELIMITED BY SIZE   33150000
331600     INTO                                                         33160000
331700         PV-WHERE-CLAUSE                                          33170000
331800     WITH                                                         33180000
331900         POINTER PV-STRING-POINTER-WHERE.                         33190000
332000                                                                  33200000
332100 4118-DONT-SHIP-BEF-DTE-B-E.                                      33210000
332200                                                                  33220000
332300     IF PV-STRING-POINTER-WHERE > 1                               33230000
332400        STRING                                                    33240000
332500            ' AND '                           DELIMITED BY SIZE   33250000
332600        INTO                                                      33260000
332700            PV-WHERE-CLAUSE                                       33270000
332800        WITH                                                      33280000
332900            POINTER PV-STRING-POINTER-WHERE.                      33290000
333000                                                                  33300000
333100     STRING                                                       33310000
333200         '(C.DONT_SHIP_BEF_DTE BETWEEN '      DELIMITED BY SIZE,  33320000
333300         PC-QUOTE                             DELIMITED BY SIZE,  33330000
333400         ASC-KEY-DONT-SHIP-BEF-DTE-B          DELIMITED BY SIZE,  33340000
333500         PC-QUOTE                             DELIMITED BY SIZE,  33350000
333600         ' AND '                              DELIMITED BY SIZE,  33360000
333700         PC-QUOTE                             DELIMITED BY SIZE,  33370000
333800         ASC-KEY-DONT-SHIP-BEF-DTE-E          DELIMITED BY SIZE,  33380000
333900         PC-QUOTE                             DELIMITED BY SIZE,  33390000
334000         ')'                                  DELIMITED BY SIZE   33400000
334100         ' AND '                              DELIMITED BY SIZE,  33410066
334200         '(C.CAN_IFNOT_SHIP_DTE BETWEEN '     DELIMITED BY SIZE,  33420066
334300         PC-QUOTE                             DELIMITED BY SIZE,  33430066
334400         ASC-KEY-DONT-SHIP-BEF-DTE-B          DELIMITED BY SIZE,  33440066
334500         PC-QUOTE                             DELIMITED BY SIZE,  33450066
334600         ' AND '                              DELIMITED BY SIZE,  33460066
334700         PC-QUOTE                             DELIMITED BY SIZE,  33470066
334800         ASC-KEY-DONT-SHIP-BEF-DTE-E          DELIMITED BY SIZE,  33480066
334900         PC-QUOTE                             DELIMITED BY SIZE,  33490066
335000         ')'                                  DELIMITED BY SIZE   33500066
335100     INTO                                                         33510000
335200         PV-WHERE-CLAUSE                                          33520000
335300     WITH                                                         33530000
335400         POINTER PV-STRING-POINTER-WHERE.                         33540000
335500                                                                  33550069
335600 4119-CAN-IFNOT-SHP-DTE-ONE.                                      33560069
335700                                                                  33570069
335800     IF PV-STRING-POINTER-WHERE > 1                               33580069
335900        STRING                                                    33590069
336000            ' AND '                           DELIMITED BY SIZE   33600069
336100        INTO                                                      33610069
336200            PV-WHERE-CLAUSE                                       33620069
336300        WITH                                                      33630069
336400            POINTER PV-STRING-POINTER-WHERE.                      33640069
336500                                                                  33650069
336600     STRING                                                       33660069
336700         'C.CAN_IFNOT_SHIP_DTE = '            DELIMITED BY SIZE,  33670069
336800         PC-QUOTE                             DELIMITED BY SIZE,  33680069
336900         ASC-KEY-DONT-SHIP-BEF-DTE-E          DELIMITED BY SIZE,  33690069
337000         PC-QUOTE                             DELIMITED BY SIZE   33700069
337100     INTO                                                         33710069
337200         PV-WHERE-CLAUSE                                          33720069
337300     WITH                                                         33730069
337400         POINTER PV-STRING-POINTER-WHERE.                         33740069
337500                                                                  33750069
337600 4119-DONT-SHIP-BEF-DTE-B.                                        33760000
337700                                                                  33770000
337800     IF PV-STRING-POINTER-WHERE > 1                               33780000
337900        STRING                                                    33790000
338000            ' AND '                           DELIMITED BY SIZE   33800000
338100        INTO                                                      33810000
338200            PV-WHERE-CLAUSE                                       33820000
338300        WITH                                                      33830000
338400            POINTER PV-STRING-POINTER-WHERE.                      33840000
338500                                                                  33850000
338600     STRING                                                       33860000
338700         '(C.DONT_SHIP_BEF_DTE BETWEEN '      DELIMITED BY SIZE,  33870000
338800         PC-QUOTE                             DELIMITED BY SIZE,  33880000
338900         ASC-KEY-DONT-SHIP-BEF-DTE-B          DELIMITED BY SIZE,  33890000
339000         PC-QUOTE                             DELIMITED BY SIZE,  33900000
339100         ' AND '                              DELIMITED BY SIZE,  33910000
339200         PC-QUOTE                             DELIMITED BY SIZE,  33920000
339300         ASC-KEY-DONT-SHIP-BEF-DTE-E          DELIMITED BY SIZE,  33930000
339400         PC-QUOTE                             DELIMITED BY SIZE,  33940000
339500         ')'                                  DELIMITED BY SIZE   33950000
339600     INTO                                                         33960000
339700         PV-WHERE-CLAUSE                                          33970000
339800     WITH                                                         33980000
339900         POINTER PV-STRING-POINTER-WHERE.                         33990000
340000                                                                  34000000
340100 4120-DONT-SHIP-BEF-DTE-E.                                        34010000
340200                                                                  34020000
340300     IF PV-STRING-POINTER-WHERE > 1                               34030000
340400        STRING                                                    34040000
340500            ' AND '                           DELIMITED BY SIZE   34050000
340600        INTO                                                      34060000
340700            PV-WHERE-CLAUSE                                       34070000
340800        WITH                                                      34080000
340900            POINTER PV-STRING-POINTER-WHERE.                      34090000
341000                                                                  34100000
341100     STRING                                                       34110000
341200         '(C.DONT_SHIP_BEF_DTE BETWEEN '      DELIMITED BY SIZE,  34120000
341300         PC-QUOTE                             DELIMITED BY SIZE,  34130000
341400         ASC-KEY-DONT-SHIP-BEF-DTE-B          DELIMITED BY SIZE,  34140000
341500         PC-QUOTE                             DELIMITED BY SIZE,  34150000
341600         ' AND '                              DELIMITED BY SIZE,  34160000
341700         PC-QUOTE                             DELIMITED BY SIZE,  34170000
341800         ASC-KEY-DONT-SHIP-BEF-DTE-E          DELIMITED BY SIZE,  34180000
341900         PC-QUOTE                             DELIMITED BY SIZE,  34190000
342000         ')'                                  DELIMITED BY SIZE   34200000
342100     INTO                                                         34210000
342200         PV-WHERE-CLAUSE                                          34220000
342300     WITH                                                         34230000
342400         POINTER PV-STRING-POINTER-WHERE.                         34240000
342500                                                                  34250000
342600 4121-ENT-NAME-DESC.                                              34260000
342700                                                                  34270000
342800*TALLYING CODE                                                    34280000
342900     IF PV-STRING-POINTER-WHERE > 1                               34290000
343000        STRING                                                    34300000
343100            ' AND '                           DELIMITED BY SIZE   34310000
343200        INTO                                                      34320000
343300            PV-WHERE-CLAUSE                                       34330000
343400        WITH                                                      34340000
343500            POINTER PV-STRING-POINTER-WHERE.                      34350000
343600                                                                  34360000
343700     MOVE ZERO TO PV-TALLY-1                                      34370000
343800                  PV-TALLY-2.                                     34380000
343900                                                                  34390000
344000     MOVE ASC-KEY-ENT-NAME-DESC TO PV-ENT-NAME-DESC.              34400000
344100     INSPECT PV-ENT-NAME-DESC                                     34410000
344200        TALLYING PV-TALLY-1 FOR ALL '*'                           34420000
344300                 PV-TALLY-2 FOR ALL '?'                           34430000
344400        REPLACING ALL '*' BY '%'                                  34440000
344500                  ALL '?' BY '_'                                  34450000
344600                  ALL '''' BY '_'.                                34460000
344700                                                                  34470000
344800     IF PV-TALLY-1 + PV-TALLY-2 = ZERO                            34480000
344900        STRING                                                    34490000
345000            'D.ENT_NAME_DESC LIKE '            DELIMITED BY SIZE, 34500000
345100            PC-QUOTE                           DELIMITED BY SIZE, 34510000
345200            PV-ENT-NAME-DESC                   DELIMITED BY '  ', 34520000
345300            PC-PERCENT                         DELIMITED BY SIZE, 34530000
345400            PC-QUOTE                           DELIMITED BY SIZE  34540000
345500        INTO                                                      34550000
345600            PV-WHERE-CLAUSE                                       34560000
345700        WITH                                                      34570000
345800            POINTER PV-STRING-POINTER-WHERE                       34580000
345900     ELSE                                                         34590000
346000        STRING                                                    34600000
346100            'D.ENT_NAME_DESC LIKE '            DELIMITED BY SIZE, 34610000
346200            PC-QUOTE                           DELIMITED BY SIZE, 34620000
346300            PV-ENT-NAME-DESC                   DELIMITED BY '  ', 34630000
346400            PC-QUOTE                           DELIMITED BY SIZE  34640000
346500        INTO                                                      34650000
346600            PV-WHERE-CLAUSE                                       34660000
346700        WITH                                                      34670000
346800            POINTER PV-STRING-POINTER-WHERE                       34680000
346900     END-IF.                                                      34690000
347000                                                                  34700000
347100 4122-VEND-STYL-NME.                                              34710000
347200                                                                  34720000
347300     IF PV-STRING-POINTER-WHERE > 1                               34730000
347400        STRING                                                    34740000
347500            ' AND '                           DELIMITED BY SIZE   34750000
347600        INTO                                                      34760000
347700            PV-WHERE-CLAUSE                                       34770000
347800        WITH                                                      34780000
347900            POINTER PV-STRING-POINTER-WHERE.                      34790000
348000                                                                  34800000
348100     MOVE ZERO TO PV-TALLY-1                                      34810000
348200                  PV-TALLY-2.                                     34820000
348300                                                                  34830000
348400     MOVE ASC-KEY-VEND-STYL-NME TO PV-VEND-STYL-NME.              34840000
348500     INSPECT PV-VEND-STYL-NME                                     34850000
348600        TALLYING PV-TALLY-1 FOR ALL '*'                           34860000
348700                 PV-TALLY-2 FOR ALL '?'                           34870000
348800        REPLACING ALL '*' BY '%'                                  34880000
348900                  ALL '?' BY '_'                                  34890000
349000                  ALL '''' BY '_'.                                34900000
349100                                                                  34910000
349200     IF PV-TALLY-1 + PV-TALLY-2 = ZERO                            34920000
349300        STRING                                                    34930000
349400            'V.VS_NBR LIKE '              DELIMITED BY SIZE,      34940000
349500            PC-QUOTE                           DELIMITED BY SIZE, 34950000
349600            PV-VEND-STYL-NME                   DELIMITED BY '  ', 34960000
349700            PC-PERCENT                         DELIMITED BY SIZE, 34970000
349800            PC-QUOTE                           DELIMITED BY SIZE  34980000
349900        INTO                                                      34990000
350000            PV-WHERE-CLAUSE                                       35000000
350100        WITH                                                      35010000
350200            POINTER PV-STRING-POINTER-WHERE                       35020000
350300     ELSE                                                         35030000
350400        STRING                                                    35040000
350500            'V.VS_NBR LIKE '                   DELIMITED BY SIZE, 35050000
350600            PC-QUOTE                           DELIMITED BY SIZE, 35060000
350700            PV-VEND-STYL-NME                   DELIMITED BY '  ', 35070000
350800            PC-QUOTE                           DELIMITED BY SIZE  35080000
350900        INTO                                                      35090000
351000            PV-WHERE-CLAUSE                                       35100000
351100        WITH                                                      35110000
351200            POINTER PV-STRING-POINTER-WHERE                       35120000
351300     END-IF.                                                      35130000
351400                                                                  35140000
351500 EJECT                                                            35150000
351600*----------------------------------------------------------------*35160000
351700*    STRING TOGETHER THE CODE TO BUILD SYNAMIC SQL CURSOR        *35170000
351800*----------------------------------------------------------------*35180000
351900                                                                  35190000
352000 4150-COMBINE-SQL.                                                35200000
352100                                                                  35210000
352200     MOVE SPACES TO PV-SQL-STMT-TEXT.                             35220000
352300                                                                  35230000
352400     STRING PV-BUILD-SELECT-STMT              DELIMITED BY SIZE,  35240000
352500            ' FROM '                          DELIMITED BY SIZE,  35250000
352600            PV-FROM-CLAUSE                    DELIMITED BY '  ',  35260000
352700            ' WHERE '                         DELIMITED BY SIZE,  35270000
352800            PV-WHERE-CLAUSE                   DELIMITED BY '  '   35280000
352900     INTO                                                         35290000
353000         PV-SQL-STMT-TEXT.                                        35300000
353100                                                                  35310000
353200     ADD PV-SELECT-BYTES                                          35320000
353300         PC-CNT-6                                                 35330000
353400         PV-STRING-POINTER-FROM                                   35340000
353500         PC-CNT-7                                                 35350000
353600         PV-STRING-POINTER-WHERE                                  35360000
353700         PC-CNT-MINUS-2                                           35370000
353800     GIVING                                                       35380000
353900         PV-SQL-STMT-LEN.                                         35390000
354000 EJECT                                                            35400000
354100*----------------------------------------------------------------*35410000
354200*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *35420000
354300*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *35430000
354400*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *35440000
354500*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *35450000
354600*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *35460000
354700*                                                                *35470000
354800*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *35480000
354900*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *35490000
355000*    UPON INITIALIZATION.                                        *35500000
355100*----------------------------------------------------------------*35510000
355200                                                                  35520000
355300 4300-READ-ITEMS-FROM-DB.                                         35530000
355400                                                                  35540000
355500     PERFORM                                                      35550000
355600         VARYING PV-READ-COUNT                                    35560000
355700         FROM 1 BY 1                                              35570000
355800         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    35580000
355900            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         35590000
356000                                                                  35600000
356100         PERFORM 4310-FETCH                                       35610000
356200                                                                  35620000
356300         MOVE 'N'                  TO PS-SKIP-SW                  35630000
356400                                                                  35640000
356500         IF  ASC-KEY-STR-NBR > ZERO                               35650000
356600             INITIALIZE PV-DB2-COUNT                              35660000
356700             MOVE PURCHS-PO-NBR    TO DK-PO-NBR                   35670000
356800             MOVE ASC-KEY-STR-NBR  TO DK-STR-NBR                  35680000
356900             PERFORM 4350-CHECK-STORE-ALLOC                       35690000
357000             IF  PV-DB2-COUNT = +0                                35700000
357100                 SET PS-SKIP       TO TRUE                        35710000
357200             END-IF                                               35720000
357300         END-IF                                                   35730000
357400                                                                  35740000
357500         IF  ASC-ITEMS-LEFT-ON-DB                                 35750000
357600         AND PS-DONT-SKIP                                         35760000
357700             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                35770000
357800                 ADD +1            TO ASC-ITEM-SUB                35780000
357900             ELSE                                                 35790000
358000                 ADD +1            TO ASC-BLK-SUB                 35800000
358100                 MOVE +1           TO ASC-ITEM-SUB                35810000
358200                                                                  35820000
358300                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         35830000
358400                     MOVE +1       TO ASC-BLK-SUB                 35840000
358500                     SET ASC-BLOCK-MODIFIED (1)                   35850000
358600                                   TO TRUE                        35860000
358700                     PERFORM 5100-WRITE-TEMP-STORAGE              35870000
358800                     MOVE ASC-BLOCK-ENTRIES                       35880000
358900                               (PC-MAX-BLOCKS-IN-ARRAY)           35890000
359000                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 35900000
359100                     ADD +1        TO ASC-BLK-SUB                 35910000
359200                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   35920000
359300                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      35930000
359400                                   TO TRUE                        35940000
359500                 END-IF                                           35950000
359600             END-IF                                               35960000
359700             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    35970000
359800             MOVE ASC-NUMBER-OF-ITEMS-READ                        35980000
359900                                   TO ASC-LIST-ITEM-NUMBER        35990000
360000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  36000000
360100             MOVE PURCHS-PO-NBR    TO ASC-PO-NBR                  36010000
360200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  36020000
360300             PERFORM 4320-GET-PO-INFO                             36030000
360400             IF ENTNME-ENT-ID NOT = PURCHS-ENT-ID                 36040000
360500                PERFORM 4330-GET-VENDOR-SHORT-NAME                36050000
360600                IF  SQLCODE = +100                                36060000
360700                    PERFORM 4335-GET-VENDOR-PRIMARY-NAME          36070000
360800                END-IF                                            36080000
360900             END-IF                                               36090000
361000             PERFORM 4340-GET-SHIPMENT-INFO                       36100000
361100             PERFORM 4395-GET-MIN-AD-DATE                         36110000
361200                                                                  36120000
361300             MOVE +0               TO PV-DB2-COUNT2               36130000
361400             PERFORM 4380-CHECK-IN-PROCESS                        36140000
361500                                                                  36150000
361600             IF PV-DB2-COUNT2 > 0                                 36160000
361700               MOVE 'Y'            TO ASC-IP-IND                  36170000
361800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  36180000
361900             ELSE                                                 36190000
362000               MOVE 'N'            TO ASC-IP-IND                  36200000
362100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  36210000
362200             END-IF                                               36220000
362300                                                                  36230000
362400             MOVE PURCHS-DEPT-NBR  TO ASC-DEPT-NBR                36240000
362500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  36250000
362600             MOVE ENTNME-ENT-NAME-DESC                            36260000
362700                                   TO ASC-VENDOR-NAME             36270000
362800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  36280000
362900             MOVE PURCHS-STATUS-CDE                               36290000
363000                                   TO ASC-STATUS                  36300000
363100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  36310000
363200             STRING PURCHS-OTB-PER-NBR(5:2) DELIMITED BY SIZE     36320000
363300                    PURCHS-OTB-PER-NBR(3:2) DELIMITED BY SIZE     36330000
363400                                 INTO ASC-OTB                     36340000
363500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  36350000
363600             MOVE PV-DONT-SHIP-BEF-DTE                            36360000
363700                                   TO ASC-SHIP-DATE               36370000
363800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  36380000
363900             MOVE PV-CAN-IFNOT-SHIP-DTE                           36390000
364000                                   TO ASC-CANCEL-DATE             36400000
364100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  36410000
364200             MOVE PURCHS-SEASET-SHRT-NM                           36420000
364300                                   TO ASC-SHRT-NM                 36430000
364400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  36440000
364500             MOVE PURCHS-TOT-UNT-QTY                              36450000
364600                                   TO ASC-TOT-UNIT-ORDERED        36460000
364700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  36470000
364800                                                                  36480000
364900             COMPUTE ASC-UNIT-ORD-TOT = ASC-UNIT-ORD-TOT +        36490000
365000                   ASC-TOT-UNIT-ORDERED (ASC-BLK-SUB ASC-ITEM-SUB)36500000
365100                                                                  36510000
365200             MOVE PV-AD-EVNT-DTE   TO ASC-AD-EVNT-DTE             36520000
365300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  36530000
365400                                                                  36540000
365500         END-IF                                                   36550000
365600     END-PERFORM.                                                 36560000
365700                                                                  36570000
365800     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          36580000
365900         MOVE +1                   TO ASC-BLK-SUB                 36590000
366000         PERFORM 5100-WRITE-TEMP-STORAGE                          36600000
366100         ADD +1                    TO ASC-BLK-SUB                 36610000
366200         PERFORM 5100-WRITE-TEMP-STORAGE                          36620000
366300                                                                  36630000
366400         MOVE 1                    TO ASC-BLK-SUB                 36640000
366500                                      PV-BLOCK-NUMBER             36650000
366600         PERFORM 4410-READ-TEMP-STORAGE                           36660000
366700         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             36670000
366800             MOVE 2                TO ASC-BLK-SUB                 36680000
366900                                      PV-BLOCK-NUMBER             36690000
367000             PERFORM 4410-READ-TEMP-STORAGE                       36700000
367100         END-IF                                                   36710000
367200     END-IF.                                                      36720000
367300                                                                  36730000
367400 EJECT                                                            36740000
367500*----------------------------------------------------------------*36750000
367600*    FETCH A VENDOR ROW                                          *36760000
367700*----------------------------------------------------------------*36770000
367800                                                                  36780000
367900 4310-FETCH.                                                      36790000
368000                                                                  36800000
368100     EXEC SQL                                                     36810000
368200         FETCH PO-CSR                                             36820000
368300          INTO :PURCHS-PO-NBR,                                    36830000
368400               :PURCHS-OTB-PER-NBR,                               36840000
368500               :PURCHS-DEPT-NBR,                                  36850000
368600               :PURCHS-ENT-ID,                                    36860000
368700               :PLNSHP-DONT-SHIP-BEF-DTE                          36870000
368800     END-EXEC.                                                    36880000
368900                                                                  36890000
369000     EVALUATE TRUE                                                36900000
369100         WHEN SQLCODE = +0                                        36910000
369200              ADD 1 TO PV-COUNT-ITEMS-READ                        36920000
369300         WHEN SQLCODE = +100                                      36930000
369400              SET ASC-NO-ITEMS-LEFT-ON-DB                         36940000
369500                                   TO TRUE                        36950000
369600         WHEN SQLWARN0 NOT = SPACE                                36960000
369700         WHEN SQLCODE < +0                                        36970000
369800         WHEN SQLCODE > +0                                        36980000
369900              MOVE '4310-FETCH-CURSOR'                            36990000
370000                                   TO DP013-PARAGRAPH             37000000
370100              MOVE 'FETCH PO CURSOR'                              37010000
370200                                   TO DP013-MESSAGE-TEXT (1)      37020000
370300              MOVE SQLCA           TO DP013-SQLCA                 37030000
370400              MOVE 'TPURCHS'       TO DP013-DB2-TABLE-NAME (1)    37040000
370500              MOVE 'TPURITM'       TO DP013-DB2-TABLE-NAME (2)    37050000
370600              MOVE 'TPLNSHP'       TO DP013-DB2-TABLE-NAME (3)    37060000
370700              MOVE 'TENTNME'       TO DP013-DB2-TABLE-NAME (4)    37070000
370800              MOVE 'XLT_SKU'       TO DP013-DB2-TABLE-NAME (5)    37080000
370900              SET DP013-DB2-ABEND  TO TRUE                        37090000
371000              PERFORM DP013-0000-PROCESS-ABEND                    37100000
371100     END-EVALUATE.                                                37110000
371200                                                                  37120000
371300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        37130000
371400         MOVE '4310-FETCH-CURSOR'  TO DP013-PARAGRAPH             37140000
371500         MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'             37150000
371600                                   TO DP013-MESSAGE-TEXT (1)      37160000
371700         MOVE SQLCA                TO DP013-SQLCA                 37170000
371800         SET DP013-DB2-ABEND                                      37180000
371900             DP013-XCTL-DISPLAY-RESTART                           37190000
372000                                   TO TRUE                        37200000
372100         PERFORM DP013-0000-PROCESS-ABEND                         37210000
372200     END-IF.                                                      37220000
372300                                                                  37230000
372400 EJECT                                                            37240000
372500*----------------------------------------------------------------*37250000
372600* GET PO INFORMATION                                             *37260000
372700*----------------------------------------------------------------*37270000
372800                                                                  37280000
372900 4320-GET-PO-INFO.                                                37290000
373000                                                                  37300000
373100     EXEC SQL                                                     37310000
373200         SELECT DEPT_NBR                                          37320000
373300               ,OTB_PER_NBR                                       37330000
373400               ,STATUS_CDE                                        37340000
373500               ,TOT_VAL_RTL_AMT                                   37350000
373600               ,TOT_UNT_QTY                                       37360000
373700               ,ENT_ID                                            37370000
373800               ,SEASET_SHRT_NM                                    37380000
373900          INTO  :PURCHS-DEPT-NBR                                  37390000
374000               ,:PURCHS-OTB-PER-NBR                               37400000
374100               ,:PURCHS-STATUS-CDE                                37410000
374200               ,:PURCHS-TOT-VAL-RTL-AMT                           37420000
374300               ,:PURCHS-TOT-UNT-QTY                               37430000
374400               ,:PURCHS-ENT-ID                                    37440000
374500               ,:PURCHS-SEASET-SHRT-NM                            37450000
374600          FROM  TPURCHS                                           37460000
374700          WHERE PO_NBR         = :PURCHS-PO-NBR                   37470000
374800            AND VER_STATUS_CDE = 'A'                              37480000
374900            AND PO_CATEG_CDE   = 'MR'                             37490000
375000     END-EXEC.                                                    37500000
375100                                                                  37510000
375200     EVALUATE TRUE                                                37520000
375300         WHEN SQLCODE = +0                                        37530000
375400         WHEN SQLCODE = -904                                      37540000
375500         WHEN SQLCODE = -913                                      37550000
375600             CONTINUE                                             37560000
375700         WHEN SQLWARN0 NOT = SPACE                                37570000
375800         WHEN SQLCODE < +0                                        37580000
375900         WHEN SQLCODE > +0                                        37590000
376000             MOVE '4320-GET-PO-INFO'                              37600000
376100                                 TO DP013-PARAGRAPH               37610000
376200             MOVE 'SELECT ON PURCHASE HEADER TABLE'               37620000
376300                                 TO DP013-MESSAGE-TEXT (1)        37630000
376400             MOVE SQLCA          TO DP013-SQLCA                   37640000
376500             MOVE 'TPURCHS'      TO DP013-DB2-TABLE-NAME (1)      37650000
376600                 SET DP013-DB2-ABEND                              37660000
376700                     DP013-XCTL-DISPLAY-RESTART                   37670000
376800                                 TO TRUE                          37680000
376900             PERFORM DP013-0000-PROCESS-ABEND                     37690000
377000     END-EVALUATE.                                                37700000
377100                                                                  37710000
377200 EJECT                                                            37720000
377300*----------------------------------------------------------------*37730000
377400* GET THE VENDOR SHORT NAME                                      *37740000
377500*----------------------------------------------------------------*37750000
377600                                                                  37760000
377700 4330-GET-VENDOR-SHORT-NAME.                                      37770000
377800                                                                  37780000
377900     EXEC SQL                                                     37790000
378000         SELECT ENT_NAME_DESC                                     37800000
378100              , ENT_ID                                            37810000
378200          INTO  :ENTNME-ENT-NAME-DESC                             37820000
378300              , :ENTNME-ENT-ID                                    37830000
378400          FROM  TENTNME                                           37840000
378500          WHERE ENT_ID   = :PURCHS-ENT-ID                         37850000
378600            AND TYPE_CDE = '04'                                   37860000
378700     END-EXEC.                                                    37870000
378800                                                                  37880000
378900     EVALUATE TRUE                                                37890000
379000         WHEN SQLCODE = +0                                        37900000
379100         WHEN SQLCODE = +100                                      37910000
379200         WHEN SQLCODE = -904                                      37920000
379300         WHEN SQLCODE = -913                                      37930000
379400             CONTINUE                                             37940000
379500         WHEN SQLWARN0 NOT = SPACE                                37950000
379600         WHEN SQLCODE < +0                                        37960000
379700         WHEN SQLCODE > +0                                        37970000
379800             MOVE '4330-GET-VENDOR-SHORT-NAME'                    37980000
379900                                 TO DP013-PARAGRAPH               37990000
380000             MOVE 'SELECT ON ENTERPRISE NAME TABLE'               38000000
380100                                 TO DP013-MESSAGE-TEXT (1)        38010000
380200             MOVE SQLCA          TO DP013-SQLCA                   38020000
380300             MOVE 'TENTNME'      TO DP013-DB2-TABLE-NAME (1)      38030000
380400                 SET DP013-DB2-ABEND                              38040000
380500                     DP013-XCTL-DISPLAY-RESTART                   38050000
380600                                 TO TRUE                          38060000
380700             PERFORM DP013-0000-PROCESS-ABEND                     38070000
380800     END-EVALUATE.                                                38080000
380900                                                                  38090000
381000 EJECT                                                            38100000
381100*----------------------------------------------------------------*38110000
381200* GET THE VENDOR PRIMARY NAME                                    *38120000
381300*----------------------------------------------------------------*38130000
381400                                                                  38140000
381500 4335-GET-VENDOR-PRIMARY-NAME.                                    38150000
381600                                                                  38160000
381700     EXEC SQL                                                     38170000
381800         SELECT ENT_NAME_DESC                                     38180000
381900              , ENT_ID                                            38190000
382000          INTO  :ENTNME-ENT-NAME-DESC                             38200000
382100              , :ENTNME-ENT-ID                                    38210000
382200          FROM  TENTNME                                           38220000
382300          WHERE ENT_ID   = :PURCHS-ENT-ID                         38230000
382400            AND TYPE_CDE = '01'                                   38240000
382500     END-EXEC.                                                    38250000
382600                                                                  38260000
382700     EVALUATE TRUE                                                38270000
382800         WHEN SQLCODE = +0                                        38280000
382900         WHEN SQLCODE = -904                                      38290000
383000         WHEN SQLCODE = -913                                      38300000
383100             CONTINUE                                             38310000
383200         WHEN SQLWARN0 NOT = SPACE                                38320000
383300         WHEN SQLCODE < +0                                        38330000
383400         WHEN SQLCODE > +0                                        38340000
383500             MOVE '4335-GET-VENDOR-PRIMARY-NAME'                  38350000
383600                                 TO DP013-PARAGRAPH               38360000
383700             MOVE 'SELECT ON ENTERPRISE NAME TABLE'               38370000
383800                                 TO DP013-MESSAGE-TEXT (1)        38380000
383900             MOVE SQLCA          TO DP013-SQLCA                   38390000
384000             MOVE 'TENTNME'      TO DP013-DB2-TABLE-NAME (1)      38400000
384100                 SET DP013-DB2-ABEND                              38410000
384200                     DP013-XCTL-DISPLAY-RESTART                   38420000
384300                                 TO TRUE                          38430000
384400             PERFORM DP013-0000-PROCESS-ABEND                     38440000
384500     END-EVALUATE.                                                38450000
384600                                                                  38460000
384700 EJECT                                                            38470000
384800*----------------------------------------------------------------*38480000
384900* GET PLANNED SHIPMENT INFO                                      *38490000
385000*----------------------------------------------------------------*38500000
385100                                                                  38510000
385200 4340-GET-SHIPMENT-INFO.                                          38520000
385300                                                                  38530000
385400     EXEC SQL                                                     38540000
385500         SELECT DONT_SHIP_BEF_DTE                                 38550000
385600               ,CAN_IFNOT_SHIP_DTE                                38560000
385700          INTO  :PLNSHP-DONT-SHIP-BEF-DTE                         38570000
385800               ,:PLNSHP-CAN-IFNOT-SHIP-DTE                        38580000
385900          FROM  TPLNSHP                                           38590000
386000          WHERE PO_NBR          = :PURCHS-PO-NBR                  38600000
386100            AND VER_STATUS_CDE  = 'A'                             38610000
386200     END-EXEC.                                                    38620000
386300                                                                  38630000
386400     EVALUATE TRUE                                                38640000
386500         WHEN SQLCODE = +0                                        38650000
386600              IF  PLNSHP-DONT-SHIP-BEF-DTE > SPACES               38660000
386700              AND PLNSHP-DONT-SHIP-BEF-DTE NOT = '0001-01-01'     38670000
386800                  MOVE PLNSHP-DONT-SHIP-BEF-DTE                   38680000
386900                                       TO PV-DB2-DATE             38690000
387000                  MOVE PV-DB2-DATE-MM  TO PV-DISPLAY-DATE-MM      38700000
387100                  MOVE PV-DB2-DATE-DD  TO PV-DISPLAY-DATE-DD      38710000
387200                  MOVE PV-DB2-DATE-YY  TO PV-DISPLAY-DATE-YY      38720000
387300                  MOVE PV-DISPLAY-DATE TO PV-DONT-SHIP-BEF-DTE    38730000
387400              ELSE                                                38740000
387500                  MOVE SPACES          TO PV-DONT-SHIP-BEF-DTE    38750000
387600              END-IF                                              38760000
387700              IF  PLNSHP-CAN-IFNOT-SHIP-DTE > SPACES              38770000
387800              AND PLNSHP-CAN-IFNOT-SHIP-DTE NOT = '0001-01-01'    38780000
387900                  MOVE PLNSHP-CAN-IFNOT-SHIP-DTE                  38790000
388000                                       TO PV-DB2-DATE             38800000
388100                  MOVE PV-DB2-DATE-MM  TO PV-DISPLAY-DATE-MM      38810000
388200                  MOVE PV-DB2-DATE-DD  TO PV-DISPLAY-DATE-DD      38820000
388300                  MOVE PV-DB2-DATE-YY  TO PV-DISPLAY-DATE-YY      38830000
388400                  MOVE PV-DISPLAY-DATE TO PV-CAN-IFNOT-SHIP-DTE   38840000
388500              ELSE                                                38850000
388600                  MOVE SPACES          TO PV-CAN-IFNOT-SHIP-DTE   38860000
388700              END-IF                                              38870000
388800                                                                  38880000
388900         WHEN SQLCODE = -904                                      38890000
389000         WHEN SQLCODE = -913                                      38900000
389100             CONTINUE                                             38910000
389200         WHEN SQLWARN0 NOT = SPACE                                38920000
389300         WHEN SQLCODE < +0                                        38930000
389400         WHEN SQLCODE > +0                                        38940000
389500             MOVE '4340-GET-SHIPMENT-INFO'                        38950000
389600                                 TO DP013-PARAGRAPH               38960000
389700             MOVE 'SELECT ON PLANNED SHIPMENTS'                   38970000
389800                                 TO DP013-MESSAGE-TEXT (1)        38980000
389900             MOVE SQLCA          TO DP013-SQLCA                   38990000
390000             MOVE 'TPLNSHP'      TO DP013-DB2-TABLE-NAME (1)      39000000
390100                 SET DP013-DB2-ABEND                              39010000
390200                     DP013-XCTL-DISPLAY-RESTART                   39020000
390300                                 TO TRUE                          39030000
390400             PERFORM DP013-0000-PROCESS-ABEND                     39040000
390500     END-EVALUATE.                                                39050000
390600                                                                  39060000
390700 EJECT                                                            39070000
390800*----------------------------------------------------------------*39080000
390900* CHECK IF PO HAS ANY STORE ALLOCATIONS                          *39090000
391000*----------------------------------------------------------------*39100000
391100                                                                  39110000
391200 4350-CHECK-STORE-ALLOC.                                          39120000
391300                                                                  39130000
391400     EXEC SQL                                                     39140000
391500          SELECT COUNT(*)                                         39150000
391600            INTO :PV-DB2-COUNT                                    39160000
391700            FROM TMESTDS                                          39170000
391800           WHERE PO_NBR  = :DK-PO-NBR                             39180000
391900             AND STR_NBR = :DK-STR-NBR                            39190000
392000     END-EXEC.                                                    39200000
392100                                                                  39210000
392200     EVALUATE TRUE                                                39220000
392300         WHEN SQLCODE = +0                                        39230000
392400         WHEN SQLCODE = +100                                      39240000
392500         WHEN SQLCODE = -904                                      39250000
392600         WHEN SQLCODE = -913                                      39260000
392700              CONTINUE                                            39270000
392800                                                                  39280000
392900         WHEN SQLWARN0 NOT = SPACES                               39290000
393000         WHEN SQLCODE < +0                                        39300000
393100         WHEN SQLCODE > +0                                        39310000
393200              MOVE '4350-CHECK-STORE-ALLOC'                       39320000
393300                              TO DP013-PARAGRAPH                  39330000
393400              MOVE 'UNSUCCESSFUL SELECT STORE ALLOCATIONS '       39340000
393500                              TO DP013-MESSAGE-TEXT (1)           39350000
393600              MOVE SQLCA      TO DP013-SQLCA                      39360000
393700              MOVE 'TMESTDS ' TO DP013-DB2-TABLE-NAME (1)         39370000
393800              SET DP013-DB2-ABEND                                 39380000
393900                  DP013-XCTL-DISPLAY-RESTART                      39390000
394000                              TO TRUE                             39400000
394100              PERFORM DP013-0000-PROCESS-ABEND                    39410000
394200     END-EVALUATE.                                                39420000
394300                                                                  39430000
394400 EJECT                                                            39440000
394500*----------------------------------------------------------------*39450000
394600*  DETERMINE IF ANY OF THE ORDERS ARE HAVE IN-PROCESS RECEIVERS, *39460000
394700*  IF THE ORDER DOES, HIGHLIGHT THE PO IN YELLOW ON THE SCREEN.  *39470000
394800*----------------------------------------------------------------*39480000
394900 4380-CHECK-IN-PROCESS.                                           39490000
395000                                                                  39500000
395100     EXEC SQL                                                     39510000
395200          SELECT COUNT(*)                                         39520000
395300            INTO :PV-DB2-COUNT2                                   39530000
395400            FROM TRECEIV                                          39540000
395500           WHERE ORD_NBR        = :PURCHS-PO-NBR                  39550000
395600             AND VER_STATUS_CDE = 'A'                             39560000
395700             AND STATUS_CDE     = 'IP'                            39570000
395800     END-EXEC.                                                    39580000
395900                                                                  39590000
396000     EVALUATE TRUE                                                39600000
396100         WHEN SQLCODE = +0                                        39610000
396200         WHEN SQLCODE = +100                                      39620000
396300         WHEN SQLCODE = -904                                      39630000
396400         WHEN SQLCODE = -913                                      39640000
396500              CONTINUE                                            39650000
396600                                                                  39660000
396700         WHEN SQLWARN0 NOT = SPACES                               39670000
396800         WHEN SQLCODE < +0                                        39680000
396900         WHEN SQLCODE > +0                                        39690000
397000              MOVE '4380-CHECK-IN-PROCESS'                        39700000
397100                              TO DP013-PARAGRAPH                  39710000
397200              MOVE 'UNSUCCESSFUL SELECT IN-PROCESS'               39720000
397300                              TO DP013-MESSAGE-TEXT (1)           39730000
397400              MOVE SQLCA      TO DP013-SQLCA                      39740000
397500              MOVE 'TRECEIV ' TO DP013-DB2-TABLE-NAME (1)         39750000
397600              SET DP013-DB2-ABEND                                 39760000
397700                  DP013-XCTL-DISPLAY-RESTART                      39770000
397800                              TO TRUE                             39780000
397900              PERFORM DP013-0000-PROCESS-ABEND                    39790000
398000     END-EVALUATE.                                                39800000
398100                                                                  39810000
398200                                                                  39820000
398300 4395-GET-MIN-AD-DATE.                                            39830000
398400                                                                  39840000
398500     MOVE SPACES TO PV-AD-EVNT-DTE.                               39850000
398600     MOVE +0     TO PV-NULL-IND.                                  39860000
398700                                                                  39870000
398800     PERFORM                                                      39880000
398900         WITH TEST AFTER                                          39890000
399000         VARYING PV-RETRY-COUNTER                                 39900000
399100         FROM 1 BY 1                                              39910000
399200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               39920000
399300             OR (SQLCODE = +0)                                    39930000
399400             OR (SQLCODE = +100))                                 39940000
399500                                                                  39950000
399600         EXEC SQL                                                 39960000
399700             SELECT MIN(AD_EVNT_DTE)                              39970000
399800              INTO  :PURITM-AD-EVNT-DTE:PV-NULL-IND               39980000
399900              FROM  TPURITM                                       39990000
400000              WHERE PO_NBR          = :PURCHS-PO-NBR              40000000
400100                AND VER_STATUS_CDE  = 'A'                         40010000
400200                AND AD_EVNT_DTE     > '0001-01-01'                40020000
400300                AND STATUS_CDE NOT IN ('CA')                      40030000
400400         END-EXEC                                                 40040000
400500                                                                  40050000
400600         EVALUATE TRUE                                            40060000
400700             WHEN SQLCODE = +0                                    40070000
400800                  IF  PV-NULL-IND < +0                            40080000
400900                      MOVE SPACES          TO PV-AD-EVNT-DTE      40090000
401000                  ELSE                                            40100000
401100                      MOVE PURITM-AD-EVNT-DTE                     40110000
401200                                           TO PV-DB2-DATE         40120000
401300                      MOVE PV-DB2-DATE-MM  TO PV-DISPLAY-DATE-MM  40130000
401400                      MOVE PV-DB2-DATE-DD  TO PV-DISPLAY-DATE-DD  40140000
401500                      MOVE PV-DB2-DATE-YY  TO PV-DISPLAY-DATE-YY  40150000
401600                      MOVE PV-DISPLAY-DATE TO PV-AD-EVNT-DTE      40160000
401700                  END-IF                                          40170000
401800             WHEN SQLCODE = +100                                  40180000
401900                  MOVE SPACES              TO PV-AD-EVNT-DTE      40190000
402000             WHEN SQLCODE = -904                                  40200000
402100             WHEN SQLCODE = -913                                  40210000
402200                  CONTINUE                                        40220000
402300                                                                  40230000
402400             WHEN SQLWARN0 NOT = SPACES                           40240000
402500             WHEN SQLCODE < +0                                    40250000
402600             WHEN SQLCODE > +0                                    40260000
402700                  MOVE '4395-GET-MIN-AD-DTE'                      40270000
402800                                  TO DP013-PARAGRAPH              40280000
402900                  MOVE 'UNSUCCESSFUL SELECT MIN AD DATE '         40290000
403000                                  TO DP013-MESSAGE-TEXT (1)       40300000
403100                  MOVE SQLCA      TO DP013-SQLCA                  40310000
403200                  MOVE 'TPURITM ' TO DP013-DB2-TABLE-NAME (1)     40320000
403300                  SET DP013-DB2-ABEND                             40330000
403400                      DP013-XCTL-DISPLAY-RESTART                  40340000
403500                                  TO TRUE                         40350000
403600                  PERFORM DP013-0000-PROCESS-ABEND                40360000
403700         END-EVALUATE                                             40370000
403800     END-PERFORM.                                                 40380000
403900                                                                  40390000
404000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        40400000
404100         MOVE '4395-GET-MIN-AD-DATE'                              40410000
404200                                  TO DP013-PARAGRAPH              40420000
404300         MOVE 'MAX RETRIES EXCEEDED ON SELECT   TPURITM'          40430000
404400                                  TO DP013-MESSAGE-TEXT (1)       40440000
404500         MOVE SQLCA               TO DP013-SQLCA                  40450000
404600         MOVE 'TPURITM '          TO DP013-DB2-TABLE-NAME (1)     40460000
404700         SET DP013-DB2-ABEND                                      40470000
404800             DP013-XCTL-DISPLAY-RESTART                           40480000
404900                                  TO TRUE                         40490000
405000         PERFORM DP013-0000-PROCESS-ABEND                         40500000
405100     END-IF.                                                      40510000
405200                                                                  40520000
405300 EJECT                                                            40530000
405400*----------------------------------------------------------------*40540000
405500* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *40550000
405600*----------------------------------------------------------------*40560000
405700                                                                  40570000
405800 4400-MOVE-COMMAREA-TO-SCREEN.                                    40580000
405900                                                                  40590000
406000     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             40600000
406100         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          40610000
406200         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          40620000
406300             MOVE +1               TO ASC-BLK-SUB                 40630000
406400             PERFORM 5100-WRITE-TEMP-STORAGE                      40640000
406500             ADD +1                TO ASC-BLK-SUB                 40650000
406600             PERFORM 5100-WRITE-TEMP-STORAGE                      40660000
406700             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             40670000
406800                 GIVING PV-BLOCK-NUMBER                           40680000
406900                 REMAINDER PV-REMAINDER                           40690000
407000             IF  PV-REMAINDER > ZERO                              40700000
407100                 ADD +1            TO PV-BLOCK-NUMBER             40710000
407200             END-IF                                               40720000
407300             MOVE +1               TO ASC-BLK-SUB                 40730000
407400             PERFORM 4410-READ-TEMP-STORAGE                       40740000
407500             ADD +1                TO ASC-BLK-SUB                 40750000
407600                                      PV-BLOCK-NUMBER             40760000
407700             PERFORM 4410-READ-TEMP-STORAGE                       40770000
407800     END-IF.                                                      40780000
407900                                                                  40790000
408000     MOVE +1                       TO ASC-BLK-SUB.                40800000
408100                                                                  40810000
408200     COMPUTE ASC-ITEM-SUB =                                       40820000
408300         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              40830000
408400         + PC-ITEMS-PER-PANEL).                                   40840000
408500                                                                  40850000
408600     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        40860000
408700         ADD +1                    TO ASC-BLK-SUB                 40870000
408800         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            40880000
408900     END-IF.                                                      40890000
409000                                                                  40900000
409100     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           40910000
409200         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                40920000
409300                                                                  40930000
409400     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        40940000
409500     PERFORM 4420-FORMAT-LIST-LINES                               40950000
409600         VARYING PV-SUB                                           40960000
409700         FROM PC-ITEMS-PER-PANEL BY -1                            40970000
409800         UNTIL PV-SUB < +1.                                       40980000
409900                                                                  40990000
410000     COMPUTE ASC-ITEMS-DISPLAYED =                                41000000
410100         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          41010000
410200                                                                  41020000
410300     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    41030000
410400                                      ASTRTITO.                   41040000
410500                                                                  41050000
410600     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    41060000
410700     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    41070000
410800     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            41080000
410900                                   TO ASELITO.                    41090000
411000                                                                  41100000
411100     MOVE ASC-UNIT-ORD-TOT     TO MR-UNITS-ORDERED-TOT.           41110000
411200                                                                  41120000
411300     IF  DP020-MSG-NUMBER-X = SPACE                               41130000
411400         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  41140000
411500*            --- MORE ITEMS TO DISPLAY ----                       41150000
411600             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            41160000
411700             SET DP020-MSG-INFORMATIONAL                          41170000
411800                                   TO TRUE                        41180000
411900         END-IF                                                   41190000
412000     END-IF.                                                      41200000
412100                                                                  41210000
412200*----------------------------------------------------------------*41220000
412300*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *41230000
412400*----------------------------------------------------------------*41240000
412500                                                                  41250000
412600 4410-READ-TEMP-STORAGE.                                          41260000
412700                                                                  41270000
412800     EXEC CICS                                                    41280000
412900         READQ TS                                                 41290000
413000             QUEUE (ASC-LIST-QUEUE-NAME)                          41300000
413100             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               41310000
413200             ITEM  (PV-BLOCK-NUMBER)                              41320000
413300             RESP  (PV-CICS-RESP)                                 41330000
413400     END-EXEC.                                                    41340000
413500                                                                  41350000
413600     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       41360000
413700       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     41370000
413800         CONTINUE                                                 41380000
413900     ELSE                                                         41390000
414000         SET DP013-CICS-ABEND      TO TRUE                        41400000
414100         SET DP013-NO-ROLLBACK     TO TRUE                        41410000
414200         MOVE '4410-READ-TEMP-STORAGE'                            41420000
414300                                   TO DP013-PARAGRAPH             41430000
414400         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      41440000
414500                                   TO DP013-MESSAGE-TEXT(1)       41450000
414600         PERFORM DP013-0000-PROCESS-ABEND                         41460000
414700     END-IF.                                                      41470000
414800                                                                  41480000
414900     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      41490000
415000                                   TO TRUE.                       41500000
415100                                                                  41510000
415200     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         41520000
415300         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               41530000
415400     END-IF.                                                      41540000
415500 EJECT                                                            41550000
415600*----------------------------------------------------------------*41560000
415700*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *41570000
415800*----------------------------------------------------------------*41580000
415900                                                                  41590000
416000 4420-FORMAT-LIST-LINES.                                          41600000
416100                                                                  41610000
416200     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      41620000
416300         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                41630000
416400         MOVE DP015-ASK-DRK-OFF    TO MR-SELECTA (PV-SUB)         41640000
416500         MOVE SPACES               TO MR-SELECT  (PV-SUB)         41650000
416600                                      MR-PO-NBR-X (PV-SUB)        41660000
416700                                      MR-DEPT-NBR (PV-SUB)        41670000
416800                                      MR-VENDOR-NAME (PV-SUB)     41680000
416900                                      MR-STATUS (PV-SUB)          41690000
417000                                      MR-AD-DATE (PV-SUB)         41700071
417100                                      MR-SHIP-DATE (PV-SUB)       41710000
417200                                      MR-CANCEL-DATE (PV-SUB)     41720000
417300                                      MR-UNITS-ORDERED-X (PV-SUB) 41730000
417400                                      MR-SHRT-NM (PV-SUB)         41740000
417500     ELSE                                                         41750000
417600         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      41760000
417700                                                   > SPACE        41770000
417800             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 41780000
417900                                   TO MR-SELECT (PV-SUB)          41790000
418000         ELSE                                                     41800000
418100             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      41810000
418200                                   TO MR-SELECT (PV-SUB)          41820000
418300         END-IF                                                   41830000
418400                                                                  41840000
418500         IF  DP030-SET-CURSOR-TRAILER                             41850000
418600             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)41860000
418700                 > SPACE)                                         41870000
418800               OR (PV-SUB = 1))                                   41880000
418900                SET DP030-SET-CURSOR-APPL-1 TO TRUE               41890000
419000                MOVE -1            TO MR-SELECTL (PV-SUB)         41900000
419100             END-IF                                               41910000
419200         END-IF                                                   41920000
419300                                                                  41930000
419400         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           41940000
419500             MOVE ASC-PO-NBR (ASC-BLK-SUB ASC-ITEM-SUB)           41950000
419600                                   TO MR-PO-NBR (PV-SUB)          41960000
419700             MOVE ASC-DEPT-NBR (ASC-BLK-SUB ASC-ITEM-SUB)         41970000
419800                                   TO MR-DEPT-NBR (PV-SUB)        41980000
419900             MOVE ASC-VENDOR-NAME (ASC-BLK-SUB ASC-ITEM-SUB)      41990000
420000                                   TO MR-VENDOR-NAME (PV-SUB)     42000000
420100             MOVE ASC-STATUS (ASC-BLK-SUB ASC-ITEM-SUB)           42010000
420200                                   TO MR-STATUS (PV-SUB)          42020000
420300             MOVE ASC-AD-EVNT-DTE (ASC-BLK-SUB ASC-ITEM-SUB)      42030072
420400                                   TO MR-AD-DATE (PV-SUB)         42040071
420500             MOVE ASC-SHIP-DATE (ASC-BLK-SUB ASC-ITEM-SUB)        42050000
420600                                   TO MR-SHIP-DATE (PV-SUB)       42060000
420700             MOVE ASC-CANCEL-DATE (ASC-BLK-SUB ASC-ITEM-SUB)      42070000
420800                                   TO MR-CANCEL-DATE (PV-SUB)     42080000
420900             MOVE ASC-SHRT-NM (ASC-BLK-SUB ASC-ITEM-SUB)          42090000
421000                                   TO MR-SHRT-NM (PV-SUB)         42100000
421100                                                                  42110000
421200             MOVE ASC-TOT-UNIT-ORDERED (ASC-BLK-SUB ASC-ITEM-SUB) 42120000
421300                                   TO MR-UNITS-ORDERED(PV-SUB)    42130000
421400                                                                  42140000
421500             IF ASC-IP-IND (ASC-BLK-SUB ASC-ITEM-SUB) = 'Y'       42150000
421600                 MOVE DP015-YELLOW          TO MR-PO-NBRC(PV-SUB) 42160000
421700             ELSE                                                 42170000
421800                 MOVE DP015-BLUE            TO MR-PO-NBRC(PV-SUB) 42180000
421900             END-IF                                               42190000
422000         END-IF                                                   42200000
422100     END-IF.                                                      42210000
422200                                                                  42220000
422300     SUBTRACT +1 FROM ASC-ITEM-SUB.                               42230000
422400                                                                  42240000
422500     IF  ASC-ITEM-SUB < + 1                                       42250000
422600         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                42260000
422700         MOVE +1                   TO ASC-BLK-SUB                 42270000
422800     END-IF.                                                      42280000
422900                                                                  42290000
423000*----------------------------------------------------------------*42300000
423100*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *42310000
423200*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *42320000
423300*  ISSUE A WARNING.                                              *42330000
423400*----------------------------------------------------------------*42340000
423500 4430-CHECK-FOR-BEGIN-AND-END.                                    42350000
423600                                                                  42360000
423700     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       42370000
423800         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     42380000
423900*            -- NO END-OF-RANGE SPECFIED ---                      42390000
424000             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            42400000
424100             SET DP020-MSG-WARNING TO TRUE                        42410000
424200             PERFORM 4431-POSITION-AT-WARNING                     42420000
424300         END-IF                                                   42430000
424400     ELSE                                                         42440000
424500         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     42450000
424600*            -- NO BEGINNING-OF-RANGE SPECFIED ---                42460000
424700             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            42470000
424800             SET DP020-MSG-WARNING TO TRUE                        42480000
424900             PERFORM 4431-POSITION-AT-WARNING                     42490000
425000         END-IF                                                   42500000
425100     END-IF.                                                      42510000
425200                                                                  42520000
425300*----------------------------------------------------------------*42530000
425400*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *42540000
425500*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *42550000
425600*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *42560000
425700*  POSITION THE CURSOR THERE.                                    *42570000
425800*----------------------------------------------------------------*42580000
425900 4431-POSITION-AT-WARNING.                                        42590000
426000                                                                  42600000
426100     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 42610000
426200                    - PV-TOP-ITEM + 1.                            42620000
426300                                                                  42630000
426400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      42640000
426500         CONTINUE                                                 42650000
426600     ELSE                                                         42660000
426700         SET DP030-SET-CURSOR-APPL-1                              42670000
426800                                   TO TRUE                        42680000
426900         MOVE -1                   TO MR-SELECTL (PV-SUB)         42690000
427000         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         42700000
427100         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         42710000
427200     END-IF.                                                      42720000
427300                                                                  42730000
427400     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   42740000
427500                    - PV-TOP-ITEM + 1.                            42750000
427600                                                                  42760000
427700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      42770000
427800         CONTINUE                                                 42780000
427900     ELSE                                                         42790000
428000         SET DP030-SET-CURSOR-APPL-1                              42800000
428100                                   TO TRUE                        42810000
428200         MOVE -1                   TO MR-SELECTL (PV-SUB)         42820000
428300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         42830000
428400         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         42840000
428500     END-IF.                                                      42850000
428600                                                                  42860000
428700 EJECT                                                            42870000
428800*----------------------------------------------------------------*42880000
428900*    PROCESS THE SELECT PURCHASE ORDERS TO BE ADD TO THE SET     *42890000
429000*----------------------------------------------------------------*42900000
429100 5000-PROCESS-ADDITIONS.                                          42910000
429200                                                                  42920000
429300                                                                  42930000
429400                                                                  42940000
429500*    UPDATE THE QUEUE WITH THE CURRENT SCREEN DATA.               42950000
429600     MOVE +1                       TO ASC-BLK-SUB.                42960000
429700     PERFORM 5100-WRITE-TEMP-STORAGE.                             42970000
429800     ADD +1                        TO ASC-BLK-SUB.                42980000
429900     PERFORM 5100-WRITE-TEMP-STORAGE.                             42990000
430000                                                                  43000000
430100*    SET THE PROCESS SELECTION SWITCH TO EDIT MODE.               43010000
430200*    VALIDATE USER IS AUTHORIZED TO UPDATE PURCHASE ORDERS.       43020000
430300     SET PS-EDIT-SELECTION         TO TRUE.                       43030000
430400     PERFORM 5200-PROCESS-SELECTED-ADDS.                          43040000
430500                                                                  43050000
430600     IF PS-NO-ERROR                                               43060000
430700*        SET THE PROCESS SELECTION SWITCH TO CHECK MODE.          43070000
430800*        CHECK IF ANY OF THE PURCHASE ORDERS ALREADY HAVE A       43080000
430900*        SEASONAL SET ASSIGNED.                                   43090000
431000         SET PS-CHECK-SELECTION    TO TRUE                        43100000
431100         PERFORM 5200-PROCESS-SELECTED-ADDS                       43110000
431200     END-IF.                                                      43120000
431300                                                                  43130000
431400     IF PS-NO-ERROR AND (ASC-NOT-CONFIRM OR ASC-CONTINUE-UPDT)    43140000
431500*        SET THE PROCESS SELECTION SWITCH TO ADD MODE.            43150000
431600*        ADD THE SELECTED PURCHASE ORDERS FROM THE SET.           43160000
431700         SET PS-ADD-SELECTION      TO TRUE                        43170000
431800         PERFORM 5200-PROCESS-SELECTED-ADDS                       43180000
431900                                                                  43190000
432000*        REST SELECTION VALUES.                                   43200000
432100         MOVE +0                   TO ASC-NUMBER-OF-SELECTED-ITEMS43210000
432200         MOVE +0                   TO ASC-START-OF-SELECTED-RANGE 43220000
432300         MOVE +0                   TO ASC-END-OF-SELECTED-RANGE   43230000
432400                                                                  43240000
432500*        FORCE MOVE OF COMMAREA TO SCREEN.                        43250000
432600         MOVE +0                   TO ASC-ITEM-AT-TOP-OF-PANEL    43260000
432700*        SET TRAN W102 REFRESH FLAG (NEW ITEMS ADD REBUID LIST)   43270000
432800         SET PO079-W102-REFRESH    TO TRUE                        43280000
432900                                                                  43290000
433000     END-IF.                                                      43300000
433100                                                                  43310000
433200 EJECT                                                            43320000
433300*----------------------------------------------------------------*43330000
433400*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *43340000
433500*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *43350000
433600*----------------------------------------------------------------*43360000
433700                                                                  43370000
433800 5100-WRITE-TEMP-STORAGE.                                         43380000
433900                                                                  43390000
434000     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     43400000
434100                                   TO PV-LIST-ITEM-NUMBER.        43410000
434200     COMPUTE PV-BLOCK-NUMBER =                                    43420000
434300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    43430000
434400                                                                  43440000
434500     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             43450000
434600     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             43460000
434700         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      43470000
434800             PERFORM 5105-REWRITE-ASC-LISTQ                       43480000
434900         END-IF                                                   43490000
435000     ELSE                                                         43500000
435100         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       43510000
435200         ASC-HIGHEST-BLOCK-WRITTEN + 1                            43520000
435300         PERFORM 5110-WRITE-ASC-LISTQ                             43530000
435400         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   43540000
435500     END-IF.                                                      43550000
435600                                                                  43560000
435700     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      43570000
435800                                   TO TRUE.                       43580000
435900                                                                  43590000
436000 EJECT                                                            43600000
436100*----------------------------------------------------------------*43610000
436200*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *43620000
436300*  SPECIFIC COMMAREA.                                            *43630000
436400*----------------------------------------------------------------*43640000
436500 5105-REWRITE-ASC-LISTQ.                                          43650000
436600                                                                  43660000
436700     EXEC CICS                                                    43670000
436800         WRITEQ TS                                                43680000
436900             QUEUE (ASC-LIST-QUEUE-NAME)                          43690000
437000             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               43700000
437100             ITEM  (PV-BLOCK-NUMBER)                              43710000
437200             REWRITE                                              43720000
437300             RESP  (PV-CICS-RESP)                                 43730000
437400     END-EXEC.                                                    43740000
437500                                                                  43750000
437600     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           43760000
437700         CONTINUE                                                 43770000
437800     ELSE                                                         43780000
437900         SET DP013-CICS-ABEND      TO TRUE                        43790000
438000         SET DP013-NO-ROLLBACK     TO TRUE                        43800000
438100         MOVE '5105-REWRITE-ASC-LISTQ'                            43810000
438200                                   TO DP013-PARAGRAPH             43820000
438300         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     43830000
438400                                   TO DP013-MESSAGE-TEXT(1)       43840000
438500         PERFORM DP013-0000-PROCESS-ABEND                         43850000
438600     END-IF.                                                      43860000
438700                                                                  43870000
438800 EJECT                                                            43880000
438900*----------------------------------------------------------------*43890000
439000*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *43900000
439100*  SPECIFIC COMMAREA.                                            *43910000
439200*----------------------------------------------------------------*43920000
439300 5110-WRITE-ASC-LISTQ.                                            43930000
439400                                                                  43940000
439500     EXEC CICS                                                    43950000
439600         WRITEQ TS                                                43960000
439700             QUEUE (ASC-LIST-QUEUE-NAME)                          43970000
439800             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               43980000
439900             ITEM  (PV-BLOCK-NUMBER)                              43990000
440000             RESP  (PV-CICS-RESP)                                 44000000
440100     END-EXEC.                                                    44010000
440200                                                                  44020000
440300     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      44030000
440400         SET DP013-CICS-ABEND      TO TRUE                        44040000
440500         SET DP013-NO-ROLLBACK     TO TRUE                        44050000
440600         MOVE '5110-WRITE-ASC-LISTQ'                              44060000
440700                                   TO DP013-PARAGRAPH             44070000
440800         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           44080000
440900                                   TO DP013-MESSAGE-TEXT(1)       44090000
441000         PERFORM DP013-0000-PROCESS-ABEND                         44100000
441100     END-IF.                                                      44110000
441200                                                                  44120000
441300 EJECT                                                            44130000
441400*----------------------------------------------------------------*44140000
441500*  PROCESS THE TEMP QUEUE READING ALL ITEMS CHECKING FOR         *44150000
441600*  SELECTED PURCHASE ORDERS TO BE PROCESSED.                     *44160000
441700*----------------------------------------------------------------*44170000
441800 5200-PROCESS-SELECTED-ADDS.                                      44180000
441900                                                                  44190000
442000     MOVE +1                       TO ASC-BLK-SUB.                44200000
442100                                                                  44210000
442200     PERFORM 5300-UPDATE-PO-SET                                   44220000
442300         VARYING ASC-ITEM-SUB                                     44230000
442400         FROM 1 BY 1                                              44240000
442500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 44250000
442600                                                                  44260000
442700     ADD +1                        TO ASC-BLK-SUB.                44270000
442800                                                                  44280000
442900     PERFORM 5300-UPDATE-PO-SET                                   44290000
443000         VARYING ASC-ITEM-SUB                                     44300000
443100         FROM 1 BY 1                                              44310000
443200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 44320000
443300                                                                  44330000
443400     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               44340000
443500                                   TO PV-LIST-ITEM-NUMBER.        44350000
443600                                                                  44360000
443700     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            44370000
443800         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    44380000
443900                                                                  44390000
444000     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     44400000
444100        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      44410000
444200         MOVE +1                   TO ASC-BLK-SUB                 44420000
444300                                                                  44430000
444400         PERFORM 5100-WRITE-TEMP-STORAGE                          44440000
444500                                                                  44450000
444600         MOVE +1                   TO PV-BLOCK-NUMBER             44460000
444700                                                                  44470000
444800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         44480000
444900             PV-FIRST-BLOCK-IN-ARRAY - 1                          44490000
445000                                                                  44500000
445100         PERFORM                                                  44510000
445200             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       44520000
445300                                                                  44530000
445400             PERFORM 4410-READ-TEMP-STORAGE                       44540000
445500                                                                  44550000
445600             PERFORM 5300-UPDATE-PO-SET                           44560000
445700                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 44570000
445800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          44580000
445900                                                                  44590000
446000             PERFORM 5100-WRITE-TEMP-STORAGE                      44600000
446100                                                                  44610000
446200             ADD +1                TO PV-BLOCK-NUMBER             44620000
446300                                                                  44630000
446400         END-PERFORM                                              44640000
446500                                                                  44650000
446600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         44660000
446700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     44670000
446800                                                                  44680000
446900         PERFORM                                                  44690000
447000             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       44700000
447100                   ASC-HIGHEST-BLOCK-WRITTEN                      44710000
447200                                                                  44720000
447300             MOVE PV-NEXT-BLOCK-IN-ARRAY                          44730000
447400                                   TO PV-BLOCK-NUMBER             44740000
447500                                                                  44750000
447600             PERFORM 4410-READ-TEMP-STORAGE                       44760000
447700                                                                  44770000
447800             PERFORM 5300-UPDATE-PO-SET                           44780000
447900                 VARYING ASC-ITEM-SUB                             44790000
448000                 FROM 1 BY 1                                      44800000
448100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          44810000
448200                                                                  44820000
448300             PERFORM 5100-WRITE-TEMP-STORAGE                      44830000
448400                                                                  44840000
448500             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      44850000
448600                                                                  44860000
448700         END-PERFORM                                              44870000
448800                                                                  44880000
448900         MOVE PV-FIRST-BLOCK-IN-ARRAY                             44890000
449000                                   TO PV-BLOCK-NUMBER             44900000
449100                                                                  44910000
449200         PERFORM 4410-READ-TEMP-STORAGE                           44920000
449300     END-IF.                                                      44930000
449400                                                                  44940000
449500                                                                  44950000
449600 EJECT                                                            44960000
449700*----------------------------------------------------------------*44970000
449800*    UPDATED EACH SELECTED PO ROW AND ASC-SHRT-NM                *44980000
449900*----------------------------------------------------------------*44990000
450000 5300-UPDATE-PO-SET.                                              45000000
450100                                                                  45010000
450200     IF  ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)          45020000
450300             NOT EQUAL ZERO                                       45030000
450400         IF  ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)                 45040000
450500           EVALUATE TRUE                                          45050000
450600                                                                  45060000
450700             WHEN PS-EDIT-SELECTION                               45070000
450800                 MOVE ASC-DEPT-NBR (ASC-BLK-SUB ASC-ITEM-SUB)     45080000
450900                                   TO DK-DEPT-NBR                 45090000
450901                                                                  45090181
450910                 SET  PS-RACF-FUNC-NO TO TRUE                     45091083
450920                 PERFORM 5400-RACF-FUNC                           45092083
450930*                                                                 45093081
450940                 IF  PS-RACF-FUNC-NO                              45094083
451000                     PERFORM 5600-CHECK-AUTHORIZATION             45100081
451010                 END-IF                                           45101081
451100             WHEN PS-CHECK-SELECTION                              45110000
451200                 MOVE ASC-PO-NBR(ASC-BLK-SUB, ASC-ITEM-SUB)       45120000
451300                     TO PV-PO-NBR-B                               45130000
451400                 PERFORM 3520-CHECK-IF-SEASET                     45140000
451500                 IF PURCHS-SEASET-SHRT-NM NOT = SPACES            45150000
451600                   MOVE PC-TSYMSG-02518 TO DP020-MSG-NUMBER       45160000
451700                   SET ASC-CONFIRM TO TRUE                        45170000
451800                   SET DP020-MSG-WARNING TO TRUE                  45180000
451900*                ELSE                                             45190000
452000*                  SET ASC-NOT-CONFIRM TO TRUE                    45200000
452100                 END-IF                                           45210000
452200                                                                  45220000
452300             WHEN PS-ADD-SELECTION                                45230000
452400                 IF ASC-NOT-CONFIRM OR ASC-CONTINUE-UPDT          45240000
452500                   MOVE ASC-PO-NBR (ASC-BLK-SUB ASC-ITEM-SUB)     45250000
452600                                     TO PURCHS-PO-NBR             45260000
452700                   PERFORM 5500-UPDATE-PO-SET-DATA                45270000
452800                   MOVE ASC-SET-SHORT-NME                         45280000
452900                                     TO ASC-SHRT-NM               45290000
453000                                        (ASC-BLK-SUB ASC-ITEM-SUB)45300000
453100                   SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)    45310000
453200                     ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)45320000
453300                       ASC-BLOCK-MODIFIED(ASC-BLK-SUB)            45330000
453400                                     TO TRUE                      45340000
453500                 END-IF                                           45350000
453600             END-EVALUATE                                         45360000
453700         END-IF                                                   45370000
453800     END-IF.                                                      45380000
453900                                                                  45390000
454100                                                                  45410000
454101*----------------------------------------------------------------*45410181
454102*    CHECK TO SEE IF COC (CENTRAL ORDER CONTROL) HAS FUNCTION    *45410281
454103*    ACCESS TO BE ABLE TO UPDATE SEASONAL SET INFO               *45410381
454104*----------------------------------------------------------------*45410481
454110 5400-RACF-FUNC.                                                  45411083
454111                                                                  45411181
454112      SET  PS-RACF-FUNC-NO TO TRUE.                               45411283
454113                                                                  45411381
454114      SET DP008-RSRC-TYPE-FUNC           TO TRUE                  45411481
454115      MOVE 'POSEASET'                    TO DP008-FUNCTION-NAME   45411583
454116      SET DP008-ACCESS-TYPE-USE          TO TRUE                  45411681
454117                                                                  45411781
454118      EXEC CICS                                                   45411881
454119         LINK PROGRAM (DP008-SECURITY-SUBROUTINE)                 45411981
454120              COMMAREA (DP008-SECURITY-COMMAREA)                  45412081
454121              LENGTH (DP008-SECURITY-COMMAREA-LENGTH)             45412181
454122      END-EXEC                                                    45412281
454123                                                                  45412381
454124      IF DP008-CALL-SUCCESSFUL                                    45412481
454125         IF DP008-ACCESS-ALLOWED                                  45412581
454126             SET  PS-RACF-FUNC-YES TO TRUE                        45412683
454127             DISPLAY ' POKCS104 - BYPASS DEPT CHECK FOR'          45412784
454128                     ' SEASONAL SET CHANGE ' DP020-USERID         45412884
454129         ELSE                                                     45412981
454130             SET  PS-RACF-FUNC-NO  TO TRUE                        45413083
454131         END-IF                                                   45413181
454132     ELSE                                                         45413281
454133         MOVE '7250-RACF-FUNC'                                    45413383
454134                               TO DP013-PARAGRAPH                 45413481
454135          MOVE 'UNABLE TO ACCESS CICS'                            45413581
454136                               TO DP013-MESSAGE-TEXT (1)          45413681
454137          MOVE SQLCA                 TO DP013-SQLCA               45413781
454138          SET DP013-DB2-ABEND                                     45413881
454139              DP013-XCTL-DISPLAY-RESTART                          45413981
454140                               TO TRUE                            45414081
454141          PERFORM DP013-0000-PROCESS-ABEND                        45414181
454142      END-IF.                                                     45414281
454143                                                                  45414381
454150                                                                  45415081
454200*----------------------------------------------------------------*45420000
454300*  UPDATE THE PURCHASE ORDER WITH THE SET SHORT NAME AND YEAR.   *45430000
454400*----------------------------------------------------------------*45440000
454500 5500-UPDATE-PO-SET-DATA.                                         45450000
454600                                                                  45460000
454700     MOVE ASC-SET-YEAR               TO PURCHS-SEASET-YR.         45470000
454800     MOVE ASC-SET-SHORT-NME          TO PURCHS-SEASET-SHRT-NM.    45480000
454900                                                                  45490000
455000     PERFORM                                                      45500000
455100         WITH TEST AFTER                                          45510000
455200         VARYING PV-RETRY-COUNTER                                 45520000
455300         FROM 1 BY 1                                              45530000
455400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               45540000
455500                   OR (SQLCODE = ZERO))                           45550000
455600         EXEC SQL                                                 45560000
455700             UPDATE TPURCHS                                       45570000
455800                SET SEASET_YR        = :PURCHS-SEASET-YR          45580000
455900                   ,SEASET_SHRT_NM   = :PURCHS-SEASET-SHRT-NM     45590000
455910                   ,LAST_UPD_TMST    = CURRENT TIMESTAMP          45591089
456000              WHERE PO_NBR           = :PURCHS-PO-NBR             45600000
456100                AND VER_STATUS_CDE   = 'A'                        45610000
456200         END-EXEC                                                 45620000
456300                                                                  45630000
456400         EVALUATE TRUE                                            45640000
456500             WHEN SQLCODE = ZERO                                  45650000
456600                                                                  45660000
456700             WHEN SQLCODE = -904                                  45670000
456800             WHEN SQLCODE = -913                                  45680000
456900                 CONTINUE                                         45690000
457000             WHEN SQLWARN0 NOT = SPACES                           45700000
457100             WHEN SQLCODE < ZERO                                  45710000
457200             WHEN SQLCODE > ZERO                                  45720000
457300                 MOVE '5500-UPDATE-PO-SET-DATA '                  45730000
457400                                   TO DP013-PARAGRAPH             45740000
457500                 MOVE 'UPDATE A ROW ON THE PO TABLE '             45750000
457600                                   TO DP013-MESSAGE-TEXT(1)       45760000
457700                 MOVE SQLCA        TO DP013-SQLCA                 45770000
457800                 MOVE 'TPURCHS'    TO DP013-DB2-TABLE-NAME (1)    45780000
457900                 SET DP013-DB2-ABEND                              45790000
458000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           45800000
458100                 PERFORM DP013-0000-PROCESS-ABEND                 45810000
458200         END-EVALUATE                                             45820000
458300     END-PERFORM.                                                 45830000
458400                                                                  45840000
458500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        45850000
458600         MOVE '5500-UPDATE-PO-SET-DATA '                          45860000
458700                                   TO DP013-PARAGRAPH             45870000
458800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO UPDATE'     45880000
458900                                   TO DP013-MESSAGE-TEXT (1)      45890000
459000         MOVE SQLCA                TO DP013-SQLCA                 45900000
459100         MOVE 'TPURCHS'            TO DP013-DB2-TABLE-NAME (1)    45910000
459200         SET DP013-DB2-ABEND                                      45920000
459300             DP013-XCTL-DISPLAY-RESTART                           45930000
459400                                   TO TRUE                        45940000
459500         PERFORM DP013-0000-PROCESS-ABEND                         45950000
459600     END-IF.                                                      45960000
459700                                                                  45970000
459800                                                                  45980000
459900 EJECT                                                            45990000
460000*----------------------------------------------------------------*46000000
460100*    CHECK TO MAKE SURE USER IS AUTHORIZED TO PERFORM MAINTENACE *46010000
460200*    ON THIS PO.                                                 *46020000
460300*----------------------------------------------------------------*46030000
460400 5600-CHECK-AUTHORIZATION.                                        46040000
460500                                                                  46050000
460600     PERFORM                                                      46060000
460700         WITH TEST AFTER                                          46070000
460800         VARYING PV-RETRY-COUNTER                                 46080000
460900         FROM 1 BY 1                                              46090000
461000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               46100000
461100             OR (SQLCODE = +0)                                    46110000
461200             OR (SQLCODE = +100))                                 46120000
461300                                                                  46130000
461400         EXEC SQL                                                 46140000
461500              SELECT COUNT(*)                                     46150000
461600                INTO :PV-DB2-COUNT                                46160000
461700                FROM TMDSEAR A                                    46170000
461800                    ,TRSPBAR B                                    46180000
461900               WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                46190000
462000                 AND A.DEPT_NBR    = :DK-DEPT-NBR                 46200000
462100                 AND A.MDSELV_CDE  = 'DPT'                        46210000
462200                 AND A.OPERCO_NBR  = '03'                         46220000
462300                 AND B.WORKER_STRT_DTE <= CURRENT DATE            46230000
462400                 AND B.WORKER_END_DTE  >= CURRENT DATE            46240000
462500                 AND B.WORKER_NBR  =                              46250000
462600                    (SELECT WORKER_NBR                            46260000
462700                       FROM TWORKER                               46270000
462800                      WHERE OPERCO_NBR = '03'                     46280000
462900                        AND UID_NBR    = :DP020-USERID)           46290000
463000         END-EXEC                                                 46300000
463100                                                                  46310000
463200         EVALUATE TRUE                                            46320000
463300             WHEN SQLCODE = +0                                    46330000
463400             WHEN SQLCODE = +100                                  46340000
463500             WHEN SQLCODE = -904                                  46350000
463600             WHEN SQLCODE = -913                                  46360000
463700                  CONTINUE                                        46370000
463800                                                                  46380000
463900             WHEN SQLWARN0 NOT = SPACES                           46390000
464000             WHEN SQLCODE < +0                                    46400000
464100             WHEN SQLCODE > +0                                    46410000
464200                  MOVE '5600-CHECK-AUTHORIZATION'                 46420000
464300                                  TO DP013-PARAGRAPH              46430000
464400                  MOVE 'UNSUCCESSFUL COUNT ON WORKER'             46440000
464500                                  TO DP013-MESSAGE-TEXT (1)       46450000
464600                  MOVE SQLCA      TO DP013-SQLCA                  46460000
464700                  MOVE 'TWORKER ' TO DP013-DB2-TABLE-NAME (1)     46470000
464800                  MOVE 'TRSPBAR ' TO DP013-DB2-TABLE-NAME (2)     46480000
464900                  SET DP013-DB2-ABEND                             46490000
465000                      DP013-XCTL-DISPLAY-RESTART                  46500000
465100                                  TO TRUE                         46510000
465200                  PERFORM DP013-0000-PROCESS-ABEND                46520000
465300         END-EVALUATE                                             46530000
465400     END-PERFORM.                                                 46540000
465500                                                                  46550000
465600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        46560000
465700         MOVE '5600-CHECK-AUTHORIZATION'                          46570000
465800                                  TO DP013-PARAGRAPH              46580000
465900         MOVE 'MAX RETRIES EXCEEDED ON COUNT ON TWORKER'          46590000
466000                                  TO DP013-MESSAGE-TEXT (1)       46600000
466100         MOVE SQLCA               TO DP013-SQLCA                  46610000
466200         MOVE 'TWORKER '          TO DP013-DB2-TABLE-NAME (1)     46620000
466300         MOVE 'TRSPBAR '          TO DP013-DB2-TABLE-NAME (2)     46630000
466400         SET DP013-DB2-ABEND                                      46640000
466500             DP013-XCTL-DISPLAY-RESTART                           46650000
466600                                  TO TRUE                         46660000
466700         PERFORM DP013-0000-PROCESS-ABEND                         46670000
466800     END-IF.                                                      46680000
466900                                                                  46690000
467000     IF PV-DB2-COUNT = +0                                         46700000
467100         PERFORM 5601-GET-DMA-GMA                                 46710000
467200         IF SQLCODE = +100                                        46720000
467300             CONTINUE                                             46730000
467400         ELSE                                                     46740000
467500             PERFORM 5602-CHECK-DMA-AUTHORIZATION                 46750000
467600             IF PV-DB2-COUNT = +0                                 46760000
467700                 PERFORM 5603-CHECK-GMA-AUTHORIZATION             46770000
467800             END-IF                                               46780000
467900         END-IF                                                   46790000
468000     END-IF.                                                      46800000
468100                                                                  46810000
468200     IF PV-DB2-COUNT = +0                                         46820000
468300         PERFORM 5604-CHECK-NO-AUTHORIZATION                      46830000
468400         IF PV-DB2-COUNT = +0                                     46840000
468500             PERFORM 5605-CHECK-NO-DMA-AUTH                       46850000
468600             IF PV-DB2-COUNT = +0                                 46860000
468700                 PERFORM 5606-CHECK-NO-GMA-AUTH                   46870000
468800                 IF PV-DB2-COUNT = +0                             46880000
468900                     MOVE +1       TO PV-DB2-COUNT                46890000
469000                 ELSE                                             46900000
469100                     MOVE +0       TO PV-DB2-COUNT                46910000
469200                 END-IF                                           46920000
469300             ELSE                                                 46930000
469400                 MOVE +0           TO PV-DB2-COUNT                46940000
469500             END-IF                                               46950000
469600         ELSE                                                     46960000
469700             MOVE +0               TO PV-DB2-COUNT                46970000
469800         END-IF                                                   46980000
469900     END-IF.                                                      46990000
470000                                                                  47000000
470100     IF  PV-DB2-COUNT = +0                                        47010000
470200         MOVE PC-TSYMSG-00014    TO DP020-MSG-NUMBER              47020000
470300         SET PS-ERROR                                             47030000
470400             DP020-MSG-FATAL     TO TRUE                          47040000
470500     END-IF.                                                      47050000
470600                                                                  47060000
470700 5601-GET-DMA-GMA.                                                47070000
470800                                                                  47080000
470900     PERFORM                                                      47090000
471000         WITH TEST AFTER                                          47100000
471100         VARYING PV-RETRY-COUNTER                                 47110000
471200         FROM 1 BY 1                                              47120000
471300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               47130000
471400             OR (SQLCODE = +0)                                    47140000
471500             OR (SQLCODE = +100))                                 47150000
471600                                                                  47160000
471700         EXEC SQL                                                 47170000
471800              SELECT GMA_NBR,                                     47180000
471900                     DMA_NBR                                      47190000
472000                INTO :DK-GMA-NBR,                                 47200000
472100                     :DK-DMA-NBR                                  47210000
472200                FROM TMDSEAR                                      47220000
472300               WHERE DEPT_NBR    = :DK-DEPT-NBR                   47230000
472400                 AND MDSELV_CDE  = 'DPT'                          47240000
472500                 AND OPERCO_NBR  = '03'                           47250000
472600                 AND STRT_DTE   <= CURRENT DATE                   47260000
472700                 AND END_DTE    >= CURRENT DATE                   47270000
472800         END-EXEC                                                 47280000
472900                                                                  47290000
473000         EVALUATE TRUE                                            47300000
473100             WHEN SQLCODE = +0                                    47310000
473200             WHEN SQLCODE = +100                                  47320000
473300             WHEN SQLCODE = -904                                  47330000
473400             WHEN SQLCODE = -913                                  47340000
473500                  CONTINUE                                        47350000
473600                                                                  47360000
473700             WHEN SQLWARN0 NOT = SPACES                           47370000
473800             WHEN SQLCODE < +0                                    47380000
473900             WHEN SQLCODE > +0                                    47390000
474000                  MOVE '5601-GET-DMA-GMA'                         47400000
474100                                  TO DP013-PARAGRAPH              47410000
474200                  MOVE 'UNSUCCESSFUL SELECT ON MDSEAR'            47420000
474300                                  TO DP013-MESSAGE-TEXT (1)       47430000
474400                  MOVE SQLCA      TO DP013-SQLCA                  47440000
474500                  MOVE 'TMDSEAR ' TO DP013-DB2-TABLE-NAME (1)     47450000
474600                  SET DP013-DB2-ABEND                             47460000
474700                      DP013-XCTL-DISPLAY-RESTART                  47470000
474800                                  TO TRUE                         47480000
474900                  PERFORM DP013-0000-PROCESS-ABEND                47490000
475000         END-EVALUATE                                             47500000
475100     END-PERFORM.                                                 47510000
475200                                                                  47520000
475300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        47530000
475400         MOVE '5601-GET-DMA-GMA'                                  47540000
475500                                  TO DP013-PARAGRAPH              47550000
475600         MOVE 'MAX RETRIES EXCEEDED ON SELECT ON MDSEAR'          47560000
475700                                  TO DP013-MESSAGE-TEXT (1)       47570000
475800         MOVE SQLCA               TO DP013-SQLCA                  47580000
475900         MOVE 'TMDSEAR '          TO DP013-DB2-TABLE-NAME (1)     47590000
476000         SET DP013-DB2-ABEND                                      47600000
476100             DP013-XCTL-DISPLAY-RESTART                           47610000
476200                                  TO TRUE                         47620000
476300         PERFORM DP013-0000-PROCESS-ABEND                         47630000
476400     END-IF.                                                      47640000
476500                                                                  47650000
476600 5602-CHECK-DMA-AUTHORIZATION.                                    47660000
476700                                                                  47670000
476800     PERFORM                                                      47680000
476900         WITH TEST AFTER                                          47690000
477000         VARYING PV-RETRY-COUNTER                                 47700000
477100         FROM 1 BY 1                                              47710000
477200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               47720000
477300             OR (SQLCODE = +0)                                    47730000
477400             OR (SQLCODE = +100))                                 47740000
477500                                                                  47750000
477600         EXEC SQL                                                 47760000
477700              SELECT COUNT(*)                                     47770000
477800                INTO :PV-DB2-COUNT                                47780000
477900                FROM TMDSEAR A                                    47790000
478000                    ,TRSPBAR B                                    47800000
478100               WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                47810000
478200                 AND A.DMA_NBR    = :DK-DMA-NBR                   47820000
478300                 AND A.MDSELV_CDE  = 'DMA'                        47830000
478400                 AND A.OPERCO_NBR  = '03'                         47840000
478500                 AND B.WORKER_STRT_DTE <= CURRENT DATE            47850000
478600                 AND B.WORKER_END_DTE  >= CURRENT DATE            47860000
478700                 AND B.WORKER_NBR  =                              47870000
478800                    (SELECT WORKER_NBR                            47880000
478900                       FROM TWORKER                               47890000
479000                      WHERE OPERCO_NBR = '03'                     47900000
479100                        AND UID_NBR    = :DP020-USERID)           47910000
479200         END-EXEC                                                 47920000
479300                                                                  47930000
479400         EVALUATE TRUE                                            47940000
479500             WHEN SQLCODE = +0                                    47950000
479600             WHEN SQLCODE = +100                                  47960000
479700             WHEN SQLCODE = -904                                  47970000
479800             WHEN SQLCODE = -913                                  47980000
479900                  CONTINUE                                        47990000
480000                                                                  48000000
480100             WHEN SQLWARN0 NOT = SPACES                           48010000
480200             WHEN SQLCODE < +0                                    48020000
480300             WHEN SQLCODE > +0                                    48030000
480400                  MOVE '5602-CHECK-DMA-AUTHORIZATION'             48040000
480500                                  TO DP013-PARAGRAPH              48050000
480600                  MOVE 'UNSUCCESSFUL COUNT ON WORKER'             48060000
480700                                  TO DP013-MESSAGE-TEXT (1)       48070000
480800                  MOVE SQLCA      TO DP013-SQLCA                  48080000
480900                  MOVE 'TWORKER ' TO DP013-DB2-TABLE-NAME (1)     48090000
481000                  MOVE 'TRSPBAR ' TO DP013-DB2-TABLE-NAME (2)     48100000
481100                  SET DP013-DB2-ABEND                             48110000
481200                      DP013-XCTL-DISPLAY-RESTART                  48120000
481300                                  TO TRUE                         48130000
481400                  PERFORM DP013-0000-PROCESS-ABEND                48140000
481500         END-EVALUATE                                             48150000
481600     END-PERFORM.                                                 48160000
481700                                                                  48170000
481800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        48180000
481900         MOVE '5602-CHECK-DMA-AUTHORIZATION'                      48190000
482000                                  TO DP013-PARAGRAPH              48200000
482100         MOVE 'MAX RETRIES EXCEEDED ON COUNT ON TWORKER'          48210000
482200                                  TO DP013-MESSAGE-TEXT (1)       48220000
482300         MOVE SQLCA               TO DP013-SQLCA                  48230000
482400         MOVE 'TWORKER '          TO DP013-DB2-TABLE-NAME (1)     48240000
482500         MOVE 'TRSPBAR '          TO DP013-DB2-TABLE-NAME (2)     48250000
482600         SET DP013-DB2-ABEND                                      48260000
482700             DP013-XCTL-DISPLAY-RESTART                           48270000
482800                                  TO TRUE                         48280000
482900         PERFORM DP013-0000-PROCESS-ABEND                         48290000
483000     END-IF.                                                      48300000
483100                                                                  48310000
483200 5603-CHECK-GMA-AUTHORIZATION.                                    48320000
483300                                                                  48330000
483400     PERFORM                                                      48340000
483500         WITH TEST AFTER                                          48350000
483600         VARYING PV-RETRY-COUNTER                                 48360000
483700         FROM 1 BY 1                                              48370000
483800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               48380000
483900             OR (SQLCODE = +0)                                    48390000
484000             OR (SQLCODE = +100))                                 48400000
484100                                                                  48410000
484200         EXEC SQL                                                 48420000
484300              SELECT COUNT(*)                                     48430000
484400                INTO :PV-DB2-COUNT                                48440000
484500                FROM TMDSEAR A                                    48450000
484600                    ,TRSPBAR B                                    48460000
484700               WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                48470000
484800                 AND A.GMA_NBR    = :DK-GMA-NBR                   48480000
484900                 AND A.MDSELV_CDE  = 'GMA'                        48490000
485000                 AND A.OPERCO_NBR  = '03'                         48500000
485100                 AND B.WORKER_STRT_DTE <= CURRENT DATE            48510000
485200                 AND B.WORKER_END_DTE  >= CURRENT DATE            48520000
485300                 AND B.WORKER_NBR  =                              48530000
485400                    (SELECT WORKER_NBR                            48540000
485500                       FROM TWORKER                               48550000
485600                      WHERE OPERCO_NBR = '03'                     48560000
485700                        AND UID_NBR    = :DP020-USERID)           48570000
485800         END-EXEC                                                 48580000
485900                                                                  48590000
486000         EVALUATE TRUE                                            48600000
486100             WHEN SQLCODE = +0                                    48610000
486200             WHEN SQLCODE = +100                                  48620000
486300             WHEN SQLCODE = -904                                  48630000
486400             WHEN SQLCODE = -913                                  48640000
486500                  CONTINUE                                        48650000
486600                                                                  48660000
486700             WHEN SQLWARN0 NOT = SPACES                           48670000
486800             WHEN SQLCODE < +0                                    48680000
486900             WHEN SQLCODE > +0                                    48690000
487000                  MOVE '5603-CHECK-GMA-AUTHORIZATION'             48700000
487100                                  TO DP013-PARAGRAPH              48710000
487200                  MOVE 'UNSUCCESSFUL COUNT ON WORKER'             48720000
487300                                  TO DP013-MESSAGE-TEXT (1)       48730000
487400                  MOVE SQLCA      TO DP013-SQLCA                  48740000
487500                  MOVE 'TWORKER ' TO DP013-DB2-TABLE-NAME (1)     48750000
487600                  MOVE 'TRSPBAR ' TO DP013-DB2-TABLE-NAME (2)     48760000
487700                  SET DP013-DB2-ABEND                             48770000
487800                      DP013-XCTL-DISPLAY-RESTART                  48780000
487900                                  TO TRUE                         48790000
488000                  PERFORM DP013-0000-PROCESS-ABEND                48800000
488100         END-EVALUATE                                             48810000
488200     END-PERFORM.                                                 48820000
488300                                                                  48830000
488400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        48840000
488500         MOVE '5603-CHECK-GMA-AUTHORIZATION'                      48850000
488600                                  TO DP013-PARAGRAPH              48860000
488700         MOVE 'MAX RETRIES EXCEEDED ON COUNT ON TWORKER'          48870000
488800                                  TO DP013-MESSAGE-TEXT (1)       48880000
488900         MOVE SQLCA               TO DP013-SQLCA                  48890000
489000         MOVE 'TWORKER '          TO DP013-DB2-TABLE-NAME (1)     48900000
489100         MOVE 'TRSPBAR '          TO DP013-DB2-TABLE-NAME (2)     48910000
489200         SET DP013-DB2-ABEND                                      48920000
489300             DP013-XCTL-DISPLAY-RESTART                           48930000
489400                                  TO TRUE                         48940000
489500         PERFORM DP013-0000-PROCESS-ABEND                         48950000
489600     END-IF.                                                      48960000
489700                                                                  48970000
489800 5604-CHECK-NO-AUTHORIZATION.                                     48980000
489900                                                                  48990000
490000     PERFORM                                                      49000000
490100         WITH TEST AFTER                                          49010000
490200         VARYING PV-RETRY-COUNTER                                 49020000
490300         FROM 1 BY 1                                              49030000
490400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               49040000
490500             OR (SQLCODE = +0)                                    49050000
490600             OR (SQLCODE = +100))                                 49060000
490700                                                                  49070000
490800         EXEC SQL                                                 49080000
490900              SELECT COUNT(*)                                     49090000
491000                INTO :PV-DB2-COUNT                                49100000
491100                FROM TMDSEAR A                                    49110000
491200                    ,TRSPBAR B                                    49120000
491300               WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                49130000
491400                 AND A.MDSELV_CDE  = 'DPT'                        49140000
491500                 AND A.OPERCO_NBR  = '03'                         49150000
491600                 AND B.WORKER_STRT_DTE <= CURRENT DATE            49160000
491700                 AND B.WORKER_END_DTE  >= CURRENT DATE            49170000
491800                 AND B.WORKER_NBR  =                              49180000
491900                    (SELECT WORKER_NBR                            49190000
492000                       FROM TWORKER                               49200000
492100                      WHERE OPERCO_NBR = '03'                     49210000
492200                        AND UID_NBR    = :DP020-USERID)           49220000
492300         END-EXEC                                                 49230000
492400                                                                  49240000
492500         EVALUATE TRUE                                            49250000
492600             WHEN SQLCODE = +0                                    49260000
492700             WHEN SQLCODE = +100                                  49270000
492800             WHEN SQLCODE = -904                                  49280000
492900             WHEN SQLCODE = -913                                  49290000
493000                  CONTINUE                                        49300000
493100                                                                  49310000
493200             WHEN SQLWARN0 NOT = SPACES                           49320000
493300             WHEN SQLCODE < +0                                    49330000
493400             WHEN SQLCODE > +0                                    49340000
493500                  MOVE '5604-CHECK-NO-AUTHORIZATION'              49350000
493600                                  TO DP013-PARAGRAPH              49360000
493700                  MOVE 'UNSUCCESSFUL COUNT ON WORKER'             49370000
493800                                  TO DP013-MESSAGE-TEXT (1)       49380000
493900                  MOVE SQLCA      TO DP013-SQLCA                  49390000
494000                  MOVE 'TWORKER ' TO DP013-DB2-TABLE-NAME (1)     49400000
494100                  MOVE 'TRSPBAR ' TO DP013-DB2-TABLE-NAME (2)     49410000
494200                  SET DP013-DB2-ABEND                             49420000
494300                      DP013-XCTL-DISPLAY-RESTART                  49430000
494400                                  TO TRUE                         49440000
494500                  PERFORM DP013-0000-PROCESS-ABEND                49450000
494600         END-EVALUATE                                             49460000
494700     END-PERFORM.                                                 49470000
494800                                                                  49480000
494900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        49490000
495000         MOVE '5604-CHECK-NO-AUTHORIZATION'                       49500000
495100                                  TO DP013-PARAGRAPH              49510000
495200         MOVE 'MAX RETRIES EXCEEDED ON COUNT ON TWORKER'          49520000
495300                                  TO DP013-MESSAGE-TEXT (1)       49530000
495400         MOVE SQLCA               TO DP013-SQLCA                  49540000
495500         MOVE 'TWORKER '          TO DP013-DB2-TABLE-NAME (1)     49550000
495600         MOVE 'TRSPBAR '          TO DP013-DB2-TABLE-NAME (2)     49560000
495700         SET DP013-DB2-ABEND                                      49570000
495800             DP013-XCTL-DISPLAY-RESTART                           49580000
495900                                  TO TRUE                         49590000
496000         PERFORM DP013-0000-PROCESS-ABEND                         49600000
496100     END-IF.                                                      49610000
496200                                                                  49620000
496300 5605-CHECK-NO-DMA-AUTH.                                          49630000
496400                                                                  49640000
496500     PERFORM                                                      49650000
496600         WITH TEST AFTER                                          49660000
496700         VARYING PV-RETRY-COUNTER                                 49670000
496800         FROM 1 BY 1                                              49680000
496900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               49690000
497000             OR (SQLCODE = +0)                                    49700000
497100             OR (SQLCODE = +100))                                 49710000
497200                                                                  49720000
497300         EXEC SQL                                                 49730000
497400              SELECT COUNT(*)                                     49740000
497500                INTO :PV-DB2-COUNT                                49750000
497600                FROM TMDSEAR A                                    49760000
497700                    ,TRSPBAR B                                    49770000
497800               WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                49780000
497900                 AND A.MDSELV_CDE  = 'DMA'                        49790000
498000                 AND A.OPERCO_NBR  = '03'                         49800000
498100                 AND B.WORKER_STRT_DTE <= CURRENT DATE            49810000
498200                 AND B.WORKER_END_DTE  >= CURRENT DATE            49820000
498300                 AND B.WORKER_NBR  =                              49830000
498400                    (SELECT WORKER_NBR                            49840000
498500                       FROM TWORKER                               49850000
498600                      WHERE OPERCO_NBR = '03'                     49860000
498700                        AND UID_NBR    = :DP020-USERID)           49870000
498800         END-EXEC                                                 49880000
498900                                                                  49890000
499000         EVALUATE TRUE                                            49900000
499100             WHEN SQLCODE = +0                                    49910000
499200             WHEN SQLCODE = +100                                  49920000
499300             WHEN SQLCODE = -904                                  49930000
499400             WHEN SQLCODE = -913                                  49940000
499500                  CONTINUE                                        49950000
499600                                                                  49960000
499700             WHEN SQLWARN0 NOT = SPACES                           49970000
499800             WHEN SQLCODE < +0                                    49980000
499900             WHEN SQLCODE > +0                                    49990000
500000                  MOVE '5605-CHECK-NO-DMA-AUTH'                   50000000
500100                                  TO DP013-PARAGRAPH              50010000
500200                  MOVE 'UNSUCCESSFUL COUNT ON WORKER'             50020000
500300                                  TO DP013-MESSAGE-TEXT (1)       50030000
500400                  MOVE SQLCA      TO DP013-SQLCA                  50040000
500500                  MOVE 'TWORKER ' TO DP013-DB2-TABLE-NAME (1)     50050000
500600                  MOVE 'TRSPBAR ' TO DP013-DB2-TABLE-NAME (2)     50060000
500700                  SET DP013-DB2-ABEND                             50070000
500800                      DP013-XCTL-DISPLAY-RESTART                  50080000
500900                                  TO TRUE                         50090000
501000                  PERFORM DP013-0000-PROCESS-ABEND                50100000
501100         END-EVALUATE                                             50110000
501200     END-PERFORM.                                                 50120000
501300                                                                  50130000
501400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        50140000
501500         MOVE '5605-CHECK-NO-DMA-AUTH'                            50150000
501600                                  TO DP013-PARAGRAPH              50160000
501700         MOVE 'MAX RETRIES EXCEEDED ON COUNT ON TWORKER'          50170000
501800                                  TO DP013-MESSAGE-TEXT (1)       50180000
501900         MOVE SQLCA               TO DP013-SQLCA                  50190000
502000         MOVE 'TWORKER '          TO DP013-DB2-TABLE-NAME (1)     50200000
502100         MOVE 'TRSPBAR '          TO DP013-DB2-TABLE-NAME (2)     50210000
502200         SET DP013-DB2-ABEND                                      50220000
502300             DP013-XCTL-DISPLAY-RESTART                           50230000
502400                                  TO TRUE                         50240000
502500         PERFORM DP013-0000-PROCESS-ABEND                         50250000
502600     END-IF.                                                      50260000
502700                                                                  50270000
502800 5606-CHECK-NO-GMA-AUTH.                                          50280000
502900                                                                  50290000
503000     PERFORM                                                      50300000
503100         WITH TEST AFTER                                          50310000
503200         VARYING PV-RETRY-COUNTER                                 50320000
503300         FROM 1 BY 1                                              50330000
503400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               50340000
503500             OR (SQLCODE = +0)                                    50350000
503600             OR (SQLCODE = +100))                                 50360000
503700                                                                  50370000
503800         EXEC SQL                                                 50380000
503900              SELECT COUNT(*)                                     50390000
504000                INTO :PV-DB2-COUNT                                50400000
504100                FROM TMDSEAR A                                    50410000
504200                    ,TRSPBAR B                                    50420000
504300               WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                50430000
504400                 AND A.MDSELV_CDE  = 'GMA'                        50440000
504500                 AND A.OPERCO_NBR  = '03'                         50450000
504600                 AND B.WORKER_STRT_DTE <= CURRENT DATE            50460000
504700                 AND B.WORKER_END_DTE  >= CURRENT DATE            50470000
504800                 AND B.WORKER_NBR  =                              50480000
504900                    (SELECT WORKER_NBR                            50490000
505000                       FROM TWORKER                               50500000
505100                      WHERE OPERCO_NBR = '03'                     50510000
505200                        AND UID_NBR    = :DP020-USERID)           50520000
505300         END-EXEC                                                 50530000
505400                                                                  50540000
505500         EVALUATE TRUE                                            50550000
505600             WHEN SQLCODE = +0                                    50560000
505700             WHEN SQLCODE = +100                                  50570000
505800             WHEN SQLCODE = -904                                  50580000
505900             WHEN SQLCODE = -913                                  50590000
506000                  CONTINUE                                        50600000
506100                                                                  50610000
506200             WHEN SQLWARN0 NOT = SPACES                           50620000
506300             WHEN SQLCODE < +0                                    50630000
506400             WHEN SQLCODE > +0                                    50640000
506500                  MOVE '5606-CHECK-NO-GMA-AUTH'                   50650000
506600                                  TO DP013-PARAGRAPH              50660000
506700                  MOVE 'UNSUCCESSFUL COUNT ON WORKER'             50670000
506800                                  TO DP013-MESSAGE-TEXT (1)       50680000
506900                  MOVE SQLCA      TO DP013-SQLCA                  50690000
507000                  MOVE 'TWORKER ' TO DP013-DB2-TABLE-NAME (1)     50700000
507100                  MOVE 'TRSPBAR ' TO DP013-DB2-TABLE-NAME (2)     50710000
507200                  SET DP013-DB2-ABEND                             50720000
507300                      DP013-XCTL-DISPLAY-RESTART                  50730000
507400                                  TO TRUE                         50740000
507500                  PERFORM DP013-0000-PROCESS-ABEND                50750000
507600         END-EVALUATE                                             50760000
507700     END-PERFORM.                                                 50770000
507800                                                                  50780000
507900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        50790000
508000         MOVE '5606-CHECK-NO-GMA-AUTH'                            50800000
508100                                  TO DP013-PARAGRAPH              50810000
508200         MOVE 'MAX RETRIES EXCEEDED ON COUNT ON TWORKER'          50820000
508300                                  TO DP013-MESSAGE-TEXT (1)       50830000
508400         MOVE SQLCA               TO DP013-SQLCA                  50840000
508500         MOVE 'TWORKER '          TO DP013-DB2-TABLE-NAME (1)     50850000
508600         MOVE 'TRSPBAR '          TO DP013-DB2-TABLE-NAME (2)     50860000
508700         SET DP013-DB2-ABEND                                      50870000
508800             DP013-XCTL-DISPLAY-RESTART                           50880000
508900                                  TO TRUE                         50890000
509000         PERFORM DP013-0000-PROCESS-ABEND                         50900000
509100     END-IF.                                                      50910000
509200                                                                  50920000
509300 EJECT                                                            50930000
509400                                                                  50940000
509500*----------------------------------------------------------------*50950000
509600*    ABEND PROCESSOR MODULE                                      *50960000
509700*----------------------------------------------------------------*50970000
509800                                                                  50980000
509900     COPY DPPD013.                                                50990000
