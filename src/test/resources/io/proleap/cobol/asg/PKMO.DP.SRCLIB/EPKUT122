000100 IDENTIFICATION DIVISION.                                         00010008
000200 PROGRAM-ID.      EPKUT122.                                       00020008
000300 AUTHOR.          BOB KOLESAR (SAFENET CONSULTING).               00030008
000400 DATE-WRITTEN.    FEBRUARY, 2003.                                 00040008
000500                                                                  00050008
000600*-----------------------------------------------------------      00060008
000700*       TIERED PRICING CORRECTION IDENTIFIER                      00070020
000800*-----------------------------------------------------------      00080008
000900*-----------------------------------------------------------      00090008
001000* HISTORY LOG:                                                    00100008
001100*-----------------------------------------------------------      00110008
001200* DATE:                                                           00120008
001300* WR/IR#:                                                         00130008
001400* PROGRAMMER:                                                     00140008
001500* DESCRIPTION:                                                    00150008
001600*                                                                 00160008
001700*----------------------------------------------------------       00170008
001800 ENVIRONMENT DIVISION.                                            00180008
001900*----------------------------------------------------------       00190008
002000 CONFIGURATION SECTION.                                           00200008
002100 SOURCE-COMPUTER.        IBM-3090.                                00210008
002200 OBJECT-COMPUTER.        IBM-3090.                                00220008
002210                                                                  00221008
002220 INPUT-OUTPUT SECTION.                                            00222008
002230                                                                  00223008
002240 FILE-CONTROL.                                                    00224008
002250                                                                  00225008
002251     SELECT CONTROL-CARD-PGM-LAST-RUN-DTE                         00225108
002252       ASSIGN TO INP01.                                           00225215
002253     SELECT CONTROL-CARD-CURR-PRICG-DTE                           00225308
002254       ASSIGN TO INP02.                                           00225415
002255     SELECT CONTROL-CARD-FUTRE-CORR-DTE                           00225508
002256       ASSIGN TO INP03.                                           00225615
002257     SELECT CONTROL-CARD-CRIT-EFF-DTE                             00225708
002258       ASSIGN TO INP04.                                           00225815
002259     SELECT PROMO-NIGHT-FILE                                      00225908
002260       ASSIGN TO OUT01.                                           00226015
002261     SELECT PROMO-EMERGENCY-FILE                                  00226108
002262       ASSIGN TO OUT02.                                           00226215
002263                                                                  00226308
002264 DATA DIVISION.                                                   00226408
002265 FILE SECTION.                                                    00226508
002266                                                                  00226608
002267 FD  CONTROL-CARD-PGM-LAST-RUN-DTE                                00226708
002268     RECORDING MODE F                                             00226808
002269     BLOCK CONTAINS 0 RECORDS                                     00226908
002270     LABEL RECORDS ARE OMITTED                                    00227008
002271     DATA RECORD IS CNTRL-CARD-PGM-LAST-RUN-REC.                  00227108
002272 01  CNTRL-CARD-PGM-LAST-RUN-REC                   PIC  X(080).   00227208
002273                                                                  00227308
002274 FD  CONTROL-CARD-CURR-PRICG-DTE                                  00227408
002275     RECORDING MODE F                                             00227508
002276     BLOCK CONTAINS 0 RECORDS                                     00227608
002277     LABEL RECORDS ARE OMITTED                                    00227708
002278     DATA RECORD IS CNTRL-CARD-CURR-PRICG-DTE-REC.                00227808
002279 01  CNTRL-CARD-CURR-PRICG-DTE-REC                 PIC  X(080).   00227908
002280                                                                  00228008
002290 FD  CONTROL-CARD-FUTRE-CORR-DTE                                  00229008
002300     RECORDING MODE F                                             00230008
002400     BLOCK CONTAINS 0 RECORDS                                     00240008
002500     LABEL RECORDS ARE OMITTED                                    00250008
002600     DATA RECORD IS CNTRL-CARD-FUTRE-CORR-DTE-REC.                00260008
002700 01  CNTRL-CARD-FUTRE-CORR-DTE-REC                 PIC  X(080).   00270008
002800                                                                  00280008
002900 FD  CONTROL-CARD-CRIT-EFF-DTE                                    00290008
003000     RECORDING MODE F                                             00300008
003010     BLOCK CONTAINS 0 RECORDS                                     00301008
003020     LABEL RECORDS ARE OMITTED                                    00302008
003030     DATA RECORD IS CNTRL-CARD-CRIT-EFF-DTE-REC.                  00303008
003040 01  CNTRL-CARD-CRIT-EFF-DTE-REC                   PIC  X(080).   00304008
003050                                                                  00305008
003060 FD  PROMO-NIGHT-FILE                                             00306008
003070     RECORDING MODE F                                             00307008
003080     BLOCK CONTAINS 0 RECORDS                                     00308008
003090     LABEL RECORDS ARE OMITTED                                    00309008
003100     DATA RECORD IS PROMO-NIGHT-ID-RECORD.                        00310008
003101 01  PROMO-NIGHT-RECORD                            PIC  X(200).   00310108
003102                                                                  00310208
003103 FD  PROMO-EMERGENCY-FILE                                         00310308
003104     RECORDING MODE F                                             00310408
003105     BLOCK CONTAINS 0 RECORDS                                     00310508
003106     LABEL RECORDS ARE OMITTED                                    00310608
003110     DATA RECORD IS PROMO-EMERG-ID-RECORD.                        00310708
003120 01  PROMO-EMERGENCY-RECORD                        PIC  X(200).   00310808
003130                                                                  00310908
003140 WORKING-STORAGE SECTION.                                         00311008
003150*-----------------------------------------------------------      00312008
003160* PS - PROGRAM SWITCHES                                           00313008
003170*-----------------------------------------------------------      00314008
003180 01  PS-PROGRAM-SWITCHES.                                         00315008
003190     05  PS-TIER-PRICG-CSR-EOF-SW                  PIC  X(001).   00316008
003200       88  PS-TIER-PRICG-CSR-EOF                     VALUE 'Y'.   00317008
003300       88  PS-TIER-PRICG-CSR-NOT-EOF                 VALUE 'N'.   00318008
003400     05  PS-TIER-PRICG-ADHOC-CSR-EOF-SW            PIC  X(001).   00319008
003500       88  PS-TIER-PRICG-ADHOC-CSR-EOF               VALUE 'Y'.   00320008
003600       88  PS-TIER-PRICG-ADHC-CSR-NOT-EOF            VALUE 'N'.   00330012
004000     05  PS-REC-FOUND-SW                           PIC  X(001).   00370008
004100       88  PS-REC-FOUND                              VALUE 'Y'.   00380008
004200       88  PS-NO-REC-FOUND                           VALUE 'N'.   00390008
004300     05  PS-WRITE-PROMO-SW                         PIC  X(001).   00400008
004400       88  PS-WRITE-PROMO                            VALUE 'Y'.   00410008
004500       88  PS-DONT-WRITE-PROMO                       VALUE 'N'.   00420008
004600     05  PS-FILE-STATUS                            PIC  X(002).   00430008
004700       88  PS-SUCCESSFUL-COMPLETION                  VALUE '00'.  00440008
004800       88  PS-END-OF-FILE                            VALUE '10'.  00450008
004900       88  PS-SUCCESSFUL-OPEN                        VALUE '97'.  00460008
005000     05  PS-END-OF-CNTL-CRD-SW                     PIC  X(001).   00470008
005100       88  PS-END-OF-CNTL-CRD-FILE                   VALUE 'Y'.   00480008
005200       88  PS-NOT-END-OF-CNTL-CRD-FILE               VALUE 'N'.   00490008
005300                                                                  00500008
005400*-----------------------------------------------------------      00510008
005500* PROGRAM CONSTANTS                                               00520008
005600*-----------------------------------------------------------      00530008
005700 01  PC-PROGRAM-CONSTANTS.                                        00540008
005800     05  PC-CURRENT-PROGRAM-NAME                   PIC  X(008)    00550008
005900       VALUE 'EPKUT122'.                                          00560008
006000     05  PC-PRICING-BUS-EVENT                      PIC  X(003)    00570008
006010       VALUE '090'.                                               00580008
006020     05  PC-ADHOC-DEV-BUS-EVENT                    PIC  X(003)    00590008
006030       VALUE '050'.                                               00600008
006040     05  PC-RMS-PRC-SETUP-IND                      PIC  X(001)    00601008
006050       VALUE 'R'.                                                 00602008
006060     05  PC-ADHOC-PRC-SETUP-IND                    PIC  X(001)    00603008
006070       VALUE 'A'.                                                 00604008
006080     05  PC-ADHOC-STR-GRP-TYP-CDE                  PIC  X(005)    00605015
006090       VALUE '99999'.                                             00606015
006091     05  PC-ADHOC-STR-SPEC-CDE                     PIC  X(004)    00607008
006092       VALUE '5000'.                                              00608008
006093     05  PC-STR-SELN-HIER-CDE                      PIC  X(002)    00609008
006094       VALUE '61'.                                                00609108
006095     05  PC-FILE-ACT-TYPE                          PIC  X(003)    00609208
006096       VALUE 'CHG'.                                               00609308
006097     05  PC-APPLY-NIGHTLY                          PIC  X(001)    00609408
006098       VALUE 'N'.                                                 00609508
006099     05  PC-APPLY-CORRECTION                       PIC  X(001)    00609608
006100       VALUE 'C'.                                                 00609708
006101     05  PC-TIER-PRICG-STAT-CDE                    PIC  X(001).   00609808
006102       88  PC-SCHEDULED-STATUS                       VALUE 'S'.   00609908
006103       88  PC-DELETE-STATUS                          VALUE 'D'.   00610008
006104       88  PC-CANCEL-STATUS                          VALUE 'C'.   00610108
006105     05  PC-ADD-STAT-CDE                           PIC  X(001)    00610208
006106       VALUE 'A'.                                                 00610308
006107     05  PC-DELETE-STAT-CDE                        PIC  X(001)    00610408
006108       VALUE 'D'.                                                 00610508
006109     05  PC-MDSE-INCL-IND                          PIC  X(001)    00610608
006110       VALUE 'I'.                                                 00610708
006120                                                                  00610808
006130*-----------------------------------------------------------      00610908
006140* PV- PROGRAM VARIABLES                                           00611008
006150*-----------------------------------------------------------      00612008
006160 01  PV-PROGRAM-VARAIBLES.                                        00613008
007500     05  PV-SQL-SUB                                PIC S9(004)    00614015
007510                                                     VALUE +0     00615015
007520                                                     COMP.        00616015
008210     05  PV-CURRENT-SYSTEM-TMST                    PIC  X(026)    00617015
008220                                                     VALUE SPACES.00618015
008300     05  PV-ACTL-STRT-TMST.                                       00619015
008310       10  PV-ACTL-STRT-TMST-DATE                  PIC  X(010)    00620015
008311                                                     VALUE SPACES.00630015
008320       10  FILLER                                  PIC  X(016)    00640015
008330                                                     VALUE SPACES.00650015
008400     05  PV-ACTL-END-TMST                          PIC  X(026)    00660015
008410                                                     VALUE SPACES.00670015
008500     05  PV-SOR-LAST-UPD-TMST                      PIC  X(026)    00680015
008510                                                     VALUE SPACES.00690015
008600     05  PV-EFF-STRT-TMST                          PIC  X(026)    00700015
008610                                                     VALUE SPACES.00710015
008700     05  PV-EFF-END-TMST                           PIC  X(026)    00720015
008710                                                     VALUE SPACES.00730015
008800     05  PV-EFF-END-NULL                           PIC S9(004)    00740015
008911                                                     VALUE ZEROS  00750015
008810                                                     COMP.        00760015
008900     05  PV-ABEND-CODE                             PIC  9999      00770015
008911                                                     VALUE ZEROS  00780015
008912                                                     COMP.        00790015
009000     05  PV-FUL-FILE-STR                           PIC  9(005)    00800015
009010                                                     VALUE ZEROS. 00810015
009100     05  EP111-CC-DATE-PLUS1                       PIC  X(010)    00820015
009110                                                     VALUE SPACES.00830015
009200     05  EP113-CC-CRNT-DTE-MINUS1                  PIC  X(010)    00840015
009300                                                     VALUE SPACES.00850015
009400                                                                  00860015
008710*----------------------------------------------------------       00868008
008800* FULL FILE EXTRACT OUTPUT FILE.                                  00869008
008900*----------------------------------------------------------       00870008
009000     COPY EPRD072.                                                00880008
009100                                                                  00890008
009200*----------------------------------------------------------       00900008
009300* EPCC111 CONTROL CARD LAYOUT                                     00910008
009400*----------------------------------------------------------       00920008
009500     COPY EPRD111.                                                00930008
009600                                                                  00940008
009700*----------------------------------------------------------       00950008
009800* EPCC113 CONTROL CARD LAYOUT                                     00960008
009900*----------------------------------------------------------       00970008
010000     COPY EPRD113.                                                00980008
010100                                                                  00990008
010200*----------------------------------------------------------       01000008
010300* EPCC115 CONTROL CARD LAYOUT                                     01010008
010400*----------------------------------------------------------       01020008
010500     COPY EPRD115.                                                01030008
010600                                                                  01040008
010700*----------------------------------------------------------       01050008
010800* EPCC128 CONTROL CARD LAYOUT                                     01060008
010810*----------------------------------------------------------       01070008
010820     COPY EPRD128.                                                01080008
010830                                                                  01081008
010900*----------------------------------------------------------       01082008
011000* DATE ROUTINE COPY MEMBERS                                       01083008
011100*----------------------------------------------------------       01084008
011200     COPY DPWS500.                                                01085008
011300                                                                  01086008
011400*-----------------------------------------------------------      01087008
011500* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         01088008
011600*-----------------------------------------------------------      01089008
011700     COPY DPWS004.                                                01090008
011800                                                                  01100008
011900*-----------------------------------------------------------      01110008
012000* DB2 ABEND COPYBOOK                                              01120008
012100*-----------------------------------------------------------      01130008
012200     COPY DPWS900.                                                01140008
012300                                                                  01150008
012400*-----------------------------------------------------------      01160008
012500* DB2 MESSAGE AREA                                                01170008
012600*-----------------------------------------------------------      01180008
012700     COPY SQLCA2.                                                 01190008
012800                                                                  01200008
012900*-----------------------------------------------------------      01210008
013000* PROGRAM COUNTERS                                                01220008
013100*-----------------------------------------------------------      01230008
013200 01  PC-PROGRAM-COUNTERS.                                         01240008
013210     05  PC-CNT-READ-RECS                          PIC  9(009)    01250008
013220                                                     VALUE 0.     01260008
013230     05  PC-CNT-NIGHT-RECS                         PIC  9(009)    01270008
013240                                                     VALUE 0.     01280008
013250     05  PC-CNT-EMERG-RECS                         PIC  9(009)    01290008
013260                                                     VALUE 0.     01300008
013290     05  PC-CNT-RMS-RECS                           PIC  9(009)    01321008
013291                                                     VALUE 0.     01322008
013292     05  PC-CNT-ADHOC-RECS                         PIC  9(009)    01323008
013293                                                    VALUE 0.      01324008
013290     05  PC-CNT-ADD-RECS                           PIC  9(009)    01324109
013291                                                     VALUE 0.     01324209
013292     05  PC-CNT-DELTE-RECS                         PIC  9(009)    01324309
013293                                                    VALUE 0.      01324409
013294     05  PC-CNT-DEVT-RECS                          PIC  9(009)    01325008
013295                                                     VALUE 0.     01326008
013270     05  PC-CNT-PROMO-RECS                         PIC  9(009)    01326109
013280                                                     VALUE 0.     01326209
013296     05  PC-CNT-PMAP-RECS                          PIC  9(009)    01327008
013297                                                     VALUE 0.     01328008
013298     05  PC-CNT-ERROR-RECS                         PIC  9(009)    01329008
013299                                                     VALUE 0.     01329108
013300     05  PC-CNT-ALL-RECS                           PIC  9(009)    01329208
013301                                                     VALUE 0.     01329308
013302     05  PC-CNT-SPACES                             PIC  9(009)    01329408
013303                                                     VALUE 0.     01329508
013304     05  PC-CNT-POS                                PIC  9(009)    01329608
013305                                                     VALUE 0.     01329708
013306     05  PC-CNT-EXCL-CHECK                         PIC  9(009)    01329808
013307                                                     VALUE 0.     01329908
013308     05  PC-MAX-RETRIES                            PIC S9(004)    01330008
013309                                                     VALUE +5     01330108
013310                                                     COMP.        01330208
014070                                                                  01330308
014080*-----------------------------------------------------------      01330408
014090* ERROR HANDLING                                                  01330508
014100*-----------------------------------------------------------      01330608
014200 01  PV-MISC-ABEND-FIELDS.                                        01330708
014300     05  PV-PARAGRAPH-NAME                         PIC  X(030)    01330808
014400                                                     VALUE SPACE. 01330908
014500     05  PV-OPERATION-MSG-1                         PIC  X(040)   01331008
014600                                                      VALUE SPACE.01332008
014700     05  PV-OPERATION-MSG-2                         PIC  X(040)   01333008
014800                                                      VALUE SPACE.01334008
014900     05  PV-DB2-OPERATION                           PIC  X(030)   01335008
015000                                                      VALUE SPACE.01336008
015100 01  ABEND-CODE                                     PIC S9(004)   01337008
015200                                                      VALUE ZEROS 01338008
015300                                                      COMP        01339008
015310                                                      SYNC.       01340008
015320   88  ABEND-4003-CTRL-CARD-ERROR                     VALUE +4003.01350008
015330   88  ABEND-4013-DB2-ERROR                           VALUE +4013.01360008
015340   88  ABEND-4019-CAL-SUB-ERROR                       VALUE +4019.01370008
015350   88  ABEND-4020-MQ-ERROR                            VALUE +4020.01380008
015360   88  ABEND-4444-FORCED-ABEND                        VALUE +4444.01390008
015370   88  ABEND-4008                                     VALUE +4008.01400008
015380                                                                  01410008
015400                                                                  01420008
015500*-----------------------------------------------------------      01430008
015600* DB2 COMMUNICATIONS AREA                                         01440008
015700*-----------------------------------------------------------      01450008
015800     EXEC SQL                                                     01460008
015900       INCLUDE SQLCA                                              01470008
016000     END-EXEC.                                                    01480008
016100                                                                  01490008
016200*-----------------------------------------------------------      01500008
016300* DB2 TABLE XST00023(XST_STR_GP_MBSHP) - STORE GROUP              01510008
016400*-----------------------------------------------------------      01520008
016500     EXEC SQL                                                     01530008
016600       INCLUDE XST00023                                           01540008
016700     END-EXEC.                                                    01550008
016800                                                                  01560008
016810*-----------------------------------------------------------      01570008
016820* DB2 TABLE XST00028(XST_MDSE_LNE_SELN) - MERCHANDISE TABLE       01580008
016830*-----------------------------------------------------------      01590008
016840     EXEC SQL                                                     01600008
016850       INCLUDE XST00028                                           01610008
016860     END-EXEC.                                                    01620008
016870                                                                  01630008
016900*-----------------------------------------------------------      01640008
017000* DB2 TABLE XST00029(XST_PROMO_STR_GP) - STORE ZONE PRICING       01650008
017100*                                               TABLE             01660008
017200*-----------------------------------------------------------      01670008
017300     EXEC SQL                                                     01680008
017400       INCLUDE XST00029                                           01690008
017500     END-EXEC.                                                    01700008
017600                                                                  01710008
018220*-----------------------------------------------------------      01790008
018230* DB2 TABLE XST00031(XST_PROMO_ADHC_RLT) ADHOC RELATION           01800008
018240*-----------------------------------------------------------      01810008
018250     EXEC SQL                                                     01820008
018260       INCLUDE XST00031                                           01821008
018270     END-EXEC.                                                    01822008
018300                                                                  01823008
018400*-----------------------------------------------------------      01824008
018500* DB2 TABLE XST00033(XST_PROMO_ADHC_STR) PROMO ADHOC STORES       01825008
018600*-----------------------------------------------------------      01826008
018700     EXEC SQL                                                     01827008
018800       INCLUDE XST00033                                           01828008
018900     END-EXEC.                                                    01829008
019000                                                                  01830008
017700*-----------------------------------------------------------      01831008
017800* DB2 TABLE XST00035(XST_TIER_PRICG) TIERED PRICING               01832008
017900*-----------------------------------------------------------      01833008
018000     EXEC SQL                                                     01834008
018100       INCLUDE XST00035                                           01835008
018200     END-EXEC.                                                    01836008
018210                                                                  01837008
019100*-----------------------------------------------------------      01840008
019200* TIERED PRICING CHANGE INTERFACE INCLUDE CURSOR. (RMS)           01850008
019300*-----------------------------------------------------------      01860008
019400     EXEC SQL                                                     01870008
019500       DECLARE TIER-PRICG-RMS CURSOR FOR                          01880015
019900         SELECT TERPRC.PROMO_INTFC_SUB_ID                         01881009
019510               ,TERPRC.STAT_CDE                                   01890009
019600               ,TERPRC.LAST_UPD_TMST                              01900008
019800               ,TERPRC.SOR_LAST_UPD_TMST                          01910008
019900               ,STRGP.PROMO_INTFC_ID                              01921030
020000               ,STRGP.MDSE_LNE_ID                                 01930030
020100               ,STRGP.STR_GP_TYP_CDE                              01940030
020200               ,STRGP.STR_GP_ID                                   01950030
020300               ,STRGP.STR_SELN_HIER_CDE                           01960030
020400               ,STRGP.ACTL_STRT_TMST                              01970030
020500               ,STRGP.ACTL_END_TMST                               01980030
020600               ,MDSSEL.PRICG_TYP_CDE                              01990008
020700         FROM XST_TIER_PRICG     TERPRC                           02000015
020800             ,XST_PROMO_STR_GP   STRGP                            02010030
020900             ,XST_MDSE_LNE_SELN  MDSSEL                           02020015
021874         WHERE TERPRC.PROMO_INTFC_ID = MDSSEL.PROMO_INTFC_ID      02021015
021100           AND TERPRC.MDSE_LNE_ID    = MDSSEL.MDSE_LNE_ID         02040015
021200           AND MDSSEL.PROMO_INTFC_ID = STRGP.PROMO_INTFC_ID       02050030
021300           AND MDSSEL.MDSE_LNE_ID    = STRGP.MDSE_LNE_ID          02060030
021500           AND STRGP.STAT_CDE IN ('S','D')                        02080033
021600           AND (TERPRC.LAST_UPD_TMST                              02090015
JNSCHG               BETWEEN '2018-11-05-17.56.31.719769'               02100030
JNSCHG                   AND CURRENT TIMESTAMP)                         02110030
021720           AND (('2018-11-05'                                     02120031
021730               BETWEEN DATE(STRGP.ACTL_STRT_TMST)                 02130030
021740                   AND DATE(STRGP.ACTL_END_TMST))                 02140030
021750           OR  (DATE(STRGP.ACTL_STRT_TMST)                        02150030
021760               BETWEEN '2018-11-06'                               02160031
021770                   AND '2018-11-09'))                             02170031
021780         FOR FETCH ONLY                                           02171015
021790         WITH UR                                                  02172015
021800     END-EXEC.                                                    02173008
021801                                                                  02174008
021802*-----------------------------------------------------------      02175008
021803* TIERED PRICING CHANGE ID ADHOC CURSOR.                          02176008
021804*-----------------------------------------------------------      02177008
021805     EXEC SQL                                                     02178008
021806       DECLARE TIER-PRICG-ADHOC CURSOR FOR                        02179011
019900         SELECT TERPRC.PROMO_INTFC_SUB_ID                         02179109
019510               ,TERPRC.STAT_CDE                                   02179209
021808               ,TERPRC.LAST_UPD_TMST                              02180108
021810               ,TERPRC.SOR_LAST_UPD_TMST                          02180208
021811               ,ADHOC.PROMO_INTFC_ID                              02180308
021820               ,ADHOC.MDSE_LNE_ID                                 02180408
021830               ,ADHOC.ADHC_STR_GP_ID                              02180508
021840               ,ADHOC.STR_SELN_HIER_CDE                           02180608
021850               ,ADHOC.ACTL_STRT_TMST                              02180708
021860               ,ADHOC.ACTL_END_TMST                               02180808
021870               ,MDSSEL.PRICG_TYP_CDE                              02180908
021871         FROM XST_TIER_PRICG     TERPRC                           02181008
021872             ,XST_PROMO_ADHC_RLT ADHOC                            02182008
021873             ,XST_MDSE_LNE_SELN  MDSSEL                           02183008
021874         WHERE TERPRC.PROMO_INTFC_ID = MDSSEL.PROMO_INTFC_ID      02184008
021875           AND TERPRC.MDSE_LNE_ID    = MDSSEL.MDSE_LNE_ID         02185008
021876           AND ADHOC.PROMO_INTFC_ID  = MDSSEL.PROMO_INTFC_ID      02186008
021877           AND ADHOC.MDSE_LNE_ID     = MDSSEL.MDSE_LNE_ID         02187008
021878           AND ADHOC.STAT_CDE  IN ('S','D')                       02187133
021880           AND (TERPRC.LAST_UPD_TMST                              02187308
JNSCHG               BETWEEN '2018-11-05-17.56.31.719769'               02187430
JNSCHG                   AND CURRENT TIMESTAMP)                         02187530
021910           AND ((:EP111-CC-CRNT-DTE                               02187631
021911               BETWEEN DATE(ADHOC.ACTL_STRT_TMST)                 02187731
021912                   AND DATE(ADHOC.ACTL_END_TMST))                 02187831
021913           OR  (DATE(ADHOC.ACTL_STRT_TMST)                        02187931
JNSCHG               BETWEEN :EP111-CC-DATE-PLUS1                       02188031
JNSCHG                   AND :EP113-CC-CRNT-DTE-MINUS1))                02189031
021916         FOR FETCH ONLY                                           02190008
021917         WITH UR                                                  02191008
021918     END-EXEC.                                                    02191108
021919                                                                  02191208
021971 LINKAGE SECTION.                                                 02196808
021972                                                                  02196908
021973*----------------------------------------------------------       02197008
021974 PROCEDURE DIVISION.                                              02197108
021975*----------------------------------------------------------       02197208
021976 0000-MAINLINE.                                                   02197308
021977                                                                  02197408
021978     PERFORM 1000-INITIALIZATION.                                 02197508
021979                                                                  02197608
021980     PERFORM 2000-PROCESS-TIERED-PRICING.                         02197708
021981                                                                  02197808
021982     PERFORM 9999-WRAPUP.                                         02197908
021983                                                                  02198008
021984     GOBACK.                                                      02198108
021985                                                                  02198208
021986*0000-EXIT.                                                       02198308
021987 EJECT.                                                           02198408
021988                                                                  02198508
021989*----------------------------------------------------------       02198608
021990* 1000-INITIALIZATION.                                            02198708
021991*     INITIALIZATION AREA - INITIALIZES ALL VARIABLES, OPENS      02198808
021992*     FILES, READS INPUT FILES, AND PROCESSES ANY INPUT FILE      02198908
021993*     PARAMETERS IT MAY NEED TO USE TO READ THE PROMO             02199008
021994*     INTERFACE ID FILE.                                          02199108
021995*----------------------------------------------------------       02199208
022000 1000-INITIALIZATION.                                             02199308
022100                                                                  02199408
JNSXXX     DISPLAY '1000-INITIALIZATION'.                               02199530
022100                                                                  02199630
022200     OPEN INPUT  CONTROL-CARD-CURR-PRICG-DTE                      02199730
022300                 CONTROL-CARD-FUTRE-CORR-DTE                      02199830
022400                 CONTROL-CARD-PGM-LAST-RUN-DTE                    02199930
022500                 CONTROL-CARD-CRIT-EFF-DTE.                       02200030
022600     OPEN OUTPUT PROMO-NIGHT-FILE                                 02200130
022700                 PROMO-EMERGENCY-FILE.                            02201030
022800                                                                  02210008
023000     INITIALIZE EP072-PROMO-INTFC-RECORD.                         02220008
023100                                                                  02230008
023200     PERFORM 1010-GET-CURRENT-SYSTEM-TMST.                        02240008
023300     PERFORM 1020-READ-PGM-LAST-RUN-CARD.                         02250008
023400     PERFORM 1030-READ-CURR-PRICG-DTE-CARD.                       02260008
023500     PERFORM 1040-READ-FUTRE-CORR-DTE-CARD.                       02270008
023600     PERFORM 1050-READ-CRIT-EFF-DTE-CARD.                         02280008
023800     PERFORM 6100-DATE-ROUTINE.                                   02290008
023900                                                                  02300008
024000*1000-EXIT.                                                       02310008
024100 EJECT.                                                           02320008
024200                                                                  02330008
024300*----------------------------------------------------------       02340008
024400* 1010-GET-CURRENT-SYSTEM-TMST.                                   02350008
024500*     RETREIVE THE CURRENT SYSTEM TIMESTAMP. THIS WILL BE         02360008
024600*     USED WITHIN THE QUERIES TO IDENTIFY WHICH SIMPLE            02370008
024700*     PRICING CHANGES NEED TO BE INCLUDED, TMST ALSO WILL BE      02380008
024800*     USED TO UPDATE EPCC115 ON PROGRAM EXIT.                     02390008
024900*----------------------------------------------------------       02400008
025000 1010-GET-CURRENT-SYSTEM-TMST.                                    02410008
025100                                                                  02420008
JNSXXX     DISPLAY '1010-GET-CURRENT-SYSTEM-TMST'.                      02421030
025200     EXEC SQL                                                     02430008
025300       SET :PV-CURRENT-SYSTEM-TMST = CURRENT TIMESTAMP            02440008
025400     END-EXEC.                                                    02450008
025500                                                                  02460008
025600     IF SQLCODE NOT EQUAL ZERO                                    02470008
025700       MOVE 'GET CURRENT TIMESTAMP' TO PV-DB2-OPERATION           02480015
025800       MOVE '1010-GET-CURRENT-SYSTEM-TMST'                        02490015
025900                                     TO PV-PARAGRAPH-NAME         02500008
026000       PERFORM 9900-SQL-ABEND-ROUTINE                             02510015
026100     END-IF.                                                      02520008
026200                                                                  02530008
026300*1010-EXIT.                                                       02540008
026400 EJECT.                                                           02550008
026500                                                                  02560008
026600*----------------------------------------------------------       02570008
026700* 1020-READ-PGM-LAST-RUN-CARD.                                    02580008
026800*     READ CONTROL CARD EPCC115. THIS CONTROL CARD CONTAINS       02590008
026900*     THE TIMESTAMP FROM THE LAST RUN OF EPKUT122                 02600008
027000*----------------------------------------------------------       02610008
027100 1020-READ-PGM-LAST-RUN-CARD.                                     02620008
027200                                                                  02630008
JNSXXX     DISPLAY '1020-READ-PGM-LAST-RUN-CARD'.                       02631030
027300     READ CONTROL-CARD-PGM-LAST-RUN-DTE                           02640008
027400                                    INTO EP115-CC-CONTROL-CARD    02650008
027500       AT END                                                     02660008
027600          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    02670008
027700                                                                  02680008
027800     IF PS-END-OF-CNTL-CRD-FILE                                   02690008
027900       DISPLAY ' '                                                02700008
028000       DISPLAY '** ABEND     **'                                  02710008
028100       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      02720008
028200       DISPLAY '** PARAGRAPH **  = 1020-READ-PGM-LAST-RUN-CARD'   02730008
028300       DISPLAY '** CONTROL FILE IS EMPTY  '                       02740008
028310       DISPLAY ' '                                                02750008
028320       MOVE +4002 TO ABEND-CODE                                   02760008
028330       CALL 'ILBOABN0' USING ABEND-CODE                           02770008
028340     ELSE                                                         02780008
028341       DISPLAY '** PROGRAM LAST RUN CONTROL CARD  **'             02790008
028342       DISPLAY '** EPCC115     **  =' EP115-CC-TIER-CUTOFF-TMST   02800012
028343       DISPLAY ' '                                                02810008
028344     END-IF.                                                      02820008
028345                                                                  02830008
028346*1020-EXIT.                                                       02831008
028347 EJECT.                                                           02832008
028348                                                                  02833008
028349*----------------------------------------------------------       02834008
028350* 1030-READ-CURR-PRICG-DTE-CARD.                                  02835008
028351*     READ CONTROL CARD EPCC111. THIS CONTROL CARD CONTAINS       02835108
028352*     THE CURRENT PRICING DATE.                                   02835208
028353*----------------------------------------------------------       02835308
028354 1030-READ-CURR-PRICG-DTE-CARD.                                   02835408
028355                                                                  02835508
JNSXXX     DISPLAY '1030-READ-CURR-PRICG-DTE-CARD'.                     02835630
028356     READ CONTROL-CARD-CURR-PRICG-DTE                             02835708
028357                               INTO EP111-CC-CONTROL-CARD         02835808
028358       AT END                                                     02835908
028359          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    02836008
028360                                                                  02836108
028361     IF PS-END-OF-CNTL-CRD-FILE                                   02836208
028362       DISPLAY ' '                                                02836308
028363       DISPLAY '** ABEND     **'                                  02836408
028364       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      02836508
028365       DISPLAY '** PARAGRAPH **  = 1030-READ-CURR-PRICG-DTE-CARD' 02836608
028366       DISPLAY '** CONTROL FILE IS EMPTY  '                       02836708
028367       DISPLAY ' '                                                02836808
028368       MOVE +4002 TO ABEND-CODE                                   02836908
028369       CALL 'ILBOABN0' USING ABEND-CODE                           02837008
028370     ELSE                                                         02837108
028371       DISPLAY '** CURRENT PRICING DATE CONTROL CARD  **'         02837208
028372       DISPLAY '** EPCC111       **  = ' EP111-CC-CRNT-DTE        02837308
028373       DISPLAY ' '                                                02837408
028374     END-IF.                                                      02837508
028376                                                                  02837608
028377*1030-EXIT.                                                       02837708
028378 EJECT.                                                           02837808
028379                                                                  02837908
028380*----------------------------------------------------------       02838008
028381* 1040-READ-FUTRE-CORR-DTE-CARD.                                  02838108
028382*     READ CONTROL CARD EPCC113. THIS CONTROL CARD CONTAINS       02838208
028383*     THE NEXT FUTURE CORRECTIONS DATE                            02838308
028384*----------------------------------------------------------       02838408
028385 1040-READ-FUTRE-CORR-DTE-CARD.                                   02838508
028386                                                                  02838608
JNSXXX     DISPLAY '1040-READ-FUTRE-CORR-DTE-CARD'.                     02838730
028387     READ CONTROL-CARD-FUTRE-CORR-DTE                             02838808
028388                               INTO EP113-CC-CONTROL-CARD         02838908
028389       AT END                                                     02839008
028390          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    02839108
028391                                                                  02839208
028392     IF PS-END-OF-CNTL-CRD-FILE                                   02839308
028393       DISPLAY ' '                                                02839408
028394       DISPLAY '** ABEND     **'                                  02839508
028395       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      02839608
028396       DISPLAY '** PARAGRAPH **  = 1040-READ-FUTRE-CORR-DTE-CARD' 02839708
028397       DISPLAY '** CONTROL FILE IS EMPTY  '                       02839808
028398       DISPLAY ' '                                                02839908
028399       MOVE +4002 TO ABEND-CODE                                   02840008
028400       CALL 'ILBOABN0' USING ABEND-CODE                           02840108
028401     ELSE                                                         02840208
028402       DISPLAY '** FUTURE CORRECTION DATE CONTROL CARD  **'       02840308
028403       DISPLAY '** EPCC113       **  = ' EP113-CC-CRNT-DTE        02840408
028404       DISPLAY ' '                                                02840508
028405     END-IF.                                                      02840608
028406                                                                  02840708
028407*1040-EXIT.                                                       02840808
028408 EJECT.                                                           02840908
028409                                                                  02841008
028410*----------------------------------------------------------       02841108
028411* 1050-READ-CRIT-EFF-DTE-CARD.                                    02841208
028412*     READ CONTROL CARD EPCC128  THIS CONTROL CARD CONTAINS       02841308
028413*     THE CRITICAL EFFECTIVE DATE, WHICH DETERMINES IF CHANGES    02841408
028414*     ARE EMERGENCY OR NIGHTLY.                                   02841508
028415*----------------------------------------------------------       02841608
028416 1050-READ-CRIT-EFF-DTE-CARD.                                     02841708
028417                                                                  02841808
028418     READ CONTROL-CARD-CRIT-EFF-DTE                               02841908
028419                               INTO EP128-CC-CONTROL-CARD         02842008
028420       AT END                                                     02842108
028421          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    02842208
028422                                                                  02842308
028423     IF PS-END-OF-CNTL-CRD-FILE                                   02842408
028424       DISPLAY ' '                                                02842508
028425       DISPLAY '** ABEND     **'                                  02842608
028426       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      02842708
028427       DISPLAY '** PARAGRAPH **  = 1050-READ-CRIT-EFF-DTE-CARD'   02842808
028428       DISPLAY '** CONTROL FILE IS EMPTY  '                       02842908
028429       DISPLAY ' '                                                02843008
028430       MOVE +4002 TO ABEND-CODE                                   02843108
028431       CALL 'ILBOABN0' USING ABEND-CODE                           02843208
028432     ELSE                                                         02843308
028433       DISPLAY '** CRITICAL EFFECTIVE DATE CONTROL CARD  **'      02843408
028434       DISPLAY '** EPCC128       **  = ' EP128-CC-CRITICAL-DTE    02843508
028435       DISPLAY ' '                                                02843608
028436     END-IF.                                                      02843708
028437                                                                  02843808
028438*1050-EXIT.                                                       02843908
028439 EJECT.                                                           02844008
028440                                                                  02844108
028441*----------------------------------------------------------       02844208
028442* 2000-PROCESS-TIERED-PRICING                                     02844308
028443*     MAIN PROCESSING AREA - EXECUTES RMS AND ADHOC QUERY         02844408
028444*     TO IDENTIFY TIERED PRICING CHANGES AND CREATES OUTPUT       02844508
028445*     FILES TO IDENTIFY WHICH STORE GROUP/PROMO INTERFACE I.D     02844608
028446*     COMBO'S NEED RECORDS CREATED FOR THE STORE SERVER.          02844708
028447*----------------------------------------------------------       02844808
028448 2000-PROCESS-TIERED-PRICING.                                     02844908
028449                                                                  02845008
JNSXXX     DISPLAY '2000-PROCESS-TIERED-PRICING'.                       02845130
JNSXXX     DISPLAY ' '.                                                 02845230
028449                                                                  02845430
028450     PERFORM 2100-PROCESS-RMS-CURSOR.                             02845530
028451                                                                  02845630
028452     PERFORM 2200-PROCESS-ADHOC-CURSOR.                           02845730
028453                                                                  02845830
028456*2000-EXIT.                                                       02845930
028457 EJECT.                                                           02846030
028458                                                                  02846130
028459*----------------------------------------------------------       02846230
028460* 2100-PROCESS-RMS-CURSOR.                                        02846330
028461*     READ THE RECORD FROM THE TIERED PRICING TABLE AND           02846430
028462*     CREATE PROMO AND PMAP RECORDS BASED ON THE RECORD READ.     02846530
028463*----------------------------------------------------------       02846630
028464 2100-PROCESS-RMS-CURSOR.                                         02846730
                                                                        02846830
JNSXXX     DISPLAY '2100-PROCESS-RMS-CURSOR'.                           02846930
JNSXXX     DISPLAY ' '.                                                 02847030
028465     PERFORM 2110-OPEN-TIER-PRICG-RMS.                            02847130
028466     PERFORM 2120-FETCH-TIER-PRICG-RMS                            02847230
028467       UNTIL PS-TIER-PRICG-CSR-EOF.                               02847330
028468     PERFORM 2130-CLOSE-TIER-PRICG-RMS.                           02847430
028469                                                                  02847530
028470*2100-EXIT.                                                       02847630
028471 EJECT.                                                           02847730
028472                                                                  02847830
028480*----------------------------------------------------------       02847930
028500* 2110-OPEN-TIER-PRICG-RMS.                                       02848030
028600*     OPEN THE SIMPLE PRICING CURSOR (RMS).                       02848130
028700*----------------------------------------------------------       02848230
028800 2110-OPEN-TIER-PRICG-RMS.                                        02848330
028900                                                                  02848430
JNSXXX     DISPLAY '2110-OPEN-TIER-PRICG-RMS'.                          02848530
JNSXXX     DISPLAY ' '.                                                 02848630
029000     PERFORM                                                      02848730
029100         WITH TEST AFTER                                          02848830
029200         VARYING PV-SQL-SUB                                       02848930
029300         FROM 1 BY 1                                              02849008
029400         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 02850008
029500                   OR  SQLCODE = 0)                               02860008
029600                                                                  02870008
029700         EXEC SQL                                                 02880008
029800           OPEN TIER-PRICG-RMS                                    02890021
029900         END-EXEC                                                 02900008
030000                                                                  02910008
030100         EVALUATE TRUE                                            02920008
030200           WHEN SQLCODE = -904                                    02930015
030300           WHEN SQLCODE = -911                                    02940015
030400           WHEN SQLCODE = -913                                    02950015
030500             CONTINUE                                             02960015
030600           WHEN SQLCODE = 0                                       02970015
030700             SET PS-TIER-PRICG-CSR-NOT-EOF TO TRUE                02980015
030800           WHEN SQLWARN0 NOT EQUAL SPACE                          02990015
030900           WHEN SQLCODE NOT EQUAL ZERO                            03000015
031000             MOVE '2110-OPEN-TIER-PRICG-RMS'                      03010015
031100                                     TO PV-PARAGRAPH-NAME         03020008
031200             MOVE 'ERROR ON OPEN OF TIER PRICG RMS CURSOR'        03030018
031300                                     TO PV-DB2-OPERATION          03040008
031400             PERFORM 9900-SQL-ABEND-ROUTINE                       03050015
031500         END-EVALUATE                                             03060008
031600     END-PERFORM.                                                 03070008
031700                                                                  03080008
031800     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         03090008
031900       MOVE '2110-OPEN-TIER-PRICG-RMS'                            03100015
032000                             TO  PV-PARAGRAPH-NAME                03110008
032100       MOVE 'OPEN RETRIES EXCEEDED'                               03120015
032200                              TO  PV-DB2-OPERATION                03130008
032300       PERFORM 9900-SQL-ABEND-ROUTINE                             03140015
032400     END-IF.                                                      03150008
032500                                                                  03160008
032600*2110-EXIT.                                                       03170008
032700 EJECT.                                                           03180008
032800                                                                  03190008
032900*----------------------------------------------------------       03200008
033000* 2120-FETCH-TIER-PRICG-RMS.                                      03210015
033100*     FETCH THE SIMPLE PRICING ID CURSOR. (RMS)                   03220008
033200*----------------------------------------------------------       03230008
033300 2120-FETCH-TIER-PRICG-RMS.                                       03240015
033400                                                                  03250008
JNSXXX     DISPLAY '2120-FETCH-TIER-PRICG-RMS'.                         03251030
JNSXXX     DISPLAY ' '.                                                 03252030
033500     PERFORM                                                      03260008
033600         WITH TEST AFTER                                          03270008
033700         VARYING PV-SQL-SUB                                       03280008
033800         FROM 1 BY 1                                              03290008
033900         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 03300008
034000                   OR  SQLCODE = 0                                03310008
034100                   OR  SQLCODE = +100)                            03320008
034200                                                                  03330008
034300         EXEC SQL                                                 03340021
034400           FETCH TIER-PRICG-RMS                                   03350021
034800           INTO  :XST00035-PROMO-INTFC-SUB-ID                     03351021
034410                ,:XST00035-STAT-CDE                               03360021
034500                ,:XST00035-LAST-UPD-TMST                          03370021
034700                ,:XST00035-SOR-LAST-UPD-TMST                      03380021
034800                ,:XST00029-PROMO-INTFC-ID                         03390021
034900                ,:XST00029-MDSE-LNE-ID                            03400021
035000                ,:XST00029-STR-GP-TYP-CDE                         03410021
035100                ,:XST00029-STR-GP-ID                              03420021
035200                ,:XST00029-STR-SELN-HIER-CDE                      03430021
035300                ,:XST00029-ACTL-STRT-TMST                         03440021
035400                ,:XST00029-ACTL-END-TMST                          03450021
035500                ,:XST00028-PRICG-TYP-CDE                          03460021
035600         END-EXEC                                                 03470021
035700                                                                  03480008
035800         EVALUATE TRUE                                            03490021
035900           WHEN SQLCODE = -904                                    03500021
036000           WHEN SQLCODE = -911                                    03510021
036100           WHEN SQLCODE = -913                                    03520021
036200             CONTINUE                                             03530021
036300           WHEN SQLCODE = ZERO                                    03540021
036400             PERFORM 3000-FORMAT-RMS-OUTPUT                       03550021
036500             ADD 1 TO PC-CNT-RMS-RECS                             03560021
036600           WHEN SQLCODE = +100                                    03570021
JNSXXX             DISPLAY 'SQL CODE 100 IN FETCHING TIER CURSOR'       03571032
036700             SET PS-TIER-PRICG-CSR-EOF TO TRUE                    03580021
036800           WHEN SQLWARN0 NOT EQUAL SPACE                          03590021
036900           WHEN SQLCODE NOT EQUAL ZERO                            03600021
037000             MOVE '2120-FETCH-TIER-PRICG-RMS'                     03610021
037100                                    TO PV-PARAGRAPH-NAME          03620021
037200             MOVE 'ERROR ON FETCHING TIER PRICG RMS CURSOR'       03630021
037300                                    TO PV-DB2-OPERATION           03640021
037400             PERFORM 9900-SQL-ABEND-ROUTINE                       03650021
037500         END-EVALUATE                                             03660021
037600     END-PERFORM.                                                 03670008
037700                                                                  03680008
037800     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         03690021
037900       MOVE '2120-FETCH-TIER-PRICG-RMS'                           03700015
038000                               TO  PV-PARAGRAPH-NAME              03710008
038100       MOVE 'FETCH RETRIES EXCEEDED'                              03720015
038200                               TO  PV-DB2-OPERATION               03730008
038300       PERFORM 9900-SQL-ABEND-ROUTINE                             03740015
038400     END-IF.                                                      03750008
038500                                                                  03760008
038600*2120-EXIT.                                                       03770008
038700 EJECT.                                                           03780008
038800                                                                  03790008
038900*-----------------------------------------------------------      03800008
039000* 2130-CLOSE-TIER-PRICG-RMS.                                      03810015
039100*                                                                 03820008
039200*-----------------------------------------------------------      03830008
039300 2130-CLOSE-TIER-PRICG-RMS.                                       03840015
039400                                                                  03850008
JNSXXX     DISPLAY '2130-CLOSE-TIER-PRICG-RMS'.                         03851030
JNSXXX     DISPLAY ' '.                                                 03852030
039500     PERFORM                                                      03860008
039600         WITH TEST AFTER                                          03870008
039700         VARYING PV-SQL-SUB                                       03880008
039800         FROM 1 BY 1                                              03890008
039900         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 03900008
040000                   OR  SQLCODE = 0)                               03910008
040100                                                                  03920008
040200         EXEC SQL                                                 03930021
040300           CLOSE TIER-PRICG-RMS                                   03940021
040400         END-EXEC                                                 03950021
040500                                                                  03960008
040600         EVALUATE TRUE                                            03970021
040700           WHEN SQLCODE = -904                                    03980021
040800           WHEN SQLCODE = -911                                    03990021
040900           WHEN SQLCODE = -913                                    04000021
041000           WHEN SQLCODE = 0                                       04010021
041100             CONTINUE                                             04020021
041200           WHEN SQLWARN0 NOT EQUAL SPACE                          04030021
041300           WHEN SQLCODE NOT EQUAL ZERO                            04040021
041400             MOVE '2130-CLOSE-TIER-PRICG-RMS'                     04050021
041500                                     TO PV-PARAGRAPH-NAME         04060021
041600             MOVE 'ERROR ON CLOSE OF TIER PRICG RMS CURSOR'       04070021
041700                                     TO PV-DB2-OPERATION          04080021
041800             PERFORM 9900-SQL-ABEND-ROUTINE                       04090021
041900         END-EVALUATE                                             04100021
042000     END-PERFORM.                                                 04110008
042100                                                                  04120008
042200     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         04130008
042300       MOVE '2130-CLOSE-TIER-PRICG-RMS'                           04140015
042400                               TO  PV-PARAGRAPH-NAME              04150008
042500       MOVE 'CLOSE RETRIES EXCEEDED'                              04160015
042600                               TO  PV-DB2-OPERATION               04170008
042700       PERFORM 9900-SQL-ABEND-ROUTINE                             04180015
042800     END-IF.                                                      04190008
042900                                                                  04200008
043000*2130-EXIT.                                                       04210008
043100 EJECT.                                                           04220008
043200                                                                  04230008
043300*----------------------------------------------------------       04240008
043400* 2200-PROCESS-ADHOC-CURSOR.                                      04250008
043500*     READ THE RECORD FROM THE SIMPLE PRICING TABLE AND           04260008
043600*     CREATE PROMO AND RECORDS BASED ON THE RECORD READ.          04270008
043700*----------------------------------------------------------       04280008
043800 2200-PROCESS-ADHOC-CURSOR.                                       04290008
                                                                        04291022
JNSXXX     DISPLAY '2200-PROCESS-ADHOC-CURSOR'.                         04292030
JNSXXX     DISPLAY ' '.                                                 04293030
043900     PERFORM 2210-OPEN-TIER-PRICG-ADHOC.                          04300008
044000     PERFORM 2220-FETCH-TIER-PRICG-ADHOC                          04310008
044100       UNTIL PS-TIER-PRICG-ADHOC-CSR-EOF.                         04320015
044200     PERFORM 2230-CLOSE-TIER-PRICG-ADHOC.                         04330008
044300                                                                  04340008
044400*2200-EXIT.                                                       04350008
044500 EJECT.                                                           04360008
044600                                                                  04370008
044700*----------------------------------------------------------       04380008
044800* 2210-OPEN-TIER-PRICG-ADHOC.                                     04390008
044900*     OPEN THE SIMPLE PRICING ADHOC CURSOR.                       04400008
045000*----------------------------------------------------------       04410008
045100 2210-OPEN-TIER-PRICG-ADHOC.                                      04420008
045200                                                                  04430008
JNSXXX     DISPLAY '2210-OPEN-TIER-PRICG-ADHOC'.                        04431030
JNSXXX     DISPLAY ' '.                                                 04432030
045300     PERFORM                                                      04440008
045400         WITH TEST AFTER                                          04450008
045500         VARYING PV-SQL-SUB                                       04460008
045600         FROM 1 BY 1                                              04470008
045700         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 04480008
045800                   OR  SQLCODE = 0)                               04490008
045900                                                                  04500008
046000         EXEC SQL                                                 04510021
046100           OPEN TIER-PRICG-ADHOC                                  04520021
046200         END-EXEC                                                 04530021
046300                                                                  04540008
046400         EVALUATE TRUE                                            04550008
046500           WHEN SQLCODE = -904                                    04560015
046600           WHEN SQLCODE = -911                                    04570015
046700           WHEN SQLCODE = -913                                    04580015
046800             CONTINUE                                             04590015
046900           WHEN SQLCODE = 0                                       04600015
047000             SET PS-TIER-PRICG-ADHC-CSR-NOT-EOF TO TRUE           04610015
047100           WHEN SQLWARN0 NOT EQUAL SPACE                          04620015
047200           WHEN SQLCODE NOT EQUAL ZERO                            04630015
047300             MOVE '2210-OPEN-TIER-PRICG-ADHOC'                    04640015
047400                                     TO PV-PARAGRAPH-NAME         04650008
047500             MOVE 'ERROR ON OPEN OF TIER PRICG ADHOC CURSOR'      04660018
047600                                     TO PV-DB2-OPERATION          04670008
047700             PERFORM 9900-SQL-ABEND-ROUTINE                       04680015
047800         END-EVALUATE                                             04690008
047900     END-PERFORM.                                                 04700008
048000                                                                  04710008
048100     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         04720017
048200       MOVE '2210-OPEN-TIER-PRICG-ADHOC'                          04730015
048300                             TO  PV-PARAGRAPH-NAME                04740008
048400       MOVE 'OPEN RETRIES EXCEEDED'                               04750015
048500                              TO  PV-DB2-OPERATION                04760008
048600       PERFORM 9900-SQL-ABEND-ROUTINE                             04770015
048700     END-IF.                                                      04780008
048800                                                                  04790008
048900*2210-EXIT.                                                       04800008
049000 EJECT.                                                           04810008
049100                                                                  04820008
049200*----------------------------------------------------------       04830008
049300* 2220-FETCH-TIER-PRICG-ADHOC.                                    04840008
049400*     FETCH THE SIMPLE PRICING ADHOC CURSOR.                      04850008
049500*----------------------------------------------------------       04860008
049600 2220-FETCH-TIER-PRICG-ADHOC.                                     04870008
049700                                                                  04880008
JNSXXX     DISPLAY '2220-FETCH-TIER-PRICG-ADHOC'.                       04881030
JNSXXX     DISPLAY ' '.                                                 04882030
049800     PERFORM                                                      04890008
049900         WITH TEST AFTER                                          04900008
050000         VARYING PV-SQL-SUB                                       04910008
050100         FROM 1 BY 1                                              04920008
050200         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 04930008
050300                   OR  SQLCODE = 0                                04940008
050400                   OR  SQLCODE = +100)                            04950008
050500                                                                  04960008
050600         EXEC SQL                                                 04970021
050700           FETCH TIER-PRICG-ADHOC                                 04980021
051100           INTO  :XST00035-PROMO-INTFC-SUB-ID                     04981021
050710                ,:XST00035-STAT-CDE                               04990021
050800                ,:XST00035-LAST-UPD-TMST                          05000021
051000                ,:XST00035-SOR-LAST-UPD-TMST                      05010021
051100                ,:XST00031-PROMO-INTFC-ID                         05020021
051110                ,:XST00031-MDSE-LNE-ID                            05030021
051120                ,:XST00031-ADHC-STR-GP-ID                         05040021
051130                ,:XST00031-STR-SELN-HIER-CDE                      05050021
051140                ,:XST00031-ACTL-STRT-TMST                         05060021
051150                ,:XST00031-ACTL-END-TMST                          05070021
051160                ,:XST00028-PRICG-TYP-CDE                          05080021
051170         END-EXEC                                                 05090021
051180                                                                  05100008
051190         EVALUATE TRUE                                            05110021
051200           WHEN SQLCODE = -904                                    05120021
051300           WHEN SQLCODE = -911                                    05130021
051400           WHEN SQLCODE = -913                                    05140021
051500             CONTINUE                                             05150021
051600           WHEN SQLCODE = ZERO                                    05160021
051700             PERFORM 3100-FORMAT-ADHOC-OUTPUT                     05170021
051800             ADD 1 TO PC-CNT-ADHOC-RECS                           05180021
051810           WHEN SQLCODE = +100                                    05181021
051820             SET PS-TIER-PRICG-ADHOC-CSR-EOF TO TRUE              05182021
051830           WHEN SQLWARN0 NOT EQUAL SPACE                          05183021
051840           WHEN SQLCODE NOT EQUAL ZERO                            05184021
051850             MOVE '2220-FETCH-TIER-PRICG-ADHOC'                   05185021
051860                                    TO PV-PARAGRAPH-NAME          05186021
051870             MOVE 'ERROR ON FETCHING TIER PRICG ADHOC CURSOR'     05187021
051880                                    TO PV-DB2-OPERATION           05188021
051881             DISPLAY 'SQLCODE= ' SQLCODE                          05188121
051882             PERFORM 9900-SQL-ABEND-ROUTINE                       05188221
051883         END-EVALUATE                                             05188321
051884     END-PERFORM.                                                 05188408
051885                                                                  05188508
051886     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         05188621
051887       MOVE '2220-FETCH-TIER-PRICG-ADHOC'                         05188715
051888                               TO  PV-PARAGRAPH-NAME              05188808
051889       MOVE 'FETCH RETRIES EXCEEDED'                              05188915
051890                               TO  PV-DB2-OPERATION               05189008
051891       PERFORM 9900-SQL-ABEND-ROUTINE                             05189115
051892     END-IF.                                                      05189208
051893                                                                  05189308
051894*2220-EXIT.                                                       05189408
051895 EJECT.                                                           05189508
051896                                                                  05189608
051897*-----------------------------------------------------------      05189708
051898* 2230-CLOSE-TIER-PRICG-ADHOC.                                    05189808
051899*     CLOSE THE SIMPLE PRICING ADHOC CURSOR.                      05189908
051900*-----------------------------------------------------------      05190008
051901 2230-CLOSE-TIER-PRICG-ADHOC.                                     05190108
051902                                                                  05190208
051903     PERFORM                                                      05190308
051904         WITH TEST AFTER                                          05190408
051905         VARYING PV-SQL-SUB                                       05190508
051906         FROM 1 BY 1                                              05190608
051907         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 05190708
051908                   OR  SQLCODE = 0)                               05190808
051909                                                                  05190908
051910         EXEC SQL                                                 05191021
051911           CLOSE TIER-PRICG-ADHOC                                 05191121
051912         END-EXEC                                                 05191221
051913                                                                  05191308
051914         EVALUATE TRUE                                            05191421
051915           WHEN SQLCODE = -904                                    05191521
051916           WHEN SQLCODE = -911                                    05191621
051917           WHEN SQLCODE = -913                                    05191721
051918           WHEN SQLCODE = 0                                       05191821
051919             CONTINUE                                             05191921
051920           WHEN SQLWARN0 NOT EQUAL SPACE                          05192021
051921           WHEN SQLCODE NOT EQUAL ZERO                            05192121
051922             MOVE '2230-CLOSE-TIER-PRICG-ADHOC'                   05192221
051923                                     TO PV-PARAGRAPH-NAME         05192321
051924             MOVE 'ERROR ON CLOSE OF TIER PRICG ADHOC CURSOR'     05192421
051925                                     TO PV-DB2-OPERATION          05192521
051926             PERFORM 9900-SQL-ABEND-ROUTINE                       05192621
051927         END-EVALUATE                                             05192721
051928     END-PERFORM.                                                 05192808
051929                                                                  05192908
051930     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         05193008
051931       MOVE '2230-CLOSE-TIER-PRICG-ADHOC'                         05193115
051932                               TO  PV-PARAGRAPH-NAME              05193208
051933       MOVE 'CLOSE RETRIES EXCEEDED'                              05193315
051934                               TO  PV-DB2-OPERATION               05193408
051935       PERFORM 9900-SQL-ABEND-ROUTINE                             05193515
051936     END-IF.                                                      05193608
051937                                                                  05193708
051938*2230-EXIT.                                                       05193808
051939 EJECT.                                                           05193908
051940                                                                  05194008
052106*-----------------------------------------------------------      05210408
052107* 3000-FORMAT-RMS-OUTPUT.                                         05210508
052108*     POPULATE COPYBOOK EPRD072.                                  05210608
052109*-----------------------------------------------------------      05210708
052110 3000-FORMAT-RMS-OUTPUT.                                          05210808
052111                                                                  05210908
JNSXXX     DISPLAY '3000-FORMAT-RMS-OUTPUT'.                            05211030
JNSXXX     DISPLAY ' '.                                                 05211130
052112     INITIALIZE EP072-PROMO-INTFC-RECORD.                         05211208
052113     MOVE PC-PRICING-BUS-EVENT                                    05211308
052114                             TO EP072-BUSINESS-EVENT-ID.          05211408
052115     MOVE PC-RMS-PRC-SETUP-IND                                    05211508
052116                             TO EP072-PRC-SETUP-IND.              05211608
052117     MOVE XST00029-STR-GP-TYP-CDE                                 05211708
052118                             TO EP072-SETUP-STR-GRP-TYP-CDE.      05211808
052119     MOVE XST00029-STR-GP-ID                                      05211908
052120                             TO EP072-SETUP-STR-GRP-ID.           05212008
052121     MOVE XST00029-STR-SELN-HIER-CDE                              05212108
052122                             TO EP072-STR-SELN-HIER-CDE.          05212208
052123     MOVE XST00029-STR-GP-TYP-CDE                                 05212308
052124                             TO EP072-DIST-STR-GRP-TYP-CDE.       05212408
052125     MOVE XST00029-STR-GP-ID                                      05212508
052126                             TO EP072-DIST-STR-GRP-ID.            05212608
052127     MOVE PC-FILE-ACT-TYPE   TO EP072-FILE-ACT-TYP.               05212708
                                                                        05212819
052129     MOVE XST00029-ACTL-STRT-TMST                                 05212908
052130                             TO PV-ACTL-STRT-TMST.                05213008
052131                                                                  05213108
052132     IF PV-ACTL-STRT-TMST-DATE > EP128-CC-CRITICAL-DTE            05213208
052133       AND PV-ACTL-STRT-TMST-DATE < EP113-CC-CRNT-DTE             05213315
052134         MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND               05213415
JNSXXX          DISPLAY 'IF 1'                                          05213530
JNSXXX          DISPLAY ' '                                             05213630
052135     ELSE                                                         05213708
052136       IF PV-ACTL-STRT-TMST-DATE <= EP128-CC-CRITICAL-DTE         05213808
052137         MOVE PC-APPLY-CORRECTION                                 05213915
052138                                  TO EP072-APPLY-IND              05214008
JNSXXX          DISPLAY 'IF 2'                                          05214130
JNSXXX          DISPLAY ' '                                             05214230
052139       END-IF                                                     05214308
052140     END-IF.                                                      05214408
052141                                                                  05215008
052152     MOVE XST00029-PROMO-INTFC-ID                                 05215615
052153                             TO EP072-PROMO-INTFC-ID.             05215715
052154     MOVE XST00029-MDSE-LNE-ID                                    05215815
052155                             TO EP072-MERCH-LNE-ID.               05215915
052156     MOVE XST00028-PRICG-TYP-CDE                                  05216015
052157                             TO EP072-PRICG-TYP-CDE.              05216115
052158     MOVE PC-MDSE-INCL-IND                                        05216215
052159                             TO EP072-MDSE-INC-EXC-IND.           05216315
052160     MOVE XST00029-ACTL-STRT-TMST                                 05216415
052161                             TO EP072-STR-GRP-PROMO-STRT-TMST.    05216515
052162     MOVE XST00029-ACTL-END-TMST                                  05216615
052163                             TO EP072-STR-GRP-PROMO-END-TMST.     05216715
052164     MOVE XST00035-SOR-LAST-UPD-TMST                              05216815
052165                             TO EP072-SOR-LAST-UPD-TMST.          05216915
052166                                                                  05217015
052142     MOVE XST00035-STAT-CDE  TO PC-TIER-PRICG-STAT-CDE.           05218519
                                                                        05218618
052167     IF EP072-APPLY-NIGHTLY                                       05218815
052148       IF PC-SCHEDULED-STATUS                                     05218918
052146         MOVE PC-ADD-STAT-CDE          TO EP072-RECORD-ACTION     05219118
052168         PERFORM 4000-WRITE-NIGHT-APPLY-RECORD                    05219218
             ELSE                                                       05219318
052148         IF PC-DELETE-STATUS OR PC-CANCEL-STATUS                  05219418
052146           MOVE PC-ADD-STAT-CDE        TO EP072-RECORD-ACTION     05219518
052168           PERFORM 4000-WRITE-NIGHT-APPLY-RECORD                  05219618
052149           MOVE PC-DELETE-STAT-CDE     TO EP072-RECORD-ACTION     05219718
052152           MOVE XST00035-PROMO-INTFC-SUB-ID                       05219818
052153                                       TO EP072-PROMO-INTFC-SUB-ID05219918
052168           PERFORM 4000-WRITE-NIGHT-APPLY-RECORD                  05220018
               END-IF                                                   05220118
             END-IF                                                     05220218
052169     END-IF.                                                      05220326
                                                                        05220426
           IF EP072-APPLY-CORRECTION                                    05220526
052148       IF PC-SCHEDULED-STATUS                                     05220618
052146         MOVE PC-ADD-STAT-CDE          TO EP072-RECORD-ACTION     05220718
052171         PERFORM 4100-WRITE-EMERG-APPLY-RECORD                    05220823
052134         MOVE PC-APPLY-NIGHTLY         TO EP072-APPLY-IND         05220923
052168         PERFORM 4000-WRITE-NIGHT-APPLY-RECORD                    05221018
             ELSE                                                       05221118
052148         IF PC-DELETE-STATUS OR PC-CANCEL-STATUS                  05221218
052146           MOVE PC-ADD-STAT-CDE        TO EP072-RECORD-ACTION     05221318
052171           PERFORM 4100-WRITE-EMERG-APPLY-RECORD                  05221423
052134           MOVE PC-APPLY-NIGHTLY       TO EP072-APPLY-IND         05221523
052168           PERFORM 4000-WRITE-NIGHT-APPLY-RECORD                  05221618
052149           MOVE PC-DELETE-STAT-CDE     TO EP072-RECORD-ACTION     05221718
052152           MOVE XST00035-PROMO-INTFC-SUB-ID                       05221818
052153                                       TO EP072-PROMO-INTFC-SUB-ID05221918
052138           MOVE PC-APPLY-CORRECTION    TO EP072-APPLY-IND         05222024
052171           PERFORM 4100-WRITE-EMERG-APPLY-RECORD                  05222123
052134           MOVE PC-APPLY-NIGHTLY       TO EP072-APPLY-IND         05222223
052168           PERFORM 4000-WRITE-NIGHT-APPLY-RECORD                  05222318
               END-IF                                                   05222418
             END-IF                                                     05222518
052172     END-IF.                                                      05222618
052173                                                                  05222718
052174*3000-EXIT.                                                       05222818
052175 EJECT.                                                           05222918
052176*-----------------------------------------------------------      05223018
052177* 3100-FORMAT-ADHOC-OUTPUT.                                       05223118
052178*     POPULATE COPYBOOK EPRD072.                                  05223218
052179*-----------------------------------------------------------      05223318
052180 3100-FORMAT-ADHOC-OUTPUT.                                        05223418
052181                                                                  05223518
052182     INITIALIZE EP072-PROMO-INTFC-RECORD.                         05223618
052183     MOVE PC-PRICING-BUS-EVENT                                    05223718
052184                             TO EP072-BUSINESS-EVENT-ID.          05223818
052185     MOVE PC-ADHOC-PRC-SETUP-IND                                  05223918
052186                             TO EP072-PRC-SETUP-IND.              05224018
052187     MOVE PC-ADHOC-STR-GRP-TYP-CDE                                05224118
052188                             TO EP072-SETUP-STR-GRP-TYP-CDE.      05224218
052190     MOVE XST00031-ADHC-STR-GP-ID                                 05224318
052200                             TO EP072-SETUP-STR-GRP-ID.           05224418
052210     MOVE XST00031-STR-SELN-HIER-CDE                              05224518
052220                             TO EP072-STR-SELN-HIER-CDE.          05224618
052230     MOVE PC-ADHOC-STR-GRP-TYP-CDE                                05224718
052240                             TO EP072-DIST-STR-GRP-TYP-CDE.       05224818
052250     MOVE XST00031-ADHC-STR-GP-ID                                 05224918
052260                             TO EP072-DIST-STR-GRP-ID.            05225008
052270     MOVE PC-FILE-ACT-TYPE   TO EP072-FILE-ACT-TYP.               05225108
052280                                                                  05225208
052281     MOVE XST00031-ACTL-STRT-TMST                                 05226008
052282                             TO PV-ACTL-STRT-TMST.                05227008
052283                                                                  05228008
052284     IF PV-ACTL-STRT-TMST-DATE > EP128-CC-CRITICAL-DTE            05228108
052285       AND PV-ACTL-STRT-TMST-DATE < EP113-CC-CRNT-DTE             05228215
052286         MOVE PC-APPLY-NIGHTLY   TO EP072-APPLY-IND               05228315
052287     ELSE                                                         05228408
052288       IF PV-ACTL-STRT-TMST-DATE <= EP128-CC-CRITICAL-DTE         05228508
052289         MOVE PC-APPLY-CORRECTION                                 05228615
052290                                  TO EP072-APPLY-IND              05228708
052291       END-IF                                                     05228808
052292     END-IF.                                                      05228908
052312                                                                  05231108
052313     MOVE XST00031-PROMO-INTFC-ID                                 05231208
052314                             TO EP072-PROMO-INTFC-ID.             05231308
052315     MOVE XST00031-MDSE-LNE-ID                                    05231408
052316                             TO EP072-MERCH-LNE-ID.               05231508
052317     MOVE XST00028-PRICG-TYP-CDE                                  05231608
052318                             TO EP072-PRICG-TYP-CDE.              05231708
052319     MOVE PC-MDSE-INCL-IND                                        05231808
052320                             TO EP072-MDSE-INC-EXC-IND.           05231908
052321     MOVE XST00031-ACTL-STRT-TMST                                 05232008
052322                             TO EP072-STR-GRP-PROMO-STRT-TMST.    05232108
052323     MOVE XST00031-ACTL-END-TMST                                  05232208
052324                             TO EP072-STR-GRP-PROMO-END-TMST.     05232308
052325     MOVE XST00035-SOR-LAST-UPD-TMST                              05232408
052326                             TO EP072-SOR-LAST-UPD-TMST.          05232508
052302                                                                  05232719
052142     MOVE XST00035-STAT-CDE  TO PC-TIER-PRICG-STAT-CDE.           05234619
                                                                        05234719
052167     IF EP072-APPLY-NIGHTLY                                       05234819
052148       IF PC-SCHEDULED-STATUS                                     05234919
052146         MOVE PC-ADD-STAT-CDE          TO EP072-RECORD-ACTION     05235019
052168         PERFORM 4000-WRITE-NIGHT-APPLY-RECORD                    05235119
             ELSE                                                       05235219
052148         IF PC-DELETE-STATUS OR PC-CANCEL-STATUS                  05235319
052146           MOVE PC-ADD-STAT-CDE        TO EP072-RECORD-ACTION     05235419
052168           PERFORM 4000-WRITE-NIGHT-APPLY-RECORD                  05235519
052149           MOVE PC-DELETE-STAT-CDE     TO EP072-RECORD-ACTION     05235619
052152           MOVE XST00035-PROMO-INTFC-SUB-ID                       05235719
052153                                       TO EP072-PROMO-INTFC-SUB-ID05235819
052168           PERFORM 4000-WRITE-NIGHT-APPLY-RECORD                  05235919
               END-IF                                                   05236019
             END-IF                                                     05236119
052169     END-IF.                                                      05236227
                                                                        05236327
           IF EP072-APPLY-CORRECTION                                    05236427
052148       IF PC-SCHEDULED-STATUS                                     05236519
052146         MOVE PC-ADD-STAT-CDE          TO EP072-RECORD-ACTION     05236619
052171         PERFORM 4100-WRITE-EMERG-APPLY-RECORD                    05236723
052134         MOVE PC-APPLY-NIGHTLY         TO EP072-APPLY-IND         05236823
052168         PERFORM 4000-WRITE-NIGHT-APPLY-RECORD                    05236923
             ELSE                                                       05237019
052148         IF PC-DELETE-STATUS OR PC-CANCEL-STATUS                  05237119
052146           MOVE PC-ADD-STAT-CDE        TO EP072-RECORD-ACTION     05237219
052171           PERFORM 4100-WRITE-EMERG-APPLY-RECORD                  05237419
052134           MOVE PC-APPLY-NIGHTLY       TO EP072-APPLY-IND         05237523
052168           PERFORM 4000-WRITE-NIGHT-APPLY-RECORD                  05237623
052149           MOVE PC-DELETE-STAT-CDE     TO EP072-RECORD-ACTION     05237719
052152           MOVE XST00035-PROMO-INTFC-SUB-ID                       05237819
052153                                       TO EP072-PROMO-INTFC-SUB-ID05237919
052138           MOVE PC-APPLY-CORRECTION    TO EP072-APPLY-IND         05238025
052171           PERFORM 4100-WRITE-EMERG-APPLY-RECORD                  05238123
052134           MOVE PC-APPLY-NIGHTLY       TO EP072-APPLY-IND         05238223
052168           PERFORM 4000-WRITE-NIGHT-APPLY-RECORD                  05238319
               END-IF                                                   05238419
             END-IF                                                     05238519
052172     END-IF.                                                      05238619
052340                                                                  05238708
052350*3100-EXIT.                                                       05238808
052360 EJECT.                                                           05238908
052370                                                                  05239008
052453*----------------------------------------------------------       05245108
052454* 4000-WRITE-NIGHT-APPLY-RECORD.                                  05245208
052460*     WRITES THE PROMO FULL FILE RECORD TO THE FULL FILE          05245308
052500*----------------------------------------------------------       05245408
052600 4000-WRITE-NIGHT-APPLY-RECORD.                                   05245508
052700                                                                  05245608
JNSXXX     DISPLAY '4000-WRITE-NIGHT-APPLY-RECORD'.                     05245730
JNSXXX     DISPLAY ' '.                                                 05245830
052710     WRITE PROMO-NIGHT-RECORD FROM EP072-PROMO-INTFC-RECORD.      05245908
052720                                                                  05246008
052730     ADD 1           TO PC-CNT-NIGHT-RECS                         05246108
052740                        PC-CNT-ALL-RECS.                          05246208
052760                                                                  05247008
052770*4000-EXIT.                                                       05248008
052780 EJECT.                                                           05249008
052790                                                                  05250008
052800*----------------------------------------------------------       05260008
052801* 4100-WRITE-EMERG-APPLY-RECORD.                                  05270008
052802*     WRITES THE PROMO FULL FILE RECORD TO THE FULL FILE          05280008
052803*----------------------------------------------------------       05280108
052804 4100-WRITE-EMERG-APPLY-RECORD.                                   05280208
052805                                                                  05280308
JNSXXX     DISPLAY '4100-WRITE-EMERG-APPLY-RECORD'.                     05280430
JNSXXX     DISPLAY ' '.                                                 05280530
052806     WRITE PROMO-EMERGENCY-RECORD FROM EP072-PROMO-INTFC-RECORD.  05280608
052807                                                                  05280708
052808     ADD 1           TO PC-CNT-EMERG-RECS                         05280808
052809                        PC-CNT-ALL-RECS.                          05280908
052820*                                                                 05281008
052830*4100-EXIT.                                                       05281108
052840 EJECT.                                                           05281208
052850                                                                  05282008
052860*----------------------------------------------------------       05283015
052870* DATE ROUTINE TO SET UP THE PROCESS DATE IN                      05284015
052880* CCYYMMDD FORMAT.                                                05285015
052890*----------------------------------------------------------       05286015
052900 6100-DATE-ROUTINE.                                               05287008
053000                                                                  05288008
053100     INITIALIZE DPG51 DPG52 DPG53                                 05289008
053200                DPG54 DPG55 DPG56.                                05290008
053210                                                                  05300008
053220     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      05310008
053230     SET DPG51-INCREMENT-DATE       TO TRUE.                      05320008
053240     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      05321008
053241     MOVE 1                         TO DPG51-INCR-DECR-DAYS-9.    05322008
053242     MOVE EP111-CC-CRNT-DTE         TO DPG52-DB2-ISO-DATE-FMT.    05323008
053243                                                                  05324008
053244     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    05324108
053245                                             DPG54 DPG55 DPG56.   05324208
053246                                                                  05324308
053247     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  05324408
053248       DISPLAY '** ABEND **'                                      05324515
053249       DISPLAY '** PROGRAM = EPKUT122'                            05324615
053250       DISPLAY 'DATE = ' EP111-CC-CRNT-DTE                        05324715
053251       DISPLAY DPG54-ERROR-MESSAGE                                05324815
053252       MOVE 4019 TO PV-ABEND-CODE                                 05324915
053253       CALL 'ILBOABN0' USING PV-ABEND-CODE                        05325015
           END-IF.                                                      05325115
053254                                                                  05325208
053255     MOVE DPG55-DB2-ISO-DATE-FMT     TO EP111-CC-DATE-PLUS1.      05325308
053256                                                                  05325408
053257     INITIALIZE DPG51 DPG52 DPG53                                 05325508
053258                DPG54 DPG55 DPG56.                                05325608
053259                                                                  05325708
053260     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      05325808
053261     SET DPG51-DECREMENT-DATE       TO TRUE.                      05325908
053262     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      05326008
053263     MOVE 1                         TO DPG51-INCR-DECR-DAYS-9.    05326108
053264     MOVE EP113-CC-CRNT-DTE         TO DPG52-DB2-ISO-DATE-FMT.    05326208
053265                                                                  05326308
053266     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    05326408
053267                                             DPG54 DPG55 DPG56.   05326508
053268                                                                  05326608
053269     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  05326708
053270       DISPLAY '** ABEND **'                                      05326815
053271       DISPLAY '** PROGRAM = EPKUT122'                            05326915
053272       DISPLAY 'DATE = ' EP111-CC-CRNT-DTE                        05327015
053273       DISPLAY DPG54-ERROR-MESSAGE                                05327115
053274       MOVE 4019 TO PV-ABEND-CODE                                 05327215
053275       CALL 'ILBOABN0' USING PV-ABEND-CODE                        05327315
           END-IF.                                                      05327415
053276                                                                  05327508
053277     MOVE DPG55-DB2-ISO-DATE-FMT    TO EP113-CC-CRNT-DTE-MINUS1.  05327608
053278                                                                  05327708
053279*6100-EXIT.                                                       05327808
053280 EJECT.                                                           05327908
053281                                                                  05328008
055100*----------------------------------------------------------       05480008
055200* 9900-SQL-ABEND-ROUTINE.                                         05490008
055300*     SQL ABEND ROUTINE.                                          05500008
055400*----------------------------------------------------------       05510008
055500 9900-SQL-ABEND-ROUTINE.                                          05520008
055600                                                                  05530008
055700     DISPLAY '** ABEND     **'.                                   05540008
055800     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        05550008
055900     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              05560008
056000     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               05570008
056100                                                                  05580008
056200     COPY DPPD004.                                                05590008
056300     SET ABEND-4013-DB2-ERROR TO TRUE.                            05600008
056400     CALL 'ILBOABN0' USING ABEND-CODE.                            05610008
056500                                                                  05620008
056600*9900-EXIT.                                                       05630008
056700 EJECT.                                                           05640008
056800                                                                  05650008
056900*----------------------------------------------------------       05660008
057000* 9999-WRAPUP.                                                    05670008
057100*     END OF PROGRAM ROUTINE.  CLOSES ALL FILES AND DISPLAYS      05680008
057200*     ANY DATA FROM THE PROGRAM.                                  05690008
057300*----------------------------------------------------------       05700008
057400 9999-WRAPUP.                                                     05710008
057500                                                                  05720008
058010     CLOSE CONTROL-CARD-PGM-LAST-RUN-DTE.                         05730008
058020     OPEN OUTPUT CONTROL-CARD-PGM-LAST-RUN-DTE.                   05740008
058030                                                                  05750008
058031     MOVE PV-CURRENT-SYSTEM-TMST TO EP115-CC-TIER-CUTOFF-TMST     05760012
058032     WRITE CNTRL-CARD-PGM-LAST-RUN-REC                            05770008
058034                                   FROM EP115-CC-CONTROL-CARD.    05780008
058070                                                                  05790008
058080     CLOSE CONTROL-CARD-CURR-PRICG-DTE                            05800008
058090           CONTROL-CARD-FUTRE-CORR-DTE                            05801008
058091           CONTROL-CARD-PGM-LAST-RUN-DTE                          05802008
058092           CONTROL-CARD-CRIT-EFF-DTE                              05803008
058093           PROMO-NIGHT-FILE                                       05804008
058094           PROMO-EMERGENCY-FILE.                                  05805008
058095                                                                  05806008
058100     DISPLAY ' '.                                                 05807008
058200     DISPLAY '*********************************************'.     05808008
058300     DISPLAY 'PROGRAM NAME: ' PC-CURRENT-PROGRAM-NAME.            05809008
058400     DISPLAY '*********************************************'.     05810008
058700     DISPLAY 'NUMBER OF NIGHT RECS WRITTEN:   ' PC-CNT-NIGHT-RECS.05820009
058800     DISPLAY 'NUMBER OF EMERG. RECS WRITTEN:  ' PC-CNT-EMERG-RECS.05830009
058700     DISPLAY 'NUMBER OF ADD RECS WRITTEN:     ' PC-CNT-ADD-RECS.  05831009
058800     DISPLAY 'NUMBER OF DELETE RECS WRITTEN:  ' PC-CNT-DELTE-RECS.05832009
058900     DISPLAY 'NUMBER OF RECS FROM RMS QUERY:  ' PC-CNT-RMS-RECS.  05840009
059000     DISPLAY 'NUMBER OF RECS FROM ADHC QUERY: ' PC-CNT-ADHOC-RECS.05850008
059100*    DISPLAY 'NUMBER OF RECS FROM DEVT QUERY: ' PC-CNT-DEVT-RECS. 05860008
059200     DISPLAY 'ALL RECS WRITTEN: ' PC-CNT-ALL-RECS.                05870008
059300     DISPLAY '*********************************************'.     05880008
059400                                                                  05890008
059500*9999-EXIT.                                                       05900008
059600 EJECT.                                                           05910008
059700                                                                  05920008
