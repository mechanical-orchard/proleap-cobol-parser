000100*************************                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*************************                                         00030000
000400 PROGRAM-ID.      TRKUP015.                                       00040000
000500 AUTHOR.          VISWA KARUTURI.                                 00050000
000600 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00060000
000700 DATE-WRITTEN.    01/23/2003.                                     00070000
000800 DATE-COMPILED.                                                   00080000
000900****************************************************************  00090000
001000*            DECONSOLIDATOR SPLIT PREP PROGRAM                 *  00100000
001100*                                                              *  00110000
001200* IT READS THE FILE THAT CONTAINS IMPORT DC SPLIT INFORMATION  *  00120000
001300* TO THE DECONSOLIDATOR AND WRITES ALL RECORDS TO OUTPUT FILE  *  00130000
001400* BY ADDING CONTROL RECORDS(ISA) WITH DECONSOLIDATOR ENT-ID.   *  00140000
001500* THEN THE OUTPUT FILE WILL SPILT INTO SPERATE FILES BY        *  00150000
001600* DECONSOLIDATOR ENT-ID ON CONTROL RECORD IN PROGRAM TRKUT020. *  00160000
001700*                                                              *  00170000
001800* THERE ARE TWO TYPES OF DC SPLITS FOR THE DECONSOLIDATOR      *  00180000
001900* CON - PO SPLIT, CMN - CONTAINER SPLIT. IF THE RECORD GROUP   *  00190000
002000* IS CON, HOLD CON RECORD AND USE PO NUMBER FROM PO RECORD TO  *  00200000
002100* FIND FOB ON TPLNSHP. IF THE RECORD GROUP IS CMN, USE         *  00210000
002200* CONTAINER ID TO FIND FOB(MOM_FOB_CDE) FROM TIMCNTK.          *  00220000
002300* THEN USE FOB TO FIND DECONSOLIDATOR ENT-ID FROM TIMFOB.      *  00230000
002400*                                                              *  00240000
002500* NOTE: IF THE DECONSOLIDATOR ENT-ID IS NOT FOUND THE RECORDS  *  00250000
002600* DEFAULT TO GALE (ENT_ID: 4831).                              *  00260000
002700*                                                              *  00240000
002800* LOGIC WAS ADDED TO SAVE THE FIRST ADJUSTED DCON SCAC ENT_ID  *          
002900* TO BE USED TO UPDATE THE TIMPORL. AS WITH ALL ADJUSTMENTS A  *          
003000* CONTAINER ADJUSTMENT TAKES PRECEDENT OVER VESSEL ADJUSMTENTS.*          
003100****************************************************************  00270000
003200 ENVIRONMENT DIVISION.                                            00280000
003300 CONFIGURATION SECTION.                                           00290000
003400 SOURCE-COMPUTER. IBM-3090.                                       00300000
003500 OBJECT-COMPUTER. IBM-3090.                                       00310000
003600 INPUT-OUTPUT SECTION.                                            00320000
003700                                                                  00330000
003800 FILE-CONTROL.                                                    00340000
003900     SELECT INPUT-FILE                                            00350000
004000         ASSIGN                       TO INP01.                   00360000
004100     SELECT INPUT-ENT-FILE                                        00370000
004200         ASSIGN                       TO INP02.                   00380000
004300     SELECT OUTPUT-FILE1                                          00390000
004400         ASSIGN                       TO OUT01.                   00400000
004500     SELECT OUTPUT-FILE2                                          00410000
004600         ASSIGN                       TO OUT02.                   00420000
004700     SELECT OUTPUT-FILE3                                          00430000
004800         ASSIGN                       TO OUT03.                   00440000
004900     SELECT OUTPUT-FILE4                                          00450000
005000         ASSIGN                       TO OUT04.                   00460000
005100     SELECT OUTPUT-FILE5                                          00470000
005200         ASSIGN                       TO OUT05.                   00480000
005300     SELECT EXCEPTION-FILE                                        00370000
005400         ASSIGN                       TO OUT06.                   00380000
005500*                                                                 00490000
005600***************                                                   00500000
005700 DATA DIVISION.                                                   00510000
005800***************                                                   00520000
005900*                                                                 00530000
006000 FILE SECTION.                                                    00540000
006100                                                                  00550000
006200 FD  INPUT-FILE                                                   00560000
006300     RECORDING MODE IS F                                          00570000
006400     LABEL RECORDS ARE STANDARD                                   00580000
006500     RECORD CONTAINS 254 CHARACTERS                               00590000
006600     BLOCK CONTAINS 0 RECORDS.                                    00600000
006700 01  INPUT-RECORD                     PIC  X(254).                00610000
006800                                                                  00620000
006900 FD  INPUT-ENT-FILE                                               00630000
007000     RECORDING MODE IS F                                          00640000
007100     LABEL RECORDS ARE STANDARD                                   00650000
007200     RECORD CONTAINS 80 CHARACTERS                                00660000
007300     BLOCK CONTAINS 0 RECORDS.                                    00670000
007400 01  INPUT-ENT-RECORD                 PIC  X(80).                 00680000
007500                                                                  00690000
007600 FD  OUTPUT-FILE1                                                 00700000
007700     RECORDING MODE F                                             00710000
007800     BLOCK CONTAINS 0 RECORDS                                     00720000
007900     RECORD CONTAINS 254 CHARACTERS                               00730000
008000     LABEL RECORDS ARE STANDARD                                   00740000
008100     DATA RECORD IS OUTPUT-RECORD.                                00750000
008200 01  OUTPUT-RECORD1                   PIC X(254).                 00760000
008300                                                                  00770000
008400                                                                  00780000
008500 FD  OUTPUT-FILE2                                                 00790000
008600     RECORDING MODE F                                             00800000
008700     BLOCK CONTAINS 0 RECORDS                                     00810000
008800     RECORD CONTAINS 254 CHARACTERS                               00820000
008900     LABEL RECORDS ARE STANDARD                                   00830000
009000     DATA RECORD IS OUTPUT-RECORD.                                00840000
009100 01  OUTPUT-RECORD2                   PIC X(254).                 00850000
009200                                                                  00860000
009300                                                                  00870000
009400 FD  OUTPUT-FILE3                                                 00880000
009500     RECORDING MODE F                                             00890000
009600     BLOCK CONTAINS 0 RECORDS                                     00900000
009700     RECORD CONTAINS 254 CHARACTERS                               00910000
009800     LABEL RECORDS ARE STANDARD                                   00920000
009900     DATA RECORD IS OUTPUT-RECORD.                                00930000
010000 01  OUTPUT-RECORD3                   PIC X(254).                 00940000
010100                                                                  00950000
010200                                                                  00960000
010300 FD  OUTPUT-FILE4                                                 00970000
010400     RECORDING MODE F                                             00980000
010500     BLOCK CONTAINS 0 RECORDS                                     00990000
010600     RECORD CONTAINS 254 CHARACTERS                               01000000
010700     LABEL RECORDS ARE STANDARD                                   01010000
010800     DATA RECORD IS OUTPUT-RECORD.                                01020000
010900 01  OUTPUT-RECORD4                   PIC X(254).                 01030000
011000                                                                  01040000
011100                                                                  01050000
011200 FD  OUTPUT-FILE5                                                 01060000
011300     RECORDING MODE F                                             01070000
011400     BLOCK CONTAINS 0 RECORDS                                     01080000
011500     RECORD CONTAINS 254 CHARACTERS                               01090000
011600     LABEL RECORDS ARE STANDARD                                   01100000
011700     DATA RECORD IS OUTPUT-RECORD.                                01110000
011800 01  OUTPUT-RECORD5                   PIC X(254).                 01120000
011900                                                                  00620000
012000 FD  EXCEPTION-FILE                                               00630000
012100     RECORDING MODE IS F                                          00640000
012200     BLOCK CONTAINS 0 RECORDS                                     00670000
012300     RECORD CONTAINS 132 CHARACTERS                               00660000
012400     LABEL RECORDS ARE STANDARD.                                  00650000
012500 01  EXCEPTION-RECORD                 PIC  X(132).                00680000
012600                                                                  01130000
012700*                                                                 01140000
012800 WORKING-STORAGE SECTION.                                         01150000
012900*                                                                 01160000
013000     EXEC SQL                                                     01210000
013100        INCLUDE TIMCNTK                                           01220000
013200     END-EXEC.                                                    01230000
013300                                                                  01240000
013400     EXEC SQL                                                     01250000
013500        INCLUDE TIMFOB                                            01260000
013600     END-EXEC.                                                    01270000
013700                                                                  01280000
013800     EXEC SQL                                                     01290000
013900        INCLUDE TEXTENT                                           01300000
014000     END-EXEC.                                                    01310000
014100                                                                  01280000
014200     EXEC SQL                                                     01290000
014300        INCLUDE TPLNSHP                                                 00
014400     END-EXEC.                                                    01310000
014500                                                                  01280000
014600     EXEC SQL                                                     01290000
014700        INCLUDE TRT00014                                          01300000
014800     END-EXEC.                                                    01310000
014900                                                                  01280000
015000     EXEC SQL                                                     01290000
015100        INCLUDE TRT00015                                          01300000
015200     END-EXEC.                                                    01310000
015300                                                                          
015400     EXEC SQL                                                             
015500          INCLUDE TIMPORL                                                 
015600     END-EXEC.                                                            
015700                                                                          
015800     EXEC SQL                                                             
015900          INCLUDE TIMCNRL                                                 
016000     END-EXEC.                                                            
016100*                                                                         
016200**************************************************                01330000
016300* INCLUDE SQL COMMUNICATION AREA                                  01340000
016400*************************************************                 01350000
016500     EXEC SQL                                                     01370000
016600        INCLUDE SQLCA                                             01380000
016700     END-EXEC.                                                    01390000
016800     COPY SQLCA2.                                                 01410000
016900                                                                  01420000
017000******************************************************************        
017100*    ENTITY ID'S TABLE COPYBOOK LAYOUT                                    
017200******************************************************************        
017300     COPY TRRD030.                                                        
017400                                                                          
017500******************************************************************        
017600* D266-GET-BEGIN-END-DATES (TRPD266) WORK FIELDS.                         
017700******************************************************************        
017800     COPY TRRD266.                                                        
017900                                                                          
018000*************************************************                 01430000
018100* PROGRAM VARIABLES                                               01440000
018200*************************************************                 01450000
018300 01 PV-PROGRAM-VARIABLES.                                         01460000
018400    05 PV-CURRENT-TIME              PIC X(26)  VALUE SPACES.              
018500    05 PV-FILE-NO                   PIC 9(01)  VALUE ZEROES.      01470000
018600    05 PV-ADDNL-FILE-NO             PIC X(01)  VALUE SPACE.       01470000
018700    05 PV-DEFAULT-VENDOR-TRI        PIC 9(09)  VALUE ZEROES.      01470100
018800    05 PV-DEFAULT-VEND-NME          PIC X(10)  VALUE SPACES.      01470100
018900    05 PV-DEFAULT-FILE-NO           PIC 9(01)  VALUE ZEROES.      01470200
019000    05 PV-WRITE-ENT-FILE-NO         PIC 9(01)  VALUE ZERO.        01470300
019100    05 PV-WRITE-ENT-FILE-ENT-ID     PIC 9(09)  VALUE ZEROES.      01470400
019200    05 PV-ENT-ID                    PIC 9(09)  VALUE ZEROES.      01470500
019300    05 PV-PREV-ENT-ID               PIC 9(09)  VALUE ZEROES.      01470600
019400    05 PV-ERROR-ENT-ID              PIC 9(09)  VALUE ZEROES.      01470500
019500    05 PV-ENT-ID-FILE-1             PIC 9(09)  VALUE ZEROES.      01470600
019600    05 PV-ENT-ID-FILE-2             PIC 9(09)  VALUE ZEROES.      01470600
019700    05 PV-ENT-ID-FILE-3             PIC 9(09)  VALUE ZEROES.      01470600
019800    05 PV-ENT-ID-FILE-4             PIC 9(09)  VALUE ZEROES.      01470600
019900    05 PV-ENT-ID-FILE-5             PIC 9(09)  VALUE ZEROES.      01470600
020000    05 PV-HOLD-ADJ-ENT-ID           PIC 9(09)  VALUE ZERO.                
020100    05 PV-DCNSL-SCAC-DEF            PIC X(04)  VALUE SPACES.              
020200    05 PV-DCNSL-SCAC-LONG           PIC X(30)  VALUE SPACES.              
020300    05 PV-DCNSL-SCAC                PIC X(04)  VALUE SPACES.              
020400    05 PV-VESSEL-NAME-DEF           PIC X(10)  VALUE SPACES.              
020500    05 PV-VESSEL-NAME-SEL           PIC X(10)  VALUE SPACES.              
020600    05 PV-WHERE-VESSEL              PIC X(10)  VALUE SPACES.              
020700    05 PV-WHERE-ETA                 PIC X(10)  VALUE SPACES.      01470800
020800    05 PV-CON-VSL-DCNSL-SCAC        PIC X(04)  VALUE SPACES.              
020900    05 PV-CMN-VSL-DCNSL-SCAC        PIC X(04)  VALUE SPACES.              
021000    05 PV-ERROR-SCAC                PIC X(04)  VALUE SPACES.              
021100    05 PV-CONTAINER-ID              PIC X(30)  VALUE SPACES.      01470800
021200    05 PV-ETA-DATE                  PIC X(10)  VALUE SPACES.      01470800
021300    05 PV-PARAGRAPH-NAME            PIC X(30)  VALUE SPACES.      01470800
021400    05 PV-DB2-OPERATION-ATTEMPTED   PIC X(30)  VALUE SPACE.       01470900
021500    05 PV-ABEND-CODE                PIC S9(04) VALUE +0           01471000
021600                                               COMP SYNC.         01472000
021700    05 PV-PO-NBR                    PIC X(30)  VALUE SPACES.              
021800    05 PV-HOLD-PO-NBR               PIC 9(08)  VALUE ZERO.                
021900                                                                          
022000 01 PV-SUB-SRIPTS     COMP SYNC.                                  01473000
022100    05 PV-NAME-SUB                  PIC S9(04) VALUE +0.          01474000
022200    05 PV-ENT-ID-COMP               PIC S9(09) VALUE ZERO         01470500
022300                                               COMP.                      
022400    05 PV-PO-NBR-COMP               PIC S9(09) VALUE ZERO                 
022500                                               COMP.                      
022600                                                                  01475000
022700 01 PV-HOLD-VARIABLES.                                            01476000
022800    05 PV-HOLD-POE-REC           PIC X(254)  VALUE SPACES.        01477000
022900    05 PV-HOLD-ETA-REC.                                           01478003
023000       10  FILLER                PIC X(11)   VALUE SPACES.        01478103
023100       10  PV-VESSEL-ETA-DATE    PIC X(08)   VALUE SPACES.        01478203
023200       10  FILLER                PIC X(236)  VALUE SPACES.        01478303
023300    05 PV-HOLD-VES-REC           PIC X(254)  VALUE SPACES.        01479000
023400    05 PV-HOLD-CON-REC           PIC X(254)  VALUE SPACES.        01480000
023500    05 PV-HOLD-WRITE-REC         PIC X(254)  VALUE SPACES.        01540000
023600    05 PV-FORMAT-DATE            PIC X(10).                       01541032
023700    05 FILLER REDEFINES PV-FORMAT-DATE.                           01542032
023800       10 PV-FORMAT-TMST-DTE-CY  PIC X(04).                       01543033
023900       10 PV-FORMAT-TMST-DTE-D1  PIC X(01).                       01544033
024000       10 PV-FORMAT-TMST-DTE-MM  PIC X(02).                       01545033
024100       10 PV-FORMAT-TMST-DTE-D2  PIC X(01).                       01546033
024200       10 PV-FORMAT-TMST-DTE-DD  PIC X(02).                       01547033
024300    05 PV-EXCEPTION-REC          PIC X(254)  VALUE SPACES.        01540000
024400                                                                  01550000
024500 01  PV-COUNTERS COMP-3.                                          01560000
024600     05  PV-OPEN-OUTPUT-FILE-COUNTER PIC S9(2)  VALUE ZERO.       01570000
024700     05  PV-EXCP-COUNTER         PIC S9(7)  VALUE ZERO.           01580000
024800     05  PV-EXTRACTS-READ        PIC S9(7)  VALUE ZERO.           01590000
024900     05  PV-TOT-RECS-WRITTEN     PIC S9(7)  VALUE ZERO.           01600000
025000     05  PV-RETRY-COUNTER        PIC S9(4)  VALUE ZERO.           01610000
025100     05  PV-HOLD-NUMBER-OF-OUTPUT-FILES PIC S99 VALUE ZEROS.      01620000
025200                                                                  01630000
025300 01 PC-PROGRAM-CONSTANTS.                                         01640000
025400    05  PC-MAX-RETRIES           PIC 9(03)  VALUE 3.              01650000
025500    05  PC-DEFAULT-VENDOR-TRI    PIC 9(09)  VALUE 4831.           01660000
025600    05  PC-A                     PIC X(01)  VALUE 'A'.            01660000
025700                                                                  01670000
025800     COPY TRRD004.                                                01680000
025900                                                                  01690000
026000 01 WS-DECONSOL-TABLE.                                            01700000
026100    05 WS-DECONSOL-TABLE-ENTRIES OCCURS 20 TIMES                  01710000
026200                                 INDEXED BY DEC-IND.              01720000
026300       10 WS-ENT-ID              PIC 9(09).                       01730000
026400       10 WS-POE-WRITE-IND       PIC X(01).                       01740000
026500       10 WS-ETA-WRITE-IND       PIC X(01).                       01750000
026600       10 WS-VES-WRITE-IND       PIC X(01).                       01760000
026700                                                                  01770000
026800 01 WS-DECONSOL-NO-TABLE.                                         01780000
026900    05 WS-DECONSOL-NO-TABLE-ENTRIES OCCURS 20 TIMES               01790000
027000                                 INDEXED BY DECNO-IND.            01800000
027100       10 WS-DECNO-FILE-NO        PIC 9(01).                      01810000
027200       10 WS-DECNO-ENT-ID         PIC 9(09).                      01820000
027300       10 WS-DECNO-DEFAULT-ENT-ID PIC X(01).                      01830000
027400       10 WS-DECNO-ADDNL-FILE-NO  PIC X(01).                              
027500                                                                  01840000
027600 01 PV-CONTROL-RECORD.                                            01920000
027700    05 PV-CTL-ISA                PIC X(03)  VALUE 'ISA'.          01930000
027800    05 PV-CONTROL-ENT-ID         PIC 9(09).                       01940000
027900    05 FILLER                    PIC X(242) VALUE SPACES.         01950000
028000                                                                  01960000
028100 01 PV-DECONSOL-RECORD.                                           01970000
028200    05 PV-DECONSOL-REC-TYPE      PIC X(03).                       01980000
028300       88 PV-DECONSOL-REC-POE               VALUE 'POE'.          01990000
028400       88 PV-DECONSOL-REC-ETA               VALUE 'ETA'.          02000000
028500       88 PV-DECONSOL-REC-VES               VALUE 'VES'.          02010000
028600       88 PV-DECONSOL-REC-CMN               VALUE 'CMN'.          02020000
028700       88 PV-DECONSOL-REC-CON               VALUE 'CON'.          02030000
028800       88 PV-DECONSOL-REC-PO                VALUE 'PO '.          02040000
028900       88 PV-DECONSOL-REC-CTT               VALUE 'CTT'.          02050000
029000    05 FILLER                    PIC X(247).                      02060000
029100 01  PV-WRITE-CTL-RECORDS.                                        02070000
029200     05  PV-WRITE-CTL-REC-FILE1-SW     PIC X(01) VALUE 'Y'.       02080000
029300       88  PV-WRITE-CTL-REC-FILE1           VALUE 'Y'.            02090000
029400       88  PV-WRITE-CTL-REC-FILE1-NO        VALUE 'N'.            02100000
029500     05  PV-WRITE-CTL-REC-FILE2-SW     PIC X(01) VALUE 'Y'.       02110000
029600       88  PV-WRITE-CTL-REC-FILE2           VALUE 'Y'.            02120000
029700       88  PV-WRITE-CTL-REC-FILE2-NO        VALUE 'N'.            02120100
029800     05  PV-WRITE-CTL-REC-FILE3-SW     PIC X(01) VALUE 'Y'.       02120200
029900       88  PV-WRITE-CTL-REC-FILE3           VALUE 'Y'.            02120300
030000       88  PV-WRITE-CTL-REC-FILE3-NO        VALUE 'N'.            02120400
030100     05  PV-WRITE-CTL-REC-FILE4-SW     PIC X(01) VALUE 'Y'.       02120500
030200       88  PV-WRITE-CTL-REC-FILE4           VALUE 'Y'.            02120600
030300       88  PV-WRITE-CTL-REC-FILE4-NO        VALUE 'N'.            02120700
030400     05  PV-WRITE-CTL-REC-FILE5-SW     PIC X(01) VALUE 'Y'.       02120800
030500       88  PV-WRITE-CTL-REC-FILE5           VALUE 'Y'.            02120900
030600       88  PV-WRITE-CTL-REC-FILE5-NO        VALUE 'N'.            02121000
030700     05  PV-PROCESSING-CMN-REC-SW      PIC X(01) VALUE ' '.       02121188
030800       88  PV-PROCESSING-CMN-REC            VALUE 'Y'.            02121288
030900       88  PV-PROCESSING-CMN-REC-NO         VALUE 'N'.            02121388
031000     05  PV-IMCNRL-SQLCODE-ZERO-SW     PIC X(01) VALUE ' '.       02121188
031100       88  PV-IMCNRL-SQLCODE-ZERO           VALUE 'Y'.            02121288
031200       88  PV-IMCNRL-SQLCODE-ZERO-NO        VALUE 'N'.            02121388
031300     05 PV-SAVE-DECONSOL-REC-TYPE      PIC X(03) VALUE SPACES.    01980000
031400        88 PV-SAVE-DECONSOL-REC-CMN         VALUE 'CMN'.          02020000
031500        88 PV-SAVE-DECONSOL-REC-CON         VALUE 'CON'.          02030000
031600                                                                  02123000
031700 01  PS-PROGRAM-SWITCHES.                                         02124000
031800     05  PS-END-OF-INPUT-FILE-SW    PIC X(01) VALUE 'N'.          02125000
031900         88  PS-END-OF-INPUT-FILE             VALUE 'Y'.          02126000
032000     05  PS-END-OF-INPUT-ENT-FILE-SW PIC X(01) VALUE 'N'.         02127000
032100         88  PS-END-OF-INPUT-ENT-FILE         VALUE 'Y'.          02128000
032200     05  PS-END-OF-SEARCH-SW        PIC X(01) VALUE 'N'.          02129000
032300         88  PS-END-OF-SEARCH                 VALUE 'Y'.          02130000
032400         88  PS-NOT-END-OF-SEARCH             VALUE 'N'.          02140000
032500     05  PS-READ-NEXT-REC-SW        PIC X(01) VALUE 'Y'.          02150000
032600         88  PS-READ-NEXT-REC                 VALUE 'Y'.          02160000
032700         88  PS-READ-NEXT-REC-NO              VALUE 'N'.          02170000
032800     05  PS-PURCHS-FOUND-SW         PIC X(01) VALUE 'N'.          02180000
032900         88  PS-PURCHS-FOUND                  VALUE 'Y'.          02190000
033000         88  PS-PURCHS-NOT-FOUND              VALUE 'N'.          02200000
033100     05  PS-END-OF-DEF-RUL-CSR-SW   PIC X(01) VALUE 'N'.          02180000
033200         88  PS-END-OF-DEF-RUL-CSR            VALUE 'Y'.          02190000
033300         88  PS-END-OF-DEF-RUL-CSR-NO         VALUE 'N'.          02200000
033400                                                                          
033500     05  PS-WRITE-FILE-1-SW         PIC X(01) VALUE 'N'.          02180000
033600         88  PS-WRITE-FILE-1                  VALUE 'Y'.          02190000
033700         88  PS-WRITE-FILE-1-NO               VALUE 'N'.          02200000
033800     05  PS-WRITE-FILE-2-SW         PIC X(01) VALUE 'N'.          02180000
033900         88  PS-WRITE-FILE-2                  VALUE 'Y'.          02190000
034000         88  PS-WRITE-FILE-2-NO               VALUE 'N'.          02200000
034100     05  PS-WRITE-FILE-3-SW         PIC X(01) VALUE 'N'.          02180000
034200         88  PS-WRITE-FILE-3                  VALUE 'Y'.          02190000
034300         88  PS-WRITE-FILE-3-NO               VALUE 'N'.          02200000
034400     05  PS-WRITE-FILE-4-SW         PIC X(01) VALUE 'N'.          02180000
034500         88  PS-WRITE-FILE-4                  VALUE 'Y'.          02190000
034600         88  PS-WRITE-FILE-4-NO               VALUE 'N'.          02200000
034700     05  PS-WRITE-FILE-5-SW         PIC X(01) VALUE 'N'.          02180000
034800         88  PS-WRITE-FILE-5                  VALUE 'Y'.          02190000
034900         88  PS-WRITE-FILE-5-NO               VALUE 'N'.          02200000
035000     05  PS-SCAC-ADJ-FOUND-SW       PIC X(01) VALUE 'N'.          02180000
035100         88  PS-SCAC-ADJ-FOUND                VALUE 'Y'.          02190000
035200         88  PS-SCAC-ADJ-FOUND-NO             VALUE 'N'.          02200000
035300                                                                        00
035400     05  PS-DEFAULT-USED-SW         PIC X(01) VALUE 'N'.          02180000
035500         88  PS-DEFAULT-USED-NO               VALUE 'N'.          02190000
035600         88  PS-DEFAULT-USED-YES              VALUE 'Y'.          02190000
035700         88  PS-FOB-USED                      VALUE 'F'.          02190000
035800                                                                  02210000
035900 01  PC-PROGRAM-CONSTANTS.                                                
036000     05  PC-CURRENT-PROGRAM-NAME     PIC X(08)     VALUE                  
036100         'TRKUP015'.                                                      
036200*                                                                         
036300*                                                                         
036400*  CURSOR DECLARATION FOR DEFAULT RULE CURSOR                             
036500*                                                                         
036600*                                                                         
036700     EXEC SQL                                                             
036800         DECLARE DEF_RUL_CSR CURSOR WITH HOLD FOR                         
036900         SELECT DISTINCT                                                  
037000                CONT.RUL_CNSTR_VAL_TXT                                    
037100               ,VSL.RUL_CNSTR_VAL_TXT                                     
037200               ,ETA.RUL_CNSTR_VAL_TXT                                     
037300          FROM  TRT_RUL_CNSTR CONPO                                       
037400               ,TRT_RUL_CNSTR CONT                                        
037500               ,TRT_RUL_CNSTR ETA                                         
037600               ,TRT_RUL_CNSTR VSL                                         
037700               ,TRT_RUL       TR                                          
037800         WHERE CONPO.RUL_ID            = CONT.RUL_ID              05161278
037900           AND CONPO.RUL_ID            = ETA.RUL_ID               05161378
038000           AND CONPO.RUL_ID            = VSL.RUL_ID               05161478
038100           AND CONPO.RUL_ID            = TR.RUL_ID                05161580
038200           AND CONPO.RUL_CNSTR_TYP_CDE = 'CONPO'                  05161278
038300           AND CONT.RUL_CNSTR_TYP_CDE  = 'CONT'                   05161378
038400           AND ETA.RUL_CNSTR_TYP_CDE   = 'ETA'                    05161478
038500           AND VSL.RUL_CNSTR_TYP_CDE   = 'VSL'                    05161278
038600           AND SUBSTR(CONPO.RUL_CNSTR_VAL_TXT,2,8) = :PV-PO-NBR   05161378
038700           AND TR.RUL_CDE              = 'CONT'                   05161478
038800           AND TR.RUL_TYP_CDE          = 'DEF'                    05161580
038900     END-EXEC.                                                            
039000                                                                          
039100****************************************************************  02220000
039200 PROCEDURE DIVISION.                                              02230000
039300****************************************************************  02240000
039400 0000-PROGRAM-MAINLINE.                                           02250000
039500                                                                  02260000
039600     PERFORM 1000-INITIALIZATION.                                 02270000
039700     PERFORM 2500-READ-INPUT-FILE.                                02280000
039800     PERFORM 2000-PROCESS-FILE                                    02290000
039900         UNTIL PS-END-OF-INPUT-FILE.                              02300000
040000     PERFORM 8000-CLOSE-FILES.                                    02310000
040100                                                                  02320000
040200     STOP RUN.                                                    02330000
040300                                                                  02340000
040400****************************************************************  02350000
040500* 1000-INITIALIZATION OPENS ALL FILES AND INITAILZES ALL OF    *  02360000
040600* THE NECESSARY FIELDS.                                        *  02370000
040700****************************************************************  02380000
040800 1000-INITIALIZATION.                                             02390000
040900                                                                  02400000
041000     OPEN INPUT INPUT-FILE                                        02410000
041100                INPUT-ENT-FILE.                                   02420000
041200     OPEN OUTPUT EXCEPTION-FILE.                                          
041300                                                                  02430000
041400     INITIALIZE WS-DECONSOL-TABLE                                 02440000
041500                WS-DECONSOL-NO-TABLE.                             02450000
041600                                                                  02460000
041700     PERFORM 1020-READ-INPUT-ENT-FILE                             02470000
041800     SET DECNO-IND TO 1                                           02480000
041900     PERFORM 1010-BUILD-ENT-TABLE                                 02490000
042000       UNTIL PS-END-OF-INPUT-ENT-FILE.                            02500000
042100                                                                  02510000
042200     OPEN OUTPUT OUTPUT-FILE1                                     02520000
042300     MOVE 2 TO PV-OPEN-OUTPUT-FILE-COUNTER                        02530000
042400     IF PV-OPEN-OUTPUT-FILE-COUNTER >                             02540000
042500        PV-HOLD-NUMBER-OF-OUTPUT-FILES                            02550000
042600         CONTINUE                                                 02560000
042700     ELSE                                                         02570000
042800        OPEN OUTPUT OUTPUT-FILE2                                  02580000
042900     END-IF.                                                      02590000
043000     MOVE 3 TO PV-OPEN-OUTPUT-FILE-COUNTER                        02600000
043100     IF PV-OPEN-OUTPUT-FILE-COUNTER >                             02610000
043200        PV-HOLD-NUMBER-OF-OUTPUT-FILES                            02620000
043300         CONTINUE                                                 02630000
043400     ELSE                                                         02640000
043500        OPEN OUTPUT OUTPUT-FILE3                                  02650000
043600     END-IF.                                                      02660000
043700     MOVE 4 TO PV-OPEN-OUTPUT-FILE-COUNTER                        02670000
043800     IF PV-OPEN-OUTPUT-FILE-COUNTER >                             02680000
043900        PV-HOLD-NUMBER-OF-OUTPUT-FILES                            02690000
044000         CONTINUE                                                 02700000
044100     ELSE                                                         02710000
044200        OPEN OUTPUT OUTPUT-FILE4                                  02720000
044300     END-IF.                                                      02721000
044400     MOVE 5 TO PV-OPEN-OUTPUT-FILE-COUNTER                        02722000
044500     IF PV-OPEN-OUTPUT-FILE-COUNTER >                             02723000
044600        PV-HOLD-NUMBER-OF-OUTPUT-FILES                            02724000
044700         CONTINUE                                                 02725000
044800     ELSE                                                         02726000
044900        OPEN OUTPUT OUTPUT-FILE5                                  02727000
045000     END-IF.                                                      02728000
045100     PERFORM 1100-RETREVE-CURRENT-TIMESTAMP.                              
045200******************************************************************02730000
045300* RETREVE CURRENT TIMESTAMP                                      *02740000
045400******************************************************************02750000
045500 1100-RETREVE-CURRENT-TIMESTAMP.                                          
045600                                                                          
045700     EXEC SQL                                                             
045800         SET :PV-CURRENT-TIME = CURRENT TIMESTAMP                         
045900     END-EXEC.                                                            
046000                                                                          
046100     EVALUATE TRUE                                                        
046200         WHEN SQLWARN0 NOT EQUAL SPACE                                    
046300         WHEN SQLCODE NOT EQUAL ZERO                                      
046400             DISPLAY '** ABEND **'                                        
046500             DISPLAY '** PROGRAM = TRKUP015 **'                           
046600             DISPLAY '** PARAGRAPH = 1100-RETREVE-CURRENT-TIME**'         
046700             DISPLAY '** UNSUCCESSFUL SELECT OF TIME**'                   
046800             PERFORM 9900-SQL-ERROR                                       
046900     END-EVALUATE.                                                        
047000                                                                          
047100****************************************************************  02730000
047200* 1010-BUILD-ENT-TABLE - BUILD ENTITY TABLE FROM INPUT-ENT-FILE*  02740000
047300****************************************************************  02750000
047400 1010-BUILD-ENT-TABLE.                                            02760000
047500     IF TR030-ENT-FILE-NO NUMERIC AND                             02770000
047600         (TR030-ENT-FILE-NO > 0 AND < 6)                          02780000
047700             MOVE TR030-ENT-FILE-NO                               02790000
047800             TO WS-DECNO-FILE-NO (DECNO-IND)                      02800000
047900                PV-HOLD-NUMBER-OF-OUTPUT-FILES                    02810000
048000         ELSE                                                     02820000
048100             DISPLAY '** INVALID DECONSOLIDATOR NUMBER = '        02830000
048200             TR030-ENT-FILE-NO                                    02840000
048300     END-IF.                                                      02850000
048400                                                                  02860000
048500     IF TR030-ENT-ID NUMERIC                                      02870000
048600         MOVE TR030-ENT-ID                                        02880000
048700         TO   WS-DECNO-ENT-ID (DECNO-IND)                         02890000
048800     ELSE                                                         02900000
048900         DISPLAY '** INVALID ENTITY ID '                          02910000
049000         TR030-DCONSLR-ENT-TBL-REC                                02920000
049100     END-IF.                                                      02930000
049200                                                                  02940000
049300     IF TR030-ENT-DEFAULT-IND = ('N' OR 'Y')                      02950000
049400         MOVE TR030-ENT-DEFAULT-IND                               02960000
049500         TO   WS-DECNO-DEFAULT-ENT-ID (DECNO-IND)                 02970000
049600     ELSE                                                         02980000
049700         DISPLAY '** INVALID DEFAULD ENTITY IND '                 02990000
049800         TR030-DCONSLR-ENT-TBL-REC                                02920000
049900     END-IF.                                                      03010000
050000                                                                  03020000
050100     IF TR030-ENT-DEFAULT-IND = 'Y'                               03030000
050200         MOVE TR030-ENT-ID           TO PV-DEFAULT-VENDOR-TRI     03040000
050300         MOVE TR030-ENT-FILE-NO      TO PV-DEFAULT-FILE-NO        03050000
050400         MOVE TR030-ENT-DCONSLR-NAME TO PV-DEFAULT-VEND-NME               
050500     END-IF.                                                      03060000
050600                                                                  02940000
050700     IF TR030-ENT-ADDNL-FILE-NO =                                 02950000
050800           (' ' OR '1' OR '2' OR '3' OR '4' OR '5')               02950000
050900         MOVE TR030-ENT-ADDNL-FILE-NO                             02960000
051000         TO   WS-DECNO-ADDNL-FILE-NO (DECNO-IND)                  02970000
051100     ELSE                                                         02980000
051200         DISPLAY '** INVALID ADDITIONAL FILE NUMBER **'           02990000
051300         TR030-DCONSLR-ENT-TBL-REC                                02920000
051400     END-IF.                                                      03010000
051500                                                                  03070000
051600     PERFORM 1020-READ-INPUT-ENT-FILE                             03080000
051700     SET DECNO-IND UP BY 1.                                       03090000
051800                                                                  03100000
051900****************************************************************  03110000
052000* 1020-READ-INPUT-ENT-FILE                                     *  03120000
052100****************************************************************  03130000
052200 1020-READ-INPUT-ENT-FILE.                                        03140000
052300     READ INPUT-ENT-FILE INTO TR030-DCONSLR-ENT-TBL-REC           03150000
052400       AT END                                                     03160000
052500        SET PS-END-OF-INPUT-ENT-FILE TO TRUE.                     03170000
052600                                                                  03180000
052700****************************************************************  03190000
052800* DETERMINE RECORD TYPE (POE, ERA, VES, CMN, CON, CON )        *  03200000
052900****************************************************************  03210000
053000 2000-PROCESS-FILE.                                               03220000
053100                                                                  03230000
053200     SET PS-READ-NEXT-REC                                         03240000
053300         PS-WRITE-FILE-1-NO                                               
053400         PS-WRITE-FILE-2-NO                                               
053500         PS-WRITE-FILE-3-NO                                               
053600         PS-WRITE-FILE-4-NO                                               
053700         PS-WRITE-FILE-5-NO TO TRUE.                                      
053800     MOVE ZEROES            TO PV-ENT-ID-FILE-1                           
053900                               PV-ENT-ID-FILE-2                           
054000                               PV-ENT-ID-FILE-3                           
054100                               PV-ENT-ID-FILE-4                           
054200                               PV-ENT-ID-FILE-5.                          
054300                                                                  03250000
054400     IF PV-DECONSOL-REC-POE                                       03260000
054500         SET PS-SCAC-ADJ-FOUND-NO TO TRUE                                 
054600         MOVE 0 TO PV-HOLD-ADJ-ENT-ID                                     
054700         MOVE PV-DECONSOL-RECORD TO PV-HOLD-POE-REC               03270000
054800                                    TR004-REC-TYPE-POE                    
054900         PERFORM VARYING DEC-IND FROM 1 BY 1                      03290000
055000             UNTIL (WS-ENT-ID(DEC-IND) = ZEROS OR LOW-VALUES)     03300000
055100                OR DEC-IND > 20                                   03310000
055200             MOVE 'Y'            TO WS-POE-WRITE-IND(DEC-IND)     03320000
055300         END-PERFORM                                              03330000
055400     END-IF.                                                      03340000
055500                                                                  03350000
055600     IF PV-DECONSOL-REC-ETA                                       03360000
055700         MOVE PV-DECONSOL-RECORD TO PV-HOLD-ETA-REC               03370000
055800         PERFORM VARYING DEC-IND FROM 1 BY 1                      03372000
055900             UNTIL (WS-ENT-ID(DEC-IND) = ZEROS OR LOW-VALUES)     03373000
056000                OR DEC-IND > 20                                   03374000
056100             MOVE 'Y'            TO WS-ETA-WRITE-IND(DEC-IND)     03375000
056200         END-PERFORM                                              03376000
056300     END-IF.                                                      03377000
056400                                                                  03378000
056500     IF PV-DECONSOL-REC-VES                                       03379000
056600         MOVE PV-DECONSOL-RECORD TO PV-HOLD-VES-REC               03380000
056700         PERFORM VARYING DEC-IND FROM 1 BY 1                      03400000
056800             UNTIL (WS-ENT-ID(DEC-IND) = ZEROS OR LOW-VALUES)     03410000
056900                OR DEC-IND > 20                                   03420000
057000             MOVE 'Y'            TO WS-VES-WRITE-IND(DEC-IND)     03430000
057100         END-PERFORM                                              03440000
057200         INITIALIZE TR004-REC-TYPE-VES                                    
057300         MOVE PV-DECONSOL-RECORD  TO TR004-REC-TYPE-VES           03520000
057400     END-IF.                                                      03450000
057500                                                                  03460000
057600     IF PV-DECONSOL-REC-CON                                       03470000
057700         MOVE PV-DECONSOL-REC-TYPE   TO PV-SAVE-DECONSOL-REC-TYPE 01980000
057800         MOVE PV-DECONSOL-RECORD     TO PV-HOLD-CON-REC           03480000
057900                                        TR004-REC-TYPE-CONTAINER          
058000         PERFORM 2500-READ-INPUT-FILE                                     
058100         IF PV-DECONSOL-REC-PO                                            
058200           MOVE PV-DECONSOL-RECORD TO TR004-REC-TYPE-PO                   
058300           IF TR004-PO-NBR NOT = PV-HOLD-PO-NBR                           
058400             SET PS-SCAC-ADJ-FOUND-NO TO TRUE                             
058500             MOVE 0 TO PV-HOLD-ADJ-ENT-ID                                 
058600           END-IF                                                         
058700           MOVE TR004-PO-NBR TO PV-PO-NBR                                 
058800                                PV-HOLD-PO-NBR                            
058900                                PV-PO-NBR-COMP                            
059000           MOVE SPACES       TO PV-DCNSL-SCAC                             
059100                                                                          
059200           IF TR004-PROCESS-POE-RETRANS-CON                               
059300             PERFORM 3000-OPEN-DEF-RUL-CSR                                
059400             PERFORM 2005-CONPO-RETRAN                                    
059500                UNTIL PS-END-OF-DEF-RUL-CSR                               
059600             PERFORM 3200-CLOSE-DEF-RUL-CSR                               
059700             SET PS-END-OF-DEF-RUL-CSR-NO TO TRUE                         
059800           ELSE                                                           
059900             PERFORM 2010-CONPO-TRAN                                      
060000           END-IF                                                         
060100                                                                          
060200*          IF NO DEFAULT RULE WAS FOUND USE DEFAULT ENT ID                
060300           IF  PS-WRITE-FILE-1-NO                                         
060400           AND PS-WRITE-FILE-2-NO                                         
060500           AND PS-WRITE-FILE-3-NO                                         
060600           AND PS-WRITE-FILE-4-NO                                         
060700           AND PS-WRITE-FILE-5-NO                                         
060800              PERFORM 2100-FIND-FOB-ENT-ID                                
060900              IF PS-DEFAULT-USED-YES                                      
061000                  PERFORM 5030-WRITE-EXCEPTION-FILE                       
061100                  SET PS-WRITE-FILE-1        TO TRUE                      
061200              END-IF                                                      
061300              PERFORM 4000-SEARCH-ENT-ID                                  
061400              MOVE PV-ENT-ID      TO PV-CONTROL-ENT-ID                    
061500              PERFORM 2030-SEARCH-ENT-ID-TBL                              
061600           END-IF                                                         
061700                                                                          
061800           MOVE PV-ENT-ID TO PV-ENT-ID-COMP                               
061900           PERFORM 7050-SELECT-TIMPORL                                    
062000           EVALUATE TRUE                                                  
062100               WHEN SQLCODE = ZERO                                        
062200                 IF IMPORL-DCONSLR-ENT-ID > 0 AND                         
062300                    IMPORL-DCONSLR-ENT-ID = PV-ENT-ID-COMP                
062400                     CONTINUE                                             
062500                 ELSE                                                     
062600                     PERFORM 7055-UPDATE-TIMPORL                          
062700                 END-IF                                                   
062800           END-EVALUATE                                                   
062900                                                                          
063000           PERFORM 2020-PROCESS-PO                                        
063100       END-IF                                                             
063200     END-IF.                                                      03600000
063300                                                                  03610001
063400     IF PV-DECONSOL-REC-CMN                                       03620001
063500         SET PS-SCAC-ADJ-FOUND-NO TO TRUE                                 
063600         MOVE 0 TO PV-HOLD-ADJ-ENT-ID                                     
063700         MOVE PV-DECONSOL-REC-TYPE TO PV-SAVE-DECONSOL-REC-TYPE   01980000
063800         SET PV-PROCESSING-CMN-REC TO TRUE                        03624088
063900         MOVE PV-DECONSOL-RECORD   TO TR004-REC-TYPE-CONTAINER    03630001
064000                                      PV-HOLD-CON-REC             03640001
064100                                                                          
064200*        DETERMIN DECON SCAC USING RULE TABLES FOR CMN                    
064300         PERFORM 7031-DECON-CMN-CONT-ADJ                                  
064400         IF PV-DCNSL-SCAC > SPACES                                        
064500            CONTINUE                                                      
064600         ELSE                                                             
064700            IF TR004-VESSEL-NAME = PV-WHERE-VESSEL                        
064800             AND PV-ETA-DATE = PV-WHERE-ETA                               
064900               CONTINUE                                                   
065000            ELSE                                                          
065100               PERFORM 3600-NEW-VESSEL                                    
065200            END-IF                                                        
065300            IF PV-CMN-VSL-DCNSL-SCAC > SPACES                             
065400               MOVE PV-CMN-VSL-DCNSL-SCAC TO PV-DCNSL-SCAC                
065500            ELSE                                                          
065600               PERFORM 7033-DECON-CMN-CONT-DEF                            
065700            END-IF                                                        
065800         END-IF                                                           
065900         IF PV-DCNSL-SCAC > SPACES                                        
066000            PERFORM 7034-SELECT-ENTITY-ID                                 
066100         ELSE                                                             
066200            MOVE PV-DEFAULT-VENDOR-TRI TO PV-ENT-ID                       
066300            PERFORM 5030-WRITE-EXCEPTION-FILE                             
066400         END-IF                                                           
066500         PERFORM 4000-SEARCH-ENT-ID                                       
066600         MOVE PV-ENT-ID      TO PV-CONTROL-ENT-ID                 03690001
066700         PERFORM 2030-SEARCH-ENT-ID-TBL                           03934600
066800                                                                          
066900         MOVE PV-ENT-ID TO PV-ENT-ID-COMP                                 
067000         PERFORM 2500-READ-INPUT-FILE                             03720001
067100         IF PV-DECONSOL-REC-PO                                    03730001
067200             MOVE PV-DECONSOL-RECORD TO TR004-REC-TYPE-PO         03740001
067300             PERFORM 7060-SELECT-TIMCNRL                          03870088
067400             EVALUATE TRUE                                                
067500                 WHEN SQLCODE = ZERO                                      
067600                   IF IMCNRL-DCONSLR-ENT-ID > 0 AND                       
067700                      IMCNRL-DCONSLR-ENT-ID = PV-ENT-ID-COMP              
067800                       CONTINUE                                           
067900                   ELSE                                                   
068000                       PERFORM 7065-UPDATE-TIMCNRL                03870088
068100                   END-IF                                                 
068200             END-EVALUATE                                                 
068300             PERFORM 2020-PROCESS-PO                              03773001
068400         END-IF                                                   03775001
068500     END-IF.                                                      03776001
068600                                                                  03780000
068700     IF PS-READ-NEXT-REC                                          03790000
068800         PERFORM 2500-READ-INPUT-FILE                             03800000
068900     END-IF.                                                      03810000
069000                                                                          
069100****************************************************************          
069200 2005-CONPO-RETRAN.                                                       
069300                                                                          
069400     PERFORM 3100-FETCH-DEF-RUL-CSR.                                      
069500                                                                          
069600     IF PS-END-OF-DEF-RUL-CSR                                             
069700        CONTINUE                                                          
069800     ELSE                                                                 
069900***     DETERMINE DECON SCAC USING RULE TABLES FOR CON                    
070000        PERFORM 3300-DECON-CON-CONT-ADJ                                   
070100        IF PV-DCNSL-SCAC > SPACES                                         
070200          SET PS-SCAC-ADJ-FOUND TO TRUE                                   
070300        ELSE                                                              
070400          PERFORM 3400-DECON-CON-VSL-ADJ                                  
070500          IF PV-CON-VSL-DCNSL-SCAC > SPACES                               
070600            MOVE PV-CON-VSL-DCNSL-SCAC TO PV-DCNSL-SCAC                   
070700            SET PS-SCAC-ADJ-FOUND TO TRUE                                 
070800          ELSE                                                            
070900            PERFORM 3500-DECON-CON-CONT-DEF                               
071000          END-IF                                                          
071100        END-IF                                                            
071200        PERFORM 2015-CONVERT-SCAC-TO-ENTID                                
071300* IF THERE IS AN ADJUSTMENT (CONTAINER OR VESSEL) ON THIS PO              
071400* THEN THE DCONSLR_ENT_ID IS SAVED TO UPDATE THE TIMPORL                  
071500        IF PS-SCAC-ADJ-FOUND                                              
071600          AND PV-HOLD-ADJ-ENT-ID = 0                                      
071700          MOVE PV-CONTROL-ENT-ID TO PV-HOLD-ADJ-ENT-ID                    
071800        END-IF                                                            
071900     END-IF.                                                              
072000                                                                          
072100****************************************************************          
072200 2010-CONPO-TRAN.                                                         
072300                                                                          
072400     MOVE TR004-CONTNR-ID TO PV-CONTAINER-ID.                             
072500     STRING PV-VESSEL-ETA-DATE(1:4) '-'                                   
072600            PV-VESSEL-ETA-DATE(5:2) '-'                                   
072700            PV-VESSEL-ETA-DATE(7:2)                                       
072800            DELIMITED BY SIZE INTO PV-ETA-DATE.                           
072900     PERFORM 3500-DECON-CON-CONT-DEF.                                     
073000     MOVE PV-VESSEL-NAME-SEL  TO PV-VESSEL-NAME-DEF.                      
073100     MOVE PV-DCNSL-SCAC       TO PV-DCNSL-SCAC-DEF.                       
073200                                                                          
073300***  DETERMINE DECON SCAC USING RULE TABLES FOR CON                       
073400     PERFORM 3300-DECON-CON-CONT-ADJ                                      
073500     IF PV-DCNSL-SCAC > SPACES                                            
073600        SET PS-SCAC-ADJ-FOUND TO TRUE                                     
073700     ELSE                                                                 
073800       PERFORM 3400-DECON-CON-VSL-ADJ                                     
073900       IF PV-CON-VSL-DCNSL-SCAC > SPACES                                  
074000         MOVE PV-CON-VSL-DCNSL-SCAC TO PV-DCNSL-SCAC                      
074100         SET PS-SCAC-ADJ-FOUND TO TRUE                                    
074200       ELSE                                                               
074300         MOVE PV-DCNSL-SCAC-DEF TO PV-DCNSL-SCAC                          
074400       END-IF                                                             
074500     END-IF.                                                              
074600                                                                          
074700     PERFORM 2015-CONVERT-SCAC-TO-ENTID.                                  
074800* IF THERE IS AN ADJUSTMENT (CONTAINER OR VESSEL) ON THIS PO              
074900* THEN THE DCONSLR_ENT_ID IS SAVED TO UPDATE THE TIMPORL                  
075000     IF PS-SCAC-ADJ-FOUND                                                 
075100       AND PV-HOLD-ADJ-ENT-ID = 0                                         
075200       MOVE PV-CONTROL-ENT-ID TO PV-HOLD-ADJ-ENT-ID                       
075300     END-IF.                                                              
075400                                                                          
075500****************************************************************          
075600 2015-CONVERT-SCAC-TO-ENTID.                                              
075700                                                                          
075800     IF PV-DCNSL-SCAC > SPACES                                            
075900        PERFORM 7034-SELECT-ENTITY-ID                                     
076000     ELSE                                                                 
076100        PERFORM 2100-FIND-FOB-ENT-ID                                      
076200        IF PS-DEFAULT-USED-YES                                            
076300            MOVE PV-DEFAULT-VENDOR-TRI TO PV-ENT-ID                       
076400            PERFORM 5030-WRITE-EXCEPTION-FILE                             
076500        END-IF                                                            
076600     END-IF.                                                              
076700     PERFORM 4000-SEARCH-ENT-ID.                                          
076800     MOVE PV-ENT-ID      TO PV-CONTROL-ENT-ID.                            
076900     PERFORM 2030-SEARCH-ENT-ID-TBL.                                      
077000                                                                          
077100****************************************************************  03933200
077200* PROCESS PO                                                   *  03933300
077300****************************************************************  03933400
077400 2020-PROCESS-PO.                                                 03933500
077500                                                                          
077600     IF PV-ERROR-ENT-ID GREATER THAN ZEROES                               
077700       MOVE PV-ERROR-ENT-ID TO PV-ENT-ID-FILE-1                           
077800                               PV-ENT-ID                                  
077900     END-IF.                                                              
078000     IF PV-ENT-ID NOT = PV-PREV-ENT-ID                            03934400
078100         MOVE PV-CONTROL-RECORD TO PV-HOLD-WRITE-REC              03935000
078200         PERFORM 5020-WRITE-OUTPUT-RECORDS                        03937000
078300     END-IF                                                       03939900
078400     PERFORM 5000-WRITE-POE-ETA-VES-REC                           03940000
078500     MOVE PV-HOLD-CON-REC TO PV-HOLD-WRITE-REC                    03940100
078600     PERFORM 5020-WRITE-OUTPUT-RECORDS                            03940200
078700     MOVE TR004-REC-TYPE-PO TO PV-HOLD-WRITE-REC                  03940300
078800     PERFORM 5020-WRITE-OUTPUT-RECORDS                            03940400
078900     MOVE PV-ENT-ID                  TO PV-PREV-ENT-ID            03940500
079000     PERFORM 6000-PROCESS-DETAIL-RECORDS                          03940600
079100     SET PS-READ-NEXT-REC-NO TO TRUE.                             03940700
079200                                                                  03940800
079300****************************************************************  03940900
079400* SEARCH INPUT ENTITY ID TABLE ENTITY ID                       *  03941000
079500****************************************************************  03941100
079600 2030-SEARCH-ENT-ID-TBL.                                          03941200
079700     SET DECNO-IND                 TO 1.                          03941300
079800     SET PS-NOT-END-OF-SEARCH      TO TRUE.                       03941400
079900     MOVE SPACE                    TO PV-ADDNL-FILE-NO.                   
080000     PERFORM UNTIL PS-END-OF-SEARCH                               03941500
080100          SEARCH WS-DECONSOL-NO-TABLE-ENTRIES                     03941600
080200              WHEN WS-DECNO-ENT-ID(DECNO-IND) = PV-ENT-ID         03941700
080300                  EVALUATE TRUE                                           
080400                     WHEN WS-DECNO-FILE-NO(DECNO-IND) = 1                 
080500                        SET PS-WRITE-FILE-1 TO TRUE                       
080600                        MOVE PV-ENT-ID      TO PV-ENT-ID-FILE-1           
080700                     WHEN WS-DECNO-FILE-NO(DECNO-IND) = 2                 
080800                        SET PS-WRITE-FILE-2 TO TRUE                       
080900                        MOVE PV-ENT-ID      TO PV-ENT-ID-FILE-2           
081000                     WHEN WS-DECNO-FILE-NO(DECNO-IND) = 3                 
081100                        SET PS-WRITE-FILE-3 TO TRUE                       
081200                        MOVE PV-ENT-ID      TO PV-ENT-ID-FILE-3           
081300                     WHEN WS-DECNO-FILE-NO(DECNO-IND) = 4                 
081400                        SET PS-WRITE-FILE-4 TO TRUE                       
081500                        MOVE PV-ENT-ID      TO PV-ENT-ID-FILE-4           
081600                     WHEN WS-DECNO-FILE-NO(DECNO-IND) = 5                 
081700                        SET PS-WRITE-FILE-5 TO TRUE                       
081800                        MOVE PV-ENT-ID      TO PV-ENT-ID-FILE-5           
081900                  END-EVALUATE                                            
082000                  EVALUATE TRUE                                           
082100                     WHEN WS-DECNO-ADDNL-FILE-NO(DECNO-IND) = 1   03942000
082200                        SET PS-WRITE-FILE-1 TO TRUE                       
082300                        IF PV-ENT-ID-FILE-1 EQUAL ZEROES                  
082400                           MOVE '000004831' TO PV-ENT-ID-FILE-1           
082500                        END-IF                                            
082600                     WHEN WS-DECNO-ADDNL-FILE-NO(DECNO-IND) = 2   03942000
082700                        SET PS-WRITE-FILE-2 TO TRUE                       
082800                        IF PV-ENT-ID-FILE-2 EQUAL ZEROES                  
082900                           MOVE '000053569' TO PV-ENT-ID-FILE-2           
083000                        END-IF                                            
083100                     WHEN WS-DECNO-ADDNL-FILE-NO(DECNO-IND) = 3   03942000
083200                        SET PS-WRITE-FILE-3 TO TRUE                       
083300                        IF PV-ENT-ID-FILE-3 EQUAL ZEROES                  
083400                           MOVE '000055883' TO PV-ENT-ID-FILE-3           
083500                        END-IF                                            
083600                     WHEN WS-DECNO-ADDNL-FILE-NO(DECNO-IND) = 4   03942000
083700                        SET PS-WRITE-FILE-4 TO TRUE                       
083800                        IF PV-ENT-ID-FILE-4 EQUAL ZEROES                  
083900                           MOVE '000074631' TO PV-ENT-ID-FILE-4           
084000                        END-IF                                            
084100                     WHEN WS-DECNO-ADDNL-FILE-NO(DECNO-IND) = 5   03942000
084200                        SET PS-WRITE-FILE-5 TO TRUE                       
084300                        IF PV-ENT-ID-FILE-5 EQUAL ZEROES                  
084400                           MOVE '000084346' TO PV-ENT-ID-FILE-5           
084500                        END-IF                                            
084600                  END-EVALUATE                                            
084700                  SET PS-END-OF-SEARCH      TO TRUE               03942200
084800              WHEN WS-DECNO-ENT-ID(DECNO-IND) = ZEROS OR          03942300
084900                                                LOW-VALUES        03942400
P40280                 MOVE PV-ENT-ID             TO PV-ENT-ID-FILE-1           
P40280*                MOVE PV-DEFAULT-VENDOR-TRI TO PV-CONTROL-ENT-ID          
P40280*                PERFORM 5030-WRITE-EXCEPTION-FILE                        
085200                 SET PS-WRITE-FILE-1        TO TRUE                       
085300                 SET PS-END-OF-SEARCH       TO TRUE               03942200
085400          END-SEARCH                                              03943000
085500     END-PERFORM.                                                 03943100
085600                                                                  03945000
085700******************************************************************03946000
085800*  SELECT FOB DECON DEFAULT FROM TIMFOB USING FOB FROM TPLNSHP   *03947000
085900******************************************************************03948000
086000                                                                  03945000
086100 2100-FIND-FOB-ENT-ID.                                                  00
086200                                                                  03945000
086300     SET PS-DEFAULT-USED-NO TO TRUE.                                    00
086400                                                                  03945000
086500     EXEC SQL                                                             
086600         SELECT FOB.DCONSLR_ENT_ID                                        
086700            INTO :PV-ENT-ID-COMP                                          
086800            FROM  TPLNSHP PO                                              
086900                 ,TIMFOB  FOB                                             
087000              WHERE PO.PO_NBR         = :PV-PO-NBR-COMP                 78
087100                AND PO.VER_STATUS_CDE = 'A'                             78
087200                AND PO.FOB_CDE        = FOB.FOB_CDE                     78
087300                AND FOB.STAT_CDE      = 'A'                             78
087400     END-EXEC                                                             
087500                                                                  03945000
087600                                                                  03945000
087700     EVALUATE TRUE                                                        
087800         WHEN SQLCODE = ZERO                                              
087900              MOVE PV-ENT-ID-COMP        TO PV-ENT-ID                     
088000              MOVE 'F'                   TO PS-DEFAULT-USED-SW            
088100          WHEN SQLCODE = +100                                             
088200              MOVE PV-DEFAULT-VENDOR-TRI TO PV-ENT-ID                     
088300              SET PS-DEFAULT-USED-YES    TO TRUE                          
088400         WHEN SQLWARN0 NOT EQUAL SPACE                                    
088500         WHEN SQLCODE NOT EQUAL ZERO                                      
088600             DISPLAY '** ABEND **'                                        
088700             DISPLAY '** SQLCODE = ' SQLCODE                              
088800             DISPLAY '** PROGRAM = TRKUP015 **'                           
088900             DISPLAY '** PARAGRAPH = 2100-FIND-FOB-DEFAULT'               
089000             DISPLAY '** PO = ' PV-PO-NBR                                 
089100             PERFORM 9900-SQL-ERROR                                       
089200     END-EVALUATE.                                                        
089300                                                                  03945000
089400                                                                  03945000
089500******************************************************************03946000
089600*  READ A RECORD FROM THE PROPRIETARY INPUT FILE.                *03947000
089700******************************************************************03948000
089800 2500-READ-INPUT-FILE.                                            03949000
089900                                                                  03950000
090000     READ INPUT-FILE                                              03960000
090100           INTO PV-DECONSOL-RECORD                                03970000
090200            AT END                                                03980000
090300             SET PS-END-OF-INPUT-FILE TO TRUE.                    03990000
090400                                                                          
090500      IF PV-HOLD-PO-NBR = 4423278 OR                              05700000
090600        PV-PO-NBR      = '4423278'                                        
090700       DISPLAY 'PV-PO-NBR     '  PV-PO-NBR                                
090800       DISPLAY 'PV-HOLD-PO-NBR ' PV-HOLD-PO-NBR                           
090900      END-IF.                                                             
091000                                                                  05165078
091100******************************************************************        
091200 3000-OPEN-DEF-RUL-CSR.                                                   
091300                                                                          
091400     EXEC SQL                                                             
091500          OPEN DEF_RUL_CSR                                                
091600     END-EXEC.                                                            
091700                                                                          
091800     EVALUATE TRUE                                                        
091900                                                                          
092000         WHEN SQLWARN0 NOT EQUAL SPACE                                    
092100         WHEN SQLCODE NOT EQUAL ZERO                                      
092200             DISPLAY '** ABEND **'                                        
092300             DISPLAY '** PROGRAM = TRKUP015 **'                           
092400             DISPLAY                                                      
092500                 '** PARAGRAPH = 3000-OPEN-DEF-RUL-CSR        **'         
092600             PERFORM 9900-SQL-ERROR                                       
092700     END-EVALUATE.                                                        
092800                                                                          
092900******************************************************************        
093000 3200-CLOSE-DEF-RUL-CSR.                                                  
093100                                                                          
093200     EXEC SQL                                                             
093300         CLOSE DEF_RUL_CSR                                                
093400     END-EXEC.                                                            
093500                                                                          
093600     EVALUATE TRUE                                                        
093700         WHEN SQLWARN0 NOT EQUAL SPACE                                    
093800         WHEN SQLCODE NOT EQUAL ZERO                                      
093900             DISPLAY '** ABEND **'                                        
094000             DISPLAY '** PROGRAM = TRKUP015 **'                           
094100             DISPLAY                                                      
094200                 '** PARAGRAPH = 3200-CLOSE-DEF-RUL-CSR'                  
094300             PERFORM 9900-SQL-ERROR                                       
094400     END-EVALUATE.                                                        
094500                                                                          
094600******************************************************************        
094700 3100-FETCH-DEF-RUL-CSR.                                                  
094800                                                                          
094900     EXEC SQL                                                             
095000          FETCH DEF_RUL_CSR                                               
095100           INTO :PV-CONTAINER-ID                                          
095200               ,:PV-VESSEL-NAME-DEF                                       
095300               ,:PV-ETA-DATE                                              
095400     END-EXEC.                                                            
095500                                                                          
095600         EVALUATE TRUE                                                    
095700             WHEN SQLCODE = ZERO                                          
095800                CONTINUE                                                  
095900             WHEN SQLCODE = +100                                          
096000                SET PS-END-OF-DEF-RUL-CSR TO TRUE                         
096100                MOVE SPACES               TO PV-CONTAINER-ID              
096200                                            PV-VESSEL-NAME-DEF            
096300                MOVE '0001-01-01'         TO PV-ETA-DATE                  
096400             WHEN SQLWARN0 NOT EQUAL SPACE                                
096500             WHEN SQLCODE NOT EQUAL ZERO                                  
096600          DISPLAY '**********************************************'        
096700          DISPLAY '** ABEND                                    **'        
096800          DISPLAY '** PROGRAM = TRKUP015                       **'        
096900          DISPLAY '** PARAGRAPH = 7038-FETCH-ENTITY-CUR        **'        
097000          DISPLAY '**********************************************'        
097100          PERFORM 9900-SQL-ERROR                                          
097200         END-EVALUATE.                                                    
097300                                                                          
097400******************************************************************06085900
097500* SELECT DECON SCAC FOR ADJUSTED CONTAINER RULE - CONS           *06086000
097600******************************************************************06086100
097700 3300-DECON-CON-CONT-ADJ.                                                 
097800                                                                  05210000
097900     EXEC SQL                                                             
098000        SELECT DEC.RUL_CNSTR_VAL_TXT                                      
098100        INTO   :PV-DCNSL-SCAC-LONG                                        
098200        FROM   TRT_RUL_CNSTR DEC                                          
098300              ,TRT_RUL_CNSTR CON                                          
098400              ,TRT_RUL_CNSTR ETA                                          
098500              ,TRT_RUL       TR                                           
098600        WHERE DEC.RUL_ID = CON.RUL_ID                                     
098700          AND DEC.RUL_ID = ETA.RUL_ID                                     
098800          AND DEC.RUL_ID = TR.RUL_ID                                      
098900          AND DEC.RUL_CNSTR_TYP_CDE       = 'DECN'                        
099000          AND CON.RUL_CNSTR_TYP_CDE       = 'CONT'                        
099100          AND ETA.RUL_CNSTR_TYP_CDE       = 'ETA'                         
099200          AND CON.RUL_CNSTR_VAL_TXT       = :PV-CONTAINER-ID              
099300          AND DATE(ETA.RUL_CNSTR_VAL_TXT) = :PV-ETA-DATE                  
099400          AND TR.RUL_CDE     = 'CONT'                                     
099500          AND TR.RUL_TYP_CDE = 'ADJ'                                      
099600     END-EXEC                                                             
099700                                                                          
099800     EVALUATE TRUE                                                        
099900         WHEN SQLCODE = ZERO                                              
100000         WHEN SQLCODE = -811                                              
100100             MOVE PV-DCNSL-SCAC-LONG (1:4) TO PV-DCNSL-SCAC               
100200                                                                          
100300         WHEN SQLCODE = +100                                              
100400             MOVE SPACES TO PV-DCNSL-SCAC                                 
100500         WHEN SQLWARN0 NOT EQUAL SPACE                                    
100600         WHEN SQLCODE NOT EQUAL ZERO                                      
100700             DISPLAY '** ABEND **'                                        
100800             DISPLAY '** SQLCODE = ' SQLCODE                              
100900             DISPLAY '** PROGRAM = TRKUP015 **'                           
101000             DISPLAY '** PARAGRAPH = 3300-DECON-CON-CONT-ADJ'             
101100             DISPLAY '** CONT ID  = ' TR004-CONTNR-ID                     
101200             DISPLAY '** ETA TMST = ' PV-VESSEL-ETA-DATE                  
101300             PERFORM 9900-SQL-ERROR                                       
101400     END-EVALUATE.                                                        
101500                                                                          
101600******************************************************************06085900
101700* SELECT DECON SCAC FOR ADJUSTED VESSEL    RULE  - CONS          *06086000
101800******************************************************************06086100
101900 3400-DECON-CON-VSL-ADJ.                                                  
102000                                                                  05210000
102100     EXEC SQL                                                             
102200        SELECT DEC.RUL_CNSTR_VAL_TXT                                      
102300        INTO   :PV-CON-VSL-DCNSL-SCAC                                     
102400        FROM   TRT_RUL_CNSTR DEC                                          
102500              ,TRT_RUL_CNSTR VSL                                          
102600              ,TRT_RUL_CNSTR ETA                                          
102700              ,TRT_RUL       TR                                           
102800        WHERE DEC.RUL_ID = VSL.RUL_ID                                     
102900          AND DEC.RUL_ID = ETA.RUL_ID                                     
103000          AND DEC.RUL_ID = TR.RUL_ID                                      
103100          AND DEC.RUL_CNSTR_TYP_CDE = 'DECN'                              
103200          AND VSL.RUL_CNSTR_TYP_CDE = 'VSL'                               
103300          AND ETA.RUL_CNSTR_TYP_CDE = 'ETA'                               
103400          AND SUBSTR(VSL.RUL_CNSTR_VAL_TXT,1,10)                          
103500                                          = :PV-VESSEL-NAME-DEF           
103600          AND DATE(ETA.RUL_CNSTR_VAL_TXT) = :PV-ETA-DATE                  
103700          AND TR.RUL_CDE     = 'VSL'                                      
103800          AND TR.RUL_TYP_CDE = 'ADJ'                                      
103900     END-EXEC                                                             
104000                                                                          
104100     EVALUATE TRUE                                                        
104200         WHEN SQLCODE = ZERO                                              
104300         WHEN SQLCODE = -811                                              
104400             CONTINUE                                                     
104500         WHEN SQLCODE = +100                                              
104600             MOVE SPACES TO PV-CON-VSL-DCNSL-SCAC                         
104700         WHEN SQLWARN0 NOT EQUAL SPACE                                    
104800         WHEN SQLCODE NOT EQUAL ZERO                                      
104900             DISPLAY '** ABEND **'                                        
105000             DISPLAY '** SQLCODE = ' SQLCODE                              
105100             DISPLAY '** PROGRAM = TRKUP015 **'                           
105200             DISPLAY '** PARAGRAPH = 3400-DECON-CON-VSL-ADJ'              
105300             DISPLAY '** CONT ID  = ' TR004-CONTNR-ID                     
105400             DISPLAY '** VESSEL   = ' PV-VESSEL-ETA-DATE                  
105500             DISPLAY '** ETA      = ' PV-ETA-DATE                         
105600             PERFORM 9900-SQL-ERROR                                       
105700     END-EVALUATE.                                                        
105800                                                                          
105900******************************************************************06085900
106000* SELECT DECON SCAC FOR DEFAULT  CONTAINER RULE                  *06086000
106100******************************************************************06086100
106200 3500-DECON-CON-CONT-DEF.                                                 
106300                                                                  05210000
106400     EXEC SQL                                                             
106500        SELECT DEC.RUL_CNSTR_VAL_TXT                                      
106600              ,VSL.RUL_CNSTR_VAL_TXT                                      
106700        INTO   :PV-DCNSL-SCAC-LONG                                        
106800              ,:PV-VESSEL-NAME-SEL                                        
106900        FROM   TRT_RUL_CNSTR DEC                                          
107000              ,TRT_RUL_CNSTR CON                                          
107100              ,TRT_RUL_CNSTR ETA                                          
107200              ,TRT_RUL_CNSTR VSL                                          
107300              ,TRT_RUL       TR                                           
107400        WHERE DEC.RUL_ID = CON.RUL_ID                                     
107500          AND DEC.RUL_ID = ETA.RUL_ID                                     
107600          AND DEC.RUL_ID = TR.RUL_ID                                      
107700          AND DEC.RUL_ID = VSL.RUL_ID                                     
107800          AND DEC.RUL_CNSTR_TYP_CDE       = 'DECN'                        
107900          AND CON.RUL_CNSTR_TYP_CDE       = 'CONT'                        
108000          AND ETA.RUL_CNSTR_TYP_CDE       = 'ETA'                         
108100          AND VSL.RUL_CNSTR_TYP_CDE       = 'VSL'                         
108200          AND CON.RUL_CNSTR_VAL_TXT       = :PV-CONTAINER-ID              
108300          AND DATE(ETA.RUL_CNSTR_VAL_TXT) = :PV-ETA-DATE                  
108400          AND TR.RUL_CDE     = 'CONT'                                     
108500          AND TR.RUL_TYP_CDE = 'DEF'                                      
108600     END-EXEC                                                             
108700                                                                          
108800     EVALUATE TRUE                                                        
108900         WHEN SQLCODE = ZERO                                              
109000         WHEN SQLCODE = -811                                              
109100             MOVE PV-DCNSL-SCAC-LONG (1:4) TO PV-DCNSL-SCAC               
109200                                                                          
109300         WHEN SQLCODE = +100                                              
109400             MOVE SPACES TO PV-DCNSL-SCAC                                 
109500         WHEN SQLWARN0 NOT EQUAL SPACE                                    
109600         WHEN SQLCODE NOT EQUAL ZERO                                      
109700             DISPLAY '** ABEND **'                                        
109800             DISPLAY '** SQLCODE = ' SQLCODE                              
109900             DISPLAY '** PROGRAM = TRKUP015 **'                           
110000             DISPLAY '** PARAGRAPH = 3500-DECON-CON-CONT-DEF'             
110100             DISPLAY '** CONT ID  = ' TR004-CONTNR-ID                     
110200             DISPLAY '** ETA TMST = ' PV-VESSEL-ETA-DATE                  
110300             PERFORM 9900-SQL-ERROR                                       
110400     END-EVALUATE.                                                        
110500                                                                          
110600******************************************************************03948000
110700 3600-NEW-VESSEL.                                                         
110800                                                                          
110900*    *******************************************                          
111000*    * GET PV-266-BEGIN-DATE & PV-266-END-DATE *                          
111100*    *******************************************                          
111200     MOVE PV-ETA-DATE     TO PV-266-DATE-ENTERED.                         
111300     PERFORM D266-GET-BEGIN-END-DATES.                                    
111400     IF PS-266-ERRORS                                                     
111500        DISPLAY '****** ETA RECORD *******'                               
111600        DISPLAY 'ETA DATE = ' PV-ETA-DATE                                 
111700        PERFORM 9900-SQL-ERROR                                            
111800     END-IF.                                                              
111900                                                                          
112000     MOVE TR004-VESSEL-NAME   TO PV-WHERE-VESSEL.                         
112100     MOVE PV-ETA-DATE         TO PV-WHERE-ETA.                            
112200     PERFORM 7032-SELECT-CMN-VSL-ADJ.                                     
112300                                                                          
112400******************************************************************03948000
112500 4000-SEARCH-ENT-ID.                                              05690000
112600                                                                          
112700      IF PV-HOLD-PO-NBR = 4423278 OR                                    00
112800        PV-PO-NBR      = '4423278'                                        
112900       DISPLAY 'PV-PO-NBR     '  PV-PO-NBR                                
113000       DISPLAY 'PV-HOLD-PO-NBR ' PV-HOLD-PO-NBR                           
113100      END-IF                                                              
113200     SET DEC-IND                   TO 1.                          05710000
113300     SET PS-NOT-END-OF-SEARCH      TO TRUE.                       05720000
113400     PERFORM UNTIL PS-END-OF-SEARCH                               05730000
113500          SEARCH WS-DECONSOL-TABLE-ENTRIES                        05740000
113600              WHEN WS-ENT-ID(DEC-IND) = PV-ENT-ID                 05750000
113700                  SET PS-END-OF-SEARCH TO TRUE                    05760000
113800              WHEN WS-ENT-ID(DEC-IND) = ZEROS OR LOW-VALUES       05770000
113900                  MOVE PV-ENT-ID   TO WS-ENT-ID(DEC-IND)          05780000
114000                  MOVE 'Y'         TO WS-POE-WRITE-IND(DEC-IND)   05790000
114100                  MOVE 'Y'         TO WS-ETA-WRITE-IND(DEC-IND)   05800000
114200                  MOVE 'Y'         TO WS-VES-WRITE-IND(DEC-IND)   05810000
114300                  SET PS-END-OF-SEARCH TO TRUE                    05820000
114400          END-SEARCH                                              05830000
114500     END-PERFORM.                                                 05840000
114600                                                                  05850000
114700 5000-WRITE-POE-ETA-VES-REC.                                      05860000
114800                                                                  05870000
114900     IF WS-POE-WRITE-IND(DEC-IND) = 'Y'                           05880000
115000         MOVE PV-HOLD-POE-REC    TO PV-HOLD-WRITE-REC             05890000
115100         PERFORM 5020-WRITE-OUTPUT-RECORDS                        05900000
115200         MOVE 'N'                TO WS-POE-WRITE-IND(DEC-IND)     05910000
115300     END-IF.                                                      05920000
115400                                                                  05930000
115500     IF WS-ETA-WRITE-IND(DEC-IND) = 'Y'                           05940000
115600         MOVE PV-HOLD-ETA-REC TO PV-HOLD-WRITE-REC                05950000
115700         PERFORM 5020-WRITE-OUTPUT-RECORDS                        05960000
115800         MOVE 'N'                TO WS-ETA-WRITE-IND(DEC-IND)     05970000
115900     END-IF.                                                      05980000
116000                                                                  05990000
116100     IF WS-VES-WRITE-IND(DEC-IND) = 'Y'                           06000000
116200         MOVE PV-HOLD-VES-REC TO PV-HOLD-WRITE-REC                06010000
116300         PERFORM 5020-WRITE-OUTPUT-RECORDS                        06020000
116400         MOVE 'N'                TO WS-VES-WRITE-IND(DEC-IND)     06030000
116500     END-IF.                                                      06040000
116600                                                                  06069400
116700****************************************************************  06069500
116800* WRITE OUTPUT RECORD BASED ON FILE NUMBER                     *  06069600
116900****************************************************************  06069700
117000 5020-WRITE-OUTPUT-RECORDS.                                       06069800
117100     IF PS-WRITE-FILE-1                                           06069900
117200         IF PV-HOLD-WRITE-REC (1:3) = 'ISA'                               
117300            MOVE PV-ENT-ID-FILE-1   TO PV-CONTROL-ENT-ID                  
117400            MOVE PV-CONTROL-RECORD  TO PV-HOLD-WRITE-REC          01920000
117500         END-IF                                                           
117600         WRITE OUTPUT-RECORD1 FROM PV-HOLD-WRITE-REC              06070000
117700     END-IF.                                                      06071000
117800     IF PS-WRITE-FILE-2                                           06072000
117900         IF PV-HOLD-WRITE-REC (1:3) = 'ISA'                               
118000            MOVE PV-ENT-ID-FILE-2   TO PV-CONTROL-ENT-ID                  
118100            MOVE PV-CONTROL-RECORD  TO PV-HOLD-WRITE-REC          01920000
118200         END-IF                                                           
118300         WRITE OUTPUT-RECORD2 FROM PV-HOLD-WRITE-REC              06073000
118400     END-IF.                                                      06073100
118500     IF PS-WRITE-FILE-3                                           06073200
118600         IF PV-HOLD-WRITE-REC (1:3) = 'ISA'                               
118700            MOVE PV-ENT-ID-FILE-3  TO PV-CONTROL-ENT-ID                   
118800            MOVE PV-CONTROL-RECORD TO PV-HOLD-WRITE-REC           01920000
118900         END-IF                                                           
119000         WRITE OUTPUT-RECORD3 FROM PV-HOLD-WRITE-REC              06073300
119100     END-IF.                                                      06073400
119200     IF PS-WRITE-FILE-4                                           06073500
119300         IF PV-HOLD-WRITE-REC (1:3) = 'ISA'                               
119400            MOVE PV-ENT-ID-FILE-4  TO PV-CONTROL-ENT-ID                   
119500            MOVE PV-CONTROL-RECORD TO PV-HOLD-WRITE-REC           01920000
119600         END-IF                                                           
119700         WRITE OUTPUT-RECORD4 FROM PV-HOLD-WRITE-REC              06073600
119800     END-IF.                                                      06073700
119900     IF PS-WRITE-FILE-5                                           06073800
120000         IF PV-HOLD-WRITE-REC (1:3) = 'ISA'                               
120100            MOVE PV-ENT-ID-FILE-5  TO PV-CONTROL-ENT-ID                   
120200            MOVE PV-CONTROL-RECORD TO PV-HOLD-WRITE-REC           01920000
120300         END-IF                                                           
120400         WRITE OUTPUT-RECORD5 FROM PV-HOLD-WRITE-REC              06073900
120500*        PERFORM 5025-WRITE-ADDITIONAL-RECS                               
120600     END-IF.                                                      06074000
120700****************************************************************  06069500
120800* WRITE OUTPUT RECORD BASED ON FILE NUMBER                     *  06069600
120900****************************************************************  06069700
121000 5030-WRITE-EXCEPTION-FILE.                                       06069800
121100                                                                          
121200     INITIALIZE PV-EXCEPTION-REC.                                         
121300                                                                          
121400     EVALUATE TRUE                                                        
121500        WHEN TR004-PROCESS-POE-TRANSMISSION                               
121600           EVALUATE TRUE                                                  
121700              WHEN TR004-REC-TYPE-CDE-CMN                                 
121800                 STRING 'CMN TRANS   DEFAULTED TO '                       
121900                        PV-DEFAULT-VEND-NME                               
122000                 DELIMITED BY SIZE      INTO PV-EXCEPTION-REC             
122100                 WRITE EXCEPTION-RECORD FROM PV-EXCEPTION-REC             
122200                                                                          
122300                 INITIALIZE PV-EXCEPTION-REC                              
122400                 STRING '   CONTAINER = ' PV-CONTAINER-ID                 
122500                 DELIMITED BY SIZE      INTO PV-EXCEPTION-REC             
122600                 WRITE EXCEPTION-RECORD FROM PV-EXCEPTION-REC             
122700                                                                          
122800                 INITIALIZE PV-EXCEPTION-REC                              
122900                 STRING '   ETA       = ' PV-ETA-DATE                     
123000                 DELIMITED BY SIZE      INTO PV-EXCEPTION-REC             
123100                 WRITE EXCEPTION-RECORD FROM PV-EXCEPTION-REC             
123200                                                                          
123300              WHEN TR004-REC-TYPE-CDE-CON                                 
123400                 STRING 'CON TRANS   DEFAULTED TO '                       
123500                        PV-DEFAULT-VEND-NME                               
123600                 DELIMITED BY SIZE      INTO PV-EXCEPTION-REC             
123700                 WRITE EXCEPTION-RECORD FROM PV-EXCEPTION-REC             
123800                                                                          
123900                 INITIALIZE PV-EXCEPTION-REC                              
124000                 STRING '   CONTAINER = ' PV-CONTAINER-ID                 
124100                 DELIMITED BY SIZE      INTO PV-EXCEPTION-REC             
124200                 WRITE EXCEPTION-RECORD FROM PV-EXCEPTION-REC             
124300                                                                          
124400                 INITIALIZE PV-EXCEPTION-REC                              
124500                 STRING '   ETA       = ' PV-ETA-DATE                     
124600                 DELIMITED BY SIZE      INTO PV-EXCEPTION-REC             
124700                 WRITE EXCEPTION-RECORD FROM PV-EXCEPTION-REC             
124800              END-EVALUATE                                                
124900                                                                          
125000        WHEN TR004-PROCESS-POE-RETRANS-CMN                                
125100           STRING 'CMN RETRANS DEFAULTED TO '                             
125200                  PV-DEFAULT-VEND-NME                                     
125300           DELIMITED BY SIZE      INTO PV-EXCEPTION-REC                   
125400           WRITE EXCEPTION-RECORD FROM PV-EXCEPTION-REC                   
125500                                                                          
125600           INITIALIZE PV-EXCEPTION-REC                                    
125700           STRING '   CONTAINER = ' PV-CONTAINER-ID                       
125800           DELIMITED BY SIZE      INTO PV-EXCEPTION-REC                   
125900           WRITE EXCEPTION-RECORD FROM PV-EXCEPTION-REC                   
126000                                                                          
126100           INITIALIZE PV-EXCEPTION-REC                                    
126200           STRING '   ETA       = ' PV-ETA-DATE                           
126300           DELIMITED BY SIZE      INTO PV-EXCEPTION-REC                   
126400           WRITE EXCEPTION-RECORD FROM PV-EXCEPTION-REC                   
126500                                                                          
126600        WHEN TR004-PROCESS-POE-RETRANS-CON                                
126700           STRING 'CON RETRANS DEFAULTED TO '                             
126800                 PV-DEFAULT-VEND-NME                                      
126900           DELIMITED BY SIZE      INTO PV-EXCEPTION-REC                   
127000           WRITE EXCEPTION-RECORD FROM PV-EXCEPTION-REC                   
127100                                                                          
127200           INITIALIZE PV-EXCEPTION-REC                                    
127300           STRING '   PO NUMBER = ' PV-PO-NBR                             
127400           DELIMITED BY SIZE      INTO PV-EXCEPTION-REC                   
127500           WRITE EXCEPTION-RECORD FROM PV-EXCEPTION-REC                   
127600                                                                          
127700     END-EVALUATE.                                                        
127800                                                                          
127900                                                                  06069400
128000****************************************************************  06069700
128100 6000-PROCESS-DETAIL-RECORDS.                                     06092100
128200                                                                  06092200
128300     PERFORM 2500-READ-INPUT-FILE.                                06092300
128400                                                                  06092400
128500     PERFORM UNTIL  PV-DECONSOL-REC-POE  OR                       06092500
128600                    PV-DECONSOL-REC-ETA  OR                       06092600
128700                    PV-DECONSOL-REC-VES  OR                       06092700
128800                    PV-DECONSOL-REC-CMN  OR                       06092800
128900                    PV-DECONSOL-REC-CON  OR                       06092900
129000                    PV-DECONSOL-REC-CTT  OR                       06093000
129100                    PS-END-OF-INPUT-FILE                          06094000
129200         MOVE PV-DECONSOL-RECORD TO  PV-HOLD-WRITE-REC            06095000
129300         IF PV-DECONSOL-REC-PO                                    03510000
129400           IF PV-SAVE-DECONSOL-REC-CON                            03470000
129500               MOVE PV-DECONSOL-RECORD TO TR004-REC-TYPE-PO       03520000
129600               PERFORM 7050-SELECT-TIMPORL                        03870088
129700               EVALUATE TRUE                                              
129800                   WHEN SQLCODE = ZERO                                    
129900                     IF IMPORL-DCONSLR-ENT-ID > 0 AND                     
130000                        IMPORL-DCONSLR-ENT-ID = PV-ENT-ID-COMP            
130100                         CONTINUE                                         
130200                     ELSE                                                 
130300                        PERFORM 7055-UPDATE-TIMPORL               03870088
130400                     END-IF                                               
130500               END-EVALUATE                                               
130600           ELSE                                                           
130700               IF PV-SAVE-DECONSOL-REC-CMN                        03620001
130800                 MOVE PV-DECONSOL-RECORD TO TR004-REC-TYPE-PO     03520000
130900                 IF PV-IMCNRL-SQLCODE-ZERO                        02121288
131000                   IF IMCNRL-DCONSLR-ENT-ID > 0 AND                       
131100                      IMCNRL-DCONSLR-ENT-ID = PV-ENT-ID-COMP              
131200                       CONTINUE                                           
131300                   ELSE                                                   
131400                       MOVE TR004-PO-NBR TO IMCNRL-PO-NBR         05210000
131500                       PERFORM 7065-UPDATE-TIMCNRL                03870088
131600                   END-IF                                                 
131700                 END-IF                                                   
131800             END-IF                                                       
131900           END-IF                                                         
132000         END-IF                                                   03775001
132100         PERFORM 5020-WRITE-OUTPUT-RECORDS                        06099000
132200         PERFORM 2500-READ-INPUT-FILE                             06110000
132300     END-PERFORM.                                                 06120000
132400                                                                          
132500******************************************************************06085900
132600* SELECT TIMPORL ROW                                             *06086000
132700******************************************************************06086100
132800 7050-SELECT-TIMPORL.                                                     
132900     MOVE TR004-PO-NBR        TO IMPORL-PO-NBR                    05210000
133000     EXEC SQL                                                             
133100         SELECT PO_NBR                                                    
133200              , VER_STATUS_CDE                                            
133300              , DCONSLR_ENT_ID                                            
133400         INTO :IMPORL-PO-NBR                                              
133500              ,:IMPORL-VER-STATUS-CDE                                     
133600              ,:IMPORL-DCONSLR-ENT-ID                                     
133700         FROM TIMPORL                                                     
133800         WHERE PO_NBR          = :IMPORL-PO-NBR                           
133900            AND VER_STATUS_CDE = :PC-A                                    
134000     END-EXEC                                                             
134100                                                                          
134200     EVALUATE TRUE                                                        
134300         WHEN SQLCODE = ZERO                                              
134400         WHEN SQLCODE = +100                                              
134500             CONTINUE                                                     
134600                                                                          
134700         WHEN SQLWARN0 NOT EQUAL SPACE                                    
134800         WHEN SQLCODE NOT EQUAL ZERO                                      
134900             DISPLAY '** ABEND **'                                        
135000             DISPLAY '** SQLCODE = ' SQLCODE                              
135100             DISPLAY '** PROGRAM = TRKUP015 **'                           
135200             DISPLAY '** PARAGRAPH = 7050-SELECT-TIMPORL**'               
135300             DISPLAY '** PO NBR = ' IMPORL-PO-NBR                         
135400             DISPLAY '** STATUS = ' IMPORL-VER-STATUS-CDE                 
135500             PERFORM 9900-SQL-ERROR                                       
135600     END-EVALUATE.                                                        
135700                                                                          
135800******************************************************************06085900
135900* UPDATE TIMPORL ROW                                             *06086000
136000******************************************************************06086100
136100 7055-UPDATE-TIMPORL.                                                     
136200                                                                          
136300* IF THERE IS AN ADJUSTMENT (CONTAINER OR VESSEL) ON THIS PO              
136400* THEN THE DCONSLR_ENT_ID WAS SAVED TO UPD THE TIMPORL.                   
136500     IF PS-SCAC-ADJ-FOUND                                                 
136600       MOVE PV-HOLD-ADJ-ENT-ID TO PV-ENT-ID-COMP                          
136700*      DISPLAY 'UPDATE -' PV-ENT-ID-COMP '->' PV-HOLD-ADJ-ENT-ID          
136800     END-IF.                                                              
136900     EXEC SQL                                                             
137000         UPDATE TIMPORL                                                   
137100            SET DCONSLR_ENT_ID  = :PV-ENT-ID-COMP                         
137200         WHERE PO_NBR           = :IMPORL-PO-NBR                          
137300            AND VER_STATUS_CDE  = :PC-A                                   
137400     END-EXEC                                                             
137500                                                                          
137600     EVALUATE TRUE                                                        
137700         WHEN SQLCODE = ZERO                                              
137800             CONTINUE                                                     
137900                                                                          
138000         WHEN SQLWARN0 NOT EQUAL SPACE                                    
138100         WHEN SQLCODE NOT EQUAL ZERO                                      
138200             DISPLAY '** ABEND **'                                        
138300             DISPLAY '** SQLCODE = ' SQLCODE                              
138400             DISPLAY '** PROGRAM = TRKUP015 **'                           
138500             DISPLAY '** PARAGRAPH = 7055-UPDATE-TIMPORL **'              
138600             DISPLAY '** PO NBR = ' IMPORL-PO-NBR                         
138700             DISPLAY '** STATUS = ' IMPORL-VER-STATUS-CDE                 
138800             PERFORM 9900-SQL-ERROR                                       
138900     END-EVALUATE.                                                        
139000                                                                          
139100******************************************************************        
139200* SELECT TIMCNRL ROW                                             *        
139300******************************************************************        
139400 7060-SELECT-TIMCNRL.                                                     
139500     MOVE TR004-CONTNR-ID     TO IMCNRL-CONTNR-ID.                04620000
139600     MOVE TR004-PO-NBR        TO IMCNRL-PO-NBR.                   05210000
139700     SET PV-IMCNRL-SQLCODE-ZERO-NO TO TRUE                                
139800     EXEC SQL                                                             
139900         SELECT  CONTNR_ID                                                
140000                ,CONTNR_SEQ_NBR                                           
140100                ,PO_NBR                                                   
140200                ,DCONSLR_ENT_ID                                           
140300           INTO :IMCNRL-CONTNR-ID                                         
140400               ,:IMCNRL-CONTNR-SEQ-NBR                                    
140500               ,:IMCNRL-PO-NBR                                            
140600               ,:IMCNRL-DCONSLR-ENT-ID                                    
140700           FROM TIMCNRL                                                   
140800          WHERE CONTNR_ID            = :IMCNRL-CONTNR-ID                  
140900            AND PO_NBR               = :IMCNRL-PO-NBR                     
141000     END-EXEC                                                             
141100                                                                          
141200     EVALUATE TRUE                                                        
141300     WHEN SQLCODE = ZERO                                                  
141400         SET PV-IMCNRL-SQLCODE-ZERO TO TRUE                               
141500     WHEN SQLCODE = +100                                                  
141600     WHEN SQLCODE = -811                                                  
141700         CONTINUE                                                         
141800                                                                          
141900     WHEN SQLWARN0 NOT EQUAL SPACE                                        
142000     WHEN SQLCODE NOT EQUAL ZERO                                          
142100         DISPLAY '** ABEND **'                                            
142200         DISPLAY '** SQLCODE = ' SQLCODE                                  
142300         DISPLAY '** PROGRAM = TRKUP015 **'                               
142400         DISPLAY '** PARAGRAPH = 7050-SELECT-TIMCNRL **'                  
142500         DISPLAY '** CONTAINER = ' IMCNRL-CONTNR-ID                       
142600         DISPLAY '** SEQ NBR = ' IMCNRL-CONTNR-SEQ-NBR                    
142700         DISPLAY '** PO-NBR = ' IMCNRL-PO-NBR                             
142800         PERFORM 9900-SQL-ERROR                                           
142900     END-EVALUATE.                                                        
143000                                                                          
143100******************************************************************        
143200* UPDATE TIMCNRL ROW                                             *        
143300******************************************************************        
143400 7065-UPDATE-TIMCNRL.                                                     
143500                                                                          
143600     EXEC SQL                                                             
143700         UPDATE TIMCNRL                                                   
143800            SET                                                           
143900               DCONSLR_ENT_ID       = :PV-ENT-ID-COMP                     
144000          WHERE CONTNR_ID           = :IMCNRL-CONTNR-ID                   
144100            AND CONTNR_SEQ_NBR      = :IMCNRL-CONTNR-SEQ-NBR              
144200            AND PO_NBR              = :IMCNRL-PO-NBR                      
144300     END-EXEC                                                             
144400                                                                          
144500     EVALUATE TRUE                                                        
144600         WHEN SQLCODE = ZERO                                              
144700             CONTINUE                                                     
144800                                                                          
144900         WHEN SQLWARN0 NOT EQUAL SPACE                                    
145000         WHEN SQLCODE NOT EQUAL ZERO                                      
145100             DISPLAY '** ABEND **'                                        
145200             DISPLAY '** SQLCODE = ' SQLCODE                              
145300             DISPLAY '** PROGRAM = TRKUP015 **'                           
145400             DISPLAY '** PARAGRAPH = 7055-UPDATE-TIMCNRL **'              
145500             DISPLAY '** CONTAINER = ' IMCNRL-CONTNR-ID                   
145600             DISPLAY '** SEQ NBR = ' IMCNRL-CONTNR-SEQ-NBR                
145700             DISPLAY '** PO-NBR = ' IMCNRL-PO-NBR                         
145800             PERFORM 9900-SQL-ERROR                                       
145900     END-EVALUATE.                                                        
146000                                                                          
146100******************************************************************06085900
146200* SELECT DECON SCAC FOR ADJUSTED CONTAINER RULE                  *06086000
146300******************************************************************06086100
146400 7031-DECON-CMN-CONT-ADJ.                                                 
146500                                                                  05210000
146600     MOVE SPACES TO PV-DCNSL-SCAC.                                05210000
146700     MOVE TR004-CONTNR-ID TO PV-CONTAINER-ID.                             
146800     STRING PV-VESSEL-ETA-DATE(1:4) '-'                                   
146900            PV-VESSEL-ETA-DATE(5:2) '-'                                   
147000            PV-VESSEL-ETA-DATE(7:2)                                       
147100     DELIMITED BY SIZE  INTO PV-ETA-DATE.                                 
147200                                                                          
147300     EXEC SQL                                                             
147400        SELECT DEC.RUL_CNSTR_VAL_TXT                                      
147500        INTO   :PV-DCNSL-SCAC-LONG                                        
147600        FROM   TRT_RUL_CNSTR DEC                                          
147700              ,TRT_RUL_CNSTR CON                                          
147800              ,TRT_RUL_CNSTR ETA                                          
147900              ,TRT_RUL       TR                                           
148000        WHERE DEC.RUL_ID = CON.RUL_ID                                     
148100          AND DEC.RUL_ID = ETA.RUL_ID                                     
148200          AND DEC.RUL_ID = TR.RUL_ID                                      
148300          AND DEC.RUL_CNSTR_TYP_CDE       = 'DECN'                        
148400          AND CON.RUL_CNSTR_TYP_CDE       = 'CONT'                        
148500          AND ETA.RUL_CNSTR_TYP_CDE       = 'ETA'                         
148600          AND CON.RUL_CNSTR_VAL_TXT       = :PV-CONTAINER-ID              
148700          AND DATE(ETA.RUL_CNSTR_VAL_TXT) = :PV-ETA-DATE                  
148800          AND TR.RUL_CDE     = 'CONT'                                     
148900          AND TR.RUL_TYP_CDE = 'ADJ'                                      
149000     END-EXEC                                                             
149100                                                                          
149200     EVALUATE TRUE                                                        
149300         WHEN SQLCODE = ZERO                                              
149400         WHEN SQLCODE = -811                                              
149500             MOVE PV-DCNSL-SCAC-LONG (1:4) TO PV-DCNSL-SCAC               
149600         WHEN SQLCODE = +100                                              
149700             MOVE SPACES TO PV-DCNSL-SCAC                                 
149800         WHEN SQLWARN0 NOT EQUAL SPACE                                    
149900         WHEN SQLCODE NOT EQUAL ZERO                                      
150000             DISPLAY '** ABEND **'                                        
150100             DISPLAY '** SQLCODE = ' SQLCODE                              
150200             DISPLAY '** PROGRAM = TRKUP015 **'                           
150300             DISPLAY '** PARAGRAPH = 7031-DECON-CMN-CONT-ADJ'             
150400             DISPLAY '** CONT ID  = ' TR004-CONTNR-ID                     
150500             DISPLAY '** ETA TMST = ' PV-VESSEL-ETA-DATE                  
150600             PERFORM 9900-SQL-ERROR                                       
150700     END-EVALUATE.                                                        
150800                                                                          
150900******************************************************************06085900
151000* SELECT DECON SCAC FOR ADJUSTED VESSEL RULE                     *06086000
151100* REMOVED ETA SELECT FOR VESSEL 08/15/2005, OVERRIDE APPLIES     *06086000
151200* TO ALL CONTAINERS REGARDLESS OF ETA.                           *06086000
151300******************************************************************06086100
151400 7032-SELECT-CMN-VSL-ADJ.                                                 
151500                                                                  05210000
151600     MOVE SPACES TO PV-CMN-VSL-DCNSL-SCAC.                                
151700                                                                          
151800     EXEC SQL                                                             
151900        SELECT DECN.RUL_CNSTR_VAL_TXT                                     
152000        INTO   :PV-CMN-VSL-DCNSL-SCAC                                     
152100        FROM   TRT_RUL_CNSTR DECN                                         
152200              ,TRT_RUL_CNSTR VSL                                          
152300              ,TRT_RUL       TR                                           
152400        WHERE TR.RUL_CDE     = 'VSL'                                      
152500          AND TR.RUL_TYP_CDE = 'ADJ'                                      
152600          AND TR.RUL_BEG_DTE = :PV-266-BEGIN-DATE                         
152700          AND TR.RUL_END_DTE = :PV-266-END-DATE                           
152800          AND VSL.RUL_ID     = TR.RUL_ID                                  
152900          AND VSL.RUL_CNSTR_TYP_CDE = 'VSL'                               
153000          AND SUBSTR(VSL.RUL_CNSTR_VAL_TXT,1,10)                          
153100                             = :PV-WHERE-VESSEL                           
153200          AND DECN.RUL_ID    = TR.RUL_ID                                  
153300          AND DECN.RUL_CNSTR_TYP_CDE = 'DECN'                             
153400     END-EXEC                                                             
153500                                                                          
153600     EVALUATE TRUE                                                        
153700         WHEN SQLCODE = ZERO                                              
153800         WHEN SQLCODE = -811                                              
153900             CONTINUE                                                     
154000         WHEN SQLCODE = +100                                              
154100             MOVE SPACES TO PV-CMN-VSL-DCNSL-SCAC                         
154200         WHEN SQLWARN0 NOT EQUAL SPACE                                    
154300         WHEN SQLCODE NOT EQUAL ZERO                                      
154400             DISPLAY '** ABEND **'                                        
154500             DISPLAY '** SQLCODE = ' SQLCODE                              
154600             DISPLAY '** PROGRAM = TRKUP015 **'                           
154700             DISPLAY '** PARAGRAPH = 7032-SELECT-CMN-VSL-ADJ'             
154800             DISPLAY '** VESSEL   = ' PV-WHERE-VESSEL                     
154900             DISPLAY '** ETA TMST = ' PV-VESSEL-ETA-DATE                  
155000             PERFORM 9900-SQL-ERROR                                       
155100     END-EVALUATE.                                                        
155200                                                                          
155300******************************************************************06085900
155400* SELECT DECON SCAC FOR DEFAULT CONTAINER RULE                   *06086000
155500******************************************************************06086100
155600 7033-DECON-CMN-CONT-DEF.                                                 
155700                                                                  05210000
155800     EXEC SQL                                                             
155900        SELECT DEC.RUL_CNSTR_VAL_TXT                                      
156000        INTO   :PV-DCNSL-SCAC-LONG                                        
156100        FROM   TRT_RUL_CNSTR DEC                                          
156200              ,TRT_RUL_CNSTR CON                                          
156300              ,TRT_RUL_CNSTR ETA                                          
156400              ,TRT_RUL       TR                                           
156500        WHERE DEC.RUL_ID = CON.RUL_ID                                     
156600          AND DEC.RUL_ID = ETA.RUL_ID                                     
156700          AND DEC.RUL_ID = TR.RUL_ID                                      
156800          AND DEC.RUL_CNSTR_TYP_CDE       = 'DECN'                        
156900          AND CON.RUL_CNSTR_TYP_CDE       = 'CONT'                        
157000          AND ETA.RUL_CNSTR_TYP_CDE       = 'ETA'                         
157100          AND CON.RUL_CNSTR_VAL_TXT       = :PV-CONTAINER-ID              
157200          AND DATE(ETA.RUL_CNSTR_VAL_TXT) = :PV-ETA-DATE                  
157300          AND TR.RUL_CDE     = 'CONT'                                     
157400          AND TR.RUL_TYP_CDE = 'DEF'                                      
157500     END-EXEC                                                             
157600                                                                          
157700     EVALUATE TRUE                                                        
157800         WHEN SQLCODE = ZERO                                              
157900         WHEN SQLCODE = -811                                              
158000            MOVE PV-DCNSL-SCAC-LONG (1:4) TO PV-DCNSL-SCAC                
158100         WHEN SQLCODE = +100                                              
158200             MOVE SPACES TO PV-DCNSL-SCAC                                 
158300         WHEN SQLWARN0 NOT EQUAL SPACE                                    
158400         WHEN SQLCODE NOT EQUAL ZERO                                      
158500             DISPLAY '** ABEND **'                                        
158600             DISPLAY '** SQLCODE = ' SQLCODE                              
158700             DISPLAY '** PROGRAM = TRKUP015 **'                           
158800             DISPLAY '** PARAGRAPH = 7033-DECON-CMN-CONT-DEF'             
158900             DISPLAY '** CONT ID  = ' TR004-CONTNR-ID                     
159000             DISPLAY '** ETA TMST = ' PV-VESSEL-ETA-DATE                  
159100             PERFORM 9900-SQL-ERROR                                       
159200     END-EVALUATE.                                                        
159300                                                                          
159400******************************************************************06085900
159500* SELECT DECON SCAC FOR ADJUSTED CONTAINER RULE                  *06086000
159600******************************************************************06086100
159700 7034-SELECT-ENTITY-ID.                                                   
159800                                                                  05210000
159900     EXEC SQL                                                             
160000        SELECT ENT_ID                                                     
160100        INTO  :EXTENT-ENT-ID                                              
160200        FROM   TEXTENT                                                    
160300        WHERE  SCAC_CDE = :PV-DCNSL-SCAC                                  
160400     END-EXEC                                                             
160500                                                                          
160600     EVALUATE TRUE                                                        
160700         WHEN SQLCODE = ZERO                                              
160800         WHEN SQLCODE = -811                                              
160900             MOVE EXTENT-ENT-ID TO PV-ENT-ID                              
161000         WHEN SQLCODE = +100                                              
161100             MOVE ZEROES        TO PV-ENT-ID                              
161200         WHEN SQLWARN0 NOT EQUAL SPACE                                    
161300         WHEN SQLCODE NOT EQUAL ZERO                                      
161400             DISPLAY '** ABEND **'                                        
161500             DISPLAY '** SQLCODE = ' SQLCODE                              
161600             DISPLAY '** PROGRAM = TRKUP015 **'                           
161700             DISPLAY '** PARAGRAPH = 7034-SELECT-ENTITY-ID'               
161800             DISPLAY '** CONT ID  = ' TR004-CONTNR-ID                     
161900             DISPLAY '** ETA TMST = ' PV-VESSEL-ETA-DATE                  
162000             PERFORM 9900-SQL-ERROR                                       
162100     END-EVALUATE.                                                        
162200                                                                          
162300******************************************************************06140000
162400*  CLOSE THE FILES.                                              *06150000
162500******************************************************************06160000
162600 8000-CLOSE-FILES.                                                06170000
162700                                                                  06180000
162800     CLOSE   INPUT-FILE                                           06190000
162900             INPUT-ENT-FILE                                       06200000
163000             EXCEPTION-FILE.                                              
163100     CLOSE   OUTPUT-FILE1                                         06210000
163200     MOVE 2 TO PV-OPEN-OUTPUT-FILE-COUNTER                        06220000
163300     IF PV-OPEN-OUTPUT-FILE-COUNTER >                             06230000
163400        PV-HOLD-NUMBER-OF-OUTPUT-FILES                            06240000
163500         CONTINUE                                                 06250000
163600     ELSE                                                         06260000
163700        CLOSE OUTPUT-FILE2                                        06270000
163800     END-IF.                                                      06280000
163900     MOVE 3 TO PV-OPEN-OUTPUT-FILE-COUNTER                        06290000
164000     IF PV-OPEN-OUTPUT-FILE-COUNTER >                             06300000
164100        PV-HOLD-NUMBER-OF-OUTPUT-FILES                            06310000
164200         CONTINUE                                                 06320000
164300     ELSE                                                         06330000
164400        CLOSE OUTPUT-FILE3                                        06340000
164500     END-IF.                                                      06350000
164600     MOVE 4 TO PV-OPEN-OUTPUT-FILE-COUNTER                        06360000
164700     IF PV-OPEN-OUTPUT-FILE-COUNTER >                             06370000
164800        PV-HOLD-NUMBER-OF-OUTPUT-FILES                            06380000
164900         CONTINUE                                                 06390000
165000     ELSE                                                         06400000
165100        CLOSE OUTPUT-FILE4                                        06410000
165200     END-IF.                                                      06420000
165300     MOVE 5 TO PV-OPEN-OUTPUT-FILE-COUNTER                        06430000
165400     IF PV-OPEN-OUTPUT-FILE-COUNTER >                             06440000
165500        PV-HOLD-NUMBER-OF-OUTPUT-FILES                            06450000
165600         CONTINUE                                                 06460000
165700     ELSE                                                         06470000
165800        CLOSE OUTPUT-FILE5                                        06480000
165900     END-IF.                                                      06490000
166000                                                                          
166100******************************************************************        
166200* EXECUTABLE COPYBOOK FOR DATE ROUTINE - D266-GET-BEGIN-END-DATES         
166300******************************************************************        
166400     COPY TRPD266.                                                        
166500                                                                  06500000
166600******************************************************************06510000
166700* SQL WARNING AND ERROR PROCESSING                               *06520000
166800******************************************************************06530000
166900 9900-SQL-ERROR.                                                  06540000
167000                                                                  06550000
167100     MOVE SQLCODE    TO SQLCODE2.                                 06560000
167200     MOVE SQLERRD(3) TO SQLERRD3.                                 06570000
167300     DISPLAY '** ABEND **       ** = SQLERROR'.                   06580000
167400     DISPLAY '** PROGRAM        ** = TRKUP015'.                   06590000
167500     DISPLAY '** PARAGRAPH      ** = ' PV-PARAGRAPH-NAME.         06600000
167600     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  06610000
167700     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  06620000
167800     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   06630000
167900     DISPLAY '**   LERRMC       ** = ' SQLERRMC.                  06640000
168000     MOVE +4013 TO PV-ABEND-CODE.                                 06650000
168100     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         06660000
