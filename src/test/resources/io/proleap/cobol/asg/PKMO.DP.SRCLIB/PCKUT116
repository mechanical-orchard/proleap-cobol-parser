000100******************************************************************00010099
000200 IDENTIFICATION DIVISION.                                         00020099
000300******************************************************************00030099
000400 PROGRAM-ID.    PCKUT116.                                         00040099
000500 AUTHOR.        JIM ARENDT.                                       00050099
000600 DATE-WRITTEN.  FEB, 2018.                                        00060099
000700                                                                  00070099
000800******************************************************************00080099
000900 ENVIRONMENT DIVISION.                                            00090099
001000******************************************************************00100099
001100                                                                  00110099
001200******************************************************************00120099
001300 INPUT-OUTPUT SECTION.                                            00130099
001400******************************************************************00140099
001500                                                                  00150099
001600******************************************************************00160099
001700 FILE-CONTROL.                                                    00170099
001800******************************************************************00180099
001900     SELECT EXTRACT-FILE-IN                                       00190099
002000         ASSIGN TO INP01.                                         00200099
002100                                                                  00210099
002200     SELECT EXTRACT-FILE-OUT                                      00220099
002300         ASSIGN TO OUT01.                                         00230099
002400                                                                  00240099
002500******************************************************************00250099
002600 DATA DIVISION.                                                   00260099
002700******************************************************************00270099
002800                                                                  00280099
002900******************************************************************00290099
003000 FILE SECTION.                                                    00300099
003100******************************************************************00310099
003200                                                                  00320099
003300 FD  EXTRACT-FILE-IN                                              00330099
003400     RECORDING MODE IS F                                          00340099
003500     LABEL RECORDS ARE STANDARD                                   00350099
003600     RECORD CONTAINS 170                                          00360099
003700     BLOCK CONTAINS 0 RECORDS                                     00370099
003800     DATA RECORD IS EXTRACT-RECORD-IN.                            00380099
003900 01  EXTRACT-RECORD-IN                   PIC  X(170).             00390099
004000                                                                  00400099
004100 FD  EXTRACT-FILE-OUT                                             00410099
004200     RECORDING MODE IS F                                          00420099
004300     LABEL RECORDS ARE STANDARD                                   00430099
004400     RECORD CONTAINS 170                                          00440099
004500     BLOCK CONTAINS 0 RECORDS                                     00450099
004600     DATA RECORD IS EXTRACT-RECORD-OUT.                           00460099
004700 01  EXTRACT-RECORD-OUT                  PIC  X(170).             00470099
004800                                                                  00480099
004900******************************************************************00490099
005000 WORKING-STORAGE SECTION.                                         00500099
005100                                                                  00510099
005200 01  ABEND-CODE                          PIC S9(04)  VALUE ZERO   00520099
005300                                                     COMP SYNC.   00530099
005400                                                                  00540099
005500******************************************************************00550099
005600 01  PC-PROGRAM-CONSTANTS.                                        00560099
005700     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        00570099
005800                                                     'PCKUT116'.  00580099
005900                                                                  00590099
006000******************************************************************00600099
006100 01  PV-PROGRAM-VARIABLES.                                        00610099
006110     05  PV-NULL-IND                     PIC S9(04)  VALUE ZERO   00620099
006120                                                     COMP SYNC.   00630099
006200     05  PV-DISP-DEC                     PIC  Z,ZZZ,ZZ9.          00640099
006300     05  PV-SCAN-UNT-COUNT               PIC S9(09)V VALUE ZERO   00650099
006400                                                     COMP-3.      00660099
006500     05  PV-TAG-UNT-COUNT                PIC S9(09)V VALUE ZERO   00670099
006600                                                     COMP-3.      00680099
006700     05  PV-SCAN-CRT-COUNT               PIC S9(09)  VALUE ZERO   00690099
006800                                                     COMP-3.      00700099
006900     05  PV-TAG-CRT-COUNT                PIC S9(09)  VALUE ZERO   00710099
007000                                                     COMP-3.      00720099
007100     05  PV-AGED-DAYS                    PIC S9(05)  VALUE ZERO   00730099
007200                                                     COMP-3.      00740099
007300     05  PV-FIRST-SCAN-DATE              PIC  X(10)  VALUE SPACE. 00750099
007400     05  PV-DATE-IN.                                              00760099
007500         10  PV-DATEI-CC                 PIC  X(02).              00770099
007600         10  PV-DATEI-YY                 PIC  X(02).              00780099
007700         10  FILLER                      PIC  X(01).              00790099
007800         10  PV-DATEI-MM                 PIC  X(02).              00800099
007900         10  FILLER                      PIC  X(01).              00810099
008000         10  PV-DATEI-DD                 PIC  X(02).              00820099
008100     05  PV-DATE-OUT.                                             00830099
008200         10  PV-DATEO-MM                 PIC  X(02).              00840099
008300         10  PV-SLASH1                   PIC  X(01).              00850099
008400         10  PV-DATEO-DD                 PIC  X(02).              00860099
008500         10  PV-SLASH2                   PIC  X(01).              00870099
008600         10  PV-DATEO-CC                 PIC  X(02).              00880099
008700         10  PV-DATEO-YY                 PIC  X(02).              00890099
008800     05  PV-ABEND-PARAGRAPH              PIC  X(30)  VALUE SPACE. 00900099
008900     05  PV-DB2-OPERATION-ATTEMPTED      PIC  X(30)  VALUE SPACE. 00910099
009000     05  PV-DISP-ORD-NBR                 PIC  9(09)  VALUE ZEROS. 00920099
009100     05  PV-DISP-RCVR                    PIC  9(04)  VALUE ZEROS. 00930099
009200     05  PV-DISP-OPER                    PIC  Z(04)  VALUE ZEROS. 00940099
009300     05  PV-DISP-TRIP-ID                 PIC  Z(09)  VALUE ZEROS. 00950099
009400     05  PV-SAVE-OPER-UNT-ID             PIC S9(04)  VALUE ZERO   00960099
009500                                                     COMP.        00970099
009600                                                                  00980099
009700******************************************************************00990099
009800 01  PA-PROGRAM-COUNTERS.                                         01000099
009900     05  PA-READ-COUNT                   PIC  9(07)  VALUE ZERO.  01010099
010000     05  PA-BYPASS-COUNT                 PIC  9(07)  VALUE ZERO.  01020099
010100     05  PA-WRITE-COUNT                  PIC  9(07)  VALUE ZERO.  01030099
010200                                                                  01040099
010300******************************************************************01050099
010400 01  DK-DB2-KEYS.                                                 01060099
010500     05  DK-OPER-UNT-ID                  PIC S9(04)  VALUE ZEROS  01070099
010600                                                     COMP.        01080099
010700     05  DK-ORD-NBR                      PIC S9(09)  VALUE ZEROS  01090099
010800                                                     COMP.        01100099
010900     05  DK-REC-SEQ-NBR                  PIC S9(09)  VALUE ZEROS  01110099
011000                                                     COMP.        01120099
011100     05  DK-TRIP-ID                      PIC S9(09)  VALUE ZEROS  01130099
011200                                                     COMP.        01140099
011300                                                                  01150099
011400******************************************************************01160099
011500 01  PS-PROGRAM-SWITCHES.                                         01170099
011600     05  PS-FIRST-READ-SW                PIC  X(01)  VALUE 'Y'.   01180099
011700         88  PS-FIRST-READ-Y                         VALUE 'Y'.   01190099
011800         88  PS-FIRST-READ-N                         VALUE 'N'.   01200099
011900     05  PS-END-OF-INPUT-SW              PIC  X(01)  VALUE 'N'.   01210099
012000         88  PS-END-OF-INPUT-Y                       VALUE 'Y'.   01220099
012100         88  PS-END-OF-INPUT-N                       VALUE 'N'.   01230099
012200     05  PS-AUTO-CONVEY-LVL-SW           PIC  X(01)  VALUE 'N'.   01240099
012300         88  PS-AUTO-CONVEY-EXCPT-CRTNS              VALUE 'Y'.   01250099
012400                                                                  01260099
012500******************************************************************01270099
012600*  COPY BOOK FOR DB2 FORMATTED MESSAGE AREA                       01280099
012700******************************************************************01290099
012800     COPY DPWS004.                                                01300099
012900                                                                  01310099
013000******************************************************************01320099
013100*  COPY BOOK FOR THE RECEIVER EXTRACT FILE                        01330099
013200******************************************************************01340099
013300     COPY PCRD081.                                                01350099
013400                                                                  01360099
013500******************************************************************01370099
013600*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TRIP TABLE         01380099
013700******************************************************************01390099
013800     EXEC SQL                                                     01400099
013900          INCLUDE TVHTRIP                                         01410099
014000     END-EXEC.                                                    01420099
014100                                                                  01430099
014200******************************************************************01440099
014300*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TPURCHS TABLE      01450099
014400******************************************************************01460099
014500     EXEC SQL                                                     01470099
014600          INCLUDE TPURCHS                                         01480099
014700     END-EXEC.                                                    01490099
014800                                                                  01500099
014900******************************************************************01510099
015000*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TINPKSU TABLE      01520099
015100******************************************************************01530099
015200     EXEC SQL                                                     01540099
015300          INCLUDE TINPKSU                                         01550099
015400     END-EXEC.                                                    01560099
015500                                                                  01570099
015600******************************************************************01580099
015700*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPMENT - RECEIVER01590099
015800*  ASSOCIATION TABLE                                              01600099
015900******************************************************************01610099
016000     EXEC SQL                                                     01620099
016100          INCLUDE TSHPTPO                                         01630099
016200     END-EXEC.                                                    01640099
016300                                                                  01650099
016400******************************************************************01660099
016500*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SUT_OTBND_UPC TABLE01670099
016600******************************************************************01680099
016700     EXEC SQL                                                     01690099
016800          INCLUDE SUT00028                                        01700099
016900     END-EXEC.                                                    01710099
017000                                                                  01720099
017100******************************************************************01730099
017200*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE PARM TABLE         01740099
017300******************************************************************01750099
017400     EXEC SQL                                                     01760099
017500          INCLUDE TKRPRPM                                         01770099
017600     END-EXEC.                                                    01780099
017700                                                                  01790099
017800******************************************************************01800099
017900*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TRIP STATUS TABLE  01810099
018000******************************************************************01820099
018100     EXEC SQL                                                     01830099
018200          INCLUDE TTRIPST                                         01840099
018300     END-EXEC.                                                    01850099
018400                                                                  01860099
018500******************************************************************01870099
018600*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPMENT TABLE     01880099
018700******************************************************************01890099
018800     EXEC SQL                                                     01900099
018900          INCLUDE TSHIPMT                                         01910099
019000     END-EXEC.                                                    01920099
019100                                                                  01930099
019200******************************************************************01940099
019300*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TSHUNLO TABLE      01950099
019400******************************************************************01960099
019500     EXEC SQL                                                     01970099
019600          INCLUDE TSHUNLO                                         01980099
019700     END-EXEC.                                                    01990099
019800                                                                  02000099
019900******************************************************************02010099
020000*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TSHPUNT TABLE      02020099
020100******************************************************************02030099
020200     EXEC SQL                                                     02040099
020300          INCLUDE TSHPUNT                                         02050099
020400     END-EXEC.                                                    02060099
020500                                                                  02070099
020600******************************************************************02080099
020700*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TSHUUPC TABLE      02090099
020800******************************************************************02100099
020900     EXEC SQL                                                     02110099
021000          INCLUDE TSHUUPC                                         02120099
021100     END-EXEC.                                                    02130099
021200                                                                  02140099
021300******************************************************************02150099
021400*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TSULBXF TABLE      02160099
021500******************************************************************02170099
021600     EXEC SQL                                                     02180099
021700          INCLUDE TSULBXF                                         02190099
021800     END-EXEC.                                                    02200099
021900                                                                  02210099
022000******************************************************************02220099
022100*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SUT_OTBND_CART     02230099
022200*  TABLE                                                          02240099
022300******************************************************************02250099
022400     EXEC SQL                                                     02260099
022500          INCLUDE SUT00024                                        02270099
022600     END-EXEC.                                                    02280099
022700                                                                  02290099
022800******************************************************************02300099
022900*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE PACK SLIP TABLE    02310099
023000******************************************************************02320099
023100     EXEC SQL                                                     02330099
023200          INCLUDE TPKSLIP                                         02340099
023300     END-EXEC.                                                    02350099
023400                                                                  02360099
023500******************************************************************02370099
023600*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SUT_PO_AUD_REQ TABL02380099
023700******************************************************************02390099
023800     EXEC SQL                                                     02400099
023900          INCLUDE SUT00015                                        02410099
024000     END-EXEC.                                                    02420099
024100                                                                  02430099
024200******************************************************************02440099
024300*  COMMUNICATION AREAS FOR DB2                                    02450099
024400******************************************************************02460099
024500     EXEC SQL                                                     02470099
024600         INCLUDE SQLCA                                            02480099
024700     END-EXEC.                                                    02490099
024800                                                                  02500099
024900******************************************************************02510099
025000 PROCEDURE DIVISION.                                              02520099
025100******************************************************************02530099
025200 0000-MAINLINE.                                                   02540099
025300                                                                  02550099
025400     PERFORM 1000-INITIALIZE-ROUTINE.                             02560099
025500                                                                  02570099
025600     PERFORM 2000-PROCESS-RTN                                     02580099
025700        UNTIL PS-END-OF-INPUT-Y.                                  02590099
025800                                                                  02600099
025900     PERFORM 9000-EOJ-ROUTINE.                                    02610099
026000                                                                  02620099
026100     GOBACK.                                                      02630099
026200                                                                  02640099
026300******************************************************************02650099
026400 1000-INITIALIZE-ROUTINE.                                         02660099
026500                                                                  02670099
026600     OPEN INPUT  EXTRACT-FILE-IN                                  02680099
026700          OUTPUT EXTRACT-FILE-OUT.                                02690099
026800                                                                  02700099
026900     DISPLAY ' '.                                                 02710099
027000     DISPLAY ' **************************************'.           02720099
027100     DISPLAY '    '   PC-CURRENT-PROGRAM-NAME.                    02730099
027200     DISPLAY ' **************************************'.           02740099
027300                                                                  02750099
027400     PERFORM 1500-READ-EXTRACT-IN.                                02760099
027500                                                                  02770099
027600******************************************************************02780099
027700*  READ INPUT FILE RECORD.                                        02790099
027800******************************************************************02800099
027900 1500-READ-EXTRACT-IN.                                            02810099
028000                                                                  02820099
028100     READ EXTRACT-FILE-IN                                         02830099
028200        INTO PC081-RECEIVER-EXT-RECORD                            02840099
028300          AT END                                                  02850099
028400             SET PS-END-OF-INPUT-Y   TO TRUE                      02860099
028500          NOT AT END                                              02870099
028600             SET PS-FIRST-READ-N     TO TRUE                      02880099
028700             ADD 1                   TO PA-READ-COUNT             02890099
028800             MOVE PC081-CURRENT-OPER TO DK-OPER-UNT-ID            02900099
028900             MOVE PC081-PO-NBR       TO DK-ORD-NBR                02910099
029000             MOVE PC081-REC-SEQ-NBR  TO DK-REC-SEQ-NBR            02920099
029100     END-READ.                                                    02930099
029200                                                                  02940099
029300     IF PS-END-OF-INPUT-Y                                         02950099
029400        IF PS-FIRST-READ-Y                                        02960099
029500            DISPLAY ' '                                           02970099
029600            DISPLAY '---> INPUT FILE EMPTY <---'                  02980099
029700            DISPLAY ' '                                           02990099
029800        END-IF                                                    03000099
029900     END-IF.                                                      03010099
030000                                                                  03020099
030100******************************************************************03030099
030200 2000-PROCESS-RTN.                                                03040099
030300                                                                  03050099
030400     PERFORM 2050-FORMAT-AND-WRITE                                03060099
030500                                                                  03070099
030600     PERFORM 1500-READ-EXTRACT-IN.                                03080099
030700                                                                  03090099
030800******************************************************************03100099
030900 2050-FORMAT-AND-WRITE.                                           03110099
031000                                                                  03120099
031100     IF PC081-AUTO-CONVEY-Y                                       03130099
031200        PERFORM 2500-AUTO-CONVEY-RFD                              03140099
031300        PERFORM 2550-AUTO-CONVEY-RLF                              03150099
031400        MOVE PV-SCAN-CRT-COUNT      TO PC081-ACTUAL-CART-CNT      03160099
031500        COMPUTE PV-SCAN-CRT-COUNT = PV-SCAN-CRT-COUNT             03170099
031600                                  - PV-TAG-CRT-COUNT              03180099
031700        COMPUTE PV-SCAN-UNT-COUNT = PV-SCAN-UNT-COUNT             03190099
031800                                  - PV-TAG-UNT-COUNT              03200099
031900        MOVE PV-SCAN-CRT-COUNT      TO PC081-CARTONS-ON-HOLD      03210099
032000        MOVE PV-SCAN-UNT-COUNT      TO PC081-UNITS-ON-HOLD        03220099
032100     ELSE                                                         03230099
032200        PERFORM 2600-NO-AUTO-RFDC                                 03240099
032300        PERFORM 2650-NO-AUTO-RFDF                                 03250099
032400        MOVE PV-SCAN-CRT-COUNT      TO PC081-ACTUAL-CART-CNT      03260099
032500        COMPUTE PV-SCAN-CRT-COUNT = PV-SCAN-CRT-COUNT             03270099
032600                                  - PV-TAG-CRT-COUNT              03280099
032700        COMPUTE PV-SCAN-UNT-COUNT = PV-SCAN-UNT-COUNT             03290099
032800                                  - PV-TAG-UNT-COUNT              03300099
032900        MOVE PV-SCAN-CRT-COUNT      TO PC081-CARTONS-ON-HOLD      03310099
033000        MOVE PV-SCAN-UNT-COUNT      TO PC081-UNITS-ON-HOLD        03320099
033100     END-IF.                                                      03330099
033200                                                                  03340099
033300     IF  PV-TAG-CRT-COUNT  = 0                                    03350099
033400     AND PV-SCAN-CRT-COUNT = 0                                    03360099
033500         ADD 1                     TO PA-BYPASS-COUNT             03370099
033600     ELSE                                                         03380099
033700         PERFORM 2075-PROCESS-CONTINUE                            03390099
033800     END-IF.                                                      03400099
033900                                                                  03410099
034000******************************************************************03420099
034100 2075-PROCESS-CONTINUE.                                           03430099
034200                                                                  03440099
034300     PERFORM 2300-SELECT-TRIP-INFO.                               03450099
034400     MOVE VHTRIP-TRIP-ID           TO DK-TRIP-ID                  03460099
034500                                      PC081-TRIP-ID.              03470099
034600     MOVE VHTRIP-OWNER-SCAC-ID     TO PC081-SCAC.                 03480099
034700     MOVE VHTRIP-VEH-NBR           TO PC081-TRAILER.              03490099
034800     MOVE TRIPST-STATUS-DTE        TO PV-DATE-IN.                 03500099
034900     MOVE PV-DATEI-CC              TO PV-DATEO-CC.                03510099
035000     MOVE PV-DATEI-YY              TO PV-DATEO-YY.                03520099
035100     MOVE PV-DATEI-MM              TO PV-DATEO-MM.                03530099
035200     MOVE PV-DATEI-DD              TO PV-DATEO-DD.                03540099
035300     MOVE '/'                      TO PV-SLASH1                   03550099
035400                                      PV-SLASH2.                  03560099
035500     MOVE PV-DATE-OUT              TO PC081-TRLR-ARRIVAL-DTE.     03570099
035600                                                                  03580099
035700     PERFORM 2800-RETRIEVE-SCAN-INFO.                             03590099
035800     IF PV-AGED-DAYS > 3                                          03600099
035900        MOVE 'Y'                   TO PC081-AGED-IND              03610099
036000     ELSE                                                         03620099
036100        MOVE 'N'                   TO PC081-AGED-IND              03630099
036200     END-IF.                                                      03640099
036300                                                                  03650099
036400     IF PV-FIRST-SCAN-DATE > SPACES                               03660099
036500        MOVE PV-FIRST-SCAN-DATE    TO PV-DATE-IN                  03670099
036600        MOVE PV-DATEI-CC           TO PV-DATEO-CC                 03680099
036700        MOVE PV-DATEI-YY           TO PV-DATEO-YY                 03690099
036800        MOVE PV-DATEI-MM           TO PV-DATEO-MM                 03700099
036900        MOVE PV-DATEI-DD           TO PV-DATEO-DD                 03710099
037000        MOVE '/'                   TO PV-SLASH1                   03720099
037100                                      PV-SLASH2                   03730099
037200        MOVE PV-DATE-OUT           TO PC081-FIRST-SCAN-DATE       03740099
037300     ELSE                                                         03750099
037400        MOVE SPACES                TO PC081-FIRST-SCAN-DATE       03760099
037500     END-IF.                                                      03770099
037600                                                                  03780099
037700     PERFORM 2900-CHECK-AUDIT-FAIL.                               03790099
037800                                                                  03800099
037900     PERFORM 8000-WRITE-OUTPUT-FILE.                              03810099
038000                                                                  03820099
038100******************************************************************03830099
038200 2100-CHECK-AUTO-CONVEY.                                          03840099
038300                                                                  03850099
038400     MOVE '2100-CHECK-AUTO-CONVEY' TO PV-ABEND-PARAGRAPH.         03860099
038500     MOVE 'GET AUTO CONVEY CODE'   TO PV-DB2-OPERATION-ATTEMPTED. 03870099
038600                                                                  03880099
038700     INITIALIZE DCLTKRPRPM.                                       03890099
038800                                                                  03900099
038900     EXEC SQL                                                     03910099
039000          SELECT FUNC_TXT                                         03920099
039100            INTO :KRPRPM-FUNC-TXT                                 03930099
039200            FROM TKRPRPM                                          03940099
039300           WHERE LOC_ID             = :DK-OPER-UNT-ID             03950099
039400             AND INTFC_SYS_CDE      = 'KHL'                       03960099
039500             AND SYS_PRC_FUNC_CDE   = 'AUTOCY'                    03970099
039600             AND FUNC_PRC_STAT_CDE  = 'AC'                        03980099
039700             AND FUNC_BEG_TMST     <= CURRENT TIMESTAMP           03990099
039800             AND FUNC_END_TMST     >= CURRENT TIMESTAMP           04000099
039900            WITH UR                                               04010099
040000     END-EXEC.                                                    04020099
040100                                                                  04030099
040200     EVALUATE TRUE                                                04040099
040300        WHEN SQLCODE = +0                                         04050099
040400            MOVE KRPRPM-FUNC-TXT      TO PS-AUTO-CONVEY-LVL-SW    04060099
040500                                                                  04070099
040600        WHEN OTHER                                                04080099
040700            DISPLAY 'ERROR OPER-ID= '    PC081-CURRENT-OPER       04090099
040800            PERFORM 9100-SQL-ABEND                                04100099
040900     END-EVALUATE.                                                04110099
041000                                                                  04120099
041100******************************************************************04130099
041200 2300-SELECT-TRIP-INFO.                                           04140099
041300                                                                  04150099
041400     MOVE '2300-SELECT-TRIP-INFO' TO PV-ABEND-PARAGRAPH.          04160099
041500     MOVE 'SELECT TRIP INFO'      TO PV-DB2-OPERATION-ATTEMPTED.  04170099
041600                                                                  04180099
041700     INITIALIZE DCLTVHTRIP.                                       04190099
041800                                                                  04200099
041900     EXEC SQL                                                     04210099
042000         SELECT DISTINCT A.TRIP_ID                                04220099
042100               ,A.OWNER_SCAC_ID                                   04230099
042200               ,A.VEH_NBR                                         04240099
042300               ,B.STATUS_DTE                                      04250099
042400           INTO :VHTRIP-TRIP-ID                                   04260099
042500               ,:VHTRIP-OWNER-SCAC-ID                             04270099
042600               ,:VHTRIP-VEH-NBR                                   04280099
042700               ,:TRIPST-STATUS-DTE                                04290099
042800           FROM TVHTRIP   A                                       04300099
042900               ,TTRIPST   B                                       04310099
043000               ,TSHIPMT   E                                       04320099
043100               ,TSHPTPO   F                                       04330099
043200          WHERE F.PO_NBR          = :DK-ORD-NBR                   04340099
043300            AND F.REC_SEQ_NBR     = :DK-REC-SEQ-NBR               04350099
043400            AND B.OPER_UNT_ID     = :DK-OPER-UNT-ID               04360099
043500            AND A.TRIP_ID         = B.TRIP_ID                     04370099
043600            AND B.TRIP_STATUS_CDE = 'AR'                          04380099
043700            AND A.TRIP_ID         = E.TRIP_ID                     04390099
043800            AND E.SHIPT_ID        = F.SHIPT_ID                    04400099
043900           WITH UR                                                04410099
044000     END-EXEC.                                                    04420099
044100                                                                  04430099
044200     EVALUATE TRUE                                                04440099
044300         WHEN SQLCODE = +0                                        04450099
044400             CONTINUE                                             04460099
044500                                                                  04470099
044600         WHEN SQLCODE = +100                                      04480099
044610              PERFORM 2310-SELECT-CURR-TRIP-INFO                  04490099
044620                                                                  04500099
044700         WHEN SQLCODE < ZERO                                      04510099
044800         WHEN SQLCODE > ZERO                                      04520099
044900         WHEN SQLWARN0 NOT = SPACE                                04530099
045000             MOVE DK-ORD-NBR           TO PV-DISP-ORD-NBR         04540099
045100             MOVE DK-REC-SEQ-NBR       TO PV-DISP-RCVR            04550099
045200             MOVE DK-OPER-UNT-ID       TO PV-DISP-OPER            04560099
045300             DISPLAY ' ERROR PO-NBR  = '  PV-DISP-ORD-NBR         04570099
045400             DISPLAY ' ERROR SEQ-NBR = '  PV-DISP-RCVR            04580099
045500             DISPLAY ' ERROR OPER-ID = '  PV-DISP-OPER            04590099
045600             PERFORM 9100-SQL-ABEND                               04600099
045700     END-EVALUATE.                                                04610099
045800                                                                  04620099
045810 2310-SELECT-CURR-TRIP-INFO.                                      04630099
045820                                                                  04640099
045830     MOVE '2310-SELECT-TRIP-INFO' TO PV-ABEND-PARAGRAPH.          04650099
045840     MOVE 'SELECT TRIP INFO'      TO PV-DB2-OPERATION-ATTEMPTED.  04660099
045850                                                                  04670099
045860     INITIALIZE DCLTVHTRIP.                                       04680099
045870                                                                  04690099
045880     EXEC SQL                                                     04700099
045890         SELECT DISTINCT A.TRIP_ID                                04710099
045891               ,A.OWNER_SCAC_ID                                   04720099
045892               ,A.VEH_NBR                                         04730099
045893               ,B.STATUS_DTE                                      04740099
045894           INTO :VHTRIP-TRIP-ID                                   04750099
045895               ,:VHTRIP-OWNER-SCAC-ID                             04760099
045896               ,:VHTRIP-VEH-NBR                                   04770099
045897               ,:TRIPST-STATUS-DTE                                04780099
045898           FROM TVHTRIP   A                                       04790099
045899               ,TTRIPST   B                                       04800099
045900               ,TSHIPMT   E                                       04810099
045901               ,TSHPTPO   F                                       04820099
045902          WHERE F.PO_NBR          = :DK-ORD-NBR                   04830099
045903            AND F.REC_SEQ_NBR     = :DK-REC-SEQ-NBR               04840099
045905            AND A.TRIP_ID         = B.TRIP_ID                     04850099
045906            AND B.TRIP_STATUS_CDE = 'AR'                          04860099
045907            AND A.TRIP_ID         = E.TRIP_ID                     04870099
045908            AND E.SHIPT_ID        = F.SHIPT_ID                    04880099
045909           WITH UR                                                04890099
045910     END-EXEC.                                                    04900099
045911                                                                  04910099
045912     EVALUATE TRUE                                                04920099
045913         WHEN SQLCODE = +0                                        04930099
045914             CONTINUE                                             04940099
045915                                                                  04950099
045916         WHEN SQLCODE = +100                                      04960099
045917              PERFORM 2320-SELECT-CURR-TRIP-INFO2                 04970099
045918                                                                  04980099
045919         WHEN SQLCODE < ZERO                                      04990099
045920         WHEN SQLCODE > ZERO                                      05000099
045921         WHEN SQLWARN0 NOT = SPACE                                05010099
045922             MOVE DK-ORD-NBR           TO PV-DISP-ORD-NBR         05020099
045923             MOVE DK-REC-SEQ-NBR       TO PV-DISP-RCVR            05030099
045924             MOVE DK-OPER-UNT-ID       TO PV-DISP-OPER            05040099
045925             DISPLAY ' ERROR PO-NBR  = '  PV-DISP-ORD-NBR         05050099
045926             DISPLAY ' ERROR SEQ-NBR = '  PV-DISP-RCVR            05060099
045927             DISPLAY ' ERROR OPER-ID = '  PV-DISP-OPER            05070099
045928             PERFORM 9100-SQL-ABEND                               05080099
045929     END-EVALUATE.                                                05090099
045930                                                                  05100099
045931 2320-SELECT-CURR-TRIP-INFO2.                                     05110099
045932                                                                  05120099
045933     MOVE '2320-SELECT-CURR-TRIP-INFO2' TO PV-ABEND-PARAGRAPH.    05130099
045934     MOVE 'SELECT EN TRIP INFO'   TO PV-DB2-OPERATION-ATTEMPTED.  05140099
045935                                                                  05150099
045936     INITIALIZE DCLTVHTRIP.                                       05160099
045937                                                                  05170099
045938     EXEC SQL                                                     05180099
045939         SELECT DISTINCT A.TRIP_ID                                05190099
045940               ,A.OWNER_SCAC_ID                                   05200099
045950               ,A.VEH_NBR                                         05210099
045951               ,B.STATUS_DTE                                      05220099
045952           INTO :VHTRIP-TRIP-ID                                   05230099
045953               ,:VHTRIP-OWNER-SCAC-ID                             05240099
045954               ,:VHTRIP-VEH-NBR     :PV-NULL-IND                  05250099
045955               ,:TRIPST-STATUS-DTE                                05260099
045956           FROM TVHTRIP   A                                       05270099
045957               ,TTRIPST   B                                       05280099
045958               ,TSHIPMT   E                                       05290099
045959               ,TSHPTPO   F                                       05300099
045960          WHERE F.PO_NBR          = :DK-ORD-NBR                   05310099
045961            AND F.REC_SEQ_NBR     = :DK-REC-SEQ-NBR               05320099
045962            AND B.OPER_UNT_ID     = :DK-OPER-UNT-ID               05330099
045963            AND A.TRIP_ID         = B.TRIP_ID                     05340099
045964            AND B.TRIP_STATUS_CDE = 'EN'                          05350099
045965            AND A.TRIP_ID         = E.TRIP_ID                     05360099
045966            AND E.SHIPT_ID        = F.SHIPT_ID                    05370099
045967           WITH UR                                                05380099
045968     END-EXEC.                                                    05390099
045969                                                                  05400099
045970     EVALUATE TRUE                                                05410099
045971         WHEN SQLCODE = +0                                        05420099
045973             IF PV-NULL-IND < +0                                  05430099
045974                MOVE 'NO TRAILER'       TO VHTRIP-VEH-NBR         05440099
045975             END-IF                                               05450099
045976*            CONTINUE                                             05460099
045977                                                                  05470099
045978         WHEN SQLCODE = +100                                      05480099
045979              MOVE 0            TO VHTRIP-TRIP-ID                 05490099
045980              MOVE 'NONE'       TO VHTRIP-OWNER-SCAC-ID           05500099
045981              MOVE 'UNKNOWN'    TO VHTRIP-VEH-NBR                 05510099
045982              MOVE '0001-01-01' TO TRIPST-STATUS-DTE              05520099
045983                                                                  05530099
045984         WHEN SQLCODE < ZERO                                      05540099
045985         WHEN SQLCODE > ZERO                                      05550099
045986         WHEN SQLWARN0 NOT = SPACE                                05560099
045987             MOVE DK-ORD-NBR           TO PV-DISP-ORD-NBR         05570099
045988             MOVE DK-REC-SEQ-NBR       TO PV-DISP-RCVR            05580099
045989             MOVE DK-OPER-UNT-ID       TO PV-DISP-OPER            05590099
045990             DISPLAY ' ERROR PO-NBR  = '  PV-DISP-ORD-NBR         05600099
045991             DISPLAY ' ERROR SEQ-NBR = '  PV-DISP-RCVR            05610099
045992             DISPLAY ' ERROR OPER-ID = '  PV-DISP-OPER            05620099
045993             PERFORM 9100-SQL-ABEND                               05630099
045994     END-EVALUATE.                                                05640099
045995******************************************************************05650099
046000*QUERY TO RETURN ALL PROMPTED DIRECTIVE CARTONS (AUTO DC) 'RFD'   05660099
046100******************************************************************05670099
046200 2500-AUTO-CONVEY-RFD.                                            05680099
046300                                                                  05690099
046400     MOVE '2500-AUTO-CONVEY-RFD'   TO PV-ABEND-PARAGRAPH.         05700099
046500     MOVE 'GET RFD COUNTS'         TO PV-DB2-OPERATION-ATTEMPTED. 05710099
046600                                                                  05720099
046700     MOVE ZEROES                   TO PV-SCAN-CRT-COUNT           05730099
046800                                      PV-SCAN-UNT-COUNT.          05740099
046900                                                                  05750099
047000     EXEC SQL                                                     05760099
047100        SELECT SUM(CRTNS) AS COH                                  05770099
047200              ,SUM(UNITS) AS UOH                                  05780099
047300          INTO :PV-SCAN-CRT-COUNT                                 05790099
047400              ,:PV-SCAN-UNT-COUNT                                 05800099
047500          FROM (SELECT COUNT(DISTINCT A.BRCDE_NBR) AS CRTNS       05810099
047600                 ,SUM(D.SHPD_UNT_QTY) AS UNITS                    05820099
047700            FROM SUT_CART_DIRV_TRKG A                             05830099
047800                ,SUT_OTBND_UPC      D                             05840099
047900           WHERE A.PO_NBR        = :DK-ORD-NBR                    05850099
048000             AND A.RCVR_SEQ_NBR  = :DK-REC-SEQ-NBR                05860099
048100             AND A.DIRV_RSN_CDE  = 'RFD'                          05870099
048200             AND A.SHIPT_UNT_ID  > 0                              05880099
048300             AND A.SHIPT_UNT_ID  = D.SHIPT_UNT_ID                 05890099
048400    UNION                                                         05900099
048500        SELECT COUNT(DISTINCT A.BRCDE_NBR) AS CRTNS               05910099
048600              ,SUM(C.SHPD_QTY) AS UNITS                           05920099
048700          FROM SUT_CART_DIRV_TRKG A                               05930099
048800              ,TSULBXF            B                               05940099
048900              ,TSHUUPC            C                               05950099
049000         WHERE A.PO_NBR       = :DK-ORD-NBR                       05960099
049100           AND A.RCVR_SEQ_NBR = :DK-REC-SEQ-NBR                   05970099
049200           AND A.DIRV_RSN_CDE = 'RFD'                             05980099
049300           AND A.BRCDE_NBR    = B.BRCDE_NBR                       05990099
049400           AND B.SHIPT_UNT_ID = C.SHIPT_UNT_ID                    06000099
049500           AND A.PO_NBR       = C.TRN_NBR                         06010099
049600           AND B.CART_LBL_TYP_CDE = 'P' ) X                       06020099
049700         WITH UR                                                  06030099
049800     END-EXEC.                                                    06040099
049900                                                                  06050099
050000     EVALUATE TRUE                                                06060099
050100          WHEN SQLCODE = +0                                       06070099
050200              CONTINUE                                            06080099
050300                                                                  06090099
050400          WHEN SQLCODE = +100                                     06100099
050500              MOVE ZEROES               TO PV-SCAN-CRT-COUNT      06110099
050600                                           PV-SCAN-UNT-COUNT      06120099
050700                                                                  06130099
050800          WHEN SQLCODE = -305                                     06140099
050900              MOVE ZEROES               TO PV-SCAN-UNT-COUNT      06150099
051000                                                                  06160099
051100          WHEN OTHER                                              06170099
051200              MOVE DK-ORD-NBR           TO PV-DISP-ORD-NBR        06180099
051300              MOVE DK-REC-SEQ-NBR       TO PV-DISP-RCVR           06190099
051400              MOVE DK-OPER-UNT-ID       TO PV-DISP-OPER           06200099
051500              DISPLAY ' ERROR PO-NBR  = '  PV-DISP-ORD-NBR        06210099
051600              DISPLAY ' ERROR SEQ-NBR = '  PV-DISP-RCVR           06220099
051700              DISPLAY ' ERROR OPER-ID = '  PV-DISP-OPER           06230099
051800              PERFORM 9100-SQL-ABEND                              06240099
051900     END-EVALUATE.                                                06250099
052000                                                                  06260099
052100******************************************************************06270099
052200* QUERY TO RETURN ALL TAGGED CARTONS (AUTO DC)  REASON 'RLF'      06280099
052300******************************************************************06290099
052400 2550-AUTO-CONVEY-RLF.                                            06300099
052500                                                                  06310099
052600     MOVE '2550-AUTO-CONVEY-RLF'    TO PV-ABEND-PARAGRAPH.        06320099
052700     MOVE 'GET RLF COUNTS'          TO PV-DB2-OPERATION-ATTEMPTED.06330099
052800                                                                  06340099
052900     MOVE ZEROES                    TO PV-TAG-CRT-COUNT           06350099
053000                                       PV-TAG-UNT-COUNT.          06360099
053100                                                                  06370099
053200     EXEC SQL                                                     06380099
053300       SELECT SUM(CRTNS) AS COH                                   06390099
053400             ,SUM(UNITS) AS UOH                                   06400099
053500         INTO :PV-TAG-CRT-COUNT                                   06410099
053600             ,:PV-TAG-UNT-COUNT                                   06420099
053700         FROM (SELECT COUNT(DISTINCT A.BRCDE_NBR) AS CRTNS        06430099
053800                     ,SUM(D.SHPD_UNT_QTY)         AS UNITS        06440099
053900                 FROM SUT_CART_DIRV_TRKG A                        06450099
054000                     ,SUT_OTBND_UPC      D                        06460099
054100                WHERE A.PO_NBR         = :DK-ORD-NBR              06470099
054200                  AND A.RCVR_SEQ_NBR   = :DK-REC-SEQ-NBR          06480099
054300                  AND A.DIRV_RSN_CDE   = 'RLF'                    06490099
054400                  AND A.SHIPT_UNT_ID   > 0                        06500099
054500                  AND D.SHIPT_UNT_ID   = A.SHIPT_UNT_ID           06510099
054600    UNION                                                         06520099
054700       SELECT COUNT(DISTINCT A.BRCDE_NBR) AS CRTNS                06530099
054800             ,SUM(C.SHPD_QTY)             AS UNITS                06540099
054900         FROM SUT_CART_DIRV_TRKG A                                06550099
055000             ,TSULBXF            B                                06560099
055100             ,TSHUUPC            C                                06570099
055200        WHERE A.PO_NBR       = :DK-ORD-NBR                        06580099
055300          AND A.RCVR_SEQ_NBR = :DK-REC-SEQ-NBR                    06590099
055400          AND A.DIRV_RSN_CDE = 'RLF'                              06600099
055500          AND A.BRCDE_NBR    = B.BRCDE_NBR                        06610099
055600          AND B.SHIPT_UNT_ID = C.SHIPT_UNT_ID                     06620099
055700          AND A.PO_NBR       = C.TRN_NBR                          06630099
055800          AND B.CART_LBL_TYP_CDE = 'P' ) X                        06640099
055900         WITH UR                                                  06650099
056000     END-EXEC.                                                    06660099
056100                                                                  06670099
056200     EVALUATE TRUE                                                06680099
056300          WHEN SQLCODE = +0                                       06690099
056400              CONTINUE                                            06700099
056500                                                                  06710099
056600          WHEN SQLCODE = -305                                     06720099
056700              MOVE ZEROES               TO PV-TAG-UNT-COUNT       06730099
056800                                                                  06740099
056900          WHEN SQLCODE = +100                                     06750099
057000              MOVE ZEROES               TO PV-TAG-CRT-COUNT       06760099
057100                                           PV-TAG-UNT-COUNT       06770099
057200                                                                  06780099
057300          WHEN OTHER                                              06790099
057400              MOVE DK-ORD-NBR           TO PV-DISP-ORD-NBR        06800099
057500              MOVE DK-REC-SEQ-NBR       TO PV-DISP-RCVR           06810099
057600              MOVE DK-OPER-UNT-ID       TO PV-DISP-OPER           06820099
057700              DISPLAY ' ERROR PO-NBR  = '  PV-DISP-ORD-NBR        06830099
057800              DISPLAY ' ERROR SEQ-NBR = '  PV-DISP-RCVR           06840099
057900              DISPLAY ' ERROR OPER-ID = '  PV-DISP-OPER           06850099
058000              PERFORM 9100-SQL-ABEND                              06860099
058100     END-EVALUATE.                                                06870099
058200                                                                  06880099
058300******************************************************************06890099
058400*QUERY TO RETURN ALL PROMPTED CARTONS (NO AUTO DC)  'RFDC'        06900099
058500******************************************************************06910099
058600 2600-NO-AUTO-RFDC.                                               06920099
058700                                                                  06930099
058800     MOVE '2600-NO-AUTO-RFDC'       TO PV-ABEND-PARAGRAPH.        06940099
058900     MOVE 'GET RFDC COUNTS'         TO PV-DB2-OPERATION-ATTEMPTED.06950099
059000                                                                  06960099
059100     MOVE ZEROES                    TO PV-SCAN-CRT-COUNT          06970099
059200                                       PV-SCAN-UNT-COUNT.         06980099
059300                                                                  06990099
059400     EXEC SQL                                                     07000099
059500       SELECT COUNT(DISTINCT A.SHIPT_UNT_ID) AS CRTNS             07010099
059600             ,SUM(C.SHPD_QTY )               AS UNITS             07020099
059700         INTO :PV-SCAN-CRT-COUNT                                  07030099
059800             ,:PV-SCAN-UNT-COUNT                                  07040099
059900         FROM TSHUNLO A                                           07050099
060000             ,TSHPUNT B                                           07060099
060100             ,TSHUUPC C                                           07070099
060200             ,TSULBXF D                                           07080099
060300             ,TPURCHS E                                           07090099
060400             ,TINPKSU F                                           07100099
060500             ,TPKSLIP G                                           07110099
060600        WHERE G.PO_NBR         = :DK-ORD-NBR                      07120099
060700          AND G.REC_SEQ_NBR    = :DK-REC-SEQ-NBR                  07130099
060800          AND G.VER_STAT_CDE   = 'A'                              07140099
060900          AND G.PKSL_STAT_CDE  = 'AC'                             07150099
061000          AND G.PO_NBR         = E.PO_NBR                         07160099
061100          AND C.TRN_NBR        = E.PO_NBR                         07170099
061200          AND E.VER_STATUS_CDE = 'A'                              07180099
061300          AND A.SHIPT_UNT_ID   = B.SHIPT_UNT_ID                   07190099
061400          AND B.SHIPT_UNT_ID   = C.SHIPT_UNT_ID                   07200099
061500          AND B.SHIPT_UNT_ID   = D.SHIPT_UNT_ID                   07210099
061600          AND B.SHIPT_UNT_ID   = F.SHIPT_UNT_ID                   07220099
061700          AND A.TRIP_ID        = 999999999                        07230099
061800          AND A.SCN_LOC_ID     = 'RFDC'                           07240099
061900          AND F.SEQ_NBR        = G.SEQ_NBR                        07250099
062000         WITH UR                                                  07260099
062100     END-EXEC.                                                    07270099
062200                                                                  07280099
062300     EVALUATE TRUE                                                07290099
062400          WHEN SQLCODE = +0                                       07300099
062500              CONTINUE                                            07310099
062600                                                                  07320099
062700          WHEN SQLCODE = -305                                     07330099
062800              MOVE ZEROES               TO PV-SCAN-UNT-COUNT      07340099
062900                                                                  07350099
063000          WHEN SQLCODE = +100                                     07360099
063100              MOVE ZEROES               TO PV-SCAN-CRT-COUNT      07370099
063200                                           PV-SCAN-UNT-COUNT      07380099
063300                                                                  07390099
063400          WHEN OTHER                                              07400099
063500              MOVE DK-ORD-NBR           TO PV-DISP-ORD-NBR        07410099
063600              MOVE DK-REC-SEQ-NBR       TO PV-DISP-RCVR           07420099
063700              MOVE DK-OPER-UNT-ID       TO PV-DISP-OPER           07430099
063800              DISPLAY ' ERROR PO-NBR  = '  PV-DISP-ORD-NBR        07440099
063900              DISPLAY ' ERROR SEQ-NBR = '  PV-DISP-RCVR           07450099
064000              DISPLAY ' ERROR OPER-ID = '  PV-DISP-OPER           07460099
064100              PERFORM 9100-SQL-ABEND                              07470099
064200     END-EVALUATE.                                                07480099
064300                                                                  07490099
064400******************************************************************07500099
064500*QUERY TO RETURN ALL TAGGED CARTONS (NO AUTO DC)  'RFDF'          07510099
064600******************************************************************07520099
064700 2650-NO-AUTO-RFDF.                                               07530099
064800                                                                  07540099
064900     MOVE '2650-NO-AUTO-RFDF'       TO PV-ABEND-PARAGRAPH.        07550099
065000     MOVE 'GET RFDF COUNTS'         TO PV-DB2-OPERATION-ATTEMPTED.07560099
065100                                                                  07570099
065200     MOVE ZEROES                    TO PV-TAG-CRT-COUNT           07580099
065300                                       PV-TAG-UNT-COUNT.          07590099
065400                                                                  07600099
065500     EXEC SQL                                                     07610099
065600       SELECT COUNT(DISTINCT A.SHIPT_UNT_ID) AS CRTNS             07620099
065700             ,SUM(C.SHPD_QTY)                AS UNITS             07630099
065800         INTO :PV-TAG-CRT-COUNT                                   07640099
065900             ,:PV-TAG-UNT-COUNT                                   07650099
066000         FROM TSHUNLO A                                           07660099
066100             ,TSHPUNT B                                           07670099
066200             ,TSHUUPC C                                           07680099
066300             ,TSULBXF D                                           07690099
066400             ,TPURCHS E                                           07700099
066500             ,TINPKSU F                                           07710099
066600             ,TPKSLIP G                                           07720099
066700        WHERE G.PO_NBR         = :DK-ORD-NBR                      07730099
066800          AND G.REC_SEQ_NBR    = :DK-REC-SEQ-NBR                  07740099
066900          AND G.VER_STAT_CDE   = 'A'                              07750099
067000          AND G.PKSL_STAT_CDE  = 'AC'                             07760099
067100          AND G.PO_NBR         = E.PO_NBR                         07770099
067200          AND F.SEQ_NBR        = G.SEQ_NBR                        07780099
067300          AND A.SHIPT_UNT_ID   = B.SHIPT_UNT_ID                   07790099
067400          AND B.SHIPT_UNT_ID   = C.SHIPT_UNT_ID                   07800099
067500          AND B.SHIPT_UNT_ID   = D.SHIPT_UNT_ID                   07810099
067600          AND B.SHIPT_UNT_ID   = F.SHIPT_UNT_ID                   07820099
067700          AND A.TRIP_ID        = 999999999                        07830099
067800          AND A.SCN_LOC_ID     = 'RFDF'                           07840099
067900          AND C.TRN_NBR        = E.PO_NBR                         07850099
068000          AND E.VER_STATUS_CDE = 'A'                              07860099
068100         WITH UR                                                  07870099
068200     END-EXEC.                                                    07880099
068300                                                                  07890099
068400     EVALUATE TRUE                                                07900099
068500          WHEN SQLCODE = +0                                       07910099
068600              CONTINUE                                            07920099
068700                                                                  07930099
068800          WHEN SQLCODE = -305                                     07940099
068900              MOVE ZEROES               TO PV-TAG-UNT-COUNT       07950099
069000                                                                  07960099
069100          WHEN SQLCODE = +100                                     07970099
069200              MOVE ZEROES               TO PV-TAG-CRT-COUNT       07980099
069300                                           PV-TAG-UNT-COUNT       07990099
069400                                                                  08000099
069500          WHEN OTHER                                              08010099
069600              MOVE DK-ORD-NBR           TO PV-DISP-ORD-NBR        08020099
069700              MOVE DK-REC-SEQ-NBR       TO PV-DISP-RCVR           08030099
069800              MOVE DK-OPER-UNT-ID       TO PV-DISP-OPER           08040099
069900              DISPLAY ' ERROR PO-NBR  = '  PV-DISP-ORD-NBR        08050099
070000              DISPLAY ' ERROR SEQ-NBR = '  PV-DISP-RCVR           08060099
070100              DISPLAY ' ERROR OPER-ID = '  PV-DISP-OPER           08070099
070200              PERFORM 9100-SQL-ABEND                              08080099
070300     END-EVALUATE.                                                08090099
070400                                                                  08100099
070500******************************************************************08110099
070600 2800-RETRIEVE-SCAN-INFO.                                         08120099
070700                                                                  08130099
070800     MOVE '2800-RETRIEVE-SCAN-INFO' TO PV-ABEND-PARAGRAPH.        08140099
070900     MOVE 'GET SCAN DATA'           TO PV-DB2-OPERATION-ATTEMPTED.08150099
071000                                                                  08160099
071100     MOVE ZEROES                    TO PV-AGED-DAYS.              08170099
071200     MOVE SPACES                    TO PV-FIRST-SCAN-DATE.        08180099
071300                                                                  08190099
071400     EXEC SQL                                                     08200099
071500       SELECT DAYS(CURRENT TIMESTAMP) - DAYS(MIN(A.CRE_TMST))     08210099
071600                                    AS AGEDDAYS                   08220099
071700             ,MIN(DATE(A.CRE_TMST)) AS FIRSTSCAN                  08230099
071800         INTO :PV-AGED-DAYS                                       08240099
071900             ,:PV-FIRST-SCAN-DATE                                 08250099
072000         FROM TSHUNLO A                                           08260099
072100             ,TINPKSU F                                           08270099
072200             ,TPKSLIP G                                           08280099
072300        WHERE G.PO_NBR         = :DK-ORD-NBR                      08290099
072400          AND G.REC_SEQ_NBR    = :DK-REC-SEQ-NBR                  08300099
072500          AND G.VER_STAT_CDE   = 'A'                              08310099
072600          AND G.PKSL_STAT_CDE  = 'AC'                             08320099
072700          AND G.PO_NBR         = F.PO_NBR                         08330099
072800          AND G.SEQ_NBR        = F.SEQ_NBR                        08340099
072900          AND F.SHIPT_UNT_ID   = A.SHIPT_UNT_ID                   08350099
073000          AND A.TRIP_ID        = :DK-TRIP-ID                      08360099
073100         WITH UR                                                  08370099
073200     END-EXEC.                                                    08380099
073300                                                                  08390099
073400     EVALUATE TRUE                                                08400099
073500          WHEN SQLCODE = +0                                       08410099
073600          WHEN SQLCODE = +100                                     08420099
073700              CONTINUE                                            08430099
073800                                                                  08440099
073900          WHEN SQLCODE = -305                                     08450099
074000              MOVE ZEROES               TO PV-AGED-DAYS           08460099
074100              MOVE SPACES               TO PV-FIRST-SCAN-DATE     08470099
074200                                                                  08480099
074300          WHEN OTHER                                              08490099
074400              MOVE DK-ORD-NBR           TO PV-DISP-ORD-NBR        08500099
074500              MOVE DK-REC-SEQ-NBR       TO PV-DISP-RCVR           08510099
074600              MOVE DK-OPER-UNT-ID       TO PV-DISP-OPER           08520099
074700              MOVE DK-TRIP-ID           TO PV-DISP-TRIP-ID        08530099
074800              DISPLAY ' ERROR PO-NBR  = '  PV-DISP-ORD-NBR        08540099
074900              DISPLAY ' ERROR SEQ-NBR = '  PV-DISP-RCVR           08550099
075000              DISPLAY ' ERROR OPER-ID = '  PV-DISP-OPER           08560099
075100              DISPLAY ' ERROR TRIP-ID = '  PV-DISP-TRIP-ID        08570099
075200              PERFORM 9100-SQL-ABEND                              08580099
075300     END-EVALUATE.                                                08590099
075400                                                                  08600099
075500******************************************************************08610099
075600 2900-CHECK-AUDIT-FAIL.                                           08620099
075700                                                                  08630099
075800     MOVE '2900-CHECK-AUDIT-FAIL'   TO PV-ABEND-PARAGRAPH.        08640099
075900     MOVE 'CHECK AUDIT FOR FAIL'    TO PV-DB2-OPERATION-ATTEMPTED.08650099
076000                                                                  08660099
076100     INITIALIZE DCLSUT00015.                                      08670099
076200                                                                  08680099
076300     EXEC SQL                                                     08690099
076400       SELECT DISTINCT AUD_STAT_CDE                               08700099
076500         INTO :SUT00015-AUD-STAT-CDE                              08710099
076600         FROM SUT_PO_AUD_REQ                                      08720099
076700        WHERE PO_NBR        = :DK-ORD-NBR                         08730099
076800          AND RCVR_SEQ_NBR  = :DK-REC-SEQ-NBR                     08740099
076900          AND AUD_STAT_CDE  = 'F'                                 08750099
077000         WITH UR                                                  08760099
077100     END-EXEC.                                                    08770099
077200                                                                  08780099
077300     EVALUATE TRUE                                                08790099
077400          WHEN SQLCODE = +0                                       08800099
077500              MOVE 'FAIL'               TO PC081-AUDIT-STATUS     08810099
077600                                                                  08820099
077700          WHEN SQLCODE = +100                                     08830099
077800              PERFORM 3000-CHECK-AUDIT-PASS                       08840099
077900                                                                  08850099
078000          WHEN OTHER                                              08860099
078100              MOVE DK-ORD-NBR           TO PV-DISP-ORD-NBR        08870099
078200              MOVE DK-REC-SEQ-NBR       TO PV-DISP-RCVR           08880099
078300              MOVE DK-OPER-UNT-ID       TO PV-DISP-OPER           08890099
078400              DISPLAY ' ERROR PO-NBR  = '  PV-DISP-ORD-NBR        08900099
078500              DISPLAY ' ERROR SEQ-NBR = '  PV-DISP-RCVR           08910099
078600              DISPLAY ' ERROR OPER-ID = '  PV-DISP-OPER           08920099
078700              PERFORM 9100-SQL-ABEND                              08930099
078800     END-EVALUATE.                                                08940099
078900                                                                  08950099
079000******************************************************************08960099
079100 3000-CHECK-AUDIT-PASS.                                           08970099
079200                                                                  08980099
079300     MOVE '3000-CHECK-AUDIT-PASS'   TO PV-ABEND-PARAGRAPH.        08990099
079400     MOVE 'CHECK AUDIT FOR PASS'    TO PV-DB2-OPERATION-ATTEMPTED.09000099
079500                                                                  09010099
079600     INITIALIZE DCLSUT00015.                                      09020099
079700                                                                  09030099
079800     EXEC SQL                                                     09040099
079900       SELECT DISTINCT AUD_STAT_CDE                               09050099
080000         INTO :SUT00015-AUD-STAT-CDE                              09060099
080100         FROM SUT_PO_AUD_REQ                                      09070099
080200        WHERE PO_NBR        = :DK-ORD-NBR                         09080099
080300          AND RCVR_SEQ_NBR  = :DK-REC-SEQ-NBR                     09090099
080400          AND AUD_STAT_CDE  = 'P'                                 09100099
080500         WITH UR                                                  09110099
080600     END-EXEC.                                                    09120099
080700                                                                  09130099
080800     EVALUATE TRUE                                                09140099
080900          WHEN SQLCODE = +0                                       09150099
081000              MOVE 'PASS'               TO PC081-AUDIT-STATUS     09160099
081100                                                                  09170099
081200          WHEN SQLCODE = +100                                     09180099
081300              MOVE SPACES               TO PC081-AUDIT-STATUS     09190099
081400                                                                  09200099
081500          WHEN OTHER                                              09210099
081600              MOVE DK-ORD-NBR           TO PV-DISP-ORD-NBR        09220099
081700              MOVE DK-REC-SEQ-NBR       TO PV-DISP-RCVR           09230099
081800              MOVE DK-OPER-UNT-ID       TO PV-DISP-OPER           09240099
081900              DISPLAY ' ERROR PO-NBR  = '  PV-DISP-ORD-NBR        09250099
082000              DISPLAY ' ERROR SEQ-NBR = '  PV-DISP-RCVR           09260099
082100              DISPLAY ' ERROR OPER-ID = '  PV-DISP-OPER           09270099
082200              PERFORM 9100-SQL-ABEND                              09280099
082300     END-EVALUATE.                                                09290099
082400                                                                  09300099
082500******************************************************************09310099
082600 8000-WRITE-OUTPUT-FILE.                                          09320099
082700                                                                  09330099
082800     WRITE EXTRACT-RECORD-OUT                                     09340099
082900        FROM PC081-RECEIVER-EXT-RECORD.                           09350099
083000                                                                  09360099
083100     ADD +1                TO PA-WRITE-COUNT.                     09370099
083200                                                                  09380099
083300******************************************************************09390099
083400* 9000-EOJ-ROUTINE.                                               09400099
083500*       - DISPLAY PROGRAM TOTALS                                  09410099
083600*       - CLOSE THE INPUT/OUTPUT FILES                            09420099
083700******************************************************************09430099
083800 9000-EOJ-ROUTINE.                                                09440099
083900                                                                  09450099
084000     DISPLAY ' '.                                                 09460099
084100     DISPLAY '    ** PROGRAM TOTALS **'.                          09470099
084200                                                                  09480099
084300     MOVE PA-READ-COUNT                     TO PV-DISP-DEC.       09490099
084400     DISPLAY ' INPUT RECORDS READ........'     PV-DISP-DEC.       09500099
084500                                                                  09510099
084600     MOVE PA-BYPASS-COUNT                   TO PV-DISP-DEC.       09520099
084700     DISPLAY ' BYPASSED/SCAN CNT=TAG CNT.'     PV-DISP-DEC.       09530099
084800                                                                  09540099
084900     MOVE PA-WRITE-COUNT                    TO PV-DISP-DEC.       09550099
085000     DISPLAY ' OUTPUT RECORDS WROTE......'     PV-DISP-DEC.       09560099
085100     DISPLAY ' '.                                                 09570099
085200                                                                  09580099
085300     CLOSE EXTRACT-FILE-IN                                        09590099
085400           EXTRACT-FILE-OUT.                                      09600099
085500                                                                  09610099
085600******************************************************************09620099
085700*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    09630099
085800*  ERROR OR WARNING CODE OCCURS.                                  09640099
085900******************************************************************09650099
086000 9100-SQL-ABEND.                                                  09660099
086100                                                                  09670099
086200     DISPLAY '9100-SQL-ABEND'.                                    09680099
086300     DISPLAY '** ABEND     **'.                                   09690099
086400     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        09700099
086500     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             09710099
086600     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     09720099
086700                                                                  09730099
086800******************************************************************09740099
086900* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    09750099
087000* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         09760099
087100* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     09770099
087200* FORMAT.                                                         09780099
087300******************************************************************09790099
087400     COPY DPPD004.                                                09800099
087500                                                                  09810099
087600     MOVE +4013                  TO ABEND-CODE.                   09820099
087700     CALL 'ILBOABN0' USING ABEND-CODE.                            09830099
087800                                                                  09840099
