000100 TITLE 'DELETE DATA FROM DUAL PRINT AND APPLY PNA/TRAILER ASSOC'. 00010001
000200 IDENTIFICATION DIVISION.                                                 
000300 PROGRAM-ID.    SUKUP025.                                                 
000400 AUTHOR.        DENNIS STEFFEN.                                           
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                                  
000600 DATE-WRITTEN   NOVEMBER 2008.                                            
000700 DATE-COMPILED.                                                           
000800 ENVIRONMENT DIVISION.                                                    
000900 CONFIGURATION SECTION.                                                   
001000 SOURCE-COMPUTER.        IBM-3090.                                        
001100 OBJECT-COMPUTER.        IBM-3090.                                        
001200                                                                          
001300 INPUT-OUTPUT SECTION.                                                    
001400 FILE-CONTROL.                                                            
001500                                                                          
001600     SELECT TRIP-ASGMT-UNLOAD-FILE                                        
001700         ASSIGN TO INP01.                                                 
001800                                                                          
001900                                                                          
002000******************************************************************        
002100 DATA DIVISION.                                                           
002200 FILE SECTION.                                                            
002300                                                                          
002400 FD  TRIP-ASGMT-UNLOAD-FILE                                               
002500     RECORDING MODE IS F                                                  
002600     LABEL RECORDS ARE STANDARD                                           
002700     BLOCK CONTAINS 0 RECORDS.                                            
002800                                                                          
002900*    FROM SUT00110                                                        
003000 01  TRIP-ASGMT-UNLOAD-REC   PIC X(108).                                  
003100/                                                                         
003200 WORKING-STORAGE SECTION.                                                 
003300                                                                          
003400     COPY SURD025.                                                        
003500                                                                          
003600     COPY SURD026.                                                        
003700                                                                          
003800     COPY DPWS004.                                                        
003900*                                                                         
004000     EXEC SQL                                                             
004100         INCLUDE SUT00110                                                 
004200     END-EXEC.                                                            
004300                                                                          
004400     EXEC SQL                                                             
004500          INCLUDE SQLCA                                                   
004600     END-EXEC.                                                            
004700                                                                          
004800 01  ABEND-CODE                      PIC S9(04)    VALUE +0               
004900                                                   COMP SYNC.             
005000                                                                          
005100 01  PS-PROGRAM-SWITCHES.                                                 
005200     05  PS-END-OF-DRIVE              PIC  X(01) VALUE 'N'.               
005300         88  PS-END-DRIVE-YES                    VALUE 'Y'.               
005400         88  PS-END-DRIVE-NO                     VALUE 'N'.               
005500                                                                          
005600 01  PC-PROGRAM-CONSTANTS.                                                
005700     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08) VALUE 'SUKUP025'.         
005800                                                                          
005900 01  DK-DB2-VARIABLES.                                                    
006000     05  DK-PURGE-DATE                PIC X(10).                          
006100                                                                          
006200 01  PV-PROGRAM-VARIABLES.                                                
006300                                                                          
006400     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.          
006500     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.          
006600     05  PV-READ-COUNTER             PIC  S9(9) COMP VALUE ZERO.          
006700     05  PV-COMMIT-COUNTER           PIC  S9(9) COMP VALUE ZERO.          
006800     05  PV-DELETE-COUNT             PIC  S9(9) COMP VALUE ZERO.          
006900     05  PV-NOTFND-COUNTER           PIC  S9(9) COMP VALUE ZERO.          
007000     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.                     
007100     05  PV-FUNC-QTY                 PIC  S9(4) COMP VALUE ZERO.          
007200/                                                                         
007300 PROCEDURE DIVISION.                                                      
007400                                                                          
007500     PERFORM 1000-INITIALIZE.                                             
007600                                                                          
007700     PERFORM 2000-PROCESS                                                 
007800             UNTIL PS-END-DRIVE-YES                                       
007900                                                                          
008000     PERFORM 9000-EOJ-ROUTINE.                                            
008100                                                                          
008200     GOBACK.                                                              
008300/                                                                         
008400 1000-INITIALIZE.                                                         
008500                                                                          
008600     DISPLAY '* * * * * * * * * * * '.                                    
008700     DISPLAY 'CURRENT PROGRAM ' PC-CURRENT-PROGRAM-NAME.                  
008800                                                                          
008900     OPEN INPUT TRIP-ASGMT-UNLOAD-FILE                                    
009000     PERFORM 8000-READ-SU025-REC.                                         
009100                                                                          
009200 2000-PROCESS.                                                            
009300                                                                          
009400     PERFORM 7000-DELETE-ASGMT.                                           
009500     IF PV-COMMIT-COUNTER > 50                                            
009600         MOVE ZERO                    TO PV-COMMIT-COUNTER                
009700         PERFORM 7900-COMMIT                                              
009800     END-IF.                                                              
009900                                                                          
010000     PERFORM 8000-READ-SU025-REC.                                         
010100                                                                          
010200 7000-DELETE-ASGMT.                                                       
010300                                                                          
010400     MOVE '7000-DELETE-ASGMT'         TO PV-PARAGRAPH-NAME.               
010500                                                                          
010600     MOVE  SU025-OPER-UNT-ID          TO SUT00110-OPER-UNT-ID             
010700     MOVE  SU025-ACM-LBL-STA-NBR      TO SUT00110-ACM-LBL-STA-NBR         
010800     MOVE  SU025-DOOR-ID              TO SUT00110-DOOR-ID                 
010900     MOVE  SU025-INBD-TRIP-ID         TO SUT00110-INBD-TRIP-ID            
011000     MOVE  SU025-ASGD-STRT-TMST       TO SUT00110-ASGD-STRT-TMST          
011100                                                                          
011200     EXEC SQL                                                             
011300         DELETE                                                           
011400         FROM                                                             
011500             SUT_PNA_TRIP_ASGMT                                           
011600         WHERE                                                            
011700             OPER_UNT_ID           = :SUT00110-OPER-UNT-ID                
011800         AND ACM_LBL_STA_NBR       = :SUT00110-ACM-LBL-STA-NBR            
011900         AND DOOR_ID               = :SUT00110-DOOR-ID                    
012000         AND INBD_TRIP_ID          = :SUT00110-INBD-TRIP-ID               
012100         AND ASGD_STRT_TMST        = :SUT00110-ASGD-STRT-TMST             
012200     END-EXEC.                                                            
012300                                                                          
012400     EVALUATE TRUE                                                        
012500         WHEN SQLCODE = ZERO                                              
012600             ADD SQLERRD(3)           TO PV-DELETE-COUNT                  
012700             ADD 1                    TO PV-COMMIT-COUNTER                
012800         WHEN SQLCODE = +100                                              
012900             ADD 1                    TO PV-NOTFND-COUNTER                
013000         WHEN SQLWARN0 NOT = SPACES                                       
013100         WHEN SQLCODE < ZERO                                              
013200         WHEN SQLCODE > ZERO                                              
013300             DISPLAY 'DELETE FAILED '                                     
013400             'OPER=' SUT00110-OPER-UNT-ID                                 
013500             ' ACM_LBL=' SUT00110-ACM-LBL-STA-NBR                         
013600             ' DOOR=' SUT00110-DOOR-ID                                    
013700             ' INBD_TRIP= ' SUT00110-INBD-TRIP-ID                         
013800             ' ASGD_TMST= ' SUT00110-ASGD-STRT-TMST                       
013900             MOVE 'DELETE'        TO PV-DB2-OPERATION-ATTEMPTED           
014000             PERFORM 9100-SQL-ABEND                                       
014100     END-EVALUATE.                                                        
014200                                                                          
014300 7900-COMMIT.                                                             
014400     MOVE '7900-COMMIT'               TO PV-PARAGRAPH-NAME.               
014500                                                                          
014600     EXEC SQL                                                             
014700         COMMIT                                                           
014800     END-EXEC.                                                            
014900                                                                          
015000     EVALUATE TRUE                                                        
015100         WHEN SQLCODE = ZERO                                              
015200             ADD SQLERRD(3)           TO PV-DELETE-COUNT                  
015300         WHEN SQLWARN0 NOT = SPACES                                       
015400         WHEN SQLCODE < ZERO                                              
015500         WHEN SQLCODE > ZERO                                              
015600             MOVE 'DELETE'        TO PV-DB2-OPERATION-ATTEMPTED           
015700             PERFORM 9100-SQL-ABEND                                       
015800     END-EVALUATE.                                                        
015900                                                                          
016000                                                                          
016100 8000-READ-SU025-REC.                                                     
016200     READ TRIP-ASGMT-UNLOAD-FILE INTO                                     
016300         SU025-TRIP-ASGMT-REC                                             
016400     AT END                                                               
016500         SET PS-END-DRIVE-YES         TO TRUE                             
016600     NOT AT END                                                           
016700         ADD +1                       TO PV-READ-COUNTER                  
016800     END-READ.                                                            
016900/                                                                         
017000 9000-EOJ-ROUTINE.                                                        
017100                                                                          
017200     PERFORM 7900-COMMIT                                                  
017300                                                                          
017400     CLOSE TRIP-ASGMT-UNLOAD-FILE                                         
017500                                                                          
017600     MOVE PV-READ-COUNTER             TO PV-DISPLAY-COUNT.                
017700     DISPLAY 'TOTAL RECORDS READ             = ' PV-DISPLAY-COUNT.        
017800                                                                          
017900     MOVE PV-DELETE-COUNT             TO PV-DISPLAY-COUNT.                
018000     DISPLAY 'ROWS DELETED                   = ' PV-DISPLAY-COUNT.        
018100                                                                          
018200     MOVE PV-NOTFND-COUNTER           TO PV-DISPLAY-COUNT.                
018300     DISPLAY 'ROWS NOT FOUND FOR DELETION    = ' PV-DISPLAY-COUNT.        
018400                                                                          
018500     DISPLAY '* * * * * * * * * * * '.                                    
018600                                                                          
018700 9100-SQL-ABEND.                                                          
018800     DISPLAY '9100-SQL-ABEND'.                                            
018900     DISPLAY '** ABEND     **'.                                           
019000     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.                
019100     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.                      
019200     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.             
019300                                                                          
019400     COPY DPPD004.                                                        
019500                                                                          
019600     MOVE +4013                  TO ABEND-CODE.                           
019700     CALL 'ILBOABN0' USING ABEND-CODE.                                    
019800                                                                          
