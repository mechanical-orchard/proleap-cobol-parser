       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    MLKUT207.                                                 
       AUTHOR.        B. GRAHAM - STRATAGEM.                                    
       INSTALLATION.  KOHLS DEPARTMENT STORES.                                  
       DATE-WRITTEN.  10/05/06.                                                 
       DATE-COMPILED.                                                           
                                                                        00070000
      ******************************************************************00080000
      * THIS PROGRAM WILL CALCULATE AND APPLY THE SMOOTHING LEVEL II    00090000
      * FACTORS FOR THOSE CANDIDATES NOT UPDATED IN THE SMOOTHING       00100000
      * LEVEL I PROCESS. SPECIAL PROCESSING IS NEEDED FOR THE LAST      00110000
      * TYPE 0 OUTLYER CANDIDATE TO INSURE THAT THE TARGET IS MET       00120000
      * AND NOT EXCEEDED.                                               00130000
      *  INPUTS ARE:                                                    00140000
      *      TARGET-CALC-DATA                                           00150000
      *            DEPT TARGET EIC                                      00160000
      *            TOTAL EIC AFTER SMOOTH I                             00170000
      *            TOTAL EIC FOR TYPE 0 CANDIDATES FOR SMOOTH II        00180000
      *         OR TOTAL EIC FOR TYPE 1 THROUGH 9 CANDIDATES FOR        00180000
      *                                            FOR SMOOTH III       00180000
      *      SMOOTH-I-DTL-IN (OUTPUT RESULT AFTER SMOOTH I)             00190000
      *  OUTPUT IS:                                                     00200000
      *      SMOOTH-II-DTL-OUT                                          00210000
      *                                                                 00220000
      *  NOTE, SMOOTHING III USES THE SAME PROCESS AS SMOOTHING II      00220000
      *                                                                         
      *CHG ID/                                                                  
      *WR/PROJ DATE       PGMR        DESCRIPTION                               
      *------- ---------- ----------- ----------------------------------        
B28582* W28582 01-03-2007 ROD JANSSEN MARGIN $ RULE CHANGE                      
C28582* 28582  01-10-2007 ROD JANSSEN GROSS MARGIN $ REFINEMENT CHANGE          
I28582* 28582  03-19-2007 ROD JANSSEN ADD TEST ID FOR SMOOTHING LEVEL           
      ******************************************************************00230000
                                                                        00240000
       ENVIRONMENT DIVISION.                                            00260000
       CONFIGURATION SECTION.                                           00290000
       SOURCE-COMPUTER.        IBM-3090.                                00310000
       OBJECT-COMPUTER.        IMB-3090.                                00320000
       INPUT-OUTPUT SECTION.                                            00340000
       FILE-CONTROL.                                                    00360000
                                                                        00370000
           SELECT TARGET-CALC-DATA                                      00380000
               ASSIGN TO INP01.                                         00390000
           SELECT SMOOTH-I-DTL-IN                                       00400000
               ASSIGN TO INP02.                                         00410000
I28582     SELECT SMOOTH-VERBIAGE-IN                                    00270000
I28582         ASSIGN TO INP03.                                         00280000
           SELECT SMOOTH-II-DTL-OUT                                     00420000
               ASSIGN TO OUT01.                                         00430000
                                                                        00460014
       DATA DIVISION.                                                   00480000
       FILE SECTION.                                                    00510000
       FD  TARGET-CALC-DATA                                             00520000
           RECORDING  MODE IS F                                         00530000
           BLOCK CONTAINS 0 RECORDS.                                    00540000
       01  TARGET-CALC-DATA-REC                  PIC X(110).            00550000
                                                                        00560000
       FD  SMOOTH-I-DTL-IN                                              00570000
           RECORDING  MODE IS F                                         00580000
           BLOCK CONTAINS 0 RECORDS.                                    00590000
           COPY MLRD070 REPLACING ML070 BY SMOOI.                       00610000
                                                                        00620000
I28582 FD  SMOOTH-VERBIAGE-IN                                           00450000
I28582     LABEL RECORDS ARE OMITTED                                    00460000
I28582     RECORDING MODE IS F                                          00470000
I28582     BLOCK CONTAINS 0 RECORDS.                                    00480000
I28582 01  SMOOTH-VERBIAGE-REC             PIC X(080).                  00490005
I28582                                                                  00500000
       FD  SMOOTH-II-DTL-OUT                                            00630000
           RECORDING  MODE IS F                                         00640000
           BLOCK CONTAINS 0 RECORDS.                                    00650000
       01  SMOOTH-II-DTL-OUT-REC                 PIC X(400).            00660000
                                                                        00670000
      /*****************************************************************00731014
       WORKING-STORAGE SECTION.                                         00740000
      ******************************************************************00741014
                                                                        00750000
       01  ABEND-CODE                            PIC S9(4) VALUE ZEROS  00760000
                                                       COMP SYNC.       00770000
I28582     88  ABEND-4001-WRITE-ERROR                      VALUE +4001. 00920000
I28582     88  ABEND-4002-READ-ERROR                       VALUE +4002. 00930000
I28582     88  ABEND-4003-CTRL-CARD-ERROR                  VALUE +4003. 00940000
I28582     88  ABEND-4004-TABLE-ERROR                      VALUE +4004. 00950000
I28582     88  ABEND-4005-OPEN-ERROR                       VALUE +4005. 00960000
I28582     88  ABEND-4006-CLOSE-ERROR                      VALUE +4006. 00970000
I28582     88  ABEND-4007-SEQUENCE-ERROR                   VALUE +4007. 00980000
I28582     88  ABEND-4008-DATA-ERROR                       VALUE +4008. 00990000
I28582     88  ABEND-4009-KEY-DATA-ERROR                   VALUE +4009. 01000000
I28582     88  LOGICAL-ISSUE-ABEND                         VALUE +4012. 01010000
I28582     88  ABEND-4013-DB2-ERROR                        VALUE +4013. 01020000
I28582     88  ABEND-4019-DATE-ROUTINE-ERROR               VALUE +4019. 01030000
I28582     88  ABEND-4444-FORCED-ABEND                     VALUE +4444. 01040000
                                                                        00780000
I28582 01  CC-SMOOTH-VERBIAGE-AREA.                                     00690010
I28582     05  CC-SMOOTH-LVL-IND           PIC  X(01)      VALUE SPACE. 00700010
I28582         88  LEVEL-I-SMOOTH                          VALUE '1'.   00710010
I28582         88  LEVEL-II-SMOOTH                         VALUE '2'.   00710010
I28582         88  LEVEL-III-SMOOTH                        VALUE '3'.   00710010
I28582         88  LEVEL-IV-SMOOTH                         VALUE '4'.   00710010
I28582     05  CC-SEPERATOR                PIC  X(03)      VALUE SPACES.00720010
I28582     05  CC-DESCRIPTION              PIC  X(76)      VALUE SPACES.00720010
I28582                                                                  00780010
       01  PA-PROGRAM-ACCUMULATORS.                                     00790000
                                                                        00800000
           05  PA-TARGET-CALC-DATA-CNT           PIC S9(09) VALUE +0    00810000
                                                        COMP-3.         00820000
           05  PA-SMOOTH-I-DTL-IN-CNT            PIC S9(09) VALUE +0    00830000
                                                        COMP-3.         00840000
           05  PA-SMOOTH-II-DTL-OUT-CNT          PIC S9(09) VALUE +0    00850000
                                                        COMP-3.         00860000
           05  PA-DIFFERENCE                   PIC S9(09)V99 VALUE +0   00870000
                                                        COMP-3.         00880000
      ******************PA-EIC-COST-TARGET-AMT***********************   00890000
      *    HOLDS THE DIFFERENCE BETWEEN THE TMNDPT TARGET AND       *   00900000
      *    THE TOTAL EIC COST AFTER SMOOTH I PROCESS                *   00910000
      ******************PA-EIC-COST-TARGET-AMT***********************   00920000
           05  PA-EIC-COST-TARGET-AMT         PIC S9(11)V99 VALUE +0    00930000
                                                        COMP-3.         00940000
      ******************PA-EIC-I-EIC-0-RESULT************************   00950000
      *    HOLDS THE DIVISION RESULT OF THE EIC-AMT1 DIVIDED BY     *   00960000
      *    THE TOTAL EIC-0 EIC AMT                                  *   00970000
      ***************************************************************   00980000
           05  PA-EIC-I-EIC-0-RESULT          PIC S9(09)V9(8) VALUE +0  00990017
                                                        COMP-3.         01000000
      ******************PA-EIC-I-EIR-RESULT**************************   01001034
      *    HOLDS THE DIVISION RESULT OF THE EIC TARGET DIVIDED BY   *   01002035
      *    THE EIR AMOUNT                                           *   01003034
      ***************************************************************   01004034
           05  PA-EIC-T-EIR-RESULT            PIC S9(09)V9(8) VALUE +0  01005035
                                                        COMP-3.         01006034
      ******************PA-NEW-EIC-COST-AMT**************************   01010000
      *    HOLDS THE RESULT OF SMOOTHING II                         *   01020000
      *                                                             *   01030000
      ***************************************************************   01040000
           05  PA-NEW-EIC-COST-AMT            PIC S9(11)V99 VALUE +0    01050000
                                                        COMP-3.         01060000
      ******************PA-HOLD-END-INV-COST-AMT2********************   01070000
      *    HOLDS THE SUM OF THE INCOMING EIC COST AND THE NEW EIC   *   01080000
      *    COST-AMT                                                 *   01090000
      ***************************************************************   01100000
           05  PA-HOLD-END-INV-COST-AMT2      PIC S9(11)V99 VALUE +0    01110000
                                                        COMP-3.         01120000
      ******************PA-HOLD-CURR-SLS-COST-AMT********************   01121035
      *    HOLDS THE INCOMING CURRENT SALES COST AMOUNT             *   01122035
      *                                                             *   01123035
      ***************************************************************   01124035
           05  PA-HOLD-CURR-SLS-COST-AMT      PIC S9(11)V99 VALUE +0    01125035
                                                        COMP-3.         01126035
      ******************PA-USED-OF-TARGET-AMT************************   01130000
      *    HOLDS THE AMOUNT OF THE COMPUTED TARGET COST AMT         *   01140000
      *    (PA-EIC-COST-TARGET-AMT) THAT HAS ALREADY BEEN USED      *   01150000
      *    FOR THE DEPARTMENT IN THIS RUN.                          *   01160000
      ***************************************************************   01170000
           05  PA-USED-OF-TARGET-AMT          PIC S9(11)V99 VALUE +0    01180000
                                                        COMP-3.         01190000
      ******************PA-NEW-USED-OF-TARGET-AMT*******************    01200000
      *    IS A TEMP HOLD AREA TO DETERMINE IF THE TARGET AMOUNT    *   01210000
      *    (PA-EIC-COST-TARGET-AMT) WILL BE EXCEEDED.               *   01220000
011600*                                                             *   01230000
      ***************************************************************   01240000
           05  PA-NEW-USED-OF-TARGET-AMT      PIC S9(11)V99 VALUE +0    01250000
                                                        COMP-3.         01260000
                                                                        01270000
       01  PC-PROGRAM-CONSTANTS.                                        01280000
           05 PC-PGM-NAME                        PIC  X(08)             01290000
                                                      VALUE 'MLKUT207'. 01300000
           05 PC-4090                            PIC S9(08) COMP SYNC   01310000
                                                      VALUE +4090.      01320000
           05 PC-0                               PIC  X(01)             01330000
                                                      VALUE '0'.        01340000
           05 PC-9999                            PIC S9(04) COMP-3      01370000
                                                      VALUE +9999.      01380000
                                                                        01410000
       01  PS-PROGRAM-SWITCHES.                                         01420000
I28582     05  PS-SMOOTH-VERB-DONE-SW    PIC X(01)   VALUE 'N'.         01860000
I28582         88  PS-SMOOTH-VERB-DONE               VALUE 'Y'.         01870000
013700     05  PS-TARGET-CALC-DATA-AT-END-SW     PIC  X(01) VALUE 'N'.  01440000
               88  PS-TARGET-CALC-DATA-AT-END-NO            VALUE 'N'.  01450000
               88  PS-TARGET-CALC-DATA-AT-END-YES           VALUE 'Y'.  01460000
           05  PS-TARGET-CALC-DATA-USED-SW       PIC  X(01) VALUE 'N'.  01470000
               88  PS-TARGET-CALC-DATA-USED-NO              VALUE 'N'.  01480000
               88  PS-TARGET-CALC-DATA-USED-YES             VALUE 'Y'.  01490000
           05  PS-SMOOTH-I-DTL-AT-END-SW         PIC  X(01) VALUE 'N'.  01500000
               88  PS-SMOOTH-I-DTL-AT-END-NO                VALUE 'N'.  01510000
               88  PS-SMOOTH-I-DTL-AT-END-YES               VALUE 'Y'.  01520000
           05  PS-ALL-DTL-DONE-SW                PIC  X(01) VALUE 'N'.  01530000
               88  PS-ALL-DTL-DONE-NO                       VALUE 'N'.  01540000
               88  PS-ALL-DTL-DONE-YES                      VALUE 'Y'.  01550000
           05  PS-SMOOTH-I-DTL-USED-SW           PIC  X(01) VALUE 'N'.  01560000
               88  PS-SMOOTH-I-DTL-USED-NO                  VALUE 'N'.  01570000
               88  PS-SMOOTH-I-DTL-USED-YES                 VALUE 'Y'.  01580000
           05  PS-FILE-MATCH-FOUND-SW            PIC  X(01) VALUE 'N'.  01590000
015300         88  PS-FILE-MATCH-FOUND-NO                   VALUE 'N'.  01600000
               88  PS-FILE-MATCH-FOUND-YES                  VALUE 'Y'.  01610000
           05  PS-FIRST-READ-SW                  PIC  X(01) VALUE 'Y'.  01620000
               88  PS-FIRST-READ-NO                         VALUE 'N'.  01630000
               88  PS-FIRST-READ-YES                        VALUE 'Y'.  01640000
           05  PS-LAST-REC-FOR-DEPT-SW           PIC  X(01) VALUE 'N'.  01650000
               88  PS-LAST-REC-FOR-DEPT-NO                  VALUE 'N'.  01660000
               88  PS-LAST-REC-FOR-DEPT-YES                 VALUE 'Y'.  01670000
                                                                        01680000
       01  PV-PROGRAM-VARIABLES.                                        01690000
           05  PV-TARGET-CALC-DATA-KEY.                                 01710000
               10  PV-TCD-DEPT-NBR               PIC  S9(04) COMP-3     01760000
                                                        VALUE ZEROS.    01770000
           05  PV-SMOOTH-I-DTL-IN-KEY.                                  01780000
               10  PV-SMI-DTL-DEPT-NBR           PIC  S9(04) COMP-3     01830000
                                                        VALUE ZEROS.    01840000
015300     05  PV-CUM-MKUP-PCT-MAX         PIC S9(9)V9(7)  VALUE ZEROES 01850000
                               COMP-3.                                  01860000
           05  PV-CUM-TO-DATE-VARIABLES.                                01870000
               10  PV-CUM-TO-DATE-PURCH-RETAIL                          01880000
                                           PIC S9(11)V9(2) VALUE ZEROES 01890000
                               COMP-3.                                  01900000
               10  PV-CUM-TO-DATE-PURCH-COST                            01910000
                                           PIC S9(11)V9(2) VALUE ZEROES 01920000
                               COMP-3.                                  01930000
               10  PV-CUM-SEASON-MKUP      PIC S9(11)V9(2) VALUE ZEROES 01940000
                               COMP-3.                                  01950000
           05  PV-PREV-FISCAL-DATA.                                     01960000
               10  PV-PREV-END-INV-RTL-AMT PIC S9(11)V9(2) VALUE ZEROES 01970000
                               COMP-3.                                  01980000
               10  PV-PREV-END-INV-COST-AMT                             01990000
                                           PIC S9(11)V9(2) VALUE ZEROES 02000000
                               COMP-3.                                  02010000
               10  FILLER                  PIC X(18)       VALUE SPACES.02020000
           05  PV-SEASON-TO-DATE-DATA.                                  02030000
               10  PV-SEAS-RCPT-RTL-AMT PIC S9(11)V9(2) VALUE ZEROES    02040000
                               COMP-3.                                  02050000
               10  PV-SEAS-RCPT-NET-COST-AMT                            02060000
                                           PIC S9(11)V9(2) VALUE ZEROES 02070000
                               COMP-3.                                  02080000
               10  PV-SEAS-PADJ-RTL-AMT PIC S9(11)V9(2) VALUE ZEROES    02090000
                               COMP-3.                                  02100000
               10  PV-SEAS-PADJ-NET-COST-AMT                            02110000
                                           PIC S9(11)V9(2) VALUE ZEROES 02120000
                               COMP-3.                                  02130000
               10  PV-SEAS-MKUP-RTL-AMT PIC S9(11)V9(2) VALUE ZEROES    02140000
                               COMP-3.                                  02150000
               10  PV-SEAS-XFER-IN-RTL-AMT                              02160000
                                           PIC S9(11)V9(2) VALUE ZEROES 02170000
                               COMP-3.                                  02180000
               10  PV-SEAS-XFER-OUT-RTL-AMT                             02190000
                                           PIC S9(11)V9(2) VALUE ZEROES 02200000
                               COMP-3.                                  02210000
               10  PV-SEAS-INV-COST-ADJ1                                02220000
                                           PIC S9(11)V9(2) VALUE ZEROES 02230000
                               COMP-3.                                  02240000
               10  PV-SEAS-INV-COST-ADJ2                                02250000
                                           PIC S9(11)V9(2) VALUE ZEROES 02260000
                               COMP-3.                                  02270000
                                                                        02280000
018500******************************************************************02377500
018600*  MLRD035                                                        02378000
018700******************************************************************02380000
018900     COPY MLRD035 REPLACING ML035 BY WS035.                       02400000
                                                                        02410000
      ******************************************************************02420000
      *  MLRD070 SMOOTHING LEVEL II CANDIDATE                           02430000
      ******************************************************************02440000
           COPY MLRD070 REPLACING ML070 BY WS070.                       02460000
                                                                        02470000
      ******************************************************************02480000
       PROCEDURE DIVISION.                                              02490000
      ******************************************************************02500000
                                                                        02510000
       0000-MAINLINE.                                                   02520000
                                                                        02530000
           PERFORM 1000-INITIALIZE.                                     02540000
                                                                        02550000
           PERFORM 1100-FILE-MATCH                                      02560000
               UNTIL PS-ALL-DTL-DONE-YES.                               02570000
                                                                        02580000
           PERFORM 9000-END-PROCESSING.                                 02590000
                                                                        02600000
                                                                        02620000
           STOP RUN.                                                    02630000
                                                                        02631014
      ******************************************************************02640000
      *  PERFORM THE NECESSARY INITIALIZATION STEPS                     02650000
      ******************************************************************02660000
                                                                        02670000
       1000-INITIALIZE.                                                 02680000
                                                                        02690000
           OPEN  INPUT TARGET-CALC-DATA                                 02700000
                       SMOOTH-I-DTL-IN                                  02710000
I28582                 SMOOTH-VERBIAGE-IN                               02290010
                OUTPUT SMOOTH-II-DTL-OUT.                               02730000
                                                                        02740000
I28582     DISPLAY '********************************************'.      02660022
I28582     PERFORM 7200-READ-SMOOTH-VERBIAGE.                           02350000
I28582     IF PS-SMOOTH-VERB-DONE                                       02360000
I28582         DISPLAY ' *** NO SMOOTH VERBIAGE IND FOUND.'             02560019
I28582         DISPLAY '1000-INITIALIZE'                                02570019
I28582         SET LOGICAL-ISSUE-ABEND   TO TRUE                        02580019
I28582         PERFORM 9999-OTHER-ABEND                                 02590019
I28582     ELSE                                                                 
I28582     IF (NOT LEVEL-II-SMOOTH) AND (NOT LEVEL-III-SMOOTH)                  
I28582         DISPLAY ' *** INVALID SMOOTH VERBIAGE IND.'              02560019
I28582         DISPLAY '1000-INITIALIZE'                                02570019
I28582         SET LOGICAL-ISSUE-ABEND   TO TRUE                        02580019
I28582         PERFORM 9999-OTHER-ABEND                                 02590019
I28582     ELSE                                                                 
I28582         DISPLAY CC-SMOOTH-VERBIAGE-AREA                          02530019
I28582     END-IF.                                                      02680000
I28582     DISPLAY '********************************************'.      02660022
I28582     DISPLAY ' '.                                                 02670022
I28582                                                                  02690000
           MOVE SPACES TO SMOOI-COMMON-RECALC-EXTRACT.                  02750000
           MOVE ZEROS  TO SMOOI-DEPT-NBR.                               02760000
           PERFORM 5000-READ-SMOOTH-I-DTL.                              02770000
                                                                        02780000
      *********************************************************         02790000
      *    READ AHEAD FOR SPECIAL LAST RECORD CALCULATIONS    *         02800000
      *    RECORD 1 IS NOT AVAILABLE FOR PROCESSING UNTIL     *         02810000
      *    RECORD 2 HAS BEEN READ.                            *         02820000
      *********************************************************         02830000
           PERFORM 5000-READ-SMOOTH-I-DTL.                              02850000
                                                                        02860000
           PERFORM 5010-READ-TARGET-CALC-DATA.                          02870000
                                                                        02880000
      ******************************************************************02890000
      *  PROCESS THE INPUT FILES.                                       02900000
      *  WHEN PA-EIC-COST-TARGET-AMT = ZEROS, TARGET WAS ALREADY        02900000
      *  REACHED IN PREVIOUS SMOOTHING PROCESSES, DO NOT ATTEMPT        02900000
      *  TO SMOOTH AGAIN.                                               02900000
      ******************************************************************02910000
       1100-FILE-MATCH.                                                 02930000
                                                                        02940000
           SET PS-FILE-MATCH-FOUND-NO TO TRUE.                          02950000
                                                                        02960000
           PERFORM 1110-DET-TO-TCD-MATCH                                02970000
               UNTIL PS-FILE-MATCH-FOUND-YES.                           02980000
                                                                        02990000
           IF WS035-END-INV-ALL-EXIST                                   03000000
               IF PA-EIC-COST-TARGET-AMT = ZEROS                        03010000
                   MOVE WS070-END-INV-COST-AMT1                         03060000
                                      TO WS070-END-INV-COST-AMT2        03070000
                   PERFORM 5050-WRITE-SMOOTH-II-DTL                     03080000
                   PERFORM 5000-READ-SMOOTH-I-DTL                       03090000
               ELSE                                                     03050000
                   PERFORM 2000-CALC-COST-AND-ADJ-AMT2                  03020000
                   PERFORM 5050-WRITE-SMOOTH-II-DTL                     03030000
                   PERFORM 5000-READ-SMOOTH-I-DTL                       03040000
               END-IF                                                   03100000
           ELSE                                                         03110000
               PERFORM 4000-NOT-ALL-DATA-FOUND                          03120000
               MOVE WS070-END-INV-COST-AMT1                             03130000
                                      TO WS070-END-INV-COST-AMT2        03140000
               PERFORM 5050-WRITE-SMOOTH-II-DTL                         03150000
               PERFORM 5000-READ-SMOOTH-I-DTL                           03160000
           END-IF.                                                      03170000
                                                                        03180000
       1110-DET-TO-TCD-MATCH.                                           03190000
                                                                        03200000
           IF PV-SMOOTH-I-DTL-IN-KEY = PV-TARGET-CALC-DATA-KEY          03210000
               SET PS-FILE-MATCH-FOUND-YES   TO TRUE                    03220000
               SET PS-TARGET-CALC-DATA-USED-YES TO TRUE                 03230000
           ELSE                                                         03240000
               IF PV-TARGET-CALC-DATA-KEY <                             03250000
                                   PV-SMOOTH-I-DTL-IN-KEY               03260000
                   PERFORM 5010-READ-TARGET-CALC-DATA                   03340000
               ELSE                                                     03350000
                   DISPLAY 'TARGET-CALC-DATA MISSING FOR '              03360000
                                           PV-SMOOTH-I-DTL-IN-KEY       03370000
                           ' '             PV-SMI-DTL-DEPT-NBR          03380000
                   MOVE PC-4090 TO RETURN-CODE                          03390000
                   MOVE WS070-END-INV-COST-AMT1                         03400000
                                      TO WS070-END-INV-COST-AMT2        03410000
                   PERFORM 5050-WRITE-SMOOTH-II-DTL                     03420000
                   PERFORM 5000-READ-SMOOTH-I-DTL                       03430000
           END-IF.                                                      03440000
                                                                        03450000
       2000-CALC-COST-AND-ADJ-AMT2.                                     03460000
      **********************************************************        03480000
      *                                                                 03490000
      * IN THE CALCULATION BELOW:                                       03500000
      * WS035-END-INV-COST-AMT                                          03510000
      * IS THE INPUT SUM OF THE ENDING INVENTORY COST OF                03520000
      * ALL TYPE 0 CANDICATES FOR A DEPT AND FSCL PERIOD/DATE.          03530000
      *                                                                 03540000
      * WS035-RECALC-END-INV-COST-AMT                                   03550000
      * IS THE INPUT SUM OF THE ENDING INVENTORY COST OF ALL            03560000
      * ROWS FOR A DEPT AND FSCL PERIOD/DATE AFTER ANY SMOOTH I         03570000
      * PROCESS HAS BEEN APPLIED.                                       03580000
      *                                                                 03590000
      * WS035-TARGET-END-INV-COST-AMT                                   03600000
      * IS THE ENDING INVENTORY COST (TARGET) FROM THE TMNDPT TABLE     03610000
      * FOR A DEPT AND FSCL PERIOD/DATE.                                03620000
      *                                                                 03630000
      * PA-EIC-COST-TARGET-AMT                                          03640000
      * HOLDS THE DIFFERENCE BETWEEN THE TMNDPT TARGET AND              03650000
      * THE TOTAL EIC COST AFTER SMOOTH I PROCESS.                      03660000
      *                                                                 03670000
      * PA-EIC-I-EIC-0-RESULT                                           03680000
      * HOLDS THE DIVISION RESULT OF THE EIC-AMT1 DIVIDED BY            03690000
      * THE TOTAL EIC-0 EIC AMT                                         03700000
      *                                                                 03710000
      * PA-NEW-EIC-COST-AMT HOLDS THE RESULT OF SMOOTHING II            03720000
      *                                                                 03730000
      * PA-HOLD-END-INV-COST-AMT2                                       03740000
      * HOLDS THE SUM OF THE INCOMING EIC COST AND THE NEW EIC          03750000
      * COST-AMT                                                        03760000
      *                                                                 03770000
      * PA-USED-OF-TARGET-AMT                                           03780000
      * HOLDS THE AMOUNT OF THE COMPUTED TARGET COST AMT                03790000
      * (PA-EIC-COST-TARGET-AMT) THAT HAS ALREADY BEEN USED             03800000
      * FOR THE DEPARTMENT IN THIS RUN.                                 03810000
      *                                                                 03820000
      * PA-NEW-USED-OF-TARGET-AMT                                       03830000
      * IS A HOLD AREA TO DETERMINE IF THE TARGET AMOUNT                03840000
      * (PA-EIC-COST-TARGET-AMT) WILL BE EXCEEDED.                      03850000
      *                                                                 03860000
      ***************************************************************   03870000
      *                                                                 03880000
      * WHEN PS-SMOOTH-I-DTL-AT-END-YES IS TRUE, THE PROCESS BELOW IS   03890000
      * PROCESSING THE LAST RECORD. THE LAST RECORD HAS SPECIAL RULES   03900000
      * FOR THE CALCULATION OF THE ADJUSTMENT AMOUNT.                   03910000
      *                                                                 03920000
      **********************************************************        03940000
                                                                        03950000
           IF PS-LAST-REC-FOR-DEPT-YES                                  04190014
               PERFORM 2050-LAST-FOR-DEPT-CALC                          04200014
           ELSE                                                         04210014
                                                                        04215014
      **** CALCULATE THE PRORATE PERCENT FOR THE KEY COMBINATION.....   04216014
B28582       IF WS035-END-INV-COST-AMT EQUAL ZERO                               
B28582         MOVE ZEROS   TO PA-EIC-I-EIC-0-RESULT                            
B28582       ELSE                                                               
               COMPUTE PA-EIC-I-EIC-0-RESULT ROUNDED =                  04217014
                    (WS070-END-INV-COST-AMT1 /                          04218014
                     WS035-END-INV-COST-AMT)                            04219014
B28582       END-IF                                                             
                                                                        04219114
      **** CALCULATE THE LEVEL II COST ADJUSTMENT...                    04219214
              COMPUTE PA-NEW-EIC-COST-AMT ROUNDED =                     04219316
                    (PA-EIC-COST-TARGET-AMT * PA-EIC-I-EIC-0-RESULT)    04219414
                                                                        04219514
      **** CALCULATE THE LEVEL II ENDING INVENTORY COST....             04219614
               COMPUTE                                                  04219714
                     PA-HOLD-END-INV-COST-AMT2 =                        04219814
                    (WS070-END-INV-COST-AMT1 + PA-NEW-EIC-COST-AMT)     04219914
                                                                        04220014
               PERFORM 2025-NOT-LAST-REC-FOR-DEPT                       04221014
           END-IF.                                                      04240014
                                                                        04250014
       2025-NOT-LAST-REC-FOR-DEPT.                                      04270014
                                                                        04280014
           ADD PA-NEW-EIC-COST-AMT        TO PA-USED-OF-TARGET-AMT.     04290014
           MOVE PA-HOLD-END-INV-COST-AMT2 TO WS070-END-INV-COST-AMT2.   04560014
                                                                        04570014
           PERFORM 2075-CALC-ADJ-AMT-2.                                 04580014
                                                                        04630014
040600 2050-LAST-FOR-DEPT-CALC.                                         04650000
                                                                        04660000
           COMPUTE PA-NEW-EIC-COST-AMT =                                04700000
                                 PA-EIC-COST-TARGET-AMT -               04710000
                                            PA-USED-OF-TARGET-AMT.      04720000
                                                                        04730000
           COMPUTE PA-HOLD-END-INV-COST-AMT2 =                          04740012
                 (WS070-END-INV-COST-AMT1 + PA-NEW-EIC-COST-AMT).       04742012
                                                                        04743014
           MOVE PA-HOLD-END-INV-COST-AMT2 TO WS070-END-INV-COST-AMT2.   04840034
                                                                        04850014
           PERFORM 2075-CALC-ADJ-AMT-2.                                 04860034
                                                                        04870014
           MOVE ZEROS TO PA-USED-OF-TARGET-AMT.                         04920000
                                                                        04930000
       2075-CALC-ADJ-AMT-2.                                             04940000
                                                                        04950014
           IF WS070-CURR-END-INV-RTL-AMT = ZEROS                        04951035
               IF WS070-END-INV-COST-AMT2 = ZEROS                       04952035
      *            MOVE ZEROS TO WS070-CURR-CUM-MKUP-PCT                04953035
                   MOVE ZEROS TO WS070-TGT-CUM-MKUP-PCT                 04953035
               ELSE                                                     04954035
      *            MOVE 100   TO WS070-CURR-CUM-MKUP-PCT                04954135
                   MOVE 100   TO WS070-TGT-CUM-MKUP-PCT                 04954135
               END-IF                                                   04955035
           ELSE                                                         04956035
               COMPUTE PA-EIC-T-EIR-RESULT ROUNDED =                    04960035
                       WS070-END-INV-COST-AMT2                          04970035
                     / WS070-CURR-END-INV-RTL-AMT                       04980035
      *        COMPUTE WS070-CURR-CUM-MKUP-PCT =                        04990035
               COMPUTE WS070-TGT-CUM-MKUP-PCT =                         04990035
                      ((1 - PA-EIC-T-EIR-RESULT)                        05000035
                     * 100)                                             05010035
           END-IF.                                                      05020035
                                                                        05030035
           COMPUTE WS070-INV-COST-ADJ2 =                                05040035
                       WS070-END-INV-COST-AMT2                          05041035
                     - WS070-END-INV-COST-AMT1.                         05050035
                                                                        05060035
           MOVE WS070-CURR-SLS-COST-AMT TO PA-HOLD-CURR-SLS-COST-AMT.   05070035
                                                                        05070135
           COMPUTE WS070-CURR-SLS-COST-AMT =                            05071035
                       PA-HOLD-CURR-SLS-COST-AMT                        05080035
                     - WS070-INV-COST-ADJ2.                             05090035
                                                                        05100035
           COMPUTE WS070-ADJ-GRO-MRGN-AMT =                             05110035
                       WS070-CURR-SLS-RTL-AMT                           05120035
                     - WS070-CURR-SLS-COST-AMT.                         05121035
                                                                        05680014
      *    DISPLAY 'PA-SMOOTH-I-DTL-IN-CNT ' PA-SMOOTH-I-DTL-IN-CNT.    05690024
                                                                        05720022
       4000-NOT-ALL-DATA-FOUND.                                         06040000
                                                                        06050000
           MOVE PC-4090 TO RETURN-CODE.                                 06060000
                                                                        06070000
           IF WS035-TYPE = +1                                           06080000
               DISPLAY 'NO EIC FOR DEPT '                               06090000
                                           PV-SMOOTH-I-DTL-IN-KEY       06100000
                       ' '                 PV-SMI-DTL-DEPT-NBR          06110000
               DISPLAY 'NO EIC OUTLYER CANDI 0 FOR DEPT '               06120000
                                           PV-SMOOTH-I-DTL-IN-KEY       06130000
                       ' '                 PV-SMI-DTL-DEPT-NBR          06140000
               DISPLAY 'TCD TYPE ' WS035-TYPE.                          06150000
                                                                        06160000
           IF WS035-TYPE = +2                                           06170000
               DISPLAY 'TMNDPT NOT AVAILABLE FOR '                      06180000
                                           PV-SMOOTH-I-DTL-IN-KEY       06190000
                       ' '                 PV-SMI-DTL-DEPT-NBR          06200000
               DISPLAY 'NO EIC OUTLYER CANDI 0 FOR DEPT '               06210000
                                           PV-SMOOTH-I-DTL-IN-KEY       06220000
                       ' '                 PV-SMI-DTL-DEPT-NBR          06230000
               DISPLAY 'TCD TYPE ' WS035-TYPE.                          06240000
                                                                        06250000
           IF WS035-TYPE = +3                                           06260000
               DISPLAY 'NO EIC OUTLYER CANDI 0 FOR DEPT '               06270000
                                           PV-SMOOTH-I-DTL-IN-KEY       06280000
                       ' '                 PV-SMI-DTL-DEPT-NBR          06290000
               DISPLAY 'TCD TYPE ' WS035-TYPE.                          06300000
                                                                        06310000
           IF WS035-TYPE = +4                                           06320000
               DISPLAY 'TMNDPT NOT AVAILABLE FOR '                      06330000
                                           PV-SMOOTH-I-DTL-IN-KEY       06340000
                       ' '                 PV-SMI-DTL-DEPT-NBR          06350000
               DISPLAY 'TCD TYPE ' WS035-TYPE.                          06360000
                                                                        06370000
           IF WS035-TYPE = +5                                           06380000
               DISPLAY 'NO EIC FOR DEPT '                               06390000
                                           PV-SMOOTH-I-DTL-IN-KEY       06400000
                       ' '                 PV-SMI-DTL-DEPT-NBR          06410000
               DISPLAY 'TCD TYPE ' WS035-TYPE.                          06420000
                                                                        06430000
           IF WS035-TYPE = +6                                           06440000
               DISPLAY 'TMNDPT NOT AVAILABLE FOR '                      06450000
                                           PV-SMOOTH-I-DTL-IN-KEY       06460000
                       ' '                 PV-SMI-DTL-DEPT-NBR          06470000
               DISPLAY 'TCD TYPE ' WS035-TYPE.                          06480000
                                                                        06490000
      ******************************************************************06520000
      *  5000 THRU 5030 READ VARIOUS INPUT FILES.                       06530000
      ******************************************************************06540000
                                                                        06550000
       5000-READ-SMOOTH-I-DTL.                                          06560000
                                                                        06570000
      *************************************************************     06580000
      *   READ AHEAD LOGIC HAS RECORD IN THE INPUT AREA WAITING   *     06590000
      *   TO BE PROCESSED.                                        *     06600000
      *************************************************************     06610000
           IF PS-SMOOTH-I-DTL-AT-END-NO                                 06630000
               MOVE SMOOI-COMMON-RECALC-EXTRACT                         06640000
                                     TO WS070-COMMON-RECALC-EXTRACT     06650000
               MOVE WS070-DEPT-NBR                                      06700000
                                     TO PV-SMI-DTL-DEPT-NBR             06710000
               SET PS-SMOOTH-I-DTL-USED-NO                              06720000
                                     TO TRUE                            06730000
               PERFORM 5005-READ-SMOOTH-I-DTL                           06740000
           ELSE                                                         06750000
               MOVE PC-9999          TO PV-SMI-DTL-DEPT-NBR             06780000
               SET PS-ALL-DTL-DONE-YES                                  06790000
                                     TO TRUE                            06800000
           END-IF.                                                      06810000
                                                                        06820000
       5005-READ-SMOOTH-I-DTL.                                          06830000
                                                                        06840000
           SET PS-LAST-REC-FOR-DEPT-NO  TO TRUE.                        06850000
                                                                        06860000
           READ SMOOTH-I-DTL-IN                                         06870000
               AT END                                                   06880000
                   SET PS-LAST-REC-FOR-DEPT-YES                         06890000
                                        TO TRUE                         06900000
                   SET PS-SMOOTH-I-DTL-AT-END-YES                       06910000
                                        TO TRUE.                        06920000
                                                                        06930000
           IF PS-SMOOTH-I-DTL-AT-END-NO                                 06940000
               ADD +1 TO PA-SMOOTH-I-DTL-IN-CNT                         06950000
               IF PS-FIRST-READ-NO                                      06960000
                   IF (WS070-DEPT-NBR NOT EQUAL                         06970014
                                           SMOOI-DEPT-NBR)              06980014
                           SET PS-LAST-REC-FOR-DEPT-YES                 07060000
                                        TO TRUE                         07070000
                   END-IF                                               07080000
               ELSE                                                     07090000
                   SET PS-FIRST-READ-NO TO TRUE                         07100000
               END-IF                                                   07110000
           END-IF.                                                      07120000
                                                                        07130000
       5010-READ-TARGET-CALC-DATA.                                      07140000
                                                                        07150000
           READ TARGET-CALC-DATA INTO WS035-DATALESS-KEY-EXTRACT        07160000
               AT END                                                   07170000
                   SET PS-TARGET-CALC-DATA-AT-END-YES                   07180000
                                        TO TRUE                         07190000
                   MOVE PC-9999         TO PV-TCD-DEPT-NBR.             07220000
                                                                        07230000
           IF PS-TARGET-CALC-DATA-AT-END-NO                             07240000
               ADD +1 TO PA-TARGET-CALC-DATA-CNT                        07250000
               MOVE WS035-DEPT-NBR      TO PV-TCD-DEPT-NBR              07280000
               SET  PS-TARGET-CALC-DATA-USED-NO                         07290000
                                        TO TRUE                         07300000
      **** CALCULATE VARIANCE BETWEEN TMNDPT AND D/B/V TABLES.....      04211014
               COMPUTE PA-EIC-COST-TARGET-AMT =                         04212014
                    (WS035-TARGET-END-INV-COST-AMT -                    04213014
                     WS035-RECALC-END-INV-COST-AMT)                     04214014
I28582*        DISPLAY 'PV-TCD-DEPT-NBR ' PV-TCD-DEPT-NBR                       
I28582*        DISPLAY 'PA-EIC-COST-TARGET-AMT ' PA-EIC-COST-TARGET-AMT         
I28582*        DISPLAY 'WS035-TARGET-END-INV-COST-AMT '                         
I28582*                 WS035-TARGET-END-INV-COST-AMT                           
I28582*        DISPLAY 'WS035-RECALC-END-INV-COST-AMT '                         
I28582*                 WS035-RECALC-END-INV-COST-AMT                           
           END-IF.                                                      07310000
                                                                        07320000
       5050-WRITE-SMOOTH-II-DTL.                                        07330000
                                                                        07340000
I28582     IF WS070-INV-COST-ADJ2 IS EQUAL TO ZEROS                             
I28582       IF LEVEL-II-SMOOTH                                         00710010
I28582         MOVE SPACE              TO WS070-LVL2-SMOOTH-IND         00700010
I28582       ELSE                                                               
I28582       IF LEVEL-III-SMOOTH                                        00710010
I28582         MOVE SPACE              TO WS070-LVL3-SMOOTH-IND         00700010
I28582       ELSE                                                               
I28582         MOVE SPACE              TO WS070-LVL2-SMOOTH-IND         00700010
I28582         MOVE SPACE              TO WS070-LVL3-SMOOTH-IND         00700010
I28582       END-IF                                                             
I28582     ELSE                                                                 
I28582       IF LEVEL-II-SMOOTH                                         00710010
I28582         MOVE CC-SMOOTH-LVL-IND  TO WS070-LVL2-SMOOTH-IND         00700010
I28582       ELSE                                                               
I28582       IF LEVEL-III-SMOOTH                                        00710010
I28582         MOVE CC-SMOOTH-LVL-IND  TO WS070-LVL3-SMOOTH-IND         00700010
I28582       ELSE                                                               
I28582         MOVE CC-SMOOTH-LVL-IND  TO WS070-LVL2-SMOOTH-IND         00700010
I28582         MOVE CC-SMOOTH-LVL-IND  TO WS070-LVL3-SMOOTH-IND         00700010
I28582       END-IF                                                             
I28582     END-IF.                                                              
I28582                                                                  06055093
           ADD +1 TO PA-SMOOTH-II-DTL-OUT-CNT.                          07350000
                                                                        07360000
           WRITE SMOOTH-II-DTL-OUT-REC FROM                             07370000
                                       WS070-COMMON-RECALC-EXTRACT.     07380000
                                                                        07390000
I28582******************************************************************06051093
I28582* 7200-READ-SMOOTH-VERBIAGE.                                      06052093
I28582******************************************************************06053093
I28582 7200-READ-SMOOTH-VERBIAGE.                                       06054093
I28582                                                                  06055093
I28582     READ SMOOTH-VERBIAGE-IN INTO CC-SMOOTH-VERBIAGE-AREA         06056093
I28582         AT END SET PS-SMOOTH-VERB-DONE TO TRUE.                  06057093
I28582                                                                  06058093
      ******************************************************************09400000
      *  PERFORM THE NECESSARY END PROCESSING STEPS                     09410000
      ******************************************************************09420000
                                                                        09430000
       9000-END-PROCESSING.                                             09440000
                                                                        09450000
           IF PS-TARGET-CALC-DATA-AT-END-NO                             09460000
               PERFORM 9050-TARGET-CALC-DATA-FINISH                     09470000
                   UNTIL PS-TARGET-CALC-DATA-AT-END-YES.                09480000
                                                                        09490000
                                                                        09500000
           CLOSE TARGET-CALC-DATA                                       09510000
                 SMOOTH-I-DTL-IN                                        09520000
I28582           SMOOTH-VERBIAGE-IN                                     02290010
                 SMOOTH-II-DTL-OUT.                                     09540000
                                                                        09550000
           DISPLAY '*************************************************'  09560000
           DISPLAY 'PA-TARGET-CALC-DATA-CNT '                           09570000
                                     PA-TARGET-CALC-DATA-CNT.           09580000
           DISPLAY 'PA-SMOOTH-I-DTL-IN-CNT ' PA-SMOOTH-I-DTL-IN-CNT.    09590000
           DISPLAY 'PA-SMOOTH-II-DTL-OUT-CNT '                          09600000
                                     PA-SMOOTH-II-DTL-OUT-CNT.          09610000
           DISPLAY '*************************************************'. 09620000
                                                                        09630000
                                                                        09640000
       9050-TARGET-CALC-DATA-FINISH.                                    09650000
                                                                        09660000
                                                                        09670000
           PERFORM 5010-READ-TARGET-CALC-DATA.                          09680000
                                                                        09690000
                                                                        09700000
       9999-OTHER-ABEND.                                                09710000
                                                                        09720000
           DISPLAY '**  ABEND     **'.                                  09730000
           DISPLAY '**  PROGRAM   **  = ' PC-PGM-NAME.                  09740000
           DISPLAY '************************************************'.  09750000
           CALL 'ILBOABN0' USING ABEND-CODE.                            09760000
