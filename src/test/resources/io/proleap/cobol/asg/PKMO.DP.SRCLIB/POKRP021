000100*************************                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*************************                                         00030000
000400 PROGRAM-ID.      POKRP021.                                       00040000
000500 AUTHOR.          K. SCHOLEY.                                     00050000
000600 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00060000
000700 DATE-WRITTEN.    06/20/00.                                       00070000
000800 DATE-COMPILED.                                                   00080000
000900****************************************************************  00090000
001000* PURCHASE ORDERS FOR NEW STORES BY STORE GROUP FILES.            00100000
      * FILE 1 IS A CONSOLIDATED DETAIL LINE FOR EACH DEPARTMENT,       00110000
      * FOLLOWED BY THE DMM NO, DMM NAME, GMM NO, GMM NAME.             00120000
      * FILE 2 IS A SUMMARY OF GMM AND DMM TOTALS.                      00130000
      * BOTH FILES ARE CREATED WITH COMMA DELIMITERS BETWEEN EACH       00140000
      * DATA FIELD.                                                     00150000
      * THE FILES WILL BE FTP'D TO A DIRECTORY ON THE USER(S) SERVER.   00160000
      * USER WILL IMPORT THE FILE FROM THE DIRECTORY INTO EXCEL.        00170000
      * NOTE ! ! ! THIS PROGRAM USES COPYBOOK PORD004 AND HAS AN        00180000
      * IDENTICAL LAYOUT CALLED HOLD-PO004-RECORD. IF CHANGES ARE       00190000
      * MADE TO PORD004, THEY MUST ALSO BE MADE TO HOLD-PO004-RECORD    00200000
      * IN WORKING STORAGE.                                             00210000
      *---------------------------------------------------------------  00220000
      * 9/19/02 -- TOOK OUT ALL 'BUGDET' RELATED ITEMS AND FILE 2 DATA  00230000
      * EFFECTIVE WITH THE SPRING 2003 STORES WE WILL NOT INCLUDE ANY   00240000
      * BUDGET DATA NOR WILL WE SEND FILE 2 TO USERS. S.BARTELT         00250000
      *---------------------------------------------------------------  00260000
      * 9/28/06 -- TOOK OUT ALL GMM, DMM BREAKS AND DEPT DESCRIPTION    00270000
      * PER MARKET SOLUTIONS.    S.BARTELT                              00280000
      *---------------------------------------------------------------  00290000
      * 7/29/09 -- ADDED THE 4-DIGIT STORE NUMBER TO THE OUTPUT FILE    00300000
      * AND AS A HOLD FIELD.                                            00310000
      * ALSO CHANGED THE BREAK LOGIC - NOW WHEN EITHER THE DEPARTMENT   00320000
      * OR STORE NUMBER CHANGES, WRITE AN OUTPUT RECORD.                00330000
      * PER MARKET SOLUTIONS.    J.KRAMER                               00340000
      *---------------------------------------------------------------  00350000
      * 4/12/13 -- ADDED SQL TO GET ONHAND UNITS AND STORE ONHAND       00360000
      *            UNITS FOR THE OUTPUT FILE.     L.FRIESS              00370000
      *---------------------------------------------------------------* 00380000
C98147* 11/04/14 - RECOMPILED TO BRING IN PORD004 COPYBOOK WITH         00390000
C98147*            EXPANDED PO NUMBER.  MODIFIED HOLD-PO004-RECORD      00400000
C98147*            TO MATCH PORD004.              L.FRIESS              00410000
C98147*---------------------------------------------------------------* 00420000
001100****************************************************************  00430000
001200*                                                                 00440000
001300 ENVIRONMENT DIVISION.                                            00450000
001400*                                                                 00460000
001500*                                                                 00470000
001600 CONFIGURATION SECTION.                                           00480000
001700 SOURCE-COMPUTER. IBM-3090.                                       00490000
001800 OBJECT-COMPUTER. IBM-3090.                                       00500000
001900*                                                                 00510000
002000*                                                                 00520000
002100 INPUT-OUTPUT SECTION.                                            00530000
002200 FILE-CONTROL.                                                    00540000
002300                                                                  00550000
002400     SELECT DATE-FILE                                             00560000
002500         ASSIGN                       TO INP01.                   00570000
002930                                                                  00580000
002910     SELECT PO-FILE                                               00590000
002920         ASSIGN                       TO INP02.                   00600000
002930                                                                  00610000
003000     SELECT PRINT-REPORT                                          00620000
003100         ASSIGN                       TO RPT01.                   00630000
003200                                                                  00640000
003300     EJECT                                                        00650000
003500*                                                                 00660000
003600*                                                                 00670000
003700***************                                                   00680000
003800 DATA DIVISION.                                                   00690000
003900***************                                                   00700000
004000*                                                                 00710000
004100*                                                                 00720000
004200 FILE SECTION.                                                    00730000
004300                                                                  00740000
004400 FD  DATE-FILE                                                    00750000
004500     RECORDING MODE F                                             00760000
004600     LABEL RECORDS ARE STANDARD                                   00770000
004700     RECORD CONTAINS 80 CHARACTERS                                00780000
004800     BLOCK CONTAINS 0 RECORDS                                     00790000
004900     DATA RECORD IS DATA-LINE .                                   00800000
005000 01  DATE-REC                           PIC X(80).                00810000
005100                                                                  00820000
005901 FD  PO-FILE                                                      00830000
005902     RECORDING MODE F                                             00840000
005903     LABEL RECORDS ARE STANDARD                                   00850000
005904     RECORD CONTAINS 280 CHARACTERS                               00860000
005905     BLOCK CONTAINS 0 RECORDS                                     00870000
005906     DATA RECORD IS PO-FILE.                                      00880000
005910 01  PO-REC                           PIC X(280).                 00890000
005920                                                                  00900000
006000 FD  PRINT-REPORT                                                 00910000
006100     RECORDING MODE F                                             00920000
006200     BLOCK CONTAINS 0 RECORDS                                     00930000
006300     RECORD CONTAINS 132 CHARACTERS                               00940000
006400     LABEL RECORDS ARE OMITTED                                    00950000
006500     DATA RECORD IS PRINT-LINE.                                   00960000
006600*                                                                 00970000
006700 01  PRINT-LINE                                      PIC X(132).  00980000
006800                                                                  00990000
006900     EJECT                                                        01000000
007000*                                                                 01010000
007100 WORKING-STORAGE SECTION.                                         01020000
007200*                                                                 01030000
007300****************************************************************  01040000
007400** STANDARD HEADER LINE - KOHLS 150 COL                        *  01050000
007500****************************************************************  01060000
007600     COPY DPWS132O.                                               01070000
007700     EJECT                                                        01080000
007800*                                                                 01090000
007900 01 PV-PROGRAM-VARIABLES.                                         01100000
012000     05 PV-TOT-DEPT.                                              01110000
012100         10 PV-TOT-DEPT-ORDERED-RTL   PIC S9(09)V99 VALUE +0.     01120000
012200         10 PV-TOT-DEPT-INPROCESS-RTL PIC S9(09)V99 VALUE +0.     01130000
012300         10 PV-TOT-DEPT-VERIFIED-RTL  PIC S9(09)V99 VALUE +0.     01140000
               10 PV-TOT-DEPT-ORDERED-UNT   PIC S9(07)    VALUE +0.     01150000
               10 PV-TOT-DEPT-INPROCESS-UNT PIC S9(07)    VALUE +0.     01160000
               10 PV-TOT-DEPT-VERIFIED-UNT  PIC S9(07)    VALUE +0.     01170000
014000     05  PV-LINE-CNT                  PIC S9(3)     VALUE +0      01180000
014100                                                    COMP-3.       01190000
           05  PV-HOLD-REPORT-GMM           PIC X(03)     VALUE SPACES. 01200000
           05  PV-HOLD-REPORT-DMM           PIC X(03)     VALUE SPACES. 01210000
           05  PV-SUM-ONHAND-QTY            PIC S9(07)    COMP-3.       01220000
           05  PV-SUM-STORE-EXPECTED-QTY    PIC S9(07)    COMP-3.       01230000
           05  PV-NULL-IND                  PIC S9(4)     COMP.         01240000
           05  PV-ABEND-PARAGRAPH           PIC X(30)     VALUE SPACES. 01250000
016600*                                                                 01260000
016600*                                                                 01270000
016700 01  PV-ABEND-CODE                    PIC S9(04)     VALUE +0     01280000
016800                                                     COMP SYNC.   01290000
016900     88  ABEND-4001-WRITE-ERROR                      VALUE +4001. 01300000
017000     88  ABEND-4002-READ-ERROR                       VALUE +4002. 01310000
017100     88  ABEND-4003-CTRL-CARD-ERROR                  VALUE +4003. 01320000
017200     88  ABEND-4004-TABLE-ERROR                      VALUE +4004. 01330000
017300     88  ABEND-4005-OPEN-ERROR                       VALUE +4005. 01340000
017400     88  ABEND-4006-CLOSE-ERROR                      VALUE +4006. 01350000
017500     88  ABEND-4007-SEQUENCE-ERROR                   VALUE +4007. 01360000
017600     88  ABEND-4008-DATA-ERROR                       VALUE +4008. 01370000
017700     88  ABEND-4009-KEY-DATA-ERROR                   VALUE +4009. 01380000
018000     88  ABEND-4013-DB2-ERROR                        VALUE +4013. 01390000
018100*                                                                 01400000
       01 PV-RETAIL-TOTALS.                                             01410000
           05 DL-RTL-ORDERED                PIC 9(09)V99.               01420000
           05 DL-RTL-INPROCESS              PIC 9(09)V99.               01430000
           05 DL-RTL-VERIFIED               PIC 9(09)V99.               01440000
                                                                        01450000
023200 01  CD-CPU-DATE.                                                 01460000
023300     05  CD-CPU-YR                    PIC 9(2)       VALUE ZEROS. 01470000
023400     05  CD-CPU-MO                    PIC 9(2)       VALUE ZEROS. 01480000
023500     05  CD-CPU-DY                    PIC 9(2)       VALUE ZEROS. 01490000
024300*                                                                 01500000
024400 01  CT-CPU-TIME.                                                 01510000
024500     05  CT-CPU-HR                    PIC 9(2)       VALUE ZEROS. 01520000
024600     05  CT-CPU-MIN                   PIC 9(2)       VALUE ZEROS. 01530000
024700     05  CT-CPU-SEC                   PIC 9(2)       VALUE ZEROS. 01540000
024800     05  CT-CPU-HSEC                  PIC 9(2)       VALUE ZEROS. 01550000
036500*                                                                 01560000
      *01  HL-HEADING-LINE2.                                            01570000
      *    05  FILLER                       PIC X(8)       VALUE        01580000
      *        'GMM..:  '.                                              01590000
      *    05  FILLER                       PIC X(01)      VALUE ','.   01600000
      *    05  HL2-GMM-NO                   PIC X(03).                  01610000
      *    05  FILLER                       PIC X(01)      VALUE ','.   01620000
      *    05  HL2-GMM-NAME                 PIC X(25).                  01630000
      *    05  FILLER                       PIC X(94)      VALUE        01640000
      *                                                      SPACES.    01650000
036500*                                                                 01660000
      *01  HL-HEADING-LINE3.                                            01670000
      *    05  FILLER                       PIC X(8)       VALUE        01680000
      *        'DMM..:  '.                                              01690000
      *    05  FILLER                       PIC X(01)      VALUE ','.   01700000
      *    05  HL3-DMM-NO                   PIC X(03).                  01710000
      *    05  FILLER                       PIC X(01)      VALUE ','.   01720000
      *    05  HL3-DMM-NAME                 PIC X(25).                  01730000
      *    05  FILLER                       PIC X(94)      VALUE        01740000
      *                                                      SPACES.    01750000
036500*                                                                 01760000
036600 01  DETAIL-LINE.                                                 01770000
           05  DL-STORE-NBR                 PIC 9(04).                  01780000
           05  FILLER                       PIC X(01) VALUE ','.        01790000
036800     05  DL-DEPARTMENT-NBR            PIC 9(03).                  01800000
           05  FILLER                       PIC X(01) VALUE ','.        01810000
037200     05  DISP-DL-RTL-ORDERED          PIC 9(9).99.                01820000
           05  FILLER                       PIC X(01) VALUE ','.        01830000
037400     05  DL-UNITS-ORDERED             PIC 9(7).                   01840000
           05  FILLER                       PIC X(01) VALUE ','.        01850000
037200     05  DISP-DL-RTL-INPROCESS        PIC 9(9).99.                01860000
           05  FILLER                       PIC X(01) VALUE ','.        01870000
037400     05  DL-UNITS-INPROCESS           PIC 9(7).                   01880000
           05  FILLER                       PIC X(01) VALUE ','.        01890000
037200     05  DISP-DL-RTL-VERIFIED         PIC 9(9).99.                01900000
           05  FILLER                       PIC X(01) VALUE ','.        01910000
037400     05  DL-UNITS-VERIFIED            PIC 9(7).                   01920000
           05  FILLER                       PIC X(01) VALUE ','.        01930000
037400     05  DL-ONHAND-UNITS              PIC 9(7).                   01940000
           05  FILLER                       PIC X(01) VALUE ','.        01950000
037400     05  DL-STORE-ONHAND-UNITS        PIC 9(7).                   01960000
           05  FILLER                       PIC X(01) VALUE ','.        01970000
039200*                                                                 01980000
045800 01  PC-PROGRAM-CONSTANTS.                                        01990000
046000     05  PC-Y                         PIC X(01)      VALUE 'Y'.   02000000
           05  PC-ROW-NOT-FOUND             PIC S9(04)     VALUE +100   02010000
                                                           COMP SYNC.   02020000
048100*                                                                 02030000
048200 01  PS-PROGRAM-SWITCHES.                                         02040000
048900     05  PS-END-OF-DATE-REC           PIC X(01)      VALUE 'N'.   02050000
049000         88  END-OF-DATE-REC                         VALUE 'Y'.   02060000
049010     05  PS-END-OF-DEPT-REC-SW        PIC X(01)      VALUE 'N'.   02070000
049020         88  PS-END-OF-DEPT-REC                      VALUE 'Y'.   02080000
049010     05  PS-FIRST-DEPT-REC-SW         PIC X(01)      VALUE 'Y'.   02090000
049020         88  PS-FIRST-DEPT-REC                       VALUE 'Y'.   02100000
049020         88  PS-NOT-FIRST-DEPT-REC                   VALUE 'N'.   02110000
049010     05  PS-FIRST-GMM-REC-SW         PIC X(01)      VALUE 'Y'.    02120000
049020         88  PS-FIRST-GMM-REC                       VALUE 'Y'.    02130000
049020         88  PS-NOT-FIRST-GMM-REC                   VALUE 'N'.    02140000
049010     05  PS-NEW-DMM-SW               PIC X(01)      VALUE 'N'.    02150000
049020         88  PS-NEW-DMM                             VALUE 'Y'.    02160000
049020         88  PS-NOT-NEW-DMM                         VALUE 'N'.    02170000
049010     05  PS-NEW-GMM-SW               PIC X(01)      VALUE 'N'.    02180000
049020         88  PS-NEW-GMM                             VALUE 'Y'.    02190000
049020         88  PS-NOT-NEW-GMM                         VALUE 'N'.    02200000
      *                                                                 02210000
050900 01  DATE-RECORD.                                                 02220000
051000     05  DATE-RECORD-CC               PIC X(02)      VALUE SPACES.02230000
051100     05  DATE-RECORD-YR               PIC X(02)      VALUE SPACES.02240000
051200     05  FILLER                       PIC X(01)      VALUE SPACES.02250000
051300     05  DATE-RECORD-MO               PIC X(02)      VALUE SPACES.02260000
051400     05  FILLER                       PIC X(01)      VALUE SPACES.02270000
051500     05  DATE-RECORD-DY               PIC X(02)      VALUE SPACES.02280000
051600     05  FILLER                       PIC X(70)      VALUE SPACES.02290000
052500*                                                                 02300000
           COPY PORD004.                                                02310000
052500*                                                                 02320000
       01  HOLD-PO004-RECORD.                                           02330000
           05  PV-HOLD-GMM-NO               PIC X(03).                  02340000
           05  PV-HOLD-GMM-NAME             PIC X(25).                  02350000
           05  PV-HOLD-DMM-NO               PIC X(03).                  02360000
           05  PV-HOLD-DMM-NAME             PIC X(25).                  02370000
           05  PV-HOLD-BUYER-NO             PIC X(03).                  02380000
           05  PV-HOLD-BUYER-NAME           PIC X(25).                  02390000
           05  PV-HOLD-DEPT-NO.                                         02400000
               10  PV-HOLD-DEPT-NO-NUM      PIC 9(03).                  02410000
           05  PV-HOLD-DEPT-DES             PIC X(25).                  02420000
           05  PV-HOLD-MAJOR-CLASS-NO       PIC X(02).                  02430000
           05  PV-HOLD-MAJOR-CLASS-DES      PIC X(25).                  02440000
           05  PV-HOLD-VENDOR-NAME          PIC X(31).                  02450000
C98147     05  PV-HOLD-PO-NUMBER            PIC X(08).                  02460000
           05  PV-HOLD-PO-NUMBER-N REDEFINES PV-HOLD-PO-NUMBER          02470000
C98147                                      PIC ZZZZZZZ9.               02480000
           05  PV-HOLD-PO-STATUS-CDE        PIC X(2).                   02490000
           05  PV-HOLD-STORE-NBR            PIC S9(04) COMP.            02500000
C98147     05  FILLER                       PIC X(01).                  02510000
           05  PV-HOLD-STORE-NAME           PIC X(05).                  02520000
           05  PV-HOLD-ORDERED-RETAIL       PIC S9(9)V99 COMP-3.        02530000
           05  PV-HOLD-ORDERED-UNITS        PIC S9(07)   COMP-3.        02540000
           05  PV-HOLD-INPROCESS-RETAIL     PIC S9(9)V99 COMP-3.        02550000
           05  PV-HOLD-INPROCESS-UNITS      PIC S9(07)   COMP-3.        02560000
           05  PV-HOLD-INPROCESS-PCT        PIC 9(7).                   02570000
           05  PV-HOLD-VERIFIED-RETAIL      PIC S9(9)V99 COMP-3.        02580000
           05  PV-HOLD-VERIFIED-UNITS       PIC S9(07)   COMP-3.        02590000
           05  PV-HOLD-VERIFIED-PCT         PIC 9(7).                   02600000
           05  PV-HOLD-SHIP-DATE.                                       02610000
              10  PV-HOLD-SHIP-MO              PIC 9(02).               02620000
              10  PV-HOLD-SHIP-DY              PIC 9(02).               02630000
              10  PV-HOLD-SHIP-CCYY            PIC 9(04).               02640000
           05  PV-HOLD-CANCEL-DATE.                                     02650000
              10  PV-HOLD-CANCEL-MO            PIC 9(02).               02660000
              10  PV-HOLD-CANCEL-DY            PIC 9(02).               02670000
              10  PV-HOLD-CANCEL-CCYY          PIC 9(04).               02680000
           05  PV-HOLD-EXTENDED-DATE.                                   02690000
              10  PV-HOLD-EXTENDED-MO          PIC 9(02).               02700000
              10  PV-HOLD-EXTENDED-DY          PIC 9(02).               02710000
              10  PV-HOLD-EXTENDED-CCYY        PIC 9(04).               02720000
           05  PV-HOLD-INPROCESS-UNITS2        PIC S9(07)   COMP-3.     02730000
           05  PV-HOLD-ENROUTE-UNITS           PIC S9(07)   COMP-3.     02740000
C98147     05  FILLER                          PIC X(16).               02750000
      *                                                                 02760000
      *                                                                 02770000
      * SKU STORE TABLE                                                 02780000
           EXEC SQL                                                     02790000
                INCLUDE TSKST                                           02800000
           END-EXEC.                                                    02810000
      *                                                                 02820000
      * SKU CROSS REFERENCE TABLE                                       02830000
           EXEC SQL                                                     02840000
                INCLUDE TSKXREF                                         02850000
           END-EXEC.                                                    02860000
      *                                                                 02870000
      * PCT_TRN_CLSN_BAL TABLE                                          02880000
           EXEC SQL                                                     02890000
                INCLUDE PCT00014                                        02900000
           END-EXEC.                                                    02910000
      *                                                                 02920000
      * DB2 COMMUNICATION AREA                                          02930000
      *                                                                 02940000
           EXEC SQL                                                     02950000
               INCLUDE SQLCA                                            02960000
           END-EXEC.                                                    02970000
      *                                                                 02980000
      * DB2 COMMUNICATION AREA2                                         02990000
      *                                                                 03000000
           COPY SQLCA2.                                                 03010000
      *                                                                 03020000
      *                                                                 03030000
060000 EJECT                                                            03040000
066800****************************************************************  03050000
066900 PROCEDURE DIVISION.                                              03060000
067000****************************************************************  03070000
067100                                                                  03080000
067200****************************************************************  03090000
067300* A100-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE  *  03100000
067400* PROGRAM.                                                     *  03110000
067500****************************************************************  03120000
067600*                                                                 03130000
067700 A000-PROGRAM-MAINLINE.                                           03140000
067800                                                                  03150000
067900     PERFORM A010-INITIALIZATION.                                 03160000
                                                                        03170000
           PERFORM B100-PROCESS-DEPARTMENTS                             03180000
           UNTIL PS-END-OF-DEPT-REC.                                    03190000
                                                                        03200000
070300     PERFORM Z100-END-ROUTINE.                                    03210000
070400                                                                  03220000
070500     GOBACK.                                                      03230000
070600                                                                  03240000
070700     EJECT                                                        03250000
070800*                                                                 03260000
070900****************************************************************  03270000
071000* A010-INITIALIZATION OPENS ALL FILES AND INITAILZES ALL OF    *  03280000
071100* THE NECESSARY FIELDS.  ALSO IT CREATES THE REPORT HEADINGS   *  03290000
071200****************************************************************  03300000
071300 A010-INITIALIZATION.                                             03310000
071400                                                                  03320000
071500     OPEN  INPUT DATE-FILE                                        03330000
071610                 PO-FILE                                          03340000
071700          OUTPUT PRINT-REPORT.                                    03350000
073600                                                                  03360000
073700     ACCEPT CT-CPU-TIME FROM TIME.                                03370000
073800     ACCEPT CD-CPU-DATE FROM DATE.                                03380000
073900                                                                  03390000
074000     MOVE CT-CPU-HR                   TO DP132O-RUN-HOUR.         03400000
074100     MOVE CT-CPU-MIN                  TO DP132O-RUN-MINUTE.       03410000
074200                                                                  03420000
074300     MOVE CD-CPU-MO                   TO DP132O-RUN-MONTH.        03430000
074400     MOVE CD-CPU-DY                   TO DP132O-RUN-DAY.          03440000
074500     MOVE CD-CPU-YR                   TO DP132O-RUN-YEAR.         03450000
074600     MOVE 1                           TO DP132O-REPORT-NUMBER.    03460000
074700     MOVE 'POKRP021'                  TO DP132O-PROGRAM-NAME.     03470000
074800                                                                  03480000
074900     READ DATE-FILE           INTO DATE-RECORD                    03490000
075000          AT END                                                  03500000
075100             MOVE PC-Y          TO  PS-END-OF-DATE-REC.           03510000
075200                                                                  03520000
085400***************************************************************** 03530000
085500* B100-PROCESS-DEPARTMENTS.                                     * 03540000
085700***************************************************************** 03550000
085800 B100-PROCESS-DEPARTMENTS.                                        03560000
085900                                                                  03570000
            READ PO-FILE INTO PO004-RECORD                              03580000
              AT END                                                    03590000
      *PROCESS THE LAST RECORD IN HOLD                                  03600000
                PERFORM B300-GET-ONHAND-QTY                             03610000
                PERFORM B400-GET-STORE-EXPECTED-QTY                     03620000
                                                                        03630000
                PERFORM B200-PRINT-DEPARTMENT                           03640000
                SET PS-END-OF-DEPT-REC TO TRUE.                         03650000
085900                                                                  03660000
            IF NOT PS-END-OF-DEPT-REC                                   03670000
      *FIRST RECORD PROCESSING                                          03680000
              IF PS-FIRST-DEPT-REC                                      03690000
                 SET PS-NOT-FIRST-DEPT-REC TO TRUE                      03700000
      *ACCUMULATE FILE 1 DEPARTMENT TOTALS INTO PV FIELDS               03710000
                 PERFORM B205-COMMON-ROUTINE                            03720000
                                                                        03730000
              ELSE                                                      03740000
      *CHECK IF DPT HAS CHANGED                                         03750000
                 IF PO004-DEPT-NO = PV-HOLD-DEPT-NO                     03760000
                    AND PO004-STORE-NBR = PV-HOLD-STORE-NBR             03770000
      *ACCUMULATE FILE 1 DEPARTMENT TOTALS INTO PV FIELDS               03780000
                   PERFORM B205-COMMON-ROUTINE                          03790000
                 ELSE                                                   03800000
      *PROCESS THE "HELD" DEPARTMENT DETAIL RECORD - GET OH QTY         03810000
                   PERFORM B300-GET-ONHAND-QTY                          03820000
                   PERFORM B400-GET-STORE-EXPECTED-QTY                  03830000
                                                                        03840000
                   PERFORM B200-PRINT-DEPARTMENT                        03850000
                                                                        03860000
      *CHECK IF DMM HAS CHANGED FOR RPT 1 DMM HEADINGS                  03870000
                   IF PO004-DMM-NO = PV-HOLD-DMM-NO                     03880000
                     CONTINUE                                           03890000
                   ELSE                                                 03900000
                     SET PS-NEW-DMM TO TRUE                             03910000
                     MOVE PO004-DMM-NO TO PV-HOLD-REPORT-DMM            03920000
                   END-IF                                               03930000
                                                                        03940000
      *CHECK IF GMM HAS CHANGED FOR RPT 1 GMM HEADINGS                  03950000
                  IF PO004-GMM-NO = PV-HOLD-REPORT-GMM                  03960000
                      CONTINUE                                          03970000
                  ELSE                                                  03980000
                      IF PS-FIRST-GMM-REC                               03990000
                        SET PS-NOT-FIRST-GMM-REC TO TRUE                04000000
                      ELSE                                              04010000
                        SET PS-NEW-GMM TO TRUE                          04020000
                      END-IF                                            04030000
                      MOVE PO004-GMM-NO TO PV-HOLD-REPORT-GMM           04040000
                  END-IF                                                04050000
                                                                        04060000
                  IF PS-NEW-GMM                                         04070000
                     SET PS-NOT-NEW-GMM TO TRUE                         04080000
                  END-IF                                                04090000
                                                                        04100000
                  IF PS-NEW-DMM                                         04110000
                     SET PS-NOT-NEW-DMM TO TRUE                         04120000
                  END-IF                                                04130000
                                                                        04140000
                   PERFORM B205-COMMON-ROUTINE                          04150000
                                                                        04160000
                 END-IF                                                 04170000
              END-IF                                                    04180000
            END-IF.                                                     04190000
                                                                        04200000
095210***************************************************************** 04210000
095220* B200-PRINT-DEPARTMENT.                                        * 04220000
095230* PRINT CONSOLIDATED DEPARTMENT DETAIL FROM HOLD                * 04230000
095240***************************************************************** 04240000
095300 B200-PRINT-DEPARTMENT.                                           04250000
           MOVE PV-HOLD-DEPT-NO          TO DL-DEPARTMENT-NBR.          04260000
           MOVE PV-HOLD-STORE-NBR        TO DL-STORE-NBR.               04270000
           MOVE PV-TOT-DEPT-ORDERED-RTL  TO DL-RTL-ORDERED.             04280000
           MOVE PV-TOT-DEPT-ORDERED-UNT  TO DL-UNITS-ORDERED.           04290000
           MOVE PV-TOT-DEPT-VERIFIED-RTL TO DL-RTL-VERIFIED.            04300000
           MOVE PV-TOT-DEPT-VERIFIED-UNT TO DL-UNITS-VERIFIED.          04310000
           MOVE PV-TOT-DEPT-INPROCESS-RTL TO DL-RTL-INPROCESS.          04320000
           MOVE PV-TOT-DEPT-INPROCESS-UNT TO DL-UNITS-INPROCESS.        04330000
095400                                                                  04340000
           MOVE DL-RTL-ORDERED   TO DISP-DL-RTL-ORDERED.                04350000
           MOVE DL-RTL-INPROCESS TO DISP-DL-RTL-INPROCESS.              04360000
           MOVE DL-RTL-VERIFIED  TO DISP-DL-RTL-VERIFIED.               04370000
                                                                        04380000
           MOVE PV-SUM-ONHAND-QTY TO DL-ONHAND-UNITS.                   04390000
                                                                        04400000
           SUBTRACT PV-SUM-STORE-EXPECTED-QTY                           04410000
                 FROM PV-SUM-ONHAND-QTY                                 04420000
               GIVING DL-STORE-ONHAND-UNITS.                            04430000
                                                                        04440000
           MOVE DETAIL-LINE TO PRINT-LINE.                              04450000
           WRITE PRINT-LINE AFTER ADVANCING 1 LINE.                     04460000
                                                                        04470000
           ADD 1 TO PV-LINE-CNT.                                        04480000
                                                                        04490000
           MOVE ZEROS TO PV-TOT-DEPT-ORDERED-RTL                        04500000
                         PV-TOT-DEPT-ORDERED-UNT                        04510000
                         PV-TOT-DEPT-VERIFIED-RTL                       04520000
                         PV-TOT-DEPT-VERIFIED-UNT                       04530000
                         PV-TOT-DEPT-INPROCESS-RTL                      04540000
                         PV-TOT-DEPT-INPROCESS-UNT.                     04550000
095400                                                                  04560000
095210***************************************************************** 04570000
095220* B205-COMMON-ROUTINE.                                          * 04580000
095230* ADD TO DEPARTMENT ACCUMULATORS FOR FILE 1                     * 04590000
      * ADD TO DMM ACCUMULATORS FOR FILE 2                              04600000
      * MOVE CURRENT PORD004 TO HOLD                                    04610000
095240***************************************************************** 04620000
095300 B205-COMMON-ROUTINE.                                             04630000
           ADD PO004-ORDERED-RETAIL   TO                                04640000
               PV-TOT-DEPT-ORDERED-RTL.                                 04650000
           ADD PO004-VERIFIED-RETAIL  TO                                04660000
               PV-TOT-DEPT-VERIFIED-RTL.                                04670000
           ADD PO004-INPROCESS-RETAIL TO                                04680000
               PV-TOT-DEPT-INPROCESS-RTL.                               04690000
           ADD PO004-ORDERED-UNITS    TO                                04700000
               PV-TOT-DEPT-ORDERED-UNT.                                 04710000
           ADD PO004-VERIFIED-UNITS   TO                                04720000
               PV-TOT-DEPT-VERIFIED-UNT.                                04730000
           ADD PO004-INPROCESS-UNITS  TO                                04740000
               PV-TOT-DEPT-INPROCESS-UNT.                               04750000
           MOVE PO004-RECORD TO HOLD-PO004-RECORD.                      04760000
096300                                                                  04770000
095210***************************************************************** 04780000
095220* B220-PRINT-DMM-INFO.                                          * 04790000
095230* FILE 1                                                        * 04800000
095240***************************************************************** 04810000
095300*B220-PRINT-DMM-INFO.                                             04820000
095400*                                                                 04830000
      *    MOVE PO004-DMM-NO TO HL3-DMM-NO.                             04840000
      *    MOVE PO004-DMM-NAME TO HL3-DMM-NAME.                         04850000
      *                                                                 04860000
      *    WRITE PRINT-LINE FROM HL-HEADING-LINE3 AFTER ADVANCING       04870000
      *      1 LINES.                                                   04880000
                                                                        04890000
096310***************************************************************** 04900000
096320* B230-PRINT-GMM-INFO.                                          * 04910000
096330* FILE 1                                                        * 04920000
096340***************************************************************** 04930000
096400*B230-PRINT-GMM-INFO.                                             04940000
096500*                                                                 04950000
      *    MOVE PO004-GMM-NO TO HL2-GMM-NO.                             04960000
      *    MOVE PO004-GMM-NAME TO HL2-GMM-NAME.                         04970000
      *                                                                 04980000
      *    WRITE PRINT-LINE FROM HL-HEADING-LINE2 AFTER ADVANCING       04990000
      *      1 LINES.                                                   05000000
                                                                        05010000
                                                                        05020000
      ***************************************************************** 05030000
      * B300-GET-ONHAND-QTY.                                          * 05040000
      * THIS ONHAND QUANTITY IS FOR THE CSV FILE USED TO CREATE THE   * 05050000
      * NEW STORE % RECEIVED REPORT.                                  * 05060000
      ***************************************************************** 05070000
       B300-GET-ONHAND-QTY.                                             05080000
                                                                        05090000
           MOVE 'B300-GET-ONHAND-QTY' TO PV-ABEND-PARAGRAPH.            05100000
           MOVE PV-HOLD-DEPT-NO-NUM   TO SKXREF-DEPT.                   05110000
                                                                        05120000
           EXEC SQL                                                     05130000
             SELECT SUM(A.ONHAND_QTY)                                   05140000
               INTO :PV-SUM-ONHAND-QTY:PV-NULL-IND                      05150000
               FROM TSKST   A                                           05160000
                  , TSKXREF B                                           05170000
              WHERE A.ITEM_NMBR = B.ITM_NBR                             05180000
                AND B.DEPT    = :SKXREF-DEPT                            05190000
                AND A.LOC_NBR = :PV-HOLD-STORE-NBR                      05200000
              WITH UR                                                   05210000
           END-EXEC.                                                    05220000
                                                                        05230000
           EVALUATE TRUE                                                05240000
             WHEN SQLCODE = ZERO                                        05250000
               IF PV-NULL-IND < 0                                       05260000
                  MOVE ZERO TO PV-SUM-ONHAND-QTY                        05270000
               END-IF                                                   05280000
                                                                        05290000
             WHEN SQLCODE = PC-ROW-NOT-FOUND                            05300000
               MOVE ZERO TO PV-SUM-ONHAND-QTY                           05310000
                                                                        05320000
             WHEN OTHER                                                 05330000
               DISPLAY PV-ABEND-PARAGRAPH                               05340000
               DISPLAY '** PV-HOLD-DEPT-NO   = ' PV-HOLD-DEPT-NO        05350000
               DISPLAY '** PV-HOLD-STORE-NBR = ' PV-HOLD-STORE-NBR      05360000
               PERFORM Z999-SQL-ERROR                                   05370000
           END-EVALUATE.                                                05380000
                                                                        05390000
                                                                        05400000
      ***************************************************************** 05410000
      * B400-GET-STORE-EXPECTED-QTY.                                  * 05420000
      * THIS STORE EXPECTED QUANTITY IS USED TO CALCULATE STORE       * 05430000
      * ONHAND FOR THE NEW STORE % RECEIVED REPORT FILE.              * 05440000
      ***************************************************************** 05450000
       B400-GET-STORE-EXPECTED-QTY.                                     05460000
                                                                        05470000
           MOVE 'B400-GET-STORE-EXPECTED-QTY' TO PV-ABEND-PARAGRAPH.    05480000
           MOVE PV-HOLD-DEPT-NO-NUM           TO SKXREF-DEPT.           05490000
                                                                        05500000
           EXEC SQL                                                     05510000
             SELECT SUM(A.TRN_CLSN_QTY)                                 05520000
               INTO :PV-SUM-STORE-EXPECTED-QTY:PV-NULL-IND              05530000
               FROM PCT_TRN_CLSN_BAL A                                  05540000
                  , TSKXREF B                                           05550000
             WHERE  A.INTR_UPC_ID  = B.INTR_UPC_ID                      05560000
               AND  B.DEPT    = :SKXREF-DEPT                            05570000
               AND  A.LOC_NBR = :PV-HOLD-STORE-NBR                      05580000
               AND  A.TRN_CLSN_CDE = 'SE'                               05590000
             WITH UR                                                    05600000
           END-EXEC.                                                    05610000
                                                                        05620000
           EVALUATE TRUE                                                05630000
             WHEN SQLCODE = ZERO                                        05640000
               IF PV-NULL-IND < 0                                       05650000
                  MOVE ZERO TO PV-SUM-STORE-EXPECTED-QTY                05660000
               END-IF                                                   05670000
                                                                        05680000
             WHEN SQLCODE = PC-ROW-NOT-FOUND                            05690000
               MOVE ZERO TO PV-SUM-STORE-EXPECTED-QTY                   05700000
                                                                        05710000
             WHEN OTHER                                                 05720000
               DISPLAY PV-ABEND-PARAGRAPH                               05730000
               DISPLAY '** PV-HOLD-DEPT-NO   = ' PV-HOLD-DEPT-NO        05740000
               DISPLAY '** PV-HOLD-STORE-NBR = ' PV-HOLD-STORE-NBR      05750000
               PERFORM Z999-SQL-ERROR                                   05760000
           END-EVALUATE.                                                05770000
                                                                        05780000
                                                                        05790000
214300***************************************************************** 05800000
214400* Z100-END-ROUTINE                                              * 05810000
214600* END OF FILE PROCESSING, CLOSE FILES                           * 05820000
214700***************************************************************** 05830000
214800                                                                  05840000
214900 Z100-END-ROUTINE.                                                05850000
215000                                                                  05860000
219900     CLOSE DATE-FILE                                              05870000
220010           PO-FILE                                                05880000
220100           PRINT-REPORT.                                          05890000
220200                                                                  05900000
220300                                                                  05910000
                                                                        05920000
      ******************************************************************05930000
      *     SQL WARNING OR ERROR PROCESSING                            *05940000
      *                                                                *05950000
      ******************************************************************05960000
                                                                        05970000
       Z999-SQL-ERROR.                                                  05980000
      *---------------                                                  05990000
                                                                        06000000
           MOVE SQLCODE    TO SQLCODE2.                                 06010000
           MOVE SQLERRD(3) TO SQLERRD3.                                 06020000
           DISPLAY '** ABEND **       ** = SQLERROR'.                   06030000
           DISPLAY '** PROGRAM        ** = POKRP021'.                   06040000
           DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  06050000
           DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  06060000
           DISPLAY '** SQLERRM        ** = ' SQLERRM.                   06070000
           DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  06080000
           MOVE +4013 TO PV-ABEND-CODE.                                 06090000
           CALL 'ILBOABN0' USING PV-ABEND-CODE.                         06100000
      *                                                                 06110000
      ******************************************************************06120000
