00001 *-----------------------*                                         03/19/93
00002  IDENTIFICATION DIVISION.                                         DPKCS042
00003 *-----------------------*                                            LV011
00004  PROGRAM-ID.    DPKCS042.                                            CL**1
00005  AUTHOR.        PAT DOYLE - OMNI RESOURCES.                          CL**1
00006  INSTALLATION.  KOHLS DEPARTMENT STORES.                             CL**1
00007  DATE-WRITTEN.  03-16-93.                                            CL**1
00008  DATE-COMPILED.                                                      CL**1
00009                                                                      CL**1
00010 *---------------------------------------------------------------*    CL**1
00011 *    Z042 - MESSAGE REVIEW PROGRAM.                             *    CL**1
00012 *                                                               *    CL**1
00013 *    THIS PROGRAM DISPLAYS THE MESSAGE TEXT, LONG DESCRIPTION,  *    CL**1
00014 *    AND CORRECTIVE ACTION FOR A MESSAGE.  THE LONG DESCRIPTION *    CL**1
00015 *    AND CORRECTIVE ACTION AREA IS SCROLLABLE, IN CASE IT       *    CL**1
00016 *    DOESN'T FIT ON ONE SCREEN. A LOCAL FUNCTION PF KEY IS      *    CL**1
00017 *    PROVIDED, WHICH WILL UPDATE THE REVIEW INDICATOR TO SHOW   *    CL**1
00018 *    THAT THE MESSAGE HAS BEEN REVIEWED.                        *    CL**1
00019 *                                                               *    CL**1
262023*  CHANGED 09/28/2021    BY JIM HUNTER      WR: CHG0262023      *         
262023*  CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE  *         
262023*  MAKING THE CALL DYNAMIC VS STATIC                            *         
00020 *---------------------------------------------------------------*    CL**1
00021                                                                      CL**1
00022  ENVIRONMENT DIVISION.                                               CL**1
00023                                                                      CL**1
00024  DATA DIVISION.                                                      CL**1
00025                                                                      CL**1
00026  WORKING-STORAGE SECTION.                                            CL**1
00027                                                                      CL**1
00028  01  PC-PROGRAM-CONSTANTS.                                           CL**1
00029      05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE            CL**1
00030                                                     'DP042A  '.      CL**1
00031      05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE            CL**1
00032                                                     'DPKM042 '.      CL**1
00033      05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE            CL**1
00034                                                     'DPKCS042'.      CL**1
00035      05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.         CL**1
00036      05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.         CL**1
00037      05  PC-DTL-QUEUE-SEQ               PIC  9(01)  VALUE 3.         CL**1
00038      05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.       CL**1
00039      05  PC-LIST-FORMAT                 PIC  X(01)  VALUE '2'.       CL**1
00040      05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +13        CL**1
00041                                                     COMP SYNC.       CL**1
00042      05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2         CL**1
00043                                                     COMP SYNC.       CL**1
00044      05  PC-MAX-ITEMS                   PIC S9(09)  VALUE            CL**1
00045                                                     +1000000         CL**1
00046                                                     COMP-3.          CL**1
00047      05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5         CL**1
00048                                                     COMP SYNC.       CL**1
00049      05  PC-MAX-RETRIES                 PIC S9(3)    VALUE 3         CL**1
00050                                                      COMP-3.         CL**1
00051                                                                      CL**1
00052  01  PC-TSYMSG-NUMBERS.                                              CL**1
00053      05  PC-TSYMSG-00008                PIC 9(5)    VALUE 00008.     CL**1
00054      05  PC-TSYMSG-00050                PIC 9(5)    VALUE 00050.     CL**1
00055      05  PC-TSYMSG-00059                PIC 9(5)    VALUE 00059.     CL**7
00056      05  PC-TSYMSG-00069                PIC 9(5)    VALUE 00069.     CL**7
00057      05  PC-TSYMSG-00070                PIC 9(5)    VALUE 00070.     CL**1
00058      05  PC-TSYMSG-00101                PIC 9(5)    VALUE 00101.     CL**1
00059      05  PC-TSYMSG-00148                PIC 9(5)    VALUE 00148.     CL**1
00060      05  PC-TSYMSG-00279                PIC 9(5)    VALUE 00279.     CL**6
00061      05  PC-TSYMSG-00302                PIC 9(5)    VALUE 00302.     CL**1
00062                                                                      CL**1
00063  01  PS-PROGRAM-SUBSCRIPTS.                                          CL**1
00064      05  PS-SUB                         PIC S9(04)   VALUE +0        CL**1
00065                                                      COMP SYNC.      CL**1
00066                                                                      CL**1
00067  01  PS-PROGRAM-SWITCHES.                                            CL**1
00068      05  PS-ERROR-SW                    PIC X(01)    VALUE 'Y'.      CL**1
00069          88  PS-NO-ERROR                             VALUE 'Y'.      CL**1
00070          88  PS-ERROR                                VALUE 'N'.      CL**1
00071      05  PS-COMMAREA-SW                 PIC X(01)    VALUE 'N'.      CL**1
00072          88  PS-COMMAREA-VALID                       VALUE 'Y'.      CL**1
00073          88  PS-COMMAREA-NOT-VALID                   VALUE 'N'.      CL**1
00074      05  PS-LIST-END-SW                 PIC X(01)    VALUE 'N'.      CL**1
00075          88  PS-LIST-END                             VALUE 'Y'.      CL**1
00076          88  PS-NO-LIST-END                          VALUE 'N'.      CL**1
00077      EJECT                                                           CL**1
00078  01  PV-PROGRAM-VARIABLES.                                           CL**1
00079      05  PV-REMAINDER                   PIC S9(04)   VALUE +0        CL**1
00080                                                      COMP SYNC.      CL**1
00081      05  PV-READ-COUNT                  PIC S9(09)   VALUE +0        CL**1
00082                                                      COMP-3.         CL**1
00083      05  PV-TOP-ITEM                    PIC S9(09)   VALUE +0        CL**1
00084                                                      COMP-3.         CL**1
00085      05  PV-BOTTOM-ITEM                 PIC S9(09)   VALUE +0        CL**1
00086                                                      COMP-3.         CL**1
00087      05  PV-BLOCK-NUMBER                PIC S9(04)   VALUE +0        CL**1
00088                                                      COMP SYNC.      CL**1
00089      05  PV-CICS-RESP                   PIC S9(04)   VALUE +0        CL**1
00090                                                      COMP SYNC.      CL**1
00091      05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)   VALUE +0        CL**1
00092                                                      COMP SYNC.      CL**1
00093      05  PV-LIST-ITEM-NUMBER            PIC S9(04)   VALUE +0        CL**1
00094                                                      COMP SYNC.      CL**1
00095      05  PV-SQL-SUB                     PIC S9(4)    COMP.           CL**1
00096                                                                      CL**1
00097  01  PV-DB2-CRITERIA-AREA.                                           CL**1
00098      15  PV-DB2-MESSAGE-NUMBER          PIC S9(05)  VALUE ZERO       CL**1
00099                                                     COMP-3.          CL**1
00100                                                                      CL**1
      *---------------------------------------------------------------*         
      *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          *         
      *---------------------------------------------------------------*         
                                                                                
           COPY DPWS030.                                                        
           COPY DPWS930.                                                        
00107                                                                      CL**1
00108 *---------------------------------------------------------------*    CL**1
00109 *    STANDARD COMMAREA.                                         *    CL**1
00110 *---------------------------------------------------------------*    CL**1
00111                                                                      CL**1
00112      COPY DPWS020.                                                   CL**1
00113      05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                   CL**1
00114                                                                      CL**1
00115 *---------------------------------------------------------------*    CL**1
00116 *    INTER-APPLICATION COMMAREA.                                *    CL**1
00117 *---------------------------------------------------------------*    CL**1
00118                                                                      CL**1
00119          10  INTER-APPL-COMM-AREA       PIC X(200).                  CL**1
00120      COPY DPWS054.                                                   CL*11
00121      COPY DPWS056.                                                   CL*11
00122 *---------------------------------------------------------------*    CL**1
00123 *    SPECIFIC COMMMAREA FOR DPKCS042.                           *    CL**1
00124 *---------------------------------------------------------------*    CL**1
00125          10  ASC-SPECIFIC-COMMAREA.                                  CL**1
00126              15  ASC-LIST-KEYS.                                      CL**1
00127                  20  ASC-KEY-MESSAGE-NUMBER          PIC S9(05)      CL**1
00128                                                      COMP-3.         CL**1
00129                  20  ASC-KEY-SYSTEM-ID               PIC  X(02).     CL**1
00130                  20  ASC-KEY-MESSAGE-TEXT            PIC  X(70).     CL**1
00131              15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                   CL**1
00132                  20  ASC-ITEM-ARRAY.                                 CL**1
00133                                                                      CL**1
00134                      25  ASC-ITEM-ENTRIES OCCURS 13 TIMES.           CL**1
00135                          30  ASC-LIST-ITEM-NUMBER    PIC S9(09)      CL**1
00136                                                      COMP-3.         CL**1
00137                          30  ASC-TEXT                PIC X(70).      CL**1
00138                                                                      CL**1
00139              15  ASC-BLK-SUB                         PIC S9(04)      CL**1
00140                                                          COMP        CL**1
00141                                                          SYNC.       CL**1
00142              15  ASC-ITEM-SUB                        PIC S9(04)      CL**1
00143                                                          COMP        CL**1
00144                                                          SYNC.       CL**1
00145              15  ASC-SEL-SUB                         PIC S9(04)      CL**1
00146                                                          COMP.       CL**1
00147              15  ASC-SEL-ITEM                        PIC S9(04)      CL**1
00148                                                          COMP.       CL**1
00149              15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)      CL**1
00150                                                          COMP-3.     CL**1
00151              15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)      CL**1
00152                                                          COMP-3.     CL**1
00153              15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(05)      CL**1
00154                                                          COMP-3.     CL**1
00155              15  ASC-ITEMS-DISPLAYED                 PIC S9(03)      CL**1
00156                                                          COMP-3.     CL**1
00157              15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)      CL**1
00158                                                          COMP-3.     CL**1
00159              15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)      CL**1
00160                                                          COMP-3.     CL**1
00161              15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)      CL**1
00162                                                          COMP        CL**1
00163                                                          SYNC.       CL**1
00164              15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)      CL**1
00165                                                          COMP-3.     CL**1
00166              15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)      CL**1
00167                                                          COMP-3.     CL**1
00168              15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).     CL**1
00169                  88  ASC-ITEMS-LEFT-ON-DB              VALUE 'Y'.    CL**1
00170                  88  ASC-NO-ITEMS-LEFT-ON-DB           VALUE 'N'.    CL**1
00171              15  ASC-USE-SELECTION-QUEUE-IND         PIC  X(01).     CL**1
00172                  88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'.    CL**1
00173              15  ASC-DESC-LINE-IND                   PIC  X(01).     CL**1
00174                  88  ASC-DESC-LINE-DONE                VALUE 'Y'.    CL**1
00175              15  ASC-CORR-LINE-IND                   PIC  X(01).     CL**1
00176                  88  ASC-CORR-LINE-DONE                VALUE 'Y'.    CL**1
00177              15  ASC-LIST-QUEUE-NAME.                                CL**1
00178                  20  ASC-LIST-TERM-ID                PIC  X(04).     CL**1
00179                  20  ASC-LIST-TASK-NUMBER            PIC S9(05)      CL**1
00180                                                          COMP-3.     CL**1
00181                  20  ASC-LIST-SEQ                    PIC  9(01).     CL**1
00182              15  ASC-SEL-QUEUE-NAME.                                 CL**1
00183                  20  ASC-SEL-TERM-ID                 PIC  X(04).     CL**1
00184                  20  ASC-SEL-TASK-NUMBER             PIC S9(05)      CL**1
00185                                                           COMP-3.    CL**1
00186                  20  ASC-SEL-SEQ                     PIC  9(01).     CL**1
00187              15  ASC-DTL-QUEUE-NAME.                                 CL**1
00188                  20  ASC-DTL-TERM-ID                 PIC  X(04).     CL**1
00189                  20  ASC-DTL-TASK-NUMBER             PIC S9(05)      CL**1
00190                                                          COMP-3.     CL**1
00191                  20  ASC-DTL-SEQ                     PIC  9(01).     CL**1
00192                                                                      CL**1
00193              15  ASC-START-ITEM-REQUEST.                             CL**1
00194                  20  ASC-START-ITEM-REQUEST-N        PIC  9(05).     CL**1
00195                                                                      CL**1
00196      EJECT                                                           CL**1
00197 *---------------------------------------------------------------*    CL**1
00198 *    MESSAGE SELECTION TSQ B QUEUE RECORD LAYOUT.               *    CL**1
00199 *---------------------------------------------------------------*    CL**1
00200                                                                      CL**1
00201      COPY DPWS057.                                                   CL*11
00202                                                                      CL**1
00203      EJECT                                                           CL**1
00204 *---------------------------------------------------------------*    CL**1
00205 *    ABEND PROCESSING COPYBOOK.                                 *    CL**1
00206 *---------------------------------------------------------------*    CL**1
00207                                                                      CL**1
00208      COPY DPWS013.                                                   CL**1
00209                                                                      CL**1
00210      EJECT                                                           CL**1
00211 *---------------------------------------------------------------*    CL**1
00212 *    ATTRIBUTE SETTINGS COPYBOOK.                               *    CL**1
00213 *---------------------------------------------------------------*    CL**1
00214                                                                      CL**1
00215      COPY DPWS015.                                                   CL**1
00216                                                                      CL**1
00217 *---------------------------------------------------------------*    CL**1
00218 *    FUNCTION KEYS COPYBOOK.                                    *    CL**1
00219 *---------------------------------------------------------------*    CL**1
00220                                                                      CL**1
00221      COPY DPWS016.                                                   CL**1
00222                                                                      CL**1
00223 *---------------------------------------------------------------*    CL**1
00224 *    NUMERIC EDIT LAYOUT.                                       *    CL**1
00225 *---------------------------------------------------------------*    CL**1
00226                                                                      CL**1
00227      COPY DPWS010I.                                                  CL**1
00228                                                                      CL**1
00229 *---------------------------------------------------------------*    CL**1
00230 *    MAP LAYOUT                                                 *    CL**1
00231 *---------------------------------------------------------------*    CL**1
00232                                                                      CL**1
00233      COPY DPKM042.                                                   CL**1
00234                                                                      CL**1
00235  01  MR-OCCURS-LAYOUT          REDEFINES  DP042AO.                   CL**1
00236      05  FILLER                PIC X(134).                           CL**1
00237      05  MR-SCROLL-AREA OCCURS 13 TIMES.                             CL**1
00238          10  MR-TEXTL          PIC S9(04) COMP.                      CL**1
00239          10  MR-TEXTA          PIC  X(01).                           CL**1
00240          10  MR-TEXTC          PIC  X(01).                           CL**1
00241          10  MR-TEXTH          PIC  X(01).                           CL**1
00242          10  MR-TEXT           PIC  X(70).                           CL**1
00243                                                                      CL**1
00244  EJECT                                                               CL**1
00245 *---------------------------------------------------------------*    CL**1
00246 *    DB2 AREA FOR TMESSAGE                                      *    CL**1
00247 *---------------------------------------------------------------*    CL**1
00248      EXEC SQL                                                        CL**1
00249           INCLUDE TSYMSG                                             CL**1
00250      END-EXEC.                                                       CL**1
00251 *---------------------------------------------------------------*    CL**1
00252 *    DB2 AREA FOR MESSAGE TEXT AND CORRECTIVE ACTION            *    CL**1
00253 *---------------------------------------------------------------*    CL**1
00254      EXEC SQL                                                        CL**1
00255           INCLUDE TSYMSGT                                            CL**1
00256      END-EXEC.                                                       CL**1
00257 *---------------------------------------------------------------*    CL**1
00258 *    DB2 AREA FOR COMMUNICATIONS                                *    CL**1
00259 *---------------------------------------------------------------*    CL**1
00260      EXEC SQL                                                        CL**1
00261           INCLUDE SQLCA                                              CL**1
00262      END-EXEC.                                                       CL**1
00263                                                                      CL**1
00264 *---------------------------------------------------------------*    CL**1
00265 *    CURSOR TO OBTAIN LONG DESCRIPTION AND CORRECTIVE ACTION    *    CL**1
00266 *---------------------------------------------------------------*    CL**1
00267                                                                      CL**1
00268      EXEC SQL                                                        CL**1
00269           DECLARE TEXT-CSR CURSOR                                    CL**1
00270           FOR SELECT                                                 CL**1
00271                 TYP_CDE                                              CL**1
00272               , LNE_SEQ_NBR                                          CL**1
00273               , LNE_TXT                                              CL**1
00274           FROM                                                       CL**1
00275                 TSYMSGT                                              CL**1
00276           WHERE                                                      CL**1
00277                 SYMSG_NBR      = :PV-DB2-MESSAGE-NUMBER              CL**1
00278           ORDER BY                                                   CL**1
00279                 TYP_CDE                                              CL**1
00280               , LNE_SEQ_NBR                                          CL**1
00281      END-EXEC.                                                       CL**1
00282                                                                      CL**1
00283  EJECT                                                               CL**1
00284  LINKAGE SECTION.                                                    CL**1
00285                                                                      CL**1
00286  01  DFHCOMMAREA.                                                    CL**1
00287      05  FILLER                         OCCURS  1 TO 4072 TIMES      CL**1
00288                                         DEPENDING ON EIBCALEN.       CL**1
00289          10  FILLER                     PIC X.                       CL**1
00290                                                                      CL**1
00291  EJECT                                                               CL**1
00292  PROCEDURE DIVISION.                                                 CL**1
00293                                                                      CL**1
00294  0000-MAIN-MODULE.                                                   CL**1
00295                                                                      CL**1
00296      INITIALIZE DP030-CICS-API-FIELDS.                               CL**1
00297      MOVE +1                      TO DP030-NUMBER-OF-MAPS.           CL**1
00298      MOVE PC-CURRENT-MAPSET-NAME  TO DP030-MAPSET-NAME.              CL**1
00299      MOVE PC-CURRENT-MAP-NAME     TO DP030-MAP-NAME (1).             CL**1
00300      SET DP030-RECEIVE-APPL-MAP   TO TRUE.                           CL**1
00301      MOVE LENGTH OF DP042AI       TO DP030-MAP-LENGTH (1).           CL**2
00302      MOVE 'PROGRAM ENTRY CALL'    TO DP013-MESSAGE-TEXT (1).         CL**1
00303      PERFORM 0001-CALL-CICS-ARCH-API.                                CL**1
00304                                                                      CL**1
00305      PERFORM 1000-CONTROL-PROCESSING.                                CL**1
00306                                                                      CL**1
00307      MOVE 'PROGRAM EXIT CALL'     TO DP013-MESSAGE-TEXT (1).         CL**1
00308      PERFORM 0001-CALL-CICS-ARCH-API.                                CL**1
00309                                                                      CL**1
00310 *----------------------------------------------------------------*   CL**3
00311 *   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *   CL**3
00312 *   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *   CL**3
00313 *----------------------------------------------------------------*   CL**3
00314                                                                      CL**3
00315  0001-CALL-CICS-ARCH-API.                                            CL**1
00316                                                                      CL**1
00317      CALL DP930-CICS-ARCH-API USING DFHEIBLK                         CL**1
00318                                     DFHCOMMAREA                      CL**1
00319                                     DP030-CICS-API-FIELDS            CL**1
00320                                     DP020-STANDARD-COMMAREA          CL**1
00321                                     DP042AI.                         CL**2
00322                                                                      CL**1
00323      IF  DP030-RC-CALL-SUCCESSFUL                                    CL**1
00324          CONTINUE                                                    CL**1
00325      ELSE                                                            CL**1
00326          SET DP013-NO-ROLLBACK TO TRUE                               CL**1
00327          SET DP013-XCTL-DISPLAY-RESTART TO TRUE                      CL**1
00328          SET DP013-CICS-ABEND TO TRUE                                CL**1
00329          MOVE 'BEFORE 0000-MAIN-MODULE' TO DP013-PARAGRAPH           CL**1
00330          MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
00331 -             'N NEXT LINE'    TO DP013-MESSAGE-TEXT (2)                  
00332          MOVE DP030-RETURN-CODE                                      CL**1
00333                                TO DP013-MESSAGE-TEXT (3)             CL**1
00334          PERFORM DP013-0000-PROCESS-ABEND                            CL**1
00335      END-IF.                                                         CL**1
00336                                                                      CL**1
00337 *----------------------------------------------------------------*   CL**1
00338 * PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *   CL**1
00339 * COURSE OF ACTION IS FOR THIS TRANSACTION.                      *   CL**1
00340 *                                                                *   CL**1
00341 * NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *   CL**1
00342 *  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *   CL**1
00343 *  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *   CL**1
00344 *  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *   CL**1
00345 *----------------------------------------------------------------*   CL**1
00346                                                                      CL**1
00347  1000-CONTROL-PROCESSING.                                            CL**1
00348                                                                      CL**1
00349      EVALUATE TRUE                                                   CL**1
00350          WHEN DP020-NEXT-ACT-INITIAL                                 CL**1
00351              MOVE EIBTRMID          TO ASC-DTL-TERM-ID               CL**1
00352              MOVE DP020-SRC-TASK-NUMBER                              CL**1
00353                                     TO ASC-DTL-TASK-NUMBER           CL**1
00354              MOVE PC-DTL-QUEUE-SEQ  TO ASC-DTL-SEQ                   CL**1
00355              PERFORM 1100-PROCESS-INTER-APPL-COMM                    CL**1
00356 ***-----$TEMPLATE NOTE$-------------------------------------------   CL**1
00357 *** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,   CL**1
00358 *** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO     CL**1
00359 *** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.   CL**1
00360 ***---------------------------------------------------------------   CL**1
00361              IF  PS-COMMAREA-NOT-VALID                               CL**1
00362 ***              MOVE PC-TSYMSG-99901                                CL**1
00363 ***                            TO  DP020-MSG-NUMBER                  CL**1
00364 ***              SET DP020-MSG-FATAL                                 CL**1
00365 ***                            TO  TRUE                              CL**1
00366                  SET DP020-NEXT-ACT-APPL-ERROR                       CL**1
00367                                TO  TRUE                              CL**1
00368              ELSE                                                    CL**1
00369                  PERFORM 2050-DELETE-DETAIL-QUEUE                    CL**1
00370                  PERFORM 4000-BUILD-INITIAL-PANEL                    CL**1
00371              END-IF                                                  CL**1
00372                                                                      CL**1
00373          WHEN DP020-NEXT-ACT-READ-MAP                                CL**1
00374              MOVE ASC-ITEM-AT-TOP-OF-PANEL                           CL**1
00375                                TO PV-TOP-ITEM                        CL**1
00376              PERFORM 2000-PROCESS-PANEL                              CL**1
00377                                                                      CL**1
00378          WHEN DP020-NEXT-ACT-RETURN                                  CL**1
00379              MOVE ASC-ITEM-AT-TOP-OF-PANEL                           CL**1
00380                                TO PV-TOP-ITEM                        CL**1
00381              MOVE ZERO         TO ASC-ITEM-AT-TOP-OF-PANEL           CL**1
00382              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                    CL**1
00383                                                                      CL**1
00384          WHEN OTHER                                                  CL**1
00385              SET DP013-LOGIC-ABEND TO TRUE                           CL**1
00386              SET DP013-NO-ROLLBACK TO TRUE                           CL**1
00387              MOVE '1000-CONTROL-PROCESSING'                          CL**1
00388                                TO  DP013-PARAGRAPH                   CL**1
00389              MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'       CL**1
00390                                TO  DP013-MESSAGE-TEXT(1)             CL**1
00391              PERFORM DP013-0000-PROCESS-ABEND                        CL**1
00392      END-EVALUATE.                                                   CL**1
00393                                                                      CL**1
00394  EJECT                                                               CL**1
00395 *----------------------------------------------------------------*   CL**1
00396 * DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *   CL**1
00397 * IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *   CL**1
00398 *----------------------------------------------------------------*   CL**1
00399                                                                      CL**1
00400  1100-PROCESS-INTER-APPL-COMM.                                       CL**1
00401                                                                      CL**1
00402      SET PS-COMMAREA-VALID     TO TRUE.                              CL**1
00403      INITIALIZE ASC-SPECIFIC-COMMAREA.                               CL**1
00404      MOVE SPACE                TO ASC-START-ITEM-REQUEST.            CL**1
00405      EVALUATE DP020-INT-APPL-FORMAT-IND                              CL**1
00406          WHEN PC-CRIT-SPEC-FORMAT                                    CL**1
00407              IF DP054-MESSAGE-NUMBER > ZERO                          CL**1
00408                  MOVE DP054-MESSAGE-NUMBER                           CL**1
00409                                TO ASC-KEY-MESSAGE-NUMBER             CL**1
00410                                   PV-DB2-MESSAGE-NUMBER              CL**1
00411              ELSE                                                    CL**1
00412                  MOVE PC-TSYMSG-00148                                CL**1
00413                                TO DP020-MSG-NUMBER                   CL**1
00414                  SET DP020-MSG-FATAL TO TRUE                         CL**1
00415                  SET DP020-NEXT-ACT-APPL-ERROR TO TRUE               CL**1
00416              END-IF                                                  CL**1
00417          WHEN PC-LIST-FORMAT                                         CL**1
00418              SET ASC-USE-SELECTION-QUEUE TO TRUE                     CL**1
00419              MOVE DP056-NUMBER-OF-TS-ITEMS                           CL**1
00420                                TO ASC-NUMBER-OF-TS-ITEMS             CL**1
00421              MOVE DP056-SEL-QUEUE-NAME                               CL**1
00422                                TO ASC-SEL-QUEUE-NAME                 CL**1
00423              PERFORM 1120-PREPARE-LIST-ENTRY                         CL**1
00424          WHEN OTHER                                                  CL**1
00425              IF  DP020-NAV-KEY-DATA > SPACE                          CL**1
00426                  PERFORM 1110-EDIT-NAV-KEY                           CL**1
00427              ELSE                                                    CL**1
00428                  MOVE PC-TSYMSG-00148                                CL**1
00429                                TO DP020-MSG-NUMBER                   CL**1
00430                  SET DP020-MSG-FATAL TO TRUE                         CL**1
00431                  SET DP020-NEXT-ACT-APPL-ERROR TO TRUE               CL**1
00432              END-IF                                                  CL**1
00433      END-EVALUATE.                                                   CL**1
00434                                                                      CL**1
00435 *----------------------------------------------------------------*   CL**1
00436 *    EDIT THE KEY ENTERED BY THE USER INTO THE KEY FIELD OF THE  *   CL**1
00437 *    COMMAND LINE.  A VALID MESSAGE NUMBER IS THE ONLY KEY       *   CL**1
00438 *    ACCEPTED.                                                   *   CL**1
00439 *----------------------------------------------------------------*   CL**1
00440                                                                      CL**1
00441  1110-EDIT-NAV-KEY.                                                  CL**1
00442                                                                      CL**1
00443      MOVE DP020-NAV-KEY-DATA TO DP010I-UNEDITED-FIELD.               CL**1
00444      MOVE PC-MSG-NUMBER-LENGTH     TO DP010I-MAXIMUM-DIGITS.         CL**1
00445      MOVE ZERO                TO DP010I-MAXIMUM-DECIMALS.            CL**1
00446      SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                        CL**1
262023     CALL DP010I-NUMERIC-EDIT-ROUTINE                                     
262023          USING DP010I-NUMERIC-EDIT-AREA.                                 
00448      IF  DP010I-ERROR-DETECTED                                       CL**1
00449          SET PS-ERROR TO TRUE                                        CL**1
00450          SET DP020-MSG-FATAL TO TRUE                                 CL**1
00451          MOVE PC-TSYMSG-00302 TO DP020-MSG-NUMBER                    CL**1
00452          SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                       CL**1
00453      ELSE                                                            CL**1
00454          MOVE DP010I-NUMERIC-FIELD   TO ASC-KEY-MESSAGE-NUMBER       CL**1
00455                                         PV-DB2-MESSAGE-NUMBER        CL**1
00456      END-IF.                                                         CL**1
00457                                                                      CL**1
00458 *----------------------------------------------------------------*   CL**1
00459 *    GET READY TO START AT THE FIRST ITEM ON THE LIST.           *   CL**1
00460 *----------------------------------------------------------------*   CL**1
00461                                                                      CL**1
00462  1120-PREPARE-LIST-ENTRY.                                            CL**1
00463                                                                      CL**1
00464      MOVE DP057-MAX-ITEMS TO ASC-SEL-SUB.                            CL**1
00465      MOVE ZERO            TO ASC-SEL-ITEM.                           CL**1
00466      PERFORM 2140-GET-NEXT-MESSAGE.                                  CL**1
00467  EJECT                                                               CL**1
00468 *----------------------------------------------------------------*   CL**1
00469 *    RECEIVE THE MAP AND PERFORM THE APPROPRIATE PARAGRAPH BASED *   CL**1
00470 *    ON WHAT FUNCTION KEY WAS SELECTED.                          *   CL**1
00471 *----------------------------------------------------------------*   CL**1
00472                                                                      CL**1
00473  2000-PROCESS-PANEL.                                                 CL**1
00474                                                                      CL**1
00475      EVALUATE TRUE                                                   CL**1
00476          WHEN DP020-SRC-AID = DP016-CLEAR                            CL**1
00477              MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                   CL**1
00478              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                    CL**1
00479              PERFORM 3200-RESET-ATTRIBUTES                           CL**1
00480                                                                      CL**1
00481          WHEN DP020-FK-REFRESH (DP020-SRC-AID)                       CL**1
00482              MOVE ASC-KEY-MESSAGE-NUMBER                             CL**1
00483                                TO  PV-DB2-MESSAGE-NUMBER             CL**1
00484              PERFORM 2050-DELETE-DETAIL-QUEUE                        CL**1
00485              PERFORM 4000-BUILD-INITIAL-PANEL                        CL**1
00486              PERFORM 3200-RESET-ATTRIBUTES                           CL**1
00487                                                                      CL**1
00488          WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)                CL**1
00489              IF  ASC-USE-SELECTION-QUEUE                             CL**1
00490                  PERFORM 2140-GET-NEXT-MESSAGE                       CL**1
00491                  IF PS-LIST-END                                      CL**1
00492                      PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            CL**1
00493                      SET PS-NO-LIST-END TO TRUE                      CL**1
00494                  ELSE                                                CL**1
00495                      PERFORM 2050-DELETE-DETAIL-QUEUE                CL**1
00496                      PERFORM 4000-BUILD-INITIAL-PANEL                CL**1
00497                  END-IF                                              CL**1
00498                  PERFORM 3200-RESET-ATTRIBUTES                       CL**1
00499              ELSE                                                    CL**1
00500                  MOVE PC-TSYMSG-00070                                CL**1
00501                                   TO DP020-MSG-NUMBER                CL**1
00502                  SET DP020-MSG-INFORMATIONAL TO TRUE                 CL**1
00503              END-IF                                                  CL**1
00504                                                                      CL**1
00505          WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)                CL**1
00506              IF  ASC-USE-SELECTION-QUEUE                             CL**1
00507                  PERFORM 2150-GET-PREV-MESSAGE                       CL**1
00508                  IF PS-LIST-END                                      CL**1
00509                      PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            CL**1
00510                      SET PS-NO-LIST-END TO TRUE                      CL**1
00511                  ELSE                                                CL**1
00512                      PERFORM 2050-DELETE-DETAIL-QUEUE                CL**1
00513                      PERFORM 4000-BUILD-INITIAL-PANEL                CL**1
00514                  END-IF                                              CL**1
00515                  PERFORM 3200-RESET-ATTRIBUTES                       CL**1
00516              ELSE                                                    CL**1
00517                  MOVE PC-TSYMSG-00069                                CL**1
00518                                   TO DP020-MSG-NUMBER                CL**1
00519                  SET DP020-MSG-INFORMATIONAL TO TRUE                 CL**1
00520              END-IF                                                  CL**1
00521                                                                      CL**1
00522          WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                     CL**1
00523              MOVE +1 TO PV-TOP-ITEM                                  CL**1
00524              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                    CL**1
00525              PERFORM 3200-RESET-ATTRIBUTES                           CL**1
00526                                                                      CL**1
00527          WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                      CL**1
00528              PERFORM 2110-BROWSE-BACKWARD                            CL**1
00529              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                    CL**1
00530              PERFORM 3200-RESET-ATTRIBUTES                           CL**1
00531                                                                      CL**1
00532          WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                      CL**1
00533              PERFORM 2120-BROWSE-FORWARD                             CL**1
00534              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                    CL**1
00535              PERFORM 3200-RESET-ATTRIBUTES                           CL**1
00536                                                                      CL**1
00537          WHEN DP020-SRC-AID = DP016-ENTER                            CL**1
00538              PERFORM 2130-CHECK-FOR-JUMP-BROWSE                      CL**1
00539              IF  PS-ERROR                                            CL**1
00540                  CONTINUE                                            CL**1
00541              ELSE                                                    CL**1
00542                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                CL**1
00543                  PERFORM 3200-RESET-ATTRIBUTES                       CL**1
00544              END-IF                                                  CL**1
00545                                                                      CL**1
00546          WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)                 CL**7
00547              PERFORM 6000-UPDATE-SYSTEM-MESSAGE                      CL**7
00548 *            --- UPDATES SUCCESSFUL ---                              CL**7
00549              MOVE PC-TSYMSG-00059 TO DP020-MSG-NUMBER                CL**7
00550              SET DP020-MSG-INFORMATIONAL TO TRUE                     CL**7
00551                                                                      CL**7
00552          WHEN OTHER                                                  CL**1
00553              SET DP013-NO-ROLLBACK TO TRUE                           CL**1
00554              SET DP013-XCTL-DISPLAY-RESTART TO TRUE                  CL**1
00555              SET DP013-CICS-ABEND TO TRUE                            CL**1
00556              MOVE '2100-CHECK-FUNCTION-KEY' TO DP013-PARAGRAPH       CL**1
00557              MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'         CL**1
00558                                    TO DP013-MESSAGE-TEXT (1)         CL**1
00559              PERFORM DP013-0000-PROCESS-ABEND                        CL**1
00560                                                                      CL**1
00561      END-EVALUATE.                                                   CL**1
00562  EJECT                                                               CL**1
00563 *----------------------------------------------------------------*   CL**1
00564 *    DELETE THE TEMPORARY STORAGE QUEUE.                         *   CL**1
00565 *----------------------------------------------------------------*   CL**1
00566                                                                      CL**1
00567  2050-DELETE-DETAIL-QUEUE.                                           CL**1
00568                                                                      CL**1
00569      EXEC CICS                                                       CL**1
00570          DELETEQ TS                                                  CL**1
00571              QUEUE (ASC-DTL-QUEUE-NAME)                              CL**1
00572              RESP  (PV-CICS-RESP)                                    CL**1
00573      END-EXEC.                                                       CL**1
00574                                                                      CL**1
00575      IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                          CL**1
00576         (PV-CICS-RESP = DFHRESP(QIDERR))                             CL**1
00577          CONTINUE                                                    CL**1
00578      ELSE                                                            CL**1
00579          SET DP013-CICS-ABEND TO TRUE                                CL**1
00580          SET DP013-NO-ROLLBACK TO TRUE                               CL**1
00581                                                                      CL**1
00582          MOVE '2050-DELETE-DETAIL-QUEUE' TO DP013-PARAGRAPH          CL**1
00583          MOVE 'ERROR TRYING TO DELETE DETAIL TEMP STORAGE QUEUE'     CL**1
00584                         TO DP013-MESSAGE-TEXT (1)                    CL**1
00585          PERFORM DP013-0000-PROCESS-ABEND                            CL**1
00586      END-IF.                                                         CL**1
00587                                                                      CL**1
00588      MOVE +0 TO ASC-HIGHEST-BLOCK-WRITTEN.                           CL**1
00589  EJECT                                                               CL**1
00590 *----------------------------------------------------------------*   CL**1
00591 *    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *   CL**1
00592 *    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *   CL**1
00593 *    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *   CL**1
00594 *    MESSAGE.                                                    *   CL**1
00595 *----------------------------------------------------------------*   CL**1
00596                                                                      CL**1
00597  2110-BROWSE-BACKWARD.                                               CL**1
00598                                                                      CL**1
00599      SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL       CL**1
00600          GIVING PV-TOP-ITEM.                                         CL**1
00601                                                                      CL**1
00602      IF  PV-TOP-ITEM < +1                                            CL**1
00603          MOVE +1              TO PV-TOP-ITEM                         CL**1
00604 *        -- TOP OF LIST --                                           CL**1
00605          MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER                    CL**1
00606          SET DP020-MSG-INFORMATIONAL TO TRUE                         CL**1
00607      END-IF.                                                         CL**1
00608                                                                      CL**1
00609  EJECT                                                               CL**1
00610                                                                      CL**1
00611 *----------------------------------------------------------------*   CL**1
00612 *    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *   CL**1
00613 *    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *   CL**1
00614 *    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *   CL**1
00615 *----------------------------------------------------------------*   CL**1
00616                                                                      CL**1
00617  2120-BROWSE-FORWARD.                                                CL**1
00618                                                                      CL**1
00619      ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL                 CL**1
00620          GIVING PV-TOP-ITEM.                                         CL**1
00621      IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                      CL**1
00622          MOVE ASC-ITEM-AT-TOP-OF-PANEL                               CL**1
00623                                    TO PV-TOP-ITEM                    CL**1
00624 *        -- BOTTOM OF LIST --                                        CL**1
00625          MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER               CL**1
00626          SET DP020-MSG-INFORMATIONAL                                 CL**1
00627                                    TO TRUE                           CL**1
00628      ELSE                                                            CL**1
00629          COMPUTE PV-BOTTOM-ITEM =                                    CL**1
00630              PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                    CL**1
00631          IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ               CL**1
00632 *            -- BOTTOM OF LIST --                                    CL**1
00633              MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER               CL**1
00634              SET DP020-MSG-INFORMATIONAL                             CL**1
00635                                    TO TRUE                           CL**1
00636          END-IF                                                      CL**1
00637      END-IF.                                                         CL**1
00638  EJECT                                                               CL**1
00639 *----------------------------------------------------------------*   CL**1
00640 *    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *   CL**1
00641 *    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *   CL**1
00642 *    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *   CL**1
00643 *    RATHER THAN HITTING PF8 TO PAGE FORWARD TO THAT POINT.      *   CL**1
00644 *    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *   CL**1
00645 *    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *   CL**1
00646 *----------------------------------------------------------------*   CL**1
00647                                                                      CL**1
00648  2130-CHECK-FOR-JUMP-BROWSE.                                         CL**1
00649                                                                      CL**1
00650      IF ASTRTITL > ZERO                                              CL**1
00651          MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST         CL**1
00652      ELSE                                                            CL**1
00653          IF ASTRTITF = DP015-ERASE-EOF                               CL**1
00654              INITIALIZE ASC-START-ITEM-REQUEST                       CL**1
00655          END-IF                                                      CL**1
00656      END-IF.                                                         CL**1
00657                                                                      CL**1
00658      SET PS-NO-ERROR               TO TRUE.                          CL**1
00659      IF (ASC-START-ITEM-REQUEST = SPACE)                             CL**1
00660          MOVE ASC-ITEM-AT-TOP-OF-PANEL                               CL**1
00661                                    TO PV-TOP-ITEM                    CL**1
00662      ELSE                                                            CL**1
00663          MOVE ASC-START-ITEM-REQUEST                                 CL**1
00664                                    TO DP010I-UNEDITED-FIELD          CL**1
00665          MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS          CL**1
00666          MOVE +0                   TO DP010I-MAXIMUM-DECIMALS        CL**1
00667          SET DP010I-NEGATIVE-NOT-ALLOWED                             CL**1
00668                                    TO TRUE                           CL**1
262023         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
262023              USING DP010I-NUMERIC-EDIT-AREA                              
00670                                                                      CL**1
00671          IF  NOT DP010I-ERROR-DETECTED                               CL**1
00672              MOVE DP010I-NUMERIC-FIELD                               CL**1
00673                                    TO  ASC-START-ITEM-REQUEST-N      CL**1
00674              IF  ASC-START-ITEM-REQUEST-N > ZERO                     CL**1
00675                  IF  ASC-START-ITEM-REQUEST-N >                      CL**1
00676                                           ASC-NUMBER-OF-ITEMS-READ   CL**1
00677                      MOVE SPACE TO ASC-START-ITEM-REQUEST            CL**1
00678                      COMPUTE PV-TOP-ITEM =                           CL**1
00679                              ASC-NUMBER-OF-ITEMS-READ                CL**1
00680                              - PC-ITEMS-PER-PANEL + 1                CL**1
00681                      IF  PV-TOP-ITEM < +1                            CL**1
00682                          MOVE +1   TO PV-TOP-ITEM                    CL**1
00683                          MOVE PC-TSYMSG-00070                        CL**1
00684                                    TO DP020-MSG-NUMBER               CL**1
00685                          SET DP020-MSG-INFORMATIONAL                 CL**1
00686                                    TO TRUE                           CL**1
00687                      END-IF                                          CL**1
00688                  ELSE                                                CL**1
00689                      MOVE ASC-START-ITEM-REQUEST-N                   CL**1
00690                                    TO PV-TOP-ITEM                    CL**1
00691                      MOVE SPACE    TO ASC-START-ITEM-REQUEST         CL**1
00692                      COMPUTE PV-BOTTOM-ITEM =                        CL**1
00693                          PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1        CL**1
00694                      IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ   CL**1
00695 *                        -- BOTTOM OF LIST --                        CL**1
00696                          MOVE PC-TSYMSG-00070                        CL**1
00697                                    TO DP020-MSG-NUMBER               CL**1
00698                          SET DP020-MSG-INFORMATIONAL                 CL**1
00699                                    TO TRUE                           CL**1
00700                      END-IF                                          CL**1
00701                  END-IF                                              CL**1
00702              ELSE                                                    CL**1
00703 *                --- VALUE OUT OF RANGE ----                         CL**1
00704                  MOVE PC-TSYMSG-00101                                CL**1
00705                                    TO DP020-MSG-NUMBER               CL**1
00706                  MOVE -1           TO ASTRTITL                       CL**1
00707                  SET DP030-SET-CURSOR-APPL-1                         CL**1
00708                                    TO TRUE                           CL**1
00709                  MOVE DP015-REVERSE                                  CL**1
00710                                    TO ASTRTITH                       CL**1
00711                  MOVE DP015-RED    TO ASTRTITC                       CL**1
00712                  MOVE DP015-UNP-NUM-BRT-MDT                          CL**1
00713                                    TO ASTRTITA                       CL**1
00714                  SET DP020-MSG-FATAL                                 CL**1
00715                                    TO TRUE                           CL**1
00716                  SET PS-ERROR      TO TRUE                           CL**1
00717              END-IF                                                  CL**1
00718                                                                      CL**1
00719          ELSE                                                        CL**1
00720              MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER               CL**1
00721              MOVE -1               TO ASTRTITL                       CL**1
00722              SET DP030-SET-CURSOR-APPL-1 TO TRUE                     CL**1
00723              MOVE DP015-REVERSE    TO ASTRTITH                       CL**1
00724              MOVE DP015-RED        TO ASTRTITC                       CL**1
00725              MOVE DP015-UNP-NUM-BRT-MDT                              CL**1
00726                                    TO ASTRTITA                       CL**1
00727              SET DP020-MSG-FATAL   TO TRUE                           CL**1
00728              SET PS-ERROR          TO TRUE                           CL**1
00729          END-IF                                                      CL**1
00730      END-IF.                                                         CL**1
00731  EJECT                                                               CL**1
00732                                                                      CL**1
00733 *----------------------------------------------------------------*   CL**1
00734 *    GET THE NEXT MESSAGE IF A LIST OF MESSAGES IS BEING         *   CL**1
00735 *    PROCESSED.                                                  *   CL**1
00736 *----------------------------------------------------------------*   CL**1
00737                                                                      CL**1
00738  2140-GET-NEXT-MESSAGE.                                              CL**1
00739                                                                      CL**1
00740      ADD +1                       TO ASC-SEL-SUB.                    CL**1
00741      IF  ASC-SEL-SUB > DP057-MAX-ITEMS                               CL**1
00742          ADD +1                   TO ASC-SEL-ITEM                    CL**1
00743          MOVE +1                  TO ASC-SEL-SUB                     CL**1
00744      END-IF.                                                         CL**1
00745      IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                   CL**1
00746          PERFORM 9100-READ-SEL-QUEUE                                 CL**1
00747          IF  DP057-ITEM (ASC-SEL-SUB) > ZERO                         CL**1
00748              MOVE DP057-MESSAGE-NUMBER (ASC-SEL-SUB)                 CL**1
00749                                   TO ASC-KEY-MESSAGE-NUMBER          CL**1
00750                                      PV-DB2-MESSAGE-NUMBER           CL**1
00751              SET DP057-INQ (ASC-SEL-SUB) TO TRUE                     CL**1
00752              PERFORM 9200-REWRITE-SEL-QUEUE                          CL**1
00753          ELSE                                                        CL**1
00754              SUBTRACT +1 FROM ASC-SEL-SUB                            CL**1
00755              MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER                CL**1
00756              SET DP020-MSG-INFORMATIONAL TO TRUE                     CL**1
00757              SET PS-LIST-END             TO TRUE                     CL**1
00758          END-IF                                                      CL**1
00759      ELSE                                                            CL**1
00760          SUBTRACT +1 FROM ASC-SEL-ITEM                               CL**1
00761          MOVE DP057-MAX-ITEMS     TO ASC-SEL-SUB                     CL**1
00762          MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER                CL**1
00763          SET DP020-MSG-INFORMATIONAL TO TRUE                         CL**1
00764          SET PS-LIST-END             TO TRUE                         CL**1
00765      END-IF.                                                         CL**1
00766                                                                      CL**1
00767 *----------------------------------------------------------------*   CL**1
00768 *    GET THE PREVIOUS MESSAGE IF A LIST OF MESSAGES IS BEING     *   CL**1
00769 *    PROCESSED.                                                  *   CL**1
00770 *----------------------------------------------------------------*   CL**1
00771                                                                      CL**1
00772  2150-GET-PREV-MESSAGE.                                              CL**1
00773                                                                      CL**1
00774      SUBTRACT +1 FROM ASC-SEL-SUB.                                   CL**1
00775      IF  ASC-SEL-SUB < +1                                            CL**1
00776          SUBTRACT +1 FROM ASC-SEL-ITEM                               CL**1
00777          MOVE DP057-MAX-ITEMS     TO ASC-SEL-SUB                     CL**1
00778      END-IF.                                                         CL**1
00779                                                                      CL**1
00780      IF  ASC-SEL-ITEM > ZERO                                         CL**1
00781          PERFORM 9100-READ-SEL-QUEUE                                 CL**1
00782          MOVE DP057-MESSAGE-NUMBER (ASC-SEL-SUB)                     CL**1
00783                                   TO ASC-KEY-MESSAGE-NUMBER          CL**1
00784                                      PV-DB2-MESSAGE-NUMBER           CL**1
00785      ELSE                                                            CL**1
00786          MOVE +1                  TO ASC-SEL-ITEM                    CL**1
00787                                      ASC-SEL-SUB                     CL**1
00788          MOVE PC-TSYMSG-00069     TO DP020-MSG-NUMBER                CL**1
00789          SET DP020-MSG-INFORMATIONAL TO TRUE                         CL**1
00790          SET PS-LIST-END             TO TRUE                         CL**1
00791      END-IF.                                                         CL**1
00792                                                                      CL**1
00793  EJECT                                                               CL**1
00794 *----------------------------------------------------------------*   CL**1
00795 *    RESET ATTRIBUTES.                                           *   CL**1
00796 *----------------------------------------------------------------*   CL**1
00797                                                                      CL**1
00798  3200-RESET-ATTRIBUTES.                                              CL**1
00799                                                                      CL**1
00800      MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                      CL**1
00801      MOVE DP015-GREEN              TO ASTRTITC.                      CL**1
00802      MOVE DP015-UNDERLINE          TO ASTRTITH.                      CL**1
00803      MOVE -1                       TO ASTRTITL.                      CL**1
00804      SET DP030-SET-CURSOR-APPL-1   TO TRUE.                          CL**1
00805                                                                      CL**1
00806  EJECT                                                               CL**1
00807                                                                      CL**1
00808 *----------------------------------------------------------------*   CL**1
00809 *    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *   CL**1
00810 *    INITIALIZE ALL COUNTERS AND FLAGS.                          *   CL**1
00811 *    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *   CL**1
00812 *    DISPLAY THE PANEL TO USER.                                  *   CL**1
00813 *----------------------------------------------------------------*   CL**1
00814                                                                      CL**1
00815  4000-BUILD-INITIAL-PANEL.                                           CL**1
00816                                                                      CL**1
00817      INITIALIZE                  ASC-BLOCK-ENTRIES (1)               CL**1
00818                                  ASC-BLOCK-ENTRIES (2).              CL**1
00819      MOVE +1                 TO  ASC-BLK-SUB.                        CL**1
00820      SET ASC-ITEMS-LEFT-ON-DB                                        CL**1
00821                              TO  TRUE.                               CL**1
00822                                                                      CL**1
00823      MOVE +0                 TO  ASC-ITEM-SUB                        CL**1
00824                                  ASC-NUMBER-OF-ITEMS-READ            CL**1
00825                                  ASC-NUMBER-OF-SELECTED-ITEMS        CL**1
00826                                  ASC-HIGHEST-BLOCK-WRITTEN           CL**1
00827                                  ASC-START-OF-SELECTED-RANGE         CL**1
00828                                  ASC-END-OF-SELECTED-RANGE           CL**1
00829                                  ASC-ITEM-AT-TOP-OF-PANEL.           CL**1
00830                                                                      CL**1
00831      MOVE SPACE              TO  ASC-DESC-LINE-IND                   CL**1
00832                                  ASC-CORR-LINE-IND.                  CL**1
00833                                                                      CL**1
00834      PERFORM 4010-OPEN-CURSOR.                                       CL**1
00835                                                                      CL**1
00836      PERFORM 4300-READ-ITEMS-FROM-DB.                                CL**1
00837                                                                      CL**1
00838      PERFORM 4020-CLOSE-CURSOR.                                      CL**1
00839                                                                      CL**1
00840      MOVE +1                 TO  PV-TOP-ITEM.                        CL**1
00841      IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                             CL**1
00842          SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                       CL**1
00843          SET DP020-MSG-FATAL   TO  TRUE                              CL**1
00844          MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER                  CL**1
00845      ELSE                                                            CL**1
00846          MOVE -1             TO ASTRTITL                             CL**1
00847          SET DP030-SET-CURSOR-APPL-1 TO TRUE                         CL**1
00848          PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                        CL**1
00849      END-IF.                                                         CL**1
00850  EJECT                                                               CL**1
00851 *----------------------------------------------------------------*   CL**1
00852 * OPEN THE CURSOR.                                               *   CL**1
00853 *----------------------------------------------------------------*   CL**1
00854                                                                      CL**1
00855  4010-OPEN-CURSOR.                                                   CL**1
00856                                                                      CL**1
00857      EXEC SQL                                                        CL**4
00858           OPEN TEXT-CSR                                              CL**4
00859      END-EXEC.                                                       CL**4
00860                                                                      CL**4
00861      EVALUATE TRUE                                                   CL**4
00862          WHEN SQLCODE = ZERO                                         CL**4
00863               CONTINUE                                               CL**4
00864          WHEN SQLWARN0 NOT EQUAL SPACE                               CL**4
00865          WHEN SQLCODE NOT EQUAL ZERO                                 CL**4
00866               MOVE '4010-OPEN-CURSOR'                                CL**4
00867                            TO  DP013-PARAGRAPH                       CL**4
00868               MOVE 'OPEN MESSAGE CURSOR'                             CL**4
00869                            TO  DP013-MESSAGE-TEXT (1)                CL**4
00870               MOVE SQLCA   TO  DP013-SQLCA                           CL**4
00871               SET DP013-DB2-ABEND                                    CL**4
00872                            TO  TRUE                                  CL**4
00873               PERFORM DP013-0000-PROCESS-ABEND                       CL**4
00874      END-EVALUATE.                                                   CL**4
00875                                                                      CL**1
00876  EJECT                                                               CL**1
00877 *----------------------------------------------------------------*   CL**1
00878 * CLOSE THE CURSOR.                                              *   CL**1
00879 *----------------------------------------------------------------*   CL**1
00880                                                                      CL**1
00881  4020-CLOSE-CURSOR.                                                  CL**1
00882                                                                      CL**1
00883      EXEC SQL                                                        CL**4
00884          CLOSE TEXT-CSR                                              CL**4
00885      END-EXEC.                                                       CL**4
00886                                                                      CL**4
00887      EVALUATE TRUE                                                   CL**4
00888          WHEN SQLCODE = ZERO                                         CL**4
00889               CONTINUE                                               CL**4
00890          WHEN SQLWARN0 NOT EQUAL SPACE                               CL**4
00891          WHEN SQLCODE NOT EQUAL ZERO                                 CL**4
00892               MOVE '4020-CLOSE-CURSOR'                               CL**4
00893                            TO  DP013-PARAGRAPH                       CL**4
00894               MOVE 'CLOSE MESSAGE CURSOR'                            CL**4
00895                            TO  DP013-MESSAGE-TEXT (1)                CL**4
00896               MOVE SQLCA   TO  DP013-SQLCA                           CL**4
00897               SET DP013-DB2-ABEND                                    CL**4
00898                            TO  TRUE                                  CL**4
00899               PERFORM DP013-0000-PROCESS-ABEND                       CL**4
00900      END-EVALUATE.                                                   CL**4
00901                                                                      CL**1
00902  EJECT                                                               CL**1
00903 *----------------------------------------------------------------*   CL**1
00904 *    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *   CL**1
00905 *    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *   CL**1
00906 *    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *   CL**1
00907 *    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *   CL**1
00908 *    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *   CL**1
00909 *                                                                *   CL**1
00910 *    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *   CL**1
00911 *    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *   CL**1
00912 *    UPON INITIALIZATION.                                        *   CL**1
00913 *----------------------------------------------------------------*   CL**1
00914                                                                      CL**1
00915  4300-READ-ITEMS-FROM-DB.                                            CL**1
00916                                                                      CL**1
00917      EXEC SQL                                                        CL**1
00918          SELECT                                                      CL**1
00919               APLSYS_CDE                                             CL**1
00920             , SHT_TXT                                                CL**1
00921          INTO                                                        CL**1
00922               :ASC-KEY-SYSTEM-ID                                     CL**1
00923             , :ASC-KEY-MESSAGE-TEXT                                  CL**1
00924          FROM                                                        CL**1
00925               TSYMSG                                                 CL**1
00926          WHERE                                                       CL**1
00927               SYMSG_NBR = :PV-DB2-MESSAGE-NUMBER                     CL**1
00928      END-EXEC.                                                       CL**1
00929                                                                      CL**1
00930      PERFORM                                                         CL**1
00931          VARYING PV-READ-COUNT                                       CL**1
00932          FROM 1 BY 1                                                 CL**1
00933          UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                       CL**1
00934             OR (ASC-NO-ITEMS-LEFT-ON-DB))                            CL**1
00935                                                                      CL**1
00936          PERFORM 4310-FETCH                                          CL**1
00937                                                                      CL**1
00938          IF  ASC-ITEMS-LEFT-ON-DB                                    CL**1
00939              PERFORM 4320-GET-SUB                                    CL**1
00940              IF SYMSGT-TYP-CDE = 'D'                                 CL**1
00941                      AND NOT ASC-DESC-LINE-DONE                      CL**1
00942                  MOVE 'LONG DESCRIPTION:'                            CL**1
00943                                TO  ASC-TEXT                          CL**1
00944                                        (ASC-BLK-SUB                  CL**1
00945                                         ASC-ITEM-SUB)                CL**1
00946                  SET ASC-DESC-LINE-DONE TO TRUE                      CL**1
00947                  PERFORM 4320-GET-SUB                                CL**1
00948              END-IF                                                  CL**1
00949              IF SYMSGT-TYP-CDE = 'R'                                 CL**1
00950                      AND NOT ASC-CORR-LINE-DONE                      CL**1
00951                  MOVE ALL '-'  TO  ASC-TEXT                          CL**1
00952                                        (ASC-BLK-SUB                  CL**1
00953                                         ASC-ITEM-SUB)                CL**1
00954                  PERFORM 4320-GET-SUB                                CL**1
00955                  MOVE 'CORRECTIVE ACTION:'                           CL**1
00956                                TO  ASC-TEXT                          CL**1
00957                                        (ASC-BLK-SUB                  CL**1
00958                                         ASC-ITEM-SUB)                CL**1
00959                  SET ASC-CORR-LINE-DONE TO TRUE                      CL**1
00960                  PERFORM 4320-GET-SUB                                CL**1
00961              END-IF                                                  CL**1
00962              MOVE SYMSGT-LNE-TXT                                     CL**1
00963                                TO  ASC-TEXT                          CL**1
00964                                        (ASC-BLK-SUB                  CL**1
00965                                         ASC-ITEM-SUB)                CL**1
00966          END-IF                                                      CL**1
00967      END-PERFORM.                                                    CL**1
00968                                                                      CL**1
00969      IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                             CL**1
00970          PERFORM 4320-GET-SUB                                        CL**1
00971          MOVE                                                        CL**1
00972          '** NO LONG DESCRIPTION OR CORRECTIVE ACTION FOUND **'      CL**1
00973                                    TO  ASC-TEXT                      CL**1
00974                                            (ASC-BLK-SUB              CL**1
00975                                             ASC-ITEM-SUB)            CL**1
00976      END-IF.                                                         CL**1
00977                                                                      CL**1
00978      MOVE +1                       TO  ASC-BLK-SUB.                  CL**1
00979      PERFORM 5100-WRITE-TEMP-STORAGE.                                CL**1
00980      ADD +1                        TO  ASC-BLK-SUB.                  CL**1
00981      PERFORM 5100-WRITE-TEMP-STORAGE.                                CL**1
00982                                                                      CL**1
00983      MOVE 1                        TO  ASC-BLK-SUB                   CL**1
00984                                        PV-BLOCK-NUMBER.              CL**1
00985      PERFORM 4410-READ-TEMP-STORAGE.                                 CL**1
00986      IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1                    CL**1
00987          MOVE 2                    TO  ASC-BLK-SUB                   CL**1
00988                                        PV-BLOCK-NUMBER               CL**1
00989          PERFORM 4410-READ-TEMP-STORAGE                              CL**1
00990      END-IF.                                                         CL**1
00991  EJECT                                                               CL**1
00992 *----------------------------------------------------------------*   CL**1
00993 *    FETCH THE TEXT CURSOR.                                      *   CL**1
00994 *----------------------------------------------------------------*   CL**1
00995                                                                      CL**1
00996  4310-FETCH.                                                         CL**1
00997                                                                      CL**1
00998      PERFORM                                                         CL**1
00999          WITH TEST AFTER                                             CL**1
01000          VARYING PV-SQL-SUB                                          CL**1
01001          FROM 1 BY 1                                                 CL**1
01002          UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                CL**1
01003             OR SQLCODE = 0                                           CL**1
01004             OR SQLCODE = +100                                        CL**1
01005                                                                      CL**1
01006          EXEC SQL                                                    CL**1
01007               FETCH TEXT-CSR                                         CL**1
01008               INTO                                                   CL**1
01009                     :SYMSGT-TYP-CDE                                  CL**1
01010                   , :SYMSGT-LNE-SEQ-NBR                              CL**1
01011                   , :SYMSGT-LNE-TXT                                  CL**1
01012          END-EXEC                                                    CL**1
01013                                                                      CL**1
01014          EVALUATE TRUE                                               CL**1
01015              WHEN SQLCODE = ZERO                                     CL**1
01016              WHEN SQLCODE = +100                                     CL**1
01017              WHEN SQLCODE = -904                                     CL**1
01018              WHEN SQLCODE = -913                                     CL**1
01019                   CONTINUE                                           CL**1
01020              WHEN SQLWARN0 NOT EQUAL SPACE                           CL**1
01021              WHEN SQLCODE NOT EQUAL ZERO                             CL**1
01022                   MOVE '4310-FETCH-CURSOR'                           CL**1
01023                                TO  DP013-PARAGRAPH                   CL**1
01024                   MOVE 'FETCH MESSAGE CURSOR'                        CL**1
01025                                TO  DP013-MESSAGE-TEXT (1)            CL**1
01026                   MOVE SQLCA   TO  DP013-SQLCA                       CL**1
01027                   SET DP013-DB2-ABEND                                CL**1
01028                                TO  TRUE                              CL**1
01029                   PERFORM DP013-0000-PROCESS-ABEND                   CL**1
01030          END-EVALUATE                                                CL**1
01031      END-PERFORM.                                                    CL**1
01032                                                                      CL**1
01033      IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                      CL**1
01034          MOVE '4310-FETCH-CURSOR'                                    CL**1
01035                                TO  DP013-PARAGRAPH                   CL**1
01036          MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'                CL**1
01037                                TO  DP013-MESSAGE-TEXT (1)            CL**1
01038          MOVE SQLCA            TO  DP013-SQLCA                       CL**1
01039          SET DP013-DB2-ABEND   TO  TRUE                              CL**1
01040          PERFORM DP013-0000-PROCESS-ABEND                            CL**1
01041      END-IF.                                                         CL**1
01042                                                                      CL**1
01043      IF  SQLCODE EQUAL +100                                          CL**1
01044          SET ASC-NO-ITEMS-LEFT-ON-DB                                 CL**1
01045                                TO  TRUE                              CL**1
01046      END-IF.                                                         CL**1
01047                                                                      CL**1
01048  EJECT                                                               CL**1
01049 *----------------------------------------------------------------*   CL**1
01050 *    GET THE CORRECT SUBSCRIPTS FOR PLACING THE TEXT LINE.       *   CL**1
01051 *----------------------------------------------------------------*   CL**1
01052                                                                      CL**1
01053  4320-GET-SUB.                                                       CL**1
01054                                                                      CL**1
01055      IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                           CL**1
01056          ADD +1            TO  ASC-ITEM-SUB                          CL**1
01057      ELSE                                                            CL**1
01058          ADD +1            TO  ASC-BLK-SUB                           CL**1
01059          MOVE +1           TO  ASC-ITEM-SUB                          CL**1
01060                                                                      CL**1
01061          IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY                    CL**1
01062              MOVE +1       TO  ASC-BLK-SUB                           CL**1
01063              PERFORM 5100-WRITE-TEMP-STORAGE                         CL**1
01064              MOVE ASC-BLOCK-ENTRIES                                  CL**1
01065                        (PC-MAX-BLOCKS-IN-ARRAY)                      CL**1
01066              TO   ASC-BLOCK-ENTRIES(ASC-BLK-SUB)                     CL**1
01067              ADD +1        TO  ASC-BLK-SUB                           CL**1
01068              INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)              CL**1
01069          END-IF                                                      CL**1
01070      END-IF.                                                         CL**1
01071                                                                      CL**1
01072      ADD +1            TO ASC-NUMBER-OF-ITEMS-READ.                  CL**1
01073      MOVE ASC-NUMBER-OF-ITEMS-READ TO ASC-LIST-ITEM-NUMBER           CL**1
01074                                       (ASC-BLK-SUB                   CL**1
01075                                        ASC-ITEM-SUB).                CL**1
01076                                                                      CL**1
01077 *----------------------------------------------------------------*   CL**1
01078 *    FORMAT THE MAP AND DETERMINE THE CURSOR POSITION.           *   CL**1
01079 *----------------------------------------------------------------*   CL**1
01080                                                                      CL**1
01081  4400-MOVE-COMMAREA-TO-SCREEN.                                       CL**1
01082                                                                      CL**1
01083      MOVE ASC-KEY-MESSAGE-NUMBER TO AMSGNBRO.                        CL**1
01084      MOVE ASC-KEY-SYSTEM-ID      TO ASYSIDO.                         CL**1
01085      MOVE ASC-KEY-MESSAGE-TEXT   TO ASHMSGO.                         CL**1
01086                                                                      CL**1
01087      IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))                CL**1
01088          AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))             CL**1
01089          OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))             CL**1
01090              DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                CL**1
01091                  GIVING PV-BLOCK-NUMBER                              CL**1
01092                  REMAINDER PV-REMAINDER                              CL**1
01093              IF  PV-REMAINDER > ZERO                                 CL**1
01094                  ADD +1 TO PV-BLOCK-NUMBER                           CL**1
01095              END-IF                                                  CL**1
01096              MOVE +1    TO ASC-BLK-SUB                               CL**1
01097              PERFORM 4410-READ-TEMP-STORAGE                          CL**1
01098              ADD +1     TO ASC-BLK-SUB                               CL**1
01099                            PV-BLOCK-NUMBER                           CL**1
01100              PERFORM 4410-READ-TEMP-STORAGE                          CL**1
01101      END-IF.                                                         CL**1
01102      MOVE +1                       TO ASC-BLK-SUB.                   CL**1
01103      COMPUTE ASC-ITEM-SUB =                                          CL**1
01104          ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))                 CL**1
01105          + PC-ITEMS-PER-PANEL).                                      CL**1
01106                                                                      CL**1
01107      IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                           CL**1
01108          ADD +1   TO ASC-BLK-SUB                                     CL**1
01109          SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB               CL**1
01110      END-IF.                                                         CL**1
01111                                                                      CL**1
01112      COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                              CL**1
01113          ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                   CL**1
01114      PERFORM 4420-FORMAT-LIST-LINES                                  CL**1
01115          VARYING PS-SUB                                              CL**1
01116          FROM PC-ITEMS-PER-PANEL BY -1                               CL**1
01117          UNTIL PS-SUB < +1.                                          CL**1
01118                                                                      CL**1
01119      COMPUTE ASC-ITEMS-DISPLAYED =                                   CL**1
01120          ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).             CL**1
01121      MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL       CL**1
01122                                       ASTRTITO.                      CL**1
01123      MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                       CL**1
01124      MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                       CL**1
01125                                                                      CL**1
01126      IF  DP020-MSG-NUMBER-X = SPACE                                  CL**5
01127          IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ     CL**5
01128 *            --- MORE ITEMS TO DISPLAY ----                          CL**5
01129              MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER               CL**5
01130              SET DP020-MSG-INFORMATIONAL TO TRUE                     CL**5
01131          END-IF                                                      CL**5
01132      END-IF.                                                         CL**5
01133                                                                      CL**5
01134 *----------------------------------------------------------------*   CL**1
01135 *    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *   CL**1
01136 *----------------------------------------------------------------*   CL**1
01137                                                                      CL**1
01138  4410-READ-TEMP-STORAGE.                                             CL**1
01139                                                                      CL**1
01140      EXEC CICS                                                       CL**1
01141          READQ TS                                                    CL**1
01142              QUEUE (ASC-DTL-QUEUE-NAME)                              CL**1
01143              INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))                  CL**1
01144              ITEM  (PV-BLOCK-NUMBER)                                 CL**1
01145              RESP  (PV-CICS-RESP)                                    CL**1
01146      END-EXEC.                                                       CL**1
01147                                                                      CL**1
01148      IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                          CL**1
01149        OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                        CL**1
01150          CONTINUE                                                    CL**1
01151      ELSE                                                            CL**1
01152          SET DP013-CICS-ABEND TO  TRUE                               CL**1
01153          SET DP013-NO-ROLLBACK TO  TRUE                              CL**1
01154          MOVE '4410-READ-TEMP-STORAGE'                               CL**1
01155                                TO  DP013-PARAGRAPH                   CL**1
01156          MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'         CL**1
01157                                TO  DP013-MESSAGE-TEXT(1)             CL**1
01158          PERFORM DP013-0000-PROCESS-ABEND                            CL**1
01159      END-IF.                                                         CL**1
01160                                                                      CL**1
01161 *    SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.                CL**1
01162                                                                      CL**1
01163      IF  PV-CICS-RESP = DFHRESP (ITEMERR)                            CL**1
01164          INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)                  CL**1
01165      END-IF.                                                         CL**1
01166  EJECT                                                               CL**1
01167 *----------------------------------------------------------------*   CL**1
01168 *    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *   CL**1
01169 *----------------------------------------------------------------*   CL**1
01170                                                                      CL**1
01171  4420-FORMAT-LIST-LINES.                                             CL**1
01172                                                                      CL**1
01173      IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ         CL**1
01174          SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                   CL**1
01175          MOVE SPACE              TO MR-TEXT (PS-SUB)                 CL**1
01176      ELSE                                                            CL**1
01177          IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL              CL**1
01178              MOVE ASC-TEXT (ASC-BLK-SUB ASC-ITEM-SUB)                CL**1
01179                                  TO MR-TEXT (PS-SUB)                 CL**1
01180          END-IF                                                      CL**1
01181      END-IF.                                                         CL**1
01182      SUBTRACT +1 FROM ASC-ITEM-SUB.                                  CL**1
01183      IF  ASC-ITEM-SUB < + 1                                          CL**1
01184          MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                     CL**1
01185          MOVE +1                 TO ASC-BLK-SUB                      CL**1
01186      END-IF.                                                         CL**1
01187                                                                      CL**1
01188 *----------------------------------------------------------------*   CL**1
01189 *    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *   CL**1
01190 *----------------------------------------------------------------*   CL**1
01191                                                                      CL**1
01192  5100-WRITE-TEMP-STORAGE.                                            CL**1
01193                                                                      CL**1
01194      MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                        CL**1
01195                                TO  PV-LIST-ITEM-NUMBER.              CL**1
01196      COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                              CL**1
01197          ASC-HIGHEST-BLOCK-WRITTEN + 1.                              CL**1
01198                                                                      CL**1
01199      EXEC CICS                                                       CL**1
01200          WRITEQ TS                                                   CL**1
01201              QUEUE (ASC-DTL-QUEUE-NAME)                              CL**1
01202              FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))                  CL**1
01203              ITEM  (PV-HIGHEST-BLOCK-WRITTEN)                        CL**1
01204              RESP  (PV-CICS-RESP)                                    CL**1
01205      END-EXEC.                                                       CL**1
01206                                                                      CL**1
01207      IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                         CL**1
01208          SET DP013-CICS-ABEND                                        CL**1
01209                        TO  TRUE                                      CL**1
01210          SET DP013-NO-ROLLBACK                                       CL**1
01211                        TO  TRUE                                      CL**1
01212          MOVE '5100-WRITE-TEMP-STORAGE'                              CL**1
01213                        TO  DP013-PARAGRAPH                           CL**1
01214          MOVE 'ATTEMPTING TO WRITE TEMP STORAGE LIST BLOCK'          CL**1
01215                        TO  DP013-MESSAGE-TEXT(1)                     CL**1
01216          PERFORM DP013-0000-PROCESS-ABEND                            CL**1
01217      END-IF.                                                         CL**1
01218      ADD +1            TO  ASC-HIGHEST-BLOCK-WRITTEN.                CL**1
01219                                                                      CL**1
01220  EJECT                                                               CL**1
01221                                                                      CL**8
01222 *----------------------------------------------------------------*   CL**7
01223 * APPLY THE CHANGES TO THE MESSAGE TO THE DB2 TABLE.             *   CL**7
01224 *----------------------------------------------------------------*   CL**7
01225                                                                      CL**8
01226  6000-UPDATE-SYSTEM-MESSAGE.                                         CL**7
01227                                                                      CL**8
01228      MOVE ASC-KEY-MESSAGE-NUMBER   TO PV-DB2-MESSAGE-NUMBER.         CL*10
01229      MOVE 'Y'                      TO SYMSG-REV-IND.                 CL**9
01230      PERFORM 6100-UPDATE-MESSAGE.                                    CL**7
01231      IF  ASC-USE-SELECTION-QUEUE                                     CL**7
01232          PERFORM 6200-UPDATE-SELECTION-QUEUE                         CL**7
01233      END-IF.                                                         CL**7
01234                                                                      CL**8
01235 *----------------------------------------------------------------*   CL**7
01236 *  UPDATE THE ROW ON THE DB2 TABLE.                              *   CL**7
01237 *----------------------------------------------------------------*   CL**7
01238                                                                      CL**8
01239  6100-UPDATE-MESSAGE.                                                CL**7
01240                                                                      CL**8
01241      PERFORM                                                         CL**7
01242          WITH TEST AFTER                                             CL**7
01243          VARYING PV-SQL-SUB                                          CL*10
01244          FROM 1 BY 1                                                 CL**7
01245          UNTIL ((PV-SQL-SUB > PC-MAX-RETRIES)                        CL*10
01246                    OR (SQLCODE = ZERO))                              CL**7
01247          EXEC SQL                                                    CL**7
01248              UPDATE TSYMSG                                           CL**7
01249                  SET REV_IND = :SYMSG-REV-IND                        CL**9
01250              WHERE SYMSG_NBR = :PV-DB2-MESSAGE-NUMBER                CL**9
01251          END-EXEC                                                    CL**7
01252                                                                      CL**7
01253          EVALUATE TRUE                                               CL**7
01254              WHEN SQLCODE = ZERO                                     CL**7
01255              WHEN SQLCODE = -904                                     CL**7
01256              WHEN SQLCODE = -913                                     CL**7
01257                  CONTINUE                                            CL**7
01258              WHEN SQLWARN0 NOT = SPACES                              CL**7
01259              WHEN SQLCODE < ZERO                                     CL**7
01260              WHEN SQLCODE > ZERO                                     CL**7
01261                  MOVE '6100-UPDATE-MESSAGE'                          CL**7
01262                                    TO DP013-PARAGRAPH                CL**7
01263                  MOVE 'UPDATE A ROW ON THE SYSTEM MESSAGE TABLE'     CL**7
01264                                    TO DP013-MESSAGE-TEXT(1)          CL**7
01265                  MOVE SQLCA        TO DP013-SQLCA                    CL**7
01266                  MOVE 'TSYMSG'     TO DP013-DB2-TABLE-NAME (1)       CL**7
01267                  SET DP013-DB2-ABEND                                 CL**7
01268                      DP013-XCTL-DISPLAY-RESTART TO TRUE              CL**7
01269                  PERFORM DP013-0000-PROCESS-ABEND                    CL**7
01270          END-EVALUATE                                                CL**7
01271      END-PERFORM.                                                    CL**7
01272                                                                      CL**9
01273      IF  PV-SQL-SUB > PC-MAX-RETRIES                                 CL*10
01274          MOVE '6100-UPDATE-MESSAGE'                                  CL**7
01275                                    TO DP013-PARAGRAPH                CL**7
01276          MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO UPDATE A SYS   CL**7
01277 -             'TEM MESSAGE'        TO DP013-MESSAGE-TEXT (1)         CL**7
01278          MOVE SQLCA                TO DP013-SQLCA                    CL**7
01279          MOVE 'TSYMSG '            TO DP013-DB2-TABLE-NAME (1)       CL**7
01280          SET DP013-DB2-ABEND                                         CL**7
01281              DP013-XCTL-DISPLAY-RESTART                              CL**7
01282                                    TO TRUE                           CL**7
01283          PERFORM DP013-0000-PROCESS-ABEND                            CL**7
01284      END-IF.                                                         CL**7
01285                                                                      CL**8
01286  EJECT                                                               CL**7
01287                                                                      CL**8
01288 *----------------------------------------------------------------*   CL**7
01289 * RECORD IN THE SELECTION TEMP STORAGE QUEUE THE FACT THAT THIS  *   CL**7
01290 * OBJECT WAS UDPATED.                                            *   CL**7
01291 *----------------------------------------------------------------*   CL**7
01292                                                                      CL**8
01293  6200-UPDATE-SELECTION-QUEUE.                                        CL**7
01294                                                                      CL**8
01295      PERFORM 9100-READ-SEL-QUEUE.                                    CL**7
01296      SET DP057-UPD (ASC-SEL-SUB) TO TRUE.                            CL**7
01297      PERFORM 9200-REWRITE-SEL-QUEUE.                                 CL*10
01298                                                                      CL**8
01299  EJECT                                                               CL**7
01300                                                                      CL**8
01301 *----------------------------------------------------------------*   CL**1
01302 * READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *   CL**1
01303 *----------------------------------------------------------------*   CL**1
01304                                                                      CL**1
01305  9100-READ-SEL-QUEUE.                                                CL**1
01306                                                                      CL**8
01307      EXEC CICS                                                       CL**1
01308          READQ TS                                                    CL**1
01309              QUEUE (ASC-SEL-QUEUE-NAME)                              CL**1
01310              INTO  (DP057-MESSAGE-SEL-REC)                           CL**1
01311              ITEM  (ASC-SEL-ITEM)                                    CL**1
01312              RESP  (PV-CICS-RESP)                                    CL**1
01313      END-EXEC.                                                       CL**1
01314                                                                      CL**1
01315      IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                          CL**1
01316          CONTINUE                                                    CL**1
01317      ELSE                                                            CL**1
01318          SET DP013-LOGIC-ABEND                                       CL**1
01319              DP013-NO-ROLLBACK     TO TRUE                           CL**1
01320          MOVE '9100-READ-SEL-QUEUE'                                  CL**1
01321                                    TO DP013-PARAGRAPH                CL**1
01322          MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'      CL**1
01323                                    TO DP013-MESSAGE-TEXT (1)         CL**1
01324          PERFORM DP013-0000-PROCESS-ABEND                            CL**1
01325      END-IF.                                                         CL**1
01326                                                                      CL**8
01327 *----------------------------------------------------------------*   CL**1
01328 * UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *   CL**1
01329 *----------------------------------------------------------------*   CL**1
01330                                                                      CL**8
01331  9200-REWRITE-SEL-QUEUE.                                             CL**1
01332                                                                      CL**8
01333      EXEC CICS                                                       CL**1
01334           WRITEQ TS                                                  CL**1
01335               QUEUE  (ASC-SEL-QUEUE-NAME)                            CL**1
01336               FROM   (DP057-MESSAGE-SEL-REC)                         CL**1
01337               ITEM   (ASC-SEL-ITEM)                                  CL**1
01338               RESP   (PV-CICS-RESP)                                  CL**1
01339               REWRITE                                                CL**1
01340      END-EXEC.                                                       CL**1
01341                                                                      CL**1
01342      IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                      CL**1
01343          SET DP013-CICS-ABEND                                        CL**1
01344              DP013-NO-ROLLBACK     TO TRUE                           CL**1
01345          MOVE '9200-REWRITE-SEL-QUEUE'                               CL**1
01346                                    TO DP013-PARAGRAPH                CL**1
01347          MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'      CL**1
01348                                    TO DP013-MESSAGE-TEXT (1)         CL**1
01349          PERFORM DP013-0000-PROCESS-ABEND                            CL**1
01350      END-IF.                                                         CL**1
01351                                                                      CL**1
01352  EJECT                                                               CL**1
01353                                                                      CL**8
01354 *----------------------------------------------------------------*   CL**1
01355 *    ABEND PROCESSOR MODULE                                      *   CL**1
01356 *----------------------------------------------------------------*   CL**1
01357                                                                      CL**1
01358      COPY DPPD013.                                                   CL**1
