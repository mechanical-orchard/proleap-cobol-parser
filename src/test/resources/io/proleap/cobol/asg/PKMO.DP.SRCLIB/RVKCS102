000100*-----------------------*                                         00010099
000200 IDENTIFICATION DIVISION.                                         00020099
000300*-----------------------*                                         00030099
000400 PROGRAM-ID.    RVKCS102.                                         00040099
000500 AUTHOR.        MIKE FURLICK.                                     00050099
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060099
000700 DATE-WRITTEN.  12-03-92.                                         00070099
000800 DATE-COMPILED.                                                   00080099
000900                                                                  00090099
001000*---------------------------------------------------------------* 00100099
001100*    T102 - REQUEST RA DETAIL UPDATE LIST.                      * 00110099
001200*                                                               * 00120099
001300*    THIS PROGRAM GENERATES THE REQUEST FOR RETURN AUTHORIZATION* 00130099
001400*    LIST.  THE USER CAN SELECT MULTIPLE ITEMS FOR INQUIRY,     * 00140099
001500*    UPDATE AND DELETE PROCESSING.                              * 00150099
001600*                                                               * 00160099
001700*---------------------------------------------------------------* 00170099
001800* 12/04/96 - TCM -  WR NO. 3904                                 * 00180099
001900*    - REPLACE ALL "++INCLUDE" REFERENCES WITH "COPY"           * 00190099
002000*      REFERENCES, PER STANDARDS                                * 00200099
002100*    - ADD CODING TO REMOVE TDFCTOR.DFCT_ORD_ID_CDE = 'M'       * 00210099
002200*      ("MARKOUT" ORDERS) FROM BEING PROCESSED BY THIS PROGRAM  * 00220099
002300*---------------------------------------------------------------* 00230099
002400* 12/04/96 - TCM -  WR NO. 3904                                 * 00240099
002500*    - DISALLOW UPDATE/DELETE ABILITY, RETAINING ABILITY TO     * 00250099
002600*      LIST LINES, FOR "MARKOUT" ORDERS                         * 00260099
002700*---------------------------------------------------------------* 00270099
002800* 12/04/96 - TCM -  WR NO. 3904                                 * 00280099
002900*    - DISALLOW UPDATE/DELETE ABILITY FOR "MARKOUT" ORDERS THAT * 00290099
003000*      ARE NOT ORDER-STATUS "OPEN"                              * 00300099
003100*---------------------------------------------------------------* 00310099
003200* 01/23/97 - TCM -  WR NO. 3904                                 * 00320099
003300*    - ADD UPDATING/DELETING OF CORRESPONDING PERM IN-STORE     * 00330099
003400*      RECORDS, BASED ON LISTING UPDATES, FOR PERM DOCUMENTS    * 00340099
003500*      ON "MARKOUT" ORDERS THAT ARE NOT ORDER-STATUS "OPEN"     * 00350099
003600*      NOTE: - LINES ON A COMPLETED PERM CANNOT BE              * 00360099
003700*                UPDATED/DELETED                                * 00370099
003800*            - DELETING ALL LINES ON A PERM, WILL CAUSE THE     * 00380099
003900*                PERM TO BE CANCELED                            * 00390099
004000*    - CHANGE PROGRAM BLOCKING FACTOR (PV-TW-ITEM-ENTRIES       * 00400099
004100*      AND ASSOCIATED FIELDS) FROM 18 TO 11                     * 00410099
004200*    - ADD TDFMEIT.MKOUT_ORD_ID TO ITEM-NUMBER-CSR CURSOR       * 00420099
004300*    - REMOVE RETRY LOGIC WHERE IT IS NO LONGER APPROPRIATE     * 00430099
004400*---------------------------------------------------------------* 00440099
004500* 04/01/97 - TCM -  WR NO. 3904                                 * 00450099
004600*    - ADD STR_NBR FIELD TO WHERE CLAUSE IN                     * 00460099
004700*      L300-SELECT-IN-STORE-DTL SQL SELECT CALL                 * 00470099
004800*---------------------------------------------------------------* 00480099
004900* 04/12/03 - V RAMAKRISHNA PRASAD, IGSI - WR NO. 23022          * 00490099
005000*    - IN THE MAP RVKM102, SKU WAS REPLACED WITH DEPT, UPC AND  * 00500099
005100*      LENGTH OF STATUS CODE, DESCRIPTION FIELD WAS REDUCED TO  * 00510099
005200*      1, 17 RESPECTIVELY. AND ALSO CHANGED THE ATTRIBUTES OF   * 00520099
005300*      UNIT COST FIELD TO MAKE IT AS NON EDITED FIELD.          * 00530099
005400*    - RVKM102-OCCURS-LAYOUT STRUCTURE WAS CHANGED ACCORDING TO * 00540099
005500*      TO THE MAP CHANGES.                                      * 00550099
005600*    - IN RV102-SPECIFIC-COMMAREA, PV-TEMP-WORK-AREA STRUCTURES * 00560099
005700*      SKU WAS REPLACED WITH DEPT, MAJOR CLASS, SUBCLASS, SKU   * 00570099
005800*      AND LENGTH OF STATUS CODE, DESCRIPTION FIELD WAS REDUCED * 00580099
005900*      TO 1, 17 RESPECTIVELY.                                   * 00590099
006000*    - ALL REFERENCES TO TSK TABLE WAS REPLACED WITH XLT_SKU,   * 00600099
006100*      XLT_VND_STYL, XLT_UPC TABLES.                            * 00610099
006200*    - CHANGED THE UNIT COST FIELD TO NON EDITED FIELD.         * 00620099
006300*    - 3 DIGIT DEPARTMENT, 2 DIGIT CLASS, 3 DIGIT SEQUENCE      * 00630099
006400*      NUMBER FROM TSPPCDT TABLE WERE REPLACED WITH 4 DIGIT     * 00640099
006500*      DEPARTMENT, 4 DIGIT SUBCLASS, 8 DIGIT SKU.               * 00650099
006600* 07/24/03 - ABRAHAM JACOB, IBM GLOBAL SERVICES   WR 23022      * 00660099
006700*    - PROGRAM NOW DISPLAYS INTERNAL UPC.                       * 00670099
006800* 10/30/03 - PAUL OMAN, WR23568  - ONLY DELETE RVT_DFCT_SHIPT   * 00680099
006900*      WHEN ALL OF THE LISTINGS ASSOCIATED WITH THE SHIPMENT    * 00690099
007000*      ARE GONE. ADDED PARAS O270, O280, AND O290.              * 00700099
007100*---------------------------------------------------------------* 00710099
007200* 02/02/04 - JOE LAROSA, WR23568  - CHANGED PROGRAM TO NOT      * 00720099
007300*      ALLOW LISTING TO BE UPDATED OR DELETED IF THE STATUS     * 00730099
007400*      IS SHIPPED, APPROVED OR DISPOSED.                        * 00740099
007500*---------------------------------------------------------------* 00750099
007510* 11/11/04 - VIRGENE LENNEMAN, WR26853 - REPLACED TSTR000 WITH  * 00751099
007520*      XLT_LOC AND XLT_DC_LOC_ASGMT. RENAMED STR_NBR TO         * 00752099
007530*      DEST_LOC_NBR FOR TABLES TSTRPPC AND TSPPCDT. REMOVED     * 00753099
007531*      REFERENCE TO OPERCO_NBR WHICH IS NO LONGER ON THESE TBLS.* 00753199
007540*---------------------------------------------------------------* 00754099
007560* CHANGED 11/04/2021    BY JIM HUNTER      WR: CHG0263627         00756099
007570* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00757099
007580* MAKING THE CALL DYNAMIC VS STATIC.                              00758099
007590*---------------------------------------------------------------* 00759099
007600                                                                  00760099
007700 ENVIRONMENT DIVISION.                                            00770099
007800                                                                  00780099
007900 DATA DIVISION.                                                   00790099
008000                                                                  00800099
008100 WORKING-STORAGE SECTION.                                         00810099
008200                                                                  00820099
008300 01  PC-PROGRAM-CONSTANTS.                                        00830099
008400     05  PC-NAVIGATOR-TRAN-ID           PIC X(04)    VALUE 'Z008'.00840099
008500     05  PC-MENU-TRAN-ID                PIC X(04)    VALUE 'Z007'.00850099
008600     05  PC-MAXIMUM-COMMAREA-LENGTH     PIC S9(04)   VALUE +4072  00860099
008700                                                     COMP SYNC.   00870099
008800     05  PC-CURRENT-MAP-NAME            PIC X(08)    VALUE        00880099
008900     'RV102A  '.                                                  00890099
009000     05  PC-CURRENT-MAPSET-NAME         PIC X(08)    VALUE        00900099
009100     'RVKM102 '.                                                  00910099
009200     05  PC-CURRENT-PROGRAM-NAME        PIC X(08)    VALUE        00920099
009300     'RVKCS102'.                                                  00930099
009400     05  PC-BEGINNING                   PIC X(01)    VALUE 'B'.   00940099
009500     05  PC-ENDING                      PIC X(01)    VALUE 'E'.   00950099
009600     05  PC-SELECTED                    PIC X(01)    VALUE 'S'.   00960099
009700     05  PC-ITEMS-PER-PANEL             PIC S9(04)   VALUE +11    00970099
009800                                                     COMP SYNC.   00980099
009900     05  PC-ITEMS-PER-BLOCK             PIC S9(04)   VALUE +11    00990099
010000                                                     COMP SYNC.   01000099
010100     05  PC-MAX-ITEMS-TO-BE-READ        PIC S9(04)   VALUE +100   01010099
010200                                                     COMP SYNC.   01020099
010300     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)   VALUE +2     01030099
010400                                                     COMP SYNC.   01040099
010500     05  PC-MAX-WR-ITEMS                PIC S9(03)   VALUE +100   01050099
010600                                                     COMP-3.      01060099
010700     05  PC-MAX-ITEMS                   PIC S9(09)   VALUE        01070099
010800                                                     +1000000     01080099
010900                                                     COMP-3.      01090099
011000     05  PC-BLOCK-LENGTH                PIC S9(04)   VALUE +1314  01100099
011100                                                     COMP SYNC.   01110099
011200     05  PC-FIELD-LENGTH                PIC S9(04)   VALUE +5     01120099
011300                                                     COMP SYNC.   01130099
011400     05  PC-ERASE-EOF-COMP              PIC S9(04)   VALUE +128   01140099
011500                                                     COMP SYNC.   01150099
011600     05  FILLER REDEFINES PC-ERASE-EOF-COMP.                      01160099
011700         10  FILLER                     PIC X(01).                01170099
011800         10  PC-ERASE-EOF               PIC X(01).                01180099
011900     05  PC-MAX-RETRIES                 PIC S9(3)    VALUE 3      01190099
012000                                                     COMP-3.      01200099
012100     05  PC-PERCENT                     PIC X(1)     VALUE '%'.   01210099
012200     05  PC-COMPANY                     PIC X(2)     VALUE '03'.  01220099
012300     05  PC-ZERO2                       PIC X(2)     VALUE '00'.  01230099
012400     05  PC-ZERO3                       PIC X(3)     VALUE '000'. 01240099
012500     05  PC-ONE                         PIC  9       VALUE 1.     01250099
012600     05  PC-TEN                         PIC  99      VALUE 10.    01260099
012700     05  PC-DPT                         PIC X(3)     VALUE 'DPT'. 01270099
012800     05  PC-BYR                         PIC X(3)     VALUE 'BYR'. 01280099
012900     05  PC-INQ                         PIC X(3)     VALUE 'INQ'. 01290099
013000     05  PC-UPD                         PIC X(3)     VALUE 'UPD'. 01300099
013100     05  PC-DEL                         PIC X(3)     VALUE 'DEL'. 01310099
013200     05  PC-ERR                         PIC X(3)     VALUE 'ERR'. 01320099
013300                                                                  01330099
013400 01  PC-TSYMSG-NUMBERS.                                           01340099
013500     05  PC-TSYMSG-00004                PIC 9(5)    VALUE 00004.  01350099
013600     05  PC-TSYMSG-00005                PIC 9(5)    VALUE 00005.  01360099
013700     05  PC-TSYMSG-00008                PIC 9(5)    VALUE 00008.  01370099
013800     05  PC-TSYMSG-00045                PIC 9(5)    VALUE 00045.  01380099
013900     05  PC-TSYMSG-00050                PIC 9(5)    VALUE 00050.  01390099
014000     05  PC-TSYMSG-00051                PIC 9(5)    VALUE 00051.  01400099
014100     05  PC-TSYMSG-00052                PIC 9(5)    VALUE 00052.  01410099
014200     05  PC-TSYMSG-00053                PIC 9(5)    VALUE 00053.  01420099
014300     05  PC-TSYMSG-00054                PIC 9(5)    VALUE 00054.  01430099
014400     05  PC-TSYMSG-00055                PIC 9(5)    VALUE 00055.  01440099
014500     05  PC-TSYMSG-00057                PIC 9(5)    VALUE 00057.  01450099
014600     05  PC-TSYMSG-00059                PIC 9(5)    VALUE 00059.  01460099
014700     05  PC-TSYMSG-00069                PIC 9(5)    VALUE 00069.  01470099
014800     05  PC-TSYMSG-00070                PIC 9(5)    VALUE 00070.  01480099
014900     05  PC-TSYMSG-00101                PIC 9(5)    VALUE 00101.  01490099
015000     05  PC-TSYMSG-00115                PIC 9(5)    VALUE 00115.  01500099
015100     05  PC-TSYMSG-00118                PIC 9(5)    VALUE 00118.  01510099
015200     05  PC-TSYMSG-00146                PIC 9(5)    VALUE 00146.  01520099
015300     05  PC-TSYMSG-00207                PIC 9(5)    VALUE 00207.  01530099
015400     05  PC-TSYMSG-01084                PIC 9(5)    VALUE 01084.  01540099
015500     05  PC-TSYMSG-01502                PIC 9(5)    VALUE 01502.  01550099
015600     05  PC-TSYMSG-01503                PIC 9(5)    VALUE 01503.  01560099
015700     05  PC-TSYMSG-01519                PIC 9(5)    VALUE 01519.  01570099
015800     05  PC-TSYMSG-03219                PIC 9(5)    VALUE 03219.  01580099
015900     05  PC-TSYMSG-03223                PIC 9(5)    VALUE 03223.  01590099
016000                                                                  01600099
016100 01  PM-PROGRAM-MESSAGES.                                         01610099
016200     05  PM-PROGRAM-MESSAGE-9           PIC X(78)    VALUE        01620099
016300     'ERROR TRYING TO REWRITE  TEMP STORAGE QUEUE - RESP '.       01630099
016400     05  FILLER REDEFINES PM-PROGRAM-MESSAGE-9.                   01640099
016500         10  FILLER                     PIC X(51).                01650099
016600         10  PM-RESP-9                  PIC Z(03)9-.              01660099
016700         10  FILLER                     PIC X(22).                01670099
016800     05  PM-PROGRAM-MESSAGE-10          PIC X(78)    VALUE        01680099
016900     'ERROR TRYING TO WRITE TO TEMP STORAGE QUEUE - RESP '.       01690099
017000     05  FILLER REDEFINES PM-PROGRAM-MESSAGE-10.                  01700099
017100         10  FILLER                     PIC X(51).                01710099
017200         10  PM-RESP-10                 PIC Z(03)9-.              01720099
017300         10  FILLER                     PIC X(22).                01730099
017400     05  PM-PROGRAM-MESSAGE-11          PIC X(78)    VALUE        01740099
017500     'LOGIC ERROR IN TRYING TO WRITE TO TEMP STORAGE QUEUE - BLOCK01750099
017600-    '     '.                                                     01760099
017700     05  FILLER REDEFINES PM-PROGRAM-MESSAGE-11.                  01770099
017800         10  FILLER                     PIC X(61).                01780099
017900         10  PM-BLOCK-NUMBER            PIC Z(03)9-.              01790099
018000         10  FILLER                     PIC X(12).                01800099
018100     05  PM-PROGRAM-MESSAGE-12          PIC X(78)    VALUE        01810099
018200     'INVALID NEXT APPLICATION ACTIVITY RECEIVED'.                01820099
018300     05  PM-PROGRAM-MESSAGE-23          PIC X(78)    VALUE        01830099
018400     'ERROR TRYING TO DELETE TEMP STORAGE QUEUE - RESP '.         01840099
018500     05  FILLER REDEFINES PM-PROGRAM-MESSAGE-23.                  01850099
018600         10  FILLER                     PIC X(49).                01860099
018700         10  PM-RESP-23                 PIC Z(03)9-.              01870099
018800         10  FILLER                     PIC X(24).                01880099
018900     05  PM-PROGRAM-MESSAGE-24          PIC X(78)    VALUE        01890099
019000     'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE - RESP '.      01900099
019100     05  FILLER REDEFINES PM-PROGRAM-MESSAGE-24.                  01910099
019200         10  FILLER                     PIC X(52).                01920099
019300         10  PM-RESP-24                 PIC Z(03)9-.              01930099
019400         10  FILLER                     PIC X(21).                01940099
019500     05  PM-PROGRAM-MESSAGE-28          PIC X(78)    VALUE        01950099
019600     'ERROR OCCURRED DURING TS QUEUE PROCESSING'.                 01960099
019700                                                                  01970099
019800 01  PS-PROGRAM-SUBSCRIPTS.                                       01980099
019900     05  PS-SUB                         PIC S9(04)   VALUE +0     01990099
020000                                                     COMP SYNC.   02000099
020100     05  PS-ITEM-SUB                    PIC S9(09)   VALUE +0     02010099
020200                                                     COMP-3.      02020099
020300                                                                  02030099
020400 01  PS-PROGRAM-SWITCHES.                                         02040099
020500     05  PS-MAP-SEND-TYPE               PIC X(01)    VALUE '1'.   02050099
020600         88  PS-SEND-MAP-N-DATA-FRSET                VALUE '1'.   02060099
020700         88  PS-SEND-MAP-N-DATA-FRSET-CPOSN          VALUE '2'.   02070099
020800         88  PS-SEND-DATA-ONLY-FRSET                 VALUE '3'.   02080099
020900         88  PS-SEND-DATA-ONLY                       VALUE '4'.   02090099
021000         88  PS-SEND-DATA-ONLY-ERASEAUP              VALUE '5'.   02100099
021100         88  PS-SEND-MAP-ONLY-FRSET                  VALUE '6'.   02110099
021200     05  PS-ERROR-SW                    PIC X(01)    VALUE 'N'.   02120099
021300         88  PS-ERROR                                VALUE 'Y'.   02130099
021400         88  PS-NO-ERROR                             VALUE 'N'.   02140099
021500     05  PS-INTER-APPL-VALID-SW         PIC X(01)    VALUE 'N'.   02150099
021600         88  PS-INTER-APPL-VALID                     VALUE 'Y'.   02160099
021700         88  PS-INTER-APPL-NOT-VALID                 VALUE 'N'.   02170099
021800     05  PS-SAME-ITEMS-DISPLAYED-SW     PIC X(01)    VALUE 'N'.   02180099
021900         88  PS-SAME-ITEMS-DISPLAYED                 VALUE 'Y'.   02190099
022000         88  PS-DIFFERENT-ITEMS-DISPLAYED            VALUE 'N'.   02200099
022100     05  PS-CURSOR-POSITIONED-SW        PIC X(01)    VALUE 'N'.   02210099
022200         88  PS-CURSOR-POSITIONED                    VALUE 'Y'.   02220099
022300         88  PS-CURSOR-NOT-POSITIONED                VALUE 'N'.   02230099
022400     05  PS-VALID-SELECTIONS-SW         PIC X(01)    VALUE 'Y'.   02240099
022500         88  PS-VALID-SELECTIONS                     VALUE 'Y'.   02250099
022600         88  PS-INVALID-SELECTIONS                   VALUE 'N'.   02260099
022700     05  PS-VALID-BEG-ITEM-SW           PIC X(01)    VALUE 'N'.   02270099
022800         88  PS-VALID-BEG-ITEM                       VALUE 'Y'.   02280099
022900         88  PS-INVALID-BEG-ITEM                     VALUE 'N'.   02290099
023000     05  PS-TOP-ITEM-IN-ARRAY-SW        PIC X(01)    VALUE 'N'.   02300099
023100         88  PS-TOP-ITEM-IN-ARRAY                    VALUE 'Y'.   02310099
023200         88  PS-TOP-ITEM-NOT-IN-ARRAY                VALUE 'N'.   02320099
023300     05  PS-BOTTOM-ITEM-IN-ARRAY-SW     PIC X(01)    VALUE 'N'.   02330099
023400         88  PS-BOTTOM-ITEM-IN-ARRAY                 VALUE 'Y'.   02340099
023500         88  PS-BOTTOM-ITEM-NOT-IN-ARRAY             VALUE 'N'.   02350099
023600     05  PS-TOP-ITEM-IN-TEMP-SW         PIC X(01)    VALUE 'N'.   02360099
023700         88  PS-TOP-ITEM-IN-TEMP                     VALUE 'Y'.   02370099
023800         88  PS-TOP-ITEM-NOT-IN-TEMP                 VALUE 'N'.   02380099
023900     05  PS-BOTTOM-ITEM-IN-TEMP-SW      PIC X(01)    VALUE 'N'.   02390099
024000         88  PS-BOTTOM-ITEM-IN-TEMP                  VALUE 'Y'.   02400099
024100         88  PS-BOTTOM-ITEM-NOT-IN-TEMP              VALUE 'N'.   02410099
024200     05  PS-LAST-BLOCK-IN-ARRAY-SW      PIC X(01)    VALUE 'N'.   02420099
024300         88  PS-LAST-BLOCK-IN-ARRAY                  VALUE 'Y'.   02430099
024400         88  PS-LAST-BLOCK-NOT-IN-ARRAY              VALUE 'N'.   02440099
024500     05  PS-SELECTION-FOUND-SW          PIC X(01)    VALUE 'N'.   02450099
024600         88  PS-SELECTION-FOUND                      VALUE 'Y'.   02460099
024700         88  PS-NO-SELECTION-FOUND                   VALUE 'N'.   02470099
024800     05  PS-WARNING-SW                  PIC X(01)    VALUE 'N'.   02480099
024900         88  PS-WARNING                              VALUE 'Y'.   02490099
025000         88  PS-NO-WARNING                           VALUE 'N'.   02500099
025100     05  PS-INFORMATIONAL-SW            PIC X(01)    VALUE 'N'.   02510099
025200         88  PS-INFORMATIONAL                        VALUE 'Y'.   02520099
025300         88  PS-NOT-INFORMATIONAL                    VALUE 'N'.   02530099
025400     05  PS-PROCESSING-SW               PIC X(01)    VALUE 'N'.   02540099
025500         88  PS-CONTINUE                             VALUE 'Y'.   02550099
025600         88  PS-DONT-PROCESS                         VALUE 'N'.   02560099
025700     05  PS-PROCESS-ITEM-SW             PIC X(01)    VALUE 'N'.   02570099
025800         88  PS-END-OF-ITEMS                         VALUE 'Y'.   02580099
025900         88  PS-NOT-END                              VALUE 'N'.   02590099
026000     05  PS-COMMAREA-SW                 PIC X(01)    VALUE 'N'.   02600099
026100         88  PS-COMMAREA-VALID                       VALUE 'Y'.   02610099
026200         88  PS-COMMAREA-NOT-VALID                   VALUE 'N'.   02620099
026300     05  PS-LIST-ITEMS-SW               PIC X(01)    VALUE 'N'.   02630099
026400         88  PS-LIST-ITEMS-FOUND                     VALUE 'Y'.   02640099
026500         88  PS-NO-LIST-ITEMS-FOUND                  VALUE 'N'.   02650099
026600     05  PS-UPDATED-SW                  PIC X(01)    VALUE 'N'.   02660099
026700         88  PS-UPDATED                              VALUE 'Y'.   02670099
026800         88  PS-NOT-UPDATED                          VALUE 'N'.   02680099
026900     05  PS-SKU-FOUND-SW                PIC X(01)    VALUE 'N'.   02690099
027000         88  PS-SKU-FOUND                            VALUE 'Y'.   02700099
027100         88  PS-SKU-NOT-FOUND                        VALUE 'N'.   02710099
027200     05  PS-TDFCTOR-SW                  PIC X(01)    VALUE 'N'.   02720099
027300         88  PS-TDFCTOR-FOUND                        VALUE 'Y'.   02730099
027400         88  PS-TDFCTOR-NOT-FOUND                    VALUE 'N'.   02740099
027500     05  PS-DELETED-SW                  PIC X(01)    VALUE 'N'.   02750099
027600         88  PS-DELETED                              VALUE 'Y'.   02760099
027700         88  PS-HEADER-DELETED                       VALUE 'H'.   02770099
027800         88  PS-NOT-DELETED                          VALUE 'N'.   02780099
027900     05  PS-WRITE-QUEUE-SW              PIC X(01)    VALUE 'N'.   02790099
028000         88  PS-WRITE-QUEUE                          VALUE 'Y'.   02800099
028100         88  PS-DONT-WRITE-QUEUE                     VALUE 'N'.   02810099
028200     05  PS-PS-PROTECT-LIST-SW          PIC X(01)    VALUE 'N'.   02820099
028300         88  PS-PROTECT-LIST-YES                     VALUE 'Y'.   02830099
028400         88  PS-PROTECT-LIST-NO                      VALUE 'N'.   02840099
028500     EJECT                                                        02850099
028600 01  PV-PROGRAM-VARIABLES.                                        02860099
028700     05  PV-SKU-NOT-FOUND-DESC.                                   02870099
028800         10 FILLER                      PIC X(05) VALUE 'ITEM='.  02880099
028900         10 PV-NOT-FOUND-ITEM-NBR       PIC X(15).                02890099
029000                                                                  02900099
029100     05  PV-CICS-RESPONSE               PIC S9(04)   VALUE +0     02910099
029200                                                     COMP SYNC.   02920099
029300     05  PV-HIGHEST-ITEM-TO-BE-READ     PIC S9(09)   VALUE +0     02930099
029400                                                     COMP-3.      02940099
029500     05  PV-ENDING-ITEM-ON-PANEL        PIC S9(09)   VALUE +0     02950099
029600                                                     COMP-3.      02960099
029700     05  PV-ITEM-IN-USE                 PIC S9(09)   VALUE +0     02970099
029800                                                     COMP-3.      02980099
029900     05  PV-TOP-ITEM                    PIC S9(09)   VALUE +0     02990099
030000                                                     COMP-3.      03000099
030100     05  PV-BOTTOM-ITEM                 PIC S9(09)   VALUE +0     03010099
030200                                                     COMP-3.      03020099
030300     05  PV-MAX-ITEMS-TO-BE-READ        PIC S9(09)   VALUE +0     03030099
030400                                                     COMP-3.      03040099
030500     05  PV-FIRST-ITEM-IN-ARRAY         PIC S9(09)   VALUE +0     03050099
030600                                                     COMP-3.      03060099
030700     05  PV-LAST-ITEM-IN-ARRAY          PIC S9(09)   VALUE +0     03070099
030800                                                     COMP-3.      03080099
030900     05  PV-LAST-ITEM-IN-TEMP           PIC S9(09)   VALUE +0     03090099
031000                                                     COMP-3.      03100099
031100     05  PV-BEGINNING-ITEM              PIC S9(09)   VALUE +0     03110099
031200                                                     COMP-3.      03120099
031300     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)   VALUE +0     03130099
031400                                                     COMP-3.      03140099
031500     05  PV-BLOCK-NUMBER                PIC S9(04)   VALUE +0     03150099
031600                                                     COMP SYNC.   03160099
031700     05  PV-RESP                        PIC S9(04)   VALUE +0     03170099
031800                                                     COMP SYNC.   03180099
031900     05  PV-ITEM                        PIC S9(04)   VALUE +0     03190099
032000                                                     COMP SYNC.   03200099
032100     05  PV-TSQ-B-ITEM                  PIC S9(04)   VALUE +0     03210099
032200                                                     COMP SYNC.   03220099
032300     05  PV-SAVE-ITEM                   PIC S9(04)   VALUE +0     03230099
032400                                                     COMP SYNC.   03240099
032500     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)   VALUE +0     03250099
032600                                                     COMP SYNC.   03260099
032700     05  PV-LIST-ITEM-NUMBER            PIC S9(04)   VALUE +0     03270099
032800                                                     COMP SYNC.   03280099
032900     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)   VALUE +0     03290099
033000                                                     COMP SYNC.   03300099
033100     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)   VALUE +0     03310099
033200                                                     COMP SYNC.   03320099
033300     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)   VALUE +0     03330099
033400                                                     COMP SYNC.   03340099
033500     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)   VALUE +0     03350099
033600                                                     COMP SYNC.   03360099
033700     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)   VALUE +0     03370099
033800                                                     COMP SYNC.   03380099
033900     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)   VALUE +0     03390099
034000                                                     COMP SYNC.   03400099
034100     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)   VALUE +0     03410099
034200                                                     COMP SYNC.   03420099
034300     05  PV-ITEMS-READ                  PIC S9(04)   VALUE +0     03430099
034400                                                     COMP SYNC.   03440099
034500     05  PV-DFCT-SHIPT-ID-IND           PIC S9(04)   VALUE +0     03450099
034600                                                     COMP SYNC.   03460099
034700         88  PV-DFCT-SHIPT-ID-NULL                   VALUE -1.    03470099
034800     05  PV-DEL-COUNT                   PIC S9(07)   VALUE +0     03480099
034900                                                     COMP-3.      03490099
035000     05  PV-MESSAGE                     PIC X(78)    VALUE SPACES.03500099
035100     05  PV-SQL-SUB                     PIC S9(4)    COMP.        03510099
035200     05  PV-RETRY-COUNTER               PIC S9(3)    COMP-3.      03520099
035300     05  PV-TDFCTOR-COUNT               PIC S9(7)    COMP-3.      03530099
035400     05  PV-DFCT-SHIPT-ID               PIC S9(9)    COMP.        03540099
035500     05  PV-BEGITMI.                                              03550099
035600         10  PV-BEGITMI-N               PIC 9(7).                 03560099
035700     05  PV-DISPLAY7                    PIC ZZZ,ZZ9.              03570099
035800     05  PV-BG-QUEUE-NAME.                                        03580099
035900         10  PV-BG-TERM-ID              PIC X(4).                 03590099
036000         10  PV-BG-TASK-NUMBER          PIC S9(5)    COMP-3.      03600099
036100         10  PV-BG-SEQUENCE             PIC  9(1).                03610099
036200     05  PV-HOLD-STATUS                 PIC S9(4)    COMP-3       03620099
036300                                                     VALUE ZERO.  03630099
036400     05  PV-DEPT-LIST-AUTH.                                       03640099
036500         10  PV-DEPT                    PIC X(03).                03650099
036600         10  FILLER                     PIC X(01)    VALUE '/'.   03660099
036700         10  PV-LIST-NUMBER             PIC 9(12).                03670099
036800         10  FILLER                     PIC X(01)    VALUE '/'.   03680099
036900         10  PV-AUTH-NUMBER             PIC 9(11).                03690099
037000         10  FILLER                     PIC X(12)    VALUE SPACES.03700099
037100     05  PV-DEPT-AREA-DEST              PIC X(40).                03710099
037200     05  PV-SPPCDT-CL-NBR               PIC S9(4)V COMP-3.        03720099
037300     05  PV-SPPCDT-DEPT-NBR             PIC S9(4)V COMP-3.        03730099
037400     05  PV-DC-NMBR-COMP                PIC S9(04) COMP VALUE +0. 03740099
037500     05  PV-WORK-DC-NBR                 PIC S9(04) COMP VALUE +0. 03750099
037510     05  PV-LOCATION                    PIC  9(04) VALUE ZEROS.   03751099
037600     05  PV-SPPCDT-ITEM-NBR             PIC S9(15)V  COMP-3.      03760099
037700     05  PV-TSPPCDT-COUNT               PIC S9(03)   COMP-3.      03770099
037800     05  PV-PGS-TO-PRT-NBR              PIC S9(04)   COMP-3.      03780099
037900     05  PV-REMAINDER                   PIC S9(04)   COMP-3.      03790099
038000                                                                  03800099
038100     05  PV-DEPT-NBR                    PIC 9(04)   VALUE ZEROES. 03810099
038200     05  PV-MAJ-CLASS                   PIC 9(04)   VALUE ZEROES. 03820099
038300     05  PV-MAJ-CLASS-R                 REDEFINES                 03830099
038400         PV-MAJ-CLASS.                                            03840099
038500        10  FILLER                      PIC 9(02).                03850099
038600        10  PV-MAJ-CLASS-DIGIT-3        PIC 9(01).                03860099
038700        10 FILLER                       PIC 9(01).                03870099
038800     05  PV-SUB-CL.                                               03880099
038900        10  FILLER                      PIC 9(02)    VALUE ZEROES.03890099
039000        10  PV-SUB-CLASS-DIGIT-3-4      PIC 9(02).                03900099
039100     05  PV-SUB-CLASS REDEFINES PV-SUB-CL                         03910099
039200                                        PIC 9(04).                03920099
039300*                                                                 03930099
039400                                                                  03940099
039500 01  PV-TEMP-WORK-AREA.                                           03950099
039600     05  PV-BLOCK-MODIFIED              PIC X.                    03960099
039700     05  PV-TW-ITEM-ENTRIES OCCURS 11 TIMES                       03970099
039800                            INDEXED BY PV-TW-IDX.                 03980099
039900         10  PV-TW-LIST-ITEM-NUMBER     PIC S9(9)    COMP-3.      03990099
040000         10  PV-TW-SELECTED-SW          PIC X.                    04000099
040100             88  PV-TW-SELECT                        VALUE 'S'.   04010099
040200             88  PV-TW-DESELECT                      VALUE ' '.   04020099
040300         10  PV-TW-ACTION               PIC X(3).                 04030099
040400         10  PV-TW-STATUS-CODE          PIC X(1).                 04040099
040500         10  PV-TW-COLOR                PIC X(1).                 04050099
040600         10  PV-TW-HILIGHT              PIC X(1).                 04060099
040700         10  PV-TW-ATTRIBUTE            PIC X(1).                 04070099
040800         10  PV-TW-DEPT                 PIC X(3).                 04080099
040900         10  PV-TW-MAJ-CLASS            PIC 9(2).                 04090099
041000         10  PV-TW-SUB-CLASS            PIC 9(2).                 04100099
041100         10  PV-TW-SKU                  PIC 9(8).                 04110099
041200         10  PV-TW-UPCX                 PIC X(15).                04120099
041300         10  PV-TW-UPC  REDEFINES                                 04130099
041400                            PV-TW-UPCX  PIC 9(15).                04140099
041500         10  PV-TW-STYLE                PIC X(05).                04150099
041600         10  PV-TW-DESC                 PIC X(17).                04160099
041700         10  PV-TW-UCOST                PIC S9(6)V99 COMP-3.      04170099
041800         10  PV-TW-URETAIL              PIC S9(6)V99 COMP-3.      04180099
041900         10  PV-TW-URETAIL-CHG-SW       PIC X.                    04190099
042000             88  PV-TW-URETAIL-CHG                   VALUE 'C'.   04200099
042100             88  PV-TW-URETAIL-RST                   VALUE ' '.   04210099
042200         10  PV-TW-SEQ-NUMBER           PIC S9(5)    COMP-3.      04220099
042300         10  PV-TW-PERM-STATUS-CDE      PIC  X(02).               04230099
042400         10  PV-TW-PERM-DOC-NBR         PIC S9(7)V   COMP-3.      04240099
042500         10  PV-TW-PERM-DTL-ROW-NBR     PIC S9(4)    COMP.        04250099
042600         10  PV-TW-DFCT-ITEM-NBR        PIC S9(15)V  COMP-3.      04260099
042700*---------------------------------------------------------------* 04270099
042800*    STANDARD COMMAREA.                                         * 04280099
042900*---------------------------------------------------------------* 04290099
043000                                                                  04300099
043100     COPY DPWS020.                                                04310099
043200     05  RV102-FILLER  REDEFINES  DP020-VARIABLE-COMMAREA.        04320099
043300                                                                  04330099
043400*---------------------------------------------------------------* 04340099
043500*    INTER-APPLICATION COMMAREA.                                * 04350099
043600*---------------------------------------------------------------* 04360099
043700                                                                  04370099
043800         10  INTER-APPL-COMM-AREA       PIC X(200).               04380099
043900     COPY RVWS100.                                                04390099
044000*---------------------------------------------------------------* 04400099
044100*    SPECIFIC COMMMAREA FOR DPKCS036.                           * 04410099
044200*---------------------------------------------------------------* 04420099
044300         10  RV102-SPECIFIC-COMMAREA.                             04430099
044400             15  RV102-APPL-CURSOR-POSITION          PIC S9(04)   04440099
044500                                                     COMP.        04450099
044600                                                                  04460099
044700             15  RV102-BLOCK-ENTRIES OCCURS 2 TIMES.              04470099
044800                 20  RV102-BLOCK-MODIFIED-SW         PIC X(01).   04480099
044900                     88  RV102-BLOCK-NOT-MODIFIED    VALUE 'N'.   04490099
045000                     88  RV102-BLOCK-MODIFIED        VALUE 'Y'.   04500099
045100                                                                  04510099
045200                 20  RV102-ITEM-ARRAY.                            04520099
045300                     25  RV102-ITEM-ENTRIES OCCURS 11 TIMES.      04530099
045400                         30  RV102-LIST-ITEM-NUMBER               04540099
045500                                                     PIC S9(09)   04550099
045600                                                         COMP-3.  04560099
045700                         30  RV102-SELECTED-SW       PIC X(01).   04570099
045800                             88  RV102-NO-SELECT     VALUE ' '.   04580099
045900                             88  RV102-DESELECT      VALUE ' '.   04590099
046000                             88  RV102-SELECT        VALUE 'S'.   04600099
046100                             88  RV102-BEGIN         VALUE 'B'.   04610099
046200                             88  RV102-END           VALUE 'E'.   04620099
046300                         30  RV102-ACTION            PIC X(3).    04630099
046400                         30  RV102-STATUS-CODE       PIC X(1).    04640099
046500                         30  RV102-COLOR             PIC X(1).    04650099
046600                         30  RV102-HILIGHT           PIC X(1).    04660099
046700                         30  RV102-ATTRIBUTE         PIC X(1).    04670099
046800                         30  RV102-DEPT              PIC X(3).    04680099
046900                         30  RV102-MAJ-CLASS         PIC 9(2).    04690099
047000                         30  RV102-SUB-CLASS         PIC 9(2).    04700099
047100                         30  RV102-SKU               PIC 9(8).    04710099
047200                         30  RV102-UPCX              PIC X(15).   04720099
047300                         30  RV102-UPC  REDEFINES                 04730099
047400                                        RV102-UPCX  PIC  9(15).   04740099
047500                                                                  04750099
047600                         30  RV102-STYLE             PIC X(05).   04760099
047700                         30  RV102-DESC              PIC X(17).   04770099
047800                         30  RV102-UCOST             PIC S9(6)V99 04780099
047900                                                         COMP-3.  04790099
048000                         30  RV102-URETAIL           PIC S9(6)V99 04800099
048100                                                         COMP-3.  04810099
048200                         30  RV102-URETAIL-CHG-SW    PIC X.       04820099
048300                             88  RV102-URETAIL-CHG     VALUE 'C'. 04830099
048400                             88  RV102-URETAIL-RESET   VALUE ' '. 04840099
048500                         30  RV102-SEQ-NUMBER        PIC S9(5)    04850099
048600                                                         COMP-3.  04860099
048700                         30  RV102-PERM-STATUS-CDE   PIC  X(02).  04870099
048800                         30  RV102-PERM-DOC-NBR      PIC S9(7)V   04880099
048900                                                         COMP-3.  04890099
049000                         30  RV102-PERM-DTL-ROW-NBR  PIC S9(4)    04900099
049100                                                         COMP.    04910099
049200                         30  RV102-DFCT-ITEM-NBR     PIC S9(15)V  04920099
049300                                                         COMP-3.  04930099
049400                                                                  04940099
049500             15  RV102-BLK-SUB                       PIC S9(04)   04950099
049600                                                         COMP     04960099
049700                                                         SYNC.    04970099
049800             15  RV102-ITEM-SUB                      PIC S9(04)   04980099
049900                                                         COMP     04990099
050000                                                         SYNC.    05000099
050100             15  RV102-NUMBER-OF-ITEMS-READ          PIC S9(09)   05010099
050200                                                         COMP-3.  05020099
050300             15  RV102-NUMBER-OF-SELECTED-ITEMS      PIC S9(09)   05030099
050400                                                         COMP-3.  05040099
050500             15  RV102-ITEM-AT-TOP-OF-PANEL          PIC S9(09)   05050099
050600                                                         COMP-3.  05060099
050700             15  RV102-ITEM-AT-BOT-OF-PANEL          PIC S9(09)   05070099
050800                                                         COMP-3.  05080099
050900             15  RV102-HIGHEST-BLOCK-WRITTEN         PIC S9(04)   05090099
051000                                                         COMP     05100099
051100                                                         SYNC.    05110099
051200             15  RV102-START-OF-SELECTED-RANGE       PIC S9(09)   05120099
051300                                                         COMP-3.  05130099
051400             15  RV102-END-OF-SELECTED-RANGE         PIC S9(09)   05140099
051500                                                         COMP-3.  05150099
051600             15  RV102-ITEMS-LEFT-INDICATOR          PIC X.       05160099
051700                 88  RV102-ITEMS-LEFT-ON-DB            VALUE 'Y'. 05170099
051800                 88  RV102-NO-ITEMS-LEFT-ON-DB         VALUE 'N'. 05180099
051900             15  RV102-TEMP-QUEUE-UPDATE-SW          PIC X.       05190099
052000                 88  RV102-UPDATE-TSQ                  VALUE 'Y'. 05200099
052100                 88  RV102-NO-TSQ-UPDATE               VALUE 'N'. 05210099
052200             15  RV102-DELETE-SW                     PIC X.       05220099
052300                 88  RV102-CAN-DELETE                  VALUE 'Y'. 05230099
052400                 88  RV102-CANT-DELETE                 VALUE 'N'. 05240099
052500             15  RV102-TEMP-QUEUE-NAME.                           05250099
052600                 20  RV102-TERM-ID                   PIC X(4).    05260099
052700                 20  RV102-TASK-NUMBER               PIC S9(7)    05270099
052800                                                         COMP-3.  05280099
052900             15  RV102-HOLD-TSQB-QUEUE-NAME          PIC X(8).    05290099
053000             15  RV102-TSQB-QUEUE-LENGTH             PIC S9(04)   05300099
053100                                                     COMP.        05310099
053200             15  RV102-INT-APPL-FORMAT-IND           PIC X.       05320099
053300                                                                  05330099
053400             15  RV102-DB2-CURRENT-DATE.                          05340099
053500                 20  RV102-DC-CC                     PIC XX.      05350099
053600                 20  RV102-DC-YY                     PIC XX.      05360099
053700                 20  FILLER                          PIC X.       05370099
053800                     88  RV102-DC-DASH1              VALUE '-'.   05380099
053900                 20  RV102-DC-MM                     PIC XX.      05390099
054000                 20  FILLER                          PIC X.       05400099
054100                     88  RV102-DC-DASH2              VALUE '-'.   05410099
054200                 20  RV102-DC-DD                     PIC XX.      05420099
054300             15  RV102-LAST-ITEM-NUMBER              PIC S9(15)   05430099
054400                                                     COMP-3.      05440099
054500                                                                  05450099
054600             15  RV102-HOLD-HEADER-INFO.                          05460099
054700                 20  RV102-ORDER-STATUS              PIC X(8).    05470099
054800                 20  RV102-ORDER-TYPE                PIC X(8).    05480099
054900                 20  RV102-VENDOR-DUNS-NBR           PIC X(9).    05490099
055000                 20  RV102-VENDOR-DESCRIPTION        PIC X(25).   05500099
055100                 20  RV102-TOTAL-COST                PIC S9(9)V99 05510099
055200                                                     COMP-3.      05520099
055300                 20  RV102-TOTAL-RETAIL              PIC S9(9)V99 05530099
055400                                                     COMP-3.      05540099
055500             15  RV102-COST-DIFFERENCE               PIC S9(7)V99 05550099
055600                                                     COMP-3.      05560099
055700             15  RV102-RETAIL-DIFFERENCE             PIC S9(7)V99 05570099
055800                                                     COMP-3.      05580099
055900             15  RV102-STR-NBR                       PIC  9(04).  05590099
056000                                                                  05600099
056100             15  RV102-SAVE-APPL-COMMAREA            PIC X(200).  05610099
056200         10  FILLER                                  PIC X(227).  05620099
056300*---------------------------------------------------------------* 05630099
056400*    TSQ 'B' RECORD LAYOUT FOR PASSING INFORMATION.             * 05640099
056500*---------------------------------------------------------------* 05650099
056600     COPY RVWS103.                                                05660099
056700*---------------------------------------------------------------* 05670099
056800*    PERM PROGRAM CONSTANTS AND WORK AREAS                      * 05680099
056900*---------------------------------------------------------------* 05690099
057000     COPY PEWS049.                                                05700099
057100*---------------------------------------------------------------* 05710099
057200*    ABEND PROCESSING COPYBOOK.                                 * 05720099
057300*---------------------------------------------------------------* 05730099
057400     COPY DPWS013.                                                05740099
057500*---------------------------------------------------------------* 05750099
057600*    MESSAGE FORMAT COPYBOOK.                                   * 05760099
057700*---------------------------------------------------------------* 05770099
057800     COPY DPWS006.                                                05780099
057900*---------------------------------------------------------------* 05790099
058000*    ATTRIBUTE SETTINGS COPYBOOK.                               * 05800099
058100*---------------------------------------------------------------* 05810099
058200     COPY DPWS015.                                                05820099
058300*---------------------------------------------------------------* 05830099
058400*    CURRENT DATE AND TIME COPYBOOK.                            * 05840099
058500*---------------------------------------------------------------* 05850099
058600     COPY DPWS017.                                                05860099
058700*---------------------------------------------------------------* 05870099
058800*    TOGGLE FUNCTION KEY LINES COPYBOOK.                        * 05880099
058900*---------------------------------------------------------------* 05890099
059000     COPY DPWS009.                                                05900099
059100*---------------------------------------------------------------* 05910099
059200*    FUNCTION KEYS COPYBOOK.                                    * 05920099
059300*---------------------------------------------------------------* 05930099
059400     COPY DPWS016.                                                05940099
059500*---------------------------------------------------------------* 05950099
059600*    DPKUT045 COPYBOOK.                                         * 05960099
059700*---------------------------------------------------------------* 05970099
059800     COPY DPWS045.                                                05980099
059900*---------------------------------------------------------------* 05990099
060000*    NUMERIC EDIT LAYOUT.                                       * 06000099
060100*---------------------------------------------------------------* 06010099
060200     COPY DPWS010I.                                               06020099
060300*---------------------------------------------------------------* 06030099
060400*    MESSAGE RECORD LAYOUT                                      * 06040099
060500*---------------------------------------------------------------* 06050099
060600     COPY DPRD507I.                                               06060099
060700*---------------------------------------------------------------* 06070099
060800*    STANDARD ATTENTION IDENTIFIER LIST                         * 06080099
060900*---------------------------------------------------------------* 06090099
061000     COPY DFHAID.                                                 06100099
061100*---------------------------------------------------------------* 06110099
061200*    STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST      * 06120099
061300*---------------------------------------------------------------* 06130099
061400     COPY DFHBMSCA.                                               06140099
061500*---------------------------------------------------------------* 06150099
061600*    MAP LAYOUT                                                 * 06160099
061700*---------------------------------------------------------------* 06170099
061800     COPY RVKM102.                                                06180099
061900 01  MD-MAP-DATA-AREA  REDEFINES RV102AO PIC X(2000).             06190099
062000*                                                                 06200099
062100 01  RVKM102-OCCURS-LAYOUT  REDEFINES  MD-MAP-DATA-AREA.          06210099
062200     05  FILLER                PIC X(248).                        06220099
062300     05  RVKM102-SCROLL-AREA OCCURS 11 TIMES.                     06230099
062400         10  RVKM102-SELECTL   PIC S9(4) COMP.                    06240099
062500         10  RVKM102-SELECTA   PIC X.                             06250099
062600         10  RVKM102-SELECTC   PIC X.                             06260099
062700         10  RVKM102-SELECTH   PIC X.                             06270099
062800         10  RVKM102-SELECTI   PIC X.                             06280099
062900             88  RVKM102-DESELECT                  VALUE ' '.     06290099
063000                                                                  06300099
063100         10  FILLER            PIC X(5).                          06310099
063200         10  RVKM102-ACTION    PIC X(3).                          06320099
063300                                                                  06330099
063400         10  FILLER            PIC X(5).                          06340099
063500         10  RVKM102-STATUS    PIC X(1).                          06350099
063600                                                                  06360099
063700         10  FILLER            PIC X(5).                          06370099
063800         10  RVKM102-DEPT      PIC X(3).                          06380099
063900                                                                  06390099
064000         10  FILLER            PIC X(5).                          06400099
064100         10  RVKM102-CLASS     PIC X(5).                          06410099
064200                                                                  06420099
064300         10  FILLER            PIC X(5).                          06430099
064400         10  RVKM102-SKU       PIC X(8).                          06440099
064500                                                                  06450099
064600         10  FILLER            PIC X(5).                          06460099
064700         10  RVKM102-UPC       PIC X(15).                         06470099
064800                                                                  06480099
064900         10  FILLER            PIC X(5).                          06490099
065000         10  RVKM102-STYLE     PIC X(5).                          06500099
065100                                                                  06510099
065200         10  FILLER            PIC X(5).                          06520099
065300         10  RVKM102-DESC      PIC X(17).                         06530099
065400                                                                  06540099
065500         10  RVKM102-URETAILL  PIC S9(4) COMP.                    06550099
065600         10  RVKM102-URETAILA  PIC X.                             06560099
065700         10  RVKM102-URETAILC  PIC X.                             06570099
065800         10  RVKM102-URETAILH  PIC X.                             06580099
065900         10  RVKM102-URETAILX.                                    06590099
066000             15  RVKM102-URETAIL                                  06600099
066100                               PIC ZZ,ZZZ.99.                     06610099
066200*---------------------------------------------------------------* 06620099
066300*    DB2 AREA FOR RTV DEFECT ORDER TABLE                        * 06630099
066400*---------------------------------------------------------------* 06640099
066500     EXEC SQL                                                     06650099
066600          INCLUDE TDFCTOR                                         06660099
066700     END-EXEC.                                                    06670099
066800*---------------------------------------------------------------* 06680099
066900*    DB2 AREA FOR RTV DEFECT ORDER MERCHANDISE ITEM TABLE       * 06690099
067000*---------------------------------------------------------------* 06700099
067100     EXEC SQL                                                     06710099
067200          INCLUDE TDFMEIT                                         06720099
067300     END-EXEC.                                                    06730099
067400***************************************************************** 06740099
067500*    SHIPMENT (RVT_DFCT_SHIPT) DB2 TABLE                          06750099
067600***************************************************************** 06760099
067700     EXEC SQL                                                     06770099
067800         INCLUDE RVT00000                                         06780099
067900     END-EXEC.                                                    06790099
068000*---------------------------------------------------------------* 06800099
068100*    DB2 AREA FOR THE SKU TABLE                                 * 06810099
068200*---------------------------------------------------------------* 06820099
068300     EXEC SQL                                                     06830099
068400          INCLUDE XLT00003                                        06840099
068500     END-EXEC.                                                    06850099
068600*---------------------------------------------------------------* 06860099
068700*    DB2 AREA FOR THE VENDOR STYLE TABLE                        * 06870099
068800*---------------------------------------------------------------* 06880099
068900     EXEC SQL                                                     06890099
069000          INCLUDE XLT00004                                        06900099
069100     END-EXEC.                                                    06910099
069200*---------------------------------------------------------------* 06920099
069300*    DB2 AREA FOR THE UPC TABLE                                 * 06930099
069400*---------------------------------------------------------------* 06940099
069500     EXEC SQL                                                     06950099
069600          INCLUDE XLT00006                                        06960099
069700     END-EXEC.                                                    06970099
069800*---------------------------------------------------------------* 06980099
069900*    DB2 AREA FOR THE XLT_LOC TABLE                             * 06990099
070000*---------------------------------------------------------------* 07000099
070100     EXEC SQL                                                     07010099
070200        INCLUDE XLT00010                                          07020099
070300     END-EXEC.                                                    07030099
070310*---------------------------------------------------------------* 07031099
070320*    DB2 AREA FOR THE XLT_DC_LOC_ASGMT TABLE                    * 07032099
070330*---------------------------------------------------------------* 07033099
070340     EXEC SQL                                                     07034099
070350        INCLUDE XLT00014                                          07035099
070360     END-EXEC.                                                    07036099
070400*---------------------------------------------------------------* 07040099
070500*  DCLGEN LAYOUT AND COBOL DECLARATION OF THE IN-STORE HEADER   * 07050099
070600*  DB2 TABLE.                                                   * 07060099
070700*---------------------------------------------------------------* 07070099
070800     EXEC SQL                                                     07080099
070900         INCLUDE TSTRPPC                                          07090099
071000     END-EXEC.                                                    07100099
071100*---------------------------------------------------------------* 07110099
071200*  DCLGEN LAYOUT AND COBOL DECLARATION OF THE IN-STORE DETAIL   * 07120099
071300*  DB2 TABLE.                                                   * 07130099
071400*---------------------------------------------------------------* 07140099
071500     EXEC SQL                                                     07150099
071600         INCLUDE TSPPCDT                                          07160099
071700     END-EXEC.                                                    07170099
071800*---------------------------------------------------------------* 07180099
071900*    DB2 AREA FOR COMMUNICATIONS                                * 07190099
072000*---------------------------------------------------------------* 07200099
072100     EXEC SQL                                                     07210099
072200          INCLUDE SQLCA                                           07220099
072300     END-EXEC.                                                    07230099
072400                                                                  07240099
072500*---------------------------------------------------------------* 07250099
072600*    CURSOR FOR THE LIST.                                       * 07260099
072700*---------------------------------------------------------------* 07270099
072800* LOGIC :                                                         07280099
072900*   - GET THE INTERNAL UPC WITH EDI-ORD-IND = 'Y'                 07290099
073000*   - IF THERE IS NO INTERNAL UPC WITH EDI-ORD-IND = 'Y', GET THE 07300099
073100*     GREATEST INTERANL UPC WITH ED-ORD-IND = 'N'                 07310099
073200*   - IF THERE IS NO INTERNAL UPCS, GET THE VENDOR UPC WHICH      07320099
073300*     HAVE EDI-ORD-IND = 'Y'                                      07330099
073400*   - IF THERE IS NO INTERNAL UPCS PRESENT AND THERE IS NO VENDOR 07340099
073500*     UPCS WITH EDI-ORD-IND = 'Y' PRESENT, GET THE GREATEST VENDOR07350099
073600*     UPC WITH EDI-ORD-IND = 'N'                                  07360099
073700*   - IF ALL THESE CONDITIONS ARE NOT SATISFIED, IT MIGHT BE A    07370099
073800*     DUMMY SKU OR A DELETED SKU.  GET THE CORRESPONDING ROWS FROM07380099
073900*     TABLE.                                                      07390099
074000*---------------------------------------------------------------* 07400099
074100     EXEC SQL                                                     07410099
074200          DECLARE ITEM-NUMBER-CSR CURSOR                          07420099
074300* NON-ZERO ITEMS WITH A MATCHING SKU RECORD                       07430099
074400          FOR SELECT                                              07440099
074500                I.DFCT_ITEM_NBR                                   07450099
074600              , I.SEQ_NBR                                         07460099
074700              , I.MKOUT_ORD_STAT_CDE                              07470099
074800              , I.MKOUT_ORD_ID                                    07480099
074900              , I.RTL_COST_AMT                                    07490099
075000              , I.UNIT_COST_AMT                                   07500099
075100              , SUBSTR(DIGITS(V.DEPT_NBR),2,3)                    07510099
075200              , SUBSTR(DIGITS(V.SUB_CL_NBR),3,2)                  07520099
075300              , S.SKU_NBR                                         07530099
075400              , U.UPC_NBR                                         07540099
075500              , U.INTR_UPC_ID                                     07550099
075600              , S.SKU_DESC                                        07560099
075700              , V.VS_NBR                                          07570099
075800*                                                                 07580099
075900          FROM                                                    07590099
076000                TDFMEIT I                                         07600099
076100              , XLT_SKU S                                         07610099
076200              , XLT_VND_STYL V                                    07620099
076300              , XLT_UPC U                                         07630099
076400          WHERE                                                   07640099
076500                I.DFCT_ORD_ID      = :RV100-UK-RA-NUMBER          07650099
076600            AND I.DFCT_ITEM_NBR    = S.ITM_NBR                    07660099
076700            AND I.DFCT_ITEM_NBR   ^= 0                            07670099
076800            AND S.STYL_ID          = V.STYL_ID                    07680099
076900            AND S.INTR_UPC_ID      = U.INTR_UPC_ID                07690099
077000            AND UPC_TYP_CDE        = 'I'                          07700099
077100            AND EDI_ORD_IND        = 'Y'                          07710099
077200      UNION ALL                                                   07720099
077300          SELECT                                                  07730099
077400                I.DFCT_ITEM_NBR                                   07740099
077500              , I.SEQ_NBR                                         07750099
077600              , I.MKOUT_ORD_STAT_CDE                              07760099
077700              , I.MKOUT_ORD_ID                                    07770099
077800              , I.RTL_COST_AMT                                    07780099
077900              , I.UNIT_COST_AMT                                   07790099
078000              , SUBSTR(DIGITS(V.DEPT_NBR),2,3)                    07800099
078100              , SUBSTR(DIGITS(V.SUB_CL_NBR),3,2)                  07810099
078200              , S.SKU_NBR                                         07820099
078300              , U.UPC_NBR                                         07830099
078400              , U.INTR_UPC_ID                                     07840099
078500              , S.SKU_DESC                                        07850099
078600              , V.VS_NBR                                          07860099
078700          FROM                                                    07870099
078800                TDFMEIT I                                         07880099
078900              , XLT_SKU S                                         07890099
079000              , XLT_VND_STYL V                                    07900099
079100              , XLT_UPC U                                         07910099
079200          WHERE                                                   07920099
079300                I.DFCT_ORD_ID      = :RV100-UK-RA-NUMBER          07930099
079400            AND I.DFCT_ITEM_NBR    = S.ITM_NBR                    07940099
079500            AND I.DFCT_ITEM_NBR   ^= 0                            07950099
079600            AND S.STYL_ID          = V.STYL_ID                    07960099
079700            AND S.INTR_UPC_ID      = U.INTR_UPC_ID                07970099
079800            AND UPC_TYP_CDE        = 'I'                          07980099
079900            AND EDI_ORD_IND        = 'N'                          07990099
080000            AND UPC_NBR            =                              08000099
080100                (SELECT MAX(U1.UPC_NBR)                           08010099
080200                   FROM XLT_UPC U1                                08020099
080300                  WHERE U.INTR_UPC_ID  = U1.INTR_UPC_ID           08030099
080400                    AND U1.UPC_TYP_CDE = 'I'                      08040099
080500                    AND U1.EDI_ORD_IND = 'N' )                    08050099
080600            AND NOT EXISTS                                        08060099
080700                (SELECT 1                                         08070099
080800                   FROM XLT_UPC U2                                08080099
080900                  WHERE U.INTR_UPC_ID   = U2.INTR_UPC_ID          08090099
081000                    AND U2.UPC_TYP_CDE    = 'I'                   08100099
081100                    AND U2.EDI_ORD_IND    = 'Y' )                 08110099
081200      UNION ALL                                                   08120099
081300          SELECT                                                  08130099
081400                I.DFCT_ITEM_NBR                                   08140099
081500              , I.SEQ_NBR                                         08150099
081600              , I.MKOUT_ORD_STAT_CDE                              08160099
081700              , I.MKOUT_ORD_ID                                    08170099
081800              , I.RTL_COST_AMT                                    08180099
081900              , I.UNIT_COST_AMT                                   08190099
082000              , SUBSTR(DIGITS(V.DEPT_NBR),2,3)                    08200099
082100              , SUBSTR(DIGITS(V.SUB_CL_NBR),3,2)                  08210099
082200              , S.SKU_NBR                                         08220099
082300              , U.UPC_NBR                                         08230099
082400              , U.INTR_UPC_ID                                     08240099
082500              , S.SKU_DESC                                        08250099
082600              , V.VS_NBR                                          08260099
082700          FROM                                                    08270099
082800                TDFMEIT I                                         08280099
082900              , XLT_SKU S                                         08290099
083000              , XLT_VND_STYL V                                    08300099
083100              , XLT_UPC U                                         08310099
083200          WHERE                                                   08320099
083300                I.DFCT_ORD_ID      = :RV100-UK-RA-NUMBER          08330099
083400            AND I.DFCT_ITEM_NBR    = S.ITM_NBR                    08340099
083500            AND I.DFCT_ITEM_NBR   ^= 0                            08350099
083600            AND S.STYL_ID          = V.STYL_ID                    08360099
083700            AND S.INTR_UPC_ID      = U.INTR_UPC_ID                08370099
083800            AND UPC_TYP_CDE        = 'V'                          08380099
083900            AND EDI_ORD_IND        = 'Y'                          08390099
084000            AND NOT EXISTS                                        08400099
084100                (SELECT 1                                         08410099
084200                   FROM XLT_UPC U3                                08420099
084300                  WHERE U.INTR_UPC_ID   = U3.INTR_UPC_ID          08430099
084400                    AND U3.UPC_TYP_CDE    = 'I')                  08440099
084500      UNION ALL                                                   08450099
084600          SELECT                                                  08460099
084700                I.DFCT_ITEM_NBR                                   08470099
084800              , I.SEQ_NBR                                         08480099
084900              , I.MKOUT_ORD_STAT_CDE                              08490099
085000              , I.MKOUT_ORD_ID                                    08500099
085100              , I.RTL_COST_AMT                                    08510099
085200              , I.UNIT_COST_AMT                                   08520099
085300              , SUBSTR(DIGITS(V.DEPT_NBR),2,3)                    08530099
085400              , SUBSTR(DIGITS(V.SUB_CL_NBR),3,2)                  08540099
085500              , S.SKU_NBR                                         08550099
085600              , U.UPC_NBR                                         08560099
085700              , U.INTR_UPC_ID                                     08570099
085800              , S.SKU_DESC                                        08580099
085900              , V.VS_NBR                                          08590099
086000          FROM                                                    08600099
086100                TDFMEIT I                                         08610099
086200              , XLT_SKU S                                         08620099
086300              , XLT_VND_STYL V                                    08630099
086400              , XLT_UPC U                                         08640099
086500          WHERE                                                   08650099
086600                I.DFCT_ORD_ID      = :RV100-UK-RA-NUMBER          08660099
086700            AND I.DFCT_ITEM_NBR    = S.ITM_NBR                    08670099
086800            AND I.DFCT_ITEM_NBR   ^= 0                            08680099
086900            AND S.STYL_ID          = V.STYL_ID                    08690099
087000            AND S.INTR_UPC_ID      = U.INTR_UPC_ID                08700099
087100            AND UPC_TYP_CDE        = 'V'                          08710099
087200            AND EDI_ORD_IND        = 'N'                          08720099
087300            AND UPC_NBR =                                         08730099
087400                (SELECT MAX(UPC_NBR)                              08740099
087500                   FROM XLT_UPC U5                                08750099
087600                   WHERE U5.INTR_UPC_ID = U.INTR_UPC_ID           08760099
087700                     AND U5.UPC_TYP_CDE = 'V'                     08770099
087800                     AND U5.EDI_ORD_IND = 'N' )                   08780099
087900            AND NOT EXISTS                                        08790099
088000                 (SELECT 1                                        08800099
088100                    FROM XLT_UPC U4                               08810099
088200                   WHERE U.INTR_UPC_ID = U4.INTR_UPC_ID           08820099
088300                     AND UPC_TYP_CDE   = 'V'                      08830099
088400                     AND U4.EDI_ORD_IND = 'Y' )                   08840099
088500            AND NOT EXISTS                                        08850099
088600                 (SELECT 1                                        08860099
088700                    FROM XLT_UPC U6                               08870099
088800                   WHERE U.INTR_UPC_ID = U6.INTR_UPC_ID           08880099
088900                     AND UPC_TYP_CDE   = 'I')                     08890099
089000      UNION ALL                                                   08900099
089100* ALL ZERO ITEMS                                                  08910099
089200          SELECT                                                  08920099
089300                I.DFCT_ITEM_NBR                                   08930099
089400              , I.SEQ_NBR                                         08940099
089500              , I.MKOUT_ORD_STAT_CDE                              08950099
089600              , I.MKOUT_ORD_ID                                    08960099
089700              , I.RTL_COST_AMT                                    08970099
089800              , I.UNIT_COST_AMT                                   08980099
089900              , I.MDSE_DEPT_NBR                                   08990099
090000              , I.MDSE_CLASS_NBR                                  09000099
090100       , DECIMAL(I.MDSE_DEPT_NBR || I.MDSE_CLASS_NBR || '000')    09010099
090200              , 0                                                 09020099
090300              , 0                                                 09030099
090400              , 'ZERO SKU'                                        09040099
090500              , '    '                                            09050099
090600          FROM                                                    09060099
090700                TDFMEIT I                                         09070099
090800          WHERE                                                   09080099
090900                I.DFCT_ORD_ID      = :RV100-UK-RA-NUMBER          09090099
091000            AND I.DFCT_ITEM_NBR    = 0                            09100099
091100      UNION ALL                                                   09110099
091200* NON-ZERO ITEMS WITH NO MATCHING SKU RECORD (DELETED)            09120099
091300          SELECT                                                  09130099
091400                I.DFCT_ITEM_NBR                                   09140099
091500              , I.SEQ_NBR                                         09150099
091600              , I.MKOUT_ORD_STAT_CDE                              09160099
091700              , I.MKOUT_ORD_ID                                    09170099
091800              , I.RTL_COST_AMT                                    09180099
091900              , I.UNIT_COST_AMT                                   09190099
092000              , I.MDSE_DEPT_NBR                                   09200099
092100              , I.MDSE_CLASS_NBR                                  09210099
092200       , DECIMAL(I.MDSE_DEPT_NBR || I.MDSE_CLASS_NBR || '000')    09220099
092300              , 0                                                 09230099
092400              , 0                                                 09240099
092500              , 'SKU DELETED'                                     09250099
092600              , '     '                                           09260099
092700          FROM                                                    09270099
092800                TDFMEIT I                                         09280099
092900          WHERE                                                   09290099
093000                I.DFCT_ORD_ID      = :RV100-UK-RA-NUMBER          09300099
093100            AND I.DFCT_ITEM_NBR   ^= 0                            09310099
093200            AND NOT EXISTS                                        09320099
093300            (SELECT 1                                             09330099
093400             FROM XLT_SKU    S                                    09340099
093500             WHERE I.DFCT_ITEM_NBR    = S.ITM_NBR)                09350099
093600          ORDER BY                                                09360099
093700                5  DESC                                           09370099
093800              , 9  ASC                                            09380099
093900     END-EXEC.                                                    09390099
094000                                                                  09400099
094100                                                                  09410099
094200 EJECT                                                            09420099
094300 LINKAGE SECTION.                                                 09430099
094400                                                                  09440099
094500 01  DFHCOMMAREA.                                                 09450099
094600     05  FILLER                         OCCURS  1 TO 4072 TIMES   09460099
094700                                        DEPENDING ON EIBCALEN.    09470099
094800         10  FILLER                     PIC X.                    09480099
094900                                                                  09490099
095000 EJECT                                                            09500099
095100 PROCEDURE DIVISION.                                              09510099
095200                                                                  09520099
095300                                                                  09530099
095400 A100-MAIN-MODULE.                                                09540099
095500*----------------------------------------------------------------*09550099
095600*    PROCESS THIS TRANSACTION IF THE COMMAREA IS VALID.          *09560099
095700*----------------------------------------------------------------*09570099
095800     PERFORM DP015-0000-CHECK-COMMAREA.                           09580099
095900                                                                  09590099
096000     IF DP020-SRC-RETURN-W-TRAN-ID                                09600099
096100         PERFORM B100-CONTROL-PROCESSING                          09610099
096200     END-IF.                                                      09620099
096300                                                                  09630099
096400     PERFORM DP003-0000-RETURN-TO-CICS.                           09640099
096500*----------------------------------------------------------------*09650099
096600*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *09660099
096700*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *09670099
096800*                                                                *09680099
096900*    PERFORMED BY A100-MAIN-MODULE.                              *09690099
097000*----------------------------------------------------------------*09700099
097100 B100-CONTROL-PROCESSING.                                         09710099
097200     SET PS-CONTINUE           TO  TRUE.                          09720099
097300     MOVE LENGTH OF RV102-BLOCK-ENTRIES (1)                       09730099
097400                               TO  PC-BLOCK-LENGTH.               09740099
097500                                                                  09750099
097600     EVALUATE TRUE                                                09760099
097700         WHEN DP020-NEXT-ACT-INITIAL                              09770099
097800              INITIALIZE RV102-SPECIFIC-COMMAREA                  09780099
097900              MOVE INTER-APPL-COMM-AREA                           09790099
098000                               TO  RV102-SAVE-APPL-COMMAREA       09800099
098100              MOVE DP020-INT-APPL-FORMAT-IND                      09810099
098200                               TO  RV102-INT-APPL-FORMAT-IND      09820099
098300              SET PS-CONTINUE  TO  TRUE                           09830099
098400              SET PS-SEND-MAP-N-DATA-FRSET                        09840099
098500                               TO  TRUE                           09850099
098600              SET DP020-NEXT-ACT-READ-MAP                         09860099
098700                               TO  TRUE                           09870099
098800              PERFORM D100-SETUP-INIT-PANEL                       09880099
098900              IF PS-NO-ERROR                                      09890099
099000                  IF PS-NO-LIST-ITEMS-FOUND                       09900099
099100                      MOVE DP016-PF3                              09910099
099200                                 TO DP020-SRC-AID                 09920099
099300                      PERFORM DP015-1000-START-NAVIGATOR          09930099
099400                  END-IF                                          09940099
099500              ELSE                                                09950099
099600                  MOVE DP016-PF3                                  09960099
099700                                 TO DP020-SRC-AID                 09970099
099800                  PERFORM DP015-1000-START-NAVIGATOR              09980099
099900              END-IF                                              09990099
100000                                                                  10000099
100100                                                                  10010099
100200         WHEN DP020-NEXT-ACT-READ-MAP                             10020099
100300              PERFORM C300-PROCESS-PANEL                          10030099
100400*JPL - 2/2/04                                                     10040099
100500             IF (RV102-ORDER-STATUS = 'SHIPPED ' OR 'APPROVED'    10050099
100600                                                 OR 'DEBT/DIS')   10060099
100700                 PERFORM                                          10070099
100800                   VARYING PS-SUB FROM 1 BY 1                     10080099
100900                     UNTIL PS-SUB > PC-ITEMS-PER-PANEL            10090099
101000                     MOVE DP015-PRO-BRT-MDT                       10100099
101100                                      TO RVKM102-SELECTA (PS-SUB) 10110099
101200                                         RVKM102-URETAILA(PS-SUB) 10120099
101300***                  MOVE DP015-UNDERLINE                         10130099
101400***                                   TO RVKM102-SELECTH (PS-SUB) 10140099
101500                     MOVE DP015-BLUE  TO RVKM102-SELECTC (PS-SUB) 10150099
101600                                         RVKM102-URETAILC(PS-SUB) 10160099
101700                 END-PERFORM                                      10170099
101800                 MOVE -1              TO ANAVCMDL                 10180099
101900             END-IF                                               10190099
102000                                                                  10200099
102100         WHEN DP020-NEXT-ACT-RETURN                               10210099
102200              SET PS-SEND-MAP-N-DATA-FRSET                        10220099
102300                               TO  TRUE                           10230099
102400              MOVE RV102-SAVE-APPL-COMMAREA                       10240099
102500                               TO  INTER-APPL-COMM-AREA           10250099
102600              PERFORM C400-REFRESH-PANEL-FROM-TEMP                10260099
102700              PERFORM G100-DISPLAY-PANEL                          10270099
102800*JPL - 2/2/04                                                     10280099
102900             IF (RV102-ORDER-STATUS = 'SHIPPED ' OR 'APPROVED'    10290099
103000                                                 OR 'DEBT/DIS')   10300099
103100                 PERFORM                                          10310099
103200                   VARYING PS-SUB FROM 1 BY 1                     10320099
103300                     UNTIL PS-SUB > PC-ITEMS-PER-PANEL            10330099
103400                     MOVE DP015-PRO-BRT-MDT                       10340099
103500                                      TO RVKM102-SELECTA (PS-SUB) 10350099
103600                                         RVKM102-URETAILA(PS-SUB) 10360099
103700***                  MOVE DP015-UNDERLINE                         10370099
103800***                                   TO RVKM102-SELECTH (PS-SUB) 10380099
103900                     MOVE DP015-BLUE  TO RVKM102-SELECTC (PS-SUB) 10390099
104000                                         RVKM102-URETAILC(PS-SUB) 10400099
104100                 END-PERFORM                                      10410099
104200                 MOVE -1              TO ANAVCMDL                 10420099
104300             END-IF                                               10430099
104400                                                                  10440099
104500         WHEN DP020-NEXT-ACT-ERROR                                10450099
104600              MOVE DP020-MSG-MESSAGE TO PV-MESSAGE                10460099
104700              IF  DP020-NAV-MNEMONIC = SPACES                     10470099
104800                  MOVE SPACES  TO  ANAVCMDO                       10480099
104900                  MOVE DP015-UNDERLINE                            10490099
105000                               TO  ANAVCMDH                       10500099
105100                  MOVE DP015-GREEN                                10510099
105200                               TO  ANAVCMDC                       10520099
105300              ELSE                                                10530099
105400                  MOVE DP020-NAV-MNEMONIC                         10540099
105500                               TO  ANAVCMDO                       10550099
105600                  MOVE DP015-REVERSE                              10560099
105700                               TO  ANAVCMDH                       10570099
105800                  MOVE DP015-RED                                  10580099
105900                               TO  ANAVCMDC                       10590099
106000              END-IF                                              10600099
106100                                                                  10610099
106200              PERFORM C400-REFRESH-PANEL-FROM-TEMP                10620099
106300              MOVE -1          TO  ANAVCMDL                       10630099
106400              MOVE PV-MESSAGE  TO  DP020-MSG-MESSAGE              10640099
106500                                                                  10650099
106600              SET DP020-MSG-FATAL                                 10660099
106700                               TO  TRUE                           10670099
106800              SET PS-SEND-MAP-N-DATA-FRSET                        10680099
106900                               TO  TRUE                           10690099
107000              SET PS-CURSOR-POSITIONED                            10700099
107100                               TO  TRUE                           10710099
107200              PERFORM G100-DISPLAY-PANEL                          10720099
107300*JPL - 2/2/04                                                     10730099
107400             IF (RV102-ORDER-STATUS = 'SHIPPED ' OR 'APPROVED'    10740099
107500                                                 OR 'DEBT/DIS')   10750099
107600                 PERFORM                                          10760099
107700                   VARYING PS-SUB FROM 1 BY 1                     10770099
107800                     UNTIL PS-SUB > PC-ITEMS-PER-PANEL            10780099
107900                     MOVE DP015-PRO-BRT-MDT                       10790099
108000                                      TO RVKM102-SELECTA (PS-SUB) 10800099
108100                                         RVKM102-URETAILA(PS-SUB) 10810099
108200***                  MOVE DP015-UNDERLINE                         10820099
108300***                                   TO RVKM102-SELECTH (PS-SUB) 10830099
108400                     MOVE DP015-BLUE  TO RVKM102-SELECTC (PS-SUB) 10840099
108500                                         RVKM102-URETAILC(PS-SUB) 10850099
108600                 END-PERFORM                                      10860099
108700                 MOVE -1              TO ANAVCMDL                 10870099
108800             END-IF                                               10880099
108900                                                                  10890099
109000         WHEN OTHER                                               10900099
109100              SET DP013-LOGIC-ABEND TO TRUE                       10910099
109200              SET DP013-NO-ROLLBACK TO TRUE                       10920099
109300              MOVE 'B100-CONTROL-PROCESSING'                      10930099
109400                               TO  DP013-PARAGRAPH                10940099
109500              MOVE PM-PROGRAM-MESSAGE-12                          10950099
109600                               TO  DP013-MESSAGE-TEXT(1)          10960099
109700              PERFORM DP013-0000-PROCESS-ABEND                    10970099
109800     END-EVALUATE.                                                10980099
109900*----------------------------------------------------------------*10990099
110000*    RECEIVE THE MAP AND PERFORM THE APPROPRIATE PARAGRAPH BASED *11000099
110100*    ON WHAT FUNCTION KEY WAS SELECTED.                          *11010099
110200*                                                                *11020099
110300*    PERFORMED BY B100-CONTROL-PROCESSING.                       *11030099
110400*----------------------------------------------------------------*11040099
110500 C300-PROCESS-PANEL.                                              11050099
110600     PERFORM DP007-0000-GET-PANEL.                                11060099
110700     SET PS-SEND-DATA-ONLY-FRSET TO TRUE.                         11070099
110800                                                                  11080099
110900     EVALUATE TRUE                                                11090099
111000         WHEN DP020-SRC-AID = DP016-CLEAR                         11100099
111100              SET PS-SEND-MAP-N-DATA-FRSET TO TRUE                11110099
111200              SET PS-SAME-ITEMS-DISPLAYED  TO TRUE                11120099
111300              PERFORM D500-REFRESH-HEADER                         11130099
111400              PERFORM E100-EDIT-SELECTIONS                        11140099
111500              PERFORM G100-DISPLAY-PANEL                          11150099
111600                                                                  11160099
111700         WHEN DP020-SRC-AID = DP016-PF5                           11170099
111800              SET PS-SEND-MAP-N-DATA-FRSET TO TRUE                11180099
111900              MOVE SPACES      TO  ANAVCMDO                       11190099
112000                                   ANAVKEYO                       11200099
112100              INITIALIZE RV102-SPECIFIC-COMMAREA                  11210099
112200              PERFORM Z050-DELETE-TEMP-STORAGE                    11220099
112300              PERFORM D100-SETUP-INIT-PANEL                       11230099
112400                                                                  11240099
112500         WHEN DP020-SRC-AID = DP016-PA2                           11250099
112600              PERFORM DP009-0000-LOAD-FK-LINES                    11260099
112700              PERFORM DP017-0000-GET-CURR-DATE-TIME               11270099
112800              SET PS-SEND-DATA-ONLY                               11280099
112900                               TO  TRUE                           11290099
113000              MOVE -1          TO  ANAVCMDL                       11300099
113100              PERFORM DP008-0000-WRITE-PANEL                      11310099
113200                                                                  11320099
113300         WHEN OTHER                                               11330099
113400              PERFORM D200-RECORD-SELECTIONS                      11340099
113500              IF (PS-VALID-SELECTIONS                             11350099
113600              AND PS-CONTINUE)                                    11360099
113700                  PERFORM D300-CHECK-FUNCTION-KEY                 11370099
113800              ELSE                                                11380099
113900                  SET PS-SAME-ITEMS-DISPLAYED TO TRUE             11390099
114000                  PERFORM G100-DISPLAY-PANEL                      11400099
114100             END-IF                                               11410099
114200     END-EVALUATE.                                                11420099
114300*----------------------------------------------------------------*11430099
114400*    WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,*11440099
114500*    SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.      *11450099
114600*    EDIT THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL *11460099
114700*    TO THE USER.                                                *11470099
114800*                                                                *11480099
114900*    PERFORMED BY B100-CONTROL-PROCESSING.                       *11490099
115000*----------------------------------------------------------------*11500099
115100 C400-REFRESH-PANEL-FROM-TEMP.                                    11510099
115200     IF  RV100-NUMBER-PROCESSED-ITEMS NUMERIC                     11520099
115300         MOVE ZERO             TO  PV-SAVE-ITEM                   11530099
115400                                   PV-TSQ-B-ITEM                  11540099
115500         SET PS-NOT-END        TO TRUE                            11550099
115600         PERFORM C500-UPDATE-TSQ                                  11560099
115700             UNTIL PS-END-OF-ITEMS                                11570099
115800         PERFORM X900-DELETE-LIST-QUEUE                           11580099
115900         MOVE SPACES           TO  RV102-HOLD-TSQB-QUEUE-NAME     11590099
116000     END-IF.                                                      11600099
116100                                                                  11610099
116200     PERFORM D500-REFRESH-HEADER.                                 11620099
116300     PERFORM D400-REFRESH-BLOCK-ARRAY.                            11630099
116400     PERFORM E100-EDIT-SELECTIONS.                                11640099
116500                                                                  11650099
116600     SET PS-DIFFERENT-ITEMS-DISPLAYED TO TRUE.                    11660099
116700     MOVE RV102-HOLD-TSQB-QUEUE-NAME                              11670099
116800                               TO  RV100-TSQB-QUEUE-NAME.         11680099
116900*----------------------------------------------------------------*11690099
117000*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *11700099
117100*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *11710099
117200*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *11720099
117300*    THE TEMP QUEUE.                                             *11730099
117400*                                                                *11740099
117500*    PERFORMED BY C400                                           *11750099
117600*----------------------------------------------------------------*11760099
117700 C500-UPDATE-TSQ.                                                 11770099
117800     ADD 1                     TO  PV-TSQ-B-ITEM.                 11780099
117900     PERFORM X600-READ-LIST-QUEUE.                                11790099
118000     IF  PV-RESP EQUAL DFHRESP(NORMAL)                            11800099
118100         SET RV103-IDX         TO  1                              11810099
118200         PERFORM C600-PROCESS-ITEMS                               11820099
118300             UNTIL RV103-RA-ARRAY (RV103-IDX) EQUAL SPACES        11830099
118400             OR RV103-IDX GREATER THAN RV103-RA-MAX-ITEMS         11840099
118500         PERFORM X550-WRITE-TS-QUEUE                              11850099
118600     ELSE                                                         11860099
118700         SET PS-END-OF-ITEMS   TO  TRUE.                          11870099
118800*----------------------------------------------------------------*11880099
118900*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*11890099
119000*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*11900099
119100*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *11910099
119200*                                                                *11920099
119300*    PERFORMED BY C500                                           *11930099
119400*----------------------------------------------------------------*11940099
119500 C600-PROCESS-ITEMS.                                              11950099
119600     COMPUTE PV-ITEM = 1 + ((RV103-ITEM (RV103-IDX) - 1)          11960099
119700                     / PC-ITEMS-PER-BLOCK).                       11970099
119800                                                                  11980099
119900     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           11990099
120000         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          12000099
120100             PERFORM X550-WRITE-TS-QUEUE                          12010099
120200         END-IF                                                   12020099
120300         MOVE PV-ITEM          TO  PV-SAVE-ITEM                   12030099
120400                                                                  12040099
120500         PERFORM X300-READ-TS-QUEUE                               12050099
120600         IF  PV-RESP NOT EQUAL DFHRESP(NORMAL)                    12060099
120700             SET PS-END-OF-ITEMS TO TRUE                          12070099
120800         END-IF                                                   12080099
120900     END-IF.                                                      12090099
121000                                                                  12100099
121100     IF  PS-NOT-END                                               12110099
121200         COMPUTE PS-SUB = (RV103-ITEM (RV103-IDX)                 12120099
121300                        - PV-TW-LIST-ITEM-NUMBER (1)) + 1         12130099
121400         SET PV-TW-DESELECT (PS-SUB)                              12140099
121500                               TO  TRUE                           12150099
121600         EVALUATE TRUE                                            12160099
121700             WHEN RV103-INQ (RV103-IDX)                           12170099
121800                  MOVE PC-INQ  TO  PV-TW-ACTION (PS-SUB)          12180099
121900                                                                  12190099
122000             WHEN RV103-UPD (RV103-IDX)                           12200099
122100                  MOVE PC-UPD  TO  PV-TW-ACTION (PS-SUB)          12210099
122200                                                                  12220099
122300             WHEN RV103-DEL (RV103-IDX)                           12230099
122400                  MOVE PC-DEL  TO  PV-TW-ACTION (PS-SUB)          12240099
122500                                                                  12250099
122600             WHEN RV103-ERR (RV103-IDX)                           12260099
122700                  MOVE PC-ERR  TO  PV-TW-ACTION (PS-SUB)          12270099
122800         END-EVALUATE                                             12280099
122900                                                                  12290099
123000         SUBTRACT 1          FROM  RV100-NUMBER-PROCESSED-ITEMS   12300099
123100                                   RV102-NUMBER-OF-SELECTED-ITEMS 12310099
123200         IF  RV100-NUMBER-PROCESSED-ITEMS EQUAL ZERO              12320099
123300             SET PS-END-OF-ITEMS TO TRUE                          12330099
123400             SET RV103-IDX     TO  RV103-RA-MAX-ITEMS             12340099
123500         END-IF                                                   12350099
123600         SET RV103-IDX      UP BY  1                              12360099
123700     END-IF.                                                      12370099
123800*----------------------------------------------------------------*12380099
123900*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *12390099
124000*    INITIALIZE ALL COUNTERS AND FLAGS.                          *12400099
124100*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *12410099
124200*    DISPLAY THE PANEL TO USER.                                  *12420099
124300*                                                                *12430099
124400*    PERFORMED BY B100-CONTROL-PROCESSING.                       *12440099
124500*    PERFORMED BY C300-PROCESS-PANEL.                            *12450099
124600*----------------------------------------------------------------*12460099
124700 D100-SETUP-INIT-PANEL.                                           12470099
124800     INITIALIZE                  RV102-BLOCK-ENTRIES (1).         12480099
124900     INITIALIZE                  RV102-BLOCK-ENTRIES (2).         12490099
125000     MOVE SPACES             TO  RV102-HOLD-TSQB-QUEUE-NAME.      12500099
125100     MOVE +1                 TO  RV102-BLK-SUB.                   12510099
125200     MOVE PC-ITEMS-PER-PANEL TO  PV-HIGHEST-ITEM-TO-BE-READ.      12520099
125300     SET RV102-ITEMS-LEFT-ON-DB                                   12530099
125400                             TO  TRUE.                            12540099
125500                                                                  12550099
125600     MOVE +0                 TO  RV102-ITEM-SUB                   12560099
125700                                 RV102-NUMBER-OF-ITEMS-READ       12570099
125800                                 RV102-NUMBER-OF-SELECTED-ITEMS   12580099
125900                                 RV102-HIGHEST-BLOCK-WRITTEN      12590099
126000                                 RV102-START-OF-SELECTED-RANGE    12600099
126100                                 RV102-END-OF-SELECTED-RANGE.     12610099
126200                                                                  12620099
126300     PERFORM DP017-0000-GET-CURR-DATE-TIME.                       12630099
126400     MOVE DP017-EDITED-DATE-YYYYMMDD                              12640099
126500                                 TO RV102-DB2-CURRENT-DATE.       12650099
126600     SET RV102-DC-DASH1          TO TRUE.                         12660099
126700     SET RV102-DC-DASH2          TO TRUE.                         12670099
126800                                                                  12680099
126900     PERFORM D150-GET-HEADER-INFO.                                12690099
127000                                                                  12700099
127100     EVALUATE DFCTOR-DFCT-ORD-ID-CDE                              12710099
127200         WHEN 'M'                                                 12720099
127300             MOVE 'MARKOUT '     TO RV102-ORDER-TYPE              12730099
127400                                                                  12740099
127500         WHEN 'R'                                                 12750099
127600             MOVE 'RTV     '     TO RV102-ORDER-TYPE              12760099
127700                                                                  12770099
127800         WHEN 'D'                                                 12780099
127900             MOVE 'DEBT/DIS'     TO RV102-ORDER-TYPE              12790099
128000                                                                  12800099
128100         WHEN 'C'                                                 12810099
128200             MOVE 'CALLBACK'     TO RV102-ORDER-TYPE              12820099
128300     END-EVALUATE.                                                12830099
128400                                                                  12840099
128500     EVALUATE DFCTOR-DFCT-ORD-STAT-CDE                            12850099
128600         WHEN 'O'                                                 12860099
128700             MOVE 'OPEN    '     TO RV102-ORDER-STATUS            12870099
128800                                                                  12880099
128900         WHEN 'C'                                                 12890099
129000             MOVE 'CLOSED  '     TO RV102-ORDER-STATUS            12900099
129100                                                                  12910099
129200         WHEN 'S'                                                 12920099
129300             MOVE 'SHIPPED '     TO RV102-ORDER-STATUS            12930099
129400                                                                  12940099
129500         WHEN 'P'                                                 12950099
129600             MOVE 'PENDING '     TO RV102-ORDER-STATUS            12960099
129700                                                                  12970099
129800         WHEN 'A'                                                 12980099
129900             MOVE 'APPROVED'     TO RV102-ORDER-STATUS            12990099
130000                                                                  13000099
130100         WHEN 'D'                                                 13010099
130200             MOVE 'DEBT/DIS'     TO RV102-ORDER-STATUS            13020099
130300     END-EVALUATE.                                                13030099
130400                                                                  13040099
130500     IF (RV102-ORDER-TYPE = 'MARKOUT ' AND                        13050099
130600         RV102-ORDER-STATUS NOT = 'OPEN    ')                     13060099
130700         MOVE RV100-OPER-UNT-ID  TO PV-DC-NMBR-COMP               13070099
130910         PERFORM D175-SELECT-DC-STORE-NUMBER                      13091099
131100     END-IF.                                                      13110099
131200                                                                  13120099
131300     MOVE DFCTOR-VENDOR-DUNS-NBR TO RV102-VENDOR-DUNS-NBR.        13130099
131400     MOVE DFCTOR-VEND-NAME       TO RV102-VENDOR-DESCRIPTION.     13140099
131500                                                                  13150099
131600     PERFORM L100-OPEN-CURSOR.                                    13160099
131700                                                                  13170099
131800     PERFORM H100-READ-ITEMS-FROM-DB.                             13180099
131900     IF PS-NO-ERROR                                               13190099
132000         SET PS-DIFFERENT-ITEMS-DISPLAYED                         13200099
132100                                 TO TRUE                          13210099
132200                                                                  13220099
132300         MOVE +1                 TO RV102-ITEM-AT-TOP-OF-PANEL    13230099
132400                                                                  13240099
132500         IF PS-NO-LIST-ITEMS-FOUND                                13250099
132600             CONTINUE                                             13260099
132700         ELSE                                                     13270099
132800             PERFORM D500-REFRESH-HEADER                          13280099
132900             PERFORM G100-DISPLAY-PANEL                           13290099
133000         END-IF                                                   13300099
133100     END-IF.                                                      13310099
133200*----------------------------------------------------------------*13320099
133300*    USE THE RA NUMBER TO GET THE HEADER INFORMATION.            *13330099
133400*                                                                *13340099
133500*    PERFORMED BY D100                                           *13350099
133600*----------------------------------------------------------------*13360099
133700 D150-GET-HEADER-INFO.                                            13370099
133800                                                                  13380099
133900     PERFORM                                                      13390099
134000         WITH TEST AFTER                                          13400099
134100         VARYING PV-SQL-SUB                                       13410099
134200         FROM 1 BY 1                                              13420099
134300         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             13430099
134400            OR SQLCODE = 0                                        13440099
134500            OR SQLCODE = +100                                     13450099
134600                                                                  13460099
134700         EXEC SQL                                                 13470099
134800              SELECT                                              13480099
134900                    VENDOR_DUNS_NBR                               13490099
135000                  , VEND_NAME                                     13500099
135100                  , DFCT_ORD_ID_CDE                               13510099
135200                  , DFCT_ORD_STAT_CDE                             13520099
135300              INTO                                                13530099
135400                    :DFCTOR-VENDOR-DUNS-NBR                       13540099
135500                  , :DFCTOR-VEND-NAME                             13550099
135600                  , :DFCTOR-DFCT-ORD-ID-CDE                       13560099
135700                  , :DFCTOR-DFCT-ORD-STAT-CDE                     13570099
135800              FROM                                                13580099
135900                    TDFCTOR                                       13590099
136000              WHERE                                               13600099
136100                    DFCT_ORD_ID      =  :RV100-UK-RA-NUMBER       13610099
136200         END-EXEC                                                 13620099
136300                                                                  13630099
136400         EVALUATE TRUE                                            13640099
136500             WHEN SQLCODE = ZERO                                  13650099
136600             WHEN SQLCODE = -911                                  13660099
136700             WHEN SQLCODE = -913                                  13670099
136800                  CONTINUE                                        13680099
136900             WHEN SQLWARN0 NOT EQUAL SPACE                        13690099
137000             WHEN SQLCODE NOT EQUAL ZERO                          13700099
137100                  MOVE 'D150-GET-HEADER-INFO'                     13710099
137200                               TO  DP013-PARAGRAPH                13720099
137300                  MOVE 'SELECT FOR HEADER INFORMATION'            13730099
137400                               TO  DP013-MESSAGE-TEXT (1)         13740099
137500                  MOVE SQLCA   TO  DP013-SQLCA                    13750099
137600                  SET DP013-DB2-ABEND                             13760099
137700                               TO  TRUE                           13770099
137800                  PERFORM DP013-0000-PROCESS-ABEND                13780099
137900         END-EVALUATE                                             13790099
138000     END-PERFORM.                                                 13800099
138100                                                                  13810099
138200     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   13820099
138300         MOVE 'D150-GET-HEADER-INFO'                              13830099
138400                               TO  DP013-PARAGRAPH                13840099
138500         MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                   13850099
138600                               TO  DP013-MESSAGE-TEXT (1)         13860099
138700         MOVE SQLCA            TO  DP013-SQLCA                    13870099
138800         SET DP013-DB2-ABEND   TO  TRUE                           13880099
138900         PERFORM DP013-0000-PROCESS-ABEND                         13890099
139000     END-IF.                                                      13900099
139100*----------------------------------------------------------------*13910099
139200*  SELECT THE "RV" LOCATION NUMBER FOR THE DISTRIBUTION CENTER   *13920099
139300*  LOCATION                                                      *13930099
139400*----------------------------------------------------------------*13940099
139500 D175-SELECT-DC-STORE-NUMBER.                                     13950099
139600     EXEC SQL                                                     13960099
139700         SELECT B.LOC_NBR                                         13970099
139800         INTO  :XLT00010-LOC-NBR                                  13980099
139900           FROM XLT_DC_LOC_ASGMT A                                13990099
139910              , XLT_LOC          B                                13991099
140000          WHERE A.DC_NBR = :PV-DC-NMBR-COMP                       14000099
140100            AND A.LOC_NBR = B.LOC_NBR                             14010099
140200            AND B.LOC_TYP_CDE = 'RV'                              14020099
140300            AND (CHAR(CURRENT_DATE, ISO)                          14030099
140400                  BETWEEN                                         14040099
140500                  CHAR(B.OPN_DTE,ISO)                             14050099
140510                      AND                                         14051099
140600                  CHAR(B.CLO_DTE,ISO))                            14060099
140800     END-EXEC                                                     14080099
140900                                                                  14090099
141000     EVALUATE TRUE                                                14100099
141100         WHEN SQLCODE = ZERO                                      14110099
141200             MOVE XLT00010-LOC-NBR TO RV102-STR-NBR               14120099
141210                                      PV-WORK-DC-NBR              14121099
141300         WHEN SQLCODE = +100                                      14130099
141400             MOVE XLT00010-LOC-NBR TO RV102-STR-NBR               14140099
141410                                      PV-WORK-DC-NBR              14141099
141500         WHEN OTHER                                               14150099
141600             MOVE 'D175-SELECT-DC-STORE-NUMBER'                   14160099
141700                                 TO DP013-PARAGRAPH               14170099
141800             MOVE 'SELECT RTVS DISTRIBUTION CENTER STR NBR'       14180099
141900                                 TO DP013-MESSAGE-TEXT (1)        14190099
141910             MOVE XLT00010-LOC-NBR TO PV-LOCATION                 14191099
141911             STRING 'OPER-UNT-ID :  '  DELIMITED BY SIZE          14191199
141912                     PV-LOCATION       DELIMITED BY SIZE          14191299
141920                               INTO DP013-MESSAGE-TEXT (2)        14192099
142000             MOVE SQLCA          TO DP013-SQLCA                   14200099
142100             SET DP013-DB2-ABEND TO TRUE                          14210099
142200             PERFORM DP013-0000-PROCESS-ABEND                     14220099
142300     END-EVALUATE.                                                14230099
142400*----------------------------------------------------------------*14240099
142500*    IF THE USER HIT THE DESELECT KEY, OR A KEY WHICH INVOLVES   *14250099
142600*    LEAVING THIS TRANSACTION AND GOING TO ANOTHER, SET A FLAG   *14260099
142700*    INDICATING THAT ALL SELECTIONS ARE VALID.  IF ANY OTHER KEY *14270099
142800*    IS HIT, MOVE THE SELECTIONS MADE TO THE COMMAREA, AND EDIT  *14280099
142900*    THOSE SELECTIONS.                                           *14290099
143000*                                                                *14300099
143100*    IF THE USER ENTERED SOMETHING IN THE COMMAND LINE OR HIT    *14310099
143200*    AN INVALID FUNCTION KEY, DO NOT EDIT THE SELECTIONS.        *14320099
143300*                                                                *14330099
143400*    PERFORMED BY C300-PROCESS-PANEL.                            *14340099
143500*----------------------------------------------------------------*14350099
143600 D200-RECORD-SELECTIONS.                                          14360099
143700                                                                  14370099
143800     SET RV102-NO-TSQ-UPDATE   TO  TRUE.                          14380099
143900                                                                  14390099
144000     IF (DP020-FK-DESELECT(DP020-SRC-AID))   OR                   14400099
144100        (DP020-FK-SELECT-ALL(DP020-SRC-AID)) OR                   14410099
144200        (DP020-FK-GO-TO-TRAN(DP020-SRC-AID)) OR                   14420099
144300        (DP020-FK-RETURN(DP020-SRC-AID))                          14430099
144400         SET PS-VALID-SELECTIONS TO TRUE                          14440099
144500         SET RV102-CANT-DELETE   TO TRUE                          14450099
144600     ELSE                                                         14460099
144700         PERFORM E200-MOVE-SELECTS-TO-COMMAREA                    14470099
144800         IF (DP020-SRC-AID EQUAL DP016-ENTER                      14480099
144900         AND DP020-NAV-MNEMONIC GREATER THAN SPACES)              14490099
145000             SET PS-VALID-SELECTIONS TO TRUE                      14500099
145100             SET RV102-CANT-DELETE   TO TRUE                      14510099
145200         ELSE                                                     14520099
145300             PERFORM E100-EDIT-SELECTIONS                         14530099
145400         END-IF                                                   14540099
145500     END-IF.                                                      14550099
145600*----------------------------------------------------------------*14560099
145700*    PERFORM THE APPROPRIATE PARAGRAPH BASED ON WHICH FUNCTION   *14570099
145800*    KEY HAD BEEN SELECTED BY THE USER.                          *14580099
145900*                                                                *14590099
146000*    PERFORMED BY C300-PROCESS-PANEL.                            *14600099
146100*----------------------------------------------------------------*14610099
146200 D300-CHECK-FUNCTION-KEY.                                         14620099
146300     EVALUATE TRUE                                                14630099
146400                                                                  14640099
146500         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  14650099
146600             SET RV102-CANT-DELETE   TO TRUE                      14660099
146700             IF  PS-CONTINUE                                      14670099
146800                 IF  RV102-NUMBER-OF-SELECTED-ITEMS > ZERO        14680099
146900                     PERFORM X100-PREPARE-LIST-QUEUE              14690099
147000                                                                  14700099
147100                     IF  PS-CONTINUE                              14710099
147200                         PERFORM E300-NAVIGATE                    14720099
147300                     ELSE                                         14730099
147400                         SET DP013-LOGIC-ABEND TO TRUE            14740099
147500                         SET DP013-NO-ROLLBACK TO TRUE            14750099
147600                         MOVE 'D300-CHECK-FUNCTION-KEY'           14760099
147700                               TO  DP013-PARAGRAPH                14770099
147800                         MOVE PM-PROGRAM-MESSAGE-28               14780099
147900                               TO  DP013-MESSAGE-TEXT(1)          14790099
148000                         PERFORM DP013-0000-PROCESS-ABEND         14800099
148100                     END-IF                                       14810099
148200                                                                  14820099
148300                 ELSE                                             14830099
148400                                                                  14840099
148500*----PC-TSYMSG-00057 - A LIST ITEM MUST BE SELECTED FOR THIS      14850099
148600*----                  FUNCTION                                   14860099
148700                     MOVE PC-TSYMSG-00057                         14870099
148800                               TO  DP020-MSG-NUMBER               14880099
148900                     SET DP020-MSG-WARNING                        14890099
149000                               TO TRUE                            14900099
149100                     PERFORM G100-DISPLAY-PANEL                   14910099
149200                 END-IF                                           14920099
149300             ELSE                                                 14930099
149400                 PERFORM G100-DISPLAY-PANEL                       14940099
149500             END-IF                                               14950099
149600                                                                  14960099
149700         WHEN DP020-FK-RETURN(DP020-SRC-AID)                      14970099
149800              PERFORM X900-DELETE-LIST-QUEUE                      14980099
149900              PERFORM E300-NAVIGATE                               14990099
150000                                                                  15000099
150100         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  15010099
150200              SET RV102-CANT-DELETE   TO TRUE                     15020099
150300              IF  PS-CONTINUE                                     15030099
150400                  PERFORM E400-DISPLAY-TOP-OF-LIST                15040099
150500              END-IF                                              15050099
150600                                                                  15060099
150700         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   15070099
150800              SET RV102-CANT-DELETE   TO TRUE                     15080099
150900              IF  PS-CONTINUE                                     15090099
151000                  PERFORM E500-BROWSE-BACKWARD                    15100099
151100              END-IF                                              15110099
151200                                                                  15120099
151300         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   15130099
151400              SET RV102-CANT-DELETE   TO TRUE                     15140099
151500              IF  PS-CONTINUE                                     15150099
151600                  PERFORM E600-BROWSE-FORWARD                     15160099
151700              END-IF                                              15170099
151800                                                                  15180099
151900         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    15190099
152000              SET RV102-CANT-DELETE   TO TRUE                     15200099
152100              PERFORM E700-DESELECT-ALL-ITEMS                     15210099
152200                                                                  15220099
152300         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  15230099
152400              SET RV102-CANT-DELETE   TO TRUE                     15240099
152500*JPL - 2/2/04                                                     15250099
152600              IF (RV102-ORDER-STATUS = 'SHIPPED ' OR 'APPROVED'   15260099
152700                                                  OR 'DEBT/DIS')  15270099
152800                  MOVE -1 TO ANAVCMDL                             15280099
152900              ELSE                                                15290099
153000                  PERFORM E900-SELECT-ALL-ITEMS                   15300099
153100              END-IF                                              15310099
153200                                                                  15320099
153300         WHEN DP020-SRC-AID = DP016-ENTER                         15330099
153400              SET RV102-CANT-DELETE   TO TRUE                     15340099
153500              IF  DP020-NAV-MNEMONIC GREATER THAN SPACES          15350099
153600                  PERFORM E300-NAVIGATE                           15360099
153700              ELSE                                                15370099
153800                  PERFORM E800-CHECK-FOR-JUMP-BROWSE              15380099
153900              END-IF                                              15390099
154000                                                                  15400099
154100*                                                                 15410099
154200*    THIS IS THE UPDATE FUNCTION (LOCAL-FUNC-01)                  15420099
154300*                                                                 15430099
154400         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)               15440099
154500*JPL - 2/2/04                                                     15450099
154600              IF (RV102-ORDER-STATUS = 'SHIPPED '                 15460099
154700                                    OR 'APPROVED'                 15470099
154800                                    OR 'DEBT/DIS')                15480099
154900                  MOVE PC-TSYMSG-03223        TO DP020-MSG-MESSAGE15490099
155000                  SET DP020-MSG-FATAL         TO TRUE             15500099
155100                  MOVE -1                     TO ANAVCMDL         15510099
155200              ELSE                                                15520099
155300              IF PS-CONTINUE                                      15530099
155400                  PERFORM P100-UPDATE-ROUTINE                     15540099
155500                  IF PS-UPDATED                                   15550099
155600                      SET PS-DIFFERENT-ITEMS-DISPLAYED TO TRUE    15560099
155700* COST CAN CHANGE, BECAUSE IT DOES NOT APPEAR ON A PERM DOCUMENT, 15570099
155800*  WHETHER RETAIL IS CHANGING OR NOT.  IF THE SKU RETAIL IS       15580099
155900*  CHANGING, BUT THE SKU IS ON A COMPLETED PERMANENT PRICE CHANGE 15590099
156000*  DOCUMENT, THE RETAIL CHANGE SHOULD NOT BE REFLECTED ON THE     15600099
156100*  LISTING SCREEN.                                                15610099
156200                      PERFORM D500-REFRESH-HEADER                 15620099
156300                  END-IF                                          15630099
156400              ELSE                                                15640099
156500                  MOVE 'CORRECT ERROR BEFORE UPDATE'              15650099
156600                                      TO DP020-MSG-MESSAGE        15660099
156700                  SET DP020-MSG-FATAL TO TRUE                     15670099
156800              END-IF                                              15680099
156900              END-IF                                              15690099
157000              PERFORM D400-REFRESH-BLOCK-ARRAY                    15700099
157100              PERFORM G100-DISPLAY-PANEL                          15710099
157200                                                                  15720099
157300*                                                                 15730099
157400*    THIS IS THE DELETE FUNCTION (LOCAL-FUNC-02)                  15740099
157500*                                                                 15750099
157600         WHEN DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)               15760099
157700*JPL - 2/2/04                                                     15770099
157800             IF (RV102-ORDER-STATUS = 'SHIPPED ' OR 'APPROVED'    15780099
157900                                                 OR 'DEBT/DIS')   15790099
158000                 SET RV102-CANT-DELETE       TO TRUE              15800099
158100                 MOVE PC-TSYMSG-03219        TO DP020-MSG-NUMBER  15810099
158200                 SET DP020-MSG-FATAL         TO TRUE              15820099
158300             ELSE                                                 15830099
158400                 IF PS-CONTINUE                                   15840099
158500                     SET RV102-CAN-DELETE TO TRUE                 15850099
158600*----PC-TSYMSG-00004 - PRESS F2 TO CONFIRM REQUEST                15860099
158700                     MOVE PC-TSYMSG-00004 TO DP020-MSG-NUMBER     15870099
158800                     SET DP020-MSG-INFORMATIONAL                  15880099
158900                                          TO TRUE                 15890099
159000                 ELSE                                             15900099
159100                     MOVE 'CORRECT ERROR BEFORE DELETE'           15910099
159200                                          TO DP020-MSG-MESSAGE    15920099
159300                     SET DP020-MSG-FATAL  TO TRUE                 15930099
159400                 END-IF                                           15940099
159500             END-IF                                               15950099
159600             PERFORM G100-DISPLAY-PANEL                           15960099
159700                                                                  15970099
159800*                                                                 15980099
159900*    THIS IS THE CONFIRM FOR THE DELETE FUNCTION                  15990099
160000*                                                                 16000099
160100         WHEN DP020-FK-CONFIRM(DP020-SRC-AID)                     16010099
160200              IF PS-CONTINUE                                      16020099
160300                  IF RV102-CAN-DELETE                             16030099
160400                      IF RV102-NUMBER-OF-SELECTED-ITEMS > ZERO    16040099
160500                          PERFORM O100-DELETE-ROUTINE             16050099
160600                          IF PS-DELETED OR PS-HEADER-DELETED      16060099
160700                              SET PS-DIFFERENT-ITEMS-DISPLAYED    16070099
160800                                  RV102-CANT-DELETE TO TRUE       16080099
160900                              IF PS-HEADER-DELETED                16090099
161000*----PC-TSYMSG-01084 - LAST DETAIL RECORD DELETED, HEADER RECORD  16100099
161100*----                  DELETED ALSO                               16110099
161200                                  MOVE PC-TSYMSG-01084            16120099
161300                                    TO DP020-MSG-NUMBER           16130099
161400                                  SET DP020-MSG-INFORMATIONAL     16140099
161500                                    TO TRUE                       16150099
161600                              END-IF                              16160099
161700                                                                  16170099
161800* COST/RETAIL WILL ALWAYS BOTH BE DELETED TOGETHER.  THEREFORE,   16180099
161900*  IF THE SKU RETAIL BEING CHANGED IS ON A COMPLETED PERMANENT    16190099
162000*  PRICE CHANGE DOUCMENT, THE COST/RETAIL CHANGE SHOULD NOT BE    16200099
162100*  REFLECTED ON THE LISTING SCREEN.                               16210099
162200                              PERFORM D500-REFRESH-HEADER         16220099
162300                          END-IF                                  16230099
162400                      END-IF                                      16240099
162500                  ELSE                                            16250099
162600*----PC-TSYMSG-00118 - DELETE MUST BE REQUESTED BEFORE CONFIRM    16260099
162700                      MOVE PC-TSYMSG-00118 TO DP020-MSG-MESSAGE   16270099
162800                      SET DP020-MSG-FATAL  TO TRUE                16280099
162900                  END-IF                                          16290099
163000              ELSE                                                16300099
163100                  MOVE 'CORRECT ERROR BEFORE UPDATE'              16310099
163200                                           TO DP020-MSG-MESSAGE   16320099
163300                  SET DP020-MSG-FATAL      TO TRUE                16330099
163400              END-IF                                              16340099
163500                                                                  16350099
163600              PERFORM D400-REFRESH-BLOCK-ARRAY                    16360099
163700              PERFORM G100-DISPLAY-PANEL                          16370099
163800                                                                  16380099
163900         WHEN OTHER                                               16390099
164000*----PC-TSYMSG-00045 - INVALID FUNCTION KEY                       16400099
164100              MOVE PC-TSYMSG-00045                                16410099
164200                                 TO DP020-MSG-NUMBER              16420099
164300              SET DP020-MSG-FATAL                                 16430099
164400                                 TO TRUE                          16440099
164500              PERFORM G100-DISPLAY-PANEL                          16450099
164600                                                                  16460099
164700     END-EVALUATE.                                                16470099
164800*----------------------------------------------------------------*16480099
164900*    WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,*16490099
165000*    READ TEMPORARY STORAGE FILLING IN BOTH BLOCKS IN THE ARRAY  *16500099
165100*    WITH THE ITEMS THAT WERE AT THE TOP OF THE LIST WHEN WE     *16510099
165200*    HAD LEFT PREVIOUSLY.                                        *16520099
165300*                                                                *16530099
165400*    PERFORMED BY C400-REFRESH-PANEL-FROM-TEMP.                  *16540099
165500*----------------------------------------------------------------*16550099
165600 D400-REFRESH-BLOCK-ARRAY.                                        16560099
165700     COMPUTE PV-TEMP-BLOCK-NUMBER =                               16570099
165800         1 + ((RV102-LIST-ITEM-NUMBER(1 1) - 1) /                 16580099
165900               PC-ITEMS-PER-BLOCK).                               16590099
166000                                                                  16600099
166100     MOVE PV-TEMP-BLOCK-NUMBER TO PV-BLOCK-NUMBER.                16610099
166200     MOVE +1                   TO RV102-BLK-SUB.                  16620099
166300                                                                  16630099
166400     PERFORM Z100-READ-TEMP-STORAGE.                              16640099
166500                                                                  16650099
166600     ADD +1 TO PV-BLOCK-NUMBER.                                   16660099
166700                                                                  16670099
166800     IF (PV-BLOCK-NUMBER < RV102-HIGHEST-BLOCK-WRITTEN) OR        16680099
166900        (PV-BLOCK-NUMBER = RV102-HIGHEST-BLOCK-WRITTEN)           16690099
167000         ADD +1 TO RV102-BLK-SUB                                  16700099
167100                                                                  16710099
167200         PERFORM Z100-READ-TEMP-STORAGE                           16720099
167300     END-IF.                                                      16730099
167400*----------------------------------------------------------------*16740099
167500*    RELOAD THE HEADER INFORMATION ON THE SCREEN.                *16750099
167600*                                                                *16760099
167700*    PERFORMED BY B100, C300, D100, D400.                        *16770099
167800*----------------------------------------------------------------*16780099
167900 D500-REFRESH-HEADER.                                             16790099
168000     MOVE RV100-UK-RA-NUMBER   TO  ARANBRO.                       16800099
168100     MOVE RV102-ORDER-STATUS   TO  ARASTATO.                      16810099
168200     MOVE RV102-ORDER-TYPE     TO  ARATYPEO.                      16820099
168300     MOVE RV102-VENDOR-DUNS-NBR                                   16830099
168400                               TO  AVENUMO.                       16840099
168500     MOVE RV102-VENDOR-DESCRIPTION                                16850099
168600                               TO  AVENAMEO.                      16860099
168700     MOVE RV102-TOTAL-COST     TO  ATCOSTO.                       16870099
168800     MOVE RV102-TOTAL-RETAIL   TO  ATRETO.                        16880099
168900*----------------------------------------------------------------*16890099
169000*    EDIT EACH SELECTION ENTRY.  IF EACH ENTRY IS CONSIDERED     *16900099
169100*    VALID, CHECK IF A BEGINNING AND ENDING ENTRY WAS ENTERED,   *16910099
169200*    AND CHECK THE FOLLOWING.                                    *16920099
169300*                                                                *16930099
169400*    1) IF THERE IS A BEGINNING RANGE, THERE MUST BE AN ENDING.  *16940099
169500*    2) IF THERE IS A ENDING RANGE, THERE MUST BE AN BEGINNING.  *16950099
169600*    3) BEGINNING RANGE MUST PRECEDE ENDING RANGE.               *16960099
169700*                                                                *16970099
169800*    IF A VALID BEGINNING AND ENDING RANGE HAVE BEEN SELECTED,   *16980099
169900*    MARK ALL ITEMS IN THAT RANGE AS BEING SELECTED.             *16990099
170000*                                                                *17000099
170100*    PERFORMED BY B100-CONTROL-PROCESSING.                       *17010099
170200*    PERFORMED BY C300-PROCESS-PANEL.                            *17020099
170300*    PERFORMED BY C400-REFRESH-PANEL-FROM-TEMP.                  *17030099
170400*    PERFORMED BY D200-RECORD-SELECTIONS.                        *17040099
170500*----------------------------------------------------------------*17050099
170600 E100-EDIT-SELECTIONS.                                            17060099
170700     SET PS-VALID-SELECTIONS TO TRUE.                             17070099
170800                                                                  17080099
170900     COMPUTE PV-ENDING-ITEM-ON-PANEL =                            17090099
171000         (RV102-ITEM-AT-TOP-OF-PANEL + PC-ITEMS-PER-PANEL) - 1.   17100099
171100     MOVE RV102-ITEM-AT-TOP-OF-PANEL                              17110099
171200                               TO  PV-ITEM-IN-USE.                17120099
171300     MOVE +1                   TO  PS-SUB.                        17130099
171400                                                                  17140099
171500     PERFORM F100-EDIT                                            17150099
171600         UNTIL (PV-ITEM-IN-USE > PV-ENDING-ITEM-ON-PANEL)         17160099
171700            OR (PV-ITEM-IN-USE > RV102-NUMBER-OF-ITEMS-READ).     17170099
171800                                                                  17180099
171900     IF  PS-VALID-SELECTIONS                                      17190099
172000         IF  RV102-START-OF-SELECTED-RANGE GREATER ZERO           17200099
172100             IF  RV102-END-OF-SELECTED-RANGE GREATER              17210099
172200                 RV102-START-OF-SELECTED-RANGE                    17220099
172300                 PERFORM F200-MARK-RANGE-AS-SELECTED              17230099
172400             ELSE                                                 17240099
172500                                                                  17250099
172600                 IF  RV102-END-OF-SELECTED-RANGE = +0             17260099
172700                     SET PS-CURSOR-POSITIONED                     17270099
172800                               TO  TRUE                           17280099
172900                     SET PS-WARNING                               17290099
173000                               TO  TRUE                           17300099
173100*----PC-TSYMSG-00051 - NO END OF RANGE HAS BEEN SPECIFIED         17310099
173200                     MOVE PC-TSYMSG-00051                         17320099
173300                               TO  DP020-MSG-NUMBER               17330099
173400                     IF  NOT DP020-NEXT-ACT-ERROR                 17340099
173500                         SET DP020-MSG-WARNING TO TRUE            17350099
173600                     END-IF                                       17360099
173700                 ELSE                                             17370099
173800                                                                  17380099
173900                     SET PS-CURSOR-POSITIONED                     17390099
174000                               TO  TRUE                           17400099
174100                     SET PS-INVALID-SELECTIONS                    17410099
174200                               TO  TRUE                           17420099
174300                     SET DP020-MSG-FATAL                          17430099
174400                               TO  TRUE                           17440099
174500*----PC-TSYMSG-00052 - END OF RANGE PRECEDES START OF RANGE       17450099
174600                     MOVE PC-TSYMSG-00052                         17460099
174700                               TO  DP020-MSG-NUMBER               17470099
174800                     IF  NOT DP020-NEXT-ACT-ERROR                 17480099
174900                         MOVE RV102-ITEM-AT-TOP-OF-PANEL          17490099
175000                               TO  PV-ITEM-IN-USE                 17500099
175100                         MOVE +1                                  17510099
175200                               TO  PS-SUB                         17520099
175300                                                                  17530099
175400                         PERFORM                                  17540099
175500                             UNTIL (PV-ITEM-IN-USE >              17550099
175600                                    PV-ENDING-ITEM-ON-PANEL)      17560099
175700                                OR (PV-ITEM-IN-USE >              17570099
175800                                    RV102-NUMBER-OF-ITEMS-READ)   17580099
175900                                                                  17590099
176000                             PERFORM K100-SET-SUBSCRIPTS          17600099
176100                             IF (RV102-BEGIN(RV102-BLK-SUB        17610099
176200                                             RV102-ITEM-SUB))     17620099
176300                             OR (RV102-END(RV102-BLK-SUB          17630099
176400                                           RV102-ITEM-SUB))       17640099
176500                                 MOVE -1                          17650099
176600                                    TO  RVKM102-SELECTL(PS-SUB)   17660099
176700                                 MOVE PV-ENDING-ITEM-ON-PANEL     17670099
176800                                    TO  PV-ITEM-IN-USE            17680099
176900                             END-IF                               17690099
177000                             ADD +1 TO  PS-SUB                    17700099
177100                             ADD +1 TO  PV-ITEM-IN-USE            17710099
177200                         END-PERFORM                              17720099
177300                                                                  17730099
177400                     END-IF                                       17740099
177500                 END-IF                                           17750099
177600             END-IF                                               17760099
177700         ELSE                                                     17770099
177800                                                                  17780099
177900             IF RV102-END-OF-SELECTED-RANGE > +0                  17790099
178000                 SET PS-CURSOR-POSITIONED TO TRUE                 17800099
178100                 SET PS-WARNING           TO TRUE                 17810099
178200*----PC-TSYMSG-00053 - NO START OF RANGE HAS BEEN SPECIFIED       17820099
178300                 MOVE PC-TSYMSG-00053                             17830099
178400                               TO  DP020-MSG-NUMBER               17840099
178500                 IF NOT DP020-NEXT-ACT-ERROR                      17850099
178600                     SET DP020-MSG-WARNING TO TRUE                17860099
178700                 END-IF                                           17870099
178800             END-IF                                               17880099
178900         END-IF                                                   17890099
179000     END-IF.                                                      17900099
179100                                                                  17910099
179200     IF  DP020-MSG-FATAL                                          17920099
179300         SET PS-DONT-PROCESS   TO  TRUE                           17930099
179400     END-IF.                                                      17940099
179500*----------------------------------------------------------------*17950099
179600*    MOVE THE SELECTIONS MADE FROM THE CURRENT PAGE INTO         *17960099
179700*    THE COMMAREA.                                               *17970099
179800*                                                                *17980099
179900*    PERFORMED BY D200-RECORD-SELECTIONS.                        *17990099
180000*----------------------------------------------------------------*18000099
180100 E200-MOVE-SELECTS-TO-COMMAREA.                                   18010099
180200     COMPUTE PV-ENDING-ITEM-ON-PANEL =                            18020099
180300         (RV102-ITEM-AT-TOP-OF-PANEL + PC-ITEMS-PER-PANEL) - 1.   18030099
180400                                                                  18040099
180500     MOVE +1                         TO PS-SUB.                   18050099
180600     MOVE RV102-ITEM-AT-TOP-OF-PANEL TO PV-ITEM-IN-USE.           18060099
180700                                                                  18070099
180800     PERFORM F300-CHECK-SELECTIONS                                18080099
180900         UNTIL PV-ITEM-IN-USE > PV-ENDING-ITEM-ON-PANEL.          18090099
181000*----------------------------------------------------------------*18100099
181100*    IF THE USER HITS A KEY THAT REQUIRES US TO GO TO ANOTHER    *18110099
181200*    TRANSACTION, WRITE OUT THE LAST 2 BLOCKS FROM THE ARRAY TO  *18120099
181300*    TEMPORARY STORAGE, SET UP THE INTER APPLICATION COMMAREA,   *18130099
181400*    AND START THE NAVIGATOR.                                    *18140099
181500*                                                                *18150099
181600*    PERFORMED BY D300-CHECK-FUNCTION-KEY.                       *18160099
181700*----------------------------------------------------------------*18170099
181800 E300-NAVIGATE.                                                   18180099
181900     MOVE +1 TO RV102-BLK-SUB.                                    18190099
182000     PERFORM Z150-WRITE-TEMP-STORAGE.                             18200099
182100                                                                  18210099
182200     ADD +1 TO RV102-BLK-SUB.                                     18220099
182300     PERFORM Z150-WRITE-TEMP-STORAGE.                             18230099
182400                                                                  18240099
182500     MOVE INTER-APPL-COMM-AREA TO  RV102-SAVE-APPL-COMMAREA.      18250099
182600                                                                  18260099
182700     PERFORM DP015-1000-START-NAVIGATOR.                          18270099
182800*----------------------------------------------------------------*18280099
182900*    IF THE USER HITS THE 1ST PAGE KEY, COMPUTE THE TOP ITEM     *18290099
183000*    NUMBER FOR THE NEW PAGE AND DETERMINE IF THIS ITEM          *18300099
183100*    IS CURRENTLY IN THE ARRAY, OR IN TEMPORARY STORAGE OR NEEDS *18310099
183200*    TO BE READ.                                                 *18320099
183300*                                                                *18330099
183400*    PERFORMED BY D300-CHECK-FUNCTION-KEY.                       *18340099
183500*----------------------------------------------------------------*18350099
183600 E400-DISPLAY-TOP-OF-LIST.                                        18360099
183700     IF  RV102-NUMBER-OF-ITEMS-READ > +0                          18370099
183800         MOVE +1 TO PV-TOP-ITEM                                   18380099
183900         PERFORM F500-BROWSE                                      18390099
184000     ELSE                                                         18400099
184100         SET PS-SAME-ITEMS-DISPLAYED TO TRUE                      18410099
184200         PERFORM G100-DISPLAY-PANEL                               18420099
184300     END-IF.                                                      18430099
184400*----------------------------------------------------------------*18440099
184500*    IF THE USER HITS THE PAGE BACKARD KEY, COMPUTE THE TOP      *18450099
184600*    ITEM NUMBER FOR THE NEW PAGE AND DETERMINE IF THIS ITEM     *18460099
184700*    IS CURRENTLY IN THE ARRAY, OR IN TEMPORARY STORAGE OR NEEDS *18470099
184800*    TO BE READ.                                                 *18480099
184900*                                                                *18490099
185000*    PERFORMED BY D300-CHECK-FUNCTION-KEY.                       *18500099
185100*----------------------------------------------------------------*18510099
185200 E500-BROWSE-BACKWARD.                                            18520099
185300     IF  RV102-NUMBER-OF-ITEMS-READ > +0                          18530099
185400         COMPUTE PV-TOP-ITEM =                                    18540099
185500             RV102-ITEM-AT-TOP-OF-PANEL - PC-ITEMS-PER-PANEL      18550099
185600         PERFORM F500-BROWSE                                      18560099
185700     ELSE                                                         18570099
185800         SET PS-SAME-ITEMS-DISPLAYED TO TRUE                      18580099
185900         PERFORM G100-DISPLAY-PANEL                               18590099
186000     END-IF.                                                      18600099
186100*----------------------------------------------------------------*18610099
186200*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *18620099
186300*    ITEM NUMBER FOR THE NEW PAGE AND DETERMINE IF THIS ITEM     *18630099
186400*    IS CURRENTLY IN THE ARRAY, OR IN TEMPORARY STORAGE OR NEEDS *18640099
186500*    TO BE READ.                                                 *18650099
186600*                                                                *18660099
186700*    PERFORMED BY D300-CHECK-FUNCTION-KEY.                       *18670099
186800*----------------------------------------------------------------*18680099
186900 E600-BROWSE-FORWARD.                                             18690099
187000     IF  RV102-NUMBER-OF-ITEMS-READ > +0                          18700099
187100         COMPUTE PV-TOP-ITEM =                                    18710099
187200             RV102-ITEM-AT-TOP-OF-PANEL + PC-ITEMS-PER-PANEL      18720099
187300         PERFORM F500-BROWSE                                      18730099
187400     ELSE                                                         18740099
187500         SET PS-SAME-ITEMS-DISPLAYED TO TRUE                      18750099
187600         PERFORM G100-DISPLAY-PANEL                               18760099
187700     END-IF.                                                      18770099
187800*----------------------------------------------------------------*18780099
187900*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *18790099
188000*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *18800099
188100*                                                                *18810099
188200*    PERFORMED BY D300-CHECK-FUNCTION-KEY.                       *18820099
188300*----------------------------------------------------------------*18830099
188400 E700-DESELECT-ALL-ITEMS.                                         18840099
188500     IF  RV102-NUMBER-OF-ITEMS-READ > +0                          18850099
188600         MOVE +1               TO  RV102-BLK-SUB                  18860099
188700                                                                  18870099
188800         PERFORM F600-CLEAR-SELECTED-INDS                         18880099
188900             VARYING RV102-ITEM-SUB FROM 1 BY 1                   18890099
189000             UNTIL RV102-ITEM-SUB > PC-ITEMS-PER-BLOCK            18900099
189100                                                                  18910099
189200         ADD +1                TO  RV102-BLK-SUB                  18920099
189300                                                                  18930099
189400         PERFORM F600-CLEAR-SELECTED-INDS                         18940099
189500             VARYING RV102-ITEM-SUB FROM 1 BY 1                   18950099
189600             UNTIL RV102-ITEM-SUB > PC-ITEMS-PER-BLOCK            18960099
189700                                                                  18970099
189800         MOVE RV102-LIST-ITEM-NUMBER(1 1) TO PV-LIST-ITEM-NUMBER  18980099
189900                                                                  18990099
190000         COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                        19000099
190100             1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-BLOCK) 19010099
190200                                                                  19020099
190300         IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                 19030099
190400            (RV102-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)19040099
190500             MOVE +1 TO RV102-BLK-SUB                             19050099
190600                                                                  19060099
190700             PERFORM Z150-WRITE-TEMP-STORAGE                      19070099
190800                                                                  19080099
190900             MOVE +1 TO PV-BLOCK-NUMBER                           19090099
191000                                                                  19100099
191100             COMPUTE PV-PREV-BLOCK-IN-ARRAY =                     19110099
191200                 PV-FIRST-BLOCK-IN-ARRAY - 1                      19120099
191300                                                                  19130099
191400             PERFORM                                              19140099
191500                 UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY   19150099
191600                                                                  19160099
191700                 PERFORM Z100-READ-TEMP-STORAGE                   19170099
191800                                                                  19180099
191900                 PERFORM F600-CLEAR-SELECTED-INDS                 19190099
192000                     VARYING RV102-ITEM-SUB FROM 1 BY 1           19200099
192100                     UNTIL RV102-ITEM-SUB > PC-ITEMS-PER-BLOCK    19210099
192200                                                                  19220099
192300                 PERFORM Z150-WRITE-TEMP-STORAGE                  19230099
192400                                                                  19240099
192500                 ADD +1 TO PV-BLOCK-NUMBER                        19250099
192600                                                                  19260099
192700             END-PERFORM                                          19270099
192800                                                                  19280099
192900             COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                     19290099
193000                 PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY 19300099
193100                                                                  19310099
193200             PERFORM                                              19320099
193300                 UNTIL PV-NEXT-BLOCK-IN-ARRAY >                   19330099
193400                       RV102-HIGHEST-BLOCK-WRITTEN                19340099
193500                                                                  19350099
193600                 MOVE PV-NEXT-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER   19360099
193700                                                                  19370099
193800                 PERFORM Z100-READ-TEMP-STORAGE                   19380099
193900                                                                  19390099
194000                 PERFORM F600-CLEAR-SELECTED-INDS                 19400099
194100                     VARYING RV102-ITEM-SUB FROM 1 BY 1           19410099
194200                     UNTIL RV102-ITEM-SUB > PC-ITEMS-PER-BLOCK    19420099
194300                                                                  19430099
194400                 PERFORM Z150-WRITE-TEMP-STORAGE                  19440099
194500                                                                  19450099
194600                 ADD +1 TO PV-NEXT-BLOCK-IN-ARRAY                 19460099
194700                                                                  19470099
194800             END-PERFORM                                          19480099
194900                                                                  19490099
195000             MOVE PV-FIRST-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER      19500099
195100                                                                  19510099
195200             PERFORM Z100-READ-TEMP-STORAGE                       19520099
195300         END-IF                                                   19530099
195400                                                                  19540099
195500     END-IF.                                                      19550099
195600                                                                  19560099
195700     MOVE +0 TO RV102-NUMBER-OF-SELECTED-ITEMS.                   19570099
195800     MOVE +0 TO RV102-START-OF-SELECTED-RANGE.                    19580099
195900     MOVE +0 TO RV102-END-OF-SELECTED-RANGE.                      19590099
196000                                                                  19600099
196100     SET PS-SAME-ITEMS-DISPLAYED TO TRUE.                         19610099
196200                                                                  19620099
196300     PERFORM G100-DISPLAY-PANEL.                                  19630099
196400*----------------------------------------------------------------*19640099
196500*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *19650099
196600*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *19660099
196700*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *19670099
196800*    RATHER THAN HITTING PF8 TO PAGE FORWARD TO THAT POINT.      *19680099
196900*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *19690099
197000*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *19700099
197100*                                                                *19710099
197200*    PERFORMED BY D300-CHECK-FUNCTION-KEY.                       *19720099
197300*----------------------------------------------------------------*19730099
197400 E800-CHECK-FOR-JUMP-BROWSE.                                      19740099
197500     SET PS-VALID-BEG-ITEM TO TRUE.                               19750099
197600                                                                  19760099
197700     IF (ASTRTITA                   = PC-ERASE-EOF) OR            19770099
197800        (RV102-NUMBER-OF-ITEMS-READ = +0)                         19780099
197900         SET PS-SAME-ITEMS-DISPLAYED TO TRUE                      19790099
198000         PERFORM G100-DISPLAY-PANEL                               19800099
198100     ELSE                                                         19810099
198200                                                                  19820099
198300         MOVE ASTRTITI         TO  DP010I-UNEDITED-FIELD          19830099
198400         MOVE PC-FIELD-LENGTH  TO  DP010I-MAXIMUM-DIGITS          19840099
198500         MOVE +0               TO  DP010I-MAXIMUM-DECIMALS        19850099
198600         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  19860099
198710         CALL DP010I-NUMERIC-EDIT-ROUTINE                         19871099
198720              USING DP010I-NUMERIC-EDIT-AREA                      19872099
198800                                                                  19880099
198900         IF  NOT DP010I-ERROR-DETECTED                            19890099
199000             MOVE DP010I-NUMERIC-FIELD                            19900099
199100                               TO  PV-BEGITMI-N                   19910099
199200             MOVE PV-BEGITMI-N TO  PV-BEGINNING-ITEM              19920099
199300                                                                  19930099
199400             IF (PV-BEGINNING-ITEM >  0)          AND             19940099
199500                (PV-BEGINNING-ITEM <  PC-MAX-ITEMS)               19950099
199600                 MOVE PV-BEGINNING-ITEM TO PV-TOP-ITEM            19960099
199700                                                                  19970099
199800                 COMPUTE PV-MAX-ITEMS-TO-BE-READ =                19980099
199900                     ((RV102-NUMBER-OF-ITEMS-READ +               19990099
200000                       PC-MAX-ITEMS-TO-BE-READ)   -               20000099
200100                       PC-ITEMS-PER-PANEL)        + 1             20010099
200200                                                                  20020099
200300                 IF PV-TOP-ITEM > PV-MAX-ITEMS-TO-BE-READ         20030099
200400                     MOVE PV-MAX-ITEMS-TO-BE-READ                 20040099
200500                               TO  PV-TOP-ITEM                    20050099
200600                     MOVE -1   TO  ASTRTITL                       20060099
200700                                                                  20070099
200800                     IF RV102-NO-ITEMS-LEFT-ON-DB                 20080099
200900*----PC-TSYMSG-00070 - BOTTOM OF LIST                             20090099
201000                         MOVE PC-TSYMSG-00070                     20100099
201100                               TO  DP020-MSG-NUMBER               20110099
201200                     ELSE                                         20120099
201300*----PC-TSYMSG-00207 - REQUEST TO SCROLL FORWARD EXCEEDS MAXIMUM; 20130099
201400*----                  SCROLLED MAXIMUM                           20140099
201500                         MOVE PC-TSYMSG-00207                     20150099
201600                               TO  DP020-MSG-NUMBER               20160099
201700                     END-IF                                       20170099
201800                                                                  20180099
201900                     SET PS-CURSOR-POSITIONED                     20190099
202000                               TO  TRUE                           20200099
202100                     SET DP020-MSG-INFORMATIONAL                  20210099
202200                               TO  TRUE                           20220099
202300                 END-IF                                           20230099
202400                 PERFORM F500-BROWSE                              20240099
202500             ELSE                                                 20250099
202600*----PC-TSYMSG-00101 - VALUE MUST BE GREATER THAN ZERO AND LESS   20260099
202700*----                  THAN 1,000,000                             20270099
202800                 MOVE PC-TSYMSG-00101                             20280099
202900                               TO  DP020-MSG-NUMBER               20290099
203000                 MOVE -1       TO  ASTRTITL                       20300099
203100                 MOVE DP015-REVERSE                               20310099
203200                               TO  ASTRTITH                       20320099
203300                 MOVE DP015-RED                                   20330099
203400                               TO  ASTRTITC                       20340099
203500                 MOVE DP015-UNP-NUM-BRT-MDT                       20350099
203600                               TO  ASTRTITA                       20360099
203700                 SET PS-CURSOR-POSITIONED                         20370099
203800                               TO  TRUE                           20380099
203900                 SET DP020-MSG-FATAL                              20390099
204000                               TO  TRUE                           20400099
204100                 SET PS-INVALID-BEG-ITEM                          20410099
204200                               TO  TRUE                           20420099
204300             END-IF                                               20430099
204400                                                                  20440099
204500         ELSE                                                     20450099
204600*----PC-TSYMSG-00008 - MUST BE NUMERIC                            20460099
204700             MOVE PC-TSYMSG-00008                                 20470099
204800                               TO  DP020-MSG-NUMBER               20480099
204900             MOVE -1           TO  ASTRTITL                       20490099
205000             MOVE DP015-REVERSE                                   20500099
205100                               TO  ASTRTITH                       20510099
205200             MOVE DP015-RED    TO  ASTRTITC                       20520099
205300             MOVE DP015-UNP-NUM-BRT-MDT                           20530099
205400                               TO  ASTRTITA                       20540099
205500             SET PS-CURSOR-POSITIONED                             20550099
205600                               TO  TRUE                           20560099
205700             SET DP020-MSG-FATAL                                  20570099
205800                               TO  TRUE                           20580099
205900             SET PS-INVALID-BEG-ITEM                              20590099
206000                               TO  TRUE                           20600099
206100         END-IF                                                   20610099
206200     END-IF.                                                      20620099
206300                                                                  20630099
206400     IF  PS-INVALID-BEG-ITEM                                      20640099
206500         SET PS-SAME-ITEMS-DISPLAYED TO TRUE                      20650099
206600         PERFORM DP017-0000-GET-CURR-DATE-TIME                    20660099
206700         PERFORM I200-FORMAT-LIST-LINES                           20670099
206800         PERFORM I300-FORMAT-NR-SELECTED                          20680099
206900         PERFORM DP005-0000-FORMAT-MSG-LINES                      20690099
207000         PERFORM DP008-0000-WRITE-PANEL                           20700099
207100     END-IF.                                                      20710099
207200*----------------------------------------------------------------*20720099
207300*    IF THE USER HITS THE SELECT KEY, SET THE SELECTION SWITCH   *20730099
207400*    FOR ALL ITEMS.                                              *20740099
207500*                                                                *20750099
207600*    PERFORMED BY D300-CHECK-FUNCTION-KEY.                       *20760099
207700*----------------------------------------------------------------*20770099
207800 E900-SELECT-ALL-ITEMS.                                           20780099
207900     IF  RV102-NUMBER-OF-ITEMS-READ > +0                          20790099
208000         MOVE +1               TO  RV102-BLK-SUB                  20800099
208100         MOVE ZERO             TO  PV-DEL-COUNT                   20810099
208200                                                                  20820099
208300         PERFORM F700-SET-SELECTED-INDS                           20830099
208400             VARYING RV102-ITEM-SUB FROM 1 BY 1                   20840099
208500             UNTIL RV102-ITEM-SUB > PC-ITEMS-PER-BLOCK            20850099
208600                                                                  20860099
208700         ADD +1 TO RV102-BLK-SUB                                  20870099
208800                                                                  20880099
208900         PERFORM F700-SET-SELECTED-INDS                           20890099
209000             VARYING RV102-ITEM-SUB FROM 1 BY 1                   20900099
209100             UNTIL RV102-ITEM-SUB > PC-ITEMS-PER-BLOCK            20910099
209200                                                                  20920099
209300         MOVE RV102-LIST-ITEM-NUMBER(1 1) TO PV-LIST-ITEM-NUMBER  20930099
209400                                                                  20940099
209500         COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                        20950099
209600             1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-BLOCK) 20960099
209700                                                                  20970099
209800         IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                 20980099
209900            (RV102-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)20990099
210000             MOVE +1 TO RV102-BLK-SUB                             21000099
210100                                                                  21010099
210200             PERFORM Z150-WRITE-TEMP-STORAGE                      21020099
210300                                                                  21030099
210400             MOVE +1 TO PV-BLOCK-NUMBER                           21040099
210500                                                                  21050099
210600             COMPUTE PV-PREV-BLOCK-IN-ARRAY =                     21060099
210700                 PV-FIRST-BLOCK-IN-ARRAY - 1                      21070099
210800                                                                  21080099
210900             PERFORM                                              21090099
211000                 UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY   21100099
211100                                                                  21110099
211200                 PERFORM Z100-READ-TEMP-STORAGE                   21120099
211300                                                                  21130099
211400                 PERFORM F700-SET-SELECTED-INDS                   21140099
211500                     VARYING RV102-ITEM-SUB FROM 1 BY 1           21150099
211600                     UNTIL RV102-ITEM-SUB > PC-ITEMS-PER-BLOCK    21160099
211700                                                                  21170099
211800                 PERFORM Z150-WRITE-TEMP-STORAGE                  21180099
211900                                                                  21190099
212000                 ADD +1 TO PV-BLOCK-NUMBER                        21200099
212100                                                                  21210099
212200             END-PERFORM                                          21220099
212300                                                                  21230099
212400             COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                     21240099
212500                 PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY 21250099
212600                                                                  21260099
212700             PERFORM                                              21270099
212800                 UNTIL PV-NEXT-BLOCK-IN-ARRAY >                   21280099
212900                       RV102-HIGHEST-BLOCK-WRITTEN                21290099
213000                                                                  21300099
213100                 MOVE PV-NEXT-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER   21310099
213200                                                                  21320099
213300                 PERFORM Z100-READ-TEMP-STORAGE                   21330099
213400                                                                  21340099
213500                 PERFORM F700-SET-SELECTED-INDS                   21350099
213600                     VARYING RV102-ITEM-SUB FROM 1 BY 1           21360099
213700                     UNTIL RV102-ITEM-SUB > PC-ITEMS-PER-BLOCK    21370099
213800                                                                  21380099
213900                 PERFORM Z150-WRITE-TEMP-STORAGE                  21390099
214000                                                                  21400099
214100                 ADD +1 TO PV-NEXT-BLOCK-IN-ARRAY                 21410099
214200                                                                  21420099
214300             END-PERFORM                                          21430099
214400                                                                  21440099
214500             MOVE PV-FIRST-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER      21450099
214600                                                                  21460099
214700             PERFORM Z100-READ-TEMP-STORAGE                       21470099
214800         END-IF                                                   21480099
214900                                                                  21490099
215000     END-IF.                                                      21500099
215100                                                                  21510099
215200     COMPUTE RV102-NUMBER-OF-SELECTED-ITEMS =                     21520099
215300             RV102-NUMBER-OF-ITEMS-READ - PV-DEL-COUNT.           21530099
215400                                                                  21540099
215500     SET PS-SAME-ITEMS-DISPLAYED TO TRUE.                         21550099
215600                                                                  21560099
215700     PERFORM G100-DISPLAY-PANEL.                                  21570099
215800*----------------------------------------------------------------*21580099
215900*    EDIT THE SELECTION ENTRIES.                                 *21590099
216000*                                                                *21600099
216100*    1) VALID ENTRIES ARE 'S' 'B' OR 'E'.                        *21610099
216200*    2) THERE CAN ONLY BE 1 BEGINNING AND 1 ENDING RANGE.        *21620099
216300*                                                                *21630099
216400*    PERFORMED BY E100-EDIT-SELECTIONS.                          *21640099
216500*----------------------------------------------------------------*21650099
216600 F100-EDIT.                                                       21660099
216700     PERFORM K100-SET-SUBSCRIPTS.                                 21670099
216800                                                                  21680099
216900     IF  RV102-ACTION(RV102-BLK-SUB RV102-ITEM-SUB)               21690099
217000         EQUAL PC-DEL                                             21700099
217100         CONTINUE                                                 21710099
217200     ELSE                                                         21720099
217300                                                                  21730099
217400       IF NOT (RV102-NO-SELECT(RV102-BLK-SUB RV102-ITEM-SUB)) AND 21740099
217500          NOT (RV102-SELECT(RV102-BLK-SUB RV102-ITEM-SUB))        21750099
217600                                                                  21760099
217700         IF  RV102-BEGIN(RV102-BLK-SUB RV102-ITEM-SUB)            21770099
217800             IF  RV102-START-OF-SELECTED-RANGE                    21780099
217900                 NOT EQUAL PV-ITEM-IN-USE                         21790099
218000                                                                  21800099
218100                 IF  RV102-START-OF-SELECTED-RANGE = +0           21810099
218200                     MOVE PV-ITEM-IN-USE                          21820099
218300                               TO  RV102-START-OF-SELECTED-RANGE  21830099
218400                 ELSE                                             21840099
218500                     IF PS-VALID-SELECTIONS                       21850099
218600*----PC-TSYMSG-00054 - ONLY ONE START OF RANGE INDICATOR MAY BE   21860099
218700*----                  SPECIFIED                                  21870099
218800                         MOVE PC-TSYMSG-00054                     21880099
218900                               TO  DP020-MSG-NUMBER               21890099
219000                         IF  NOT DP020-NEXT-ACT-ERROR             21900099
219100                             MOVE -1                              21910099
219200                               TO  RVKM102-SELECTL(PS-SUB)        21920099
219300                         END-IF                                   21930099
219400                     END-IF                                       21940099
219500                                                                  21950099
219600                     SET DP020-MSG-FATAL                          21960099
219700                               TO  TRUE                           21970099
219800                     SET PS-INVALID-SELECTIONS                    21980099
219900                               TO  TRUE                           21990099
220000                     SET PS-CURSOR-POSITIONED                     22000099
220100                               TO  TRUE                           22010099
220200                 END-IF                                           22020099
220300             END-IF                                               22030099
220400         ELSE                                                     22040099
220500                                                                  22050099
220600             IF  RV102-END(RV102-BLK-SUB RV102-ITEM-SUB)          22060099
220700                 IF  RV102-END-OF-SELECTED-RANGE                  22070099
220800                     NOT EQUAL PV-ITEM-IN-USE                     22080099
220900                                                                  22090099
221000                     IF RV102-END-OF-SELECTED-RANGE = +0          22100099
221100                         MOVE PV-ITEM-IN-USE                      22110099
221200                               TO  RV102-END-OF-SELECTED-RANGE    22120099
221300                     ELSE                                         22130099
221400                                                                  22140099
221500                         IF  PS-VALID-SELECTIONS                  22150099
221600*----PC-TSYMSG-00055 - ONLY ONE END OF RANGE INDICATOR MAY BE     22160099
221700*----                  SPECIFIED                                  22170099
221800                             MOVE PC-TSYMSG-00055                 22180099
221900                               TO  DP020-MSG-NUMBER               22190099
222000                                                                  22200099
222100                             IF  NOT DP020-NEXT-ACT-ERROR         22210099
222200                                 MOVE -1                          22220099
222300                                    TO  RVKM102-SELECTL(PS-SUB)   22230099
222400                             END-IF                               22240099
222500                         END-IF                                   22250099
222600                         SET PS-INVALID-SELECTIONS                22260099
222700                                    TO  TRUE                      22270099
222800                         SET PS-CURSOR-POSITIONED                 22280099
222900                                    TO  TRUE                      22290099
223000                         SET DP020-MSG-FATAL                      22300099
223100                                    TO  TRUE                      22310099
223200                     END-IF                                       22320099
223300                 END-IF                                           22330099
223400             ELSE                                                 22340099
223500                                                                  22350099
223600                 IF  PS-VALID-SELECTIONS                          22360099
223700*----PC-TSYMSG-00005 - INVALID VALUE                              22370099
223800                     MOVE PC-TSYMSG-00005                         22380099
223900                               TO  DP020-MSG-NUMBER               22390099
224000                     IF  NOT DP020-NEXT-ACT-ERROR                 22400099
224100                         MOVE -1                                  22410099
224200                               TO  RVKM102-SELECTL(PS-SUB)        22420099
224300                     END-IF                                       22430099
224400                 END-IF                                           22440099
224500                 SET PS-INVALID-SELECTIONS                        22450099
224600                               TO  TRUE                           22460099
224700                 SET PS-CURSOR-POSITIONED                         22470099
224800                               TO  TRUE                           22480099
224900                 SET DP020-MSG-FATAL                              22490099
225000                               TO  TRUE                           22500099
225100                 MOVE DP015-RED                                   22510099
225200                               TO  RVKM102-SELECTC(PS-SUB)        22520099
225300                 MOVE DP015-REVERSE                               22530099
225400                               TO  RVKM102-SELECTH(PS-SUB)        22540099
225500             END-IF                                               22550099
225600         END-IF                                                   22560099
225700       END-IF                                                     22570099
225800     END-IF.                                                      22580099
225900                                                                  22590099
226000     ADD +1                    TO  PV-ITEM-IN-USE.                22600099
226100     ADD +1                    TO  PS-SUB.                        22610099
226200*----------------------------------------------------------------*22620099
226300*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *22630099
226400*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *22640099
226500*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *22650099
226600*                                                                *22660099
226700*    PERFORMED BY E100-EDIT-SELECTIONS.                          *22670099
226800*----------------------------------------------------------------*22680099
226900 F200-MARK-RANGE-AS-SELECTED.                                     22690099
227000     MOVE +1                   TO  RV102-BLK-SUB.                 22700099
227100     PERFORM G200-MARK-SELECTED-INDS                              22710099
227200         VARYING RV102-ITEM-SUB FROM 1 BY 1                       22720099
227300         UNTIL RV102-ITEM-SUB > PC-ITEMS-PER-BLOCK.               22730099
227400                                                                  22740099
227500     ADD +1 TO RV102-BLK-SUB.                                     22750099
227600     PERFORM G200-MARK-SELECTED-INDS                              22760099
227700         VARYING RV102-ITEM-SUB FROM 1 BY 1                       22770099
227800         UNTIL RV102-ITEM-SUB > PC-ITEMS-PER-BLOCK.               22780099
227900                                                                  22790099
228000     MOVE RV102-LIST-ITEM-NUMBER(1 1)                             22800099
228100                               TO  PV-LIST-ITEM-NUMBER.           22810099
228200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            22820099
228300         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         22830099
228400               PC-ITEMS-PER-BLOCK).                               22840099
228500                                                                  22850099
228600     MOVE RV102-START-OF-SELECTED-RANGE                           22860099
228700                               TO  PV-START-OF-SELECTED-RANGE.    22870099
228800     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            22880099
228900         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  22890099
229000               PC-ITEMS-PER-BLOCK).                               22900099
229100                                                                  22910099
229200     MOVE RV102-END-OF-SELECTED-RANGE                             22920099
229300                               TO  PV-END-OF-SELECTED-RANGE.      22930099
229400     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             22940099
229500         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    22950099
229600               PC-ITEMS-PER-BLOCK).                               22960099
229700     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             22970099
229800         PV-FIRST-BLOCK-IN-ARRAY + 1.                             22980099
229900                                                                  22990099
230000     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    23000099
230100        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        23010099
230200         MOVE +1               TO  RV102-BLK-SUB                  23020099
230300         PERFORM Z150-WRITE-TEMP-STORAGE                          23030099
230400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         23040099
230500             PV-FIRST-BLOCK-IN-ARRAY - 1                          23050099
230600                                                                  23060099
230700         PERFORM                                                  23070099
230800             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      23080099
230900                   PV-PREV-BLOCK-IN-ARRAY                         23090099
231000             MOVE PV-FIRST-BLOCK-IN-RANGE                         23100099
231100                               TO  PV-BLOCK-NUMBER                23110099
231200             PERFORM Z100-READ-TEMP-STORAGE                       23120099
231300             PERFORM G200-MARK-SELECTED-INDS                      23130099
231400                 VARYING RV102-ITEM-SUB FROM 1 BY 1               23140099
231500                 UNTIL RV102-ITEM-SUB > PC-ITEMS-PER-BLOCK        23150099
231600             PERFORM Z150-WRITE-TEMP-STORAGE                      23160099
231700             ADD +1            TO PV-FIRST-BLOCK-IN-RANGE         23170099
231800         END-PERFORM                                              23180099
231900                                                                  23190099
232000         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         23200099
232100             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     23210099
232200         PERFORM                                                  23220099
232300             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       23230099
232400                   PV-LAST-BLOCK-IN-RANGE                         23240099
232500             MOVE PV-NEXT-BLOCK-IN-ARRAY                          23250099
232600                               TO  PV-BLOCK-NUMBER                23260099
232700             PERFORM Z100-READ-TEMP-STORAGE                       23270099
232800             PERFORM G200-MARK-SELECTED-INDS                      23280099
232900                 VARYING RV102-ITEM-SUB FROM 1 BY 1               23290099
233000                 UNTIL RV102-ITEM-SUB > PC-ITEMS-PER-BLOCK        23300099
233100             PERFORM Z150-WRITE-TEMP-STORAGE                      23310099
233200             ADD +1            TO  PV-NEXT-BLOCK-IN-ARRAY         23320099
233300         END-PERFORM                                              23330099
233400                                                                  23340099
233500         MOVE PV-FIRST-BLOCK-IN-ARRAY                             23350099
233600                               TO  PV-BLOCK-NUMBER                23360099
233700         PERFORM Z100-READ-TEMP-STORAGE                           23370099
233800     END-IF.                                                      23380099
233900                                                                  23390099
234000     MOVE +0                   TO  RV102-START-OF-SELECTED-RANGE  23400099
234100                                   RV102-END-OF-SELECTED-RANGE.   23410099
234200*----------------------------------------------------------------*23420099
234300*    CHECK EACH ENTRY TO DETERMINE IF THE SELECTION CRITERIA IN  *23430099
234400*    THE MAP DIFFERS FROM THAT IN THE ARRAY.  IF THEY DO DIFFER, *23440099
234500*    AND THE ARRAY ENTRY SHOWS THAT THE ITEM WAS PREVIOUSLY      *23450099
234600*    SELECTED, SUBTRACT 1 FROM THE SELECTED COUNTER.  IF THEY DO *23460099
234700*    DIFFER, AND THE ARRAY ENTRY SHOWS THAT THIS ITEM WAS MARKED *23470099
234800*    AS EITHER THE BEGINNING OR ENDING SELECTION POINT, ZERO OUT *23480099
234900*    THE STARTING RANGE AND/OR ENDING RANGE.  IF THE ENTRY ON    *23490099
235000*    THE MAP SHOWS THAT THIS ITEM WAS SELECTED, ADD 1 TO THE     *23500099
235100*    SELECTED COUNTER.                                           *23510099
235200*                                                                *23520099
235300*    PERFORMED BY E200-MOVE-SELECTS-TO-COMMAREA.                 *23530099
235400*----------------------------------------------------------------*23540099
235500 F300-CHECK-SELECTIONS.                                           23550099
235600     IF (PV-ITEM-IN-USE < RV102-NUMBER-OF-ITEMS-READ) OR          23560099
235700        (PV-ITEM-IN-USE = RV102-NUMBER-OF-ITEMS-READ)             23570099
235800         PERFORM K100-SET-SUBSCRIPTS                              23580099
235900                                                                  23590099
236000       IF  RV102-ACTION(RV102-BLK-SUB RV102-ITEM-SUB)             23600099
236100           EQUAL PC-DEL                                           23610099
236200           CONTINUE                                               23620099
236300       ELSE                                                       23630099
236400                                                                  23640099
236500         IF  RV102-SELECTED-SW(RV102-BLK-SUB RV102-ITEM-SUB)      23650099
236600             NOT EQUAL RVKM102-SELECTI(PS-SUB)                    23660099
236700             SET RV102-BLOCK-MODIFIED(RV102-BLK-SUB)              23670099
236800                               TO  TRUE                           23680099
236900             IF  RV102-SELECT(RV102-BLK-SUB RV102-ITEM-SUB)       23690099
237000                 SUBTRACT +1 FROM RV102-NUMBER-OF-SELECTED-ITEMS  23700099
237100             ELSE                                                 23710099
237200                                                                  23720099
237300                 IF  RV102-BEGIN(RV102-BLK-SUB RV102-ITEM-SUB)    23730099
237400                     IF  RV102-LIST-ITEM-NUMBER(RV102-BLK-SUB     23740099
237500                                               RV102-ITEM-SUB) =  23750099
237600                         RV102-START-OF-SELECTED-RANGE            23760099
237700                         MOVE +0                                  23770099
237800                               TO  RV102-START-OF-SELECTED-RANGE  23780099
237900                     END-IF                                       23790099
238000                 ELSE                                             23800099
238100                                                                  23810099
238200                     IF  RV102-END(RV102-BLK-SUB RV102-ITEM-SUB)  23820099
238300                         IF  RV102-LIST-ITEM-NUMBER               23830099
238400                                 (RV102-BLK-SUB RV102-ITEM-SUB)   23840099
238500                         =  RV102-END-OF-SELECTED-RANGE           23850099
238600                             MOVE +0                              23860099
238700                               TO RV102-END-OF-SELECTED-RANGE     23870099
238800                         END-IF                                   23880099
238900                     END-IF                                       23890099
239000                 END-IF                                           23900099
239100             END-IF                                               23910099
239200                                                                  23920099
239300             IF RVKM102-SELECTI(PS-SUB) = PC-SELECTED             23930099
239400                 ADD +1        TO RV102-NUMBER-OF-SELECTED-ITEMS  23940099
239500             END-IF                                               23950099
239600                                                                  23960099
239700             IF (RVKM102-SELECTA(PS-SUB) = PC-ERASE-EOF) OR       23970099
239800                (RVKM102-SELECTI(PS-SUB) = SPACES)                23980099
239900                 MOVE SPACES   TO                                 23990099
240000                      RV102-SELECTED-SW(RV102-BLK-SUB             24000099
240100                                        RV102-ITEM-SUB)           24010099
240200             ELSE                                                 24020099
240300                 MOVE RVKM102-SELECTI(PS-SUB) TO                  24030099
240400                      RV102-SELECTED-SW(RV102-BLK-SUB             24040099
240500                                        RV102-ITEM-SUB)           24050099
240600             END-IF                                               24060099
240700         END-IF                                                   24070099
240800       END-IF                                                     24080099
240900     END-IF.                                                      24090099
241000*                                                                 24100099
241100*    THIS LOGIC ADDED FOR THE SCREEN FIELDS THAT CAN BE UPDATED.  24110099
241200*                                                                 24120099
241300     IF  RV102-ACTION (RV102-BLK-SUB RV102-ITEM-SUB)              24130099
241400         NOT EQUAL PC-DEL                                         24140099
241500         MOVE DP015-GREEN       TO RVKM102-URETAILC (PS-SUB)      24150099
241600         MOVE DP015-UNDERLINE   TO RVKM102-URETAILH (PS-SUB)      24160099
241700     END-IF.                                                      24170099
241800                                                                  24180099
241900     IF (RVKM102-URETAILL (PS-SUB) GREATER THAN ZERO              24190099
242000     OR  RVKM102-URETAILA (PS-SUB) EQUAL PC-ERASE-EOF)            24200099
242100                                                                  24210099
242200*        SET RV102-URETAIL-CHG (RV102-BLK-SUB RV102-ITEM-SUB)     24220099
242300*                              TO  TRUE                           24230099
242400*        SET RV102-BLOCK-MODIFIED(RV102-BLK-SUB)                  24240099
242500*                              TO  TRUE                           24250099
242600                                                                  24260099
242700         MOVE RVKM102-URETAILX (PS-SUB)                           24270099
242800                               TO  DP010I-UNEDITED-FIELD          24280099
242900         MOVE 8                TO  DP010I-MAXIMUM-DIGITS          24290099
243000         MOVE 2                TO  DP010I-MAXIMUM-DECIMALS        24300099
243100                                                                  24310099
243210         CALL DP010I-NUMERIC-EDIT-ROUTINE                         24321099
243220              USING DP010I-NUMERIC-EDIT-AREA                      24322099
243300         IF  DP010I-ERROR-DETECTED                                24330099
243400             MOVE DP015-RED    TO  RVKM102-URETAILC (PS-SUB)      24340099
243500             MOVE DP015-REVERSE TO RVKM102-URETAILH (PS-SUB)      24350099
243600             MOVE -1            TO RVKM102-URETAILL (PS-SUB)      24360099
243700             MOVE DP015-UNP-NUM-BRT-MDT                           24370099
243800                               TO  RVKM102-URETAILA (PS-SUB)      24380099
243900*----PC-TSYMSG-00008 - MUST BE NUMERIC                            24390099
244000             MOVE PC-TSYMSG-00008                                 24400099
244100                               TO  DP020-MSG-NUMBER               24410099
244200             SET DP020-MSG-FATAL                                  24420099
244300                               TO  TRUE                           24430099
244400             SET PS-DONT-PROCESS                                  24440099
244500                               TO  TRUE                           24450099
244600         ELSE                                                     24460099
244700             IF (RV102-ORDER-TYPE = 'MARKOUT ' AND                24470099
244800                 RV102-ORDER-STATUS NOT = 'OPEN    ')             24480099
244900                 IF (RV102-PERM-STATUS-CDE                        24490099
245000                         (RV102-BLK-SUB RV102-ITEM-SUB) =         24500099
245100                     PE049-IS-COMPLETED-STATUS-CDE)               24510099
245200                     CONTINUE                                     24520099
245300                 ELSE                                             24530099
245400                     COMPUTE RV102-RETAIL-DIFFERENCE =            24540099
245500                         RV102-RETAIL-DIFFERENCE +                24550099
245600                         (RV102-URETAIL                           24560099
245700                             (RV102-BLK-SUB RV102-ITEM-SUB)       24570099
245800                         - DP010I-NUMERIC-FIELD)                  24580099
245900                     MOVE DP010I-NUMERIC-FIELD                    24590099
246000                                 TO RV102-URETAIL (RV102-BLK-SUB  24600099
246100                                                   RV102-ITEM-SUB)24610099
246200                                    RVKM102-URETAIL (PS-SUB)      24620099
246300                     SET RV102-URETAIL-CHG                        24630099
246400                             (RV102-BLK-SUB RV102-ITEM-SUB)       24640099
246500                                 TO TRUE                          24650099
246600                     SET RV102-BLOCK-MODIFIED(RV102-BLK-SUB)      24660099
246700                                 TO TRUE                          24670099
246800                 END-IF                                           24680099
246900             ELSE                                                 24690099
247000                 COMPUTE RV102-RETAIL-DIFFERENCE =                24700099
247100                     RV102-RETAIL-DIFFERENCE +                    24710099
247200                     (RV102-URETAIL (RV102-BLK-SUB RV102-ITEM-SUB)24720099
247300                     - DP010I-NUMERIC-FIELD)                      24730099
247400                 MOVE DP010I-NUMERIC-FIELD                        24740099
247500                                 TO RV102-URETAIL (RV102-BLK-SUB  24750099
247600                                                   RV102-ITEM-SUB)24760099
247700                                    RVKM102-URETAIL (PS-SUB)      24770099
247800                 SET RV102-URETAIL-CHG                            24780099
247900                             (RV102-BLK-SUB RV102-ITEM-SUB)       24790099
248000                                 TO TRUE                          24800099
248100                 SET RV102-BLOCK-MODIFIED(RV102-BLK-SUB)          24810099
248200                                 TO TRUE                          24820099
248300             END-IF                                               24830099
248400         END-IF                                                   24840099
248500     END-IF.                                                      24850099
248600                                                                  24860099
248700                                                                  24870099
248800     ADD +1                    TO  PV-ITEM-IN-USE.                24880099
248900     ADD +1                    TO  PS-SUB.                        24890099
249000*----------------------------------------------------------------*24900099
249100*    CALCULATE THE NEW TOP AND BOTTOM ITEM NUMBERS BASED ON WHERE*24910099
249200*    THE USER SPECIFIED TO GO ON THE LIST AND DETERMINE WHERE    *24920099
249300*    THESE ITEMS CAN BE FOUND (I.E. ARRAY, TEMPORARY STORAGE).   *24930099
249400*                                                                *24940099
249500*    PERFORMED BY E400-DISPLAY-TOP-OF-LIST.                      *24950099
249600*    PERFORMED BY E500-BROWSE-BACKWARD.                          *24960099
249700*    PERFORMED BY E600-BROWSE-FORWARD.                           *24970099
249800*    PERFORMED BY E800-CHECK-FOR-JUMP-BROWSE.                    *24980099
249900*----------------------------------------------------------------*24990099
250000 F500-BROWSE.                                                     25000099
250100     IF  PV-TOP-ITEM < +1                                         25010099
250200         MOVE +1               TO  PV-TOP-ITEM                    25020099
250300         IF  PS-CURSOR-NOT-POSITIONED                             25030099
250400*----PC-TSYMSG-00069 - TOP OF LIST                                25040099
250500             MOVE PC-TSYMSG-00069                                 25050099
250600                               TO  DP020-MSG-NUMBER               25060099
250700             SET DP020-MSG-INFORMATIONAL                          25070099
250800                               TO  TRUE                           25080099
250900             SET PS-INFORMATIONAL                                 25090099
251000                               TO  TRUE                           25100099
251100             SET PS-CURSOR-POSITIONED                             25110099
251200                               TO  TRUE                           25120099
251300         END-IF                                                   25130099
251400     END-IF.                                                      25140099
251500                                                                  25150099
251600     IF  RV102-NO-ITEMS-LEFT-ON-DB                                25160099
251700         IF  PV-TOP-ITEM > RV102-NUMBER-OF-ITEMS-READ             25170099
251800             IF  DP020-SRC-AID EQUAL DP016-ENTER                  25180099
251900                 MOVE RV102-NUMBER-OF-ITEMS-READ                  25190099
252000                               TO  PV-TOP-ITEM                    25200099
252100             ELSE                                                 25210099
252200                 MOVE RV102-ITEM-AT-TOP-OF-PANEL                  25220099
252300                               TO  PV-TOP-ITEM                    25230099
252400             END-IF                                               25240099
252500                                                                  25250099
252600             IF  PS-CURSOR-NOT-POSITIONED                         25260099
252700                 MOVE -1       TO  ANAVCMDL                       25270099
252800                 SET DP020-MSG-INFORMATIONAL                      25280099
252900                               TO  TRUE                           25290099
253000                 SET PS-CURSOR-POSITIONED                         25300099
253100                               TO  TRUE                           25310099
253200                 IF  DP020-FK-NEXT-PAGE(DP020-SRC-AID)            25320099
253300*----PC-TSYMSG-00070 - BOTTOM OF LIST                             25330099
253400                     MOVE PC-TSYMSG-00070                         25340099
253500                               TO  DP020-MSG-NUMBER               25350099
253600                     SET PS-INFORMATIONAL                         25360099
253700                               TO  TRUE                           25370099
253800             END-IF                                               25380099
253900         END-IF                                                   25390099
254000     END-IF.                                                      25400099
254100                                                                  25410099
254200     COMPUTE PV-BOTTOM-ITEM =                                     25420099
254300         (PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1.                  25430099
254400                                                                  25440099
254500     IF  RV102-NO-ITEMS-LEFT-ON-DB                                25450099
254600         IF  PV-BOTTOM-ITEM > RV102-NUMBER-OF-ITEMS-READ          25460099
254700             MOVE RV102-NUMBER-OF-ITEMS-READ                      25470099
254800                               TO  PV-BOTTOM-ITEM                 25480099
254900             IF  PS-CURSOR-NOT-POSITIONED                         25490099
255000                 IF  PV-TOP-ITEM NOT = +1                         25500099
255100                     IF  DP020-FK-NEXT-PAGE(DP020-SRC-AID)        25510099
255200*----PC-TSYMSG-00070 - BOTTOM OF LIST                             25520099
255300                         MOVE PC-TSYMSG-00070                     25530099
255400                               TO  DP020-MSG-NUMBER               25540099
255500                         SET PS-INFORMATIONAL                     25550099
255600                               TO  TRUE                           25560099
255700                         SET DP020-MSG-INFORMATIONAL              25570099
255800                               TO  TRUE                           25580099
255900                         SET PS-CURSOR-POSITIONED                 25590099
256000                               TO  TRUE                           25600099
256100                     END-IF                                       25610099
256200                 END-IF                                           25620099
256300             END-IF                                               25630099
256400         END-IF                                                   25640099
256500     END-IF.                                                      25650099
256600                                                                  25660099
256700     PERFORM G300-DETERMINE-WHAT-IS-WHERE.                        25670099
256800                                                                  25680099
256900     IF  PS-TOP-ITEM-IN-ARRAY                                     25690099
257000         IF  PS-BOTTOM-ITEM-NOT-IN-ARRAY                          25700099
257100             IF  PS-BOTTOM-ITEM-IN-TEMP                           25710099
257200                 PERFORM G500-SCROLL-FORWARD                      25720099
257300             ELSE                                                 25730099
257400                 IF  PS-LAST-BLOCK-NOT-IN-ARRAY                   25740099
257500                     PERFORM G500-SCROLL-FORWARD                  25750099
257600                 END-IF                                           25760099
257700                 PERFORM G400-READ-ITEMS-INTO-ARRAY               25770099
257800             END-IF                                               25780099
257900         END-IF                                                   25790099
258000     ELSE                                                         25800099
258100                                                                  25810099
258200         IF  PS-BOTTOM-ITEM-IN-ARRAY                              25820099
258300             PERFORM G600-SCROLL-BACKWARD                         25830099
258400         ELSE                                                     25840099
258500             IF  PS-TOP-ITEM-IN-TEMP                              25850099
258600                 PERFORM G700-GET-TOP-ITEMS-BLOCK                 25860099
258700                 PERFORM G300-DETERMINE-WHAT-IS-WHERE             25870099
258800                 IF  PS-BOTTOM-ITEM-NOT-IN-ARRAY                  25880099
258900                     PERFORM G400-READ-ITEMS-INTO-ARRAY           25890099
259000                 END-IF                                           25900099
259100             ELSE                                                 25910099
259200                 IF  PS-LAST-BLOCK-NOT-IN-ARRAY                   25920099
259300                     PERFORM G800-GET-LAST-BLOCK-IN-TEMP          25930099
259400                 END-IF                                           25940099
259500                 PERFORM G400-READ-ITEMS-INTO-ARRAY               25950099
259600             END-IF                                               25960099
259700         END-IF                                                   25970099
259800     END-IF.                                                      25980099
259900                                                                  25990099
260000     IF  PV-TOP-ITEM = RV102-ITEM-AT-TOP-OF-PANEL                 26000099
260100         SET PS-SAME-ITEMS-DISPLAYED                              26010099
260200                               TO  TRUE                           26020099
260300     ELSE                                                         26030099
260400         SET PS-DIFFERENT-ITEMS-DISPLAYED                         26040099
260500                               TO  TRUE                           26050099
260600         MOVE PV-TOP-ITEM      TO  RV102-ITEM-AT-TOP-OF-PANEL     26060099
260700     END-IF.                                                      26070099
260800                                                                  26080099
260900     PERFORM G100-DISPLAY-PANEL.                                  26090099
261000*----------------------------------------------------------------*26100099
261100*    MARK EACH ITEM AS BEING NOT SELECTED.                       *26110099
261200*                                                                *26120099
261300*    PERFORMED BY E700-DESELECT-ALL-ITEMS.                       *26130099
261400*----------------------------------------------------------------*26140099
261500 F600-CLEAR-SELECTED-INDS.                                        26150099
261600     IF  RV102-LIST-ITEM-NUMBER(RV102-BLK-SUB RV102-ITEM-SUB)     26160099
261700             NOT EQUAL ZERO                                       26170099
261800         IF  NOT RV102-NO-SELECT(RV102-BLK-SUB RV102-ITEM-SUB)    26180099
261900             SET RV102-NO-SELECT(RV102-BLK-SUB RV102-ITEM-SUB)    26190099
262000                               TO  TRUE                           26200099
262100             SET RV102-BLOCK-MODIFIED(RV102-BLK-SUB)              26210099
262200                               TO  TRUE                           26220099
262300         END-IF                                                   26230099
262400     END-IF.                                                      26240099
262500*----------------------------------------------------------------*26250099
262600*    MARK EACH ITEM AS BEING SELECTED, EXCEPT DELETED ITEMS.     *26260099
262700*                                                                *26270099
262800*    PERFORMED BY E900-SELECT-ALL-ITEMS.                         *26280099
262900*----------------------------------------------------------------*26290099
263000 F700-SET-SELECTED-INDS.                                          26300099
263100     IF  RV102-LIST-ITEM-NUMBER(RV102-BLK-SUB RV102-ITEM-SUB)     26310099
263200         NOT EQUAL ZERO                                           26320099
263300                                                                  26330099
263400         IF  NOT RV102-SELECT(RV102-BLK-SUB RV102-ITEM-SUB)       26340099
263500             IF  RV102-ACTION(RV102-BLK-SUB RV102-ITEM-SUB)       26350099
263600                 EQUAL PC-DEL                                     26360099
263700                 ADD 1         TO  PV-DEL-COUNT                   26370099
263800             ELSE                                                 26380099
263900                 SET RV102-SELECT(RV102-BLK-SUB RV102-ITEM-SUB)   26390099
264000                               TO  TRUE                           26400099
264100                 SET RV102-BLOCK-MODIFIED(RV102-BLK-SUB)          26410099
264200                               TO  TRUE                           26420099
264300             END-IF                                               26430099
264400         END-IF                                                   26440099
264500     END-IF.                                                      26450099
264600*----------------------------------------------------------------*26460099
264700*    FILL THE MAP WITH THE NECESSARY DATA AND WRITE IT OUT.      *26470099
264800*                                                                *26480099
264900*    PERFORMED BY B100-CONTROL-PROCESSING.                       *26490099
265000*    PERFORMED BY C300-PROCESS-PANEL.                            *26500099
265100*    PERFORMED BY C400-REFRESH-PANEL-FROM-TEMP.                  *26510099
265200*    PERFORMED BY D100-SETUP-INIT-PANEL.                         *26520099
265300*    PERFORMED BY E400-DISPLAY-TOP-OF-LIST.                      *26530099
265400*    PERFORMED BY E500-BROWSE-BACKWARD.                          *26540099
265500*    PERFORMED BY E600-BROWSE-FORWARD.                           *26550099
265600*    PERFORMED BY E700-DESELECT-ALL-ITEMS.                       *26560099
265700*    PERFORMED BY E800-CHECK-FOR-JUMP-BROWSE.                    *26570099
265800*    PERFORMED BY F500-BROWSE.                                   *26580099
265900*----------------------------------------------------------------*26590099
266000 G100-DISPLAY-PANEL.                                              26600099
266100     PERFORM DP017-0000-GET-CURR-DATE-TIME.                       26610099
266200     MOVE DP017-EDITED-TIME-HMS                                   26620099
266300                               TO  ATIMEO.                        26630099
266400                                                                  26640099
266500     IF PS-SEND-MAP-N-DATA-FRSET                                  26650099
266600         PERFORM DP002-0000-FORMAT-TITLE-LINES                    26660099
266700         PERFORM DP009-0000-LOAD-FK-LINES                         26670099
266800     END-IF.                                                      26680099
266900                                                                  26690099
267000     PERFORM H200-FORMAT-PANEL-BODY.                              26700099
267100                                                                  26710099
267200     PERFORM DP005-0000-FORMAT-MSG-LINES.                         26720099
267300                                                                  26730099
267400     PERFORM DP008-0000-WRITE-PANEL.                              26740099
267500*----------------------------------------------------------------*26750099
267600*    MARK EACH ITEM THAT FALLS WITHIN THE BEGINNING AND ENDING   *26760099
267700*    RANGE AS BEING SELECTED.                                    *26770099
267800*                                                                *26780099
267900*    PERFORMED BY F200-MARK-RANGE-AS-SELECTED.                   *26790099
268000*----------------------------------------------------------------*26800099
268100 G200-MARK-SELECTED-INDS.                                         26810099
268200     IF  RV102-LIST-ITEM-NUMBER(RV102-BLK-SUB                     26820099
268300                                RV102-ITEM-SUB)                   26830099
268400         GREATER RV102-END-OF-SELECTED-RANGE                      26840099
268500         CONTINUE                                                 26850099
268600                                                                  26860099
268700     ELSE                                                         26870099
268800         IF  RV102-LIST-ITEM-NUMBER(RV102-BLK-SUB                 26880099
268900                                    RV102-ITEM-SUB)               26890099
269000             LESS RV102-START-OF-SELECTED-RANGE                   26900099
269100             CONTINUE                                             26910099
269200                                                                  26920099
269300         ELSE                                                     26930099
269400             IF (NOT RV102-SELECT(RV102-BLK-SUB                   26940099
269500                                 RV102-ITEM-SUB)                  26950099
269600             AND RV102-ACTION(RV102-BLK-SUB                       26960099
269700                                 RV102-ITEM-SUB)                  26970099
269800                 NOT EQUAL PC-DEL)                                26980099
269900                                                                  26990099
270000                 SET RV102-SELECT(RV102-BLK-SUB                   27000099
270100                                  RV102-ITEM-SUB)                 27010099
270200                               TO  TRUE                           27020099
270300                 SET RV102-BLOCK-MODIFIED(RV102-BLK-SUB)          27030099
270400                               TO  TRUE                           27040099
270500                 ADD +1        TO RV102-NUMBER-OF-SELECTED-ITEMS  27050099
270600                                                                  27060099
270700             END-IF                                               27070099
270800         END-IF                                                   27080099
270900     END-IF.                                                      27090099
271000*----------------------------------------------------------------*27100099
271100*    DETERMINE WHETHER THE TOP ITEM AND BOTTOM ITEM CAN BE FOUND *27110099
271200*    IN THE ARRAY, IN TEMPORARY STORAGE, OR NEITHER.             *27120099
271300*                                                                *27130099
271400*    PERFORMED BY F500-BROWSE.                                   *27140099
271500*----------------------------------------------------------------*27150099
271600 G300-DETERMINE-WHAT-IS-WHERE.                                    27160099
271700     MOVE RV102-LIST-ITEM-NUMBER(1 1)                             27170099
271800                               TO  PV-FIRST-ITEM-IN-ARRAY.        27180099
271900     COMPUTE PV-LAST-ITEM-IN-ARRAY =                              27190099
272000         (PV-FIRST-ITEM-IN-ARRAY +                                27200099
272100         (PC-MAX-BLOCKS-IN-ARRAY * PC-ITEMS-PER-BLOCK)) - 1.      27210099
272200     IF  PV-LAST-ITEM-IN-ARRAY > RV102-NUMBER-OF-ITEMS-READ       27220099
272300         MOVE RV102-NUMBER-OF-ITEMS-READ                          27230099
272400                               TO  PV-LAST-ITEM-IN-ARRAY          27240099
272500     END-IF.                                                      27250099
272600                                                                  27260099
272700     COMPUTE PV-LAST-ITEM-IN-TEMP =                               27270099
272800         RV102-HIGHEST-BLOCK-WRITTEN * PC-ITEMS-PER-BLOCK.        27280099
272900     IF  PV-LAST-ITEM-IN-TEMP > RV102-NUMBER-OF-ITEMS-READ        27290099
273000         MOVE RV102-NUMBER-OF-ITEMS-READ                          27300099
273100                               TO  PV-LAST-ITEM-IN-TEMP           27310099
273200     END-IF.                                                      27320099
273300                                                                  27330099
273400     IF (PV-TOP-ITEM > PV-FIRST-ITEM-IN-ARRAY)                    27340099
273500     OR (PV-TOP-ITEM = PV-FIRST-ITEM-IN-ARRAY)                    27350099
273600         IF (PV-TOP-ITEM < PV-LAST-ITEM-IN-ARRAY)                 27360099
273700         OR (PV-TOP-ITEM = PV-LAST-ITEM-IN-ARRAY)                 27370099
273800             SET PS-TOP-ITEM-IN-ARRAY                             27380099
273900                               TO  TRUE                           27390099
274000         ELSE                                                     27400099
274100             SET PS-TOP-ITEM-NOT-IN-ARRAY                         27410099
274200                               TO  TRUE                           27420099
274300         END-IF                                                   27430099
274400     ELSE                                                         27440099
274500         SET PS-TOP-ITEM-NOT-IN-ARRAY                             27450099
274600                               TO  TRUE                           27460099
274700     END-IF.                                                      27470099
274800                                                                  27480099
274900     IF (PV-BOTTOM-ITEM > PV-FIRST-ITEM-IN-ARRAY)                 27490099
275000     OR (PV-BOTTOM-ITEM = PV-FIRST-ITEM-IN-ARRAY)                 27500099
275100         IF (PV-BOTTOM-ITEM < PV-LAST-ITEM-IN-ARRAY)              27510099
275200         OR (PV-BOTTOM-ITEM = PV-LAST-ITEM-IN-ARRAY)              27520099
275300             SET PS-BOTTOM-ITEM-IN-ARRAY                          27530099
275400                               TO  TRUE                           27540099
275500         ELSE                                                     27550099
275600             SET PS-BOTTOM-ITEM-NOT-IN-ARRAY                      27560099
275700                               TO  TRUE                           27570099
275800         END-IF                                                   27580099
275900     ELSE                                                         27590099
276000         SET PS-BOTTOM-ITEM-NOT-IN-ARRAY                          27600099
276100                               TO  TRUE                           27610099
276200     END-IF.                                                      27620099
276300                                                                  27630099
276400     IF (PV-TOP-ITEM < PV-LAST-ITEM-IN-TEMP)                      27640099
276500     OR (PV-TOP-ITEM = PV-LAST-ITEM-IN-TEMP)                      27650099
276600         SET PS-TOP-ITEM-IN-TEMP                                  27660099
276700                               TO  TRUE                           27670099
276800     ELSE                                                         27680099
276900         SET PS-TOP-ITEM-NOT-IN-TEMP                              27690099
277000                               TO  TRUE                           27700099
277100     END-IF.                                                      27710099
277200                                                                  27720099
277300     IF (PV-BOTTOM-ITEM < PV-LAST-ITEM-IN-TEMP)                   27730099
277400     OR (PV-BOTTOM-ITEM = PV-LAST-ITEM-IN-TEMP)                   27740099
277500         SET PS-BOTTOM-ITEM-IN-TEMP                               27750099
277600                               TO  TRUE                           27760099
277700     ELSE                                                         27770099
277800         SET PS-BOTTOM-ITEM-NOT-IN-TEMP                           27780099
277900                               TO  TRUE                           27790099
278000     END-IF.                                                      27800099
278100                                                                  27810099
278200     IF PV-LAST-ITEM-IN-TEMP > PV-LAST-ITEM-IN-ARRAY              27820099
278300         SET PS-LAST-BLOCK-NOT-IN-ARRAY                           27830099
278400                               TO  TRUE                           27840099
278500     ELSE                                                         27850099
278600         SET PS-LAST-BLOCK-IN-ARRAY                               27860099
278700                               TO  TRUE                           27870099
278800     END-IF.                                                      27880099
278900*----------------------------------------------------------------*27890099
279000*    DETERMINE THE SPOT IN THE ARRAY WHERE THE LAST ITEM FROM    *27900099
279100*    THE DATA BASE WAS ADDED SO WE KNOW WHERE TO ADD THE NEW     *27910099
279200*    ITEMS.  USE THE SAVED UPC KEY TO START THE BROWSE.  H600    *27920099
279300*    MUST BE PERFORMED TO POSITION TO THE FIRST UPC TO PROCESS.  *27930099
279400*                                                                *27940099
279500*    PERFORMED BY F500-BROWSE.                                   *27950099
279600*----------------------------------------------------------------*27960099
279700 G400-READ-ITEMS-INTO-ARRAY.                                      27970099
279800     COMPUTE PS-ITEM-SUB =                                        27980099
279900         (RV102-NUMBER-OF-ITEMS-READ -                            27990099
280000          RV102-LIST-ITEM-NUMBER(1 1)) + 1.                       28000099
280100                                                                  28010099
280200     MOVE PS-ITEM-SUB TO RV102-ITEM-SUB.                          28020099
280300                                                                  28030099
280400     IF  RV102-ITEM-SUB > PC-ITEMS-PER-BLOCK                      28040099
280500         SUBTRACT PC-ITEMS-PER-BLOCK                              28050099
280600                             FROM  RV102-ITEM-SUB                 28060099
280700         MOVE PC-MAX-BLOCKS-IN-ARRAY                              28070099
280800                               TO  RV102-BLK-SUB                  28080099
280900     ELSE                                                         28090099
281000         MOVE +1               TO  RV102-BLK-SUB                  28100099
281100     END-IF.                                                      28110099
281200                                                                  28120099
281300     MOVE PV-BOTTOM-ITEM       TO  PV-HIGHEST-ITEM-TO-BE-READ.    28130099
281400                                                                  28140099
281500     PERFORM L100-OPEN-CURSOR.                                    28150099
281600     PERFORM H100-READ-ITEMS-FROM-DB.                             28160099
281700     IF  PV-ITEMS-READ EQUAL ZERO                                 28170099
281800         MOVE RV102-ITEM-AT-TOP-OF-PANEL                          28180099
281900                               TO  PV-TOP-ITEM                    28190099
282000     END-IF.                                                      28200099
282100                                                                  28210099
282200     IF  RV102-NO-ITEMS-LEFT-ON-DB                                28220099
282300         IF  PV-TOP-ITEM > RV102-NUMBER-OF-ITEMS-READ             28230099
282400             MOVE RV102-NUMBER-OF-ITEMS-READ                      28240099
282500                               TO  PV-TOP-ITEM                    28250099
282600         END-IF                                                   28260099
282700         IF  DP020-FK-NEXT-PAGE(DP020-SRC-AID)                    28270099
282800*----PC-TSYMSG-00070 - BOTTOM OF LIST                             28280099
282900             MOVE PC-TSYMSG-00070  TO  DP020-MSG-NUMBER           28290099
283000             SET DP020-MSG-INFORMATIONAL                          28300099
283100                               TO  TRUE                           28310099
283200             SET PS-INFORMATIONAL                                 28320099
283300                               TO  TRUE                           28330099
283400         END-IF                                                   28340099
283500     END-IF.                                                      28350099
283600*----------------------------------------------------------------*28360099
283700*    IF THE TOP ITEM WE NEED IS IN THE ARRAY, BUT THE BOTTOM     *28370099
283800*    ITEM WE NEED IS IN TEMPORARY STORAGE OR HAS NOT BEEN READ   *28380099
283900*    YET, WRITE OUT THE 1ST BLOCK IN THE ARRAY TO TEMPORARY      *28390099
284000*    STORAGE.  MOVE THE 2ND BLOCK IN THE ARRAY TO THE 1ST BLOCK  *28400099
284100*    AND READ THE BLOCK NEEDED INTO THE 2ND BLOCK OF THE ARRAY.  *28410099
284200*    THE TOP ITEM WILL BE LOCATED IN THE 1ST BLOCK, AND THE      *28420099
284300*    BOTTOM ITEM WILL EITHER BE LOCATED IN THE 2ND BLOCK OR      *28430099
284400*    WILL BE PLACED IN THE 2ND BLOCK.                            *28440099
284500*                                                                *28450099
284600*    PERFORMED BY F500-BROWSE.                                   *28460099
284700*----------------------------------------------------------------*28470099
284800 G500-SCROLL-FORWARD.                                             28480099
284900     MOVE +1                   TO  RV102-BLK-SUB.                 28490099
285000     PERFORM Z150-WRITE-TEMP-STORAGE.                             28500099
285100                                                                  28510099
285200     MOVE RV102-BLOCK-ENTRIES(PC-MAX-BLOCKS-IN-ARRAY) TO          28520099
285300          RV102-BLOCK-ENTRIES(RV102-BLK-SUB).                     28530099
285400                                                                  28540099
285500     COMPUTE PV-TEMP-BLOCK-NUMBER =                               28550099
285600         1 + ((PV-BOTTOM-ITEM - 1) / PC-ITEMS-PER-BLOCK).         28560099
285700                                                                  28570099
285800     MOVE PV-TEMP-BLOCK-NUMBER TO  PV-BLOCK-NUMBER.               28580099
285900     ADD +1                    TO  RV102-BLK-SUB.                 28590099
286000     PERFORM Z100-READ-TEMP-STORAGE.                              28600099
286100*----------------------------------------------------------------*28610099
286200*    IF TOP ITEM WE NEED IS NOT IN THE ARRAY, BUT THE BOTTOM     *28620099
286300*    ITEM IS, WRITE BOTH BLOCKS TO TEMPORARY STORAGE.  MOVE      *28630099
286400*    THE 1ST BLOCK IN THE ARRAY TO THE 2ND BLOCK OF THE ARRAY.   *28640099
286500*    READ THE BLOCK THAT CONTAINS THE TOP ITEM INTO THE 1ST BLOCK*28650099
286600*    OF THE ARRAY.                                               *28660099
286700*                                                                *28670099
286800*    PERFORMED BY F500-BROWSE.                                   *28680099
286900*----------------------------------------------------------------*28690099
287000 G600-SCROLL-BACKWARD.                                            28700099
287100     MOVE +1                   TO  RV102-BLK-SUB.                 28710099
287200     PERFORM Z150-WRITE-TEMP-STORAGE.                             28720099
287300                                                                  28730099
287400     ADD +1 TO RV102-BLK-SUB.                                     28740099
287500     PERFORM Z150-WRITE-TEMP-STORAGE.                             28750099
287600                                                                  28760099
287700     MOVE +1                   TO  RV102-BLK-SUB.                 28770099
287800     MOVE RV102-BLOCK-ENTRIES(RV102-BLK-SUB) TO                   28780099
287900          RV102-BLOCK-ENTRIES(PC-MAX-BLOCKS-IN-ARRAY).            28790099
288000                                                                  28800099
288100     COMPUTE PV-TEMP-BLOCK-NUMBER =                               28810099
288200         1 + ((PV-TOP-ITEM - 1) / PC-ITEMS-PER-BLOCK).            28820099
288300                                                                  28830099
288400     MOVE PV-TEMP-BLOCK-NUMBER TO PV-BLOCK-NUMBER.                28840099
288500     PERFORM Z100-READ-TEMP-STORAGE.                              28850099
288600*----------------------------------------------------------------*28860099
288700*    IF BOTH THE TOP AND BOTTOM ITEMS WE NEED ARE NOT IN THE     *28870099
288800*    ARRAY, BUT THE TOP ITEM IS IN TEMPORARY STORAGE, WRITE BOTH *28880099
288900*    BLOCKS IN THE ARRAY TO TEMPORARY STORAGE.  READ THE BLOCK   *28890099
289000*    THAT CONTAINS THE TOP ITEM INTO THE 1ST BLOCK OF THE ARRAY. *28900099
289100*    IF THERE IS ANOTHER BLOCK IN TEMPORARY STORAGE FOLLOWING    *28910099
289200*    THE ONE JUST READ, READ THAT ONE INTO THE 2ND BLOCK OF THE  *28920099
289300*    ARRAY, OTHERWISE INITIALIZE THE 2ND BLOCK OF THE ARRAY.     *28930099
289400*                                                                *28940099
289500*    PERFORMED BY F500-BROWSE.                                   *28950099
289600*----------------------------------------------------------------*28960099
289700 G700-GET-TOP-ITEMS-BLOCK.                                        28970099
289800     MOVE +1                   TO  RV102-BLK-SUB.                 28980099
289900     PERFORM Z150-WRITE-TEMP-STORAGE.                             28990099
290000                                                                  29000099
290100     ADD +1                    TO  RV102-BLK-SUB.                 29010099
290200     PERFORM Z150-WRITE-TEMP-STORAGE.                             29020099
290300                                                                  29030099
290400     COMPUTE PV-TEMP-BLOCK-NUMBER =                               29040099
290500         1 + ((PV-TOP-ITEM - 1) / PC-ITEMS-PER-BLOCK).            29050099
290600                                                                  29060099
290700     MOVE PV-TEMP-BLOCK-NUMBER TO  PV-BLOCK-NUMBER.               29070099
290800     MOVE +1                   TO  RV102-BLK-SUB.                 29080099
290900                                                                  29090099
291000     PERFORM Z100-READ-TEMP-STORAGE.                              29100099
291100                                                                  29110099
291200     ADD +1                    TO  PV-BLOCK-NUMBER.               29120099
291300     ADD +1                    TO  RV102-BLK-SUB.                 29130099
291400                                                                  29140099
291500     IF (PV-BLOCK-NUMBER < RV102-HIGHEST-BLOCK-WRITTEN) OR        29150099
291600        (PV-BLOCK-NUMBER = RV102-HIGHEST-BLOCK-WRITTEN)           29160099
291700         PERFORM Z100-READ-TEMP-STORAGE                           29170099
291800     ELSE                                                         29180099
291900         PERFORM I100-INITIALIZE-BLOCK                            29190099
292000     END-IF.                                                      29200099
292100*----------------------------------------------------------------*29210099
292200*    IF BOTH THE TOP AND BOTTOM ITEMS WE NEED ARE NOT IN THE     *29220099
292300*    ARRAY AND BOTH ITEMS ARE NOT IN TEMPORARY STORAGE (THE      *29230099
292400*    ITEMS HAVE NOT BEEN READ FROM THE DATA BASE YET), AND THE   *29240099
292500*    LAST ITEM READ FROM THE DATA BASE IS IN TEMPORARY STORAGE,  *29250099
292600*    WRITE BOTH BLOCKS IN THE ARRAY TO TEMPORARY STORAGE.  READ  *29260099
292700*    THE HIGHEST BLOCK IN TEMPORARY STORAGE INTO THE 1ST BLOCK   *29270099
292800*    OF THE ARRAY, AND INITIALIZE THE 2ND BLOCK IN THE ARRAY.    *29280099
292900*    THE 2ND BLOCK WILL BE USED FOR THE NEW ITEMS TO BE READ.    *29290099
293000*    THE 1ST BLOCK WILL NOW CONTAIN THE ITEMS THAT WERE LAST     *29300099
293100*    READ FROM THE DATA BASE.                                    *29310099
293200*                                                                *29320099
293300*    PERFORMED BY F500-BROWSE.                                   *29330099
293400*----------------------------------------------------------------*29340099
293500 G800-GET-LAST-BLOCK-IN-TEMP.                                     29350099
293600     MOVE +1                   TO  RV102-BLK-SUB.                 29360099
293700     PERFORM Z150-WRITE-TEMP-STORAGE.                             29370099
293800                                                                  29380099
293900     ADD +1                    TO  RV102-BLK-SUB.                 29390099
294000     PERFORM Z150-WRITE-TEMP-STORAGE.                             29400099
294100                                                                  29410099
294200     MOVE RV102-HIGHEST-BLOCK-WRITTEN                             29420099
294300                               TO  PV-BLOCK-NUMBER.               29430099
294400     MOVE +1                   TO  RV102-BLK-SUB.                 29440099
294500     PERFORM Z100-READ-TEMP-STORAGE.                              29450099
294600                                                                  29460099
294700     ADD +1                    TO  RV102-BLK-SUB.                 29470099
294800     PERFORM I100-INITIALIZE-BLOCK.                               29480099
294900*----------------------------------------------------------------*29490099
295000*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *29500099
295100*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *29510099
295200*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *29520099
295300*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *29530099
295400*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *29540099
295500*                                                                *29550099
295600*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *29560099
295700*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *29570099
295800*    UPON INITIALIZATION.                                        *29580099
295900*                                                                *29590099
296000*    PERFORMED BY D100-SETUP-INIT-PANEL.                         *29600099
296100*    PERFORMED BY G400-READ-ITEMS-INTO-ARRAY.                    *29610099
296200*----------------------------------------------------------------*29620099
296300 H100-READ-ITEMS-FROM-DB.                                         29630099
296400     PERFORM                                                      29640099
296500         UNTIL  RV102-NO-ITEMS-LEFT-ON-DB OR                      29650099
296600                PS-ERROR                                          29660099
296700*         OR    RV102-NUMBER-OF-ITEMS-READ =                      29670099
296800*               PV-HIGHEST-ITEM-TO-BE-READ                        29680099
296900                                                                  29690099
297000         PERFORM L200-FETCH                                       29700099
297100                                                                  29710099
297200         IF  RV102-ITEMS-LEFT-ON-DB AND PS-NO-ERROR               29720099
297300             IF  RV102-ITEM-SUB < PC-ITEMS-PER-BLOCK              29730099
297400                 ADD +1            TO  RV102-ITEM-SUB             29740099
297500             ELSE                                                 29750099
297600                 ADD +1            TO  RV102-BLK-SUB              29760099
297700                 MOVE +1           TO  RV102-ITEM-SUB             29770099
297800                                                                  29780099
297900                 IF  RV102-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY       29790099
298000                     MOVE +1       TO  RV102-BLK-SUB              29800099
298100                     SET RV102-BLOCK-MODIFIED (1)                 29810099
298200                               TO  TRUE                           29820099
298300                     PERFORM Z150-WRITE-TEMP-STORAGE              29830099
298400                     MOVE RV102-BLOCK-ENTRIES                     29840099
298500                               (PC-MAX-BLOCKS-IN-ARRAY)           29850099
298600                     TO   RV102-BLOCK-ENTRIES(RV102-BLK-SUB)      29860099
298700                     ADD +1        TO  RV102-BLK-SUB              29870099
298800                     PERFORM I100-INITIALIZE-BLOCK                29880099
298900                 END-IF                                           29890099
299000             END-IF                                               29900099
299100                                                                  29910099
299200             ADD 1             TO  RV102-NUMBER-OF-ITEMS-READ     29920099
299300                                   PV-ITEMS-READ                  29930099
299400             MOVE RV102-NUMBER-OF-ITEMS-READ                      29940099
299500                               TO  RV102-LIST-ITEM-NUMBER         29950099
299600                                       (RV102-BLK-SUB             29960099
299700                                        RV102-ITEM-SUB)           29970099
299800                                                                  29980099
299900             EVALUATE DFMEIT-MKOUT-ORD-STAT-CDE                   29990099
300000                                                                  30000099
300100                 WHEN 'P'                                         30010099
300200                     MOVE 'P'                                     30020099
300300                               TO  RV102-STATUS-CODE              30030099
300400                                       (RV102-BLK-SUB             30040099
300500                                        RV102-ITEM-SUB)           30050099
300600                                                                  30060099
300700                 WHEN 'A'                                         30070099
300800                     MOVE 'A'                                     30080099
300900                               TO  RV102-STATUS-CODE              30090099
301000                                       (RV102-BLK-SUB             30100099
301100                                        RV102-ITEM-SUB)           30110099
301200                                                                  30120099
301300                 WHEN OTHER                                       30130099
301400                     MOVE 'O'                                     30140099
301500                               TO  RV102-STATUS-CODE              30150099
301600                                       (RV102-BLK-SUB             30160099
301700                                        RV102-ITEM-SUB)           30170099
301800             END-EVALUATE                                         30180099
301900             MOVE DP015-GREEN  TO  RV102-COLOR                    30190099
302000                                       (RV102-BLK-SUB             30200099
302100                                        RV102-ITEM-SUB)           30210099
302200             MOVE DP015-UNDERLINE                                 30220099
302300                               TO  RV102-HILIGHT                  30230099
302400                                       (RV102-BLK-SUB             30240099
302500                                        RV102-ITEM-SUB)           30250099
302600             MOVE DP015-UNP-NUM-NOR-OFF                           30260099
302700                               TO  RV102-ATTRIBUTE                30270099
302800                                       (RV102-BLK-SUB             30280099
302900                                        RV102-ITEM-SUB)           30290099
303000                                                                  30300099
303100             MOVE DFMEIT-RTL-COST-AMT                             30310099
303200                               TO  RV102-URETAIL                  30320099
303300                                       (RV102-BLK-SUB             30330099
303400                                        RV102-ITEM-SUB)           30340099
303500             ADD DFMEIT-RTL-COST-AMT                              30350099
303600                               TO  RV102-TOTAL-RETAIL             30360099
303700                                                                  30370099
303800             MOVE DFMEIT-UNIT-COST-AMT                            30380099
303900                               TO  RV102-UCOST                    30390099
304000                                       (RV102-BLK-SUB             30400099
304100                                        RV102-ITEM-SUB)           30410099
304200             ADD DFMEIT-UNIT-COST-AMT                             30420099
304300                               TO  RV102-TOTAL-COST               30430099
304400                                                                  30440099
304500             MOVE DFMEIT-SEQ-NBR                                  30450099
304600                               TO  RV102-SEQ-NUMBER               30460099
304700                                       (RV102-BLK-SUB             30470099
304800                                        RV102-ITEM-SUB)           30480099
304900                                                                  30490099
305000             MOVE DFMEIT-MDSE-DEPT-NBR                            30500099
305100                               TO  RV102-DEPT                     30510099
305200                                   (RV102-BLK-SUB                 30520099
305300                                    RV102-ITEM-SUB)               30530099
305400             MOVE DFMEIT-MDSE-CLASS-NBR(1:1)                      30540099
305500                               TO  PV-MAJ-CLASS-DIGIT-3           30550099
305600             MOVE PV-MAJ-CLASS TO   RV102-MAJ-CLASS               30560099
305700                                    (RV102-BLK-SUB                30570099
305800                                     RV102-ITEM-SUB)              30580099
305900             MOVE DFMEIT-MDSE-CLASS-NBR                           30590099
306000                               TO  PV-SUB-CLASS-DIGIT-3-4         30600099
306100             MOVE PV-SUB-CLASS TO  RV102-SUB-CLASS                30610099
306200                                   (RV102-BLK-SUB                 30620099
306300                                    RV102-ITEM-SUB)               30630099
306400             MOVE XLT00003-SKU-NBR                                30640099
306500                               TO  RV102-SKU                      30650099
306600                                   (RV102-BLK-SUB                 30660099
306700                                    RV102-ITEM-SUB)               30670099
306800                                                                  30680099
306900             MOVE XLT00006-UPC-NBR                                30690099
307000                               TO  RV102-UPC                      30700099
307100                                   (RV102-BLK-SUB                 30710099
307200                                    RV102-ITEM-SUB)               30720099
307300             MOVE XLT00004-VS-NBR                                 30730099
307400                               TO  RV102-STYLE                    30740099
307500                                       (RV102-BLK-SUB             30750099
307600                                        RV102-ITEM-SUB)           30760099
307700                                                                  30770099
307800             MOVE XLT00003-SKU-DESC TO  RV102-DESC                30780099
307900                                       (RV102-BLK-SUB             30790099
308000                                        RV102-ITEM-SUB)           30800099
308100             MOVE DFMEIT-DFCT-ITEM-NBR                            30810099
308200                                 TO RV102-DFCT-ITEM-NBR           30820099
308300                                    (RV102-BLK-SUB                30830099
308400                                     RV102-ITEM-SUB)              30840099
308500             IF (RV102-ORDER-TYPE = 'MARKOUT ' AND                30850099
308600                 RV102-ORDER-STATUS NOT = 'OPEN    ')             30860099
308700                 MOVE STRPPC-STATUS-CDE                           30870099
308800                                 TO RV102-PERM-STATUS-CDE         30880099
308900                                    (RV102-BLK-SUB                30890099
309000                                     RV102-ITEM-SUB)              30900099
309100                 MOVE SPPCDT-DOC-NBR                              30910099
309200                                 TO RV102-PERM-DOC-NBR            30920099
309300                                    (RV102-BLK-SUB                30930099
309400                                     RV102-ITEM-SUB)              30940099
309500                 MOVE SPPCDT-ROW-NBR                              30950099
309600                                 TO RV102-PERM-DTL-ROW-NBR        30960099
309700                                    (RV102-BLK-SUB                30970099
309800                                     RV102-ITEM-SUB)              30980099
309900             END-IF                                               30990099
310000         END-IF                                                   31000099
310100     END-PERFORM.                                                 31010099
310200                                                                  31020099
310300     IF PS-NO-ERROR                                               31030099
310400         IF  RV102-NUMBER-OF-ITEMS-READ EQUAL ZERO                31040099
310500             SET PS-NO-LIST-ITEMS-FOUND                           31050099
310600                                 TO TRUE                          31060099
310700             SET DP020-MSG-FATAL TO TRUE                          31070099
310800*----PC-TSYMSG-00050 - NO LIST ITEMS WERE FOUND FOR THE CRITERIA  31080099
310900*----                  SPECIFIED                                  31090099
311000             MOVE PC-TSYMSG-00050                                 31100099
311100                                 TO DP020-MSG-NUMBER              31110099
311200         ELSE                                                     31120099
311300             SET PS-LIST-ITEMS-FOUND                              31130099
311400                                 TO TRUE                          31140099
311500             MOVE DFMEIT-DFCT-ITEM-NBR                            31150099
311600                                 TO RV102-LAST-ITEM-NUMBER        31160099
311700         END-IF                                                   31170099
311800                                                                  31180099
311900         MOVE +1                 TO RV102-BLK-SUB                 31190099
312000         PERFORM Z150-WRITE-TEMP-STORAGE                          31200099
312100         ADD +1                  TO RV102-BLK-SUB                 31210099
312200         PERFORM Z150-WRITE-TEMP-STORAGE                          31220099
312300                                                                  31230099
312400         MOVE 1                  TO RV102-BLK-SUB                 31240099
312500                                    PV-BLOCK-NUMBER               31250099
312600         PERFORM Z100-READ-TEMP-STORAGE                           31260099
312700         IF RV102-HIGHEST-BLOCK-WRITTEN GREATER THAN 1            31270099
312800             MOVE 2              TO RV102-BLK-SUB                 31280099
312900                                    PV-BLOCK-NUMBER               31290099
313000             PERFORM Z100-READ-TEMP-STORAGE                       31300099
313100         END-IF                                                   31310099
313200     END-IF.                                                      31320099
313300*----------------------------------------------------------------*31330099
313400*    FORMAT THE MAP AND DETERMINE THE CURSOR POSITION.           *31340099
313500*                                                                *31350099
313600*    PERFORMED BY G100-DISPLAY-PANEL.                            *31360099
313700*----------------------------------------------------------------*31370099
313800 H200-FORMAT-PANEL-BODY.                                          31380099
313900     PERFORM I700-FORMAT-FROM-TO-LINE.                            31390099
314000     PERFORM I200-FORMAT-LIST-LINES.                              31400099
314100     PERFORM I300-FORMAT-NR-SELECTED.                             31410099
314200                                                                  31420099
314300     IF NOT DP020-NEXT-ACT-ERROR                                  31430099
314400         PERFORM I800-SET-CURSOR-POSITION                         31440099
314500     END-IF.                                                      31450099
314600*----------------------------------------------------------------*31460099
314700*    INITIALIZE A BLOCK IN THE ARRAY.                            *31470099
314800*                                                                *31480099
314900*    PERFORMED BY D100-SETUP-INIT-PANEL.                         *31490099
315000*    PERFORMED BY G700-GET-TOP-ITEMS-BLOCK.                      *31500099
315100*    PERFORMED BY G800-GET-LAST-BLOCK-IN-TEMP.                   *31510099
315200*    PERFORMED BY H100-READ-ITEMS-FROM-DB.                       *31520099
315300*----------------------------------------------------------------*31530099
315400 I100-INITIALIZE-BLOCK.                                           31540099
315500     INITIALIZE  RV102-BLOCK-ENTRIES (RV102-BLK-SUB).             31550099
315600     SET RV102-BLOCK-NOT-MODIFIED(RV102-BLK-SUB) TO TRUE.         31560099
315700*----------------------------------------------------------------*31570099
315800*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *31580099
315900*                                                                *31590099
316000*    PERFORMED BY E800-CHECK-FOR-JUMP-BROWSE.                    *31600099
316100*    PERFORMED BY H200-FORMAT-PANEL-BODY.                        *31610099
316200*----------------------------------------------------------------*31620099
316300 I200-FORMAT-LIST-LINES.                                          31630099
316400     COMPUTE PV-ENDING-ITEM-ON-PANEL =                            31640099
316500         (RV102-ITEM-AT-TOP-OF-PANEL + PC-ITEMS-PER-PANEL) - 1.   31650099
316600                                                                  31660099
316700     MOVE RV102-ITEM-AT-TOP-OF-PANEL                              31670099
316800                               TO  PV-ITEM-IN-USE.                31680099
316900     MOVE +1                   TO  PS-SUB.                        31690099
317000                                                                  31700099
317100     PERFORM J100-PROCESS-ITEMS                                   31710099
317200         UNTIL PV-ITEM-IN-USE > PV-ENDING-ITEM-ON-PANEL.          31720099
317300*----------------------------------------------------------------*31730099
317400*    FORMAT THE FIELD WHICH WILL SHOW THE NUMBER OF ITEMS THAT   *31740099
317500*    WERE SELECTED BY THE USER.                                  *31750099
317600*                                                                *31760099
317700*    PERFORMED BY E800-CHECK-FOR-JUMP-BROWSE.                    *31770099
317800*    PERFORMED BY H200-FORMAT-PANEL-BODY.                        *31780099
317900*----------------------------------------------------------------*31790099
318000 I300-FORMAT-NR-SELECTED.                                         31800099
318100     MOVE RV102-NUMBER-OF-SELECTED-ITEMS                          31810099
318200                               TO  ASELITO.                       31820099
318300*----------------------------------------------------------------*31830099
318400*    FORMAT THE LINE THAT WILL SHOW THE TOTAL NUMBER OF ITEMS WE *31840099
318500*    HAVE ON OUR LIST AND SHOW THE NUMBERS ASSOCIATED WITH THE   *31850099
318600*    FIRST AND LAST ITEMS ON CURRENT PAGE.  THIS WILL HELP THE   *31860099
318700*    USER DETERMINE HOW FAR THEY ARE INTO THE LIST.              *31870099
318800*                                                                *31880099
318900*    PERFORMED BY H200-FORMAT-PANEL-BODY.                        *31890099
319000*----------------------------------------------------------------*31900099
319100 I700-FORMAT-FROM-TO-LINE.                                        31910099
319200     MOVE RV102-ITEM-AT-TOP-OF-PANEL                              31920099
319300                               TO  ASTRTITO.                      31930099
319400                                                                  31940099
319500     MOVE DP015-GREEN          TO  ASTRTITC.                      31950099
319600     MOVE DP015-UNDERLINE      TO  ASTRTITH.                      31960099
319700     MOVE DP015-UNP-NUM-BRT-MDT                                   31970099
319800                               TO  ASTRTITA.                      31980099
319900                                                                  31990099
320000     COMPUTE PV-ENDING-ITEM-ON-PANEL =                            32000099
320100         (RV102-ITEM-AT-TOP-OF-PANEL + PC-ITEMS-PER-PANEL) - 1.   32010099
320200                                                                  32020099
320300     IF PV-ENDING-ITEM-ON-PANEL < RV102-NUMBER-OF-ITEMS-READ      32030099
320400         MOVE PV-ENDING-ITEM-ON-PANEL                             32040099
320500                               TO  AENDITO                        32050099
320600     ELSE                                                         32060099
320700         MOVE RV102-NUMBER-OF-ITEMS-READ                          32070099
320800                               TO  AENDITO                        32080099
320900     END-IF.                                                      32090099
321000                                                                  32100099
321100     MOVE RV102-NUMBER-OF-ITEMS-READ                              32110099
321200                               TO  ATOTITO.                       32120099
321300*----------------------------------------------------------------*32130099
321400*    IF NO ITEMS WERE READ FROM THE DATA BASE, POINT THE CURSOR  *32140099
321500*    TO THE COMMAND LINE, OTHERWISE POINT THE CURSOR TO ONE OF   *32150099
321600*    THE SELECTION ENTRIES.                                      *32160099
321700*                                                                *32170099
321800*    PERFORMED BY H200-FORMAT-PANEL-BODY.                        *32180099
321900*----------------------------------------------------------------*32190099
322000 I800-SET-CURSOR-POSITION.                                        32200099
322100     IF RV102-NUMBER-OF-ITEMS-READ = +0                           32210099
322200     AND DP020-MSG-NUMBER NOT NUMERIC                             32220099
322300         MOVE -1               TO  ANAVCMDL                       32230099
322400*----PC-TSYMSG-00050 - NO LIST ITEMS WERE FOUND FOR THE CRITERIA  32240099
322500*----                  SPECIFIED                                  32250099
322600         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               32260099
322700         SET DP020-MSG-WARNING TO  TRUE                           32270099
322800     ELSE                                                         32280099
322900*JPL 2/2/04                                                       32290099
323000         IF (RV102-ORDER-STATUS = 'SHIPPED ' OR 'APPROVED'        32300099
323100                                             OR 'DEBT/DIS')       32310099
323200             MOVE -1 TO ANAVCMDL                                  32320099
323300         ELSE                                                     32330099
323400                                                                  32340099
323500             IF PS-DONT-PROCESS                                   32350099
323600                 CONTINUE                                         32360099
323700             ELSE                                                 32370099
323800                 IF (PS-CURSOR-NOT-POSITIONED) OR                 32380099
323900                    (PS-WARNING)               OR                 32390099
324000                    (PS-INFORMATIONAL)                            32400099
324100                     PERFORM J200-FIND-LAST-SELECTION             32410099
324200                 END-IF                                           32420099
324300             END-IF                                               32430099
324400         END-IF                                                   32440099
324500     END-IF.                                                      32450099
324600*----------------------------------------------------------------*32460099
324700*    PROCESS EACH ITEM IN THE ARRAY AND MOVE IT TO THE MAP.      *32470099
324800*    FILL THE MAP UNTIL WE HAVE REACHED THE MAXIMUM NUMBER OF    *32480099
324900*    MAP ENTRIES.                                                *32490099
325000*                                                                *32500099
325100*    PERFORMED BY I200-FORMAT-LIST-LINES.                        *32510099
325200*----------------------------------------------------------------*32520099
325300 J100-PROCESS-ITEMS.                                              32530099
325400     IF (PV-ITEM-IN-USE < RV102-NUMBER-OF-ITEMS-READ              32540099
325500     OR  PV-ITEM-IN-USE = RV102-NUMBER-OF-ITEMS-READ)             32550099
325600         PERFORM K100-SET-SUBSCRIPTS                              32560099
325700                                                                  32570099
325800         MOVE DP015-UNP-ALP-BRT-MDT                               32580099
325900                               TO  RVKM102-SELECTA(PS-SUB)        32590099
326000                                                                  32600099
326100         IF (RV102-SELECT(RV102-BLK-SUB RV102-ITEM-SUB))          32610099
326200         OR (RV102-NO-SELECT(RV102-BLK-SUB RV102-ITEM-SUB))       32620099
326300             MOVE DP015-UNDERLINE TO RVKM102-SELECTH(PS-SUB)      32630099
326400             MOVE DP015-GREEN     TO RVKM102-SELECTC(PS-SUB)      32640099
326500         ELSE                                                     32650099
326600                                                                  32660099
326700             IF (RV102-BEGIN(RV102-BLK-SUB RV102-ITEM-SUB))       32670099
326800             OR (RV102-END(RV102-BLK-SUB RV102-ITEM-SUB))         32680099
326900                 MOVE DP015-UNDERLINE   TO RVKM102-SELECTH(PS-SUB)32690099
327000                 MOVE DP015-GREEN       TO RVKM102-SELECTC(PS-SUB)32700099
327100                 IF (DP020-MSG-NUMBER  =    PC-TSYMSG-00051       32710099
327200                                         OR PC-TSYMSG-00053       32720099
327300                    )                                             32730099
327400*                    UNPAIRED RANGE CHARACTER, SET WARNING        32740099
327500*                    ATTRIBUTES FOR RANGE CHARACTER:              32750099
327600                     MOVE DP015-REVERSE TO RVKM102-SELECTH(PS-SUB)32760099
327700                     MOVE DP015-YELLOW  TO RVKM102-SELECTC(PS-SUB)32770099
327800                 END-IF                                           32780099
327900                                                                  32790099
328000                 IF (    DP020-MSG-NUMBER  = PC-TSYMSG-00054      32800099
328100                     AND RV102-BEGIN( RV102-BLK-SUB               32810099
328200                                      RV102-ITEM-SUB   )          32820099
328300                    )                                             32830099
328400*                    TWO OR MORE START-OF-RANGE CHARACTERS, SET   32840099
328500*                    ATTRIBUTES FOR START-OF-RANGE CHARACTERS:    32850099
328600                     MOVE DP015-REVERSE TO RVKM102-SELECTH(PS-SUB)32860099
328700                     MOVE DP015-RED     TO RVKM102-SELECTC(PS-SUB)32870099
328800                 END-IF                                           32880099
328900                                                                  32890099
329000                 IF (    DP020-MSG-NUMBER  = PC-TSYMSG-00055      32900099
329100                     AND RV102-END( RV102-BLK-SUB                 32910099
329200                                    RV102-ITEM-SUB   )            32920099
329300                    )                                             32930099
329400*                    TWO OR MORE END-OF-RANGE CHARACTERS, SET     32940099
329500*                    ATTRIBUTES FOR END-OF-RANGE CHARACTERS:      32950099
329600                     MOVE DP015-REVERSE TO RVKM102-SELECTH(PS-SUB)32960099
329700                     MOVE DP015-RED     TO RVKM102-SELECTC(PS-SUB)32970099
329800                 END-IF                                           32980099
329900                                                                  32990099
330000                 IF  DP020-MSG-NUMBER  =  PC-TSYMSG-00052         33000099
330100*                    END-OF-RANGE PRECEDES START OF RANGE, SET    33010099
330200*                    ATTRIBUTES OF RANGE CHARACTERS:              33020099
330300                     MOVE DP015-REVERSE TO RVKM102-SELECTH(PS-SUB)33030099
330400                     MOVE DP015-RED     TO RVKM102-SELECTC(PS-SUB)33040099
330500                 END-IF                                           33050099
330600             END-IF                                               33060099
330700                                                                  33070099
330800         END-IF                                                   33080099
330900                                                                  33090099
331000         MOVE RV102-SELECTED-SW(RV102-BLK-SUB RV102-ITEM-SUB)     33100099
331100                               TO  RVKM102-SELECTI(PS-SUB)        33110099
331200         IF  RV102-ACTION(RV102-BLK-SUB RV102-ITEM-SUB) = PC-DEL  33120099
331300             MOVE DP015-ASK-DRK-OFF                               33130099
331400                               TO  RVKM102-SELECTA(PS-SUB)        33140099
331500         END-IF                                                   33150099
331600                                                                  33160099
331700                                                                  33170099
331800         IF (PS-SEND-MAP-N-DATA-FRSET                             33180099
331900         OR  PS-DIFFERENT-ITEMS-DISPLAYED)                        33190099
332000                                                                  33200099
332100            MOVE RV102-ACTION (RV102-BLK-SUB RV102-ITEM-SUB)      33210099
332200                               TO  RVKM102-ACTION       (PS-SUB)  33220099
332300            IF  RVKM102-ACTION (PS-SUB) EQUAL PC-ERR              33230099
332400                MOVE DP015-RED TO  RVKM102-SELECTC (PS-SUB)       33240099
332500                MOVE DP015-REVERSE                                33250099
332600                               TO  RVKM102-SELECTH (PS-SUB)       33260099
332700                MOVE -1        TO  RVKM102-SELECTL (PS-SUB)       33270099
332800                SET PS-CURSOR-POSITIONED                          33280099
332900                               TO  TRUE                           33290099
333000                MOVE SPACE     TO  RV102-ACTION                   33300099
333100                                  (RV102-BLK-SUB RV102-ITEM-SUB)  33310099
333200                SET RV102-BLOCK-MODIFIED (RV102-BLK-SUB)          33320099
333300                               TO  TRUE                           33330099
333400            END-IF                                                33340099
333500                                                                  33350099
333600            MOVE RV102-COLOR       (RV102-BLK-SUB RV102-ITEM-SUB) 33360099
333700                               TO                                 33370099
333800                                   RVKM102-URETAILC      (PS-SUB) 33380099
333900            MOVE RV102-HILIGHT     (RV102-BLK-SUB RV102-ITEM-SUB) 33390099
334000                               TO                                 33400099
334100                                   RVKM102-URETAILH      (PS-SUB) 33410099
334200            MOVE RV102-ATTRIBUTE   (RV102-BLK-SUB RV102-ITEM-SUB) 33420099
334300                               TO                                 33430099
334400                                   RVKM102-URETAILA      (PS-SUB) 33440099
334500                                                                  33450099
334600            MOVE RV102-STATUS-CODE (RV102-BLK-SUB RV102-ITEM-SUB) 33460099
334700                               TO  RVKM102-STATUS        (PS-SUB) 33470099
334800                                                                  33480099
334900            MOVE RV102-DEPT        (RV102-BLK-SUB RV102-ITEM-SUB) 33490099
335000                               TO  RVKM102-DEPT          (PS-SUB) 33500099
335100                                                                  33510099
335200            STRING RV102-MAJ-CLASS (RV102-BLK-SUB RV102-ITEM-SUB) 33520099
335300                    ' '                                           33530099
335400                   RV102-SUB-CLASS (RV102-BLK-SUB RV102-ITEM-SUB) 33540099
335500                    DELIMITED BY SIZE                             33550099
335600                             INTO  RVKM102-CLASS         (PS-SUB) 33560099
335700                                                                  33570099
335800            MOVE RV102-SKU         (RV102-BLK-SUB RV102-ITEM-SUB) 33580099
335900                               TO  RVKM102-SKU           (PS-SUB) 33590099
336000                                                                  33600099
336100            MOVE RV102-UPCX        (RV102-BLK-SUB RV102-ITEM-SUB) 33610099
336200                               TO  RVKM102-UPC           (PS-SUB) 33620099
336300                                                                  33630099
336400            MOVE RV102-STYLE       (RV102-BLK-SUB RV102-ITEM-SUB) 33640099
336500                               TO  RVKM102-STYLE         (PS-SUB) 33650099
336600                                                                  33660099
336700            MOVE RV102-DESC        (RV102-BLK-SUB RV102-ITEM-SUB) 33670099
336800                               TO  RVKM102-DESC          (PS-SUB) 33680099
336900                                                                  33690099
337000            MOVE RV102-URETAIL     (RV102-BLK-SUB RV102-ITEM-SUB) 33700099
337100                               TO  RVKM102-URETAIL       (PS-SUB) 33710099
337200         END-IF                                                   33720099
337300                                                                  33730099
337400*JPL - 2/2/04                                                     33740099
337500         IF (RV102-ORDER-STATUS = 'SHIPPED ' OR 'APPROVED'        33750099
337600                                             OR 'DEBT/DIS')       33760099
337700             MOVE DP015-PRO-BRT-MDT TO RVKM102-SELECTA (PS-SUB)   33770099
337800                                       RVKM102-URETAILA(PS-SUB)   33780099
337900             MOVE DP015-UNDERLINE   TO RVKM102-SELECTH (PS-SUB)   33790099
338000             MOVE DP015-BLUE        TO RVKM102-SELECTC (PS-SUB)   33800099
338100                                       RVKM102-URETAILC(PS-SUB)   33810099
338200         END-IF                                                   33820099
338300                                                                  33830099
338400     ELSE                                                         33840099
338500                                                                  33850099
338600         IF (PS-SEND-MAP-N-DATA-FRSET                             33860099
338700         OR  PS-DIFFERENT-ITEMS-DISPLAYED)                        33870099
338800             MOVE SPACES       TO  RVKM102-STATUS        (PS-SUB) 33880099
338900                                   RVKM102-ACTION        (PS-SUB) 33890099
339000                                   RVKM102-DEPT          (PS-SUB) 33900099
339100                                   RVKM102-CLASS         (PS-SUB) 33910099
339200                                   RVKM102-SKU           (PS-SUB) 33920099
339300                                   RVKM102-UPC           (PS-SUB) 33930099
339400                                   RVKM102-STYLE         (PS-SUB) 33940099
339500                                   RVKM102-DESC          (PS-SUB) 33950099
339600                                   RVKM102-URETAILX      (PS-SUB) 33960099
339700             MOVE DP015-ASK-DRK-OFF                               33970099
339800                               TO  RVKM102-SELECTA       (PS-SUB) 33980099
339900                                   RVKM102-URETAILA      (PS-SUB) 33990099
340000         END-IF                                                   34000099
340100                                                                  34010099
340200     END-IF.                                                      34020099
340300                                                                  34030099
340400     ADD +1 TO PV-ITEM-IN-USE.                                    34040099
340500     ADD +1 TO PS-SUB.                                            34050099
340600*----------------------------------------------------------------*34060099
340700*    FIND THE LAST SELECTION ENTRY IN THE MAP THAT IS NOT        *34070099
340800*    SPACES OR LOW VALUES AND POINT THE CURSOR TO THIS ENTRY.    *34080099
340900*    IF ALL ENTRIES ARE SPACES OR LOW VALUES, POINT THE CURSOR   *34090099
341000*    TO THE 1ST SELECTION ENTRY IN THE MAP.                      *34100099
341100*                                                                *34110099
341200*    PERFORMED BY I800-SET-CURSOR-POSITION.                      *34120099
341300*----------------------------------------------------------------*34130099
341400 J200-FIND-LAST-SELECTION.                                        34140099
341500     MOVE PC-ITEMS-PER-PANEL TO PS-SUB.                           34150099
341600                                                                  34160099
341700     SET PS-NO-SELECTION-FOUND TO TRUE.                           34170099
341800                                                                  34180099
341900     PERFORM                                                      34190099
342000         UNTIL (PS-SUB = +1                                       34200099
342100            OR  PS-SELECTION-FOUND)                               34210099
342200                                                                  34220099
342300         IF  RVKM102-SELECTI(PS-SUB) GREATER THAN SPACES          34230099
342400             SET PS-SELECTION-FOUND                               34240099
342500                               TO  TRUE                           34250099
342600         ELSE                                                     34260099
342700             SUBTRACT +1     FROM  PS-SUB                         34270099
342800         END-IF                                                   34280099
342900     END-PERFORM.                                                 34290099
343000                                                                  34300099
343100     IF  PS-NO-SELECTION-FOUND                                    34310099
343200         PERFORM                                                  34320099
343300             VARYING PS-SUB                                       34330099
343400             FROM 1 BY 1                                          34340099
343500             UNTIL PS-SUB EQUAL PC-ITEMS-PER-PANEL                34350099
343600              OR   RVKM102-ACTION (PS-SUB) NOT = PC-DEL           34360099
343700         END-PERFORM                                              34370099
343800                                                                  34380099
343900         IF (PS-SUB EQUAL PC-ITEMS-PER-PANEL                      34390099
344000         AND RVKM102-ACTION (PS-SUB) EQUAL PC-DEL)                34400099
344100             MOVE -1           TO  ANAVCMDL                       34410099
344200         ELSE                                                     34420099
344300             MOVE -1           TO  RVKM102-SELECTL(PS-SUB)        34430099
344400     ELSE                                                         34440099
344500         MOVE -1               TO  RVKM102-SELECTL(PS-SUB)        34450099
344600     END-IF.                                                      34460099
344700*----------------------------------------------------------------*34470099
344800*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *34480099
344900*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*34490099
345000*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *34500099
345100*                                                                *34510099
345200*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *34520099
345300*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *34530099
345400*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *34540099
345500*    US IN THE 2ND BLOCK OF THE ARRAY.                           *34550099
345600*                                                                *34560099
345700*    PERFORMED BY E100-EDIT-SELECTIONS.                          *34570099
345800*    PERFORMED BY F100-EDIT.                                     *34580099
345900*    PERFORMED BY F300-CHECK-SELECTIONS.                         *34590099
346000*    PERFORMED BY J100-PROCESS-ITEMS.                            *34600099
346100*----------------------------------------------------------------*34610099
346200 K100-SET-SUBSCRIPTS.                                             34620099
346300     COMPUTE PS-ITEM-SUB =                                        34630099
346400         (PV-ITEM-IN-USE - RV102-LIST-ITEM-NUMBER(1 1)) + 1.      34640099
346500                                                                  34650099
346600     MOVE PS-ITEM-SUB TO RV102-ITEM-SUB.                          34660099
346700                                                                  34670099
346800     IF RV102-ITEM-SUB > PC-ITEMS-PER-BLOCK                       34680099
346900         SUBTRACT PC-ITEMS-PER-BLOCK FROM RV102-ITEM-SUB          34690099
347000                                                                  34700099
347100         MOVE PC-MAX-BLOCKS-IN-ARRAY TO RV102-BLK-SUB             34710099
347200     ELSE                                                         34720099
347300         MOVE +1                     TO RV102-BLK-SUB             34730099
347400     END-IF.                                                      34740099
347500*----------------------------------------------------------------*34750099
347600*    OPEN THE TMESSAGE CURSOR.                                   *34760099
347700*                                                                *34770099
347800*    PERFORMED BY D100-SETUP-INITIAL-PANEL                       *34780099
347900*                 G400-READ-ITEMS-INTO-ARRAY.                    *34790099
348000*----------------------------------------------------------------*34800099
348100 L100-OPEN-CURSOR.                                                34810099
348200                                                                  34820099
348300     PERFORM                                                      34830099
348400         WITH TEST AFTER                                          34840099
348500         VARYING PV-SQL-SUB                                       34850099
348600         FROM 1 BY 1                                              34860099
348700         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             34870099
348800            OR SQLCODE = 0                                        34880099
348900            OR SQLCODE = +100                                     34890099
349000                                                                  34900099
349100         EXEC SQL                                                 34910099
349200              OPEN ITEM-NUMBER-CSR                                34920099
349300         END-EXEC                                                 34930099
349400                                                                  34940099
349500                                                                  34950099
349600         EVALUATE TRUE                                            34960099
349700             WHEN SQLCODE = ZERO                                  34970099
349800             WHEN SQLCODE = +100                                  34980099
349900             WHEN SQLCODE = -913                                  34990099
350000             WHEN SQLCODE = -911                                  35000099
350100                  CONTINUE                                        35010099
350200             WHEN SQLWARN0 NOT EQUAL SPACE                        35020099
350300             WHEN SQLCODE NOT EQUAL ZERO                          35030099
350400                  MOVE 'L100-OPEN-CURSOR'                         35040099
350500                               TO  DP013-PARAGRAPH                35050099
350600                  MOVE 'OPEN RTV CURSOR'                          35060099
350700                               TO  DP013-MESSAGE-TEXT (1)         35070099
350800                  MOVE SQLCA   TO  DP013-SQLCA                    35080099
350900                  SET DP013-DB2-ABEND                             35090099
351000                               TO  TRUE                           35100099
351100                  PERFORM DP013-0000-PROCESS-ABEND                35110099
351200         END-EVALUATE                                             35120099
351300     END-PERFORM.                                                 35130099
351400                                                                  35140099
351500     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   35150099
351600         MOVE 'L100-OPEN-CURSOR'                                  35160099
351700                               TO  DP013-PARAGRAPH                35170099
351800         MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'              35180099
351900                               TO  DP013-MESSAGE-TEXT (1)         35190099
352000         MOVE SQLCA            TO  DP013-SQLCA                    35200099
352100         SET DP013-DB2-ABEND   TO  TRUE                           35210099
352200         PERFORM DP013-0000-PROCESS-ABEND                         35220099
352300     END-IF.                                                      35230099
352400*----------------------------------------------------------------*35240099
352500*    OBTAIN THE NEXT ROW FOR THE APPROPRIATE CURSOR.             *35250099
352600*                                                                *35260099
352700*    PERFORMED BY H100                                           *35270099
352800*----------------------------------------------------------------*35280099
352900 L200-FETCH.                                                      35290099
353000     EXEC SQL                                                     35300099
353100          FETCH                                                   35310099
353200                ITEM-NUMBER-CSR                                   35320099
353300           INTO                                                   35330099
353400                :DFMEIT-DFCT-ITEM-NBR                             35340099
353500              , :DFMEIT-SEQ-NBR                                   35350099
353600              , :DFMEIT-MKOUT-ORD-STAT-CDE                        35360099
353700              , :DFMEIT-MKOUT-ORD-ID                              35370099
353800              , :DFMEIT-RTL-COST-AMT                              35380099
353900              , :DFMEIT-UNIT-COST-AMT                             35390099
354000              , :DFMEIT-MDSE-DEPT-NBR                             35400099
354100              , :DFMEIT-MDSE-CLASS-NBR                            35410099
354200              , :XLT00003-SKU-NBR                                 35420099
354300              , :XLT00006-UPC-NBR                                 35430099
354400              , :XLT00006-INTR-UPC-ID                             35440099
354500              , :XLT00003-SKU-DESC                                35450099
354600              , :XLT00004-VS-NBR                                  35460099
354700*                                                                 35470099
354800     END-EXEC.                                                    35480099
354900                                                                  35490099
355000     EVALUATE TRUE                                                35500099
355100         WHEN SQLCODE = ZERO                                      35510099
355200             IF (RV102-ORDER-TYPE = 'MARKOUT ' AND                35520099
355300                 RV102-ORDER-STATUS NOT = 'OPEN    ')             35530099
355400                 MOVE DFMEIT-MDSE-DEPT-NBR                        35540099
355500                                 TO PV-DEPT                       35550099
355600                 MOVE RV100-UK-RA-NUMBER                          35560099
355700                                 TO PV-LIST-NUMBER                35570099
355800                 MOVE DFMEIT-MKOUT-ORD-ID                         35580099
355900                                 TO PV-AUTH-NUMBER                35590099
356000                 MOVE PV-DEPT-LIST-AUTH                           35600099
356100                                 TO PV-DEPT-AREA-DEST             35610099
356200                 MOVE DFMEIT-MDSE-CLASS-NBR                       35620099
356300                                 TO PV-SUB-CLASS-DIGIT-3-4        35630099
356400                 MOVE PV-SUB-CLASS                                35640099
356500                                 TO PV-SPPCDT-CL-NBR              35650099
356600                 PERFORM L300-SELECT-IN-STORE-DTL                 35660099
356700             END-IF                                               35670099
356800         WHEN SQLCODE = +100                                      35680099
356900             SET RV102-NO-ITEMS-LEFT-ON-DB                        35690099
357000                                 TO TRUE                          35700099
357100         WHEN SQLWARN0 NOT EQUAL SPACE                            35710099
357200         WHEN SQLCODE NOT EQUAL ZERO                              35720099
357300             MOVE 'L200-FETCH-CURSOR'                             35730099
357400                                 TO DP013-PARAGRAPH               35740099
357500             MOVE 'FETCH ITEM CURSOR'                             35750099
357600                                 TO DP013-MESSAGE-TEXT (1)        35760099
357700             MOVE SQLCA          TO DP013-SQLCA                   35770099
357800             SET DP013-DB2-ABEND TO TRUE                          35780099
357900             PERFORM DP013-0000-PROCESS-ABEND                     35790099
358000     END-EVALUATE.                                                35800099
358100*----------------------------------------------------------------*35810099
358200*    FIND THE APPROPRITE PERM IN-STORE DETAIL LINE FOR THE       *35820099
358300*        LISTING LINE                                            *35830099
358400*----------------------------------------------------------------*35840099
358500 L300-SELECT-IN-STORE-DTL.                                        35850099
358600*                                                                 35860099
358700      MOVE DFMEIT-MDSE-DEPT-NBR   TO  PV-DEPT-NBR                 35870099
358800      MOVE PV-DEPT-NBR            TO  PV-SPPCDT-DEPT-NBR          35880099
358900*                                                                 35890099
359000     EXEC SQL                                                     35900099
359100         SELECT  A.STATUS_CDE                                     35910099
359200               , B.DOC_NBR                                        35920099
359300               , B.ROW_NBR                                        35930099
359400           INTO  :STRPPC-STATUS-CDE                               35940099
359500               , :SPPCDT-DOC-NBR                                  35950099
359600               , :SPPCDT-ROW-NBR                                  35960099
359700           FROM  TSTRPPC A                                        35970099
359800               , TSPPCDT B                                        35980099
360100           WHERE A.DEST_LOC_NBR = :PV-WORK-DC-NBR AND             36010099
360200                 A.DEST_LOC_NBR = B.DEST_LOC_NBR AND              36020099
360300                 A.DEPT_AREA_DEST = :PV-DEPT-AREA-DEST AND        36030099
360400                 A.DOC_NBR = B.DOC_NBR AND                        36040099
360500                 B.DEPT_NBR     = :PV-SPPCDT-DEPT-NBR AND         36050099
360600                 B.SUB_CL_NBR   = :PV-SPPCDT-CL-NBR AND           36060099
360700                 B.SKU_NBR      = :XLT00003-SKU-NBR AND           36070099
360800                 B.OLD_PR = :DFMEIT-RTL-COST-AMT AND              36080099
360900                 B.ITEM_NBR = :DFMEIT-DFCT-ITEM-NBR               36090099
361000     END-EXEC.                                                    36100099
361100                                                                  36110099
361200     EVALUATE TRUE                                                36120099
361300         WHEN SQLCODE = ZERO                                      36130099
361400              CONTINUE                                            36140099
361500         WHEN SQLCODE = +100                                      36150099
361600              SET PS-ERROR       TO TRUE                          36160099
361700              SET DP020-MSG-FATAL                                 36170099
361800                                 TO TRUE                          36180099
361900*----PC-TSYMSG-00146 - SELECTION NOT VALID FOR REQUESTED FUNCTION 36190099
362000              MOVE PC-TSYMSG-00146                                36200099
362100                                 TO DP020-MSG-NUMBER              36210099
362200         WHEN OTHER                                               36220099
362300              MOVE 'L300-SELECT-IN-STORE-DTL'                     36230099
362400                                 TO DP013-PARAGRAPH               36240099
362500              MOVE 'SELECT TSTRPPC/TSPPCDT IN-STORE DTL INFO'     36250099
362600                                 TO DP013-MESSAGE-TEXT (1)        36260099
362700              MOVE SQLCA         TO DP013-SQLCA                   36270099
362800              SET DP013-DB2-ABEND                                 36280099
362900                                 TO TRUE                          36290099
363000              PERFORM DP013-0000-PROCESS-ABEND                    36300099
363100     END-EVALUATE.                                                36310099
363200*----------------------------------------------------------------*36320099
363300*    HERE WE WRITE THE LIST TEMP STORAGE QUEUE AND PERFORM THE   *36330099
363400*    ACTUAL DELETE ROUTINE.                                      *36340099
363500*                                                                *36350099
363600*    PERFORMED BY D300                                           *36360099
363700*----------------------------------------------------------------*36370099
363800 O100-DELETE-ROUTINE.                                             36380099
363900     MOVE 1                    TO  RV102-BLK-SUB.                 36390099
364000     PERFORM Z150-WRITE-TEMP-STORAGE.                             36400099
364100     ADD 1                     TO  RV102-BLK-SUB.                 36410099
364200     PERFORM Z150-WRITE-TEMP-STORAGE.                             36420099
364300                                                                  36430099
364400     SET PS-NOT-DELETED        TO  TRUE.                          36440099
364500     PERFORM O200-DELETE-PRICES                                   36450099
364600             VARYING PV-ITEM                                      36460099
364700             FROM 1 BY 1                                          36470099
364800             UNTIL PV-ITEM GREATER RV102-HIGHEST-BLOCK-WRITTEN.   36480099
364900*----------------------------------------------------------------*36490099
365000*    HERE WE READ THE TEMP STORAGE QUEUE FOR THE LIST TO UPDATE  *36500099
365100*    THE DB2 TABLES.                                             *36510099
365200*                                                                *36520099
365300*    PERFORMED BY O100                                           *36530099
365400*----------------------------------------------------------------*36540099
365500 O200-DELETE-PRICES.                                              36550099
365600                                                                  36560099
365700     PERFORM X300-READ-TS-QUEUE.                                  36570099
365800     SET PS-DONT-WRITE-QUEUE   TO  TRUE.                          36580099
365900                                                                  36590099
366000     IF  PV-RESP EQUAL DFHRESP(NORMAL)                            36600099
366100         PERFORM                                                  36610099
366200         VARYING PV-TW-IDX                                        36620099
366300         FROM 1 BY 1                                              36630099
366400         UNTIL PV-TW-IDX GREATER THAN PC-ITEMS-PER-BLOCK          36640099
366500           OR PV-TW-LIST-ITEM-NUMBER (PV-TW-IDX) EQUAL ZERO       36650099
366600                                                                  36660099
366700             IF PV-TW-SELECT (PV-TW-IDX)                          36670099
366800                 MOVE PV-TW-SEQ-NUMBER (PV-TW-IDX)                36680099
366900                                 TO DFMEIT-SEQ-NBR                36690099
367000                 IF (RV102-ORDER-TYPE = 'MARKOUT ' AND            36700099
367100                     RV102-ORDER-STATUS NOT = 'OPEN    ')         36710099
367200                     MOVE PV-TW-PERM-DOC-NBR (PV-TW-IDX)          36720099
367300                                 TO SPPCDT-DOC-NBR                36730099
367400                     MOVE PV-TW-DEPT (PV-TW-IDX)                  36740099
367500                                 TO SPPCDT-DEPT-NBR               36750099
367600                     MOVE PV-TW-MAJ-CLASS (PV-TW-IDX)             36760099
367700                                 TO SPPCDT-MAJ-CL-NBR             36770099
367800                     MOVE PV-TW-SUB-CLASS (PV-TW-IDX)             36780099
367900                                 TO SPPCDT-SUB-CL-NBR             36790099
368000                     MOVE PV-TW-SKU (PV-TW-IDX)                   36800099
368100                                 TO SPPCDT-SKU-NBR                36810099
368200                     MOVE PV-TW-PERM-DTL-ROW-NBR (PV-TW-IDX)      36820099
368300                                 TO SPPCDT-ROW-NBR                36830099
368400                     PERFORM O400-SELECT-HDR-UPD-FIELDS           36840099
368500                     IF (STRPPC-STATUS-CDE =                      36850099
368600                         PE049-IS-COMPLETED-STATUS-CDE)           36860099
368700*----PC-TSYMSG-01502 - CANNOT UPDATE/DELETE - SKU IS ON A         36870099
368800*----                  COMPLETED PERMANENT PRICE CHANGE           36880099
368900                         MOVE PC-TSYMSG-01502                     36890099
369000                                 TO DP020-MSG-NUMBER              36900099
369100                         SET DP020-MSG-INFORMATIONAL              36910099
369200                                 TO TRUE                          36920099
369300                     ELSE                                         36930099
369400                         PERFORM O300-DELETE-TDFMEIT              36940099
369500                     END-IF                                       36950099
369600                 ELSE                                             36960099
369700                     PERFORM O300-DELETE-TDFMEIT                  36970099
369800                 END-IF                                           36980099
369900             END-IF                                               36990099
370000                                                                  37000099
370100         END-PERFORM                                              37010099
370200     END-IF.                                                      37020099
370300                                                                  37030099
370400     IF  PS-WRITE-QUEUE                                           37040099
370500         MOVE PV-ITEM          TO  PV-SAVE-ITEM                   37050099
370600         PERFORM X550-WRITE-TS-QUEUE                              37060099
370700     END-IF.                                                      37070099
370800                                                                  37080099
370900     PERFORM O250-CHECK-DETAIL.                                   37090099
371000*----------------------------------------------------------------*37100099
371100*    CHECK IF ANY MORE DETAIL ITEMS EXIST...IF SO, DELETE HEADER *37110099
371200*                                                                *37120099
371300*    PERFORMED BY O200                                           *37130099
371400*----------------------------------------------------------------*37140099
371500 O250-CHECK-DETAIL.                                               37150099
371600     EXEC SQL                                                     37160099
371700          SELECT                                                  37170099
371800                 DFCT_ORD_ID                                      37180099
371900          INTO                                                    37190099
372000                 :DFMEIT-DFCT-ORD-ID                              37200099
372100          FROM                                                    37210099
372200                 TDFMEIT                                          37220099
372300          WHERE                                                   37230099
372400                DFCT_ORD_ID      =  :RV100-UK-RA-NUMBER           37240099
372500     END-EXEC.                                                    37250099
372600                                                                  37260099
372700     EVALUATE TRUE                                                37270099
372800         WHEN SQLCODE = ZERO                                      37280099
372900         WHEN SQLCODE = -811                                      37290099
373000         WHEN SQLCODE = +100                                      37300099
373100             CONTINUE                                             37310099
373200         WHEN OTHER                                               37320099
373300             MOVE 'O250-CHECK-DETAIL  '                           37330099
373400                                 TO DP013-PARAGRAPH               37340099
373500             MOVE 'SELECT DETAIL ITEMS'                           37350099
373600                                 TO DP013-MESSAGE-TEXT (1)        37360099
373700             MOVE RV100-UK-RA-NUMBER                              37370099
373800                                 TO DP013-MESSAGE-TEXT (2)        37380099
373900             MOVE SQLCA          TO DP013-SQLCA                   37390099
374000             SET DP013-DB2-ABEND TO TRUE                          37400099
374100             PERFORM DP013-0000-PROCESS-ABEND                     37410099
374200     END-EVALUATE.                                                37420099
374300                                                                  37430099
374400     IF SQLCODE = +100                                            37440099
374500         PERFORM O270-SELECT-TDFCTOR                              37450099
374600         PERFORM O275-DELETE-TDFCTOR                              37460099
374700                                                                  37470099
374800         IF PV-DFCT-SHIPT-ID = 0                                  37480099
374900            CONTINUE                                              37490099
375000         ELSE                                                     37500099
375100            PERFORM O280-COUNT-TDFCTOR                            37510099
375200                                                                  37520099
375300            IF PV-TDFCTOR-COUNT = 0                               37530099
375400               PERFORM O290-DELETE-RVT-DFCT-SHIPT                 37540099
375500            END-IF                                                37550099
375600            SET PS-HEADER-DELETED TO TRUE                         37560099
375700         END-IF                                                   37570099
375800     END-IF.                                                      37580099
375900*----------------------------------------------------------------*37590099
376000*    SELECT THE TDFCTOR TO GET THE DFCT-SHIPT-ID                 *37600099
376100*                                                                *37610099
376200*----------------------------------------------------------------*37620099
376300 O270-SELECT-TDFCTOR.                                             37630099
376400     EXEC SQL                                                     37640099
376500          SELECT                                                  37650099
376600                 DFCT_SHIPT_ID                                    37660099
376700                                                                  37670099
376800            INTO                                                  37680099
376900                :PV-DFCT-SHIPT-ID  :PV-DFCT-SHIPT-ID-IND          37690099
377000                                                                  37700099
377100           FROM                                                   37710099
377200                TDFCTOR                                           37720099
377300          WHERE                                                   37730099
377400                DFCT_ORD_ID      =  :RV100-UK-RA-NUMBER           37740099
377500     END-EXEC.                                                    37750099
377600                                                                  37760099
377700     EVALUATE TRUE                                                37770099
377800         WHEN SQLCODE = ZERO                                      37780099
377900              IF PV-DFCT-SHIPT-ID-NULL                            37790099
378000                 MOVE 0 TO PV-DFCT-SHIPT-ID                       37800099
378100              END-IF                                              37810099
378200                                                                  37820099
378300         WHEN OTHER                                               37830099
378400             MOVE 'O270-SELECT-TDFCTOR'                           37840099
378500                                 TO DP013-PARAGRAPH               37850099
378600             MOVE 'SELECT HEADER TABLE'                           37860099
378700                                 TO DP013-MESSAGE-TEXT (1)        37870099
378800             MOVE RV100-UK-RA-NUMBER                              37880099
378900                                 TO DP013-MESSAGE-TEXT (2)        37890099
379000             MOVE SQLCA          TO DP013-SQLCA                   37900099
379100             SET DP013-DB2-ABEND TO TRUE                          37910099
379200             PERFORM DP013-0000-PROCESS-ABEND                     37920099
379300         END-EVALUATE.                                            37930099
379400                                                                  37940099
379500*----------------------------------------------------------------*37950099
379600*    DELETE THE HEADER ROW IF NO DETAIL REMAINS.                 *37960099
379700*                                                                *37970099
379800*    PERFORMED BY O250                                           *37980099
379900*----------------------------------------------------------------*37990099
380000 O275-DELETE-TDFCTOR.                                             38000099
380100     EXEC SQL                                                     38010099
380200          DELETE                                                  38020099
380300           FROM                                                   38030099
380400                TDFCTOR                                           38040099
380500          WHERE                                                   38050099
380600                DFCT_ORD_ID      =  :RV100-UK-RA-NUMBER           38060099
380700     END-EXEC.                                                    38070099
380800                                                                  38080099
380900     EVALUATE TRUE                                                38090099
381000         WHEN SQLCODE = ZERO                                      38100099
381100             CONTINUE                                             38110099
381200         WHEN OTHER                                               38120099
381300             MOVE 'O275-DELETE-TDFCTOR'                           38130099
381400                                 TO DP013-PARAGRAPH               38140099
381500             MOVE 'DELETE HEADER TABLE'                           38150099
381600                                 TO DP013-MESSAGE-TEXT (1)        38160099
381700             MOVE RV100-UK-RA-NUMBER                              38170099
381800                                 TO DP013-MESSAGE-TEXT (2)        38180099
381900             MOVE SQLCA          TO DP013-SQLCA                   38190099
382000             SET DP013-DB2-ABEND TO TRUE                          38200099
382100             PERFORM DP013-0000-PROCESS-ABEND                     38210099
382200         END-EVALUATE.                                            38220099
382300                                                                  38230099
382400******************************************************************38240099
382500*    IF THERE AREN'T ANY MORE TDFCTOR ROWS FOR THE DFCT-SHIPT-ID  38250099
382600*    THEN YOU CAN DELETE THE RVT-DFCT-STAT ROW (RVT00000).        38260099
382700*                                                                 38270099
382800*    NOTE: THE RVT-SHIPT-STAT (RVT00001) IS DELETED AUTOMATCALLY  38280099
382900*          BY DB2.                                                38290099
383000******************************************************************38300099
383100 O280-COUNT-TDFCTOR.                                              38310099
383200                                                                  38320099
383300     EXEC SQL                                                     38330099
383400          SELECT COUNT(*)                                         38340099
383500           INTO :PV-TDFCTOR-COUNT                                 38350099
383600           FROM TDFCTOR                                           38360099
383700          WHERE DFCT_SHIPT_ID = :PV-DFCT-SHIPT-ID                 38370099
383800     END-EXEC.                                                    38380099
383900                                                                  38390099
384000     EVALUATE TRUE                                                38400099
384100         WHEN SQLCODE = ZERO                                      38410099
384200              CONTINUE                                            38420099
384300                                                                  38430099
384400         WHEN OTHER                                               38440099
384500              MOVE 'O280-DELETE-RVT-DFCT-SHIPT'                   38450099
384600                                 TO DP013-PARAGRAPH               38460099
384700              MOVE 'DELETE RVT-DFCT-SHIPT'                        38470099
384800                                 TO DP013-MESSAGE-TEXT (1)        38480099
384900              MOVE SQLCA         TO DP013-SQLCA                   38490099
385000              SET DP013-DB2-ABEND                                 38500099
385100                                 TO TRUE                          38510099
385200              PERFORM DP013-0000-PROCESS-ABEND                    38520099
385300     END-EVALUATE.                                                38530099
385400                                                                  38540099
385500******************************************************************38550099
385600*    IF THERE AREN'T ANY MORE TDFCTOR ROWS FOR THE DFCT-SHIPT-ID  38560099
385700*    THEN YOU CAN DELETE THE RVT-DFCT-STAT ROW (RVT00000).        38570099
385800*                                                                 38580099
385900*    NOTE: THE RVT-SHIPT-STAT (RVT00001) IS DELETED AUTOMATCALLY  38590099
386000*          BY DB2.                                                38600099
386100******************************************************************38610099
386200 O290-DELETE-RVT-DFCT-SHIPT.                                      38620099
386300                                                                  38630099
386400     EXEC SQL                                                     38640099
386500          DELETE FROM RVT_DFCT_SHIPT                              38650099
386600          WHERE DFCT_SHIPT_ID = :PV-DFCT-SHIPT-ID                 38660099
386700     END-EXEC.                                                    38670099
386800                                                                  38680099
386900     EVALUATE TRUE                                                38690099
387000         WHEN SQLCODE = ZERO                                      38700099
387100              CONTINUE                                            38710099
387200         WHEN OTHER                                               38720099
387300              MOVE 'O290-DELETE-RVT-DFCT-SHIPT'                   38730099
387400                                 TO DP013-PARAGRAPH               38740099
387500              MOVE 'DELETE RVT-DFCT-SHIPT'                        38750099
387600                                 TO DP013-MESSAGE-TEXT (1)        38760099
387700              MOVE SQLCA         TO DP013-SQLCA                   38770099
387800              SET DP013-DB2-ABEND                                 38780099
387900                                 TO TRUE                          38790099
388000              PERFORM DP013-0000-PROCESS-ABEND                    38800099
388100     END-EVALUATE.                                                38810099
388200                                                                  38820099
388300*----------------------------------------------------------------*38830099
388400*    DELETE THE ROW SELECTED IN O200.                            *38840099
388500*                                                                *38850099
388600*    PERFORMED BY O200                                           *38860099
388700*----------------------------------------------------------------*38870099
388800 O300-DELETE-TDFMEIT.                                             38880099
388900     EXEC SQL                                                     38890099
389000          DELETE                                                  38900099
389100           FROM                                                   38910099
389200                TDFMEIT                                           38920099
389300          WHERE                                                   38930099
389400                DFCT_ORD_ID      =  :RV100-UK-RA-NUMBER           38940099
389500           AND  SEQ_NBR          =  :DFMEIT-SEQ-NBR               38950099
389600     END-EXEC.                                                    38960099
389700                                                                  38970099
389800     EVALUATE TRUE                                                38980099
389900         WHEN SQLCODE = ZERO                                      38990099
390000             IF (RV102-ORDER-TYPE = 'MARKOUT ' AND                39000099
390100                 RV102-ORDER-STATUS NOT = 'OPEN    ')             39010099
390200                 COMPUTE STRPPC-TOT-ACT-PR-CHG-AMT =              39020099
390300                     STRPPC-TOT-ACT-PR-CHG-AMT -                  39030099
390400                     SPPCDT-OLD-PR                                39040099
390500                 IF STRPPC-TOT-ACT-PR-CHG-AMT = ZERO              39050099
390600                     PERFORM O500-DELETE-PERM-DETAIL-LINE         39060099
390700                     PERFORM O600-UPDATE-CANCEL-TSTRPPC           39070099
390800*----PC-TSYMSG-01519 - ALL PERM DETAIL RECORDS WERE DELETED. THE  39080099
390900*----                  PERM DOCUMENT IS CANCELED.                 39090099
391000                     MOVE PC-TSYMSG-01519                         39100099
391100                                 TO DP020-MSG-NUMBER              39110099
391200                     SET DP020-MSG-WARNING                        39120099
391300                                 TO TRUE                          39130099
391400                 ELSE                                             39140099
391500                     IF SPPCDT-ACTL-PR-CHG-QTY = PC-ONE           39150099
391600                         PERFORM O500-DELETE-PERM-DETAIL-LINE     39160099
391700* CALCULATE STRPPC-PGS-TO-PRT-NBR BASED ON THE INSERTED LINE      39170099
391800                         PERFORM Q400-GET-TSPPCDT-COUNT           39180099
391900                         DIVIDE PV-TSPPCDT-COUNT BY PC-TEN        39190099
392000                             GIVING PV-PGS-TO-PRT-NBR             39200099
392100                             REMAINDER PV-REMAINDER               39210099
392200                         IF PV-REMAINDER IS NOT = ZERO            39220099
392300                             ADD PC-ONE                           39230099
392400                                 TO PV-PGS-TO-PRT-NBR             39240099
392500                         END-IF                                   39250099
392600                         MOVE PV-PGS-TO-PRT-NBR                   39260099
392700                                 TO STRPPC-PGS-TO-PRT-NBR         39270099
392800                     ELSE                                         39280099
392900                         SUBTRACT PC-ONE                          39290099
393000                                 FROM SPPCDT-ACTL-PR-CHG-QTY      39300099
393100                         SUBTRACT SPPCDT-OLD-PR                   39310099
393200                                 FROM SPPCDT-ACTL-PR-CHG-AMT      39320099
393300                         PERFORM Q300-UPDATE-PERM-UPDATE-LINE     39330099
393400                     END-IF                                       39340099
393500                     IF (STRPPC-STATUS-CDE =                      39350099
393600                         PE049-IS-CNTS-ENTER-STATUS-CDE)          39360099
393700                         MOVE SPACES                              39370099
393800                                 TO STRPPC-PR-CHG-CPL-NAME        39380099
393900                                    STRPPC-PREV-STATUS-CDE        39390099
394000                                    STRPPC-ENTR-ID                39400099
394100                         PERFORM Q100-UPD-TSTRPPC-RESET-STATUS    39410099
394200*----PC-TSYMSG-01503 - REAPPROVE PERM - SUCCESSFUL UPDATE/DELETE  39420099
394300*----                  CAUSED A DOC STATUS CHANGE                 39430099
394400                         MOVE PC-TSYMSG-01503                     39440099
394500                                 TO DP020-MSG-NUMBER              39450099
394600                         SET DP020-MSG-WARNING                    39460099
394700                                 TO TRUE                          39470099
394800                     ELSE                                         39480099
394900                         PERFORM Q200-UPDATE-TSTRPPC              39490099
395000*----PC-TSYMSG-00115 - DELETE SUCCESSFUL                          39500099
395100                         MOVE PC-TSYMSG-00115                     39510099
395200                                 TO DP020-MSG-NUMBER              39520099
395300                         SET DP020-MSG-INFORMATIONAL              39530099
395400                                 TO TRUE                          39540099
395500                     END-IF                                       39550099
395600                 END-IF                                           39560099
395700             ELSE                                                 39570099
395800*----PC-TSYMSG-00115 - DELETE SUCCESSFUL                          39580099
395900                 MOVE PC-TSYMSG-00115                             39590099
396000                                 TO DP020-MSG-NUMBER              39600099
396100                 SET DP020-MSG-INFORMATIONAL                      39610099
396200                                 TO TRUE                          39620099
396300             END-IF                                               39630099
396400                                                                  39640099
396500             MOVE DP015-BLUE     TO PV-TW-COLOR (PV-TW-IDX)       39650099
396600             MOVE DP015-HL-OFF   TO PV-TW-HILIGHT (PV-TW-IDX)     39660099
396700             MOVE DP015-ASK-NOR-OFF                               39670099
396800                                 TO PV-TW-ATTRIBUTE (PV-TW-IDX)   39680099
396900             MOVE PC-DEL         TO PV-TW-ACTION (PV-TW-IDX)      39690099
397000             SET PV-TW-DESELECT (PV-TW-IDX)                       39700099
397100                                 TO TRUE                          39710099
397200             SET PS-WRITE-QUEUE  TO TRUE                          39720099
397300             SET PS-DELETED      TO TRUE                          39730099
397400             SUBTRACT PC-ONE FROM                                 39740099
397500                         RV102-NUMBER-OF-SELECTED-ITEMS           39750099
397600             ADD PV-TW-UCOST(PV-TW-IDX)                           39760099
397700                                 TO RV102-COST-DIFFERENCE         39770099
397800             ADD PV-TW-URETAIL(PV-TW-IDX)                         39780099
397900                                 TO RV102-RETAIL-DIFFERENCE       39790099
398000             SUBTRACT RV102-RETAIL-DIFFERENCE                     39800099
398100                 FROM RV102-TOTAL-RETAIL                          39810099
398200             SUBTRACT RV102-COST-DIFFERENCE                       39820099
398300                 FROM RV102-TOTAL-COST                            39830099
398400             MOVE ZERO           TO RV102-COST-DIFFERENCE         39840099
398500                                    RV102-RETAIL-DIFFERENCE       39850099
398600         WHEN OTHER                                               39860099
398700             MOVE 'O300-DELETE-TDFMEIT'                           39870099
398800                                 TO DP013-PARAGRAPH               39880099
398900             MOVE 'DELETE ITEM TABLE'                             39890099
399000                                 TO DP013-MESSAGE-TEXT (1)        39900099
399100             MOVE SQLCA          TO DP013-SQLCA                   39910099
399200             SET DP013-DB2-ABEND TO TRUE                          39920099
399300             PERFORM DP013-0000-PROCESS-ABEND                     39930099
399400     END-EVALUATE.                                                39940099
399500*----------------------------------------------------------------*39950099
399600*    SELECT PERM HEADER UPDATED FIELDS                           *39960099
399700*----------------------------------------------------------------*39970099
399800 O400-SELECT-HDR-UPD-FIELDS.                                      39980099
399900     EXEC SQL                                                     39990099
400000          SELECT A.STATUS_CDE                                     40000099
400100               , A.TOT_ACT_PR_CHG_AMT                             40010099
400200               , A.PGS_TO_PRT_NBR                                 40020099
400300               , B.ACTL_PR_CHG_QTY                                40030099
400400               , B.OLD_PR                                         40040099
400500               , B.ACTL_PR_CHG_AMT                                40050099
400600          INTO :STRPPC-STATUS-CDE,                                40060099
400700               :STRPPC-TOT-ACT-PR-CHG-AMT,                        40070099
400800               :STRPPC-PGS-TO-PRT-NBR,                            40080099
400900               :SPPCDT-ACTL-PR-CHG-QTY,                           40090099
401000               :SPPCDT-OLD-PR,                                    40100099
401100               :SPPCDT-ACTL-PR-CHG-AMT                            40110099
401200          FROM TSTRPPC A                                          40120099
401300             , TSPPCDT B                                          40130099
401400          WHERE                                                   40140099
401700                A.DEST_LOC_NBR = :PV-WORK-DC-NBR AND              40170099
401800                A.DEST_LOC_NBR = B.DEST_LOC_NBR AND               40180099
401900                A.DOC_NBR = :SPPCDT-DOC-NBR AND                   40190099
402000                A.DOC_NBR = B.DOC_NBR AND                         40200099
402100                B.DEPT_NBR = :SPPCDT-DEPT-NBR AND                 40210099
402200                B.SUB_CL_NBR = :SPPCDT-SUB-CL-NBR AND             40220099
402300                B.SKU_NBR = :SPPCDT-SKU-NBR AND                   40230099
402400                B.ROW_NBR = :SPPCDT-ROW-NBR                       40240099
402500     END-EXEC.                                                    40250099
402600                                                                  40260099
402700     EVALUATE TRUE                                                40270099
402800         WHEN SQLCODE = ZERO                                      40280099
402900              CONTINUE                                            40290099
403000         WHEN OTHER                                               40300099
403100              MOVE 'O400-SELECT-HDR-UPD-FIELDS'                   40310099
403200                                 TO DP013-PARAGRAPH               40320099
403300              MOVE 'SELECT HEADER UPDATE FIELDS'                  40330099
403400                                 TO DP013-MESSAGE-TEXT (1)        40340099
403500              MOVE SQLCA         TO DP013-SQLCA                   40350099
403600              SET DP013-DB2-ABEND                                 40360099
403700                                 TO TRUE                          40370099
403800              PERFORM DP013-0000-PROCESS-ABEND                    40380099
403900     END-EVALUATE.                                                40390099
404000*----------------------------------------------------------------*40400099
404100*    DELETE PERM DETAIL LINE                                     *40410099
404200*----------------------------------------------------------------*40420099
404300 O500-DELETE-PERM-DETAIL-LINE.                                    40430099
404400     EXEC SQL                                                     40440099
404500          DELETE FROM TSPPCDT                                     40450099
404600          WHERE                                                   40460099
404800                DEST_LOC_NBR = :PV-WORK-DC-NBR AND                40480099
404900                DOC_NBR = :SPPCDT-DOC-NBR AND                     40490099
405000                DEPT_NBR = :SPPCDT-DEPT-NBR AND                   40500099
405100                SUB_CL_NBR = :SPPCDT-SUB-CL-NBR AND               40510099
405200                SKU_NBR = :SPPCDT-SKU-NBR AND                     40520099
405300                ROW_NBR = :SPPCDT-ROW-NBR                         40530099
405400     END-EXEC.                                                    40540099
405500                                                                  40550099
405600     EVALUATE TRUE                                                40560099
405700         WHEN SQLCODE = ZERO                                      40570099
405800              CONTINUE                                            40580099
405900         WHEN OTHER                                               40590099
406000              MOVE 'O500-DELETE-PERM-DETAIL-LINE'                 40600099
406100                                 TO DP013-PARAGRAPH               40610099
406200              MOVE 'DELETE PERM DETAIL LINE'                      40620099
406300                                 TO DP013-MESSAGE-TEXT (1)        40630099
406400              MOVE SQLCA         TO DP013-SQLCA                   40640099
406500              SET DP013-DB2-ABEND                                 40650099
406600                                 TO TRUE                          40660099
406700              PERFORM DP013-0000-PROCESS-ABEND                    40670099
406800     END-EVALUATE.                                                40680099
406900*----------------------------------------------------------------*40690099
407000*    UPDATE (CANCEL) PERM HEADER                                 *40700099
407100*----------------------------------------------------------------*40710099
407200 O600-UPDATE-CANCEL-TSTRPPC.                                      40720099
407300     EXEC SQL                                                     40730099
407400          UPDATE TSTRPPC                                          40740099
407500          SET STATUS_CDE = :PE049-IS-CANCELLED-STATUS-CDE         40750099
407600            , PREV_STATUS_CDE = STATUS_CDE                        40760099
407700            , CAN_DTE = CURRENT DATE                              40770099
407800            , CAN_ID = :DP020-USERID                              40780099
407900            , TOT_ACT_PR_CHG_AMT = 0                              40790099
408000          WHERE                                                   40800099
408200                DEST_LOC_NBR = :PV-WORK-DC-NBR AND                40820099
408300                DOC_NBR = :SPPCDT-DOC-NBR                         40830099
408400     END-EXEC.                                                    40840099
408500                                                                  40850099
408600     EVALUATE TRUE                                                40860099
408700         WHEN SQLCODE = ZERO                                      40870099
408800             CONTINUE                                             40880099
408900         WHEN OTHER                                               40890099
409000             MOVE 'O600-UPDATE-CANCEL-TSTRPPC'                    40900099
409100                                 TO DP013-PARAGRAPH               40910099
409200             MOVE 'UPDATE (CANCEL) PERM HEADER(S) - TSTRPPC'      40920099
409300                                 TO DP013-MESSAGE-TEXT (1)        40930099
409400             MOVE SQLCA          TO DP013-SQLCA                   40940099
409500             SET DP013-DB2-ABEND TO TRUE                          40950099
409600             PERFORM DP013-0000-PROCESS-ABEND                     40960099
409700     END-EVALUATE.                                                40970099
409800*----------------------------------------------------------------*40980099
409900*    HERE WE WRITE THE LIST TEMP STORAGE QUEUE AND PERFORM THE   *40990099
410000*    ACTUAL UPDATE ROUTINE.                                      *41000099
410100*                                                                *41010099
410200*    PERFORMED BY D300                                           *41020099
410300*----------------------------------------------------------------*41030099
410400 P100-UPDATE-ROUTINE.                                             41040099
410500     MOVE 1                    TO  RV102-BLK-SUB.                 41050099
410600     PERFORM Z150-WRITE-TEMP-STORAGE.                             41060099
410700     ADD 1                     TO  RV102-BLK-SUB.                 41070099
410800     PERFORM Z150-WRITE-TEMP-STORAGE.                             41080099
410900                                                                  41090099
411000     SET PS-NOT-UPDATED        TO  TRUE.                          41100099
411100     PERFORM P200-UPDATE-PRICES                                   41110099
411200             VARYING PV-ITEM                                      41120099
411300             FROM 1 BY 1                                          41130099
411400             UNTIL PV-ITEM GREATER RV102-HIGHEST-BLOCK-WRITTEN.   41140099
411500*----------------------------------------------------------------*41150099
411600*    HERE WE READ THE TEMP STORAGE QUEUE FOR THE LIST TO UPDATE  *41160099
411700*    THE DB2 TABLES.                                             *41170099
411800*                                                                *41180099
411900*    PERFORMED BY P100                                           *41190099
412000*----------------------------------------------------------------*41200099
412100 P200-UPDATE-PRICES.                                              41210099
412200                                                                  41220099
412300     PERFORM X300-READ-TS-QUEUE.                                  41230099
412400     SET PS-DONT-WRITE-QUEUE   TO  TRUE.                          41240099
412500                                                                  41250099
412600     IF  PV-RESP EQUAL DFHRESP(NORMAL)                            41260099
412700         PERFORM                                                  41270099
412800         VARYING PV-TW-IDX                                        41280099
412900         FROM 1 BY 1                                              41290099
413000         UNTIL PV-TW-IDX GREATER THAN PC-ITEMS-PER-BLOCK          41300099
413100           OR  PV-TW-LIST-ITEM-NUMBER (PV-TW-IDX) EQUAL ZERO      41310099
413200                                                                  41320099
413300               IF (PV-TW-URETAIL-CHG (PV-TW-IDX)                  41330099
413400               OR  PV-TW-SELECT (PV-TW-IDX))                      41340099
413500                   MOVE PV-TW-URETAIL (PV-TW-IDX)                 41350099
413600                               TO  DFMEIT-RTL-COST-AMT            41360099
413700                   MOVE PV-TW-SEQ-NUMBER (PV-TW-IDX)              41370099
413800                               TO  DFMEIT-SEQ-NBR                 41380099
413900                   IF (RV102-ORDER-TYPE = 'MARKOUT ' AND          41390099
414000                       RV102-ORDER-STATUS NOT = 'OPEN    ')       41400099
414100                       MOVE PV-TW-PERM-DOC-NBR (PV-TW-IDX)        41410099
414200                                 TO SPPCDT-DOC-NBR                41420099
414300                       MOVE PV-TW-DEPT (PV-TW-IDX)                41430099
414400                                 TO SPPCDT-DEPT-NBR               41440099
414500                       MOVE PV-TW-MAJ-CLASS (PV-TW-IDX)           41450099
414600                                 TO SPPCDT-MAJ-CL-NBR             41460099
414700                       MOVE PV-TW-SUB-CLASS (PV-TW-IDX)           41470099
414800                                 TO SPPCDT-SUB-CL-NBR             41480099
414900                       MOVE PV-TW-SKU (PV-TW-IDX)                 41490099
415000                                 TO SPPCDT-SKU-NBR                41500099
415100                       MOVE PV-TW-PERM-DTL-ROW-NBR (PV-TW-IDX)    41510099
415200                                 TO SPPCDT-ROW-NBR                41520099
415300                       MOVE PV-TW-DFCT-ITEM-NBR (PV-TW-IDX)       41530099
415400                                 TO PV-SPPCDT-ITEM-NBR            41540099
415500                       PERFORM P400-SELECT-HDR-DTL-UPD-FIELDS     41550099
415600                       IF (STRPPC-STATUS-CDE =                    41560099
415700                           PE049-IS-COMPLETED-STATUS-CDE)         41570099
415800                           IF (DFMEIT-RTL-COST-AMT NOT =          41580099
415900                               SPPCDT-OLD-PR)                     41590099
416000*----PC-TSYMSG-01502 - CANNOT UPDATE/DELETE - SKU IS ON A         41600099
416100*----                  COMPLETED PERMANENT PRICE CHANGE           41610099
416200                               MOVE PC-TSYMSG-01502               41620099
416300                                 TO DP020-MSG-NUMBER              41630099
416400                               SET DP020-MSG-INFORMATIONAL        41640099
416500                                 TO TRUE                          41650099
416600                           ELSE                                   41660099
416700                               PERFORM P300-UPDATE-TDFMEIT        41670099
416800                           END-IF                                 41680099
416900                       ELSE                                       41690099
417000                           PERFORM P300-UPDATE-TDFMEIT            41700099
417100                       END-IF                                     41710099
417200                   ELSE                                           41720099
417300                       PERFORM P300-UPDATE-TDFMEIT                41730099
417400                   END-IF                                         41740099
417500               END-IF                                             41750099
417600                                                                  41760099
417700         END-PERFORM                                              41770099
417800     END-IF.                                                      41780099
417900                                                                  41790099
418000     IF  PS-WRITE-QUEUE                                           41800099
418100         MOVE PV-ITEM          TO  PV-SAVE-ITEM                   41810099
418200         PERFORM X550-WRITE-TS-QUEUE                              41820099
418300     END-IF.                                                      41830099
418400*----------------------------------------------------------------*41840099
418500*    UPDATE THE RETAIL COST AMOUNT AND THE ITEM STATUS CODE.     *41850099
418600*                                                                *41860099
418700*    PERFORMED BY P200                                           *41870099
418800*----------------------------------------------------------------*41880099
418900 P300-UPDATE-TDFMEIT.                                             41890099
419000     EXEC SQL                                                     41900099
419100          UPDATE                                                  41910099
419200                TDFMEIT                                           41920099
419300          SET                                                     41930099
419400                RTL_COST_AMT     =  :DFMEIT-RTL-COST-AMT          41940099
419500          WHERE                                                   41950099
419600                DFCT_ORD_ID      =  :RV100-UK-RA-NUMBER           41960099
419700           AND  SEQ_NBR          =  :DFMEIT-SEQ-NBR               41970099
419800     END-EXEC.                                                    41980099
419900                                                                  41990099
420000     EVALUATE TRUE                                                42000099
420100         WHEN SQLCODE = ZERO                                      42010099
420200             IF (RV102-ORDER-TYPE = 'MARKOUT ' AND                42020099
420300                 RV102-ORDER-STATUS NOT = 'OPEN    ')             42030099
420400* ONLY PROCESS AN IN-STORE IF THE RETAIL PRICE HAS CHANGED        42040099
420500                 IF DFMEIT-RTL-COST-AMT NOT = SPPCDT-OLD-PR       42050099
420600* CALCULATE STRPPC-TOT-ACT-PR-CHG-AMT BEFORE SPPCDT-OLD-PR IS     42060099
420700*  UPDATED WITH THE NEW (DFMEIT-RTL-COST-AMT) PRICE               42070099
420800                     COMPUTE STRPPC-TOT-ACT-PR-CHG-AMT =          42080099
420900                         STRPPC-TOT-ACT-PR-CHG-AMT -              42090099
421000                         (SPPCDT-OLD-PR - DFMEIT-RTL-COST-AMT)    42100099
421100                     IF SPPCDT-ACTL-PR-CHG-QTY = PC-ONE           42110099
421200* SELECT "OLD PRICE" PERM DETAIL FOR POSSIBLE LINE UPDATE         42120099
421300                         PERFORM P500-SELECT-PERM-UPDATE-LINE     42130099
421400                         IF SQLCODE = ZERO                        42140099
421500                             PERFORM P600-DEL-PREV-PERM-DTL-LINE  42150099
421600                             ADD PC-ONE                           42160099
421700                                 TO SPPCDT-ACTL-PR-CHG-QTY        42170099
421800                             ADD DFMEIT-RTL-COST-AMT              42180099
421900                                 TO SPPCDT-ACTL-PR-CHG-AMT        42190099
422000                             PERFORM Q300-UPDATE-PERM-UPDATE-LINE 42200099
422100                             MOVE SPPCDT-ROW-NBR                  42210099
422200                                 TO PV-TW-PERM-DTL-ROW-NBR        42220099
422300                                    (PV-TW-IDX)                   42230099
422400* CALCULATE STRPPC-PGS-TO-PRT-NBR BASED ON THE DELETED LINE       42240099
422500                             PERFORM Q400-GET-TSPPCDT-COUNT       42250099
422600                             DIVIDE PV-TSPPCDT-COUNT BY PC-TEN    42260099
422700                             GIVING PV-PGS-TO-PRT-NBR             42270099
422800                             REMAINDER PV-REMAINDER               42280099
422900                             IF PV-REMAINDER IS NOT = ZERO        42290099
423000                                 ADD PC-ONE                       42300099
423100                                 TO PV-PGS-TO-PRT-NBR             42310099
423200                             END-IF                               42320099
423300                             MOVE PV-PGS-TO-PRT-NBR               42330099
423400                                 TO STRPPC-PGS-TO-PRT-NBR         42340099
423500                         ELSE                                     42350099
423600                             MOVE DFMEIT-RTL-COST-AMT             42360099
423700                                 TO SPPCDT-OLD-PR                 42370099
423800                                    SPPCDT-ACTL-PR-CHG-AMT        42380099
423900                             PERFORM P700-UPDATE-TSPPCDT          42390099
424000                         END-IF                                   42400099
424100                     ELSE                                         42410099
424200                         SUBTRACT PC-ONE                          42420099
424300                                 FROM SPPCDT-ACTL-PR-CHG-QTY      42430099
424400                         SUBTRACT SPPCDT-OLD-PR                   42440099
424500                                 FROM SPPCDT-ACTL-PR-CHG-AMT      42450099
424600                         PERFORM P700-UPDATE-TSPPCDT              42460099
424700* SELECT "OLD PRICE" PERM DETAIL FOR POSSIBLE LINE UPDATE         42470099
424800                         PERFORM P500-SELECT-PERM-UPDATE-LINE     42480099
424900                         IF SQLCODE = ZERO                        42490099
425000                             ADD PC-ONE                           42500099
425100                                 TO SPPCDT-ACTL-PR-CHG-QTY        42510099
425200                             ADD DFMEIT-RTL-COST-AMT              42520099
425300                                 TO SPPCDT-ACTL-PR-CHG-AMT        42530099
425400                             PERFORM Q300-UPDATE-PERM-UPDATE-LINE 42540099
425500                             MOVE SPPCDT-ROW-NBR                  42550099
425600                                 TO PV-TW-PERM-DTL-ROW-NBR        42560099
425700                                    (PV-TW-IDX)                   42570099
425800                         ELSE                                     42580099
426100                             MOVE RV102-STR-NBR                   42610099
426200                                 TO SPPCDT-DEST-LOC-NBR           42620099
426300* SPPCDT-DOC-NBR, SPPCDT-DEPT-NBR, SPPCDT-CL-NBR, SPPCDT-SEQ-NBR  42630099
426400*   ARE SET ABOVE                                                 42640099
426500* SPPCDT-ROW-NBR IS SET IN P800-SEL-MAX-TSPPCDT-ROW-NBR           42650099
426600                             PERFORM P800-SEL-MAX-TSPPCDT-ROW-NBR 42660099
426700                             MOVE PC-ONE                          42670099
426800                                 TO SPPCDT-ACTL-PR-CHG-QTY        42680099
426900                             MOVE DFMEIT-RTL-COST-AMT             42690099
427000                                 TO SPPCDT-OLD-PR                 42700099
427100                             MOVE ZEROS                           42710099
427200                                 TO SPPCDT-NEW-PR                 42720099
427300                             MOVE DFMEIT-RTL-COST-AMT             42730099
427400                                 TO SPPCDT-ACTL-PR-CHG-AMT        42740099
427500* SPPCDT-UPC-NBR, SPPCDT-ITEM-NBR, SPPCDT-INV-DKEY RETURNED IN    42750099
427600*   PERFORM P400-SELECT-HDR-DTL-UPD-FIELDS                        42760099
427700                             PERFORM P900-INSERT-TSPPCDT-ROW      42770099
427800                             MOVE SPPCDT-ROW-NBR                  42780099
427900                                 TO PV-TW-PERM-DTL-ROW-NBR        42790099
428000                                    (PV-TW-IDX)                   42800099
428100* CALCULATE STRPPC-PGS-TO-PRT-NBR BASED ON THE INSERTED LINE      42810099
428200                             PERFORM Q400-GET-TSPPCDT-COUNT       42820099
428300                             DIVIDE PV-TSPPCDT-COUNT BY PC-TEN    42830099
428400                                GIVING PV-PGS-TO-PRT-NBR          42840099
428500                                REMAINDER PV-REMAINDER            42850099
428600                             IF PV-REMAINDER IS NOT = ZERO        42860099
428700                                 ADD PC-ONE                       42870099
428800                                 TO PV-PGS-TO-PRT-NBR             42880099
428900                             END-IF                               42890099
429000                             MOVE PV-PGS-TO-PRT-NBR               42900099
429100                                 TO STRPPC-PGS-TO-PRT-NBR         42910099
429200                         END-IF                                   42920099
429300                     END-IF                                       42930099
429400                     IF (STRPPC-STATUS-CDE =                      42940099
429500                         PE049-IS-CNTS-ENTER-STATUS-CDE)          42950099
429600                         MOVE SPACES                              42960099
429700                                 TO STRPPC-PR-CHG-CPL-NAME        42970099
429800                                    STRPPC-PREV-STATUS-CDE        42980099
429900                                    STRPPC-ENTR-ID                42990099
430000                         PERFORM Q100-UPD-TSTRPPC-RESET-STATUS    43000099
430100*----PC-TSYMSG-01503 - REAPPROVE PERM - SUCCESSFUL UPDATE/DELETE  43010099
430200*----                  CAUSED A DOC STATUS CHANGE                 43020099
430300                         MOVE PC-TSYMSG-01503                     43030099
430400                                 TO DP020-MSG-NUMBER              43040099
430500                         SET DP020-MSG-WARNING                    43050099
430600                                 TO TRUE                          43060099
430700                     ELSE                                         43070099
430800                         PERFORM Q200-UPDATE-TSTRPPC              43080099
430900*----PC-TSYMSG-00059 - UPDATE(S) SUCCESSFUL                       43090099
431000                         MOVE PC-TSYMSG-00059                     43100099
431100                                 TO DP020-MSG-NUMBER              43110099
431200                         SET DP020-MSG-INFORMATIONAL              43120099
431300                                 TO TRUE                          43130099
431400                     END-IF                                       43140099
431500                 ELSE                                             43150099
431600* ASSUME UNIT_COST_AMT HAS BEEN SUCCESSFULLY UPDATED              43160099
431700* DO NOT FLAG UNIT_COST_AMT ONLY UPDATES                          43170099
431800*----PC-TSYMSG-00059 - UPDATE(S) SUCCESSFUL                       43180099
431900                     MOVE PC-TSYMSG-00059                         43190099
432000                                 TO DP020-MSG-NUMBER              43200099
432100                     SET DP020-MSG-INFORMATIONAL                  43210099
432200                                 TO TRUE                          43220099
432300                 END-IF                                           43230099
432400             ELSE                                                 43240099
432500*----PC-TSYMSG-00059 - UPDATE(S) SUCCESSFUL                       43250099
432600                 MOVE PC-TSYMSG-00059                             43260099
432700                                 TO DP020-MSG-NUMBER              43270099
432800                 SET DP020-MSG-INFORMATIONAL                      43280099
432900                                 TO TRUE                          43290099
433000             END-IF                                               43300099
433100                                                                  43310099
433200             MOVE PC-UPD         TO PV-TW-ACTION (PV-TW-IDX)      43320099
433300             SET PV-TW-URETAIL-RST (PV-TW-IDX)                    43330099
433400                                 TO TRUE                          43340099
433500             SET PS-WRITE-QUEUE  TO TRUE                          43350099
433600             SET PS-UPDATED      TO TRUE                          43360099
433700             SUBTRACT RV102-RETAIL-DIFFERENCE                     43370099
433800                 FROM RV102-TOTAL-RETAIL                          43380099
433900             MOVE ZERO           TO RV102-RETAIL-DIFFERENCE       43390099
434000         WHEN OTHER                                               43400099
434100             MOVE 'P300-UPDATE-TDFMEIT'                           43410099
434200                                 TO DP013-PARAGRAPH               43420099
434300             MOVE 'UPDATE ITEM TABLE'                             43430099
434400                                 TO DP013-MESSAGE-TEXT (1)        43440099
434500             MOVE SQLCA          TO DP013-SQLCA                   43450099
434600             SET DP013-DB2-ABEND TO TRUE                          43460099
434700             PERFORM DP013-0000-PROCESS-ABEND                     43470099
434800     END-EVALUATE.                                                43480099
434900*----------------------------------------------------------------*43490099
435000*    SELECT PERM HEADER/DETAIL UPDATED FIELDS                    *43500099
435100*----------------------------------------------------------------*43510099
435200 P400-SELECT-HDR-DTL-UPD-FIELDS.                                  43520099
435300     EXEC SQL                                                     43530099
435400          SELECT A.STATUS_CDE                                     43540099
435500               , A.TOT_ACT_PR_CHG_AMT                             43550099
435600               , A.PGS_TO_PRT_NBR                                 43560099
435700               , B.ACTL_PR_CHG_QTY                                43570099
435800               , B.OLD_PR                                         43580099
435900               , B.ACTL_PR_CHG_AMT                                43590099
436000               , B.UPC_NBR                                        43600099
436100               , B.ITEM_NBR                                       43610099
436200               , B.INV_DKEY                                       43620099
436300          INTO :STRPPC-STATUS-CDE,                                43630099
436400               :STRPPC-TOT-ACT-PR-CHG-AMT,                        43640099
436500               :STRPPC-PGS-TO-PRT-NBR,                            43650099
436600               :SPPCDT-ACTL-PR-CHG-QTY,                           43660099
436700               :SPPCDT-OLD-PR,                                    43670099
436800               :SPPCDT-ACTL-PR-CHG-AMT,                           43680099
436900               :SPPCDT-UPC-NBR,                                   43690099
437000               :SPPCDT-ITEM-NBR,                                  43700099
437100               :SPPCDT-INV-DKEY                                   43710099
437200          FROM TSTRPPC A                                          43720099
437300             , TSPPCDT B                                          43730099
437400          WHERE                                                   43740099
437700                A.DEST_LOC_NBR = :PV-WORK-DC-NBR AND              43770099
437800                A.DEST_LOC_NBR = B.DEST_LOC_NBR AND               43780099
437900                A.DOC_NBR = :SPPCDT-DOC-NBR AND                   43790099
438000                A.DOC_NBR = B.DOC_NBR AND                         43800099
438100                B.DEPT_NBR = :SPPCDT-DEPT-NBR AND                 43810099
438200                B.SUB_CL_NBR = :SPPCDT-SUB-CL-NBR AND             43820099
438300                B.SKU_NBR = :SPPCDT-SKU-NBR AND                   43830099
438400                B.ROW_NBR = :SPPCDT-ROW-NBR                       43840099
438500     END-EXEC.                                                    43850099
438600                                                                  43860099
438700     EVALUATE TRUE                                                43870099
438800         WHEN SQLCODE = ZERO                                      43880099
438900              CONTINUE                                            43890099
439000         WHEN OTHER                                               43900099
439100              MOVE 'P400-SELECT-HDR-DTL-UPD-FIELDS'               43910099
439200                                 TO DP013-PARAGRAPH               43920099
439300              MOVE 'SELECT HEADER/DETAIL UPDATE FIELDS'           43930099
439400                                 TO DP013-MESSAGE-TEXT (1)        43940099
439500              MOVE SQLCA         TO DP013-SQLCA                   43950099
439600              SET DP013-DB2-ABEND                                 43960099
439700                                 TO TRUE                          43970099
439800              PERFORM DP013-0000-PROCESS-ABEND                    43980099
439900     END-EVALUATE.                                                43990099
440000*----------------------------------------------------------------*44000099
440100*    SELECT "OLD PRICE" PERM DETAIL FOR POSSIBLE LINE UPDATE     *44010099
440200*----------------------------------------------------------------*44020099
440300 P500-SELECT-PERM-UPDATE-LINE.                                    44030099
440400     EXEC SQL                                                     44040099
440500          SELECT ROW_NBR                                          44050099
440600               , ACTL_PR_CHG_QTY                                  44060099
440700               , ACTL_PR_CHG_AMT                                  44070099
440800          INTO :SPPCDT-ROW-NBR,                                   44080099
440900               :SPPCDT-ACTL-PR-CHG-QTY,                           44090099
441000               :SPPCDT-ACTL-PR-CHG-AMT                            44100099
441100          FROM TSPPCDT                                            44110099
441200          WHERE                                                   44120099
441400                DEST_LOC_NBR = :PV-WORK-DC-NBR AND                44140099
441500                DOC_NBR = :SPPCDT-DOC-NBR AND                     44150099
441600                DEPT_NBR = :SPPCDT-DEPT-NBR AND                   44160099
441700                SUB_CL_NBR = :SPPCDT-SUB-CL-NBR AND               44170099
441800                SKU_NBR = :SPPCDT-SKU-NBR AND                     44180099
441900                OLD_PR = :DFMEIT-RTL-COST-AMT AND                 44190099
442000                ITEM_NBR = :PV-SPPCDT-ITEM-NBR                    44200099
442100     END-EXEC.                                                    44210099
442200                                                                  44220099
442300     EVALUATE TRUE                                                44230099
442400* +100 IS VALID HERE, RETURN FROM THIS PARAGRAPH PROCESSES BASED  44240099
442500*  ON RETURNED SQLCODE                                            44250099
442600         WHEN SQLCODE = ZERO                                      44260099
442700         WHEN SQLCODE = +100                                      44270099
442800              CONTINUE                                            44280099
442900         WHEN OTHER                                               44290099
443000              MOVE 'P500-SELECT-PERM-LINE-UPDATE'                 44300099
443100                                 TO DP013-PARAGRAPH               44310099
443200              MOVE 'SELECT TSPPCDT PERM UPDATE LINE'              44320099
443300                                 TO DP013-MESSAGE-TEXT (1)        44330099
443400              MOVE SQLCA         TO DP013-SQLCA                   44340099
443500              SET DP013-DB2-ABEND                                 44350099
443600                                 TO TRUE                          44360099
443700              PERFORM DP013-0000-PROCESS-ABEND                    44370099
443800     END-EVALUATE.                                                44380099
443900*----------------------------------------------------------------*44390099
444000*    DELETE PREVIOUS PERM DETAIL LINE                            *44400099
444100*----------------------------------------------------------------*44410099
444200 P600-DEL-PREV-PERM-DTL-LINE.                                     44420099
444300     EXEC SQL                                                     44430099
444400          DELETE FROM TSPPCDT                                     44440099
444500          WHERE                                                   44450099
444700                DEST_LOC_NBR = :PV-WORK-DC-NBR AND                44470099
444800                DOC_NBR = :SPPCDT-DOC-NBR AND                     44480099
444900                DEPT_NBR = :SPPCDT-DEPT-NBR AND                   44490099
445000                SUB_CL_NBR = :SPPCDT-SUB-CL-NBR AND               44500099
445100                SKU_NBR = :SPPCDT-SKU-NBR AND                     44510099
445200                OLD_PR = :SPPCDT-OLD-PR AND                       44520099
445300                ITEM_NBR = :PV-SPPCDT-ITEM-NBR                    44530099
445400     END-EXEC.                                                    44540099
445500                                                                  44550099
445600     EVALUATE TRUE                                                44560099
445700         WHEN SQLCODE = ZERO                                      44570099
445800              CONTINUE                                            44580099
445900         WHEN OTHER                                               44590099
446000              MOVE 'P600-DEL-PREV-PERM-DTL-LINE'                  44600099
446100                                 TO DP013-PARAGRAPH               44610099
446200              MOVE 'DELETE PERM DETAIL LINE'                      44620099
446300                                 TO DP013-MESSAGE-TEXT (1)        44630099
446400              MOVE SQLCA         TO DP013-SQLCA                   44640099
446500              SET DP013-DB2-ABEND                                 44650099
446600                                 TO TRUE                          44660099
446700              PERFORM DP013-0000-PROCESS-ABEND                    44670099
446800     END-EVALUATE.                                                44680099
446900*----------------------------------------------------------------*44690099
447000*    UPDATE PERM DETAIL TABLE                                    *44700099
447100*----------------------------------------------------------------*44710099
447200 P700-UPDATE-TSPPCDT.                                             44720099
447300     EXEC SQL                                                     44730099
447400          UPDATE TSPPCDT                                          44740099
447500          SET ACTL_PR_CHG_QTY = :SPPCDT-ACTL-PR-CHG-QTY           44750099
447600            , OLD_PR = :SPPCDT-OLD-PR                             44760099
447700            , ACTL_PR_CHG_AMT = :SPPCDT-ACTL-PR-CHG-AMT           44770099
447800          WHERE                                                   44780099
448000                DEST_LOC_NBR = :PV-WORK-DC-NBR AND                44800099
448100                DOC_NBR = :SPPCDT-DOC-NBR AND                     44810099
448200                DEPT_NBR = :SPPCDT-DEPT-NBR AND                   44820099
448300                SUB_CL_NBR = :SPPCDT-SUB-CL-NBR AND               44830099
448400                SKU_NBR = :SPPCDT-SKU-NBR AND                     44840099
448500                ROW_NBR = :SPPCDT-ROW-NBR                         44850099
448600     END-EXEC.                                                    44860099
448700                                                                  44870099
448800     EVALUATE TRUE                                                44880099
448900         WHEN SQLCODE = ZERO                                      44890099
449000              CONTINUE                                            44900099
449100         WHEN OTHER                                               44910099
449200              MOVE 'P700-UPDATE-TSPPCDT'                          44920099
449300                                 TO DP013-PARAGRAPH               44930099
449400              MOVE 'UPDATE TSPPCDT PRICE/QUANTITY'                44940099
449500                                 TO DP013-MESSAGE-TEXT (1)        44950099
449600              MOVE SQLCA         TO DP013-SQLCA                   44960099
449700              SET DP013-DB2-ABEND                                 44970099
449800                                 TO TRUE                          44980099
449900              PERFORM DP013-0000-PROCESS-ABEND                    44990099
450000     END-EVALUATE.                                                45000099
450100*----------------------------------------------------------------*45010099
450200* SELECT THE MAXIMUM ROW NUMBER + 1, FROM THE PERM DETAIL TABLE  *45020099
450300*----------------------------------------------------------------*45030099
450400 P800-SEL-MAX-TSPPCDT-ROW-NBR.                                    45040099
450500     EXEC SQL                                                     45050099
450600         SELECT  MAX(ROW_NBR) + 1                                 45060099
450700         INTO  :SPPCDT-ROW-NBR                                    45070099
450800         FROM  TSPPCDT                                            45080099
451000         WHERE DEST_LOC_NBR = :PV-WORK-DC-NBR AND                 45100099
451100               DOC_NBR = :SPPCDT-DOC-NBR                          45110099
451200     END-EXEC.                                                    45120099
451300                                                                  45130099
451400     EVALUATE TRUE                                                45140099
451500         WHEN SQLCODE = 0                                         45150099
451600             CONTINUE                                             45160099
451700         WHEN OTHER                                               45170099
451800             MOVE 'P800-SEL-MAX-TSPPCDT-ROW-NBR'                  45180099
451900                                 TO DP013-PARAGRAPH               45190099
452000             MOVE 'SELECT MAXIMUM TSPPCDT ROW NUMBER'             45200099
452100                                 TO DP013-MESSAGE-TEXT (1)        45210099
452200             MOVE SQLCA          TO DP013-SQLCA                   45220099
452300             SET DP013-DB2-ABEND                                  45230099
452400                                 TO TRUE                          45240099
452500             PERFORM DP013-0000-PROCESS-ABEND                     45250099
452600     END-EVALUATE.                                                45260099
452700*----------------------------------------------------------------*45270099
452800*  INSERT THE IN-STORE DETAIL ROW                                *45280099
452900*----------------------------------------------------------------*45290099
453000 P900-INSERT-TSPPCDT-ROW.                                         45300099
453100     EXEC SQL                                                     45310099
453200        INSERT INTO TSPPCDT                                       45320099
453400               (DEST_LOC_NBR                                      45340099
453500             ,  DOC_NBR                                           45350099
453600             ,  SKU_NBR                                           45360099
453700             ,  ROW_NBR                                           45370099
453800             ,  ACTL_PR_CHG_QTY                                   45380099
453900             ,  OLD_PR                                            45390099
454000             ,  NEW_PR                                            45400099
454100             ,  ACTL_PR_CHG_AMT                                   45410099
454200             ,  UPC_NBR                                           45420099
454300             ,  ITEM_NBR                                          45430099
454400             ,  INV_DKEY                                          45440099
454500             ,  DEPT_NBR                                          45450099
454600             ,  MAJ_CL_NBR                                        45460099
454700             ,  SUB_CL_NBR )                                      45470099
454900        VALUES (:SPPCDT-DEST-LOC-NBR                              45490099
455000             ,  :SPPCDT-DOC-NBR                                   45500099
455100             ,  :SPPCDT-SKU-NBR                                   45510099
455200             ,  :SPPCDT-ROW-NBR                                   45520099
455300             ,  :SPPCDT-ACTL-PR-CHG-QTY                           45530099
455400             ,  :SPPCDT-OLD-PR                                    45540099
455500             ,  :SPPCDT-NEW-PR                                    45550099
455600             ,  :SPPCDT-ACTL-PR-CHG-AMT                           45560099
455700             ,  :SPPCDT-UPC-NBR                                   45570099
455800             ,  :SPPCDT-ITEM-NBR                                  45580099
455900             ,  :SPPCDT-INV-DKEY                                  45590099
456000             ,  :SPPCDT-DEPT-NBR                                  45600099
456100             ,  :SPPCDT-MAJ-CL-NBR                                45610099
456200             ,  :SPPCDT-SUB-CL-NBR)                               45620099
456300     END-EXEC.                                                    45630099
456400                                                                  45640099
456500     EVALUATE TRUE                                                45650099
456600         WHEN SQLCODE = 0                                         45660099
456700             CONTINUE                                             45670099
456800         WHEN OTHER                                               45680099
456900             MOVE 'P900-INSERT-TSPPCDT-ROW'                       45690099
457000                                 TO DP013-PARAGRAPH               45700099
457100             MOVE 'INSERT TSPPCDT ROW'                            45710099
457200                                 TO DP013-MESSAGE-TEXT (1)        45720099
457300             MOVE SQLCA          TO DP013-SQLCA                   45730099
457400             SET DP013-DB2-ABEND TO TRUE                          45740099
457500             PERFORM DP013-0000-PROCESS-ABEND                     45750099
457600     END-EVALUATE.                                                45760099
457700*----------------------------------------------------------------*45770099
457800*    UPDATE PERM HEADER TABLE - RESET STATUS                     *45780099
457900*                                                                *45790099
458000*    THIS SQL WAS CHANGED TO UPDATE THE STATUS TO A 'CE' INSTEAD.*45800099
458100*    SET PR_CHG_CPL_NAME, EFF_DTE, ENTR_DTE, ENTR_TIME, AND      *45810099
458200*    ENTR_ID TO CURRENT DATE, TIME AND USER ID VALUES.  THIS     *45820099
458300*    CHANGE WAS MADE AS PART OF THE AUTO-APPROVAL PROCESS FOR    *45830099
458400*    THE IN-STORE PERM SYSTEM RECORDS.                           *45840099
458500*                          -- DAN HINTZ WR#24785 03/17/2003      *45850099
458600*----------------------------------------------------------------*45860099
458700 Q100-UPD-TSTRPPC-RESET-STATUS.                                   45870099
458800     EXEC SQL                                                     45880099
458900          UPDATE TSTRPPC                                          45890099
459000          SET EFF_DTE = CURRENT DATE                              45900099
459100            , PR_CHG_CPL_NAME = :DP020-USERID                     45910099
459200            , STATUS_CDE = :PE049-IS-CNTS-ENTER-STATUS-CDE        45920099
459300            , PREV_STATUS_CDE = :STRPPC-PREV-STATUS-CDE           45930099
459400            , ENTR_DTE = CURRENT DATE                             45940099
459500            , ENTR_TIME = CURRENT TIME                            45950099
459600            , ENTR_ID = :DP020-USERID                             45960099
459700            , TOT_ACT_PR_CHG_AMT = :STRPPC-TOT-ACT-PR-CHG-AMT     45970099
459800            , PGS_TO_PRT_NBR = :STRPPC-PGS-TO-PRT-NBR             45980099
459900          WHERE                                                   45990099
460100                DEST_LOC_NBR = :PV-WORK-DC-NBR AND                46010099
460200                DOC_NBR = :SPPCDT-DOC-NBR                         46020099
460300     END-EXEC.                                                    46030099
460400                                                                  46040099
460500     EVALUATE TRUE                                                46050099
460600         WHEN SQLCODE = ZERO                                      46060099
460700              CONTINUE                                            46070099
460800         WHEN OTHER                                               46080099
460900              MOVE 'Q100-UPD-TSTRPPC-RESET-STATUS'                46090099
461000                                 TO DP013-PARAGRAPH               46100099
461100              MOVE 'UPDATE TSTRPPC - RESET STATUS'                46110099
461200                                 TO DP013-MESSAGE-TEXT (1)        46120099
461300              MOVE SQLCA         TO DP013-SQLCA                   46130099
461400              SET DP013-DB2-ABEND                                 46140099
461500                                 TO TRUE                          46150099
461600              PERFORM DP013-0000-PROCESS-ABEND                    46160099
461700     END-EVALUATE.                                                46170099
461800*----------------------------------------------------------------*46180099
461900*    UPDATE PERM HEADER TABLE                                    *46190099
462000*----------------------------------------------------------------*46200099
462100 Q200-UPDATE-TSTRPPC.                                             46210099
462200     EXEC SQL                                                     46220099
462300          UPDATE TSTRPPC                                          46230099
462400          SET TOT_ACT_PR_CHG_AMT = :STRPPC-TOT-ACT-PR-CHG-AMT     46240099
462500            , PGS_TO_PRT_NBR = :STRPPC-PGS-TO-PRT-NBR             46250099
462600          WHERE                                                   46260099
462800                DEST_LOC_NBR = :PV-WORK-DC-NBR AND                46280099
462900                DOC_NBR = :SPPCDT-DOC-NBR                         46290099
463000     END-EXEC.                                                    46300099
463100                                                                  46310099
463200     EVALUATE TRUE                                                46320099
463300         WHEN SQLCODE = ZERO                                      46330099
463400              CONTINUE                                            46340099
463500         WHEN OTHER                                               46350099
463600              MOVE 'Q200-UPDATE-TSTRPPC'                          46360099
463700                                 TO DP013-PARAGRAPH               46370099
463800              MOVE 'UPDATE TSTRPPC TOTAL ACTUAL PRICE CHANGE'     46380099
463900                                 TO DP013-MESSAGE-TEXT (1)        46390099
464000              MOVE SQLCA         TO DP013-SQLCA                   46400099
464100              SET DP013-DB2-ABEND                                 46410099
464200                                 TO TRUE                          46420099
464300              PERFORM DP013-0000-PROCESS-ABEND                    46430099
464400     END-EVALUATE.                                                46440099
464500*----------------------------------------------------------------*46450099
464600*    UPDATE PERM DETAIL TABLE - PERM UPDATE LINE                 *46460099
464700*----------------------------------------------------------------*46470099
464800 Q300-UPDATE-PERM-UPDATE-LINE.                                    46480099
464900     EXEC SQL                                                     46490099
465000          UPDATE TSPPCDT                                          46500099
465100          SET ACTL_PR_CHG_QTY = :SPPCDT-ACTL-PR-CHG-QTY           46510099
465200            , ACTL_PR_CHG_AMT = :SPPCDT-ACTL-PR-CHG-AMT           46520099
465300          WHERE                                                   46530099
465500                DEST_LOC_NBR = :PV-WORK-DC-NBR AND                46550099
465600                DOC_NBR = :SPPCDT-DOC-NBR AND                     46560099
465700                DEPT_NBR = :SPPCDT-DEPT-NBR AND                   46570099
465800                SUB_CL_NBR = :SPPCDT-SUB-CL-NBR AND               46580099
465900                SKU_NBR = :SPPCDT-SKU-NBR AND                     46590099
466000                ROW_NBR = :SPPCDT-ROW-NBR                         46600099
466100     END-EXEC.                                                    46610099
466200                                                                  46620099
466300     EVALUATE TRUE                                                46630099
466400         WHEN SQLCODE = ZERO                                      46640099
466500              CONTINUE                                            46650099
466600         WHEN OTHER                                               46660099
466700              MOVE 'Q300-UPDATE-PERM-UPDATE-LINE'                 46670099
466800                                 TO DP013-PARAGRAPH               46680099
466900              MOVE 'UPDATE TSPPCDT PRICE/QUANTITY, NOT OLD PRICE' 46690099
467000                                 TO DP013-MESSAGE-TEXT (1)        46700099
467100              MOVE SQLCA         TO DP013-SQLCA                   46710099
467200              SET DP013-DB2-ABEND                                 46720099
467300                                 TO TRUE                          46730099
467400              PERFORM DP013-0000-PROCESS-ABEND                    46740099
467500     END-EVALUATE.                                                46750099
467600*----------------------------------------------------------------*46760099
467700* GET IN-STORE PERM DETAIL LINE COUNT                            *46770099
467800*----------------------------------------------------------------*46780099
467900 Q400-GET-TSPPCDT-COUNT.                                          46790099
468000     EXEC SQL                                                     46800099
468100          SELECT COUNT (*)                                        46810099
468200          INTO  :PV-TSPPCDT-COUNT                                 46820099
468300          FROM  TSPPCDT                                           46830099
468500          WHERE DEST_LOC_NBR = :PV-WORK-DC-NBR AND                46850099
468600                DOC_NBR = :SPPCDT-DOC-NBR                         46860099
468700     END-EXEC.                                                    46870099
468800                                                                  46880099
468900     EVALUATE TRUE                                                46890099
469000         WHEN SQLCODE = 0                                         46900099
469100             CONTINUE                                             46910099
469200         WHEN OTHER                                               46920099
469300             MOVE 'Q400-GET-TSPPCDT-COUNT'                        46930099
469400                                 TO DP013-PARAGRAPH               46940099
469500             MOVE 'COUNT TSPPCDT ROWS'                            46950099
469600                                 TO DP013-MESSAGE-TEXT (1)        46960099
469700             MOVE SQLCA          TO DP013-SQLCA                   46970099
469800             SET DP013-DB2-ABEND TO TRUE                          46980099
469900             PERFORM DP013-0000-PROCESS-ABEND                     46990099
470000     END-EVALUATE.                                                47000099
470100*----------------------------------------------------------------*47010099
470200*    PREPARE THE TEMPORARY STORAGE QUEUE "B".  MOVE ALL SELECTED *47020099
470300*    ITEMS FROM TEMP STORAGE QUEUE "A" (SCROLL QUEUE) TO THE     *47030099
470400*    SELECTED ITEM LAYOUT FOR QUEUE "B".                         *47040099
470500*                                                                *47050099
470600*    FIRST, PREPARE QUEUE "B" NAME, THEN DELETE THE QUEUE, NEXT  *47060099
470700*    LOAD THE QUEUE "B" RECORD.  WRITE A QUEUE "B" RECORD WHEN   *47070099
470800*    THE MAXIMUM ENTRIES ARE FULL.                               *47080099
470900*                                                                *47090099
471000*    PERFORMED BY D300                                           *47100099
471100*----------------------------------------------------------------*47110099
471200 X100-PREPARE-LIST-QUEUE.                                         47120099
471300                                                                  47130099
471400     MOVE +1                   TO  RV102-BLK-SUB.                 47140099
471500     PERFORM Z150-WRITE-TEMP-STORAGE.                             47150099
471600     ADD +1                    TO  RV102-BLK-SUB.                 47160099
471700     PERFORM Z150-WRITE-TEMP-STORAGE.                             47170099
471800                                                                  47180099
471900     MOVE RV102-TERM-ID        TO  PV-BG-TERM-ID.                 47190099
472000     MOVE RV102-TASK-NUMBER    TO  PV-BG-TASK-NUMBER.             47200099
472100     MOVE 1                    TO  PV-BG-SEQUENCE.                47210099
472200                                                                  47220099
472300     MOVE PV-BG-QUEUE-NAME     TO  RV102-HOLD-TSQB-QUEUE-NAME     47230099
472400                                   RV100-TSQB-QUEUE-NAME.         47240099
472500     MOVE LENGTH OF RV103-RA-REQUEST-RECORD                       47250099
472600                               TO  RV100-TSQB-QUEUE-LENGTH        47260099
472700                                   RV102-TSQB-QUEUE-LENGTH.       47270099
472800     PERFORM X900-DELETE-LIST-QUEUE.                              47280099
472900                                                                  47290099
473000     SET RV102-UPDATE-TSQ      TO  TRUE.                          47300099
473100                                                                  47310099
473200     SET RV103-IDX             TO  1.                             47320099
473300     INITIALIZE RV103-RA-REQUEST-RECORD.                          47330099
473400                                                                  47340099
473500     PERFORM X200-PROCESS-TS-QUEUE                                47350099
473600             VARYING PV-ITEM                                      47360099
473700             FROM 1 BY 1                                          47370099
473800             UNTIL PV-ITEM GREATER RV102-HIGHEST-BLOCK-WRITTEN.   47380099
473900                                                                  47390099
474000     PERFORM X500-WRITE-LIST-QUEUE.                               47400099
474100*----------------------------------------------------------------*47410099
474200*    READ A TS QUEUE RECORD, MOVE SELECTED RECORDS TO THE        *47420099
474300*    APPLICATIONS SYSTEM LIST QUEUE RECORD.                      *47430099
474400*                                                                *47440099
474500*    PERFORMED BY X100                                           *47450099
474600*----------------------------------------------------------------*47460099
474700 X200-PROCESS-TS-QUEUE.                                           47470099
474800                                                                  47480099
474900     PERFORM X300-READ-TS-QUEUE.                                  47490099
475000                                                                  47500099
475100     IF  PV-RESP EQUAL DFHRESP(NORMAL)                            47510099
475200         PERFORM                                                  47520099
475300         VARYING PV-TW-IDX                                        47530099
475400         FROM 1 BY 1                                              47540099
475500         UNTIL PV-TW-IDX GREATER THAN PC-ITEMS-PER-BLOCK          47550099
475600           OR  PV-TW-LIST-ITEM-NUMBER (PV-TW-IDX) EQUAL ZERO      47560099
475700                                                                  47570099
475800             IF  PV-TW-SELECT (PV-TW-IDX)                         47580099
475900                 MOVE PV-TW-LIST-ITEM-NUMBER (PV-TW-IDX)          47590099
476000                               TO  RV103-ITEM (RV103-IDX)         47600099
476100                                                                  47610099
476200                 MOVE PV-TW-LIST-ITEM-NUMBER (PV-TW-IDX)          47620099
476300                               TO  RV103-ITEM-NUMBER              47630099
476400                                        (RV103-IDX)               47640099
476500                                                                  47650099
476600                 SET RV103-IDX UP BY 1                            47660099
476700                 IF  RV103-IDX GREATER PC-MAX-WR-ITEMS            47670099
476800                     PERFORM X500-WRITE-LIST-QUEUE                47680099
476900                 END-IF                                           47690099
477000             END-IF                                               47700099
477100                                                                  47710099
477200         END-PERFORM                                              47720099
477300     END-IF.                                                      47730099
477400*----------------------------------------------------------------*47740099
477500*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*47750099
477600*                                                                *47760099
477700*    PERFORMED BY C500, P200, O200, X200                         *47770099
477800*----------------------------------------------------------------*47780099
477900 X300-READ-TS-QUEUE.                                              47790099
478000     EXEC CICS                                                    47800099
478100         READQ TS                                                 47810099
478200         QUEUE(RV102-TEMP-QUEUE-NAME)                             47820099
478300         INTO(PV-TEMP-WORK-AREA)                                  47830099
478400         LENGTH(PC-BLOCK-LENGTH)                                  47840099
478500         ITEM(PV-ITEM)                                            47850099
478600         RESP(PV-RESP)                                            47860099
478700     END-EXEC.                                                    47870099
478800*----------------------------------------------------------------*47880099
478900*    WRITE THE STORE SELECTION RECORD (QUEUE "B").               *47890099
479000*                                                                *47900099
479100*    PERFORMED BY X100                                           *47910099
479200*----------------------------------------------------------------*47920099
479300 X500-WRITE-LIST-QUEUE.                                           47930099
479400                                                                  47940099
479500     IF  RV103-IDX GREATER THAN 1                                 47950099
479600         MOVE PC-MAX-WR-ITEMS  TO  RV103-RA-MAX-ITEMS             47960099
479700         MOVE RV102-NUMBER-OF-SELECTED-ITEMS                      47970099
479800                               TO  RV103-RA-SELECTED-ITEMS        47980099
479900         MOVE RV100-UK-RA-NUMBER                                  47990099
480000                               TO  RV103-RA-NUMBER                48000099
480100                                                                  48010099
480200         EXEC CICS                                                48020099
480300              WRITEQ TS                                           48030099
480400              QUEUE(RV102-HOLD-TSQB-QUEUE-NAME)                   48040099
480500              FROM(RV103-RA-REQUEST-RECORD)                       48050099
480600              LENGTH(RV102-TSQB-QUEUE-LENGTH)                     48060099
480700              ITEM(PV-TSQ-B-ITEM)                                 48070099
480800              RESP(PV-RESP)                                       48080099
480900         END-EXEC                                                 48090099
481000                                                                  48100099
481100         IF  PV-RESP NOT EQUAL DFHRESP(NORMAL)                    48110099
481200             SET PS-DONT-PROCESS                                  48120099
481300                               TO  TRUE                           48130099
481400         END-IF                                                   48140099
481500                                                                  48150099
481600         INITIALIZE RV103-RA-REQUEST-RECORD                       48160099
481700         SET RV103-IDX         TO  1                              48170099
481800     END-IF.                                                      48180099
481900*----------------------------------------------------------------*48190099
482000*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *48200099
482100*                                                                *48210099
482200*    PERFORMED BY C500, C600, P200, O200                         *48220099
482300*----------------------------------------------------------------*48230099
482400 X550-WRITE-TS-QUEUE.                                             48240099
482500     EXEC CICS                                                    48250099
482600         WRITEQ TS                                                48260099
482700         REWRITE                                                  48270099
482800         QUEUE(RV102-TEMP-QUEUE-NAME)                             48280099
482900         FROM(PV-TEMP-WORK-AREA)                                  48290099
483000         LENGTH(PC-BLOCK-LENGTH)                                  48300099
483100         ITEM(PV-SAVE-ITEM)                                       48310099
483200         RESP(PV-RESP)                                            48320099
483300     END-EXEC.                                                    48330099
483400*----------------------------------------------------------------*48340099
483500*    READ THE LIST QUEUE RECORD.                                 *48350099
483600*                                                                *48360099
483700*    PERFORMED BY C500                                           *48370099
483800*----------------------------------------------------------------*48380099
483900 X600-READ-LIST-QUEUE.                                            48390099
484000     EXEC CICS                                                    48400099
484100          READQ TS                                                48410099
484200          QUEUE(RV102-HOLD-TSQB-QUEUE-NAME)                       48420099
484300          INTO(RV103-RA-REQUEST-RECORD)                           48430099
484400          LENGTH(RV102-TSQB-QUEUE-LENGTH)                         48440099
484500          ITEM(PV-TSQ-B-ITEM)                                     48450099
484600          RESP(PV-RESP)                                           48460099
484700     END-EXEC.                                                    48470099
484800*----------------------------------------------------------------*48480099
484900*    DELETE THE STORE SELECTION STORAGE QUEUE ("B").             *48490099
485000*                                                                *48500099
485100*    PERFORMED BY X100                                           *48510099
485200*----------------------------------------------------------------*48520099
485300 X900-DELETE-LIST-QUEUE.                                          48530099
485400     EXEC CICS                                                    48540099
485500          DELETEQ TS                                              48550099
485600          QUEUE(RV102-HOLD-TSQB-QUEUE-NAME)                       48560099
485700          RESP(PV-RESP)                                           48570099
485800     END-EXEC.                                                    48580099
485900*----------------------------------------------------------------*48590099
486000*    DELETE THE TEMPORARY STORAGE QUEUE.                         *48600099
486100*                                                                *48610099
486200*    PERFORMED BY C300-PROCESS-PANEL.                            *48620099
486300*----------------------------------------------------------------*48630099
486400 Z050-DELETE-TEMP-STORAGE.                                        48640099
486500     EXEC CICS                                                    48650099
486600         DELETEQ TS                                               48660099
486700         QUEUE(RV102-TEMP-QUEUE-NAME)                             48670099
486800         RESP(PV-RESP)                                            48680099
486900     END-EXEC.                                                    48690099
487000                                                                  48700099
487100     IF (PV-RESP NOT = DFHRESP(NORMAL)) AND                       48710099
487200        (PV-RESP NOT = DFHRESP(QIDERR))                           48720099
487300         MOVE PV-RESP TO PM-RESP-23                               48730099
487400                                                                  48740099
487500         SET DP013-LOGIC-ABEND TO TRUE                            48750099
487600         SET DP013-NO-ROLLBACK TO TRUE                            48760099
487700                                                                  48770099
487800         MOVE 'Z050-DELETE-TEMP-STORAGE' TO DP013-PARAGRAPH       48780099
487900         MOVE PM-PROGRAM-MESSAGE-23      TO DP013-MESSAGE-TEXT(1) 48790099
488000                                                                  48800099
488100         PERFORM DP013-0000-PROCESS-ABEND                         48810099
488200     END-IF.                                                      48820099
488300                                                                  48830099
488400     MOVE +0 TO RV102-HIGHEST-BLOCK-WRITTEN.                      48840099
488500*----------------------------------------------------------------*48850099
488600*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *48860099
488700*                                                                *48870099
488800*    PERFORMED BY D400-REFRESH-BLOCK-ARRAY.                      *48880099
488900*    PERFORMED BY E700-DESELECT-ALL-ITEMS.                       *48890099
489000*    PERFORMED BY F200-MARK-RANGE-AS-SELECTED.                   *48900099
489100*    PERFORMED BY G500-SCROLL-FORWARD.                           *48910099
489200*    PERFORMED BY G600-SCROLL-BACKWARD.                          *48920099
489300*    PERFORMED BY G700-GET-TOP-ITEMS-BLOCK.                      *48930099
489400*    PERFORMED BY G800-GET-LAST-BLOCK-IN-TEMP.                   *48940099
489500*----------------------------------------------------------------*48950099
489600 Z100-READ-TEMP-STORAGE.                                          48960099
489700     EXEC CICS                                                    48970099
489800         READQ TS                                                 48980099
489900         QUEUE(RV102-TEMP-QUEUE-NAME)                             48990099
490000         INTO(RV102-BLOCK-ENTRIES(RV102-BLK-SUB))                 49000099
490100         LENGTH(PC-BLOCK-LENGTH)                                  49010099
490200         ITEM(PV-BLOCK-NUMBER)                                    49020099
490300         RESP(PV-RESP)                                            49030099
490400     END-EXEC.                                                    49040099
490500                                                                  49050099
490600     IF PV-RESP NOT = DFHRESP(NORMAL)                             49060099
490700         MOVE PV-RESP          TO  PM-RESP-24                     49070099
490800         EXEC CICS                                                49080099
490900              DELETEQ TS                                          49090099
491000              QUEUE(RV102-TEMP-QUEUE-NAME)                        49100099
491100              RESP(PV-RESP)                                       49110099
491200         END-EXEC                                                 49120099
491300         SET DP013-LOGIC-ABEND TO  TRUE                           49130099
491400         SET DP013-NO-ROLLBACK TO  TRUE                           49140099
491500         MOVE 'Z100-READ-TEMP-STORAGE'                            49150099
491600                               TO  DP013-PARAGRAPH                49160099
491700         MOVE PM-PROGRAM-MESSAGE-24                               49170099
491800                               TO  DP013-MESSAGE-TEXT(1)          49180099
491900         PERFORM DP013-0000-PROCESS-ABEND                         49190099
492000     END-IF.                                                      49200099
492100                                                                  49210099
492200     SET RV102-BLOCK-NOT-MODIFIED(RV102-BLK-SUB) TO TRUE.         49220099
492300*----------------------------------------------------------------*49230099
492400*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *49240099
492500*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *49250099
492600*                                                                *49260099
492700*    PERFORMED BY E300-NAVIGATE.                                 *49270099
492800*    PERFORMED BY E700-DESELECT-ALL-ITEMS.                       *49280099
492900*    PERFORMED BY F200-MARK-RANGE-AS-SELECTED.                   *49290099
493000*    PERFORMED BY G500-SCROLL-FORWARD.                           *49300099
493100*    PERFORMED BY G600-SCROLL-BACKWARD.                          *49310099
493200*    PERFORMED BY G700-GET-TOP-ITEMS-BLOCK.                      *49320099
493300*    PERFORMED BY G800-GET-LAST-BLOCK-IN-TEMP.                   *49330099
493400*    PERFORMED BY H100-READ-ITEMS-FROM-DB.                       *49340099
493500*----------------------------------------------------------------*49350099
493600 Z150-WRITE-TEMP-STORAGE.                                         49360099
493700     IF RV102-HIGHEST-BLOCK-WRITTEN = +0                          49370099
493800         MOVE EIBTASKN         TO  DP020-SRC-TASK-NUMBER          49380099
493900         MOVE EIBTASKN         TO  RV102-TASK-NUMBER              49390099
494000         MOVE EIBTRMID         TO  RV102-TERM-ID                  49400099
494100     END-IF.                                                      49410099
494200                                                                  49420099
494300     MOVE RV102-LIST-ITEM-NUMBER(RV102-BLK-SUB 1)                 49430099
494400                               TO  PV-LIST-ITEM-NUMBER.           49440099
494500     COMPUTE PV-BLOCK-NUMBER =                                    49450099
494600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-BLOCK).    49460099
494700                                                                  49470099
494800     IF (PV-BLOCK-NUMBER < RV102-HIGHEST-BLOCK-WRITTEN)           49480099
494900     OR (PV-BLOCK-NUMBER = RV102-HIGHEST-BLOCK-WRITTEN)           49490099
495000         IF  RV102-BLOCK-MODIFIED(RV102-BLK-SUB)                  49500099
495100             EXEC CICS                                            49510099
495200                 WRITEQ TS                                        49520099
495300                 QUEUE(RV102-TEMP-QUEUE-NAME)                     49530099
495400                 FROM(RV102-BLOCK-ENTRIES(RV102-BLK-SUB))         49540099
495500                 LENGTH(PC-BLOCK-LENGTH)                          49550099
495600                 ITEM(PV-BLOCK-NUMBER)                            49560099
495700                 REWRITE                                          49570099
495800                 RESP(PV-RESP)                                    49580099
495900             END-EXEC                                             49590099
496000                                                                  49600099
496100             IF  PV-RESP NOT = DFHRESP(NORMAL)                    49610099
496200                 MOVE PV-RESP  TO  PM-RESP-9                      49620099
496300                 EXEC CICS                                        49630099
496400                     DELETEQ TS                                   49640099
496500                     QUEUE(RV102-TEMP-QUEUE-NAME)                 49650099
496600                     RESP(PV-RESP)                                49660099
496700                 END-EXEC                                         49670099
496800                                                                  49680099
496900                 SET DP013-LOGIC-ABEND                            49690099
497000                               TO  TRUE                           49700099
497100                 SET DP013-NO-ROLLBACK                            49710099
497200                               TO  TRUE                           49720099
497300                 MOVE 'Z150-WRITE-TEMP-STORAGE'                   49730099
497400                               TO  DP013-PARAGRAPH                49740099
497500                 MOVE PM-PROGRAM-MESSAGE-9                        49750099
497600                               TO  DP013-MESSAGE-TEXT(1)          49760099
497700                 PERFORM DP013-0000-PROCESS-ABEND                 49770099
497800             END-IF                                               49780099
497900         END-IF                                                   49790099
498000     ELSE                                                         49800099
498100                                                                  49810099
498200         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       49820099
498300             RV102-HIGHEST-BLOCK-WRITTEN + 1                      49830099
498400         IF  PV-BLOCK-NUMBER = PV-HIGHEST-BLOCK-WRITTEN           49840099
498500             EXEC CICS                                            49850099
498600                 WRITEQ TS                                        49860099
498700                 QUEUE(RV102-TEMP-QUEUE-NAME)                     49870099
498800                 FROM(RV102-BLOCK-ENTRIES(RV102-BLK-SUB))         49880099
498900                 LENGTH(PC-BLOCK-LENGTH)                          49890099
499000                 ITEM(PV-BLOCK-NUMBER)                            49900099
499100                 RESP(PV-RESP)                                    49910099
499200             END-EXEC                                             49920099
499300                                                                  49930099
499400             IF  PV-RESP NOT = DFHRESP(NORMAL)                    49940099
499500                 MOVE PV-RESP  TO  PM-RESP-10                     49950099
499600                 EXEC CICS                                        49960099
499700                     DELETEQ TS                                   49970099
499800                     QUEUE(RV102-TEMP-QUEUE-NAME)                 49980099
499900                     RESP(PV-RESP)                                49990099
500000                 END-EXEC                                         50000099
500100                                                                  50010099
500200                 SET DP013-LOGIC-ABEND                            50020099
500300                               TO  TRUE                           50030099
500400                 SET DP013-NO-ROLLBACK                            50040099
500500                               TO  TRUE                           50050099
500600                 MOVE 'Z150-WRITE-TEMP-STORAGE'                   50060099
500700                               TO  DP013-PARAGRAPH                50070099
500800                 MOVE PM-PROGRAM-MESSAGE-10                       50080099
500900                               TO  DP013-MESSAGE-TEXT(1)          50090099
501000                 PERFORM DP013-0000-PROCESS-ABEND                 50100099
501100             END-IF                                               50110099
501200             ADD +1            TO  RV102-HIGHEST-BLOCK-WRITTEN    50120099
501300         ELSE                                                     50130099
501400             SET DP013-LOGIC-ABEND                                50140099
501500                               TO  TRUE                           50150099
501600             SET DP013-NO-ROLLBACK                                50160099
501700                               TO  TRUE                           50170099
501800             MOVE 'Z150-WRITE-TEMP-STORAGE'                       50180099
501900                               TO  DP013-PARAGRAPH                50190099
502000             MOVE PV-BLOCK-NUMBER                                 50200099
502100                               TO  PM-BLOCK-NUMBER                50210099
502200             MOVE PM-PROGRAM-MESSAGE-11                           50220099
502300                               TO  DP013-MESSAGE-TEXT(1)          50230099
502400             PERFORM DP013-0000-PROCESS-ABEND                     50240099
502500         END-IF                                                   50250099
502600     END-IF.                                                      50260099
502700                                                                  50270099
502800     SET RV102-BLOCK-NOT-MODIFIED(RV102-BLK-SUB) TO TRUE.         50280099
502900*----------------------------------------------------------------*50290099
503000*    FILL IN SCREEN HEADER MODULE                                *50300099
503100*----------------------------------------------------------------*50310099
503200     COPY DPPD022.                                                50320099
503300*----------------------------------------------------------------*50330099
503400*    RETURN TO CICS MODULE                                       *50340099
503500*----------------------------------------------------------------*50350099
503600     COPY DPPD003.                                                50360099
503700*----------------------------------------------------------------*50370099
503800*    FORMAT MESSAGE LINES MODULE                                 *50380099
503900*----------------------------------------------------------------*50390099
504000     COPY DPPD005.                                                50400099
504100*----------------------------------------------------------------*50410099
504200*    GET PANEL MODULE                                            *50420099
504300*----------------------------------------------------------------*50430099
504400     COPY DPPD007.                                                50440099
504500*----------------------------------------------------------------*50450099
504600*    WRITE PANEL MODULE                                          *50460099
504700*----------------------------------------------------------------*50470099
504800     COPY DPPD008.                                                50480099
504900*----------------------------------------------------------------*50490099
505000*    TOGGLE THE FUNCTION KEY LINE MODULE                         *50500099
505100*----------------------------------------------------------------*50510099
505200     COPY DPPD009.                                                50520099
505300*----------------------------------------------------------------*50530099
505400*    ABEND PROCESSOR MODULE                                      *50540099
505500*----------------------------------------------------------------*50550099
505600     COPY DPPD013.                                                50560099
505700*----------------------------------------------------------------*50570099
505800*    CHECK COMMUNICATION AREA MODULE                             *50580099
505900*----------------------------------------------------------------*50590099
506000     COPY DPPD015.                                                50600099
506100*----------------------------------------------------------------*50610099
506200*    UPDATE TIME AND DATE MODULE                                 *50620099
506300*----------------------------------------------------------------*50630099
506400     COPY DPPD017.                                                50640099
