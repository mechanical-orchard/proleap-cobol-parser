000100*-----------------------*                                         00010027
000200 IDENTIFICATION DIVISION.                                         00020027
000300*-----------------------*                                         00030027
000400 PROGRAM-ID.    PCKCS155.                                         00040027
000500 AUTHOR.        M. FURLICK - STRATAGEM                            00050027
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060027
000700 DATE-WRITTEN.  1/94.                                             00070027
000800 DATE-COMPILED.                                                   00080027
000900                                                                  00090027
001000*----------------------------------------------------------------*00100027
001100*    E155 - WORK ORDER INSTRUCTION MAINTENANCE.                  *00110027
001200*                                                                *00120027
001300*    THIS PROGRAM IS INVOKED FROM PCKCS154.  IT CAN ADD NEW      *00130027
001400*    INSTRUCTIONS, AND MODIFY OR DELETE EXISTING INSTRUCTIONS.   *00140027
001500*    ONLY 1 INSTRUCTION MAY BE PASSED AT A TIME, HOWEVER, THE    *00150027
001600*    LOGIC IN THE PROGRAM IS STANDARD "TSQB" LOGIC THAT WILL     *00160027
001700*    HANDLE MULTIPLE ITEMS IF THEY EXIST.                        *00170027
001800*                                                                *00180027
001900*  NOTE**NOTE**NOTE**NOTE**                                      *00190027
002000*    WHEN MAKING CHANGES TO THE DELETE STATUS ROLL-UP, THE SAME  *00200027
002100*    CHANGES MUST BE MADE TO THE STATUS ROLL-UP IN PGM PCKCS154. *00210027
002200*                                                                *00220027
002300*----------------------------------------------------------------*00230027
002310* DATE  11/04/2021                                                00231038
002320*            - CHANGE CALL OF 'DPKUT100' TO                     * 00232038
002330*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00233038
002340*              MAKING THE CALL DYNAMIC VS STATIC                * 00234038
002350*     MADE BY: GERMAN BANDA            WR/IR #: CHG0264232        00235039
1122RM*---------------------------------------------------------------- 00235140
1122RM* DATE  11/07/2022                                              * 00235240
1122RM*            - ADD COPYBOOK DPWS930                             * 00235340
1122RM*              CHANGE CALL TO DPWS030 FROM STATIC TO            * 00235440
1122RM*              DYNAMIC.                                         * 00235540
1122RM*     MADE BY: BOB MCASEY              WR/IR #: CHG0277910      * 00235640
002360*-----------------------------------------------------------------00236038
002361* DATE  02/14/2023                                              * 00237041
002362*            - REMOVE COPYBOOK FOR UPC CHECK DIGIT ROUTINE      * 00238041
002365*     MADE BY: JEAN KURK               WR/IR #: CHG0281369      * 00239241
002360*-----------------------------------------------------------------00239341
002400                                                                  00240027
002500                                                                  00250027
002600 ENVIRONMENT DIVISION.                                            00260027
002700                                                                  00270027
002800 DATA DIVISION.                                                   00280027
002900                                                                  00290027
003000                                                                  00300027
003100 WORKING-STORAGE SECTION.                                         00310027
003200                                                                  00320027
003300 01  PC-PROGRAM-CONSTANTS.                                        00330027
003400     05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'PCKCS155'.  00340027
003500     05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'PC155A  '.  00350027
003600     05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'PCKM155 '.  00360027
003700     05  PC-AUDIT-RTN             PIC  X(08)  VALUE  'RCKCS290'.  00370027
003800     05  PC-AUDIT-RTN-LENGTH      PIC S9(04)  VALUE  +300         00380027
003900                                                     COMP SYNC.   00390027
004000     05  PC-APPL-MAP              PIC S9(04)  VALUE  +1           00400027
004100                                              COMP.               00410027
004200     05  PC-PERIOD                PIC  X(01)  VALUE '.'.          00420027
004300     05  PC-A                     PIC  X(01)  VALUE 'A'.          00430027
004400     05  PC-5                     PIC  9(01)  VALUE 5.            00440027
004500     05  PC-I                     PIC  X(01)  VALUE 'I'.          00450027
004600     05  PC-N                     PIC  X(01)  VALUE 'N'.          00460027
004700     05  PC-Y                     PIC  X(01)  VALUE 'Y'.          00470027
004800     05  PC-DB2-DUMMY-DATE-1      PIC  X(26)  VALUE               00480029
004900         '9999-09-09-09.09.09.000000'.                            00490029
004910     05  PC-DB2-DUMMY-DATE-2      PIC  X(26)  VALUE               00491029
004920         '9999-09-09-09.09.09.999999'.                            00492029
005000     05  PC-CM                          PIC  X(02)  VALUE 'CM'.   00500027
005010     05  PC-IP                          PIC  X(02)  VALUE 'IP'.   00501030
005100                                                                  00510027
005200     05  PC-TSYMSG-NUMBERS.                                       00520027
005300         10  PC-TSYMSG-00005      PIC  9(05)  VALUE  00005.       00530027
005400         10  PC-TSYMSG-00008      PIC  9(05)  VALUE  00008.       00540027
005500         10  PC-TSYMSG-00034      PIC  9(05)  VALUE  00034.       00550027
005600         10  PC-TSYMSG-00059      PIC  9(05)  VALUE  00059.       00560027
005700         10  PC-TSYMSG-00069      PIC  9(05)  VALUE  00069.       00570027
005800         10  PC-TSYMSG-00070      PIC  9(05)  VALUE  00070.       00580027
005900         10  PC-TSYMSG-00115      PIC  9(05)  VALUE  00115.       00590027
006000         10  PC-TSYMSG-00148      PIC  9(05)  VALUE  00148.       00600027
006100         10  PC-TSYMSG-00551      PIC  9(05)  VALUE  00551.       00610027
006200*                                                                 00620027
006300 01  PS-PROGRAM-SWITCHES.                                         00630027
006400     05  PS-ERROR-SW              PIC  X(01)  VALUE  'N'.         00640027
006500         88  PS-ERROR                         VALUE  'Y'.         00650027
006600         88  PS-WARNING                       VALUE  'W'.         00660027
006700         88  PS-NO-ERROR                      VALUE  'N'.         00670027
006800     05  PS-SOFT-ABORT-SW         PIC  X(01)  VALUE  'N'.         00680027
006900         88  PS-SOFT-ABORT                    VALUE  'Y'.         00690027
007000     05  PS-DATA-OK-SW            PIC  X(01)  VALUE  'N'.         00700027
007100         88  PS-DATA-OK                       VALUE  'Y'.         00710027
007200         88  PS-DATA-NOT-OK                   VALUE  'N'.         00720027
007300*                                                                 00730027
007400 01  PV-PROGRAM-VARIABLES.                                        00740027
007500     05  PV-CICS-RESPONSE         PIC S9(04)  VALUE +0            00750027
007600                                              COMP SYNC.          00760027
007700     05  PV-CICS-RESP             PIC S9(04)  VALUE +0            00770027
007800                                              COMP SYNC.          00780027
007900     05  PV-NULL-IND              PIC S9(04)  VALUE +0            00790027
008000                                              COMP SYNC.          00800027
008100     05  PV-DB2-COUNT             PIC S9(9)   VALUE +0            00810027
008200                                              COMP-3.             00820027
008300     05  PV-WORK-TMST.                                            00830027
008400         10  PV-WT-CCYY                 PIC  X(04).               00840027
008500             88  PV-WT-NULL-DATE                    VALUE '9999'  00850027
008600                                                          '0001'. 00860027
008700         10  FILLER  REDEFINES  PV-WT-CCYY.                       00870027
008800             15  FILLER                 PIC  X(02).               00880027
008900             15  PV-WT-YR               PIC  X(02).               00890027
009000         10  FILLER                     PIC  X(01).               00900027
009100         10  PV-WT-MO                   PIC  X(02).               00910027
009200         10  FILLER                     PIC  X(01).               00920027
009300         10  PV-WT-DA                   PIC  X(02).               00930027
009400         10  FILLER                     PIC  X(01).               00940027
009500         10  PV-WT-HH                   PIC  X(02).               00950027
009600         10  FILLER                     PIC  X(01).               00960027
009700         10  PV-WT-MM                   PIC  X(02).               00970027
009800         10  FILLER                     PIC  X(01).               00980027
009900         10  PV-WT-SS                   PIC  X(02).               00990027
010000         10  FILLER                     PIC  X(07).               01000027
010100     05  PV-SCREEN-DISPLAY-DATE.                                  01010027
010200         10  PV-SD-MO                   PIC  X(02).               01020027
010300         10  FILLER                     PIC  X(01)   VALUE '/'.   01030027
010400         10  PV-SD-DA                   PIC  X(02).               01040027
010500         10  FILLER                     PIC  X(01)   VALUE '/'.   01050027
010600         10  PV-SD-YR                   PIC  X(02).               01060027
010700     05  PV-SCREEN-DISPLAY-TIME.                                  01070027
010800         10  PV-SD-HH                   PIC  X(02).               01080027
010900         10  FILLER                     PIC  X(01)   VALUE ':'.   01090027
011000         10  PV-SD-MM                   PIC  X(02).               01100027
011100         10  FILLER                     PIC  X(01)   VALUE ':'.   01110027
011200         10  PV-SD-SS                   PIC  X(02).               01120027
011300/                                                                 01130027
011400*---------------------------------------------------------------* 01140027
011500*  RECORD LAYOUT 'INSERT AUDIT MODULE'  RCKCS290                * 01150027
011600*---------------------------------------------------------------* 01160027
011700                                                                  01170027
011800     COPY RCWS031.                                                01180027
011900                                                                  01190027
012000/                                                                 01200027
012100*----------------------------------------------------------------*01210027
012200*  THE LAYOUT FOR THE TEMPORARY STORAGE QUEUE CONTAINING         *01220027
012300*  SELECTED LIST ITEMS TO BE PROCESSED BY THIS PROGRAM.          *01230027
012400*----------------------------------------------------------------*01240027
012500     COPY PCWS017.                                                01250027
012600                                                                  01260027
012700/                                                                 01270027
012800*----------------------------------------------------------------*01280027
012900*  THE LAYOUT FOR THE TEMPORARY STORAGE QUEUE CONTAINING         *01290027
013000*  SELECTED FACILITY ITEMS PASSED BACK FROM PCKCS136.            *01300027
013100*----------------------------------------------------------------*01310027
013200     COPY PCWS019.                                                01320027
013300                                                                  01330027
013400/                                                                 01340027
013500*----------------------------------------------------------------*01350027
013600*    MAP LAYOUT                                                  *01360027
013700*----------------------------------------------------------------*01370027
013800                                                                  01380027
013900     COPY PCKM155.                                                01390027
014000                                                                  01400027
014100 EJECT                                                            01410027
014200*----------------------------------------------------------------*01420027
014300*    ATTRIBUTE SETTINGS COPYBOOK.                                *01430027
014400*----------------------------------------------------------------*01440027
014500                                                                  01450027
014600     COPY DPWS015.                                                01460027
014700                                                                  01470027
014800*----------------------------------------------------------------*01480027
014900*    FUNCTION KEYS COPYBOOK                                      *01490027
015000*----------------------------------------------------------------*01500027
015100                                                                  01510027
015200     COPY DPWS016.                                                01520027
015300                                                                  01530027
016000*----------------------------------------------------------------*01600027
016100*    DATE/TIME COPYBOOK                                          *01610027
016200*----------------------------------------------------------------*01620027
016300                                                                  01630027
016400     COPY DPWS017.                                                01640027
016500                                                                  01650027
016600/                                                                 01660027
016700**--------------------------------------------------------------**01670027
016800** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **01680027
016900** SUB-ROUTINE (DPKUT100).                                      **01690027
017000**--------------------------------------------------------------**01700027
017100     COPY DPWS010I.                                               01710027
017200 EJECT                                                            01720027
017300**--------------------------------------------------------------**01730027
017400** THE CALLING PARAMETER LIST (DPWS030) FOR THE CICS ARCHITECTURE*01740027
017500** APPLICATION PROGRAMMING INTERFACE MODULE -- DPKCS030.        **01750027
017600**--------------------------------------------------------------**01760027
017700     COPY DPWS030.                                                01770027
1122RM     COPY DPWS930.                                                01771040
017800 EJECT                                                            01780027
017900**--------------------------------------------------------------**01790027
018000*    STANDARD COMMAREA.                                           01800027
018100**--------------------------------------------------------------**01810027
018200                                                                  01820027
018300     COPY DPWS020.                                                01830027
018400     05  PCKCS155-APPL REDEFINES DP020-VARIABLE-COMMAREA.         01840027
018500                                                                  01850027
018600***************************************************************** 01860027
018700*    INTER-APPLICATION COMMAREA.                                  01870027
018800***************************************************************** 01880027
018900                                                                  01890027
019000         10  INTER-APPL-COMM-AREA PIC X(200).                     01900027
019100     COPY PCWS000.                                                01910027
019200***************************************************************** 01920027
019300*    SPECIFIC COMMMAREA FOR DPKCS041.                             01930027
019400***************************************************************** 01940027
019500         10  ASC-SPECIFIC-COMMAREA.                               01950027
019600             15  ASC-KEY-PO-NBR                  PIC S9(09)       01960027
019700                                                 COMP.            01970027
019800             15  ASC-KEY-RCVR-SEQ-NBR            PIC S9(09)       01980027
019900                                                 COMP.            01990027
020000             15  ASC-KEY-LINE-NBR                PIC S9(04)       02000027
020100                                                 COMP.            02010027
020200             15  ASC-KEY-WORK-ORD-SEQ-NBR        PIC S9(04)       02020027
020300                                                 COMP.            02030027
020400             15  ASC-SCREEN-SEQ-NBR              PIC S9(04)       02040027
020500                                                 COMP.            02050027
020600             15  ASC-WO-INSTR-SEQ-NBR            PIC S9(04)       02060027
020700                                                 COMP.            02070027
020800             15  ASC-EXPECTED-CARTONS-X.                          02080027
020900                 20  ASC-EXPECTED-CARTONS        PIC  9(05).      02090027
021000             15  ASC-ACTUAL-CARTONS-X.                            02100027
021100                 20  ASC-ACTUAL-CARTONS          PIC  9(05).      02110027
021200             15  ASC-SCREEN-ENTERABLE-FIELDS.                     02120027
021300                 20  ASC-SCR-OPER-ID       PIC S9(04)  COMP.      02130027
021400                 20  ASC-SCR-OPER-UNT-ID   PIC S9(04)  COMP.      02140027
021500                 20  ASC-SCR-FCLTY-ID      PIC S9(04)  COMP.      02150027
021600                 20  ASC-SCR-FCLTY-AREA-ID PIC  X(06).            02160027
021700                 20  ASC-SCR-PRC-FCLTY-AREA-ID                    02170027
021800                                           PIC  X(06).            02180027
021900                 20  ASC-SCR-EXPTED-CART-CNT                      02190027
022000                                           PIC S9(09)  COMP.      02200027
022100                 20  ASC-SCR-ACTL-CART-CNT PIC S9(09)  COMP.      02210027
022200                 20  ASC-SCR-REPACK-IND    PIC  X(01).            02220027
022300                 20  ASC-SCR-START-DATE    PIC  X(08).            02230027
022400                 20  ASC-SCR-START-TIME    PIC  X(08).            02240027
022500                 20  ASC-SCR-STOP-DATE     PIC  X(08).            02250027
022600                 20  ASC-SCR-STOP-TIME     PIC  X(08).            02260027
022700                 20  ASC-SCR-LNE-LOC-CDE   PIC  X(05).            02270027
022800                 20  ASC-OPER-DESC         PIC  X(25).            02280027
022900                                                                  02290027
023000             15  ASC-ORIG-ACTUAL-CARTONS   PIC  9(05).            02300027
023100             15  ASC-INT-APPL-FORMAT-IND   PIC  X(01).            02310027
023200                 88  ASC-ADD-FUNCTION                  VALUE 'A'. 02320027
023300                 88  ASC-DELETE-FUNCTION               VALUE 'D'. 02330027
023400                 88  ASC-UPDATE-FUNCTION               VALUE 'U'. 02340027
023500             15  ASC-USE-SELECTION-QUEUE-IND                      02350027
023600                                           PIC  X(01).            02360027
023700                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 02370027
023800             15  ASC-SEL-QUEUE-NAME        PIC  X(08).            02380027
023900             15  ASC-FACILITY-QUEUE-NAME.                         02390027
024000                 20  ASC-FAC-TERM-ID                 PIC  X(04).  02400027
024100                 20  ASC-FAC-TASK-NUMBER             PIC S9(05)   02410027
024200                                                          COMP-3. 02420027
024300                 20  ASC-FAC-SEQ                     PIC  9(01).  02430027
024400             15  ASC-NUMBER-OF-TS-ITEMS    PIC S9(05)  COMP-3.    02440027
024500             15  ASC-NUMBER-OF-SELECTED-ITEMS                     02450027
024600                                           PIC S9(09)  COMP-3.    02460027
024700             15  ASC-SEL-SUB               PIC S9(04)  COMP.      02470027
024800             15  ASC-SEL-ITEM              PIC S9(04)  COMP.      02480027
024900             15  ASC-RETURN-SW             PIC  X(01).            02490027
025000                 88  ASC-RETURN-FROM-FACILITY          VALUE 'Y'. 02500027
025100                 88  ASC-RETURN-FROM-ELSEWHERE         VALUE 'N'. 02510027
025200             15  ASC-CURRENT-TIMESTAMP.                           02520027
025300                 20  ASC-CT-DATE  PIC  X(10).                     02530027
025400                 20  FILLER       PIC  X(01).                     02540027
025500                     88 ASC-CT-DASH1          VALUE '-'.          02550027
025600                 20  ASC-CT-TIME  PIC  X(08).                     02560027
025700                 20  FILLER       PIC  X(07).                     02570027
025800                     88  ASC-CT-ZERO1         VALUE '.000000'.    02580027
025900             15  ASC-CURRENT-TMST REDEFINES  ASC-CURRENT-TIMESTAMP02590027
026000                                  PIC  X(26).                     02600027
026100                                                                  02610027
026200             15  ASC-CURR-OPER-UNT-ID      PIC  9(04).            02620032
026210             15  ASC-HOLD-INTER-APPL       PIC  X(196).           02621032
026300         10  FILLER                        PIC  X(200).           02630027
026400/                                                                 02640027
026500*----------------------------------------------------------------*02650027
026600*    ABEND PROCESSING COPYBOOK.                                  *02660027
026700*----------------------------------------------------------------*02670027
026800                                                                  02680027
026900     COPY DPWS013.                                                02690027
027000                                                                  02700027
027100/                                                                 02710027
027200                                                                  02720027
027300*    DB2 AREA FOR TRECEIV                                         02730027
027400                                                                  02740027
027500     EXEC SQL                                                     02750027
027600          INCLUDE TRECEIV                                         02760027
027700     END-EXEC.                                                    02770027
027800                                                                  02780027
027900*    DB2 AREA FOR WORK ORDER INSTRUCTIONS                         02790027
028000                                                                  02800027
028100     EXEC SQL                                                     02810027
028200          INCLUDE TWKORIN                                         02820027
028300     END-EXEC.                                                    02830027
028400                                                                  02840027
028500*    DB2 AREA FOR WORK ORDERS                                     02850027
028600                                                                  02860027
028700     EXEC SQL                                                     02870027
028800          INCLUDE TWRKORD                                         02880027
028900     END-EXEC.                                                    02890027
029000                                                                  02900027
029100*    DB2 AREA FOR OPERATION                                       02910027
029200                                                                  02920027
029300     EXEC SQL                                                     02930027
029400          INCLUDE TOPERAT                                         02940027
029500     END-EXEC.                                                    02950027
029600                                                                  02960027
029700*    DB2 AREA FOR FACILTY AREA                                    02970027
029800                                                                  02980027
029900     EXEC SQL                                                     02990027
030000          INCLUDE TOPERFA                                         03000027
030100     END-EXEC.                                                    03010027
030200                                                                  03020027
030300*    DB2 AREA FOR COMMUNICATIONS                                  03030027
030400                                                                  03040027
030500     EXEC SQL                                                     03050027
030600          INCLUDE SQLCA                                           03060027
030700     END-EXEC.                                                    03070027
030800                                                                  03080027
030900*---------------------------------------------------------------* 03090027
031000*    CURSOR DECLARATION FOR USED IN ADD PROCESS.                * 03100027
031100*---------------------------------------------------------------* 03110027
031200                                                                  03120027
031300     EXEC SQL                                                     03130027
031400          DECLARE ADD-CSR CURSOR                                  03140027
031500          FOR SELECT                                              03150027
031600                     ORD_NBR                                      03160027
031700                    ,RCVR_SEQ_NBR                                 03170027
031800                    ,ORD_LNE_NBR                                  03180027
031900                    ,WORK_ORD_SEQ_NBR                             03190027
032000                    ,WO_INSTR_SEQ_NBR                             03200027
032100                    ,CRE_TMST                                     03210027
032200                    ,VER_STATUS_CDE                               03220027
032300                    ,CRE_UID_ID                                   03230027
032400                    ,OPER_ID                                      03240027
032500                    ,OPER_UNT_ID                                  03250027
032600                    ,FCLTY_ID                                     03260027
032700                    ,FCLTY_AREA_ID                                03270027
032800                    ,PRC_FCLTY_AREA_ID                            03280027
032900                    ,EXPTED_CART_CNT                              03290027
033000                    ,ACTL_CART_CNT                                03300027
033100                    ,ALLOC_IND                                    03310027
033200                    ,REPACK_IND                                   03320027
033300                    ,STRT_TMST                                    03330027
033400                    ,STOP_TMST                                    03340027
033500                    ,SCREEN_SEQ_NBR                               03350027
033600                    ,LNE_LOC_CDE                                  03360027
033700                    ,REC_SEL_IND                                  03370027
033800          FROM                                                    03380027
033900                TWKORIN                                           03390027
034000          WHERE                                                   03400027
034100                ORD_NBR            =  :ASC-KEY-PO-NBR             03410027
034200            AND RCVR_SEQ_NBR       =  :ASC-KEY-RCVR-SEQ-NBR       03420027
034300            AND ORD_LNE_NBR        =  :ASC-KEY-LINE-NBR           03430027
034400            AND WORK_ORD_SEQ_NBR   =  :ASC-KEY-WORK-ORD-SEQ-NBR   03440027
034500            AND VER_STATUS_CDE     =  :PC-A                       03450027
034600            AND SCREEN_SEQ_NBR     >  :ASC-SCREEN-SEQ-NBR         03460027
034700            AND CRE_TMST           <  :ASC-CURRENT-TMST           03470027
034800          FOR UPDATE OF                                           03480027
034900                VER_STATUS_CDE                                    03490027
035000              , SCREEN_SEQ_NBR                                    03500027
035100     END-EXEC.                                                    03510027
035200/                                                                 03520027
035300 LINKAGE SECTION.                                                 03530027
035400                                                                  03540027
035500 01  DFHCOMMAREA.                                                 03550027
035600     05  FILLER                         OCCURS  1 TO 4072 TIMES   03560027
035700                                        DEPENDING ON EIBCALEN.    03570027
035800         10  FILLER                     PIC X.                    03580027
035900                                                                  03590027
036000                                                                  03600027
036100 PROCEDURE DIVISION.                                              03610027
036200**-------------------------------------------------------------** 03620027
036300** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 03630027
036400** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 03640027
036500** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 03650027
036600**                                                             ** 03660027
036700** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 03670027
036800** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 03680027
036900**-------------------------------------------------------------** 03690027
037000                                                                  03700027
037100 0000-MAIN-MODULE.                                                03710027
037200                                                                  03720027
037300     INITIALIZE DP030-CICS-API-FIELDS.                            03730027
037400     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03740027
037500     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03750027
037600     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03760027
037700                                                                  03770027
037800     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03780027
037900     MOVE LENGTH OF PC155AI        TO DP030-MAP-LENGTH (1).       03790027
038000     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03800027
038100     PERFORM 0001-CALL-CICS-ARCH-API.                             03810027
038200                                                                  03820027
038300     PERFORM 1000-CONTROL-PROCESSING                              03830027
038400                                                                  03840027
038500     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03850027
038600     PERFORM 0001-CALL-CICS-ARCH-API.                             03860027
038700                                                                  03870027
038800 0001-CALL-CICS-ARCH-API.                                         03880027
038900                                                                  03890027
1122RM*    CALL 'DPKCS030' USING DFHEIBLK                               03900040
1122RM     CALL DP930-CICS-ARCH-API                                     03901040
1122RM                     USING DFHEIBLK                               03902040
039100                           DFHCOMMAREA                            03910027
039200                           DP030-CICS-API-FIELDS                  03920027
039300                           DP020-STANDARD-COMMAREA                03930027
039400                           PC155AI.                               03940027
039500                                                                  03950027
039600     IF  DP030-RC-CALL-SUCCESSFUL                                 03960027
039700         CONTINUE                                                 03970027
039800     ELSE                                                         03980027
039900         SET DP013-NO-ROLLBACK                                    03990027
040000             DP013-XCTL-DISPLAY-RESTART                           04000027
040100             DP013-CICS-ABEND      TO TRUE                        04010027
040200         MOVE 'BEFORE 0000-MAIN-MODULE'                           04020027
040300                                   TO DP013-PARAGRAPH             04030027
1122RM*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX04040040
1122RM*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      04050040
1122RM         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04051040
1122RM-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04052040
040600         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      04060027
040700         PERFORM DP013-0000-PROCESS-ABEND                         04070027
040800     END-IF.                                                      04080027
040900/                                                                 04090027
041000*----------------------------------------------------------------*04100027
041100*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *04110027
041200*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *04120027
041300*----------------------------------------------------------------*04130027
041400                                                                  04140027
041500 1000-CONTROL-PROCESSING.                                         04150027
041600                                                                  04160027
041700     EVALUATE TRUE                                                04170027
041800         WHEN DP020-NEXT-ACT-INITIAL                              04180027
041900              PERFORM 1100-FIND-OBJECT-KEYS                       04190027
042000              IF  PS-ERROR                                        04200027
042100                  CONTINUE                                        04210027
042200              ELSE                                                04220027
042300                  MOVE INTER-APPL-COMM-AREA                       04230027
042400                                   TO  ASC-HOLD-INTER-APPL        04240027
042500                  PERFORM 4000-BUILD-INITIAL-PANEL                04250027
042600                  PERFORM 3200-RESET-ATTRIBUTES                   04260027
042700                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            04270027
042800                  IF  SQLCODE = +100                              04280027
042900                      SET DP020-NEXT-ACT-APPL-ERROR TO TRUE       04290027
043000                      MOVE PC-TSYMSG-00148                        04300027
043100                                   TO  DP020-MSG-NUMBER           04310027
043200                      SET DP020-MSG-FATAL TO TRUE                 04320027
043300                  END-IF                                          04330027
043400              END-IF                                              04340027
043500                                                                  04350027
043600         WHEN DP020-NEXT-ACT-READ-MAP                             04360027
043700              PERFORM 2000-PROCESS-PANEL                          04370027
043800                                                                  04380027
043900         WHEN DP020-NEXT-ACT-RETURN                               04390027
044000              MOVE ASC-HOLD-INTER-APPL                            04400027
044100                                   TO  INTER-APPL-COMM-AREA       04410027
044200              IF  ASC-RETURN-FROM-FACILITY                        04420027
044300                  PERFORM 1200-GET-FACILITY                       04430027
044400              END-IF                                              04440027
044500              PERFORM 3000-EDIT-DATA-IN-COMMAREA                  04450027
044600              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                04460027
044700                                                                  04470027
044800         WHEN OTHER                                               04480027
044900              SET DP013-LOGIC-ABEND TO TRUE                       04490027
045000              SET DP013-NO-ROLLBACK TO TRUE                       04500027
045100              MOVE '1000-CONTROL-PROCESSING'                      04510027
045200                                   TO  DP013-PARAGRAPH            04520027
045300              MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'  04530027
045400                                   TO  DP013-MESSAGE-TEXT(1)      04540027
045500              MOVE DP020-NEXT-APPL-ACTIVITY                       04550027
045600                                   TO  DP013-MESSAGE-TEXT(2)      04560027
045700              PERFORM DP013-0000-PROCESS-ABEND                    04570027
045800     END-EVALUATE.                                                04580027
045900                                                                  04590027
046000*----------------------------------------------------------------*04600027
046100*  DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE    *04610027
046200*  INTER-APPLICATION FORMAT CODE.                                *04620027
046300*----------------------------------------------------------------*04630027
046400                                                                  04640027
046500 1100-FIND-OBJECT-KEYS.                                           04650027
046600                                                                  04660027
046700     INITIALIZE ASC-SPECIFIC-COMMAREA.                            04670027
046800     MOVE DP020-INT-APPL-FORMAT-IND                               04680027
046900                                   TO  ASC-INT-APPL-FORMAT-IND.   04690027
047000                                                                  04700027
047100     SET ASC-USE-SELECTION-QUEUE TO TRUE.                         04710027
047200     MOVE PC000-NUMBER-OF-SELECTED-ITEMS                          04720027
047300                                 TO ASC-NUMBER-OF-SELECTED-ITEMS. 04730027
047400     MOVE PC000-NUMBER-OF-TS-ITEMS                                04740027
047500                                   TO  ASC-NUMBER-OF-TS-ITEMS.    04750027
047600     MOVE PC000-SEL-QUEUE-NAME                                    04760027
047700                                   TO  ASC-SEL-QUEUE-NAME.        04770027
047800     PERFORM 1120-PREPARE-LIST-ENTRY.                             04780027
047900                                                                  04790027
048000*----------------------------------------------------------------*04800027
048100* ENTRY IS FROM A LIST.  GET THE MESSAGE NUMBER FROM THE TEMP    *04810027
048200* STORAGE QUEUE PASSED FROM THE LIST.                            *04820027
048300*----------------------------------------------------------------*04830027
048400                                                                  04840027
048500 1120-PREPARE-LIST-ENTRY.                                         04850027
048600                                                                  04860027
048700     MOVE PC017-MAX-ITEMS          TO ASC-SEL-SUB.                04870027
048800     MOVE ZERO                     TO ASC-SEL-ITEM.               04880027
048900     PERFORM 2110-GET-NEXT-LINE.                                  04890027
049000/                                                                 04900027
049100*----------------------------------------------------------------*04910027
049200*    WE HAVE RETURNED FROM THE FACILITY LIST.  GRAB THE FIRST    *04920027
049300*    ONE SELECTED AND SLAP IT IN OUR ASC, THEN DELETE THE QUEUE. *04930027
049400*----------------------------------------------------------------*04940027
049500                                                                  04950027
049600 1200-GET-FACILITY.                                               04960027
049700                                                                  04970027
049800     PERFORM 1210-GET-FACILITY-REC.                               04980027
049900                                                                  04990027
050000     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       05000027
050100         MOVE PC019-FCLTY-AREA-ID(1) TO  ASC-SCR-FCLTY-AREA-ID    05010027
050200         MOVE PC019-PRC-FCLTY-AREA-ID(1) TO                       05020027
050300                                         ASC-SCR-PRC-FCLTY-AREA-ID05030027
050400         MOVE PC019-OPER-DESC    (1) TO  ASC-OPER-DESC            05040027
050500         MOVE PC019-OPERATION-ID (1) TO  ASC-SCR-OPER-ID          05050027
050600         MOVE PC019-FACILITY-ID      TO  ASC-SCR-FCLTY-ID         05060027
050610*** DMH BEGIN - 11/4/08                                           05061033
050700         MOVE ASC-CURR-OPER-UNT-ID    TO ASC-SCR-OPER-UNT-ID      05070033
050710***      MOVE PC019-OPERATING-UNIT-ID TO ASC-SCR-OPER-UNT-ID      05071033
050720*** DMH END   - 11/4/08                                           05072033
050800     END-IF.                                                      05080027
050900                                                                  05090027
051000     PERFORM 1220-DELETE-FACILITY-QUEUE.                          05100027
051100     SET ASC-RETURN-FROM-ELSEWHERE TO  TRUE.                      05110027
051200                                                                  05120027
051300 1210-GET-FACILITY-REC.                                           05130027
051400                                                                  05140027
051500     EXEC CICS                                                    05150027
051600          READQ TS                                                05160027
051700              QUEUE (ASC-FACILITY-QUEUE-NAME)                     05170027
051800              INTO  (PC019-MESSAGE-SEL-REC)                       05180027
051900              ITEM  (1)                                           05190027
052000              RESP  (PV-CICS-RESP)                                05200027
052100     END-EXEC.                                                    05210027
052200                                                                  05220027
052300     IF (PV-CICS-RESP = DFHRESP (NORMAL)                          05230027
052400     OR  PV-CICS-RESP = DFHRESP (QIDERR))                         05240027
052500         CONTINUE                                                 05250027
052600     ELSE                                                         05260027
052700         SET DP013-CICS-ABEND      TO TRUE                        05270027
052800         SET DP013-NO-ROLLBACK     TO TRUE                        05280027
052900         MOVE '1210-GET-FACILITY-REC'                             05290027
053000                                   TO DP013-PARAGRAPH             05300027
053100         MOVE 'ATTEMPTING TO READ FACILITY QUEUE'                 05310027
053200                                   TO DP013-MESSAGE-TEXT(1)       05320027
053300         PERFORM DP013-0000-PROCESS-ABEND                         05330027
053400     END-IF.                                                      05340027
053500                                                                  05350027
053600 1220-DELETE-FACILITY-QUEUE.                                      05360027
053700                                                                  05370027
053800     EXEC CICS                                                    05380027
053900         DELETEQ TS                                               05390027
054000             QUEUE (ASC-FACILITY-QUEUE-NAME)                      05400027
054100             RESP  (PV-CICS-RESP)                                 05410027
054200     END-EXEC.                                                    05420027
054300                                                                  05430027
054400     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      05440027
054500        (PV-CICS-RESP = DFHRESP(QIDERR)))                         05450027
054600         CONTINUE                                                 05460027
054700     ELSE                                                         05470027
054800         SET DP013-CICS-ABEND TO TRUE                             05480027
054900         SET DP013-NO-ROLLBACK TO TRUE                            05490027
055000         MOVE '1220-DELETE-FACILTY-QUEUE'                         05500027
055100                        TO DP013-PARAGRAPH                        05510027
055200         MOVE 'ERROR TRYING TO DELETE FACILITY QUEUE'             05520027
055300                        TO DP013-MESSAGE-TEXT (1)                 05530027
055400         PERFORM DP013-0000-PROCESS-ABEND                         05540027
055500     END-IF.                                                      05550027
055600/                                                                 05560027
055700*----------------------------------------------------------------*05570027
055800* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *05580027
055900* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *05590027
056000* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *05600027
056100* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *05610027
056200* FUNCTION KEYS CAN GET THIS FAR.                                *05620027
056300*----------------------------------------------------------------*05630027
056400                                                                  05640027
056500 2000-PROCESS-PANEL.                                              05650027
056600                                                                  05660027
056700     IF  PC000-PO-NBR-N NOT GREATER THAN ZERO                     05670027
056800         MOVE ASC-HOLD-INTER-APPL TO INTER-APPL-COMM-AREA         05680027
056900     END-IF.                                                      05690027
057000                                                                  05700027
057100     EVALUATE TRUE                                                05710027
057200                                                                  05720027
057300         WHEN DP020-SRC-AID = DP016-CLEAR                         05730027
057400              PERFORM 3000-EDIT-DATA-IN-COMMAREA                  05740027
057500              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                05750027
057600                                                                  05760027
057700         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     05770027
057800              SET DP030-DONT-ERASE                                05780027
057900                  DP030-SEND-DATAONLY (PC-APPL-MAP)               05790027
058000                                   TO TRUE                        05800027
058100              MOVE PC017-MAX-ITEMS TO ASC-SEL-SUB                 05810027
058200              MOVE ZERO            TO ASC-SEL-ITEM                05820027
058300              PERFORM 2110-GET-NEXT-LINE                          05830027
058400              PERFORM 4000-BUILD-INITIAL-PANEL                    05840027
058500              PERFORM 3200-RESET-ATTRIBUTES                       05850027
058600              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                05860027
058700                                                                  05870027
058800         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             05880027
058900              IF  ASC-USE-SELECTION-QUEUE                         05890027
059000                  PERFORM 2110-GET-NEXT-LINE                      05900027
059100                  PERFORM 4000-BUILD-INITIAL-PANEL                05910027
059200                  PERFORM 3200-RESET-ATTRIBUTES                   05920027
059300                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            05930027
059400              ELSE                                                05940027
059500*                 --- BOTTOM OF LIST ---                          05950027
059600                  MOVE PC-TSYMSG-00070                            05960027
059700                                   TO DP020-MSG-NUMBER            05970027
059800                  SET DP020-MSG-INFORMATIONAL                     05980027
059900                                   TO TRUE                        05990027
060000              END-IF                                              06000027
060100                                                                  06010027
060200         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             06020027
060300              IF  ASC-USE-SELECTION-QUEUE                         06030027
060400                  PERFORM 2120-GET-PREV-LINE                      06040027
060500                  PERFORM 4000-BUILD-INITIAL-PANEL                06050027
060600                  PERFORM 3200-RESET-ATTRIBUTES                   06060027
060700                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            06070027
060800              ELSE                                                06080027
060900*                 --- TOP OF LIST ---                             06090027
061000                  MOVE PC-TSYMSG-00069                            06100027
061100                                   TO DP020-MSG-NUMBER            06110027
061200                  SET DP020-MSG-INFORMATIONAL                     06120027
061300                                   TO TRUE                        06130027
061400              END-IF                                              06140027
061500                                                                  06150027
061600         WHEN OTHER                                               06160027
061700              PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                06170027
061800              IF  DP020-FK-LOCAL-GOTO (DP020-SRC-AID)             06180027
061900                  SET ASC-RETURN-FROM-FACILITY                    06190027
062000                      DP030-CONTINUE-GO                           06200027
062100                                   TO TRUE                        06210027
062200                  MOVE EIBTRMID    TO ASC-FAC-TERM-ID             06220027
062300                  MOVE DP020-SRC-TASK-NUMBER                      06230027
062400                                   TO ASC-FAC-TASK-NUMBER         06240027
062500                  MOVE PC-5        TO ASC-FAC-SEQ                 06250027
062600                  MOVE ASC-FACILITY-QUEUE-NAME                    06260027
062700                                   TO PC000-FACILITY-QUEUE-NAME   06270027
062800              ELSE                                                06280027
062900                  PERFORM 3000-EDIT-DATA-IN-COMMAREA              06290027
063000                  IF  PS-NO-ERROR                                 06300027
063100                      SET DP030-CONTINUE-GO                       06310027
063200                                   TO TRUE                        06320027
063300                      PERFORM 2100-CHECK-FUNCTION-KEY             06330027
063400                  ELSE                                            06340027
063500                      PERFORM 4400-MOVE-COMMAREA-TO-SCREEN        06350027
063600                      SET DP030-OVERRIDE-GO                       06360027
063700                                   TO TRUE                        06370027
063800                  END-IF                                          06380027
063900              END-IF                                              06390027
064000     END-EVALUATE.                                                06400027
064100                                                                  06410027
064200*----------------------------------------------------------------*06420027
064300* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED       *06430027
064400* FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED   *06440027
064500* FROM THE CICS ARCHITECTURE API.                                *06450027
064600*----------------------------------------------------------------*06460027
064700                                                                  06470027
064800 2100-CHECK-FUNCTION-KEY.                                         06480027
064900                                                                  06490027
065000     EVALUATE TRUE                                                06500027
065100         WHEN DP020-SRC-AID = DP016-ENTER                         06510027
065200              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                06520027
065300                                                                  06530027
065400         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              06540027
065500              SET DP030-CONTINUE-GO TO TRUE                       06550027
065600              PERFORM 5000-BEGIN-MAINT-PROCESS                    06560027
065700              IF  PS-NO-ERROR                                     06570027
065800*             --- UPDATES SUCCESSFUL ---                          06580027
065900                  EVALUATE TRUE                                   06590027
066000                      WHEN ASC-ADD-FUNCTION                       06600027
066100                           MOVE PC-TSYMSG-00034                   06610027
066200                                   TO DP020-MSG-NUMBER            06620027
066300                      WHEN ASC-DELETE-FUNCTION                    06630027
066400                           MOVE PC-TSYMSG-00115                   06640027
066500                                   TO DP020-MSG-NUMBER            06650027
066600                      WHEN ASC-UPDATE-FUNCTION                    06660027
066700                           MOVE PC-TSYMSG-00059                   06670027
066800                                   TO DP020-MSG-NUMBER            06680027
066900                  END-EVALUATE                                    06690027
067000                  SET DP020-MSG-INFORMATIONAL                     06700027
067100                                   TO TRUE                        06710027
067200                  MOVE DP016-PF3   TO DP020-SRC-AID               06720027
067300              ELSE                                                06730027
067400                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            06740027
067500              END-IF                                              06750027
067600                                                                  06760027
067700         WHEN OTHER                                               06770027
067800              SET DP013-NO-ROLLBACK                               06780027
067900                  DP013-XCTL-DISPLAY-RESTART                      06790027
068000                  DP013-CICS-ABEND  TO TRUE                       06800027
068100              MOVE '2000-PROCESS-PANEL'                           06810027
068200                                   TO DP013-PARAGRAPH             06820027
068300              MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'     06830027
068400                                   TO DP013-MESSAGE-TEXT (1)      06840027
068500              PERFORM DP013-0000-PROCESS-ABEND                    06850027
068600     END-EVALUATE.                                                06860027
068700                                                                  06870027
068800*----------------------------------------------------------------*06880027
068900*    RETRIEVE THE NEXT KEY FOR PROCESSING.                       *06890027
069000*----------------------------------------------------------------*06900027
069100                                                                  06910027
069200 2110-GET-NEXT-LINE.                                              06920027
069300                                                                  06930027
069400     ADD +1                        TO  ASC-SEL-SUB.               06940027
069500     IF  ASC-SEL-SUB > PC017-MAX-ITEMS                            06950027
069600         ADD +1                    TO  ASC-SEL-ITEM               06960027
069700         MOVE +1                   TO  ASC-SEL-SUB                06970027
069800     END-IF.                                                      06980027
069900                                                                  06990027
070000     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                07000027
070100         PERFORM 9100-READ-SEL-QUEUE                              07010027
070200         IF  PC017-ITEM (ASC-SEL-SUB) > ZERO                      07020027
070300             MOVE PC017-SCREEN-SEQ-NBR(ASC-SEL-SUB)               07030027
070400                                   TO  ASC-SCREEN-SEQ-NBR         07040027
070500             MOVE PC017-WO-INSTR-SEQ-NBR(ASC-SEL-SUB)             07050027
070600                                   TO  ASC-WO-INSTR-SEQ-NBR       07060027
070700             MOVE PC017-EXPECTED-CTNS   (ASC-SEL-SUB)             07070027
070800                                   TO  ASC-EXPECTED-CARTONS       07080027
070900             MOVE PC017-ACTUAL-CTNS     (ASC-SEL-SUB)             07090027
071000                                   TO  ASC-ACTUAL-CARTONS         07100027
071100             SET PC017-INQ (ASC-SEL-SUB)                          07110027
071200                                   TO  TRUE                       07120027
071300             PERFORM 9200-REWRITE-SEL-QUEUE                       07130027
071400         ELSE                                                     07140027
071500             SUBTRACT +1 FROM ASC-SEL-SUB                         07150027
071600*            --- BOTTOM OF LIST ---                               07160027
071700             MOVE PC-TSYMSG-00070  TO  DP020-MSG-NUMBER           07170027
071800             SET DP020-MSG-INFORMATIONAL                          07180027
071900                                   TO  TRUE                       07190027
072000         END-IF                                                   07200027
072100     ELSE                                                         07210027
072200         SUBTRACT +1 FROM ASC-SEL-ITEM                            07220027
072300         MOVE PC017-MAX-ITEMS      TO  ASC-SEL-SUB                07230027
072400         MOVE PC-TSYMSG-00070      TO  DP020-MSG-NUMBER           07240027
072500         SET DP020-MSG-INFORMATIONAL                              07250027
072600                                   TO  TRUE                       07260027
072700     END-IF.                                                      07270027
072800                                                                  07280027
072900*----------------------------------------------------------------*07290027
073000*  GET THE MESSAGE NUMBER (KEY) OF THE PREVIOUS SELECTED         *07300027
073100*  OBJECT FROM THE SELECTED-ITEMS TEMP. STORAGE QUEUE.           *07310027
073200*----------------------------------------------------------------*07320027
073300                                                                  07330027
073400 2120-GET-PREV-LINE.                                              07340027
073500                                                                  07350027
073600     SUBTRACT +1 FROM ASC-SEL-SUB.                                07360027
073700     IF  ASC-SEL-SUB < +1                                         07370027
073800         SUBTRACT +1 FROM ASC-SEL-ITEM                            07380027
073900         MOVE PC017-MAX-ITEMS      TO ASC-SEL-SUB                 07390027
074000     END-IF.                                                      07400027
074100                                                                  07410027
074200     IF  ASC-SEL-ITEM > ZERO                                      07420027
074300         PERFORM 9100-READ-SEL-QUEUE                              07430027
074400         MOVE PC017-SCREEN-SEQ-NBR(ASC-SEL-SUB)                   07440027
074500                                   TO  ASC-SCREEN-SEQ-NBR         07450027
074600         MOVE PC017-WO-INSTR-SEQ-NBR(ASC-SEL-SUB)                 07460027
074700                                   TO  ASC-WO-INSTR-SEQ-NBR       07470027
074800         SET PC017-INQ (ASC-SEL-SUB)                              07480027
074900                                   TO  TRUE                       07490027
075000     ELSE                                                         07500027
075100         MOVE +1                   TO ASC-SEL-ITEM                07510027
075200                                      ASC-SEL-SUB                 07520027
075300*        --- TOP OF LIST ---                                      07530027
075400         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            07540027
075500         SET DP020-MSG-INFORMATIONAL                              07550027
075600                                   TO TRUE                        07560027
075700     END-IF.                                                      07570027
075800/                                                                 07580027
075900*----------------------------------------------------------------*07590027
076000* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS   *07600027
076100* IN THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN   *07610027
076200* THE APPLICATION-SPECIFIC COMMAERA, NOT ON THE SCREEN.          *07620027
076300*----------------------------------------------------------------*07630027
076400                                                                  07640027
076500 2200-MOVE-SCREEN-TO-COMMAREA.                                    07650027
076600                                                                  07660027
076700     IF  AOPERL   > ZERO                                          07670027
076800         MOVE AOPERI               TO  ASC-SCR-OPER-ID            07680027
076900     ELSE                                                         07690027
077000         IF  AOPERF   = DP015-ERASE-EOF                           07700027
077100             MOVE ZERO             TO  ASC-SCR-OPER-ID            07710027
077200         END-IF                                                   07720027
077300     END-IF.                                                      07730027
077400                                                                  07740027
077500*  IR-263:  ADDED PC000-OPERATING-UNIT-ID                         07750027
077600*                                                                 07760027
077700     IF  AOPUNIDL > ZERO                                          07770027
077800         MOVE AOPUNIDI           TO  ASC-SCR-OPER-UNT-ID          07780027
077900                                     PC000-OPERATING-UNIT-ID      07790027
078000     ELSE                                                         07800027
078100         IF  AOPUNIDF = DP015-ERASE-EOF                           07810027
078200             MOVE ZERO             TO  ASC-SCR-OPER-UNT-ID        07820027
078300         END-IF                                                   07830027
078400     END-IF.                                                      07840027
078500                                                                  07850027
078600     IF  AFACIDL  > ZERO                                          07860027
078700         MOVE AFACIDI              TO  ASC-SCR-FCLTY-ID           07870027
078800     ELSE                                                         07880027
078900         IF  AFACIDF  = DP015-ERASE-EOF                           07890027
079000             MOVE ZERO             TO  ASC-SCR-FCLTY-ID           07900027
079100         END-IF                                                   07910027
079200     END-IF.                                                      07920027
079300                                                                  07930027
079400     IF  AFACAIDL > ZERO                                          07940027
079500         MOVE AFACAIDI             TO  ASC-SCR-FCLTY-AREA-ID      07950027
079600     ELSE                                                         07960027
079700         IF  AFACAIDF = DP015-ERASE-EOF                           07970027
079800             MOVE ZERO             TO  ASC-SCR-FCLTY-AREA-ID      07980027
079900         END-IF                                                   07990027
080000     END-IF.                                                      08000027
080100                                                                  08010027
080200     IF  AACTCNTL > ZERO                                          08020027
080300         MOVE AACTCNTI             TO  ASC-ACTUAL-CARTONS         08030027
080400     ELSE                                                         08040027
080500         IF  AACTCNTF = DP015-ERASE-EOF                           08050027
080600             MOVE ZERO             TO  ASC-ACTUAL-CARTONS         08060027
080700         END-IF                                                   08070027
080800     END-IF.                                                      08080027
080900                                                                  08090027
081000     IF  ARPKCTNL > ZERO                                          08100027
081100         MOVE ARPKCTNI             TO  ASC-SCR-REPACK-IND         08110027
081200     ELSE                                                         08120027
081300         IF  ARPKCTNF = DP015-ERASE-EOF                           08130027
081400             MOVE SPACE            TO  ASC-SCR-REPACK-IND         08140027
081500         END-IF                                                   08150027
081600     END-IF.                                                      08160027
081700                                                                  08170027
081800     IF  ALINLOCL > ZERO                                          08180027
081900         MOVE ALINLOCI             TO  ASC-SCR-LNE-LOC-CDE        08190027
082000     ELSE                                                         08200027
082100         IF  ALINLOCF = DP015-ERASE-EOF                           08210027
082200             MOVE SPACE            TO  ASC-SCR-LNE-LOC-CDE        08220027
082300         END-IF                                                   08230027
082400     END-IF.                                                      08240027
082500/                                                                 08250027
082600*----------------------------------------------------------------*08260027
082700* PERFORM EDITS ON EACH FIELD ENTERED BY THE USER.  IF AN ERROR  *08270027
082800* IS FOUND, THE CURSOR IS POSITIONED AT THAT FIELD AND AN        *08280027
082900* APPROPRIATE ERROR MESSAGE IS DISPLAYED.                        *08290027
083000*----------------------------------------------------------------*08300027
083100                                                                  08310027
083200 3000-EDIT-DATA-IN-COMMAREA.                                      08320027
083300                                                                  08330027
083400     PERFORM 3200-RESET-ATTRIBUTES.                               08340027
083500                                                                  08350027
083600     IF  NOT ASC-DELETE-FUNCTION                                  08360027
083700         PERFORM 3010-ACTUAL-VALIDATE                             08370027
083800     END-IF.                                                      08380027
083900                                                                  08390027
084000     SET DP030-SET-CURSOR-APPL-1   TO  TRUE.                      08400027
084100     IF  NOT PS-ERROR                                             08410027
084200         IF  ASC-ADD-FUNCTION                                     08420027
084300             MOVE -1               TO  AOPUNIDL                   08430027
084400         ELSE                                                     08440027
084500             MOVE -1               TO  ALINLOCL                   08450027
084600         END-IF                                                   08460027
084700     END-IF.                                                      08470027
084800                                                                  08480027
084900 3010-ACTUAL-VALIDATE.                                            08490027
085000                                                                  08500027
085100     IF  ASC-SCR-REPACK-IND EQUAL PC-Y OR PC-N                    08510027
085200         CONTINUE                                                 08520027
085300     ELSE                                                         08530027
085400         IF  ASC-SCR-REPACK-IND EQUAL SPACE                       08540027
085500             MOVE PC-N             TO  ASC-SCR-REPACK-IND         08550027
085600                                       ARPKCTNO                   08560027
085700         ELSE                                                     08570027
085800             SET PS-ERROR          TO  TRUE                       08580027
085900             SET DP020-MSG-FATAL   TO  TRUE                       08590027
086000             MOVE PC-TSYMSG-00005  TO  DP020-MSG-NUMBER           08600027
086100             MOVE DP015-UNP-ALP-BRT-OFF                           08610027
086200                                   TO  ARPKCTNA                   08620027
086300             MOVE DP015-RED        TO  ARPKCTNC                   08630027
086400             MOVE DP015-REVERSE    TO  ARPKCTNH                   08640027
086500             MOVE -1               TO  ARPKCTNL                   08650027
086600         END-IF                                                   08660027
086700     END-IF.                                                      08670027
086800                                                                  08680027
086900     MOVE ASC-ACTUAL-CARTONS       TO  DP010I-UNEDITED-FIELD.     08690027
087000     MOVE PC-5                     TO  DP010I-MAXIMUM-DIGITS.     08700027
087100     MOVE ZERO                     TO  DP010I-MAXIMUM-DECIMALS.   08710027
087200     SET DP010I-NEGATIVE-NOT-ALLOWED                              08720027
087300                                   TO  TRUE.                      08730027
087410     CALL DP010I-NUMERIC-EDIT-ROUTINE                             08741037
087420                         USING DP010I-NUMERIC-EDIT-AREA           08742037
087500                                                                  08750027
087600     IF  DP010I-ERROR-DETECTED                                    08760027
087700         SET PS-ERROR              TO  TRUE                       08770027
087800         SET DP020-MSG-FATAL       TO  TRUE                       08780027
087900         MOVE PC-TSYMSG-00008      TO  DP020-MSG-NUMBER           08790027
088000         MOVE DP015-UNP-ALP-BRT-OFF                               08800027
088100                                   TO  AACTCNTA                   08810027
088200         MOVE DP015-RED            TO  AACTCNTC                   08820027
088300         MOVE DP015-REVERSE        TO  AACTCNTH                   08830027
088400         MOVE -1                   TO  AACTCNTL                   08840027
088500     ELSE                                                         08850027
088600         MOVE DP010I-NUMERIC-FIELD TO  ASC-ACTUAL-CARTONS         08860027
088700     END-IF.                                                      08870027
088800                                                                  08880027
088900     IF  NOT PS-ERROR                                             08890027
089000         IF  ASC-EXPECTED-CARTONS NOT EQUAL ASC-ACTUAL-CARTONS    08900027
089100             IF  ASC-SCR-REPACK-IND NOT EQUAL PC-Y                08910027
089200               MOVE 'REPACK IND MUST BE "Y" IF ACTUAL ^= EXPECTED'08920027
089300                                   TO  DP020-MSG-MESSAGE          08930027
089400                 SET DP020-MSG-FATAL                              08940027
089500                     PS-ERROR      TO  TRUE                       08950027
089600                 MOVE DP015-UNP-ALP-BRT-OFF                       08960027
089700                                   TO  ARPKCTNA                   08970027
089800                 MOVE DP015-RED    TO  ARPKCTNC                   08980027
089900                 MOVE DP015-REVERSE TO ARPKCTNH                   08990027
090000                 MOVE -1           TO  ARPKCTNL                   09000027
090100             END-IF                                               09010027
090200         END-IF                                                   09020027
090300     END-IF.                                                      09030027
090400                                                                  09040027
090500     IF  ASC-ADD-FUNCTION                                         09050027
090600         PERFORM 3020-CONTINUE-VALIDATE                           09060027
090700     END-IF.                                                      09070027
090800/                                                                 09080027
090900*----------------------------------------------------------------*09090027
091000*    THERE ARE SOME ADDITIONAL FIELDS TO CHECK WHEN THE          *09100027
091100*    OPERATOR IS PERFORMING AN ADD FUNCTION.  IF WE GET A HIT    *09110027
091200*    ON TOPERFA, ALL IS O.K., OTHERWISE, ERROR.                  *09120027
091300*----------------------------------------------------------------*09130027
091400                                                                  09140027
091500 3020-CONTINUE-VALIDATE.                                          09150027
091600                                                                  09160027
091700     PERFORM 4200-GET-TOPERAT.                                    09170027
091800     IF  SQLCODE EQUAL ZERO                                       09180027
091900         MOVE OPERAT-OPER-DESC     TO  ASC-OPER-DESC              09190027
092000     ELSE                                                         09200027
092100         SET PS-ERROR              TO  TRUE                       09210027
092200         SET DP020-MSG-FATAL       TO  TRUE                       09220027
092300         MOVE PC-TSYMSG-00148      TO  DP020-MSG-NUMBER           09230027
092400         MOVE DP015-UNP-ALP-BRT-OFF                               09240027
092500                                   TO  AOPERA                     09250027
092600         MOVE DP015-RED            TO  AOPERC                     09260027
092700         MOVE DP015-REVERSE        TO  AOPERH                     09270027
092800         MOVE -1                   TO  AOPERL                     09280027
092900     END-IF.                                                      09290027
093000                                                                  09300027
093100     PERFORM 4300-GET-TOPERFA.                                    09310027
093200     IF  SQLCODE EQUAL ZERO                                       09320027
093300         MOVE OPERFA-PRC-FCLTY-AREA-ID                            09330027
093400                                   TO  ASC-SCR-PRC-FCLTY-AREA-ID  09340027
093500     ELSE                                                         09350027
093600         SET PS-ERROR              TO  TRUE                       09360027
093700         SET DP020-MSG-FATAL       TO  TRUE                       09370027
093800         MOVE PC-TSYMSG-00148      TO  DP020-MSG-NUMBER           09380027
093900         MOVE DP015-UNP-ALP-BRT-OFF                               09390027
094000                                   TO  AFACAIDA                   09400027
094100                                       AOPERA                     09410027
094200                                       AOPUNIDA                   09420027
094300                                       AFACIDA                    09430027
094400         MOVE DP015-RED            TO  AFACAIDC                   09440027
094500                                       AOPERC                     09450027
094600                                       AOPUNIDC                   09460027
094700                                       AFACIDC                    09470027
094800         MOVE DP015-REVERSE        TO  AFACAIDH                   09480027
094900                                       AOPERH                     09490027
095000                                       AOPUNIDH                   09500027
095100                                       AFACIDH                    09510027
095200         MOVE -1                   TO  AOPERL                     09520027
095300     END-IF.                                                      09530027
095400/                                                                 09540027
095500*----------------------------------------------------------------*09550027
095600*    RESET THE DATA ENTERABLE FIELDS ATTRIBUTE, HIGHLIGHT, AND   *09560027
095700*    COLOR BYTES.                                                *09570027
095800*----------------------------------------------------------------*09580027
095900                                                                  09590027
096000 3200-RESET-ATTRIBUTES.                                           09600027
096100                                                                  09610027
096200     IF  ASC-DELETE-FUNCTION                                      09620027
096300         MOVE DP015-PRO-NOR-OFF                                   09630027
096400                                   TO AACTCNTA                    09640027
096500                                      ALINLOCA                    09650027
096600                                      ARPKCTNA                    09660027
096700         MOVE DP015-BLUE           TO AACTCNTC                    09670027
096800                                      ALINLOCC                    09680027
096900                                      ARPKCTNC                    09690027
097000         MOVE DP015-HL-OFF         TO AACTCNTH                    09700027
097100                                      ALINLOCH                    09710027
097200                                      ARPKCTNH                    09720027
097300     ELSE                                                         09730027
097400         MOVE DP015-UNP-ALP-NOR-OFF                               09740027
097500                                   TO AACTCNTA                    09750027
097600                                      ALINLOCA                    09760027
097700                                      ARPKCTNA                    09770027
097800         MOVE DP015-GREEN          TO AACTCNTC                    09780027
097900                                      ALINLOCC                    09790027
098000                                      ARPKCTNC                    09800027
098100         MOVE DP015-UNDERLINE      TO AACTCNTH                    09810027
098200                                      ALINLOCH                    09820027
098300                                      ARPKCTNH                    09830027
098400         IF  ASC-ADD-FUNCTION                                     09840027
098500             MOVE DP015-UNP-ALP-NOR-OFF                           09850027
098600                                   TO AOPERA                      09860027
098700                                      AOPUNIDA                    09870027
098800                                      AFACIDA                     09880027
098900                                      AFACAIDA                    09890027
099000             MOVE DP015-GREEN      TO AOPERC                      09900027
099100                                      AOPUNIDC                    09910027
099200                                      AFACIDC                     09920027
099300                                      AFACAIDC                    09930027
099400             MOVE DP015-UNDERLINE  TO AOPERH                      09940027
099500                                      AOPUNIDH                    09950027
099600                                      AFACIDH                     09960027
099700                                      AFACAIDH                    09970027
099800         END-IF                                                   09980027
099900     END-IF.                                                      09990027
100000/                                                                 10000027
100100*----------------------------------------------------------------*10010027
100200*    VALIDATE THE QUEUE WAS PASSED AND DISPLAY FOR THE FIRST     *10020027
100300*    ENTRY.                                                      *10030027
100400*----------------------------------------------------------------*10040027
100500                                                                  10050027
100600 4000-BUILD-INITIAL-PANEL.                                        10060027
100700                                                                  10070027
100800     INITIALIZE ASC-SCREEN-ENTERABLE-FIELDS.                      10080027
100900     MOVE PC017-PO-NBR             TO  ASC-KEY-PO-NBR.            10090027
101000     MOVE PC017-RCVR-SEQ-NBR       TO  ASC-KEY-RCVR-SEQ-NBR.      10100027
101100     MOVE PC017-WORK-ORD-SEQ-NBR   TO  ASC-KEY-WORK-ORD-SEQ-NBR.  10110027
101200     MOVE PC017-LINE-NBR           TO  ASC-KEY-LINE-NBR.          10120027
101300     SET DP030-SET-CURSOR-APPL-1   TO  TRUE.                      10130027
101400                                                                  10140027
101500     IF  ASC-ADD-FUNCTION                                         10150027
101600         MOVE SPACES               TO  ASC-SCR-START-DATE         10160027
101700                                       ASC-SCR-START-TIME         10170027
101800                                       ASC-SCR-STOP-DATE          10180027
101900                                       ASC-SCR-STOP-TIME          10190027
102000                                       ASC-SCR-REPACK-IND         10200027
102010*** DMH BEGIN - 11/06/08                                          10201031
102020         PERFORM 4010-GET-CURR-OPER                               10202031
102030         MOVE  ASC-CURR-OPER-UNT-ID                               10203031
102040                                   TO  ASC-SCR-OPER-UNT-ID        10204031
102050                                       PC000-OPERATING-UNIT-ID    10205035
102100***      MOVE PC000-OPERATING-UNIT-ID                             10210031
102200***                                TO  ASC-SCR-OPER-UNT-ID        10220031
102210*** DMH END   - 11/06/08                                          10221031
102300         MOVE PC000-FACILITY-ID    TO  ASC-SCR-FCLTY-ID           10230027
102400         MOVE -1                   TO  AOPUNIDL                   10240027
102500     ELSE                                                         10250027
102600         MOVE -1                   TO  ALINLOCL                   10260027
102700         PERFORM 4100-GET-TWKORIN                                 10270027
102800         IF  SQLCODE EQUAL ZERO                                   10280027
102900             MOVE WKORIN-OPER-ID   TO  ASC-SCR-OPER-ID            10290027
103000             MOVE WKORIN-OPER-UNT-ID                              10300027
103100                                   TO  ASC-SCR-OPER-UNT-ID        10310027
103200                                                                  10320027
103300             MOVE WKORIN-FCLTY-ID  TO  ASC-SCR-FCLTY-ID           10330027
103400             MOVE WKORIN-FCLTY-AREA-ID                            10340027
103500                                   TO  ASC-SCR-FCLTY-AREA-ID      10350027
103600                                                                  10360027
103700             MOVE WKORIN-EXPTED-CART-CNT                          10370027
103800                                   TO  ASC-SCR-EXPTED-CART-CNT    10380027
103900                                       ASC-EXPECTED-CARTONS       10390027
104000                                                                  10400027
104100             MOVE WKORIN-ACTL-CART-CNT                            10410027
104200                                   TO  ASC-SCR-ACTL-CART-CNT      10420027
104300                                       ASC-ACTUAL-CARTONS         10430027
104400                                       ASC-ORIG-ACTUAL-CARTONS    10440027
104500             MOVE WKORIN-REPACK-IND TO ASC-SCR-REPACK-IND         10450027
104600             MOVE WKORIN-LNE-LOC-CDE                              10460027
104700                                   TO  ASC-SCR-LNE-LOC-CDE        10470027
104800                                                                  10480027
104900             PERFORM 4200-GET-TOPERAT                             10490027
105000             MOVE OPERAT-OPER-DESC TO  ASC-OPER-DESC              10500027
105100                                                                  10510027
105200             MOVE WKORIN-STRT-TMST TO  PV-WORK-TMST               10520027
105300             IF  PV-WT-NULL-DATE                                  10530027
105400                 MOVE SPACES       TO  ASC-SCR-START-DATE         10540027
105500                                       ASC-SCR-START-TIME         10550027
105600             ELSE                                                 10560027
105700                 MOVE PV-WT-YR     TO  PV-SD-YR                   10570027
105800                 MOVE PV-WT-MO     TO  PV-SD-MO                   10580027
105900                 MOVE PV-WT-DA     TO  PV-SD-DA                   10590027
106000                 MOVE PV-WT-HH     TO  PV-SD-HH                   10600027
106100                 MOVE PV-WT-MM     TO  PV-SD-MM                   10610027
106200                 MOVE PV-WT-SS     TO  PV-SD-SS                   10620027
106300                 MOVE PV-SCREEN-DISPLAY-DATE                      10630027
106400                                   TO  ASC-SCR-START-DATE         10640027
106500                 MOVE PV-SCREEN-DISPLAY-TIME                      10650027
106600                                   TO  ASC-SCR-START-TIME         10660027
106700             END-IF                                               10670027
106800                                                                  10680027
106900             MOVE WKORIN-STOP-TMST TO  PV-WORK-TMST               10690027
107000             IF  PV-WT-NULL-DATE                                  10700027
107100                 MOVE SPACES       TO  ASC-SCR-STOP-DATE          10710027
107200                                       ASC-SCR-STOP-TIME          10720027
107300             ELSE                                                 10730027
107400                 MOVE PV-WT-YR     TO  PV-SD-YR                   10740027
107500                 MOVE PV-WT-MO     TO  PV-SD-MO                   10750027
107600                 MOVE PV-WT-DA     TO  PV-SD-DA                   10760027
107700                 MOVE PV-WT-HH     TO  PV-SD-HH                   10770027
107800                 MOVE PV-WT-MM     TO  PV-SD-MM                   10780027
107900                 MOVE PV-WT-SS     TO  PV-SD-SS                   10790027
108000                 MOVE PV-SCREEN-DISPLAY-DATE                      10800027
108100                                   TO  ASC-SCR-STOP-DATE          10810027
108200                 MOVE PV-SCREEN-DISPLAY-TIME                      10820027
108300                                   TO  ASC-SCR-STOP-TIME          10830027
108400             END-IF                                               10840027
108500         END-IF                                                   10850027
108600     END-IF.                                                      10860027
108700                                                                  10870027
108800     PERFORM DP017-0000-GET-CURR-DATE-TIME.                       10880027
108900     SET DP017-EDITED-YMD-DATE-DASH-1                             10890027
109000         DP017-EDITED-YMD-DATE-DASH-2                             10900027
109100                                TO  TRUE.                         10910027
109200     MOVE PC-PERIOD             TO  DP017-EDITED-TIME-SEPARATOR-1 10920027
109300                                    DP017-EDITED-TIME-SEPARATOR-2.10930027
109400     MOVE DP017-EDITED-DATE-YYYYMMDD TO  ASC-CT-DATE.             10940027
109500     MOVE DP017-EDITED-TIME-HMS      TO  ASC-CT-TIME.             10950027
109600     SET ASC-CT-DASH1                                             10960027
109700         ASC-CT-ZERO1                TO  TRUE.                    10970027
109701                                                                  10970131
109702                                                                  10970231
109710*----------------------------------------------------------------*10971031
109720* SELECT CURRENT OPER UNIT FOR RECEIVER - WORK ORDER INSTRUCTIONS*10972031
109730* ARE BASED ON THE CURRENT OPER UNIT ID OF THE RECEIVER          *10973031
109740*---------------------------------------------------------------- 10974031
109750 4010-GET-CURR-OPER.                                              10975031
109760                                                                  10976031
109770         EXEC SQL                                                 10977031
109780              SELECT                                              10978031
109790                     CURR_OPER_UNT_ID                             10979031
109791             INTO                                                 10979131
109792                    :RECEIV-CURR-OPER-UNT-ID                      10979231
109793             FROM                                                 10979331
109794                    TRECEIV                                       10979431
109795             WHERE                                                10979531
109796                     ORD_NBR          =  :ASC-KEY-PO-NBR          10979631
109797              AND    REC_SEQ_NBR      =  :ASC-KEY-RCVR-SEQ-NBR    10979731
109798              AND    VER_STATUS_CDE   =  :PC-A                    10979831
109799         END-EXEC.                                                10979931
109800                                                                  10980031
109801         EVALUATE TRUE                                            10980131
109802             WHEN SQLCODE = ZERO                                  10980231
109803                  MOVE  RECEIV-CURR-OPER-UNT-ID                   10980332
109804                    TO  ASC-CURR-OPER-UNT-ID                      10980432
109805                                                                  10980532
109806             WHEN SQLCODE = +100                                  10980631
109807                   MOVE PC000-OPERATING-UNIT-ID                   10980732
109808                    TO  ASC-CURR-OPER-UNT-ID                      10980832
109809                                                                  10980932
109810             WHEN SQLCODE = -904                                  10981031
109811             WHEN SQLCODE = -913                                  10981131
109812                  PERFORM 9900-SOFT-ABORT                         10981231
109813             WHEN SQLWARN0 NOT = SPACES                           10981331
109814             WHEN SQLCODE NOT EQUAL ZERO                          10981431
109815                 MOVE '4010-GET-CURR-OPER'                        10981531
109816                                   TO DP013-PARAGRAPH             10981631
109817                 MOVE 'SELECT CURR OPER FOR RECEIOVER'            10981731
109818                                   TO DP013-MESSAGE-TEXT (1)      10981831
109819                 MOVE SQLCA        TO DP013-SQLCA                 10981931
109820                 MOVE 'TRECEIV'    TO DP013-DB2-TABLE-NAME (1)    10982031
109821                 SET DP013-DB2-ABEND                              10982131
109822                     DP013-XCTL-DISPLAY-RESTART                   10982231
109823                                   TO TRUE                        10982331
109824                 PERFORM DP013-0000-PROCESS-ABEND                 10982431
109825         END-EVALUATE.                                            10982531
109826                                                                  10982631
109827                                                                  10982731
109830/                                                                 10983027
109900*----------------------------------------------------------------*10990027
110000* SELECT A ROW FROM THE DB2 TWKORIN TABLE.                       *11000027
110100*----------------------------------------------------------------*11010027
110200                                                                  11020027
110300 4100-GET-TWKORIN.                                                11030027
110400                                                                  11040027
110500         EXEC SQL                                                 11050027
110600              SELECT                                              11060027
110700                     OPER_ID                                      11070027
110800                   , OPER_UNT_ID                                  11080027
110900                   , FCLTY_ID                                     11090027
111000                   , FCLTY_AREA_ID                                11100027
111100                   , EXPTED_CART_CNT                              11110027
111200                   , ACTL_CART_CNT                                11120027
111300                   , REPACK_IND                                   11130027
111400                   , STRT_TMST                                    11140027
111500                   , STOP_TMST                                    11150027
111600                   , LNE_LOC_CDE                                  11160027
111700             INTO                                                 11170027
111800                    :WKORIN-OPER-ID                               11180027
111900                  , :WKORIN-OPER-UNT-ID                           11190027
112000                  , :WKORIN-FCLTY-ID                              11200027
112100                  , :WKORIN-FCLTY-AREA-ID                         11210027
112200                  , :WKORIN-EXPTED-CART-CNT                       11220027
112300                  , :WKORIN-ACTL-CART-CNT                         11230027
112400                  , :WKORIN-REPACK-IND                            11240027
112500                  , :WKORIN-STRT-TMST                             11250027
112600                  , :WKORIN-STOP-TMST                             11260027
112700                  , :WKORIN-LNE-LOC-CDE                           11270027
112800             FROM                                                 11280027
112900                    TWKORIN                                       11290027
113000             WHERE                                                11300027
113100                     ORD_NBR          =  :ASC-KEY-PO-NBR          11310027
113200              AND    RCVR_SEQ_NBR     =  :ASC-KEY-RCVR-SEQ-NBR    11320027
113300              AND    ORD_LNE_NBR      =  :ASC-KEY-LINE-NBR        11330027
113400              AND    WORK_ORD_SEQ_NBR =  :ASC-KEY-WORK-ORD-SEQ-NBR11340027
113500              AND    WO_INSTR_SEQ_NBR =  :ASC-WO-INSTR-SEQ-NBR    11350027
113600              AND    VER_STATUS_CDE   =  :PC-A                    11360027
113700         END-EXEC.                                                11370027
113800                                                                  11380027
113900         EVALUATE TRUE                                            11390027
114000             WHEN SQLCODE = ZERO                                  11400027
114100             WHEN SQLCODE = +100                                  11410027
114200                  CONTINUE                                        11420027
114300             WHEN SQLCODE = -904                                  11430027
114400             WHEN SQLCODE = -913                                  11440027
114500                  PERFORM 9900-SOFT-ABORT                         11450027
114600             WHEN SQLWARN0 NOT = SPACES                           11460027
114700             WHEN SQLCODE NOT EQUAL ZERO                          11470027
114800                 MOVE '4100-GET-TWKORIN'                          11480027
114900                                   TO DP013-PARAGRAPH             11490027
115000                 MOVE 'SELECT WORK ORDER INSTRUSTION'             11500027
115100                                   TO DP013-MESSAGE-TEXT (1)      11510027
115200                 MOVE SQLCA        TO DP013-SQLCA                 11520027
115300                 MOVE 'TWKORIN'    TO DP013-DB2-TABLE-NAME (1)    11530027
115400                 SET DP013-DB2-ABEND                              11540027
115500                     DP013-XCTL-DISPLAY-RESTART                   11550027
115600                                   TO TRUE                        11560027
115700                 PERFORM DP013-0000-PROCESS-ABEND                 11570027
115800         END-EVALUATE.                                            11580027
115900/                                                                 11590027
116000*----------------------------------------------------------------*11600027
116100* SELECT A ROW FROM THE DB2 TOPERAT TABLE.                       *11610027
116200*----------------------------------------------------------------*11620027
116300                                                                  11630027
116400 4200-GET-TOPERAT.                                                11640027
116500                                                                  11650027
116600         EXEC SQL                                                 11660027
116700              SELECT                                              11670027
116800                     OPER_DESC                                    11680027
116900             INTO                                                 11690027
117000                    :OPERAT-OPER-DESC                             11700027
117100             FROM                                                 11710027
117200                    TOPERAT                                       11720027
117300             WHERE                                                11730027
117400                     OPER_ID          =  :ASC-SCR-OPER-ID         11740027
117500              AND    VER_STATUS_CDE   =  :PC-A                    11750027
117600         END-EXEC.                                                11760027
117700                                                                  11770027
117800         EVALUATE TRUE                                            11780027
117900             WHEN SQLCODE = ZERO                                  11790027
118000             WHEN SQLCODE = +100                                  11800027
118100                  CONTINUE                                        11810027
118200             WHEN SQLCODE = -904                                  11820027
118300             WHEN SQLCODE = -913                                  11830027
118400                  PERFORM 9900-SOFT-ABORT                         11840027
118500             WHEN SQLWARN0 NOT = SPACES                           11850027
118600             WHEN SQLCODE NOT EQUAL ZERO                          11860027
118700                 MOVE '4200-GET-TOPERAT'                          11870027
118800                                   TO DP013-PARAGRAPH             11880027
118900                 MOVE 'SELECT OPERATION DESCRIPTION'              11890027
119000                                   TO DP013-MESSAGE-TEXT (1)      11900027
119100                 MOVE SQLCA        TO DP013-SQLCA                 11910027
119200                 MOVE 'TOPERAT'    TO DP013-DB2-TABLE-NAME (1)    11920027
119300                 SET DP013-DB2-ABEND                              11930027
119400                     DP013-XCTL-DISPLAY-RESTART                   11940027
119500                                   TO TRUE                        11950027
119600                 PERFORM DP013-0000-PROCESS-ABEND                 11960027
119700         END-EVALUATE.                                            11970027
119800/                                                                 11980027
119900*----------------------------------------------------------------*11990027
120000* SELECT A ROW FROM THE DB2 TOPERFA TABLE.                       *12000027
120100*----------------------------------------------------------------*12010027
120200                                                                  12020027
120300 4300-GET-TOPERFA.                                                12030027
120400                                                                  12040027
120500         EXEC SQL                                                 12050027
120600              SELECT                                              12060027
120700                     FCLTY_AREA_ID                                12070027
120800                   , PRC_FCLTY_AREA_ID                            12080027
120900             INTO                                                 12090027
121000                    :OPERFA-FCLTY-AREA-ID                         12100027
121100                  , :OPERFA-PRC-FCLTY-AREA-ID                     12110027
121200             FROM                                                 12120027
121300                    TOPERFA                                       12130027
121400             WHERE                                                12140027
121500                     OPER_ID          =  :ASC-SCR-OPER-ID         12150027
121600              AND    OPER_UNT_ID      =  :ASC-SCR-OPER-UNT-ID     12160027
121700              AND    FCLTY_ID         =  :ASC-SCR-FCLTY-ID        12170027
121800              AND    FCLTY_AREA_ID    =  :ASC-SCR-FCLTY-AREA-ID   12180027
121900              AND    VER_STATUS_CDE   =  :PC-A                    12190027
122000         END-EXEC.                                                12200027
122100                                                                  12210027
122200         EVALUATE TRUE                                            12220027
122300             WHEN SQLCODE = ZERO                                  12230027
122400             WHEN SQLCODE = +100                                  12240027
122500                  CONTINUE                                        12250027
122600             WHEN SQLCODE = -904                                  12260027
122700             WHEN SQLCODE = -913                                  12270027
122800                  PERFORM 9900-SOFT-ABORT                         12280027
122900             WHEN SQLWARN0 NOT = SPACES                           12290027
123000             WHEN SQLCODE NOT EQUAL ZERO                          12300027
123100                 MOVE '4300-GET-TOPERFA'                          12310027
123200                                   TO DP013-PARAGRAPH             12320027
123300                 MOVE 'SELECT FACILTY AREA ID'                    12330027
123400                                   TO DP013-MESSAGE-TEXT (1)      12340027
123500                 MOVE SQLCA        TO DP013-SQLCA                 12350027
123600                 MOVE 'TOPERFA'    TO DP013-DB2-TABLE-NAME (1)    12360027
123700                 SET DP013-DB2-ABEND                              12370027
123800                     DP013-XCTL-DISPLAY-RESTART                   12380027
123900                                   TO TRUE                        12390027
124000                 PERFORM DP013-0000-PROCESS-ABEND                 12400027
124100         END-EVALUATE.                                            12410027
124200/                                                                 12420027
124300*----------------------------------------------------------------*12430027
124400*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *12440027
124500*----------------------------------------------------------------*12450027
124600                                                                  12460027
124700 4400-MOVE-COMMAREA-TO-SCREEN.                                    12470027
124800                                                                  12480027
124900     IF  PS-SOFT-ABORT                                            12490027
125000         MOVE PC-TSYMSG-00551      TO  DP020-MSG-NUMBER           12500027
125100     END-IF.                                                      12510027
125200                                                                  12520027
125300     MOVE PC000-OPERATING-UNIT-ID  TO  AOPERIDO.                  12530027
125400     MOVE PC000-FACILITY-ID        TO  AFACLIDO.                  12540027
125500                                                                  12550027
125600     MOVE ASC-KEY-PO-NBR           TO  ARECVRO.                   12560027
125700     MOVE ASC-KEY-RCVR-SEQ-NBR     TO  AHSEQO.                    12570027
125800     MOVE ASC-KEY-LINE-NBR         TO  ALINEO.                    12580027
125900     MOVE ASC-KEY-WORK-ORD-SEQ-NBR TO  AWORDERO.                  12590027
126000                                                                  12600027
126100     MOVE ASC-SCREEN-SEQ-NBR       TO  ASSEQO.                    12610027
126200     MOVE ASC-SCR-OPER-ID          TO  AOPERO.                    12620027
126300     MOVE ASC-SCR-OPER-UNT-ID      TO  AOPUNIDO.                  12630027
126400                                                                  12640027
126500     MOVE ASC-SCR-FCLTY-ID         TO  AFACIDO.                   12650027
126600     MOVE ASC-SCR-FCLTY-AREA-ID    TO  AFACAIDO.                  12660027
126700     MOVE ASC-SCR-REPACK-IND       TO  ARPKCTNO.                  12670027
126800     MOVE ASC-SCR-LNE-LOC-CDE      TO  ALINLOCO.                  12680027
126900                                                                  12690027
127000     MOVE ASC-SCR-START-DATE       TO  ASDATEO.                   12700027
127100     MOVE ASC-SCR-START-TIME       TO  ASTIMEO.                   12710027
127200     MOVE ASC-SCR-STOP-DATE        TO  AEDATEO.                   12720027
127300     MOVE ASC-SCR-STOP-TIME        TO  AETIMEO.                   12730027
127400                                                                  12740027
127500     MOVE SPACES                   TO  AWODESCO.                  12750027
127600     STRING ASC-OPER-DESC         DELIMITED BY '  '               12760027
127700            ' '                   DELIMITED BY SIZE               12770027
127800            ASC-SCR-FCLTY-AREA-ID DELIMITED BY '  '               12780027
127900                                 INTO  AWODESCO.                  12790027
128000                                                                  12800027
128100     MOVE ASC-SCR-PRC-FCLTY-AREA-ID                               12810027
128200                                   TO  APRFAIDO.                  12820027
128300                                                                  12830027
128400     IF  ASC-EXPECTED-CARTONS NUMERIC                             12840027
128500         MOVE ASC-EXPECTED-CARTONS TO  AECTCNTO                   12850027
128600     END-IF.                                                      12860027
128700     IF  ASC-ACTUAL-CARTONS NUMERIC                               12870027
128800         MOVE ASC-ACTUAL-CARTONS   TO  AACTCNTO                   12880027
128900     END-IF.                                                      12890027
129000/                                                                 12900027
129100*----------------------------------------------------------------*12910027
129200*    DETERMINE WHETHER THIS IS AN ADD, UPDATE, OR DELETE AND     *12920027
129300*    BRANCH ACCORDINGLY.                                         *12930027
129400*----------------------------------------------------------------*12940027
129500                                                                  12950027
129600 5000-BEGIN-MAINT-PROCESS.                                        12960027
129700                                                                  12970027
129800     EVALUATE TRUE                                                12980027
129900         WHEN ASC-ADD-FUNCTION                                    12990027
130000              PERFORM 5100-ADD-PROCESS                            13000027
130100         WHEN ASC-UPDATE-FUNCTION                                 13010027
130200              PERFORM 5200-UPDATE-PROCESS                         13020027
130300         WHEN ASC-DELETE-FUNCTION                                 13030027
130400              PERFORM 5300-DELETE-PROCESS                         13040027
130500     END-EVALUATE.                                                13050027
130600/                                                                 13060027
130700*----------------------------------------------------------------*13070027
130800*    1.)  UPDATE ALL ROWS, FROM ROW SELECTED TO END, WITH        *13080027
130900*         NEW SCREEN SEQUENCE NUMBER (ADD 1 TO EACH).            *13090027
131000*    2.)  GET THE MAX WORK ORDER INSTRUCTION NUMBER              *13100027
131100*    3.)  INSERT NEW ROW, COMMIT.                                *13110027
131200*----------------------------------------------------------------*13120027
131300                                                                  13130027
131400 5100-ADD-PROCESS.                                                13140027
131500                                                                  13150027
131600     PERFORM 5110-OPEN-CURSOR.                                    13160027
131700     PERFORM 5120-PROCESS-CURSOR                                  13170027
131800         UNTIL SQLCODE NOT EQUAL ZERO.                            13180027
131900     PERFORM 5130-CLOSE-CURSOR.                                   13190027
132000     PERFORM 5140-GET-MAX-WO-INSTR.                               13200027
132100     PERFORM 5150-INSERT-NEW-TWKORIN.                             13210027
132200/                                                                 13220027
132300*----------------------------------------------------------------*13230027
132400*    OPEN THE CURSOR USED FOR THE ADD PROCESS.                   *13240027
132500*----------------------------------------------------------------*13250027
132600                                                                  13260027
132700 5110-OPEN-CURSOR.                                                13270027
132800                                                                  13280027
132900                                                                  13290027
133000     EXEC SQL                                                     13300027
133100          OPEN ADD-CSR                                            13310027
133200     END-EXEC.                                                    13320027
133300                                                                  13330027
133400     EVALUATE TRUE                                                13340027
133500         WHEN SQLCODE = ZERO                                      13350027
133600         WHEN SQLCODE = -904                                      13360027
133700         WHEN SQLCODE = -913                                      13370027
133800             CONTINUE                                             13380027
133900         WHEN SQLWARN0 NOT = SPACES                               13390027
134000         WHEN SQLCODE < ZERO                                      13400027
134100         WHEN SQLCODE > ZERO                                      13410027
134200             MOVE '5110-OPEN-CURSOR'                              13420027
134300                               TO DP013-PARAGRAPH                 13430027
134400             MOVE 'OPEN ADD CURSOR - '                            13440027
134500                               TO DP013-MESSAGE-TEXT (1)          13450027
134600             MOVE SQLCA        TO DP013-SQLCA                     13460027
134700             MOVE 'TWKORIN '   TO DP013-DB2-TABLE-NAME (1)        13470027
134800             SET DP013-DB2-ABEND                                  13480027
134900                 DP013-XCTL-DISPLAY-RESTART TO TRUE               13490027
135000             PERFORM DP013-0000-PROCESS-ABEND                     13500027
135100     END-EVALUATE.                                                13510027
135200/                                                                 13520027
135300*----------------------------------------------------------------*13530027
135400*    NOW, TRAVERSE THE ROWS, UPDATING AND INSERTING.             *13540027
135500*----------------------------------------------------------------*13550027
135600                                                                  13560027
135700 5120-PROCESS-CURSOR.                                             13570027
135800                                                                  13580027
135900     PERFORM 5122-FETCH-CURSOR.                                   13590027
136000     IF  SQLCODE EQUAL ZERO                                       13600027
136100         PERFORM 5124-UPDATE-TWKORIN                              13610027
136200         PERFORM 5126-INSERT-TWKORIN                              13620027
136300     END-IF.                                                      13630027
136400                                                                  13640027
136500 5122-FETCH-CURSOR.                                               13650027
136600                                                                  13660027
136700     EXEC SQL                                                     13670027
136800          FETCH                                                   13680027
136900                ADD-CSR                                           13690027
137000          INTO                                                    13700027
137100               :WKORIN-ORD-NBR                                    13710027
137200              ,:WKORIN-RCVR-SEQ-NBR                               13720027
137300              ,:WKORIN-ORD-LNE-NBR                                13730027
137400              ,:WKORIN-WORK-ORD-SEQ-NBR                           13740027
137500              ,:WKORIN-WO-INSTR-SEQ-NBR                           13750027
137600              ,:WKORIN-CRE-TMST                                   13760027
137700              ,:WKORIN-VER-STATUS-CDE                             13770027
137800              ,:WKORIN-CRE-UID-ID                                 13780027
137900              ,:WKORIN-OPER-ID                                    13790027
138000              ,:WKORIN-OPER-UNT-ID                                13800027
138100              ,:WKORIN-FCLTY-ID                                   13810027
138200              ,:WKORIN-FCLTY-AREA-ID                              13820027
138300              ,:WKORIN-PRC-FCLTY-AREA-ID                          13830027
138400              ,:WKORIN-EXPTED-CART-CNT                            13840027
138500              ,:WKORIN-ACTL-CART-CNT                              13850027
138600              ,:WKORIN-ALLOC-IND                                  13860027
138700              ,:WKORIN-REPACK-IND                                 13870027
138800              ,:WKORIN-STRT-TMST                                  13880027
138900              ,:WKORIN-STOP-TMST                                  13890027
139000              ,:WKORIN-SCREEN-SEQ-NBR                             13900027
139100              ,:WKORIN-LNE-LOC-CDE                                13910027
139200              ,:WKORIN-REC-SEL-IND                                13920027
139300     END-EXEC.                                                    13930027
139400                                                                  13940027
139500     EVALUATE TRUE                                                13950027
139600         WHEN SQLCODE = ZERO                                      13960027
139700         WHEN SQLCODE = +100                                      13970027
139800              CONTINUE                                            13980027
139900         WHEN SQLWARN0 NOT = SPACE                                13990027
140000         WHEN SQLCODE NOT = ZERO                                  14000027
140100              MOVE '5122-FETCH-CURSOR'                            14010027
140200                               TO DP013-PARAGRAPH                 14020027
140300              MOVE 'FETCH ADD CURSOR'                             14030027
140400                               TO DP013-MESSAGE-TEXT (1)          14040027
140500              MOVE SQLCA       TO DP013-SQLCA                     14050027
140600              SET DP013-DB2-ABEND                                 14060027
140700                               TO TRUE                            14070027
140800              PERFORM DP013-0000-PROCESS-ABEND                    14080027
140900     END-EVALUATE.                                                14090027
141000/                                                                 14100027
141100*----------------------------------------------------------------*14110027
141200*    UPDATE THE CURRENT ROW.                                     *14120027
141300*----------------------------------------------------------------*14130027
141400                                                                  14140027
141500 5124-UPDATE-TWKORIN.                                             14150027
141600                                                                  14160027
141700     EXEC SQL                                                     14170027
141800          UPDATE                                                  14180027
141900                 TWKORIN                                          14190027
142000             SET                                                  14200027
142100                 VER_STATUS_CDE      =  :PC-I                     14210027
142200           WHERE                                                  14220027
142300                 CURRENT OF ADD-CSR                               14230027
142400     END-EXEC.                                                    14240027
142500                                                                  14250027
142600     EVALUATE TRUE                                                14260027
142700         WHEN SQLCODE = ZERO                                      14270027
142800              CONTINUE                                            14280027
142900         WHEN SQLCODE = -904                                      14290027
143000         WHEN SQLCODE = -913                                      14300027
143100              PERFORM 9900-SOFT-ABORT                             14310027
143200         WHEN SQLWARN0 NOT = SPACES                               14320027
143300         WHEN SQLCODE NOT EQUAL ZERO                              14330027
143400              MOVE '5124-UPDATE-TWKORIN'                          14340027
143500                                   TO DP013-PARAGRAPH             14350027
143600              MOVE 'UPDATE VIA ADD CURSOR'                        14360027
143700                                   TO DP013-MESSAGE-TEXT (1)      14370027
143800              MOVE SQLCA           TO DP013-SQLCA                 14380027
143900              MOVE 'TWKORIN'       TO DP013-DB2-TABLE-NAME (1)    14390027
144000              SET DP013-DB2-ABEND                                 14400027
144100                  DP013-XCTL-DISPLAY-RESTART                      14410027
144200                                   TO TRUE                        14420027
144300              PERFORM DP013-0000-PROCESS-ABEND                    14430027
144400     END-EVALUATE.                                                14440027
144500/                                                                 14450027
144600*----------------------------------------------------------------*14460027
144700*    INSERT THE "UPDATED ACTIVE ROW"                             *14470027
144800*----------------------------------------------------------------*14480027
144900                                                                  14490027
145000 5126-INSERT-TWKORIN.                                             14500027
145100                                                                  14510027
145200     ADD 1                     TO  WKORIN-SCREEN-SEQ-NBR.         14520027
145300                                                                  14530027
145400     EXEC SQL                                                     14540027
145500          INSERT                                                  14550027
145600          INTO  TWKORIN                                           14560027
145700               (ORD_NBR                                           14570027
145800               ,RCVR_SEQ_NBR                                      14580027
145900               ,ORD_LNE_NBR                                       14590027
146000               ,WORK_ORD_SEQ_NBR                                  14600027
146100               ,WO_INSTR_SEQ_NBR                                  14610027
146200               ,CRE_TMST                                          14620027
146300               ,VER_STATUS_CDE                                    14630027
146400               ,CRE_UID_ID                                        14640027
146500               ,OPER_ID                                           14650027
146600               ,OPER_UNT_ID                                       14660027
146700               ,FCLTY_ID                                          14670027
146800               ,FCLTY_AREA_ID                                     14680027
146900               ,PRC_FCLTY_AREA_ID                                 14690027
147000               ,EXPTED_CART_CNT                                   14700027
147100               ,ACTL_CART_CNT                                     14710027
147200               ,ALLOC_IND                                         14720027
147300               ,REPACK_IND                                        14730027
147400               ,STRT_TMST                                         14740027
147500               ,STOP_TMST                                         14750027
147600               ,SCREEN_SEQ_NBR                                    14760027
147700               ,LNE_LOC_CDE                                       14770027
147800               ,REC_SEL_IND)                                      14780027
147900        VALUES                                                    14790027
148000              (:WKORIN-ORD-NBR                                    14800027
148100              ,:WKORIN-RCVR-SEQ-NBR                               14810027
148200              ,:WKORIN-ORD-LNE-NBR                                14820027
148300              ,:WKORIN-WORK-ORD-SEQ-NBR                           14830027
148400              ,:WKORIN-WO-INSTR-SEQ-NBR                           14840027
148500              , CURRENT TIMESTAMP                                 14850027
148600              ,:PC-A                                              14860027
148700              ,:WKORIN-CRE-UID-ID                                 14870027
148800              ,:WKORIN-OPER-ID                                    14880027
148900              ,:WKORIN-OPER-UNT-ID                                14890027
149000              ,:WKORIN-FCLTY-ID                                   14900027
149100              ,:WKORIN-FCLTY-AREA-ID                              14910027
149200              ,:WKORIN-PRC-FCLTY-AREA-ID                          14920027
149300              ,:WKORIN-EXPTED-CART-CNT                            14930027
149400              ,:WKORIN-ACTL-CART-CNT                              14940027
149500              ,:WKORIN-ALLOC-IND                                  14950027
149600              ,:WKORIN-REPACK-IND                                 14960027
149700              ,:WKORIN-STRT-TMST                                  14970027
149800              ,:WKORIN-STOP-TMST                                  14980027
149900              ,:WKORIN-SCREEN-SEQ-NBR                             14990027
150000              ,:WKORIN-LNE-LOC-CDE                                15000027
150100              ,:WKORIN-REC-SEL-IND)                               15010027
150200     END-EXEC.                                                    15020027
150300                                                                  15030027
150400     EVALUATE TRUE                                                15040027
150500         WHEN SQLCODE = ZERO                                      15050027
150600              CONTINUE                                            15060027
150700         WHEN SQLCODE = -904                                      15070027
150800         WHEN SQLCODE = -913                                      15080027
150900              PERFORM 9900-SOFT-ABORT                             15090027
151000         WHEN SQLWARN0 NOT = SPACES                               15100027
151100         WHEN SQLCODE NOT EQUAL ZERO                              15110027
151200              MOVE '5126-INSERT-TWKORIN'                          15120027
151300                                   TO DP013-PARAGRAPH             15130027
151400              MOVE 'INSERT DURING ADD PROCESS'                    15140027
151500                                   TO DP013-MESSAGE-TEXT (1)      15150027
151600              MOVE SQLCA           TO DP013-SQLCA                 15160027
151700              MOVE 'TWKORIN'       TO DP013-DB2-TABLE-NAME (1)    15170027
151800              SET DP013-DB2-ABEND                                 15180027
151900                  DP013-XCTL-DISPLAY-RESTART                      15190027
152000                                   TO TRUE                        15200027
152100              PERFORM DP013-0000-PROCESS-ABEND                    15210027
152200     END-EVALUATE.                                                15220027
152300/                                                                 15230027
152400*----------------------------------------------------------------*15240027
152500*    CLOSE THE CURSOR USED FOR THE ADD PROCESS.                  *15250027
152600*----------------------------------------------------------------*15260027
152700                                                                  15270027
152800 5130-CLOSE-CURSOR.                                               15280027
152900                                                                  15290027
153000         EXEC SQL                                                 15300027
153100              CLOSE ADD-CSR                                       15310027
153200         END-EXEC.                                                15320027
153300                                                                  15330027
153400         EVALUATE TRUE                                            15340027
153500             WHEN SQLCODE = ZERO                                  15350027
153600             WHEN SQLCODE = -904                                  15360027
153700             WHEN SQLCODE = -913                                  15370027
153800                 CONTINUE                                         15380027
153900             WHEN SQLWARN0 NOT = SPACES                           15390027
154000             WHEN SQLCODE < ZERO                                  15400027
154100             WHEN SQLCODE > ZERO                                  15410027
154200                 MOVE '5130-CLOSE-CURSOR'                         15420027
154300                                   TO DP013-PARAGRAPH             15430027
154400                 MOVE 'CLOSE ADD CURSOR - '                       15440027
154500                                   TO DP013-MESSAGE-TEXT (1)      15450027
154600                 MOVE SQLCA        TO DP013-SQLCA                 15460027
154700                 MOVE 'TWKORIN '   TO DP013-DB2-TABLE-NAME (1)    15470027
154800                 SET DP013-DB2-ABEND                              15480027
154900                     DP013-XCTL-DISPLAY-RESTART TO TRUE           15490027
155000                 PERFORM DP013-0000-PROCESS-ABEND                 15500027
155100         END-EVALUATE.                                            15510027
155200/                                                                 15520027
155300*----------------------------------------------------------------*15530027
155400*    GET THE MAXIMUM WORK ORDER INSTRUCTION SEQUENCE NUMBER      *15540027
155500*----------------------------------------------------------------*15550027
155600                                                                  15560027
155700 5140-GET-MAX-WO-INSTR.                                           15570027
155800                                                                  15580027
155900     MOVE ZERO      TO  WKORIN-WO-INSTR-SEQ-NBR.                  15590027
156000         EXEC SQL                                                 15600027
156100              SELECT                                              15610027
156200                    MAX(WO_INSTR_SEQ_NBR)                         15620027
156300              INTO                                                15630027
156400                   :WKORIN-WO-INSTR-SEQ-NBR :PV-NULL-IND          15640027
156500              FROM                                                15650027
156600                    TWKORIN                                       15660027
156700             WHERE                                                15670027
156800                    ORD_NBR          =  :ASC-KEY-PO-NBR           15680027
156900              AND   RCVR_SEQ_NBR     =  :ASC-KEY-RCVR-SEQ-NBR     15690027
157000              AND   ORD_LNE_NBR      =  :ASC-KEY-LINE-NBR         15700027
157100              AND   WORK_ORD_SEQ_NBR =  :ASC-KEY-WORK-ORD-SEQ-NBR 15710027
157200         END-EXEC.                                                15720027
157300                                                                  15730027
157400         EVALUATE TRUE                                            15740027
157500             WHEN SQLCODE = ZERO                                  15750027
157600             WHEN SQLCODE = +100                                  15760027
157700                 CONTINUE                                         15770027
157800             WHEN SQLCODE = -904                                  15780027
157900             WHEN SQLCODE = -913                                  15790027
158000                  PERFORM 9900-SOFT-ABORT                         15800027
158100             WHEN SQLWARN0 NOT = SPACES                           15810027
158200             WHEN SQLCODE < ZERO                                  15820027
158300             WHEN SQLCODE > ZERO                                  15830027
158400                 MOVE '5140-GET-MAX-WO-INSTR'                     15840027
158500                                   TO DP013-PARAGRAPH             15850027
158600                 MOVE 'GET MAX WO INSTRUCTION SEQ NBR'            15860027
158700                                   TO DP013-MESSAGE-TEXT(1)       15870027
158800                 MOVE SQLCA        TO DP013-SQLCA                 15880027
158900                 MOVE 'TWKORIN'    TO DP013-DB2-TABLE-NAME (1)    15890027
159000                 SET DP013-DB2-ABEND                              15900027
159100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           15910027
159200                 PERFORM DP013-0000-PROCESS-ABEND                 15920027
159300         END-EVALUATE.                                            15930027
159400/                                                                 15940027
159500*----------------------------------------------------------------*15950027
159600*    FINALLY, INSERT THE NEW ROW.                                *15960027
159700*----------------------------------------------------------------*15970027
159800                                                                  15980027
159900 5150-INSERT-NEW-TWKORIN.                                         15990027
160000                                                                  16000027
160100     MOVE ASC-EXPECTED-CARTONS TO  WKORIN-EXPTED-CART-CNT.        16010027
160200     MOVE ASC-ACTUAL-CARTONS   TO  WKORIN-ACTL-CART-CNT.          16020027
160300     MOVE ASC-SCR-REPACK-IND   TO  WKORIN-REPACK-IND.             16030027
160400                                                                  16040027
160500     MOVE ASC-KEY-PO-NBR       TO  WKORIN-ORD-NBR.                16050027
160600     MOVE ASC-KEY-RCVR-SEQ-NBR TO  WKORIN-RCVR-SEQ-NBR.           16060027
160700     MOVE ASC-KEY-WORK-ORD-SEQ-NBR                                16070027
160800                               TO  WKORIN-WORK-ORD-SEQ-NBR.       16080027
160900     MOVE ASC-KEY-LINE-NBR     TO  WKORIN-ORD-LNE-NBR.            16090027
161000                                                                  16100027
161100     MOVE ASC-SCR-OPER-ID      TO  WKORIN-OPER-ID.                16110027
161200                                                                  16120027
161300*  IR-263                                                         16130027
161400*    MOVE ASC-SCR-OPER-UNT-ID  TO  WKORIN-OPER-UNT-ID.            16140027
161410*** DMH BEGIN - 11/4/08                                           16141036
161500***  MOVE PC000-OPERATING-UNIT-ID                                 16150036
161501     MOVE ASC-CURR-OPER-UNT-ID                                    16150136
161510*** DMH END   - 11/4/08                                           16151036
161600                               TO  WKORIN-OPER-UNT-ID.            16160027
161700                                                                  16170027
161800     MOVE ASC-SCR-FCLTY-ID     TO  WKORIN-FCLTY-ID.               16180027
161900     MOVE ASC-SCR-FCLTY-AREA-ID                                   16190027
162000                               TO WKORIN-FCLTY-AREA-ID.           16200027
162100     MOVE ASC-SCR-PRC-FCLTY-AREA-ID                               16210027
162200                               TO  WKORIN-PRC-FCLTY-AREA-ID.      16220027
162300     MOVE ASC-SCREEN-SEQ-NBR   TO  WKORIN-SCREEN-SEQ-NBR.         16230027
162400                                                                  16240027
162500     ADD 1                     TO  WKORIN-SCREEN-SEQ-NBR.         16250027
162600     ADD 1                     TO  WKORIN-WO-INSTR-SEQ-NBR.       16260027
162700     MOVE PC-DB2-DUMMY-DATE-2  TO  WKORIN-STRT-TMST               16270029
162800                                   WKORIN-STOP-TMST.              16280027
162900     MOVE SPACES               TO  WKORIN-REC-SEL-IND.            16290027
163000                                                                  16300027
163100     EXEC SQL                                                     16310027
163200          INSERT                                                  16320027
163300          INTO  TWKORIN                                           16330027
163400               (ORD_NBR                                           16340027
163500               ,RCVR_SEQ_NBR                                      16350027
163600               ,ORD_LNE_NBR                                       16360027
163700               ,WORK_ORD_SEQ_NBR                                  16370027
163800               ,WO_INSTR_SEQ_NBR                                  16380027
163900               ,CRE_TMST                                          16390027
164000               ,VER_STATUS_CDE                                    16400027
164100               ,CRE_UID_ID                                        16410027
164200               ,OPER_ID                                           16420027
164300               ,OPER_UNT_ID                                       16430027
164400               ,FCLTY_ID                                          16440027
164500               ,FCLTY_AREA_ID                                     16450027
164600               ,PRC_FCLTY_AREA_ID                                 16460027
164700               ,EXPTED_CART_CNT                                   16470027
164800               ,ACTL_CART_CNT                                     16480027
164900               ,ALLOC_IND                                         16490027
165000               ,REPACK_IND                                        16500027
165100               ,STRT_TMST                                         16510027
165200               ,STOP_TMST                                         16520027
165300               ,SCREEN_SEQ_NBR                                    16530027
165400               ,LNE_LOC_CDE                                       16540027
165500               ,REC_SEL_IND)                                      16550027
165600        VALUES                                                    16560027
165700              (:WKORIN-ORD-NBR                                    16570027
165800              ,:WKORIN-RCVR-SEQ-NBR                               16580027
165900              ,:WKORIN-ORD-LNE-NBR                                16590027
166000              ,:WKORIN-WORK-ORD-SEQ-NBR                           16600027
166100              ,:WKORIN-WO-INSTR-SEQ-NBR                           16610027
166200              , CURRENT TIMESTAMP                                 16620027
166300              ,:PC-A                                              16630027
166400              ,:DP020-USERID                                      16640027
166500              ,:WKORIN-OPER-ID                                    16650027
166600              ,:WKORIN-OPER-UNT-ID                                16660027
166700              ,:WKORIN-FCLTY-ID                                   16670027
166800              ,:WKORIN-FCLTY-AREA-ID                              16680027
166900              ,:WKORIN-PRC-FCLTY-AREA-ID                          16690027
167000              ,:WKORIN-EXPTED-CART-CNT                            16700027
167100              ,:WKORIN-ACTL-CART-CNT                              16710027
167200              ,:WKORIN-ALLOC-IND                                  16720027
167300              ,:WKORIN-REPACK-IND                                 16730027
167400              ,:WKORIN-STRT-TMST                                  16740027
167500              ,:WKORIN-STOP-TMST                                  16750027
167600              ,:WKORIN-SCREEN-SEQ-NBR                             16760027
167700              ,:ASC-SCR-LNE-LOC-CDE                               16770027
167800              ,:WKORIN-REC-SEL-IND)                               16780027
167900     END-EXEC.                                                    16790027
168000                                                                  16800027
168100     EVALUATE TRUE                                                16810027
168200         WHEN SQLCODE = ZERO                                      16820027
168300              CONTINUE                                            16830027
168400         WHEN SQLCODE = -904                                      16840027
168500         WHEN SQLCODE = -913                                      16850027
168600              PERFORM 9900-SOFT-ABORT                             16860027
168700         WHEN SQLWARN0 NOT = SPACES                               16870027
168800         WHEN SQLCODE NOT EQUAL ZERO                              16880027
168900              MOVE '5126-INSERT-TWKORIN'                          16890027
169000                                   TO DP013-PARAGRAPH             16900027
169100              MOVE 'INSERT DURING ADD PROCESS'                    16910027
169200                                   TO DP013-MESSAGE-TEXT (1)      16920027
169300              MOVE SQLCA           TO DP013-SQLCA                 16930027
169400              MOVE 'TWKORIN'       TO DP013-DB2-TABLE-NAME (1)    16940027
169500              SET DP013-DB2-ABEND                                 16950027
169600                  DP013-XCTL-DISPLAY-RESTART                      16960027
169700                                   TO TRUE                        16970027
169800              PERFORM DP013-0000-PROCESS-ABEND                    16980027
169900     END-EVALUATE.                                                16990027
170000/                                                                 17000027
170100*----------------------------------------------------------------*17010027
170200*    EASY LOGIC; JUST UPDATE THE SELECTED ROW.                   *17020027
170300*----------------------------------------------------------------*17030027
170400                                                                  17040027
170500 5200-UPDATE-PROCESS.                                             17050027
170600                                                                  17060027
170700     PERFORM 5210-UPDATE-CURRENT-TWKORIN.                         17070027
170800     IF  ASC-ACTUAL-CARTONS NOT EQUAL ASC-ORIG-ACTUAL-CARTONS     17080027
170900         PERFORM 5220-UPDATE-EXPECTED-TWKORIN                     17090027
171000     END-IF.                                                      17100027
171100                                                                  17110027
171200 5210-UPDATE-CURRENT-TWKORIN.                                     17120027
171300                                                                  17130027
171400     MOVE ASC-EXPECTED-CARTONS    TO  WKORIN-EXPTED-CART-CNT.     17140027
171500     MOVE ASC-ACTUAL-CARTONS      TO  WKORIN-ACTL-CART-CNT.       17150027
171600     EXEC SQL                                                     17160027
171700          UPDATE                                                  17170027
171800                 TWKORIN                                          17180027
171900             SET                                                  17190027
172000                 EXPTED_CART_CNT     =  :WKORIN-EXPTED-CART-CNT   17200027
172100               , ACTL_CART_CNT       =  :WKORIN-ACTL-CART-CNT     17210027
172200               , REPACK_IND          =  :ASC-SCR-REPACK-IND       17220027
172300               , LNE_LOC_CDE         =  :ASC-SCR-LNE-LOC-CDE      17230027
172400           WHERE                                                  17240027
172500                 ORD_NBR             =  :ASC-KEY-PO-NBR           17250027
172600             AND RCVR_SEQ_NBR        =  :ASC-KEY-RCVR-SEQ-NBR     17260027
172700             AND ORD_LNE_NBR         =  :ASC-KEY-LINE-NBR         17270027
172800             AND WORK_ORD_SEQ_NBR    =  :ASC-KEY-WORK-ORD-SEQ-NBR 17280027
172900             AND WO_INSTR_SEQ_NBR    =  :ASC-WO-INSTR-SEQ-NBR     17290027
173000             AND VER_STATUS_CDE      =  :PC-A                     17300027
173100     END-EXEC.                                                    17310027
173200                                                                  17320027
173300     EVALUATE TRUE                                                17330027
173400         WHEN SQLCODE = ZERO                                      17340027
173500              CONTINUE                                            17350027
173600         WHEN SQLCODE = -904                                      17360027
173700         WHEN SQLCODE = -913                                      17370027
173800              PERFORM 9900-SOFT-ABORT                             17380027
173900         WHEN SQLWARN0 NOT = SPACES                               17390027
174000         WHEN SQLCODE NOT EQUAL ZERO                              17400027
174100              MOVE '5210-UPDATE-CURRENT-TWKORIN'                  17410027
174200                                   TO DP013-PARAGRAPH             17420027
174300              MOVE 'UPDATE VIA TRUE UPDATE'                       17430027
174400                                   TO DP013-MESSAGE-TEXT (1)      17440027
174500              MOVE SQLCA           TO DP013-SQLCA                 17450027
174600              MOVE 'TWKORIN'       TO DP013-DB2-TABLE-NAME (1)    17460027
174700              SET DP013-DB2-ABEND                                 17470027
174800                  DP013-XCTL-DISPLAY-RESTART                      17480027
174900                                   TO TRUE                        17490027
175000              PERFORM DP013-0000-PROCESS-ABEND                    17500027
175100     END-EVALUATE.                                                17510027
175200                                                                  17520027
175300 5220-UPDATE-EXPECTED-TWKORIN.                                    17530027
175400                                                                  17540027
175500     MOVE ASC-ACTUAL-CARTONS      TO  WKORIN-EXPTED-CART-CNT.     17550027
175600                                                                  17560027
175700     EXEC SQL                                                     17570027
175800          UPDATE                                                  17580027
175900                 TWKORIN                                          17590027
176000             SET                                                  17600027
176100                 EXPTED_CART_CNT   =  :WKORIN-EXPTED-CART-CNT     17610027
176200          WHERE                                                   17620027
176300                ORD_NBR            =  :ASC-KEY-PO-NBR             17630027
176400            AND RCVR_SEQ_NBR       =  :ASC-KEY-RCVR-SEQ-NBR       17640027
176500            AND ORD_LNE_NBR        =  :ASC-KEY-LINE-NBR           17650027
176600            AND WORK_ORD_SEQ_NBR   =  :ASC-KEY-WORK-ORD-SEQ-NBR   17660027
176700            AND VER_STATUS_CDE     =  :PC-A                       17670027
176800            AND SCREEN_SEQ_NBR     =  :ASC-SCREEN-SEQ-NBR + 1     17680027
176900            AND CRE_TMST           <  :ASC-CURRENT-TMST           17690027
177000     END-EXEC.                                                    17700027
177100                                                                  17710027
177200     EVALUATE TRUE                                                17720027
177300         WHEN SQLCODE = ZERO                                      17730027
177400         WHEN SQLCODE = +100                                      17740027
177500              CONTINUE                                            17750027
177600         WHEN SQLCODE = -904                                      17760027
177700         WHEN SQLCODE = -913                                      17770027
177800              PERFORM 9900-SOFT-ABORT                             17780027
177900         WHEN SQLWARN0 NOT = SPACES                               17790027
178000         WHEN SQLCODE NOT EQUAL ZERO                              17800027
178100              MOVE '5220-UPDATE-EXPECTED-TWKORIN'                 17810027
178200                                   TO DP013-PARAGRAPH             17820027
178300              MOVE 'UPDATE EXPECTED CARTON COUNT'                 17830027
178400                                   TO DP013-MESSAGE-TEXT (1)      17840027
178500              MOVE SQLCA           TO DP013-SQLCA                 17850027
178600              MOVE 'TWKORIN'       TO DP013-DB2-TABLE-NAME (1)    17860027
178700              SET DP013-DB2-ABEND                                 17870027
178800                  DP013-XCTL-DISPLAY-RESTART                      17880027
178900                                   TO TRUE                        17890027
179000              PERFORM DP013-0000-PROCESS-ABEND                    17900027
179100     END-EVALUATE.                                                17910027
179200/                                                                 17920027
179300*----------------------------------------------------------------*17930027
179400*    HERE STARTS THE DELETE PROCESS.  THIS PERFORMS A "LOGICAL"  *17940027
179500*    DELETE WHERE THE STATUS IS CHANGED TO INACTIVE.  THE REST   *17950027
179600*    OF THE WORK ORDER INSTRUCTIONS THAT COME AFTER THIS ONE     *17960027
179700*    (HAVE A HIGHER SCREEN SEQUENCE NUMBER) MUST BE MODIFIED     *17970027
179800*    BY SUBTRACTING 1 FROM SCREEN_SEQ_NBR.                       *17980027
179900*----------------------------------------------------------------*17990027
180000                                                                  18000027
180100 5300-DELETE-PROCESS.                                             18010027
180200                                                                  18020027
180300     PERFORM 5310-SET-INACTIVE.                                   18030027
180400     PERFORM 5320-RESEQUENCE.                                     18040027
180500     PERFORM 5330-STATUS.                                         18050027
180600                                                                  18060027
180700 5310-SET-INACTIVE.                                               18070027
180800                                                                  18080027
180900     EXEC SQL                                                     18090027
181000          UPDATE                                                  18100027
181100                 TWKORIN                                          18110027
181200             SET                                                  18120027
181300                 VER_STATUS_CDE      =  :PC-I                     18130027
181400           WHERE                                                  18140027
181500                 ORD_NBR             =  :ASC-KEY-PO-NBR           18150027
181600             AND RCVR_SEQ_NBR        =  :ASC-KEY-RCVR-SEQ-NBR     18160027
181700             AND ORD_LNE_NBR         =  :ASC-KEY-LINE-NBR         18170027
181800             AND WORK_ORD_SEQ_NBR    =  :ASC-KEY-WORK-ORD-SEQ-NBR 18180027
181900             AND WO_INSTR_SEQ_NBR    =  :ASC-WO-INSTR-SEQ-NBR     18190027
182000             AND VER_STATUS_CDE      =  :PC-A                     18200027
182100     END-EXEC.                                                    18210027
182200                                                                  18220027
182300     EVALUATE TRUE                                                18230027
182400         WHEN SQLCODE = ZERO                                      18240027
182500              CONTINUE                                            18250027
182600         WHEN SQLCODE = +100                                      18260027
182700              SET PS-ERROR         TO  TRUE                       18270027
182800              MOVE PC-TSYMSG-00148 TO  DP020-MSG-NUMBER           18280027
182900         WHEN SQLCODE = -904                                      18290027
183000         WHEN SQLCODE = -913                                      18300027
183100              PERFORM 9900-SOFT-ABORT                             18310027
183200         WHEN SQLWARN0 NOT = SPACES                               18320027
183300         WHEN SQLCODE NOT EQUAL ZERO                              18330027
183400              MOVE '5310-SET-INACTIVE'                            18340027
183500                                   TO DP013-PARAGRAPH             18350027
183600              MOVE '"LOGICAL" DELETE; SET STATUS TO I'            18360027
183700                                   TO DP013-MESSAGE-TEXT (1)      18370027
183800              MOVE SQLCA           TO DP013-SQLCA                 18380027
183900              MOVE 'TWKORIN'       TO DP013-DB2-TABLE-NAME (1)    18390027
184000              SET DP013-DB2-ABEND                                 18400027
184100                  DP013-XCTL-DISPLAY-RESTART                      18410027
184200                                   TO TRUE                        18420027
184300              PERFORM DP013-0000-PROCESS-ABEND                    18430027
184400     END-EVALUATE.                                                18440027
184500                                                                  18450027
184600 5320-RESEQUENCE.                                                 18460027
184700                                                                  18470027
184800     EXEC SQL                                                     18480027
184900          UPDATE                                                  18490027
185000                 TWKORIN                                          18500027
185100             SET                                                  18510027
185200                 SCREEN_SEQ_NBR      =  SCREEN_SEQ_NBR - 1        18520027
185300           WHERE                                                  18530027
185400                 ORD_NBR             =  :ASC-KEY-PO-NBR           18540027
185500             AND RCVR_SEQ_NBR        =  :ASC-KEY-RCVR-SEQ-NBR     18550027
185600             AND ORD_LNE_NBR         =  :ASC-KEY-LINE-NBR         18560027
185700             AND WORK_ORD_SEQ_NBR    =  :ASC-KEY-WORK-ORD-SEQ-NBR 18570027
185800             AND VER_STATUS_CDE      =  :PC-A                     18580027
185900             AND SCREEN_SEQ_NBR      >  :ASC-SCREEN-SEQ-NBR       18590027
186000     END-EXEC.                                                    18600027
186100                                                                  18610027
186200     EVALUATE TRUE                                                18620027
186300         WHEN SQLCODE = ZERO                                      18630027
186400         WHEN SQLCODE = +100                                      18640027
186500              CONTINUE                                            18650027
186600         WHEN SQLCODE = -904                                      18660027
186700         WHEN SQLCODE = -913                                      18670027
186800              PERFORM 9900-SOFT-ABORT                             18680027
186900         WHEN SQLWARN0 NOT = SPACES                               18690027
187000         WHEN SQLCODE NOT EQUAL ZERO                              18700027
187100              MOVE '5320-RESEQUENCE'                              18710027
187200                                   TO DP013-PARAGRAPH             18720027
187300              MOVE 'RESEQUENCE SCREEN SEQUENCE NUMBER'            18730027
187400                                   TO DP013-MESSAGE-TEXT (1)      18740027
187500              MOVE SQLCA           TO DP013-SQLCA                 18750027
187600              MOVE 'TWKORIN'       TO DP013-DB2-TABLE-NAME (1)    18760027
187700              SET DP013-DB2-ABEND                                 18770027
187800                  DP013-XCTL-DISPLAY-RESTART                      18780027
187900                                   TO TRUE                        18790027
188000              PERFORM DP013-0000-PROCESS-ABEND                    18800027
188100     END-EVALUATE.                                                18810027
188200/                                                                 18820027
188300 5330-STATUS.                                                     18830027
188400     PERFORM 5400-GET-MAX-WO-INSTR.                               18840027
188500     IF  WKORIN-STOP-TMST = PC-DB2-DUMMY-DATE-1                   18850029
188510     OR  WKORIN-STOP-TMST = PC-DB2-DUMMY-DATE-2                   18851029
188600         CONTINUE                                                 18860027
188700     ELSE                                                         18870027
188800         PERFORM 6000-SET-STATUS                                  18880027
188900     END-IF.                                                      18890027
189000/                                                                 18900027
189100*----------------------------------------------------------------*18910027
189200*    GET THE MAXIMUM WORK ORDER INSTRUCTION SEQUENCE NUMBER      *18920027
189300*----------------------------------------------------------------*18930027
189400                                                                  18940027
189500 5400-GET-MAX-WO-INSTR.                                           18950027
189600                                                                  18960027
189700     EXEC SQL                                                     18970027
189800          SELECT STOP_TMST                                        18980027
189900                ,WO_INSTR_SEQ_NBR                                 18990027
190000            INTO :WKORIN-STOP-TMST                                19000027
190100                ,:WKORIN-WO-INSTR-SEQ-NBR                         19010027
190200            FROM TWKORIN                                          19020027
190300          WHERE ORD_NBR          =  :ASC-KEY-PO-NBR               19030027
190400            AND RCVR_SEQ_NBR     =  :ASC-KEY-RCVR-SEQ-NBR         19040027
190500            AND ORD_LNE_NBR      =  :ASC-KEY-LINE-NBR             19050027
190600            AND WORK_ORD_SEQ_NBR =  :ASC-KEY-WORK-ORD-SEQ-NBR     19060027
190700            AND VER_STATUS_CDE   =  'A'                           19070027
190800            AND WO_INSTR_SEQ_NBR =                                19080027
190900              (SELECT MAX(WO_INSTR_SEQ_NBR)                       19090027
191000                      FROM TWKORIN                                19100027
191100               WHERE ORD_NBR         = :ASC-KEY-PO-NBR            19110027
191200                AND RCVR_SEQ_NBR     = :ASC-KEY-RCVR-SEQ-NBR      19120027
191300                AND ORD_LNE_NBR      = :ASC-KEY-LINE-NBR          19130027
191400                AND VER_STATUS_CDE   =  'A'                       19140027
191500                AND WORK_ORD_SEQ_NBR = :ASC-KEY-WORK-ORD-SEQ-NBR) 19150027
191600     END-EXEC.                                                    19160027
191700                                                                  19170027
191800     EVALUATE TRUE                                                19180027
191900         WHEN SQLCODE = ZERO                                      19190027
192000              CONTINUE                                            19200027
192100         WHEN SQLCODE = +100                                      19210027
192200              MOVE PC-DB2-DUMMY-DATE-2 TO WKORIN-STOP-TMST        19220029
192300         WHEN SQLCODE = -904                                      19230027
192400         WHEN SQLCODE = -913                                      19240027
192500               PERFORM 9900-SOFT-ABORT                            19250027
192600         WHEN SQLWARN0 NOT = SPACES                               19260027
192700         WHEN SQLCODE < ZERO                                      19270027
192800         WHEN SQLCODE > ZERO                                      19280027
192900              MOVE '5100-GET-MAX-WO-INSTR'                        19290027
193000                                   TO DP013-PARAGRAPH             19300027
193100              MOVE 'GET MAX WO INSTRUCTION SEQ NBR'               19310027
193200                                   TO DP013-MESSAGE-TEXT(1)       19320027
193300              MOVE SQLCA           TO DP013-SQLCA                 19330027
193400              MOVE 'TWKORIN'       TO DP013-DB2-TABLE-NAME (1)    19340027
193500              SET DP013-DB2-ABEND                                 19350027
193600                  DP013-XCTL-DISPLAY-RESTART                      19360027
193700                                   TO TRUE                        19370027
193800              PERFORM DP013-0000-PROCESS-ABEND                    19380027
193900     END-EVALUATE.                                                19390027
194000/                                                                 19400027
194100 6000-SET-STATUS.                                                 19410027
194200                                                                  19420027
194300     PERFORM 6510-COMPLETE-WORK-ORDER.                            19430027
194400     IF  ASC-KEY-LINE-NBR NOT EQUAL ZERO                          19440027
194500         PERFORM 6505-SET-ALL-STATUSES                            19450027
194600     ELSE                                                         19460027
194700         PERFORM 6503-UPDATE-REC-STATUS                           19470027
194800     END-IF.                                                      19480027
194900/                                                                 19490027
195000 6503-UPDATE-REC-STATUS.                                          19500027
195100                                                                  19510027
195200     PERFORM 6551-SELECT-TRECEIV.                                 19520027
195300                                                                  19530027
195400     IF RECEIV-PACK-BY-ST-IND = 'Y'                               19540027
195500         PERFORM 6553-LINK-AUDIT-MODULE                           19550027
195600         PERFORM 6552-UPDATE-TRECEIV                              19560027
195700                                                                  19570027
195800*IR-122: SHUT DOWN ALL NON-ZERO WORK ORDER INSTRUCTIONS AND SET   19580027
195900*        THE WORK ORDERS TO 'CM'.                                 19590027
196000         PERFORM 6506-COMPLETE-TWRKORD                            19600027
196100         PERFORM 6507-COMPLETE-TWKORIN                            19610027
196200*IR-122                                                           19620027
196300     END-IF.                                                      19630027
196400                                                                  19640027
196500/                                                                 19650027
196600*----------------------------------------------------------------*19660027
196700*    IT IS NOT A ZERO LINE NUMBER SO SET THE PROPER STATUS ON    *19670027
196800*    ALL TABLES.                                                 *19680027
196900*----------------------------------------------------------------*19690027
197000                                                                  19700027
197100*AWB-03/01/94 (ADDED)                                             19710027
197200                                                                  19720027
197300 6505-SET-ALL-STATUSES.                                           19730027
197400                                                                  19740027
197500     PERFORM 6520-COUNT-TWRKORD.                                  19750027
197600     IF  PV-DB2-COUNT EQUAL ZERO                                  19760027
197700         PERFORM 6550-COMPLETE-RECEIVER                           19770027
197800     END-IF.                                                      19780027
197900/                                                                 19790027
198000*IR-122: 6506 AND 6507 ADDED.                                     19800027
198100                                                                  19810027
198200 6506-COMPLETE-TWRKORD.                                           19820027
198300                                                                  19830027
198400                                                                  19840027
198500     EXEC SQL                                                     19850027
198600          UPDATE                                                  19860027
198700                TWRKORD                                           19870027
198800          SET   CRE_UID_ID         =  :PC-CURRENT-PROGRAM-NAME    19880027
198900              , STAT_CDE           =  :PC-CM                      19890027
199000          WHERE                                                   19900027
199100                ORD_NBR            =  :ASC-KEY-PO-NBR             19910027
199200          AND   ORD_LNE_NBR        >  0                           19920027
199300          AND   RCVR_SEQ_NBR       =  :ASC-KEY-RCVR-SEQ-NBR       19930027
199400          AND   OPER_UNT_ID        =  :ASC-SCR-OPER-UNT-ID        19940027
199500          AND   FCLTY_ID           =  :ASC-SCR-FCLTY-ID           19950027
199600          AND   VER_STATUS_CDE     =  :PC-A                       19960027
199700     END-EXEC.                                                    19970027
199800                                                                  19980027
199900     EVALUATE TRUE                                                19990027
200000         WHEN SQLCODE = ZERO                                      20000027
200100         WHEN SQLCODE = +100                                      20010027
200200              CONTINUE                                            20020027
200300         WHEN SQLWARN0 NOT = SPACE                                20030027
200400         WHEN SQLCODE NOT = ZERO                                  20040027
200500              MOVE '6506-COMPLETE-TWRKORD'                        20050027
200600                               TO DP013-PARAGRAPH                 20060027
200700              MOVE 'SET THE STATUS TO COMPLETE FOR ALL TWRKORD'   20070027
200800                               TO DP013-MESSAGE-TEXT (1)          20080027
200900              MOVE SQLCA       TO DP013-SQLCA                     20090027
201000              MOVE 'TWRKORD '  TO DP013-DB2-TABLE-NAME (1)        20100027
201100              SET DP013-DB2-ABEND                                 20110027
201200                               TO TRUE                            20120027
201300              PERFORM DP013-0000-PROCESS-ABEND                    20130027
201400     END-EVALUATE.                                                20140027
201500/                                                                 20150027
201600 6507-COMPLETE-TWKORIN.                                           20160027
201700                                                                  20170027
201800     EXEC SQL                                                     20180027
201900          UPDATE                                                  20190027
202000                TWKORIN                                           20200027
202100          SET   STRT_TMST          =  CURRENT TIMESTAMP           20210027
202200              , CRE_UID_ID         =  :PC-CURRENT-PROGRAM-NAME    20220027
202300          WHERE                                                   20230027
202400                ORD_NBR            =  :ASC-KEY-PO-NBR             20240027
202500          AND   ORD_LNE_NBR        >  0                           20250027
202600          AND   RCVR_SEQ_NBR       =  :ASC-KEY-RCVR-SEQ-NBR       20260027
202700          AND   OPER_UNT_ID        =  :ASC-SCR-OPER-UNT-ID        20270027
202800          AND   FCLTY_ID           =  :ASC-SCR-FCLTY-ID           20280027
202900          AND   VER_STATUS_CDE     =  :PC-A                       20290027
203000          AND   STRT_TMST          >  CURRENT TIMESTAMP           20300027
203100     END-EXEC.                                                    20310027
203200                                                                  20320027
203300     EVALUATE TRUE                                                20330027
203400         WHEN SQLCODE = ZERO                                      20340027
203500         WHEN SQLCODE = +100                                      20350027
203600              CONTINUE                                            20360027
203700         WHEN SQLWARN0 NOT = SPACE                                20370027
203800         WHEN SQLCODE NOT = ZERO                                  20380027
203900              MOVE '6507-COMPLETE-TWKORIN'                        20390027
204000                               TO DP013-PARAGRAPH                 20400027
204100              MOVE 'SET THE START TIMESTAMP FOR ALL TWKORIN'      20410027
204200                               TO DP013-MESSAGE-TEXT (1)          20420027
204300              MOVE SQLCA       TO DP013-SQLCA                     20430027
204400              MOVE 'TWKORIN '  TO DP013-DB2-TABLE-NAME (1)        20440027
204500              SET DP013-DB2-ABEND                                 20450027
204600                               TO TRUE                            20460027
204700              PERFORM DP013-0000-PROCESS-ABEND                    20470027
204800     END-EVALUATE.                                                20480027
204900                                                                  20490027
205000     EXEC SQL                                                     20500027
205100          UPDATE                                                  20510027
205200                TWKORIN                                           20520027
205300          SET   STOP_TMST          =  CURRENT TIMESTAMP           20530027
205400              , CRE_UID_ID         =  :PC-CURRENT-PROGRAM-NAME    20540027
205500          WHERE                                                   20550027
205600                ORD_NBR            =  :ASC-KEY-PO-NBR             20560027
205700          AND   ORD_LNE_NBR        >  0                           20570027
205800          AND   RCVR_SEQ_NBR       =  :ASC-KEY-RCVR-SEQ-NBR       20580027
205900          AND   OPER_UNT_ID        =  :ASC-SCR-OPER-UNT-ID        20590027
206000          AND   FCLTY_ID           =  :ASC-SCR-FCLTY-ID           20600027
206100          AND   VER_STATUS_CDE     =  :PC-A                       20610027
206200          AND   STOP_TMST          >  CURRENT TIMESTAMP           20620027
206300     END-EXEC.                                                    20630027
206400                                                                  20640027
206500     EVALUATE TRUE                                                20650027
206600         WHEN SQLCODE = ZERO                                      20660027
206700         WHEN SQLCODE = +100                                      20670027
206800              CONTINUE                                            20680027
206900         WHEN SQLWARN0 NOT = SPACE                                20690027
207000         WHEN SQLCODE NOT = ZERO                                  20700027
207100              MOVE '6507-COMPLETE-TWKORIN'                        20710027
207200                               TO DP013-PARAGRAPH                 20720027
207300              MOVE 'SET THE STOP TIMESTAMP FOR ALL TWKORIN'       20730027
207400                               TO DP013-MESSAGE-TEXT (1)          20740027
207500              MOVE SQLCA       TO DP013-SQLCA                     20750027
207600              MOVE 'TWKORIN '  TO DP013-DB2-TABLE-NAME (1)        20760027
207700              SET DP013-DB2-ABEND                                 20770027
207800                               TO TRUE                            20780027
207900              PERFORM DP013-0000-PROCESS-ABEND                    20790027
208000     END-EVALUATE.                                                20800027
208100/                                                                 20810027
208200*----------------------------------------------------------------*20820027
208300*    SET THE STATUS CODE TO COMPLETE FOR THIS WORK ORDER.        *20830027
208400*    RATHER THAN JUST UPDATING THE "CURRENT" ROW, WE MUST        *20840027
208500*    SET THE VER_STATUS_CODE TO INACTIVE, AND INSERT A NEW       *20850027
208600*    ROW WITH THE PROPER STATUS CODE.                            *20860027
208700*----------------------------------------------------------------*20870027
208800                                                                  20880027
208900 6510-COMPLETE-WORK-ORDER.                                        20890027
209000                                                                  20900027
209100     PERFORM 6512-UPDATE-TWRKORD.                                 20910027
209200/                                                                 20920027
209300*----------------------------------------------------------------*20930027
209400*    CHANGE THE CURRENT ROW TO NOT ACTIVE.                       *20940027
209500*----------------------------------------------------------------*20950027
209600                                                                  20960027
209700 6512-UPDATE-TWRKORD.                                             20970027
209800                                                                  20980027
209900     EXEC SQL                                                     20990027
210000          UPDATE                                                  21000027
210100                TWRKORD                                           21010027
210200          SET   STAT_CDE           =  :PC-CM                      21020027
210300              , CRE_UID_ID         =  :PC-CURRENT-PROGRAM-NAME    21030027
210400          WHERE                                                   21040027
210500                ORD_NBR            =  :ASC-KEY-PO-NBR             21050027
210600          AND   ORD_LNE_NBR        =  :ASC-KEY-LINE-NBR           21060027
210700          AND   RCVR_SEQ_NBR       =  :ASC-KEY-RCVR-SEQ-NBR       21070027
210800          AND   WORK_ORD_SEQ_NBR   =  :ASC-KEY-WORK-ORD-SEQ-NBR   21080027
210900          AND   OPER_UNT_ID        =  :ASC-SCR-OPER-UNT-ID        21090027
211000          AND   FCLTY_ID           =  :ASC-SCR-FCLTY-ID           21100027
211100          AND   VER_STATUS_CDE     =  :PC-A                       21110027
211200     END-EXEC.                                                    21120027
211300                                                                  21130027
211400     EVALUATE TRUE                                                21140027
211500         WHEN SQLCODE = ZERO                                      21150027
211600         WHEN SQLCODE = +100                                      21160027
211700              CONTINUE                                            21170027
211800         WHEN SQLWARN0 NOT = SPACE                                21180027
211900         WHEN SQLCODE NOT = ZERO                                  21190027
212000              MOVE '6512-UPDATE-TWRKORD'                          21200027
212100                               TO DP013-PARAGRAPH                 21210027
212200              MOVE 'UPDATE TWRKORD STATUS CODE'                   21220027
212300                               TO DP013-MESSAGE-TEXT (1)          21230027
212400              MOVE SQLCA       TO DP013-SQLCA                     21240027
212500              MOVE 'TWRKORD'   TO DP013-DB2-TABLE-NAME (1)        21250027
212600              SET DP013-DB2-ABEND                                 21260027
212700                               TO TRUE                            21270027
212800              PERFORM DP013-0000-PROCESS-ABEND                    21280027
212900     END-EVALUATE.                                                21290027
213000/                                                                 21300027
213100*----------------------------------------------------------------*21310027
213200*    SEE IF THERE ARE ANY OTHER ORDERS TO COMPLETE.              *21320027
213300*----------------------------------------------------------------*21330027
213400                                                                  21340027
213500 6520-COUNT-TWRKORD.                                              21350027
213600                                                                  21360027
213700     MOVE ZERO            TO PV-DB2-COUNT.                        21370027
213800     EXEC SQL                                                     21380027
213900          SELECT                                                  21390027
214000                COUNT(*)                                          21400027
214100          INTO                                                    21410027
214200                :PV-DB2-COUNT :PV-NULL-IND                        21420027
214300          FROM                                                    21430027
214400                TWRKORD                                           21440027
214500          WHERE                                                   21450027
214600                ORD_NBR            =  :ASC-KEY-PO-NBR             21460027
214700          AND   ORD_LNE_NBR        =  :ASC-KEY-LINE-NBR           21470027
214800          AND   RCVR_SEQ_NBR       =  :ASC-KEY-RCVR-SEQ-NBR       21480027
214900          AND   OPER_UNT_ID        =  :ASC-SCR-OPER-UNT-ID        21490027
215000          AND   FCLTY_ID           =  :ASC-SCR-FCLTY-ID           21500027
215100          AND   STAT_CDE          ^=  :PC-CM                      21510027
215200          AND   VER_STATUS_CDE     =  :PC-A                       21520027
215300     END-EXEC.                                                    21530027
215400                                                                  21540027
215500     EVALUATE TRUE                                                21550027
215600         WHEN SQLCODE = ZERO                                      21560027
215700         WHEN SQLCODE = +100                                      21570027
215800              CONTINUE                                            21580027
215900         WHEN SQLWARN0 NOT = SPACE                                21590027
216000         WHEN SQLCODE NOT = ZERO                                  21600027
216100              MOVE '6520-COUNT-TWRKORD'                           21610027
216200                               TO DP013-PARAGRAPH                 21620027
216300              MOVE 'COUNT NUMBER OF WORK ORDERS NOT COMPLETE'     21630027
216400                               TO DP013-MESSAGE-TEXT (1)          21640027
216500              MOVE SQLCA       TO DP013-SQLCA                     21650027
216600              MOVE 'TWRKORD '  TO DP013-DB2-TABLE-NAME (1)        21660027
216700              SET DP013-DB2-ABEND                                 21670027
216800                               TO TRUE                            21680027
216900              PERFORM DP013-0000-PROCESS-ABEND                    21690027
217000     END-EVALUATE.                                                21700027
217100/                                                                 21710027
217200*----------------------------------------------------------------*21720027
217300*    SET THE STATUS CODE TO COMPLETE FOR THIS RECEIVER.          *21730027
217400*    RATHER THAN JUST UPDATING THE "CURRENT" ROW, WE MUST        *21740027
217500*    SET THE VER_STATUS_CODE TO INACTIVE, AND INSERT A NEW       *21750027
217600*    ROW WITH THE PROPER STATUS CODE.                            *21760027
217700*----------------------------------------------------------------*21770027
217800                                                                  21780027
217900 6550-COMPLETE-RECEIVER.                                          21790027
218000                                                                  21800027
218100     PERFORM 6553-LINK-AUDIT-MODULE.                              21810027
218200     PERFORM 6552-UPDATE-TRECEIV.                                 21820027
218300/                                                                 21830027
218400*----------------------------------------------------------------*21840027
218500*    GET THE CURRENT ROW FOR PROCESSING.                         *21850027
218600*----------------------------------------------------------------*21860027
218700                                                                  21870027
218800 6551-SELECT-TRECEIV.                                             21880027
218900                                                                  21890027
219000     EXEC SQL                                                     21900027
219100          SELECT                                                  21910027
219200              PACK_BY_ST_IND                                      21920027
219300          INTO                                                    21930027
219400              :RECEIV-PACK-BY-ST-IND                              21940027
219500          FROM                                                    21950027
219600                TRECEIV                                           21960027
219700          WHERE                                                   21970027
219800                ORD_NBR            =  :ASC-KEY-PO-NBR             21980027
219900          AND   REC_SEQ_NBR        =  :ASC-KEY-RCVR-SEQ-NBR       21990027
220000          AND   OPER_UNT_ID        =  :ASC-SCR-OPER-UNT-ID        22000027
220100          AND   FCLTY_ID           =  :ASC-SCR-FCLTY-ID           22010027
220200          AND   VER_STATUS_CDE     =  :PC-A                       22020027
220300     END-EXEC.                                                    22030027
220400                                                                  22040027
220500     EVALUATE TRUE                                                22050027
220600         WHEN SQLCODE = ZERO                                      22060027
220700              CONTINUE                                            22070027
220800         WHEN SQLCODE = +100                                      22080027
220900              SET PS-DATA-NOT-OK    TO TRUE                       22090027
221000         WHEN SQLWARN0 NOT = SPACE                                22100027
221100         WHEN SQLCODE NOT = ZERO                                  22110027
221200              MOVE '6551-SELECT-TRECEIV'                          22120027
221300                               TO DP013-PARAGRAPH                 22130027
221400              MOVE 'SELECT TRECEIV'                               22140027
221500                               TO DP013-MESSAGE-TEXT (1)          22150027
221600              MOVE SQLCA       TO DP013-SQLCA                     22160027
221700              MOVE 'TRECEIV '  TO DP013-DB2-TABLE-NAME (1)        22170027
221800              SET DP013-DB2-ABEND                                 22180027
221900                               TO TRUE                            22190027
222000              PERFORM DP013-0000-PROCESS-ABEND                    22200027
222100     END-EVALUATE.                                                22210027
222200/                                                                 22220027
222300*----------------------------------------------------------------*22230027
222400*    CHANGE THE CURRENT ROW TO NOT ACTIVE.                       *22240027
222500*----------------------------------------------------------------*22250027
222600                                                                  22260027
222700 6552-UPDATE-TRECEIV.                                             22270027
222800                                                                  22280027
222900     EXEC SQL                                                     22290027
223000          UPDATE                                                  22300027
223100                TRECEIV                                           22310027
223200          SET   STATUS_CDE         = :PC-CM                       22320027
223300              , UPD_TMST           = CURRENT TIMESTAMP            22330027
223400              , UPD_UID            = :DP020-USERID                22340027
223500              , UPD_PGM_ID         = :PC-CURRENT-PROGRAM-NAME     22350027
223600          WHERE                                                   22360027
223700                ORD_NBR            =  :ASC-KEY-PO-NBR             22370027
223800          AND   REC_SEQ_NBR        =  :ASC-KEY-RCVR-SEQ-NBR       22380027
223900          AND   OPER_UNT_ID        =  :ASC-SCR-OPER-UNT-ID        22390027
224000          AND   FCLTY_ID           =  :ASC-SCR-FCLTY-ID           22400027
224100          AND   VER_STATUS_CDE     =  :PC-A                       22410027
224110          AND   STATUS_CDE         =  :PC-IP                      22411030
224200     END-EXEC.                                                    22420027
224300                                                                  22430027
224400     EVALUATE TRUE                                                22440027
224500         WHEN SQLCODE = ZERO                                      22450027
224510         WHEN SQLCODE = +100                                      22451030
224600              CONTINUE                                            22460027
224700         WHEN SQLCODE = -904                                      22470027
224800         WHEN SQLCODE = -913                                      22480027
224900              PERFORM 9900-SOFT-ABORT                             22490027
225000         WHEN SQLWARN0 NOT = SPACE                                22500027
225100         WHEN SQLCODE NOT = ZERO                                  22510027
225200              MOVE '6552-UPDATE-TRECEIV'                          22520027
225300                               TO DP013-PARAGRAPH                 22530027
225400              MOVE 'UPDATE TRECEIV STATUS CODE'                   22540027
225500                               TO DP013-MESSAGE-TEXT (1)          22550027
225600              MOVE SQLCA       TO DP013-SQLCA                     22560027
225700              MOVE 'TRECEIV '  TO DP013-DB2-TABLE-NAME (1)        22570027
225800              SET DP013-DB2-ABEND                                 22580027
225900                               TO TRUE                            22590027
226000              PERFORM DP013-0000-PROCESS-ABEND                    22600027
226100     END-EVALUATE.                                                22610027
226200/                                                                 22620027
226300*----------------------------------------------------------------*22630027
226400*    LINK TO AUDIT MODULE * RCKCS290                             *22640027
226500*----------------------------------------------------------------*22650027
226600                                                                  22660027
226700 6553-LINK-AUDIT-MODULE.                                          22670027
226800                                                                  22680027
226900     MOVE 'V'                   TO RC031-TABLE-TO-AUDIT.          22690027
227000     MOVE 'B'                   TO RC031-AUD-TYP-CDE.             22700027
227100     MOVE 'U'                   TO RC031-AUD-FUNC-CDE.            22710027
227200     MOVE ASC-SCR-OPER-UNT-ID   TO RC031-OPER-UNT-ID.             22720027
227300     MOVE ASC-SCR-FCLTY-ID      TO RC031-FCLTY-ID.                22730027
227400     MOVE ASC-KEY-PO-NBR        TO RC031-PO-NBR.                  22740027
227500     MOVE ASC-KEY-RCVR-SEQ-NBR  TO RC031-REC-SEQ-NBR.             22750027
227600                                                                  22760027
227700     EXEC CICS                                                    22770027
227800          LINK PROGRAM  (PC-AUDIT-RTN)                            22780027
227900          COMMAREA (RC031-FIELDS)                                 22790027
228000          LENGTH   (PC-AUDIT-RTN-LENGTH)                          22800027
228100     END-EXEC.                                                    22810027
228200                                                                  22820027
228300     EVALUATE TRUE                                                22830027
228400         WHEN RC031-CALL-SUCCESSFUL                               22840027
228500             CONTINUE                                             22850027
228600         WHEN RC031-TRECEIV-REC-NOT-FOUND                         22860027
228700             SET PS-DATA-NOT-OK    TO TRUE                        22870027
228800         WHEN OTHER                                               22880027
228900             MOVE '6553-LINK-AUDIT-MODULE'                        22890027
229000                                 TO DP013-PARAGRAPH               22900027
229100             MOVE 'UNSUCCESSFUL CALL TO AUDIT RTN'                22910027
229200                                 TO DP013-MESSAGE-TEXT (1)        22920027
229300             MOVE RC031-RETURN-DESC                               22930027
229400                                 TO DP013-MESSAGE-TEXT (2)        22940027
229500             MOVE RC031-SQLCA    TO DP013-SQLCA                   22950027
229600             SET DP013-DB2-ABEND                                  22960027
229700                 DP013-XCTL-DISPLAY-RESTART                       22970027
229800                                 TO TRUE                          22980027
229900             PERFORM DP013-0000-PROCESS-ABEND                     22990027
230000     END-EVALUATE.                                                23000027
230100/                                                                 23010027
230200*----------------------------------------------------------------*23020027
230300*    THE DB2 RESOURCE IS NOT AVAILABLE, SET THE ERROR MESSAGE    *23030027
230400*    AND THE ERROR SWITCHES.                                     *23040027
230500*----------------------------------------------------------------*23050027
230600                                                                  23060027
230700 9900-SOFT-ABORT.                                                 23070027
230800                                                                  23080027
230900     SET PS-ERROR                                                 23090027
231000         PS-SOFT-ABORT           TO  TRUE.                        23100027
231100     SET DP020-MSG-FATAL         TO  TRUE.                        23110027
231200     MOVE PC-TSYMSG-00551        TO  DP020-MSG-NUMBER.            23120027
231300/                                                                 23130027
231400                                                                  23140027
231500*----------------------------------------------------------------*23150027
231600* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *23160027
231700*----------------------------------------------------------------*23170027
231800                                                                  23180027
231900 9100-READ-SEL-QUEUE.                                             23190027
232000                                                                  23200027
232100     EXEC CICS                                                    23210027
232200         READQ TS                                                 23220027
232300             QUEUE (ASC-SEL-QUEUE-NAME)                           23230027
232400             INTO  (PC017-TS-SEL-REC)                             23240027
232500             ITEM  (ASC-SEL-ITEM)                                 23250027
232600             RESP  (PV-CICS-RESPONSE)                             23260027
232700     END-EXEC.                                                    23270027
232800                                                                  23280027
232900     IF  PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL)                   23290027
233000         CONTINUE                                                 23300027
233100     ELSE                                                         23310027
233200         SET DP013-LOGIC-ABEND                                    23320027
233300             DP013-NO-ROLLBACK     TO TRUE                        23330027
233400         MOVE '9100-READ-SEL-QUEUE'                               23340027
233500                                   TO DP013-PARAGRAPH             23350027
233600         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   23360027
233700                                   TO DP013-MESSAGE-TEXT (1)      23370027
233800         PERFORM DP013-0000-PROCESS-ABEND                         23380027
233900     END-IF.                                                      23390027
234000                                                                  23400027
234100*----------------------------------------------------------------*23410027
234200* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *23420027
234300*----------------------------------------------------------------*23430027
234400                                                                  23440027
234500 9200-REWRITE-SEL-QUEUE.                                          23450027
234600                                                                  23460027
234700     EXEC CICS                                                    23470027
234800          WRITEQ TS                                               23480027
234900              QUEUE  (ASC-SEL-QUEUE-NAME)                         23490027
235000              FROM   (PC017-TS-SEL-REC)                           23500027
235100              ITEM   (ASC-SEL-ITEM)                               23510027
235200              RESP   (PV-CICS-RESPONSE)                           23520027
235300              REWRITE                                             23530027
235400     END-EXEC.                                                    23540027
235500                                                                  23550027
235600     IF  PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)               23560027
235700         SET DP013-CICS-ABEND                                     23570027
235800             DP013-NO-ROLLBACK     TO TRUE                        23580027
235900         MOVE '9200-REWRITE-SEL-QUEUE'                            23590027
236000                                   TO DP013-PARAGRAPH             23600027
236100         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   23610027
236200                                   TO DP013-MESSAGE-TEXT (1)      23620027
236300         PERFORM DP013-0000-PROCESS-ABEND                         23630027
236400     END-IF.                                                      23640027
236500/                                                                 23650027
236600*----------------------------------------------------------------*23660027
236700*    DATE/TIME SUBROUTINE.                                       *23670027
236800*----------------------------------------------------------------*23680027
236900                                                                  23690027
237000     COPY DPPD017.                                                23700027
237100/                                                                 23710027
237200*----------------------------------------------------------------*23720027
237300*    ABEND PROCESSOR MODULE                                      *23730027
237400*----------------------------------------------------------------*23740027
237500                                                                  23750027
237600     COPY DPPD013.                                                23760027
