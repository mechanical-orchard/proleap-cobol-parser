000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    PCKUP999.                                         00020001
000300 AUTHOR.        DENISE HAHN.                                      00030023
000400 INSTALLATION.  KOHLS.                                            00040000
000500 DATE-WRITTEN   JANUARY, 2022.                                    00050001
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800* ************************************************************** *00080000
000900* * PCKUP999 - FIX P2L VERIFICATION UNITS FOR RECEIVERS THAT   * *00090001
001000* *            WENT OVER 1000 RECEIVERS                        * *00100001
001200* *                                                            * *00120000
001210* * - READ CARTON DETAIL RECORD                                * *00121001
001211* *   - UPDATE SUT_OTBND_UPC WITH CORRECT RECEIVER #           * *00121101
001212* *   - READ NEXT CARTON DETAIL RECORD                         * *00121201
001220* *                                                            * *00122001
001230* * AT END OF CARTON DETAIL RECORD                             * *00123001
001240* *                                                            * *00124001
001300* * - READ SUMMARIZED INPUT FILE                               * *00130001
001400* *   - IF NEW PO-RCVR-LINE                                    * *00140001
001401* *      - SET PREV PO-RCVR-LINE RSLTS RCVD TMST               * *00140101
001402* *      - SET PREV PO-RCVR-LINE READY TO VERIFY               * *00140201
001700* *                                                            * *00170000
003330* ************************************************************** *00333000
003340 ENVIRONMENT DIVISION.                                            00334000
003350 CONFIGURATION SECTION.                                           00335000
003360 SOURCE-COMPUTER.        IBM-3090.                                00336000
003370 OBJECT-COMPUTER.        IBM-3090.                                00337000
003380                                                                  00338000
003390 INPUT-OUTPUT SECTION.                                            00339000
003400 FILE-CONTROL.                                                    00340000
003500                                                                  00350000
003600     SELECT INPUT-DETAIL-FILE             ASSIGN TO INP01.        00360001
003700     SELECT INPUT-SUMMARY-FILE            ASSIGN TO INP02.        00370001
004100                                                                  00410000
004200******************************************************************00420000
004300 DATA DIVISION.                                                   00430000
004400 FILE SECTION.                                                    00440000
004500                                                                  00450000
004600                                                                  00460000
004700 FD  INPUT-DETAIL-FILE                                            00470001
004800     RECORDING MODE IS F                                          00480000
004900     LABEL RECORDS ARE STANDARD                                   00490000
005000     BLOCK CONTAINS 0 RECORDS.                                    00500000
005100 01  INPUT-DETAIL-RECORD            PIC  X(110).                  00510001
005200                                                                  00520000
005300 FD  INPUT-SUMMARY-FILE                                           00530001
005400     RECORDING MODE IS F                                          00540000
005500     LABEL RECORDS ARE STANDARD                                   00550000
005600     BLOCK CONTAINS 0 RECORDS.                                    00560000
005700 01  INPUT-SUMMARY-RECORD            PIC  X(110).                 00570001
005800                                                                  00580000
007600                                                                  00760000
007700                                                                  00770000
007800                                                                  00780000
007900 WORKING-STORAGE SECTION.                                         00790000
008000                                                                  00800000
008500 01  PC-PROGRAM-CONSTANTS.                                        00850000
008600     05  PC-CURRENT-PROGRAM-NAME     PIC X(08) VALUE 'PCKUP999'.  00860001
008700     05  PC-ABEND-INFO.                                           00870000
008800         10  PC-ABEND                PIC X(11) VALUE              00880000
008900                                               '** ABEND **'.     00890000
009000         10  PC-ABEND-MSG-PARA       PIC X(15) VALUE              00900000
009100                                               '- PARA       : '. 00910000
009200         10  PC-ABEND-MSG-DISPLAY-PARA                            00920000
009300                                     PIC X(15) VALUE              00930000
009400                                               '  CALLED PARA: '. 00940000
009500         10  PC-ABEND-MSG-NUMBER     PIC X(15) VALUE              00950000
009600                                               '  FOR ABEND# : '. 00960000
009700         10  PC-ABEND-MSG-DESC       PIC X(15) VALUE              00970000
009800                                               '- ERROR IS   : '. 00980000
009900         10  PC-ABEND-MSG-INDENT-15  PIC X(15) VALUE SPACES.      00990000
010000         10  PC-ABEND-MSG-ACTION     PIC X(15) VALUE              01000000
010100                                               '- ACTION     : '. 01010000
012200                                                                  01220000
012300 01  PS-PROGRAM-SWITCHES.                                         01230000
012400     05  PS-DETAIL-EOF-SW            PIC X(01) VALUE 'N'.         01240001
012500         88  PS-DETAIL-EOF                     VALUE 'Y'.         01250001
012600         88  PS-DETAIL-NOT-EOF                 VALUE 'N'.         01260001
012700     05  PS-SUMMARY-SW               PIC X(01) VALUE 'N'.         01270001
012800         88  PS-SUMMARY-EOF                    VALUE 'Y'.         01280001
012900         88  PS-SUMMARY-NOT-EOF                VALUE 'N'.         01290001
014400                                                                  01440000
014500 01  PV-PROGRAM-VARIABLES.                                        01450000
014610     05  PV-DETAIL-COUNT             PIC  9(09).                  01461011
014620     05  PV-SUMMARY-COUNT            PIC  9(09).                  01462011
014800     05  PV-UPDATE-DISTDT-CNT        PIC  9(09).                  01480012
014801     05  PV-NO-UPD-DISTDT-CNT        PIC  9(09).                  01480110
014802     05  PV-UPDATE-DISTHD-CNT        PIC  9(09).                  01480212
014803     05  PV-NO-UPD-DISTHD-CNT        PIC  9(09).                  01480312
014804     05  PV-UPDATE-UPC-CNT           PIC  9(09).                  01480410
014805     05  PV-NO-UPD-UPC-CNT           PIC  9(09).                  01480509
014806     05  PV-COMMIT-CNT               PIC  9(09).                  01480611
014807     05  PV-SQLCODE                  PIC  -999.                   01480711
014810                                                                  01481002
014820     05  PV-UPDATE-RCVR              PIC  S9(9) COMP.             01482004
014830                                                                  01483007
014840     05 PV-PREV-OPER                 PIC   9(04).                 01484008
014860     05 PV-PREV-TRN-NBR              PIC   9(09).                 01486008
014880     05 PV-PREV-RCVR                 PIC   9(09).                 01488008
014890     05 PV-PREV-TRN-LNE-NBR          PIC   9(09).                 01489008
014891                                                                  01489115
014892     05 PV-TEST-RCVR-SEQ             PIC  S9(9) COMP.             01489215
014893     05 PV-TEST-STR-NBR              PIC  S9(4) COMP.             01489315
014894     05 PV-TEST-PRCG-STAT            PIC  X(1).                   01489415
014895                                                                  01489515
014896     05 PV-PARAGRAPH-NAME            PIC   X(30).                 01489615
014897     05 PV-DB2-OPERATION-MSG-1       PIC   X(50).                 01489715
014898     05 PV-DB2-TABLE-NAME            PIC   X(50).                 01489815
014900*                                                                 01490001
029800 01  ABEND-CODE                      PIC S9(04)                   02980000
029900                                               VALUE ZEROES       02990000
030000                                               COMP SYNC.         03000000
030100                                                                  03010000
030110******************************************************************03011006
030120* INPUT  RECORD DETAIL                                            03012021
030130******************************************************************03013006
030140     COPY PCRD999.                                                03014006
030150                                                                  03015006
030160******************************************************************03016021
030170* INPUT  RECORD SUMMARY                                           03017021
030180******************************************************************03018021
030190     COPY PCRD998.                                                03019021
030191                                                                  03019122
030200*---------------------------------------------------------------* 03020000
030300*  DB2 FORMATTED MESSAGE AREA                                     03030000
030400*---------------------------------------------------------------* 03040000
030500     COPY DPWS004.                                                03050000
030600                                                                  03060000
030700                                                                  03070000
030800*---------------------------------------------------------------* 03080000
030900*    DB2 AREA FOR TDISTHD                                       * 03090001
031000*---------------------------------------------------------------* 03100000
031100     EXEC SQL                                                     03110000
031200          INCLUDE TDISTHD                                         03120001
031300     END-EXEC.                                                    03130000
031400                                                                  03140000
031500*---------------------------------------------------------------* 03150000
031600*    DB2 AREA FOR TDISTDT                                       * 03160001
031700*---------------------------------------------------------------* 03170000
031800     EXEC SQL                                                     03180000
031900          INCLUDE TDISTDT                                         03190001
032000     END-EXEC.                                                    03200000
032100                                                                  03210000
032200*---------------------------------------------------------------* 03220000
032300*    DB2 AREA FOR SUT00028                                      * 03230001
032400*---------------------------------------------------------------* 03240000
032500     EXEC SQL                                                     03250000
032600          INCLUDE SUT00028                                        03260001
032700     END-EXEC.                                                    03270000
032800                                                                  03280000
034300*---------------------------------------------------------------* 03430000
034400*    DB2 AREA FOR COMMUNICATIONS                                * 03440000
034500*---------------------------------------------------------------* 03450000
034600     EXEC SQL                                                     03460000
034700          INCLUDE SQLCA                                           03470000
034800     END-EXEC.                                                    03480000
034900                                                                  03490000
035000                                                                  03500000
035100 PROCEDURE DIVISION.                                              03510000
035200                                                                  03520000
035300 0000-PROGRAM-MAINLINE.                                           03530000
035400                                                                  03540000
035500     PERFORM 1000-INITIALIZE.                                     03550000
035600                                                                  03560000
035610     DISPLAY 'PROCESS DETAIL FILE'.                               03561001
035700     SET PS-DETAIL-NOT-EOF TO TRUE.                               03570001
035900     PERFORM 2000-PROCESS-DETAIL-FILE                             03590001
036000         UNTIL PS-DETAIL-EOF.                                     03600001
036010                                                                  03601001
036013     DISPLAY ' '.                                                 03601301
036014     DISPLAY 'DETAIL INPUT:  '  PV-DETAIL-COUNT.                  03601401
036015     DISPLAY ' '.                                                 03601510
036016     DISPLAY 'DETAIL UPDATE: '  PV-UPDATE-UPC-CNT.                03601610
036017     DISPLAY 'DETAIL NO UPD: '  PV-NO-UPD-UPC-CNT.                03601710
036018     DISPLAY ' '.                                                 03601810
036019                                                                  03601901
036020     PERFORM 7100-READ-SUMMARY.                                   03602001
036021     MOVE  PC998-CORRECT-OPER  TO  PV-PREV-OPER                   03602123
036022     MOVE  PC998-CORRECT-RCVR  TO  PV-PREV-RCVR                   03602223
036023     MOVE  PC998-TRN-NBR       TO  PV-PREV-TRN-NBR                03602323
036024     MOVE  PC998-TRN-LNE-NBR   TO  PV-PREV-TRN-LNE-NBR            03602423
036025                                                                  03602501
036026     DISPLAY 'PROCESS SUMMARY FILE'.                              03602601
036030     PERFORM 2100-PROCESS-SUMMARY-FILE                            03603001
036040         UNTIL PS-SUMMARY-EOF.                                    03604020
036041                                                                  03604101
036042     PERFORM 2120-UPDATE-DISTHD.                                  03604226
036043                                                                  03604326
036044     DISPLAY ' '.                                                 03604401
036045     DISPLAY 'SUMMARY INPUT: '  PV-SUMMARY-COUNT.                 03604510
036046     DISPLAY 'TDISTDT UPDATE:'  PV-UPDATE-DISTDT-CNT.             03604612
036047     DISPLAY 'TDISTDT NO UPD:'  PV-NO-UPD-DISTDT-CNT.             03604712
036048     DISPLAY 'TDISTHD UPDATE:'  PV-UPDATE-DISTHD-CNT.             03604812
036049     DISPLAY 'TDISTHD NO UPD:'  PV-NO-UPD-DISTHD-CNT.             03604912
036050     DISPLAY ' '.                                                 03605010
036051                                                                  03605109
036060                                                                  03606001
041194                                                                  04119400
041195     STOP RUN.                                                    04119500
041196                                                                  04119600
041197                                                                  04119700
041198* ************************************************************** *04119800
041199* * INITIALIZATIONS                                            * *04119900
041200* ************************************************************** *04120000
041300 1000-INITIALIZE.                                                 04130000
041400                                                                  04140000
041700     OPEN  INPUT INPUT-DETAIL-FILE.                               04170001
041800     OPEN  INPUT INPUT-SUMMARY-FILE.                              04180001
041900                                                                  04190001
042000     PERFORM 7000-READ-DETAIL.                                    04200001
042010                                                                  04201001
042100 2000-PROCESS-DETAIL-FILE.                                        04210001
042110                                                                  04211001
042120     PERFORM 2010-UPDATE-OTBND-UPC.                               04212001
042130                                                                  04213001
042140     PERFORM 7000-READ-DETAIL.                                    04214001
042150                                                                  04215001
042160 2010-UPDATE-OTBND-UPC.                                           04216001
042170                                                                  04217001
042180     MOVE PC999-SHIPT-UNT-ID       TO SUT00028-SHIPT-UNT-ID.      04218001
042190     MOVE PC999-TRN-NBR            TO SUT00028-TRN-NBR.           04219001
042191     MOVE PC999-RCVR-SEQ-NBR       TO SUT00028-RCVR-SEQ-NBR.      04219101
042192     MOVE PC999-TRN-LNE-NBR        TO SUT00028-TRN-LNE-NBR.       04219201
042193     MOVE PC999-CORRECT-RCVR       TO PV-UPDATE-RCVR.             04219301
042194                                                                  04219401
042195     EXEC SQL                                                     04219527
042196         UPDATE SUT_OTBND_UPC                                     04219627
042197            SET RCVR_SEQ_NBR  = :PV-UPDATE-RCVR                   04219727
042198          WHERE SHIPT_UNT_ID  = :SUT00028-SHIPT-UNT-ID            04219827
042199            AND TRN_NBR       = :SUT00028-TRN-NBR                 04219927
042200            AND RCVR_SEQ_NBR  = :SUT00028-RCVR-SEQ-NBR            04220027
042210            AND TRN_LNE_NBR   = :SUT00028-TRN-LNE-NBR             04221027
042220     END-EXEC.                                                    04222027
042230                                                                  04223001
042231*    EXEC SQL                                                     04223127
042232*        SELECT RCVR_SEQ_NBR                                      04223227
042233*          INTO :PV-TEST-RCVR-SEQ                                 04223327
042234*          FROM SUT_OTBND_UPC                                     04223427
042235*         WHERE SHIPT_UNT_ID  = :SUT00028-SHIPT-UNT-ID            04223527
042236*           AND TRN_NBR       = :SUT00028-TRN-NBR                 04223627
042237*           AND RCVR_SEQ_NBR  = :SUT00028-RCVR-SEQ-NBR            04223727
042238*           AND TRN_LNE_NBR   = :SUT00028-TRN-LNE-NBR             04223827
042239*    END-EXEC.                                                    04223927
042240                                                                  04224016
042241     EVALUATE TRUE                                                04224116
042250         WHEN SQLCODE = ZERO                                      04225001
042251              DISPLAY 'UPC UPDATE: ' PC999-SHIPT-UNT-ID           04225114
042252                      '  '           PC999-RCVR-SEQ-NBR           04225214
042253                      '  '           PC999-CORRECT-RCVR           04225319
042260              ADD +1 TO PV-UPDATE-UPC-CNT                         04226001
042270                                                                  04227001
042280         WHEN SQLCODE = +100                                      04228001
042281              DISPLAY 'NO UPC UPDATE: ' PC999-SHIPT-UNT-ID        04228114
042290              ADD +0 TO PV-NO-UPD-UPC-CNT                         04229001
042291                                                                  04229101
042292         WHEN SQLWARN0 NOT = SPACE                                04229201
042293         WHEN SQLCODE < ZERO                                      04229301
042294         WHEN SQLCODE > ZERO                                      04229401
042295              DISPLAY '2010-UPDATE-OTBND-UPC'                     04229501
042296              DISPLAY  PC999-SHIPT-UNT-ID  ' - '                  04229601
042297                       PC999-TRN-NBR ' - '                        04229701
042298                       PC999-RCVR-SEQ-NBR ' - '                   04229801
042299                       PC999-TRN-LNE-NBR                          04229901
042300                       '  CORRECTED RCVR: '                       04230001
042310                       PC999-CORRECT-RCVR                         04231001
042320          MOVE '2010-UPDATE-OTBND-UPC'                            04232001
042330                             TO PV-PARAGRAPH-NAME                 04233001
042340          MOVE 'UPDATE SUT_OTBND_UPD'                             04234001
042350                             TO PV-DB2-OPERATION-MSG-1            04235001
042360          MOVE 'SUT00028'    TO PV-DB2-TABLE-NAME                 04236001
042370          PERFORM 9999-DB2-ABEND                                  04237001
042380     END-EVALUATE.                                                04238001
042390                                                                  04239001
042391     ADD +1 TO PV-COMMIT-CNT.                                     04239101
042392                                                                  04239201
042393*    IF  PV-COMMIT-CNT = 100                                      04239314
042394*        PERFORM 7200-COMMIT                                      04239414
042395*        MOVE ZERO TO PV-COMMIT-CNT                               04239514
042396*    END-IF.                                                      04239614
042397                                                                  04239701
042400                                                                  04240000
045700 2100-PROCESS-SUMMARY-FILE.                                       04570001
045800                                                                  04580000
045810     IF  PC998-CORRECT-OPER  =  PV-PREV-OPER    AND               04581021
045820         PC998-CORRECT-RCVR  =  PV-PREV-RCVR    AND               04582021
045830         PC998-TRN-NBR       =  PV-PREV-TRN-NBR AND               04583021
045840         PC998-TRN-LNE-NBR   =  PV-PREV-TRN-LNE-NBR               04584021
045841         CONTINUE                                                 04584123
045842     ELSE                                                         04584223
045843         PERFORM 2120-UPDATE-DISTHD                               04584301
045844         MOVE  PC998-CORRECT-OPER  TO  PV-PREV-OPER               04584421
045845         MOVE  PC998-CORRECT-RCVR  TO  PV-PREV-RCVR               04584521
045846         MOVE  PC998-TRN-NBR       TO  PV-PREV-TRN-NBR            04584621
045847         MOVE  PC998-TRN-LNE-NBR   TO  PV-PREV-TRN-LNE-NBR        04584721
045848     END-IF.                                                      04584801
045850                                                                  04585001
045900     PERFORM 2110-UPDATE-DISTDT.                                  04590001
046000                                                                  04600000
046100     PERFORM 7100-READ-SUMMARY.                                   04610001
046200                                                                  04620000
046300 2110-UPDATE-DISTDT.                                              04630001
046301                                                                  04630101
046309     MOVE PC998-TRN-NBR            TO DISTDT-ORD-NBR.             04630921
046310     MOVE PC998-CORRECT-RCVR       TO DISTDT-RCVR-SEQ-NBR.        04631021
046311     MOVE PC998-TRN-LNE-NBR        TO DISTDT-ORD-LNE-NBR.         04631121
046312     MOVE PC998-DEST-LOC-NBR       TO DISTDT-STR-NBR.             04631221
046313     MOVE PC998-SHPD-UNT-QTY       TO DISTDT-ACTL-ALLOC-QTY.      04631321
046320                                                                  04632001
046330                                                                  04633001
046500     EXEC SQL                                                     04650027
046600         UPDATE TDISTDT                                           04660027
046700            SET ACTL_ALLOC_QTY = :DISTDT-ACTL-ALLOC-QTY           04670027
046800          WHERE ORD_NBR        = :DISTDT-ORD-NBR                  04680027
046900            AND RCVR_SEQ_NBR   = :DISTDT-RCVR-SEQ-NBR             04690027
047000            AND ORD_LNE_NBR    = :DISTDT-ORD-LNE-NBR              04700027
047100            AND STR_NBR        = :DISTDT-STR-NBR                  04710027
047600     END-EXEC.                                                    04760027
047700                                                                  04770000
047710*    EXEC SQL                                                     04771027
047720*        SELECT STR_NBR                                           04772027
047721*          INTO :PV-TEST-STR-NBR                                  04772127
047722*          FROM TDISTDT                                           04772227
047740*         WHERE ORD_NBR        = :DISTDT-ORD-NBR                  04774027
047750*           AND RCVR_SEQ_NBR   = :DISTDT-RCVR-SEQ-NBR             04775027
047760*           AND ORD_LNE_NBR    = :DISTDT-ORD-LNE-NBR              04776027
047770*           AND STR_NBR        = :DISTDT-STR-NBR                  04777027
047780*    END-EXEC.                                                    04778027
047790                                                                  04779014
047800     EVALUATE TRUE                                                04780000
047900         WHEN SQLCODE = ZERO                                      04790000
047910              DISPLAY 'DISTDT UPDATE: ' PC998-TRN-NBR             04791021
047920                      '-'            PC998-CORRECT-RCVR           04792021
047921                      '-'            PC998-TRN-LNE-NBR            04792121
047930                      '-'            PC998-DEST-LOC-NBR           04793021
048000              ADD +1 TO PV-UPDATE-DISTDT-CNT                      04800001
048010                                                                  04801001
048100         WHEN SQLCODE = +100                                      04810001
048110              DISPLAY 'NO DISTDT UPD: ' PC998-TRN-NBR             04811021
048120                      '-'            PC998-CORRECT-RCVR           04812022
048121                      '-'            PC998-TRN-LNE-NBR            04812121
048130                      '-'            PC998-DEST-LOC-NBR           04813021
048200              ADD +0 TO PV-NO-UPD-DISTDT-CNT                      04820001
048300                                                                  04830001
049000         WHEN SQLWARN0 NOT = SPACE                                04900000
049100         WHEN SQLCODE < ZERO                                      04910000
049200         WHEN SQLCODE > ZERO                                      04920000
049610              DISPLAY  '2110-UPDATE-DISTDT'                       04961001
049620              DISPLAY  PC998-TRN-NBR ' - '                        04962021
049630                       PC998-CORRECT-RCVR ' - '                   04963021
049640                       PC998-TRN-LNE-NBR ' - '                    04964021
049641                       PC998-DEST-LOC-NBR                         04964121
049650                                                                  04965001
049900          MOVE '2110-UPDATE-DISTDT   '                            04990001
050000                             TO PV-PARAGRAPH-NAME                 05000000
050100          MOVE 'UPDATE TDISTDT      '                             05010001
050200                             TO PV-DB2-OPERATION-MSG-1            05020000
050300          MOVE 'TDISTDT '    TO PV-DB2-TABLE-NAME                 05030001
050400          PERFORM 9999-DB2-ABEND                                  05040000
050500     END-EVALUATE.                                                05050000
050600                                                                  05060000
050700                                                                  05070001
050800 2120-UPDATE-DISTHD.                                              05080001
051300                                                                  05130001
051400     MOVE PV-PREV-TRN-NBR          TO DISTHD-ORD-NBR.             05140001
051500     MOVE PV-PREV-RCVR             TO DISTHD-RCVR-SEQ-NBR.        05150001
051600     MOVE PV-PREV-TRN-LNE-NBR      TO DISTHD-ORD-LNE-NBR.         05160001
051900                                                                  05190001
052100     EXEC SQL                                                     05210027
052200         UPDATE TDISTHD                                           05220027
052300            SET RSLTS_RCVD_TMST = CURRENT TIMESTAMP               05230027
052310              , PRCG_STAT_CDE   = 'B'                             05231028
052400          WHERE ORD_NBR         = :DISTHD-ORD-NBR                 05240027
052500            AND RCVR_SEQ_NBR    = :DISTHD-RCVR-SEQ-NBR            05250027
052600            AND ORD_LNE_NBR     = :DISTHD-ORD-LNE-NBR             05260027
052800     END-EXEC.                                                    05280027
052810                                                                  05281014
052820*    EXEC SQL                                                     05282027
052830*        SELECT PRCG_STAT_CDE                                     05283027
052840*          INTO :PV-TEST-PRCG-STAT                                05284027
052850*          FROM TDISTHD                                           05285027
052860*         WHERE ORD_NBR         = :DISTHD-ORD-NBR                 05286027
052870*           AND RCVR_SEQ_NBR    = :DISTHD-RCVR-SEQ-NBR            05287027
052880*           AND ORD_LNE_NBR     = :DISTHD-ORD-LNE-NBR             05288027
052890*    END-EXEC.                                                    05289027
052900                                                                  05290001
053000     EVALUATE TRUE                                                05300001
053100         WHEN SQLCODE = ZERO                                      05310001
053110              DISPLAY  'UPDATE TDISTHD - '                        05311014
053111                       PV-PREV-TRN-NBR    ' - '                   05311124
053120                       PV-PREV-RCVR       ' - '                   05312024
053130                       PV-PREV-TRN-LNE-NBR                        05313024
053150              DISPLAY  ' '                                        05315017
053200              ADD +1 TO PV-UPDATE-DISTHD-CNT                      05320001
053300                                                                  05330001
053400         WHEN SQLCODE = +100                                      05340001
053410              DISPLAY  'NO UPD TDISTHD - '                        05341014
053420                       PV-PREV-TRN-NBR    ' - '                   05342024
053430                       PV-PREV-RCVR       ' - '                   05343024
053440                       PV-PREV-TRN-LNE-NBR                        05344024
053460              ' '                                                 05346014
053500              ADD +0 TO PV-NO-UPD-DISTHD-CNT                      05350001
053600                                                                  05360001
053700         WHEN SQLWARN0 NOT = SPACE                                05370001
053800         WHEN SQLCODE < ZERO                                      05380001
053900         WHEN SQLCODE > ZERO                                      05390001
054000              DISPLAY  '2120-UPDATE-DISTHD'                       05400001
054100              DISPLAY  PV-PREV-TRN-NBR    ' - '                   05410001
054200                       PV-PREV-RCVR       ' - '                   05420001
054300                       PV-PREV-TRN-LNE-NBR ' - '                  05430001
054400                       PC998-DEST-LOC-NBR                         05440024
054500                                                                  05450001
054600          MOVE '2120-UPDATE-DISTDT   '                            05460001
054700                             TO PV-PARAGRAPH-NAME                 05470001
054800          MOVE 'UPDATE TDISTHD      '                             05480001
054900                             TO PV-DB2-OPERATION-MSG-1            05490001
055000          MOVE 'TDISTHD '    TO PV-DB2-TABLE-NAME                 05500001
055100          PERFORM 9999-DB2-ABEND                                  05510001
055200     END-EVALUATE.                                                05520001
055201                                                                  05520101
055210     ADD +1 TO PV-COMMIT-CNT.                                     05521001
055220                                                                  05522001
055230*    IF  PV-COMMIT-CNT = 100                                      05523018
055240*        PERFORM 7200-COMMIT                                      05524018
055250*        MOVE ZERO TO PV-COMMIT-CNT                               05525018
055260*    END-IF.                                                      05526018
055300                                                                  05530001
055400                                                                  05540001
077095*---------------------------------------------------------------* 07709501
077096* READ DETAIL                                                   * 07709601
077097*---------------------------------------------------------------* 07709701
077098 7000-READ-DETAIL.                                                07709801
077099                                                                  07709901
077100     READ INPUT-DETAIL-FILE                                       07710001
077101          INTO PC999-OUTPUT-RECORD                                07710101
077102          AT END                                                  07710201
077103              SET PS-DETAIL-EOF TO TRUE.                          07710301
077104                                                                  07710401
077105     IF  PS-DETAIL-EOF                                            07710501
077106         CONTINUE                                                 07710601
077107     ELSE                                                         07710701
077108         ADD +1 TO PV-DETAIL-COUNT                                07710813
077116     END-IF.                                                      07711601
077117                                                                  07711701
077118                                                                  07711801
077120*---------------------------------------------------------------* 07712001
077121* READ SUMMARY                                                  * 07712101
077122*---------------------------------------------------------------* 07712201
077123 7100-READ-SUMMARY.                                               07712305
077124                                                                  07712401
077125     READ INPUT-SUMMARY-FILE                                      07712501
077126          INTO PC998-OUTPUT-RECORD                                07712621
077127          AT END                                                  07712701
077128              SET PS-SUMMARY-EOF TO TRUE.                         07712801
077129                                                                  07712901
077130     IF  PS-SUMMARY-EOF                                           07713001
077131         CONTINUE                                                 07713101
077132     ELSE                                                         07713201
077133         ADD +1 TO PV-SUMMARY-COUNT                               07713313
077134     END-IF.                                                      07713401
077135                                                                  07713501
077136                                                                  07713601
077139*---------------------------------------------------------------* 07713901
077140* COMMIT                                                        * 07714001
077141*---------------------------------------------------------------* 07714101
077142*7200-COMMIT.                                                     07714214
077143*                                                                 07714314
077150*    EXEC SQL                                                     07715014
077200*         COMMIT                                                  07720014
077300*    END-EXEC.                                                    07730014
077400*                                                                 07740014
077600*                                                                 07760014
088000* ************************************************************** *08800000
088100* * DISPLAY INFORMATION NEEDED FOR DEBUGGING/MAINTENANCE/SUPPORT *08810000
088200* * AND CALL THE ABEND PROCESSOR IN THE EVENT THAT AN          * *08820000
088300* * SQL ERROR OR WARNING CODE OCCURS.                          * *08830000
088400* ************************************************************** *08840000
088500 9999-DB2-ABEND.                                                  08850000
088600                                                                  08860000
088700     DISPLAY PC-CURRENT-PROGRAM-NAME ' 9999-DB2-ABEND'            08870001
088900     DISPLAY PC-CURRENT-PROGRAM-NAME ' ** ABEND           **'     08890001
089100     DISPLAY PC-CURRENT-PROGRAM-NAME                              08910000
089200             ' ** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.       08920000
089300     DISPLAY PC-CURRENT-PROGRAM-NAME                              08930000
089400             ' ** TABLES AFFECTED ** = ' PV-DB2-TABLE-NAME.       08940000
089500     DISPLAY PC-CURRENT-PROGRAM-NAME                              08950000
089600             ' ** OPERATION       ** = ' PV-DB2-OPERATION-MSG-1.  08960000
089700                                                                  08970000
089800     DISPLAY PC-CURRENT-PROGRAM-NAME                              08980000
089900             ' ** SQLCODE         ** = ' SQLCODE.                 08990000
090000     MOVE SQLCODE TO PV-SQLCODE.                                  09000000
090100     DISPLAY PC-CURRENT-PROGRAM-NAME                              09010000
090200             ' ** PV-SQLCODE      ** = ' PV-SQLCODE '.'.          09020000
090300                                                                  09030000
090400     DISPLAY PC-CURRENT-PROGRAM-NAME                              09040000
090500             ' ** SQLWARN0        ** = ' SQLWARN0 '.'.            09050000
090600                                                                  09060000
090700                                                                  09070000
090800*----------------------------------------------------------------*09080000
090900* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *09090000
091000* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *09100000
091100* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *09110000
091200* FORMAT.                                                        *09120000
091300*----------------------------------------------------------------*09130000
091400     COPY DPPD004.                                                09140000
091500                                                                  09150000
091600                                                                  09160000
091700*----------------------------------------------------------------*09170000
091800* CALL ABEND                                                     *09180000
091900*----------------------------------------------------------------*09190000
092000     MOVE +4013                  TO ABEND-CODE.                   09200000
092100     CALL 'ILBOABN0' USING ABEND-CODE.                            09210000
092200*                                                                 09220000
