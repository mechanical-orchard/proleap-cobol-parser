      *****************************************************************         
      *  INWS401 - COMMON DEPARTMENT LOOKUP WORKING STORAGE.                    
      *                                                                         
      *-----------------------------------------------------------------        
      *CHANGE HISTORY:                                                          
      * WR/PROJ DATE       PGMR          DESCRIPTION OF CHANGES                 
      * ------- ---------- -----------   -------------------------------        
      * W28582  09-01-2006 J SELWITSCHKA INITIAL IMPLEMENTATION                 
      * W33304  05-23-2008 C EBERT        HOLD INVENTORY LEDGER OPEN            
      * W33304                            ACROSS PERIODS                        
      *         02-01-2024 B MCASEY       REMOVE REFERENCE TO ESTIMATED         
      * CHG0300700                        INVENTORY IN INV_LOC_CSR              
      *-----------------------------------------------------------------        
      *PURPOSE: COMMON INVENTORY DEPARTMENT LOOKUP.                             
      *                                                                         
      *NOTE:    REFER TO INPD401 FOR EACH PROCESSING OPTION.                    
      *           THE INPUT FIELDS WILL BE INITIALIZED AFTER EACH               
      *           PERFORM OF IN401-INV-DEPT-LOOKUP.                             
      *                                                                         
      *-----------------------------------------------------------------        
      *  HOW TO USE THIS COPYBOOK WITH INPD401:                                 
      *-----------------------------------------------------------------        
      *  1.  FILL THE INPUT VARIABLES BEFORE PERFORMING PARAGRAPH               
      *      IN401-INV-DEPT-LOOKUP. AT A MINIMUM, LOCATION NUMBER               
      *      (IN401-PV-LOOKUP-LOC-NBR) AND DEPARTMENT NUMBER                    
      *      (IN401-PV-LOOKUP-DEPT-NBR) MUST BE FILLED. IF INVENTORY ID         
      *      IS AVAILABLE, FILL IN401-PV-LOOKUP-INV-ID. THE LOOKUP IS           
      *      MOVE EFFICIENT IF INVENTORY ID IS PROVIDED.                        
      *                                                                         
      *  2.  PERFORM PARAGRAPH IN401-INV-DEPT-LOOKUP.                           
      *                                                                         
      *  3.  CHECK RESULTS.                                                     
      *      - DEPARTMENT LOOKUP RETURN CODE VARIABLES ARE DEFINED HERE.        
      *        (IN401-PV-COMMON-AREA)                                           
      *         - RETURN STATUS CODE                                            
      *         - RETURN STATUS CODE REASON TEXT                                
      *                                                                         
      *      - ON A SUCCESSFUL EXECUTION CHECK WHETHER THE DEPARTMENT           
      *        QUALIFIES FOR INVENTORY. IF IT QUALIFIES,                        
      *        IN401-PS-QUALIFIES-YES WILL BE TRUE. IF IT DOES NOT              
      *        QUALIFY, IN401-PS-QUALIFIES-NO WILL BE TRUE.                     
      *                                                                         
      *-----------------------------------------------------------------        
      *                                                                         
      *  4.  ERROR HANDLING PASSED TO THE SOURCE MODULE.                        
      *                                                                         
      ******************************************************************        
                                                                                
       01  IN401-PV-PROGRAM-VARIABLE.                                           
           05  IN401-PV-MAX-RETRIES    PIC S9(03) VALUE +03 COMP-3.     INKUT102
           05  IN401-PV-INPUT-AREA.                                             
               10  IN401-PV-LOOKUP-INV-ID       PIC S9(09) COMP.                
               10  IN401-PV-LOOKUP-LOC-NBR      PIC S9(04) COMP.                
               10  IN401-PV-LOOKUP-DEPT-NBR     PIC S9(04) COMP-3.              
               10  IN401-PV-LOOKUP-MAJ-CL-NBR   PIC S9(04) COMP-3.              
                                                                                
                                                                                
           05  IN401-PV-COMMON-AREA.                                            
               10  IN401-PV-SQL-SUB        PIC 9(03)  VALUE ZERO.       INKUT102
               10  IN401-PV-RETURN-STATUS-AREA.                                 
                   15  IN401-PV-SQLCDE     PIC S9(9) COMP-4 VALUE ZEROS.        
                   15  IN401-PV-RETURN-CDE PIC S9(04) COMP VALUE ZEROS.         
                       88  IN401-PV-RET-CODE-OK            VALUE ZEROS.         
                       88  IN401-PV-INVALID-INPUT          VALUE +04.           
                       88  IN401-PV-INV-OVERFLOW           VALUE +08.           
                       88  IN401-PV-INV-LOC-OVERFLOW       VALUE +10.           
                       88  IN401-PV-DEPT-INV-OVERFLOW      VALUE +12.           
                       88  IN401-PV-SQL-ERROR              VALUE +16.           
                   15  IN401-PV-RETURN-RSN PIC X(40)       VALUE SPACES.        
      *** ANY NEW 'ERROR RELATED' IN401-PV-RETURN-RSN NEED TO INCLUDED          
      *** IN THE IN401-PV-INVALID-KEY-INPUT LEVEL 88...                         
                       88  IN401-PV-INVALID-KEY-INPUT      VALUES ARE           
                           'THE LOCATION IS MISSING OR INVALID      ',          
                           'THE DEPT IS MISSING OR INVALID          ',          
                           'INTERNAL TABLE MAXIMUM EXCEEDED         ',          
                           'CURSOR OPEN ISSUE                       ',          
                           'CURSOR FETCH ISSUE                      ',          
                           'CURSOR CLOSE ISSUE                      ',          
                           'DEADLOCK ERROR - ATTRIBUTES             ',          
                           'DEADLOCK ERROR - PRICE                  ',          
                           'AN UNDEFINED SQLCODE ERROR IS PRESENT   '.          
      *** VALID RETURN MESSAGES....                                             
      *** INVALID "ERROR" RETURN MESSAGES....                                   
                       88  IN401-PV-INVALID-LOCATION       VALUE                
                           'THE LOCATION IS MISSING OR INVALID      '.          
                       88  IN401-PV-INVALID-DEPT           VALUE                
                           'THE DEPT IS MISSING OR INVALID          '.          
                       88  IN401-PV-TABLE-OVERFLOW         VALUE                
                           'INTERNAL TABLE MAXIMUM EXCEEDED         '.          
                       88  IN401-PV-CURSOR-OPEN            VALUE                
                           'CURSOR OPEN ISSUE                       '.          
                       88  IN401-PV-CURSOR-FETCH           VALUE                
                           'CURSOR FETCH ISSUE                      '.          
                       88  IN401-PV-CURSOR-CLOSE           VALUE                
                           'CURSOR CLOSE ISSUE                      '.          
                       88  IN401-PV-DEADLOCK-ATTRIB        VALUE                
                           'DEADLOCK ERROR - ATTRIBUTES             '.          
                       88  IN401-PV-DEADLOCK-PRICE         VALUE                
                           'DEADLOCK ERROR - PRICE                  '.          
                   15  IN401-PV-PARAGRAPH  PIC X(100) VALUE SPACES.             
                                                                                
           05  IN401-PS-SWITCHES.                                               
               10  IN401-PS-INV-FOUND-SW          PIC X(01) VALUE 'Y'.          
                   88  IN401-PS-INV-NOT-FOUND               VALUE 'N'.          
                   88  IN401-PS-INV-FOUND                   VALUE 'Y'.          
               10  IN401-PS-INV-LOC-FOUND-SW      PIC X(01) VALUE 'Y'.          
                   88  IN401-PS-INV-LOC-NOT-FOUND           VALUE 'N'.          
                   88  IN401-PS-INV-LOC-FOUND               VALUE 'Y'.          
               10  IN401-PS-DEPT-INV-FOUND-SW     PIC X(01) VALUE 'Y'.          
                   88  IN401-PS-DEPT-INV-NOT-FOUND          VALUE 'N'.          
                   88  IN401-PS-DEPT-INV-FOUND              VALUE 'Y'.          
               10  IN401-PS-STORE-0000-FND2-SW    PIC X(01) VALUE 'N'.          
                   88  IN401-PS-STORE-0000-FND2             VALUE 'N'.          
                   88  IN401-PS-STORE-0000-NOTFND2          VALUE 'Y'.          
               10  IN401-PS-STORE-SPEC-FND2-SW    PIC X(01) VALUE 'N'.          
                   88  IN401-PS-STORE-SPEC-FND2             VALUE 'N'.          
                   88  IN401-PS-STORE-SPEC-NOTFND2          VALUE 'Y'.          
               10  IN401-PS-STORE-SPEC-FND3-SW    PIC X(01) VALUE 'N'.          
                   88  IN401-PS-STORE-SPEC-FND3             VALUE 'N'.          
                   88  IN401-PS-STORE-SPEC-NOTFND3          VALUE 'Y'.          
               10  IN401-PS-QUALIFIES-SW          PIC X(01) VALUE 'N'.          
                   88  IN401-PS-QUALIFIES-NO                VALUE 'N'.          
                   88  IN401-PS-QUALIFIES-YES               VALUE 'Y'.          
               10  IN401-PS-FIRST-TIME-SW         PIC X(01) VALUE 'Y'.          
                   88  IN401-PS-FIRST-TIME                  VALUE 'Y'.          
                   88  IN401-PS-FIRST-TIME-NO               VALUE 'N'.          
               10  IN401-PS-INV-TYPE-SW           PIC X(01) VALUE 'N'.          
                   88  IN401-PS-STORE-INV                   VALUE 'Y'.          
                   88  IN401-PS-NOT-STORE-INV               VALUE 'N'.          
                                                                                
           05  IN401-PV-WORK-AREA.                                              
               10  IN401-PV-INV-ID-PREV        PIC S9(09) COMP VALUE -1.        
               10  IN401-PV-INV-ID             PIC  9(09) VALUE ZEROES.         
               10  IN401-PV-LOC-NBR            PIC  9(04) VALUE ZEROES.         
               10  IN401-PV-DEPT-NBR           PIC  9(04) VALUE ZEROES.         
                                                                        INKUT102
           05  IN401-TABLE-AREA.                                                
               10  IN401-INV-TABLE.                                             
                   15  IN401-INV OCCURS 999 TIMES INDEXED BY                    
                                                 IN401-INV-INDX                 
                                                 IN401-INV-INDX-MAX.            
                       20  IN401-INV-ID          PIC S9(09) COMP.               
                       20  IN401-INV-0000-FND-SW PIC X(01) VALUE SPACE.         
                           88  IN401-INV-0000-FND          VALUE 'Y'.           
                           88  IN401-INV-0000-NOTFND       VALUE 'N'.           
               10  FILLER                 PIC X(147) VALUE SPACES.              
                                                                                
               10  IN401-INV-LOC-TABLE.                                         
                   15  IN401-INV-LOC OCCURS 9999  TIMES INDEXED BY              
                                                  IN401-LOC-INDX                
                                                  IN401-LOC-INDX-MAX.           
                       20  IN401-LOC-INV-ID      PIC S9(09) COMP.               
                       20  IN401-LOC-NBR         PIC S9(04) COMP.               
W33304                 20  IN401-OPN-FSCL-MN-DTE PIC X(10) VALUE SPACES.        
W33304                 20  IN401-PLND-FIN-BK-DTE PIC X(10) VALUE SPACES.        
W33304                 20  IN401-FINCL-INV-STAT-CDE                             
W33304                                           PIC X(02) VALUE SPACES.        
               10  FILLER                 PIC X(147) VALUE SPACES.              
                                                                                
               10  IN401-DEPT-INV-TABLE.                                        
                   15  IN401-DEPT-INV-TB OCCURS 99999 TIMES INDEXED BY          
                                                   IN401-DEPT-INDX              
                                                   IN401-DEPT-INDX-MAX.         
                       20  IN401-DEPT-INV-ID     PIC S9(09) COMP.               
                       20  IN401-DEPT-LOC-NBR    PIC S9(04) COMP.               
                       20  IN401-DEPT-NBR        PIC S9(04) COMP-3.             
                       20  IN401-MAJ-CL-NBR      PIC S9(04) COMP-3.             
               10  FILLER                 PIC X(147) VALUE SPACES.              
                                                                                
      ******************************************************************        
      *  INVENTORY CONTROL TABLE                                                
      ******************************************************************        
           EXEC SQL                                                             
               INCLUDE TINCNTL                                                  
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
      *  INVENTORY PARAMETERS TABLE                                             
      ******************************************************************        
           EXEC SQL                                                             
               INCLUDE TINVPAR                                                  
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
      *  INVENTORY DEPARTMENT TABLE                                             
      ******************************************************************        
           EXEC SQL                                                             
               INCLUDE INT00004                                                 
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
      *  INVENTORY LOCATION CURSOR.                                             
      *  LOOKUP ALL ACTIVE INVENTORY CYCLES AND ASSOCIATED LOCATIONS.           
      *****************************************************************         
           EXEC SQL                                                             
                DECLARE INV_LOC_CSR CURSOR FOR                                  
                   SELECT B.INV_ID                                              
                         ,B.LOC_NBR                                             
W33304                   ,A.OPN_FSCL_MN_DTE                                     
W33304                   ,A.PLND_FIN_BKG_DTE                                    
W33304                   ,B.FINCL_INV_STAT_CDE                                  
                   FROM TINCNTL           A                                     
                       ,TINVPAR           B                                     
                   WHERE A.INV_ID   = B.INV_ID                                  
                     AND A.ACTV_IND = 'Y'                                       
W33304               AND B.LOC_INV_STAT_CDE = 'IN'                              
0224RM****           AND B.SCHD_PHY_CNT_CDE <> 'EI'                             
W33304               AND B.ACTL_FIN_BK_DTE = '9999-09-09'                       
W33304             ORDER BY A.PLND_FIN_BKG_DTE                                  
                           ,B.INV_ID                                            
                           ,B.LOC_NBR                                           
                   FOR FETCH ONLY                                               
                   WITH UR                                                      
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
      *  DEPARTMENT INVENTORY CURSOR.                                           
      *  LOOKUP ALL DEPARTMENTS SET-UP FOR INVENTORY.                           
      *****************************************************************         
           EXEC SQL                                                             
                DECLARE DEPT_INV_CSR CURSOR FOR                                 
                   SELECT B.INV_ID                                              
                         ,B.LOC_NBR                                             
                         ,B.DEPT_NBR                                            
                         ,B.MAJ_CL_NBR                                          
                   FROM TINCNTL           A                                     
                       ,INT_INV_PARM_MDSE B                                     
                   WHERE A.INV_ID = B.INV_ID                                    
                     AND A.ACTV_IND = 'Y'                                       
                   ORDER BY B.INV_ID                                            
                           ,B.LOC_NBR                                           
                           ,B.DEPT_NBR                                          
                   FOR FETCH ONLY                                               
                   WITH UR                                                      
           END-EXEC.                                                            
                                                                                
