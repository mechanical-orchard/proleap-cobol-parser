000100*-----------------------*                                         00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300*-----------------------*                                         00030001
000400 PROGRAM-ID.    CNKCS249.                                         00040001
000500 AUTHOR.        DENISE HAHN.                                      00050001
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060001
000700 DATE-WRITTEN.  01-24-2017.                                       00070001
000800 DATE-COMPILED.                                                   00080001
000900                                                                  00090001
001000                                                                  00100001
001100*---------------------------------------------------------------* 00110001
001200*    Y249 - WST_ATTR_ELEM - ADD/UPDATE                          * 00120001
001300*---------------------------------------------------------------* 00130001
263455* CHANGED 11/03/2021    BY JIM HUNTER      WR: CHG0263455         00130125
263455* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00130225
263455* MAKING THE CALL DYNAMIC VS STATIC.                              00130325
263455*----------------------------------------------------------------*00130425
CICS  * CHANGED 10/25/2022    BY JIM HUNTER      WR: CHG0276961         00130526
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00130626
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00130726
CICS  *-----------------------------------------------------------------00130826
001310                                                                  00131001
001340                                                                  00134001
001350 EJECT                                                            00135001
001360 ENVIRONMENT DIVISION.                                            00136001
001370                                                                  00137001
001380 DATA DIVISION.                                                   00138001
001390                                                                  00139001
001400 WORKING-STORAGE SECTION.                                         00140001
001500                                                                  00150001
001600 01  DK-DB2-KEYS.                                                 00160001
001700     05  DK-INTGRTN-TYP            PIC   X(10)    VALUE SPACES.   00170001
001800     05  DK-ATTR-DEFN-SEQ          PIC  S9(4) COMP VALUE ZEROS.   00180001
001900     05  DK-ATTR-ELEM-SEQ          PIC  S9(9) COMP VALUE ZEROS.   00190001
002000     05  DK-CURRENT-TIMESTAMP      PIC   X(26)     VALUE SPACES.  00200001
003100                                                                  00310001
003200 01  PC-PROGRAM-CONSTANTS.                                        00320001
003300     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE 'CNK249  '.  00330001
003400     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE 'CNKM249 '.  00340001
003500     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE 'CNKCS249'.  00350001
003501                                                                  00350101
003516     05  PC-LIST-QUEUE-SEQ         PIC  9(01)  VALUE 1.           00351601
003517**   05  PC-SEL-QUEUE-SEQ          PIC  9(01)  VALUE 2.           00351722
003518     05  PC-SEL-QUEUE-SEQ          PIC  9(01)  VALUE 3.           00351822
003519     05  PC-CRIT-SPEC-FORMAT       PIC  X(01)  VALUE '1'.         00351922
003520     05  PC-LIST-FORMAT            PIC  X(01)  VALUE '2'.         00352022
003521     05  PC-DEFN-LIST-FORMAT-ADD   PIC  X(01)  VALUE '4'.         00352122
003522     05  PC-ELEM-LIST-FORMAT-ADD   PIC  X(01)  VALUE '6'.         00352222
003523     05  PC-ELEM-LIST-FORMAT-UPD   PIC  X(01)  VALUE '7'.         00352322
003524     05  PC-ITEMS-PER-PANEL        PIC S9(04)  VALUE +07          00352422
003525                                               COMP SYNC.         00352522
003526     05  PC-MAX-BLOCKS-IN-ARRAY    PIC S9(04)  VALUE +2           00352622
003527                                               COMP SYNC.         00352722
003528     05  PC-MAX-ITEMS              PIC S9(09)  VALUE +1000000     00352822
003529                                               COMP-3.            00352922
003530     05  PC-MSG-NUMBER-LENGTH      PIC S9(04)  VALUE +5           00353022
003531                                               COMP SYNC.         00353122
003532     05  PC-MAX-RETRIES            PIC S9(03)  VALUE 3            00353222
003533                                               COMP-3.            00353322
005500     05  PC-INQ                    PIC  X(03)  VALUE 'INQ'.       00550001
005600     05  PC-UPD                    PIC  X(03)  VALUE 'UPD'.       00560001
005700     05  PC-DEL                    PIC  X(03)  VALUE 'DEL'.       00570001
005800     05  PC-ERR                    PIC  X(03)  VALUE 'ERR'.       00580001
005810                                                                  00581001
005900     05  PC-ELEM-SEQ         PIC  X(12)  VALUE 'ELEM SEQ    '.    00590001
006000     05  PC-DEFN-SEQ         PIC  X(12)  VALUE 'DEFN SEQ    '.    00600001
006100                                                                  00610001
006110     05  PC-DEFAULT-TMST           PIC  X(26)  VALUE              00611001
006120                                   '9999-12-31-23.59.59.999999'.  00612001
006130     05  PC-DECIMAL                PIC  X(01)  VALUE ".".         00613001
006140                                                                  00614001
006150*----------------------------------------------------------------*00615001
006160*  SYSTEM MESSAGES                                               *00616001
006170*----------------------------------------------------------------*00617001
006180*   00004 = F2 TO CONFIRM REQUEST                                *00618001
006190*   00005 = INVALID VALUE                                        *00619001
006200*   00007 = REQUIRED ENTRY                                       *00620001
006300*   00008 = MUST BE NUMERIC                                      *00630001
006400*   00009 = INVALID DATE                                         *00640001
006500*   00034 = ADD SUCCESSFUL                                       *00650001
006600*   00050 - NO LIST ITEMS WERE FOUND FOR THE CRITERIA SPECIFIED  *00660001
006700*   00051 - NO END OF RANGE HAS BEEN SPECIFIED                   *00670001
006800*   00052 - END OF RANGE PRECEDES START OF RANGE                 *00680001
006900*   00053 - NO START OF RANGE HAS BEEN SPECIFIED                 *00690001
007000*   00054 - ONLY ONE START OF RANGE INDICATOR MAY BE SPECIFIED   *00700001
007100*   00055 - ONLY ONE END OF RANGE INDICATOR MAY BE SPECIFIED     *00710001
007200*   00057 - A LIST ITEM MUST BE SELECTED FOR THIS FUNCTION       *00720001
007300*   00059 - UPDATE(S) SUCCESSFUL                                 *00730001
007400*   00069 - TOP OF LIST                                          *00740001
007500*   00070 - BOTTOM OF LIST                                       *00750001
007600*   00101 - VALUE MUST BE > ZERO AND  < 1,000,000                *00760001
007700*   00279 - MORE ITEMS TO DISPLAY                                *00770001
007710*   03792 - ALL PARM ELEMENTS MUST BE SELECTED                   *00771015
007800*----------------------------------------------------------------*00780001
007900     05  PC-TSYMSG-NUMBERS.                                       00790001
008000         10  PC-TSYMSG-00004            PIC  9(05)  VALUE 00004.  00800001
008100         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00810001
008200         10  PC-TSYMSG-00007            PIC  9(05)  VALUE 00007.  00820001
008300         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00830001
008400         10  PC-TSYMSG-00009            PIC  9(05)  VALUE 00009.  00840001
008500         10  PC-TSYMSG-00034            PIC  9(05)  VALUE 00034.  00850001
008600         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00860001
008700         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00870001
008800         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00880001
008900         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00890001
009000         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00900001
009100         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00910001
009200         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00920001
009300         10  PC-TSYMSG-00059            PIC  9(05)  VALUE 00059.  00930001
009400         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00940001
009500         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00950001
009600         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00960001
009700         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00970001
009710         10  PC-TSYMSG-03792            PIC  9(05)  VALUE 03792.  00971015
009800                                                                  00980001
026800                                                                  02680001
026900 01  PS-PROGRAM-SWITCHES.                                         02690001
027000     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    02700001
027100         88  PS-NO-ERROR                            VALUE 'Y'.    02710001
027200         88  PS-ERROR                               VALUE 'N'.    02720001
027300     05  PS-BLOCK-ERROR-SW              PIC  X(01)  VALUE 'Y'.    02730001
027400         88  PS-NO-BLOCK-ERROR                      VALUE 'Y'.    02740001
027500         88  PS-BLOCK-ERROR                         VALUE 'N'.    02750001
027600     05  PS-CONFIRM-PROCESSING-IND      PIC  X(01)  VALUE  'N'.   02760001
027700         88  PS-CONFIRM-PROCESSING                  VALUE  'Y'.   02770001
027800         88  PS-NOT-CONFIRM-PROCESSING              VALUE  'N'.   02780001
027900     05  PS-SOFT-ABORT-ERROR-SW         PIC  X(01)  VALUE 'N'.    02790001
028000         88  PS-SOFT-ABORT-ERROR                    VALUE 'Y'.    02800001
028100         88  PS-NO-SOFT-ABORT-ERROR                 VALUE 'N'.    02810001
028200     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    02820001
028300         88  PS-COMMAREA-VALID                      VALUE 'Y'.    02830001
028400         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    02840001
028800     05  PS-LIST-END-SW                 PIC  X(01)  VALUE 'N'.    02880001
028900         88  PS-LIST-END                            VALUE 'Y'.    02890001
029000         88  PS-NO-LIST-END                         VALUE 'N'.    02900001
029100     05  PS-DATE-DEFINITION-FROM-TO-SW  PIC  X(01)  VALUE 'T'.    02910001
029200         88  PS-DATE-DEFN-FROM                      VALUE 'F'.    02920001
029300         88  PS-DATE-DEFN-TO                        VALUE 'T'.    02930001
029301                                                                  02930101
029310*    05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    02931001
029320*        88  PS-DONE                                VALUE 'Y'.    02932001
029330*        88  PS-NOT-DONE                            VALUE 'N'.    02933001
029400*    05  PS-EOF-STATUS-CSR-SW           PIC  X(01)  VALUE 'N'.    02940001
029500*        88  PS-EOF-STATUS-CSR-YES                  VALUE 'Y'.    02950001
029600*        88  PS-EOF-STATUS-CSR-NO                   VALUE 'N'.    02960001
029700*    05  PS-FIRST-ERR-LINE-FOUND-SW     PIC  X(01)  VALUE 'N'.    02970001
029800*        88  PS-FIRST-ERR-LINE-FOUND                VALUE 'Y'.    02980001
029900*        88  PS-FIRST-ERR-LINE-NOT-FOUND            VALUE 'N'.    02990001
030000                                                                  03000001
030100 01  PV-PROGRAM-VARIABLES.                                        03010001
030200*    05  PV-SAVE-ITEM-NUMBER            PIC  9(05)  VALUE 0.      03020001
030300     05  PV-CICS-RESPONSE               PIC S9(08)  VALUE ZEROES  03030001
030400                                        COMP SYNC.                03040001
030600     05  PV-SUB                         PIC S9(04)  VALUE +0      03060001
030700                                                    COMP SYNC.    03070001
030800     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      03080001
030900                                                    COMP SYNC.    03090001
031000     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      03100001
031100                                                    COMP-3.       03110001
031200     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      03120001
031300                                                    COMP-3.       03130001
031400     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      03140001
031500                                                    COMP-3.       03150001
031600     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      03160001
031700                                                    COMP-3.       03170001
031800     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      03180001
031900                                                    COMP-3.       03190001
032000     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      03200001
032100                                                    COMP-3.       03210001
032200     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      03220001
032300                                                    COMP-3.       03230001
032400     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      03240001
032500                                                    COMP SYNC.    03250001
032600     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      03260001
032700                                                    COMP SYNC.    03270001
032800     05  PV-ITEM                        PIC S9(04)  VALUE +0      03280001
032900                                                    COMP SYNC.    03290001
033000     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      03300001
033100                                                    COMP SYNC.    03310001
033200     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      03320001
033300                                                    COMP SYNC.    03330001
033400     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      03340001
033500                                                    COMP SYNC.    03350001
033600     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      03360001
033700                                                    COMP SYNC.    03370001
033800     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      03380001
033900                                                    COMP SYNC.    03390001
034000     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      03400001
034100                                                    COMP SYNC.    03410001
034200     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      03420001
034300                                                    COMP SYNC.    03430001
034400     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      03440001
034500                                                    COMP SYNC.    03450001
034600     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      03460001
034700                                                    COMP SYNC.    03470001
034800     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      03480001
034900                                                    COMP SYNC.    03490001
035000     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      03500001
035100                                                    COMP SYNC.    03510001
035110                                                                  03511001
035120     05  PV-WST00010-ELEM-COUNT         PIC S9(09)  COMP.         03512001
035130     05  PV-DATE-HOLD.                                            03513001
035140         10  PV-DATE-HOLD-CCYY          PIC 9(04)  VALUE ZEROES.  03514001
035150         10  FILLER                     PIC X(01).                03515001
035160         10  PV-DATE-HOLD-MM            PIC 9(02)  VALUE ZEROES.  03516001
035170         10  FILLER                     PIC X(01).                03517001
035180         10  PV-DATE-HOLD-DD            PIC 9(02)  VALUE ZEROES.  03518001
035190         10  FILLER                     PIC X(16).                03519001
035191                                                                  03519101
035192     05  PV-DATE-WORK.                                            03519201
035193         10  PV-DATE-WORK-CCYY          PIC 9(04)  VALUE ZEROES.  03519301
035194         10  PV-DATE-WORK-MM            PIC 9(02)  VALUE ZEROES.  03519401
035195         10  PV-DATE-WORK-DD            PIC 9(02)  VALUE ZEROES.  03519501
035196      05 PV-NUMBER-WORK                 PIC X(14)  VALUE SPACES.  03519601
035197      05 PV-NUM-LEN                     PIC S9(04) VALUE +0       03519701
035198                                                   COMP.          03519801
035199      05 PV-DECIMAL-WORK                PIC X(14)  VALUE SPACES.  03519901
035200      05 PV-DEC-LEN                     PIC S9(04) VALUE +0       03520001
035201                                                   COMP.          03520101
035202      05 PV-TEXT-WORK                   PIC X(50)  VALUE SPACES.  03520201
035203      05 PV-TEXT-LEN                    PIC S9(04) VALUE +0       03520301
035204                                                   COMP.          03520401
035205     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      03520501
035206                                                    COMP SYNC.    03520601
035207     05  PV-NULL-IND-1                  PIC S9(04)  VALUE +0      03520701
035208                                                    COMP.         03520801
035209     05  PV-NULL-IND-2                  PIC S9(04)  VALUE +0      03520901
035210                                                    COMP.         03521001
035211     05  PV-NULL-IND-3                  PIC S9(04)  VALUE +0      03521101
035212                                                    COMP.         03521201
035213     05  PV-SOFT-ABORT-MSG.                                       03521301
035214         10  FILLER            PIC X(12) VALUE ' CNKCS249 - '.    03521401
035215         10  FILLER            PIC X(09) VALUE 'SQLCODE: '.       03521501
035216         10  PV-SOFT-SQLCODE   PIC ZZ9-.                          03521601
035217         10  FILLER            PIC X(12) VALUE ' PARAGRAPH: '.    03521701
035218         10  PV-SOFT-PARAGRAPH PIC X(30).                         03521801
035219                                                                  03521901
035220     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     03522001
035221                                                     COMP SYNC.   03522101
035222     05  PV-CICS-MSG-AREA                PIC  X(80)  VALUE SPACE. 03522201
035223     05  PV-CICS-MSG-AREA2               PIC  X(100) VALUE SPACE. 03522301
035224                                                                  03522401
035225     05  PV-CICS-MSG-HOLD.                                        03522501
035226         10  FILLER                      PIC  X(01)  VALUE SPACE. 03522601
035227         10  PV-CICS-MSG-DATA            PIC  X(79)  VALUE SPACE. 03522701
035228                                                                  03522801
035229     05  PV-CICS-MSG-HOLD2.                                       03522901
035230         10  FILLER                      PIC  X(01)  VALUE SPACE. 03523001
035231         10  PV-CICS-MSG-DATA2           PIC  X(99)  VALUE SPACE. 03523101
035232                                                                  03523201
035233     05  PV-SEL-TERM-ID                  PIC  X(04).              03523301
035234     05  PV-SEL-TASK-NUMBER              PIC  9(05).              03523401
035235     05  PV-SEL-SEQ                      PIC  9(01).              03523501
035236                                                                  03523601
035237     05  PV-ORIGINAL-BLOCK               PIC S9(04)  VALUE +0     03523701
035238                                                     COMP SYNC.   03523801
035239     05  PV-ITEMS-HOLD                   PIC S9(03)  COMP-3.      03523901
035240     05  PV-ITEMS-DIFF                   PIC S9(03)  COMP-3.      03524001
035241                                                                  03524101
035242     05  PV-DISP-MAX-LENGTH             PIC ZZZ9    VALUE ZEROS.  03524201
035243     05  PV-DISP-DEC-POS                PIC ZZZ9    VALUE ZEROS.  03524301
035244     05  PV-DISP-ELEM-CNT               PIC ZZZ9    VALUE ZEROS.  03524401
035245     05  PV-DISP-ATTR-NBR               PIC 9(10).99-.            03524501
035246     05  PV-DISP-DEFN                   PIC 9(04)   VALUE ZEROS.  03524601
035247     05  PV-DISP-ELEM                   PIC 9(04)   VALUE ZEROS.  03524701
035248     05  PV-DISP-ATTR-ELEM              PIC 9(10).99-.            03524801
035249     05  PV-DISP-TASK-NUMBER            PIC 9(05).                03524923
035250                                                                  03525001
035251     05  PV-NULL-ELEM-TXT               PIC S9(04)  VALUE ZEROS   03525101
035252                                                    COMP SYNC.    03525201
035253     05  PV-ELEM-TXT-WORK.                                        03525301
035254         49  WS-ATTR-ELEM-TXT-LEN       PIC S9(4) COMP.           03525401
035255         49  WS-ATTR-ELEM-TXT-TEXT      PIC X(50).                03525501
035256                                                                  03525601
035257     05  PV-NULL-ELEM-TMST              PIC S9(04)  VALUE ZEROS   03525701
035258                                                    COMP SYNC.    03525801
035259     05  PV-NULL-ELEM-NBR               PIC S9(04)  VALUE ZEROS   03525901
035260                                                    COMP SYNC.    03526001
035261                                                                  03526101
035262     05  PV-MAX-ELEM-SEQ-NBR            PIC  S9(4)  COMP.         03526201
035263     05  PV-NEXT-ELEM-SEQ-NBR           PIC  S9(4)  COMP.         03526301
035264                                                                  03526401
035265                                                                  03526501
035270*    05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      03527001
035300*                                                   COMP SYNC.    03530001
052900                                                                  05290001
053000                                                                  05300001
054200******************************************************************05420001
054300**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **05430001
054400**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **05440001
054500**  APPLICATION-SPECIFIC COMMAREA.                              **05450001
054600******************************************************************05460001
054610 01  LQW-LIST-QUEUE-WORK-AREA.                                    05461001
054620     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  05462001
054630     05  LQW-ITEM-ENTRIES               OCCURS  7 TIMES           05463001
054640                                        INDEXED BY LQW-IDX.       05464001
054650         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       05465001
054660         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               05466001
054670         10  LQW-SELECTED-SW            PIC  X(01).               05467001
054680             88  LQW-SELECT                         VALUE 'S'.    05468001
054690             88  LQW-DESELECT                       VALUE ' '.    05469001
054691         10  LQW-ACTION                 PIC  X(01).               05469101
054692             88  LQW-ADD                            VALUE 'A'.    05469201
054693             88  LQW-INQ                            VALUE 'I'.    05469301
054694             88  LQW-UPD                            VALUE 'U'.    05469401
054695             88  LQW-ERR                            VALUE 'E'.    05469501
054696         10  LQW-DTL-ATTR-ELEM-SEQ   PIC  9(04).                  05469601
054697         10  LQW-DTL-ATTR-DEFN-SEQ   PIC  9(04).                  05469701
054698         10  LQW-DTL-DATA-TYPE       PIC  X(03).                  05469801
054699         10  LQW-DTL-DEFN-DESCR      PIC  X(12).                  05469901
054700         10  LQW-DTL-ELEM-VALUE      PIC  X(50).                  05470001
054701         10  LQW-DTL-ELEM-TEXT       PIC  X(50).                  05470101
054702         10  LQW-DTL-ELEM-TEXT-NULL  PIC  X(01).                  05470201
054703         10  LQW-DTL-ELEM-TMST       PIC  X(26).                  05470301
054704         10  LQW-DTL-ELEM-TMST-NULL  PIC  X(01).                  05470401
054705         10  LQW-DTL-ELEM-NBR        PIC  9(10).99-.              05470501
054706         10  LQW-DTL-ELEM-NBR-NULL   PIC  X(01).                  05470601
054707                                                                  05470701
058300                                                                  05830001
058400                                                                  05840001
058410*---------------------------------------------------------------* 05841001
058420* SELECTON QUEUE LAYOUT - FOR ELEMENT ADD/UPDATE(CNKCS249)      * 05842001
058430*---------------------------------------------------------------* 05843001
058440     COPY CNWS030.                                                05844001
058450                                                                  05845001
058460*---------------------------------------------------------------* 05846001
058470* SELECTON QUEUE LAYOUT - FROM INTEGRATION LIST (CNKCS246)      * 05847001
058480*---------------------------------------------------------------* 05848001
058490     COPY CNWS028.                                                05849001
058491                                                                  05849101
058497*----------------------------------------------------------------*05849701
058498*    CALENDAR ROUTINE                                            *05849801
058499*----------------------------------------------------------------*05849901
058500     COPY DPWS500.                                                05850001
058501                                                                  05850101
060400*---------------------------------------------------------------* 06040001
060500*    MAP LAYOUT                                                 * 06050001
060600*---------------------------------------------------------------* 06060001
060700                                                                  06070001
060800     COPY CNKM249.                                                06080001
060900                                                                  06090001
061000 01  MR-OCCURS-LAYOUT                   REDEFINES  CNK249O.       06100001
061100     05  FILLER                         PIC X(105).               06110001
061200     05  MR-SCROLL-AREA                 OCCURS  7 TIMES.          06120001
061300         10  MR-SELECTL                 PIC S9(04) COMP.          06130001
061400         10  MR-SELECTA                 PIC  X(01).               06140001
061500         10  MR-SELECTC                 PIC  X(01).               06150001
061600         10  MR-SELECTH                 PIC  X(01).               06160001
061700         10  MR-SELECTI                 PIC  X(01).               06170001
061800                                                                  06180001
061900         10  MR-ACTIONL                 PIC S9(04) COMP.          06190001
062010         10  MR-ACTIONA                 PIC  X(01).               06201008
062100         10  MR-ACTIONC                 PIC  X(01).               06210001
062200         10  MR-ACTIONH                 PIC  X(01).               06220001
062300         10  MR-ACTION                  PIC  X(01).               06230001
062400                                                                  06240001
062500         10  MR-DEFSEQL                PIC S9(04) COMP.           06250001
062610         10  MR-DEFSEQA                PIC  X(01).                06261008
062700         10  MR-DEFSEQC                PIC  X(01).                06270001
062800         10  MR-DEFSEQH                PIC  X(01).                06280001
062900         10  MR-DEFSEQ                 PIC  Z(04).                06290001
063000                                                                  06300001
063100         10  MR-DATYPEL                PIC S9(04) COMP.           06310001
063210         10  MR-DATYPEA                PIC  X(01).                06321008
063300         10  MR-DATYPEC                PIC  X(01).                06330001
063400         10  MR-DATYPEH                PIC  X(01).                06340001
063500         10  MR-DATYPE                 PIC  X(03).                06350001
063600                                                                  06360001
063700         10  MR-DADESCL                PIC S9(04) COMP.           06370001
063810         10  MR-DADESCA                PIC  X(01).                06381008
063900         10  MR-DADESCC                PIC  X(01).                06390001
064000         10  MR-DADESCH                PIC  X(01).                06400001
064100         10  MR-DADESC                 PIC  X(12).                06410001
064200                                                                  06420001
064300         10  MR-VALUEL                 PIC S9(04) COMP.           06430001
064410         10  MR-VALUEA                 PIC  X(01).                06441008
064500         10  MR-VALUEC                 PIC  X(01).                06450001
064600         10  MR-VALUEH                 PIC  X(01).                06460001
064700         10  MR-VALUE                  PIC  X(50).                06470001
064800                                                                  06480001
064900     05  FILLER                         PIC  X(12).               06490001
065000                                                                  06500001
065100                                                                  06510001
069600*---------------------------------------------------------------* 06960001
069700*    ATTRIBUTE SETTINGS COPYBOOK.                               * 06970001
069800*---------------------------------------------------------------* 06980001
069900                                                                  06990001
070000     COPY DPWS015.                                                07000001
070100                                                                  07010001
070200*---------------------------------------------------------------* 07020001
070300*    FUNCTION KEYS COPYBOOK.                                    * 07030001
070400*---------------------------------------------------------------* 07040001
070500                                                                  07050001
070600     COPY DPWS016.                                                07060001
070700                                                                  07070001
070800*---------------------------------------------------------------* 07080001
070900*    NUMERIC EDIT LAYOUT.                                       * 07090001
071000*---------------------------------------------------------------* 07100001
071100                                                                  07110001
071200     COPY DPWS010I.                                               07120001
071300                                                                  07130001
071400*---------------------------------------------------------------* 07140001
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 07150026
071600*---------------------------------------------------------------* 07160001
071700                                                                  07170001
071800     COPY DPWS030.                                                07180001
CICS       COPY DPWS930.                                                07190026
072000                                                                  07200001
072100*---------------------------------------------------------------* 07210001
072200*    STANDARD COMMAREA.                                         * 07220001
072300*---------------------------------------------------------------* 07230001
072400                                                                  07240001
072500     COPY DPWS020.                                                07250001
072600     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                07260001
072700                                                                  07270001
072800*---------------------------------------------------------------* 07280001
073810* INTER-APPLICATION COMMAREA.                                   * 07381001
073820*   CNWS022 - IS THE INPUT LAYOUT WHEN COMING FROM              * 07382001
073830*             DEFN_LIST ADD (CNKCS247)                          * 07383001
073840*             ELEM_LIST ADD (CNKCS248)                          * 07384001
073850*   CNWS027 - IS THE INPUT LAYOUT WHEN COMING FROM              * 07385001
073860*             ELEM_LIST UPD (CNKCS248)                          * 07386001
073870*   CNWS029 - IS THE INPUT LAYOUT FOR ELEMENT ADD/UPDATE        * 07387001
073880*                           (CNKCS249)                          * 07388001
073890*---------------------------------------------------------------* 07389001
073891                                                                  07389101
073892         10  INTER-APPL-COMM-AREA       PIC X(200).               07389201
073893     COPY CNWS022.                                                07389301
073894     COPY CNWS027.                                                07389401
073895     COPY CNWS029.                                                07389501
073896                                                                  07389601
073900*---------------------------------------------------------------* 07390001
074000*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 07400001
074100*---------------------------------------------------------------* 07410001
074200         10  ASC-SPECIFIC-COMMAREA.                               07420001
074300             15  ASC-INT-APPL-FORMAT-IND      PIC  X(01).         07430001
074400             15  ASC-FUNCTION                 PIC  X(02).         07440001
074500                 88  ASC-FUNCTION-NONE             VALUE ' '.     07450001
074600                 88  ASC-ADD-CODE                  VALUE 'AC'.    07460001
074700                 88  ASC-UPD-CODE                  VALUE 'UC'.    07470001
074800                 88  ASC-ADD-PARM                  VALUE 'AP'.    07480001
074900                 88  ASC-UPD-PARM                  VALUE 'UP'.    07490001
075000                 88  ASC-ADD-ELEM                  VALUE 'AE'.    07500001
075100                 88  ASC-UPD-ELEM                  VALUE 'UE'.    07510001
075200             15  ASC-PARM-NAME                PIC  X(10).         07520001
075300             15  ASC-PARM-DESC                PIC  X(50).         07530001
075400                                                                  07540001
075500             15  ASC-ATTR-ELEM-SEQ            PIC 9(04).          07550001
075600             15  ASC-ATTR-DEFN-SEQ            PIC 9(04).          07560001
075700             15  ASC-DATA-TYPE                PIC X(03).          07570001
075800             15  ASC-DEFN-DESCR               PIC X(08).          07580001
075900                                                                  07590001
076000             15  ASC-ORD-SEQ                  PIC  X(12).         07600001
076100             15  ASC-CURSOR-SW                PIC  X(1).          07610001
076110                 88  ASC-ELEM-UPD                    VALUE 'U'.   07611001
076120                 88  ASC-ELEM-ADD                    VALUE 'A'.   07612001
076130             15  ASC-CONFIRM-SW              PIC   X(01).         07613001
076140                 88  ASC-CONFIRM-UPD                 VALUE 'U'.   07614001
076150                 88  ASC-CONFIRM-ADD                 VALUE 'A'.   07615001
076160                 88  ASC-CONFIRM-NONE                VALUE ' '.   07616001
076170             15  FILLER                      PIC   X(97).         07617001
081700*-----------------------------------------------------------------08170001
081800             15  ASC-BLK-SUB                  PIC S9(04) COMP     08180001
081900                                                         SYNC.    08190001
082000             15  ASC-ITEM-SUB                 PIC S9(04) COMP     08200001
082100                                                         SYNC.    08210001
082200             15  ASC-NUMBER-OF-ITEMS-READ     PIC S9(09) COMP-3.  08220001
082300             15  ASC-NUMBER-OF-SELECTED-ITEMS PIC S9(09) COMP-3.  08230001
082400             15  ASC-ITEMS-DISPLAYED          PIC S9(03) COMP-3.  08240001
082500             15  ASC-ITEM-AT-TOP-OF-PANEL     PIC S9(09) COMP-3.  08250001
082600             15  ASC-ITEM-AT-BOT-OF-PANEL     PIC S9(09) COMP-3.  08260001
082700             15  ASC-HIGHEST-BLOCK-WRITTEN    PIC S9(04) COMP     08270001
082800                                                         SYNC.    08280001
082900             15  ASC-START-OF-SELECTED-RANGE  PIC S9(09) COMP-3.  08290001
083000             15  ASC-END-OF-SELECTED-RANGE    PIC S9(09) COMP-3.  08300001
083100             15  ASC-ITEMS-LEFT-INDICATOR     PIC  X(01).         08310001
083200                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     08320001
083300                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     08330001
083400             15  ASC-TEMP-QUEUE-UPDATE-SW     PIC  X(01).         08340001
083500                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     08350001
083600                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     08360001
083700             15  ASC-LIST-QUEUE-NAME.                             08370001
083800                 20  ASC-LIST-TERM-ID         PIC  X(04).         08380001
083900                 20  ASC-LIST-TASK-NUMBER     PIC S9(05) COMP-3.  08390001
084000                 20  ASC-LIST-SEQ             PIC  9(01).         08400001
084100                                                                  08410001
084200             15  ASC-START-ITEM-REQUEST.                          08420001
084300                 20  ASC-START-ITEM-REQUEST-N PIC  9(05).         08430001
084400                                                                  08440001
084500             15  ASC-SEL-SUB                  PIC S9(4) COMP.     08450001
084600             15  ASC-SEL-ITEM                 PIC S9(4) COMP.     08460001
084610                                                                  08461001
084700             15  ASC-USE-SELECTION-QUEUE-IND  PIC  X(1).          08470001
084800                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 08480001
084900             15  ASC-SEL-QUEUE-NAME.                              08490001
085000                 20  ASC-SEL-TERM-ID          PIC  X(04).         08500001
085100                 20  ASC-SEL-TASK-NUMBER      PIC S9(05) COMP-3.  08510001
085200                 20  ASC-SEL-SEQ              PIC  9(01).         08520001
085210                                                                  08521001
085300             15  ASC-SEL-QUEUE-NAME-2.                            08530001
085400                 20  ASC-SEL-TERM-ID-2        PIC  X(04).         08540001
085500                 20  ASC-SEL-TASK-NUMBER-2    PIC S9(05) COMP-3.  08550001
085600                 20  ASC-SEL-SEQ-2            PIC  9(01).         08560001
085610                                                                  08561001
085700             15  ASC-NUMBER-OF-TS-ITEMS       PIC S9(09) COMP-3.  08570001
085800                                                                  08580001
085900*-----------------------------------------------------------------08590001
086000                                                                  08600001
086100             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                08610001
086200                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  08620001
086300                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   08630001
086400                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   08640001
086500                                                                  08650001
086600                 20  ASC-ITEM-ARRAY.                              08660001
086700                     25  ASC-ITEM-ENTRIES OCCURS  7 TIMES.        08670001
086800                         30  ASC-LIST-ITEM-NUMBER                 08680001
086900                                                     PIC S9(09)   08690001
087000                                                     COMP-3.      08700001
087100                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  08710001
087200                             88  ASC-VALID-SELECT    VALUE ' '    08720001
087300                                                           'S'    08730001
087400                                                           'B'    08740001
087500                                                           'E'.   08750001
087600                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   08760001
087700                             88  ASC-TEMP-SELECT     VALUE 'S'.   08770001
087800                             88  ASC-TEMP-BEGIN      VALUE 'B'.   08780001
087900                             88  ASC-TEMP-END        VALUE 'E'.   08790001
088000                         30  ASC-SELECTED-SW         PIC  X(01).  08800001
088100                             88  ASC-NO-SELECT       VALUE ' '.   08810001
088200                             88  ASC-SELECT          VALUE 'S'.   08820001
088300                             88  ASC-BEGIN           VALUE 'B'.   08830001
088400                             88  ASC-END             VALUE 'E'.   08840001
088500                         30  ASC-ACTION              PIC  X(01).  08850009
088501                         30  ASC-DTL-ATTR-ELEM-SEQ   PIC  9(04).  08850101
088502                         30  ASC-DTL-ATTR-DEFN-SEQ   PIC  9(04).  08850201
088503                         30  ASC-DTL-DATA-TYPE       PIC  X(03).  08850301
088504                         30  ASC-DTL-DEFN-DESCR      PIC  X(12).  08850401
088505                         30  ASC-DTL-ELEM-VALUE      PIC  X(50).  08850501
088506                         30  ASC-DTL-ELEM-TEXT       PIC  X(50).  08850601
088507                         30  ASC-DTL-ELEM-TEXT-NULL  PIC  X(01).  08850701
088508                         30  ASC-DTL-ELEM-TMST       PIC  X(26).  08850801
088509                         30  ASC-DTL-ELEM-TMST-NULL  PIC  X(01).  08850901
088510                         30  ASC-DTL-ELEM-NBR        PIC          08851001
088511                                                     9(10).99-.   08851101
088512                         30  ASC-DTL-ELEM-NBR-NULL   PIC  X(01).  08851201
088513                                                                  08851301
088520                                                                  08852001
092100                                                                  09210001
092200                                                                  09220001
092300*---------------------------------------------------------------* 09230001
092400*    ABEND PROCESSING COPYBOOK.                                 * 09240001
092500*---------------------------------------------------------------* 09250001
092700     COPY DPWS013.                                                09270001
092800                                                                  09280001
092900                                                                  09290001
092910*----------------------------------------------------------------*09291001
092920*    DB2 TABLE FOR WST_INTGRTN_TYP INTEGRATION CODE TABLE         09292001
092930*----------------------------------------------------------------*09293001
092940     EXEC SQL                                                     09294001
092950          INCLUDE WST00008                                        09295001
092960     END-EXEC.                                                    09296001
092970                                                                  09297001
092980                                                                  09298001
092990*----------------------------------------------------------------*09299001
092991*    DB2 TABLE FOR WST_ATTR_DEFN ATTRIBUTE DEFINITION TABLE       09299101
092992*----------------------------------------------------------------*09299201
092993     EXEC SQL                                                     09299301
092994          INCLUDE WST00009                                        09299401
092995     END-EXEC.                                                    09299501
092996                                                                  09299601
092997                                                                  09299701
092998*----------------------------------------------------------------*09299801
092999*    DB2 TABLE FOR WST_ATTR_ELEM ATTRIBUTE ELEMENT TABLE          09299901
093000*----------------------------------------------------------------*09300001
093001     EXEC SQL                                                     09300101
093002          INCLUDE WST00010                                        09300201
093003     END-EXEC.                                                    09300301
093004                                                                  09300401
093005                                                                  09300501
098520*---------------------------------------------------------------* 09852001
098530* WST_ATTR_ELEM CURSOR  USED WHEN ADDING A NEW ELEMENT GROUP    * 09853001
098540*---------------------------------------------------------------* 09854001
098550     EXEC SQL                                                     09855001
098560        DECLARE ATTR-ELEM-SEQ-ADD-CSR CURSOR FOR                  09856001
098570         SELECT A.INTGRTN_TYP_CDE                                 09857001
098580              , A.ATTR_DEFN_SEQ_NBR                               09858001
098590              , A.ATTR_DEFN_DESC                                  09859001
098591              , A.REQR_IND                                        09859101
098592              , A.DATYP_CDE                                       09859201
098593              , A.MAX_LEN_QTY                                     09859301
098594              , A.MAX_PCSN_QTY                                    09859401
098595           FROM WST_ATTR_DEFN A                                   09859501
098596          WHERE A.INTGRTN_TYP_CDE   =  :DK-INTGRTN-TYP            09859601
098597     END-EXEC.                                                    09859701
098598                                                                  09859801
098599*---------------------------------------------------------------* 09859901
098600* WST_ATTR_ELEM CURSOR   USED WHEN UPDATING AN EXISTING ELEMENT * 09860001
098601*---------------------------------------------------------------* 09860101
098602     EXEC SQL                                                     09860201
098603        DECLARE ATTR-ELEM-SEQ-UPD-CSR CURSOR FOR                  09860301
098604         SELECT A.INTGRTN_TYP_CDE                                 09860401
098605              , A.ATTR_DEFN_SEQ_NBR                               09860501
098606              , A.ATTR_ELEM_SEQ_NBR                               09860601
098607              , A.ATTR_ELEM_TXT                                   09860701
098608              , A.ATTR_ELEM_TMST                                  09860801
098609              , A.ATTR_ELEM_NBR                                   09860901
098610              , B.DATYP_CDE                                       09861001
098611              , B.ATTR_DEFN_DESC                                  09861101
098612           FROM WST_ATTR_ELEM A                                   09861201
098613              , WST_ATTR_DEFN B                                   09861301
098614          WHERE A.INTGRTN_TYP_CDE   =  :DK-INTGRTN-TYP            09861401
098615            AND A.ATTR_DEFN_SEQ_NBR =  :DK-ATTR-DEFN-SEQ          09861501
098616            AND A.ATTR_ELEM_SEQ_NBR =  :DK-ATTR-ELEM-SEQ          09861601
098617            AND A.INTGRTN_TYP_CDE   =  B.INTGRTN_TYP_CDE          09861701
098618            AND A.ATTR_DEFN_SEQ_NBR =  B.ATTR_DEFN_SEQ_NBR        09861801
098619     END-EXEC.                                                    09861901
098620                                                                  09862001
098621                                                                  09862101
098622*---------------------------------------------------------------* 09862201
098623*    DB2 AREA FOR COMMUNICATIONS                                * 09862301
098624*---------------------------------------------------------------* 09862401
098625     EXEC SQL                                                     09862501
098626          INCLUDE SQLCA                                           09862601
098627     END-EXEC.                                                    09862701
098628                                                                  09862801
098629                                                                  09862901
098630*---------------------------------------------------------------* 09863001
098640*                                                               * 09864001
098650*---------------------------------------------------------------* 09865001
102300 LINKAGE SECTION.                                                 10230001
102400                                                                  10240001
102500 01  DFHCOMMAREA.                                                 10250001
102600     05  FILLER                         OCCURS  1 TO 4072 TIMES   10260001
102700                                        DEPENDING ON EIBCALEN.    10270001
102800         10  FILLER                     PIC X.                    10280001
102900                                                                  10290001
103000                                                                  10300001
103100 PROCEDURE DIVISION.                                              10310001
103200******************************************************************10320001
103300**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **10330001
103400**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **10340001
103500**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **10350001
103600******************************************************************10360001
103700 0000-MAIN-MODULE.                                                10370001
103800     INITIALIZE DP030-CICS-API-FIELDS.                            10380001
103900     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       10390001
104000     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          10400001
104100     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         10410001
104200     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       10420001
104300     MOVE LENGTH OF CNK249I        TO DP030-MAP-LENGTH (1).       10430001
104400     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     10440001
104500     PERFORM 0001-CALL-CICS-ARCH-API.                             10450001
104600                                                                  10460001
104700     PERFORM 1000-CONTROL-PROCESSING                              10470001
104800                                                                  10480001
104900     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     10490001
105000     PERFORM 0001-CALL-CICS-ARCH-API.                             10500001
105100                                                                  10510001
105200******************************************************************10520001
105300**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **10530001
105400**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **10540001
105500******************************************************************10550001
105600 0001-CALL-CICS-ARCH-API.                                         10560001
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      10570026
105800                                    DFHCOMMAREA                   10580026
105900                                    DP030-CICS-API-FIELDS         10590026
106000                                    DP020-STANDARD-COMMAREA       10600026
106100                                    CNK249I.                      10610026
106200                                                                  10620001
106300     IF  DP030-RC-CALL-SUCCESSFUL                                 10630001
106400         CONTINUE                                                 10640001
106500     ELSE                                                         10650001
106600         SET DP013-NO-ROLLBACK                                    10660001
106700             DP013-XCTL-DISPLAY-RESTART                           10670001
106800             DP013-CICS-ABEND      TO TRUE                        10680001
106900         MOVE '0001-CALL-CICS-ARCH-API'                           10690001
107000                                   TO DP013-PARAGRAPH             10700001
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O10701026
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      10702026
107300         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      10730001
107400         PERFORM DP013-0000-PROCESS-ABEND                         10740001
107500     END-IF.                                                      10750001
107600*----------------------------------------------------------------*10760001
107700* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *10770001
107800* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *10780001
107900*                                                                *10790001
108000* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *10800001
108100*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *10810001
108200*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *10820001
108300*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *10830001
108400*----------------------------------------------------------------*10840001
108500                                                                  10850001
108600 1000-CONTROL-PROCESSING.                                         10860001
108700                                                                  10870001
108800     EVALUATE TRUE                                                10880001
108900         WHEN DP020-NEXT-ACT-INITIAL                              10890001
109000             INITIALIZE ASC-SPECIFIC-COMMAREA                     10900001
109100             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            10910001
109200                                      ASC-SEL-TERM-ID             10920001
109300                                      ASC-SEL-TERM-ID-2           10930001
109400             MOVE DP020-SRC-TASK-NUMBER                           10940001
109500                                   TO ASC-LIST-TASK-NUMBER        10950001
109600                                      ASC-SEL-TASK-NUMBER         10960001
109700                                      ASC-SEL-TASK-NUMBER-2       10970001
109800             MOVE PC-LIST-QUEUE-SEQ                               10980001
109900                                   TO ASC-LIST-SEQ                10990001
110000             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 11000001
110100                                      ASC-SEL-SEQ-2               11010001
110200             PERFORM 1100-PROCESS-INTER-APPL-COMM                 11020001
110300***-----$TEMPLATE NOTE$-------------------------------------------11030001
110400*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,11040001
110500*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  11050001
110600*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.11060001
110700***---------------------------------------------------------------11070001
110800             IF  PS-COMMAREA-NOT-VALID                            11080001
110900                 SET DP020-NEXT-ACT-APPL-ERROR                    11090001
111000                                   TO TRUE                        11100001
111100             ELSE                                                 11110001
111200                 PERFORM 4000-BUILD-INITIAL-PANEL                 11120001
111300             END-IF                                               11130001
111400                                                                  11140001
111500         WHEN DP020-NEXT-ACT-READ-MAP                             11150001
111600             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        11160001
111700                                   TO PV-TOP-ITEM                 11170001
111800             PERFORM 2000-PROCESS-PANEL                           11180001
111900                                                                  11190001
112000         WHEN DP020-NEXT-ACT-RETURN                               11200001
112100             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        11210001
112200                                   TO PV-TOP-ITEM                 11220001
112300             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    11230001
112400                                                                  11240001
112600             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 11260001
112700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11270001
113200                                                                  11320001
113300         WHEN OTHER                                               11330001
113400             SET DP013-LOGIC-ABEND TO TRUE                        11340001
113500             SET DP013-NO-ROLLBACK TO TRUE                        11350001
113600             MOVE '1000-CONTROL-PROCESSING'                       11360001
113700                                   TO DP013-PARAGRAPH             11370001
113800             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    11380001
113900                                   TO DP013-MESSAGE-TEXT(1)       11390001
114000             PERFORM DP013-0000-PROCESS-ABEND                     11400001
114100     END-EVALUATE.                                                11410001
114200                                                                  11420001
114300                                                                  11430001
114400*----------------------------------------------------------------*11440001
114500* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *11450001
114600* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *11460001
114700*----------------------------------------------------------------*11470001
114800                                                                  11480001
114900 1100-PROCESS-INTER-APPL-COMM.                                    11490001
115000                                                                  11500001
115100     SET PS-COMMAREA-VALID         TO TRUE.                       11510001
115200     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     11520001
115201                                                                  11520101
115202**?                                                               11520201
115210     MOVE DP020-INT-APPL-FORMAT-IND                               11521001
115220                                   TO ASC-INT-APPL-FORMAT-IND.    11522001
115230**?                                                               11523001
115300                                                                  11530001
115310                                                                  11531001
115320*WHEN COMING FROM DEFN LIST        (CNKCS247 - F17=ADD ELEM=4)    11532001
115330*WHEN COMING FROM ELEM LIST        (CNKCS248 - F13=ADD ELEM=6)    11533001
115340     EVALUATE ASC-INT-APPL-FORMAT-IND                             11534001
115350         WHEN PC-DEFN-LIST-FORMAT-ADD                             11535001
115360         WHEN PC-ELEM-LIST-FORMAT-ADD                             11536001
115370              SET  ASC-ELEM-ADD             TO TRUE               11537001
115380              MOVE CN022-FUNCTION           TO ASC-FUNCTION       11538001
115390              MOVE CN022-PARM-NAME          TO ASC-PARM-NAME      11539001
115391              MOVE CN022-PARM-DESC          TO ASC-PARM-DESC      11539101
115392                                                                  11539201
115393              PERFORM 3045-GET-NEXT-SEQ-NBR                       11539301
115394              PERFORM 3050-GET-CURRENT-TMST                       11539401
115395              MOVE PV-NEXT-ELEM-SEQ-NBR TO ASC-ATTR-ELEM-SEQ      11539501
115396                                                                  11539601
115397                                                                  11539701
115398*WHEN COMING FROM ELEM LIST        (CNKCS247 - F15=UPD DEFN=5)    11539801
115399         WHEN PC-ELEM-LIST-FORMAT-UPD                             11539901
115400           IF  CN027-NUMBER-OF-SELECTED-ITEMS > 0                 11540001
115401               SET ASC-USE-SELECTION-QUEUE TO TRUE                11540101
115402               MOVE CN027-NUMBER-OF-SELECTED-ITEMS                11540201
115403                                  TO ASC-NUMBER-OF-SELECTED-ITEMS 11540301
115404               MOVE CN027-NUMBER-OF-TS-ITEMS                      11540401
115405                                  TO ASC-NUMBER-OF-TS-ITEMS       11540501
115406               MOVE CN027-SEL-QUEUE-NAME                          11540601
115407                                  TO ASC-SEL-QUEUE-NAME           11540701
115408                                                                  11540801
115409               SET  ASC-ELEM-UPD        TO TRUE                   11540901
115410               MOVE CN027-FUNCTION      TO ASC-FUNCTION           11541001
115411               MOVE CN027-FUNC-NAME     TO ASC-PARM-NAME          11541101
115412               MOVE CN027-FUNC-DESC     TO ASC-PARM-DESC          11541201
115413                                                                  11541301
115414               PERFORM 1120-PREPARE-LIST-ENTRY                    11541401
115415**?            PERFORM 3000-EDIT-DATA-IN-COMMAREA                 11541501
115416           ELSE                                                   11541601
115418               MOVE PC-TSYMSG-00057       TO DP020-MSG-NUMBER     11541801
115419               SET  PS-COMMAREA-NOT-VALID TO TRUE                 11541901
115420           END-IF                                                 11542001
115430     END-EVALUATE.                                                11543001
117400                                                                  11740001
119900                                                                  11990001
120000*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%*12000001
120100 1120-PREPARE-LIST-ENTRY.                                         12010001
120200                                                                  12020001
120300     MOVE CN028-MAX-ITEMS          TO ASC-SEL-SUB.                12030001
120400     MOVE ZERO                     TO ASC-SEL-ITEM.               12040001
120500     PERFORM 1130-GET-NEXT-RECORD.                                12050001
120600                                                                  12060001
120610                                                                  12061001
120700*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%*12070001
120800*    GET THE NEXT RECORD IF A LIST OF RECORDS ARE BEING PROCESSED*12080001
120900*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%*12090001
121000 1130-GET-NEXT-RECORD.                                            12100001
121100                                                                  12110001
121200     ADD +1                       TO ASC-SEL-SUB.                 12120001
121300                                                                  12130001
121400     IF  ASC-SEL-SUB > CN028-MAX-ITEMS                            12140001
121500         ADD +1                   TO ASC-SEL-ITEM                 12150001
121600         MOVE +1                  TO ASC-SEL-SUB                  12160001
121700     END-IF.                                                      12170001
121800                                                                  12180001
121900     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                12190001
122000         PERFORM 9100-READ-SEL-QUEUE                              12200001
122100         IF  CN028-ITEM (ASC-SEL-SUB) > ZERO                      12210001
122200             MOVE CN028-ELEM-SEQ       (ASC-SEL-SUB)              12220001
122300                                  TO ASC-ATTR-ELEM-SEQ            12230001
122400             MOVE CN028-DEFN-SEQ       (ASC-SEL-SUB)              12240001
122500                                  TO ASC-ATTR-DEFN-SEQ            12250001
122600             MOVE CN028-DATA-TYPE      (ASC-SEL-SUB)              12260001
122700                                  TO ASC-DATA-TYPE                12270001
122800                                                                  12280001
122900             SET CN028-INQ (ASC-SEL-SUB)                          12290001
123000                                  TO TRUE                         12300001
125700             PERFORM 9200-REWRITE-SEL-QUEUE                       12570001
125800         ELSE                                                     12580001
125900             SUBTRACT +1 FROM ASC-SEL-SUB                         12590001
126000             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             12600001
126100             SET DP020-MSG-INFORMATIONAL                          12610001
126200                 PS-LIST-END             TO TRUE                  12620001
126300         END-IF                                                   12630001
126400     ELSE                                                         12640001
126500         SUBTRACT +1 FROM ASC-SEL-ITEM                            12650001
126600         MOVE CN028-MAX-ITEMS     TO ASC-SEL-SUB                  12660001
126700         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             12670001
126800         SET DP020-MSG-INFORMATIONAL                              12680001
126900             PS-LIST-END             TO TRUE                      12690001
127000     END-IF.                                                      12700001
127100                                                                  12710001
127200                                                                  12720001
127300*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%*12730001
127400*    GET THE PREVIOUS RECORD IF A LIST OF RECORDS ARE BEING      *12740001
127500*    PROCESSED.                                                  *12750001
127600*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%*12760001
127700                                                                  12770001
127800 1140-GET-PREV-RECORD.                                            12780001
127900                                                                  12790001
128000     SUBTRACT +1 FROM ASC-SEL-SUB.                                12800001
128100                                                                  12810001
128200     IF  ASC-SEL-SUB < +1                                         12820001
128300         SUBTRACT +1 FROM ASC-SEL-ITEM                            12830001
128400         MOVE CN028-MAX-ITEMS     TO ASC-SEL-SUB                  12840001
128500     END-IF.                                                      12850001
128600                                                                  12860001
128700     IF  ASC-SEL-ITEM > ZERO                                      12870001
128800         PERFORM 9100-READ-SEL-QUEUE                              12880001
128900         IF  CN028-ITEM (ASC-SEL-SUB) > ZERO                      12890001
129000             MOVE CN028-ELEM-SEQ       (ASC-SEL-SUB)              12900001
129100                                  TO ASC-ATTR-ELEM-SEQ            12910001
129200             MOVE CN028-DEFN-SEQ       (ASC-SEL-SUB)              12920001
129300                                  TO ASC-ATTR-DEFN-SEQ            12930001
129400             MOVE CN028-DATA-TYPE      (ASC-SEL-SUB)              12940001
129500                                  TO ASC-DATA-TYPE                12950001
129600                                                                  12960001
129700             SET CN028-INQ (ASC-SEL-SUB)                          12970001
129800                                  TO TRUE                         12980001
132300         PERFORM 9200-REWRITE-SEL-QUEUE                           13230001
132400     ELSE                                                         13240001
132500         MOVE +1                  TO ASC-SEL-ITEM                 13250001
132600                                     ASC-SEL-SUB                  13260001
132700         MOVE PC-TSYMSG-00069     TO DP020-MSG-NUMBER             13270001
132800         SET DP020-MSG-INFORMATIONAL                              13280001
132900             PS-LIST-END             TO TRUE                      13290001
133000     END-IF.                                                      13300001
133100                                                                  13310001
133200                                                                  13320001
133500*----------------------------------------------------------------*13350001
133600* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *13360001
133700* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *13370001
133800* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *13380001
133900* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *13390001
134000* FUNCTION KEYS CAN GET THIS FAR.                                *13400001
134100*----------------------------------------------------------------*13410001
134200                                                                  13420001
134300 2000-PROCESS-PANEL.                                              13430001
134400     EVALUATE TRUE                                                13440001
134500         WHEN DP020-SRC-AID = DP016-CLEAR                         13450001
134600             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    13460001
134700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   13470001
134800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 13480001
134900                                                                  13490001
135000         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    13500001
135100             PERFORM 2050-DELETE-LIST-QUEUE                       13510001
135110             PERFORM 3050-GET-CURRENT-TMST                        13511001
135200             PERFORM 4000-BUILD-INITIAL-PANEL                     13520001
135300                                                                  13530001
135400         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    13540001
135500             PERFORM 2140-DESELECT-ALL-ITEMS                      13550001
135600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 13560001
135700                                                                  13570001
135800         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  13580001
135810             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 13581014
135900             PERFORM 2150-SELECT-ALL-ITEMS                        13590001
136000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 13600001
136100                                                                  13610001
136200*        WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             13620001
136300*            IF  ASC-USE-SELECTION-QUEUE                          13630001
136400*                PERFORM 1130-GET-NEXT-RECORD                     13640001
136500*                IF PS-LIST-END                                   13650001
136600*                    PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         13660001
136700*                    SET PS-NO-LIST-END TO TRUE                   13670001
136800*                ELSE                                             13680001
136900*                    PERFORM 2050-DELETE-LIST-QUEUE               13690001
137000*                    PERFORM 3200-RESET-ATTRIBUTES                13700001
137100*                    PERFORM 4000-BUILD-INITIAL-PANEL             13710001
137200*                END-IF                                           13720001
137300*             ELSE                                                13730001
137400*                PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             13740001
137500*                --- BOTTOM OF LIST ---                           13750001
137600*                MOVE PC-TSYMSG-00070                             13760001
137700*                                  TO DP020-MSG-NUMBER            13770001
137800*                SET DP020-MSG-INFORMATIONAL                      13780001
137900*                                  TO TRUE                        13790001
138000*            END-IF                                               13800001
138100*                                                                 13810001
138200*        WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             13820001
138300*            IF  ASC-USE-SELECTION-QUEUE                          13830001
138400*                PERFORM 1140-GET-PREV-RECORD                     13840001
138500*                IF PS-LIST-END                                   13850001
138600*                    PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         13860001
138700*                    SET PS-NO-LIST-END                           13870001
138800*                                  TO TRUE                        13880001
138900*                ELSE                                             13890001
139000*                    PERFORM 2050-DELETE-LIST-QUEUE               13900001
139100*                    PERFORM 3200-RESET-ATTRIBUTES                13910001
139200*                    PERFORM 4000-BUILD-INITIAL-PANEL             13920001
139300*                END-IF                                           13930001
139400*            ELSE                                                 13940001
139500*                PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             13950001
139600*                MOVE PC-TSYMSG-00069                             13960001
139700*                                  TO DP020-MSG-NUMBER            13970001
139800*                SET DP020-MSG-INFORMATIONAL                      13980001
139900*                                  TO TRUE                        13990001
140000*            END-IF                                               14000001
140100                                                                  14010001
140200         WHEN OTHER                                               14020001
140300             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 14030001
140301**?                                                               14030108
140302             PERFORM 3200-RESET-ATTRIBUTES                        14030208
140310**?                                                               14031008
140400**?          PERFORM 3000-EDIT-DATA-IN-COMMAREA                   14040001
140410                                                                  14041001
140420             IF  (ASC-ADD-ELEM  AND  ASC-CONFIRM-ADD)  OR         14042001
140430                 (ASC-UPD-ELEM  AND  ASC-CONFIRM-UPD)  OR         14043001
140440                 (DP020-SRC-AID = DP016-ENTER)         OR         14044001
140450                 (DP020-FK-NEXT-PAGE(DP020-SRC-AID))   OR         14045001
140460                 (DP020-FK-PREV-PAGE(DP020-SRC-AID))              14046001
140470                 CONTINUE                                         14047001
140480             ELSE                                                 14048001
140490                 PERFORM 3000-EDIT-DATA-IN-COMMAREA               14049001
140491             END-IF                                               14049101
140500                                                                  14050001
140600             IF  PS-NO-ERROR                                      14060001
140700                 SET DP030-CONTINUE-GO                            14070001
140800                                 TO TRUE                          14080001
140900                 PERFORM 2100-CHECK-FUNCTION-KEY                  14090001
141000             ELSE                                                 14100001
141100                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             14110001
141200                 SET DP030-OVERRIDE-GO                            14120001
141300                                 TO TRUE                          14130001
141400             END-IF                                               14140001
141500     END-EVALUATE.                                                14150001
141600                                                                  14160001
141610                                                                  14161001
141700*----------------------------------------------------------------*14170001
141800*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *14180001
141900*----------------------------------------------------------------*14190001
142000 2050-DELETE-LIST-QUEUE.                                          14200001
142100                                                                  14210001
142200     EXEC CICS                                                    14220001
142300         DELETEQ TS                                               14230001
142400             QUEUE (ASC-LIST-QUEUE-NAME)                          14240001
142500             RESP  (PV-CICS-RESP)                                 14250001
142600     END-EXEC.                                                    14260001
142700                                                                  14270001
142800     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       14280001
142900        (PV-CICS-RESP = DFHRESP(QIDERR))                          14290001
143000         CONTINUE                                                 14300001
143100     ELSE                                                         14310001
143200         SET DP013-CICS-ABEND      TO TRUE                        14320001
143300         SET DP013-NO-ROLLBACK     TO TRUE                        14330001
143400                                                                  14340001
143500         MOVE '2050-DELETE-LIST-QUEUE'                            14350001
143600                                   TO DP013-PARAGRAPH             14360001
143700         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    14370001
143800                                   TO DP013-MESSAGE-TEXT (1)      14380001
143900         PERFORM DP013-0000-PROCESS-ABEND                         14390001
144000     END-IF.                                                      14400001
144100                                                                  14410001
144200     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  14420001
144300                                                                  14430001
144310                                                                  14431001
144400*----------------------------------------------------------------*14440001
144500* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*14450001
144600* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *14460001
144700* CICS ARCHITECTURE API.                                         *14470001
144800*----------------------------------------------------------------*14480001
144900 2100-CHECK-FUNCTION-KEY.                                         14490001
145000                                                                  14500001
145100     EVALUATE TRUE                                                14510001
145210                                                                  14521001
145220* F13 - ADD ELEM  (WST_ATTR_ELEM) (LOCAL-FUNC-01)                 14522001
145230         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              14523001
145240              IF  ASC-NUMBER-OF-SELECTED-ITEMS > 0                14524001
145250                  MOVE ASC-NUMBER-OF-SELECTED-ITEMS               14525001
145260                                TO CN029-NUMBER-OF-SELECTED-ITEMS 14526001
145270                  MOVE ASC-NUMBER-OF-TS-ITEMS                     14527001
145280                                      TO CN029-NUMBER-OF-TS-ITEMS 14528001
145291                  MOVE ASC-SEL-QUEUE-NAME                         14529101
145292                                         TO  CN029-SEL-QUEUE-NAME 14529201
145293                  SET CN029-ADD-ELEM TO TRUE                      14529301
145294                  MOVE ASC-PARM-NAME    TO  CN029-FUNC-NAME       14529401
145295                  MOVE ASC-PARM-DESC    TO  CN029-FUNC-DESC       14529501
145296                  PERFORM 5000-PREPARE-SEL-QUEUE                  14529601
145297                  IF  PS-NO-ERROR                                 14529701
145298                      SET  ASC-CONFIRM-ADD  TO  TRUE              14529801
145299                      MOVE PC-TSYMSG-00004  TO DP020-MSG-NUMBER   14529901
145300                      SET DP020-MSG-WARNING TO TRUE               14530001
145301                  END-IF                                          14530101
145302              ELSE                                                14530201
145303                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            14530301
145304                  SET DP030-OVERRIDE-GO TO TRUE                   14530401
145305                  MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER       14530501
145306                  SET DP020-MSG-WARNING  TO TRUE                  14530601
145307              END-IF                                              14530701
145308                                                                  14530801
145309                                                                  14530901
145310* F15 - UPD ELEM  (WST_ATTR_ELEM) (LOCAL-FUNC-02)                 14531001
145311         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              14531101
145312              IF  ASC-NUMBER-OF-SELECTED-ITEMS > 0                14531201
145313                  MOVE ASC-NUMBER-OF-SELECTED-ITEMS               14531301
145314                                TO CN029-NUMBER-OF-SELECTED-ITEMS 14531401
145315                  MOVE ASC-NUMBER-OF-TS-ITEMS                     14531501
145316                                      TO CN029-NUMBER-OF-TS-ITEMS 14531601
145318                  MOVE ASC-SEL-QUEUE-NAME                         14531801
145319                                         TO  CN029-SEL-QUEUE-NAME 14531901
145320                  SET CN029-UPD-ELEM TO TRUE                      14532001
145321                  MOVE ASC-PARM-NAME    TO  CN029-FUNC-NAME       14532101
145322                  MOVE ASC-PARM-DESC    TO  CN029-FUNC-DESC       14532201
145323                  PERFORM 5000-PREPARE-SEL-QUEUE                  14532301
145324                  IF  PS-NO-ERROR                                 14532401
145325                      SET  ASC-CONFIRM-UPD  TO  TRUE              14532501
145326                      MOVE PC-TSYMSG-00004  TO DP020-MSG-NUMBER   14532601
145327                      SET DP020-MSG-WARNING TO TRUE               14532701
145328                  END-IF                                          14532801
145329              ELSE                                                14532901
145330                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            14533001
145331                  SET DP030-OVERRIDE-GO TO TRUE                   14533101
145332                  MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER       14533201
145333                  SET DP020-MSG-FATAL   TO TRUE                   14533301
145334             END-IF                                               14533401
145335                                                                  14533501
153300* F2 - CONFIRM (CNCL/UNCNCL) (CNFM/UNCNFM DISTRO)                 15330001
153400                                                                  15340001
153500         WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                    15350001
153600              IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO             15360001
153601                                                                  15360101
153610                IF  ASC-CONFIRM-ADD                               15361001
153620                    PERFORM 4600-PROCESS-PARM-ADD                 15362001
153630                       VARYING PV-ITEM FROM 1 BY 1                15363001
153640                       UNTIL PV-ITEM > ASC-HIGHEST-BLOCK-WRITTEN  15364001
153650                          OR PS-SOFT-ABORT-ERROR                  15365001
153651                    IF  PS-NO-ERROR                               15365113
153652                        PERFORM 2050-DELETE-LIST-QUEUE            15365213
153653                        PERFORM 3200-RESET-ATTRIBUTES             15365313
153654                        PERFORM 3045-GET-NEXT-SEQ-NBR             15365413
153655                        MOVE PV-NEXT-ELEM-SEQ-NBR                 15365513
153656                          TO ASC-ATTR-ELEM-SEQ                    15365613
153657                        PERFORM 3050-GET-CURRENT-TMST             15365713
153658                        PERFORM 4000-BUILD-INITIAL-PANEL          15365813
153659                        SET DP020-MSG-INFORMATIONAL  TO  TRUE     15365913
153660                        MOVE PC-TSYMSG-00034  TO  DP020-MSG-NUMBER15366013
153661                    END-IF                                        15366113
153663                                                                  15366301
153670                ELSE                                              15367001
153680                                                                  15368001
153690                IF  ASC-CONFIRM-UPD                               15369001
153691                    PERFORM 4700-PROCESS-PARM-UPDATE              15369101
153692                       VARYING PV-ITEM FROM 1 BY 1                15369201
153693                       UNTIL PV-ITEM > ASC-HIGHEST-BLOCK-WRITTEN  15369301
153694                          OR PS-SOFT-ABORT-ERROR                  15369401
153695                                                                  15369501
153696                END-IF                                            15369601
153697                END-IF                                            15369701
153699                                                                  15369901
156800              ELSE                                                15680001
156900                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            15690001
157000                  SET DP030-OVERRIDE-GO      TO TRUE              15700001
157100                  MOVE PC-TSYMSG-00057       TO DP020-MSG-NUMBER  15710001
157200                  SET DP020-MSG-WARNING      TO TRUE              15720001
157300              END-IF                                              15730001
157400                                                                  15740001
157500              SET  ASC-CONFIRM-NONE TO  TRUE                      15750005
157600                                                                  15760001
164100                                                                  16410001
164200* F6 - FIRST PAGE                                                 16420005
164400         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  16440001
164410             PERFORM 3200-RESET-ATTRIBUTES                        16441001
164500             MOVE +1               TO PV-TOP-ITEM                 16450001
164600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 16460001
164610             SET  ASC-CONFIRM-NONE  TO  TRUE                      16461001
164700                                                                  16470001
164800* F7 - PREVIOUS PAGE                                              16480005
165000         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   16500001
165010             PERFORM 3200-RESET-ATTRIBUTES                        16501001
165100             PERFORM 2110-BROWSE-BACKWARD                         16510001
165200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 16520001
165210             SET  ASC-CONFIRM-NONE  TO  TRUE                      16521001
165300                                                                  16530001
165400* F8 - NEXT PAGE                                                  16540005
165600         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   16560001
165700             PERFORM 3200-RESET-ATTRIBUTES                        16570001
165710             MOVE -1               TO  MR-SELECTL(1)              16571001
165720             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   16572001
165730             PERFORM 2120-BROWSE-FORWARD                          16573001
165740             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 16574001
165741             SET  ASC-CONFIRM-NONE  TO  TRUE                      16574101
165750                                                                  16575001
165760* ENTER KEY                                                       16576001
165780         WHEN DP020-SRC-AID = DP016-ENTER                         16578001
165790             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   16579001
165800             IF  PS-ERROR                                         16580001
165900                 CONTINUE                                         16590001
166000             ELSE                                                 16600001
166100                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             16610001
166200             END-IF                                               16620001
166210             SET  ASC-CONFIRM-NONE  TO  TRUE                      16621001
166300                                                                  16630001
166400         WHEN OTHER                                               16640001
166500             SET DP013-NO-ROLLBACK                                16650001
166600                 DP013-XCTL-DISPLAY-RESTART                       16660001
166700                 DP013-CICS-ABEND  TO TRUE                        16670001
166800             MOVE '2100-CHECK-FUNCTION-KEY'                       16680001
166900                                   TO DP013-PARAGRAPH             16690001
167000             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      16700001
167100                                   TO DP013-MESSAGE-TEXT (1)      16710001
167200             PERFORM DP013-0000-PROCESS-ABEND                     16720001
167300     END-EVALUATE.                                                16730001
167400                                                                  16740001
167500                                                                  16750001
167600******************************************************************16760001
167700** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **16770001
167800** INTER-APPLICATION COMMAREA.                                  **16780001
167900******************************************************************16790001
168000*2110-PREPARE-INTER-APPL-COMM.                                    16800001
168100**?                                                               16810001
168200**?  INITIALIZE CN022-INTER-APPL-COMMAREA.                        16820001
168300**?                                                               16830001
168400**?  MOVE ASC-FUNCTION             TO CN022-FUNCTION.             16840001
168500**?                                                               16850001
168600*2115-PREPARE-INTER-APPL-ELEM.                                    16860001
168700**?                                                               16870001
168800**?  INITIALIZE CN022-INTER-APPL-COMMAREA.                        16880001
168900**?                                                               16890001
169000**?  SET  CN022-FUNCTION-NONE       TO TRUE.                      16900001
169100**?  MOVE CN022-FUNCTION            TO ASC-FUNCTION.              16910001
169200**?  MOVE ASC-PARM-NAME             TO CN022-PARM-NAME.           16920001
169300**?  MOVE ASC-PARM-DESC             TO CN022-PARM-DESC.           16930001
169400**?                                                               16940001
169500**?                                                               16950001
170900*----------------------------------------------------------------*17090001
171000*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *17100001
171100*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *17110001
171200*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *17120001
171300*    MESSAGE.                                                    *17130001
171400*----------------------------------------------------------------*17140001
171500*                                                                 17150001
171600 2110-BROWSE-BACKWARD.                                            17160001
171700     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    17170001
171800         GIVING PV-TOP-ITEM.                                      17180001
171900                                                                  17190001
172000     IF  ((PV-TOP-ITEM < +1)                                      17200001
172100       OR (PV-TOP-ITEM = +1))                                     17210001
172200         MOVE +1                   TO PV-TOP-ITEM                 17220001
172300*        -- TOP OF LIST --                                        17230005
172400         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            17240001
172500         SET DP020-MSG-INFORMATIONAL TO TRUE                      17250001
172600     END-IF.                                                      17260001
172700                                                                  17270001
172800                                                                  17280001
172900*----------------------------------------------------------------*17290001
173000*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *17300001
173100*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *17310001
173200*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *17320001
173300*----------------------------------------------------------------*17330001
173400*                                                                 17340001
173500 2120-BROWSE-FORWARD.                                             17350001
173600                                                                  17360001
173700     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              17370001
173800         GIVING PV-TOP-ITEM.                                      17380001
173900     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   17390001
174000         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            17400001
174100                                   TO PV-TOP-ITEM                 17410001
174200*        -- BOTTOM OF LIST --                                     17420001
174300         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            17430001
174400         SET DP020-MSG-INFORMATIONAL                              17440001
174500                                   TO TRUE                        17450001
174600     ELSE                                                         17460001
174700         COMPUTE PV-BOTTOM-ITEM =                                 17470001
174800             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 17480001
174900         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            17490001
175000*            -- BOTTOM OF LIST --                                 17500001
175100             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            17510001
175200             SET DP020-MSG-INFORMATIONAL                          17520001
175300                                   TO TRUE                        17530001
175400         END-IF                                                   17540001
175500     END-IF.                                                      17550001
175600                                                                  17560001
175610                                                                  17561001
175700*----------------------------------------------------------------*17570001
175800*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *17580001
175900*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *17590001
176000*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *17600001
176100*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *17610001
176200*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *17620001
176300*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *17630001
176400*----------------------------------------------------------------*17640001
176500                                                                  17650001
176600 2130-CHECK-FOR-JUMP-BROWSE.                                      17660001
176700     SET PS-NO-ERROR               TO TRUE.                       17670001
176800     IF (ASC-START-ITEM-REQUEST = SPACE)                          17680001
176900         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            17690001
177000                                   TO PV-TOP-ITEM                 17700001
177100     ELSE                                                         17710001
177200         MOVE ASC-START-ITEM-REQUEST                              17720001
177300                                   TO DP010I-UNEDITED-FIELD       17730001
177310         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     17731001
177400         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       17740001
177600         SET DP010I-NEGATIVE-NOT-ALLOWED                          17760001
177700                                   TO TRUE                        17770001
263455         CALL DP010I-NUMERIC-EDIT-ROUTINE                         17781025
263455              USING DP010I-NUMERIC-EDIT-AREA                      17782025
177900                                                                  17790001
178000         IF  NOT DP010I-ERROR-DETECTED                            17800001
178100             MOVE DP010I-NUMERIC-FIELD                            17810001
178200                                   TO  ASC-START-ITEM-REQUEST-N   17820001
178300             IF  ASC-START-ITEM-REQUEST-N > ZERO                  17830001
178400                 IF  ASC-START-ITEM-REQUEST-N >                   17840001
178500                                          ASC-NUMBER-OF-ITEMS-READ17850001
178600                     MOVE SPACE TO ASC-START-ITEM-REQUEST         17860001
178700                     COMPUTE PV-TOP-ITEM =                        17870001
178800                             ASC-NUMBER-OF-ITEMS-READ             17880001
178900                             - PC-ITEMS-PER-PANEL + 1             17890001
179000                     IF  PV-TOP-ITEM < +1                         17900001
179100                         MOVE +1   TO PV-TOP-ITEM                 17910001
179200                         MOVE PC-TSYMSG-00070                     17920001
179300                                   TO DP020-MSG-NUMBER            17930001
179400                         SET DP020-MSG-INFORMATIONAL              17940001
179500                                   TO TRUE                        17950001
179600                     END-IF                                       17960001
179700                 ELSE                                             17970001
179800                     MOVE ASC-START-ITEM-REQUEST-N                17980001
179900                                   TO PV-TOP-ITEM                 17990001
180000                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      18000001
180100                     COMPUTE PV-BOTTOM-ITEM =                     18010001
180200                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     18020001
180300                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ18030001
180400*                        -- BOTTOM OF LIST --                     18040006
180500                         MOVE PC-TSYMSG-00070                     18050001
180600                                   TO DP020-MSG-NUMBER            18060001
180700                         SET DP020-MSG-INFORMATIONAL              18070001
180800                                   TO TRUE                        18080001
180900                     END-IF                                       18090001
181000                 END-IF                                           18100001
181100             ELSE                                                 18110001
181200*                --- VALUE OUT OF RANGE ----                      18120006
181300                 MOVE PC-TSYMSG-00101                             18130001
181400                                   TO DP020-MSG-NUMBER            18140001
181500                 MOVE -1           TO ASTRTITL                    18150001
181600                 SET DP030-SET-CURSOR-APPL-1                      18160001
181700                                   TO TRUE                        18170001
181800                 MOVE DP015-REVERSE                               18180001
181900                                   TO ASTRTITH                    18190001
182000                 MOVE DP015-RED    TO ASTRTITC                    18200001
182100                 MOVE DP015-UNP-NUM-BRT-MDT                       18210001
182200                                   TO ASTRTITA                    18220001
182300                 SET DP020-MSG-FATAL                              18230001
182400                                   TO TRUE                        18240001
182500                 SET PS-ERROR      TO TRUE                        18250001
182600             END-IF                                               18260001
182700                                                                  18270001
182800         ELSE                                                     18280001
182900             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            18290001
183000             MOVE -1               TO ASTRTITL                    18300001
183100             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  18310001
183200             MOVE DP015-REVERSE    TO ASTRTITH                    18320001
183300             MOVE DP015-RED        TO ASTRTITC                    18330001
183400             MOVE DP015-UNP-NUM-BRT-MDT                           18340001
183500                                   TO ASTRTITA                    18350001
183600             SET DP020-MSG-FATAL   TO TRUE                        18360001
183700             SET PS-ERROR          TO TRUE                        18370001
183800         END-IF                                                   18380001
183900     END-IF.                                                      18390001
184000                                                                  18400001
184010                                                                  18401001
184100*----------------------------------------------------------------*18410001
184200*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *18420001
184300*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *18430001
184400*----------------------------------------------------------------*18440001
184500 2140-DESELECT-ALL-ITEMS.                                         18450001
184600     MOVE +1                       TO ASC-BLK-SUB.                18460001
184700                                                                  18470001
184800     PERFORM 2141-CLEAR-SELECTED-INDS                             18480001
184900         VARYING ASC-ITEM-SUB                                     18490001
185000         FROM 1 BY 1                                              18500001
185100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 18510001
185200                                                                  18520001
185300     ADD +1                        TO ASC-BLK-SUB.                18530001
185400                                                                  18540001
185500     PERFORM 2141-CLEAR-SELECTED-INDS                             18550001
185600         VARYING ASC-ITEM-SUB                                     18560001
185700         FROM 1 BY 1                                              18570001
185800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 18580001
185900                                                                  18590001
186000     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               18600001
186100                                   TO PV-LIST-ITEM-NUMBER.        18610001
186200                                                                  18620001
186300     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            18630001
186400         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    18640001
186500                                                                  18650001
186600     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     18660001
186700        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      18670001
186800         MOVE +1                   TO ASC-BLK-SUB                 18680001
186900                                                                  18690001
187000         PERFORM 5100-WRITE-TEMP-STORAGE                          18700001
187100                                                                  18710001
187200         MOVE +1                   TO PV-BLOCK-NUMBER             18720001
187300                                                                  18730001
187400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         18740001
187500             PV-FIRST-BLOCK-IN-ARRAY - 1                          18750001
187600                                                                  18760001
187700         PERFORM                                                  18770001
187800             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       18780001
187900                                                                  18790001
188000             PERFORM 4410-READ-TEMP-STORAGE                       18800001
188100                                                                  18810001
188200             PERFORM 2141-CLEAR-SELECTED-INDS                     18820001
188300                 VARYING ASC-ITEM-SUB                             18830001
188310                 FROM 1 BY 1                                      18831001
188400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          18840001
188500                                                                  18850001
188600             PERFORM 5100-WRITE-TEMP-STORAGE                      18860001
188700                                                                  18870001
188800             ADD +1                TO PV-BLOCK-NUMBER             18880001
188900                                                                  18890001
189000         END-PERFORM                                              18900001
189100                                                                  18910001
189200         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         18920001
189300             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     18930001
189400                                                                  18940001
189500         PERFORM                                                  18950001
189600             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       18960001
189700                   ASC-HIGHEST-BLOCK-WRITTEN                      18970001
189800                                                                  18980001
189900             MOVE PV-NEXT-BLOCK-IN-ARRAY                          18990001
190000                                   TO PV-BLOCK-NUMBER             19000001
190100                                                                  19010001
190200             PERFORM 4410-READ-TEMP-STORAGE                       19020001
190300                                                                  19030001
190400             PERFORM 2141-CLEAR-SELECTED-INDS                     19040001
190500                 VARYING ASC-ITEM-SUB                             19050001
190600                 FROM 1 BY 1                                      19060001
190700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          19070001
190800                                                                  19080001
190900             PERFORM 5100-WRITE-TEMP-STORAGE                      19090001
191000                                                                  19100001
191100             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      19110001
191200                                                                  19120001
191300         END-PERFORM                                              19130001
191400                                                                  19140001
191500         MOVE PV-FIRST-BLOCK-IN-ARRAY                             19150001
191600                                   TO PV-BLOCK-NUMBER             19160001
191700                                                                  19170001
191800         PERFORM 4410-READ-TEMP-STORAGE                           19180001
191900     END-IF.                                                      19190001
192000                                                                  19200001
192100                                                                  19210001
192200     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 19220001
192300     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.19230001
192400     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  19240001
192500                                                                  19250001
192600     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        19260001
192700                                                                  19270001
192800                                                                  19280001
192900*----------------------------------------------------------------*19290001
193000*    MARK EACH ITEM AS BEING NOT SELECTED.                       *19300001
193100*----------------------------------------------------------------*19310001
193200                                                                  19320001
193300 2141-CLEAR-SELECTED-INDS.                                        19330001
193400                                                                  19340001
193500     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           19350001
193600             NOT EQUAL ZERO                                       19360001
193700         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          19370001
193800             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          19380001
193900                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    19390001
194000                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  19400001
194100                                   TO TRUE                        19410001
194200         END-IF                                                   19420001
194300     END-IF.                                                      19430001
194400                                                                  19440001
194500                                                                  19450001
194600*----------------------------------------------------------------*19460001
194700*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *19470001
194800*  FOR ALL ITEMS.                                                *19480001
194900*----------------------------------------------------------------*19490001
195000                                                                  19500001
195100 2150-SELECT-ALL-ITEMS.                                           19510001
195200                                                                  19520001
195300     MOVE +1                       TO ASC-BLK-SUB.                19530001
195400                                                                  19540001
195500     PERFORM 2151-SET-SELECTED-INDS                               19550001
195600         VARYING ASC-ITEM-SUB                                     19560001
195700         FROM 1 BY 1                                              19570001
195800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 19580001
195900                                                                  19590001
196000     ADD +1                        TO ASC-BLK-SUB.                19600001
196100                                                                  19610001
196200     PERFORM 2151-SET-SELECTED-INDS                               19620001
196300         VARYING ASC-ITEM-SUB                                     19630001
196400         FROM 1 BY 1                                              19640001
196500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 19650001
196600                                                                  19660001
196700     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               19670001
196800                                   TO PV-LIST-ITEM-NUMBER.        19680001
196900                                                                  19690001
197000     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            19700001
197100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    19710001
197200                                                                  19720001
197300*                                                                 19730001
197400     IF  PV-FIRST-BLOCK-IN-ARRAY  = +1                            19740001
197500         MOVE +1                   TO ASC-BLK-SUB                 19750001
197600                                                                  19760001
197700         PERFORM 5100-WRITE-TEMP-STORAGE                          19770001
197800         MOVE +2                   TO ASC-BLK-SUB                 19780001
197900         PERFORM 5100-WRITE-TEMP-STORAGE                          19790001
197910         MOVE +1                   TO ASC-BLK-SUB                 19791001
197920         MOVE +1                   TO PV-BLOCK-NUMBER             19792001
197930     END-IF.                                                      19793001
197940*                                                                 19794001
197950                                                                  19795001
197960     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     19796001
197970        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    19797001
197980         MOVE +1                   TO ASC-BLK-SUB                 19798001
197990                                                                  19799001
198000         PERFORM 5100-WRITE-TEMP-STORAGE                          19800001
198100                                                                  19810001
198200         MOVE +1                   TO PV-BLOCK-NUMBER             19820001
198300                                                                  19830001
198400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         19840001
198500             PV-FIRST-BLOCK-IN-ARRAY - 1                          19850001
198600                                                                  19860001
198700         PERFORM                                                  19870001
198800             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       19880001
198900                                                                  19890001
199000             PERFORM 4410-READ-TEMP-STORAGE                       19900001
199100                                                                  19910001
199200             PERFORM 2151-SET-SELECTED-INDS                       19920001
199300                 VARYING ASC-ITEM-SUB                             19930001
199400                 FROM 1 BY 1                                      19940001
199500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          19950001
199600                                                                  19960001
199700             PERFORM 5100-WRITE-TEMP-STORAGE                      19970001
199800                                                                  19980001
199900             ADD +1                TO PV-BLOCK-NUMBER             19990001
200000                                                                  20000001
200100         END-PERFORM                                              20010001
200200                                                                  20020001
200300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         20030001
200400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     20040001
200500                                                                  20050001
200600         PERFORM                                                  20060001
200700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       20070001
200800                   ASC-HIGHEST-BLOCK-WRITTEN                      20080001
200900                                                                  20090001
201000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          20100001
201100                                   TO PV-BLOCK-NUMBER             20110001
201200                                                                  20120001
201300             PERFORM 4410-READ-TEMP-STORAGE                       20130001
201400                                                                  20140001
201500             PERFORM 2151-SET-SELECTED-INDS                       20150001
201600                 VARYING ASC-ITEM-SUB                             20160001
201700                 FROM 1 BY 1                                      20170001
201800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          20180001
201900                                                                  20190001
202000             PERFORM 5100-WRITE-TEMP-STORAGE                      20200001
202100                                                                  20210001
202200             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      20220001
202300                                                                  20230001
202400         END-PERFORM                                              20240001
202500                                                                  20250001
202600         MOVE PV-FIRST-BLOCK-IN-ARRAY                             20260001
202700                                   TO PV-BLOCK-NUMBER             20270001
202800                                                                  20280001
202900         PERFORM 4410-READ-TEMP-STORAGE                           20290001
203000     END-IF.                                                      20300001
203100                                                                  20310001
203200                                                                  20320001
203300     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             20330001
203400                       ASC-NUMBER-OF-SELECTED-ITEMS.              20340001
203500                                                                  20350001
203600     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        20360001
203700                                                                  20370001
203800                                                                  20380001
203900*----------------------------------------------------------------*20390001
204000*    MARK EACH ITEM AS BEING SELECTED.                           *20400001
204100*----------------------------------------------------------------*20410001
204200                                                                  20420001
204300 2151-SET-SELECTED-INDS.                                          20430001
204400                                                                  20440001
204500     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           20450001
204600             NOT EQUAL ZERO                                       20460001
204700         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             20470001
204800             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             20480001
204900                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        20490001
205000                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  20500001
205100                               TO  TRUE                           20510001
205200         END-IF                                                   20520001
205300     END-IF.                                                      20530001
205310                                                                  20531001
205400******************************************************************20540001
205410******************************************************************20541001
205500** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **20550001
205600** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **20560001
205700******************************************************************20570001
205800 2200-MOVE-SCREEN-TO-COMMAREA.                                    20580001
205900                                                                  20590001
206000     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             20600001
206100     MOVE +1                       TO PV-SUB.                     20610001
206200                                                                  20620001
206300     PERFORM 3100-SET-SUBSCRIPTS.                                 20630001
206400     IF  ASTRTITL > ZERO                                          20640001
206500         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          20650001
206600     ELSE                                                         20660001
206700         IF  ASTRTITF = DP015-ERASE-EOF                           20670001
206800             INITIALIZE ASC-START-ITEM-REQUEST                    20680001
206900         END-IF                                                   20690001
207000     END-IF.                                                      20700001
207900                                                                  20790001
208000     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          20800001
208100         VARYING PV-SUB                                           20810001
208200         FROM 1 BY 1                                              20820001
208300         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      20830001
208310                                                                  20831001
208320                                                                  20832001
208400******************************************************************20840001
208500** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**20850001
208600******************************************************************20860001
208700 2210-MOVE-LINES-TO-COMMAREA.                                     20870001
208800     IF  MR-SELECTL (PV-SUB) > ZERO                               20880001
208900         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             20890001
209000         MOVE MR-SELECTI (PV-SUB)                                 20900001
209100                                   TO ASC-TEMP-SELECTED-SW        20910001
209200                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      20920001
209300     ELSE                                                         20930001
209400         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                20940001
209500                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     20950001
209600                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        20960001
209700                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      20970001
209800         END-IF                                                   20980001
209900     END-IF.                                                      20990001
210000                                                                  21000001
210010     MOVE ASC-ATTR-ELEM-SEQ        TO  ASC-DTL-ATTR-ELEM-SEQ      21001001
210020                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      21002001
210030                                                                  21003001
210031     IF  MR-DEFSEQL (PV-SUB) > ZERO                               21003108
210040         MOVE  MR-DEFSEQ (PV-SUB)  TO  ASC-DTL-ATTR-DEFN-SEQ      21004008
210050                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      21005001
210051     END-IF.                                                      21005108
210060                                                                  21006001
210070                                                                  21007001
210071     IF  MR-DATYPEL (PV-SUB) > ZERO                               21007108
210080         MOVE  MR-DATYPE (PV-SUB)  TO  ASC-DTL-DATA-TYPE          21008008
210090                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      21009001
210091     END-IF.                                                      21009108
210092                                                                  21009201
210093                                                                  21009301
210094     IF  MR-DADESCL (PV-SUB) > ZERO                               21009408
210095         MOVE MR-DADESC (PV-SUB)   TO  ASC-DTL-DEFN-DESCR         21009508
210096                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      21009601
210097     END-IF.                                                      21009708
210098                                                                  21009801
210099     IF  MR-VALUEL (PV-SUB) > ZERO                                21009901
210100         MOVE MR-VALUE (PV-SUB)                                   21010001
210101                                   TO  ASC-DTL-ELEM-VALUE         21010101
210102                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      21010201
210103     END-IF.                                                      21010301
210110                                                                  21011001
210200     ADD +1                        TO ASC-ITEM-SUB.               21020001
210300     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        21030001
210400         ADD +1                    TO ASC-BLK-SUB                 21040001
210500         MOVE +1                   TO ASC-ITEM-SUB                21050001
210600     END-IF.                                                      21060001
210610                                                                  21061001
210620                                                                  21062001
210700******************************************************************21070001
210800** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **21080001
210900** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **21090001
211000******************************************************************21100001
211100 3000-EDIT-DATA-IN-COMMAREA.                                      21110001
211200     SET PS-NO-ERROR               TO TRUE.                       21120001
211300     PERFORM 3200-RESET-ATTRIBUTES.                               21130001
211400     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     21140001
211500                                                                  21150001
231800*                                                                 23180001
232000* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              23200001
232100* EDITTING IS DONE FROM THE BOTTOM UP.                            23210001
232200*                                                                 23220001
232300     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       23230001
232400         ASC-ITEMS-DISPLAYED - 1.                                 23240001
232500     PERFORM 3100-SET-SUBSCRIPTS.                                 23250001
232600                                                                  23260001
232700     IF  PS-NO-ERROR                                              23270001
232800         PERFORM 3005-EDIT-COMMAREA-BLOCKS                        23280001
232900     END-IF.                                                      23290001
232910                                                                  23291020
232920     IF  ASC-ADD-ELEM                                             23292020
232930         IF  ASC-NUMBER-OF-ITEMS-READ  =                          23293020
232940             ASC-NUMBER-OF-SELECTED-ITEMS                         23294020
232950             CONTINUE                                             23295020
232960         ELSE                                                     23296020
232970             MOVE PC-TSYMSG-03792   TO DP020-MSG-NUMBER           23297020
232980             SET DP020-MSG-FATAL    TO TRUE                       23298020
232990             MOVE -1                TO MR-SELECTL (PV-SUB)        23299020
232991             SET DP030-SET-CURSOR-APPL-1                          23299120
232992                                    TO TRUE                       23299220
232993             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        23299320
232994             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        23299420
232995             SET PS-ERROR TO TRUE                                 23299520
232996         END-IF                                                   23299620
232997     END-IF.                                                      23299720
233000                                                                  23300001
233100     IF  PS-NO-ERROR                                              23310001
233200         PERFORM 3400-CHECK-RANGE-SEQUENCE                        23320001
233300     END-IF.                                                      23330001
233400                                                                  23340001
233500     IF  ((PS-NO-ERROR)                                           23350001
233600       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   23360001
233700       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    23370001
233800             PERFORM 3500-MARK-RANGE-AS-SELECTED                  23380001
233900     END-IF.                                                      23390001
234000                                                                  23400001
234100                                                                  23410001
234200*----------------------------------------------------------------*23420001
234300* 3005-EDIT-COMMAREA-BLOCKS                                      *23430001
234400*----------------------------------------------------------------*23440001
234500 3005-EDIT-COMMAREA-BLOCKS.                                       23450001
234600     MOVE +1                       TO PV-BLOCK-NUMBER.            23460001
234700     MOVE +1                       TO ASC-BLK-SUB.                23470001
234800     MOVE PC-ITEMS-PER-PANEL       TO ASC-ITEM-SUB.               23480001
234900                                                                  23490001
235000     COMPUTE PV-BLOCK-NUMBER  =                                   23500001
235100             1 + ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) /            23510001
235200             PC-ITEMS-PER-PANEL.                                  23520001
235300                                                                  23530001
235400     MOVE  PV-BLOCK-NUMBER         TO PV-ORIGINAL-BLOCK.          23540001
235500                                                                  23550001
235600     PERFORM                                                      23560001
235700        UNTIL PV-BLOCK-NUMBER > ASC-HIGHEST-BLOCK-WRITTEN         23570001
235800           OR PS-ERROR                                            23580001
235900           OR PS-BLOCK-ERROR                                      23590001
236000                                                                  23600001
236100              COMPUTE PV-ITEMS-HOLD  =                            23610001
236200                      ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +       23620001
236300                      PC-ITEMS-PER-PANEL - 1                      23630001
236400                                                                  23640001
236500               IF  PV-ITEMS-HOLD  >  ASC-NUMBER-OF-ITEMS-READ     23650001
236600                   SUBTRACT  ASC-NUMBER-OF-ITEMS-READ             23660001
236700                       FROM  PV-ITEMS-HOLD                        23670001
236800                     GIVING  PV-ITEMS-DIFF                        23680001
236900                   SUBTRACT  PV-ITEMS-DIFF                        23690001
237000                       FROM  PC-ITEMS-PER-PANEL                   23700001
237100                     GIVING  PV-ITEMS-HOLD                        23710001
237200                       MOVE  PV-ITEMS-HOLD TO PV-SUB              23720001
237300                                              ASC-ITEM-SUB        23730001
237400                                              ASC-ITEMS-DISPLAYED 23740001
237500                                                                  23750001
237600               ELSE                                               23760001
237700                   MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB            23770001
237800                   MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB      23780001
237900               END-IF                                             23790001
238000                                                                  23800001
238100               PERFORM 3300-EDIT-SELECTIONS                       23810001
238200                       VARYING PV-SUB                             23820001
238300                          FROM PV-SUB BY -1                       23830001
238400                          UNTIL PV-SUB < +1                       23840001
239000                                                                  23900001
239100               MOVE +1               TO ASC-BLK-SUB               23910001
239200                                                                  23920001
239300               PERFORM 5105-REWRITE-ASC-LISTQ                     23930001
239400                                                                  23940001
239500               MOVE +1                TO ASC-BLK-SUB              23950001
239600                                                                  23960001
239700               IF  PS-BLOCK-ERROR                                 23970001
239800                   SET  PS-ERROR     TO TRUE                      23980001
239900                   MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)      23990001
240000                                     TO PV-TOP-ITEM               24000001
240100               ELSE                                               24010001
240200                   ADD  +1           TO PV-BLOCK-NUMBER           24020001
240300                   IF  PV-BLOCK-NUMBER >                          24030001
240400                       ASC-HIGHEST-BLOCK-WRITTEN                  24040001
240500                       MOVE +2       TO ASC-BLK-SUB               24050001
240600                       PERFORM 4410-READ-TEMP-STORAGE             24060001
240700                       MOVE +1       TO ASC-BLK-SUB               24070001
240800                   ELSE                                           24080001
240900                       PERFORM 4410-READ-TEMP-STORAGE             24090001
241000                       ADD  +1        TO PV-BLOCK-NUMBER          24100001
241100                       MOVE +2        TO ASC-BLK-SUB              24110001
241200                       PERFORM 4410-READ-TEMP-STORAGE             24120001
241300                       SUBTRACT +1  FROM PV-BLOCK-NUMBER          24130001
241400                       MOVE +1        TO ASC-BLK-SUB              24140001
241500               END-IF                                             24150001
241600           END-IF                                                 24160001
241700     END-PERFORM.                                                 24170001
241800                                                                  24180001
241900     IF  PV-ORIGINAL-BLOCK  = +1    OR                            24190001
242000         PS-ERROR                   OR                            24200001
242100         PS-BLOCK-ERROR                                           24210001
242200             CONTINUE                                             24220001
242300     ELSE                                                         24230001
242400         MOVE +1                 TO PV-BLOCK-NUMBER               24240001
242500         MOVE +1                 TO ASC-BLK-SUB                   24250001
242600         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  24260001
242700         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEMS-DISPLAYED           24270001
242800         PERFORM 4410-READ-TEMP-STORAGE                           24280001
242900                                                                  24290001
243000         PERFORM                                                  24300001
243100            UNTIL PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK             24310001
243200               OR PS-ERROR                                        24320001
243300               OR PS-BLOCK-ERROR                                  24330001
243400                                                                  24340001
243500                  COMPUTE PV-ITEMS-HOLD  =                        24350001
243600                          ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +   24360001
243700                          PC-ITEMS-PER-PANEL - 1                  24370001
243800                                                                  24380001
243900                  IF  PV-ITEMS-HOLD > ASC-NUMBER-OF-ITEMS-READ    24390001
244000                      SUBTRACT  ASC-NUMBER-OF-ITEMS-READ          24400001
244100                          FROM  PV-ITEMS-HOLD                     24410001
244200                        GIVING  PV-ITEMS-DIFF                     24420001
244300                      SUBTRACT  PV-ITEMS-DIFF                     24430001
244400                          FROM  PC-ITEMS-PER-PANEL                24440001
244500                        GIVING  PV-ITEMS-HOLD                     24450001
244600                          MOVE  PV-ITEMS-HOLD TO PV-SUB           24460001
244700                                                 ASC-ITEM-SUB     24470001
244800                                              ASC-ITEMS-DISPLAYED 24480001
244900                  ELSE                                            24490001
245000                      MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB         24500001
245100                      MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB   24510001
245200                  END-IF                                          24520001
245300                                                                  24530001
245400                  PERFORM 3300-EDIT-SELECTIONS                    24540001
245500                          VARYING PV-SUB                          24550001
245600                             FROM PV-SUB BY -1                    24560001
245700                            UNTIL PV-SUB < +1                     24570001
245800                                                                  24580001
246400                  MOVE +1               TO ASC-BLK-SUB            24640001
246500                                                                  24650001
246600                  PERFORM 5105-REWRITE-ASC-LISTQ                  24660001
246700                                                                  24670001
246800                  MOVE +1                TO ASC-BLK-SUB           24680001
246900                                                                  24690001
247000                  IF  PS-BLOCK-ERROR                              24700001
247100                      SET  PS-ERROR     TO TRUE                   24710001
247200                      MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)   24720001
247300                                        TO PV-TOP-ITEM            24730001
247400                  ELSE                                            24740001
247500                      ADD  +1            TO PV-BLOCK-NUMBER       24750001
247600                      IF  PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK     24760001
247700                          MOVE +2        TO ASC-BLK-SUB           24770001
247800                          PERFORM 4410-READ-TEMP-STORAGE          24780001
247900                          MOVE +1        TO ASC-BLK-SUB           24790001
248000                      ELSE                                        24800001
248100                          PERFORM 4410-READ-TEMP-STORAGE          24810001
248200                          ADD  +1        TO PV-BLOCK-NUMBER       24820001
248300                          MOVE +2        TO ASC-BLK-SUB           24830001
248400                          PERFORM 4410-READ-TEMP-STORAGE          24840001
248500                          SUBTRACT +1  FROM PV-BLOCK-NUMBER       24850001
248600                          MOVE +1        TO ASC-BLK-SUB           24860001
248700                      END-IF                                      24870001
248800                  END-IF                                          24880001
248900     END-PERFORM.                                                 24890001
249000                                                                  24900001
249100                                                                  24910001
249200*----------------------------------------------------------------*24920001
249300* GET THE NEXT ELEM SEQUENCE NUMBER                              *24930001
249400*----------------------------------------------------------------*24940001
249500 3045-GET-NEXT-SEQ-NBR.                                           24950001
249600                                                                  24960001
249700      MOVE ASC-PARM-NAME     TO DK-INTGRTN-TYP.                   24970001
249800                                                                  24980001
249900        EXEC SQL                                                  24990001
250000          SELECT                                                  25000001
250100                 MAX(ATTR_ELEM_SEQ_NBR)                           25010001
250200            INTO                                                  25020001
250300                 :PV-MAX-ELEM-SEQ-NBR                             25030001
250400            FROM  WST_ATTR_ELEM                                   25040001
250500           WHERE  INTGRTN_TYP_CDE   = :DK-INTGRTN-TYP             25050001
250600        END-EXEC                                                  25060001
250700                                                                  25070001
250800        EVALUATE TRUE                                             25080001
250900            WHEN SQLCODE = +0                                     25090001
251000                 ADD  1 TO PV-MAX-ELEM-SEQ-NBR                    25100001
251100                      GIVING PV-NEXT-ELEM-SEQ-NBR                 25110001
251200                                                                  25120001
251300            WHEN SQLCODE = +100                                   25130001
251400            WHEN SQLCODE = -305                                   25140001
251500                 MOVE 1  TO  PV-NEXT-ELEM-SEQ-NBR                 25150001
251600                                                                  25160001
251700            WHEN SQLWARN0 NOT = SPACES                            25170001
251800            WHEN SQLCODE < +0                                     25180001
251900            WHEN SQLCODE > +0                                     25190001
252000                MOVE '3045-GET-NEXT-SEQ-NBR'                      25200001
252100                                          TO DP013-PARAGRAPH      25210001
252200                MOVE 'GET NEXT WST_ATTR_ELEM SEQ'                 25220001
252300                                    TO DP013-MESSAGE-TEXT (1)     25230001
252400                MOVE SQLCA      TO DP013-SQLCA                    25240001
252500                MOVE 'WST00010' TO DP013-DB2-TABLE-NAME (1)       25250001
252600                SET DP013-DB2-ABEND                               25260001
252700                    DP013-XCTL-DISPLAY-RESTART TO TRUE            25270001
252800                PERFORM DP013-0000-PROCESS-ABEND                  25280001
252900        END-EVALUATE.                                             25290001
253000                                                                  25300001
253100                                                                  25310001
253200*----------------------------------------------------------------*25320001
253300* GET THE CURRENT TIMESTAMP                                      *25330001
253400*----------------------------------------------------------------*25340001
253500 3050-GET-CURRENT-TMST.                                           25350001
253600                                                                  25360001
253700        EXEC SQL                                                  25370001
253800            SET :DK-CURRENT-TIMESTAMP = CURRENT TIMESTAMP         25380001
253900        END-EXEC.                                                 25390001
254000                                                                  25400001
254100                                                                  25410001
254200*----------------------------------------------------------------*25420001
254300*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *25430001
254400*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*25440001
254500*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *25450001
254600*                                                                *25460001
254700*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *25470001
254800*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *25480001
254900*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *25490001
255000*    US IN THE 2ND BLOCK OF THE ARRAY.                           *25500001
255100*----------------------------------------------------------------*25510001
262200 3100-SET-SUBSCRIPTS.                                             26220001
262300                                                                  26230001
262400     COMPUTE ASC-ITEM-SUB =                                       26240001
262500         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        26250001
262600                                                                  26260001
262700     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         26270001
262800         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            26280001
262900                                                                  26290001
263000         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               26300001
263100     ELSE                                                         26310001
263200         MOVE +1                     TO ASC-BLK-SUB               26320001
263300     END-IF.                                                      26330001
263310                                                                  26331001
263320                                                                  26332001
263400******************************************************************26340001
263500** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **26350001
263600******************************************************************26360001
263800 3200-RESET-ATTRIBUTES.                                           26380001
263900     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   26390001
264100     MOVE DP015-GREEN              TO ASTRTITC.                   26410001
264300     MOVE DP015-UNDERLINE          TO ASTRTITH.                   26430001
264500                                                                  26450001
264600     PERFORM                                                      26460001
264700         VARYING PV-SUB                                           26470001
264800         FROM 1 BY 1                                              26480001
264900         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        26490001
265000         MOVE DP015-UNP-ALP-NOR-OFF                               26500001
265100                                   TO MR-SELECTA (PV-SUB)         26510001
265200         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         26520001
265400         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         26540001
265401                                                                  26540108
265410             IF  PV-SUB  >  ASC-ITEMS-DISPLAYED  AND              26541008
265420                 NOT DP020-FK-PREV-PAGE(DP020-SRC-AID)            26542008
265430                 CONTINUE                                         26543008
265440             ELSE                                                 26544008
265450                 MOVE DP015-UNP-ALP-NOR-OFF                       26545008
265460                                   TO MR-SELECTA (PV-SUB)         26546008
265492                                      MR-VALUEA  (PV-SUB)         26549208
265497                 MOVE DP015-PRO-NOR-MDT                           26549708
265498                                   TO MR-DEFSEQA (PV-SUB)         26549808
265499                                      MR-DATYPEA (PV-SUB)         26549908
265500                                      MR-DADESCA (PV-SUB)         26550008
265505                 MOVE DP015-GREEN  TO MR-SELECTC (PV-SUB)         26550508
265506                                      MR-VALUEC  (PV-SUB)         26550608
265515                 MOVE DP015-BLUE   TO MR-DEFSEQC (PV-SUB)         26551508
265516                                      MR-DATYPEC (PV-SUB)         26551608
265517                                      MR-DADESCC (PV-SUB)         26551708
265518                 MOVE DP015-UNDERLINE                             26551808
265519                                   TO MR-SELECTH (PV-SUB)         26551908
265520                                      MR-VALUEH  (PV-SUB)         26552008
265533             END-IF                                               26553308
265534     END-PERFORM.                                                 26553401
265535                                                                  26553501
265540                                                                  26554001
265600******************************************************************26560001
265700** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **26570001
265800** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **26580001
265900** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **26590001
266000** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **26600001
266100******************************************************************26610001
266200 3300-EDIT-SELECTIONS.                                            26620001
266300     EVALUATE TRUE                                                26630001
266400         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     26640001
266500             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         26650001
266600                 CONTINUE                                         26660001
266700         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         26670001
266800             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        26680001
266900                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   26690001
267000                 MOVE ASC-TEMP-SELECTED-SW                        26700001
267100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  26710001
267200                                TO ASC-SELECTED-SW                26720001
267300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  26730001
267400             END-IF                                               26740001
267500         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     26750001
267600                 = SPACE                                          26760001
267700             EVALUATE TRUE                                        26770001
267800                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       26780001
267900                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS26790001
268000                     MOVE SPACE TO ASC-SELECTED-SW                26800001
268100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  26810001
268200                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        26820001
268300                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    26830001
268400                     MOVE SPACE TO ASC-SELECTED-SW                26840001
268500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  26850001
268600                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          26860001
268700                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      26870001
268800                     MOVE SPACE TO ASC-SELECTED-SW                26880001
268900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  26890001
269000             END-EVALUATE                                         26900001
269100         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           26910001
269200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            26920001
269300                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    26930001
269400             END-IF                                               26940001
269500             PERFORM 3310-EDIT-RANGE                              26950001
269600         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             26960001
269700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            26970001
269800                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    26980001
269900             END-IF                                               26990001
270000             PERFORM 3310-EDIT-RANGE                              27000001
270100         WHEN OTHER                                               27010001
270200             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           27020001
270300             SET DP020-MSG-FATAL    TO TRUE                       27030001
270400             MOVE -1                TO MR-SELECTL (PV-SUB)        27040001
270500             SET DP030-SET-CURSOR-APPL-1                          27050001
270600                                    TO TRUE                       27060001
270700             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        27070001
270800             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        27080001
270900             SET PS-ERROR TO TRUE                                 27090001
271000             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            27100001
271100                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     27110001
271200                 MOVE SPACE         TO ASC-SELECTED-SW            27120001
271300                                        (ASC-BLK-SUB ASC-ITEM-SUB)27130001
271400             END-IF                                               27140001
271500     END-EVALUATE.                                                27150001
271650                                                                  27165015
271700     PERFORM 3305-EDIT-LINES.                                     27170019
271800                                                                  27180001
274400                                                                  27440001
274500     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 27450001
274600     SUBTRACT +1 FROM ASC-ITEM-SUB.                               27460001
274700     IF  ASC-ITEM-SUB < 1                                         27470001
274800         SUBTRACT +1 FROM ASC-BLK-SUB                             27480001
274900         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                27490001
275000     END-IF.                                                      27500001
275100                                                                  27510001
275200                                                                  27520001
275300*----------------------------------------------------------------*27530001
275400*  EDIT SELECTED LINES                                           *27540001
275500*----------------------------------------------------------------*27550001
275600 3305-EDIT-LINES.                                                 27560001
275800                                                                  27580001
275820     IF  ASC-DTL-DATA-TYPE (ASC-BLK-SUB, ASC-ITEM-SUB) = 'NUM'    27582001
275830                                                                  27583001
275840         MOVE ASC-DTL-ELEM-VALUE (ASC-BLK-SUB, ASC-ITEM-SUB)      27584001
275850           TO PV-NUMBER-WORK                                      27585001
275860         PERFORM                                                  27586001
275870           UNTIL PV-NUMBER-WORK(PV-NUM-LEN:1) = SPACES            27587001
275880           COMPUTE PV-NUM-LEN   = PV-NUM-LEN + 1                  27588001
275890         END-PERFORM                                              27589001
275891                                                                  27589101
275892         SUBTRACT 1 FROM PV-NUM-LEN                               27589201
275893                                                                  27589301
275894         EVALUATE TRUE                                            27589401
275895             WHEN PV-NUM-LEN  =  14                               27589501
275896                  MOVE  PV-NUMBER-WORK(1:14)                      27589601
275897                                    TO DP010I-UNEDITED-FIELD      27589701
275898                  MOVE  14           TO DP010I-MAXIMUM-DIGITS     27589801
275899             WHEN PV-NUM-LEN  =  13                               27589901
275900                  MOVE  PV-NUMBER-WORK(1:13)                      27590001
275901                                    TO DP010I-UNEDITED-FIELD      27590101
275902                  MOVE  13           TO DP010I-MAXIMUM-DIGITS     27590201
275903             WHEN PV-NUM-LEN  =  12                               27590301
275904                  MOVE  PV-NUMBER-WORK(1:12)                      27590401
275905                                    TO DP010I-UNEDITED-FIELD      27590501
275906                  MOVE  12           TO DP010I-MAXIMUM-DIGITS     27590601
275907             WHEN PV-NUM-LEN  =  11                               27590701
275908                  MOVE  PV-NUMBER-WORK(1:11)                      27590801
275909                                    TO DP010I-UNEDITED-FIELD      27590901
275910                  MOVE  11           TO DP010I-MAXIMUM-DIGITS     27591001
275911             WHEN PV-NUM-LEN  =  10                               27591101
275912                  MOVE  PV-NUMBER-WORK(1:10)                      27591201
275913                                    TO DP010I-UNEDITED-FIELD      27591301
275914                  MOVE  10           TO DP010I-MAXIMUM-DIGITS     27591401
275915             WHEN PV-NUM-LEN  =  09                               27591501
275916                  MOVE  PV-NUMBER-WORK(1:09)                      27591601
275917                                    TO DP010I-UNEDITED-FIELD      27591701
275918                  MOVE  09           TO DP010I-MAXIMUM-DIGITS     27591801
275919             WHEN PV-NUM-LEN  =  08                               27591901
275920                  MOVE  PV-NUMBER-WORK(1:08)                      27592001
275921                                    TO DP010I-UNEDITED-FIELD      27592101
275922                  MOVE  08           TO DP010I-MAXIMUM-DIGITS     27592201
275923             WHEN PV-NUM-LEN  =  07                               27592301
275924                  MOVE  PV-NUMBER-WORK(1:07)                      27592401
275925                                    TO DP010I-UNEDITED-FIELD      27592501
275926                  MOVE  07           TO DP010I-MAXIMUM-DIGITS     27592601
275927             WHEN PV-NUM-LEN  =  06                               27592701
275928                  MOVE  PV-NUMBER-WORK(1:06)                      27592801
275929                                    TO DP010I-UNEDITED-FIELD      27592901
275930                  MOVE  06           TO DP010I-MAXIMUM-DIGITS     27593001
275931             WHEN PV-NUM-LEN  =  05                               27593101
275932                  MOVE  PV-NUMBER-WORK(1:05)                      27593201
275933                                    TO DP010I-UNEDITED-FIELD      27593301
275934                  MOVE  05           TO DP010I-MAXIMUM-DIGITS     27593401
275935             WHEN PV-NUM-LEN  =  04                               27593501
275936                  MOVE  PV-NUMBER-WORK(1:04)                      27593601
275937                                    TO DP010I-UNEDITED-FIELD      27593701
275938                  MOVE  04           TO DP010I-MAXIMUM-DIGITS     27593801
275939             WHEN PV-NUM-LEN  =  03                               27593901
275940                  MOVE  PV-NUMBER-WORK(1:03)                      27594001
275941                                    TO DP010I-UNEDITED-FIELD      27594101
275942                  MOVE  03           TO DP010I-MAXIMUM-DIGITS     27594201
275943             WHEN PV-NUM-LEN  =  02                               27594301
275944                  MOVE  PV-NUMBER-WORK(1:02)                      27594401
275945                                    TO DP010I-UNEDITED-FIELD      27594501
275946                  MOVE  02           TO DP010I-MAXIMUM-DIGITS     27594601
275947             WHEN PV-NUM-LEN  =  01                               27594701
275948                  MOVE  PV-NUMBER-WORK(1:01)                      27594801
275949                                    TO DP010I-UNEDITED-FIELD      27594901
275950                  MOVE  01           TO DP010I-MAXIMUM-DIGITS     27595001
275951             WHEN OTHER                                           27595101
275952                  MOVE ASC-DTL-ELEM-VALUE                         27595201
275953                                     (ASC-BLK-SUB, ASC-ITEM-SUB)  27595301
275954                                    TO DP010I-UNEDITED-FIELD      27595401
275955                  MOVE  14           TO DP010I-MAXIMUM-DIGITS     27595501
275956         END-EVALUATE                                             27595601
275957                                                                  27595701
275958         MOVE ASC-DTL-ELEM-VALUE (ASC-BLK-SUB, ASC-ITEM-SUB)      27595801
275959           TO PV-DECIMAL-WORK                                     27595901
275960         MOVE LENGTH OF ASC-DTL-ELEM-VALUE                        27596001
275961                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      27596101
275962           TO PV-DEC-LEN                                          27596201
275963         PERFORM                                                  27596301
275964           UNTIL PV-DECIMAL-WORK(PV-DEC-LEN:1) = PC-DECIMAL       27596401
275965              OR PV-DEC-LEN                    = ZERO             27596501
275966           COMPUTE PV-DEC-LEN   = PV-DEC-LEN - 1                  27596601
275967         END-PERFORM                                              27596701
275968                                                                  27596801
275969         IF  PV-DEC-LEN  > 0                                      27596901
275970             MOVE 2                 TO DP010I-MAXIMUM-DECIMALS    27597001
275971         ELSE                                                     27597101
275972             MOVE 0                 TO DP010I-MAXIMUM-DECIMALS    27597201
275973         END-IF                                                   27597301
275974                                                                  27597401
275975         SET DP010I-NEGATIVE-ALLOWED                              27597501
275976                                     TO TRUE                      27597601
263455         CALL DP010I-NUMERIC-EDIT-ROUTINE                         27597825
263455              USING DP010I-NUMERIC-EDIT-AREA                      27597925
275978         IF  DP010I-ERROR-DETECTED                                27598001
275979             SET PS-ERROR                                         27598101
275980                 DP020-MSG-FATAL TO  TRUE                         27598201
275981             MOVE PC-TSYMSG-00008   TO DP020-MSG-NUMBER           27598301
275982             SET DP020-MSG-FATAL    TO TRUE                       27598401
275983             MOVE -1                TO MR-VALUEL (PV-SUB)         27598501
275984             SET DP030-SET-CURSOR-APPL-1                          27598601
275985                                    TO TRUE                       27598701
275986             MOVE DP015-RED         TO MR-VALUEC (PV-SUB)         27598801
275987             MOVE DP015-REVERSE     TO MR-VALUEH (PV-SUB)         27598901
275988         ELSE                                                     27599001
275989             MOVE DP010I-NUMERIC-FIELD TO PV-DISP-ATTR-NBR        27599101
275990             MOVE PV-DISP-ATTR-NBR TO  ASC-DTL-ELEM-NBR           27599201
275991                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      27599301
275992             MOVE  'N'             TO  ASC-DTL-ELEM-NBR-NULL      27599401
275993                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      27599501
275994         END-IF                                                   27599601
275995             MOVE  SPACES          TO  ASC-DTL-ELEM-TEXT          27599701
275996                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      27599801
275997             MOVE  'Y'             TO  ASC-DTL-ELEM-TEXT-NULL     27599901
275998                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      27600001
275999             MOVE  SPACES          TO  ASC-DTL-ELEM-TMST          27600101
276000                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      27600201
276001             MOVE  'Y'             TO  ASC-DTL-ELEM-TMST-NULL     27600301
276002                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      27600401
276003     END-IF.                                                      27600501
276004                                                                  27600601
276005     IF  ASC-DTL-DATA-TYPE (ASC-BLK-SUB, ASC-ITEM-SUB) = 'DTE'    27600701
276006         IF  ASC-DTL-ELEM-VALUE (ASC-BLK-SUB, ASC-ITEM-SUB)       27600801
276007             =  PC-DEFAULT-TMST                                   27600901
276008             CONTINUE                                             27601001
276009         ELSE                                                     27601101
276010             MOVE ASC-DTL-ELEM-VALUE (ASC-BLK-SUB, ASC-ITEM-SUB)  27601201
276011               TO PV-DATE-HOLD                                    27601301
276012                                                                  27601401
276013             MOVE PV-DATE-HOLD-CCYY  TO  PV-DATE-WORK-CCYY        27601501
276014             MOVE PV-DATE-HOLD-MM    TO  PV-DATE-WORK-MM          27601601
276015             MOVE PV-DATE-HOLD-DD    TO  PV-DATE-WORK-DD          27601701
276016                                                                  27601801
276017             INITIALIZE DPG51 DPG52 DPG53                         27601901
276018                        DPG54 DPG55 DPG56                         27602001
276019             SET  DPG51-ACTUAL-CALENDAR-ONLY                      27602101
276020                  DPG51-DO-NOT-INCR-DECR-DATE                     27602201
276021                                        TO TRUE                   27602301
276022***          'CCYYMMDD'                                           27602401
276023             SET  DPG52-LK-DTE-ISO                                27602501
276024                                        TO TRUE                   27602601
276025             MOVE PV-DATE-WORK          TO DPG52-LK-DATE-INPUT    27602701
276026             CALL DP500-KOHLS-CALENDAR-ROUTINE                    27602801
276027                                     USING DPG51 DPG52 DPG53      27602901
276028                                           DPG54 DPG55 DPG56      27603001
276029             IF (DPG54-DATE-INVALID  OR                           27603101
276030                 DPG54-SEVERE-ERROR)                              27603201
276031                 SET PS-ERROR                                     27603301
276032                     DP020-MSG-FATAL TO  TRUE                     27603401
276033                 MOVE PC-TSYMSG-00009   TO DP020-MSG-NUMBER       27603501
276034                 SET DP020-MSG-FATAL    TO TRUE                   27603601
276035                 MOVE -1                TO MR-VALUEL (PV-SUB)     27603701
276036                 SET DP030-SET-CURSOR-APPL-1                      27603801
276037                                        TO TRUE                   27603901
276038                 MOVE DP015-RED         TO MR-VALUEC (PV-SUB)     27604001
276039                 MOVE DP015-REVERSE     TO MR-VALUEH (PV-SUB)     27604101
276040                 MOVE -1                TO MR-VALUEL (PV-SUB)     27604201
276041                 SET DP030-SET-CURSOR-APPL-1                      27604301
276042                                        TO TRUE                   27604401
276043             END-IF                                               27604501
276044         END-IF                                                   27604601
276045                                                                  27604701
276046         MOVE  SPACES          TO  ASC-DTL-ELEM-TEXT              27604801
276047                             (ASC-BLK-SUB, ASC-ITEM-SUB)          27604901
276048         MOVE  'Y'             TO  ASC-DTL-ELEM-TEXT-NULL         27605001
276049                             (ASC-BLK-SUB, ASC-ITEM-SUB)          27605101
276050         MOVE ASC-DTL-ELEM-VALUE (ASC-BLK-SUB, ASC-ITEM-SUB)      27605201
276051                               TO  ASC-DTL-ELEM-TMST              27605301
276052                             (ASC-BLK-SUB, ASC-ITEM-SUB)          27605401
276053         MOVE  'N'             TO  ASC-DTL-ELEM-TMST-NULL         27605501
276054                             (ASC-BLK-SUB, ASC-ITEM-SUB)          27605601
276055         MOVE  ZEROES          TO  ASC-DTL-ELEM-NBR               27605701
276056                             (ASC-BLK-SUB, ASC-ITEM-SUB)          27605801
276057         MOVE  'Y'             TO  ASC-DTL-ELEM-NBR-NULL          27605901
276058                             (ASC-BLK-SUB, ASC-ITEM-SUB)          27606001
276059     END-IF.                                                      27606101
276060                                                                  27606201
276061     IF  ASC-DTL-DATA-TYPE (ASC-BLK-SUB, ASC-ITEM-SUB) = 'STR'    27606301
276062                                                                  27606401
276063         IF  ASC-DTL-ELEM-VALUE (ASC-BLK-SUB, ASC-ITEM-SUB)       27606501
276064                                = SPACES                          27606601
276065             SET PS-ERROR                                         27606701
276066                 DP020-MSG-FATAL TO  TRUE                         27606801
276067             MOVE PC-TSYMSG-00007   TO DP020-MSG-NUMBER           27606901
276068             SET DP020-MSG-FATAL    TO TRUE                       27607001
276069             MOVE -1                TO MR-VALUEL (PV-SUB)         27607101
276070             SET DP030-SET-CURSOR-APPL-1                          27607201
276071                                    TO TRUE                       27607301
276072             MOVE DP015-RED         TO MR-VALUEC (PV-SUB)         27607401
276073             MOVE DP015-REVERSE     TO MR-VALUEH (PV-SUB)         27607501
276074             MOVE -1                TO MR-VALUEL (PV-SUB)         27607601
276075             SET DP030-SET-CURSOR-APPL-1                          27607701
276076                                    TO TRUE                       27607801
276077         END-IF                                                   27607901
276078                                                                  27608001
276079         MOVE ASC-DTL-ELEM-VALUE (ASC-BLK-SUB, ASC-ITEM-SUB)      27608101
276080                                   TO  ASC-DTL-ELEM-TEXT          27608201
276081                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      27608301
276082         MOVE  'N'                 TO  ASC-DTL-ELEM-TEXT-NULL     27608401
276083                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      27608501
276084         MOVE  SPACES              TO  ASC-DTL-ELEM-TMST          27608601
276085                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      27608701
276086         MOVE  'Y'                 TO  ASC-DTL-ELEM-TMST-NULL     27608801
276087                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      27608901
276088         MOVE  ZEROES              TO  ASC-DTL-ELEM-NBR           27609001
276089                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      27609101
276090         MOVE  'Y'                 TO  ASC-DTL-ELEM-NBR-NULL      27609201
276091                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      27609301
276092     END-IF.                                                      27609401
280500                                                                  28050001
280600                                                                  28060001
280700******************************************************************28070001
280800** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **28080001
280900** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **28090001
281000** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**28100001
281100** THE ENDING.                                                  **28110001
281200******************************************************************28120001
281300 3310-EDIT-RANGE.                                                 28130001
281400     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                28140001
281500         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   28150001
281600             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)28160001
281700                                   TO ASC-SELECTED-SW             28170001
281800                                        (ASC-BLK-SUB ASC-ITEM-SUB)28180001
281900             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 28190001
282000         ELSE                                                     28200001
282100             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     28210001
282200                 CONTINUE                                         28220001
282300             ELSE                                                 28230001
282400*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        28240001
282500                 MOVE PC-TSYMSG-00054                             28250001
282600                                   TO DP020-MSG-NUMBER            28260001
282700                 SET DP020-MSG-FATAL                              28270001
282800                                   TO TRUE                        28280001
282900                 MOVE -1           TO MR-SELECTL (PV-SUB)         28290001
283000                 SET DP030-SET-CURSOR-APPL-1                      28300001
283100                                   TO TRUE                        28310001
283200                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         28320001
283300                 MOVE DP015-UNDERLINE                             28330001
283400                                   TO MR-SELECTH (PV-SUB)         28340001
283500                 SET PS-ERROR      TO TRUE                        28350001
283600             END-IF                                               28360001
283700         END-IF                                                   28370001
283800     ELSE                                                         28380001
283900         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     28390001
284000             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 28400001
284100                                   TO ASC-SELECTED-SW             28410001
284200                                     (ASC-BLK-SUB ASC-ITEM-SUB)   28420001
284300             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   28430001
284400         ELSE                                                     28440001
284500             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       28450001
284600                 CONTINUE                                         28460001
284700             ELSE                                                 28470001
284800*                -- ONLY ONE END-OF-RANGE ALLOWED --              28480001
284900                 MOVE PC-TSYMSG-00055                             28490001
285000                                   TO DP020-MSG-NUMBER            28500001
285100                 SET DP020-MSG-FATAL                              28510001
285200                                   TO TRUE                        28520001
285300                 MOVE -1           TO MR-SELECTL (PV-SUB)         28530001
285400                 SET DP030-SET-CURSOR-APPL-1                      28540001
285500                                   TO TRUE                        28550001
285600                 SET PS-ERROR      TO TRUE                        28560001
285700             END-IF                                               28570001
285800         END-IF                                                   28580001
285900     END-IF.                                                      28590001
286000                                                                  28600001
286010                                                                  28601001
286100******************************************************************28610001
286200** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **28620001
286300** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **28630001
286400******************************************************************28640001
286500 3400-CHECK-RANGE-SEQUENCE.                                       28650001
286600     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       28660001
286700       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      28670001
286800       AND  ASC-START-OF-SELECTED-RANGE >                         28680001
286900                                         ASC-END-OF-SELECTED-RANGE28690001
287000*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                28700001
287100         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 28710001
287200         SET DP020-MSG-FATAL TO TRUE                              28720001
287300         SET PS-ERROR TO TRUE                                     28730001
287400         PERFORM 3410-POSITION-AT-ERROR                           28740001
287500     END-IF.                                                      28750001
287510                                                                  28751001
287520                                                                  28752001
287600******************************************************************28760001
287700** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **28770001
287800** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **28780001
287900** SHOULD BE POSITIONED ON A RANGE ERROR.                       **28790001
288000******************************************************************28800001
288100 3410-POSITION-AT-ERROR.                                          28810001
288200     SET DP030-SET-CURSOR-APPL-1                                  28820001
288300                                   TO TRUE.                       28830001
288400     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 28840001
288500                    - PV-TOP-ITEM + 1.                            28850001
288600     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      28860001
288700         CONTINUE                                                 28870001
288800     ELSE                                                         28880001
288900         MOVE -1                   TO MR-SELECTL (PV-SUB)         28890001
289000         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         28900001
289100         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         28910001
289200     END-IF.                                                      28920001
289300                                                                  28930001
289400     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   28940001
289500                    - PV-TOP-ITEM + 1.                            28950001
289600     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      28960001
289700         CONTINUE                                                 28970001
289800     ELSE                                                         28980001
289900         MOVE -1                   TO MR-SELECTL (PV-SUB)         28990001
290000         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         29000001
290100         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         29010001
290200     END-IF.                                                      29020001
290300                                                                  29030001
290310                                                                  29031001
290400*----------------------------------------------------------------*29040001
290500*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *29050001
290600*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *29060001
290700*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *29070001
290800*----------------------------------------------------------------*29080001
291000 3500-MARK-RANGE-AS-SELECTED.                                     29100001
291100     MOVE +1                       TO  ASC-BLK-SUB.               29110001
291200     PERFORM 3510-MARK-SELECTED-INDS                              29120001
291300         VARYING ASC-ITEM-SUB                                     29130001
291400         FROM 1 BY 1                                              29140001
291500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 29150001
291600                                                                  29160001
291700     ADD +1                        TO ASC-BLK-SUB.                29170001
291800     PERFORM 3510-MARK-SELECTED-INDS                              29180001
291900         VARYING ASC-ITEM-SUB                                     29190001
292000         FROM 1 BY 1                                              29200001
292100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 29210001
292200                                                                  29220001
292300     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               29230001
292400                                   TO  PV-LIST-ITEM-NUMBER.       29240001
292500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            29250001
292600         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         29260001
292700               PC-ITEMS-PER-PANEL).                               29270001
292800                                                                  29280001
292900     MOVE ASC-START-OF-SELECTED-RANGE                             29290001
293000                                   TO PV-START-OF-SELECTED-RANGE. 29300001
293100     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            29310001
293200         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  29320001
293300               PC-ITEMS-PER-PANEL).                               29330001
293400                                                                  29340001
293500     MOVE ASC-END-OF-SELECTED-RANGE                               29350001
293600                                   TO  PV-END-OF-SELECTED-RANGE.  29360001
293700     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             29370001
293800         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    29380001
293900               PC-ITEMS-PER-PANEL).                               29390001
294000     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             29400001
294100         PV-FIRST-BLOCK-IN-ARRAY + 1.                             29410001
294200                                                                  29420001
294300     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    29430001
294400        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        29440001
294500         MOVE +1                   TO ASC-BLK-SUB                 29450001
294600         PERFORM 5100-WRITE-TEMP-STORAGE                          29460001
294700         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         29470001
294800             PV-FIRST-BLOCK-IN-ARRAY - 1                          29480001
294900                                                                  29490001
295000         PERFORM                                                  29500001
295100             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      29510001
295200                   PV-PREV-BLOCK-IN-ARRAY                         29520001
295300             MOVE PV-FIRST-BLOCK-IN-RANGE                         29530001
295400                                   TO PV-BLOCK-NUMBER             29540001
295500             PERFORM 4410-READ-TEMP-STORAGE                       29550001
295600             PERFORM 3510-MARK-SELECTED-INDS                      29560001
295700                 VARYING ASC-ITEM-SUB                             29570001
295800                 FROM 1 BY 1                                      29580001
295900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          29590001
296000             PERFORM 5100-WRITE-TEMP-STORAGE                      29600001
296100             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     29610001
296200         END-PERFORM                                              29620001
296300                                                                  29630001
296400         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         29640001
296500             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     29650001
296600         PERFORM                                                  29660001
296700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       29670001
296800                   PV-LAST-BLOCK-IN-RANGE                         29680001
296900             MOVE PV-NEXT-BLOCK-IN-ARRAY                          29690001
297000                                   TO PV-BLOCK-NUMBER             29700001
297100             PERFORM 4410-READ-TEMP-STORAGE                       29710001
297200             PERFORM 3510-MARK-SELECTED-INDS                      29720001
297300                 VARYING ASC-ITEM-SUB                             29730001
297400                 FROM 1 BY 1                                      29740001
297500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          29750001
297600             PERFORM 5100-WRITE-TEMP-STORAGE                      29760001
297700             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      29770001
297800         END-PERFORM                                              29780001
297900                                                                  29790001
298000         MOVE PV-FIRST-BLOCK-IN-ARRAY                             29800001
298100                                   TO PV-BLOCK-NUMBER             29810001
298200         PERFORM 4410-READ-TEMP-STORAGE                           29820001
298300     END-IF.                                                      29830001
298400                                                                  29840001
298500     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 29850001
298600                                      ASC-END-OF-SELECTED-RANGE.  29860001
298700                                                                  29870001
298800                                                                  29880001
298900*----------------------------------------------------------------*29890001
299000* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *29900001
299100*----------------------------------------------------------------*29910001
299300 3510-MARK-SELECTED-INDS.                                         29930002
299400                                                                  29940002
299500     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         29950002
299600                                ASC-ITEM-SUB) >                   29960002
299700         ASC-START-OF-SELECTED-RANGE)                             29970002
299800     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         29980002
299900                                ASC-ITEM-SUB) =                   29990002
300000         ASC-START-OF-SELECTED-RANGE)                             30000002
300100                                                                  30010002
300200         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     30020002
300300                                    ASC-ITEM-SUB) <               30030002
300400             ASC-END-OF-SELECTED-RANGE)                           30040002
300500         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     30050002
300600                                    ASC-ITEM-SUB) =               30060002
300700             ASC-END-OF-SELECTED-RANGE)                           30070002
300800                                                                  30080002
300900             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          30090002
301000                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   30100002
301100                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   30110002
301200                               TO TRUE                            30120002
301300                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              30130002
301400                               TO TRUE                            30140002
301500                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    30150002
301600             END-IF                                               30160002
301700         END-IF                                                   30170002
301800     END-IF.                                                      30180002
301900                                                                  30190002
302000                                                                  30200002
330400*----------------------------------------------------------------*33040001
330500* PRINT LINE EDITS                                               *33050001
330600*----------------------------------------------------------------*33060001
330700*3640-PRINT-LINE-EDITS.                                           33070001
330800*                                                                 33080001
330900*    EVALUATE TRUE                                                33090001
331000*        WHEN ASC-NBR-STORES (ASC-BLK-SUB ASC-ITEM-SUB) > SPACES  33100001
331100*             CONTINUE                                            33110001
331200*                                                                 33120001
331300*        WHEN OTHER                                               33130001
331400*             SET PS-ERROR                                        33140001
331500*                 DP020-MSG-FATAL TO  TRUE                        33150001
331600*             MOVE PC-TSYMSG-02297        TO DP020-MSG-NUMBER     33160001
331700*             MOVE DP015-UNP-ALP-BRT-OFF  TO MR-SELECTA (PV-SUB)  33170001
331800*             MOVE DP015-RED              TO MR-SELECTC (PV-SUB)  33180001
331900*             MOVE DP015-REVERSE          TO MR-SELECTH (PV-SUB)  33190001
332000*             MOVE -1                     TO MR-SELECTL (PV-SUB)  33200001
332100*             SET DP030-SET-CURSOR-APPL-1 TO TRUE                 33210001
332200*                                                                 33220001
332300*    END-EVALUATE.                                                33230001
360500*----------------------------------------------------------------*36050001
360600*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *36060001
360700*    INITIALIZE ALL COUNTERS AND FLAGS.                          *36070001
360800*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *36080001
360900*    DISPLAY THE PANEL TO USER.                                  *36090001
361000*----------------------------------------------------------------*36100001
361200 4000-BUILD-INITIAL-PANEL.                                        36120003
361300                                                                  36130003
361400     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            36140003
361500                                 ASC-BLOCK-ENTRIES (2).           36150003
361600     MOVE +1                 TO ASC-BLK-SUB.                      36160003
361700     SET ASC-ITEMS-LEFT-ON-DB                                     36170003
361800                             TO TRUE.                             36180003
361900                                                                  36190003
362000     MOVE +0                 TO ASC-ITEM-SUB                      36200003
362100                                ASC-NUMBER-OF-ITEMS-READ          36210003
362200                                ASC-NUMBER-OF-SELECTED-ITEMS      36220003
362300                                ASC-HIGHEST-BLOCK-WRITTEN         36230003
362400                                ASC-START-OF-SELECTED-RANGE       36240003
362500                                ASC-END-OF-SELECTED-RANGE         36250003
362600                                ASC-ITEM-AT-TOP-OF-PANEL.         36260003
362700                                                                  36270003
362800     PERFORM 4100-PREPARE-CURSOR                                  36280003
362900                                                                  36290003
363000     PERFORM 4010-OPEN-CURSOR.                                    36300003
363100                                                                  36310003
363200     PERFORM 4300-READ-ITEMS-FROM-DB.                             36320003
363300                                                                  36330003
363400     PERFORM 4020-CLOSE-CURSOR.                                   36340003
363500                                                                  36350003
363600     MOVE +1                   TO  PV-TOP-ITEM.                   36360003
363700     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          36370003
363800         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    36380003
363900         SET DP020-MSG-FATAL   TO  TRUE                           36390003
364000         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               36400003
364100     ELSE                                                         36410003
364200         MOVE -1               TO MR-SELECTL (1)                  36420003
364300         SET DP030-SET-CURSOR-APPL-1                              36430003
364400                               TO TRUE                            36440003
364500         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     36450003
364600     END-IF.                                                      36460003
364700                                                                  36470003
364710                                                                  36471003
364800*----------------------------------------------------------------*36480001
364900* OPEN THE CURSOR                                                *36490003
365000*   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *36500001
365100*   WILL BE OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *36510001
365200*   USER.                                                        *36520001
365300*----------------------------------------------------------------*36530001
365500 4010-OPEN-CURSOR.                                                36550003
365600     PERFORM                                                      36560003
365700         WITH TEST AFTER                                          36570003
365800         VARYING PV-RETRY-COUNTER                                 36580003
365900         FROM 1 BY 1                                              36590003
366000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               36600003
366100                   OR (SQLCODE = ZERO))                           36610003
366200                                                                  36620003
366300              MOVE 'CURSOR:  ATTR-DEFN-CSR   '                    36630003
366400                                        TO DP013-MESSAGE-TEXT (2) 36640003
366500                                                                  36650003
366600              IF  ASC-ELEM-ADD                                    36660003
366700                  EXEC SQL                                        36670003
366710                       OPEN ATTR-ELEM-SEQ-ADD-CSR                 36671003
366720                  END-EXEC                                        36672003
366730              ELSE                                                36673003
366740                  EXEC SQL                                        36674003
366750                       OPEN ATTR-ELEM-SEQ-UPD-CSR                 36675003
366760                  END-EXEC                                        36676003
366770             END-IF                                               36677003
366800                                                                  36680003
367000         EVALUATE TRUE                                            36700003
367100             WHEN SQLCODE = ZERO                                  36710003
367200             WHEN SQLCODE = -904                                  36720003
367300             WHEN SQLCODE = -913                                  36730003
367400                 CONTINUE                                         36740003
367500             WHEN SQLWARN0 NOT = SPACES                           36750003
367600             WHEN SQLCODE < ZERO                                  36760003
367700             WHEN SQLCODE > ZERO                                  36770003
367800                 MOVE '4010-OPEN-CURSOR'                          36780003
367900                                   TO DP013-PARAGRAPH             36790003
368000                 MOVE 'OPEN ATTR-ELEM CURSOR - '                  36800003
368100                                   TO DP013-MESSAGE-TEXT (1)      36810003
368200                 MOVE SQLCA        TO DP013-SQLCA                 36820003
368300                 MOVE 'WST_ATTR_ELEM' TO DP013-DB2-TABLE-NAME (1) 36830003
368400                 SET DP013-DB2-ABEND                              36840003
368500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           36850003
368600                 PERFORM DP013-0000-PROCESS-ABEND                 36860003
368700         END-EVALUATE                                             36870003
368800     END-PERFORM.                                                 36880003
368900                                                                  36890003
369000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        36900003
369100         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             36910003
369200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   36920003
369300                                   TO DP013-MESSAGE-TEXT (1)      36930003
369400         MOVE SQLCA                TO DP013-SQLCA                 36940003
369500         MOVE 'WST_ATTR_DEFN'      TO DP013-DB2-TABLE-NAME (1)    36950003
369600         SET DP013-DB2-ABEND                                      36960003
369700             DP013-XCTL-DISPLAY-RESTART                           36970003
369800                                   TO TRUE                        36980003
369900         PERFORM DP013-0000-PROCESS-ABEND                         36990003
370000     END-IF.                                                      37000003
370100                                                                  37010003
370200                                                                  37020003
370300*----------------------------------------------------------------*37030001
370400* CLOSE THE CURSOR                                               *37040003
370500*   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *37050001
370600*   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *37060001
370700*   USER.                                                        *37070001
370800*----------------------------------------------------------------*37080001
371000 4020-CLOSE-CURSOR.                                               37100006
371100                                                                  37110003
371200     IF  ASC-ELEM-ADD                                             37120003
371300         EXEC SQL                                                 37130003
371400               CLOSE ATTR-ELEM-SEQ-ADD-CSR                        37140003
371500          END-EXEC                                                37150003
371510     ELSE                                                         37151003
371520         EXEC SQL                                                 37152003
371530               CLOSE ATTR-ELEM-SEQ-UPD-CSR                        37153003
371540          END-EXEC                                                37154003
371550     END-IF                                                       37155003
371600*                                                                 37160001
371700     EVALUATE TRUE                                                37170003
371800         WHEN SQLCODE = ZERO                                      37180003
371900             CONTINUE                                             37190003
372000         WHEN SQLWARN0 NOT = SPACES                               37200003
372100         WHEN SQLCODE < ZERO                                      37210003
372200         WHEN SQLCODE > ZERO                                      37220003
372300             MOVE '4020-CLOSE-CURSOR'                             37230003
372400                               TO DP013-PARAGRAPH                 37240003
372500             MOVE 'CLOSE ATTR_ELEM CURSOR '                       37250003
372600                                  TO DP013-MESSAGE-TEXT (1)       37260003
372700             MOVE SQLCA           TO DP013-SQLCA                  37270003
372800             MOVE 'WST_ATTR_ELEM' TO DP013-DB2-TABLE-NAME (1)     37280003
372900             SET DP013-DB2-ABEND                                  37290003
373000                 DP013-XCTL-DISPLAY-RESTART TO TRUE               37300003
373100             PERFORM DP013-0000-PROCESS-ABEND                     37310003
373200     END-EVALUATE.                                                37320003
373300                                                                  37330003
373400                                                                  37340003
373500*----------------------------------------------------------------*37350001
373600*    SET UP THE HOST VARIABLES.                                  *37360001
373700*----------------------------------------------------------------*37370001
373900 4100-PREPARE-CURSOR.                                             37390003
374000                                                                  37400003
374100     MOVE ASC-PARM-NAME        TO  DK-INTGRTN-TYP.                37410003
374200                                                                  37420003
374300     IF  ASC-ELEM-UPD                                             37430003
374400         MOVE ASC-ATTR-ELEM-SEQ TO DK-ATTR-ELEM-SEQ               37440003
374410         MOVE ASC-ATTR-DEFN-SEQ TO DK-ATTR-DEFN-SEQ               37441003
374420     END-IF.                                                      37442003
374430                                                                  37443003
374440                                                                  37444003
374500*----------------------------------------------------------------*37450001
374600*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *37460001
374700*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *37470001
374800*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *37480001
374900*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *37490001
375000*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *37500001
375100*                                                                *37510001
375200*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *37520001
375300*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *37530001
375400*    UPON INITIALIZATION.                                        *37540001
375500*----------------------------------------------------------------*37550001
375600 4300-READ-ITEMS-FROM-DB.                                         37560003
375700                                                                  37570003
375800     PERFORM                                                      37580003
375900         VARYING PV-READ-COUNT                                    37590003
376000         FROM 1 BY 1                                              37600003
376100         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    37610003
376200            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         37620003
376300                                                                  37630003
376400         PERFORM 4310-FETCH                                       37640003
376500                                                                  37650003
376600         IF  ASC-ITEMS-LEFT-ON-DB                                 37660003
376700             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                37670003
376800                 ADD +1            TO ASC-ITEM-SUB                37680003
376900             ELSE                                                 37690003
377000                 ADD +1            TO ASC-BLK-SUB                 37700003
377100                 MOVE +1           TO ASC-ITEM-SUB                37710003
377200                                                                  37720003
377300                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         37730003
377400                     MOVE +1       TO ASC-BLK-SUB                 37740003
377500                     SET ASC-BLOCK-MODIFIED (1)                   37750003
377600                                   TO TRUE                        37760003
377700                     PERFORM 5100-WRITE-TEMP-STORAGE              37770003
377800                     MOVE ASC-BLOCK-ENTRIES                       37780003
377900                               (PC-MAX-BLOCKS-IN-ARRAY)           37790003
378000                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 37800003
378100                     ADD +1        TO ASC-BLK-SUB                 37810003
378200                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   37820003
378300                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      37830003
378400                                   TO TRUE                        37840003
378500                 END-IF                                           37850003
378600             END-IF                                               37860003
378700             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    37870003
378800             MOVE ASC-NUMBER-OF-ITEMS-READ                        37880003
378900                                   TO ASC-LIST-ITEM-NUMBER        37890003
379000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  37900003
379100                                                                  37910003
379200             MOVE  SPACES          TO ASC-DTL-ELEM-TEXT           37920003
379300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37930003
379400                                      ASC-DTL-ELEM-TMST           37940003
379500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37950003
379600             MOVE  ZEROES          TO ASC-DTL-ELEM-NBR            37960003
379700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37970003
379900                                                                  37990003
380000             IF  ASC-ELEM-ADD                                     38000003
380100                 MOVE WST00009-ATTR-DEFN-SEQ-NBR                  38010003
380200                   TO  ASC-DTL-ATTR-DEFN-SEQ                      38020003
380300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 38030003
380400                 MOVE PV-NEXT-ELEM-SEQ-NBR                        38040003
380500                   TO  ASC-DTL-ATTR-ELEM-SEQ                      38050003
380600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 38060003
380700                  MOVE WST00009-ATTR-DEFN-DESC                    38070003
380800                    TO ASC-DTL-DEFN-DESCR                         38080003
380900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 38090003
381000                  MOVE WST00009-DATYP-CDE                         38100003
381100                    TO ASC-DTL-DATA-TYPE                          38110003
381200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 38120003
381300                                                                  38130003
381400                  EVALUATE  WST00009-DATYP-CDE                    38140003
381500                      WHEN  'STR'                                 38150003
381600                            MOVE  -1 TO  PV-NULL-ELEM-TMST        38160003
381700                            MOVE  -1 TO  PV-NULL-ELEM-NBR         38170003
381800                            MOVE   0 TO  PV-NULL-ELEM-TXT         38180003
381900                            MOVE  SPACES  TO ASC-DTL-ELEM-TEXT    38190003
382000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 38200003
382010                                            ASC-DTL-ELEM-VALUE    38201008
382020                                       (ASC-BLK-SUB ASC-ITEM-SUB) 38202008
382100                            MOVE  'N' TO ASC-DTL-ELEM-TEXT-NULL   38210003
382200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 38220003
382300                            MOVE  SPACES TO ASC-DTL-ELEM-TMST     38230003
382400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 38240003
382500                            MOVE  'Y'    TO ASC-DTL-ELEM-TMST-NULL38250003
382600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 38260003
382700                            MOVE  ZEROES TO ASC-DTL-ELEM-NBR      38270003
382800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 38280003
382810                                            ASC-DTL-ELEM-VALUE    38281008
382820                                       (ASC-BLK-SUB ASC-ITEM-SUB) 38282008
382900                            MOVE  'Y'    TO ASC-DTL-ELEM-NBR-NULL 38290003
383000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 38300003
383100                      WHEN  'NUM'                                 38310003
383200                            MOVE  -1 TO  PV-NULL-ELEM-TMST        38320003
383300                            MOVE   0 TO  PV-NULL-ELEM-NBR         38330003
383400                            MOVE  -1 TO  PV-NULL-ELEM-TXT         38340003
383500                            MOVE  SPACES  TO ASC-DTL-ELEM-TEXT    38350003
383600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 38360003
383700                            MOVE  'Y' TO ASC-DTL-ELEM-TEXT-NULL   38370003
383800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 38380003
383900                            MOVE  SPACES TO ASC-DTL-ELEM-TMST     38390003
384000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 38400003
384100                            MOVE  'Y'    TO ASC-DTL-ELEM-TMST-NULL38410003
384200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 38420003
384300                            MOVE  ZEROES TO ASC-DTL-ELEM-NBR      38430003
384400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 38440003
384410                                            ASC-DTL-ELEM-VALUE    38441008
384420                                       (ASC-BLK-SUB ASC-ITEM-SUB) 38442008
384500                            MOVE  'N'    TO ASC-DTL-ELEM-NBR-NULL 38450003
384600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 38460003
384700                      WHEN  'DTE'                                 38470003
384800                            MOVE   0  TO  PV-NULL-ELEM-TMST       38480003
384900                            MOVE  -1  TO  PV-NULL-ELEM-NBR        38490003
385000                            MOVE  -1  TO  PV-NULL-ELEM-TXT        38500003
385100                            MOVE  SPACES  TO ASC-DTL-ELEM-TEXT    38510003
385200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 38520003
385300                            MOVE  'Y' TO ASC-DTL-ELEM-TEXT-NULL   38530003
385400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 38540003
385500                            IF  PS-DATE-DEFN-FROM                 38550003
385600                                MOVE  DK-CURRENT-TIMESTAMP        38560003
385700                                         TO ASC-DTL-ELEM-TMST     38570003
385800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 38580003
385810                                            ASC-DTL-ELEM-VALUE    38581008
385820                                       (ASC-BLK-SUB ASC-ITEM-SUB) 38582008
385900                            ELSE                                  38590003
386000                                MOVE  PC-DEFAULT-TMST             38600003
386100                                         TO ASC-DTL-ELEM-TMST     38610003
386200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 38620003
386210                                            ASC-DTL-ELEM-VALUE    38621008
386220                                       (ASC-BLK-SUB ASC-ITEM-SUB) 38622008
386300                            END-IF                                38630003
386400                            MOVE  'N'    TO ASC-DTL-ELEM-TMST-NULL38640003
386500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 38650003
386600                            MOVE  ZEROES TO ASC-DTL-ELEM-NBR      38660003
386700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 38670003
386800                            MOVE  'Y'    TO ASC-DTL-ELEM-NBR-NULL 38680003
386900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 38690003
387000                  END-EVALUATE                                    38700003
387100             ELSE                                                 38710003
387200                 MOVE WST00010-ATTR-DEFN-SEQ-NBR                  38720003
387300                   TO  ASC-DTL-ATTR-DEFN-SEQ                      38730003
387400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 38740003
387500                 MOVE WST00010-ATTR-ELEM-SEQ-NBR                  38750003
387600                   TO  ASC-DTL-ATTR-ELEM-SEQ                      38760003
387700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 38770003
387800                  MOVE WST00009-ATTR-DEFN-DESC                    38780003
387900                    TO ASC-DTL-DEFN-DESCR                         38790003
388000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 38800003
388100                  MOVE WST00009-DATYP-CDE                         38810003
388200                    TO ASC-DTL-DATA-TYPE                          38820003
388300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 38830003
388400                                                                  38840003
388500                                                                  38850003
388600                  IF  PV-NULL-ELEM-TXT  =  -1                     38860003
388700                      MOVE SPACES         TO ASC-DTL-ELEM-TEXT    38870003
388800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 38880003
388900                      MOVE  'Y'         TO ASC-DTL-ELEM-TEXT-NULL 38890003
389000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 38900003
389100                  ELSE                                            38910003
389200                      MOVE  WS-ATTR-ELEM-TXT-TEXT                 38920003
389300                                             TO ASC-DTL-ELEM-TEXT 38930003
389400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 38940003
389500                  END-IF                                          38950003
389600                                                                  38960003
389700                  IF  PV-NULL-ELEM-TMST  =  -1                    38970003
389800                      MOVE  SPACES      TO ASC-DTL-ELEM-TMST      38980003
389900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 38990003
390000                      MOVE  'Y'         TO ASC-DTL-ELEM-TMST-NULL 39000003
390100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 39010003
390200                  ELSE                                            39020003
390300                      MOVE  WST00010-ATTR-ELEM-TMST               39030003
390400                                        TO ASC-DTL-ELEM-TMST      39040003
390500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 39050003
390600                  END-IF                                          39060003
390700                                                                  39070003
390800                  IF  PV-NULL-ELEM-NBR  =  -1                     39080003
390810                      MOVE  ZEROES      TO ASC-DTL-ELEM-NBR       39081003
390820                                       (ASC-BLK-SUB ASC-ITEM-SUB) 39082003
390830                      MOVE  'Y'         TO ASC-DTL-ELEM-NBR-NULL  39083003
390840                                       (ASC-BLK-SUB ASC-ITEM-SUB) 39084003
390850                  ELSE                                            39085003
390860                      MOVE  WST00010-ATTR-ELEM-NBR                39086003
390870                                        TO ASC-DTL-ELEM-NBR       39087003
390880                                       (ASC-BLK-SUB ASC-ITEM-SUB) 39088003
390890                  END-IF                                          39089003
390891                                                                  39089103
390892             END-IF                                               39089203
390893                                                                  39089303
390894         END-IF                                                   39089403
390895     END-PERFORM.                                                 39089503
391000                                                                  39100003
391100     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          39110003
391200         MOVE +1               TO ASC-BLK-SUB                     39120003
391300         PERFORM 5100-WRITE-TEMP-STORAGE                          39130003
391400         ADD +1                TO ASC-BLK-SUB                     39140003
391500         PERFORM 5100-WRITE-TEMP-STORAGE                          39150003
391600                                                                  39160003
391700         MOVE 1                TO ASC-BLK-SUB                     39170003
391800                                  PV-BLOCK-NUMBER                 39180003
391900         PERFORM 4410-READ-TEMP-STORAGE                           39190003
392000         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             39200003
392100             MOVE 2            TO ASC-BLK-SUB                     39210003
392200                                  PV-BLOCK-NUMBER                 39220003
392300             PERFORM 4410-READ-TEMP-STORAGE                       39230003
392400         END-IF                                                   39240003
392500     END-IF.                                                      39250003
392600                                                                  39260003
392610                                                                  39261003
392700*----------------------------------------------------------------*39270001
392800*    FETCH THE CURSOR                                            *39280003
392900*----------------------------------------------------------------*39290001
393100 4310-FETCH.                                                      39310003
393200                                                                  39320003
393300     MOVE  SPACES  TO  PV-ELEM-TXT-WORK                           39330003
393400                                                                  39340003
393500     IF  ASC-ELEM-ADD                                             39350003
393600         EXEC SQL                                                 39360003
393700              FETCH ATTR-ELEM-SEQ-ADD-CSR                         39370003
393800               INTO                                               39380003
393900                    :WST00009-INTGRTN-TYP-CDE                     39390003
394000                  , :WST00009-ATTR-DEFN-SEQ-NBR                   39400003
394100                  , :WST00009-ATTR-DEFN-DESC                      39410003
394200                  , :WST00009-REQR-IND                            39420003
394300                  , :WST00009-DATYP-CDE                           39430003
394310                  , :WST00009-MAX-LEN-QTY                         39431003
394320                  , :WST00009-MAX-PCSN-QTY                        39432003
394330         END-EXEC                                                 39433003
394340     ELSE                                                         39434003
394350         EXEC SQL                                                 39435003
394360              FETCH ATTR-ELEM-SEQ-UPD-CSR                         39436003
394370               INTO                                               39437003
394380                    :WST00010-INTGRTN-TYP-CDE                     39438003
394390                  , :WST00010-ATTR-DEFN-SEQ-NBR                   39439003
394391                  , :WST00010-ATTR-ELEM-SEQ-NBR                   39439103
394392                  , :PV-ELEM-TXT-WORK        :PV-NULL-ELEM-TXT    39439203
394393                  , :WST00010-ATTR-ELEM-TMST :PV-NULL-ELEM-TMST   39439303
394394                  , :WST00010-ATTR-ELEM-NBR  :PV-NULL-ELEM-NBR    39439403
394395                  , :WST00009-DATYP-CDE                           39439503
394396                  , :WST00009-ATTR-DEFN-DESC                      39439603
394397         END-EXEC                                                 39439703
394398     END-IF.                                                      39439803
394399                                                                  39439903
394500     EVALUATE TRUE                                                39450003
394600         WHEN SQLCODE = ZERO                                      39460003
394700              IF  ASC-ELEM-ADD  AND                               39470003
394800                  WST00009-DATYP-CDE =  'DTE'                     39480003
394900                  PERFORM 4330-DETERMINE-FROM-TO                  39490003
394910              END-IF                                              39491003
394920              CONTINUE                                            39492003
394930                                                                  39493003
395000         WHEN SQLCODE = +100                                      39500003
395100              CONTINUE                                            39510003
395200                                                                  39520003
395400         WHEN SQLWARN0 NOT = SPACE                                39540003
395500         WHEN SQLCODE NOT = ZERO                                  39550003
395600              MOVE '4310-FETCH-CURSOR'                            39560003
395700                               TO DP013-PARAGRAPH                 39570003
395800              MOVE 'FETCH MESSAGE CURSOR'                         39580003
395900                               TO DP013-MESSAGE-TEXT (1)          39590003
396000              MOVE SQLCA       TO DP013-SQLCA                     39600003
396100              SET DP013-DB2-ABEND                                 39610003
396200                               TO TRUE                            39620003
396300              PERFORM DP013-0000-PROCESS-ABEND                    39630003
396400     END-EVALUATE.                                                39640003
396500                                                                  39650003
396600     IF  SQLCODE EQUAL +100                                       39660003
396700         SET ASC-NO-ITEMS-LEFT-ON-DB                              39670003
396800                                   TO TRUE                        39680003
396900     END-IF.                                                      39690003
397000                                                                  39700003
397100                                                                  39710003
397200*----------------------------------------------------------------*39720003
397300* COUNT THE NUMBER OF ROWS ON WST_ATTR_ELEM FOR THE PARM         *39730003
397400*----------------------------------------------------------------*39740003
397500 4320-GET-ELEM-COUNT.                                             39750003
397600                                                                  39760003
397700       EXEC SQL                                                   39770003
397800            SELECT COUNT(*)                                       39780003
397900              INTO :PV-WST00010-ELEM-COUNT                        39790003
398000              FROM WST_ATTR_ELEM                                  39800003
398100             WHERE INTGRTN_TYP_CDE   = :WST00009-INTGRTN-TYP-CDE  39810003
398200               AND ATTR_DEFN_SEQ_NBR = :WST00009-ATTR-DEFN-SEQ-NBR39820003
398300       END-EXEC.                                                  39830003
398400                                                                  39840003
398500                                                                  39850003
398600     EVALUATE TRUE                                                39860003
398700         WHEN SQLCODE = ZERO                                      39870003
398800              CONTINUE                                            39880003
398900                                                                  39890003
399000         WHEN SQLCODE = +100                                      39900003
399100              MOVE 0  TO  PV-WST00010-ELEM-COUNT                  39910003
399200                                                                  39920003
399300         WHEN SQLWARN0 NOT = SPACE                                39930003
399400         WHEN SQLCODE NOT = ZERO                                  39940003
399500              MOVE '4320-GET-ELEM-COUNT' TO DP013-PARAGRAPH       39950003
399600              MOVE 'COUNT # OF ELEM ROWS  '                       39960003
399700                               TO DP013-MESSAGE-TEXT (1)          39970003
399800              MOVE SQLCA       TO DP013-SQLCA                     39980003
399900              SET DP013-DB2-ABEND TO TRUE                         39990003
400000              PERFORM DP013-0000-PROCESS-ABEND                    40000003
400100     END-EVALUATE.                                                40010003
400200                                                                  40020003
400300                                                                  40030003
400400*----------------------------------------------------------------*40040003
400500* DETERINE IF THE DATE DEFINITION IS FROM/BEGIN OR TO/END  .     *40050003
400600*----------------------------------------------------------------*40060003
400700 4330-DETERMINE-FROM-TO.                                          40070003
400800                                                                  40080003
400900       EXEC SQL                                                   40090003
401000            SELECT 'F'                                            40100003
401100              INTO :PS-DATE-DEFINITION-FROM-TO-SW                 40110003
401200              FROM WST_ATTR_DEFN                                  40120003
401300             WHERE INTGRTN_TYP_CDE = :WST00009-INTGRTN-TYP-CDE    40130003
401400               AND ATTR_DEFN_SEQ_NBR                              40140003
401500                                   = :WST00009-ATTR-DEFN-SEQ-NBR  40150003
401600               AND (ATTR_DEFN_DESC LIKE '%FROM%'    OR            40160003
401700                    ATTR_DEFN_DESC LIKE '%BEGIN%'   OR            40170003
401800                    ATTR_DEFN_DESC LIKE '%START%'                 40180003
401900                   )                                              40190003
402000       END-EXEC.                                                  40200003
402100                                                                  40210003
402200                                                                  40220003
402300     EVALUATE TRUE                                                40230003
402400         WHEN SQLCODE = ZERO                                      40240003
402500              CONTINUE                                            40250003
402600                                                                  40260003
402700         WHEN SQLCODE = +100                                      40270003
402800              MOVE 'T'  TO  PS-DATE-DEFINITION-FROM-TO-SW         40280003
402900              MOVE ZEROES  TO  SQLCODE                            40290003
403000                                                                  40300003
403100         WHEN SQLWARN0 NOT = SPACE                                40310003
403200         WHEN SQLCODE NOT = ZERO                                  40320003
403300              MOVE '4330-DETERMINE-FROM-TO' TO DP013-PARAGRAPH    40330003
403400              MOVE 'DETERMINE IF FROM OR TO TMST'                 40340003
403500                               TO DP013-MESSAGE-TEXT (1)          40350003
403600              MOVE SQLCA       TO DP013-SQLCA                     40360003
403700              SET DP013-DB2-ABEND TO TRUE                         40370003
403800              PERFORM DP013-0000-PROCESS-ABEND                    40380003
403900     END-EVALUATE.                                                40390003
404000                                                                  40400003
404100                                                                  40410003
454700*----------------------------------------------------------------*45470001
454800* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *45480001
454900*----------------------------------------------------------------*45490001
455100 4400-MOVE-COMMAREA-TO-SCREEN.                                    45510003
455200     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             45520003
455300         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          45530003
455400         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          45540003
455500             MOVE +1    TO ASC-BLK-SUB                            45550003
455600             PERFORM 5100-WRITE-TEMP-STORAGE                      45560003
455700             ADD +1     TO ASC-BLK-SUB                            45570003
455800             PERFORM 5100-WRITE-TEMP-STORAGE                      45580003
455900             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             45590003
456000                 GIVING PV-BLOCK-NUMBER                           45600003
456100                 REMAINDER PV-REMAINDER                           45610003
456200             IF  PV-REMAINDER > ZERO                              45620003
456300                 ADD +1 TO PV-BLOCK-NUMBER                        45630003
456400             END-IF                                               45640003
456500             MOVE +1    TO ASC-BLK-SUB                            45650003
456600             PERFORM 4410-READ-TEMP-STORAGE                       45660003
456700             ADD +1     TO ASC-BLK-SUB                            45670003
456800                           PV-BLOCK-NUMBER                        45680003
456900             PERFORM 4410-READ-TEMP-STORAGE                       45690003
457000     END-IF.                                                      45700003
457100     MOVE +1            TO ASC-BLK-SUB.                           45710003
457200     COMPUTE ASC-ITEM-SUB =                                       45720003
457300         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              45730003
457400         + PC-ITEMS-PER-PANEL).                                   45740003
457500                                                                  45750003
457600     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        45760003
457700         ADD +1         TO ASC-BLK-SUB                            45770003
457800         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            45780003
457900     END-IF.                                                      45790003
458000                                                                  45800003
458100     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           45810003
458200         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                45820003
458300     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        45830003
458400     PERFORM 4420-FORMAT-LIST-LINES                               45840003
458500         VARYING PV-SUB                                           45850003
458600         FROM PC-ITEMS-PER-PANEL BY -1                            45860003
458700         UNTIL PV-SUB < +1.                                       45870003
458800                                                                  45880003
458900     COMPUTE ASC-ITEMS-DISPLAYED =                                45890003
459000         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          45900003
459100     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    45910003
459200                                      ASTRTITO.                   45920003
459300     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    45930003
459400     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    45940003
459500     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            45950003
459600                                   TO ASELITO.                    45960003
459700                                                                  45970003
459800     MOVE  ASC-PARM-NAME           TO APRMNMEO.                   45980003
459900     MOVE  ASC-PARM-DESC           TO APRMDSCO.                   45990003
460000                                                                  46000003
460100     MOVE  ASC-ATTR-ELEM-SEQ       TO AELMSEQO.                   46010003
460200*    MOVE  ASC-??????????          TO ATOTDEFO.                   46020003
460300                                                                  46030003
466000     IF  DP020-MSG-NUMBER-X = SPACE                               46600003
466100         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  46610003
466200*            --- MORE ITEMS TO DISPLAY ----                       46620003
466300             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            46630003
466400             SET DP020-MSG-INFORMATIONAL TO TRUE                  46640003
466500         END-IF                                                   46650003
466600     END-IF.                                                      46660003
466610                                                                  46661003
466620                                                                  46662003
466700*----------------------------------------------------------------*46670001
466800*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *46680001
466900*----------------------------------------------------------------*46690001
467100 4410-READ-TEMP-STORAGE.                                          46710003
467200                                                                  46720003
467300     EXEC CICS                                                    46730003
467400         READQ TS                                                 46740003
467500             QUEUE (ASC-LIST-QUEUE-NAME)                          46750003
467600             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               46760003
467700             ITEM  (PV-BLOCK-NUMBER)                              46770003
467800             RESP  (PV-CICS-RESP)                                 46780003
467900     END-EXEC.                                                    46790003
468000                                                                  46800003
468100     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       46810003
468200       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     46820003
468300         CONTINUE                                                 46830003
468400     ELSE                                                         46840003
468500         SET DP013-CICS-ABEND     TO TRUE                         46850003
468600         SET DP013-NO-ROLLBACK    TO TRUE                         46860003
468700         MOVE '4410-READ-TEMP-STORAGE'                            46870003
468800                                  TO DP013-PARAGRAPH              46880003
468900         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      46890003
469000                                  TO DP013-MESSAGE-TEXT(1)        46900003
469100         PERFORM DP013-0000-PROCESS-ABEND                         46910003
469200     END-IF.                                                      46920003
469300                                                                  46930003
469400     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             46940003
469500                                                                  46950003
469600     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         46960003
469700         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               46970003
469800     END-IF.                                                      46980003
469900                                                                  46990003
469910                                                                  46991003
470000*----------------------------------------------------------------*47000001
470100*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *47010001
470200*----------------------------------------------------------------*47020001
470400 4420-FORMAT-LIST-LINES.                                          47040003
470500     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      47050003
470600         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                47060003
470700         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           47070003
470710                                    MR-VALUEA  (PV-SUB)           47071007
470800         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           47080003
470810                                    MR-VALUEH  (PV-SUB)           47081007
470900         MOVE SPACES             TO MR-SELECTI      (PV-SUB)      47090003
471000                                    MR-ACTION       (PV-SUB)      47100003
471100                                    MR-DATYPE       (PV-SUB)      47110003
471200                                    MR-DADESC       (PV-SUB)      47120003
471300                                    MR-VALUE        (PV-SUB)      47130003
471400         MOVE ZEROES             TO MR-DEFSEQ       (PV-SUB)      47140003
472100     ELSE                                                         47210003
472200         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      47220003
472300                                                   > SPACE        47230003
472400             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 47240003
472500                                 TO MR-SELECTI (PV-SUB)           47250003
472600         ELSE                                                     47260003
472700             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      47270003
472800                                 TO MR-SELECTI (PV-SUB)           47280003
472900         END-IF                                                   47290003
473000                                                                  47300003
473100         IF  DP030-SET-CURSOR-TRAILER                             47310003
473200             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)47320003
473300                 > SPACE)                                         47330003
473400               OR (PV-SUB = 1))                                   47340003
473500                SET DP030-SET-CURSOR-APPL-1 TO TRUE               47350003
473600                MOVE -1          TO MR-SELECTL (PV-SUB)           47360003
473700             END-IF                                               47370003
473800         END-IF                                                   47380003
473900                                                                  47390003
473910         MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)               47391003
473920                                          TO MR-ACTION   (PV-SUB) 47392003
473930         MOVE ASC-DTL-ATTR-DEFN-SEQ (ASC-BLK-SUB ASC-ITEM-SUB)    47393003
473940                                          TO MR-DEFSEQ   (PV-SUB) 47394003
473950         MOVE ASC-DTL-DATA-TYPE     (ASC-BLK-SUB ASC-ITEM-SUB)    47395003
473960                                          TO MR-DATYPE   (PV-SUB) 47396003
473970         MOVE ASC-DTL-DEFN-DESCR    (ASC-BLK-SUB ASC-ITEM-SUB)    47397003
473980                                          TO MR-DADESC   (PV-SUB) 47398003
473990                                                                  47399003
473991         MOVE SPACES                      TO MR-VALUE    (PV-SUB) 47399103
473992                                                                  47399203
473993         IF   ASC-DTL-DATA-TYPE(ASC-BLK-SUB ASC-ITEM-SUB) = 'STR' 47399303
473994              MOVE  ASC-DTL-ELEM-TEXT (ASC-BLK-SUB ASC-ITEM-SUB)  47399403
473995                                          TO MR-VALUE    (PV-SUB) 47399503
473996         END-IF                                                   47399603
473997                                                                  47399703
473998         IF   ASC-DTL-DATA-TYPE(ASC-BLK-SUB ASC-ITEM-SUB) = 'NUM' 47399803
473999              MOVE  ASC-DTL-ELEM-NBR  (ASC-BLK-SUB ASC-ITEM-SUB)  47399903
474000                                          TO PV-DISP-ATTR-NBR     47400003
474001              MOVE  PV-DISP-ATTR-NBR      TO MR-VALUE    (PV-SUB) 47400103
474002         END-IF                                                   47400203
474003                                                                  47400303
474004         IF   ASC-DTL-DATA-TYPE(ASC-BLK-SUB ASC-ITEM-SUB) = 'DTE' 47400403
474005              MOVE  ASC-DTL-ELEM-TMST (ASC-BLK-SUB ASC-ITEM-SUB)  47400503
474006                                          TO MR-VALUE    (PV-SUB) 47400603
474007         END-IF                                                   47400703
474008                                                                  47400803
488500     END-IF.                                                      48850003
488600                                                                  48860003
488700                                                                  48870003
488800     SUBTRACT +1 FROM ASC-ITEM-SUB                                48880003
488900     IF  ASC-ITEM-SUB < + 1                                       48890003
489000         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  48900003
489100         MOVE +1                 TO ASC-BLK-SUB                   48910003
489110     END-IF.                                                      48911003
489200                                                                  48920003
489210                                                                  48921003
489300******************************************************************48930001
489400** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **48940001
489500** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **48950001
489600** ISSUE A WARNING.                                             **48960001
489700******************************************************************48970001
489800 4430-CHECK-FOR-BEGIN-AND-END.                                    48980003
489900     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       48990003
490000         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     49000003
490100*            -- NO END-OF-RANGE SPECFIED ---                      49010001
490200             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            49020003
490300             SET DP020-MSG-WARNING TO TRUE                        49030003
490400             PERFORM 4431-POSITION-AT-WARNING                     49040003
490500         END-IF                                                   49050003
490600     ELSE                                                         49060003
490700         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     49070003
490800*            -- NO BEGINNING-OF-RANGE SPECFIED ---                49080001
490900             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            49090003
491000             SET DP020-MSG-WARNING TO TRUE                        49100003
491100             PERFORM 4431-POSITION-AT-WARNING                     49110003
491200         END-IF                                                   49120003
491300     END-IF.                                                      49130003
491310                                                                  49131003
491320                                                                  49132003
491400******************************************************************49140001
491500** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **49150001
491600** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **49160001
491700** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **49170001
491800** POSITION THE CURSOR THERE.                                   **49180001
491900******************************************************************49190001
492000 4431-POSITION-AT-WARNING.                                        49200003
492100     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 49210003
492200                    - PV-TOP-ITEM + 1.                            49220003
492300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      49230003
492400         CONTINUE                                                 49240003
492500     ELSE                                                         49250003
492600         SET DP030-SET-CURSOR-APPL-1                              49260003
492700                                   TO TRUE                        49270003
492800         MOVE -1                   TO MR-SELECTL (PV-SUB)         49280003
492900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         49290003
493000         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         49300003
493100     END-IF.                                                      49310003
493200                                                                  49320003
493300     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   49330003
493400                    - PV-TOP-ITEM + 1.                            49340003
493500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      49350003
493600         CONTINUE                                                 49360003
493700     ELSE                                                         49370003
493800         SET DP030-SET-CURSOR-APPL-1                              49380003
493900                                   TO TRUE                        49390003
494000         MOVE -1                   TO MR-SELECTL (PV-SUB)         49400003
494100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         49410003
494200         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         49420003
494300     END-IF.                                                      49430003
494400                                                                  49440003
494500                                                                  49450003
521700*----------------------------------------------------------------*52170001
521800*  PROCESS PARM ADD                                              *52180003
521900*----------------------------------------------------------------*52190003
521910 4600-PROCESS-PARM-ADD.                                           52191003
522100                                                                  52210003
522200     MOVE +1                       TO ASC-BLK-SUB.                52220003
522300     PERFORM 5100-WRITE-TEMP-STORAGE.                             52230003
522400     ADD +1                        TO ASC-BLK-SUB.                52240003
522500     PERFORM 5100-WRITE-TEMP-STORAGE.                             52250003
522600                                                                  52260003
522700     PERFORM 6112-READ-LIST-QUEUE.                                52270003
522800                                                                  52280003
522900     SET  LQW-IDX  TO   1.                                        52290003
523000                                                                  52300003
523100     IF PS-NO-SOFT-ABORT-ERROR                                    52310003
523200       IF PV-CICS-RESP = DFHRESP (NORMAL)                         52320003
523300         PERFORM                                                  52330003
523400         VARYING LQW-IDX  FROM 1 BY 1                             52340003
523500         UNTIL   LQW-IDX > PC-ITEMS-PER-PANEL                     52350003
523600            OR   LQW-LIST-ITEM-NUMBER (LQW-IDX) = ZERO            52360003
523700            OR   PS-SOFT-ABORT-ERROR                              52370003
523800            OR   PS-ERROR                                         52380003
523900             IF  LQW-SELECT (LQW-IDX)                             52390003
524000                 PERFORM 4605-PROCESS-SELECTED-LINES              52400003
524100             END-IF                                               52410003
524200         END-PERFORM                                              52420003
524300       END-IF                                                     52430003
524400     END-IF.                                                      52440003
524410                                                                  52441012
524420     MOVE PV-ITEM      TO PV-SAVE-ITEM.                           52442012
524430     PERFORM 6111-WRITE-LIST-QUEUE.                               52443012
524440                                                                  52444012
524450     MOVE +1                     TO  ASC-BLK-SUB.                 52445012
524460     PERFORM 4410-READ-TEMP-STORAGE.                              52446012
524470                                                                  52447012
524480     ADD +1                      TO  ASC-BLK-SUB                  52448012
524490                                     PV-BLOCK-NUMBER.             52449012
524491                                                                  52449112
524492     PERFORM 4410-READ-TEMP-STORAGE.                              52449212
524493                                                                  52449312
525700                                                                  52570003
525800*----------------------------------------------------------------*52580001
525900*                                                                *52590001
526000*----------------------------------------------------------------*52600001
526100 4605-PROCESS-SELECTED-LINES.                                     52610003
526200                                                                  52620003
526300     PERFORM 4620-PROCESS-ADD                                     52630003
526400*                                                                 52640001
526500     IF  PS-NO-ERROR                                              52650003
526600         EVALUATE TRUE                                            52660003
526700             WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                52670003
526800                  SET DP020-MSG-INFORMATIONAL  TO  TRUE           52680003
526900                  MOVE PC-TSYMSG-00034  TO  DP020-MSG-NUMBER      52690003
527000         END-EVALUATE                                             52700003
527100     END-IF.                                                      52710003
527110                                                                  52711003
527300                                                                  52730003
527400*----------------------------------------------------------------*52740001
527500*                                                                *52750001
527600*                                                                *52760001
527700*----------------------------------------------------------------*52770001
527710 4620-PROCESS-ADD.                                                52771003
527720                                                                  52772003
527730     MOVE  -1  TO  PV-NULL-IND-1                                  52773003
527740                   PV-NULL-IND-2                                  52774003
527750                   PV-NULL-IND-3.                                 52775003
527760     INITIALIZE WST00010-ATTR-ELEM-TXT                            52776003
527770                WST00010-ATTR-ELEM-TMST                           52777003
527780                WST00010-ATTR-ELEM-NBR.                           52778003
527790                                                                  52779003
527800     MOVE  ASC-PARM-NAME                                          52780003
527900           TO WST00010-INTGRTN-TYP-CDE                            52790003
528000                                                                  52800003
528100     MOVE  LQW-DTL-ATTR-ELEM-SEQ  (LQW-IDX)                       52810003
528200           TO WST00010-ATTR-ELEM-SEQ-NBR                          52820003
528300                                                                  52830003
528400     MOVE  LQW-DTL-ATTR-DEFN-SEQ  (LQW-IDX)                       52840003
528500           TO WST00010-ATTR-DEFN-SEQ-NBR                          52850003
528600                                                                  52860003
528700     IF  LQW-DTL-DATA-TYPE (LQW-IDX)  =  'NUM'                    52870003
528800         MOVE  LQW-DTL-ELEM-NBR (LQW-IDX)                         52880003
528900           TO  WST00010-ATTR-ELEM-NBR                             52890003
529000         MOVE  0   TO  PV-NULL-IND-1                              52900003
529100     END-IF.                                                      52910003
529200                                                                  52920003
529300     IF  LQW-DTL-DATA-TYPE (LQW-IDX)  =  'STR'                    52930003
529400                                                                  52940003
529500         MOVE LENGTH OF LQW-DTL-ELEM-TEXT (LQW-IDX)               52950003
529600           TO  PV-TEXT-LEN                                        52960003
529700         MOVE LQW-DTL-ELEM-TEXT (LQW-IDX)                         52970003
529800           TO PV-TEXT-WORK                                        52980003
529900         PERFORM                                                  52990003
529910           UNTIL PV-TEXT-WORK(PV-TEXT-LEN:1) > SPACES             52991003
529920           COMPUTE PV-TEXT-LEN   = PV-TEXT-LEN - 1                52992003
529930         END-PERFORM                                              52993003
529940                                                                  52994003
529950         MOVE  LQW-DTL-ELEM-TEXT (LQW-IDX)                        52995003
529960           TO  WST00010-ATTR-ELEM-TXT-TEXT                        52996003
529970         MOVE  PV-TEXT-LEN                                        52997003
529980           TO  WST00010-ATTR-ELEM-TXT-LEN                         52998003
529990         MOVE  0   TO  PV-NULL-IND-2                              52999003
529991     END-IF.                                                      52999103
529992                                                                  52999203
529993     IF  LQW-DTL-DATA-TYPE (LQW-IDX)  =  'DTE'                    52999303
529994         MOVE  LQW-DTL-ELEM-TMST (LQW-IDX)                        52999403
529995           TO  WST00010-ATTR-ELEM-TMST                            52999503
529996         MOVE  0   TO  PV-NULL-IND-3                              52999603
529997     END-IF.                                                      52999703
529998                                                                  52999803
529999     PERFORM 4630-INSERT-ATTR-ELEM.                               52999903
530000                                                                  53000003
530010     IF  PS-NO-ERROR                                              53001003
530100         SET  LQW-DESELECT (LQW-IDX)                              53010003
530200              LQW-UPD (LQW-IDX)        TO  TRUE                   53020006
530300         SUBTRACT  1                                              53030003
530400             FROM  ASC-NUMBER-OF-SELECTED-ITEMS                   53040003
530500         MOVE LQW-SELECTED-SW (LQW-IDX)                           53050003
530600                              TO LQW-TEMP-SELECTED-SW (LQW-IDX)   53060003
530700     END-IF.                                                      53070003
530800                                                                  53080003
530900                                                                  53090003
531000*----------------------------------------------------------------*53100001
531100*                                                                *53110001
531200*----------------------------------------------------------------*53120001
531210 4630-INSERT-ATTR-ELEM.                                           53121003
531300                                                                  53130003
531400     EXEC SQL                                                     53140003
531500     INSERT INTO WST_ATTR_ELEM                                    53150003
531600           ( INTGRTN_TYP_CDE                                      53160003
531700           ,ATTR_DEFN_SEQ_NBR                                     53170003
531800           ,ATTR_ELEM_SEQ_NBR                                     53180003
531900           ,ATTR_ELEM_TXT                                         53190003
532000           ,ATTR_ELEM_TMST                                        53200003
532100           ,ATTR_ELEM_NBR                                         53210003
532200           )                                                      53220003
532300    VALUES (:WST00010-INTGRTN-TYP-CDE                             53230003
532400           ,:WST00010-ATTR-DEFN-SEQ-NBR                           53240003
532500           ,:WST00010-ATTR-ELEM-SEQ-NBR                           53250003
532600           ,:WST00010-ATTR-ELEM-TXT                               53260003
532700                :PV-NULL-IND-2                                    53270003
532800           ,:WST00010-ATTR-ELEM-TMST                              53280003
532900                :PV-NULL-IND-3                                    53290003
533000           ,:WST00010-ATTR-ELEM-NBR                               53300003
533100                :PV-NULL-IND-1                                    53310003
533200           )                                                      53320003
533300     END-EXEC.                                                    53330003
533400                                                                  53340003
533500        EVALUATE TRUE                                             53350003
533600            WHEN SQLCODE = +0                                     53360003
533700                 CONTINUE                                         53370003
533800                                                                  53380003
533900            WHEN SQLWARN0 NOT = SPACES                            53390003
534000            WHEN SQLCODE < +0                                     53400003
534100            WHEN SQLCODE > +0                                     53410003
534200                                                                  53420003
534300                MOVE WST00010-ATTR-DEFN-SEQ-NBR                   53430003
534400                     TO  PV-DISP-DEFN                             53440003
534500                MOVE WST00010-ATTR-ELEM-SEQ-NBR                   53450003
534600                     TO  PV-DISP-ELEM                             53460003
534700                MOVE WST00010-ATTR-ELEM-NBR                       53470003
534800                     TO  PV-DISP-ATTR-ELEM                        53480003
534900                MOVE '4630-INSERT-ATTR-ELEM'                      53490003
535000                                          TO DP013-PARAGRAPH      53500003
535100                MOVE 'INSERT NEW WST_ATTR_ELEM  '                 53510003
535200                                    TO DP013-MESSAGE-TEXT (1)     53520003
535300                                                                  53530003
535400                STRING  WST00010-INTGRTN-TYP-CDE '-'              53540003
535500                        PV-DISP-DEFN             '-'              53550003
535600                        PV-DISP-ELEM             '--'             53560003
535700                        'NBR:'  PV-DISP-ATTR-ELEM ' '             53570003
535800                        'TMST:' WST00010-ATTR-ELEM-TMST           53580003
535900                                       DELIMITED BY SIZE          53590003
536000                                  INTO DP013-MESSAGE-TEXT (2)     53600003
536100                                                                  53610003
536110                STRING  WST00010-ATTR-ELEM-TXT                    53611003
536120                                       DELIMITED BY SIZE          53612003
536130                                  INTO DP013-MESSAGE-TEXT (3)     53613003
536140                                                                  53614003
536150                MOVE SQLCA      TO DP013-SQLCA                    53615003
536160                MOVE 'WST00010' TO DP013-DB2-TABLE-NAME (1)       53616003
536170                SET DP013-DB2-ABEND                               53617003
536180                    DP013-XCTL-DISPLAY-RESTART TO TRUE            53618003
536190                PERFORM DP013-0000-PROCESS-ABEND                  53619003
536191        END-EVALUATE.                                             53619103
536192                                                                  53619203
536193                                                                  53619303
536194*----------------------------------------------------------------*53619403
536195*                                                                *53619503
536196*----------------------------------------------------------------*53619603
536197 4700-PROCESS-PARM-UPDATE.                                        53619703
536198                                                                  53619803
536199     MOVE +1                       TO ASC-BLK-SUB.                53619903
536200     PERFORM 5100-WRITE-TEMP-STORAGE.                             53620003
536300     ADD +1                        TO ASC-BLK-SUB.                53630003
536400     PERFORM 5100-WRITE-TEMP-STORAGE.                             53640003
536500                                                                  53650003
536600     PERFORM 6112-READ-LIST-QUEUE.                                53660003
536700                                                                  53670003
536800     SET  LQW-IDX  TO   1.                                        53680003
536900                                                                  53690003
537000     IF  PS-NO-SOFT-ABORT-ERROR                                   53700003
537100         IF  PV-CICS-RESP = DFHRESP (NORMAL)                      53710003
537200             PERFORM                                              53720003
537300             VARYING LQW-IDX  FROM 1 BY 1                         53730003
537400               UNTIL  LQW-IDX > PC-ITEMS-PER-PANEL                53740003
537410                  OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) = ZERO       53741003
537420                  OR  PS-SOFT-ABORT-ERROR                         53742003
537430                  OR  PS-ERROR                                    53743003
537440                      IF  LQW-SELECT (LQW-IDX) AND                53744003
537450                          PS-NO-ERROR                             53745003
537460                          PERFORM 4705-PROCESS-SELECTED-LINES     53746003
537470                          IF  PS-NO-ERROR                         53747003
537480                              SET  LQW-DESELECT (LQW-IDX)         53748003
537490                                   LQW-UPD (LQW-IDX) TO TRUE      53749003
537491                          END-IF                                  53749103
537492                      END-IF                                      53749203
537493             END-PERFORM                                          53749303
537494                                                                  53749403
537495             IF  PS-NO-ERROR                                      53749503
537496                  SET DP020-MSG-INFORMATIONAL  TO  TRUE           53749603
537497                  MOVE PC-TSYMSG-00059  TO  DP020-MSG-NUMBER      53749703
537498             END-IF                                               53749803
537499                                                                  53749903
537500         END-IF                                                   53750003
537501     END-IF.                                                      53750103
537502                                                                  53750203
537503     MOVE PV-ITEM      TO PV-SAVE-ITEM.                           53750303
537504     PERFORM 6111-WRITE-LIST-QUEUE.                               53750403
537505                                                                  53750503
537506     MOVE +1                     TO  ASC-BLK-SUB.                 53750603
537507     PERFORM 4410-READ-TEMP-STORAGE.                              53750703
537508                                                                  53750803
537509     ADD +1                      TO  ASC-BLK-SUB                  53750903
537510                                     PV-BLOCK-NUMBER.             53751003
537511                                                                  53751103
537512     PERFORM 4410-READ-TEMP-STORAGE.                              53751203
537513                                                                  53751303
537514                                                                  53751403
537515*----------------------------------------------------------------*53751503
537516* PROCESS UPDATE OF INTEGRATION PARM ELEMENT                     *53751603
537517*----------------------------------------------------------------*53751703
537518 4705-PROCESS-SELECTED-LINES.                                     53751803
537519                                                                  53751903
537520     PERFORM 4720-PROCESS-UPDATE                                  53752003
537521                                                                  53752103
537522     IF  PS-NO-ERROR                                              53752203
537523         EVALUATE TRUE                                            53752303
537524             WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                53752403
537525                  SET DP020-MSG-INFORMATIONAL  TO  TRUE           53752503
537526                  MOVE PC-TSYMSG-00059  TO  DP020-MSG-NUMBER      53752603
537527         END-EVALUATE                                             53752703
537528     END-IF.                                                      53752803
537529                                                                  53752903
537535*?   PERFORM 9100-READ-SEL-QUEUE.                                 53753503
537536*?       SET CN030-UPD (CN030-IDX)                                53753603
537537*?                            TO TRUE                             53753703
537538*?   PERFORM 9200-REWRITE-SEL-QUEUE.                              53753803
537539                                                                  53753903
537540                                                                  53754003
537541*----------------------------------------------------------------*53754103
537542*                                                                *53754203
537543*----------------------------------------------------------------*53754303
537544 4720-PROCESS-UPDATE.                                             53754403
537545                                                                  53754503
537546     MOVE  -1  TO  PV-NULL-IND-1                                  53754603
537547                   PV-NULL-IND-2                                  53754703
537548                   PV-NULL-IND-3.                                 53754803
537549                                                                  53754903
537550     INITIALIZE WST00010-ATTR-ELEM-TXT                            53755003
537551                WST00010-ATTR-ELEM-TMST                           53755103
537552                WST00010-ATTR-ELEM-NBR.                           53755203
537553                                                                  53755303
537554     MOVE  ASC-PARM-NAME                                          53755403
537555           TO WST00010-INTGRTN-TYP-CDE                            53755503
537556                                                                  53755603
537557     MOVE  LQW-DTL-ATTR-ELEM-SEQ  (LQW-IDX)                       53755703
537558           TO WST00010-ATTR-ELEM-SEQ-NBR                          53755803
537559                                                                  53755903
537560     MOVE  LQW-DTL-ATTR-DEFN-SEQ  (LQW-IDX)                       53756003
537561           TO WST00010-ATTR-DEFN-SEQ-NBR                          53756103
537562                                                                  53756203
537563     IF  LQW-DTL-DATA-TYPE (LQW-IDX)  =  'NUM'                    53756303
537564         MOVE  LQW-DTL-ELEM-NBR (LQW-IDX)                         53756403
537565           TO  WST00010-ATTR-ELEM-NBR                             53756503
537566         MOVE  0   TO  PV-NULL-IND-1                              53756603
537567     END-IF.                                                      53756703
537568                                                                  53756803
537569     IF  LQW-DTL-DATA-TYPE (LQW-IDX)  =  'STR'                    53756903
537570                                                                  53757003
537571         MOVE LENGTH OF LQW-DTL-ELEM-TEXT (LQW-IDX)               53757103
537572           TO  PV-TEXT-LEN                                        53757203
537573         MOVE LQW-DTL-ELEM-TEXT (LQW-IDX)                         53757303
537574           TO PV-TEXT-WORK                                        53757403
537575         PERFORM                                                  53757503
537576           UNTIL PV-TEXT-WORK(PV-TEXT-LEN:1) > SPACES             53757603
537577           COMPUTE PV-TEXT-LEN   = PV-TEXT-LEN - 1                53757703
537578         END-PERFORM                                              53757803
537579                                                                  53757903
537580         MOVE  LQW-DTL-ELEM-TEXT (LQW-IDX)                        53758003
537581           TO  WST00010-ATTR-ELEM-TXT-TEXT                        53758103
537582         MOVE  PV-TEXT-LEN                                        53758203
537583           TO  WST00010-ATTR-ELEM-TXT-LEN                         53758303
537584         MOVE  0   TO  PV-NULL-IND-2                              53758403
537585     END-IF.                                                      53758503
537586                                                                  53758603
537587     IF  LQW-DTL-DATA-TYPE (LQW-IDX)  =  'DTE'                    53758703
537588         MOVE  LQW-DTL-ELEM-TMST (LQW-IDX)                        53758803
537589           TO  WST00010-ATTR-ELEM-TMST                            53758903
537590         MOVE  0   TO  PV-NULL-IND-3                              53759003
537591     END-IF.                                                      53759103
537592                                                                  53759203
537593     PERFORM 4730-UPDATE-ATTR-ELEM.                               53759303
537594                                                                  53759403
537595                                                                  53759503
537596*----------------------------------------------------------------*53759603
537597*                                                                *53759703
537598*----------------------------------------------------------------*53759803
537599 4730-UPDATE-ATTR-ELEM.                                           53759903
537600                                                                  53760003
537601     EXEC SQL                                                     53760103
537602     UPDATE WST_ATTR_ELEM                                         53760203
537603        SET                                                       53760303
537604            ATTR_ELEM_TXT      =  :WST00010-ATTR-ELEM-TXT         53760403
537605                                  :PV-NULL-IND-2                  53760503
537606           ,ATTR_ELEM_TMST     =  :WST00010-ATTR-ELEM-TMST        53760603
537607                                  :PV-NULL-IND-3                  53760703
537608           ,ATTR_ELEM_NBR      =  :WST00010-ATTR-ELEM-NBR         53760803
537609                                  :PV-NULL-IND-1                  53760903
537610     WHERE  INTGRTN_TYP_CDE    =  :WST00010-INTGRTN-TYP-CDE       53761003
537611       AND  ATTR_DEFN_SEQ_NBR  =  :WST00010-ATTR-DEFN-SEQ-NBR     53761103
537612       AND  ATTR_ELEM_SEQ_NBR  =  :WST00010-ATTR-ELEM-SEQ-NBR     53761203
537613     END-EXEC.                                                    53761303
537614                                                                  53761403
537615        EVALUATE TRUE                                             53761503
537616            WHEN SQLCODE = +0                                     53761603
537617                 CONTINUE                                         53761703
537618                                                                  53761803
537619            WHEN SQLWARN0 NOT = SPACES                            53761903
537620            WHEN SQLCODE < +0                                     53762003
537621            WHEN SQLCODE > +0                                     53762103
537622                                                                  53762203
537623                MOVE WST00010-ATTR-DEFN-SEQ-NBR                   53762303
537624                     TO  PV-DISP-DEFN                             53762403
537625                MOVE WST00010-ATTR-ELEM-SEQ-NBR                   53762503
537626                     TO  PV-DISP-ELEM                             53762603
537627                MOVE WST00010-ATTR-ELEM-NBR                       53762703
537628                     TO  PV-DISP-ATTR-ELEM                        53762803
537629                MOVE '4730-UPDATE-ATTR-ELEM'                      53762903
537630                                          TO DP013-PARAGRAPH      53763003
537631                MOVE 'UPDATE WST_ATTR_ELEM  '                     53763103
537632                                    TO DP013-MESSAGE-TEXT (1)     53763203
537633                                                                  53763303
537634                STRING  WST00010-INTGRTN-TYP-CDE '-'              53763403
537635                        PV-DISP-DEFN             '-'              53763503
537636                        PV-DISP-ELEM             '--'             53763603
537637                        'NBR:'  PV-DISP-ATTR-ELEM ' '             53763703
537638                        'TMST:' WST00010-ATTR-ELEM-TMST           53763803
537639                                       DELIMITED BY SIZE          53763903
537640                                  INTO DP013-MESSAGE-TEXT (2)     53764003
537641                                                                  53764103
537642                STRING  WST00010-ATTR-ELEM-TXT                    53764203
537643                                       DELIMITED BY SIZE          53764303
537644                                  INTO DP013-MESSAGE-TEXT (3)     53764403
537645                                                                  53764503
537646                MOVE SQLCA      TO DP013-SQLCA                    53764603
537647                MOVE 'WST00010' TO DP013-DB2-TABLE-NAME (1)       53764703
537648                SET DP013-DB2-ABEND                               53764803
537649                    DP013-XCTL-DISPLAY-RESTART TO TRUE            53764903
537650                PERFORM DP013-0000-PROCESS-ABEND                  53765003
537651        END-EVALUATE.                                             53765103
537652                                                                  53765203
537653                                                                  53765303
585800*----------------------------------------------------------------*58580001
585900* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *58590001
586000* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *58600001
586100* FOR THE SELECTED ITEMS QUEUE.                                  *58610001
586200*                                                                *58620001
586300* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *58630001
586400* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *58640001
586500* THE ARRAY IS FULL.                                             *58650001
586600*----------------------------------------------------------------*58660001
586800 5000-PREPARE-SEL-QUEUE.                                          58680004
586900                                                                  58690004
587000     MOVE +1                   TO  ASC-BLK-SUB.                   58700004
587100     PERFORM 5100-WRITE-TEMP-STORAGE.                             58710004
587200     ADD +1                    TO  ASC-BLK-SUB.                   58720004
587300     PERFORM 5100-WRITE-TEMP-STORAGE.                             58730004
587400                                                                  58740004
587500     MOVE ASC-SEL-QUEUE-NAME-2 TO  ASC-SEL-QUEUE-NAME.            58750004
587600     MOVE ASC-SEL-QUEUE-NAME   TO  CN027-SEL-QUEUE-NAME.          58760004
587700     PERFORM 6010-DELETE-SEL-QUEUE.                               58770004
587800                                                                  58780004
587900     SET ASC-UPDATE-TSQ        TO  TRUE.                          58790004
588000                                                                  58800004
588100     SET CN028-IDX             TO  1.                             58810004
588200     MOVE ZERO                 TO CN027-NUMBER-OF-TS-ITEMS.       58820004
588300     INITIALIZE CN028-SELECTED-ITEM-ARRAY.                        58830004
588400                                                                  58840004
588500     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           58850004
588600             VARYING PV-ITEM                                      58860004
588700             FROM 1 BY 1                                          58870004
588800             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     58880004
588900                                                                  58890004
589000     IF  CN028-IDX > 1                                            58900004
589100         PERFORM 5205-WRITE-SEL-QUEUE                             58910004
589200         ADD +1                TO CN027-NUMBER-OF-TS-ITEMS        58920004
589300     END-IF.                                                      58930004
589400                                                                  58940004
589410                                                                  58941004
589500*----------------------------------------------------------------*58950001
589600*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *58960001
589700*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *58970001
589800*----------------------------------------------------------------*58980001
590000 5100-WRITE-TEMP-STORAGE.                                         59000004
590100     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     59010004
590200                                   TO PV-LIST-ITEM-NUMBER.        59020004
590300     COMPUTE PV-BLOCK-NUMBER =                                    59030004
590400         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    59040004
590500                                                                  59050004
590600     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             59060004
590700     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             59070004
590800         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      59080004
590900             PERFORM 5105-REWRITE-ASC-LISTQ                       59090004
591000         END-IF                                                   59100004
591100     ELSE                                                         59110004
591200         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       59120004
591300         ASC-HIGHEST-BLOCK-WRITTEN + 1                            59130004
591400         PERFORM 5110-WRITE-ASC-LISTQ                             59140004
591500         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   59150004
591600     END-IF.                                                      59160004
591700                                                                  59170004
591800     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             59180004
591810                                                                  59181004
591820                                                                  59182004
591900******************************************************************59190001
592000** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **59200001
592100** SPECIFIC COMMAREA.                                           **59210001
592200******************************************************************59220001
592300 5105-REWRITE-ASC-LISTQ.                                          59230004
592400     EXEC CICS                                                    59240004
592500         WRITEQ TS                                                59250004
592600             QUEUE (ASC-LIST-QUEUE-NAME)                          59260004
592700             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               59270004
592800             ITEM  (PV-BLOCK-NUMBER)                              59280004
592900             REWRITE                                              59290004
593000             RESP  (PV-CICS-RESP)                                 59300004
593100     END-EXEC.                                                    59310004
593200                                                                  59320004
593300     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           59330004
593400         CONTINUE                                                 59340004
593500     ELSE                                                         59350004
593600         SET DP013-CICS-ABEND            TO TRUE                  59360004
593700         SET DP013-NO-ROLLBACK           TO TRUE                  59370004
593800         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       59380004
593900         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     59390004
594000                                         TO DP013-MESSAGE-TEXT(1) 59400004
594100         PERFORM DP013-0000-PROCESS-ABEND                         59410004
594200     END-IF.                                                      59420004
594300                                                                  59430004
594310                                                                  59431004
594400******************************************************************59440001
594500** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **59450001
594600** SPECIFIC COMMAREA.                                           **59460001
594700******************************************************************59470001
594800 5110-WRITE-ASC-LISTQ.                                            59480004
594900     EXEC CICS                                                    59490004
595000         WRITEQ TS                                                59500004
595100             QUEUE (ASC-LIST-QUEUE-NAME)                          59510004
595200             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               59520004
595300             ITEM  (PV-BLOCK-NUMBER)                              59530004
595400             RESP  (PV-CICS-RESP)                                 59540004
595500     END-EXEC.                                                    59550004
595600     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      59560004
595700         SET DP013-CICS-ABEND      TO TRUE                        59570004
595800         SET DP013-NO-ROLLBACK     TO TRUE                        59580004
595900         MOVE '5110-WRITE-ASC-LISTQ'                              59590004
596000                                   TO DP013-PARAGRAPH             59600004
596100         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           59610004
596200                                   TO DP013-MESSAGE-TEXT(1)       59620004
596300         PERFORM DP013-0000-PROCESS-ABEND                         59630004
596400     END-IF.                                                      59640004
596500                                                                  59650004
596510                                                                  59651004
596600*----------------------------------------------------------------*59660001
596700* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *59670001
596800* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *59680001
596900*----------------------------------------------------------------*59690004
597100 5200-FILL-SEL-QUEUE-RECORD.                                      59710004
597200                                                                  59720004
597300     PERFORM 6112-READ-LIST-QUEUE.                                59730004
597400                                                                  59740004
597500     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       59750004
597600         PERFORM                                                  59760004
597700         VARYING LQW-IDX                                          59770004
597800         FROM 1 BY 1                                              59780004
597900         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            59790004
598000           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          59800004
598100                                                                  59810004
598200             IF  LQW-SELECT (LQW-IDX)                             59820004
598300                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              59830004
598400                                   TO CN028-ITEM (CN028-IDX)      59840004
598500                 MOVE SPACE        TO CN028-ACTION-SW (CN028-IDX) 59850004
598600                                                                  59860004
598700                                                                  59870004
598800                 MOVE  LQW-DTL-ATTR-ELEM-SEQ (LQW-IDX)            59880004
598900                            TO CN028-ELEM-SEQ       (CN030-IDX)   59890004
599000                 MOVE  LQW-DTL-ATTR-DEFN-SEQ (LQW-IDX)            59900004
599100                            TO CN028-DEFN-SEQ       (CN030-IDX)   59910004
599200                 MOVE  LQW-DTL-DATA-TYPE     (LQW-IDX)            59920004
599300                            TO CN028-DATA-TYPE      (CN030-IDX)   59930004
599400                 MOVE  LQW-DTL-ELEM-VALUE    (LQW-IDX)            59940004
599500                            TO CN028-ELEM-VALUE     (CN030-IDX)   59950004
599600                 MOVE  LQW-DTL-ELEM-TEXT     (LQW-IDX)            59960004
599700                            TO CN028-ELEM-TEXT      (CN030-IDX)   59970004
599800                 MOVE  LQW-DTL-ELEM-TEXT-NULL(LQW-IDX)            59980004
599900                            TO CN028-ELEM-TEXT-NULL (CN030-IDX)   59990004
600000                 MOVE  LQW-DTL-ELEM-TMST     (LQW-IDX)            60000004
600100                            TO CN028-ELEM-TMST      (CN030-IDX)   60010004
600200                 MOVE  LQW-DTL-ELEM-TMST-NULL(LQW-IDX)            60020004
600300                            TO CN028-ELEM-TMST-NULL (CN030-IDX)   60030004
600400                 MOVE  LQW-DTL-ELEM-NBR      (LQW-IDX)            60040004
600500                            TO CN028-ELEM-NBR       (CN030-IDX)   60050004
600600                 MOVE  LQW-DTL-ELEM-NBR-NULL (LQW-IDX)            60060004
600700                            TO CN028-ELEM-NBR-NULL  (CN030-IDX)   60070004
603900                                                                  60390004
604000                 SET CN028-IDX UP BY 1                            60400004
604100                 IF  CN028-IDX > CN028-MAX-ITEMS                  60410004
604200                     PERFORM 5205-WRITE-SEL-QUEUE                 60420004
604300                     ADD +1        TO CN027-NUMBER-OF-TS-ITEMS    60430004
604400                     INITIALIZE CN028-SELECTED-ITEM-ARRAY         60440004
604500                     SET CN028-IDX TO  1                          60450004
604600                 END-IF                                           60460004
604700             END-IF                                               60470004
604800         END-PERFORM                                              60480004
604900     END-IF.                                                      60490004
605000                                                                  60500004
605010                                                                  60501004
605100*----------------------------------------------------------------*60510001
605200*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *60520001
605300*----------------------------------------------------------------*60530001
605500 5205-WRITE-SEL-QUEUE.                                            60550004
605600                                                                  60560004
605700     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            60570004
605800                                   TO CN028-SELECTED-ITEMS.       60580004
605900                                                                  60590004
606000     EXEC CICS                                                    60600004
606100          WRITEQ TS                                               60610004
606200              QUEUE (ASC-SEL-QUEUE-NAME)                          60620004
606300              FROM  (CN028-SELECT-RECORD)                         60630004
606400              ITEM  (PV-SEL-QUEUE-ITEM)                           60640004
606500              RESP  (PV-CICS-RESP)                                60650004
606600     END-EXEC.                                                    60660004
606700                                                                  60670004
606800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          60680004
606900         CONTINUE                                                 60690004
607000     ELSE                                                         60700004
607100         SET DP013-CICS-ABEND      TO TRUE                        60710004
607200         SET DP013-NO-ROLLBACK     TO TRUE                        60720004
607300         MOVE '5205-WRITE-SEL-QUEUE'                              60730004
607400                                   TO DP013-PARAGRAPH             60740004
607500         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          60750004
607600                                   TO DP013-MESSAGE-TEXT(1)       60760004
607700         PERFORM DP013-0000-PROCESS-ABEND                         60770004
607800     END-IF.                                                      60780004
607900                                                                  60790004
607910                                                                  60791004
608000******************************************************************60800001
608100** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **60810001
608200** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **60820001
608300** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **60830001
608400** THE USER.                                                    **60840001
608500******************************************************************60850001
608600 6000-REFRESH-PANEL-FROM-TEMP.                                    60860004
608700     IF  ASC-UPDATE-TSQ                                           60870004
608800         SET ASC-NO-TSQ-UPDATE TO TRUE                            60880004
608900         MOVE ZERO                 TO PV-SAVE-ITEM                60890004
609000                                      PV-SEL-QUEUE-ITEM           60900004
609100         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        60910004
609200                                   TO PV-HOLD-SELECTED-ITEMS      60920004
609300         MOVE +1                   TO PV-ITEMS-PROCESSED          60930004
609400         PERFORM 6100-UPDATE-TSQ                                  60940004
609500             UNTIL PV-ITEMS-PROCESSED >                           60950004
609600                                     PV-HOLD-SELECTED-ITEMS       60960004
609700         INITIALIZE ASC-BLOCK-ENTRIES (1)                         60970004
609800                    ASC-BLOCK-ENTRIES (2)                         60980004
609900     END-IF.                                                      60990004
610000                                                                  61000004
610010                                                                  61001004
610100*----------------------------------------------------------------*61010001
610200*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *61020001
610300*----------------------------------------------------------------*61030001
610400 6010-DELETE-SEL-QUEUE.                                           61040004
610500                                                                  61050004
610600     EXEC CICS                                                    61060004
610700         DELETEQ TS                                               61070004
610800             QUEUE (ASC-SEL-QUEUE-NAME)                           61080004
610900             RESP  (PV-CICS-RESP)                                 61090004
611000     END-EXEC.                                                    61100004
611100                                                                  61110004
611200     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      61120004
611300        (PV-CICS-RESP = DFHRESP(QIDERR)))                         61130004
611400         CONTINUE                                                 61140004
611500     ELSE                                                         61150004
611600         SET DP013-CICS-ABEND TO TRUE                             61160004
611700         SET DP013-NO-ROLLBACK TO TRUE                            61170004
611800         MOVE '6010-DELETE-SEL-QUEUE'                             61180004
611900                        TO DP013-PARAGRAPH                        61190004
612000         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         61200004
612100                        TO DP013-MESSAGE-TEXT (1)                 61210004
612200         PERFORM DP013-0000-PROCESS-ABEND                         61220004
612300     END-IF.                                                      61230004
612400                                                                  61240004
612410                                                                  61241004
612500*----------------------------------------------------------------*61250001
612600*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *61260001
612700*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *61270001
612800*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *61280001
612900*    THE TEMP QUEUE.                                             *61290001
613000*----------------------------------------------------------------*61300001
613200 6100-UPDATE-TSQ.                                                 61320004
613300                                                                  61330004
613400     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             61340004
613500     PERFORM 6105-READ-SEL-QUEUE.                                 61350004
613600     PERFORM                                                      61360004
613700         VARYING CN028-IDX                                        61370004
613800         FROM 1 BY 1                                              61380004
613900         UNTIL ((PV-ITEMS-PROCESSED >                             61390004
614000                              PV-HOLD-SELECTED-ITEMS)             61400004
614100         OR (CN028-IDX GREATER THAN CN028-MAX-ITEMS))             61410004
614200         IF  CN028-ACTION-SW (CN028-IDX) > SPACE                  61420004
614300             PERFORM 6110-PROCESS-ITEMS                           61430004
614400         END-IF                                                   61440004
614500         ADD +1                TO PV-ITEMS-PROCESSED              61450004
614600     END-PERFORM.                                                 61460004
614700     PERFORM 6111-WRITE-LIST-QUEUE.                               61470004
614710                                                                  61471004
614720                                                                  61472004
614800*----------------------------------------------------------------*61480001
614900*    READ THE LIST QUEUE RECORD.                                 *61490001
615000*----------------------------------------------------------------*61500001
615200 6105-READ-SEL-QUEUE.                                             61520004
615300                                                                  61530004
615400     EXEC CICS                                                    61540004
615500          READQ TS                                                61550004
615600              QUEUE (ASC-SEL-QUEUE-NAME)                          61560004
615700              INTO  (CN028-SELECT-RECORD)                         61570004
615800              ITEM  (PV-SEL-QUEUE-ITEM)                           61580004
615900              RESP  (PV-CICS-RESP)                                61590004
616000     END-EXEC.                                                    61600004
616100                                                                  61610004
616200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          61620004
616300         CONTINUE                                                 61630004
616400     ELSE                                                         61640004
616500         SET DP013-CICS-ABEND      TO  TRUE                       61650004
616600         SET DP013-NO-ROLLBACK     TO  TRUE                       61660004
616700         MOVE '6105-READ-SEL-QUEUE'                               61670004
616800                                   TO  DP013-PARAGRAPH            61680004
616900         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           61690004
617000                                   TO  DP013-MESSAGE-TEXT(1)      61700004
617100         PERFORM DP013-0000-PROCESS-ABEND                         61710004
617200     END-IF.                                                      61720004
617300                                                                  61730004
617310                                                                  61731004
617400*----------------------------------------------------------------*61740001
617500*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*61750001
617600*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*61760001
617700*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *61770001
617800*----------------------------------------------------------------*61780001
618000 6110-PROCESS-ITEMS.                                              61800004
618100                                                                  61810004
618200     COMPUTE PV-ITEM = 1 + ((CN028-ITEM (CN028-IDX) - 1)          61820004
618300                     / PC-ITEMS-PER-PANEL).                       61830004
618400                                                                  61840004
618500     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           61850004
618600         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          61860004
618700             PERFORM 6111-WRITE-LIST-QUEUE                        61870004
618800         END-IF                                                   61880004
618900         MOVE PV-ITEM          TO PV-SAVE-ITEM                    61890004
619000                                                                  61900004
619100         PERFORM 6112-READ-LIST-QUEUE                             61910004
619200         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               61920004
619300             CONTINUE                                             61930004
619400         END-IF                                                   61940004
619500     END-IF.                                                      61950004
619600                                                                  61960004
619700     COMPUTE PV-SUB = (CN028-ITEM (CN028-IDX)                     61970004
619800                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              61980004
619900     SET LQW-DESELECT (PV-SUB) TO    TRUE                         61990004
620000     MOVE LQW-SELECTED-SW (PV-SUB)                                62000004
620100                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  62010004
620200     EVALUATE TRUE                                                62020004
620300         WHEN CN028-INQ (CN028-IDX)                               62030004
620400              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             62040004
620500                                                                  62050004
620600         WHEN CN028-UPD (CN028-IDX)                               62060004
620700              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             62070004
620800                                                                  62080004
620900         WHEN CN028-DEL (CN028-IDX)                               62090004
621000              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             62100004
621100                                                                  62110004
621200         WHEN CN028-ERR (CN028-IDX)                               62120004
621300              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             62130004
621400     END-EVALUATE.                                                62140004
621500                                                                  62150004
621600     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                62160004
621700                                                                  62170004
621710                                                                  62171004
621800*----------------------------------------------------------------*62180001
621900*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *62190001
622000*----------------------------------------------------------------*62200001
622200 6111-WRITE-LIST-QUEUE.                                           62220004
622300                                                                  62230004
622400     EXEC CICS                                                    62240004
622500         WRITEQ TS                                                62250004
622600             QUEUE (ASC-LIST-QUEUE-NAME)                          62260004
622700             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     62270004
622800             ITEM  (PV-SAVE-ITEM)                                 62280004
622900             REWRITE                                              62290004
623000             RESP  (PV-CICS-RESP)                                 62300004
623100     END-EXEC.                                                    62310004
623200                                                                  62320004
623300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          62330004
623400         CONTINUE                                                 62340004
623500     ELSE                                                         62350004
623600         SET DP013-CICS-ABEND  TO  TRUE                           62360004
623700         SET DP013-NO-ROLLBACK TO  TRUE                           62370004
623800         MOVE '6111-WRITE-LIST-QUEUE'                             62380004
623900                               TO  DP013-PARAGRAPH                62390004
624000         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  62400004
624100                               TO  DP013-MESSAGE-TEXT(1)          62410004
624200         PERFORM DP013-0000-PROCESS-ABEND                         62420004
624300     END-IF.                                                      62430004
624400                                                                  62440004
624500                                                                  62450004
624600*----------------------------------------------------------------*62460001
624700*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*62470001
624800*----------------------------------------------------------------*62480001
625000 6112-READ-LIST-QUEUE.                                            62500004
625100                                                                  62510004
625200     EXEC CICS                                                    62520004
625300         READQ TS                                                 62530004
625400             QUEUE (ASC-LIST-QUEUE-NAME)                          62540004
625500             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     62550004
625600             ITEM  (PV-ITEM)                                      62560004
625700             RESP  (PV-CICS-RESP)                                 62570004
625800     END-EXEC.                                                    62580004
625900                                                                  62590004
626000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          62600004
626100         CONTINUE                                                 62610004
626200     ELSE                                                         62620004
626300         SET DP013-CICS-ABEND        TO TRUE                      62630004
626400         SET DP013-NO-ROLLBACK       TO TRUE                      62640004
626500         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           62650004
626600         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    62660004
626700                                     TO DP013-MESSAGE-TEXT(1)     62670004
626800         PERFORM DP013-0000-PROCESS-ABEND                         62680004
626900     END-IF.                                                      62690004
627000                                                                  62700004
627100                                                                  62710004
627200*----------------------------------------------------------------*62720004
627300* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *62730001
627400*----------------------------------------------------------------*62740004
627500 9100-READ-SEL-QUEUE.                                             62750004
627600     EXEC CICS                                                    62760004
627700         READQ TS                                                 62770004
627800             QUEUE (ASC-SEL-QUEUE-NAME)                           62780004
627900             INTO  (CN028-SELECT-RECORD)                          62790004
628000             ITEM  (ASC-SEL-ITEM)                                 62800004
628100             RESP  (PV-CICS-RESP)                                 62810004
628200     END-EXEC.                                                    62820004
628300     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        62830004
628400         CONTINUE                                                 62840004
628500     ELSE                                                         62850004
628510         MOVE ASC-SEL-TASK-NUMBER  TO PV-DISP-TASK-NUMBER         62851023
628600         SET DP013-LOGIC-ABEND                                    62860004
628700             DP013-NO-ROLLBACK   TO   TRUE                        62870004
628800         MOVE '9100-READ-SEL-QUEUE'                               62880004
628900                                 TO   DP013-PARAGRAPH             62890004
629000         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   62900004
629100                                 TO   DP013-MESSAGE-TEXT (1)      62910004
629110         STRING 'ASC-SEL-QUEUE-NAME: '                            62911023
629120                 ASC-SEL-TERM-ID ':'                              62912023
629121                 PV-DISP-TASK-NUMBER ':'                          62912124
629130                 ASC-SEL-SEQ ':'                                  62913024
629140                                     DELIMITED BY SIZE            62914023
629150                                INTO DP013-MESSAGE-TEXT (2)       62915023
629200         PERFORM DP013-0000-PROCESS-ABEND                         62920004
629300     END-IF.                                                      62930004
629400                                                                  62940004
629500                                                                  62950004
629600*----------------------------------------------------------------*62960004
629700* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *62970001
629800*----------------------------------------------------------------*62980004
629900 9200-REWRITE-SEL-QUEUE.                                          62990004
630000                                                                  63000004
630100     EXEC CICS                                                    63010004
630200          WRITEQ TS                                               63020004
630300              QUEUE  (ASC-SEL-QUEUE-NAME)                         63030004
630400              FROM   (CN028-SELECT-RECORD)                        63040004
630500              ITEM   (ASC-SEL-ITEM)                               63050004
630600              RESP   (PV-CICS-RESP)                               63060004
630700              REWRITE                                             63070004
630800     END-EXEC.                                                    63080004
630900                                                                  63090004
631000     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   63100004
631100         SET DP013-CICS-ABEND                                     63110004
631200             DP013-NO-ROLLBACK     TO TRUE                        63120004
631300         MOVE '9200-REWRITE-SEL-QUEUE'                            63130004
631400                                   TO DP013-PARAGRAPH             63140004
631500         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   63150004
631600                                   TO DP013-MESSAGE-TEXT (1)      63160004
631700         PERFORM DP013-0000-PROCESS-ABEND                         63170004
631800     END-IF.                                                      63180004
631900                                                                  63190004
632000                                                                  63200004
632100*----------------------------------------------------------------*63210001
632200*    THE DB2 RESOURCE IS NOT AVAILABLE, DISPLAY A MESSAGE ON     *63220001
632300*    THE TERMINAL INDICATING THAT THE RESOURCE IS UNAVAILABLE.   *63230001
632400*----------------------------------------------------------------*63240001
632500 9900-SOFT-ABORT.                                                 63250004
632600                                                                  63260004
632700     EXEC CICS SYNCPOINT                                          63270004
632800          ROLLBACK                                                63280004
632900     END-EXEC.                                                    63290004
633000                                                                  63300004
633100     SET  PS-ERROR                                                63310004
633200          PS-SOFT-ABORT-ERROR                                     63320004
633300          DP020-MSG-FATAL       TO  TRUE.                         63330004
633400                                                                  63340004
633600                                                                  63360004
633700*----------------------------------------------------------------*63370001
633800*    ABEND PROCESSOR MODULE                                      *63380001
633900*----------------------------------------------------------------*63390001
634000                                                                  63400001
634100     COPY DPPD013.                                                63410001
