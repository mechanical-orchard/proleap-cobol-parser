000100*-----------------------*                                         00010002
000200 IDENTIFICATION DIVISION.                                         00020002
000300*-----------------------*                                         00030002
000400 PROGRAM-ID.    ETKCS344.                                         00040002
000500 AUTHOR.        TESS BESTE.                                       00050002
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060002
000700 DATE-WRITTEN.  02-27-95.                                         00070002
000800 DATE-COMPILED.                                                   00080002
000900                                                                  00090002
001000*-----------------------------------------------------------------00100002
001100*             E344 - EDI DOCS ON HOLD LIST                        00110002
001200*                                                                 00120002
001300*  THIS PROGRAM GENERATES A LIST OF EDI DOCUMENTS ON HOLD.        00130002
001400*                                                                 00140002
001500*  THE PROGRAM CAN BE ENTERED FROM THE EDI MENU OR FROM A CRITERIA00150002
001600*  SPEC SCREEN ON THE POMENU. IF ENTERED FROM THE EDI MENU, ALL   00160002
001700*  DOCUMENTS ON HOLD ARE DISPLAYED. IF ENTERED FROM THE CRITERIA  00170002
001800*  SPEC, ONLY CERTAIN DOCUMENTS ARE DISPLAYED BASED UPON THE      00180002
001900*  SELECTION CRITERIA.                                            00190002
002000*-----------------------------------------------------------------00200002
002010* 10/11/2021 GERMAN BANDA                    WR/IR #: CHG0262418* 00201004
002020*            - CHANGE CALL OF DPKUT100 TO                       * 00202004
002030*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00203004
002040*              MAKING THE CALL DYNAMIC VS STATIC                * 00204004
002050*                                                               * 00205004
002060*---------------------------------------------------------------* 00205105
CICS  *  CHANGED 10/28/2022    BY BARB SCHULTZ    WR: CHG0277210      * 00205205
CICS  *                                                               * 00205305
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL   * 00205405
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.    * 00205505
002050*                                                               * 00205605
002060*---------------------------------------------------------------* 00206004
002100                                                                  00210002
002200                                                                  00220002
002300                                                                  00230002
002400 ENVIRONMENT DIVISION.                                            00240002
002500                                                                  00250002
002600 DATA DIVISION.                                                   00260002
002700                                                                  00270002
002800 WORKING-STORAGE SECTION.                                         00280002
002900                                                                  00290002
003000 01  PC-PROGRAM-CONSTANTS.                                        00300002
003100     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00310002
003200                                                    'ET344A  '.   00320002
003300     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00330002
003400                                                    'ETKM344 '.   00340002
003500     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00350002
003600                                                    'ETKCS344'.   00360002
003700     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00370002
003800     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00380002
003900     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +12     00390002
004000                                                    COMP SYNC.    00400002
004100     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00410002
004200                                                    COMP SYNC.    00420002
004300     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00430002
004400                                                    +1000000      00440002
004500                                                    COMP-3.       00450002
004600     05  PC-ITEM-NUMBER-LENGTH          PIC S9(04)  VALUE +5      00460002
004700                                                    COMP SYNC.    00470002
004800     05  PC-RLSE-IND-NONE-RELEASED      PIC  X      VALUE 'N'.    00480002
004900     05  PC-RLSE-IND-SOME-RELEASED      PIC  X      VALUE 'P'.    00490002
005000     05  PC-RLSE-IND-DELETED            PIC  X      VALUE 'D'.    00500002
005100     05  PC-RLSE-IND-RELEASED           PIC  X      VALUE 'Y'.    00510002
005200     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00520002
005300     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00530002
005400     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00540002
005500     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00550002
005600     05  PC-REL                         PIC  X(03)  VALUE 'REL'.  00560002
005700     05  PC-OPERCO-NBR                  PIC  X(02)  VALUE '03'.   00570002
005800     05  PC-RSPLVL-CDE-BUYER            PIC  X(03)  VALUE 'BYR'.  00580002
005900     05  PC-MDSELV-CDE-DEPT             PIC  X(03)  VALUE 'DPT'.  00590002
006000     05  PC-CALENDAR-ROUTINE            PIC  X(08)  VALUE         00600002
006100                                                       'DPKUT500'.00610002
006200      05  PC-EMPTY-DATE                 PIC  X(10)  VALUE         00620002
006300                                                     '9999-09-09'.00630002
006400     05  PC-TSYMSG-NUMBERS.                                       00640002
006500         10  PC-TSYMSG-00004            PIC  9(05)  VALUE 00004.  00650002
006600         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00660002
006700         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00670002
006800         10  PC-TSYMSG-00016            PIC  9(05)  VALUE 00016.  00680002
006900         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00690002
007000         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00700002
007100         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00710002
007200         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00720002
007300         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00730002
007400         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00740002
007500         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00750002
007600         10  PC-TSYMSG-00059            PIC  9(05)  VALUE 00059.  00760002
007700         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00770002
007800         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00780002
007900         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00790002
008000         10  PC-TSYMSG-00115            PIC  9(05)  VALUE 00115.  00800002
008100         10  PC-TSYMSG-00148            PIC  9(05)  VALUE 00148.  00810002
008200         10  PC-TSYMSG-00149            PIC  9(05)  VALUE 00149.  00820002
008300         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00830002
008400         10  PC-TSYMSG-00551            PIC  9(05)  VALUE 00551.  00840002
008500         10  PC-TSYMSG-00660            PIC  9(05)  VALUE 00660.  00850002
008600                                                                  00860002
008700 01  PS-PROGRAM-SWITCHES.                                         00870002
008800     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00880002
008900         88  PS-NO-ERROR                            VALUE 'Y'.    00890002
009000         88  PS-ERROR                               VALUE 'N'.    00900002
009100     05  PS-START-ITEM-ERROR-SW         PIC  X(01)  VALUE 'Y'.    00910002
009200         88  PS-NO-START-ITEM-ERROR                 VALUE 'Y'.    00920002
009300         88  PS-START-ITEM-ERROR                    VALUE 'N'.    00930002
009400     05  PS-DELETES-SUCCESSFUL-SW       PIC  X.                   00940002
009500         88  PS-DELETES-SUCCESSFUL                  VALUE 'Y'.    00950002
009600         88  PS-DELETES-UNSUCCESSFUL                VALUE 'N'.    00960002
009700     05  PS-RELEASES-SUCCESSFUL-SW      PIC  X.                   00970002
009800         88  PS-RELEASES-SUCCESSFUL                 VALUE 'Y'.    00980002
009900         88  PS-RELEASES-UNSUCCESSFUL               VALUE 'N'.    00990002
010000                                                                  01000002
010100 01  PV-PROGRAM-VARIABLES.                                        01010002
010200     05  PV-SUB                         PIC S9(04)  VALUE +0      01020002
010300                                                    COMP SYNC.    01030002
010400     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01040002
010500                                                    COMP SYNC.    01050002
010600     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01060002
010700                                                    COMP-3.       01070002
010800     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01080002
010900                                                    COMP-3.       01090002
011000     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01100002
011100                                                    COMP-3.       01110002
011200     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01120002
011300                                                    COMP-3.       01130002
011400     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01140002
011500                                                    COMP-3.       01150002
011600     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01160002
011700                                                    COMP-3.       01170002
011800     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01180002
011900                                                    COMP-3.       01190002
012000     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01200002
012100                                                    COMP SYNC.    01210002
012200     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01220002
012300                                                    COMP SYNC.    01230002
012400     05  PV-ITEM                        PIC S9(04)  VALUE +0      01240002
012500                                                    COMP SYNC.    01250002
012600     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01260002
012700                                                    COMP SYNC.    01270002
012800     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01280002
012900                                                    COMP SYNC.    01290002
013000     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01300002
013100                                                    COMP SYNC.    01310002
013200     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01320002
013300                                                    COMP SYNC.    01330002
013400     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01340002
013500                                                    COMP SYNC.    01350002
013600     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01360002
013700                                                    COMP SYNC.    01370002
013800     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01380002
013900                                                    COMP SYNC.    01390002
014000     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01400002
014100                                                    COMP SYNC.    01410002
014200     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01420002
014300                                                    COMP SYNC.    01430002
014400     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01440002
014500                                                    COMP SYNC.    01450002
014600     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01460002
014700                                                    COMP SYNC.    01470002
014800     05  PV-DB2-TP-DKEY                 PIC S9(09)  COMP.         01480002
014900     05  PV-DB2-TP-DKEY-TMST            PIC  X(26).               01490002
015000                                                                  01500002
015100                                                                  01510002
015200*-----------------------------------------------------------------01520002
015300* THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE. THIS  01530002
015400* QUEUE MUST HAVE THE SAME LAYOUT AS 1 OCCURRENCE OF              01540002
015500* ASC-BLOCK-ENTRIES.                                              01550002
015600*-----------------------------------------------------------------01560002
015700                                                                  01570002
015800 01  LQW-LIST-QUEUE-WORK-AREA.                                    01580002
015900     05  LQW-BLOCK-MODIFIED             PIC  X      VALUE SPACE.  01590002
016000     05  LQW-ITEM-ENTRIES               OCCURS 12 TIMES           01600002
016100                                        INDEXED BY LQW-IDX.       01610002
016200         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01620002
016300         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01630002
016400         10  LQW-SELECTED-SW            PIC  X(01).               01640002
016500             88  LQW-SELECT                         VALUE 'S'.    01650002
016600             88  LQW-DESELECT                       VALUE ' '.    01660002
016700         10  LQW-ACTION                 PIC  X(03).               01670002
016800         10  LQW-DOCUMENT               PIC  X(25).               01680002
016900         10  LQW-VENDOR-NAME            PIC  X(10).               01690002
017000         10  LQW-TSET-NME-ID            PIC  X(03).               01700002
017100         10  LQW-HOLD-DATE              PIC  X(08).               01710002
017200         10  LQW-RELEASE-DATE           PIC  X(08).               01720002
017300         10  LQW-TP-DKEY                PIC S9(09)  COMP.         01730002
017400         10  LQW-TP-DKEY-TMST           PIC  X(26).               01740002
017500         10  LQW-TRN-SET-CDE            PIC  X(03).               01750002
017600                                                                  01760002
017700                                                                  01770002
017800*-----------------------------------------------------------------01780002
017900* RECORD LAYOUT FOR THE EDI DOCUMENTS ON HOLD SELECTED ITEMS TEMP 01790002
018000* STORAGE QUEUE.                                                  01800002
018100*-----------------------------------------------------------------01810002
018200                                                                  01820002
018300     COPY ETWS346.                                                01830002
018400                                                                  01840002
018500                                                                  01850002
018600*-----------------------------------------------------------------01860002
018700* MAP LAYOUT                                                      01870002
018800*-----------------------------------------------------------------01880002
018900                                                                  01890002
019000     COPY ETKM344.                                                01900002
019100*                                                                 01910002
019200 01  MR-OCCURS-LAYOUT                   REDEFINES  ET344AO.       01920002
019300     05  FILLER                         PIC X(42).                01930002
019400     05  MR-SCROLL-AREA                 OCCURS 12 TIMES.          01940002
019500         10  MR-SELECTL                 PIC S9(04) COMP.          01950002
019600         10  MR-SELECTA                 PIC  X(01).               01960002
019700         10  MR-SELECTC                 PIC  X(01).               01970002
019800         10  MR-SELECTH                 PIC  X(01).               01980002
019900         10  MR-SELECT                  PIC  X(01).               01990002
020000                                                                  02000002
020100         10  MR-ACTIONL                 PIC S9(04) COMP.          02010002
020200         10  MR-ACTIONA                 PIC  X(01).               02020002
020300         10  MR-ACTIONC                 PIC  X(01).               02030002
020400         10  MR-ACTIONH                 PIC  X(01).               02040002
020500         10  MR-ACTION                  PIC  X(03).               02050002
020600                                                                  02060002
020700         10  MR-DOCUMENTL               PIC S9(04) COMP.          02070002
020800         10  MR-DOCUMENTA               PIC  X(01).               02080002
020900         10  MR-DOCUMENTC               PIC  X(01).               02090002
021000         10  MR-DOCUMENTH               PIC  X(01).               02100002
021100         10  MR-DOCUMENT                PIC  X(25).               02110002
021200                                                                  02120002
021300         10  MR-VENDOR-NAMEL            PIC S9(04) COMP.          02130002
021400         10  MR-VENDOR-NAMEA            PIC  X(01).               02140002
021500         10  MR-VENDOR-NAMEC            PIC  X(01).               02150002
021600         10  MR-VENDOR-NAMEH            PIC  X(01).               02160002
021700         10  MR-VENDOR-NAME             PIC  X(10).               02170002
021800                                                                  02180002
021900         10  MR-EDI-DOCUMENTL           PIC S9(04) COMP.          02190002
022000         10  MR-EDI-DOCUMENTA           PIC  X(01).               02200002
022100         10  MR-EDI-DOCUMENTC           PIC  X(01).               02210002
022200         10  MR-EDI-DOCUMENTH           PIC  X(01).               02220002
022300         10  MR-EDI-DOCUMENT            PIC  X(03).               02230002
022400                                                                  02240002
022500         10  MR-HOLD-DATEL              PIC S9(04) COMP.          02250002
022600         10  MR-HOLD-DATEA              PIC  X(01).               02260002
022700         10  MR-HOLD-DATEC              PIC  X(01).               02270002
022800         10  MR-HOLD-DATEH              PIC  X(01).               02280002
022900         10  MR-HOLD-DATE               PIC  X(08).               02290002
023000                                                                  02300002
023100         10  MR-RELEASE-DATEL           PIC S9(04) COMP.          02310002
023200         10  MR-RELEASE-DATEA           PIC  X(01).               02320002
023300         10  MR-RELEASE-DATEC           PIC  X(01).               02330002
023400         10  MR-RELEASE-DATEH           PIC  X(01).               02340002
023500         10  MR-RELEASE-DATE            PIC  X(08).               02350002
023600                                                                  02360002
023700*-----------------------------------------------------------------02370002
023800* ATTRIBUTE SETTINGS COPYBOOK                                     02380002
023900*-----------------------------------------------------------------02390002
024000                                                                  02400002
024100     COPY DPWS015.                                                02410002
024200                                                                  02420002
024300*-----------------------------------------------------------------02430002
024400* FUNCTION KEYS COPYBOOK                                          02440002
024500*-----------------------------------------------------------------02450002
024600                                                                  02460002
024700     COPY DPWS016.                                                02470002
024800                                                                  02480002
024900*----------------------------------------------------------------*02490002
025000* COPYBOOK FOR CURRENT SYSTEM DATE/TIME PROCEDURE DIVISION ROUTINE02500002
025100*----------------------------------------------------------------*02510002
025200                                                                  02520002
025300     COPY DPWS017.                                                02530002
025400                                                                  02540002
025500*----------------------------------------------------------------*02550002
025600* COPYBOOK FOR CALENDAR SUBROUTINE (DPKUT500)                     02560002
025700*----------------------------------------------------------------*02570002
025800                                                                  02580002
025900     COPY DPWS500.                                                02590002
026000                                                                  02600002
026100*-----------------------------------------------------------------02610002
026200* NUMERIC EDIT LAYOUT                                             02620002
026300*-----------------------------------------------------------------02630002
026400                                                                  02640002
026500     COPY DPWS010I.                                               02650002
026600                                                                  02660002
026700*-----------------------------------------------------------------02670002
CICS  * PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.               02680005
026900*-----------------------------------------------------------------02690002
027000                                                                  02700002
027100     COPY DPWS030.                                                02710002
CICS       COPY DPWS930.                                                02711005
027200                                                                  02720002
027300*-----------------------------------------------------------------02730002
027400* STANDARD COMMAREA                                               02740002
027500*-----------------------------------------------------------------02750002
027600                                                                  02760002
027700     COPY DPWS020.                                                02770002
027800     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02780002
027900                                                                  02790002
028000*-----------------------------------------------------------------02800002
028100* THIS IS THE INTER-APPLICATION COMMAREA FOR THE EDI DOCUMENTS    02810002
028200* ON HOLD SCREENS.                                                02820002
028300*-----------------------------------------------------------------02830002
028400                                                                  02840002
028500         10  INTER-APPL-COMM-AREA       PIC X(200).               02850002
028600     COPY ETWS345.                                                02860002
028700*-----------------------------------------------------------------02870002
028800* THIS IS THE APPLICATION-SPECIFIC COMMAREA.                      02880002
028900*-----------------------------------------------------------------02890002
029000         10  ASC-SPECIFIC-COMMAREA.                               02900002
029100             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                02910002
029200                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  02920002
029300                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   02930002
029400                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   02940002
029500                                                                  02950002
029600                 20  ASC-ITEM-ARRAY.                              02960002
029700                     25  ASC-ITEM-ENTRIES OCCURS 12 TIMES.        02970002
029800                         30  ASC-LIST-ITEM-NUMBER                 02980002
029900                                                     PIC S9(09)   02990002
030000                                                     COMP-3.      03000002
030100                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03010002
030200                             88  ASC-VALID-SELECT    VALUE ' '    03020002
030300                                                           'S'    03030002
030400                                                           'B'    03040002
030500                                                           'E'.   03050002
030600                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03060002
030700                             88  ASC-TEMP-SELECT     VALUE 'S'.   03070002
030800                             88  ASC-TEMP-BEGIN      VALUE 'B'.   03080002
030900                             88  ASC-TEMP-END        VALUE 'E'.   03090002
031000                         30  ASC-SELECTED-SW         PIC  X(01).  03100002
031100                             88  ASC-NO-SELECT       VALUE ' '.   03110002
031200                             88  ASC-SELECT          VALUE 'S'.   03120002
031300                             88  ASC-BEGIN           VALUE 'B'.   03130002
031400                             88  ASC-END             VALUE 'E'.   03140002
031500                         30  ASC-ACTION              PIC  X(03).  03150002
031600                         30  ASC-DOCUMENT            PIC  X(25).  03160002
031700                         30  ASC-VENDOR-NAME         PIC  X(10).  03170002
031800                         30  ASC-TSET-NME-ID         PIC  X(03).  03180002
031900                             88  ASC-TSET-NME-ID-INV VALUE 'INV'. 03190002
032000                             88  ASC-TSET-NME-ID-ASN VALUE 'ASN'. 03200002
032100                             88  ASC-TSET-NME-ID-POA VALUE 'POA'. 03210002
032200                         30  ASC-HOLD-DATE.                       03220002
032300                             35  ASC-HOLD-DATE-MM    PIC  X(02).  03230002
032400                             35  ASC-HOLD-DATE-S1    PIC  X.      03240002
032500                             35  ASC-HOLD-DATE-DD    PIC  X(02).  03250002
032600                             35  ASC-HOLD-DATE-S2    PIC  X.      03260002
032700                             35  ASC-HOLD-DATE-YY    PIC  X(02).  03270002
032800                         30  ASC-RELEASE-DATE        PIC  X(08).  03280002
032900                         30  ASC-TP-DKEY             PIC S9(09)   03290002
033000                                                         COMP.    03300002
033100                         30  ASC-TP-DKEY-TMST        PIC  X(26).  03310002
033200                         30  ASC-TRN-SET-CDE         PIC  X(03).  03320002
033300                                                                  03330002
033400                                                                  03340002
033500             15  ASC-BLK-SUB                         PIC S9(04)   03350002
033600                                                          COMP    03360002
033700                                                          SYNC.   03370002
033800             15  ASC-ITEM-SUB                        PIC S9(04)   03380002
033900                                                          COMP    03390002
034000                                                          SYNC.   03400002
034100             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   03410002
034200                                                          COMP-3. 03420002
034300             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   03430002
034400                                                          COMP-3. 03440002
034500             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03450002
034600                                                          COMP-3. 03460002
034700             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   03470002
034800                                                          COMP-3. 03480002
034900             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03490002
035000                                                          COMP-3. 03500002
035100             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   03510002
035200                                                          COMP    03520002
035300                                                          SYNC.   03530002
035400             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03540002
035500                                                          COMP-3. 03550002
035600             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03560002
035700                                                          COMP-3. 03570002
035800             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03580002
035900                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   03590002
036000                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   03600002
036100             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  03610002
036200                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   03620002
036300                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   03630002
036400             15  ASC-LIST-QUEUE-NAME.                             03640002
036500                 20  ASC-LIST-TERM-ID                PIC  X(04).  03650002
036600                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   03660002
036700                                                          COMP-3. 03670002
036800                 20  ASC-LIST-SEQ                    PIC  9(01).  03680002
036900             15  ASC-SEL-QUEUE-NAME.                              03690002
037000                 20  ASC-SEL-TERM-ID                 PIC  X(04).  03700002
037100                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   03710002
037200                                                          COMP-3. 03720002
037300                 20  ASC-SEL-SEQ                     PIC  9(01).  03730002
037400                                                                  03740002
037500             15  ASC-CURSOR-SW                       PIC X.       03750002
037600                 88  ASC-ALL-DOCS-CSR                VALUE 'A'.   03760002
037700                 88  ASC-DEPT-CSR                    VALUE 'D'.   03770002
037800                 88  ASC-WORKER-CSR                  VALUE 'W'.   03780002
037900             15  ASC-INT-APPL-FORMAT-IND             PIC X.       03790002
038000                 88  ASC-INT-APPL-FORMAT-CRIT-SPEC   VALUE '1'.   03800002
038100                 88  ASC-INT-APPL-FORMAT-EDI-MENU    VALUE '3'.   03810002
038200             15  ASC-DELETE-PENDING-SW               PIC X.       03820002
038300                 88  ASC-DELETE-PENDING              VALUE 'Y'.   03830002
038400                 88  ASC-NO-DELETE-PENDING           VALUES 'N'   03840002
038500                                                            ' '.  03850002
038600             15  ASC-RELEASE-PENDING-SW              PIC X.       03860002
038700                 88  ASC-RELEASE-PENDING             VALUE 'Y'.   03870002
038800                 88  ASC-NO-RELEASE-PENDING          VALUES 'N'   03880002
038900                                                            ' '.  03890002
039000             15  ASC-INT-APPL-DEPT-NBR               PIC  X(03).  03900002
039100             15  ASC-INT-APPL-WORKER-NBR             PIC S9(06)   03910002
039200                                                     COMP-3.      03920002
039300                                                                  03930002
039400             15  ASC-START-ITEM-REQUEST.                          03940002
039500                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  03950002
039600         10  FILLER                     PIC  X(462).              03960002
039700                                                                  03970002
039800                                                                  03980002
039900*-----------------------------------------------------------------03990002
040000* ABEND PROCESSING COPYBOOK.                                      04000002
040100*-----------------------------------------------------------------04010002
040200                                                                  04020002
040300     COPY DPWS013.                                                04030002
040400                                                                  04040002
040500                                                                  04050002
040600*-----------------------------------------------------------------04060002
040700* DB2 AREA FOR FG/TSET XMIT HOLD TABLE                            04070002
040800*-----------------------------------------------------------------04080002
040900     EXEC SQL                                                     04090002
041000          INCLUDE TFGTRHL                                         04100002
041100     END-EXEC.                                                    04110002
041200                                                                  04120002
041300*-----------------------------------------------------------------04130002
041400* DB2 AREA FOR DOCUMENT P.O. HOLD TABLE                           04140002
041500*-----------------------------------------------------------------04150002
041600     EXEC SQL                                                     04160002
041700          INCLUDE TTRPOHL                                         04170002
041800     END-EXEC.                                                    04180002
041900                                                                  04190002
042000*-----------------------------------------------------------------04200002
042100* DB2 AREA FOR FG/TSET HELD DATA TABLE                            04210002
042200*-----------------------------------------------------------------04220002
042300     EXEC SQL                                                     04230002
042400          INCLUDE TFGTRDT                                         04240002
042500     END-EXEC.                                                    04250002
042600                                                                  04260002
042700*-----------------------------------------------------------------04270002
042800* DB2 AREA FOR ENTITY NAME TABLE                                  04280002
042900*-----------------------------------------------------------------04290002
043000     EXEC SQL                                                     04300002
043100          INCLUDE TENTNME                                         04310002
043200     END-EXEC.                                                    04320002
043300                                                                  04330002
043400*-----------------------------------------------------------------04340002
043500* DB2 AREA FOR TRANSACTION SET TABLE                              04350002
043600*-----------------------------------------------------------------04360002
043700     EXEC SQL                                                     04370002
043800          INCLUDE TTRNSET                                         04380002
043900     END-EXEC.                                                    04390002
044000                                                                  04400002
044100*-----------------------------------------------------------------04410002
044200* DB2 AREA FOR TRADING PARTNER TABLE                              04420002
044300*-----------------------------------------------------------------04430002
044400     EXEC SQL                                                     04440002
044500          INCLUDE TTRDPRT                                         04450002
044600     END-EXEC.                                                    04460002
044700                                                                  04470002
044800*-----------------------------------------------------------------04480002
044900* DB2 AREA FOR RESPONSIBLE AREA TABLE                             04490002
045000*-----------------------------------------------------------------04500002
045100     EXEC SQL                                                     04510002
045200          INCLUDE TRSPBAR                                         04520002
045300     END-EXEC.                                                    04530002
045400                                                                  04540002
045500*-----------------------------------------------------------------04550002
045600* DB2 AREA FOR MERCHANDISE AREA TABLE                             04560002
045700*-----------------------------------------------------------------04570002
045800     EXEC SQL                                                     04580002
045900          INCLUDE TMDSEAR                                         04590002
046000     END-EXEC.                                                    04600002
046100                                                                  04610002
046200*-----------------------------------------------------------------04620002
046300* DB2 AREA FOR COMMUNICATIONS                                     04630002
046400*-----------------------------------------------------------------04640002
046500     EXEC SQL                                                     04650002
046600          INCLUDE SQLCA                                           04660002
046700     END-EXEC.                                                    04670002
046800                                                                  04680002
046900*-----------------------------------------------------------------04690002
047000* CURSOR USED WHEN ENTERING FROM THE EDI MENU OR FROM THE         04700002
047100* CRITERIA SPEC SCREEN WITH NO CRITERIA ENTERED. DISPLAYS ALL     04710002
047200* DOCUMENTS ON HOLD.                                              04720002
047300*-----------------------------------------------------------------04730002
047400                                                                  04740002
047500     EXEC SQL                                                     04750002
047600         DECLARE  ALL-DOCS-CSR CURSOR FOR                         04760002
047700         SELECT   TFGTRHL.TRN_DTL_TXT                             04770002
047800                , TFGTRHL.HOLD_DTE                                04780002
047900                , TFGTRHL.TP_DKEY                                 04790002
048000                , TFGTRHL.TP_DKEY_TMST                            04800002
048100                , TFGTRHL.TRN_SET_CDE                             04810002
048200                , TENTNME.ENT_NAME_DESC                           04820002
048300                , TTRNSET.TRAN_SET_NME_ID                         04830002
048400         FROM     TFGTRHL                                         04840002
048500                , TENTNME                                         04850002
048600                , TTRNSET                                         04860002
048700                , TTRDPRT                                         04870002
048800         WHERE  (TFGTRHL.RLSE_IND    = :PC-RLSE-IND-NONE-RELEASED 04880002
048900           OR    TFGTRHL.RLSE_IND    = :PC-RLSE-IND-SOME-RELEASED)04890002
049000           AND   TTRDPRT.TP_DKEY     = TFGTRHL.TP_DKEY            04900002
049100           AND   TTRNSET.TRAN_SET_CDE = TFGTRHL.TRN_SET_CDE       04910002
049200           AND   TENTNME.ENT_ID      = TTRDPRT.ENT_ID             04920002
049300           AND   TENTNME.TYPE_CDE    = '04'                       04930002
049400         ORDER BY  TFGTRHL.TP_DKEY_TMST  DESC                     04940002
049500     END-EXEC.                                                    04950002
049600                                                                  04960002
049700*-----------------------------------------------------------------04970002
049800* CURSOR USED WHEN ENTERING FROM THE CRITERIA SPEC WITH A         04980002
049900* DEPARTMENT NUMBER. DISPLAYS ALL DOCUMENTS ON HOLD FOR THAT      04990002
050000* SPECIFIC DEPARTMENT.                                            05000002
050100*-----------------------------------------------------------------05010002
050200                                                                  05020002
050300     EXEC SQL                                                     05030002
050400         DECLARE DEPT-CSR CURSOR FOR                              05040002
050500         SELECT DISTINCT                                          05050002
050600                  TFGTRHL.TRN_DTL_TXT                             05060002
050700                , TFGTRHL.HOLD_DTE                                05070002
050800                , TFGTRHL.TP_DKEY                                 05080002
050900                , TFGTRHL.TP_DKEY_TMST                            05090002
051000                , TFGTRHL.TRN_SET_CDE                             05100002
051100                , TENTNME.ENT_NAME_DESC                           05110002
051200                , TTRNSET.TRAN_SET_NME_ID                         05120002
051300         FROM     TFGTRHL                                         05130002
051400                , TTRPOHL                                         05140002
051500                , TENTNME                                         05150002
051600                , TTRNSET                                         05160002
051700                , TTRDPRT                                         05170002
051800         WHERE    TTRPOHL.DEPT_NBR    = :ASC-INT-APPL-DEPT-NBR    05180002
051900           AND    TTRPOHL.PO_RLSE_IND = :PC-RLSE-IND-NONE-RELEASED05190002
052000           AND    TTRPOHL.TP_DKEY     = TFGTRHL.TP_DKEY           05200002
052100           AND    TTRPOHL.TP_DKEY_TMST = TFGTRHL.TP_DKEY_TMST     05210002
052200           AND    TTRDPRT.TP_DKEY      = TFGTRHL.TP_DKEY          05220002
052300           AND    TTRNSET.TRAN_SET_CDE = TFGTRHL.TRN_SET_CDE      05230002
052400           AND    TENTNME.ENT_ID       = TTRDPRT.ENT_ID           05240002
052500           AND    TENTNME.TYPE_CDE     = '04'                     05250002
052600         ORDER BY TFGTRHL.TP_DKEY_TMST  DESC                      05260002
052700     END-EXEC.                                                    05270002
052800                                                                  05280002
052900*-----------------------------------------------------------------05290002
053000* CURSOR USED WHEN ENTERING FROM THE CRITERIA SPEC WITH A         05300002
053100* WORKER NUMBER. DISPLAYS ALL DOCUMENTS ON HOLD FOR ANY OF THAT   05310002
053200* BUYER'S DEPARTMENTS.                                            05320002
053300*-----------------------------------------------------------------05330002
053400                                                                  05340002
053500     EXEC SQL                                                     05350002
053600         DECLARE WORKER-CSR CURSOR FOR                            05360002
053700         SELECT   DISTINCT                                        05370002
053800                  TFGTRHL.TRN_DTL_TXT                             05380002
053900                , TFGTRHL.HOLD_DTE                                05390002
054000                , TFGTRHL.TP_DKEY                                 05400002
054100                , TFGTRHL.TP_DKEY_TMST                            05410002
054200                , TFGTRHL.TRN_SET_CDE                             05420002
054300                , TENTNME.ENT_NAME_DESC                           05430002
054400                , TTRNSET.TRAN_SET_NME_ID                         05440002
054500         FROM     TFGTRHL                                         05450002
054600                , TTRPOHL                                         05460002
054700                , TENTNME                                         05470002
054800                , TTRNSET                                         05480002
054900                , TTRDPRT                                         05490002
055000                , TRSPBAR                                         05500002
055100                , TMDSEAR                                         05510002
055200         WHERE    TRSPBAR.WORKER_NBR   = :ASC-INT-APPL-WORKER-NBR 05520002
055300           AND    TRSPBAR.OPERCO_NBR   = :PC-OPERCO-NBR           05530002
055400           AND    TRSPBAR.RSPLVL_CDE   = :PC-RSPLVL-CDE-BUYER     05540002
055500           AND    CURRENT DATE BETWEEN TRSPBAR.WORKER_STRT_DTE    05550002
055600                                   AND TRSPBAR.WORKER_END_DTE     05560002
055700           AND    TMDSEAR.MDSEAR_DKEY  = TRSPBAR.MDSEAR_DKEY      05570002
055800           AND    TMDSEAR.MDSELV_CDE   = :PC-MDSELV-CDE-DEPT      05580002
055900           AND    CURRENT DATE BETWEEN TMDSEAR.STRT_DTE           05590002
056000                                   AND TMDSEAR.END_DTE            05600002
056100           AND    TTRPOHL.DEPT_NBR    = TMDSEAR.DEPT_NBR          05610002
056200           AND    TTRPOHL.PO_RLSE_IND = :PC-RLSE-IND-NONE-RELEASED05620002
056300           AND    TTRPOHL.TP_DKEY     = TFGTRHL.TP_DKEY           05630002
056400           AND    TTRPOHL.TP_DKEY_TMST = TFGTRHL.TP_DKEY_TMST     05640002
056500           AND    TTRDPRT.TP_DKEY      = TFGTRHL.TP_DKEY          05650002
056600           AND    TTRNSET.TRAN_SET_CDE = TFGTRHL.TRN_SET_CDE      05660002
056700           AND    TENTNME.ENT_ID       = TTRDPRT.ENT_ID           05670002
056800           AND    TENTNME.TYPE_CDE     = '04'                     05680002
056900         ORDER BY  TFGTRHL.TP_DKEY_TMST  DESC                     05690002
057000     END-EXEC.                                                    05700002
057100                                                                  05710002
057200                                                                  05720002
057300 LINKAGE SECTION.                                                 05730002
057400                                                                  05740002
057500 01  DFHCOMMAREA.                                                 05750002
057600     05  FILLER                         OCCURS  1 TO 4072 TIMES   05760002
057700                                        DEPENDING ON EIBCALEN.    05770002
057800         10  FILLER                     PIC X.                    05780002
057900                                                                  05790002
058000                                                                  05800002
058100 PROCEDURE DIVISION.                                              05810002
058200*-----------------------------------------------------------------05820002
058300* THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM.     05830002
058400* FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM      05840002
058500* PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT.     05850002
058600*-----------------------------------------------------------------05860002
058700                                                                  05870002
058800 0000-MAIN-MODULE.                                                05880002
058900                                                                  05890002
059000     INITIALIZE DP030-CICS-API-FIELDS.                            05900002
059100     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       05910002
059200     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          05920002
059300     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         05930002
059400     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       05940002
059500     MOVE LENGTH OF ET344AI        TO DP030-MAP-LENGTH (1).       05950002
059600     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05960002
059700     PERFORM 0001-CALL-CICS-ARCH-API.                             05970002
059800*                                                                 05980002
059900     PERFORM 1000-CONTROL-PROCESSING                              05990002
060000*                                                                 06000002
060100     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     06010002
060200     PERFORM 0001-CALL-CICS-ARCH-API.                             06020002
060300                                                                  06030002
060400                                                                  06040002
060500*-----------------------------------------------------------------06050002
060600* THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE       06060002
060700* AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.             06070002
060800*-----------------------------------------------------------------06080002
060900                                                                  06090002
061000 0001-CALL-CICS-ARCH-API.                                         06100002
061100                                                                  06110002
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      06120005
061300                           DFHCOMMAREA                            06130002
061400                           DP030-CICS-API-FIELDS                  06140002
061500                           DP020-STANDARD-COMMAREA                06150002
061600                           ET344AI.                               06160002
061700                                                                  06170002
061800     IF  DP030-RC-CALL-SUCCESSFUL                                 06180002
061900         CONTINUE                                                 06190002
062000     ELSE                                                         06200002
062100         SET DP013-NO-ROLLBACK                                    06210002
062200             DP013-XCTL-DISPLAY-RESTART                           06220002
062300             DP013-CICS-ABEND      TO TRUE                        06230002
062400         MOVE '0001-CALL-CICS-ARCH-API'                           06240002
062500                                   TO DP013-PARAGRAPH             06250002
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O06260005
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      06270005
062800         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      06280002
062900         PERFORM DP013-0000-PROCESS-ABEND                         06290002
063000     END-IF.                                                      06300002
063100                                                                  06310002
063200                                                                  06320002
063300*-----------------------------------------------------------------06330002
063400* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT       06340002
063500* COURSE OF ACTION IS FOR THIS TRANSACTION.                       06350002
063600*                                                                 06360002
063700* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE   06370002
063800*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS     06380002
063900*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS    06390002
064000*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS.  06400002
064100*-----------------------------------------------------------------06410002
064200                                                                  06420002
064300 1000-CONTROL-PROCESSING.                                         06430002
064400                                                                  06440002
064500     EVALUATE TRUE                                                06450002
064600         WHEN DP020-NEXT-ACT-INITIAL                              06460002
064700             INITIALIZE ASC-SPECIFIC-COMMAREA                     06470002
064800             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            06480002
064900                                      ASC-SEL-TERM-ID             06490002
065000             MOVE DP020-SRC-TASK-NUMBER                           06500002
065100                                   TO ASC-LIST-TASK-NUMBER        06510002
065200                                      ASC-SEL-TASK-NUMBER         06520002
065300             MOVE PC-LIST-QUEUE-SEQ                               06530002
065400                                   TO ASC-LIST-SEQ                06540002
065500             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 06550002
065600             PERFORM 1100-PROCESS-INTER-APPL-COMM                 06560002
065700             PERFORM 4000-BUILD-INITIAL-PANEL                     06570002
065800                                                                  06580002
065900         WHEN DP020-NEXT-ACT-READ-MAP                             06590002
066000             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06600002
066100                                   TO PV-TOP-ITEM                 06610002
066200             PERFORM 2000-PROCESS-PANEL                           06620002
066300                                                                  06630002
066400         WHEN DP020-NEXT-ACT-RETURN                               06640002
066500             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06650002
066600                                   TO PV-TOP-ITEM                 06660002
066700             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    06670002
066800             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 06680002
066900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06690002
067000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06700002
067100             IF ASC-DELETE-PENDING                                06710002
067200             OR ASC-RELEASE-PENDING                               06720002
067300                 PERFORM 3250-SET-ATTRIBUTES-TO-PROT              06730002
067400                 SET DP020-MSG-INFORMATIONAL TO TRUE              06740002
067500*                ---- PRESS PF2 TO CONFIRM REQUEST ----           06750002
067600                 MOVE PC-TSYMSG-00004  TO DP020-MSG-NUMBER        06760002
067700             END-IF                                               06770002
067800                                                                  06780002
067900         WHEN OTHER                                               06790002
068000             SET DP013-LOGIC-ABEND TO TRUE                        06800002
068100             SET DP013-NO-ROLLBACK TO TRUE                        06810002
068200             MOVE '1000-CONTROL-PROCESSING'                       06820002
068300                                   TO DP013-PARAGRAPH             06830002
068400             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    06840002
068500                                   TO DP013-MESSAGE-TEXT(1)       06850002
068600             PERFORM DP013-0000-PROCESS-ABEND                     06860002
068700     END-EVALUATE.                                                06870002
068800                                                                  06880002
068900                                                                  06890002
069000*-----------------------------------------------------------------06900002
069100* SAVE FIELDS FROM INTER-APPL COMMAREA.                           06910002
069200*-----------------------------------------------------------------06920002
069300                                                                  06930002
069400 1100-PROCESS-INTER-APPL-COMM.                                    06940002
069500                                                                  06950002
069600     MOVE SPACE                     TO ASC-START-ITEM-REQUEST.    06960002
069700     MOVE DP020-INT-APPL-FORMAT-IND TO ASC-INT-APPL-FORMAT-IND.   06970002
069800     IF ASC-INT-APPL-FORMAT-CRIT-SPEC                             06980002
069900         MOVE ET345-DEPT-NBR        TO ASC-INT-APPL-DEPT-NBR      06990002
070000         MOVE ET345-WORKER-NBR      TO ASC-INT-APPL-WORKER-NBR    07000002
070100     END-IF.                                                      07010002
070200                                                                  07020002
070300                                                                  07030002
070400*-----------------------------------------------------------------07040002
070500* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA    07050002
070600* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT    07060002
070700* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST   07070002
070800* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID       07080002
070900* FUNCTION KEYS CAN GET THIS FAR.                                 07090002
071000*-----------------------------------------------------------------07100002
071100                                                                  07110002
071200 2000-PROCESS-PANEL.                                              07120002
071300                                                                  07130002
071400     EVALUATE TRUE                                                07140002
071500         WHEN DP020-SRC-AID = DP016-CLEAR                         07150002
071600             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    07160002
071700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07170002
071800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07180002
071900             SET ASC-NO-DELETE-PENDING                            07190002
072000                 ASC-NO-RELEASE-PENDING TO TRUE                   07200002
072100                                                                  07210002
072200         WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                    07220002
072300             IF ASC-DELETE-PENDING                                07230002
072400                 PERFORM 7000-DELETE-SELECTED-DOCUMENTS           07240002
072500             ELSE                                                 07250002
072600                 IF ASC-RELEASE-PENDING                           07260002
072700                     PERFORM 7200-RLEASE-SELECTED-DOCUMENTS       07270002
072800                 ELSE                                             07280002
072900                     PERFORM 2200-MOVE-SCREEN-TO-COMMAREA         07290002
073000                     PERFORM 3000-EDIT-DATA-IN-COMMAREA           07300002
073100                     IF  PS-NO-ERROR                              07310002
073200                         SET DP020-MSG-FATAL TO TRUE              07320002
073300*                        ---- UPDATE MUST BE REQUESTED BEFORE ----07330002
073400*                        ---- CONFIRM                         ----07340002
073500                         MOVE PC-TSYMSG-00016  TO DP020-MSG-NUMBER07350002
073600                    END-IF                                        07360002
073700                 END-IF                                           07370002
073800             END-IF                                               07380002
073900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07390002
074000                                                                  07400002
074100         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    07410002
074200             PERFORM 2050-DELETE-LIST-QUEUE                       07420002
074300             PERFORM 4000-BUILD-INITIAL-PANEL                     07430002
074400             SET ASC-NO-DELETE-PENDING                            07440002
074500                 ASC-NO-RELEASE-PENDING TO TRUE                   07450002
074600                                                                  07460002
074700         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    07470002
074800             PERFORM 2140-DESELECT-ALL-ITEMS                      07480002
074900             PERFORM 3200-RESET-ATTRIBUTES                        07490002
075000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07500002
075100             SET ASC-NO-DELETE-PENDING                            07510002
075200                 ASC-NO-RELEASE-PENDING TO TRUE                   07520002
075300                                                                  07530002
075400         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  07540002
075500             PERFORM 2150-SELECT-ALL-ITEMS                        07550002
075600             PERFORM 3200-RESET-ATTRIBUTES                        07560002
075700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07570002
075800             SET ASC-NO-DELETE-PENDING                            07580002
075900                 ASC-NO-RELEASE-PENDING TO TRUE                   07590002
076000                                                                  07600002
076100         WHEN OTHER                                               07610002
076200             SET ASC-NO-DELETE-PENDING                            07620002
076300                 ASC-NO-RELEASE-PENDING TO TRUE                   07630002
076400             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 07640002
076500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07650002
076600             IF  PS-NO-ERROR                                      07660002
076700                 SET DP030-CONTINUE-GO TO TRUE                    07670002
076800                 PERFORM 2100-CHECK-FUNCTION-KEY                  07680002
076900             ELSE                                                 07690002
077000                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07700002
077100                 SET DP030-OVERRIDE-GO TO TRUE                    07710002
077200             END-IF                                               07720002
077300     END-EVALUATE.                                                07730002
077400                                                                  07740002
077500                                                                  07750002
077600*-----------------------------------------------------------------07760002
077700*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                      07770002
077800*-----------------------------------------------------------------07780002
077900                                                                  07790002
078000 2050-DELETE-LIST-QUEUE.                                          07800002
078100                                                                  07810002
078200     EXEC CICS                                                    07820002
078300         DELETEQ TS                                               07830002
078400             QUEUE (ASC-LIST-QUEUE-NAME)                          07840002
078500             RESP  (PV-CICS-RESP)                                 07850002
078600     END-EXEC.                                                    07860002
078700                                                                  07870002
078800     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       07880002
078900        (PV-CICS-RESP = DFHRESP(QIDERR))                          07890002
079000         CONTINUE                                                 07900002
079100     ELSE                                                         07910002
079200         SET DP013-CICS-ABEND      TO TRUE                        07920002
079300         SET DP013-NO-ROLLBACK     TO TRUE                        07930002
079400                                                                  07940002
079500         MOVE '2050-DELETE-LIST-QUEUE'                            07950002
079600                                   TO DP013-PARAGRAPH             07960002
079700         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    07970002
079800                                   TO DP013-MESSAGE-TEXT (1)      07980002
079900         PERFORM DP013-0000-PROCESS-ABEND                         07990002
080000     END-IF.                                                      08000002
080100                                                                  08010002
080200     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  08020002
080300                                                                  08030002
080400                                                                  08040002
080500*-----------------------------------------------------------------08050002
080600* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST. 08060002
080700* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE   08070002
080800* CICS ARCHITECTURE API.                                          08080002
080900*-----------------------------------------------------------------08090002
081000                                                                  08100002
081100 2100-CHECK-FUNCTION-KEY.                                         08110002
081200                                                                  08120002
081300     EVALUATE TRUE                                                08130002
081400         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  08140002
081500             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              08150002
081600                 INITIALIZE ET345-NUMBER-OF-TS-ITEMS              08160002
081700                            ET345-SEL-QUEUE-NAME                  08170002
081800                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                08180002
081900                                TO ET345-NUMBER-OF-SELECTED-ITEMS 08190002
082000                 PERFORM 5000-PREPARE-SEL-QUEUE                   08200002
082100             ELSE                                                 08210002
082200                 SET DP030-OVERRIDE-GO                            08220002
082300                                   TO TRUE                        08230002
082400*                ---- A LIST ITEM MUST BE SELECTED ----           08240002
082500                 MOVE PC-TSYMSG-00057                             08250002
082600                                   TO DP020-MSG-NUMBER            08260002
082700                 SET DP020-MSG-WARNING                            08270002
082800                                   TO TRUE                        08280002
082900                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08290002
083000             END-IF                                               08300002
083100                                                                  08310002
083200*        *--------------------------------------------------------08320002
083300*        * 'DELETE' FUNCTION KEY HIT                              08330002
083400*        *--------------------------------------------------------08340002
083500                                                                  08350002
083600         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              08360002
083700             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              08370002
083800                 SET ASC-NO-RELEASE-PENDING TO TRUE               08380002
083900                 SET ASC-DELETE-PENDING     TO TRUE               08390002
084000                 PERFORM 3250-SET-ATTRIBUTES-TO-PROT              08400002
084100                 SET DP020-MSG-INFORMATIONAL TO TRUE              08410002
084200*                ---- PRESS PF2 TO CONFIRM REQUEST ----           08420002
084300                 MOVE PC-TSYMSG-00004  TO DP020-MSG-NUMBER        08430002
084400             ELSE                                                 08440002
084500*                ---- A LIST ITEM MUST BE SELECTED ----           08450002
084600                 MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER        08460002
084700                 SET DP020-MSG-WARNING TO TRUE                    08470002
084800             END-IF                                               08480002
084900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08490002
085000                                                                  08500002
085100*        *--------------------------------------------------------08510002
085200*        * 'RELEASE' FUNCTION KEY HIT                             08520002
085300*        *--------------------------------------------------------08530002
085400                                                                  08540002
085500         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              08550002
085600             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              08560002
085700                 SET ASC-NO-DELETE-PENDING  TO TRUE               08570002
085800                 SET ASC-RELEASE-PENDING    TO TRUE               08580002
085900                 PERFORM 3250-SET-ATTRIBUTES-TO-PROT              08590002
086000                 SET DP020-MSG-INFORMATIONAL TO TRUE              08600002
086100*                ---- PRESS PF2 TO CONFIRM REQUEST ----           08610002
086200                 MOVE PC-TSYMSG-00004  TO DP020-MSG-NUMBER        08620002
086300             ELSE                                                 08630002
086400*                ---- A LIST ITEM MUST BE SELECTED ----           08640002
086500                 MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER        08650002
086600                 SET DP020-MSG-WARNING TO TRUE                    08660002
086700             END-IF                                               08670002
086800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08680002
086900                                                                  08690002
087000         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  08700002
087100             MOVE +1               TO PV-TOP-ITEM                 08710002
087200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08720002
087300                                                                  08730002
087400         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   08740002
087500             PERFORM 2110-BROWSE-BACKWARD                         08750002
087600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08760002
087700                                                                  08770002
087800         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   08780002
087900             PERFORM 2120-BROWSE-FORWARD                          08790002
088000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08800002
088100                                                                  08810002
088200         WHEN DP020-SRC-AID = DP016-ENTER                         08820002
088300             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   08830002
088400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08840002
088500                                                                  08850002
088600         WHEN OTHER                                               08860002
088700             SET DP013-NO-ROLLBACK                                08870002
088800                 DP013-XCTL-DISPLAY-RESTART                       08880002
088900                 DP013-CICS-ABEND  TO TRUE                        08890002
089000             MOVE '2100-CHECK-FUNCTION-KEY'                       08900002
089100                                   TO DP013-PARAGRAPH             08910002
089200             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      08920002
089300                                   TO DP013-MESSAGE-TEXT (1)      08930002
089400             PERFORM DP013-0000-PROCESS-ABEND                     08940002
089500     END-EVALUATE.                                                08950002
089600                                                                  08960002
089700                                                                  08970002
089800*-----------------------------------------------------------------08980002
089900*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP      08990002
090000*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,       09000002
090100*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST    09010002
090200*    MESSAGE.                                                     09020002
090300*-----------------------------------------------------------------09030002
090400                                                                  09040002
090500 2110-BROWSE-BACKWARD.                                            09050002
090600                                                                  09060002
090700     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    09070002
090800         GIVING PV-TOP-ITEM.                                      09080002
090900                                                                  09090002
091000     IF  ((PV-TOP-ITEM < +1)                                      09100002
091100       OR (PV-TOP-ITEM = +1))                                     09110002
091200         MOVE +1                   TO PV-TOP-ITEM                 09120002
091300*        -- TOP OF LIST --                                        09130002
091400         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            09140002
091500         SET DP020-MSG-INFORMATIONAL TO TRUE                      09150002
091600     END-IF.                                                      09160002
091700                                                                  09170002
091800                                                                  09180002
091900*-----------------------------------------------------------------09190002
092000*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP       09200002
092100*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO    09210002
092200*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.              09220002
092300*-----------------------------------------------------------------09230002
092400                                                                  09240002
092500 2120-BROWSE-FORWARD.                                             09250002
092600                                                                  09260002
092700     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              09270002
092800         GIVING PV-TOP-ITEM.                                      09280002
092900     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   09290002
093000         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            09300002
093100                                   TO PV-TOP-ITEM                 09310002
093200*        -- BOTTOM OF LIST --                                     09320002
093300         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            09330002
093400         SET DP020-MSG-INFORMATIONAL                              09340002
093500                                   TO TRUE                        09350002
093600     ELSE                                                         09360002
093700         COMPUTE PV-BOTTOM-ITEM =                                 09370002
093800             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 09380002
093900         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            09390002
094000*            -- BOTTOM OF LIST --                                 09400002
094100             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            09410002
094200             SET DP020-MSG-INFORMATIONAL                          09420002
094300                                   TO TRUE                        09430002
094400         END-IF                                                   09440002
094500     END-IF.                                                      09450002
094600                                                                  09460002
094700                                                                  09470002
094800*-----------------------------------------------------------------09480002
094900*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO     09490002
095000*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.    09500002
095100*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST   09510002
095200*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.          09520002
095300*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT      09530002
095400*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.           09540002
095500*-----------------------------------------------------------------09550002
095600                                                                  09560002
095700 2130-CHECK-FOR-JUMP-BROWSE.                                      09570002
095800                                                                  09580002
095900     IF (ASC-START-ITEM-REQUEST = SPACE)                          09590002
096000         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            09600002
096100                                   TO PV-TOP-ITEM                 09610002
096200     ELSE                                                         09620002
096300         MOVE ASC-START-ITEM-REQUEST  TO DP010I-UNEDITED-FIELD    09630002
096400         MOVE PC-ITEM-NUMBER-LENGTH   TO DP010I-MAXIMUM-DIGITS    09640002
096500         MOVE +0                      TO DP010I-MAXIMUM-DECIMALS  09650002
096600         SET DP010I-NEGATIVE-NOT-ALLOWED                          09660002
096700                                   TO TRUE                        09670002
096810         CALL DP010I-NUMERIC-EDIT-ROUTINE                         09681003
096820                         USING DP010I-NUMERIC-EDIT-AREA           09682003
096900                                                                  09690002
097000         IF  NOT DP010I-ERROR-DETECTED                            09700002
097100             MOVE DP010I-NUMERIC-FIELD                            09710002
097200                                   TO  ASC-START-ITEM-REQUEST-N   09720002
097300             IF  ASC-START-ITEM-REQUEST-N > ZERO                  09730002
097400                 IF  ASC-START-ITEM-REQUEST-N >                   09740002
097500                                          ASC-NUMBER-OF-ITEMS-READ09750002
097600                     MOVE SPACE TO ASC-START-ITEM-REQUEST         09760002
097700                     COMPUTE PV-TOP-ITEM =                        09770002
097800                             ASC-NUMBER-OF-ITEMS-READ             09780002
097900                             - PC-ITEMS-PER-PANEL + 1             09790002
098000                     IF  PV-TOP-ITEM < +1                         09800002
098100                         MOVE +1   TO PV-TOP-ITEM                 09810002
098200*                        ---- BOTTOM OF LIST ----                 09820002
098300                         MOVE PC-TSYMSG-00070                     09830002
098400                                   TO DP020-MSG-NUMBER            09840002
098500                         SET DP020-MSG-INFORMATIONAL              09850002
098600                                   TO TRUE                        09860002
098700                     END-IF                                       09870002
098800                 ELSE                                             09880002
098900                     MOVE ASC-START-ITEM-REQUEST-N                09890002
099000                                   TO PV-TOP-ITEM                 09900002
099100                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      09910002
099200                     COMPUTE PV-BOTTOM-ITEM =                     09920002
099300                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     09930002
099400                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ09940002
099500*                        -- BOTTOM OF LIST --                     09950002
099600                         MOVE PC-TSYMSG-00070                     09960002
099700                                   TO DP020-MSG-NUMBER            09970002
099800                         SET DP020-MSG-INFORMATIONAL              09980002
099900                                   TO TRUE                        09990002
100000                     END-IF                                       10000002
100100                 END-IF                                           10010002
100200             ELSE                                                 10020002
100300*                --- VALUE OUT OF RANGE ----                      10030002
100400                 MOVE PC-TSYMSG-00101     TO DP020-MSG-NUMBER     10040002
100500                 MOVE -1                  TO ASTRTITL             10050002
100600                 SET DP030-SET-CURSOR-APPL-1                      10060002
100700                                          TO TRUE                 10070002
100800                 MOVE DP015-REVERSE       TO ASTRTITH             10080002
100900                 MOVE DP015-RED           TO ASTRTITC             10090002
101000                 MOVE DP015-UNP-NUM-BRT-OFF                       10100002
101100                                          TO ASTRTITA             10110002
101200                 SET DP020-MSG-FATAL      TO TRUE                 10120002
101300                 SET PS-START-ITEM-ERROR TO TRUE                  10130002
101400             END-IF                                               10140002
101500                                                                  10150002
101600         ELSE                                                     10160002
101700*            ---- MUST BE NUMERIC ----                            10170002
101800             MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER      10180002
101900             MOVE -1                     TO ASTRTITL              10190002
102000             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  10200002
102100             MOVE DP015-REVERSE          TO ASTRTITH              10210002
102200             MOVE DP015-RED              TO ASTRTITC              10220002
102300             MOVE DP015-UNP-NUM-BRT-OFF  TO ASTRTITA              10230002
102400             SET DP020-MSG-FATAL         TO TRUE                  10240002
102500             SET PS-START-ITEM-ERROR     TO TRUE                  10250002
102600         END-IF                                                   10260002
102700     END-IF.                                                      10270002
102800                                                                  10280002
102900                                                                  10290002
103000*-----------------------------------------------------------------10300002
103100*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION       10310002
103200*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.          10320002
103300*-----------------------------------------------------------------10330002
103400                                                                  10340002
103500 2140-DESELECT-ALL-ITEMS.                                         10350002
103600                                                                  10360002
103700     MOVE +1                       TO ASC-BLK-SUB.                10370002
103800                                                                  10380002
103900     PERFORM 2141-CLEAR-SELECTED-INDS                             10390002
104000         VARYING ASC-ITEM-SUB                                     10400002
104100         FROM 1 BY 1                                              10410002
104200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10420002
104300                                                                  10430002
104400     ADD +1                        TO ASC-BLK-SUB.                10440002
104500                                                                  10450002
104600     PERFORM 2141-CLEAR-SELECTED-INDS                             10460002
104700         VARYING ASC-ITEM-SUB                                     10470002
104800         FROM 1 BY 1                                              10480002
104900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10490002
105000                                                                  10500002
105100     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               10510002
105200                                   TO PV-LIST-ITEM-NUMBER.        10520002
105300                                                                  10530002
105400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            10540002
105500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    10550002
105600                                                                  10560002
105700     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     10570002
105800        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      10580002
105900         MOVE +1                   TO ASC-BLK-SUB                 10590002
106000                                                                  10600002
106100         PERFORM 5100-WRITE-TEMP-STORAGE                          10610002
106200                                                                  10620002
106300         MOVE +1                   TO PV-BLOCK-NUMBER             10630002
106400                                                                  10640002
106500         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         10650002
106600             PV-FIRST-BLOCK-IN-ARRAY - 1                          10660002
106700                                                                  10670002
106800         PERFORM                                                  10680002
106900             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       10690002
107000                                                                  10700002
107100             PERFORM 4410-READ-TEMP-STORAGE                       10710002
107200                                                                  10720002
107300             PERFORM 2141-CLEAR-SELECTED-INDS                     10730002
107400                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 10740002
107500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10750002
107600                                                                  10760002
107700             PERFORM 5100-WRITE-TEMP-STORAGE                      10770002
107800                                                                  10780002
107900             ADD +1                TO PV-BLOCK-NUMBER             10790002
108000                                                                  10800002
108100         END-PERFORM                                              10810002
108200                                                                  10820002
108300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         10830002
108400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     10840002
108500                                                                  10850002
108600         PERFORM                                                  10860002
108700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       10870002
108800                   ASC-HIGHEST-BLOCK-WRITTEN                      10880002
108900                                                                  10890002
109000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          10900002
109100                                   TO PV-BLOCK-NUMBER             10910002
109200                                                                  10920002
109300             PERFORM 4410-READ-TEMP-STORAGE                       10930002
109400                                                                  10940002
109500             PERFORM 2141-CLEAR-SELECTED-INDS                     10950002
109600                 VARYING ASC-ITEM-SUB                             10960002
109700                 FROM 1 BY 1                                      10970002
109800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10980002
109900                                                                  10990002
110000             PERFORM 5100-WRITE-TEMP-STORAGE                      11000002
110100                                                                  11010002
110200             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      11020002
110300                                                                  11030002
110400         END-PERFORM                                              11040002
110500                                                                  11050002
110600         MOVE PV-FIRST-BLOCK-IN-ARRAY                             11060002
110700                                   TO PV-BLOCK-NUMBER             11070002
110800                                                                  11080002
110900         PERFORM 4410-READ-TEMP-STORAGE                           11090002
111000     END-IF.                                                      11100002
111100                                                                  11110002
111200                                                                  11120002
111300     MOVE +0        TO ASC-NUMBER-OF-SELECTED-ITEMS               11130002
111400                       ASC-START-OF-SELECTED-RANGE                11140002
111500                       ASC-END-OF-SELECTED-RANGE.                 11150002
111600                                                                  11160002
111700     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        11170002
111800                                                                  11180002
111900                                                                  11190002
112000*-----------------------------------------------------------------11200002
112100*    MARK EACH ITEM AS BEING NOT SELECTED.                        11210002
112200*-----------------------------------------------------------------11220002
112300                                                                  11230002
112400 2141-CLEAR-SELECTED-INDS.                                        11240002
112500                                                                  11250002
112600     IF ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)            11260002
112700             NOT EQUAL ZERO                                       11270002
112800         SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)              11280002
112900             ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        11290002
113000             ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      11300002
113100                               TO TRUE                            11310002
113200     END-IF.                                                      11320002
113300                                                                  11330002
113400                                                                  11340002
113500*-----------------------------------------------------------------11350002
113600*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH   11360002
113700*  FOR ALL ITEMS.                                                 11370002
113800*-----------------------------------------------------------------11380002
113900                                                                  11390002
114000 2150-SELECT-ALL-ITEMS.                                           11400002
114100                                                                  11410002
114200     MOVE ZERO  TO  ASC-NUMBER-OF-SELECTED-ITEMS.                 11420002
114300     MOVE +1    TO  ASC-BLK-SUB.                                  11430002
114400                                                                  11440002
114500     PERFORM 2151-SET-SELECTED-INDS                               11450002
114600         VARYING ASC-ITEM-SUB                                     11460002
114700         FROM 1 BY 1                                              11470002
114800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11480002
114900                                                                  11490002
115000     ADD +1                        TO ASC-BLK-SUB.                11500002
115100                                                                  11510002
115200     PERFORM 2151-SET-SELECTED-INDS                               11520002
115300         VARYING ASC-ITEM-SUB                                     11530002
115400         FROM 1 BY 1                                              11540002
115500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11550002
115600                                                                  11560002
115700     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               11570002
115800                                   TO PV-LIST-ITEM-NUMBER.        11580002
115900                                                                  11590002
116000     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            11600002
116100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    11610002
116200                                                                  11620002
116300     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     11630002
116400        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    11640002
116500         MOVE +1                   TO ASC-BLK-SUB                 11650002
116600                                                                  11660002
116700         PERFORM 5100-WRITE-TEMP-STORAGE                          11670002
116800                                                                  11680002
116900         MOVE +1                   TO PV-BLOCK-NUMBER             11690002
117000                                                                  11700002
117100         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         11710002
117200             PV-FIRST-BLOCK-IN-ARRAY - 1                          11720002
117300                                                                  11730002
117400         PERFORM                                                  11740002
117500             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       11750002
117600                                                                  11760002
117700             PERFORM 4410-READ-TEMP-STORAGE                       11770002
117800                                                                  11780002
117900             PERFORM 2151-SET-SELECTED-INDS                       11790002
118000                 VARYING ASC-ITEM-SUB                             11800002
118100                 FROM 1 BY 1                                      11810002
118200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11820002
118300                                                                  11830002
118400             PERFORM 5100-WRITE-TEMP-STORAGE                      11840002
118500                                                                  11850002
118600             ADD +1                TO PV-BLOCK-NUMBER             11860002
118700                                                                  11870002
118800         END-PERFORM                                              11880002
118900                                                                  11890002
119000         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         11900002
119100             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     11910002
119200                                                                  11920002
119300         PERFORM                                                  11930002
119400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       11940002
119500                   ASC-HIGHEST-BLOCK-WRITTEN                      11950002
119600                                                                  11960002
119700             MOVE PV-NEXT-BLOCK-IN-ARRAY                          11970002
119800                                   TO PV-BLOCK-NUMBER             11980002
119900                                                                  11990002
120000             PERFORM 4410-READ-TEMP-STORAGE                       12000002
120100                                                                  12010002
120200             PERFORM 2151-SET-SELECTED-INDS                       12020002
120300                 VARYING ASC-ITEM-SUB                             12030002
120400                 FROM 1 BY 1                                      12040002
120500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12050002
120600                                                                  12060002
120700             PERFORM 5100-WRITE-TEMP-STORAGE                      12070002
120800                                                                  12080002
120900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      12090002
121000                                                                  12100002
121100         END-PERFORM                                              12110002
121200                                                                  12120002
121300         MOVE PV-FIRST-BLOCK-IN-ARRAY                             12130002
121400                                   TO PV-BLOCK-NUMBER             12140002
121500                                                                  12150002
121600         PERFORM 4410-READ-TEMP-STORAGE                           12160002
121700     END-IF.                                                      12170002
121800                                                                  12180002
121900     MOVE +0        TO ASC-START-OF-SELECTED-RANGE                12190002
122000                       ASC-END-OF-SELECTED-RANGE.                 12200002
122100                                                                  12210002
122200     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        12220002
122300                                                                  12230002
122400                                                                  12240002
122500*-----------------------------------------------------------------12250002
122600*    MARK EACH ITEM AS BEING SELECTED.                            12260002
122700*-----------------------------------------------------------------12270002
122800                                                                  12280002
122900 2151-SET-SELECTED-INDS.                                          12290002
123000                                                                  12300002
123100     IF ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) NOT = ZERO 12310002
123200         IF ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB) = PC-DEL OR     12320002
123300                                                    PC-REL        12330002
123400             SET ASC-NO-SELECT      (ASC-BLK-SUB ASC-ITEM-SUB)    12340002
123500                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    12350002
123600                 ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                 12360002
123700                                       TO  TRUE                   12370002
123800         ELSE                                                     12380002
123900             ADD +1  TO  ASC-NUMBER-OF-SELECTED-ITEMS             12390002
124000             SET ASC-SELECT         (ASC-BLK-SUB ASC-ITEM-SUB)    12400002
124100                 ASC-TEMP-SELECT    (ASC-BLK-SUB ASC-ITEM-SUB)    12410002
124200                 ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                 12420002
124300                                       TO  TRUE                   12430002
124400         END-IF                                                   12440002
124500     END-IF.                                                      12450002
124600                                                                  12460002
124700                                                                  12470002
124800*-----------------------------------------------------------------12480002
124900* MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE       12490002
125000* SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.    12500002
125100*-----------------------------------------------------------------12510002
125200                                                                  12520002
125300 2200-MOVE-SCREEN-TO-COMMAREA.                                    12530002
125400                                                                  12540002
125500     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             12550002
125600     MOVE +1                       TO PV-SUB.                     12560002
125700                                                                  12570002
125800     PERFORM 3100-SET-SUBSCRIPTS.                                 12580002
125900     IF  ASTRTITL > ZERO                                          12590002
126000         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          12600002
126100     ELSE                                                         12610002
126200         IF ASTRTITF = DP015-ERASE-EOF                            12620002
126300             MOVE SPACE TO ASC-START-ITEM-REQUEST                 12630002
126400         END-IF.                                                  12640002
126500                                                                  12650002
126600     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          12660002
126700         VARYING PV-SUB                                           12670002
126800         FROM 1 BY 1                                              12680002
126900         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      12690002
127000                                                                  12700002
127100                                                                  12710002
127200*-----------------------------------------------------------------12720002
127300* MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA.  12730002
127400*-----------------------------------------------------------------12740002
127500                                                                  12750002
127600 2210-MOVE-LINES-TO-COMMAREA.                                     12760002
127700                                                                  12770002
127800     IF  MR-SELECTL (PV-SUB) > ZERO                               12780002
127900         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             12790002
128000         MOVE MR-SELECT (PV-SUB)                                  12800002
128100                                   TO ASC-TEMP-SELECTED-SW        12810002
128200                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12820002
128300     ELSE                                                         12830002
128400         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                12840002
128500                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     12850002
128600                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        12860002
128700                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12870002
128800         END-IF                                                   12880002
128900     END-IF.                                                      12890002
129000     ADD +1                        TO ASC-ITEM-SUB.               12900002
129100     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        12910002
129200         ADD +1                    TO ASC-BLK-SUB                 12920002
129300         MOVE +1                   TO ASC-ITEM-SUB                12930002
129400     END-IF.                                                      12940002
129500                                                                  12950002
129600                                                                  12960002
129700*-----------------------------------------------------------------12970002
129800* EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE         12980002
129900* COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).    12990002
130000*-----------------------------------------------------------------13000002
130100                                                                  13010002
130200 3000-EDIT-DATA-IN-COMMAREA.                                      13020002
130300                                                                  13030002
130400     SET PS-NO-ERROR               TO TRUE.                       13040002
130500     PERFORM 3200-RESET-ATTRIBUTES.                               13050002
130600     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     13060002
130700                                                                  13070002
130800* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              13080002
130900* EDITTING IS DONE FROM THE BOTTOM UP.                            13090002
131000*                                                                 13100002
131100     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       13110002
131200         ASC-ITEMS-DISPLAYED - 1.                                 13120002
131300     PERFORM 3100-SET-SUBSCRIPTS.                                 13130002
131400     PERFORM 3300-EDIT-SELECTIONS                                 13140002
131500         VARYING PV-SUB                                           13150002
131600         FROM PV-SUB BY -1                                        13160002
131700         UNTIL PV-SUB < +1                                        13170002
131800                                                                  13180002
131900     IF  PS-NO-ERROR                                              13190002
132000         PERFORM 3400-CHECK-RANGE-SEQUENCE                        13200002
132100     END-IF.                                                      13210002
132200                                                                  13220002
132300     IF  ((PS-NO-ERROR)                                           13230002
132400       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   13240002
132500       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    13250002
132600             PERFORM 3500-MARK-RANGE-AS-SELECTED                  13260002
132700     END-IF.                                                      13270002
132800                                                                  13280002
132900                                                                  13290002
133000*-----------------------------------------------------------------13300002
133100*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM  13310002
133200*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL 13320002
133300*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                   13330002
133400*                                                                 13340002
133500*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS    13350002
133600*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT     13360002
133700*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION   13370002
133800*    US IN THE 2ND BLOCK OF THE ARRAY.                            13380002
133900*-----------------------------------------------------------------13390002
134000                                                                  13400002
134100 3100-SET-SUBSCRIPTS.                                             13410002
134200                                                                  13420002
134300     COMPUTE ASC-ITEM-SUB =                                       13430002
134400         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        13440002
134500                                                                  13450002
134600     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         13460002
134700         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            13470002
134800                                                                  13480002
134900         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               13490002
135000     ELSE                                                         13500002
135100         MOVE +1                     TO ASC-BLK-SUB               13510002
135200     END-IF.                                                      13520002
135300                                                                  13530002
135400                                                                  13540002
135500*-----------------------------------------------------------------13550002
135600* RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.        13560002
135700*-----------------------------------------------------------------13570002
135800                                                                  13580002
135900 3200-RESET-ATTRIBUTES.                                           13590002
136000                                                                  13600002
136100     MOVE DP015-UNP-NUM-NOR-OFF    TO ASTRTITA.                   13610002
136200     MOVE DP015-GREEN              TO ASTRTITC.                   13620002
136300     MOVE DP015-UNDERLINE          TO ASTRTITH.                   13630002
136400                                                                  13640002
136500     PERFORM                                                      13650002
136600         VARYING PV-SUB                                           13660002
136700         FROM 1 BY 1                                              13670002
136800         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        13680002
136900         MOVE DP015-UNP-ALP-NOR-OFF                               13690002
137000                                   TO MR-SELECTA (PV-SUB)         13700002
137100         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         13710002
137200         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         13720002
137300     END-PERFORM.                                                 13730002
137400                                                                  13740002
137500                                                                  13750002
137600 3250-SET-ATTRIBUTES-TO-PROT.                                     13760002
137700                                                                  13770002
137800     PERFORM                                                      13780002
137900         VARYING PV-SUB FROM 1 BY 1                               13790002
138000         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        13800002
138100             MOVE DP015-PRO-NOR-OFF    TO MR-SELECTA (PV-SUB)     13810002
138200             MOVE DP015-BLUE           TO MR-SELECTC (PV-SUB)     13820002
138300             MOVE DP015-HL-OFF         TO MR-SELECTH (PV-SUB)     13830002
138400     END-PERFORM.                                                 13840002
138500     MOVE -1                           TO ASTRTITL.               13850002
138600     SET DP030-SET-CURSOR-APPL-1       TO TRUE.                   13860002
138700                                                                  13870002
138800                                                                  13880002
138900*-----------------------------------------------------------------13890002
139000* EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS       13900002
139100* WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'      13910002
139200* IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR       13920002
139300* WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.                13930002
139400*-----------------------------------------------------------------13940002
139500                                                                  13950002
139600 3300-EDIT-SELECTIONS.                                            13960002
139700                                                                  13970002
139800     EVALUATE TRUE                                                13980002
139900         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13990002
140000             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         14000002
140100                 CONTINUE                                         14010002
140200         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         14020002
140300             IF NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)         14030002
140400                 IF ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB) = PC-DEL14040002
140500                                                         OR PC-REL14050002
140600*                    ---- DATA DOES NOT EXIST ----                14060002
140700                     MOVE PC-TSYMSG-00148   TO DP020-MSG-NUMBER   14070002
140800                     SET DP020-MSG-FATAL    TO TRUE               14080002
140900                     MOVE -1                TO MR-SELECTL (PV-SUB)14090002
141000                     SET DP030-SET-CURSOR-APPL-1                  14100002
141100                                            TO TRUE               14110002
141200                     MOVE DP015-RED         TO MR-SELECTC (PV-SUB)14120002
141300                     MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)14130002
141400                     SET PS-ERROR           TO TRUE               14140002
141500                 ELSE                                             14150002
141600                     ADD +1 TO ASC-NUMBER-OF-SELECTED-ITEMS       14160002
141700                     IF ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)      14170002
141800                         MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE14180002
141900                     ELSE                                         14190002
142000                         IF ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)    14200002
142100                             MOVE ZERO                            14210002
142200                                  TO ASC-END-OF-SELECTED-RANGE    14220002
142300                         END-IF                                   14230002
142400                     END-IF                                       14240002
142500                     MOVE ASC-TEMP-SELECTED-SW                    14250002
142600                                        (ASC-BLK-SUB ASC-ITEM-SUB)14260002
142700                         TO ASC-SELECTED-SW                       14270002
142800                                        (ASC-BLK-SUB ASC-ITEM-SUB)14280002
142900                 END-IF                                           14290002
143000             END-IF                                               14300002
143100         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     14310002
143200                 = SPACE                                          14320002
143300             EVALUATE TRUE                                        14330002
143400                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       14340002
143500                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS14350002
143600                     MOVE SPACE TO ASC-SELECTED-SW                14360002
143700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14370002
143800                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        14380002
143900                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    14390002
144000                     MOVE SPACE TO ASC-SELECTED-SW                14400002
144100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14410002
144200                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          14420002
144300                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      14430002
144400                     MOVE SPACE TO ASC-SELECTED-SW                14440002
144500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14450002
144600             END-EVALUATE                                         14460002
144700         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           14470002
144800             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14480002
144900                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    14490002
145000             END-IF                                               14500002
145100             PERFORM 3310-EDIT-RANGE                              14510002
145200         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             14520002
145300             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14530002
145400                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    14540002
145500             END-IF                                               14550002
145600             PERFORM 3310-EDIT-RANGE                              14560002
145700         WHEN OTHER                                               14570002
145800*            ---- INVALID VALUE ----                              14580002
145900             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           14590002
146000             SET DP020-MSG-FATAL    TO TRUE                       14600002
146100             MOVE -1                TO MR-SELECTL (PV-SUB)        14610002
146200             SET DP030-SET-CURSOR-APPL-1                          14620002
146300                                    TO TRUE                       14630002
146400             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        14640002
146500             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        14650002
146600             SET PS-ERROR TO TRUE                                 14660002
146700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14670002
146800                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     14680002
146900                 MOVE SPACE         TO ASC-SELECTED-SW            14690002
147000                                        (ASC-BLK-SUB ASC-ITEM-SUB)14700002
147100             END-IF                                               14710002
147200     END-EVALUATE.                                                14720002
147300                                                                  14730002
147400     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 14740002
147500     SUBTRACT +1 FROM ASC-ITEM-SUB.                               14750002
147600     IF  ASC-ITEM-SUB < 1                                         14760002
147700         SUBTRACT +1 FROM ASC-BLK-SUB                             14770002
147800         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                14780002
147900     END-IF.                                                      14790002
148000                                                                  14800002
148100                                                                  14810002
148200*-----------------------------------------------------------------14820002
148300* IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A         14830002
148400* RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1       14840002
148500* ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)   14850002
148600* THE ENDING.                                                     14860002
148700*-----------------------------------------------------------------14870002
148800                                                                  14880002
148900 3310-EDIT-RANGE.                                                 14890002
149000                                                                  14900002
149100     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                14910002
149200         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   14920002
149300             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)14930002
149400                                   TO ASC-SELECTED-SW             14940002
149500                                        (ASC-BLK-SUB ASC-ITEM-SUB)14950002
149600             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 14960002
149700         ELSE                                                     14970002
149800             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     14980002
149900                 CONTINUE                                         14990002
150000             ELSE                                                 15000002
150100*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        15010002
150200                 MOVE PC-TSYMSG-00054                             15020002
150300                                   TO DP020-MSG-NUMBER            15030002
150400                 SET DP020-MSG-FATAL                              15040002
150500                                   TO TRUE                        15050002
150600                 MOVE -1           TO MR-SELECTL (PV-SUB)         15060002
150700                 SET DP030-SET-CURSOR-APPL-1                      15070002
150800                                   TO TRUE                        15080002
150900                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         15090002
151000                 MOVE DP015-UNDERLINE                             15100002
151100                                   TO MR-SELECTH (PV-SUB)         15110002
151200                 SET PS-ERROR      TO TRUE                        15120002
151300             END-IF                                               15130002
151400         END-IF                                                   15140002
151500     ELSE                                                         15150002
151600         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     15160002
151700             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 15170002
151800                                   TO ASC-SELECTED-SW             15180002
151900                                     (ASC-BLK-SUB ASC-ITEM-SUB)   15190002
152000             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   15200002
152100         ELSE                                                     15210002
152200             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       15220002
152300                 CONTINUE                                         15230002
152400             ELSE                                                 15240002
152500*                -- ONLY ONE END-OF-RANGE ALLOWED --              15250002
152600                 MOVE PC-TSYMSG-00055                             15260002
152700                                   TO DP020-MSG-NUMBER            15270002
152800                 SET DP020-MSG-FATAL                              15280002
152900                                   TO TRUE                        15290002
153000                 MOVE -1           TO MR-SELECTL (PV-SUB)         15300002
153100                 SET DP030-SET-CURSOR-APPL-1                      15310002
153200                                   TO TRUE                        15320002
153300                 SET PS-ERROR      TO TRUE                        15330002
153400             END-IF                                               15340002
153500         END-IF                                                   15350002
153600     END-IF.                                                      15360002
153700                                                                  15370002
153800                                                                  15380002
153900*-----------------------------------------------------------------15390002
154000* IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,       15400002
154100* MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.     15410002
154200*-----------------------------------------------------------------15420002
154300                                                                  15430002
154400 3400-CHECK-RANGE-SEQUENCE.                                       15440002
154500                                                                  15450002
154600     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       15460002
154700       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      15470002
154800       AND  ASC-START-OF-SELECTED-RANGE >                         15480002
154900                                         ASC-END-OF-SELECTED-RANGE15490002
155000*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                15500002
155100         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 15510002
155200         SET DP020-MSG-FATAL TO TRUE                              15520002
155300         SET PS-ERROR TO TRUE                                     15530002
155400         PERFORM 3410-POSITION-AT-ERROR                           15540002
155500     ELSE                                                         15550002
155600         MOVE -1 TO MR-SELECTL (1)                                15560002
155700     END-IF.                                                      15570002
155800     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       15580002
155900                                                                  15590002
156000                                                                  15600002
156100*-----------------------------------------------------------------15610002
156200* BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE       15620002
156300* PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR    15630002
156400* SHOULD BE POSITIONED ON A RANGE ERROR.                          15640002
156500*-----------------------------------------------------------------15650002
156600                                                                  15660002
156700 3410-POSITION-AT-ERROR.                                          15670002
156800                                                                  15680002
156900     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 15690002
157000                    - PV-TOP-ITEM + 1.                            15700002
157100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      15710002
157200         CONTINUE                                                 15720002
157300     ELSE                                                         15730002
157400         MOVE -1                   TO MR-SELECTL (PV-SUB)         15740002
157500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         15750002
157600         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         15760002
157700     END-IF.                                                      15770002
157800*                                                                 15780002
157900     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   15790002
158000                    - PV-TOP-ITEM + 1.                            15800002
158100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      15810002
158200         CONTINUE                                                 15820002
158300     ELSE                                                         15830002
158400         MOVE -1                   TO MR-SELECTL (PV-SUB)         15840002
158500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         15850002
158600         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         15860002
158700     END-IF.                                                      15870002
158800                                                                  15880002
158900                                                                  15890002
159000*-----------------------------------------------------------------15900002
159100*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE     15910002
159200*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS     15920002
159300*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.              15930002
159400*-----------------------------------------------------------------15940002
159500                                                                  15950002
159600 3500-MARK-RANGE-AS-SELECTED.                                     15960002
159700                                                                  15970002
159800     MOVE +1                       TO  ASC-BLK-SUB.               15980002
159900     PERFORM 3510-MARK-SELECTED-INDS                              15990002
160000         VARYING ASC-ITEM-SUB                                     16000002
160100         FROM 1 BY 1                                              16010002
160200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16020002
160300                                                                  16030002
160400     ADD +1                        TO ASC-BLK-SUB.                16040002
160500     PERFORM 3510-MARK-SELECTED-INDS                              16050002
160600         VARYING ASC-ITEM-SUB                                     16060002
160700         FROM 1 BY 1                                              16070002
160800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16080002
160900                                                                  16090002
161000     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               16100002
161100                                   TO  PV-LIST-ITEM-NUMBER.       16110002
161200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            16120002
161300         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         16130002
161400               PC-ITEMS-PER-PANEL).                               16140002
161500                                                                  16150002
161600     MOVE ASC-START-OF-SELECTED-RANGE                             16160002
161700                                   TO PV-START-OF-SELECTED-RANGE. 16170002
161800     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            16180002
161900         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  16190002
162000               PC-ITEMS-PER-PANEL).                               16200002
162100                                                                  16210002
162200     MOVE ASC-END-OF-SELECTED-RANGE                               16220002
162300                                   TO  PV-END-OF-SELECTED-RANGE.  16230002
162400     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             16240002
162500         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    16250002
162600               PC-ITEMS-PER-PANEL).                               16260002
162700     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             16270002
162800         PV-FIRST-BLOCK-IN-ARRAY + 1.                             16280002
162900                                                                  16290002
163000     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    16300002
163100        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        16310002
163200         MOVE +1                   TO ASC-BLK-SUB                 16320002
163300         PERFORM 5100-WRITE-TEMP-STORAGE                          16330002
163400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         16340002
163500             PV-FIRST-BLOCK-IN-ARRAY - 1                          16350002
163600                                                                  16360002
163700         PERFORM                                                  16370002
163800             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      16380002
163900                   PV-PREV-BLOCK-IN-ARRAY                         16390002
164000             MOVE PV-FIRST-BLOCK-IN-RANGE                         16400002
164100                                   TO PV-BLOCK-NUMBER             16410002
164200             PERFORM 4410-READ-TEMP-STORAGE                       16420002
164300             PERFORM 3510-MARK-SELECTED-INDS                      16430002
164400                 VARYING ASC-ITEM-SUB                             16440002
164500                 FROM 1 BY 1                                      16450002
164600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16460002
164700             PERFORM 5100-WRITE-TEMP-STORAGE                      16470002
164800             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     16480002
164900         END-PERFORM                                              16490002
165000                                                                  16500002
165100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         16510002
165200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     16520002
165300         PERFORM                                                  16530002
165400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       16540002
165500                   PV-LAST-BLOCK-IN-RANGE                         16550002
165600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          16560002
165700                                   TO PV-BLOCK-NUMBER             16570002
165800             PERFORM 4410-READ-TEMP-STORAGE                       16580002
165900             PERFORM 3510-MARK-SELECTED-INDS                      16590002
166000                 VARYING ASC-ITEM-SUB                             16600002
166100                 FROM 1 BY 1                                      16610002
166200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16620002
166300             PERFORM 5100-WRITE-TEMP-STORAGE                      16630002
166400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      16640002
166500         END-PERFORM                                              16650002
166600                                                                  16660002
166700         MOVE PV-FIRST-BLOCK-IN-ARRAY                             16670002
166800                                   TO PV-BLOCK-NUMBER             16680002
166900         PERFORM 4410-READ-TEMP-STORAGE                           16690002
167000     END-IF.                                                      16700002
167100                                                                  16710002
167200     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 16720002
167300                                      ASC-END-OF-SELECTED-RANGE.  16730002
167400                                                                  16740002
167500                                                                  16750002
167600*-----------------------------------------------------------------16760002
167700* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.            16770002
167800*-----------------------------------------------------------------16780002
167900                                                                  16790002
168000 3510-MARK-SELECTED-INDS.                                         16800002
168100                                                                  16810002
168200     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         16820002
168300                                ASC-ITEM-SUB) >                   16830002
168400         ASC-START-OF-SELECTED-RANGE)                             16840002
168500     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         16850002
168600                                ASC-ITEM-SUB) =                   16860002
168700         ASC-START-OF-SELECTED-RANGE)                             16870002
168800                                                                  16880002
168900         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     16890002
169000                                    ASC-ITEM-SUB) <               16900002
169100             ASC-END-OF-SELECTED-RANGE)                           16910002
169200         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     16920002
169300                                    ASC-ITEM-SUB) =               16930002
169400             ASC-END-OF-SELECTED-RANGE)                           16940002
169500                                                                  16950002
169600             IF NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)         16960002
169700                 IF ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB) = PC-DEL16970002
169800                                                         OR PC-REL16980002
169900                     SET ASC-NO-SELECT (ASC-BLK-SUB  ASC-ITEM-SUB)16990002
170000                     ASC-TEMP-NO-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)17000002
170100                     ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              17010002
170200                               TO TRUE                            17020002
170300                 ELSE                                             17030002
170400                     SET ASC-SELECT    (ASC-BLK-SUB  ASC-ITEM-SUB)17040002
170500                     ASC-TEMP-SELECT   (ASC-BLK-SUB  ASC-ITEM-SUB)17050002
170600                     ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              17060002
170700                               TO TRUE                            17070002
170800                     ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS17080002
170900                 END-IF                                           17090002
171000             END-IF                                               17100002
171100         END-IF                                                   17110002
171200     END-IF.                                                      17120002
171300                                                                  17130002
171400                                                                  17140002
171500*-----------------------------------------------------------------17150002
171600*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                         17160002
171700*    INITIALIZE ALL COUNTERS AND FLAGS.                           17170002
171800*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.   17180002
171900*    DISPLAY THE PANEL TO USER.                                   17190002
172000*-----------------------------------------------------------------17200002
172100                                                                  17210002
172200 4000-BUILD-INITIAL-PANEL.                                        17220002
172300                                                                  17230002
172400     INITIALIZE                   ASC-BLOCK-ENTRIES (1)           17240002
172500                                  ASC-BLOCK-ENTRIES (2).          17250002
172600     MOVE +1                   TO ASC-BLK-SUB.                    17260002
172700     SET ASC-ITEMS-LEFT-ON-DB  TO TRUE.                           17270002
172800                                                                  17280002
172900     MOVE +0                 TO ASC-ITEM-SUB                      17290002
173000                                ASC-NUMBER-OF-ITEMS-READ          17300002
173100                                ASC-NUMBER-OF-SELECTED-ITEMS      17310002
173200                                ASC-HIGHEST-BLOCK-WRITTEN         17320002
173300                                ASC-START-OF-SELECTED-RANGE       17330002
173400                                ASC-END-OF-SELECTED-RANGE         17340002
173500                                ASC-ITEM-AT-TOP-OF-PANEL.         17350002
173600                                                                  17360002
173700*    *------------------------------------------------------------17370002
173800*    * DETERMINE WHICH CURSOR SHOULD BE USED. IF THIS PROGRAM WAS 17380002
173900*    * ENTERED FROM THE EDI MENU, ALL DOCUMENTS SHOULD BE         17390002
174000*    * RETRIEVED. IF THIS PROGRAM WAS ENTERED FROM THE CRITERIA   17400002
174100*    * SPEC SCREEN, THE FIELDS PASSED TO THIS PROGRAM FROM THE    17410002
174200*    * CRITERIA SPEC (IN THE INTER APPL COMMAREA) ARE USED TO     17420002
174300*    * DETERMINE WHICH DOCUMENTS TO RETRIEVE.                     17430002
174400*    *------------------------------------------------------------17440002
174500                                                                  17450002
174600     IF ASC-INT-APPL-FORMAT-EDI-MENU                              17460002
174700         SET ASC-ALL-DOCS-CSR TO TRUE                             17470002
174800     ELSE                                                         17480002
174900         IF ASC-INT-APPL-WORKER-NBR = ZERO                        17490002
175000             IF ASC-INT-APPL-DEPT-NBR = SPACE                     17500002
175100                 SET ASC-ALL-DOCS-CSR TO TRUE                     17510002
175200             ELSE                                                 17520002
175300                 SET ASC-DEPT-CSR TO TRUE                         17530002
175400             END-IF                                               17540002
175500         ELSE                                                     17550002
175600             SET ASC-WORKER-CSR TO TRUE                           17560002
175700         END-IF                                                   17570002
175800     END-IF.                                                      17580002
175900                                                                  17590002
176000     PERFORM Z800-OPEN-CURSOR.                                    17600002
176100                                                                  17610002
176200     IF SQLCODE = ZERO                                            17620002
176300                                                                  17630002
176400         PERFORM 4300-READ-ITEMS-FROM-DB                          17640002
176500         PERFORM Z820-CLOSE-CURSOR                                17650002
176600                                                                  17660002
176700         MOVE +1 TO  PV-TOP-ITEM                                  17670002
176800         IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                      17680002
176900             SET DP020-MSG-FATAL        TO  TRUE                  17690002
177000*            ---- NO LIST ITEMS FOUND FOR CRITERIA ----           17700002
177100             MOVE PC-TSYMSG-00050       TO  DP020-MSG-NUMBER      17710002
177200             IF DP020-FK-REFRESH (DP020-SRC-AID)                  17720002
177300                 CONTINUE                                         17730002
177400             ELSE                                                 17740002
177500                 SET DP020-NEXT-ACT-APPL-ERROR TO TRUE            17750002
177600             END-IF                                               17760002
177700         ELSE                                                     17770002
177800             MOVE -1                     TO MR-SELECTL (1)        17780002
177900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  17790002
178000         END-IF                                                   17800002
178100         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     17810002
178200     ELSE                                                         17820002
178300         SET DP020-MSG-WARNING  TO TRUE                           17830002
178400*        ---- WAIT 15 SECONDS, THEN RETRY ----                    17840002
178500         MOVE PC-TSYMSG-00551   TO  DP020-MSG-NUMBER              17850002
178600         IF DP020-FK-REFRESH (DP020-SRC-AID)                      17860002
178700             CONTINUE                                             17870002
178800         ELSE                                                     17880002
178900             SET  DP020-NEXT-ACT-APPL-ERROR TO TRUE               17890002
179000         END-IF                                                   17900002
179100     END-IF.                                                      17910002
179200                                                                  17920002
179300                                                                  17930002
179400*-----------------------------------------------------------------17940002
179500*  READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE       17950002
179600*  BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,        17960002
179700*  WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND     17970002
179800*  BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE        17980002
179900*  2ND BLOCK MAKING IT AVAILABLE TO BE USED.                      17990002
180000*                                                                 18000002
180100*  DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE       18010002
180200*  ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM     18020002
180300*  UPON INITIALIZATION.                                           18030002
180400*-----------------------------------------------------------------18040002
180500                                                                  18050002
180600 4300-READ-ITEMS-FROM-DB.                                         18060002
180700                                                                  18070002
180800*    *------------------------------------------------------------18080002
180900*    * MOST OF THE CALENDAR ROUTINE FIELDS USED IN CALCULATING THE18090002
181000*    * RELEASE DATE FOR EACH DOCUMENT ARE INITIALIZED HERE RATHER 18100002
181100*    * THAN WHEN THE RELEASE DATE IS CALCULATED  BECAUSE THEY ONLY18110002
181200*    * NEED TO BE INITIALIZED ONCE, RATHER THAN ONCE FOR EACH     18120002
181300*    * DOCUMENT.                                                  18130002
181400*    *------------------------------------------------------------18140002
181500     INITIALIZE  DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.             18150002
181600     PERFORM DP017-0000-GET-CURR-DATE-TIME.                       18160002
181700     MOVE DP017-CURRENT-DATE-YMD TO DPG51-SYSTEM-DATE.            18170002
181800     SET  DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                     18180002
181900     SET  DPG52-LK-DTE-ISO-FMT      TO TRUE.                      18190002
182000                                                                  18200002
182100     PERFORM                                                      18210002
182200         VARYING PV-READ-COUNT                                    18220002
182300         FROM 1 BY 1                                              18230002
182400         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    18240002
182500            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         18250002
182600                                                                  18260002
182700         PERFORM Z810-FETCH-CURSOR                                18270002
182800                                                                  18280002
182900         IF  ASC-ITEMS-LEFT-ON-DB                                 18290002
183000             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                18300002
183100                 ADD +1            TO ASC-ITEM-SUB                18310002
183200             ELSE                                                 18320002
183300                 ADD +1            TO ASC-BLK-SUB                 18330002
183400                 MOVE +1           TO ASC-ITEM-SUB                18340002
183500                                                                  18350002
183600                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         18360002
183700                     MOVE +1       TO ASC-BLK-SUB                 18370002
183800                     SET ASC-BLOCK-MODIFIED (1) TO TRUE           18380002
183900                     PERFORM 5100-WRITE-TEMP-STORAGE              18390002
184000                     MOVE ASC-BLOCK-ENTRIES                       18400002
184100                                          (PC-MAX-BLOCKS-IN-ARRAY)18410002
184200                                 TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB)18420002
184300                     ADD +1        TO ASC-BLK-SUB                 18430002
184400                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   18440002
184500                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      18450002
184600                                                           TO TRUE18460002
184700                 END-IF                                           18470002
184800             END-IF                                               18480002
184900             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    18490002
185000             MOVE ASC-NUMBER-OF-ITEMS-READ                        18500002
185100                         TO ASC-LIST-ITEM-NUMBER                  18510002
185200                                        (ASC-BLK-SUB ASC-ITEM-SUB)18520002
185300             MOVE FGTRHL-TRN-DTL-TXT                              18530002
185400                         TO ASC-DOCUMENT                          18540002
185500                                        (ASC-BLK-SUB ASC-ITEM-SUB)18550002
185600             MOVE FGTRHL-HOLD-DTE (3:2)                           18560002
185700                         TO ASC-HOLD-DATE-YY                      18570002
185800                                        (ASC-BLK-SUB ASC-ITEM-SUB)18580002
185900             MOVE FGTRHL-HOLD-DTE (6:2)                           18590002
186000                         TO ASC-HOLD-DATE-MM                      18600002
186100                                        (ASC-BLK-SUB ASC-ITEM-SUB)18610002
186200             MOVE FGTRHL-HOLD-DTE (9:2)                           18620002
186300                         TO ASC-HOLD-DATE-DD                      18630002
186400                                        (ASC-BLK-SUB ASC-ITEM-SUB)18640002
186500             MOVE '/' TO ASC-HOLD-DATE-S1                         18650002
186600                                        (ASC-BLK-SUB ASC-ITEM-SUB)18660002
186700                         ASC-HOLD-DATE-S2                         18670002
186800                                        (ASC-BLK-SUB ASC-ITEM-SUB)18680002
186900             MOVE FGTRHL-TRN-SET-CDE                              18690002
187000                         TO ASC-TRN-SET-CDE                       18700002
187100                                        (ASC-BLK-SUB ASC-ITEM-SUB)18710002
187200             MOVE ENTNME-ENT-NAME-DESC                            18720002
187300                         TO ASC-VENDOR-NAME                       18730002
187400                                        (ASC-BLK-SUB ASC-ITEM-SUB)18740002
187500             MOVE TRNSET-TRAN-SET-NME-ID                          18750002
187600                     TO ASC-TSET-NME-ID (ASC-BLK-SUB ASC-ITEM-SUB)18760002
187700             PERFORM 4350-CALC-RELEASE-DATE                       18770002
187800             MOVE FGTRHL-TP-DKEY                                  18780002
187900                      TO ASC-TP-DKEY    (ASC-BLK-SUB ASC-ITEM-SUB)18790002
188000             MOVE FGTRHL-TP-DKEY-TMST                             18800002
188100                      TO ASC-TP-DKEY-TMST                         18810002
188200                                        (ASC-BLK-SUB ASC-ITEM-SUB)18820002
188300         END-IF                                                   18830002
188400     END-PERFORM.                                                 18840002
188500                                                                  18850002
188600     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          18860002
188700         MOVE +1               TO ASC-BLK-SUB                     18870002
188800         PERFORM 5100-WRITE-TEMP-STORAGE                          18880002
188900         ADD +1                TO ASC-BLK-SUB                     18890002
189000         PERFORM 5100-WRITE-TEMP-STORAGE                          18900002
189100                                                                  18910002
189200         MOVE 1                TO ASC-BLK-SUB                     18920002
189300                                  PV-BLOCK-NUMBER                 18930002
189400         PERFORM 4410-READ-TEMP-STORAGE                           18940002
189500         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             18950002
189600             MOVE 2            TO ASC-BLK-SUB                     18960002
189700                                  PV-BLOCK-NUMBER                 18970002
189800             PERFORM 4410-READ-TEMP-STORAGE                       18980002
189900         END-IF                                                   18990002
190000     END-IF.                                                      19000002
190100                                                                  19010002
190200                                                                  19020002
190300 4350-CALC-RELEASE-DATE.                                          19030002
190400                                                                  19040002
190500     IF ASC-TSET-NME-ID-INV (ASC-BLK-SUB ASC-ITEM-SUB)            19050002
190600         SET  DPG51-INCREMENT-DATE TO TRUE                        19060002
190700         MOVE 12 TO DPG51-INCR-DECR-BUS-DAYS-9                    19070002
190800     ELSE                                                         19080002
190900         IF ASC-TSET-NME-ID-ASN (ASC-BLK-SUB ASC-ITEM-SUB)        19090002
191000         OR ASC-TSET-NME-ID-POA (ASC-BLK-SUB ASC-ITEM-SUB)        19100002
191100             SET  DPG51-INCREMENT-DATE TO TRUE                    19110002
191200             MOVE 10 TO DPG51-INCR-DECR-BUS-DAYS-9                19120002
191300         ELSE                                                     19130002
191400             SET DPG51-DO-NOT-INCR-DECR-DATE TO TRUE              19140002
191500         END-IF                                                   19150002
191600     END-IF.                                                      19160002
191700                                                                  19170002
191800     MOVE FGTRHL-HOLD-DTE           TO DPG52-LK-DATE-INPUT.       19180002
191900                                                                  19190002
192000     CALL PC-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53             19200002
192100                                    DPG54 DPG55 DPG56.            19210002
192200     EVALUATE TRUE                                                19220002
192300         WHEN DPG54-SEVERE-ERROR                                  19230002
192400         WHEN DPG54-DATE-INVALID                                  19240002
192500             MOVE '4350-CALC-RELEASE-DATE'                        19250002
192600                           TO  DP013-PARAGRAPH                    19260002
192700             MOVE 'ERROR DETECTED BY CALENDAR ROUTINE:'           19270002
192800                           TO  DP013-MESSAGE-TEXT (1)             19280002
192900             MOVE DPG54-ERROR-MESSAGE                             19290002
193000                           TO  DP013-MESSAGE-TEXT (2)             19300002
193100             SET DP013-LOGIC-ABEND TO  TRUE                       19310002
193200             PERFORM DP013-0000-PROCESS-ABEND                     19320002
193300     END-EVALUATE.                                                19330002
193400                                                                  19340002
193500     MOVE DPG55-GREG-DATE-FMT TO ASC-RELEASE-DATE                 19350002
193600                                       (ASC-BLK-SUB ASC-ITEM-SUB).19360002
193700                                                                  19370002
193800                                                                  19380002
193900*-----------------------------------------------------------------19390002
194000* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.      19400002
194100*-----------------------------------------------------------------19410002
194200                                                                  19420002
194300 4400-MOVE-COMMAREA-TO-SCREEN.                                    19430002
194400                                                                  19440002
194500     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             19450002
194600         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          19460002
194700         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          19470002
194800             MOVE +1    TO ASC-BLK-SUB                            19480002
194900             PERFORM 5100-WRITE-TEMP-STORAGE                      19490002
195000             ADD +1     TO ASC-BLK-SUB                            19500002
195100             PERFORM 5100-WRITE-TEMP-STORAGE                      19510002
195200             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             19520002
195300                 GIVING PV-BLOCK-NUMBER                           19530002
195400                 REMAINDER PV-REMAINDER                           19540002
195500             IF  PV-REMAINDER > ZERO                              19550002
195600                 ADD +1 TO PV-BLOCK-NUMBER                        19560002
195700             END-IF                                               19570002
195800             MOVE +1    TO ASC-BLK-SUB                            19580002
195900             PERFORM 4410-READ-TEMP-STORAGE                       19590002
196000             ADD +1     TO ASC-BLK-SUB                            19600002
196100                           PV-BLOCK-NUMBER                        19610002
196200             PERFORM 4410-READ-TEMP-STORAGE                       19620002
196300     END-IF.                                                      19630002
196400     MOVE +1            TO ASC-BLK-SUB.                           19640002
196500     COMPUTE ASC-ITEM-SUB =                                       19650002
196600         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              19660002
196700         + PC-ITEMS-PER-PANEL).                                   19670002
196800                                                                  19680002
196900     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        19690002
197000         ADD +1         TO ASC-BLK-SUB                            19700002
197100         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            19710002
197200     END-IF.                                                      19720002
197300                                                                  19730002
197400     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           19740002
197500         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                19750002
197600     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        19760002
197700     PERFORM 4420-FORMAT-LIST-LINES                               19770002
197800         VARYING PV-SUB                                           19780002
197900         FROM PC-ITEMS-PER-PANEL BY -1                            19790002
198000         UNTIL PV-SUB < +1.                                       19800002
198100                                                                  19810002
198200     COMPUTE ASC-ITEMS-DISPLAYED =                                19820002
198300         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          19830002
198400     IF PS-NO-START-ITEM-ERROR                                    19840002
198500         MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL19850002
198600                                          ASTRTITO                19860002
198700         MOVE SPACE                    TO ASC-START-ITEM-REQUEST  19870002
198800     ELSE                                                         19880002
198900         MOVE ASC-START-ITEM-REQUEST   TO ASTRTITO                19890002
199000     END-IF.                                                      19900002
199100     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    19910002
199200     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    19920002
199300     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            19930002
199400                                   TO ASELITO.                    19940002
199500                                                                  19950002
199600     IF  DP020-MSG-NUMBER-X = SPACE                               19960002
199700         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  19970002
199800*            --- MORE ITEMS TO DISPLAY ----                       19980002
199900             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            19990002
200000             SET DP020-MSG-INFORMATIONAL TO TRUE                  20000002
200100         END-IF                                                   20010002
200200     END-IF.                                                      20020002
200300                                                                  20030002
200400                                                                  20040002
200500*-----------------------------------------------------------------20050002
200600*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.          20060002
200700*-----------------------------------------------------------------20070002
200800                                                                  20080002
200900 4410-READ-TEMP-STORAGE.                                          20090002
201000                                                                  20100002
201100     EXEC CICS                                                    20110002
201200         READQ TS                                                 20120002
201300             QUEUE (ASC-LIST-QUEUE-NAME)                          20130002
201400             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               20140002
201500             ITEM  (PV-BLOCK-NUMBER)                              20150002
201600             RESP  (PV-CICS-RESP)                                 20160002
201700     END-EXEC.                                                    20170002
201800                                                                  20180002
201900     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       20190002
202000       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     20200002
202100         CONTINUE                                                 20210002
202200     ELSE                                                         20220002
202300         SET DP013-CICS-ABEND     TO TRUE                         20230002
202400         SET DP013-NO-ROLLBACK    TO TRUE                         20240002
202500         MOVE '4410-READ-TEMP-STORAGE'                            20250002
202600                                  TO DP013-PARAGRAPH              20260002
202700         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      20270002
202800                                  TO DP013-MESSAGE-TEXT(1)        20280002
202900         PERFORM DP013-0000-PROCESS-ABEND                         20290002
203000     END-IF.                                                      20300002
203100                                                                  20310002
203200     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             20320002
203300                                                                  20330002
203400     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         20340002
203500         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               20350002
203600     END-IF.                                                      20360002
203700                                                                  20370002
203800                                                                  20380002
203900*-----------------------------------------------------------------20390002
204000*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.     20400002
204100*-----------------------------------------------------------------20410002
204200                                                                  20420002
204300 4420-FORMAT-LIST-LINES.                                          20430002
204400                                                                  20440002
204500     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      20450002
204600         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                20460002
204700         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA      (PV-SUB)      20470002
204800         MOVE DP015-HL-OFF       TO MR-SELECTH      (PV-SUB)      20480002
204900         MOVE SPACE              TO MR-SELECT       (PV-SUB)      20490002
205000                                    MR-ACTION       (PV-SUB)      20500002
205100                                    MR-DOCUMENT     (PV-SUB)      20510002
205200                                    MR-VENDOR-NAME  (PV-SUB)      20520002
205300                                    MR-EDI-DOCUMENT (PV-SUB)      20530002
205400                                    MR-HOLD-DATE    (PV-SUB)      20540002
205500                                    MR-RELEASE-DATE (PV-SUB)      20550002
205600     ELSE                                                         20560002
205700         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      20570002
205800                                                   > SPACE        20580002
205900             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 20590002
206000                                 TO MR-SELECT (PV-SUB)            20600002
206100         ELSE                                                     20610002
206200             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      20620002
206300                                 TO MR-SELECT (PV-SUB)            20630002
206400         END-IF                                                   20640002
206500                                                                  20650002
206600         IF  DP030-SET-CURSOR-TRAILER                             20660002
206700             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)20670002
206800                 > SPACE)                                         20680002
206900               OR (PV-SUB = 1))                                   20690002
207000                SET DP030-SET-CURSOR-APPL-1 TO TRUE               20700002
207100                MOVE -1          TO MR-SELECTL (PV-SUB)           20710002
207200             END-IF                                               20720002
207300         END-IF                                                   20730002
207400                                                                  20740002
207500         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           20750002
207600             MOVE ASC-ACTION         (ASC-BLK-SUB ASC-ITEM-SUB)   20760002
207700                  TO MR-ACTION       (PV-SUB)                     20770002
207800             MOVE ASC-DOCUMENT       (ASC-BLK-SUB ASC-ITEM-SUB)   20780002
207900                  TO MR-DOCUMENT     (PV-SUB)                     20790002
208000             MOVE ASC-VENDOR-NAME    (ASC-BLK-SUB ASC-ITEM-SUB)   20800002
208100                  TO MR-VENDOR-NAME  (PV-SUB)                     20810002
208200             MOVE ASC-TSET-NME-ID    (ASC-BLK-SUB ASC-ITEM-SUB)   20820002
208300                  TO MR-EDI-DOCUMENT (PV-SUB)                     20830002
208400             MOVE ASC-HOLD-DATE      (ASC-BLK-SUB ASC-ITEM-SUB)   20840002
208500                  TO MR-HOLD-DATE    (PV-SUB)                     20850002
208600             MOVE ASC-RELEASE-DATE   (ASC-BLK-SUB ASC-ITEM-SUB)   20860002
208700                  TO MR-RELEASE-DATE (PV-SUB)                     20870002
208800         END-IF                                                   20880002
208900     END-IF.                                                      20890002
209000     SUBTRACT +1 FROM ASC-ITEM-SUB                                20900002
209100     IF  ASC-ITEM-SUB < + 1                                       20910002
209200         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  20920002
209300         MOVE +1                 TO ASC-BLK-SUB                   20930002
209400     END-IF.                                                      20940002
209500                                                                  20950002
209600                                                                  20960002
209700*-----------------------------------------------------------------20970002
209800* IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF      20980002
209900* RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,         20990002
210000* ISSUE A WARNING.                                                21000002
210100*-----------------------------------------------------------------21010002
210200                                                                  21020002
210300 4430-CHECK-FOR-BEGIN-AND-END.                                    21030002
210400                                                                  21040002
210500     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       21050002
210600         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     21060002
210700*            -- NO END-OF-RANGE SPECFIED ---                      21070002
210800             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            21080002
210900             SET DP020-MSG-WARNING TO TRUE                        21090002
211000             PERFORM 4431-POSITION-AT-WARNING                     21100002
211100         END-IF                                                   21110002
211200     ELSE                                                         21120002
211300         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     21130002
211400*            -- NO BEGINNING-OF-RANGE SPECFIED ---                21140002
211500             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            21150002
211600             SET DP020-MSG-WARNING TO TRUE                        21160002
211700             PERFORM 4431-POSITION-AT-WARNING                     21170002
211800         END-IF                                                   21180002
211900     END-IF.                                                      21190002
212000                                                                  21200002
212100                                                                  21210002
212200*-----------------------------------------------------------------21220002
212300* ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,     21230002
212400* DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE      21240002
212500* IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND           21250002
212600* POSITION THE CURSOR THERE.                                      21260002
212700*-----------------------------------------------------------------21270002
212800                                                                  21280002
212900 4431-POSITION-AT-WARNING.                                        21290002
213000                                                                  21300002
213100     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 21310002
213200                    - PV-TOP-ITEM + 1.                            21320002
213300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      21330002
213400         CONTINUE                                                 21340002
213500     ELSE                                                         21350002
213600         SET DP030-SET-CURSOR-APPL-1                              21360002
213700                                   TO TRUE                        21370002
213800         MOVE -1                   TO MR-SELECTL (PV-SUB)         21380002
213900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         21390002
214000         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         21400002
214100     END-IF.                                                      21410002
214200                                                                  21420002
214300     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   21430002
214400                    - PV-TOP-ITEM + 1.                            21440002
214500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      21450002
214600         CONTINUE                                                 21460002
214700     ELSE                                                         21470002
214800         SET DP030-SET-CURSOR-APPL-1                              21480002
214900                                   TO TRUE                        21490002
215000         MOVE -1                   TO MR-SELECTL (PV-SUB)         21500002
215100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         21510002
215200         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         21520002
215300     END-IF.                                                      21530002
215400                                                                  21540002
215500                                                                  21550002
215600*-----------------------------------------------------------------21560002
215700* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-   21570002
215800* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT      21580002
215900* FOR THE SELECTED ITEMS QUEUE.                                   21590002
216000*                                                                 21600002
216100* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION      21610002
216200* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN     21620002
216300* THE ARRAY IS FULL.                                              21630002
216400*-----------------------------------------------------------------21640002
216500                                                                  21650002
216600 5000-PREPARE-SEL-QUEUE.                                          21660002
216700                                                                  21670002
216800     MOVE +1                   TO  ASC-BLK-SUB.                   21680002
216900     PERFORM 5100-WRITE-TEMP-STORAGE.                             21690002
217000     ADD +1                    TO  ASC-BLK-SUB.                   21700002
217100     PERFORM 5100-WRITE-TEMP-STORAGE.                             21710002
217200                                                                  21720002
217300     MOVE ASC-SEL-QUEUE-NAME   TO  ET345-SEL-QUEUE-NAME.          21730002
217400     PERFORM 6010-DELETE-SEL-QUEUE.                               21740002
217500                                                                  21750002
217600     SET ASC-UPDATE-TSQ        TO  TRUE.                          21760002
217700                                                                  21770002
217800     SET ET346-IDX             TO  1.                             21780002
217900     MOVE ZERO                 TO ET345-NUMBER-OF-TS-ITEMS.       21790002
218000     INITIALIZE ET346-SELECTED-ITEM-ARRAY.                        21800002
218100                                                                  21810002
218200     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           21820002
218300             VARYING PV-ITEM                                      21830002
218400             FROM 1 BY 1                                          21840002
218500             UNTIL PV-ITEM > ASC-HIGHEST-BLOCK-WRITTEN.           21850002
218600                                                                  21860002
218700     IF  ET346-IDX > 1                                            21870002
218800         PERFORM 5205-WRITE-SEL-QUEUE                             21880002
218900         ADD +1                TO ET345-NUMBER-OF-TS-ITEMS        21890002
219000     END-IF.                                                      21900002
219100                                                                  21910002
219200                                                                  21920002
219300*-----------------------------------------------------------------21930002
219400*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.       21940002
219500*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.     21950002
219600*-----------------------------------------------------------------21960002
219700                                                                  21970002
219800 5100-WRITE-TEMP-STORAGE.                                         21980002
219900                                                                  21990002
220000     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     22000002
220100                                   TO PV-LIST-ITEM-NUMBER.        22010002
220200     COMPUTE PV-BLOCK-NUMBER =                                    22020002
220300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    22030002
220400                                                                  22040002
220500     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             22050002
220600     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             22060002
220700         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      22070002
220800             PERFORM 5105-REWRITE-ASC-LISTQ                       22080002
220900         END-IF                                                   22090002
221000     ELSE                                                         22100002
221100         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       22110002
221200         ASC-HIGHEST-BLOCK-WRITTEN + 1                            22120002
221300         PERFORM 5110-WRITE-ASC-LISTQ                             22130002
221400         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   22140002
221500     END-IF.                                                      22150002
221600                                                                  22160002
221700     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             22170002
221800                                                                  22180002
221900                                                                  22190002
222000*-----------------------------------------------------------------22200002
222100* REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       22210002
222200* SPECIFIC COMMAREA.                                              22220002
222300*-----------------------------------------------------------------22230002
222400                                                                  22240002
222500 5105-REWRITE-ASC-LISTQ.                                          22250002
222600                                                                  22260002
222700     EXEC CICS                                                    22270002
222800         WRITEQ TS                                                22280002
222900             QUEUE (ASC-LIST-QUEUE-NAME)                          22290002
223000             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               22300002
223100             ITEM  (PV-BLOCK-NUMBER)                              22310002
223200             REWRITE                                              22320002
223300             RESP  (PV-CICS-RESP)                                 22330002
223400     END-EXEC.                                                    22340002
223500                                                                  22350002
223600     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           22360002
223700         CONTINUE                                                 22370002
223800     ELSE                                                         22380002
223900         SET DP013-CICS-ABEND            TO TRUE                  22390002
224000         SET DP013-NO-ROLLBACK           TO TRUE                  22400002
224100         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       22410002
224200         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     22420002
224300                                         TO DP013-MESSAGE-TEXT(1) 22430002
224400         PERFORM DP013-0000-PROCESS-ABEND                         22440002
224500     END-IF.                                                      22450002
224600                                                                  22460002
224700                                                                  22470002
224800*-----------------------------------------------------------------22480002
224900* WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-         22490002
225000* SPECIFIC COMMAREA.                                              22500002
225100*-----------------------------------------------------------------22510002
225200                                                                  22520002
225300 5110-WRITE-ASC-LISTQ.                                            22530002
225400                                                                  22540002
225500     EXEC CICS                                                    22550002
225600         WRITEQ TS                                                22560002
225700             QUEUE (ASC-LIST-QUEUE-NAME)                          22570002
225800             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               22580002
225900             ITEM  (PV-BLOCK-NUMBER)                              22590002
226000             RESP  (PV-CICS-RESP)                                 22600002
226100     END-EXEC.                                                    22610002
226200     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      22620002
226300         SET DP013-CICS-ABEND      TO TRUE                        22630002
226400         SET DP013-NO-ROLLBACK     TO TRUE                        22640002
226500         MOVE '5110-WRITE-ASC-LISTQ'                              22650002
226600                                   TO DP013-PARAGRAPH             22660002
226700         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           22670002
226800                                   TO DP013-MESSAGE-TEXT(1)       22680002
226900         PERFORM DP013-0000-PROCESS-ABEND                         22690002
227000     END-IF.                                                      22700002
227100                                                                  22710002
227200                                                                  22720002
227300*-----------------------------------------------------------------22730002
227400* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS  22740002
227500* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.                22750002
227600*-----------------------------------------------------------------22760002
227700                                                                  22770002
227800 5200-FILL-SEL-QUEUE-RECORD.                                      22780002
227900                                                                  22790002
228000     PERFORM 6112-READ-LIST-QUEUE.                                22800002
228100                                                                  22810002
228200     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       22820002
228300         PERFORM                                                  22830002
228400         VARYING LQW-IDX                                          22840002
228500         FROM 1 BY 1                                              22850002
228600         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            22860002
228700           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          22870002
228800                                                                  22880002
228900             IF  LQW-SELECT (LQW-IDX)                             22890002
229000                 MOVE LQW-LIST-ITEM-NUMBER  (LQW-IDX)             22900002
229100                      TO ET346-ITEM         (ET346-IDX)           22910002
229200                 MOVE SPACE                                       22920002
229300                      TO ET346-ACTION-SW    (ET346-IDX)           22930002
229400                 MOVE LQW-TP-DKEY           (LQW-IDX)             22940002
229500                      TO ET346-TP-DKEY      (ET346-IDX)           22950002
229600                 MOVE LQW-TP-DKEY-TMST      (LQW-IDX)             22960002
229700                      TO ET346-TP-DKEY-TMST (ET346-IDX)           22970002
229800                 MOVE LQW-TRN-SET-CDE       (LQW-IDX)             22980002
229900                      TO ET346-TRN-SET-CDE  (ET346-IDX)           22990002
230000                 MOVE LQW-VENDOR-NAME       (LQW-IDX)             23000002
230100                      TO ET346-VENDOR-NAME  (ET346-IDX)           23010002
230200                 SET ET346-IDX UP BY 1                            23020002
230300                 IF  ET346-IDX > ET346-MAX-ITEMS                  23030002
230400                     PERFORM 5205-WRITE-SEL-QUEUE                 23040002
230500                     ADD +1        TO ET345-NUMBER-OF-TS-ITEMS    23050002
230600                     INITIALIZE ET346-SELECTED-ITEM-ARRAY         23060002
230700                     SET ET346-IDX TO  1                          23070002
230800                 END-IF                                           23080002
230900             END-IF                                               23090002
231000         END-PERFORM                                              23100002
231100     END-IF.                                                      23110002
231200                                                                  23120002
231300                                                                  23130002
231400*-----------------------------------------------------------------23140002
231500*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                 23150002
231600*-----------------------------------------------------------------23160002
231700                                                                  23170002
231800 5205-WRITE-SEL-QUEUE.                                            23180002
231900                                                                  23190002
232000     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            23200002
232100                                   TO ET346-SELECTED-ITEMS.       23210002
232200                                                                  23220002
232300     EXEC CICS                                                    23230002
232400          WRITEQ TS                                               23240002
232500              QUEUE (ASC-SEL-QUEUE-NAME)                          23250002
232600              FROM  (ET346-SELECTED-ITEMS-AREA)                   23260002
232700              ITEM  (PV-SEL-QUEUE-ITEM)                           23270002
232800              RESP  (PV-CICS-RESP)                                23280002
232900     END-EXEC.                                                    23290002
233000                                                                  23300002
233100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          23310002
233200         CONTINUE                                                 23320002
233300     ELSE                                                         23330002
233400         SET DP013-CICS-ABEND      TO TRUE                        23340002
233500         SET DP013-NO-ROLLBACK     TO TRUE                        23350002
233600         MOVE '5205-WRITE-SEL-QUEUE'                              23360002
233700                                   TO DP013-PARAGRAPH             23370002
233800         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          23380002
233900                                   TO DP013-MESSAGE-TEXT(1)       23390002
234000         PERFORM DP013-0000-PROCESS-ABEND                         23400002
234100     END-IF.                                                      23410002
234200                                                                  23420002
234300                                                                  23430002
234400*-----------------------------------------------------------------23440002
234500* WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,    23450002
234600* SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT    23460002
234700* THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO       23470002
234800* THE USER.                                                       23480002
234900*-----------------------------------------------------------------23490002
235000                                                                  23500002
235100 6000-REFRESH-PANEL-FROM-TEMP.                                    23510002
235200                                                                  23520002
235300     IF  ASC-UPDATE-TSQ                                           23530002
235400         SET ASC-NO-TSQ-UPDATE TO TRUE                            23540002
235500         MOVE ZERO                 TO PV-SAVE-ITEM                23550002
235600                                      PV-SEL-QUEUE-ITEM           23560002
235700         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        23570002
235800                                   TO PV-HOLD-SELECTED-ITEMS      23580002
235900         PERFORM 6100-UPDATE-TSQ                                  23590002
236000             UNTIL PV-ITEMS-PROCESSED >                           23600002
236100                                     ASC-NUMBER-OF-SELECTED-ITEMS 23610002
236200         PERFORM 6010-DELETE-SEL-QUEUE                            23620002
236300         INITIALIZE ASC-BLOCK-ENTRIES (1)                         23630002
236400                    ASC-BLOCK-ENTRIES (2)                         23640002
236500                                                                  23650002
236600         DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                 23660002
236700                GIVING PV-BLOCK-NUMBER                            23670002
236800                REMAINDER PV-REMAINDER                            23680002
236900         IF  PV-REMAINDER > ZERO                                  23690002
237000             ADD +1     TO PV-BLOCK-NUMBER                        23700002
237100         END-IF                                                   23710002
237200         MOVE +1        TO ASC-BLK-SUB                            23720002
237300         PERFORM 4410-READ-TEMP-STORAGE                           23730002
237400         ADD +1         TO ASC-BLK-SUB                            23740002
237500                           PV-BLOCK-NUMBER                        23750002
237600         PERFORM 4410-READ-TEMP-STORAGE                           23760002
237700                                                                  23770002
237800     END-IF.                                                      23780002
237900                                                                  23790002
238000                                                                  23800002
238100*-----------------------------------------------------------------23810002
238200*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.                23820002
238300*-----------------------------------------------------------------23830002
238400                                                                  23840002
238500 6010-DELETE-SEL-QUEUE.                                           23850002
238600                                                                  23860002
238700     EXEC CICS                                                    23870002
238800         DELETEQ TS                                               23880002
238900             QUEUE (ASC-SEL-QUEUE-NAME)                           23890002
239000             RESP  (PV-CICS-RESP)                                 23900002
239100     END-EXEC.                                                    23910002
239200                                                                  23920002
239300     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      23930002
239400        (PV-CICS-RESP = DFHRESP(QIDERR)))                         23940002
239500         CONTINUE                                                 23950002
239600     ELSE                                                         23960002
239700         SET DP013-CICS-ABEND TO TRUE                             23970002
239800         SET DP013-NO-ROLLBACK TO TRUE                            23980002
239900         MOVE '6010-DELETE-SEL-QUEUE'                             23990002
240000                        TO DP013-PARAGRAPH                        24000002
240100         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         24010002
240200                        TO DP013-MESSAGE-TEXT (1)                 24020002
240300         PERFORM DP013-0000-PROCESS-ABEND                         24030002
240400     END-IF.                                                      24040002
240500                                                                  24050002
240600*-----------------------------------------------------------------24060002
240700* INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.          24070002
240800* LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER      24080002
240900* TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN        24090002
241000* THE TEMP QUEUE.                                                 24100002
241100*-----------------------------------------------------------------24110002
241200                                                                  24120002
241300 6100-UPDATE-TSQ.                                                 24130002
241400                                                                  24140002
241500     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             24150002
241600     PERFORM 6105-READ-SEL-QUEUE.                                 24160002
241700     PERFORM                                                      24170002
241800         VARYING ET346-IDX                                        24180002
241900         FROM 1 BY 1                                              24190002
242000         UNTIL ((PV-ITEMS-PROCESSED >                             24200002
242100                              PV-HOLD-SELECTED-ITEMS)             24210002
242200         OR (ET346-IDX GREATER THAN ET346-MAX-ITEMS))             24220002
242300         IF  ET346-ACTION-SW (ET346-IDX) > SPACE                  24230002
242400             PERFORM 6110-PROCESS-ITEMS                           24240002
242500         END-IF                                                   24250002
242600         ADD +1                TO PV-ITEMS-PROCESSED              24260002
242700     END-PERFORM.                                                 24270002
242800     PERFORM 6111-WRITE-LIST-QUEUE.                               24280002
242900                                                                  24290002
243000                                                                  24300002
243100*-----------------------------------------------------------------24310002
243200*    READ THE LIST QUEUE RECORD.                                  24320002
243300*-----------------------------------------------------------------24330002
243400                                                                  24340002
243500 6105-READ-SEL-QUEUE.                                             24350002
243600                                                                  24360002
243700     EXEC CICS                                                    24370002
243800          READQ TS                                                24380002
243900              QUEUE (ASC-SEL-QUEUE-NAME)                          24390002
244000              INTO  (ET346-SELECTED-ITEMS-AREA)                   24400002
244100              ITEM  (PV-SEL-QUEUE-ITEM)                           24410002
244200              RESP  (PV-CICS-RESP)                                24420002
244300     END-EXEC.                                                    24430002
244400                                                                  24440002
244500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          24450002
244600         CONTINUE                                                 24460002
244700     ELSE                                                         24470002
244800         SET DP013-CICS-ABEND      TO  TRUE                       24480002
244900         SET DP013-NO-ROLLBACK     TO  TRUE                       24490002
245000         MOVE '6105-READ-SEL-QUEUE'                               24500002
245100                                   TO  DP013-PARAGRAPH            24510002
245200         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           24520002
245300                                   TO  DP013-MESSAGE-TEXT(1)      24530002
245400         PERFORM DP013-0000-PROCESS-ABEND                         24540002
245500     END-IF.                                                      24550002
245600                                                                  24560002
245700                                                                  24570002
245800*-----------------------------------------------------------------24580002
245900* CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.    24590002
246000* REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE    24600002
246100* THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.               24610002
246200*-----------------------------------------------------------------24620002
246300                                                                  24630002
246400 6110-PROCESS-ITEMS.                                              24640002
246500                                                                  24650002
246600     COMPUTE PV-ITEM = 1 + ((ET346-ITEM (ET346-IDX) - 1)          24660002
246700                     / PC-ITEMS-PER-PANEL).                       24670002
246800                                                                  24680002
246900     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           24690002
247000         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          24700002
247100             PERFORM 6111-WRITE-LIST-QUEUE                        24710002
247200         END-IF                                                   24720002
247300         MOVE PV-ITEM          TO PV-SAVE-ITEM                    24730002
247400                                                                  24740002
247500         PERFORM 6112-READ-LIST-QUEUE                             24750002
247600         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               24760002
247700             CONTINUE                                             24770002
247800         END-IF                                                   24780002
247900     END-IF.                                                      24790002
248000                                                                  24800002
248100     COMPUTE PV-SUB = (ET346-ITEM (ET346-IDX)                     24810002
248200                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              24820002
248300     SET LQW-DESELECT (PV-SUB) TO    TRUE                         24830002
248400     MOVE LQW-SELECTED-SW (PV-SUB)                                24840002
248500                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  24850002
248600     EVALUATE TRUE                                                24860002
248700         WHEN ET346-INQ (ET346-IDX)                               24870002
248800              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             24880002
248900                                                                  24890002
249000         WHEN ET346-UPD (ET346-IDX)                               24900002
249100              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             24910002
249200                                                                  24920002
249300         WHEN ET346-DEL (ET346-IDX)                               24930002
249400              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             24940002
249500                                                                  24950002
249600         WHEN ET346-REL (ET346-IDX)                               24960002
249700              MOVE PC-REL      TO LQW-ACTION (PV-SUB)             24970002
249800                                                                  24980002
249900         WHEN ET346-ERR (ET346-IDX)                               24990002
250000              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             25000002
250100     END-EVALUATE.                                                25010002
250200                                                                  25020002
250300     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                25030002
250400                                                                  25040002
250500                                                                  25050002
250600*-----------------------------------------------------------------25060002
250700* WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.                 25070002
250800*-----------------------------------------------------------------25080002
250900                                                                  25090002
251000 6111-WRITE-LIST-QUEUE.                                           25100002
251100                                                                  25110002
251200     EXEC CICS                                                    25120002
251300         WRITEQ TS                                                25130002
251400             QUEUE (ASC-LIST-QUEUE-NAME)                          25140002
251500             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     25150002
251600             ITEM  (PV-SAVE-ITEM)                                 25160002
251700             REWRITE                                              25170002
251800             RESP  (PV-CICS-RESP)                                 25180002
251900     END-EXEC.                                                    25190002
252000*                                                                 25200002
252100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          25210002
252200         CONTINUE                                                 25220002
252300     ELSE                                                         25230002
252400         SET DP013-CICS-ABEND  TO  TRUE                           25240002
252500         SET DP013-NO-ROLLBACK TO  TRUE                           25250002
252600         MOVE '6111-WRITE-LIST-QUEUE'                             25260002
252700                               TO  DP013-PARAGRAPH                25270002
252800         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  25280002
252900                               TO  DP013-MESSAGE-TEXT(1)          25290002
253000         PERFORM DP013-0000-PROCESS-ABEND                         25300002
253100     END-IF.                                                      25310002
253200                                                                  25320002
253300                                                                  25330002
253400*-----------------------------------------------------------------25340002
253500* READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.    25350002
253600*-----------------------------------------------------------------25360002
253700                                                                  25370002
253800 6112-READ-LIST-QUEUE.                                            25380002
253900                                                                  25390002
254000     EXEC CICS                                                    25400002
254100         READQ TS                                                 25410002
254200             QUEUE (ASC-LIST-QUEUE-NAME)                          25420002
254300             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     25430002
254400             ITEM  (PV-ITEM)                                      25440002
254500             RESP  (PV-CICS-RESP)                                 25450002
254600     END-EXEC.                                                    25460002
254700*                                                                 25470002
254800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          25480002
254900         CONTINUE                                                 25490002
255000     ELSE                                                         25500002
255100         SET DP013-CICS-ABEND        TO TRUE                      25510002
255200         SET DP013-NO-ROLLBACK       TO TRUE                      25520002
255300         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           25530002
255400         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    25540002
255500                                     TO DP013-MESSAGE-TEXT(1)     25550002
255600         PERFORM DP013-0000-PROCESS-ABEND                         25560002
255700     END-IF.                                                      25570002
255800                                                                  25580002
255900                                                                  25590002
256000 7000-DELETE-SELECTED-DOCUMENTS.                                  25600002
256100                                                                  25610002
256200     MOVE +1                   TO  ASC-BLK-SUB.                   25620002
256300     PERFORM 5100-WRITE-TEMP-STORAGE.                             25630002
256400     ADD +1                    TO  ASC-BLK-SUB.                   25640002
256500     PERFORM 5100-WRITE-TEMP-STORAGE.                             25650002
256600                                                                  25660002
256700     SET PS-DELETES-SUCCESSFUL TO TRUE.                           25670002
256800                                                                  25680002
256900     PERFORM                                                      25690002
257000       VARYING PV-ITEM FROM 1 BY 1                                25700002
257100       UNTIL PV-ITEM > ASC-HIGHEST-BLOCK-WRITTEN                  25710002
257200          OR PS-DELETES-UNSUCCESSFUL                              25720002
257300         PERFORM 6112-READ-LIST-QUEUE                             25730002
257400         IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                   25740002
257500             PERFORM                                              25750002
257600               VARYING LQW-IDX FROM 1 BY 1                        25760002
257700               UNTIL LQW-IDX > PC-ITEMS-PER-PANEL                 25770002
257800                  OR LQW-LIST-ITEM-NUMBER (LQW-IDX) = ZERO        25780002
257900                  OR PS-DELETES-UNSUCCESSFUL                      25790002
258000                 IF LQW-SELECT (LQW-IDX)                          25800002
258100                     PERFORM 7100-DELETE-DOCUMENT                 25810002
258200                 END-IF                                           25820002
258300             END-PERFORM                                          25830002
258400         END-IF                                                   25840002
258500     END-PERFORM.                                                 25850002
258600                                                                  25860002
258700*    *------------------------------------------------------------25870002
258800*    * IF ALL DELETES WERE DONE SUCCESSFULLY, GO BACK AND MARK THE25880002
258900*    * DELETED DOCUMENTS AND DESELECT THEM IN THE LIST QUEUE.     25890002
259000*    *------------------------------------------------------------25900002
259100                                                                  25910002
259200     IF PS-DELETES-SUCCESSFUL                                     25920002
259300         PERFORM                                                  25930002
259400           VARYING PV-ITEM FROM 1 BY 1                            25940002
259500           UNTIL PV-ITEM > ASC-HIGHEST-BLOCK-WRITTEN              25950002
259600             PERFORM 6112-READ-LIST-QUEUE                         25960002
259700             IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)               25970002
259800                 MOVE PV-ITEM TO PV-SAVE-ITEM                     25980002
259900                 PERFORM                                          25990002
260000                   VARYING LQW-IDX FROM 1 BY 1                    26000002
260100                   UNTIL LQW-IDX > PC-ITEMS-PER-PANEL             26010002
260200                      OR LQW-LIST-ITEM-NUMBER (LQW-IDX) = ZERO    26020002
260300                                                                  26030002
260400                     IF LQW-SELECT (LQW-IDX)                      26040002
260500                         SET  LQW-DESELECT (LQW-IDX) TO TRUE      26050002
260600                         MOVE LQW-SELECTED-SW (LQW-IDX)           26060002
260700                                 TO LQW-TEMP-SELECTED-SW (LQW-IDX)26070002
260800                         MOVE PC-DEL TO LQW-ACTION (LQW-IDX)      26080002
260900                         SUBTRACT 1                               26090002
261000                             FROM ASC-NUMBER-OF-SELECTED-ITEMS    26100002
261100                     END-IF                                       26110002
261200                 END-PERFORM                                      26120002
261300                 PERFORM 6111-WRITE-LIST-QUEUE                    26130002
261400             END-IF                                               26140002
261500         END-PERFORM                                              26150002
261600                                                                  26160002
261700         SET DP020-MSG-INFORMATIONAL TO TRUE                      26170002
261800*        ---- DELETE SUCCESSFUL ----                              26180002
261900         MOVE PC-TSYMSG-00115  TO DP020-MSG-NUMBER                26190002
262000         MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL        26200002
262100         INITIALIZE ASC-BLOCK-ENTRIES (1)                         26210002
262200                    ASC-BLOCK-ENTRIES (2)                         26220002
262300                                                                  26230002
262400         DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                 26240002
262500                GIVING PV-BLOCK-NUMBER                            26250002
262600                REMAINDER PV-REMAINDER                            26260002
262700         IF  PV-REMAINDER > ZERO                                  26270002
262800             ADD +1     TO PV-BLOCK-NUMBER                        26280002
262900         END-IF                                                   26290002
263000         MOVE +1        TO ASC-BLK-SUB                            26300002
263100         PERFORM 4410-READ-TEMP-STORAGE                           26310002
263200         ADD +1         TO ASC-BLK-SUB                            26320002
263300                           PV-BLOCK-NUMBER                        26330002
263400         PERFORM 4410-READ-TEMP-STORAGE                           26340002
263500     ELSE                                                         26350002
263600         SET DP020-MSG-FATAL TO TRUE                              26360002
263700*        ---- DATA IN USE, CANNOT DELETE ----                     26370002
263800         MOVE PC-TSYMSG-00149  TO DP020-MSG-NUMBER                26380002
263900     END-IF.                                                      26390002
264000                                                                  26400002
264100     SET ASC-NO-DELETE-PENDING TO TRUE.                           26410002
264200     PERFORM 3200-RESET-ATTRIBUTES.                               26420002
264300                                                                  26430002
264400                                                                  26440002
264500 7100-DELETE-DOCUMENT.                                            26450002
264600                                                                  26460002
264700     MOVE LQW-TP-DKEY      (LQW-IDX) TO PV-DB2-TP-DKEY.           26470002
264800     MOVE LQW-TP-DKEY-TMST (LQW-IDX) TO PV-DB2-TP-DKEY-TMST.      26480002
264900                                                                  26490002
265000     PERFORM Z830-DELETE-FROM-TFGTRDT.                            26500002
265100     IF PS-DELETES-SUCCESSFUL                                     26510002
265200         PERFORM Z840-DELETE-FROM-TTRPOHL                         26520002
265300         IF PS-DELETES-SUCCESSFUL                                 26530002
265400             PERFORM Z850-UPDATE-TFGTRHL-FOR-DLET                 26540002
265500         END-IF                                                   26550002
265600     END-IF.                                                      26560002
265700                                                                  26570002
265800                                                                  26580002
265900 7200-RLEASE-SELECTED-DOCUMENTS.                                  26590002
266000                                                                  26600002
266100     MOVE +1                   TO  ASC-BLK-SUB.                   26610002
266200     PERFORM 5100-WRITE-TEMP-STORAGE.                             26620002
266300     ADD +1                    TO  ASC-BLK-SUB.                   26630002
266400     PERFORM 5100-WRITE-TEMP-STORAGE.                             26640002
266500                                                                  26650002
266600     SET PS-RELEASES-SUCCESSFUL TO TRUE.                          26660002
266700                                                                  26670002
266800     PERFORM                                                      26680002
266900       VARYING PV-ITEM FROM 1 BY 1                                26690002
267000       UNTIL PV-ITEM > ASC-HIGHEST-BLOCK-WRITTEN                  26700002
267100          OR PS-RELEASES-UNSUCCESSFUL                             26710002
267200         PERFORM 6112-READ-LIST-QUEUE                             26720002
267300         IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                   26730002
267400             PERFORM                                              26740002
267500               VARYING LQW-IDX FROM 1 BY 1                        26750002
267600               UNTIL LQW-IDX > PC-ITEMS-PER-PANEL                 26760002
267700                  OR LQW-LIST-ITEM-NUMBER (LQW-IDX) = ZERO        26770002
267800                  OR PS-RELEASES-UNSUCCESSFUL                     26780002
267900                 IF LQW-SELECT (LQW-IDX)                          26790002
268000                     PERFORM 7300-RELEASE-DOCUMENT                26800002
268100                 END-IF                                           26810002
268200             END-PERFORM                                          26820002
268300         END-IF                                                   26830002
268400     END-PERFORM.                                                 26840002
268500                                                                  26850002
268600*    *------------------------------------------------------------26860002
268700*    * IF ALL RELEASES WERE DONE SUCCESSFULLY, GO BACK AND MARK   26870002
268800*    * THE RELEASED DOCUMENTS AND DESELECT THEM IN THE LIST QUEUE.26880002
268900*    *------------------------------------------------------------26890002
269000                                                                  26900002
269100     IF PS-RELEASES-SUCCESSFUL                                    26910002
269200         PERFORM                                                  26920002
269300           VARYING PV-ITEM FROM 1 BY 1                            26930002
269400           UNTIL PV-ITEM > ASC-HIGHEST-BLOCK-WRITTEN              26940002
269500             PERFORM 6112-READ-LIST-QUEUE                         26950002
269600             IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)               26960002
269700                 MOVE PV-ITEM TO PV-SAVE-ITEM                     26970002
269800                 PERFORM                                          26980002
269900                   VARYING LQW-IDX FROM 1 BY 1                    26990002
270000                   UNTIL LQW-IDX > PC-ITEMS-PER-PANEL             27000002
270100                      OR LQW-LIST-ITEM-NUMBER (LQW-IDX) = ZERO    27010002
270200                                                                  27020002
270300                     IF LQW-SELECT (LQW-IDX)                      27030002
270400                         SET  LQW-DESELECT (LQW-IDX) TO TRUE      27040002
270500                         MOVE LQW-SELECTED-SW (LQW-IDX)           27050002
270600                                 TO LQW-TEMP-SELECTED-SW (LQW-IDX)27060002
270700                         MOVE PC-REL TO LQW-ACTION (LQW-IDX)      27070002
270800                         SUBTRACT 1                               27080002
270900                             FROM ASC-NUMBER-OF-SELECTED-ITEMS    27090002
271000                     END-IF                                       27100002
271100                 END-PERFORM                                      27110002
271200                 PERFORM 6111-WRITE-LIST-QUEUE                    27120002
271300             END-IF                                               27130002
271400         END-PERFORM                                              27140002
271500         SET DP020-MSG-INFORMATIONAL TO TRUE                      27150002
271600*        ---- UPDATE(S) SUCCESSFUL ----                           27160002
271700         MOVE PC-TSYMSG-00059  TO DP020-MSG-NUMBER                27170002
271800         MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL        27180002
271900         INITIALIZE ASC-BLOCK-ENTRIES (1)                         27190002
272000                    ASC-BLOCK-ENTRIES (2)                         27200002
272100                                                                  27210002
272200         DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                 27220002
272300                GIVING PV-BLOCK-NUMBER                            27230002
272400                REMAINDER PV-REMAINDER                            27240002
272500         IF  PV-REMAINDER > ZERO                                  27250002
272600             ADD +1     TO PV-BLOCK-NUMBER                        27260002
272700         END-IF                                                   27270002
272800         MOVE +1        TO ASC-BLK-SUB                            27280002
272900         PERFORM 4410-READ-TEMP-STORAGE                           27290002
273000         ADD +1         TO ASC-BLK-SUB                            27300002
273100                           PV-BLOCK-NUMBER                        27310002
273200         PERFORM 4410-READ-TEMP-STORAGE                           27320002
273300     ELSE                                                         27330002
273400         SET DP020-MSG-FATAL TO TRUE                              27340002
273500*        ---- UPDATES UNSUCCESSFUL - FILE UNAVAILABLE ----        27350002
273600         MOVE PC-TSYMSG-00660  TO DP020-MSG-NUMBER                27360002
273700     END-IF.                                                      27370002
273800                                                                  27380002
273900     SET ASC-NO-RELEASE-PENDING TO TRUE.                          27390002
274000     PERFORM 3200-RESET-ATTRIBUTES.                               27400002
274100                                                                  27410002
274200                                                                  27420002
274300 7300-RELEASE-DOCUMENT.                                           27430002
274400                                                                  27440002
274500     MOVE LQW-TP-DKEY      (LQW-IDX) TO PV-DB2-TP-DKEY.           27450002
274600     MOVE LQW-TP-DKEY-TMST (LQW-IDX) TO PV-DB2-TP-DKEY-TMST.      27460002
274700                                                                  27470002
274800     PERFORM Z860-UPDATE-TTRPOHL-FOR-RLSE.                        27480002
274900     IF PS-RELEASES-SUCCESSFUL                                    27490002
275000         PERFORM Z870-UPDATE-TFGTRHL-FOR-RLSE                     27500002
275100     END-IF.                                                      27510002
275200                                                                  27520002
275300                                                                  27530002
275400*-----------------------------------------------------------------27540002
275500* OPEN THE APPROPRIATE CURSOR.                                    27550002
275600*-----------------------------------------------------------------27560002
275700                                                                  27570002
275800 Z800-OPEN-CURSOR.                                                27580002
275900                                                                  27590002
276000     EVALUATE TRUE                                                27600002
276100         WHEN ASC-ALL-DOCS-CSR                                    27610002
276200             MOVE 'CURSOR:  ALL-DOCS-CSR'                         27620002
276300                               TO DP013-MESSAGE-TEXT (2)          27630002
276400             EXEC SQL                                             27640002
276500                  OPEN ALL-DOCS-CSR                               27650002
276600             END-EXEC                                             27660002
276700                                                                  27670002
276800         WHEN ASC-DEPT-CSR                                        27680002
276900             MOVE 'CURSOR:  DEPT-CSR'                             27690002
277000                               TO DP013-MESSAGE-TEXT (2)          27700002
277100             EXEC SQL                                             27710002
277200                  OPEN DEPT-CSR                                   27720002
277300             END-EXEC                                             27730002
277400                                                                  27740002
277500         WHEN ASC-WORKER-CSR                                      27750002
277600             MOVE 'CURSOR:  WORKER-CSR'                           27760002
277700                               TO DP013-MESSAGE-TEXT (2)          27770002
277800             EXEC SQL                                             27780002
277900                  OPEN WORKER-CSR                                 27790002
278000             END-EXEC                                             27800002
278100                                                                  27810002
278200     END-EVALUATE.                                                27820002
278300                                                                  27830002
278400     EVALUATE TRUE                                                27840002
278500         WHEN SQLCODE = ZERO                                      27850002
278600         WHEN SQLCODE = -904                                      27860002
278700         WHEN SQLCODE = -913                                      27870002
278800             CONTINUE                                             27880002
278900         WHEN SQLWARN0 NOT = SPACES                               27890002
279000         WHEN SQLCODE  NOT = ZERO                                 27900002
279100             MOVE 'Z800-OPEN-CURSOR'                              27910002
279200                               TO DP013-PARAGRAPH                 27920002
279300             MOVE SQLCA        TO DP013-SQLCA                     27930002
279400             EVALUATE TRUE                                        27940002
279500                 WHEN ASC-ALL-DOCS-CSR                            27950002
279600                     MOVE 'TFGTRHL'  TO DP013-DB2-TABLE-NAME (1)  27960002
279700                     MOVE 'TENTNME'  TO DP013-DB2-TABLE-NAME (2)  27970002
279800                     MOVE 'TTRNSET'  TO DP013-DB2-TABLE-NAME (3)  27980002
279900                     MOVE 'TTRDPRT'  TO DP013-DB2-TABLE-NAME (4)  27990002
280000                 WHEN ASC-DEPT-CSR                                28000002
280100                 WHEN ASC-WORKER-CSR                              28010002
280200                     MOVE 'TFGTRHL'  TO DP013-DB2-TABLE-NAME (1)  28020002
280300                     MOVE 'TTRPOHL'  TO DP013-DB2-TABLE-NAME (2)  28030002
280400                     MOVE 'TENTNME'  TO DP013-DB2-TABLE-NAME (3)  28040002
280500                     MOVE 'TTRNSET'  TO DP013-DB2-TABLE-NAME (4)  28050002
280600                     MOVE 'TTRDPRT'  TO DP013-DB2-TABLE-NAME (5)  28060002
280700             END-EVALUATE                                         28070002
280800             SET DP013-DB2-ABEND                                  28080002
280900                 DP013-XCTL-DISPLAY-RESTART TO TRUE               28090002
281000             PERFORM DP013-0000-PROCESS-ABEND                     28100002
281100     END-EVALUATE.                                                28110002
281200                                                                  28120002
281300                                                                  28130002
281400*-----------------------------------------------------------------28140002
281500* FETCH THE APPROPRIATE CURSOR.                                   28150002
281600*-----------------------------------------------------------------28160002
281700                                                                  28170002
281800 Z810-FETCH-CURSOR.                                               28180002
281900                                                                  28190002
282000     EVALUATE TRUE                                                28200002
282100         WHEN ASC-ALL-DOCS-CSR                                    28210002
282200             MOVE 'CURSOR:  ALL-DOCS-CSR'                         28220002
282300                               TO DP013-MESSAGE-TEXT (2)          28230002
282400             EXEC SQL                                             28240002
282500                  FETCH ALL-DOCS-CSR                              28250002
282600                  INTO                                            28260002
282700                       :FGTRHL-TRN-DTL-TXT                        28270002
282800                     , :FGTRHL-HOLD-DTE                           28280002
282900                     , :FGTRHL-TP-DKEY                            28290002
283000                     , :FGTRHL-TP-DKEY-TMST                       28300002
283100                     , :FGTRHL-TRN-SET-CDE                        28310002
283200                     , :ENTNME-ENT-NAME-DESC                      28320002
283300                     , :TRNSET-TRAN-SET-NME-ID                    28330002
283400             END-EXEC                                             28340002
283500                                                                  28350002
283600         WHEN ASC-DEPT-CSR                                        28360002
283700             MOVE 'CURSOR:  DEPT-CSR'                             28370002
283800                               TO DP013-MESSAGE-TEXT (2)          28380002
283900             EXEC SQL                                             28390002
284000                  FETCH DEPT-CSR                                  28400002
284100                  INTO                                            28410002
284200                       :FGTRHL-TRN-DTL-TXT                        28420002
284300                     , :FGTRHL-HOLD-DTE                           28430002
284400                     , :FGTRHL-TP-DKEY                            28440002
284500                     , :FGTRHL-TP-DKEY-TMST                       28450002
284600                     , :FGTRHL-TRN-SET-CDE                        28460002
284700                     , :ENTNME-ENT-NAME-DESC                      28470002
284800                     , :TRNSET-TRAN-SET-NME-ID                    28480002
284900             END-EXEC                                             28490002
285000                                                                  28500002
285100         WHEN ASC-WORKER-CSR                                      28510002
285200             MOVE 'CURSOR:  WORKER-CSR'                           28520002
285300                               TO DP013-MESSAGE-TEXT (2)          28530002
285400             EXEC SQL                                             28540002
285500                  FETCH WORKER-CSR                                28550002
285600                  INTO                                            28560002
285700                       :FGTRHL-TRN-DTL-TXT                        28570002
285800                     , :FGTRHL-HOLD-DTE                           28580002
285900                     , :FGTRHL-TP-DKEY                            28590002
286000                     , :FGTRHL-TP-DKEY-TMST                       28600002
286100                     , :FGTRHL-TRN-SET-CDE                        28610002
286200                     , :ENTNME-ENT-NAME-DESC                      28620002
286300                     , :TRNSET-TRAN-SET-NME-ID                    28630002
286400             END-EXEC                                             28640002
286500                                                                  28650002
286600     END-EVALUATE.                                                28660002
286700                                                                  28670002
286800     EVALUATE TRUE                                                28680002
286900         WHEN SQLCODE = ZERO                                      28690002
287000         WHEN SQLCODE = +100                                      28700002
287100              CONTINUE                                            28710002
287200         WHEN SQLWARN0 NOT = SPACE                                28720002
287300         WHEN SQLCODE  NOT = ZERO                                 28730002
287400             MOVE 'Z810-FETCH-CURSOR'                             28740002
287500                                 TO DP013-PARAGRAPH               28750002
287600             MOVE 'FETCH CURSOR' TO DP013-MESSAGE-TEXT (1)        28760002
287700             MOVE SQLCA          TO DP013-SQLCA                   28770002
287800             EVALUATE TRUE                                        28780002
287900                 WHEN ASC-ALL-DOCS-CSR                            28790002
288000                     MOVE 'TFGTRHL'  TO DP013-DB2-TABLE-NAME (1)  28800002
288100                     MOVE 'TENTNME'  TO DP013-DB2-TABLE-NAME (2)  28810002
288200                     MOVE 'TTRNSET'  TO DP013-DB2-TABLE-NAME (3)  28820002
288300                     MOVE 'TTRDPRT'  TO DP013-DB2-TABLE-NAME (4)  28830002
288400                 WHEN ASC-DEPT-CSR                                28840002
288500                 WHEN ASC-WORKER-CSR                              28850002
288600                     MOVE 'TFGTRHL'  TO DP013-DB2-TABLE-NAME (1)  28860002
288700                     MOVE 'TTRPOHL'  TO DP013-DB2-TABLE-NAME (2)  28870002
288800                     MOVE 'TENTNME'  TO DP013-DB2-TABLE-NAME (3)  28880002
288900                     MOVE 'TTRNSET'  TO DP013-DB2-TABLE-NAME (4)  28890002
289000                     MOVE 'TTRDPRT'  TO DP013-DB2-TABLE-NAME (5)  28900002
289100             END-EVALUATE                                         28910002
289200             SET DP013-DB2-ABEND TO TRUE                          28920002
289300             PERFORM DP013-0000-PROCESS-ABEND                     28930002
289400     END-EVALUATE.                                                28940002
289500                                                                  28950002
289600     IF  SQLCODE EQUAL +100                                       28960002
289700         SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                      28970002
289800     END-IF.                                                      28980002
289900                                                                  28990002
290000                                                                  29000002
290100*-----------------------------------------------------------------29010002
290200* CLOSE THE APPROPRIATE CURSOR.                                   29020002
290300*-----------------------------------------------------------------29030002
290400                                                                  29040002
290500 Z820-CLOSE-CURSOR.                                               29050002
290600                                                                  29060002
290700     EVALUATE TRUE                                                29070002
290800         WHEN ASC-ALL-DOCS-CSR                                    29080002
290900             MOVE 'CURSOR:  ALL-DOCS-CSR'                         29090002
291000                               TO DP013-MESSAGE-TEXT (2)          29100002
291100             EXEC SQL                                             29110002
291200                  CLOSE ALL-DOCS-CSR                              29120002
291300             END-EXEC                                             29130002
291400                                                                  29140002
291500         WHEN ASC-DEPT-CSR                                        29150002
291600             MOVE 'CURSOR:  DEPT-CSR'                             29160002
291700                               TO DP013-MESSAGE-TEXT (2)          29170002
291800             EXEC SQL                                             29180002
291900                  CLOSE DEPT-CSR                                  29190002
292000             END-EXEC                                             29200002
292100                                                                  29210002
292200         WHEN ASC-WORKER-CSR                                      29220002
292300             MOVE 'CURSOR:  WORKER-CSR'                           29230002
292400                               TO DP013-MESSAGE-TEXT (2)          29240002
292500             EXEC SQL                                             29250002
292600                  CLOSE WORKER-CSR                                29260002
292700             END-EXEC                                             29270002
292800                                                                  29280002
292900     END-EVALUATE.                                                29290002
293000                                                                  29300002
293100     EVALUATE TRUE                                                29310002
293200         WHEN SQLCODE = ZERO                                      29320002
293300             CONTINUE                                             29330002
293400         WHEN SQLWARN0 NOT = SPACES                               29340002
293500         WHEN SQLCODE  NOT = ZERO                                 29350002
293600             MOVE 'Z820-CLOSE-CURSOR'                             29360002
293700                                 TO DP013-PARAGRAPH               29370002
293800             MOVE 'CLOSE CURSOR' TO DP013-MESSAGE-TEXT (1)        29380002
293900             MOVE SQLCA          TO DP013-SQLCA                   29390002
294000             EVALUATE TRUE                                        29400002
294100                 WHEN ASC-ALL-DOCS-CSR                            29410002
294200                     MOVE 'TFGTRHL'  TO DP013-DB2-TABLE-NAME (1)  29420002
294300                     MOVE 'TENTNME'  TO DP013-DB2-TABLE-NAME (2)  29430002
294400                     MOVE 'TTRNSET'  TO DP013-DB2-TABLE-NAME (3)  29440002
294500                     MOVE 'TTRDPRT'  TO DP013-DB2-TABLE-NAME (4)  29450002
294600                 WHEN ASC-DEPT-CSR                                29460002
294700                 WHEN ASC-WORKER-CSR                              29470002
294800                     MOVE 'TFGTRHL'  TO DP013-DB2-TABLE-NAME (1)  29480002
294900                     MOVE 'TTRPOHL'  TO DP013-DB2-TABLE-NAME (2)  29490002
295000                     MOVE 'TENTNME'  TO DP013-DB2-TABLE-NAME (3)  29500002
295100                     MOVE 'TTRNSET'  TO DP013-DB2-TABLE-NAME (4)  29510002
295200                     MOVE 'TTRDPRT'  TO DP013-DB2-TABLE-NAME (5)  29520002
295300             END-EVALUATE                                         29530002
295400             SET DP013-DB2-ABEND                                  29540002
295500                 DP013-XCTL-DISPLAY-RESTART TO TRUE               29550002
295600             PERFORM DP013-0000-PROCESS-ABEND                     29560002
295700     END-EVALUATE.                                                29570002
295800                                                                  29580002
295900                                                                  29590002
296000 Z830-DELETE-FROM-TFGTRDT.                                        29600002
296100                                                                  29610002
296200     EXEC SQL                                                     29620002
296300         DELETE FROM TFGTRDT                                      29630002
296400         WHERE TP_DKEY =     :PV-DB2-TP-DKEY                      29640002
296500           AND TP_DKEY_TMST= :PV-DB2-TP-DKEY-TMST                 29650002
296600     END-EXEC.                                                    29660002
296700                                                                  29670002
296800     EVALUATE TRUE                                                29680002
296900         WHEN SQLCODE = ZERO                                      29690002
297000         WHEN SQLCODE = +100                                      29700002
297100             CONTINUE                                             29710002
297200         WHEN SQLCODE = -904                                      29720002
297300         WHEN SQLCODE = -913                                      29730002
297400             EXEC CICS                                            29740002
297500                 SYNCPOINT                                        29750002
297600                     ROLLBACK                                     29760002
297700             END-EXEC                                             29770002
297800             SET PS-DELETES-UNSUCCESSFUL TO TRUE                  29780002
297900         WHEN SQLWARN0 NOT = SPACES                               29790002
298000         WHEN SQLCODE  NOT = ZERO                                 29800002
298100             MOVE 'Z830-DELETE-FROM-TFGTRDT'                      29810002
298200                               TO DP013-PARAGRAPH                 29820002
298300             MOVE 'DELETE ROW(S) FROM EDI FG/TSET HELD DATA TABLE'29830002
298400                               TO DP013-MESSAGE-TEXT(1)           29840002
298500             MOVE SQLCA        TO DP013-SQLCA                     29850002
298600             MOVE 'TFGTRDT'    TO DP013-DB2-TABLE-NAME (1)        29860002
298700             SET DP013-DB2-ABEND                                  29870002
298800                 DP013-XCTL-DISPLAY-RESTART TO TRUE               29880002
298900             PERFORM DP013-0000-PROCESS-ABEND                     29890002
299000     END-EVALUATE.                                                29900002
299100                                                                  29910002
299200                                                                  29920002
299300 Z840-DELETE-FROM-TTRPOHL.                                        29930002
299400                                                                  29940002
299500     EXEC SQL                                                     29950002
299600         DELETE FROM TTRPOHL                                      29960002
299700         WHERE TP_DKEY =     :PV-DB2-TP-DKEY                      29970002
299800           AND TP_DKEY_TMST= :PV-DB2-TP-DKEY-TMST                 29980002
299900     END-EXEC.                                                    29990002
300000                                                                  30000002
300100     EVALUATE TRUE                                                30010002
300200         WHEN SQLCODE = ZERO                                      30020002
300300         WHEN SQLCODE = +100                                      30030002
300400             CONTINUE                                             30040002
300500         WHEN SQLCODE = -904                                      30050002
300600         WHEN SQLCODE = -913                                      30060002
300700             EXEC CICS                                            30070002
300800                 SYNCPOINT                                        30080002
300900                     ROLLBACK                                     30090002
301000             END-EXEC                                             30100002
301100             SET PS-DELETES-UNSUCCESSFUL TO TRUE                  30110002
301200         WHEN SQLWARN0 NOT = SPACES                               30120002
301300         WHEN SQLCODE  NOT = ZERO                                 30130002
301400             MOVE 'Z840-DELETE-FROM-TTRPOHL'                      30140002
301500                               TO DP013-PARAGRAPH                 30150002
301600             MOVE 'DELETE ROW(S) FROM DOCUMENT P.O. HOLD TABLE'   30160002
301700                               TO DP013-MESSAGE-TEXT(1)           30170002
301800             MOVE SQLCA        TO DP013-SQLCA                     30180002
301900             MOVE 'TTRPOHL'    TO DP013-DB2-TABLE-NAME (1)        30190002
302000             SET DP013-DB2-ABEND                                  30200002
302100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               30210002
302200             PERFORM DP013-0000-PROCESS-ABEND                     30220002
302300     END-EVALUATE.                                                30230002
302400                                                                  30240002
302500                                                                  30250002
302600 Z850-UPDATE-TFGTRHL-FOR-DLET.                                    30260002
302700                                                                  30270002
302800     EXEC SQL                                                     30280002
302900         UPDATE TFGTRHL                                           30290002
303000             SET    RLSE_IND        = :PC-RLSE-IND-DELETED        30300002
303100                   ,RLSE_DTE        =  DATE(CURRENT TIMESTAMP)    30310002
303200                   ,USER_ID         = :DP020-USERID               30320002
303300             WHERE  TP_DKEY         = :PV-DB2-TP-DKEY             30330002
303400               AND  TP_DKEY_TMST    = :PV-DB2-TP-DKEY-TMST        30340002
303500     END-EXEC.                                                    30350002
303600                                                                  30360002
303700     EVALUATE TRUE                                                30370002
303800         WHEN SQLCODE = ZERO                                      30380002
303900             CONTINUE                                             30390002
304000         WHEN SQLCODE = -904                                      30400002
304100         WHEN SQLCODE = -913                                      30410002
304200             EXEC CICS                                            30420002
304300                 SYNCPOINT                                        30430002
304400                     ROLLBACK                                     30440002
304500             END-EXEC                                             30450002
304600             SET PS-DELETES-UNSUCCESSFUL TO TRUE                  30460002
304700         WHEN SQLWARN0 NOT = SPACES                               30470002
304800         WHEN SQLCODE  NOT = ZERO                                 30480002
304900             MOVE 'Z850-UPDATE-TFGTRHL-FOR-DLET'                  30490002
305000                               TO DP013-PARAGRAPH                 30500002
305100             MOVE 'UPDATE A ROW ON THE FG/TSET XMIT HOLD TABLE'   30510002
305200                               TO DP013-MESSAGE-TEXT(1)           30520002
305300             MOVE SQLCA        TO DP013-SQLCA                     30530002
305400             MOVE 'TFGTRHL'    TO DP013-DB2-TABLE-NAME (1)        30540002
305500             SET DP013-DB2-ABEND                                  30550002
305600                 DP013-XCTL-DISPLAY-RESTART TO TRUE               30560002
305700             PERFORM DP013-0000-PROCESS-ABEND                     30570002
305800     END-EVALUATE.                                                30580002
305900                                                                  30590002
306000                                                                  30600002
306100 Z860-UPDATE-TTRPOHL-FOR-RLSE.                                    30610002
306200                                                                  30620002
306300     EXEC SQL                                                     30630002
306400         UPDATE TTRPOHL                                           30640002
306500             SET    PO_RLSE_IND     = :PC-RLSE-IND-RELEASED       30650002
306600             WHERE  TP_DKEY         = :PV-DB2-TP-DKEY             30660002
306700               AND  TP_DKEY_TMST    = :PV-DB2-TP-DKEY-TMST        30670002
306800     END-EXEC.                                                    30680002
306900                                                                  30690002
307000     EVALUATE TRUE                                                30700002
307100         WHEN SQLCODE = ZERO                                      30710002
307200             CONTINUE                                             30720002
307300         WHEN SQLCODE = -904                                      30730002
307400         WHEN SQLCODE = -913                                      30740002
307500             EXEC CICS                                            30750002
307600                 SYNCPOINT                                        30760002
307700                     ROLLBACK                                     30770002
307800             END-EXEC                                             30780002
307900             SET PS-RELEASES-UNSUCCESSFUL TO TRUE                 30790002
308000         WHEN SQLWARN0 NOT = SPACES                               30800002
308100         WHEN SQLCODE  NOT = ZERO                                 30810002
308200             MOVE 'Z860-UPDATE-TTRPOHL-FOR-RLSE'                  30820002
308300                               TO DP013-PARAGRAPH                 30830002
308400             MOVE 'UPDATE A ROW ON THE DOCUMENT P.O. HOLD TABLE'  30840002
308500                               TO DP013-MESSAGE-TEXT(1)           30850002
308600             MOVE SQLCA        TO DP013-SQLCA                     30860002
308700             MOVE 'TTRPOHL'    TO DP013-DB2-TABLE-NAME (1)        30870002
308800             SET DP013-DB2-ABEND                                  30880002
308900                 DP013-XCTL-DISPLAY-RESTART TO TRUE               30890002
309000             PERFORM DP013-0000-PROCESS-ABEND                     30900002
309100     END-EVALUATE.                                                30910002
309200                                                                  30920002
309300                                                                  30930002
309400 Z870-UPDATE-TFGTRHL-FOR-RLSE.                                    30940002
309500                                                                  30950002
309600     EXEC SQL                                                     30960002
309700         UPDATE TFGTRHL                                           30970002
309800             SET    RLSE_IND        = :PC-RLSE-IND-RELEASED       30980002
309900                   ,RLSE_DTE        = :PC-EMPTY-DATE              30990002
310000                   ,USER_ID         = :DP020-USERID               31000002
310100             WHERE  TP_DKEY         = :PV-DB2-TP-DKEY             31010002
310200               AND  TP_DKEY_TMST    = :PV-DB2-TP-DKEY-TMST        31020002
310300     END-EXEC.                                                    31030002
310400                                                                  31040002
310500     EVALUATE TRUE                                                31050002
310600         WHEN SQLCODE = ZERO                                      31060002
310700             CONTINUE                                             31070002
310800         WHEN SQLCODE = -904                                      31080002
310900         WHEN SQLCODE = -913                                      31090002
311000             EXEC CICS                                            31100002
311100                 SYNCPOINT                                        31110002
311200                     ROLLBACK                                     31120002
311300             END-EXEC                                             31130002
311400             SET PS-RELEASES-UNSUCCESSFUL TO TRUE                 31140002
311500         WHEN SQLWARN0 NOT = SPACES                               31150002
311600         WHEN SQLCODE  NOT = ZERO                                 31160002
311700             MOVE 'Z870-UPDATE-TFGTRHL-FOR-RLSE'                  31170002
311800                               TO DP013-PARAGRAPH                 31180002
311900             MOVE 'UPDATE A ROW ON THE FG/TSET XMIT HOLD TABLE'   31190002
312000                               TO DP013-MESSAGE-TEXT(1)           31200002
312100             MOVE SQLCA        TO DP013-SQLCA                     31210002
312200             MOVE 'TFGTRHL'    TO DP013-DB2-TABLE-NAME (1)        31220002
312300             SET DP013-DB2-ABEND                                  31230002
312400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               31240002
312500             PERFORM DP013-0000-PROCESS-ABEND                     31250002
312600     END-EVALUATE.                                                31260002
312700                                                                  31270002
312800                                                                  31280002
312900*----------------------------------------------------------------*31290002
313000*    CURRENT SYSTEM DATE/TIME MODULE                              31300002
313100*----------------------------------------------------------------*31310002
313200                                                                  31320002
313300     COPY DPPD017.                                                31330002
313400                                                                  31340002
313500                                                                  31350002
313600*-----------------------------------------------------------------31360002
313700*    ABEND PROCESSOR MODULE                                       31370002
313800*-----------------------------------------------------------------31380002
313900                                                                  31390002
314000     COPY DPPD013.                                                31400002
