000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    SUKCS590.                                         00040000
000500 AUTHOR.        LARRY SCHLEICHER.                                 00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  01-29-02.                                         00070000
000800 DATE-COMPILED.                                                   00080000
000900*----------------------------------------------------------------*00090000
001500*    CHANGES                                                     *00091000
      *    MADE BY: SHOBHIT BAIJAL       PR#5148D                      *00092000
      *    DATE:    10/15/2013                                         *00093000
      *                                                                *00094000
      *    NEW PACKAGING TYPE 'RF' WAS ADDED FOR RFID AUDITS AND LOGIC *00095000
      *    TO POPULATE RFID ERRORS.                                    *00096000
      *    CHANGES CAN BE FOUND WITH *SB 10/15/13                      *00097000
001130*                                                                 00097121
001110* CHANGED 01/09/2023    BY JEAN KURK       WR: CHG0278099         00097221
001120* CHANGE CALL OF DPKCS030 TO BE DYNAMIC                           00097321
001600*----------------------------------------------------------------*00098000
001000                                                                  00100000
001100 DATA DIVISION.                                                   00110000
001200 WORKING-STORAGE SECTION.                                         00120000
001300                                                                  00130000
001400 01  DK-DB2-KEYS.                                                 00140000
001500     05  DK-OPER-UNT-ID               PIC S9(04) COMP VALUE +0.   00150000
001600     05  DK-AUDIT-NBR                 PIC S9(09)  COMP.           00160000
001700     05  DK-ENT-ID                    PIC S9(09)  COMP.           00170000
001800     05  DK-DEPT-NBR                  PIC  X(03).                 00180000
001900     05  DK-SKU-NBR                   PIC  X(15).                 00190000
002000     05  DK-SKU-NBR-X   REDEFINES DK-SKU-NBR.                     00200000
002100         10  DK-SKU-DEPT-NBR          PIC  X(03).                 00210000
002200         10  FILLER                   PIC  X(01).                 00220000
002300         10  DK-SKU-CL-NBR            PIC  X(02).                 00230000
002400         10  FILLER                   PIC  X(01).                 00240000
002500         10  DK-SKU-SKU               PIC  X(08).                 00250000
002600     05  DN-PO                        PIC S9(04) COMP VALUE ZERO. 00260000
002700                                                                  00270000
002800 01  PC-PROGRAM-CONSTANTS.                                        00280000
002900     05  PC-INTER-APPL-CODES.                                     00290000
003000         10  PC-INTER-APPL-CRIT-SPEC                              00300000
003100                                  PIC  X(01)  VALUE '1'.          00310000
003200         10  PC-INTER-APPL-LIST   PIC  X(01)  VALUE '2'.          00320000
003300     05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'SU590A  '.  00330000
003400     05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'SUKM590 '.  00340000
003500     05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'SUKCS590'.  00350000
003600     05  PC-LOCATION-MODULE       PIC  X(08)  VALUE  'XLKUT071'.  00360000
003700     05  PC-UPDATE-MSG-NBR        PIC  X(08)  VALUE  'DPMSGNBR'.  00370000
003800     05  PC-ITEMS-PER-PANEL       PIC S9(04)  VALUE +10           00380000
003900                                              COMP SYNC.          00390000
004000     05  PC-MAX-RETRIES           PIC S9(04)  VALUE  +3           00400000
004100                                              COMP.               00410000
004200     05  PC-MAX-LOCK-RETRIES      PIC S9(04)  VALUE  +3           00420000
004300                                              COMP.               00430000
004400     05  PC-MAX-MSG-VAR           PIC S9(04)  VALUE +1            00440000
004500                                              COMP.               00450000
004600     05  PC-UPD-VSAM              PIC  X(01)  VALUE 'Y'.          00460000
004700     05  PC-MSG-VAR-SYMBOLIC      PIC  X(04)  VALUE '&VAR'.       00470000
004800     05  PC-INQ                    PIC  X(03)  VALUE 'INQ'.       00480000
004900     05  PC-UPD                    PIC  X(03)  VALUE 'UPD'.       00490000
005000     05  PC-DEL                    PIC  X(03)  VALUE 'DEL'.       00500000
005100     05  PC-ERR                    PIC  X(03)  VALUE 'ERR'.       00510000
005200     05  PC-NEW                    PIC  X(02)  VALUE 'NW'.        00520000
005300     05  PC-SLASH                  PIC  X(01)  VALUE '/'.         00530000
005400     05  PC-ZERO                   PIC S9(04)  VALUE ZEROES.      00540000
005500     05  PC-DC                    PIC  X(02)  VALUE  'DC'.        00550000
005600     05  PC-N                     PIC  X(01)  VALUE  'N'.         00560000
005700     05  PC-PICKING               PIC  X(01)  VALUE 'P'.          00570000
005800     05  PC-TICKET                PIC  X(01)  VALUE 'T'.          00580000
005900     05  PC-PACKING               PIC  X(01)  VALUE 'A'.          00590000
006000     05  PC-MAX-DATE              PIC  X(10)  VALUE '9999-09-09'. 00600000
006100     05  PC-DUMMY-DATE            PIC  X(10)  VALUE '09-09-9999'. 00610000
006200     05  PC-BULK-CSPK              PIC  X(10)  VALUE              00620000
006300                                    'BULK/CSEPK'.                 00630000
006400     05  PC-PRE-PACK               PIC  X(10)  VALUE              00640000
006500                                    'PRE-PACK  '.                 00650000
006600     05  PC-PBS                    PIC  X(10)  VALUE              00660000
006700                                    'PBS       '.                 00670000
      *SB 10/15/13 - BEGIN PR#5148D                                     00670100
006600     05  PC-RFID                   PIC  X(10)  VALUE              00671000
006700                                    'RFID      '.                 00672000
      *SB 10/15/13 - END PR#5148D                                       00673000
006800     05  PC-MANUAL                 PIC  X(06)  VALUE 'MANUAL'.    00680000
006900     05  PC-SYSTEM                 PIC  X(06)  VALUE 'SYSTEM'.    00690000
007000     05  PC-REWORK                 PIC  X(06)  VALUE 'REWORK'.    00700000
007100     05  PC-SPOT                   PIC  X(06)  VALUE 'SPOT  '.    00710000
007200     05  PC-100-PCNT               PIC  X(06)  VALUE '100 % '.    00720000
007300     05  PC-PASS                   PIC  X(10)  VALUE              00730000
007400                                    'PASS      '.                 00740000
007500     05  PC-FAIL                   PIC  X(10)  VALUE              00750000
007600                                    'FAIL      '.                 00760000
007700     05  PC-IN-PROCESS             PIC  X(10)  VALUE              00770000
007800                                    'IN PROCESS'.                 00780000
007900     05  PC-PROMPT                 PIC  X(10)  VALUE              00790000
008000                                    'PROMPT    '.                 00800000
008100     05  PC-NOT-NEEDED             PIC  X(10)  VALUE              00810000
008200                                    'NOT NEEDED'.                 00820000
008300     05  PC-ALL                    PIC  X(10)  VALUE              00830000
008400                                    'ALL       '.                 00840000
008500     05  PC-DEFAULT-TMST           PIC  X(26)  VALUE              00850000
008600                                  '9999-09-09-09.09.09.999999'.   00860000
      *SB 01/27/14 - BEGIN PR#5148D                                     00861000
           05  PC-WRG-TAGS-NO-EPC              PIC S9(4) COMP VALUE +38.00862000
           05  PC-WRG-RFID-TGS-CLR             PIC S9(4) COMP VALUE +39.00863000
           05  PC-WRG-RFID-TGS-SIZ             PIC S9(4) COMP VALUE +40.00864000
           05  PC-WRG-RFID-TGS-STL             PIC S9(4) COMP VALUE +41.00865000
           05  PC-VA-NO-EPC-LOGO               PIC S9(4) COMP VALUE +42.00866000
      *SB 01/27/14 - END   PR#5148D                                     00867000
008700                                                                  00870000
008800******************************************************************00880000
008900*   SYSTEM MESSAGES                                              *00890000
009000******************************************************************00900000
009100* 00007 - REQUIRED ENTRY                                          00910000
009200* 00008 - MUST BE NUMERIC                                         00920000
009300* 00057 - A LIST ITEM MUST BE SELECTED FOR THIS FUNCTION          00930000
009400* 00059 - UPDATE(S) SUCCESSFUL                                    00940000
009500* 00069 - TOP OF LIST                                             00950000
009600* 00070 - BOTTOM OF LIST                                          00960000
009700* 00095 - APPLICATION SYSTEM DOES NOT EXIST                       00970000
009800* 00148 - DATA DOES NOT EXIST                                     00980000
009900* 00223 - PREVIOUS OBJECT HAS BEEN ADDED                          00990000
010000* 00224 - OBJECT ON PREVIOUS SCREEN WAS SUCCESSFULLY ADDED        01000000
010100* 00388 - ONLY ONE REPLACEABLE SYMBOLIC VARIABLE (&VAR) CAN BE EN 01010000
010200* 00551 - WAIT 15 SECONDS;RETRY FUNCTION AGAIN;IF UNSUCCESSFUL CA 01020000
010300* 02482 - MESSAGE NUMBER ALREADY EXISTS                           01030000
010400* 02488 - MESSAGE NUMBER OVERRIDE MUST BE GREATER THAN OR EQUAL T 01040000
010500******************************************************************01050000
010600     05  PC-TSYMSG-NUMBERS.                                       01060000
010700         10  PC-TSYMSG-00007      PIC  9(05)  VALUE  00007.       01070000
010800         10  PC-TSYMSG-00008      PIC  9(05)  VALUE  00008.       01080000
010900         10  PC-TSYMSG-00057      PIC  9(05)  VALUE  00057.       01090000
011000         10  PC-TSYMSG-00059      PIC  9(05)  VALUE  00059.       01100000
011100         10  PC-TSYMSG-00068      PIC  9(05)  VALUE  00068.       01110000
011200         10  PC-TSYMSG-00069      PIC  9(05)  VALUE  00069.       01120000
011300         10  PC-TSYMSG-00070      PIC  9(05)  VALUE  00070.       01130000
011400         10  PC-TSYMSG-00095      PIC  9(05)  VALUE  00095.       01140000
011500         10  PC-TSYMSG-00148      PIC  9(05)  VALUE  00148.       01150000
011600         10  PC-TSYMSG-00223      PIC  9(05)  VALUE  00223.       01160000
011700         10  PC-TSYMSG-00224      PIC  9(05)  VALUE  00224.       01170000
011800         10  PC-TSYMSG-00388      PIC  9(05)  VALUE  00388.       01180000
011900         10  PC-TSYMSG-00551      PIC  9(05)  VALUE  00551.       01190000
012000         10  PC-TSYMSG-02185      PIC  9(05)  VALUE  02185.       01200000
012100         10  PC-TSYMSG-02482      PIC  9(05)  VALUE  02482.       01210000
012200         10  PC-TSYMSG-02488      PIC  9(05)  VALUE  02488.       01220000
012300                                                                  01230000
012400 01  PS-PROGRAM-SWITCHES.                                         01240000
012500     05  PS-ERROR-SW              PIC  X(01)  VALUE  'N'.         01250000
012600         88  PS-ERROR                         VALUE  'Y'.         01260000
012700         88  PS-NO-ERROR                      VALUE  'N'.         01270000
012800     05  PS-EOC-VIOLATION-CURSOR-IND     PIC  X(01)  VALUE 'N'.   01280000
012900         88  PS-EOC-VIOLATION-CURSOR                 VALUE 'Y'.   01290000
013000         88  PS-NOT-EOC-VIOLATION-CURSOR             VALUE 'N'.   01300000
013100     05  PS-EOC-TICKET-CURSOR-IND        PIC  X(01)  VALUE 'N'.   01310000
013200         88  PS-EOC-TICKET-CURSOR                    VALUE 'Y'.   01320000
013300         88  PS-NOT-EOC-TICKET-CURSOR                VALUE 'N'.   01330000
      *SB 10/15/13 - BEGIN PR#5148D                                     01330100
013100     05  PS-EOC-RFIDERR-CURSOR-IND       PIC  X(01)  VALUE 'N'.   01331000
013200         88  PS-EOC-RFIDERR-CURSOR                   VALUE 'Y'.   01332000
013300         88  PS-NOT-EOC-RFIDERR-CURSOR               VALUE 'N'.   01333000
      *SB 10/15/13 - END PR#5148D                                       01334000
013400     05  PS-END-CARTON-CSR-SW         PIC X(1)   VALUE 'N'.       01340000
013500         88  PS-EOF-CARTON-CSR                   VALUE 'Y'.       01350000
013600         88  PS-NOT-EOF-CARTON-CSR               VALUE 'N'.       01360000
013700                                                                  01370000
013800 01  PV-PROGRAM-VARIABLES.                                        01380000
013900     05  PV-SKU-NBR-X                   PIC X(08).                01390000
014000     05  PV-SKU-NBR REDEFINES PV-SKU-NBR-X                        01400000
014100                                        PIC 9(08).                01410000
014200     05  PV-SAVE-SCN-TMST         PIC  X(26).                     01420000
014300     05  PV-CICS-RESPONSE         PIC S9(04)  VALUE +0            01430000
014400                                              COMP SYNC.          01440000
014500     05  PV-CICS-MSG-AREA               PIC  X(100) VALUE SPACE.  01450000
014600     05  PV-COMMAREA-LENGTH             PIC S9(04)  VALUE +0      01460000
014700                                                    COMP SYNC.    01470000
014800     05  PV-RETRY-COUNTER         PIC S9(04)  VALUE +0            01480000
014900                                              COMP SYNC.          01490000
015000     05  PV-LOCK-RETRY-COUNTER    PIC S9(04)  VALUE +0            01500000
015100                                              COMP SYNC.          01510000
015200     05  PV-MSG-VAR-CNT           PIC S9(04)  VALUE +0            01520000
015300                                              COMP SYNC.          01530000
015400     05  PV-ITEM                  PIC S9(04)  VALUE +0            01540000
015500                                              COMP SYNC.          01550000
015600     05  PV-SUB                   PIC S9(04)  VALUE +0            01560000
015700                                              COMP SYNC.          01570000
015800     05  PV-SEL-QUEUE-ITEM        PIC S9(04)  VALUE +0            01580000
015900                                              COMP SYNC.          01590000
016000     05  PV-SAVE-ITEM             PIC S9(04)  VALUE +0            01600000
016100                                              COMP SYNC.          01610000
016200     05  PV-ITEMS-PROCESSED       PIC S9(09)  VALUE +0            01620000
016300                                              COMP-3.             01630000
016400     05  PV-HOLD-SELECTED-ITEMS   PIC S9(09)  VALUE +0            01640000
016500                                              COMP-3.             01650000
016600     05  PV-HOLD-UPC-NBR          PIC S9(15)  COMP-3.             01660000
016700     05  PV-DB2-ERROR-COUNT       PIC S9(09)  COMP.               01670000
016800     05  PV-DB2-TICKET-COUNT      PIC S9(09)  COMP.               01680000
      *SB 10/15/13 - BEGIN PR#5148D                                     01680100
016800     05  PV-DB2-SCAN-COUNT        PIC S9(09)  COMP.               01681000
016800     05  PV-DB2-RFID-COUNT        PIC S9(09)  COMP.               01681100
016900     05  PV-TOTAL-RFID-COUNT      PIC S9(09)  COMP.               01681200
017200     05  PV-RFID-ERRORS           PIC S9(09)  COMP.               01681300
      *SB 10/15/13 - END PR#5148D                                       01682000
016900     05  PV-TOTAL-TICKET-COUNT    PIC S9(09)  COMP.               01690000
017000     05  PV-PICK-ERRORS           PIC S9(09)  COMP.               01700000
017100     05  PV-PACK-ERRORS           PIC S9(09)  COMP.               01710000
017200     05  PV-TICKET-ERRORS         PIC S9(09)  COMP.               01720000
017300     05  PV-TOTAL-ERRORS          PIC S9(09)  COMP.               01730000
017400     05  PV-DISPLAY-AUDIT-CNTL-NBR       PIC 9(09).               01740000
017500     05  PV-DEPT-NBR-X.                                           01750000
017600         10  PV-DEPT-NBR                PIC 9(03).                01760000
017700     05  PV-DATE.                                                 01770000
017800         10  PV-DATE-MM                 PIC 9(02).                01780000
017900         10  FILLER                     PIC X(1)  VALUE '-'.      01790000
018000         10  PV-DATE-DD                 PIC 9(02).                01800000
018100         10  FILLER                     PIC X(1)  VALUE '-'.      01810000
018200         10  PV-DATE-YY                 PIC 9(04).                01820000
017700     05  PV-PASS-DATE.                                            01821000
017800         10  PV-PASS-MM                 PIC 9(02).                01822000
018000         10  PV-PASS-DD                 PIC 9(02).                01824000
018200         10  PV-PASS-YY                 PIC 9(04).                01826000
018300                                                                  01830000
018400     05  PV-TIME.                                                 01840000
018500         10  PV-TIME-HH                 PIC 9(02).                01850000
018600         10  FILLER                     PIC X(1)  VALUE ':'.      01860000
018700         10  PV-TIME-MM                 PIC 9(02).                01870000
018800                                                                  01880000
018900     05  PV-PO-RECEIVER.                                          01890000
019000         10  PV-PO                      PIC ZZZZZZZZ9.            01900000
019100         10  FILLER                     PIC X(1)  VALUE '-'.      01910000
019200         10  PV-RECEIVER                PIC 9(03).                01920000
019300                                                                  01930000
019400     05  PV-AUDIT-TYPE                  PIC X(06) VALUE SPACES.   01940000
019500     05  PV-AUDIT-DURATION            PIC S9(9) COMP-3 VALUE ZERO.01950000
019600     05  PV-CARTON-DURATION           PIC S9(9) COMP-3 VALUE ZERO.01960000
019700     05  PV-DISPLAY-DURATION.                                     01970000
019800         10  FILLER                   PIC  X(6) VALUE 'HOURS:'.   01980000
019900         10  PV-DISPLAY-HOURS         PIC  Z(5) VALUE ZERO.       01990000
020000         10  FILLER                   PIC  X(7) VALUE '  MIN: '.  02000000
020100         10  PV-DISPLAY-MIN           PIC  Z(2) VALUE ZERO.       02010000
020200******************************************************************02020000
020300**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **02030000
020400**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **02040000
020500**  APPLICATION-SPECIFIC COMMAREA.                              **02050000
020600******************************************************************02060000
020700 01  LQW-LIST-QUEUE-WORK-AREA.                                    02070000
020800     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  02080000
020900     05  LQW-ITEM-ENTRIES               OCCURS 10 TIMES           02090000
021000                                        INDEXED BY LQW-IDX.       02100000
021100         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       02110000
021200         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               02120000
021300         10  LQW-SELECTED-SW            PIC  X(01).               02130000
021400             88  LQW-SELECT                         VALUE 'S'.    02140000
021500             88  LQW-DESELECT                       VALUE ' '.    02150000
021600         10  LQW-ACTION                 PIC  X(03).               02160000
021700             88  LQW-DEL                            VALUE 'DEL'.  02170000
021800             88  LQW-INQ                            VALUE 'INQ'.  02180000
021900             88  LQW-UPD                            VALUE 'UPD'.  02190000
022000             88  LQW-ERR                            VALUE 'ERR'.  02200000
022100             88  LQW-PRT                            VALUE 'PRT'.  02210000
022200         10  LQW-PO-LINE                PIC  9(04).               02220000
022300         10  LQW-MERCH-CLASS            PIC  X(02).               02230000
022400         10  LQW-SEQUENCE               PIC  9(08).               02240000
022500         10  LQW-SKU-DESC               PIC  X(20).               02250000
022600         10  LQW-UPC                    PIC  9(15).               02260000
022700         10  LQW-SHIPD-QTY              PIC  Z(05).               02270000
022800*LMM                                                              02280000
022900         10  LQW-PREPK-RATIO            PIC  Z(05).               02290000
023000*                                                                 02300000
023100*----------------------------------------------------------------*02310000
023200*    CALLING PARAMETERS FOR LOCKING MODULE DPKCS044              *02320000
023300*----------------------------------------------------------------*02330000
023400                                                                  02340000
023500     COPY DPWS044.                                                02350000
023600                                                                  02360000
023700*----------------------------------------------------------------*02370000
023800*    THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT   *02380000
023900*    SUB-ROUTINE (DPKUT100).                                     *02390000
024000*----------------------------------------------------------------*02400000
024100     COPY DPWS010I.                                               02410000
024200                                                                  02420000
024300*  DOMAIN ITEM MODULE                                             02430000
024400     COPY XLWS001.                                                02440000
024500                                                                  02450000
024600**--------------------------------------------------------------**02460000
024700** THE LAYOUT FOR THE TEMPORARY STORAGE QUEUE CONTAINING        **02470000
024800** SELECTED LIST ITEMS TO BE PROCESSED BY THIS PROGRAM.         **02480000
024900**--------------------------------------------------------------**02490000
025000     COPY SUWS025.                                                02500000
025100                                                                  02510000
025200*----------------------------------------------------------------*02520000
025300*    MAP LAYOUT                                                  *02530000
025400*----------------------------------------------------------------*02540000
025500                                                                  02550000
025600     COPY SUKM590.                                                02560000
025700                                                                  02570000
025800***************************************************************** 02580000
025900*   XLWS071 - IS THE LAYOUT THAT IS USED TO PASS INFO TO THE    * 02590000
026000*             LOCATION MODULE (XLKUT071)                        * 02600000
026100***************************************************************** 02610000
026200     COPY XLWS071.                                                02620000
026300                                                                  02630000
026400*----------------------------------------------------------------*02640000
026500*    ATTRIBUTE SETTINGS COPYBOOK.                                *02650000
026600*----------------------------------------------------------------*02660000
026700                                                                  02670000
026800     COPY DPWS015.                                                02680000
026900                                                                  02690000
027000*----------------------------------------------------------------*02700000
027100*    FUNCTION KEYS COPYBOOK                                      *02710000
027200*----------------------------------------------------------------*02720000
027300                                                                  02730000
027400     COPY DPWS016.                                                02740000
027500                                                                  02750000
027600***************************************************************** 02760000
027700* PARAMETERS FOR CALLING CICS ARCHITECTURE API                    02770021
027800***************************************************************** 02780000
027900     COPY DPWS030.                                                02790000
027900     COPY DPWS930.                                                02791021
028000                                                                  02800000
028100***************************************************************** 02810000
028200*    STANDARD COMMAREA.                                           02820000
028300***************************************************************** 02830000
028400                                                                  02840000
028500     COPY DPWS020.                                                02850000
028600     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02860000
028700                                                                  02870000
028800***************************************************************** 02880000
028900*    INTER-APPLICATION COMMAREA.                                  02890000
029000***************************************************************** 02900000
029100                                                                  02910000
029200         10  INTER-APPL-COMM-AREA PIC X(200).                     02920000
029300     COPY SUWS023.                                                02930000
029400     COPY RCWS800.                                                02940000
029500     COPY SUWS038.                                                02950000
029600     COPY SUWS024.                                                02960000
029700***************************************************************** 02970000
029800*    SPECIFIC COMMMAREA FOR SUKCS590.                             02980000
029900***************************************************************** 02990000
030000         10  ASC-SPECIFIC-COMMAREA.                               03000000
030100             15  ASC-INT-APPL-FORMAT-IND   PIC  X(01).            03010000
030200             15  ASC-AUDIT-NBR.                                   03020000
030300                 20  ASC-AUDIT-NBR-N         PIC  9(09).          03030000
030400             15  ASC-CRE-DATE                PIC  X(10).          03040000
030500             15  ASC-CRE-TIME                PIC  X(05).          03050000
030600             15  ASC-PO-RCVR                 PIC  X(13).          03060000
030700                                                                  03070000
030800             15  ASC-LINE-NUMBER.                                 03080000
030900                 20  ASC-LINE-NBR            PIC  ZZZ9.           03090000
031000                 20  ASC-LINE-C REDEFINES                         03100000
031100                              ASC-LINE-NBR.                       03110000
031200                     25  ASC-LINE-NBR-CHAR   PIC  X(04).          03120000
031300                     25  ASC-LINE-NBR-NUM REDEFINES               03130000
031400                         ASC-LINE-NBR-CHAR   PIC 9(04).           03140000
031500                                                                  03150000
031600             15  ASC-SKU                     PIC  X(15).          03160000
031700             15  ASC-OPER-UNIT               PIC  9999.           03170000
031800             15  ASC-OPER-DESC               PIC  X(30).          03180000
031900             15  ASC-ENT-ID                  PIC  ZZZZZZZZZ.      03190000
032000             15  ASC-ENT-DESC                PIC  X(30).          03200000
032100             15  ASC-DEPT                    PIC  ZZZZ.           03210000
032200             15  ASC-DEPT-DESC               PIC  X(30).          03220000
032300             15  ASC-PROCESS-STATUS          PIC  X(01).          03230000
032400             15  ASC-AUDIT-SOURCE            PIC  X(06).          03240000
032500             15  ASC-SOURCE                  PIC  X(06).          03250000
032600             15  ASC-PACKAGE-TYPE            PIC  X(02).          03260000
032700             15  ASC-AUDIT-STATUS            PIC  X(09).          03270000
032800             15  ASC-AUDIT-TYPE              PIC  X(06).          03280000
032900             15  ASC-DEFERRED-IND            PIC  X(01).          03290000
033000             15  ASC-MODIFIED-IND            PIC  X(01).          03300000
033100             15  ASC-CREATE-USERID           PIC  X(08).          03310000
033200             15  ASC-REQUEST-DATE            PIC  X(08).          03320000
033300             15  ASC-REQUEST-MDCY            PIC  X(10).          03330000
033400             15  ASC-REQUEST-TIME            PIC  X(05).          03340000
033500             15  ASC-START-DATE              PIC  X(10).          03350000
033600             15  ASC-START-TIME              PIC  X(05).          03360000
033700             15  ASC-STOP-DATE               PIC  X(10).          03370000
033800             15  ASC-STOP-TIME               PIC  X(05).          03380000
033900             15  ASC-CARTON-HOURS            PIC  9(06).          03390000
034000             15  ASC-CARTON-MIN              PIC  9(02).          03400000
034100             15  ASC-DURATION-DATE           PIC  X(10).          03410000
034200             15  ASC-DURATION-TIME           PIC  X(05).          03420000
034300             15  ASC-POSTPONED-MIN           PIC  ZZZZZZZZZ.      03430000
034400             15  ASC-CLOSE-MIN               PIC  ZZZZZZZZZ.      03440000
034500             15  ASC-REQ-CARTONS             PIC  ZZZZ.           03450000
034600             15  ASC-TOTAL-ERRORS            PIC  ZZZZZZ.         03460000
034700             15  ASC-REQ-UNITS               PIC  ZZZZ.           03470000
034800             15  ASC-PICK-ERRORS             PIC  ZZZZZZ.         03480000
      *SB 10/15/13 - BEGIN PR#5148D                                     03480100
034800             15  ASC-RFID-ERRORS             PIC  ZZZZZZ.         03481000
      *SB 10/15/13 - END PR#5148D                                       03482000
034900             15  ASC-AUDIT-CARTONS           PIC  ZZZZ.           03490000
035000             15  ASC-PACK-ERRORS             PIC  ZZZZZZ.         03500000
035100             15  ASC-AUDIT-UNITS             PIC  ZZZZ.           03510000
035200             15  ASC-TICKET-ERRORS           PIC  ZZZZZZ.         03520000
035300             15  ASC-MOD-QTY-IND             PIC  X(01).          03530000
035310             15  ASC-USE-SELECTION-QUEUE-IND                      03531000
035400                                           PIC  X(01).            03540000
035500                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 03550000
035600             15  ASC-SEL-QUEUE-NAME        PIC  X(08).            03560000
035700             15  ASC-NUMBER-OF-TS-ITEMS    PIC S9(05)  COMP-3.    03570000
035800             15  ASC-NUMBER-OF-SELECTED-ITEMS                     03580000
035900                                           PIC S9(09)  COMP-3.    03590000
036000             15  ASC-SEL-SUB               PIC S9(04)  COMP.      03600000
036100             15  ASC-SEL-ITEM              PIC S9(04)  COMP.      03610000
036200             15  ASC-TEMP-QUEUE-UPDATE-SW     PIC  X(01).         03620000
036300                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     03630000
036400                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     03640000
036500             15  ASC-LIST-QUEUE-NAME.                             03650000
036600                 20  ASC-LIST-TERM-ID         PIC  X(04).         03660000
036700                 20  ASC-LIST-TASK-NUMBER     PIC S9(05) COMP-3.  03670000
036800                 20  ASC-LIST-SEQ             PIC  9(01).         03680000
036900             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03690000
037000                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03700000
037100                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03710000
037200                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03720000
037300             15  FILLER                       PIC  X(2488).       03730000
037400     EJECT                                                        03740000
037500*----------------------------------------------------------------*03750000
037600*    ABEND PROCESSING COPYBOOK.                                  *03760000
037700*----------------------------------------------------------------*03770000
037800                                                                  03780000
037900     COPY DPWS013.                                                03790000
038000                                                                  03800000
038100******************************************************************03810000
038200*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      03820000
038300*  AUDIT TRANSACTION EXCEPTION TABLE                              03830000
038400******************************************************************03840000
038500     EXEC SQL                                                     03850000
038600         INCLUDE TCTEXCP                                          03860000
038700     END-EXEC.                                                    03870000
038800                                                                  03880000
038900*----------------------------------------------------------------*03890000
039000*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      03900000
039100*  AUDIT TRANSACTION TABLE                                        03910000
039200*----------------------------------------------------------------*03920000
039300     EXEC SQL                                                     03930000
039400         INCLUDE TSUATRN                                          03940000
039500     END-EXEC.                                                    03950000
039600                                                                  03960000
039700*----------------------------------------------------------------*03970000
039800*    DB2 DCLGEN FOR THE EXTERNAL ENTERPRISE TABLE                 03980000
039900*----------------------------------------------------------------*03990000
040000     EXEC SQL                                                     04000000
040100          INCLUDE TEXTENT                                         04010000
040200     END-EXEC.                                                    04020000
040300                                                                  04030000
040400*----------------------------------------------------------------*04040000
040500*    DB2 DCLGEN FOR THE ENTERPRISE NAME TABLE                     04050000
040600*----------------------------------------------------------------*04060000
040700     EXEC SQL                                                     04070000
040800          INCLUDE TENTNME                                         04080000
040900     END-EXEC.                                                    04090000
041000                                                                  04100000
041100*---------------------------------------------------------------* 04110000
041200*  DCLGEN FOR THE DB2 DEPARTMENT TABLE                            04120000
041300*---------------------------------------------------------------* 04130000
041400     EXEC SQL                                                     04140000
041500         INCLUDE TVNDDPT                                          04150000
041600     END-EXEC.                                                    04160000
041700*----------------------------------------------------------------*04170000
041800*    DB2 DCLGEN FOR THE MERCHANDISE AREA TABLE                    04180000
041900*----------------------------------------------------------------*04190000
042000     EXEC SQL                                                     04200000
042100          INCLUDE TMDSEAR                                         04210000
042200     END-EXEC.                                                    04220000
042300                                                                  04230000
042400                                                                  04240000
042500*    DB2 AREA FOR THE SHIPPING UNIT EXCEPTION TABLE             * 04250000
042600                                                                  04260000
042700     EXEC SQL                                                     04270000
042800         INCLUDE TSUEXCP                                          04280000
042900     END-EXEC.                                                    04290000
043000                                                                  04300000
043100*    DB2 AREA FOR THE AUDIT VIOLATION REASON CODE TABLE         * 04310000
043200                                                                  04320000
043300     EXEC SQL                                                     04330000
043400          INCLUDE TVILNCD                                         04340000
043500     END-EXEC.                                                    04350000
043600                                                                  04360000
043700*----------------------------------------------------------------*04370000
043800*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE AUDIT SHIPPING UPC 04380000
043900*  TABLE                                                          04390000
044000*----------------------------------------------------------------*04400000
044100     EXEC SQL                                                     04410000
044200         INCLUDE TSUAUPC                                          04420000
044300     END-EXEC.                                                    04430000
044400                                                                  04440000
044500*----------------------------------------------------------------*04450000
044600                                                                  04460000
044700*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE AUDIT TABLE        04470000
044800*----------------------------------------------------------------*04480000
044900     EXEC SQL                                                     04490000
045000         INCLUDE TSUNAUD                                          04500000
045100     END-EXEC.                                                    04510000
045200                                                                  04520000
045300*----------------------------------------------------------------*04530000
045400*    DB2 DCLGEN FOR THE VENDOR PO AUDIT REQUEST TABLE             04540000
045500*    (SUT_PO_AUD_REQ)                                             04550000
045600*----------------------------------------------------------------*04560000
045700     EXEC SQL                                                     04570000
045800          INCLUDE SUT00015                                        04580000
045900     END-EXEC.                                                    04590000
046000*    DB2 AREA FOR COMMUNICATIONS                                  04600000
046100                                                                  04610000
046200     EXEC SQL                                                     04620000
046300          INCLUDE SQLCA                                           04630000
046400     END-EXEC.                                                    04640000
046500                                                                  04650000
046600                                                                  04660000
046700     EXEC SQL                                                     04670000
046800         DECLARE VIOLATION_CURSOR CURSOR FOR                      04680000
046900         SELECT                                                   04690000
047000                 B.SCN_TMST                                       04700000
047100               , C.VILN_GP_SEQ_NBR                                04710000
047200               , SUM(A.SCND_UNT_QTY)                              04720000
047300         FROM    TSUAUPC A                                        04730000
047400              ,  TSUEXCP B                                        04740000
047500              ,  TVILNCD C                                        04750000
047600         WHERE                                                    04760000
047700             A.AUD_CNTL_NBR       = :DK-AUDIT-NBR                 04770000
047800         AND A.AUD_CNTL_NBR       = B.AUD_CNTL_NBR                04780000
047900         AND A.SCN_TMST           = B.SCN_TMST                    04790000
048000         AND C.VILN_GP_CDE        = 'VA'                          04800000
048100         AND C.FALR_IND           = 'Y'                           04810000
048200         AND B.VILN_GP_CDE        = C.VILN_GP_CDE                 04820000
048300         AND B.VILN_GP_SEQ_NBR    = C.VILN_GP_SEQ_NBR             04830000
048400         AND C.VILN_CTG_CDE       = 'P'                           04840000
048500         GROUP BY                                                 04850000
048600                 B.SCN_TMST                                       04860000
048700              ,  C.VILN_GP_SEQ_NBR                                04870000
048800         ORDER BY                                                 04880000
048900                 B.SCN_TMST                                       04890000
049000              ,  C.VILN_GP_SEQ_NBR                                04900000
049100     END-EXEC.                                                    04910000
049200                                                                  04920000
049300     EXEC SQL                                                     04930000
049400         DECLARE TICKET_CURSOR CURSOR FOR                         04940000
049500         SELECT  A.UPC_NBR                                        04950000
049600              ,  B.VILN_GP_SEQ_NBR                                04960000
049700              ,  SUM(A.SCND_UNT_QTY) AS SUMA                      04970000
049800         FROM    TSUAUPC A                                        04980000
049900              ,  TSUEXCP B                                        04990000
050000              ,  TVILNCD C                                        05000000
050100         WHERE                                                    05010000
050200             A.AUD_CNTL_NBR       = :DK-AUDIT-NBR                 05020000
050300         AND A.AUD_CNTL_NBR       = B.AUD_CNTL_NBR                05030000
050400         AND A.SCN_TMST           = B.SCN_TMST                    05040000
050500         AND C.VILN_GP_CDE        = 'VA'                          05050000
050600         AND B.VILN_GP_CDE        = C.VILN_GP_CDE                 05060000
050700         AND B.VILN_GP_SEQ_NBR    = C.VILN_GP_SEQ_NBR             05070000
050800         AND C.VILN_CTG_CDE       = 'T'                           05080000
050900         GROUP BY                                                 05090000
051000                 A.UPC_NBR                                        05100000
051100              ,  B.VILN_GP_SEQ_NBR                                05110000
051200         ORDER BY                                                 05120000
051300                 A.UPC_NBR                                        05130000
051400              ,  SUMA   DESC                                      05140000
051500              ,  B.VILN_GP_SEQ_NBR                                05150000
051600     END-EXEC.                                                    05160000
051700                                                                  05170000
      *SB 10/15/13 - BEGIN PR#5148D                                     05170100
049300     EXEC SQL                                                     05171000
049400         DECLARE RFIDERR_CURSOR CURSOR FOR                        05171100
049500         SELECT  A.UPC_NBR                                        05171200
049600              ,  B.VILN_GP_SEQ_NBR                                05171300
                    ,  B.SCN_TMST                                       05171400
049700              ,  SUM(A.SCND_UNT_QTY) AS SUMA                      05171500
049700              ,  SUM(A.RFID_TGD_QTY) AS SUMB                      05171600
049800         FROM    TSUAUPC A                                        05171700
049900              ,  TSUEXCP B                                        05171800
050000              ,  TVILNCD C                                        05171900
                    ,  TSUATRN D                                        05172000
050100         WHERE                                                    05172200
050200             A.AUD_CNTL_NBR       = :DK-AUDIT-NBR                 05172300
050300         AND A.AUD_CNTL_NBR       = B.AUD_CNTL_NBR                05172400
050400         AND A.SCN_TMST           = B.SCN_TMST                    05172500
050500         AND C.VILN_GP_CDE        = 'VA'                          05172600
               AND C.FALR_IND           = 'Y'                           05172700
050600         AND B.VILN_GP_CDE        = C.VILN_GP_CDE                 05172800
050700         AND B.VILN_GP_SEQ_NBR    = C.VILN_GP_SEQ_NBR             05172900
               AND A.AUD_CNTL_NBR       = D.AUD_CNTL_NBR                05173000
               AND A.SHIPT_UNT_ID       = D.SHIPT_UNT_ID                05173100
               AND B.SCN_TMST           >= D.UNT_AUD_STRT_TMST          05173200
               AND C.VILN_GP_SEQ_NBR IN (:PC-WRG-TAGS-NO-EPC            05173600
                                        ,:PC-WRG-RFID-TGS-CLR           05173700
                                        ,:PC-WRG-RFID-TGS-SIZ           05173800
                                        ,:PC-WRG-RFID-TGS-STL           05173900
                                        ,:PC-VA-NO-EPC-LOGO)            05174000
050900         GROUP BY                                                 05174200
051000                 A.UPC_NBR                                        05174300
051100              ,  B.VILN_GP_SEQ_NBR                                05174400
                    ,  B.SCN_TMST                                       05174500
051200         ORDER BY                                                 05174600
                       B.SCN_TMST                                       05174700
051300              ,  A.UPC_NBR                                        05174800
051400              ,  SUMA   DESC                                      05174900
051500              ,  B.VILN_GP_SEQ_NBR                                05175000
051600     END-EXEC.                                                    05180500
      *SB 10/15/13 - END PR#5148D                                       05180600
051700                                                                  05180700
051800* CARTON CURSOR FOR CALCULATING AUDIT DURATION.                   05181000
051900                                                                  05190000
052000     EXEC SQL                                                     05200000
052100         DECLARE CARTON-CSR CURSOR FOR                            05210000
052200             SELECT                                               05220000
052300                SHIPT_UNT_ID                                      05230000
052400               ,( (( DAYS(UNT_AUD_STP_TMST) -                     05240000
052500                     DAYS(UNT_AUD_STRT_TMST) )                    05250000
052600                     * 1440)                                      05260000
052700             +                                                    05270000
052800                  (( HOUR(UNT_AUD_STP_TMST) -                     05280000
052900                     HOUR(UNT_AUD_STRT_TMST) )                    05290000
053000                     * 60 )                                       05300000
053100             +                                                    05310000
053200                  ( MINUTE(UNT_AUD_STP_TMST) -                    05320000
053300                    MINUTE(UNT_AUD_STRT_TMST) )                   05330000
053400                                                                  05340000
053500             -      UNT_PSPND_MNIT_QTY                            05350000
053600             -      UNT_CLO_MNIT_QTY )                            05360000
053700             FROM                                                 05370000
053800                   TSUATRN                                        05380000
053900             WHERE                                                05390000
054000                    AUD_CNTL_NBR      = :DK-AUDIT-NBR             05400000
054100               AND  UNT_AUD_STP_TMST <> :PC-DEFAULT-TMST          05410000
054200     END-EXEC.                                                    05420000
054300                                                                  05430000
054400                                                                  05440000
054500 LINKAGE SECTION.                                                 05450000
054600                                                                  05460000
054700 01  DFHCOMMAREA.                                                 05470000
054800     05  FILLER                         OCCURS  1 TO 4072 TIMES   05480000
054900                                        DEPENDING ON EIBCALEN.    05490000
055000         10  FILLER                     PIC  X(01).               05500000
055100                                                                  05510000
055200                                                                  05520000
055300 PROCEDURE DIVISION.                                              05530000
055400***************************************************************** 05540000
055500** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 05550000
055600** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 05560000
055700** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 05570000
055800**                                                             ** 05580000
055900** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 05590000
056000** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 05600000
056100***************************************************************** 05610000
056200 0000-MAIN-MODULE.                                                05620000
056300     INITIALIZE DP030-CICS-API-FIELDS.                            05630000
056400     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       05640000
056500     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          05650000
056600     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         05660000
056700     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       05670000
056800     MOVE LENGTH OF SU590AI        TO DP030-MAP-LENGTH (1).       05680000
056900     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05690000
057000     PERFORM 0001-CALL-CICS-ARCH-API.                             05700000
057100                                                                  05710000
057200     PERFORM 1000-CONTROL-PROCESSING                              05720000
057300                                                                  05730000
057400     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05740000
057500     PERFORM 0001-CALL-CICS-ARCH-API.                             05750000
057600                                                                  05760000
057700 0001-CALL-CICS-ARCH-API.                                         05770000
057800*    CALL 'DPKCS030' USING DFHEIBLK                               05780021
057800     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      05781021
057900                           DFHCOMMAREA                            05790000
058000                           DP030-CICS-API-FIELDS                  05800000
058100                           DP020-STANDARD-COMMAREA                05810000
058200                           SU590AI.                               05820000
058300                                                                  05830000
058400     IF  DP030-RC-CALL-SUCCESSFUL                                 05840000
058500         CONTINUE                                                 05850000
058600     ELSE                                                         05860000
058700         SET DP013-NO-ROLLBACK                                    05870000
058800             DP013-XCTL-DISPLAY-RESTART                           05880000
058900             DP013-CICS-ABEND      TO TRUE                        05890000
059000         MOVE 'BEFORE 0000-MAIN-MODULE'                           05900000
059100                                   TO DP013-PARAGRAPH             05910000
059200*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX05920021
059300*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      05930021
059200         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O05931021
059300-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05932021
059400         MOVE DP030-RETURN-CODE                                   05940000
059500                                   TO DP013-MESSAGE-TEXT (3)      05950000
059600         PERFORM DP013-0000-PROCESS-ABEND                         05960000
059700     END-IF.                                                      05970000
059800                                                                  05980000
059900*----------------------------------------------------------------*05990000
060000*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *06000000
060100*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *06010000
060200*----------------------------------------------------------------*06020000
060300                                                                  06030000
060400 1000-CONTROL-PROCESSING.                                         06040000
060500                                                                  06050000
060600     EVALUATE TRUE                                                06060000
060700         WHEN DP020-NEXT-ACT-INITIAL                              06070000
060800             PERFORM 1100-FIND-OBJECT-KEYS                        06080000
060900             IF  PS-ERROR                                         06090000
061000                 CONTINUE                                         06100000
061100             ELSE                                                 06110000
061200                 MOVE ASC-AUDIT-NBR-N         TO DK-AUDIT-NBR     06120000
061300                 PERFORM 4000-BUILD-INITIAL-PANEL                 06130000
061400                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06140000
061500             END-IF                                               06150000
061600                                                                  06160000
061700         WHEN DP020-NEXT-ACT-READ-MAP                             06170000
061800             PERFORM 2000-PROCESS-PANEL                           06180000
061900                                                                  06190000
062000         WHEN DP020-NEXT-ACT-RETURN                               06200000
062100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06210000
062200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06220000
062300                                                                  06230000
062400         WHEN OTHER                                               06240000
062500             SET DP013-LOGIC-ABEND                                06250000
062600                 DP013-NO-ROLLBACK TO TRUE                        06260000
062700             MOVE '1000-CONTROL-PROCESSING'                       06270000
062800                                   TO DP013-PARAGRAPH             06280000
062900             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   06290000
063000                                   TO DP013-MESSAGE-TEXT(1)       06300000
063100             MOVE DP020-NEXT-APPL-ACTIVITY                        06310000
063200                                   TO DP013-MESSAGE-TEXT(2)       06320000
063300             PERFORM DP013-0000-PROCESS-ABEND                     06330000
063400     END-EVALUATE.                                                06340000
063500                                                                  06350000
063600******************************************************************06360000
063700** DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE   **06370000
063800** INTER-APPLICATION FORMAT CODE.                               **06380000
063900******************************************************************06390000
064000 1100-FIND-OBJECT-KEYS.                                           06400000
064100     INITIALIZE ASC-SPECIFIC-COMMAREA.                            06410000
064200     MOVE DP020-INT-APPL-FORMAT-IND                               06420000
064300                                   TO ASC-INT-APPL-FORMAT-IND.    06430000
064400     EVALUATE DP020-INT-APPL-FORMAT-IND                           06440000
064500         WHEN PC-INTER-APPL-CRIT-SPEC                             06450000
064600             IF  SU023-AUDIT-NBR > ZERO                           06460000
064700                 MOVE SU023-AUDIT-NBR                             06470000
064800                                   TO ASC-AUDIT-NBR-N             06480000
064900             ELSE                                                 06490000
065000                 MOVE PC-TSYMSG-00148                             06500000
065100                                   TO DP020-MSG-NUMBER            06510000
065200                 SET DP020-MSG-FATAL                              06520000
065300                     DP020-NEXT-ACT-APPL-ERROR                    06530000
065400                                   TO TRUE                        06540000
065500             END-IF                                               06550000
065600                                                                  06560000
065700         WHEN PC-INTER-APPL-LIST                                  06570000
065800             SET ASC-USE-SELECTION-QUEUE TO TRUE                  06580000
065900             MOVE SU024-NUMBER-OF-SELECTED-ITEMS                  06590000
066000                                   TO ASC-NUMBER-OF-SELECTED-ITEMS06600000
066100             MOVE SU024-NUMBER-OF-TS-ITEMS                        06610000
066200                                   TO ASC-NUMBER-OF-TS-ITEMS      06620000
066300             MOVE SU024-SEL-QUEUE-NAME                            06630000
066400                                   TO ASC-SEL-QUEUE-NAME          06640000
066500             PERFORM 1120-PREPARE-LIST-ENTRY                      06650000
066600                                                                  06660000
066700         WHEN OTHER                                               06670000
066800             MOVE PC-TSYMSG-00148                                 06680000
066900                               TO DP020-MSG-NUMBER                06690000
067000             SET DP020-MSG-FATAL                                  06700000
067100                 DP020-NEXT-ACT-APPL-ERROR                        06710000
067200                               TO TRUE                            06720000
067300     END-EVALUATE.                                                06730000
067400*----------------------------------------------------------------*06740000
067500* ENTRY IS FROM A LIST.  GET THE MESSAGE NUMBER FROM THE TEMP    *06750000
067600* STORAGE QUEUE PASSED FROM THE LIST.                            *06760000
067700*----------------------------------------------------------------*06770000
067800 1120-PREPARE-LIST-ENTRY.                                         06780000
067900     MOVE SU025-MAX-ITEMS          TO ASC-SEL-SUB.                06790000
068000     MOVE ZERO                     TO ASC-SEL-ITEM.               06800000
068100     PERFORM 2110-GET-NEXT-MESSAGE.                               06810000
068200*----------------------------------------------------------------*06820000
068300*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *06830000
068400*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *06840000
068500*----------------------------------------------------------------*06850000
068600                                                                  06860000
068700                                                                  06870000
068800*----------------------------------------------------------------*06880000
068900* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*06890000
069000* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*06900000
069100* EDITS.                                                         *06910000
069200*----------------------------------------------------------------*06920000
069300 2000-PROCESS-PANEL.                                              06930000
069400                                                                  06940000
069500     EVALUATE TRUE                                                06950000
069600                                                                  06960000
069700         WHEN DP020-SRC-AID = DP016-CLEAR                         06970000
069800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06980000
069900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06990000
070000                                                                  07000000
070100         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     07010000
070200             MOVE ASC-AUDIT-NBR-N         TO DK-AUDIT-NBR         07020000
070300*            INITIALIZE ASC-SPECIFIC-COMMAREA                     07030000
070400             PERFORM 4000-BUILD-INITIAL-PANEL                     07040000
070500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07050000
070600*            PERFORM 3200-RESET-ATTRIBUTES                        07060000
070700                                                                  07070000
070800         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             07080000
070900             IF  ASC-USE-SELECTION-QUEUE                          07090000
071000                 PERFORM 2110-GET-NEXT-MESSAGE                    07100000
071100                 MOVE ASC-AUDIT-NBR-N         TO DK-AUDIT-NBR     07110000
071200                 PERFORM 4000-BUILD-INITIAL-PANEL                 07120000
071300                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07130000
071400*                PERFORM 3200-RESET-ATTRIBUTES                    07140000
071500             ELSE                                                 07150000
071600*                --- BOTTOM OF LIST ---                           07160000
071700                 MOVE PC-TSYMSG-00070                             07170000
071800                                   TO DP020-MSG-NUMBER            07180000
071900                 SET DP020-MSG-INFORMATIONAL                      07190000
072000                     PS-ERROR      TO TRUE                        07200000
072100             END-IF                                               07210000
072200                                                                  07220000
072300         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             07230000
072400             IF  ASC-USE-SELECTION-QUEUE                          07240000
072500                 PERFORM 2120-GET-PREV-MESSAGE                    07250000
072600                 MOVE ASC-AUDIT-NBR-N         TO DK-AUDIT-NBR     07260000
072700                 PERFORM 4000-BUILD-INITIAL-PANEL                 07270000
072800                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07280000
072900*                PERFORM 3200-RESET-ATTRIBUTES                    07290000
073000             ELSE                                                 07300000
073100*                --- TOP OF LIST ---                              07310000
073200                 MOVE PC-TSYMSG-00069                             07320000
073300                                   TO DP020-MSG-NUMBER            07330000
073400                 SET DP020-MSG-INFORMATIONAL                      07340000
073500                                   TO TRUE                        07350000
073600             END-IF                                               07360000
073700                                                                  07370000
073800         WHEN OTHER                                               07380000
073900*            PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 07390000
074000*            PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07400000
074100             PERFORM 2100-CHECK-FUNCTION-KEY                      07410000
074200             IF  PS-NO-ERROR                                      07420000
074300                 SET DP030-CONTINUE-GO TO TRUE                    07430000
074400             ELSE                                                 07440000
074500                 SET DP030-OVERRIDE-GO TO TRUE                    07450000
074600             END-IF                                               07460000
074700     END-EVALUATE.                                                07470000
074800                                                                  07480000
074900                                                                  07490000
075000******************************************************************07500000
075100** ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **07510000
075200** FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **07520000
075300** FROM THE CICS ARCHITECTURE API.                              **07530000
075400******************************************************************07540000
075500 2100-CHECK-FUNCTION-KEY.                                         07550000
075600     EVALUATE TRUE                                                07560000
075700         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              07570000
075800             IF ASC-PACKAGE-TYPE = 'PP'                           07580000
075900                 INITIALIZE RC800-INTER-APPL-COMMAREA             07590000
076000                 MOVE ASC-PO-RCVR TO PV-PO-RECEIVER               07600000
076100                 MOVE PV-PO           TO RC800-REC-NBR-N          07610000
076200                 MOVE PV-RECEIVER     TO RC800-REC-SEQ-NBR-N      07620000
076300                 MOVE ASC-LINE-NBR-NUM TO      RC800-LINE-NBR-N   07630000
076400                 MOVE ASC-OPER-UNIT   TO       RC800-OPER-UNIT-ID 07640000
076500                 MOVE 1               TO       RC800-FACILITY-ID  07650000
076600                 MOVE ASC-LINE-NBR-CHAR TO     RC800-PACK-ID      07660000
076700                                                                  07670000
076800             ELSE                                                 07680000
076900                 MOVE PC-TSYMSG-02185  TO DP020-MSG-NUMBER        07690000
077000                 SET DP020-MSG-FATAL                              07700000
077100                     PS-ERROR          TO TRUE                    07710000
077200             END-IF                                               07720000
077300                                                                  07730000
077400*LMM ADD                                                          07740000
077500* F23 - SU-AUDITED CARTON LIST (LOCAL-FUNC-02)                    07750000
077600*                                                                 07760000
077700         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              07770000
077800                                                                  07780000
077900*            IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              07790000
078000                 MOVE ASC-AUDIT-NBR-N     TO SU024-AUDIT-NBR      07800000
078100                 MOVE ASC-OPER-UNIT       TO SU024-OPER-UNIT-ID   07810000
078200                 MOVE ASC-OPER-DESC       TO SU024-OPER-DESC      07820000
078300                 MOVE ASC-PROCESS-STATUS  TO SU024-PROCESS-STATUS 07830000
078400                 MOVE ASC-AUDIT-SOURCE    TO SU024-SOURCE         07840000
078500                 MOVE ASC-PACKAGE-TYPE    TO SU024-PACKAGING-TYPE 07850000
078600                 MOVE ASC-ENT-ID          TO SU024-ENT-ID         07860000
078700                 MOVE ASC-ENT-DESC        TO SU024-VENDOR-NAME    07870000
078800                 MOVE ASC-DEPT            TO SU024-DEPT-NBR       07880000
078900                 MOVE ASC-DEPT-DESC       TO SU024-DEPARTMENT-DESC07890000
079000                 MOVE ASC-PO-RCVR         TO PV-PO-RECEIVER       07900000
079100                 MOVE PV-PO               TO SU024-PO             07910000
079200                 MOVE PV-RECEIVER         TO SU024-RECEIVER-SEQ   07920000
079300                 MOVE ASC-REQUEST-MDCY    TO SU024-REQUEST-DATE   07930000
079400*            ELSE                                                 07940000
079500*                PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07950000
079600*                SET DP030-OVERRIDE-GO                            07960000
079700*                                  TO TRUE                        07970000
079800*                MOVE PC-TSYMSG-00057                             07980000
079900*                                  TO DP020-MSG-NUMBER            07990000
080000*                SET DP020-MSG-WARNING                            08000000
080100*                                  TO TRUE                        08010000
080200*            END-IF                                               08020000
080300*LMM END                                                          08030000
080400                                                                  08040000
080500* F24 - SU-STORE UNIT ADJ TRAN LIST                               08050000
080600         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              08060000
080700                 INITIALIZE SU038-INTER-APPL-COMMAREA             08070000
080800                 MOVE ASC-AUDIT-NBR-N     TO SU038-AUDIT          08080000
080900                 MOVE ASC-OPER-UNIT       TO SU038-OPER-UNT-ID    08090000
081000                 MOVE ASC-OPER-DESC       TO SU038-OPER-NAME      08100000
081100                 MOVE ASC-PO-RCVR         TO SU038-PO-RCVR        08110000
081200*                MOVE ASC-LINE-NBR-NUM    TO SU038-LINE           08120000
081300                 MOVE 'A'                 TO SU038-UNT-ADJ-TYP    08130000
081400                 MOVE 'A'                 TO SU038-FAIL-SUCCSS    08140000
081100                 MOVE ASC-START-DATE(1:2) TO PV-PASS-MM           08141000
081100                 MOVE ASC-START-DATE(4:2) TO PV-PASS-DD           08142000
081100                 MOVE ASC-START-DATE(7:4) TO PV-PASS-YY           08143000
081100                 MOVE PV-PASS-DATE        TO SU038-FROM-DATE      08144000
081100                 MOVE ASC-STOP-DATE(1:2)  TO PV-PASS-MM           08145000
081100                 MOVE ASC-STOP-DATE(4:2)  TO PV-PASS-DD           08146000
081100                 MOVE ASC-STOP-DATE(7:4)  TO PV-PASS-YY           08147000
081100                 MOVE PV-PASS-DATE        TO SU038-TO-DATE        08148000
081500                                                                  08150000
081600         WHEN DP020-SRC-AID = DP016-ENTER                         08160000
081700             CONTINUE                                             08170000
081800                                                                  08180000
081900         WHEN OTHER                                               08190000
082000             SET DP013-NO-ROLLBACK                                08200000
082100                 DP013-XCTL-DISPLAY-RESTART                       08210000
082200                 DP013-CICS-ABEND  TO TRUE                        08220000
082300             MOVE '2100-CHECK-FUNCTION-KEY'                       08230000
082400                                   TO DP013-PARAGRAPH             08240000
082500             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      08250000
082600                                   TO DP013-MESSAGE-TEXT (1)      08260000
082700             PERFORM DP013-0000-PROCESS-ABEND                     08270000
082800     END-EVALUATE.                                                08280000
082900                                                                  08290000
083000******************************************************************08300000
083100** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **08310000
083200** INTER-APPLICATION COMMAREA.                                  **08320000
083300******************************************************************08330000
083400 2101-PREPARE-INTER-APPL-COMM.                                    08340000
083500     MOVE ASC-AUDIT-NBR-N          TO SU023-AUDIT-NBR.            08350000
083600                                                                  08360000
083700 2110-GET-NEXT-MESSAGE.                                           08370000
083800     ADD +1                        TO ASC-SEL-SUB.                08380000
083900     IF  ASC-SEL-SUB > SU025-MAX-ITEMS                            08390000
084000         ADD +1                    TO ASC-SEL-ITEM                08400000
084100         MOVE +1                   TO ASC-SEL-SUB                 08410000
084200     END-IF.                                                      08420000
084300     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                08430000
084400         PERFORM 9100-READ-SEL-QUEUE                              08440000
084500         IF  SU025-ITEM (ASC-SEL-SUB) > ZERO                      08450000
084600             MOVE SU025-AUDIT-NBR (ASC-SEL-SUB)                   08460000
084700                                   TO ASC-AUDIT-NBR-N             08470000
084800             MOVE SU025-SOURCE (ASC-SEL-SUB)                      08480000
084900                                   TO ASC-AUDIT-SOURCE            08490000
085000             MOVE SU025-OPER-UNIT (ASC-SEL-SUB)                   08500000
085100                                   TO ASC-OPER-UNIT               08510000
085200             MOVE SU025-PO-RECEIVER (ASC-SEL-SUB)                 08520000
085300                                   TO ASC-PO-RCVR                 08530000
085400                                                                  08540000
085500             IF SU025-PACK-LINE (ASC-SEL-SUB) = 'PBS'             08550000
085600                MOVE SPACES TO ASC-LINE-NBR-CHAR                  08560000
085700             ELSE                                                 08570000
085800                MOVE SU025-PACK-LINE (ASC-SEL-SUB)                08580000
085900                                   TO ASC-LINE-NBR                08590000
086000             END-IF                                               08600000
086100                                                                  08610000
086200             MOVE SU025-SKU (ASC-SEL-SUB)                         08620000
086300                                   TO ASC-SKU                     08630000
086400                                      DK-SKU-NBR                  08640000
086500             MOVE SU025-REQUEST-DATE (ASC-SEL-SUB)                08650000
086600                                   TO ASC-REQUEST-DATE            08660000
086700             MOVE SU025-REQUEST-MDCY (ASC-SEL-SUB)                08670000
086800                                   TO ASC-REQUEST-MDCY            08680000
086900             MOVE SU025-REQUEST-TIME (ASC-SEL-SUB)                08690000
087000                                   TO ASC-REQUEST-TIME            08700000
087100             MOVE SU025-PROCESS-ST-CDE (ASC-SEL-SUB)              08710000
087200                                   TO ASC-PROCESS-STATUS          08720000
087300             MOVE SU025-DEFERRED-IND (ASC-SEL-SUB)                08730000
087400                                   TO ASC-DEFERRED-IND            08740000
087500             MOVE SU025-MODIFIED-IND (ASC-SEL-SUB)                08750000
087600                                   TO ASC-MODIFIED-IND            08760000
087700                                                                  08770000
087800                                                                  08780000
087900             SET SU025-INQ (ASC-SEL-SUB)                          08790000
088000                                   TO TRUE                        08800000
088100             PERFORM 9200-REWRITE-LIST-QUEUE                      08810000
088200         ELSE                                                     08820000
088300             SUBTRACT +1 FROM ASC-SEL-SUB                         08830000
088400*            --- BOTTOM OF LIST ---                               08840000
088500             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            08850000
088600             SET DP020-MSG-INFORMATIONAL                          08860000
088700                                   TO TRUE                        08870000
088800         END-IF                                                   08880000
088900     ELSE                                                         08890000
089000         SUBTRACT +1 FROM ASC-SEL-ITEM                            08900000
089100         MOVE SU025-MAX-ITEMS      TO ASC-SEL-SUB                 08910000
089200         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            08920000
089300         SET DP020-MSG-INFORMATIONAL                              08930000
089400                                   TO TRUE                        08940000
089500     END-IF.                                                      08950000
089600*----------------------------------------------------------------*08960000
089700* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*08970000
089800* THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *08980000
089900* APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *08990000
090000*----------------------------------------------------------------*09000000
090100                                                                  09010000
090200******************************************************************09020000
090300** GET THE MESSAGE NUMBER (KEY) OF THE PREVIOUS SELECTED        **09030000
090400** OBJECT FROM THE SELECTED-ITEMS TEMP. STORAGE QUEUE.          **09040000
090500******************************************************************09050000
090600 2120-GET-PREV-MESSAGE.                                           09060000
090700     SUBTRACT +1 FROM ASC-SEL-SUB.                                09070000
090800     IF  ASC-SEL-SUB < +1                                         09080000
090900         SUBTRACT +1 FROM ASC-SEL-ITEM                            09090000
091000         MOVE SU025-MAX-ITEMS      TO ASC-SEL-SUB                 09100000
091100     END-IF.                                                      09110000
091200*                                                                 09120000
091300     IF  ASC-SEL-ITEM > ZERO                                      09130000
091400         PERFORM 9100-READ-SEL-QUEUE                              09140000
091500         MOVE SU025-AUDIT-NBR (ASC-SEL-SUB)                       09150000
091600                                   TO ASC-AUDIT-NBR-N             09160000
091700         MOVE SU025-SOURCE (ASC-SEL-SUB)                          09170000
091800                                   TO ASC-AUDIT-SOURCE            09180000
091900         MOVE SU025-OPER-UNIT (ASC-SEL-SUB)                       09190000
092000                                   TO ASC-OPER-UNIT               09200000
092100         MOVE SU025-PO-RECEIVER (ASC-SEL-SUB)                     09210000
092200                                   TO ASC-PO-RCVR                 09220000
092300                                                                  09230000
092400         IF SU025-PACK-LINE (ASC-SEL-SUB) = 'PBS'                 09240000
092500            MOVE SPACES TO ASC-LINE-NBR-CHAR                      09250000
092600         ELSE                                                     09260000
092700            MOVE SU025-PACK-LINE (ASC-SEL-SUB)                    09270000
092800                               TO ASC-LINE-NBR                    09280000
092900         END-IF                                                   09290000
093000                                                                  09300000
093100         MOVE SU025-SKU (ASC-SEL-SUB)                             09310000
093200                                   TO ASC-SKU                     09320000
093300                                      DK-SKU-NBR                  09330000
093400         MOVE SU025-REQUEST-DATE (ASC-SEL-SUB)                    09340000
093500                                   TO ASC-REQUEST-DATE            09350000
093600         MOVE SU025-REQUEST-MDCY (ASC-SEL-SUB)                    09360000
093700                                   TO ASC-REQUEST-MDCY            09370000
093800         MOVE SU025-REQUEST-TIME (ASC-SEL-SUB)                    09380000
093900                                   TO ASC-REQUEST-TIME            09390000
094000         MOVE SU025-PROCESS-ST-CDE (ASC-SEL-SUB)                  09400000
094100                                   TO ASC-PROCESS-STATUS          09410000
094200         MOVE SU025-DEFERRED-IND (ASC-SEL-SUB)                    09420000
094300                                   TO ASC-DEFERRED-IND            09430000
094400         MOVE SU025-MODIFIED-IND (ASC-SEL-SUB)                    09440000
094500                                   TO ASC-MODIFIED-IND            09450000
094600     ELSE                                                         09460000
094700         MOVE +1                   TO ASC-SEL-ITEM                09470000
094800                                      ASC-SEL-SUB                 09480000
094900*        --- TOP OF LIST ---                                      09490000
095000         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            09500000
095100         SET DP020-MSG-INFORMATIONAL                              09510000
095200                                   TO TRUE                        09520000
095300     END-IF.                                                      09530000
095400 EJECT                                                            09540000
095500 2200-MOVE-SCREEN-TO-COMMAREA.                                    09550000
095600     CONTINUE.                                                    09560000
095700                                                                  09570000
095800*----------------------------------------------------------------*09580000
095900* PERFORM EDITS ON EACH FIELD ENTERED BY THE USER.  IF AN ERROR  *09590000
096000* IS FOUND THE CURSOR IS POSITIONED AT THAT FIELD AND AN         *09600000
096100* APPROPRIATE ERROR MESSAGE IS DISPLAYED.                        *09610000
096200*----------------------------------------------------------------*09620000
096300                                                                  09630000
096400 3000-EDIT-DATA-IN-COMMAREA.                                      09640000
096500*    PERFORM 3200-RESET-ATTRIBUTES.                               09650000
096600     CONTINUE.                                                    09660000
096700                                                                  09670000
096800*3200-RESET-ATTRIBUTES.                                           09680000
096900*    MOVE DP015-ASK-NOR-OFF        TO AAUDTNBA                    09690000
097000*    MOVE DP015-BLUE               TO AAUDTNBC.                   09700000
097100                                                                  09710000
097200*----------------------------------------------------------------*09720000
097300* GET THE NEXT AVAILABLE MESSAGE NUMBER, MOVE IT TO THE SCREEN   *09730000
097400* AND POSITION THE CURSOR FOR THE INITIAL PANEL.                 *09740000
097500*----------------------------------------------------------------*09750000
097600                                                                  09760000
097700 4000-BUILD-INITIAL-PANEL.                                        09770000
097800                                                                  09780000
097900     SET DP030-SET-CURSOR-TRAILER                                 09790000
098000         PS-NO-ERROR             TO TRUE.                         09800000
098100                                                                  09810000
098200     PERFORM 4100-SELECT-AUDIT-DETAIL.                            09820000
098300     IF DN-PO = -1                                                09830000
098400         PERFORM 4010-BUILD-FROM-TSUNAUD                          09840000
098500     ELSE                                                         09850000
098600         PERFORM 4020-BUILD-FROM-SUT00015                         09860000
098700     END-IF.                                                      09870000
098800                                                                  09880000
098900 4010-BUILD-FROM-TSUNAUD.                                         09890000
099000     MOVE SUNAUD-PRC-FCLTY-AREA-ID                                09900000
099100                                  TO ASC-SOURCE.                  09910000
099200     MOVE 'MAN'                   TO ASC-AUDIT-SOURCE.            09920000
099300     MOVE SUNAUD-AUD-STAT-CDE     TO ASC-AUDIT-STATUS.            09930000
099400     IF  ASC-AUDIT-STATUS  =  'IP'                                09940000
099500         PERFORM 4275-SELECT-TSUAUPC                              09950000
099600     END-IF.                                                      09960000
099700     MOVE PV-AUDIT-TYPE           TO ASC-AUDIT-TYPE.              09970000
099800                                                                  09980000
099900     MOVE SUNAUD-AUD-USR-ID       TO ASC-CREATE-USERID.           09990000
100000     MOVE SUNAUD-AUD-STRT-TMST (6:2) TO PV-DATE-MM.               10000000
100100     MOVE SUNAUD-AUD-STRT-TMST (9:2) TO PV-DATE-DD.               10010000
100200     MOVE SUNAUD-AUD-STRT-TMST (1:4) TO PV-DATE-YY.               10020000
100300     MOVE PV-DATE                 TO ASC-START-DATE.              10030000
100400     MOVE SUNAUD-AUD-STRT-TMST (12:2) TO PV-TIME-HH.              10040000
100500     MOVE SUNAUD-AUD-STRT-TMST (15:2) TO PV-TIME-MM.              10050000
100600     MOVE PV-TIME                 TO ASC-START-TIME.              10060000
100700     MOVE SUNAUD-AUD-STP-TMST (6:2) TO PV-DATE-MM.                10070000
100800     MOVE SUNAUD-AUD-STP-TMST (9:2) TO PV-DATE-DD.                10080000
100900     MOVE SUNAUD-AUD-STP-TMST (1:4) TO PV-DATE-YY.                10090000
101000     MOVE PV-DATE                 TO ASC-STOP-DATE.               10100000
101100     MOVE SUNAUD-AUD-STP-TMST (12:2) TO PV-TIME-HH.               10110000
101200     MOVE SUNAUD-AUD-STP-TMST (15:2) TO PV-TIME-MM.               10120000
101300     MOVE PV-TIME                 TO ASC-STOP-TIME.               10130000
101400     MOVE SUNAUD-AUD-PSPND-MNIT-QTY                               10140000
101500                                  TO ASC-POSTPONED-MIN.           10150000
101600     MOVE SUNAUD-AUD-CLO-MNIT-QTY TO ASC-CLOSE-MIN.               10160000
101700     MOVE SUNAUD-OPER-UNT-ID      TO ASC-OPER-UNIT                10170000
101800                                     DK-OPER-UNT-ID.              10180000
101900     PERFORM 4200-SELECT-OPER-DESC.                               10190000
102000     MOVE XL071-LOC-NM            TO ASC-OPER-DESC.               10200000
102100     PERFORM 4300-CHECK-VIOLATIONS.                               10210000
102200     COMPUTE PV-TOTAL-ERRORS =                                    10220000
102300          PV-PICK-ERRORS +                                        10230000
102400          PV-PACK-ERRORS +                                        10240000
102500          PV-TICKET-ERRORS                                        10250000
102600     MOVE PV-TOTAL-ERRORS         TO ASC-TOTAL-ERRORS.            10260000
102700     MOVE PV-PICK-ERRORS          TO ASC-PICK-ERRORS.             10270000
102800     MOVE PV-PACK-ERRORS          TO ASC-PACK-ERRORS.             10280000
102900     MOVE PV-TICKET-ERRORS        TO ASC-TICKET-ERRORS.           10290000
      *SB 10/15/13 - BEGIN PR#5148D                                     10290100
102900     MOVE PV-RFID-ERRORS          TO ASC-RFID-ERRORS.             10291000
      *SB 10/15/13 - END PR#5148D                                       10292000
103000     PERFORM 4050-CALC-AUDIT-DURATION.                            10300000
103100     IF  PV-CARTON-DURATION  > 0                                  10310000
103200         DIVIDE  PV-CARTON-DURATION                               10320000
103300             BY  60                                               10330000
103400         GIVING  ASC-CARTON-HOURS                                 10340000
103500         REMAINDER  ASC-CARTON-MIN                                10350000
103600     ELSE                                                         10360000
103700         MOVE  ZEROES  TO  ASC-CARTON-HOURS                       10370000
103800                           ASC-CARTON-MIN                         10380000
103900     END-IF.                                                      10390000
104000                                                                  10400000
104100                                                                  10410000
104200 4020-BUILD-FROM-SUT00015.                                        10420000
104300     MOVE SUT00015-AUD-STAT-CDE   TO ASC-PROCESS-STATUS.          10430000
104400     MOVE 'SYS'                   TO ASC-AUDIT-SOURCE.            10440000
104500     MOVE SUT00015-AUD-CNTL-NBR   TO ASC-AUDIT-NBR-N.             10450000
104600     MOVE SUT00015-CRE-TMST (6:2) TO PV-DATE-MM.                  10460000
104700     MOVE SUT00015-CRE-TMST (9:2) TO PV-DATE-DD.                  10470000
104800     MOVE SUT00015-CRE-TMST (1:4) TO PV-DATE-YY.                  10480000
104900     MOVE PV-DATE                 TO ASC-CRE-DATE.                10490000
105000     MOVE SUT00015-CRE-TMST (12:2) TO PV-TIME-HH.                 10500000
105100     MOVE SUT00015-CRE-TMST (15:2) TO PV-TIME-MM.                 10510000
105200     MOVE PV-TIME                 TO ASC-CRE-TIME.                10520000
105300     MOVE SUT00015-PO-NBR         TO PV-PO.                       10530000
105400     MOVE SUT00015-RCVR-SEQ-NBR   TO PV-RECEIVER.                 10540000
105500     MOVE PV-PO-RECEIVER          TO ASC-PO-RCVR.                 10550000
105600                                                                  10560000
105700*LMM IF SUT00015-PO-LNE-NBR > 0                                   10570000
105800     EVALUATE TRUE                                                10580000
105900       WHEN SUT00015-PKGNG-TYP-CDE = 'BC'                         10590000
106000          MOVE SUT00015-PO-LNE-NBR                                10600000
106100                                  TO ASC-LINE-NBR                 10610000
106200       WHEN SUT00015-PKGNG-TYP-CDE = 'PP'                         10620000
106300          MOVE SUT00015-PO-PREPK-ID                               10630000
106400                                  TO ASC-LINE-NBR                 10640000
106500       WHEN SUT00015-PKGNG-TYP-CDE = 'PS'                         10650000
      *SB 10/15/13 - BEGIN PR#5148D                                     10650100
106500       WHEN SUT00015-PKGNG-TYP-CDE = 'RF'                         10651000
      *SB 10/15/13 - END PR#5148D                                       10652000
106600          MOVE SPACES             TO ASC-LINE-NBR-CHAR            10660000
106700     END-EVALUATE.                                                10670000
106800                                                                  10680000
106900     MOVE SUT00015-OPER-UNT-ID    TO ASC-OPER-UNIT                10690000
107000                                     DK-OPER-UNT-ID.              10700000
107100     PERFORM 4200-SELECT-OPER-DESC.                               10710000
107200     MOVE XL071-LOC-NM            TO ASC-OPER-DESC.               10720000
107300     MOVE SUT00015-ENT-ID         TO ASC-ENT-ID                   10730000
107400                                     DK-ENT-ID.                   10740000
107500     PERFORM 4250-SELECT-VENDOR.                                  10750000
107600     MOVE ENTNME-ENT-NAME-DESC    TO ASC-ENT-DESC.                10760000
107700     MOVE SUT00015-DEPT-NBR       TO ASC-DEPT                     10770000
107800                                     PV-DEPT-NBR.                 10780000
107900     MOVE PV-DEPT-NBR-X           TO DK-DEPT-NBR.                 10790000
108000     PERFORM 4270-SELECT-DEPT.                                    10800000
108100     MOVE MDSEAR-DESC             TO ASC-DEPT-DESC.               10810000
108200     MOVE SUNAUD-PRC-FCLTY-AREA-ID                                10820000
108300                                  TO ASC-SOURCE.                  10830000
108400     MOVE SUT00015-PKGNG-TYP-CDE  TO ASC-PACKAGE-TYPE.            10840000
108500     MOVE SUNAUD-AUD-STAT-CDE     TO ASC-AUDIT-STATUS.            10850000
108600     PERFORM 4275-SELECT-TSUAUPC.                                 10860000
108700     MOVE PV-AUDIT-TYPE           TO ASC-AUDIT-TYPE.              10870000
108800     MOVE SUT00015-DFRD-AUD-IND   TO ASC-DEFERRED-IND.            10880000
108900     MOVE SUNAUD-AUD-USR-ID       TO ASC-CREATE-USERID.           10890000
109000     MOVE SUNAUD-AUD-STRT-TMST (6:2) TO PV-DATE-MM.               10900000
109100     MOVE SUNAUD-AUD-STRT-TMST (9:2) TO PV-DATE-DD.               10910000
109200     MOVE SUNAUD-AUD-STRT-TMST (1:4) TO PV-DATE-YY.               10920000
109300     MOVE PV-DATE                 TO ASC-START-DATE.              10930000
109400     MOVE SUNAUD-AUD-STRT-TMST (12:2) TO PV-TIME-HH.              10940000
109500     MOVE SUNAUD-AUD-STRT-TMST (15:2) TO PV-TIME-MM.              10950000
109600     MOVE PV-TIME                 TO ASC-START-TIME.              10960000
109700     MOVE SUNAUD-AUD-STP-TMST (6:2) TO PV-DATE-MM.                10970000
109800     MOVE SUNAUD-AUD-STP-TMST (9:2) TO PV-DATE-DD.                10980000
109900     MOVE SUNAUD-AUD-STP-TMST (1:4) TO PV-DATE-YY.                10990000
110000     MOVE PV-DATE                 TO ASC-STOP-DATE.               11000000
110100     MOVE SUNAUD-AUD-STP-TMST (12:2) TO PV-TIME-HH.               11010000
110200     MOVE SUNAUD-AUD-STP-TMST (15:2) TO PV-TIME-MM.               11020000
110300     MOVE PV-TIME                 TO ASC-STOP-TIME.               11030000
110400     MOVE SUNAUD-AUD-PSPND-MNIT-QTY                               11040000
110500                                  TO ASC-POSTPONED-MIN.           11050000
110600     MOVE SUNAUD-AUD-CLO-MNIT-QTY TO ASC-CLOSE-MIN.               11060000
110610     MOVE SUT00015-MOD-QTY-IND    TO ASC-MOD-QTY-IND.             11061000
110700     PERFORM 4300-CHECK-VIOLATIONS.                               11070000
110800     MOVE SUT00015-CART-QTY       TO ASC-REQ-CARTONS.             11080000
110900     COMPUTE PV-TOTAL-ERRORS =                                    11090000
111000          PV-PICK-ERRORS +                                        11100000
111100          PV-PACK-ERRORS +                                        11110000
111200          PV-TICKET-ERRORS                                        11120000
111300     MOVE PV-TOTAL-ERRORS         TO ASC-TOTAL-ERRORS.            11130000
111400     MOVE SUT00015-UNT-QTY        TO ASC-REQ-UNITS.               11140000
111500     MOVE PV-PICK-ERRORS          TO ASC-PICK-ERRORS.             11150000
111600     MOVE SUT00015-AUD-CART-QTY   TO ASC-AUDIT-CARTONS.           11160000
111700     MOVE PV-PACK-ERRORS          TO ASC-PACK-ERRORS.             11170000
111800     MOVE SUT00015-AUD-UNT-QTY    TO ASC-AUDIT-UNITS.             11180000
111900     MOVE PV-TICKET-ERRORS        TO ASC-TICKET-ERRORS.           11190000
      *SB 10/15/13 - BEGIN PR#5148D                                     11190100
111900     MOVE PV-RFID-ERRORS          TO ASC-RFID-ERRORS.             11191000
      *SB 10/15/13 - END PR#5148D                                       11192000
112000     PERFORM 4050-CALC-AUDIT-DURATION.                            11200000
112100     IF  PV-CARTON-DURATION  > 0                                  11210000
112200         DIVIDE  PV-CARTON-DURATION                               11220000
112300             BY  60                                               11230000
112400         GIVING  ASC-CARTON-HOURS                                 11240000
112500         REMAINDER  ASC-CARTON-MIN                                11250000
112600     ELSE                                                         11260000
112700         MOVE  ZEROES  TO  ASC-CARTON-HOURS                       11270000
112800                           ASC-CARTON-MIN                         11280000
112900     END-IF.                                                      11290000
113000                                                                  11300000
113100                                                                  11310000
113200******************************************************************11320000
113300* CALCULATION AUDIT DURATION                                      11330000
113400******************************************************************11340000
113500 4050-CALC-AUDIT-DURATION.                                        11350000
113600                                                                  11360000
113700     INITIALIZE  PV-AUDIT-DURATION                                11370000
113800                 PV-CARTON-DURATION.                              11380000
113900     SET  PS-NOT-EOF-CARTON-CSR  TO  TRUE.                        11390000
114000                                                                  11400000
114100     PERFORM 4060-OPEN-CARTON-CSR.                                11410000
114200     PERFORM 4065-FETCH-CARTON-CSR.                               11420000
114300                                                                  11430000
114400     IF  PS-EOF-CARTON-CSR                                        11440000
114500         CONTINUE                                                 11450000
114600     ELSE                                                         11460000
114700         PERFORM 4070-CARTON-DURATION                             11470000
114800           UNTIL PS-EOF-CARTON-CSR                                11480000
114900     END-IF.                                                      11490000
115000                                                                  11500000
115100     PERFORM 4075-CLOSE-CARTON-CSR.                               11510000
115200                                                                  11520000
115300                                                                  11530000
115400 4060-OPEN-CARTON-CSR.                                            11540000
115500                                                                  11550000
115600     EXEC SQL                                                     11560000
115700         OPEN CARTON-CSR                                          11570000
115800     END-EXEC.                                                    11580000
115900                                                                  11590000
116000     EVALUATE TRUE                                                11600000
116100         WHEN SQLCODE = ZERO                                      11610000
116200             CONTINUE                                             11620000
116300         WHEN SQLWARN0 NOT = SPACES                               11630000
116400         WHEN SQLCODE < +0                                        11640000
116500         WHEN SQLCODE > ZERO                                      11650000
116600             MOVE '4060-OPEN-CARTON-CSR'                          11660000
116700                             TO DP013-PARAGRAPH                   11670000
116800             MOVE 'OPEN CARTON CURSOR'                            11680000
116900                             TO DP013-MESSAGE-TEXT (1)            11690000
117000             MOVE SQLCA      TO DP013-SQLCA                       11700000
117100             MOVE 'TSUATRN ' TO DP013-DB2-TABLE-NAME (1)          11710000
117200             SET DP013-DB2-ABEND                                  11720000
117300                             TO TRUE                              11730000
117400             SET DP013-XCTL-DISPLAY-RESTART                       11740000
117500                             TO TRUE                              11750000
117600             PERFORM DP013-0000-PROCESS-ABEND                     11760000
117700     END-EVALUATE.                                                11770000
117800                                                                  11780000
117900                                                                  11790000
118000 4065-FETCH-CARTON-CSR.                                           11800000
118100                                                                  11810000
118200     EXEC SQL                                                     11820000
118300         FETCH CARTON-CSR                                         11830000
118400         INTO                                                     11840000
118500             :SUATRN-SHIPT-UNT-ID                                 11850000
118600         ,   :PV-CARTON-DURATION                                  11860000
118700     END-EXEC.                                                    11870000
118800                                                                  11880000
118900     EVALUATE TRUE                                                11890000
119000         WHEN SQLCODE = ZERO                                      11900000
119100              IF  PV-CARTON-DURATION  = 0                         11910000
119200                  MOVE  1             TO PV-CARTON-DURATION       11920000
119300              END-IF                                              11930000
119400                                                                  11940000
119500         WHEN SQLCODE = +100                                      11950000
119600              SET PS-EOF-CARTON-CSR    TO TRUE                    11960000
119700                                                                  11970000
119800         WHEN SQLWARN0 NOT = SPACES                               11980000
119900         WHEN SQLCODE < +0                                        11990000
120000         WHEN SQLCODE > ZERO                                      12000000
120100             MOVE '4065-FETCH-CARTON-CSR'                         12010000
120200                             TO DP013-PARAGRAPH                   12020000
120300             MOVE 'FETCH CARTON CURSOR'                           12030000
120400                             TO DP013-MESSAGE-TEXT (1)            12040000
120500             MOVE SQLCA      TO DP013-SQLCA                       12050000
120600             MOVE 'TSUATRN ' TO DP013-DB2-TABLE-NAME (1)          12060000
120700             SET DP013-DB2-ABEND                                  12070000
120800                             TO TRUE                              12080000
120900             SET DP013-XCTL-DISPLAY-RESTART                       12090000
121000                             TO TRUE                              12100000
121100             PERFORM DP013-0000-PROCESS-ABEND                     12110000
121200     END-EVALUATE.                                                12120000
121300                                                                  12130000
121400                                                                  12140000
121500 4070-CARTON-DURATION.                                            12150000
121600                                                                  12160000
121700     ADD  PV-CARTON-DURATION TO PV-AUDIT-DURATION.                12170000
121800                                                                  12180000
121900     PERFORM 4065-FETCH-CARTON-CSR.                               12190000
122000                                                                  12200000
122100                                                                  12210000
122200 4075-CLOSE-CARTON-CSR.                                           12220000
122300                                                                  12230000
122400     EXEC SQL                                                     12240000
122500         CLOSE CARTON-CSR                                         12250000
122600     END-EXEC.                                                    12260000
122700                                                                  12270000
122800     EVALUATE TRUE                                                12280000
122900         WHEN SQLCODE = ZERO                                      12290000
123000             CONTINUE                                             12300000
123100                                                                  12310000
123200         WHEN SQLWARN0 NOT = SPACES                               12320000
123300         WHEN SQLCODE < +0                                        12330000
123400         WHEN SQLCODE > ZERO                                      12340000
123500             MOVE '4075-CLOSE-CARTON-CSR'                         12350000
123600                             TO DP013-PARAGRAPH                   12360000
123700             MOVE 'CLOSE CARTON CURSOR'                           12370000
123800                             TO DP013-MESSAGE-TEXT (1)            12380000
123900             MOVE SQLCA      TO DP013-SQLCA                       12390000
124000             MOVE 'TSUATRN ' TO DP013-DB2-TABLE-NAME (1)          12400000
124100             SET DP013-DB2-ABEND                                  12410000
124200                             TO TRUE                              12420000
124300             SET DP013-XCTL-DISPLAY-RESTART                       12430000
124400                             TO TRUE                              12440000
124500             PERFORM DP013-0000-PROCESS-ABEND                     12450000
124600     END-EVALUATE.                                                12460000
124700                                                                  12470000
124800******************************************************************12480000
124900*                                                                 12490000
125000******************************************************************12500000
125100 4100-SELECT-AUDIT-DETAIL.                                        12510000
125200                                                                  12520000
125300     EXEC SQL                                                     12530000
125400          SELECT DISTINCT                                         12540000
125500                AUD.AUD_STRT_TMST                                 12550000
125600             ,  AUD.AUD_STP_TMST                                  12560000
125700             ,  AUD.AUD_PSPND_MNIT_QTY                            12570000
125800             ,  AUD.AUD_CLO_MNIT_QTY                              12580000
125900             ,  AUD.AUD_USR_ID                                    12590000
126000             ,  AUD.PRC_FCLTY_AREA_ID                             12600000
126100             ,  AUD.AUD_STAT_CDE                                  12610000
126200             ,  CASE                                              12620000
126300                   AUD.AUD_TYP_CDE                                12630000
126400                WHEN '01' THEN '100%  '                           12640000
126500                WHEN '02' THEN 'SPOT  '                           12650000
126600                WHEN '03' THEN 'REWORK'                           12660000
126700                END                                               12670000
126800             ,  AUD.OPER_UNT_ID                                   12680000
126900                                                                  12690000
127000             ,  REQ.PO_NBR                                        12700000
127100             ,  REQ.PO_LNE_NBR                                    12710000
127200             ,  REQ.PO_PREPK_ID                                   12720000
127300             ,  REQ.OPER_UNT_ID                                   12730000
127400             ,  REQ.RCVR_SEQ_NBR                                  12740000
127500             ,  REQ.AUD_CNTL_NBR                                  12750000
127600             ,  REQ.CART_QTY                                      12760000
127700             ,  REQ.UNT_QTY                                       12770000
127800             ,  REQ.AUD_CART_QTY                                  12780000
127900             ,  REQ.AUD_UNT_QTY                                   12790000
128000             ,  REQ.AUD_STAT_CDE                                  12800000
128100             ,  REQ.DFRD_AUD_IND                                  12810000
128200             ,  REQ.AUD_ERR_PCT                                   12820000
128300             ,  REQ.CRE_TMST                                      12830000
128400             ,  REQ.CART_PRMPT_CDE                                12840000
128500             ,  REQ.PKGNG_TYP_CDE                                 12850000
128600             ,  REQ.EFF_BEG_TMST                                  12860000
128700             ,  REQ.ENT_ID                                        12870000
128800             ,  REQ.DEPT_NBR                                      12880000
128810             ,  MOD_QTY_IND                                       12881000
128900                                                                  12890000
129000          INTO                                                    12900000
129100                                                                  12910000
129200                :SUNAUD-AUD-STRT-TMST                             12920000
129300             ,  :SUNAUD-AUD-STP-TMST                              12930000
129400             ,  :SUNAUD-AUD-PSPND-MNIT-QTY                        12940000
129500             ,  :SUNAUD-AUD-CLO-MNIT-QTY                          12950000
129600             ,  :SUNAUD-AUD-USR-ID                                12960000
129700             ,  :SUNAUD-PRC-FCLTY-AREA-ID                         12970000
129800             ,  :SUNAUD-AUD-STAT-CDE                              12980000
129900             ,  :PV-AUDIT-TYPE                                    12990000
130000             ,  :SUNAUD-OPER-UNT-ID                               13000000
130100                                                                  13010000
130200             ,  :SUT00015-PO-NBR:DN-PO                            13020000
130300             ,  :SUT00015-PO-LNE-NBR:DN-PO                        13030000
130400             ,  :SUT00015-PO-PREPK-ID:DN-PO                       13040000
130500             ,  :SUT00015-OPER-UNT-ID:DN-PO                       13050000
130600             ,  :SUT00015-RCVR-SEQ-NBR:DN-PO                      13060000
130700             ,  :SUT00015-AUD-CNTL-NBR:DN-PO                      13070000
130800             ,  :SUT00015-CART-QTY:DN-PO                          13080000
130900             ,  :SUT00015-UNT-QTY:DN-PO                           13090000
131000             ,  :SUT00015-AUD-CART-QTY:DN-PO                      13100000
131100             ,  :SUT00015-AUD-UNT-QTY:DN-PO                       13110000
131200             ,  :SUT00015-AUD-STAT-CDE:DN-PO                      13120000
131300             ,  :SUT00015-DFRD-AUD-IND:DN-PO                      13130000
131400             ,  :SUT00015-AUD-ERR-PCT:DN-PO                       13140000
131500             ,  :SUT00015-CRE-TMST:DN-PO                          13150000
131600             ,  :SUT00015-CART-PRMPT-CDE:DN-PO                    13160000
131700             ,  :SUT00015-PKGNG-TYP-CDE:DN-PO                     13170000
131800             ,  :SUT00015-EFF-BEG-TMST:DN-PO                      13180000
131900             ,  :SUT00015-ENT-ID:DN-PO                            13190000
132000             ,  :SUT00015-DEPT-NBR:DN-PO                          13200000
132010             ,  :SUT00015-MOD-QTY-IND:DN-PO                       13201000
132100          FROM                                                    13210000
132200                TSUNAUD        AUD                                13220000
132300            LEFT OUTER JOIN                                       13230000
132400                SUT_PO_AUD_REQ REQ                                13240000
132500             ON REQ.AUD_CNTL_NBR    = AUD.AUD_CNTL_NBR            13250000
132600          WHERE AUD.AUD_CNTL_NBR    = :DK-AUDIT-NBR               13260000
132700     END-EXEC                                                     13270000
132800                                                                  13280000
132900                                                                  13290000
133000     EVALUATE TRUE                                                13300000
133100         WHEN SQLCODE = ZERO                                      13310000
133200             CONTINUE                                             13320000
133300                                                                  13330000
133400         WHEN SQLWARN0 NOT = SPACES                               13340000
133500         WHEN SQLCODE < +0                                        13350000
133600         WHEN SQLCODE > ZERO                                      13360000
133700             MOVE DK-AUDIT-NBR TO PV-DISPLAY-AUDIT-CNTL-NBR       13370000
133800             MOVE '4100-SELECT-AUDIT-DETAIL'                      13380000
133900                             TO DP013-PARAGRAPH                   13390000
134000             MOVE 'SELECT AUDIT INFO'                             13400000
134100                             TO DP013-MESSAGE-TEXT (1)            13410000
134200             MOVE PV-DISPLAY-AUDIT-CNTL-NBR                       13420000
134300                             TO DP013-MESSAGE-TEXT (2)            13430000
134400             MOVE SQLCA      TO DP013-SQLCA                       13440000
134500             MOVE 'SUT00015' TO DP013-DB2-TABLE-NAME (1)          13450000
134600             MOVE 'TSUNAUD'  TO DP013-DB2-TABLE-NAME (2)          13460000
134700             SET DP013-DB2-ABEND                                  13470000
134800                             TO TRUE                              13480000
134900             SET DP013-XCTL-DISPLAY-RESTART                       13490000
135000                             TO TRUE                              13500000
135100             PERFORM DP013-0000-PROCESS-ABEND                     13510000
135200     END-EVALUATE.                                                13520000
135300                                                                  13530000
135400*----------------------------------------------------------------*13540000
135500*       GET THE FACILITY NAME                                    *13550000
135600*----------------------------------------------------------------*13560000
135700 4200-SELECT-OPER-DESC.                                           13570000
136000                                                                  13600000
136100     INITIALIZE XL071-COMMAREA-REC.                               13610000
136200     MOVE DK-OPER-UNT-ID  TO XL071-LOCATION-NUMBER.               13620000
136300                                                                  13630000
136400     CALL PC-LOCATION-MODULE  USING                               13640000
136500                                    DFHEIBLK                      13650000
136600                                    XL071-COMMAREA                13660000
136700                                    XL071-COMMAREA-REC.           13670000
136800                                                                  13680000
136900     EVALUATE TRUE                                                13690000
137000         WHEN XL071-NO-ERRORS                                     13700000
137100              CONTINUE                                            13710000
137200                                                                  13720000
137300         WHEN OTHER                                               13730000
137400              INITIALIZE PV-CICS-MSG-AREA                         13740000
137500              STRING ' SUKCS590 - CALL XLTUT071 -'                13750000
137600                     ' SQLCODE=' XL071-SQLCODE                    13760000
137700                     ' TABLE='   XL071-DB2-TABLE                  13770000
137800                                              DELIMITED BY SIZE   13780000
137900                                         INTO PV-CICS-MSG-AREA    13790000
138000              MOVE LENGTH OF PV-CICS-MSG-AREA                     13800000
138100                                        TO PV-COMMAREA-LENGTH     13810000
138200              EXEC CICS                                           13820000
138300                   WRITEQ TD                                      13830000
138400                    QUEUE  ('CSSL')                               13840000
138500                     FROM  (PV-CICS-MSG-AREA)                     13850000
138600                   LENGTH  (PV-COMMAREA-LENGTH)                   13860000
138700                     RESP  (PV-CICS-RESPONSE)                     13870000
138800              END-EXEC                                            13880000
138900              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              13890000
139000              PERFORM 9900-SOFT-ABORT                             13900000
139100     END-EVALUATE.                                                13910000
139200                                                                  13920000
139300 4250-SELECT-VENDOR.                                              13930000
139400                                                                  13940000
139500     EXEC SQL                                                     13950000
139600          SELECT ENT_NAME_DESC                                    13960000
139700            INTO :ENTNME-ENT-NAME-DESC                            13970000
139800            FROM TEXTENT A                                        13980000
139900                ,TENTNME B                                        13990000
140000           WHERE A.ENT_ID      = :DK-ENT-ID                       14000000
140100             AND A.ENT_ID = B.ENT_ID                              14010000
140200             AND A.STATUS_CDE  = 'A'                              14020000
140300             AND B.TYPE_CDE    = '01'                             14030000
                 WITH UR                                                14031000
140400     END-EXEC.                                                    14040000
140500                                                                  14050000
140600     EVALUATE TRUE                                                14060000
140700         WHEN SQLCODE = +0                                        14070000
140800         WHEN SQLCODE = -811                                      14080000
140900             CONTINUE                                             14090000
141000         WHEN SQLCODE = +100                                      14100000
141100             MOVE SPACES   TO ENTNME-ENT-NAME-DESC                14110000
141200         WHEN SQLWARN0 NOT = SPACES                               14120000
141300         WHEN SQLCODE < +0                                        14130000
141400         WHEN SQLCODE > +0                                        14140000
141500             MOVE '4250-SELECT-VENDOR'                            14150000
141600                             TO DP013-PARAGRAPH                   14160000
141700             MOVE 'SELECT SCAC CODE'                              14170000
141800                             TO DP013-MESSAGE-TEXT (1)            14180000
141900             MOVE SQLCA      TO DP013-SQLCA                       14190000
142000             MOVE 'TEXTENT'  TO DP013-DB2-TABLE-NAME (1)          14200000
142100             SET DP013-DB2-ABEND                                  14210000
142200                             TO TRUE                              14220000
142300             SET DP013-XCTL-DISPLAY-RESTART                       14230000
142400                             TO TRUE                              14240000
142500             PERFORM DP013-0000-PROCESS-ABEND                     14250000
142600     END-EVALUATE.                                                14260000
142700                                                                  14270000
142800 4270-SELECT-DEPT.                                                14280000
142900                                                                  14290000
143000     EXEC SQL                                                     14300000
143100         SELECT A.ENT_ID                                          14310000
143200             ,  B.MDSEAR_DESC                                     14320000
143300          INTO  :VNDDPT-ENT-ID                                    14330000
143400             ,  :MDSEAR-DESC                                      14340000
143500          FROM  TVNDDPT A                                         14350000
143600             ,  TMDSEAR B                                         14360000
143700          WHERE A.ENT_ID         = :DK-ENT-ID                     14370000
143800           AND  A.DEPT_NBR       = :DK-DEPT-NBR                   14380000
143900            AND A.DEPT_NBR       = B.DEPT_NBR                     14390000
144000            AND B.MDSELV_CDE     = 'DPT'                          14400000
144100            AND B.OPERCO_NBR     = '03'                           14410000
144200            AND (B.STRT_DTE     <= CURRENT DATE AND               14420000
144300                 B.END_DTE       > CURRENT DATE)                  14430000
144400     END-EXEC.                                                    14440000
144500                                                                  14450000
144600     EVALUATE TRUE                                                14460000
144700         WHEN SQLCODE = +0                                        14470000
144800             CONTINUE                                             14480000
144900                                                                  14490000
145000         WHEN SQLCODE = +100                                      14500000
145100             MOVE SPACES   TO MDSEAR-DESC                         14510000
145200                                                                  14520000
145300         WHEN SQLWARN0 NOT = SPACE                                14530000
145400         WHEN SQLCODE < +0                                        14540000
145500         WHEN SQLCODE > +0                                        14550000
145600             MOVE '4270-SELECT-DEPT'                              14560000
145700                             TO DP013-PARAGRAPH                   14570000
145800             MOVE 'VALIDATE THE DEPT NUMBER'                      14580000
145900                             TO DP013-MESSAGE-TEXT (1)            14590000
146000             MOVE SQLCA      TO DP013-SQLCA                       14600000
146100             MOVE 'TVNDDPT'  TO DP013-DB2-TABLE-NAME (1)          14610000
146200             MOVE 'TMDSEAR'  TO DP013-DB2-TABLE-NAME (2)          14620000
146300             SET DP013-DB2-ABEND                                  14630000
146400                             TO TRUE                              14640000
146500             SET DP013-XCTL-DISPLAY-RESTART                       14650000
146600                             TO TRUE                              14660000
146700             PERFORM DP013-0000-PROCESS-ABEND                     14670000
146800     END-EVALUATE.                                                14680000
146900                                                                  14690000
147000******************************************************************14700000
147100* FOR INPROCESS AUDITS CHECK TO SEE IF AUDIT HAS ACTUALLY BEEN STA14710000
147200******************************************************************14720000
147300 4275-SELECT-TSUAUPC.                                             14730000
147400     EXEC SQL                                                     14740000
147500         SELECT DISTINCT                                          14750000
147600                SKU_NBR                                           14760000
147700          INTO                                                    14770000
147800             :SUAUPC-SKU-NBR                                      14780000
147900          FROM TSUAUPC                                            14790000
148000          WHERE AUD_CNTL_NBR      = :DK-AUDIT-NBR                 14800000
148100     END-EXEC.                                                    14810000
148200                                                                  14820000
148300     EVALUATE TRUE                                                14830000
148400         WHEN SQLCODE = ZERO                                      14840000
148500             PERFORM 4280-CALL-XLKUT001                           14850000
148600             MOVE SUAUPC-SKU-NBR         TO PV-SKU-NBR            14860000
148700             STRING XL001-DEPT-NBR-3CH   DELIMITED BY SIZE        14870000
148800                  , ' '                  DELIMITED BY SIZE        14880000
148900                  , XL001-SUB-CL-NBR-2CH DELIMITED BY SIZE        14890000
149000                  , ' '                  DELIMITED BY SIZE        14900000
149100                  , PV-SKU-NBR-X         DELIMITED BY SIZE        14910000
149200                                        INTO ASC-SKU              14920000
149300         WHEN SQLCODE = -811                                      14930000
149400              MOVE 'MULTIPLE'           TO ASC-SKU                14940000
149500         WHEN SQLCODE = +100                                      14950000
149600              CONTINUE                                            14960000
149700***           MOVE 'R'  TO ASC-AUDIT-STATUS                       14970000
149800         WHEN SQLWARN0 NOT = SPACES                               14980000
149900         WHEN SQLCODE < +0                                        14990000
150000         WHEN SQLCODE > ZERO                                      15000000
150100             MOVE '4275-SELECT-TSUAUPC'                           15010000
150200                             TO DP013-PARAGRAPH                   15020000
150300             MOVE 'SELECT TSUAUPC'                                15030000
150400                             TO DP013-MESSAGE-TEXT (1)            15040000
150500             MOVE SQLCA      TO DP013-SQLCA                       15050000
150600             MOVE 'TSUAUPC'  TO DP013-DB2-TABLE-NAME (1)          15060000
150700             SET DP013-DB2-ABEND                                  15070000
150800                             TO TRUE                              15080000
150900             SET DP013-XCTL-DISPLAY-RESTART                       15090000
151000                             TO TRUE                              15100000
151100             PERFORM DP013-0000-PROCESS-ABEND                     15110000
151200     END-EVALUATE.                                                15120000
151300                                                                  15130000
151400 4280-CALL-XLKUT001.                                              15140000
151500                                                                  15150000
151600     INITIALIZE XL001-ITEM-COMMAREA                               15160000
151700     SET XL001-SELECT-VND-STYL                                    15170000
151800         XL001-BY-NUMERIC-SKU         TO TRUE.                    15180000
151900                                                                  15190000
152000     MOVE SUAUPC-SKU-NBR              TO XL001-KEY-SKU.           15200000
152100                                                                  15210000
152200     CALL XL001-VSM-PGM  USING DFHEIBLK                           15220000
152300                              XL001-COMMAREA                      15230000
152400                              XL001-ITEM-COMMAREA.                15240000
152500                                                                  15250000
152600     EVALUATE TRUE                                                15260000
152700         WHEN XL001-SUCCESSFUL                                    15270000
152800         WHEN XL001-SKU-NOT-FOUND                                 15280000
152900             CONTINUE                                             15290000
153000         WHEN XL001-SQL-ERROR                                     15300000
153100         WHEN XL001-INVALID-ACCESS                                15310000
153200             MOVE '4280-CALL-XLKUT001'                            15320000
153300                             TO DP013-PARAGRAPH                   15330000
153400             MOVE 'CALL XLUT0001'                                 15340000
153500                             TO DP013-MESSAGE-TEXT (1)            15350000
153600             MOVE 'INVALID ACCESS'                                15360000
153700                             TO DP013-MESSAGE-TEXT (2)            15370000
153800             SET DP013-DB2-ABEND                                  15380000
153900                             TO TRUE                              15390000
154000             SET DP013-XCTL-DISPLAY-RESTART                       15400000
154100                             TO TRUE                              15410000
154200             PERFORM DP013-0000-PROCESS-ABEND                     15420000
154300         WHEN OTHER                                               15430000
154400             MOVE '4280-CALL-XLKUT001'                            15440000
154500                             TO DP013-PARAGRAPH                   15450000
154600             MOVE 'CALL XLUT0001'                                 15460000
154700                             TO DP013-MESSAGE-TEXT (1)            15470000
154800             MOVE 'OTHER ABEND'                                   15480000
154900                             TO DP013-MESSAGE-TEXT (2)            15490000
155000             SET DP013-DB2-ABEND                                  15500000
155100                             TO TRUE                              15510000
155200             SET DP013-XCTL-DISPLAY-RESTART                       15520000
155300                             TO TRUE                              15530000
155400             PERFORM DP013-0000-PROCESS-ABEND                     15540000
155500     END-EVALUATE.                                                15550000
155600                                                                  15560000
155700******************************************************************15570000
155800* 4300-CHECK-VIOLATIONS. -- GET THE SUM OF THE VIOLATIONS BY TYPE 15580000
155900******************************************************************15590000
156000 4300-CHECK-VIOLATIONS.                                           15600000
156100                                                                  15610000
156200     PERFORM 4330-OPEN-VIOLATION-CURSOR                           15620000
156300     MOVE SPACES                   TO PV-SAVE-SCN-TMST            15630000
156400     PERFORM 4360-FETCH-VIOLATION-CURSOR                          15640000
156500                                                                  15650000
156600     PERFORM UNTIL PS-EOC-VIOLATION-CURSOR                        15660000
156700         IF SUEXCP-SCN-TMST NOT = PV-SAVE-SCN-TMST                15670000
156800             ADD PV-DB2-ERROR-COUNT                               15680000
156900                                   TO PV-PICK-ERRORS              15690000
157000             MOVE SUEXCP-SCN-TMST  TO PV-SAVE-SCN-TMST            15700000
157100         END-IF                                                   15710000
157200         PERFORM 4360-FETCH-VIOLATION-CURSOR                      15720000
157300     END-PERFORM.                                                 15730000
157400                                                                  15740000
157500     PERFORM 4390-CLOSE-VIOLATION-CURSOR.                         15750000
157600                                                                  15760000
157700     PERFORM 4391-OPEN-TICKET-CURSOR                              15770000
157800     PERFORM 4393-FETCH-TICKET-CURSOR                             15780000
157900     MOVE 0                     TO PV-HOLD-UPC-NBR                15790000
158000                                   PV-TOTAL-TICKET-COUNT          15800000
158100     PERFORM UNTIL PS-EOC-TICKET-CURSOR                           15810000
158200**   THE ITEMS FROM THE CURSOR ARE IN UPC, TICKET-COUNT (DESC)    15820000
158300**   ORDER, THEREFORE ONLY THE FIRST FETCH FOR THE UPC IS ADDED   15830000
158400         IF SUAUPC-UPC-NBR NOT = PV-HOLD-UPC-NBR                  15840000
158500             ADD  PV-DB2-TICKET-COUNT   TO PV-TOTAL-TICKET-COUNT  15850000
158600             MOVE SUAUPC-UPC-NBR TO  PV-HOLD-UPC-NBR              15860000
158700         END-IF                                                   15870000
158800         PERFORM 4393-FETCH-TICKET-CURSOR                         15880000
158900     END-PERFORM.                                                 15890000
159000                                                                  15900000
159100     PERFORM 4395-CLOSE-TICKET-CURSOR.                            15910000
159200                                                                  15920000
159300                                                                  15930000
159400     MOVE PV-TOTAL-TICKET-COUNT    TO PV-TICKET-ERRORS.           15940000
159500                                                                  15950000
159600     PERFORM 4397-SELECT-I-PACK-ERRORS.                           15960000
159700     MOVE PV-DB2-ERROR-COUNT       TO PV-PACK-ERRORS.             15970000
159800                                                                  15980000
      *SB 10/15/13 - BEGIN PR#5148D                                     15980100
      *****CALCULATING RFID ERRORS**************************************15980200
156300     MOVE SPACES                   TO PV-SAVE-SCN-TMST            15980300
156200     PERFORM 4500-OPEN-RFIDERR-CURSOR                             15981000
157800     PERFORM 4510-FETCH-RFIDERR-CURSOR                            15981100
157900     MOVE 0                          TO PV-HOLD-UPC-NBR           15981200
158000                                        PV-TOTAL-RFID-COUNT       15981300
158100     PERFORM UNTIL PS-EOC-RFIDERR-CURSOR                          15981400
156700         IF SUEXCP-SCN-TMST NOT = PV-SAVE-SCN-TMST                15981700
158500             ADD  PV-DB2-RFID-COUNT  TO PV-TOTAL-RFID-COUNT       15981800
158600*            MOVE SUAUPC-UPC-NBR     TO PV-HOLD-UPC-NBR           15981900
157000             MOVE SUEXCP-SCN-TMST    TO PV-SAVE-SCN-TMST          15982000
157100         END-IF                                                   15982100
158800         PERFORM 4510-FETCH-RFIDERR-CURSOR                        15982300
158900     END-PERFORM.                                                 15982400
159000                                                                  15982500
159100     PERFORM 4515-CLOSE-RFIDERR-CURSOR.                           15982600
159200                                                                  15982700
159400     MOVE PV-TOTAL-RFID-COUNT        TO PV-RFID-ERRORS.           15982800
      *SB 10/15/13 - END PR#5148D                                       15982900
157600                                                                  15989600
159900******************************************************************15990000
160000* 4330-OPEN-VIOLATION-CURSOR                                     *16000000
160100*  OPEN THE PO LINE CURSOR                                       *16010000
160200******************************************************************16020000
160300 4330-OPEN-VIOLATION-CURSOR.                                      16030000
160400                                                                  16040000
160500     EXEC SQL                                                     16050000
160600         OPEN VIOLATION_CURSOR                                    16060000
160700     END-EXEC.                                                    16070000
160800                                                                  16080000
160900     EVALUATE TRUE                                                16090000
161000         WHEN SQLCODE = ZERO                                      16100000
161100             SET PS-NOT-EOC-VIOLATION-CURSOR TO TRUE              16110000
161200                                                                  16120000
161300         WHEN SQLWARN0 NOT = SPACE                                16130000
161400         WHEN SQLCODE < +0                                        16140000
161500         WHEN SQLCODE > +0                                        16150000
161600             MOVE '4330-OPEN-VIOLATION-CURSOR'                    16160000
161700                             TO DP013-PARAGRAPH                   16170000
161800             MOVE 'SUKCS590 - OPEN VIOLATION CURSOR'              16180000
161900                             TO DP013-MESSAGE-TEXT (1)            16190000
162000             MOVE DK-AUDIT-NBR     TO PV-DISPLAY-AUDIT-CNTL-NBR   16200000
162100             STRING 'AUDIT NBR: '      DELIMITED BY SIZE          16210000
162200                 PV-DISPLAY-AUDIT-CNTL-NBR                        16220000
162300                                       DELIMITED BY SIZE          16230000
162400                           INTO DP013-MESSAGE-TEXT(2)             16240000
162500             MOVE SQLCA      TO DP013-SQLCA                       16250000
162600             MOVE 'TSUAUPC ' TO DP013-DB2-TABLE-NAME(1)           16260000
162700             MOVE 'TSUEXCP ' TO DP013-DB2-TABLE-NAME(2)           16270000
162800             MOVE 'TVILNCD ' TO DP013-DB2-TABLE-NAME(3)           16280000
162900             SET DP013-DB2-ABEND                                  16290000
163000                             TO TRUE                              16300000
163100             SET DP013-XCTL-DISPLAY-RESTART                       16310000
163200                             TO TRUE                              16320000
163300             PERFORM DP013-0000-PROCESS-ABEND                     16330000
163400     END-EVALUATE.                                                16340000
163500                                                                  16350000
163600                                                                  16360000
163700******************************************************************16370000
163800* 4360-FETCH-VIOLATION-CURSOR                                    *16380000
163900*  FETCH THE NEXT OCCURANCE OF THE VIOLATION_CURSOR              *16390000
164000******************************************************************16400000
164100 4360-FETCH-VIOLATION-CURSOR.                                     16410000
164200                                                                  16420000
164300     EXEC SQL                                                     16430000
164400         FETCH VIOLATION_CURSOR                                   16440000
164500         INTO    :SUEXCP-SCN-TMST                                 16450000
164600               , :VILNCD-VILN-GP-SEQ-NBR                          16460000
164700               , :PV-DB2-ERROR-COUNT                              16470000
164800     END-EXEC.                                                    16480000
164900                                                                  16490000
165000     EVALUATE TRUE                                                16500000
165100         WHEN SQLCODE = ZERO                                      16510000
165200             CONTINUE                                             16520000
165300                                                                  16530000
165400         WHEN SQLCODE = +100                                      16540000
165500             SET PS-EOC-VIOLATION-CURSOR     TO TRUE              16550000
165600                                                                  16560000
165700         WHEN SQLWARN0 NOT = SPACE                                16570000
165800         WHEN SQLCODE < +0                                        16580000
165900         WHEN SQLCODE > +0                                        16590000
166000             MOVE '4360-FETCH-VIOLATION-CURSOR'                   16600000
166100                             TO DP013-PARAGRAPH                   16610000
166200             MOVE 'SUKCS590 - FETCH VIOLATION_CURSOR'             16620000
166300                             TO DP013-MESSAGE-TEXT (1)            16630000
166400             MOVE DK-AUDIT-NBR     TO PV-DISPLAY-AUDIT-CNTL-NBR   16640000
166500             STRING 'AUDIT NBR: '      DELIMITED BY SIZE          16650000
166600                 PV-DISPLAY-AUDIT-CNTL-NBR                        16660000
166700                                       DELIMITED BY SIZE          16670000
166800                           INTO DP013-MESSAGE-TEXT(2)             16680000
166900             MOVE SQLCA      TO DP013-SQLCA                       16690000
167000             MOVE 'TSUAUPC ' TO DP013-DB2-TABLE-NAME(1)           16700000
167100             MOVE 'TSUEXCP ' TO DP013-DB2-TABLE-NAME(2)           16710000
167200             MOVE 'TVILNCD ' TO DP013-DB2-TABLE-NAME(3)           16720000
167300             SET DP013-DB2-ABEND                                  16730000
167400                             TO TRUE                              16740000
167500             SET DP013-XCTL-DISPLAY-RESTART                       16750000
167600                             TO TRUE                              16760000
167700             PERFORM DP013-0000-PROCESS-ABEND                     16770000
167800     END-EVALUATE.                                                16780000
167900                                                                  16790000
168000                                                                  16800000
168100******************************************************************16810000
168200* 4390-CLOSE-VIOLATION-CURSOR                                    *16820000
168300*  CLOSE THE PO LINE CURSOR                                      *16830000
168400******************************************************************16840000
168500 4390-CLOSE-VIOLATION-CURSOR.                                     16850000
168600                                                                  16860000
168700     EXEC SQL                                                     16870000
168800         CLOSE VIOLATION_CURSOR                                   16880000
168900     END-EXEC.                                                    16890000
169000                                                                  16900000
169100     EVALUATE TRUE                                                16910000
169200         WHEN SQLCODE = ZERO                                      16920000
169300             CONTINUE                                             16930000
169400                                                                  16940000
169500         WHEN SQLWARN0 NOT = SPACE                                16950000
169600         WHEN SQLCODE < +0                                        16960000
169700         WHEN SQLCODE > +0                                        16970000
169800             MOVE '4390-CLOSE-VIOLATION-CURSOR'                   16980000
169900                             TO DP013-PARAGRAPH                   16990000
170000             MOVE 'SUKCS590 - CLOSE VIOLATION_CURSOR'             17000000
170100                             TO DP013-MESSAGE-TEXT (1)            17010000
170200             MOVE DK-AUDIT-NBR     TO PV-DISPLAY-AUDIT-CNTL-NBR   17020000
170300             STRING 'AUDIT NBR: '      DELIMITED BY SIZE          17030000
170400                 PV-DISPLAY-AUDIT-CNTL-NBR                        17040000
170500                                       DELIMITED BY SIZE          17050000
170600                           INTO DP013-MESSAGE-TEXT(2)             17060000
170700             MOVE SQLCA      TO DP013-SQLCA                       17070000
170800             MOVE 'TSUAUPC ' TO DP013-DB2-TABLE-NAME(1)           17080000
170900             MOVE 'TSUEXCP ' TO DP013-DB2-TABLE-NAME(2)           17090000
171000             MOVE 'TVILNCD ' TO DP013-DB2-TABLE-NAME(3)           17100000
171100             SET DP013-DB2-ABEND                                  17110000
171200                             TO TRUE                              17120000
171300             SET DP013-XCTL-DISPLAY-RESTART                       17130000
171400                             TO TRUE                              17140000
171500             PERFORM DP013-0000-PROCESS-ABEND                     17150000
171600     END-EVALUATE.                                                17160000
171700                                                                  17170000
171800 4391-OPEN-TICKET-CURSOR.                                         17180000
171900                                                                  17190000
172000     EXEC SQL                                                     17200000
172100         OPEN TICKET_CURSOR                                       17210000
172200     END-EXEC.                                                    17220000
172300                                                                  17230000
172400     EVALUATE TRUE                                                17240000
172500         WHEN SQLCODE = ZERO                                      17250000
172600             SET PS-NOT-EOC-TICKET-CURSOR TO TRUE                 17260000
172700                                                                  17270000
172800         WHEN SQLWARN0 NOT = SPACE                                17280000
172900         WHEN SQLCODE < +0                                        17290000
173000         WHEN SQLCODE > +0                                        17300000
173100             MOVE '4391-OPEN-TICKET-CURSOR'                       17310000
173200                             TO DP013-PARAGRAPH                   17320000
173300             MOVE 'SUKCS590 - OPEN TICKET CURSOR'                 17330000
173400                             TO DP013-MESSAGE-TEXT (1)            17340000
173500             MOVE DK-AUDIT-NBR     TO PV-DISPLAY-AUDIT-CNTL-NBR   17350000
173600             STRING 'AUDIT NBR: '      DELIMITED BY SIZE          17360000
173700                 PV-DISPLAY-AUDIT-CNTL-NBR                        17370000
173800                                       DELIMITED BY SIZE          17380000
173900                           INTO DP013-MESSAGE-TEXT(2)             17390000
174000             MOVE SQLCA      TO DP013-SQLCA                       17400000
174100             MOVE 'TSUAUPC ' TO DP013-DB2-TABLE-NAME(1)           17410000
174200             MOVE 'TSUEXCP ' TO DP013-DB2-TABLE-NAME(2)           17420000
174300             MOVE 'TVILNCD ' TO DP013-DB2-TABLE-NAME(3)           17430000
174400             SET DP013-DB2-ABEND                                  17440000
174500                             TO TRUE                              17450000
174600             SET DP013-XCTL-DISPLAY-RESTART                       17460000
174700                             TO TRUE                              17470000
174800             PERFORM DP013-0000-PROCESS-ABEND                     17480000
174900     END-EVALUATE.                                                17490000
175000                                                                  17500000
175100                                                                  17510000
175200******************************************************************17520000
175300* 4393-FETCH-TICKET-CURSOR                                       *17530000
175400*  FETCH THE NEXT OCCURANCE OF THE TICKET_CURSOR                 *17540000
175500******************************************************************17550000
175600 4393-FETCH-TICKET-CURSOR.                                        17560000
175700                                                                  17570000
175800     EXEC SQL                                                     17580000
175900         FETCH TICKET_CURSOR                                      17590000
176000         INTO    :SUAUPC-UPC-NBR                                  17600000
176100              ,  :SUEXCP-VILN-GP-SEQ-NBR                          17610000
176200               , :PV-DB2-TICKET-COUNT                             17620000
176300     END-EXEC.                                                    17630000
176400                                                                  17640000
176500     EVALUATE TRUE                                                17650000
176600         WHEN SQLCODE = ZERO                                      17660000
176700             CONTINUE                                             17670000
176800                                                                  17680000
176900         WHEN SQLCODE = +100                                      17690000
177000             SET PS-EOC-TICKET-CURSOR        TO TRUE              17700000
177100                                                                  17710000
177200         WHEN SQLWARN0 NOT = SPACE                                17720000
177300         WHEN SQLCODE < +0                                        17730000
177400         WHEN SQLCODE > +0                                        17740000
177500             MOVE '4393-FETCH-TICKET-CURSOR'                      17750000
177600                             TO DP013-PARAGRAPH                   17760000
177700             MOVE 'SUKCS590 - FETCH TICKET_CURSOR'                17770000
177800                             TO DP013-MESSAGE-TEXT (1)            17780000
177900             MOVE DK-AUDIT-NBR     TO PV-DISPLAY-AUDIT-CNTL-NBR   17790000
178000             STRING 'AUDIT NBR: '      DELIMITED BY SIZE          17800000
178100                 PV-DISPLAY-AUDIT-CNTL-NBR                        17810000
178200                                       DELIMITED BY SIZE          17820000
178300                           INTO DP013-MESSAGE-TEXT(2)             17830000
178400             MOVE SQLCA      TO DP013-SQLCA                       17840000
178500             MOVE 'TSUAUPC ' TO DP013-DB2-TABLE-NAME(1)           17850000
178600             MOVE 'TSUEXCP ' TO DP013-DB2-TABLE-NAME(2)           17860000
178700             MOVE 'TVILNCD ' TO DP013-DB2-TABLE-NAME(3)           17870000
178800             SET DP013-DB2-ABEND                                  17880000
178900                             TO TRUE                              17890000
179000             SET DP013-XCTL-DISPLAY-RESTART                       17900000
179100                             TO TRUE                              17910000
179200             PERFORM DP013-0000-PROCESS-ABEND                     17920000
179300     END-EVALUATE.                                                17930000
179400                                                                  17940000
179500                                                                  17950000
179600******************************************************************17960000
179700* 4395-CLOSE-TICKET-CURSOR                                       *17970000
179800*  CLOSE THE PO LINE CURSOR                                      *17980000
179900******************************************************************17990000
180000 4395-CLOSE-TICKET-CURSOR.                                        18000000
180100                                                                  18010000
180200     EXEC SQL                                                     18020000
180300         CLOSE TICKET_CURSOR                                      18030000
180400     END-EXEC.                                                    18040000
180500                                                                  18050000
180600     EVALUATE TRUE                                                18060000
180700         WHEN SQLCODE = ZERO                                      18070000
180800             CONTINUE                                             18080000
180900                                                                  18090000
181000         WHEN SQLWARN0 NOT = SPACE                                18100000
181100         WHEN SQLCODE < +0                                        18110000
181200         WHEN SQLCODE > +0                                        18120000
181300             MOVE '4395-CLOSE-TICKET-CURSOR'                      18130000
181400                             TO DP013-PARAGRAPH                   18140000
181500             MOVE 'SUKCS590 - CLOSE TICKET_CURSOR'                18150000
181600                             TO DP013-MESSAGE-TEXT (1)            18160000
181700             MOVE DK-AUDIT-NBR     TO PV-DISPLAY-AUDIT-CNTL-NBR   18170000
181800             STRING 'AUDIT NBR: '      DELIMITED BY SIZE          18180000
181900                 PV-DISPLAY-AUDIT-CNTL-NBR                        18190000
182000                                       DELIMITED BY SIZE          18200000
182100                           INTO DP013-MESSAGE-TEXT(2)             18210000
182200             MOVE SQLCA      TO DP013-SQLCA                       18220000
182300             MOVE 'TSUAUPC ' TO DP013-DB2-TABLE-NAME(1)           18230000
182400             MOVE 'TSUEXCP ' TO DP013-DB2-TABLE-NAME(2)           18240000
182500             MOVE 'TVILNCD ' TO DP013-DB2-TABLE-NAME(3)           18250000
182600             SET DP013-DB2-ABEND                                  18260000
182700                             TO TRUE                              18270000
182800             SET DP013-XCTL-DISPLAY-RESTART                       18280000
182900                             TO TRUE                              18290000
183000             PERFORM DP013-0000-PROCESS-ABEND                     18300000
183100     END-EVALUATE.                                                18310000
183200*                                                                 18320000
183300 4397-SELECT-I-PACK-ERRORS.                                       18330000
183400                                                                  18340000
183500     EXEC SQL                                                     18350000
183600         SELECT COUNT (DISTINCT SHIPT_UNT_ID)                     18360000
183700         INTO  :PV-DB2-ERROR-COUNT                                18370000
183800         FROM                                                     18380000
183900                 TCTEXCP A                                        18390000
184000              ,  TVILNCD B                                        18400000
184100         WHERE                                                    18410000
184200             A.AUD_CNTL_NBR       = :DK-AUDIT-NBR                 18420000
184300         AND B.VILN_GP_CDE        = 'VA'                          18430000
184400         AND B.FALR_IND           = 'Y'                           18440000
184500         AND B.VILN_CTG_CDE       = 'A'                           18450000
184600         AND A.VILN_GP_CDE        = B.VILN_GP_CDE                 18460000
184700         AND A.VILN_GP_SEQ_NBR    = B.VILN_GP_SEQ_NBR             18470000
184800     END-EXEC.                                                    18480000
184900                                                                  18490000
185000     EVALUATE TRUE                                                18500000
185100         WHEN SQLCODE = ZERO                                      18510000
185200             CONTINUE                                             18520000
185300         WHEN SQLWARN0 NOT = SPACES                               18530000
185400         WHEN SQLCODE < ZERO                                      18540000
185500         WHEN SQLCODE > ZERO                                      18550000
185600             MOVE '4397-SELECT-I-PACK-ERRORS'                     18560000
185700                 TO DP013-PARAGRAPH                               18570000
185800             MOVE 'SUM OF I PACK ERRORS'                          18580000
185900                 TO DP013-MESSAGE-TEXT (1)                        18590000
186000             MOVE DK-AUDIT-NBR     TO PV-DISPLAY-AUDIT-CNTL-NBR   18600000
186100             STRING 'AUDIT NBR: '      DELIMITED BY SIZE          18610000
186200                 PV-DISPLAY-AUDIT-CNTL-NBR                        18620000
186300                                       DELIMITED BY SIZE          18630000
186400                           INTO DP013-MESSAGE-TEXT(2)             18640000
186500             MOVE SQLCA            TO DP013-SQLCA                 18650000
186600             MOVE 'TCTEXCP'        TO DP013-DB2-TABLE-NAME (1)    18660000
186700             MOVE 'TVILNCD'        TO DP013-DB2-TABLE-NAME (2)    18670000
186800             SET DP013-DB2-ABEND   TO TRUE                        18680000
186900             SET DP013-XCTL-DISPLAY-RESTART                       18690000
187000                             TO TRUE                              18700000
187100             PERFORM DP013-0000-PROCESS-ABEND                     18710000
187200     END-EVALUATE.                                                18720000
187300                                                                  18730000
187400                                                                  18740000
187500*----------------------------------------------------------------*18750000
187600*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *18760000
187700*----------------------------------------------------------------*18770000
187800                                                                  18780000
187900 4400-MOVE-COMMAREA-TO-SCREEN.                                    18790000
188000     MOVE ASC-AUDIT-NBR-N          TO AAUDTNBO.                   18800000
188100     MOVE ASC-CRE-DATE             TO AREQDTEO.                   18810000
188200     MOVE ASC-CRE-TIME             TO AREQTMEO.                   18820000
188300     MOVE ASC-PO-RCVR              TO APORCVRO.                   18830000
188400                                                                  18840000
188500     EVALUATE TRUE                                                18850000
188600     WHEN ASC-PACKAGE-TYPE = 'PS'                                 18860000
      *SB 10/15/13 - BEGIN PR#5148D                                     18860100
188600     WHEN ASC-PACKAGE-TYPE = 'RF'                                 18861000
      *SB 10/15/13 - END PR#5148D                                       18862000
188700        MOVE SPACES                TO ALNPKO                      18870000
188800        MOVE SPACES                TO ALNENBRO                    18880000
188900     WHEN ASC-PACKAGE-TYPE = 'PP'                                 18890000
189000        MOVE 'PACK-ID.......:'     TO ALNPKO                      18900000
189100        MOVE ASC-LINE-NBR          TO ALNENBRO                    18910000
189200     WHEN OTHER                                                   18920000
189300        MOVE 'LINE NUMBER...:'     TO ALNPKO                      18930000
189400        MOVE ASC-LINE-NBR          TO ALNENBRO                    18940000
189500     END-EVALUATE                                                 18950000
189600                                                                  18960000
189700     IF ASC-SKU = ZEROES                                          18970000
189800         MOVE SPACES               TO ASKUO                       18980000
189900     ELSE                                                         18990000
190000         IF ASC-SKU  = 'MULTIPLE'                                 19000000
190100            MOVE ASC-SKU              TO ASKUO                    19010000
190200         ELSE                                                     19020000
190300            MOVE ASC-SKU              TO DK-SKU-NBR               19030000
190400            MOVE DK-SKU-SKU           TO ASKUO                    19040000
190500         END-IF                                                   19050000
190600     END-IF                                                       19060000
190700                                                                  19070000
190800     MOVE ASC-OPER-UNIT            TO AOPRUNTO.                   19080000
190900     MOVE ASC-OPER-DESC            TO AOPRDSCO.                   19090000
191000     MOVE ASC-ENT-ID               TO AVENDIDO.                   19100000
191100     MOVE ASC-ENT-DESC             TO AVENDNMO.                   19110000
191200     MOVE ASC-DEPT                 TO ADEPTO.                     19120000
191300     MOVE ASC-DEPT-DESC            TO ADPTDSCO.                   19130000
191400     EVALUATE ASC-PROCESS-STATUS                                  19140000
191500        WHEN 'P' MOVE PC-PASS          TO APRCSTAO                19150000
191600        WHEN 'F' MOVE PC-FAIL          TO APRCSTAO                19160000
191700        WHEN 'I' MOVE PC-IN-PROCESS    TO APRCSTAO                19170000
191800        WHEN 'N' MOVE PC-NOT-NEEDED    TO APRCSTAO                19180000
191900        WHEN 'R' MOVE PC-PROMPT        TO APRCSTAO                19190000
192000        WHEN 'A' MOVE PC-ALL           TO APRCSTAO                19200000
192100     END-EVALUATE.                                                19210000
192200                                                                  19220000
192300     EVALUATE ASC-AUDIT-SOURCE                                    19230000
192400         WHEN 'MAN' MOVE PC-MANUAL     TO AAUDSRCO                19240000
192500         WHEN 'SYS' MOVE PC-SYSTEM     TO AAUDSRCO                19250000
192600         WHEN 'REW' MOVE PC-REWORK     TO AAUDSRCO                19260000
192700         WHEN 'SPT' MOVE PC-SPOT       TO AAUDSRCO                19270000
192800         WHEN '100' MOVE PC-100-PCNT   TO AAUDSRCO                19280000
192900     END-EVALUATE.                                                19290000
193000                                                                  19300000
193100     MOVE ASC-SOURCE               TO ASOURCEO.                   19310000
193200                                                                  19320000
193300     EVALUATE ASC-PACKAGE-TYPE                                    19330000
193400        WHEN 'BC' MOVE PC-BULK-CSPK    TO APKGTYPO                19340000
193500        WHEN 'PP' MOVE PC-PRE-PACK     TO APKGTYPO                19350000
193600        WHEN 'PS' MOVE PC-PBS          TO APKGTYPO                19360000
      *SB 10/15/13 - BEGIN PR#5148D                                     19360100
193600        WHEN 'RF' MOVE PC-RFID         TO APKGTYPO                19361000
      *SB 10/15/13 - END PR#5148D                                       19362000
193700     END-EVALUATE.                                                19370000
193800                                                                  19380000
193900     MOVE ASC-AUDIT-TYPE           TO AAUDTYPO.                   19390000
194000     MOVE ASC-DEFERRED-IND         TO ADEFERDO.                   19400000
194100     MOVE ASC-CREATE-USERID        TO AUSERIDO.                   19410000
194200     MOVE ASC-MODIFIED-IND         TO AMODINDO.                   19420000
194300                                                                  19430000
194400     IF ASC-START-DATE = PC-DUMMY-DATE                            19440000
194500         MOVE SPACES               TO ASTRDTEO                    19450000
194600                                      ASTRTMEO                    19460000
194700     ELSE                                                         19470000
194800         MOVE ASC-START-DATE       TO ASTRDTEO                    19480000
194900         MOVE ASC-START-TIME       TO ASTRTMEO                    19490000
195000     END-IF                                                       19500000
195100                                                                  19510000
195200     IF ASC-STOP-DATE = PC-DUMMY-DATE                             19520000
195300         MOVE SPACES               TO ASTPDTEO                    19530000
195400                                      ASTPTMEO                    19540000
195500     ELSE                                                         19550000
195600         MOVE ASC-STOP-DATE        TO ASTPDTEO                    19560000
195700         MOVE ASC-STOP-TIME        TO ASTPTMEO                    19570000
195800     END-IF                                                       19580000
195900                                                                  19590000
196000     MOVE ASC-POSTPONED-MIN        TO APSTMINO.                   19600000
196100     MOVE ASC-CLOSE-MIN            TO ACLSMINO.                   19610000
196101     IF  ASC-MOD-QTY-IND   = 'N'                                  19610100
196102        CONTINUE                                                  19610200
196103     ELSE                                                         19610300
196110        MOVE '****RECLAIM PERFORMED OR NOT ENOUGH CARTONS****'    19611000
196111                                   TO ARCLMSGO                    19611100
196120     END-IF.                                                      19612000
196200     MOVE ASC-REQ-CARTONS          TO AREQCTNO.                   19620000
196300     MOVE ASC-TOTAL-ERRORS         TO ATOTERRO.                   19630000
196400     MOVE ASC-REQ-UNITS            TO AREQUNTO.                   19640000
196500     MOVE ASC-PICK-ERRORS          TO APIKERRO.                   19650000
196600     MOVE ASC-AUDIT-CARTONS        TO AAUDCTNO.                   19660000
196700     MOVE ASC-PACK-ERRORS          TO APAKERRO.                   19670000
196800     MOVE ASC-AUDIT-UNITS          TO AAUDUNTO.                   19680000
196900     MOVE ASC-TICKET-ERRORS        TO ATCKERRO.                   19690000
      *SB 10/15/13 - BEGIN PR#5148D                                     19690100
196900     MOVE ASC-RFID-ERRORS          TO ARFDERRO.                   19691000
      *SB 10/15/13 - END PR#5148D                                       19692000
197000                                                                  19700000
197100     IF  ASC-CARTON-HOURS  >  0  OR                               19710000
197200         ASC-CARTON-MIN    >  0                                   19720000
197300         MOVE  ASC-CARTON-HOURS     TO  PV-DISPLAY-HOURS          19730000
197400         MOVE  ASC-CARTON-MIN       TO  PV-DISPLAY-MIN            19740000
197500         MOVE  PV-DISPLAY-DURATION  TO  ADURATO                   19750000
197600     ELSE                                                         19760000
197700         MOVE  SPACES               TO  ADURATO                   19770000
197800     END-IF.                                                      19780000
197900                                                                  19790000
198000                                                                  19800000
      *SB 10/15/13 - BEGIN PR#5148D                                     19810000
171800 4500-OPEN-RFIDERR-CURSOR.                                        19841000
171900                                                                  19842000
172000     EXEC SQL                                                     19843000
172100         OPEN RFIDERR_CURSOR                                      19844000
172200     END-EXEC.                                                    19845000
172300                                                                  19846000
172400     EVALUATE TRUE                                                19847000
172500         WHEN SQLCODE = ZERO                                      19848000
172600             SET PS-NOT-EOC-RFIDERR-CURSOR TO TRUE                19849000
172700                                                                  19849100
172800         WHEN SQLWARN0 NOT = SPACE                                19849200
172900         WHEN SQLCODE < +0                                        19849300
173000         WHEN SQLCODE > +0                                        19849400
173100             MOVE '4500-OPEN-RFIDERR-CURSOR'                      19849500
173200                             TO DP013-PARAGRAPH                   19849600
173300             MOVE 'SUKCS590 - OPEN RFIDERR CURSOR'                19849700
173400                             TO DP013-MESSAGE-TEXT (1)            19849800
173500             MOVE DK-AUDIT-NBR     TO PV-DISPLAY-AUDIT-CNTL-NBR   19849900
173600             STRING 'AUDIT NBR: '      DELIMITED BY SIZE          19850000
173700                 PV-DISPLAY-AUDIT-CNTL-NBR                        19850100
173800                                       DELIMITED BY SIZE          19850200
173900                           INTO DP013-MESSAGE-TEXT(2)             19850300
174000             MOVE SQLCA      TO DP013-SQLCA                       19850400
174100             MOVE 'TSUAUPC ' TO DP013-DB2-TABLE-NAME(1)           19850500
174200             MOVE 'TSUEXCP ' TO DP013-DB2-TABLE-NAME(2)           19850600
174300             MOVE 'TVILNCD ' TO DP013-DB2-TABLE-NAME(3)           19850700
174400             SET DP013-DB2-ABEND                                  19850800
174500                             TO TRUE                              19850900
174600             SET DP013-XCTL-DISPLAY-RESTART                       19851000
174700                             TO TRUE                              19851100
174800             PERFORM DP013-0000-PROCESS-ABEND                     19851200
174900     END-EVALUATE.                                                19851300
175000                                                                  19851400
175100                                                                  19851500
175200******************************************************************19851600
175300* 4510-FETCH-RFIDERR-CURSOR                                      *19851700
175400*  FETCH THE NEXT OCCURANCE OF THE RFIDERR_CURSOR                *19851800
175500******************************************************************19851900
175600 4510-FETCH-RFIDERR-CURSOR.                                       19852000
175700                                                                  19852100
175800     EXEC SQL                                                     19852200
175900         FETCH RFIDERR_CURSOR                                     19852300
176000         INTO    :SUAUPC-UPC-NBR                                  19852400
176100               , :SUEXCP-VILN-GP-SEQ-NBR                          19852500
                     , :SUEXCP-SCN-TMST                                 19852600
176200               , :PV-DB2-SCAN-COUNT                               19852700
176200               , :PV-DB2-RFID-COUNT                               19852800
176300     END-EXEC.                                                    19852900
176400                                                                  19853000
176500     EVALUATE TRUE                                                19853100
176600         WHEN SQLCODE = ZERO                                      19853200
176700             IF SUEXCP-VILN-GP-SEQ-NBR = 42                       19853300
                      COMPUTE PV-DB2-RFID-COUNT = PV-DB2-SCAN-COUNT -   19853400
                                                  PV-DB2-RFID-COUNT     19853500
176800             END-IF                                               19853600
176900         WHEN SQLCODE = +100                                      19853700
177000             SET PS-EOC-RFIDERR-CURSOR       TO TRUE              19853800
177100                                                                  19853900
177200         WHEN SQLWARN0 NOT = SPACE                                19854000
177300         WHEN SQLCODE < +0                                        19854100
177400         WHEN SQLCODE > +0                                        19854200
177500             MOVE '4510-FETCH-RFIDERR-CURSOR'                     19854300
177600                             TO DP013-PARAGRAPH                   19854400
177700             MOVE 'SUKCS590 - FETCH RFIDERR_CURSOR'               19854500
177800                             TO DP013-MESSAGE-TEXT (1)            19854600
177900             MOVE DK-AUDIT-NBR     TO PV-DISPLAY-AUDIT-CNTL-NBR   19854700
178000             STRING 'AUDIT NBR: '      DELIMITED BY SIZE          19854800
178100                 PV-DISPLAY-AUDIT-CNTL-NBR                        19854900
178200                                       DELIMITED BY SIZE          19855000
178300                           INTO DP013-MESSAGE-TEXT(2)             19855100
178400             MOVE SQLCA      TO DP013-SQLCA                       19855200
178500             MOVE 'TSUAUPC ' TO DP013-DB2-TABLE-NAME(1)           19855300
178600             MOVE 'TSUEXCP ' TO DP013-DB2-TABLE-NAME(2)           19855400
178700             MOVE 'TVILNCD ' TO DP013-DB2-TABLE-NAME(3)           19855500
178800             SET DP013-DB2-ABEND                                  19855600
178900                             TO TRUE                              19855700
179000             SET DP013-XCTL-DISPLAY-RESTART                       19855800
179100                             TO TRUE                              19855900
179200             PERFORM DP013-0000-PROCESS-ABEND                     19856000
179300     END-EVALUATE.                                                19856100
179400                                                                  19856200
179500                                                                  19856300
179600******************************************************************19856400
179700* 4515-CLOSE-RFIDERR-CURSOR                                      *19856500
179800*  CLOSE THE PO LINE CURSOR                                      *19856600
179900******************************************************************19856700
180000 4515-CLOSE-RFIDERR-CURSOR.                                       19856800
180100                                                                  19856900
180200     EXEC SQL                                                     19857000
180300         CLOSE RFIDERR_CURSOR                                     19857100
180400     END-EXEC.                                                    19857200
180500                                                                  19857300
180600     EVALUATE TRUE                                                19857400
180700         WHEN SQLCODE = ZERO                                      19857500
180800             CONTINUE                                             19857600
180900                                                                  19857700
181000         WHEN SQLWARN0 NOT = SPACE                                19857800
181100         WHEN SQLCODE < +0                                        19857900
181200         WHEN SQLCODE > +0                                        19858000
181300             MOVE '4515-CLOSE-RFIDERR-CURSOR'                     19858100
181400                             TO DP013-PARAGRAPH                   19858200
181500             MOVE 'SUKCS590 - CLOSE RFIDERR_CURSOR'               19858300
181600                             TO DP013-MESSAGE-TEXT (1)            19858400
181700             MOVE DK-AUDIT-NBR     TO PV-DISPLAY-AUDIT-CNTL-NBR   19858500
181800             STRING 'AUDIT NBR: '      DELIMITED BY SIZE          19858600
181900                 PV-DISPLAY-AUDIT-CNTL-NBR                        19858700
182000                                       DELIMITED BY SIZE          19858800
182100                           INTO DP013-MESSAGE-TEXT(2)             19858900
182200             MOVE SQLCA      TO DP013-SQLCA                       19859000
182300             MOVE 'TSUAUPC ' TO DP013-DB2-TABLE-NAME(1)           19859100
182400             MOVE 'TSUEXCP ' TO DP013-DB2-TABLE-NAME(2)           19859200
182500             MOVE 'TVILNCD ' TO DP013-DB2-TABLE-NAME(3)           19859300
182600             SET DP013-DB2-ABEND                                  19859400
182700                             TO TRUE                              19859500
182800             SET DP013-XCTL-DISPLAY-RESTART                       19859600
182900                             TO TRUE                              19859700
183000             PERFORM DP013-0000-PROCESS-ABEND                     19859800
183100     END-EVALUATE.                                                19859900
      *SB 10/15/13 - END PR#5148D                                       19860000
                                                                        19860100
198100*----------------------------------------------------------------*19860200
198200* APPLY THE CHANGES TO THE MESSAGE TO THE DB2 TABLE.             *19860300
198300*----------------------------------------------------------------*19860400
198500*----------------------------------------------------------------*19860500
198600* RECORD IN THE SELECTION TEMP STORAGE QUEUE THE FACT THAT THIS  *19861000
198700* OBJECT WAS UDPATED.                                            *19870000
198800*----------------------------------------------------------------*19880000
198900 5200-UPDATE-SELECTION-QUEUE.                                     19890000
199000     PERFORM 9100-READ-SEL-QUEUE.                                 19900000
199100     SET SU025-UPD (ASC-SEL-SUB) TO TRUE.                         19910000
199200     PERFORM 9200-REWRITE-LIST-QUEUE.                             19920000
199300******************************************************************19930000
199400** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **19940000
199500** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **19950000
199600** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **19960000
199700** THE USER.                                                    **19970000
199800******************************************************************19980000
199900 6000-REFRESH-PANEL-FROM-TEMP.                                    19990000
200000     IF  ASC-UPDATE-TSQ                                           20000000
200100         SET ASC-NO-TSQ-UPDATE TO TRUE                            20010000
200200         MOVE ZERO                 TO PV-SAVE-ITEM                20020000
200300                                      PV-SEL-QUEUE-ITEM           20030000
200400         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        20040000
200500                                   TO PV-HOLD-SELECTED-ITEMS      20050000
200600         MOVE +1                   TO PV-ITEMS-PROCESSED          20060000
200700         PERFORM 6100-UPDATE-TSQ                                  20070000
200800             UNTIL PV-ITEMS-PROCESSED >                           20080000
200900                                     PV-HOLD-SELECTED-ITEMS       20090000
201000         INITIALIZE ASC-BLOCK-ENTRIES (1)                         20100000
201100                    ASC-BLOCK-ENTRIES (2)                         20110000
201200     END-IF.                                                      20120000
201300                                                                  20130000
201400*----------------------------------------------------------------*20140000
201500*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *20150000
201600*----------------------------------------------------------------*20160000
201700 6010-DELETE-SEL-QUEUE.                                           20170000
201800                                                                  20180000
201900     EXEC CICS                                                    20190000
202000         DELETEQ TS                                               20200000
202100             QUEUE (ASC-SEL-QUEUE-NAME)                           20210000
202200             RESP  (PV-CICS-RESPONSE)                             20220000
202300     END-EXEC.                                                    20230000
202400*                                                                 20240000
202500     IF ((PV-CICS-RESPONSE = DFHRESP(NORMAL)) OR                  20250000
202600        (PV-CICS-RESPONSE = DFHRESP(QIDERR)))                     20260000
202700         CONTINUE                                                 20270000
202800     ELSE                                                         20280000
202900         SET DP013-CICS-ABEND TO TRUE                             20290000
203000         SET DP013-NO-ROLLBACK TO TRUE                            20300000
203100         MOVE '6010-DELETE-SEL-QUEUE'                             20310000
203200                        TO DP013-PARAGRAPH                        20320000
203300         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         20330000
203400                        TO DP013-MESSAGE-TEXT (1)                 20340000
203500         PERFORM DP013-0000-PROCESS-ABEND                         20350000
203600     END-IF.                                                      20360000
203700                                                                  20370000
203800*----------------------------------------------------------------*20380000
203900*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *20390000
204000*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *20400000
204100*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *20410000
204200*    THE TEMP QUEUE.                                             *20420000
204300*----------------------------------------------------------------*20430000
204400                                                                  20440000
204500 6100-UPDATE-TSQ.                                                 20450000
204600                                                                  20460000
204700     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             20470000
204800     PERFORM 6105-READ-SEL-QUEUE.                                 20480000
204900     PERFORM                                                      20490000
205000         VARYING SU025-IDX                                        20500000
205100         FROM 1 BY 1                                              20510000
205200         UNTIL ((PV-ITEMS-PROCESSED >                             20520000
205300                              PV-HOLD-SELECTED-ITEMS)             20530000
205400         OR (SU025-IDX GREATER THAN SU025-MAX-ITEMS))             20540000
205500         IF  SU025-ACTION-SW (SU025-IDX) > SPACE                  20550000
205600             PERFORM 6110-PROCESS-ITEMS                           20560000
205700         END-IF                                                   20570000
205800         ADD +1                TO PV-ITEMS-PROCESSED              20580000
205900     END-PERFORM.                                                 20590000
206000     PERFORM 6111-WRITE-LIST-QUEUE.                               20600000
206100*----------------------------------------------------------------*20610000
206200*    READ THE LIST QUEUE RECORD.                                 *20620000
206300*----------------------------------------------------------------*20630000
206400                                                                  20640000
206500 6105-READ-SEL-QUEUE.                                             20650000
206600                                                                  20660000
206700     EXEC CICS                                                    20670000
206800          READQ TS                                                20680000
206900              QUEUE (ASC-SEL-QUEUE-NAME)                          20690000
207000              INTO  (SU025-SELECT-RECORD)                         20700000
207100              ITEM  (PV-SEL-QUEUE-ITEM)                           20710000
207200              RESP  (PV-CICS-RESPONSE)                            20720000
207300     END-EXEC.                                                    20730000
207400*                                                                 20740000
207500     IF  PV-CICS-RESPONSE = DFHRESP (NORMAL)                      20750000
207600         CONTINUE                                                 20760000
207700     ELSE                                                         20770000
207800         SET DP013-CICS-ABEND      TO  TRUE                       20780000
207900         SET DP013-NO-ROLLBACK     TO  TRUE                       20790000
208000         MOVE '6105-READ-SEL-QUEUE'                               20800000
208100                                   TO  DP013-PARAGRAPH            20810000
208200         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           20820000
208300                                   TO  DP013-MESSAGE-TEXT(1)      20830000
208400         PERFORM DP013-0000-PROCESS-ABEND                         20840000
208500     END-IF.                                                      20850000
208600 EJECT                                                            20860000
208700*----------------------------------------------------------------*20870000
208800*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*20880000
208900*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*20890000
209000*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *20900000
209100*----------------------------------------------------------------*20910000
209200                                                                  20920000
209300 6110-PROCESS-ITEMS.                                              20930000
209400                                                                  20940000
209500     COMPUTE PV-ITEM = 1 + ((SU025-ITEM (SU025-IDX) - 1)          20950000
209600                     / PC-ITEMS-PER-PANEL).                       20960000
209700                                                                  20970000
209800     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           20980000
209900         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          20990000
210000             PERFORM 6111-WRITE-LIST-QUEUE                        21000000
210100         END-IF                                                   21010000
210200         MOVE PV-ITEM          TO PV-SAVE-ITEM                    21020000
210300                                                                  21030000
210400         PERFORM 6112-READ-LIST-QUEUE                             21040000
210500         IF  PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)           21050000
210600             CONTINUE                                             21060000
210700         END-IF                                                   21070000
210800     END-IF.                                                      21080000
210900                                                                  21090000
211000     COMPUTE PV-SUB = (SU025-ITEM (SU025-IDX)                     21100000
211100                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              21110000
211200     SET LQW-DESELECT (PV-SUB)             TO  TRUE.              21120000
211300     MOVE LQW-SELECTED-SW (PV-SUB)                                21130000
211400                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  21140000
211500     EVALUATE TRUE                                                21150000
211600         WHEN SU025-INQ (SU025-IDX)                               21160000
211700              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             21170000
211800                                                                  21180000
211900         WHEN SU025-UPD (SU025-IDX)                               21190000
212000              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             21200000
212100                                                                  21210000
212200         WHEN SU025-DEL (SU025-IDX)                               21220000
212300              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             21230000
212400                                                                  21240000
212500         WHEN SU025-ERR (SU025-IDX)                               21250000
212600              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             21260000
212700     END-EVALUATE.                                                21270000
212800                                                                  21280000
212900     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                21290000
213000                                                                  21300000
213100*----------------------------------------------------------------*21310000
213200*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *21320000
213300*----------------------------------------------------------------*21330000
213400                                                                  21340000
213500 6111-WRITE-LIST-QUEUE.                                           21350000
213600                                                                  21360000
213700     EXEC CICS                                                    21370000
213800         WRITEQ TS                                                21380000
213900             QUEUE (ASC-LIST-QUEUE-NAME)                          21390000
214000             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     21400000
214100             ITEM  (PV-SAVE-ITEM)                                 21410000
214200             REWRITE                                              21420000
214300             RESP  (PV-CICS-RESPONSE)                             21430000
214400     END-EXEC.                                                    21440000
214500*                                                                 21450000
214600     IF  PV-CICS-RESPONSE = DFHRESP (NORMAL)                      21460000
214700         CONTINUE                                                 21470000
214800     ELSE                                                         21480000
214900         SET DP013-CICS-ABEND  TO  TRUE                           21490000
215000         SET DP013-NO-ROLLBACK TO  TRUE                           21500000
215100         MOVE '6111-WRITE-LIST-QUEUE'                             21510000
215200                               TO  DP013-PARAGRAPH                21520000
215300         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  21530000
215400                               TO  DP013-MESSAGE-TEXT(1)          21540000
215500         PERFORM DP013-0000-PROCESS-ABEND                         21550000
215600     END-IF.                                                      21560000
215700                                                                  21570000
215800 EJECT                                                            21580000
215900*----------------------------------------------------------------*21590000
216000*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*21600000
216100*----------------------------------------------------------------*21610000
216200                                                                  21620000
216300 6112-READ-LIST-QUEUE.                                            21630000
216400                                                                  21640000
216500     EXEC CICS                                                    21650000
216600         READQ TS                                                 21660000
216700             QUEUE (ASC-LIST-QUEUE-NAME)                          21670000
216800             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     21680000
216900             ITEM  (PV-ITEM)                                      21690000
217000             RESP  (PV-CICS-RESPONSE)                             21700000
217100     END-EXEC.                                                    21710000
217200*                                                                 21720000
217300     IF  PV-CICS-RESPONSE = DFHRESP (NORMAL)                      21730000
217400         CONTINUE                                                 21740000
217500     ELSE                                                         21750000
217600         SET DP013-CICS-ABEND        TO TRUE                      21760000
217700         SET DP013-NO-ROLLBACK       TO TRUE                      21770000
217800         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           21780000
217900         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    21790000
218000                                     TO DP013-MESSAGE-TEXT(1)     21800000
218100         PERFORM DP013-0000-PROCESS-ABEND                         21810000
218200     END-IF.                                                      21820000
218300                                                                  21830000
218400                                                                  21840000
218500*----------------------------------------------------------------*21850000
218600* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *21860000
218700*----------------------------------------------------------------*21870000
218800                                                                  21880000
218900 9100-READ-SEL-QUEUE.                                             21890000
219000     EXEC CICS                                                    21900000
219100         READQ TS                                                 21910000
219200             QUEUE (ASC-SEL-QUEUE-NAME)                           21920000
219300             INTO  (SU025-SELECT-RECORD)                          21930000
219400             ITEM  (ASC-SEL-ITEM)                                 21940000
219500             RESP  (PV-CICS-RESPONSE)                             21950000
219600     END-EXEC.                                                    21960000
219700                                                                  21970000
219800     IF  PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL)                   21980000
219900         CONTINUE                                                 21990000
220000     ELSE                                                         22000000
220100         SET DP013-LOGIC-ABEND                                    22010000
220200             DP013-NO-ROLLBACK     TO TRUE                        22020000
220300         MOVE '9100-READ-SEL-QUEUE'                               22030000
220400                                   TO DP013-PARAGRAPH             22040000
220500         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   22050000
220600                                   TO DP013-MESSAGE-TEXT (1)      22060000
220700         PERFORM DP013-0000-PROCESS-ABEND                         22070000
220800     END-IF.                                                      22080000
220900*----------------------------------------------------------------*22090000
221000* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *22100000
221100*----------------------------------------------------------------*22110000
221200 9200-REWRITE-LIST-QUEUE.                                         22120000
221300     EXEC CICS                                                    22130000
221400          WRITEQ TS                                               22140000
221500              QUEUE  (ASC-SEL-QUEUE-NAME)                         22150000
221600              FROM   (SU025-SELECT-RECORD)                        22160000
221700              ITEM   (ASC-SEL-ITEM)                               22170000
221800              RESP   (PV-CICS-RESPONSE)                           22180000
221900              REWRITE                                             22190000
222000     END-EXEC.                                                    22200000
222100                                                                  22210000
222200     IF  PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)               22220000
222300         SET DP013-CICS-ABEND                                     22230000
222400             DP013-NO-ROLLBACK     TO TRUE                        22240000
222500         MOVE '9200-REWRITE-LIST-QUEUE'                           22250000
222600                                   TO DP013-PARAGRAPH             22260000
222700         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   22270000
222800                                   TO DP013-MESSAGE-TEXT (1)      22280000
222900         PERFORM DP013-0000-PROCESS-ABEND                         22290000
223000     END-IF.                                                      22300000
223100                                                                  22310000
223200                                                                  22320000
223300*----------------------------------------------------------------*22330000
223400*    THE DB2 RESOURCE IS NOT AVAILABLE, SET THE ERROR MESSAGE    *22340000
223500*    AND THE ERROR SWITCHES.                                     *22350000
223600*----------------------------------------------------------------*22360000
223700 9900-SOFT-ABORT.                                                 22370000
223800     SET PS-ERROR         TO TRUE.                                22380000
223900     SET DP020-MSG-FATAL  TO TRUE.                                22390000
224000     MOVE PC-TSYMSG-00551 TO DP020-MSG-NUMBER.                    22400000
224100     SET DP020-NEXT-ACT-APPL-ERROR TO TRUE.                       22410000
224200     MOVE 'PROGRAM EXIT CALL' TO DP013-MESSAGE-TEXT (1).          22420000
224300     PERFORM 0001-CALL-CICS-ARCH-API.                             22430000
224400                                                                  22440000
224500******************************************************************22450000
224600 9999-WRITE-MESSAGE-TO-CICS-LOG.                                  22460000
224700                                                                  22470000
224800     MOVE PC-CURRENT-PROGRAM-NAME     TO DP013-PROGRAM.           22480000
224900     MOVE DFHEIBLK                    TO DP013-DFHEIBLK.          22490000
225000     INITIALIZE DP013-SRC-TASK-NUMBER                             22500000
225100                DP013-STACK.                                      22510000
225200     SET DP013-LINK-RETURN            TO TRUE.                    22520000
225300                                                                  22530000
225400     EXEC CICS                                                    22540000
225500         LINK                                                     22550000
225600             PROGRAM   (DP013-NAME)                               22560000
225700             COMMAREA  (DP013-PARAMETERS)                         22570000
225800             LENGTH    (DP013-LENGTH)                             22580000
225900     END-EXEC.                                                    22590000
226000/                                                                 22600000
226100*----------------------------------------------------------------*22610000
226200*    ABEND PROCESSOR MODULE                                      *22620000
226300*----------------------------------------------------------------*22630000
226400                                                                  22640000
226500     COPY DPPD013.                                                22650000
226600                                                                  22660000
226700*----------------------------------------------------------------*22670000
226800*    LINK TO CICS OBJECT LOCKING MODULE                          *22680000
226900*----------------------------------------------------------------*22690000
227000                                                                  22700000
227100     COPY DPPD044.                                                22710000
