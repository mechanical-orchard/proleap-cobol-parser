000100*-----------------------*                                         00010004
000200 IDENTIFICATION DIVISION.                                         00020004
000300*-----------------------*                                         00030004
000400 PROGRAM-ID.    ETKCS346.                                         00040004
000500 AUTHOR.        TESS BESTE.                                       00050004
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060004
000700 DATE-WRITTEN.  04-19-95.                                         00070004
000800 DATE-COMPILED.                                                   00080004
000900                                                                  00090004
001000*-----------------------------------------------------------------00100004
001100*             E346 - DOCUMENTS ON HOLD UPDATE                     00110004
001200*                                                                 00120004
001300* THIS PROGRAM READS THE SELECTED ITEMS QUEUE FROM THE EDI PO LIST00130004
001400* PROGRAM.  FOR EACH SELECTED P.O., IT RETRIEVES THE DATA RELATED 00140004
001500* RELATED TO THE DOCUMENT CONTAINING THAT P.O., EXAMINES IT FOR   00150004
001600* ERRORS, AND DISPLAYS THE RESULTS.                               00160004
001700*                                                                 00170004
001800* THE SCREEN CONTAINS A HEADER SECTION AND A DETAIL SECTION.  THE 00180004
001900* HEADER SECTION CONTAINS DOCUMENT HEADER INFO.  THIS INFO VARIES 00190004
002000* DEPENDING UPON WHAT TYPE OF DOCUMENT IT IS (INVOICE OR POA).    00200004
002100* THE DEPARTMENT NUMBER IN THE HEADER SECTION MAY BE UPDATED.     00210004
002200* THE DETAIL SECTION CONTAINS ONE LINE FOR EACH ERROR DETECTED    00220004
002300* WITHIN THE DOCUMENT.  EACH LINE CONTAINS THE UPC CODE AND AN    00230004
002400* ERROR MESSAGE.  THESE LINES ARE DISPLAYED IN A LIST FORMAT, AND 00240004
002500* MAY THEN BE SELECTED FOR FURTHER INQUIRY BY THE EDI UPC DETAIL  00250004
002600* INQUIRY PROGRAM.                                                00260004
002700******************************************************************00270004
002800*  DATE  07/18/2003                                               00280004
002900*  CHANGE MADE:                                                   00290004
003000*   MADE CHANGES TO SUPPORT THE PROCESSING OF COMPOUND PACK. AP   00300004
003100*   NO LONGER REQUIRES THE ET ONHOLD PROCESS TO PERFORM           00310004
003200*   VERIFICATION ON THE UPC NUMBER FOR INVOICES. THIS LOGIC WAS   00320004
003300*   COMMENTED OUT AS A RESULT.                                    00330004
003400*  MADE BY: JON FIEDLER             WR# : 24764                   00340004
003500******************************************************************00350004
003600* CHANGED 11/04/2014    BY COGNIZANT       WR: CHG0101274         00360004
003700*                                                                 00370004
003800* EXTENDED PO# FROM 7 TO 8 DIGITS WHERE NEEDED.                   00380004
003900* RECOMPILED FOR APRD050 8 DIGITS PO# EXPANDED.                   00390004
004000*---------------------------------------------------------------- 00400004
004010* 10/11/2021 GERMAN BANDA                    WR/IR #: CHG0262418* 00401006
004020*            - CHANGE CALL OF DPKUT100 TO                       * 00402006
004030*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00403006
004040*              MAKING THE CALL DYNAMIC VS STATIC                * 00404006
004050*                                                               * 00405006
004060*---------------------------------------------------------------* 00406006
CICS  *  CHANGED 10/28/2022    BY BARB SCHULTZ    WR: CHG0277210      * 00407007
CICS  *                                                               * 00408007
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL   * 00409007
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.    * 00409107
CICS  *---------------------------------------------------------------* 00409307
004300                                                                  00430004
004400 ENVIRONMENT DIVISION.                                            00440004
004500                                                                  00450004
004600 DATA DIVISION.                                                   00460004
004700                                                                  00470004
004800 WORKING-STORAGE SECTION.                                         00480004
004900                                                                  00490004
005000 01  PC-PROGRAM-CONSTANTS.                                        00500004
005100     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00510004
005200                                                    'ET346A  '.   00520004
005300     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00530004
005400                                                    'ETKM346 '.   00540004
005500     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00550004
005600                                                    'ETKCS346'.   00560004
005700     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00570004
005800     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00580004
005900     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +7      00590004
006000                                                    COMP SYNC.    00600004
006100     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00610004
006200                                                    COMP SYNC.    00620004
006300     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00630004
006400                                                    +1000000      00640004
006500                                                    COMP-3.       00650004
006600     05  PC-ITEM-NUMBER-LENGTH          PIC S9(04)  VALUE +5      00660004
006700                                                    COMP SYNC.    00670004
006800     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00680004
006900     05  PC-TRN-SET-CDES.                                         00690004
007000         10  PC-TRN-SET-CDE-INV         PIC  X(03)  VALUE '810'.  00700004
007100         10  PC-TRN-SET-CDE-POA         PIC  X(03)  VALUE '855'.  00710004
007200     05  PC-ERROR-MSGS.                                           00720004
007300         10  PC-MSG-UPC-SKU-NOT-FND     PIC  X(20)  VALUE         00730004
007400                                           'UPC/SKU NOT FOUND   '.00740004
007500         10  PC-MSG-WRONG-DEPT          PIC  X(20)  VALUE         00750004
007600                                           'WRONG DEPARTMENT    '.00760004
007700         10  PC-MSG-UPC-NOT-ON-PO       PIC  X(20)  VALUE         00770004
007800                                           'UPC NOT ON  P.O.    '.00780004
007900     05  PC-STATUS-MSGS.                                          00790004
008000         10  PC-STATUS-NEW-PO           PIC  X(15)  VALUE         00800004
008100                                                'NEW P.O.       '.00810004
008200         10  PC-STATUS-DUP              PIC  X(15)  VALUE         00820004
008300                                                'DUPLICATE      '.00830004
008400         10  PC-STATUS-MULT-DEPT        PIC  X(15)  VALUE         00840004
008500                                                'MULTIPLE DEPTS '.00850004
008600         10  PC-STATUS-NO-DEPT          PIC  X(15)  VALUE         00860004
008700                                                'NO DEPT        '.00870004
008800         10  PC-STATUS-NOT-FOUND        PIC  X(15)  VALUE         00880004
008900                                                'NOT FOUND      '.00890004
009000         10  PC-STATUS-ON-HOLD          PIC  X(15)  VALUE         00900004
009100                                                'ON HOLD        '.00910004
009200         10  PC-STATUS-NEW-INVOICE      PIC  X(15)  VALUE         00920004
009300                                                'NEW INVOICE    '.00930004
009400     05  PC-HEADER-LINE-LABELS.                                   00940004
009500         10  PC-DEPT-LINE-LABEL         PIC  X(22)  VALUE         00950004
009600                                         'DEPARTMENT...........:'.00960004
009700         10  PC-ASSIGNED-DEPT-LINE-LABEL                          00970004
009800                                        PIC  X(22)  VALUE         00980004
009900                                         'ASSIGNED DEPARTMENT..:'.00990004
010000         10  PC-VENDOR-LINE-LABEL       PIC  X(22)  VALUE         01000004
010100                                         'VENDOR...............:'.01010004
010200         10  PC-INV-LINE-LABEL          PIC  X(22)  VALUE         01020004
010300                                         'INVOICE NUMBER.......:'.01030004
010400                                                                  01040004
010500     05  PC-TSYMSG-NUMBERS.                                       01050004
010600         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  01060004
010700         10  PC-TSYMSG-00007            PIC  9(05)  VALUE 00007.  01070004
010800         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  01080004
010900         10  PC-TSYMSG-00046            PIC  9(05)  VALUE 00046.  01090004
011000         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  01100004
011100         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  01110004
011200         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  01120004
011300         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  01130004
011400         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  01140004
011500         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  01150004
011600         10  PC-TSYMSG-00059            PIC  9(05)  VALUE 00059.  01160004
011700         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  01170004
011800         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  01180004
011900         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  01190004
012000         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01200004
012100         10  PC-TSYMSG-00489            PIC  9(05)  VALUE 00489.  01210004
012200         10  PC-TSYMSG-00551            PIC  9(05)  VALUE 00551.  01220004
012300         10  PC-TSYMSG-00660            PIC  9(05)  VALUE 00660.  01230004
012400                                                                  01240004
012500 01  PS-PROGRAM-SWITCHES.                                         01250004
012600     05  PS-ERROR-SW                    PIC  X      VALUE 'Y'.    01260004
012700         88  PS-NO-ERROR                            VALUE 'Y'.    01270004
012800         88  PS-ERROR                               VALUE 'N'.    01280004
012900     05  PS-POA-ERROR-SW                PIC  X.                   01290004
013000         88  PS-POA-NO-ERRORS                       VALUE SPACE.  01300004
013100         88  PS-POA-SKU-ERR                         VALUE 'S'.    01310004
013200         88  PS-POA-DEPT-ERR                        VALUE 'D'.    01320004
013300     05  PS-INV-ERROR-SW                PIC  X.                   01330004
013400         88  PS-INV-NO-ERRORS                       VALUE SPACE.  01340004
013500         88  PS-INV-SKU-ERR                         VALUE 'S'.    01350004
013600         88  PS-INV-UPC-ERR                         VALUE 'U'.    01360004
013700     05  PS-CHECK-FOR-LINE-MATCH-SW     PIC  X.                   01370004
013800         88  PS-DONT-CHECK-FOR-LINE-MATCH           VALUE 'N'.    01380004
013900         88  PS-CHECK-FOR-LINE-MATCH                VALUE 'Y'.    01390004
014000     05  PS-DATA-AVAILABLE-SW           PIC  X.                   01400004
014100         88  PS-DATA-AVAILABLE                      VALUE 'Y'.    01410004
014200         88  PS-DATA-NOT-AVAILABLE                  VALUE 'N'.    01420004
014300     05  PS-UPDATE-REQUESTED-SW         PIC  X.                   01430004
014400         88  PS-UPDATE-REQUESTED                    VALUE 'Y'.    01440004
014500         88  PS-NO-UPDATE-REQUESTED                 VALUE 'N'.    01450004
014600     05  PS-START-ITEM-ERROR-SW         PIC  X      VALUE 'Y'.    01460004
014700         88  PS-NO-START-ITEM-ERROR                 VALUE 'Y'.    01470004
014800         88  PS-START-ITEM-ERROR                    VALUE 'N'.    01480004
014900     05  PS-LIST-END-SW                 PIC X       VALUE 'N'.    01490004
015000         88  PS-LIST-END                            VALUE 'Y'.    01500004
015100         88  PS-NO-LIST-END                         VALUE 'N'.    01510004
015200                                                                  01520004
015300 01  PV-PROGRAM-VARIABLES.                                        01530004
015400     05  PV-SUB                         PIC S9(04)  VALUE +0      01540004
015500                                                    COMP SYNC.    01550004
015600     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01560004
015700                                                    COMP SYNC.    01570004
015800     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01580004
015900                                                    COMP-3.       01590004
016000     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01600004
016100                                                    COMP-3.       01610004
016200     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01620004
016300                                                    COMP-3.       01630004
016400     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01640004
016500                                                    COMP-3.       01650004
016600     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01660004
016700                                                    COMP-3.       01670004
016800     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01680004
016900                                                    COMP-3.       01690004
017000     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01700004
017100                                                    COMP-3.       01710004
017200     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01720004
017300                                                    COMP SYNC.    01730004
017400     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01740004
017500                                                    COMP SYNC.    01750004
017600     05  PV-ITEM                        PIC S9(04)  VALUE +0      01760004
017700                                                    COMP SYNC.    01770004
017800     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01780004
017900                                                    COMP SYNC.    01790004
018000     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01800004
018100                                                    COMP SYNC.    01810004
018200     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01820004
018300                                                    COMP SYNC.    01830004
018400     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01840004
018500                                                    COMP SYNC.    01850004
018600     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01860004
018700                                                    COMP SYNC.    01870004
018800     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01880004
018900                                                    COMP SYNC.    01890004
019000     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01900004
019100                                                    COMP SYNC.    01910004
019200     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01920004
019300                                                    COMP SYNC.    01930004
019400     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01940004
019500                                                    COMP SYNC.    01950004
019600     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01960004
019700                                                    COMP SYNC.    01970004
019800     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01980004
019900                                                    COMP SYNC.    01990004
020000     05  PV-DB2-DEPT-NBR                PIC  X(03).               02000004
020100     05  PV-DB2-DEPT-NBR-N              REDEFINES                 02010004
020200         PV-DB2-DEPT-NBR                PIC  9(03).               02020004
020300                                                                  02030004
020400     05  PV-FORMAT-UPC-NBR.                                       02040004
020500         10  FILLER                     PIC  X(02).               02050004
020600         10  FILLER                     PIC  X      VALUE '-'.    02060004
020700         10  FILLER                     PIC  X(05).               02070004
020800         10  FILLER                     PIC  X      VALUE '-'.    02080004
020900         10  FILLER                     PIC  X(05).               02090004
021000         10  FILLER                     PIC  X      VALUE '-'.    02100004
021100         10  FILLER                     PIC  X.                   02110004
021200                                                                  02120004
021300     05  PV-PO002-I-SKU                 PIC 9(08)   VALUE ZERO.   02130004
021400     05  PV-SKXREF-SKU                  PIC S9(08)  COMP-3.       02140004
021500                                                                  02150004
021600     05  PV-SKXREF-DEPT                 PIC X(03)   VALUE SPACES  02160004
021700                                                  JUSTIFIED RIGHT.02170004
021800                                                                  02180004
021900                                                                  02190004
022000*-----------------------------------------------------------------02200004
022100* THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE. THIS  02210004
022200* QUEUE MUST HAVE THE SAME LAYOUT AS 1 OCCURRENCE OF              02220004
022300* ASC-BLOCK-ENTRIES.                                              02230004
022400*-----------------------------------------------------------------02240004
022500                                                                  02250004
022600 01  LQW-LIST-QUEUE-WORK-AREA.                                    02260004
022700     05  LQW-BLOCK-MODIFIED             PIC  X      VALUE SPACE.  02270004
022800     05  LQW-ITEM-ENTRIES               OCCURS 7  TIMES           02280004
022900                                        INDEXED BY LQW-IDX.       02290004
023000         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       02300004
023100         10  LQW-TEMP-SELECTED-SW       PIC  X.                   02310004
023200         10  LQW-SELECTED-SW            PIC  X.                   02320004
023300             88  LQW-SELECT                         VALUE 'S'.    02330004
023400             88  LQW-DESELECT                       VALUE ' '.    02340004
023500         10  LQW-ACTION                 PIC  X(03).               02350004
023600         10  LQW-UPC-NBR                PIC  X(15).               02360004
023700         10  LQW-ERROR-MSG              PIC  X(20).               02370004
023800                                                                  02380004
023900                                                                  02390004
024000*-----------------------------------------------------------------02400004
024100* RECORD LAYOUT FOR THE EDI DOCUMENTS ON HOLD SELECTED ITEMS TEMP 02410004
024200* STORAGE QUEUE.                                                  02420004
024300*-----------------------------------------------------------------02430004
024400                                                                  02440004
024500     COPY ETWS346.                                                02450004
024600                                                                  02460004
024700                                                                  02470004
024800*-----------------------------------------------------------------02480004
024900* MAP LAYOUT                                                      02490004
025000*-----------------------------------------------------------------02500004
025100                                                                  02510004
025200     COPY ETKM346.                                                02520004
025300*                                                                 02530004
025400 01  MR-OCCURS-LAYOUT                   REDEFINES  ET346AO.       02540004
025500     05  FILLER                         PIC X(367).               02550004
025600     05  MR-SCROLL-AREA                 OCCURS 7  TIMES.          02560004
025700         10  MR-SELECTL                 PIC S9(04) COMP.          02570004
025800         10  MR-SELECTA                 PIC  X(01).               02580004
025900         10  MR-SELECTC                 PIC  X(01).               02590004
026000         10  MR-SELECTH                 PIC  X(01).               02600004
026100         10  MR-SELECT                  PIC  X(01).               02610004
026200                                                                  02620004
026300         10  MR-ACTIONL                 PIC S9(04) COMP.          02630004
026400         10  MR-ACTIONA                 PIC  X(01).               02640004
026500         10  MR-ACTIONC                 PIC  X(01).               02650004
026600         10  MR-ACTIONH                 PIC  X(01).               02660004
026700         10  MR-ACTION                  PIC  X(03).               02670004
026800                                                                  02680004
026900         10  MR-UPC-NBRL                PIC S9(04) COMP.          02690004
027000         10  MR-UPC-NBRA                PIC  X(01).               02700004
027100         10  MR-UPC-NBRC                PIC  X(01).               02710004
027200         10  MR-UPC-NBRH                PIC  X(01).               02720004
027300         10  MR-UPC-NBR                 PIC  X(16).               02730004
027400                                                                  02740004
027500         10  MR-ERROR-MSGL              PIC S9(04) COMP.          02750004
027600         10  MR-ERROR-MSGA              PIC  X(01).               02760004
027700         10  MR-ERROR-MSGC              PIC  X(01).               02770004
027800         10  MR-ERROR-MSGH              PIC  X(01).               02780004
027900         10  MR-ERROR-MSG               PIC  X(20).               02790004
028000                                                                  02800004
028100*-----------------------------------------------------------------02810004
028200* EDI PURCHASE ORDER ACKNOWLEDGMENT RECORD LAYOUT                 02820004
028300*-----------------------------------------------------------------02830004
028400                                                                  02840004
028500     COPY PORD002.                                                02850004
028600                                                                  02860004
028700*-----------------------------------------------------------------02870004
028800* EDI INVOICE RECORD LAYOUT                                       02880004
028900*-----------------------------------------------------------------02890004
029000                                                                  02900004
029100 01  AP050-EDI-IN-FILE.                                           02910004
029200     COPY APRD050.                                                02920004
029300                                                                  02930004
029400*-----------------------------------------------------------------02940004
029500* NUMERIC EDIT ROUTINE COPYBOOK                                   02950004
029600*-----------------------------------------------------------------02960004
029700                                                                  02970004
029800     COPY DPWS010I.                                               02980004
029900                                                                  02990004
030000*-----------------------------------------------------------------03000004
030100* ATTRIBUTE SETTINGS COPYBOOK                                     03010004
030200*-----------------------------------------------------------------03020004
030300                                                                  03030004
030400     COPY DPWS015.                                                03040004
030500                                                                  03050004
030600*-----------------------------------------------------------------03060004
030700* FUNCTION KEYS COPYBOOK                                          03070004
030800*-----------------------------------------------------------------03080004
030900                                                                  03090004
031000     COPY DPWS016.                                                03100004
031100                                                                  03110004
031200*-----------------------------------------------------------------03120004
CICS  * PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.               03130007
031400*-----------------------------------------------------------------03140004
031500                                                                  03150004
031600     COPY DPWS030.                                                03160004
CICS       COPY DPWS930.                                                03161007
031700                                                                  03170004
031800*-----------------------------------------------------------------03180004
031900* STANDARD COMMAREA                                               03190004
032000*-----------------------------------------------------------------03200004
032100                                                                  03210004
032200     COPY DPWS020.                                                03220004
032300     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03230004
032400                                                                  03240004
032500*-----------------------------------------------------------------03250004
032600* THIS IS THE INTER-APPLICATION COMMAREA FOR THE EDI DOCUMENTS    03260004
032700* ON HOLD SCREENS.                                                03270004
032800*-----------------------------------------------------------------03280004
032900                                                                  03290004
033000         10  INTER-APPL-COMM-AREA       PIC X(200).               03300004
033100     COPY ETWS345.                                                03310004
033200*-----------------------------------------------------------------03320004
033300* THIS IS THE APPLICATION-SPECIFIC COMMAREA.                      03330004
033400*-----------------------------------------------------------------03340004
033500         10  ASC-SPECIFIC-COMMAREA.                               03350004
033600             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03360004
033700                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03370004
033800                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03380004
033900                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03390004
034000                                                                  03400004
034100                 20  ASC-ITEM-ARRAY.                              03410004
034200                     25  ASC-ITEM-ENTRIES OCCURS 7  TIMES.        03420004
034300                         30  ASC-LIST-ITEM-NUMBER                 03430004
034400                                                     PIC S9(09)   03440004
034500                                                     COMP-3.      03450004
034600                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03460004
034700                             88  ASC-VALID-SELECT    VALUE ' '    03470004
034800                                                           'S'    03480004
034900                                                           'B'    03490004
035000                                                           'E'.   03500004
035100                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03510004
035200                             88  ASC-TEMP-SELECT     VALUE 'S'.   03520004
035300                             88  ASC-TEMP-BEGIN      VALUE 'B'.   03530004
035400                             88  ASC-TEMP-END        VALUE 'E'.   03540004
035500                         30  ASC-SELECTED-SW         PIC  X(01).  03550004
035600                             88  ASC-NO-SELECT       VALUE ' '.   03560004
035700                             88  ASC-SELECT          VALUE 'S'.   03570004
035800                             88  ASC-BEGIN           VALUE 'B'.   03580004
035900                             88  ASC-END             VALUE 'E'.   03590004
036000                         30  ASC-ACTION              PIC  X(03).  03600004
036100                         30  ASC-UPC-NBR             PIC  X(15).  03610004
036200                         30  ASC-ERROR-MSG           PIC  X(20).  03620004
036300                                                                  03630004
036400*            *----------------------------------------------------03640004
036500*            * THE FOLLOWING FIELDS ARE PASSED TO THIS PROGRAM IN 03650004
036600*            * THE SELECTION QUEUE.                               03660004
036700*            *----------------------------------------------------03670004
036800             15  ASC-SEL-QUEUE-FIELDS.                            03680004
036900                 20  ASC-TP-DKEY                     PIC S9(09)   03690004
037000                                                         COMP.    03700004
037100                 20  ASC-TP-DKEY-TMST                PIC  X(26).  03710004
037200                 20  ASC-TRN-SET-CDE                 PIC  X(03).  03720004
037300                 20  ASC-VENDOR-NAME                 PIC  X(10).  03730004
037400                 20  ASC-PO-NBR                      PIC  X(22).  03740004
037500                 20  ASC-ASSIGNED-DEPT-NBR           PIC  X(03).  03750004
037600*            *----------------------------------------------------03760004
037700*            * THE FOLLOWING ARE HEADER SECTION FIELDS THAT ARE   03770004
037800*            * FILLED IN BY THIS PROGRAM.                         03780004
037900*            *----------------------------------------------------03790004
038000             15  ASC-HEADER-INFO.                                 03800004
038100                 20  ASC-PO-STATUS                   PIC  X(17).  03810004
038200                 20  ASC-DEPT-STATUS                 PIC  X(15).  03820004
038300                 20  ASC-INVOICE-NBR                 PIC  X(22).  03830004
038400                 20  ASC-INV-STATUS                  PIC  X(15).  03840004
038500                 20  ASC-DEPT-NBR                    PIC  X(03).  03850004
038600                                                                  03860004
038700             15  ASC-NEW-ASSIGNED-DEPT-NBR           PIC  X(30).  03870004
038800                                                                  03880004
038900             15  ASC-BLK-SUB                         PIC S9(04)   03890004
039000                                                          COMP    03900004
039100                                                          SYNC.   03910004
039200             15  ASC-ITEM-SUB                        PIC S9(04)   03920004
039300                                                          COMP    03930004
039400                                                          SYNC.   03940004
039500             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   03950004
039600                                                          COMP-3. 03960004
039700             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   03970004
039800                                                          COMP-3. 03980004
039900             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03990004
040000                                                          COMP-3. 04000004
040100             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   04010004
040200                                                          COMP-3. 04020004
040300             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   04030004
040400                                                          COMP-3. 04040004
040500             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   04050004
040600                                                          COMP    04060004
040700                                                          SYNC.   04070004
040800             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   04080004
040900                                                          COMP-3. 04090004
041000             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   04100004
041100                                                          COMP-3. 04110004
041200             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  04120004
041300                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   04130004
041400                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   04140004
041500             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  04150004
041600                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   04160004
041700                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   04170004
041800             15  ASC-LIST-QUEUE-NAME.                             04180004
041900                 20  ASC-LIST-TERM-ID                PIC  X(04).  04190004
042000                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   04200004
042100                                                          COMP-3. 04210004
042200                 20  ASC-LIST-SEQ                    PIC  9(01).  04220004
042300             15  ASC-INPUT-SEL-QUEUE-NAME            PIC  X(08).  04230004
042400             15  ASC-OUTPUT-SEL-QUEUE-NAME.                       04240004
042500                 20  ASC-SEL-TERM-ID                 PIC  X(04).  04250004
042600                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   04260004
042700                                                          COMP-3. 04270004
042800                 20  ASC-SEL-SEQ                     PIC  9(01).  04280004
042900             15  ASC-SEL-SUB                         PIC S9(04)   04290004
043000                                                     COMP.        04300004
043100             15  ASC-SEL-ITEM                        PIC S9(04)   04310004
043200                                                     COMP.        04320004
043300             15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(05)   04330004
043400                                                     COMP-3.      04340004
043500             15  ASC-USE-SELECTION-QUEUE-IND         PIC  X.      04350004
043600                 88  ASC-USE-SELECTION-QUEUE         VALUE 'Y'.   04360004
043700             15  ASC-START-ITEM-REQUEST.                          04370004
043800                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  04380004
043900         10  FILLER                     PIC  X(1985).             04390004
044000                                                                  04400004
044100                                                                  04410004
044200*-----------------------------------------------------------------04420004
044300* ABEND PROCESSING COPYBOOK.                                      04430004
044400*-----------------------------------------------------------------04440004
044500                                                                  04450004
044600     COPY DPWS013.                                                04460004
044700                                                                  04470004
044800                                                                  04480004
044900*-----------------------------------------------------------------04490004
045000* DB2 AREA FOR P.O.'S ON HOLD TABLE                               04500004
045100*-----------------------------------------------------------------04510004
045200     EXEC SQL                                                     04520004
045300          INCLUDE TTRPOHL                                         04530004
045400     END-EXEC.                                                    04540004
045500                                                                  04550004
045600*-----------------------------------------------------------------04560004
045700* DB2 AREA FOR FG/TSET HELD DATA TABLE                            04570004
045800*-----------------------------------------------------------------04580004
045900     EXEC SQL                                                     04590004
046000          INCLUDE TFGTRDT                                         04600004
046100     END-EXEC.                                                    04610004
046200                                                                  04620004
046300*-----------------------------------------------------------------04630004
046400* DB2 AREA FOR TRADING PARTNER TABLE                              04640004
046500*-----------------------------------------------------------------04650004
046600     EXEC SQL                                                     04660004
046700          INCLUDE TTRDPRT                                         04670004
046800     END-EXEC.                                                    04680004
046900                                                                  04690004
047000*-----------------------------------------------------------------04700004
047100* DB2 AREA FOR STATUS CODE TABLE                                  04710004
047200*-----------------------------------------------------------------04720004
047300     EXEC SQL                                                     04730004
047400          INCLUDE TSTATCD                                         04740004
047500     END-EXEC.                                                    04750004
047600                                                                  04760004
047700*-----------------------------------------------------------------04770004
047800* DB2 AREA FOR VENDOR DEPARTMENT TABLE                            04780004
047900*-----------------------------------------------------------------04790004
048000     EXEC SQL                                                     04800004
048100          INCLUDE TVNDDPT                                         04810004
048200     END-EXEC.                                                    04820004
048300                                                                  04830004
048400*-----------------------------------------------------------------04840004
048500* DB2 AREA FOR SKU CROSS REFERENCE TABLE                          04850004
048600*-----------------------------------------------------------------04860004
048700     EXEC SQL                                                     04870004
048800          INCLUDE TSKXREF                                         04880004
048900     END-EXEC.                                                    04890004
049000                                                                  04900004
049100*-----------------------------------------------------------------04910004
049200* DB2 AREA FOR COMMUNICATIONS                                     04920004
049300*-----------------------------------------------------------------04930004
049400     EXEC SQL                                                     04940004
049500          INCLUDE SQLCA                                           04950004
049600     END-EXEC.                                                    04960004
049700                                                                  04970004
049800*-----------------------------------------------------------------04980004
049900* CURSOR USED TO READ THE ACTUAL DATA RELATED TO A P.O. ON HOLD.  04990004
050000*-----------------------------------------------------------------05000004
050100                                                                  05010004
050200     EXEC SQL                                                     05020004
050300         DECLARE   TFGTRDT-CSR CURSOR FOR                         05030004
050400         SELECT    TRN_SET_SEQ_NBR                                05040004
050500                 , TRN_SET_DATA                                   05050004
050600         FROM      TFGTRDT                                        05060004
050700         WHERE     TP_DKEY      = :ASC-TP-DKEY                    05070004
050800           AND     TP_DKEY_TMST = :ASC-TP-DKEY-TMST               05080004
050900         ORDER BY  TRN_SET_SEQ_NBR                                05090004
051000     END-EXEC.                                                    05100004
051100                                                                  05110004
051200                                                                  05120004
051300 LINKAGE SECTION.                                                 05130004
051400                                                                  05140004
051500 01  DFHCOMMAREA.                                                 05150004
051600     05  FILLER                         OCCURS  1 TO 4072 TIMES   05160004
051700                                        DEPENDING ON EIBCALEN.    05170004
051800         10  FILLER                     PIC X.                    05180004
051900                                                                  05190004
052000                                                                  05200004
052100 PROCEDURE DIVISION.                                              05210004
052200*-----------------------------------------------------------------05220004
052300* THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM.     05230004
052400* FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM      05240004
052500* PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT.     05250004
052600*-----------------------------------------------------------------05260004
052700                                                                  05270004
052800 0000-MAIN-MODULE.                                                05280004
052900                                                                  05290004
053000     INITIALIZE DP030-CICS-API-FIELDS.                            05300004
053100     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       05310004
053200     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          05320004
053300     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         05330004
053400     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       05340004
053500     MOVE LENGTH OF ET346AI        TO DP030-MAP-LENGTH (1).       05350004
053600     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05360004
053700     PERFORM 0001-CALL-CICS-ARCH-API.                             05370004
053800*                                                                 05380004
053900     PERFORM 1000-CONTROL-PROCESSING                              05390004
054000*                                                                 05400004
054100     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05410004
054200     PERFORM 0001-CALL-CICS-ARCH-API.                             05420004
054300                                                                  05430004
054400                                                                  05440004
054500*-----------------------------------------------------------------05450004
054600* THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE       05460004
054700* AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.             05470004
054800*-----------------------------------------------------------------05480004
054900                                                                  05490004
055000 0001-CALL-CICS-ARCH-API.                                         05500004
055100                                                                  05510004
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      05520007
055300                                    DFHCOMMAREA                   05530007
055400                                    DP030-CICS-API-FIELDS         05540007
055500                                    DP020-STANDARD-COMMAREA       05550007
055600                                    ET346AI.                      05560007
055700                                                                  05570004
055800     IF  DP030-RC-CALL-SUCCESSFUL                                 05580004
055900         CONTINUE                                                 05590004
056000     ELSE                                                         05600004
056100         SET DP013-NO-ROLLBACK                                    05610004
056200             DP013-XCTL-DISPLAY-RESTART                           05620004
056300             DP013-CICS-ABEND      TO TRUE                        05630004
056400         MOVE '0001-CALL-CICS-ARCH-API'                           05640004
056500                                   TO DP013-PARAGRAPH             05650004
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O05660007
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05670007
056800         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05680004
056900         PERFORM DP013-0000-PROCESS-ABEND                         05690004
057000     END-IF.                                                      05700004
057100                                                                  05710004
057200                                                                  05720004
057300*-----------------------------------------------------------------05730004
057400* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT       05740004
057500* COURSE OF ACTION IS FOR THIS TRANSACTION.                       05750004
057600*                                                                 05760004
057700* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE   05770004
057800*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS     05780004
057900*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS    05790004
058000*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS.  05800004
058100*-----------------------------------------------------------------05810004
058200                                                                  05820004
058300 1000-CONTROL-PROCESSING.                                         05830004
058400                                                                  05840004
058500     EVALUATE TRUE                                                05850004
058600         WHEN DP020-NEXT-ACT-INITIAL                              05860004
058700             INITIALIZE ASC-SPECIFIC-COMMAREA                     05870004
058800             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            05880004
058900                                      ASC-SEL-TERM-ID             05890004
059000             MOVE DP020-SRC-TASK-NUMBER                           05900004
059100                                   TO ASC-LIST-TASK-NUMBER        05910004
059200                                      ASC-SEL-TASK-NUMBER         05920004
059300             MOVE PC-LIST-QUEUE-SEQ                               05930004
059400                                   TO ASC-LIST-SEQ                05940004
059500             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 05950004
059600             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05960004
059700             PERFORM 4000-BUILD-INITIAL-PANEL                     05970004
059800                                                                  05980004
059900         WHEN DP020-NEXT-ACT-READ-MAP                             05990004
060000             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06000004
060100                                   TO PV-TOP-ITEM                 06010004
060200             PERFORM 2000-PROCESS-PANEL                           06020004
060300                                                                  06030004
060400         WHEN DP020-NEXT-ACT-RETURN                               06040004
060500             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06050004
060600                                   TO PV-TOP-ITEM                 06060004
060700             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    06070004
060800             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 06080004
060900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06090004
061000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06100004
061100                                                                  06110004
061200         WHEN OTHER                                               06120004
061300             SET DP013-LOGIC-ABEND TO TRUE                        06130004
061400             SET DP013-NO-ROLLBACK TO TRUE                        06140004
061500             MOVE '1000-CONTROL-PROCESSING'                       06150004
061600                                   TO DP013-PARAGRAPH             06160004
061700             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    06170004
061800                                   TO DP013-MESSAGE-TEXT(1)       06180004
061900             PERFORM DP013-0000-PROCESS-ABEND                     06190004
062000     END-EVALUATE.                                                06200004
062100                                                                  06210004
062200                                                                  06220004
062300*-----------------------------------------------------------------06230004
062400* SAVE FIELDS FROM INTER-APPL COMMAREA.                           06240004
062500*-----------------------------------------------------------------06250004
062600                                                                  06260004
062700 1100-PROCESS-INTER-APPL-COMM.                                    06270004
062800                                                                  06280004
062900     MOVE SPACE                     TO ASC-START-ITEM-REQUEST.    06290004
063000     SET ASC-USE-SELECTION-QUEUE    TO TRUE.                      06300004
063100     MOVE ET345-NUMBER-OF-TS-ITEMS  TO ASC-NUMBER-OF-TS-ITEMS.    06310004
063200     MOVE ET345-SEL-QUEUE-NAME      TO ASC-INPUT-SEL-QUEUE-NAME.  06320004
063300     PERFORM 1120-PREPARE-LIST-ENTRY.                             06330004
063400                                                                  06340004
063500                                                                  06350004
063600*-----------------------------------------------------------------06360004
063700*    GET READY TO START AT THE FIRST ITEM ON THE LIST.            06370004
063800*-----------------------------------------------------------------06380004
063900                                                                  06390004
064000 1120-PREPARE-LIST-ENTRY.                                         06400004
064100                                                                  06410004
064200     MOVE ET346-MAX-ITEMS TO ASC-SEL-SUB.                         06420004
064300     MOVE ZERO            TO ASC-SEL-ITEM.                        06430004
064400     PERFORM 2133-GET-NEXT-SEL-QUEUE-ITEM.                        06440004
064500                                                                  06450004
064600                                                                  06460004
064700*-----------------------------------------------------------------06470004
064800* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA    06480004
064900* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT    06490004
065000* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST   06500004
065100* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID       06510004
065200* FUNCTION KEYS CAN GET THIS FAR.                                 06520004
065300*-----------------------------------------------------------------06530004
065400                                                                  06540004
065500 2000-PROCESS-PANEL.                                              06550004
065600                                                                  06560004
065700     EVALUATE TRUE                                                06570004
065800         WHEN DP020-SRC-AID = DP016-CLEAR                         06580004
065900             MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                06590004
066000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06600004
066100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06610004
066200             IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                  06620004
066300                 SET DP030-SET-CURSOR-APPL-1    TO TRUE           06630004
066400                 IF ASC-TRN-SET-CDE = PC-TRN-SET-CDE-POA          06640004
066500                     MOVE -1                 TO AH3DATAL          06650004
066600                 ELSE                                             06660004
066700                     MOVE -1                 TO AH4DATAL          06670004
066800                 END-IF                                           06680004
066900             END-IF                                               06690004
067000                                                                  06700004
067100         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    06710004
067200             PERFORM 2050-DELETE-LIST-QUEUE                       06720004
067300             PERFORM 4000-BUILD-INITIAL-PANEL                     06730004
067400                                                                  06740004
067500         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    06750004
067600             PERFORM 2140-DESELECT-ALL-ITEMS                      06760004
067700             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 06770004
067800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06780004
067900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06790004
068000             IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                  06800004
068100                 SET DP030-SET-CURSOR-APPL-1    TO TRUE           06810004
068200                 IF ASC-TRN-SET-CDE = PC-TRN-SET-CDE-POA          06820004
068300                     MOVE -1                 TO AH3DATAL          06830004
068400                 ELSE                                             06840004
068500                     MOVE -1                 TO AH4DATAL          06850004
068600                 END-IF                                           06860004
068700             END-IF                                               06870004
068800                                                                  06880004
068900         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             06890004
069000             PERFORM 2133-GET-NEXT-SEL-QUEUE-ITEM                 06900004
069100             IF PS-LIST-END                                       06910004
069200                 SET PS-NO-LIST-END TO TRUE                       06920004
069300                 PERFORM 2200-MOVE-SCREEN-TO-COMMAREA             06930004
069400                 PERFORM 3000-EDIT-DATA-IN-COMMAREA               06940004
069500                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06950004
069600*                ---- BOTTOM OF LIST ----                         06960004
069700                 MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER         06970004
069800                 SET DP020-MSG-INFORMATIONAL TO TRUE              06980004
069900             ELSE                                                 06990004
070000                 PERFORM 2050-DELETE-LIST-QUEUE                   07000004
070100                 PERFORM 4000-BUILD-INITIAL-PANEL                 07010004
070200             END-IF                                               07020004
070300                                                                  07030004
070400         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             07040004
070500             PERFORM 2137-GET-PREV-SEL-QUEUE-ITEM                 07050004
070600             IF PS-LIST-END                                       07060004
070700                 SET PS-NO-LIST-END TO TRUE                       07070004
070800                 PERFORM 2200-MOVE-SCREEN-TO-COMMAREA             07080004
070900                 PERFORM 3000-EDIT-DATA-IN-COMMAREA               07090004
071000                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07100004
071100*                ---- TOP OF LIST ----                            07110004
071200                 MOVE PC-TSYMSG-00069     TO DP020-MSG-NUMBER     07120004
071300                 SET DP020-MSG-INFORMATIONAL TO TRUE              07130004
071400             ELSE                                                 07140004
071500                 PERFORM 2050-DELETE-LIST-QUEUE                   07150004
071600                 PERFORM 4000-BUILD-INITIAL-PANEL                 07160004
071700             END-IF                                               07170004
071800                                                                  07180004
071900         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  07190004
072000             PERFORM 2150-SELECT-ALL-ITEMS                        07200004
072100             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 07210004
072200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07220004
072300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07230004
072400             IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                  07240004
072500                 SET DP030-SET-CURSOR-APPL-1    TO TRUE           07250004
072600                 IF ASC-TRN-SET-CDE = PC-TRN-SET-CDE-POA          07260004
072700                     MOVE -1                 TO AH3DATAL          07270004
072800                 ELSE                                             07280004
072900                     MOVE -1                 TO AH4DATAL          07290004
073000                 END-IF                                           07300004
073100             END-IF                                               07310004
073200                                                                  07320004
073300         WHEN OTHER                                               07330004
073400             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 07340004
073500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07350004
073600             IF  PS-NO-ERROR                                      07360004
073700                 SET DP030-CONTINUE-GO TO TRUE                    07370004
073800                 PERFORM 2100-CHECK-FUNCTION-KEY                  07380004
073900             ELSE                                                 07390004
074000                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07400004
074100                 SET DP030-OVERRIDE-GO TO TRUE                    07410004
074200             END-IF                                               07420004
074300     END-EVALUATE.                                                07430004
074400                                                                  07440004
074500                                                                  07450004
074600*-----------------------------------------------------------------07460004
074700*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                      07470004
074800*-----------------------------------------------------------------07480004
074900                                                                  07490004
075000 2050-DELETE-LIST-QUEUE.                                          07500004
075100                                                                  07510004
075200     EXEC CICS                                                    07520004
075300         DELETEQ TS                                               07530004
075400             QUEUE (ASC-LIST-QUEUE-NAME)                          07540004
075500             RESP  (PV-CICS-RESP)                                 07550004
075600     END-EXEC.                                                    07560004
075700                                                                  07570004
075800     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       07580004
075900        (PV-CICS-RESP = DFHRESP(QIDERR))                          07590004
076000         CONTINUE                                                 07600004
076100     ELSE                                                         07610004
076200         SET DP013-CICS-ABEND      TO TRUE                        07620004
076300         SET DP013-NO-ROLLBACK     TO TRUE                        07630004
076400                                                                  07640004
076500         MOVE '2050-DELETE-LIST-QUEUE'                            07650004
076600                                   TO DP013-PARAGRAPH             07660004
076700         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    07670004
076800                                   TO DP013-MESSAGE-TEXT (1)      07680004
076900         PERFORM DP013-0000-PROCESS-ABEND                         07690004
077000     END-IF.                                                      07700004
077100                                                                  07710004
077200     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  07720004
077300                                                                  07730004
077400                                                                  07740004
077500*-----------------------------------------------------------------07750004
077600* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST. 07760004
077700* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE   07770004
077800* CICS ARCHITECTURE API.                                          07780004
077900*-----------------------------------------------------------------07790004
078000                                                                  07800004
078100 2100-CHECK-FUNCTION-KEY.                                         07810004
078200                                                                  07820004
078300     EVALUATE TRUE                                                07830004
078400         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              07840004
078500             IF PS-NO-UPDATE-REQUESTED                            07850004
078600*                ---- DATA NOT CHANGED; NO UPDATE PERFORMED       07860004
078700                 MOVE PC-TSYMSG-00046                             07870004
078800                                   TO DP020-MSG-NUMBER            07880004
078900                 SET DP020-MSG-WARNING TO TRUE                    07890004
079000             ELSE                                                 07900004
079100                 PERFORM Z850-UPDATE-DEPT-NBR                     07910004
079200                 IF PS-DATA-NOT-AVAILABLE                         07920004
079300                     SET DP020-MSG-FATAL TO TRUE                  07930004
079400*                    ---- UPDATES UNSUCCESSFUL - FILE  ----       07940004
079500*                    ---- UNAVAILABLE                  ----       07950004
079600                     MOVE PC-TSYMSG-00660  TO DP020-MSG-NUMBER    07960004
079700                 ELSE                                             07970004
079800                     SET DP020-MSG-INFORMATIONAL TO TRUE          07980004
079900*                    ---- UPDATE(S) SUCCESSFUL ----               07990004
080000                     MOVE PC-TSYMSG-00059  TO DP020-MSG-NUMBER    08000004
080100                     PERFORM 9100-READ-SEL-QUEUE                  08010004
080200                     SET ET346-UPD (ASC-SEL-SUB) TO TRUE          08020004
080300                     MOVE ASC-NEW-ASSIGNED-DEPT-NBR               08030004
080400                                 TO ET346-DEPT-NBR (ASC-SEL-SUB)  08040004
080500                                    ASC-ASSIGNED-DEPT-NBR         08050004
080600                     PERFORM 9200-REWRITE-SEL-QUEUE               08060004
080700                 END-IF                                           08070004
080800             END-IF                                               08080004
080900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08090004
081000                                                                  08100004
081100         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  08110004
081200             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              08120004
081300                 INITIALIZE ET345-NUMBER-OF-TS-ITEMS              08130004
081400                            ET345-SEL-QUEUE-NAME                  08140004
081500                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                08150004
081600                                TO ET345-NUMBER-OF-SELECTED-ITEMS 08160004
081700                 PERFORM 5000-PREPARE-SEL-QUEUE                   08170004
081800             ELSE                                                 08180004
081900                 SET DP030-OVERRIDE-GO                            08190004
082000                                   TO TRUE                        08200004
082100*                ---- A LIST ITEM MUST BE SELECTED ----           08210004
082200                 MOVE PC-TSYMSG-00057                             08220004
082300                                   TO DP020-MSG-NUMBER            08230004
082400                 SET DP020-MSG-WARNING                            08240004
082500                                   TO TRUE                        08250004
082600                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08260004
082700             END-IF                                               08270004
082800                                                                  08280004
082900         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  08290004
083000             MOVE +1               TO PV-TOP-ITEM                 08300004
083100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08310004
083200                                                                  08320004
083300         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   08330004
083400             PERFORM 2110-BROWSE-BACKWARD                         08340004
083500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08350004
083600                                                                  08360004
083700         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   08370004
083800             PERFORM 2120-BROWSE-FORWARD                          08380004
083900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08390004
084000                                                                  08400004
084100         WHEN DP020-SRC-AID = DP016-ENTER                         08410004
084200             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   08420004
084300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08430004
084400                                                                  08440004
084500         WHEN OTHER                                               08450004
084600             SET DP013-NO-ROLLBACK                                08460004
084700                 DP013-XCTL-DISPLAY-RESTART                       08470004
084800                 DP013-CICS-ABEND  TO TRUE                        08480004
084900             MOVE '2100-CHECK-FUNCTION-KEY'                       08490004
085000                                   TO DP013-PARAGRAPH             08500004
085100             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      08510004
085200                                   TO DP013-MESSAGE-TEXT (1)      08520004
085300             PERFORM DP013-0000-PROCESS-ABEND                     08530004
085400     END-EVALUATE.                                                08540004
085500                                                                  08550004
085600                                                                  08560004
085700*-----------------------------------------------------------------08570004
085800*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP      08580004
085900*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,       08590004
086000*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST    08600004
086100*    MESSAGE.                                                     08610004
086200*-----------------------------------------------------------------08620004
086300                                                                  08630004
086400 2110-BROWSE-BACKWARD.                                            08640004
086500                                                                  08650004
086600     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    08660004
086700         GIVING PV-TOP-ITEM.                                      08670004
086800                                                                  08680004
086900     IF  ((PV-TOP-ITEM < +1)                                      08690004
087000       OR (PV-TOP-ITEM = +1))                                     08700004
087100         MOVE +1                   TO PV-TOP-ITEM                 08710004
087200*        -- TOP OF LIST --                                        08720004
087300         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            08730004
087400         SET DP020-MSG-INFORMATIONAL TO TRUE                      08740004
087500     END-IF.                                                      08750004
087600                                                                  08760004
087700                                                                  08770004
087800*-----------------------------------------------------------------08780004
087900*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP       08790004
088000*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO    08800004
088100*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.              08810004
088200*-----------------------------------------------------------------08820004
088300                                                                  08830004
088400 2120-BROWSE-FORWARD.                                             08840004
088500                                                                  08850004
088600     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              08860004
088700         GIVING PV-TOP-ITEM.                                      08870004
088800     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   08880004
088900         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08890004
089000                                   TO PV-TOP-ITEM                 08900004
089100*        -- BOTTOM OF LIST --                                     08910004
089200         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            08920004
089300         SET DP020-MSG-INFORMATIONAL                              08930004
089400                                   TO TRUE                        08940004
089500     ELSE                                                         08950004
089600         COMPUTE PV-BOTTOM-ITEM =                                 08960004
089700             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 08970004
089800         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            08980004
089900*            -- BOTTOM OF LIST --                                 08990004
090000             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            09000004
090100             SET DP020-MSG-INFORMATIONAL                          09010004
090200                                   TO TRUE                        09020004
090300         END-IF                                                   09030004
090400     END-IF.                                                      09040004
090500                                                                  09050004
090600                                                                  09060004
090700*-----------------------------------------------------------------09070004
090800*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO     09080004
090900*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.    09090004
091000*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST   09100004
091100*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.          09110004
091200*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT      09120004
091300*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.           09130004
091400*-----------------------------------------------------------------09140004
091500                                                                  09150004
091600 2130-CHECK-FOR-JUMP-BROWSE.                                      09160004
091700                                                                  09170004
091800     IF (ASC-START-ITEM-REQUEST = SPACE)                          09180004
091900         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            09190004
092000                                   TO PV-TOP-ITEM                 09200004
092100     ELSE                                                         09210004
092200         MOVE ASC-START-ITEM-REQUEST  TO DP010I-UNEDITED-FIELD    09220004
092300         MOVE PC-ITEM-NUMBER-LENGTH   TO DP010I-MAXIMUM-DIGITS    09230004
092400         MOVE +0                      TO DP010I-MAXIMUM-DECIMALS  09240004
092500         SET DP010I-NEGATIVE-NOT-ALLOWED                          09250004
092600                                   TO TRUE                        09260004
092710         CALL DP010I-NUMERIC-EDIT-ROUTINE                         09271005
092720                         USING DP010I-NUMERIC-EDIT-AREA           09272005
092800                                                                  09280004
092900         IF  NOT DP010I-ERROR-DETECTED                            09290004
093000             MOVE DP010I-NUMERIC-FIELD                            09300004
093100                                   TO  ASC-START-ITEM-REQUEST-N   09310004
093200             IF  ASC-START-ITEM-REQUEST-N > ZERO                  09320004
093300                 IF  ASC-START-ITEM-REQUEST-N >                   09330004
093400                                          ASC-NUMBER-OF-ITEMS-READ09340004
093500                     MOVE SPACE TO ASC-START-ITEM-REQUEST         09350004
093600                     COMPUTE PV-TOP-ITEM =                        09360004
093700                             ASC-NUMBER-OF-ITEMS-READ             09370004
093800                             - PC-ITEMS-PER-PANEL + 1             09380004
093900                     IF  PV-TOP-ITEM < +1                         09390004
094000                         MOVE +1   TO PV-TOP-ITEM                 09400004
094100*                        ---- BOTTOM OF LIST ----                 09410004
094200                         MOVE PC-TSYMSG-00070                     09420004
094300                                   TO DP020-MSG-NUMBER            09430004
094400                         SET DP020-MSG-INFORMATIONAL              09440004
094500                                   TO TRUE                        09450004
094600                     END-IF                                       09460004
094700                 ELSE                                             09470004
094800                     MOVE ASC-START-ITEM-REQUEST-N                09480004
094900                                   TO PV-TOP-ITEM                 09490004
095000                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      09500004
095100                     COMPUTE PV-BOTTOM-ITEM =                     09510004
095200                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     09520004
095300                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ09530004
095400*                        -- BOTTOM OF LIST --                     09540004
095500                         MOVE PC-TSYMSG-00070                     09550004
095600                                   TO DP020-MSG-NUMBER            09560004
095700                         SET DP020-MSG-INFORMATIONAL              09570004
095800                                   TO TRUE                        09580004
095900                     END-IF                                       09590004
096000                 END-IF                                           09600004
096100             ELSE                                                 09610004
096200*                --- VALUE OUT OF RANGE ----                      09620004
096300                 MOVE PC-TSYMSG-00101     TO DP020-MSG-NUMBER     09630004
096400                 MOVE -1                  TO ASTRTITL             09640004
096500                 SET DP030-SET-CURSOR-APPL-1                      09650004
096600                                          TO TRUE                 09660004
096700                 MOVE DP015-REVERSE       TO ASTRTITH             09670004
096800                 MOVE DP015-RED           TO ASTRTITC             09680004
096900                 MOVE DP015-UNP-NUM-BRT-OFF                       09690004
097000                                          TO ASTRTITA             09700004
097100                 SET DP020-MSG-FATAL      TO TRUE                 09710004
097200                 SET PS-START-ITEM-ERROR TO TRUE                  09720004
097300             END-IF                                               09730004
097400                                                                  09740004
097500         ELSE                                                     09750004
097600*            ---- MUST BE NUMERIC ----                            09760004
097700             MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER      09770004
097800             MOVE -1                     TO ASTRTITL              09780004
097900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  09790004
098000             MOVE DP015-REVERSE          TO ASTRTITH              09800004
098100             MOVE DP015-RED              TO ASTRTITC              09810004
098200             MOVE DP015-UNP-NUM-BRT-OFF  TO ASTRTITA              09820004
098300             SET DP020-MSG-FATAL         TO TRUE                  09830004
098400             SET PS-START-ITEM-ERROR     TO TRUE                  09840004
098500         END-IF                                                   09850004
098600     END-IF.                                                      09860004
098700                                                                  09870004
098800                                                                  09880004
098900*----------------------------------------------------------------*09890004
099000* GET THE NEXT DOCUMENT IF A LIST OF DOCMENTS IS BEING PROCESSED. 09900004
099100*----------------------------------------------------------------*09910004
099200                                                                  09920004
099300 2133-GET-NEXT-SEL-QUEUE-ITEM.                                    09930004
099400                                                                  09940004
099500     ADD +1                       TO ASC-SEL-SUB.                 09950004
099600     IF  ASC-SEL-SUB > ET346-MAX-ITEMS                            09960004
099700         ADD +1                   TO ASC-SEL-ITEM                 09970004
099800         MOVE +1                  TO ASC-SEL-SUB                  09980004
099900     END-IF.                                                      09990004
100000     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                10000004
100100         PERFORM 9100-READ-SEL-QUEUE                              10010004
100200         IF  ET346-ITEM (ASC-SEL-SUB) > ZERO                      10020004
100300             MOVE ET346-TP-DKEY      (ASC-SEL-SUB)                10030004
100400                                     TO ASC-TP-DKEY               10040004
100500             MOVE ET346-TP-DKEY-TMST (ASC-SEL-SUB)                10050004
100600                                     TO ASC-TP-DKEY-TMST          10060004
100700             MOVE ET346-TRN-SET-CDE  (ASC-SEL-SUB)                10070004
100800                                     TO ASC-TRN-SET-CDE           10080004
100900             MOVE ET346-VENDOR-NAME  (ASC-SEL-SUB)                10090004
101000                                     TO ASC-VENDOR-NAME           10100004
101100             MOVE ET346-PO-NBR       (ASC-SEL-SUB)                10110004
101200                                     TO ASC-PO-NBR                10120004
101300             MOVE ET346-DEPT-NBR     (ASC-SEL-SUB)                10130004
101400                                     TO ASC-ASSIGNED-DEPT-NBR     10140004
101500             IF ET346-ACTION-SW (ASC-SEL-SUB) = SPACE             10150004
101600                 SET ET346-INQ  (ASC-SEL-SUB) TO TRUE             10160004
101700                 PERFORM 9200-REWRITE-SEL-QUEUE                   10170004
101800             END-IF                                               10180004
101900         ELSE                                                     10190004
102000             SUBTRACT +1 FROM ASC-SEL-SUB                         10200004
102100*            ---- BOTTOM OF LIST ----                             10210004
102200             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             10220004
102300             SET DP020-MSG-INFORMATIONAL TO TRUE                  10230004
102400             SET PS-LIST-END             TO TRUE                  10240004
102500         END-IF                                                   10250004
102600     ELSE                                                         10260004
102700         SUBTRACT +1 FROM ASC-SEL-ITEM                            10270004
102800         MOVE ET346-MAX-ITEMS     TO ASC-SEL-SUB                  10280004
102900*        ---- BOTTOM OF LIST ----                                 10290004
103000         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             10300004
103100         SET DP020-MSG-INFORMATIONAL TO TRUE                      10310004
103200         SET PS-LIST-END             TO TRUE                      10320004
103300     END-IF.                                                      10330004
103400                                                                  10340004
103500                                                                  10350004
103600*-----------------------------------------------------------------10360004
103700* GET THE PREVIOUS DOCUMENT IF A LIST OF DOCUMENTS IS BEING       10370004
103800* PROCESSED.                                                      10380004
103900*-----------------------------------------------------------------10390004
104000                                                                  10400004
104100 2137-GET-PREV-SEL-QUEUE-ITEM.                                    10410004
104200                                                                  10420004
104300     SUBTRACT +1 FROM ASC-SEL-SUB.                                10430004
104400     IF  ASC-SEL-SUB < +1                                         10440004
104500         SUBTRACT +1 FROM ASC-SEL-ITEM                            10450004
104600         MOVE ET346-MAX-ITEMS     TO ASC-SEL-SUB                  10460004
104700     END-IF.                                                      10470004
104800                                                                  10480004
104900     IF  ASC-SEL-ITEM > ZERO                                      10490004
105000*        *--------------------------------------------------------10500004
105100*        * MOVE DATA FROM THE SELECTION QUEUE INTO THE            10510004
105200*        * DCLGENS. (THE SELECTION QUEUE IS NOT USED WHEN THE     10520004
105300*        * PROGRAM IS ENTERED FROM THE EDI MENU OR THE            10530004
105400*        * CRITERIA SPEC. IN THOSE CASES, THIS DATA IS FETCHED    10540004
105500*        * FROM THE DB2 TABLES INTO THE DCLGENS.)                 10550004
105600*        *--------------------------------------------------------10560004
105700         PERFORM 9100-READ-SEL-QUEUE                              10570004
105800         MOVE ET346-TP-DKEY      (ASC-SEL-SUB)                    10580004
105900                                     TO ASC-TP-DKEY               10590004
106000         MOVE ET346-TP-DKEY-TMST (ASC-SEL-SUB)                    10600004
106100                                     TO ASC-TP-DKEY-TMST          10610004
106200         MOVE ET346-TRN-SET-CDE  (ASC-SEL-SUB)                    10620004
106300                                     TO ASC-TRN-SET-CDE           10630004
106400         MOVE ET346-VENDOR-NAME  (ASC-SEL-SUB)                    10640004
106500                                     TO ASC-VENDOR-NAME           10650004
106600         MOVE ET346-PO-NBR       (ASC-SEL-SUB)                    10660004
106700                                     TO ASC-PO-NBR                10670004
106800         MOVE ET346-DEPT-NBR     (ASC-SEL-SUB)                    10680004
106900                                     TO ASC-ASSIGNED-DEPT-NBR     10690004
107000     ELSE                                                         10700004
107100         MOVE +1                  TO ASC-SEL-ITEM                 10710004
107200                                     ASC-SEL-SUB                  10720004
107300         SET PS-LIST-END             TO TRUE                      10730004
107400     END-IF.                                                      10740004
107500                                                                  10750004
107600                                                                  10760004
107700*-----------------------------------------------------------------10770004
107800*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION       10780004
107900*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.          10790004
108000*-----------------------------------------------------------------10800004
108100                                                                  10810004
108200 2140-DESELECT-ALL-ITEMS.                                         10820004
108300                                                                  10830004
108400     MOVE +1                       TO ASC-BLK-SUB.                10840004
108500                                                                  10850004
108600     PERFORM 2141-CLEAR-SELECTED-INDS                             10860004
108700         VARYING ASC-ITEM-SUB                                     10870004
108800         FROM 1 BY 1                                              10880004
108900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10890004
109000                                                                  10900004
109100     ADD +1                        TO ASC-BLK-SUB.                10910004
109200                                                                  10920004
109300     PERFORM 2141-CLEAR-SELECTED-INDS                             10930004
109400         VARYING ASC-ITEM-SUB                                     10940004
109500         FROM 1 BY 1                                              10950004
109600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10960004
109700                                                                  10970004
109800     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               10980004
109900                                   TO PV-LIST-ITEM-NUMBER.        10990004
110000                                                                  11000004
110100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            11010004
110200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    11020004
110300                                                                  11030004
110400     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     11040004
110500        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      11050004
110600         MOVE +1                   TO ASC-BLK-SUB                 11060004
110700                                                                  11070004
110800         PERFORM 5100-WRITE-TEMP-STORAGE                          11080004
110900                                                                  11090004
111000         MOVE +1                   TO PV-BLOCK-NUMBER             11100004
111100                                                                  11110004
111200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         11120004
111300             PV-FIRST-BLOCK-IN-ARRAY - 1                          11130004
111400                                                                  11140004
111500         PERFORM                                                  11150004
111600             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       11160004
111700                                                                  11170004
111800             PERFORM 4410-READ-TEMP-STORAGE                       11180004
111900                                                                  11190004
112000             PERFORM 2141-CLEAR-SELECTED-INDS                     11200004
112100                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 11210004
112200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11220004
112300                                                                  11230004
112400             PERFORM 5100-WRITE-TEMP-STORAGE                      11240004
112500                                                                  11250004
112600             ADD +1                TO PV-BLOCK-NUMBER             11260004
112700                                                                  11270004
112800         END-PERFORM                                              11280004
112900                                                                  11290004
113000         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         11300004
113100             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     11310004
113200                                                                  11320004
113300         PERFORM                                                  11330004
113400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       11340004
113500                   ASC-HIGHEST-BLOCK-WRITTEN                      11350004
113600                                                                  11360004
113700             MOVE PV-NEXT-BLOCK-IN-ARRAY                          11370004
113800                                   TO PV-BLOCK-NUMBER             11380004
113900                                                                  11390004
114000             PERFORM 4410-READ-TEMP-STORAGE                       11400004
114100                                                                  11410004
114200             PERFORM 2141-CLEAR-SELECTED-INDS                     11420004
114300                 VARYING ASC-ITEM-SUB                             11430004
114400                 FROM 1 BY 1                                      11440004
114500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11450004
114600                                                                  11460004
114700             PERFORM 5100-WRITE-TEMP-STORAGE                      11470004
114800                                                                  11480004
114900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      11490004
115000                                                                  11500004
115100         END-PERFORM                                              11510004
115200                                                                  11520004
115300         MOVE PV-FIRST-BLOCK-IN-ARRAY                             11530004
115400                                   TO PV-BLOCK-NUMBER             11540004
115500                                                                  11550004
115600         PERFORM 4410-READ-TEMP-STORAGE                           11560004
115700     END-IF.                                                      11570004
115800                                                                  11580004
115900                                                                  11590004
116000     MOVE +0        TO ASC-NUMBER-OF-SELECTED-ITEMS               11600004
116100                       ASC-START-OF-SELECTED-RANGE                11610004
116200                       ASC-END-OF-SELECTED-RANGE.                 11620004
116300                                                                  11630004
116400                                                                  11640004
116500*-----------------------------------------------------------------11650004
116600*    MARK EACH ITEM AS BEING NOT SELECTED.                        11660004
116700*-----------------------------------------------------------------11670004
116800                                                                  11680004
116900 2141-CLEAR-SELECTED-INDS.                                        11690004
117000                                                                  11700004
117100     IF ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)            11710004
117200             NOT EQUAL ZERO                                       11720004
117300         SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)              11730004
117400             ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        11740004
117500             ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      11750004
117600                               TO TRUE                            11760004
117700     END-IF.                                                      11770004
117800                                                                  11780004
117900                                                                  11790004
118000*-----------------------------------------------------------------11800004
118100*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH   11810004
118200*  FOR ALL ITEMS.                                                 11820004
118300*-----------------------------------------------------------------11830004
118400                                                                  11840004
118500 2150-SELECT-ALL-ITEMS.                                           11850004
118600                                                                  11860004
118700     MOVE ZERO  TO  ASC-NUMBER-OF-SELECTED-ITEMS.                 11870004
118800     MOVE +1    TO  ASC-BLK-SUB.                                  11880004
118900                                                                  11890004
119000     PERFORM 2151-SET-SELECTED-INDS                               11900004
119100         VARYING ASC-ITEM-SUB                                     11910004
119200         FROM 1 BY 1                                              11920004
119300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11930004
119400                                                                  11940004
119500     ADD +1                        TO ASC-BLK-SUB.                11950004
119600                                                                  11960004
119700     PERFORM 2151-SET-SELECTED-INDS                               11970004
119800         VARYING ASC-ITEM-SUB                                     11980004
119900         FROM 1 BY 1                                              11990004
120000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12000004
120100                                                                  12010004
120200     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               12020004
120300                                   TO PV-LIST-ITEM-NUMBER.        12030004
120400                                                                  12040004
120500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            12050004
120600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    12060004
120700                                                                  12070004
120800     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     12080004
120900        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    12090004
121000         MOVE +1                   TO ASC-BLK-SUB                 12100004
121100                                                                  12110004
121200         PERFORM 5100-WRITE-TEMP-STORAGE                          12120004
121300                                                                  12130004
121400         MOVE +1                   TO PV-BLOCK-NUMBER             12140004
121500                                                                  12150004
121600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         12160004
121700             PV-FIRST-BLOCK-IN-ARRAY - 1                          12170004
121800                                                                  12180004
121900         PERFORM                                                  12190004
122000             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       12200004
122100                                                                  12210004
122200             PERFORM 4410-READ-TEMP-STORAGE                       12220004
122300                                                                  12230004
122400             PERFORM 2151-SET-SELECTED-INDS                       12240004
122500                 VARYING ASC-ITEM-SUB                             12250004
122600                 FROM 1 BY 1                                      12260004
122700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12270004
122800                                                                  12280004
122900             PERFORM 5100-WRITE-TEMP-STORAGE                      12290004
123000                                                                  12300004
123100             ADD +1                TO PV-BLOCK-NUMBER             12310004
123200                                                                  12320004
123300         END-PERFORM                                              12330004
123400                                                                  12340004
123500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         12350004
123600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     12360004
123700                                                                  12370004
123800         PERFORM                                                  12380004
123900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       12390004
124000                   ASC-HIGHEST-BLOCK-WRITTEN                      12400004
124100                                                                  12410004
124200             MOVE PV-NEXT-BLOCK-IN-ARRAY                          12420004
124300                                   TO PV-BLOCK-NUMBER             12430004
124400                                                                  12440004
124500             PERFORM 4410-READ-TEMP-STORAGE                       12450004
124600                                                                  12460004
124700             PERFORM 2151-SET-SELECTED-INDS                       12470004
124800                 VARYING ASC-ITEM-SUB                             12480004
124900                 FROM 1 BY 1                                      12490004
125000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12500004
125100                                                                  12510004
125200             PERFORM 5100-WRITE-TEMP-STORAGE                      12520004
125300                                                                  12530004
125400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      12540004
125500                                                                  12550004
125600         END-PERFORM                                              12560004
125700                                                                  12570004
125800         MOVE PV-FIRST-BLOCK-IN-ARRAY                             12580004
125900                                   TO PV-BLOCK-NUMBER             12590004
126000                                                                  12600004
126100         PERFORM 4410-READ-TEMP-STORAGE                           12610004
126200     END-IF.                                                      12620004
126300                                                                  12630004
126400     MOVE +0        TO ASC-START-OF-SELECTED-RANGE                12640004
126500                       ASC-END-OF-SELECTED-RANGE.                 12650004
126600                                                                  12660004
126700                                                                  12670004
126800*-----------------------------------------------------------------12680004
126900*    MARK EACH ITEM AS BEING SELECTED.                            12690004
127000*-----------------------------------------------------------------12700004
127100                                                                  12710004
127200 2151-SET-SELECTED-INDS.                                          12720004
127300                                                                  12730004
127400     IF ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) NOT = ZERO 12740004
127500         ADD +1  TO  ASC-NUMBER-OF-SELECTED-ITEMS                 12750004
127600         SET ASC-SELECT         (ASC-BLK-SUB ASC-ITEM-SUB)        12760004
127700             ASC-TEMP-SELECT    (ASC-BLK-SUB ASC-ITEM-SUB)        12770004
127800             ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     12780004
127900                                   TO  TRUE                       12790004
128000     END-IF.                                                      12800004
128100                                                                  12810004
128200                                                                  12820004
128300*-----------------------------------------------------------------12830004
128400* MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE       12840004
128500* SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.    12850004
128600*-----------------------------------------------------------------12860004
128700                                                                  12870004
128800 2200-MOVE-SCREEN-TO-COMMAREA.                                    12880004
128900                                                                  12890004
129000     IF ASC-TRN-SET-CDE = PC-TRN-SET-CDE-POA                      12900004
129100         IF  AH3DATAL > ZERO                                      12910004
129200             MOVE AH3DATAI       TO ASC-NEW-ASSIGNED-DEPT-NBR     12920004
129300         ELSE                                                     12930004
129400             IF  AH3DATAF = DP015-ERASE-EOF                       12940004
129500                 MOVE SPACE      TO ASC-NEW-ASSIGNED-DEPT-NBR     12950004
129600             END-IF                                               12960004
129700         END-IF                                                   12970004
129800     ELSE                                                         12980004
129900         IF  AH4DATAL > ZERO                                      12990004
130000             MOVE AH4DATAI       TO ASC-NEW-ASSIGNED-DEPT-NBR     13000004
130100         ELSE                                                     13010004
130200             IF  AH4DATAF = DP015-ERASE-EOF                       13020004
130300                 MOVE SPACE      TO ASC-NEW-ASSIGNED-DEPT-NBR     13030004
130400             END-IF                                               13040004
130500         END-IF                                                   13050004
130600     END-IF.                                                      13060004
130700                                                                  13070004
130800     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             13080004
130900     MOVE +1                       TO PV-SUB.                     13090004
131000                                                                  13100004
131100     PERFORM 3100-SET-SUBSCRIPTS.                                 13110004
131200     IF  ASTRTITL > ZERO                                          13120004
131300         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          13130004
131400     ELSE                                                         13140004
131500         IF ASTRTITF = DP015-ERASE-EOF                            13150004
131600             MOVE SPACE TO ASC-START-ITEM-REQUEST                 13160004
131700         END-IF.                                                  13170004
131800                                                                  13180004
131900     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          13190004
132000         VARYING PV-SUB                                           13200004
132100         FROM 1 BY 1                                              13210004
132200         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      13220004
132300                                                                  13230004
132400                                                                  13240004
132500*-----------------------------------------------------------------13250004
132600* MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA.  13260004
132700*-----------------------------------------------------------------13270004
132800                                                                  13280004
132900 2210-MOVE-LINES-TO-COMMAREA.                                     13290004
133000                                                                  13300004
133100     IF  MR-SELECTL (PV-SUB) > ZERO                               13310004
133200         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             13320004
133300         MOVE MR-SELECT (PV-SUB)                                  13330004
133400                                   TO ASC-TEMP-SELECTED-SW        13340004
133500                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      13350004
133600     ELSE                                                         13360004
133700         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                13370004
133800                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     13380004
133900                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        13390004
134000                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      13400004
134100         END-IF                                                   13410004
134200     END-IF.                                                      13420004
134300     ADD +1                        TO ASC-ITEM-SUB.               13430004
134400     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        13440004
134500         ADD +1                    TO ASC-BLK-SUB                 13450004
134600         MOVE +1                   TO ASC-ITEM-SUB                13460004
134700     END-IF.                                                      13470004
134800                                                                  13480004
134900                                                                  13490004
135000*-----------------------------------------------------------------13500004
135100* EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE         13510004
135200* COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).    13520004
135300*-----------------------------------------------------------------13530004
135400                                                                  13540004
135500 3000-EDIT-DATA-IN-COMMAREA.                                      13550004
135600                                                                  13560004
135700     SET PS-NO-ERROR                                              13570004
135800         PS-NO-UPDATE-REQUESTED    TO TRUE.                       13580004
135900     PERFORM 3200-RESET-ATTRIBUTES.                               13590004
136000     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     13600004
136100                                                                  13610004
136200* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              13620004
136300* EDITTING IS DONE FROM THE BOTTOM UP.                            13630004
136400*                                                                 13640004
136500     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       13650004
136600         ASC-ITEMS-DISPLAYED - 1.                                 13660004
136700     PERFORM 3100-SET-SUBSCRIPTS.                                 13670004
136800     PERFORM 3300-EDIT-SELECTIONS                                 13680004
136900         VARYING PV-SUB                                           13690004
137000         FROM PV-SUB BY -1                                        13700004
137100         UNTIL PV-SUB < +1                                        13710004
137200                                                                  13720004
137300     IF  PS-NO-ERROR                                              13730004
137400         PERFORM 3400-CHECK-RANGE-SEQUENCE                        13740004
137500     END-IF.                                                      13750004
137600                                                                  13760004
137700     IF  ((PS-NO-ERROR)                                           13770004
137800       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   13780004
137900       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    13790004
138000             PERFORM 3500-MARK-RANGE-AS-SELECTED                  13800004
138100     END-IF.                                                      13810004
138200                                                                  13820004
138300*    *------------------------------------------------------------13830004
138400*    * EDIT THE DEPARTMENT NUMBER.  IT MUST BE A VALID DEPARTMENT 13840004
138500*    * FOR THIS VENDOR ON THE TVNDDPT TABLE.                      13850004
138600*    *------------------------------------------------------------13860004
138700                                                                  13870004
138800     IF ASC-NEW-ASSIGNED-DEPT-NBR = SPACE                         13880004
138900         IF ASC-ASSIGNED-DEPT-NBR = SPACE                         13890004
139000             CONTINUE                                             13900004
139100         ELSE                                                     13910004
139200             SET  PS-ERROR                                        13920004
139300                  DP030-SET-CURSOR-APPL-1                         13930004
139400                  DP020-MSG-FATAL          TO TRUE                13940004
139500*            ---- REQUIRED ENTRY ----                             13950004
139600             MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER      13960004
139700             IF ASC-TRN-SET-CDE = PC-TRN-SET-CDE-POA              13970004
139800                 MOVE DP015-UNP-NUM-BRT-OFF    TO AH3DATAA        13980004
139900                 MOVE DP015-RED                TO AH3DATAC        13990004
140000                 MOVE DP015-REVERSE            TO AH3DATAH        14000004
140100                 MOVE -1                       TO AH3DATAL        14010004
140200             ELSE                                                 14020004
140300                 MOVE DP015-UNP-NUM-BRT-OFF    TO AH4DATAA        14030004
140400                 MOVE DP015-RED                TO AH4DATAC        14040004
140500                 MOVE DP015-REVERSE            TO AH4DATAH        14050004
140600                 MOVE -1                       TO AH4DATAL        14060004
140700             END-IF                                               14070004
140800         END-IF                                                   14080004
140900     ELSE                                                         14090004
141000         MOVE ASC-NEW-ASSIGNED-DEPT-NBR TO DP010I-UNEDITED-FIELD  14100004
141100         MOVE LENGTH OF ASC-ASSIGNED-DEPT-NBR                     14110004
141200                                    TO DP010I-MAXIMUM-DIGITS      14120004
141300         MOVE ZERO                  TO DP010I-MAXIMUM-DECIMALS    14130004
141400         SET  DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                 14140004
141510         CALL DP010I-NUMERIC-EDIT-ROUTINE                         14151005
141520                         USING DP010I-NUMERIC-EDIT-AREA           14152005
141600                                                                  14160004
141700         IF DP010I-ERROR-DETECTED                                 14170004
141800             SET  PS-ERROR                                        14180004
141900                  DP030-SET-CURSOR-APPL-1                         14190004
142000                  DP020-MSG-FATAL         TO TRUE                 14200004
142100*            ---- INVALID VALUE  ----                             14210004
142200             MOVE PC-TSYMSG-00005        TO DP020-MSG-NUMBER      14220004
142300             IF ASC-TRN-SET-CDE = PC-TRN-SET-CDE-POA              14230004
142400                 MOVE DP015-UNP-NUM-BRT-OFF    TO AH3DATAA        14240004
142500                 MOVE DP015-RED                TO AH3DATAC        14250004
142600                 MOVE DP015-REVERSE            TO AH3DATAH        14260004
142700                 MOVE -1                       TO AH3DATAL        14270004
142800             ELSE                                                 14280004
142900                 MOVE DP015-UNP-NUM-BRT-OFF    TO AH4DATAA        14290004
143000                 MOVE DP015-RED                TO AH4DATAC        14300004
143100                 MOVE DP015-REVERSE            TO AH4DATAH        14310004
143200                 MOVE -1                       TO AH4DATAL        14320004
143300             END-IF                                               14330004
143400         ELSE                                                     14340004
143500             MOVE DP010I-NUMERIC-FIELD                            14350004
143600                                      TO PV-DB2-DEPT-NBR-N        14360004
143700             MOVE PV-DB2-DEPT-NBR     TO ASC-NEW-ASSIGNED-DEPT-NBR14370004
143800             IF ASC-NEW-ASSIGNED-DEPT-NBR = ASC-ASSIGNED-DEPT-NBR 14380004
143900                 CONTINUE                                         14390004
144000             ELSE                                                 14400004
144100                 PERFORM Z840-GET-DEPT-FROM-TVNDDPT               14410004
144200                 EVALUATE TRUE                                    14420004
144300                     WHEN SQLCODE = ZERO                          14430004
144400                         SET PS-UPDATE-REQUESTED TO TRUE          14440004
144500                     WHEN PS-DATA-NOT-AVAILABLE                   14450004
144600                         SET  PS-ERROR                            14460004
144700                         DP020-MSG-WARNING TO TRUE                14470004
144800*                        ---- WAIT 15 SECONDS, THEN RETRY ----    14480004
144900                         MOVE PC-TSYMSG-00551 TO DP020-MSG-NUMBER 14490004
145000                     WHEN OTHER                                   14500004
145100                         SET  PS-ERROR                            14510004
145200                              DP030-SET-CURSOR-APPL-1             14520004
145300                              DP020-MSG-FATAL        TO TRUE      14530004
145400*                   ---- CHECK DEPT, REQUESTED VENDOR NOT ----    14540004
145500*                   ---- FOUND FOR SPECIFIED DEPT         ----    14550004
145600                         MOVE PC-TSYMSG-00489                     14560004
145700                                           TO DP020-MSG-NUMBER    14570004
145800                         IF ASC-TRN-SET-CDE =                     14580004
145900                                            PC-TRN-SET-CDE-POA    14590004
146000                             MOVE DP015-UNP-NUM-BRT-OFF           14600004
146100                                                   TO AH3DATAA    14610004
146200                             MOVE DP015-RED        TO AH3DATAC    14620004
146300                             MOVE DP015-REVERSE    TO AH3DATAH    14630004
146400                             MOVE -1               TO AH3DATAL    14640004
146500                         ELSE                                     14650004
146600                             MOVE DP015-UNP-NUM-BRT-OFF           14660004
146700                                                   TO AH4DATAA    14670004
146800                             MOVE DP015-RED        TO AH4DATAC    14680004
146900                             MOVE DP015-REVERSE    TO AH4DATAH    14690004
147000                             MOVE -1               TO AH4DATAL    14700004
147100                         END-IF                                   14710004
147200                 END-EVALUATE                                     14720004
147300             END-IF                                               14730004
147400         END-IF                                                   14740004
147500     END-IF.                                                      14750004
147600                                                                  14760004
147700     IF PS-NO-ERROR                                               14770004
147800         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      14780004
147900         IF ASC-TRN-SET-CDE = PC-TRN-SET-CDE-POA                  14790004
148000             MOVE -1                 TO AH3DATAL                  14800004
148100         ELSE                                                     14810004
148200             MOVE -1                 TO AH4DATAL                  14820004
148300         END-IF                                                   14830004
148400     END-IF.                                                      14840004
148500                                                                  14850004
148600                                                                  14860004
148700*-----------------------------------------------------------------14870004
148800*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM  14880004
148900*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL 14890004
149000*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                   14900004
149100*                                                                 14910004
149200*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS    14920004
149300*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT     14930004
149400*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION   14940004
149500*    US IN THE 2ND BLOCK OF THE ARRAY.                            14950004
149600*-----------------------------------------------------------------14960004
149700                                                                  14970004
149800 3100-SET-SUBSCRIPTS.                                             14980004
149900                                                                  14990004
150000     COMPUTE ASC-ITEM-SUB =                                       15000004
150100         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        15010004
150200                                                                  15020004
150300     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         15030004
150400         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            15040004
150500                                                                  15050004
150600         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               15060004
150700     ELSE                                                         15070004
150800         MOVE +1                     TO ASC-BLK-SUB               15080004
150900     END-IF.                                                      15090004
151000                                                                  15100004
151100                                                                  15110004
151200*-----------------------------------------------------------------15120004
151300* RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.        15130004
151400*-----------------------------------------------------------------15140004
151500                                                                  15150004
151600 3200-RESET-ATTRIBUTES.                                           15160004
151700                                                                  15170004
151800     PERFORM 3250-RESET-DEPT-NBR-ATTRIBUTES.                      15180004
151900                                                                  15190004
152000     MOVE DP015-UNP-NUM-NOR-OFF    TO ASTRTITA.                   15200004
152100     MOVE DP015-GREEN              TO ASTRTITC.                   15210004
152200     MOVE DP015-UNDERLINE          TO ASTRTITH.                   15220004
152300                                                                  15230004
152400     PERFORM                                                      15240004
152500         VARYING PV-SUB                                           15250004
152600         FROM 1 BY 1                                              15260004
152700         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        15270004
152800         MOVE DP015-UNP-ALP-NOR-OFF                               15280004
152900                                   TO MR-SELECTA (PV-SUB)         15290004
153000         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         15300004
153100         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         15310004
153200     END-PERFORM.                                                 15320004
153300                                                                  15330004
153400                                                                  15340004
153500*-----------------------------------------------------------------15350004
153600* RESET THE ATTRIBUTES OF THE DEPT-NBR FIELD ON THE MAP.  THE     15360004
153700* LOCATION OF THE DEPT-NBR FIELD WITHIN THE SCREEN VARIES,        15370004
153800* DEPENDING UPON WHETHER THE P.O. BEING DISPLAYED BELONGS TO      15380004
153900* A POA OR AN INVOICE.                                            15390004
154000*-----------------------------------------------------------------15400004
154100                                                                  15410004
154200 3250-RESET-DEPT-NBR-ATTRIBUTES.                                  15420004
154300                                                                  15430004
154400     IF ASC-TRN-SET-CDE = PC-TRN-SET-CDE-POA                      15440004
154500         MOVE DP015-UNP-NUM-NOR-OFF    TO AH3DATAA                15450004
154600         MOVE DP015-GREEN              TO AH3DATAC                15460004
154700         MOVE DP015-UNDERLINE          TO AH3DATAH                15470004
154800         MOVE DP015-PRO-NOR-OFF        TO AH4DATAA                15480004
154900         MOVE DP015-BLUE               TO AH4DATAC                15490004
155000         MOVE DP015-HL-OFF             TO AH4DATAH                15500004
155100     ELSE                                                         15510004
155200         MOVE DP015-PRO-NOR-OFF        TO AH3DATAA                15520004
155300         MOVE DP015-BLUE               TO AH3DATAC                15530004
155400         MOVE DP015-HL-OFF             TO AH3DATAH                15540004
155500         MOVE DP015-UNP-NUM-NOR-OFF    TO AH4DATAA                15550004
155600         MOVE DP015-GREEN              TO AH4DATAC                15560004
155700         MOVE DP015-UNDERLINE          TO AH4DATAH                15570004
155800     END-IF.                                                      15580004
155900                                                                  15590004
156000                                                                  15600004
156100*-----------------------------------------------------------------15610004
156200* EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS       15620004
156300* WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'      15630004
156400* IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR       15640004
156500* WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.                15650004
156600*-----------------------------------------------------------------15660004
156700                                                                  15670004
156800 3300-EDIT-SELECTIONS.                                            15680004
156900                                                                  15690004
157000     EVALUATE TRUE                                                15700004
157100         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     15710004
157200             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         15720004
157300                 CONTINUE                                         15730004
157400         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         15740004
157500             IF NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)         15750004
157600                 ADD +1 TO ASC-NUMBER-OF-SELECTED-ITEMS           15760004
157700                 IF ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)          15770004
157800                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    15780004
157900                 ELSE                                             15790004
158000                     IF ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)        15800004
158100                         MOVE ZERO                                15810004
158200                              TO ASC-END-OF-SELECTED-RANGE        15820004
158300                     END-IF                                       15830004
158400                 END-IF                                           15840004
158500                 MOVE ASC-TEMP-SELECTED-SW                        15850004
158600                                    (ASC-BLK-SUB ASC-ITEM-SUB)    15860004
158700                     TO ASC-SELECTED-SW                           15870004
158800                                    (ASC-BLK-SUB ASC-ITEM-SUB)    15880004
158900             END-IF                                               15890004
159000         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     15900004
159100                 = SPACE                                          15910004
159200             EVALUATE TRUE                                        15920004
159300                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       15930004
159400                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS15940004
159500                     MOVE SPACE TO ASC-SELECTED-SW                15950004
159600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15960004
159700                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        15970004
159800                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    15980004
159900                     MOVE SPACE TO ASC-SELECTED-SW                15990004
160000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16000004
160100                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          16010004
160200                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      16020004
160300                     MOVE SPACE TO ASC-SELECTED-SW                16030004
160400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16040004
160500             END-EVALUATE                                         16050004
160600         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           16060004
160700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            16070004
160800                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    16080004
160900             END-IF                                               16090004
161000             PERFORM 3310-EDIT-RANGE                              16100004
161100         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             16110004
161200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            16120004
161300                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    16130004
161400             END-IF                                               16140004
161500             PERFORM 3310-EDIT-RANGE                              16150004
161600         WHEN OTHER                                               16160004
161700*            ---- INVALID VALUE ----                              16170004
161800             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           16180004
161900             SET DP020-MSG-FATAL    TO TRUE                       16190004
162000             MOVE -1                TO MR-SELECTL (PV-SUB)        16200004
162100             SET DP030-SET-CURSOR-APPL-1                          16210004
162200                                    TO TRUE                       16220004
162300             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        16230004
162400             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        16240004
162500             SET PS-ERROR TO TRUE                                 16250004
162600             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            16260004
162700                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     16270004
162800                 MOVE SPACE         TO ASC-SELECTED-SW            16280004
162900                                        (ASC-BLK-SUB ASC-ITEM-SUB)16290004
163000             END-IF                                               16300004
163100     END-EVALUATE.                                                16310004
163200                                                                  16320004
163300     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 16330004
163400     SUBTRACT +1 FROM ASC-ITEM-SUB.                               16340004
163500     IF  ASC-ITEM-SUB < 1                                         16350004
163600         SUBTRACT +1 FROM ASC-BLK-SUB                             16360004
163700         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                16370004
163800     END-IF.                                                      16380004
163900                                                                  16390004
164000                                                                  16400004
164100*-----------------------------------------------------------------16410004
164200* IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A         16420004
164300* RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1       16430004
164400* ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)   16440004
164500* THE ENDING.                                                     16450004
164600*-----------------------------------------------------------------16460004
164700                                                                  16470004
164800 3310-EDIT-RANGE.                                                 16480004
164900                                                                  16490004
165000     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                16500004
165100         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   16510004
165200             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)16520004
165300                                   TO ASC-SELECTED-SW             16530004
165400                                        (ASC-BLK-SUB ASC-ITEM-SUB)16540004
165500             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 16550004
165600         ELSE                                                     16560004
165700             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     16570004
165800                 CONTINUE                                         16580004
165900             ELSE                                                 16590004
166000*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        16600004
166100                 MOVE PC-TSYMSG-00054                             16610004
166200                                   TO DP020-MSG-NUMBER            16620004
166300                 SET DP020-MSG-FATAL                              16630004
166400                                   TO TRUE                        16640004
166500                 MOVE -1           TO MR-SELECTL (PV-SUB)         16650004
166600                 SET DP030-SET-CURSOR-APPL-1                      16660004
166700                                   TO TRUE                        16670004
166800                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         16680004
166900                 MOVE DP015-UNDERLINE                             16690004
167000                                   TO MR-SELECTH (PV-SUB)         16700004
167100                 SET PS-ERROR      TO TRUE                        16710004
167200             END-IF                                               16720004
167300         END-IF                                                   16730004
167400     ELSE                                                         16740004
167500         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     16750004
167600             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 16760004
167700                                   TO ASC-SELECTED-SW             16770004
167800                                     (ASC-BLK-SUB ASC-ITEM-SUB)   16780004
167900             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   16790004
168000         ELSE                                                     16800004
168100             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       16810004
168200                 CONTINUE                                         16820004
168300             ELSE                                                 16830004
168400*                -- ONLY ONE END-OF-RANGE ALLOWED --              16840004
168500                 MOVE PC-TSYMSG-00055                             16850004
168600                                   TO DP020-MSG-NUMBER            16860004
168700                 SET DP020-MSG-FATAL                              16870004
168800                                   TO TRUE                        16880004
168900                 MOVE -1           TO MR-SELECTL (PV-SUB)         16890004
169000                 SET DP030-SET-CURSOR-APPL-1                      16900004
169100                                   TO TRUE                        16910004
169200                 SET PS-ERROR      TO TRUE                        16920004
169300             END-IF                                               16930004
169400         END-IF                                                   16940004
169500     END-IF.                                                      16950004
169600                                                                  16960004
169700                                                                  16970004
169800*-----------------------------------------------------------------16980004
169900* IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,       16990004
170000* MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.     17000004
170100*-----------------------------------------------------------------17010004
170200                                                                  17020004
170300 3400-CHECK-RANGE-SEQUENCE.                                       17030004
170400                                                                  17040004
170500     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       17050004
170600       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      17060004
170700       AND  ASC-START-OF-SELECTED-RANGE >                         17070004
170800                                         ASC-END-OF-SELECTED-RANGE17080004
170900*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                17090004
171000         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 17100004
171100         SET DP020-MSG-FATAL TO TRUE                              17110004
171200         SET PS-ERROR TO TRUE                                     17120004
171300         PERFORM 3410-POSITION-AT-ERROR                           17130004
171400     ELSE                                                         17140004
171500         MOVE -1 TO MR-SELECTL (1)                                17150004
171600     END-IF.                                                      17160004
171700     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       17170004
171800                                                                  17180004
171900                                                                  17190004
172000*-----------------------------------------------------------------17200004
172100* BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE       17210004
172200* PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR    17220004
172300* SHOULD BE POSITIONED ON A RANGE ERROR.                          17230004
172400*-----------------------------------------------------------------17240004
172500                                                                  17250004
172600 3410-POSITION-AT-ERROR.                                          17260004
172700                                                                  17270004
172800     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 17280004
172900                    - PV-TOP-ITEM + 1.                            17290004
173000     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      17300004
173100         CONTINUE                                                 17310004
173200     ELSE                                                         17320004
173300         MOVE -1                   TO MR-SELECTL (PV-SUB)         17330004
173400         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         17340004
173500         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         17350004
173600     END-IF.                                                      17360004
173700*                                                                 17370004
173800     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   17380004
173900                    - PV-TOP-ITEM + 1.                            17390004
174000     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      17400004
174100         CONTINUE                                                 17410004
174200     ELSE                                                         17420004
174300         MOVE -1                   TO MR-SELECTL (PV-SUB)         17430004
174400         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         17440004
174500         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         17450004
174600     END-IF.                                                      17460004
174700                                                                  17470004
174800                                                                  17480004
174900*-----------------------------------------------------------------17490004
175000*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE     17500004
175100*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS     17510004
175200*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.              17520004
175300*-----------------------------------------------------------------17530004
175400                                                                  17540004
175500 3500-MARK-RANGE-AS-SELECTED.                                     17550004
175600                                                                  17560004
175700     MOVE +1                       TO  ASC-BLK-SUB.               17570004
175800     PERFORM 3510-MARK-SELECTED-INDS                              17580004
175900         VARYING ASC-ITEM-SUB                                     17590004
176000         FROM 1 BY 1                                              17600004
176100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 17610004
176200                                                                  17620004
176300     ADD +1                        TO ASC-BLK-SUB.                17630004
176400     PERFORM 3510-MARK-SELECTED-INDS                              17640004
176500         VARYING ASC-ITEM-SUB                                     17650004
176600         FROM 1 BY 1                                              17660004
176700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 17670004
176800                                                                  17680004
176900     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               17690004
177000                                   TO  PV-LIST-ITEM-NUMBER.       17700004
177100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            17710004
177200         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         17720004
177300               PC-ITEMS-PER-PANEL).                               17730004
177400                                                                  17740004
177500     MOVE ASC-START-OF-SELECTED-RANGE                             17750004
177600                                   TO PV-START-OF-SELECTED-RANGE. 17760004
177700     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            17770004
177800         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  17780004
177900               PC-ITEMS-PER-PANEL).                               17790004
178000                                                                  17800004
178100     MOVE ASC-END-OF-SELECTED-RANGE                               17810004
178200                                   TO  PV-END-OF-SELECTED-RANGE.  17820004
178300     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             17830004
178400         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    17840004
178500               PC-ITEMS-PER-PANEL).                               17850004
178600     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             17860004
178700         PV-FIRST-BLOCK-IN-ARRAY + 1.                             17870004
178800                                                                  17880004
178900     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    17890004
179000        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        17900004
179100         MOVE +1                   TO ASC-BLK-SUB                 17910004
179200         PERFORM 5100-WRITE-TEMP-STORAGE                          17920004
179300         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         17930004
179400             PV-FIRST-BLOCK-IN-ARRAY - 1                          17940004
179500                                                                  17950004
179600         PERFORM                                                  17960004
179700             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      17970004
179800                   PV-PREV-BLOCK-IN-ARRAY                         17980004
179900             MOVE PV-FIRST-BLOCK-IN-RANGE                         17990004
180000                                   TO PV-BLOCK-NUMBER             18000004
180100             PERFORM 4410-READ-TEMP-STORAGE                       18010004
180200             PERFORM 3510-MARK-SELECTED-INDS                      18020004
180300                 VARYING ASC-ITEM-SUB                             18030004
180400                 FROM 1 BY 1                                      18040004
180500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          18050004
180600             PERFORM 5100-WRITE-TEMP-STORAGE                      18060004
180700             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     18070004
180800         END-PERFORM                                              18080004
180900                                                                  18090004
181000         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         18100004
181100             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     18110004
181200         PERFORM                                                  18120004
181300             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       18130004
181400                   PV-LAST-BLOCK-IN-RANGE                         18140004
181500             MOVE PV-NEXT-BLOCK-IN-ARRAY                          18150004
181600                                   TO PV-BLOCK-NUMBER             18160004
181700             PERFORM 4410-READ-TEMP-STORAGE                       18170004
181800             PERFORM 3510-MARK-SELECTED-INDS                      18180004
181900                 VARYING ASC-ITEM-SUB                             18190004
182000                 FROM 1 BY 1                                      18200004
182100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          18210004
182200             PERFORM 5100-WRITE-TEMP-STORAGE                      18220004
182300             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      18230004
182400         END-PERFORM                                              18240004
182500                                                                  18250004
182600         MOVE PV-FIRST-BLOCK-IN-ARRAY                             18260004
182700                                   TO PV-BLOCK-NUMBER             18270004
182800         PERFORM 4410-READ-TEMP-STORAGE                           18280004
182900     END-IF.                                                      18290004
183000                                                                  18300004
183100     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 18310004
183200                                      ASC-END-OF-SELECTED-RANGE.  18320004
183300                                                                  18330004
183400                                                                  18340004
183500*-----------------------------------------------------------------18350004
183600* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.            18360004
183700*-----------------------------------------------------------------18370004
183800                                                                  18380004
183900 3510-MARK-SELECTED-INDS.                                         18390004
184000                                                                  18400004
184100     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         18410004
184200                                ASC-ITEM-SUB) >                   18420004
184300         ASC-START-OF-SELECTED-RANGE)                             18430004
184400     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         18440004
184500                                ASC-ITEM-SUB) =                   18450004
184600         ASC-START-OF-SELECTED-RANGE)                             18460004
184700                                                                  18470004
184800         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     18480004
184900                                    ASC-ITEM-SUB) <               18490004
185000             ASC-END-OF-SELECTED-RANGE)                           18500004
185100         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     18510004
185200                                    ASC-ITEM-SUB) =               18520004
185300             ASC-END-OF-SELECTED-RANGE)                           18530004
185400                                                                  18540004
185500             IF NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)         18550004
185600                 SET ASC-SELECT    (ASC-BLK-SUB  ASC-ITEM-SUB)    18560004
185700                 ASC-TEMP-SELECT   (ASC-BLK-SUB  ASC-ITEM-SUB)    18570004
185800                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  18580004
185900                           TO TRUE                                18590004
186000                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    18600004
186100             END-IF                                               18610004
186200         END-IF                                                   18620004
186300     END-IF.                                                      18630004
186400                                                                  18640004
186500                                                                  18650004
186600*-----------------------------------------------------------------18660004
186700*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                         18670004
186800*    INITIALIZE ALL COUNTERS AND FLAGS.                           18680004
186900*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.   18690004
187000*    DISPLAY THE PANEL TO USER.                                   18700004
187100*-----------------------------------------------------------------18710004
187200                                                                  18720004
187300 4000-BUILD-INITIAL-PANEL.                                        18730004
187400                                                                  18740004
187500     INITIALIZE                   ASC-BLOCK-ENTRIES (1)           18750004
187600                                  ASC-BLOCK-ENTRIES (2)           18760004
187700                                  ASC-HEADER-INFO.                18770004
187800                                                                  18780004
187900                                                                  18790004
188000     MOVE +1                   TO ASC-BLK-SUB.                    18800004
188100     SET ASC-ITEMS-LEFT-ON-DB  TO TRUE.                           18810004
188200     SET PS-DATA-AVAILABLE     TO TRUE.                           18820004
188300                                                                  18830004
188400     MOVE +0                   TO ASC-ITEM-SUB                    18840004
188500                                  ASC-NUMBER-OF-ITEMS-READ        18850004
188600                                  ASC-NUMBER-OF-SELECTED-ITEMS    18860004
188700                                  ASC-HIGHEST-BLOCK-WRITTEN       18870004
188800                                  ASC-START-OF-SELECTED-RANGE     18880004
188900                                  ASC-END-OF-SELECTED-RANGE       18890004
189000                                  ASC-ITEM-AT-TOP-OF-PANEL.       18900004
189100                                                                  18910004
189200     MOVE ASC-ASSIGNED-DEPT-NBR TO ASC-NEW-ASSIGNED-DEPT-NBR.     18920004
189300                                                                  18930004
189400     PERFORM Z800-OPEN-CURSOR.                                    18940004
189500                                                                  18950004
189600     IF PS-DATA-NOT-AVAILABLE                                     18960004
189700         CONTINUE                                                 18970004
189800     ELSE                                                         18980004
189900         EVALUATE TRUE                                            18990004
190000             WHEN ASC-TRN-SET-CDE = PC-TRN-SET-CDE-POA            19000004
190100                 PERFORM 4310-POA-READ-ITEMS-FROM-DB              19010004
190200             WHEN ASC-TRN-SET-CDE = PC-TRN-SET-CDE-INV            19020004
190300                 PERFORM 4320-INV-READ-ITEMS-FROM-DB              19030004
190400             WHEN OTHER                                           19040004
190500                 CONTINUE                                         19050004
190600         END-EVALUATE                                             19060004
190700     END-IF.                                                      19070004
190800                                                                  19080004
190900     PERFORM 3200-RESET-ATTRIBUTES.                               19090004
191000                                                                  19100004
191100     IF PS-DATA-NOT-AVAILABLE                                     19110004
191200         SET DP020-MSG-WARNING  TO TRUE                           19120004
191300*        ---- WAIT 15 SECONDS, THEN RETRY ----                    19130004
191400         MOVE PC-TSYMSG-00551   TO  DP020-MSG-NUMBER              19140004
191500         IF DP020-FK-REFRESH        (DP020-SRC-AID)               19150004
191600         OR DP020-FK-PREV-SELECTION (DP020-SRC-AID)               19160004
191700         OR DP020-FK-NEXT-SELECTION (DP020-SRC-AID)               19170004
191800             CONTINUE                                             19180004
191900         ELSE                                                     19190004
192000             SET  DP020-NEXT-ACT-APPL-ERROR TO TRUE               19200004
192100         END-IF                                                   19210004
192200     ELSE                                                         19220004
192300         PERFORM Z820-CLOSE-CURSOR                                19230004
192400                                                                  19240004
192500         MOVE +1 TO  PV-TOP-ITEM                                  19250004
192600         IF ASC-TRN-SET-CDE = PC-TRN-SET-CDE-POA                  19260004
192700             MOVE -1                 TO AH3DATAL                  19270004
192800         ELSE                                                     19280004
192900             MOVE -1                 TO AH4DATAL                  19290004
193000         END-IF                                                   19300004
193100         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      19310004
193200         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     19320004
193300     END-IF.                                                      19330004
193400                                                                  19340004
193500                                                                  19350004
193600 4310-POA-READ-ITEMS-FROM-DB.                                     19360004
193700                                                                  19370004
193800     PERFORM                                                      19380004
193900         VARYING PV-READ-COUNT                                    19390004
194000         FROM 1 BY 1                                              19400004
194100         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    19410004
194200            OR (ASC-NO-ITEMS-LEFT-ON-DB)                          19420004
194300            OR (PS-DATA-NOT-AVAILABLE))                           19430004
194400                                                                  19440004
194500         PERFORM Z810-FETCH-CURSOR                                19450004
194600                                                                  19460004
194700         IF   PS-DATA-AVAILABLE                                   19470004
194800         AND  ASC-ITEMS-LEFT-ON-DB                                19480004
194900             MOVE FGTRDT-TRN-SET-DATA-TEXT TO PO002-EDI855-RECORD 19490004
195000             EVALUATE TRUE                                        19500004
195100                 WHEN PO002-HEADER-RECORD                         19510004
195200                     PERFORM 4313-POA-PROCESS-HEADER-RECORD       19520004
195300                 WHEN PO002-ITEM-RECORD                           19530004
195400                     PERFORM 4315-POA-CHECK-FOR-ERRORS            19540004
195500                     IF PS-POA-NO-ERRORS                          19550004
195600                         CONTINUE                                 19560004
195700                     ELSE                                         19570004
195800                         PERFORM 4317-POA-PROCESS-ITEM-RECORD     19580004
195900                     END-IF                                       19590004
196000                 WHEN OTHER                                       19600004
196100                     CONTINUE                                     19610004
196200             END-EVALUATE                                         19620004
196300         END-IF                                                   19630004
196400     END-PERFORM.                                                 19640004
196500                                                                  19650004
196600     IF PS-DATA-NOT-AVAILABLE                                     19660004
196700         CONTINUE                                                 19670004
196800     ELSE                                                         19680004
196900         IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                      19690004
197000             MOVE +1               TO ASC-BLK-SUB                 19700004
197100             PERFORM 5100-WRITE-TEMP-STORAGE                      19710004
197200             ADD +1                TO ASC-BLK-SUB                 19720004
197300             PERFORM 5100-WRITE-TEMP-STORAGE                      19730004
197400                                                                  19740004
197500             MOVE 1                TO ASC-BLK-SUB                 19750004
197600                                      PV-BLOCK-NUMBER             19760004
197700             PERFORM 4410-READ-TEMP-STORAGE                       19770004
197800             IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1         19780004
197900                 MOVE 2            TO ASC-BLK-SUB                 19790004
198000                                      PV-BLOCK-NUMBER             19800004
198100                 PERFORM 4410-READ-TEMP-STORAGE                   19810004
198200             END-IF                                               19820004
198300         END-IF                                                   19830004
198400     END-IF.                                                      19840004
198500                                                                  19850004
198600                                                                  19860004
198700 4313-POA-PROCESS-HEADER-RECORD.                                  19870004
198800                                                                  19880004
198900     IF PO002-NEW-PO-BAD                                          19890004
199000         MOVE PC-STATUS-NEW-PO        TO ASC-PO-STATUS            19900004
199100     ELSE                                                         19910004
199200         MOVE PC-STATUS-DUP           TO ASC-PO-STATUS            19920004
199300     END-IF.                                                      19930004
199400                                                                  19940004
199500     MOVE PO002-H-DEPT-NBR            TO ASC-DEPT-NBR.            19950004
199600                                                                  19960004
199700     IF PO002-ONE-DEPT                                            19970004
199800         CONTINUE                                                 19980004
199900     ELSE                                                         19990004
200000        IF PO002-MULTIPLE-DEPTS                                   20000004
200100            MOVE PC-STATUS-MULT-DEPT  TO ASC-DEPT-STATUS          20010004
200200        ELSE                                                      20020004
200300            MOVE PC-STATUS-NO-DEPT    TO ASC-DEPT-STATUS          20030004
200400        END-IF                                                    20040004
200500     END-IF.                                                      20050004
200600                                                                  20060004
200700                                                                  20070004
200800 4315-POA-CHECK-FOR-ERRORS.                                       20080004
200900                                                                  20090004
201000     IF PO002-I-SKU IS NUMERIC                                    20100004
201100        MOVE PO002-I-SKU TO PV-PO002-I-SKU                        20110004
201200        MOVE PV-PO002-I-SKU TO PV-SKXREF-SKU                      20120004
201300        PERFORM Z860-GET-DEPARTMENT.                              20130004
201400                                                                  20140004
201500     SET PS-POA-NO-ERRORS TO TRUE.                                20150004
201600                                                                  20160004
201700     IF PO002-I-SKU (1:5) = 'NOSKU' OR SQLCODE NOT = ZERO         20170004
201800         SET PS-POA-SKU-ERR TO TRUE                               20180004
201900     ELSE                                                         20190004
202000         IF ASC-ASSIGNED-DEPT-NBR = SPACE                         20200004
202100             CONTINUE                                             20210004
202200         ELSE                                                     20220004
202300             IF PV-SKXREF-DEPT NOT = ASC-ASSIGNED-DEPT-NBR        20230004
202400                 SET PS-POA-DEPT-ERR TO TRUE                      20240004
202500             END-IF                                               20250004
202600         END-IF                                                   20260004
202700     END-IF.                                                      20270004
202800                                                                  20280004
202900                                                                  20290004
203000*-----------------------------------------------------------------20300004
203100*  MOVE THE ITEMS FROM THE DATA BASE INTO THE BLOCKS IN THE ARRAY.20310004
203200*  WHENEVER BOTH BLOCKS BECOME FULL, WRITE OUT THE 1ST BLOCK TO   20320004
203300*  TEMPORARY STORAGE, MOVE THE 2ND BLOCK IN THE ARRAY TO THE 1ST  20330004
203400*  BLOCK, AND INITIALIZE THE 2ND BLOCK MAKING IT AVAILABLE TO BE  20340004
203500*  USED.                                                          20350004
203600*-----------------------------------------------------------------20360004
203700                                                                  20370004
203800 4317-POA-PROCESS-ITEM-RECORD.                                    20380004
203900                                                                  20390004
204000     IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                        20400004
204100         ADD +1            TO ASC-ITEM-SUB                        20410004
204200     ELSE                                                         20420004
204300         ADD +1            TO ASC-BLK-SUB                         20430004
204400         MOVE +1           TO ASC-ITEM-SUB                        20440004
204500                                                                  20450004
204600         IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY                 20460004
204700             MOVE +1       TO ASC-BLK-SUB                         20470004
204800             SET ASC-BLOCK-MODIFIED (1) TO TRUE                   20480004
204900             PERFORM 5100-WRITE-TEMP-STORAGE                      20490004
205000             MOVE ASC-BLOCK-ENTRIES                               20500004
205100                                  (PC-MAX-BLOCKS-IN-ARRAY)        20510004
205200                         TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB)        20520004
205300             ADD +1        TO ASC-BLK-SUB                         20530004
205400             INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)           20540004
205500             SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)              20550004
205600                                                   TO TRUE        20560004
205700         END-IF                                                   20570004
205800     END-IF.                                                      20580004
205900                                                                  20590004
206000     ADD +1                TO ASC-NUMBER-OF-ITEMS-READ.           20600004
206100                                                                  20610004
206200     MOVE ASC-NUMBER-OF-ITEMS-READ   TO ASC-LIST-ITEM-NUMBER      20620004
206300                                       (ASC-BLK-SUB ASC-ITEM-SUB).20630004
206400                                                                  20640004
206500     EVALUATE TRUE                                                20650004
206600         WHEN PS-POA-SKU-ERR                                      20660004
206700             MOVE PC-MSG-UPC-SKU-NOT-FND TO ASC-ERROR-MSG         20670004
206800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20680004
206900         WHEN PS-POA-DEPT-ERR                                     20690004
207000             MOVE PC-MSG-WRONG-DEPT      TO ASC-ERROR-MSG         20700004
207100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20710004
207200         WHEN OTHER                                               20720004
207300             CONTINUE                                             20730004
207400     END-EVALUATE.                                                20740004
207500                                                                  20750004
207600     MOVE PO002-I-UPC                TO ASC-UPC-NBR               20760004
207700                                       (ASC-BLK-SUB ASC-ITEM-SUB).20770004
207800                                                                  20780004
207900                                                                  20790004
208000 4320-INV-READ-ITEMS-FROM-DB.                                     20800004
208100                                                                  20810004
208200     PERFORM                                                      20820004
208300         VARYING PV-READ-COUNT                                    20830004
208400         FROM 1 BY 1                                              20840004
208500         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    20850004
208600            OR (ASC-NO-ITEMS-LEFT-ON-DB)                          20860004
208700            OR (PS-DATA-NOT-AVAILABLE))                           20870004
208800                                                                  20880004
208900         PERFORM Z810-FETCH-CURSOR                                20890004
209000                                                                  20900004
209100         IF   PS-DATA-AVAILABLE                                   20910004
209200         AND  ASC-ITEMS-LEFT-ON-DB                                20920004
209300             MOVE FGTRDT-TRN-SET-DATA-TEXT TO AP050-EDI-IN-FILE   20930004
209400             EVALUATE TRUE                                        20940004
209500                 WHEN AP050-INV-INTRCHG                           20950004
209600                     PERFORM 4323-INV-PROCESS-HEADER-RECORD       20960004
209700*                WHEN AP050-INV-DETAILS                           20970004
209800*                    PERFORM 4325-INV-CHECK-FOR-ERRORS            20980004
209900*                    IF PS-INV-NO-ERRORS                          20990004
210000*                        CONTINUE                                 21000004
210100*                    ELSE                                         21010004
210200*                        PERFORM 4327-INV-PROCESS-ITEM-RECORD     21020004
210300*                    END-IF                                       21030004
210400                 WHEN OTHER                                       21040004
210500                     CONTINUE                                     21050004
210600         END-IF                                                   21060004
210700     END-PERFORM.                                                 21070004
210800                                                                  21080004
210900     IF PS-DATA-NOT-AVAILABLE                                     21090004
211000         CONTINUE                                                 21100004
211100     ELSE                                                         21110004
211200         IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                      21120004
211300             MOVE +1               TO ASC-BLK-SUB                 21130004
211400             PERFORM 5100-WRITE-TEMP-STORAGE                      21140004
211500             ADD +1                TO ASC-BLK-SUB                 21150004
211600             PERFORM 5100-WRITE-TEMP-STORAGE                      21160004
211700                                                                  21170004
211800             MOVE 1                TO ASC-BLK-SUB                 21180004
211900                                      PV-BLOCK-NUMBER             21190004
212000             PERFORM 4410-READ-TEMP-STORAGE                       21200004
212100             IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1         21210004
212200                 MOVE 2            TO ASC-BLK-SUB                 21220004
212300                                      PV-BLOCK-NUMBER             21230004
212400                 PERFORM 4410-READ-TEMP-STORAGE                   21240004
212500             END-IF                                               21250004
212600         END-IF                                                   21260004
212700     END-IF.                                                      21270004
212800                                                                  21280004
212900                                                                  21290004
213000 4323-INV-PROCESS-HEADER-RECORD.                                  21300004
213100                                                                  21310004
213200     IF AP050-PO-NOT-FOUND                                        21320004
213300     OR AP050-PO-ON-HOLD                                          21330004
213400         SET PS-DONT-CHECK-FOR-LINE-MATCH TO TRUE                 21340004
213500     ELSE                                                         21350004
213600         SET PS-CHECK-FOR-LINE-MATCH      TO TRUE                 21360004
213700     END-IF.                                                      21370004
213800                                                                  21380004
213900     IF AP050-PO-NOT-FOUND                                        21390004
214000         MOVE PC-STATUS-NOT-FOUND         TO ASC-PO-STATUS        21400004
214100     ELSE                                                         21410004
214200         IF AP050-PO-ON-HOLD                                      21420004
214300             MOVE PC-STATUS-ON-HOLD       TO ASC-PO-STATUS        21430004
214400         ELSE                                                     21440004
214500             PERFORM Z830-GET-STATUS                              21450004
214600             EVALUATE TRUE                                        21460004
214700                 WHEN SQLCODE = ZERO                              21470004
214800                     MOVE STATCD-STATUS-DESC TO ASC-PO-STATUS     21480004
214900                 WHEN OTHER                                       21490004
215000                     CONTINUE                                     21500004
215100             END-EVALUATE                                         21510004
215200         END-IF                                                   21520004
215300     END-IF.                                                      21530004
215400                                                                  21540004
215500     MOVE AP050-VENDOR-INVOICE-NBR    TO ASC-INVOICE-NBR.         21550004
215600     MOVE PC-STATUS-NEW-INVOICE       TO ASC-INV-STATUS.          21560004
215700     MOVE AP050-DEPT-NBR-ON-PO        TO ASC-DEPT-NBR.            21570004
215800                                                                  21580004
215900                                                                  21590004
216000*4325-INV-CHECK-FOR-ERRORS.                                       21600004
216100*                                                                 21610004
216200*    SET PS-INV-NO-ERRORS TO TRUE.                                21620004
216300*                                                                 21630004
216400*    IF AP050-KOHLS-SKU = SPACE                                   21640004
216500*        SET PS-INV-SKU-ERR TO TRUE                               21650004
216600*    ELSE                                                         21660004
216700*        IF   PS-CHECK-FOR-LINE-MATCH                             21670004
216800*        AND  AP050-NO-LINE-MATCH                                 21680004
216900*            SET PS-INV-UPC-ERR TO TRUE                           21690004
217000*        END-IF                                                   21700004
217100*    END-IF.                                                      21710004
217200*                                                                 21720004
217300*                                                                 21730004
217400*-----------------------------------------------------------------21740004
217500*  MOVE THE ITEMS FROM THE DATA BASE INTO THE BLOCKS IN THE ARRAY.21750004
217600*  WHENEVER BOTH BLOCKS BECOME FULL, WRITE OUT THE 1ST BLOCK TO   21760004
217700*  TEMPORARY STORAGE, MOVE THE 2ND BLOCK IN THE ARRAY TO THE 1ST  21770004
217800*  BLOCK, AND INITIALIZE THE 2ND BLOCK MAKING IT AVAILABLE TO BE  21780004
217900*  USED.                                                          21790004
218000*-----------------------------------------------------------------21800004
218100*                                                                 21810004
218200*4327-INV-PROCESS-ITEM-RECORD.                                    21820004
218300*                                                                 21830004
218400*    IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                        21840004
218500*        ADD +1            TO ASC-ITEM-SUB                        21850004
218600*    ELSE                                                         21860004
218700*        ADD +1            TO ASC-BLK-SUB                         21870004
218800*        MOVE +1           TO ASC-ITEM-SUB                        21880004
218900*                                                                 21890004
219000*        IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY                 21900004
219100*            MOVE +1       TO ASC-BLK-SUB                         21910004
219200*            SET ASC-BLOCK-MODIFIED (1) TO TRUE                   21920004
219300*            PERFORM 5100-WRITE-TEMP-STORAGE                      21930004
219400*            MOVE ASC-BLOCK-ENTRIES                               21940004
219500*                                 (PC-MAX-BLOCKS-IN-ARRAY)        21950004
219600*                        TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB)        21960004
219700*            ADD +1        TO ASC-BLK-SUB                         21970004
219800*            INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)           21980004
219900*            SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)              21990004
220000*                                                  TO TRUE        22000004
220100*        END-IF                                                   22010004
220200*    END-IF.                                                      22020004
220300*                                                                 22030004
220400*    ADD +1                TO ASC-NUMBER-OF-ITEMS-READ.           22040004
220500*                                                                 22050004
220600*    MOVE ASC-NUMBER-OF-ITEMS-READ   TO ASC-LIST-ITEM-NUMBER      22060004
220700*                                      (ASC-BLK-SUB ASC-ITEM-SUB).22070004
220800*                                                                 22080004
220900*    EVALUATE TRUE                                                22090004
221000*        WHEN PS-INV-SKU-ERR                                      22100004
221100*            MOVE PC-MSG-UPC-SKU-NOT-FND TO ASC-ERROR-MSG         22110004
221200*                                      (ASC-BLK-SUB ASC-ITEM-SUB) 22120004
221300*        WHEN PS-INV-UPC-ERR                                      22130004
221400*            MOVE PC-MSG-UPC-NOT-ON-PO   TO ASC-ERROR-MSG         22140004
221500*                                      (ASC-BLK-SUB ASC-ITEM-SUB) 22150004
221600*        WHEN OTHER                                               22160004
221700*            CONTINUE                                             22170004
221800*    END-EVALUATE.                                                22180004
221900*                                                                 22190004
222000*    IF AP050-EAN                                                 22200004
222100*        MOVE AP050-EAN-UPC          TO ASC-UPC-NBR               22210004
222200*                                      (ASC-BLK-SUB ASC-ITEM-SUB) 22220004
222300*                                      (3:13)                     22230004
222400*    ELSE                                                         22240004
222500*        MOVE '0'                    TO ASC-UPC-NBR               22250004
222600*                                      (ASC-BLK-SUB ASC-ITEM-SUB) 22260004
222700*                                      (3:1)                      22270004
222800*        MOVE AP050-UPC-CODE         TO ASC-UPC-NBR               22280004
222900*                                      (ASC-BLK-SUB ASC-ITEM-SUB) 22290004
223000*                                      (4:12)                     22300004
223100*    END-IF.                                                      22310004
223200*                                                                 22320004
223300*                                                                 22330004
223400*-----------------------------------------------------------------22340004
223500* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.      22350004
223600*-----------------------------------------------------------------22360004
223700                                                                  22370004
223800 4400-MOVE-COMMAREA-TO-SCREEN.                                    22380004
223900                                                                  22390004
224000     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             22400004
224100         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          22410004
224200         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          22420004
224300             MOVE +1    TO ASC-BLK-SUB                            22430004
224400             PERFORM 5100-WRITE-TEMP-STORAGE                      22440004
224500             ADD +1     TO ASC-BLK-SUB                            22450004
224600             PERFORM 5100-WRITE-TEMP-STORAGE                      22460004
224700             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             22470004
224800                 GIVING PV-BLOCK-NUMBER                           22480004
224900                 REMAINDER PV-REMAINDER                           22490004
225000             IF  PV-REMAINDER > ZERO                              22500004
225100                 ADD +1 TO PV-BLOCK-NUMBER                        22510004
225200             END-IF                                               22520004
225300             MOVE +1    TO ASC-BLK-SUB                            22530004
225400             PERFORM 4410-READ-TEMP-STORAGE                       22540004
225500             ADD +1     TO ASC-BLK-SUB                            22550004
225600                           PV-BLOCK-NUMBER                        22560004
225700             PERFORM 4410-READ-TEMP-STORAGE                       22570004
225800     END-IF.                                                      22580004
225900     MOVE +1            TO ASC-BLK-SUB.                           22590004
226000     COMPUTE ASC-ITEM-SUB =                                       22600004
226100         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              22610004
226200         + PC-ITEMS-PER-PANEL).                                   22620004
226300                                                                  22630004
226400     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        22640004
226500         ADD +1         TO ASC-BLK-SUB                            22650004
226600         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            22660004
226700     END-IF.                                                      22670004
226800                                                                  22680004
226900     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           22690004
227000         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                22700004
227100     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        22710004
227200     PERFORM 4420-FORMAT-LIST-LINES                               22720004
227300         VARYING PV-SUB                                           22730004
227400         FROM PC-ITEMS-PER-PANEL BY -1                            22740004
227500         UNTIL PV-SUB < +1.                                       22750004
227600                                                                  22760004
227700     COMPUTE ASC-ITEMS-DISPLAYED =                                22770004
227800         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          22780004
227900     IF PS-NO-START-ITEM-ERROR                                    22790004
228000         MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL22800004
228100                                          ASTRTITO                22810004
228200         MOVE SPACE                    TO ASC-START-ITEM-REQUEST  22820004
228300     ELSE                                                         22830004
228400         MOVE ASC-START-ITEM-REQUEST   TO ASTRTITO                22840004
228500     END-IF.                                                      22850004
228600     MOVE ASC-ITEM-AT-BOT-OF-PANEL     TO AENDITO.                22860004
228700     MOVE ASC-NUMBER-OF-ITEMS-READ     TO ATOTITO.                22870004
228800     MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO ASELITO.                22880004
228900                                                                  22890004
229000*    *------------------------------------------------------------22900004
229100*    * FILL IN THE FIELDS IN THE HEADER PORTION OF THE SCREEN.    22910004
229200*    *------------------------------------------------------------22920004
229300                                                                  22930004
229400     MOVE ASC-PO-NBR                          TO APONBRO.         22940004
229500     MOVE ASC-PO-STATUS                       TO APOSTATO.        22950004
229600                                                                  22960004
229700     EVALUATE TRUE                                                22970004
229800         WHEN ASC-TRN-SET-CDE = PC-TRN-SET-CDE-POA                22980004
229900             MOVE PC-DEPT-LINE-LABEL          TO AH2DESCO         22990004
230000             MOVE ASC-DEPT-NBR                TO AH2DATAO         23000004
230100             MOVE ASC-DEPT-STATUS             TO AH2STATO         23010004
230200             MOVE PC-ASSIGNED-DEPT-LINE-LABEL TO AH3DESCO         23020004
230300             MOVE ASC-NEW-ASSIGNED-DEPT-NBR   TO AH3DATAO         23030004
230400             MOVE PC-VENDOR-LINE-LABEL        TO AH4DESCO         23040004
230500             MOVE ASC-VENDOR-NAME             TO AH4DATAO         23050004
230600             MOVE SPACE                       TO AH5DESCO         23060004
230700                                                 AH5DATAO         23070004
230800         WHEN ASC-TRN-SET-CDE = PC-TRN-SET-CDE-INV                23080004
230900             MOVE PC-INV-LINE-LABEL           TO AH2DESCO         23090004
231000             MOVE ASC-INVOICE-NBR             TO AH2DATAO         23100004
231100             MOVE ASC-INV-STATUS              TO AH2STATO         23110004
231200             MOVE PC-DEPT-LINE-LABEL          TO AH3DESCO         23120004
231300             MOVE ASC-DEPT-NBR                TO AH3DATAO         23130004
231400             MOVE PC-ASSIGNED-DEPT-LINE-LABEL TO AH4DESCO         23140004
231500             MOVE ASC-NEW-ASSIGNED-DEPT-NBR   TO AH4DATAO         23150004
231600             MOVE PC-VENDOR-LINE-LABEL        TO AH5DESCO         23160004
231700             MOVE ASC-VENDOR-NAME             TO AH5DATAO         23170004
231800         WHEN OTHER                                               23180004
231900             MOVE SPACE TO                       AH2DESCO         23190004
232000                                                 AH2DATAO         23200004
232100                                                 AH2STATO         23210004
232200                                                 AH3DESCO         23220004
232300                                                 AH3DATAO         23230004
232400                                                 AH4DESCO         23240004
232500                                                 AH4DATAO         23250004
232600                                                 AH5DESCO         23260004
232700                                                 AH5DATAO         23270004
232800     END-EVALUATE.                                                23280004
232900                                                                  23290004
233000     IF  DP020-MSG-NUMBER-X = SPACE                               23300004
233100         IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                      23310004
233200             CONTINUE                                             23320004
233300         ELSE                                                     23330004
233400             IF  ASC-ITEM-AT-BOT-OF-PANEL <                       23340004
233500                 ASC-NUMBER-OF-ITEMS-READ                         23350004
233600*                --- MORE ITEMS TO DISPLAY ----                   23360004
233700                 MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER        23370004
233800                 SET DP020-MSG-INFORMATIONAL TO TRUE              23380004
233900             END-IF                                               23390004
234000         END-IF                                                   23400004
234100     END-IF.                                                      23410004
234200                                                                  23420004
234300                                                                  23430004
234400*-----------------------------------------------------------------23440004
234500*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.          23450004
234600*-----------------------------------------------------------------23460004
234700                                                                  23470004
234800 4410-READ-TEMP-STORAGE.                                          23480004
234900                                                                  23490004
235000     EXEC CICS                                                    23500004
235100         READQ TS                                                 23510004
235200             QUEUE (ASC-LIST-QUEUE-NAME)                          23520004
235300             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               23530004
235400             ITEM  (PV-BLOCK-NUMBER)                              23540004
235500             RESP  (PV-CICS-RESP)                                 23550004
235600     END-EXEC.                                                    23560004
235700                                                                  23570004
235800     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       23580004
235900       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     23590004
236000         CONTINUE                                                 23600004
236100     ELSE                                                         23610004
236200         SET DP013-CICS-ABEND     TO TRUE                         23620004
236300         SET DP013-NO-ROLLBACK    TO TRUE                         23630004
236400         MOVE '4410-READ-TEMP-STORAGE'                            23640004
236500                                  TO DP013-PARAGRAPH              23650004
236600         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      23660004
236700                                  TO DP013-MESSAGE-TEXT(1)        23670004
236800         PERFORM DP013-0000-PROCESS-ABEND                         23680004
236900     END-IF.                                                      23690004
237000                                                                  23700004
237100     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             23710004
237200                                                                  23720004
237300     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         23730004
237400         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               23740004
237500     END-IF.                                                      23750004
237600                                                                  23760004
237700                                                                  23770004
237800*-----------------------------------------------------------------23780004
237900*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.     23790004
238000*-----------------------------------------------------------------23800004
238100                                                                  23810004
238200 4420-FORMAT-LIST-LINES.                                          23820004
238300                                                                  23830004
238400     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      23840004
238500         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                23850004
238600         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA      (PV-SUB)      23860004
238700         MOVE DP015-HL-OFF       TO MR-SELECTH      (PV-SUB)      23870004
238800         MOVE SPACE              TO MR-SELECT       (PV-SUB)      23880004
238900                                    MR-ACTION       (PV-SUB)      23890004
239000                                    MR-UPC-NBR      (PV-SUB)      23900004
239100                                    MR-ERROR-MSG    (PV-SUB)      23910004
239200     ELSE                                                         23920004
239300         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      23930004
239400                                                   > SPACE        23940004
239500             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 23950004
239600                                 TO MR-SELECT (PV-SUB)            23960004
239700         ELSE                                                     23970004
239800             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      23980004
239900                                 TO MR-SELECT (PV-SUB)            23990004
240000         END-IF                                                   24000004
240100                                                                  24010004
240200*        IF  DP030-SET-CURSOR-TRAILER                             24020004
240300*            IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)24030004
240400*                > SPACE)                                         24040004
240500*              OR (PV-SUB = 1))                                   24050004
240600*               SET DP030-SET-CURSOR-APPL-1 TO TRUE               24060004
240700*               MOVE -1          TO MR-SELECTL (PV-SUB)           24070004
240800*            END-IF                                               24080004
240900*        END-IF                                                   24090004
241000                                                                  24100004
241100         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           24110004
241200             MOVE ASC-ACTION         (ASC-BLK-SUB ASC-ITEM-SUB)   24120004
241300                  TO MR-ACTION       (PV-SUB)                     24130004
241400             MOVE ASC-UPC-NBR    (ASC-BLK-SUB ASC-ITEM-SUB) (3:2) 24140004
241500                  TO PV-FORMAT-UPC-NBR (1:2)                      24150004
241600             MOVE ASC-UPC-NBR    (ASC-BLK-SUB ASC-ITEM-SUB) (5:5) 24160004
241700                  TO PV-FORMAT-UPC-NBR (4:5)                      24170004
241800             MOVE ASC-UPC-NBR    (ASC-BLK-SUB ASC-ITEM-SUB) (10:5)24180004
241900                  TO PV-FORMAT-UPC-NBR (10:5)                     24190004
242000             MOVE ASC-UPC-NBR    (ASC-BLK-SUB ASC-ITEM-SUB) (15:1)24200004
242100                  TO PV-FORMAT-UPC-NBR (16:1)                     24210004
242200             MOVE PV-FORMAT-UPC-NBR                               24220004
242300                  TO MR-UPC-NBR      (PV-SUB)                     24230004
242400             MOVE ASC-ERROR-MSG      (ASC-BLK-SUB ASC-ITEM-SUB)   24240004
242500                  TO MR-ERROR-MSG    (PV-SUB)                     24250004
242600         END-IF                                                   24260004
242700     END-IF.                                                      24270004
242800     SUBTRACT +1 FROM ASC-ITEM-SUB                                24280004
242900     IF  ASC-ITEM-SUB < + 1                                       24290004
243000         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  24300004
243100         MOVE +1                 TO ASC-BLK-SUB                   24310004
243200     END-IF.                                                      24320004
243300                                                                  24330004
243400                                                                  24340004
243500*-----------------------------------------------------------------24350004
243600* IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF      24360004
243700* RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,         24370004
243800* ISSUE A WARNING.                                                24380004
243900*-----------------------------------------------------------------24390004
244000                                                                  24400004
244100 4430-CHECK-FOR-BEGIN-AND-END.                                    24410004
244200                                                                  24420004
244300     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       24430004
244400         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     24440004
244500*            -- NO END-OF-RANGE SPECFIED ---                      24450004
244600             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            24460004
244700             SET DP020-MSG-WARNING TO TRUE                        24470004
244800             PERFORM 4431-POSITION-AT-WARNING                     24480004
244900         END-IF                                                   24490004
245000     ELSE                                                         24500004
245100         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     24510004
245200*            -- NO BEGINNING-OF-RANGE SPECFIED ---                24520004
245300             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            24530004
245400             SET DP020-MSG-WARNING TO TRUE                        24540004
245500             PERFORM 4431-POSITION-AT-WARNING                     24550004
245600         END-IF                                                   24560004
245700     END-IF.                                                      24570004
245800                                                                  24580004
245900                                                                  24590004
246000*-----------------------------------------------------------------24600004
246100* ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,     24610004
246200* DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE      24620004
246300* IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND           24630004
246400* POSITION THE CURSOR THERE.                                      24640004
246500*-----------------------------------------------------------------24650004
246600                                                                  24660004
246700 4431-POSITION-AT-WARNING.                                        24670004
246800                                                                  24680004
246900     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 24690004
247000                    - PV-TOP-ITEM + 1.                            24700004
247100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      24710004
247200         CONTINUE                                                 24720004
247300     ELSE                                                         24730004
247400         SET DP030-SET-CURSOR-APPL-1                              24740004
247500                                   TO TRUE                        24750004
247600         MOVE -1                   TO MR-SELECTL (PV-SUB)         24760004
247700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         24770004
247800         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         24780004
247900     END-IF.                                                      24790004
248000                                                                  24800004
248100     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   24810004
248200                    - PV-TOP-ITEM + 1.                            24820004
248300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      24830004
248400         CONTINUE                                                 24840004
248500     ELSE                                                         24850004
248600         SET DP030-SET-CURSOR-APPL-1                              24860004
248700                                   TO TRUE                        24870004
248800         MOVE -1                   TO MR-SELECTL (PV-SUB)         24880004
248900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         24890004
249000         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         24900004
249100     END-IF.                                                      24910004
249200                                                                  24920004
249300                                                                  24930004
249400*-----------------------------------------------------------------24940004
249500* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-   24950004
249600* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT      24960004
249700* FOR THE SELECTED ITEMS QUEUE.                                   24970004
249800*                                                                 24980004
249900* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION      24990004
250000* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN     25000004
250100* THE ARRAY IS FULL.                                              25010004
250200*-----------------------------------------------------------------25020004
250300                                                                  25030004
250400 5000-PREPARE-SEL-QUEUE.                                          25040004
250500                                                                  25050004
250600     MOVE +1                   TO  ASC-BLK-SUB.                   25060004
250700     PERFORM 5100-WRITE-TEMP-STORAGE.                             25070004
250800     ADD +1                    TO  ASC-BLK-SUB.                   25080004
250900     PERFORM 5100-WRITE-TEMP-STORAGE.                             25090004
251000                                                                  25100004
251100     MOVE ASC-OUTPUT-SEL-QUEUE-NAME  TO  ET345-SEL-QUEUE-NAME.    25110004
251200     PERFORM 6010-DELETE-SEL-QUEUE.                               25120004
251300                                                                  25130004
251400     SET ASC-UPDATE-TSQ        TO  TRUE.                          25140004
251500                                                                  25150004
251600     SET ET346-IDX             TO  1.                             25160004
251700     MOVE ZERO                 TO ET345-NUMBER-OF-TS-ITEMS.       25170004
251800     INITIALIZE ET346-SELECTED-ITEM-ARRAY.                        25180004
251900                                                                  25190004
252000     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           25200004
252100             VARYING PV-ITEM                                      25210004
252200             FROM 1 BY 1                                          25220004
252300             UNTIL PV-ITEM > ASC-HIGHEST-BLOCK-WRITTEN.           25230004
252400                                                                  25240004
252500     IF  ET346-IDX > 1                                            25250004
252600         PERFORM 5205-WRITE-SEL-QUEUE                             25260004
252700         ADD +1                TO ET345-NUMBER-OF-TS-ITEMS        25270004
252800     END-IF.                                                      25280004
252900                                                                  25290004
253000                                                                  25300004
253100*-----------------------------------------------------------------25310004
253200*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.       25320004
253300*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.     25330004
253400*-----------------------------------------------------------------25340004
253500                                                                  25350004
253600 5100-WRITE-TEMP-STORAGE.                                         25360004
253700                                                                  25370004
253800     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     25380004
253900                                   TO PV-LIST-ITEM-NUMBER.        25390004
254000     COMPUTE PV-BLOCK-NUMBER =                                    25400004
254100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    25410004
254200                                                                  25420004
254300     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             25430004
254400     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             25440004
254500         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      25450004
254600             PERFORM 5105-REWRITE-ASC-LISTQ                       25460004
254700         END-IF                                                   25470004
254800     ELSE                                                         25480004
254900         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       25490004
255000         ASC-HIGHEST-BLOCK-WRITTEN + 1                            25500004
255100         PERFORM 5110-WRITE-ASC-LISTQ                             25510004
255200         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   25520004
255300     END-IF.                                                      25530004
255400                                                                  25540004
255500     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             25550004
255600                                                                  25560004
255700                                                                  25570004
255800*-----------------------------------------------------------------25580004
255900* REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       25590004
256000* SPECIFIC COMMAREA.                                              25600004
256100*-----------------------------------------------------------------25610004
256200                                                                  25620004
256300 5105-REWRITE-ASC-LISTQ.                                          25630004
256400                                                                  25640004
256500     EXEC CICS                                                    25650004
256600         WRITEQ TS                                                25660004
256700             QUEUE (ASC-LIST-QUEUE-NAME)                          25670004
256800             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               25680004
256900             ITEM  (PV-BLOCK-NUMBER)                              25690004
257000             REWRITE                                              25700004
257100             RESP  (PV-CICS-RESP)                                 25710004
257200     END-EXEC.                                                    25720004
257300                                                                  25730004
257400     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           25740004
257500         CONTINUE                                                 25750004
257600     ELSE                                                         25760004
257700         SET DP013-CICS-ABEND            TO TRUE                  25770004
257800         SET DP013-NO-ROLLBACK           TO TRUE                  25780004
257900         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       25790004
258000         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     25800004
258100                                         TO DP013-MESSAGE-TEXT(1) 25810004
258200         PERFORM DP013-0000-PROCESS-ABEND                         25820004
258300     END-IF.                                                      25830004
258400                                                                  25840004
258500                                                                  25850004
258600*-----------------------------------------------------------------25860004
258700* WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-         25870004
258800* SPECIFIC COMMAREA.                                              25880004
258900*-----------------------------------------------------------------25890004
259000                                                                  25900004
259100 5110-WRITE-ASC-LISTQ.                                            25910004
259200                                                                  25920004
259300     EXEC CICS                                                    25930004
259400         WRITEQ TS                                                25940004
259500             QUEUE (ASC-LIST-QUEUE-NAME)                          25950004
259600             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               25960004
259700             ITEM  (PV-BLOCK-NUMBER)                              25970004
259800             RESP  (PV-CICS-RESP)                                 25980004
259900     END-EXEC.                                                    25990004
260000     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      26000004
260100         SET DP013-CICS-ABEND      TO TRUE                        26010004
260200         SET DP013-NO-ROLLBACK     TO TRUE                        26020004
260300         MOVE '5110-WRITE-ASC-LISTQ'                              26030004
260400                                   TO DP013-PARAGRAPH             26040004
260500         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           26050004
260600                                   TO DP013-MESSAGE-TEXT(1)       26060004
260700         PERFORM DP013-0000-PROCESS-ABEND                         26070004
260800     END-IF.                                                      26080004
260900                                                                  26090004
261000                                                                  26100004
261100*-----------------------------------------------------------------26110004
261200* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS  26120004
261300* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.                26130004
261400*-----------------------------------------------------------------26140004
261500                                                                  26150004
261600 5200-FILL-SEL-QUEUE-RECORD.                                      26160004
261700                                                                  26170004
261800     PERFORM 6112-READ-LIST-QUEUE.                                26180004
261900                                                                  26190004
262000     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       26200004
262100         PERFORM                                                  26210004
262200         VARYING LQW-IDX                                          26220004
262300         FROM 1 BY 1                                              26230004
262400         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            26240004
262500           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          26250004
262600                                                                  26260004
262700             IF  LQW-SELECT (LQW-IDX)                             26270004
262800                 MOVE LQW-LIST-ITEM-NUMBER  (LQW-IDX)             26280004
262900                      TO ET346-ITEM         (ET346-IDX)           26290004
263000                 MOVE SPACE                                       26300004
263100                      TO ET346-ACTION-SW    (ET346-IDX)           26310004
263200                 MOVE LQW-UPC-NBR           (LQW-IDX)             26320004
263300                      TO ET346-UPC-NBR      (ET346-IDX)           26330004
263400                 MOVE ASC-VENDOR-NAME                             26340004
263500                      TO ET346-VENDOR-NAME  (ET346-IDX)           26350004
263600                 SET ET346-IDX UP BY 1                            26360004
263700                 IF  ET346-IDX > ET346-MAX-ITEMS                  26370004
263800                     PERFORM 5205-WRITE-SEL-QUEUE                 26380004
263900                     ADD +1        TO ET345-NUMBER-OF-TS-ITEMS    26390004
264000                     INITIALIZE ET346-SELECTED-ITEM-ARRAY         26400004
264100                     SET ET346-IDX TO  1                          26410004
264200                 END-IF                                           26420004
264300             END-IF                                               26430004
264400         END-PERFORM                                              26440004
264500     END-IF.                                                      26450004
264600                                                                  26460004
264700                                                                  26470004
264800*-----------------------------------------------------------------26480004
264900*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                 26490004
265000*-----------------------------------------------------------------26500004
265100                                                                  26510004
265200 5205-WRITE-SEL-QUEUE.                                            26520004
265300                                                                  26530004
265400     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            26540004
265500                                   TO ET346-SELECTED-ITEMS.       26550004
265600                                                                  26560004
265700     EXEC CICS                                                    26570004
265800          WRITEQ TS                                               26580004
265900              QUEUE (ASC-OUTPUT-SEL-QUEUE-NAME)                   26590004
266000              FROM  (ET346-SELECTED-ITEMS-AREA)                   26600004
266100              ITEM  (PV-SEL-QUEUE-ITEM)                           26610004
266200              RESP  (PV-CICS-RESP)                                26620004
266300     END-EXEC.                                                    26630004
266400                                                                  26640004
266500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          26650004
266600         CONTINUE                                                 26660004
266700     ELSE                                                         26670004
266800         SET DP013-CICS-ABEND      TO TRUE                        26680004
266900         SET DP013-NO-ROLLBACK     TO TRUE                        26690004
267000         MOVE '5205-WRITE-SEL-QUEUE'                              26700004
267100                                   TO DP013-PARAGRAPH             26710004
267200         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          26720004
267300                                   TO DP013-MESSAGE-TEXT(1)       26730004
267400         PERFORM DP013-0000-PROCESS-ABEND                         26740004
267500     END-IF.                                                      26750004
267600                                                                  26760004
267700                                                                  26770004
267800*-----------------------------------------------------------------26780004
267900* WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,    26790004
268000* SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT    26800004
268100* THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO       26810004
268200* THE USER.                                                       26820004
268300*-----------------------------------------------------------------26830004
268400                                                                  26840004
268500 6000-REFRESH-PANEL-FROM-TEMP.                                    26850004
268600                                                                  26860004
268700     IF  ASC-UPDATE-TSQ                                           26870004
268800         SET ASC-NO-TSQ-UPDATE TO TRUE                            26880004
268900         MOVE ZERO                 TO PV-SAVE-ITEM                26890004
269000                                      PV-SEL-QUEUE-ITEM           26900004
269100         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        26910004
269200                                   TO PV-HOLD-SELECTED-ITEMS      26920004
269300         PERFORM 6100-UPDATE-TSQ                                  26930004
269400             UNTIL PV-ITEMS-PROCESSED >                           26940004
269500                                     ASC-NUMBER-OF-SELECTED-ITEMS 26950004
269600         PERFORM 6010-DELETE-SEL-QUEUE                            26960004
269700         INITIALIZE ASC-BLOCK-ENTRIES (1)                         26970004
269800                    ASC-BLOCK-ENTRIES (2)                         26980004
269900                                                                  26990004
270000         DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                 27000004
270100                GIVING PV-BLOCK-NUMBER                            27010004
270200                REMAINDER PV-REMAINDER                            27020004
270300         IF  PV-REMAINDER > ZERO                                  27030004
270400             ADD +1     TO PV-BLOCK-NUMBER                        27040004
270500         END-IF                                                   27050004
270600         MOVE +1        TO ASC-BLK-SUB                            27060004
270700         PERFORM 4410-READ-TEMP-STORAGE                           27070004
270800         ADD +1         TO ASC-BLK-SUB                            27080004
270900                           PV-BLOCK-NUMBER                        27090004
271000         PERFORM 4410-READ-TEMP-STORAGE                           27100004
271100                                                                  27110004
271200     END-IF.                                                      27120004
271300                                                                  27130004
271400                                                                  27140004
271500*-----------------------------------------------------------------27150004
271600*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.                27160004
271700*-----------------------------------------------------------------27170004
271800                                                                  27180004
271900 6010-DELETE-SEL-QUEUE.                                           27190004
272000                                                                  27200004
272100     EXEC CICS                                                    27210004
272200         DELETEQ TS                                               27220004
272300             QUEUE (ASC-OUTPUT-SEL-QUEUE-NAME)                    27230004
272400             RESP  (PV-CICS-RESP)                                 27240004
272500     END-EXEC.                                                    27250004
272600                                                                  27260004
272700     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      27270004
272800        (PV-CICS-RESP = DFHRESP(QIDERR)))                         27280004
272900         CONTINUE                                                 27290004
273000     ELSE                                                         27300004
273100         SET DP013-CICS-ABEND TO TRUE                             27310004
273200         SET DP013-NO-ROLLBACK TO TRUE                            27320004
273300         MOVE '6010-DELETE-SEL-QUEUE'                             27330004
273400                        TO DP013-PARAGRAPH                        27340004
273500         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         27350004
273600                        TO DP013-MESSAGE-TEXT (1)                 27360004
273700         PERFORM DP013-0000-PROCESS-ABEND                         27370004
273800     END-IF.                                                      27380004
273900                                                                  27390004
274000*-----------------------------------------------------------------27400004
274100* INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.          27410004
274200* LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER      27420004
274300* TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN        27430004
274400* THE TEMP QUEUE.                                                 27440004
274500*-----------------------------------------------------------------27450004
274600                                                                  27460004
274700 6100-UPDATE-TSQ.                                                 27470004
274800                                                                  27480004
274900     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             27490004
275000     PERFORM 6105-READ-SEL-QUEUE.                                 27500004
275100     PERFORM                                                      27510004
275200         VARYING ET346-IDX                                        27520004
275300         FROM 1 BY 1                                              27530004
275400         UNTIL ((PV-ITEMS-PROCESSED >                             27540004
275500                              PV-HOLD-SELECTED-ITEMS)             27550004
275600         OR (ET346-IDX GREATER THAN ET346-MAX-ITEMS))             27560004
275700         IF  ET346-ACTION-SW (ET346-IDX) > SPACE                  27570004
275800             PERFORM 6110-PROCESS-ITEMS                           27580004
275900         END-IF                                                   27590004
276000         ADD +1                TO PV-ITEMS-PROCESSED              27600004
276100     END-PERFORM.                                                 27610004
276200     PERFORM 6111-WRITE-LIST-QUEUE.                               27620004
276300                                                                  27630004
276400                                                                  27640004
276500*-----------------------------------------------------------------27650004
276600*    READ THE LIST QUEUE RECORD.                                  27660004
276700*-----------------------------------------------------------------27670004
276800                                                                  27680004
276900 6105-READ-SEL-QUEUE.                                             27690004
277000                                                                  27700004
277100     EXEC CICS                                                    27710004
277200          READQ TS                                                27720004
277300              QUEUE (ASC-OUTPUT-SEL-QUEUE-NAME)                   27730004
277400              INTO  (ET346-SELECTED-ITEMS-AREA)                   27740004
277500              ITEM  (PV-SEL-QUEUE-ITEM)                           27750004
277600              RESP  (PV-CICS-RESP)                                27760004
277700     END-EXEC.                                                    27770004
277800                                                                  27780004
277900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          27790004
278000         CONTINUE                                                 27800004
278100     ELSE                                                         27810004
278200         SET DP013-CICS-ABEND      TO  TRUE                       27820004
278300         SET DP013-NO-ROLLBACK     TO  TRUE                       27830004
278400         MOVE '6105-READ-SEL-QUEUE'                               27840004
278500                                   TO  DP013-PARAGRAPH            27850004
278600         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           27860004
278700                                   TO  DP013-MESSAGE-TEXT(1)      27870004
278800         PERFORM DP013-0000-PROCESS-ABEND                         27880004
278900     END-IF.                                                      27890004
279000                                                                  27900004
279100                                                                  27910004
279200*-----------------------------------------------------------------27920004
279300* CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.    27930004
279400* REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE    27940004
279500* THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.               27950004
279600*-----------------------------------------------------------------27960004
279700                                                                  27970004
279800 6110-PROCESS-ITEMS.                                              27980004
279900                                                                  27990004
280000     COMPUTE PV-ITEM = 1 + ((ET346-ITEM (ET346-IDX) - 1)          28000004
280100                     / PC-ITEMS-PER-PANEL).                       28010004
280200                                                                  28020004
280300     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           28030004
280400         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          28040004
280500             PERFORM 6111-WRITE-LIST-QUEUE                        28050004
280600         END-IF                                                   28060004
280700         MOVE PV-ITEM          TO PV-SAVE-ITEM                    28070004
280800                                                                  28080004
280900         PERFORM 6112-READ-LIST-QUEUE                             28090004
281000         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               28100004
281100             CONTINUE                                             28110004
281200         END-IF                                                   28120004
281300     END-IF.                                                      28130004
281400                                                                  28140004
281500     COMPUTE PV-SUB = (ET346-ITEM (ET346-IDX)                     28150004
281600                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              28160004
281700     SET LQW-DESELECT (PV-SUB) TO    TRUE                         28170004
281800     MOVE LQW-SELECTED-SW (PV-SUB)                                28180004
281900                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  28190004
282000     EVALUATE TRUE                                                28200004
282100         WHEN ET346-INQ (ET346-IDX)                               28210004
282200              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             28220004
282300     END-EVALUATE.                                                28230004
282400                                                                  28240004
282500     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                28250004
282600                                                                  28260004
282700                                                                  28270004
282800*-----------------------------------------------------------------28280004
282900* WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.                 28290004
283000*-----------------------------------------------------------------28300004
283100                                                                  28310004
283200 6111-WRITE-LIST-QUEUE.                                           28320004
283300                                                                  28330004
283400     EXEC CICS                                                    28340004
283500         WRITEQ TS                                                28350004
283600             QUEUE (ASC-LIST-QUEUE-NAME)                          28360004
283700             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     28370004
283800             ITEM  (PV-SAVE-ITEM)                                 28380004
283900             REWRITE                                              28390004
284000             RESP  (PV-CICS-RESP)                                 28400004
284100     END-EXEC.                                                    28410004
284200*                                                                 28420004
284300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          28430004
284400         CONTINUE                                                 28440004
284500     ELSE                                                         28450004
284600         SET DP013-CICS-ABEND  TO  TRUE                           28460004
284700         SET DP013-NO-ROLLBACK TO  TRUE                           28470004
284800         MOVE '6111-WRITE-LIST-QUEUE'                             28480004
284900                               TO  DP013-PARAGRAPH                28490004
285000         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  28500004
285100                               TO  DP013-MESSAGE-TEXT(1)          28510004
285200         PERFORM DP013-0000-PROCESS-ABEND                         28520004
285300     END-IF.                                                      28530004
285400                                                                  28540004
285500                                                                  28550004
285600*-----------------------------------------------------------------28560004
285700* READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.    28570004
285800*-----------------------------------------------------------------28580004
285900                                                                  28590004
286000 6112-READ-LIST-QUEUE.                                            28600004
286100                                                                  28610004
286200     EXEC CICS                                                    28620004
286300         READQ TS                                                 28630004
286400             QUEUE (ASC-LIST-QUEUE-NAME)                          28640004
286500             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     28650004
286600             ITEM  (PV-ITEM)                                      28660004
286700             RESP  (PV-CICS-RESP)                                 28670004
286800     END-EXEC.                                                    28680004
286900*                                                                 28690004
287000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          28700004
287100         CONTINUE                                                 28710004
287200     ELSE                                                         28720004
287300         SET DP013-CICS-ABEND        TO TRUE                      28730004
287400         SET DP013-NO-ROLLBACK       TO TRUE                      28740004
287500         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           28750004
287600         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    28760004
287700                                     TO DP013-MESSAGE-TEXT(1)     28770004
287800         PERFORM DP013-0000-PROCESS-ABEND                         28780004
287900     END-IF.                                                      28790004
288000                                                                  28800004
288100                                                                  28810004
288200*-----------------------------------------------------------------28820004
288300* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.        28830004
288400*-----------------------------------------------------------------28840004
288500                                                                  28850004
288600 9100-READ-SEL-QUEUE.                                             28860004
288700                                                                  28870004
288800     EXEC CICS                                                    28880004
288900         READQ TS                                                 28890004
289000             QUEUE (ASC-INPUT-SEL-QUEUE-NAME)                     28900004
289100             INTO  (ET346-SELECTED-ITEMS-AREA)                    28910004
289200             ITEM  (ASC-SEL-ITEM)                                 28920004
289300             RESP  (PV-CICS-RESP)                                 28930004
289400     END-EXEC.                                                    28940004
289500                                                                  28950004
289600     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       28960004
289700         CONTINUE                                                 28970004
289800     ELSE                                                         28980004
289900         SET DP013-LOGIC-ABEND                                    28990004
290000             DP013-NO-ROLLBACK     TO TRUE                        29000004
290100         MOVE '9100-READ-SEL-QUEUE'                               29010004
290200                                   TO DP013-PARAGRAPH             29020004
290300         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   29030004
290400                                   TO DP013-MESSAGE-TEXT (1)      29040004
290500         PERFORM DP013-0000-PROCESS-ABEND                         29050004
290600     END-IF.                                                      29060004
290700                                                                  29070004
290800                                                                  29080004
290900*-----------------------------------------------------------------29090004
291000* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.        29100004
291100*-----------------------------------------------------------------29110004
291200                                                                  29120004
291300 9200-REWRITE-SEL-QUEUE.                                          29130004
291400                                                                  29140004
291500     EXEC CICS                                                    29150004
291600          WRITEQ TS                                               29160004
291700              QUEUE  (ASC-INPUT-SEL-QUEUE-NAME)                   29170004
291800              FROM   (ET346-SELECTED-ITEMS-AREA)                  29180004
291900              ITEM   (ASC-SEL-ITEM)                               29190004
292000              RESP   (PV-CICS-RESP)                               29200004
292100              REWRITE                                             29210004
292200     END-EXEC.                                                    29220004
292300                                                                  29230004
292400     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   29240004
292500         SET DP013-CICS-ABEND                                     29250004
292600             DP013-NO-ROLLBACK     TO TRUE                        29260004
292700         MOVE '9200-REWRITE-SEL-QUEUE'                            29270004
292800                                   TO DP013-PARAGRAPH             29280004
292900         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   29290004
293000                                   TO DP013-MESSAGE-TEXT (1)      29300004
293100         PERFORM DP013-0000-PROCESS-ABEND                         29310004
293200     END-IF.                                                      29320004
293300                                                                  29330004
293400                                                                  29340004
293500 Z800-OPEN-CURSOR.                                                29350004
293600                                                                  29360004
293700     EXEC SQL                                                     29370004
293800          OPEN TFGTRDT-CSR                                        29380004
293900     END-EXEC.                                                    29390004
294000                                                                  29400004
294100     EVALUATE TRUE                                                29410004
294200         WHEN SQLCODE = ZERO                                      29420004
294300             CONTINUE                                             29430004
294400         WHEN SQLCODE = -904                                      29440004
294500         WHEN SQLCODE = -913                                      29450004
294600             SET PS-DATA-NOT-AVAILABLE TO TRUE                    29460004
294700         WHEN SQLWARN0 NOT = SPACES                               29470004
294800         WHEN SQLCODE  NOT = ZERO                                 29480004
294900             MOVE 'Z800-OPEN-CURSOR' TO DP013-PARAGRAPH           29490004
295000             MOVE SQLCA              TO DP013-SQLCA               29500004
295100             MOVE 'TFGTRDT'          TO DP013-DB2-TABLE-NAME (1)  29510004
295200             SET DP013-DB2-ABEND                                  29520004
295300                 DP013-XCTL-DISPLAY-RESTART TO TRUE               29530004
295400             PERFORM DP013-0000-PROCESS-ABEND                     29540004
295500     END-EVALUATE.                                                29550004
295600                                                                  29560004
295700                                                                  29570004
295800 Z810-FETCH-CURSOR.                                               29580004
295900                                                                  29590004
296000     EXEC SQL                                                     29600004
296100          FETCH  TFGTRDT-CSR                                      29610004
296200          INTO  :FGTRDT-TRN-SET-SEQ-NBR                           29620004
296300              , :FGTRDT-TRN-SET-DATA                              29630004
296400     END-EXEC.                                                    29640004
296500                                                                  29650004
296600     EVALUATE TRUE                                                29660004
296700         WHEN SQLCODE = ZERO                                      29670004
296800             CONTINUE                                             29680004
296900         WHEN SQLCODE = +100                                      29690004
297000             SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                  29700004
297100         WHEN SQLCODE = -904                                      29710004
297200         WHEN SQLCODE = -913                                      29720004
297300             SET PS-DATA-NOT-AVAILABLE TO TRUE                    29730004
297400         WHEN SQLWARN0 NOT = SPACE                                29740004
297500         WHEN SQLCODE  NOT = ZERO                                 29750004
297600             MOVE 'Z810-FETCH-CURSOR' TO DP013-PARAGRAPH          29760004
297700             MOVE 'FETCH CURSOR'      TO DP013-MESSAGE-TEXT (1)   29770004
297800             MOVE SQLCA               TO DP013-SQLCA              29780004
297900             MOVE 'TFGTRDT'           TO DP013-DB2-TABLE-NAME (1) 29790004
298000             SET DP013-DB2-ABEND                                  29800004
298100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               29810004
298200             PERFORM DP013-0000-PROCESS-ABEND                     29820004
298300     END-EVALUATE.                                                29830004
298400                                                                  29840004
298500                                                                  29850004
298600 Z820-CLOSE-CURSOR.                                               29860004
298700                                                                  29870004
298800     EXEC SQL                                                     29880004
298900          CLOSE TFGTRDT-CSR                                       29890004
299000     END-EXEC.                                                    29900004
299100                                                                  29910004
299200     EVALUATE TRUE                                                29920004
299300         WHEN SQLCODE = ZERO                                      29930004
299400         WHEN SQLCODE = -904                                      29940004
299500         WHEN SQLCODE = -913                                      29950004
299600             CONTINUE                                             29960004
299700         WHEN SQLWARN0 NOT = SPACES                               29970004
299800         WHEN SQLCODE  NOT = ZERO                                 29980004
299900             MOVE 'Z820-CLOSE-CURSOR' TO DP013-PARAGRAPH          29990004
300000             MOVE 'CLOSE CURSOR'      TO DP013-MESSAGE-TEXT (1)   30000004
300100             MOVE SQLCA               TO DP013-SQLCA              30010004
300200             MOVE 'TFGTRDT'           TO DP013-DB2-TABLE-NAME (1) 30020004
300300             SET DP013-DB2-ABEND                                  30030004
300400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               30040004
300500             PERFORM DP013-0000-PROCESS-ABEND                     30050004
300600     END-EVALUATE.                                                30060004
300700                                                                  30070004
300800                                                                  30080004
300900 Z830-GET-STATUS.                                                 30090004
301000                                                                  30100004
301100     EXEC SQL                                                     30110004
301200          SELECT  STATUS_DESC                                     30120004
301300          INTO   :STATCD-STATUS-DESC                              30130004
301400          FROM    TSTATCD                                         30140004
301500          WHERE   STATUS_CDE     = :AP050-PO-STATUS               30150004
301600            AND   STATUS_TYP_CDE = 'P'                            30160004
301700     END-EXEC.                                                    30170004
301800                                                                  30180004
301900     EVALUATE TRUE                                                30190004
302000         WHEN SQLCODE = ZERO                                      30200004
302100         WHEN SQLCODE = +100                                      30210004
302200             CONTINUE                                             30220004
302300         WHEN SQLCODE = -904                                      30230004
302400         WHEN SQLCODE = -913                                      30240004
302500             SET PS-DATA-NOT-AVAILABLE TO TRUE                    30250004
302600         WHEN SQLWARN0 NOT = SPACES                               30260004
302700         WHEN SQLCODE  NOT = ZERO                                 30270004
302800             MOVE 'Z830-GET-STATUS'  TO DP013-PARAGRAPH           30280004
302900             MOVE SQLCA              TO DP013-SQLCA               30290004
303000             MOVE 'TSTATCD'          TO DP013-DB2-TABLE-NAME (1)  30300004
303100             SET DP013-DB2-ABEND                                  30310004
303200                 DP013-XCTL-DISPLAY-RESTART TO TRUE               30320004
303300             PERFORM DP013-0000-PROCESS-ABEND                     30330004
303400     END-EVALUATE.                                                30340004
303500                                                                  30350004
303600                                                                  30360004
303700 Z840-GET-DEPT-FROM-TVNDDPT.                                      30370004
303800                                                                  30380004
303900     EXEC SQL                                                     30390004
304000          SELECT  DEPT_NBR                                        30400004
304100          INTO   :VNDDPT-DEPT-NBR                                 30410004
304200          FROM    TVNDDPT                                         30420004
304300                , TTRDPRT                                         30430004
304400          WHERE   TTRDPRT.TP_DKEY  = :ASC-TP-DKEY                 30440004
304500            AND   TVNDDPT.ENT_ID   = TTRDPRT.ENT_ID               30450004
304600            AND   TVNDDPT.DEPT_NBR = :PV-DB2-DEPT-NBR             30460004
304700     END-EXEC.                                                    30470004
304800                                                                  30480004
304900     EVALUATE TRUE                                                30490004
305000         WHEN SQLCODE = ZERO                                      30500004
305100         WHEN SQLCODE = +100                                      30510004
305200             CONTINUE                                             30520004
305300         WHEN SQLCODE = -904                                      30530004
305400         WHEN SQLCODE = -913                                      30540004
305500             SET PS-DATA-NOT-AVAILABLE TO TRUE                    30550004
305600         WHEN SQLWARN0 NOT = SPACES                               30560004
305700         WHEN SQLCODE  NOT = ZERO                                 30570004
305800             MOVE 'Z840-GET-DEPT-FROM-TVNDDPT'                    30580004
305900                                     TO DP013-PARAGRAPH           30590004
306000             MOVE SQLCA              TO DP013-SQLCA               30600004
306100             MOVE 'TVNDDPT'          TO DP013-DB2-TABLE-NAME (1)  30610004
306200             MOVE 'TTRDPRT'          TO DP013-DB2-TABLE-NAME (2)  30620004
306300             SET DP013-DB2-ABEND                                  30630004
306400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               30640004
306500             PERFORM DP013-0000-PROCESS-ABEND                     30650004
306600     END-EVALUATE.                                                30660004
306700                                                                  30670004
306800                                                                  30680004
306900 Z850-UPDATE-DEPT-NBR.                                            30690004
307000                                                                  30700004
307100     EXEC SQL                                                     30710004
307200         UPDATE TTRPOHL                                           30720004
307300             SET                                                  30730004
307400                 DEPT_NBR        = :PV-DB2-DEPT-NBR               30740004
307500             WHERE  TP_DKEY      = :ASC-TP-DKEY                   30750004
307600               AND  TP_DKEY_TMST = :ASC-TP-DKEY-TMST              30760004
307700               AND  PO_NBR       = :ASC-PO-NBR                    30770004
307800     END-EXEC.                                                    30780004
307900                                                                  30790004
308000     EVALUATE TRUE                                                30800004
308100         WHEN SQLCODE = ZERO                                      30810004
308200             CONTINUE                                             30820004
308300         WHEN SQLCODE = -904                                      30830004
308400         WHEN SQLCODE = -913                                      30840004
308500             EXEC CICS                                            30850004
308600                 SYNCPOINT                                        30860004
308700                     ROLLBACK                                     30870004
308800             END-EXEC                                             30880004
308900             SET PS-DATA-NOT-AVAILABLE TO TRUE                    30890004
309000         WHEN SQLWARN0 NOT = SPACES                               30900004
309100         WHEN SQLCODE  NOT = ZERO                                 30910004
309200             MOVE 'Z850-UPDATE-DEPT-NBR'                          30920004
309300                               TO DP013-PARAGRAPH                 30930004
309400             MOVE 'UPDATE A ROW ON THE P.O. ON HOLD TABLE'        30940004
309500                               TO DP013-MESSAGE-TEXT(1)           30950004
309600             MOVE SQLCA        TO DP013-SQLCA                     30960004
309700             MOVE 'TTRPOHL'    TO DP013-DB2-TABLE-NAME (1)        30970004
309800             SET DP013-DB2-ABEND                                  30980004
309900                 DP013-XCTL-DISPLAY-RESTART TO TRUE               30990004
310000             PERFORM DP013-0000-PROCESS-ABEND                     31000004
310100     END-EVALUATE.                                                31010004
310200                                                                  31020004
310300                                                                  31030004
310400 Z860-GET-DEPARTMENT.                                             31040004
310500                                                                  31050004
310600     EXEC SQL                                                     31060004
310700          SELECT  DEPT                                            31070004
310800          INTO   :SKXREF-DEPT                                     31080004
310900          FROM    TSKXREF                                         31090004
311000          WHERE   SKU = :PV-SKXREF-SKU                            31100004
311100     END-EXEC.                                                    31110004
311200                                                                  31120004
311300     EVALUATE TRUE                                                31130004
311400         WHEN SQLCODE = ZERO                                      31140004
311500             MOVE SKXREF-DEPT TO PV-SKXREF-DEPT                   31150004
311600         WHEN SQLCODE = -904                                      31160004
311700         WHEN SQLCODE = -913                                      31170004
311800             SET PS-DATA-NOT-AVAILABLE TO TRUE                    31180004
311900         WHEN SQLWARN0 NOT = SPACES                               31190004
312000         WHEN SQLCODE  NOT = ZERO                                 31200004
312100             MOVE 'Z860-GET-DEPARTMENT'                           31210004
312200                               TO DP013-PARAGRAPH                 31220004
312300             MOVE 'SELECT A ROW ON THE TSKXREF TABLE'             31230004
312400                               TO DP013-MESSAGE-TEXT(1)           31240004
312500             MOVE SQLCA        TO DP013-SQLCA                     31250004
312600             MOVE 'TSKXREF'    TO DP013-DB2-TABLE-NAME (1)        31260004
312700             SET DP013-DB2-ABEND                                  31270004
312800                 DP013-XCTL-DISPLAY-RESTART TO TRUE               31280004
312900             PERFORM DP013-0000-PROCESS-ABEND                     31290004
313000     END-EVALUATE.                                                31300004
313100                                                                  31310004
313200                                                                  31320004
313300*-----------------------------------------------------------------31330004
313400*    ABEND PROCESSOR MODULE                                       31340004
313500*-----------------------------------------------------------------31350004
313600                                                                  31360004
313700     COPY DPPD013.                                                31370004
