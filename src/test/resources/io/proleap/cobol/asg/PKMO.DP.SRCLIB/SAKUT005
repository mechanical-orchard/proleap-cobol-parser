000100****************************************************************  00010003
000200 IDENTIFICATION DIVISION.                                         00020003
000300****************************************************************  00030003
000400                                                                  00040003
000500 PROGRAM-ID.         SAKUT005.                                    00050003
000600                                                                  00060003
000700 AUTHOR.             CRAIG VOSKUIL - STRATAGEM.                   00070003
000800                                                                  00080003
000900 INSTALLATION.       KOHLS DEPARTMENT STORES.                     00090003
001000                                                                  00100003
001100 DATE-WRITTEN.       JUNE 1999.                                   00110003
001200                                                                  00120003
001300 DATE-COMPILED.                                                   00130003
001400                                                                  00140003
001500******************************************************************00150003
001600*                                                                *00160003
001700*     THIS PROGRAM CREATES A CURRENCY DELIVERY DOWNLOAD FILE     *00170003
001800*     TO BE FTP'D TO FINANCE.                                    *00180003
001900*                                                                 00190003
002000*     SELECT TSAADSU ROWS AND EXTRACT STORE NUMBER, DATE         *00200003
002100*     AND CASH AMOUNT.                                           *00210003
002200*                                                                *00220003
002300*     THIS NEW FILE WILL BE DOWNLOADED TO THE LAN.               *00230003
002400*----------------------------------------------------------       00240003
002500* HISTORY LOG:                                                    00250003
002600*----------------------------------------------------------       00260003
002700* DATE: 09/29/04                                                  00270003
002800* WR/IR#: WR27107                                                 00280003
002900* PROGRAMMER: THOMAS HANSON                                       00290003
003000* DESCRIPTION: ALTER THE CURR/DLVRY EXTRACT FILE TO INCLUDE       00300003
003100*   A 4 DIGIT STORE NUMBER VALUE. INCREASES FILE SIZE BY 1.       00310003
003200*----------------------------------------------------------       00320003
003300******************************************************************00330003
003400     EJECT                                                        00340003
003500                                                                  00350003
003600****************************************************************  00360003
003700 ENVIRONMENT DIVISION.                                            00370003
003800****************************************************************  00380003
003900                                                                  00390003
004000 CONFIGURATION SECTION.                                           00400003
004100                                                                  00410003
004200 SOURCE-COMPUTER.    IBM-3090.                                    00420003
004300                                                                  00430003
004400 OBJECT-COMPUTER.    IBM-3090.                                    00440003
004500                                                                  00450003
004600 INPUT-OUTPUT SECTION.                                            00460003
004700                                                                  00470003
004800 FILE-CONTROL.                                                    00480003
004900                                                                  00490003
005000     SELECT FISCAL-MONTH-INPUT-FILE                               00500003
005100         ASSIGN TO INP01.                                         00510003
005200                                                                  00520003
005300     SELECT CURRENCY-DELIVERY-FILE                                00530003
005400         ASSIGN TO OUT01.                                         00540003
005500                                                                  00550003
005600     EJECT                                                        00560003
005700****************************************************************  00570003
005800 DATA DIVISION.                                                   00580003
005900****************************************************************  00590003
006000                                                                  00600003
006100 FILE SECTION.                                                    00610003
006200                                                                  00620003
006300 FD  FISCAL-MONTH-INPUT-FILE                                      00630003
006400     RECORDING MODE IS F                                          00640003
006500     RECORD CONTAINS 80 CHARACTERS                                00650003
006600     LABEL RECORDS ARE STANDARD                                   00660003
006700     BLOCK CONTAINS 0 RECORDS.                                    00670003
006800                                                                  00680003
006900 01  FISCAL-MONTH-INPUT-RECORD   PIC X(80).                       00690003
007000                                                                  00700003
007100 FD  CURRENCY-DELIVERY-FILE                                       00710003
007200     RECORDING MODE IS F                                          00720003
007300     RECORD CONTAINS 21 CHARACTERS                                00730003
007400     LABEL RECORDS ARE STANDARD                                   00740003
007500     BLOCK CONTAINS 0  RECORDS.                                   00750003
007600                                                                  00760003
007700 01  CURRENCY-DELIVERY-RECORD    PIC X(21).                       00770003
007800     EJECT                                                        00780003
007900****************************************************************  00790003
008000 WORKING-STORAGE SECTION.                                         00800003
008100****************************************************************  00810003
008200                                                                  00820003
008300 01  ABEND-CODE                  PIC S9(04) VALUE +0              00830003
008400                                                    COMP          00840003
008500                                                    SYNC.         00850003
008600                                                                  00860003
008700     88  AC-CURSOR-OPEN                             VALUE +4001.  00870003
008800     88  AC-CURSOR-CLOSE                            VALUE +4002.  00880003
008900     88  AC-CURSOR-FETCH                            VALUE +4003.  00890003
009000     88  AC-INVALID-CONTROL-CARD                    VALUE +4004.  00900003
009100     88  AC-CALENDAR-ROUTINE-ERROR                  VALUE +4005.  00910003
009200     88  AC-FILE-SEQUENCE-ERROR                     VALUE +4007.  00920003
009300     88  AC-DB2-ERROR                               VALUE +4013.  00930003
009400                                                                  00940003
009500     EJECT                                                        00950003
009600****************************************************************  00960003
009700*   CASH SALES EXTRACT RECORD LAYOUT - OUTPUT                     00970003
009800****************************************************************  00980003
009900                                                                  00990003
010000 01  CSE-CURRENCY-DELIVERY-REC.                                   01000003
010100     05  CSE-STORE               PIC  9(4)     VALUE ZEROES.      01010003
010200     05  FILLER                  PIC  X(1)     VALUE ','.         01020003
010300     05  CSE-DATE                PIC  9(6)     VALUE ZEROES.      01030003
010400     05  FILLER                  PIC  X(1)     VALUE ','.         01040003
010500     05  CSE-CURRENCY-DELIVERY   PIC  9(7)V99  VALUE ZEROES.      01050003
010600                                                                  01060003
010700****************************************************************  01070003
010800*    LAYOUT FOR THE INPUT FILE THAT INDICATES WHETHER OR NOT   *  01080003
010900*    IT IS FISCAL MONTH END                                    *  01090003
011000****************************************************************  01100003
011100                                                                  01110003
011200 01  FISCAL-MONTH-CONTROL-AREA.                                   01120003
011300     05  FM-CONTROL-DATE         PIC X(10)    VALUE SPACES.       01130003
011400     05  FM-CURRENT-DATE         PIC X(10)    VALUE SPACES.       01140003
011500     05  FM-LAST-WEEK-IND        PIC X(01)    VALUE SPACES.       01150003
011600         88  FM-LAST-FISCAL-WEEK              VALUE 'Y'.          01160003
011700         88  FM-NOT-LAST-FISCAL-WEEK          VALUE 'N'.          01170003
011800     05  FILLER                  PIC X(59)    VALUE SPACES.       01180003
011900                                                                  01190003
012000 01  PV-PROGRAM-VARIABLES.                                        01200003
012100     05  PV-RECORDS-WRITTEN      PIC S9(7)  VALUE +0 COMP-3.      01210003
012200     05  PV-DELIVERY-CURSOR-COUNT                                 01220003
012300                                 PIC S9(7) VALUE +0 COMP-3.       01230003
012400     05  PV-START-DATE           PIC X(10).                       01240003
012500     05  PV-END-DATE             PIC X(10).                       01250003
012600     05  PV-TNDR-TYP-CDE         PIC XX     VALUE SPACES.         01260003
012700     05  PV-PARAGRAPH-NAME       PIC X(30)  VALUE SPACES.         01270003
012800     05  PV-OPERATION-MSG-1      PIC X(40)  VALUE SPACES.         01280003
012900     05  PV-OPERATION-MSG-2      PIC X(40)  VALUE SPACES.         01290003
013000     05  PV-EDIT-MASK            PIC Z,ZZZ,ZZ9.                   01300003
013100     05  PV-DB2-ISO-DATE.                                         01310003
013200         10  PV-DB2-ISO-CC       PIC 99.                          01320003
013300         10  PV-DB2-ISO-YY       PIC 99.                          01330003
013400         10  FILLER              PIC X.                           01340003
013500         10  PV-DB2-ISO-MM       PIC 99.                          01350003
013600         10  FILLER              PIC X.                           01360003
013700         10  PV-DB2-ISO-DD       PIC 99.                          01370003
013800     05  PV-MDY-DATE             PIC 9(6).                        01380003
013900     05  FILLER REDEFINES PV-MDY-DATE.                            01390003
014000         10  PV-MDY-MM           PIC 99.                          01400003
014100         10  PV-MDY-DD           PIC 99.                          01410003
014200         10  PV-MDY-YY           PIC 99.                          01420003
014300                                                                  01430003
014400 01  PC-PROGRAM-CONSTANTS.                                        01440003
014500     05  PC-CURRENT-PROGRAM-NAME PIC X(8)   VALUE 'SAKUT005'.     01450003
014600     05  PC-CUR                  PIC XXX    VALUE 'CUD'.          01460003
014700     05  PC-ROW-NOT-FOUND        PIC S9(04) VALUE +100            01470003
014800                                            COMP SYNC.            01480003
014900                                                                  01490003
015000 01  PS-PROGRAM-SWITCHES.                                         01500003
015100     05  PS-END-OF-DELIVERY-CURSOR-SW    PIC X      VALUE 'N'.    01510003
015200         88 PS-END-OF-DELIVERY-CURSOR               VALUE 'Y'.    01520003
015300     05  PS-END-OF-FISCAL-FILE-SW        PIC X      VALUE 'N'.    01530003
015400         88 PS-END-OF-FISCAL-FILE                   VALUE 'Y'.    01540003
015500     EJECT                                                        01550003
015600******************************************************************01560003
015700*  PARAMETER LIST FOR THE CALENDAR ROUTINE (DPKUT500) *           01570003
015800******************************************************************01580003
015900     COPY DPWS500.                                                01590003
016000     EJECT                                                        01600003
016100******************************************************************01610003
016200*  DB2 COMMUNICATION AREA. *                                      01620003
016300******************************************************************01630003
016400     EXEC SQL                                                     01640003
016500          INCLUDE SQLCA                                           01650003
016600     END-EXEC.                                                    01660003
016700 EJECT                                                            01670003
016800******************************************************************01680003
016900*  DB2 TABLE TSAADSU - SUMMARY TABLE                             *01690003
017000******************************************************************01700003
017100     EXEC SQL                                                     01710003
017200          INCLUDE TSAADSU                                         01720003
017300     END-EXEC.                                                    01730003
017400 EJECT                                                            01740003
017500******************************************************************01750003
017600*  CURSOR FOR FETCHING TSAADSU                                   *01760003
017700*  ONLY GET DATA FOR THOSE STORES THAT HAVE STM <> 0.            *01770003
017800*  IF THEY DO NOT HAVE SALES ON A GIVEN DAY, THEY SHOULD NOT     *01780003
017900*  HAVE CURRENCY DELIVERY. THIS WOULD REPRESENT A HOLIDAY.       *01790003
018000*  THE ADJUSTED AMT (ADJ_AMT) IS USED BECAUSE THIS IS THE AUDITED*01800003
018100*  AMOUNT.                                                        01810003
018200******************************************************************01820003
018300     EXEC SQL                                                     01830003
018400         DECLARE DELIVERY-CURSOR CURSOR                           01840003
018500         FOR SELECT D.SLS_DTE                                     01850003
018600                   ,D.STR_NBR                                     01860003
018700                   ,D.SUM_CTG_CDE                                 01870003
018800                   ,D.ADJ_AMT                                     01880003
018900         FROM TSAADSU D                                           01890003
019000         WHERE D.SLS_DTE BETWEEN :PV-START-DATE AND :PV-END-DATE  01900003
019100         AND D.SUM_CTG_CDE = :PC-CUR                              01910003
019200                AND EXISTS                                        01920003
019300             (SELECT 1                                            01930003
019400                FROM TSAADSU T                                    01940003
019500               WHERE T.SLS_DTE     = D.SLS_DTE                    01950003
019600                 AND T.STR_NBR     = D.STR_NBR                    01960003
019700                 AND T.SUM_CTG_CDE = 'STM'                        01970003
019800                 AND T.ADJ_AMT    ^= 0)                           01980003
019900         ORDER BY D.SLS_DTE, D.STR_NBR                            01990003
020000         WITH UR                                                  02000003
020100     END-EXEC.                                                    02010003
020200 EJECT                                                            02020003
020300******************************************************************02030003
020400 PROCEDURE DIVISION.                                              02040003
020500******************************************************************02050003
020600                                                                  02060003
020700     PERFORM 1000-INITIALIZATION.                                 02070003
020800                                                                  02080003
020900     IF FM-LAST-FISCAL-WEEK                                       02090003
021000         PERFORM 2000-PROCESS-TRANFILE                            02100003
021100             UNTIL PS-END-OF-DELIVERY-CURSOR                      02110003
021200         PERFORM 8000-END-OF-JOB                                  02120003
021300     ELSE                                                         02130003
021400         DISPLAY 'WEEK ENDING DATE '                              02140003
021500                 FM-CONTROL-DATE                                  02150003
021600                 ' IS NOT THE LAST WEEK OF THE FISCAL MONTH'      02160003
021700         CLOSE FISCAL-MONTH-INPUT-FILE                            02170003
021800         CLOSE CURRENCY-DELIVERY-FILE                             02180003
021900         MOVE 4090                 TO RETURN-CODE                 02190003
022000     END-IF.                                                      02200003
022100                                                                  02210003
022200     STOP RUN.                                                    02220003
022300                                                                  02230003
022400******************************************************************02240003
022500*                                                                *02250003
022600*    INITIALIZATION ROUTINE, OPEN THE EXTRACT, ACCEPT THE        *02260003
022700*    CARD FROM SYSIN, PERFORM THE ROUTINE TO FIND THE FISCAL     *02270003
022800*    PERIOD AND PERFORM THE ROUTIN TO OPEN THE CURSOR.           *02280003
022900*                                                                *02290003
023000******************************************************************02300003
023100                                                                  02310003
023200 1000-INITIALIZATION.                                             02320003
023300                                                                  02330003
023400     OPEN  INPUT  FISCAL-MONTH-INPUT-FILE.                        02340003
023500     OPEN  OUTPUT CURRENCY-DELIVERY-FILE.                         02350003
023600                                                                  02360003
023700     READ FISCAL-MONTH-INPUT-FILE                                 02370003
023800         INTO FISCAL-MONTH-CONTROL-AREA                           02380003
023900         AT END SET PS-END-OF-FISCAL-FILE                         02390003
024000                                   TO TRUE.                       02400003
024100                                                                  02410003
024200     IF PS-END-OF-FISCAL-FILE                                     02420003
024300         MOVE '1000-INITIALIZATION'                               02430003
024400                                 TO PV-PARAGRAPH-NAME             02440003
024500         MOVE 'FISCAL MONTH FILE IS EMPTY'                        02450003
024600                                 TO PV-OPERATION-MSG-1            02460003
024700         SET AC-FILE-SEQUENCE-ERROR                               02470003
024800                                 TO TRUE                          02480003
024900         PERFORM 9999-ABEND                                       02490003
025000     END-IF.                                                      02500003
025100                                                                  02510003
025200     IF FM-LAST-FISCAL-WEEK                                       02520003
025300         PERFORM 1100-DATE-ROUTINE                                02530003
025400         PERFORM 1200-OPEN-DELIVERY-CURSOR                        02540003
025500         PERFORM 2100-FETCH-DELIVERY-CURSOR                       02550003
025600     END-IF.                                                      02560003
025700                                                                  02570003
025800     EJECT                                                        02580003
025900******************************************************************02590003
026000*                                                                *02600003
026100*    INITIALIZE THE CALL PARAMETERS, SET THE DATE INDICATORS,    *02610003
026200*    MOVE THE YEAR AND PERIOD TO THE INPUT AREA AND CALL THE     *02620003
026300*    ROUTINE AND CHECK FOR ERRORS.                               *02630003
026400*                                                                *02640003
026500******************************************************************02650003
026600 1100-DATE-ROUTINE.                                               02660003
026700                                                                  02670003
026800     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              02680003
026900                                                                  02690003
027000     SET  DPG51-FISCAL-454-CALENDAR    TO TRUE.                   02700003
027100     SET  DPG51-DO-NOT-INCR-DECR-DATE  TO TRUE.                   02710003
027200     SET  DPG52-LK-DTE-ISO-FMT         TO TRUE.                   02720003
027300     MOVE FM-CONTROL-DATE              TO DPG52-LK-DATE-INPUT.    02730003
027400                                                                  02740003
027500     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    02750003
027600                                             DPG54 DPG55 DPG56.   02760003
027700                                                                  02770003
027800     EVALUATE TRUE                                                02780003
027900         WHEN DPG54-SEVERE-ERROR                                  02790003
028000         WHEN DPG54-DATE-INVALID                                  02800003
028100             MOVE '1100-DATE-ROUTINE'                             02810003
028200                                           TO PV-PARAGRAPH-NAME   02820003
028300             MOVE 'ERROR CONVERTING INPUT CARD DATE'              02830003
028400                                           TO PV-OPERATION-MSG-1  02840003
028500             SET AC-CALENDAR-ROUTINE-ERROR TO TRUE                02850003
028600             MOVE DPG54-ERROR-MESSAGE      TO PV-OPERATION-MSG-2  02860003
028700             PERFORM 9999-ABEND                                   02870003
028800     END-EVALUATE.                                                02880003
028900                                                                  02890003
029000     MOVE DPG56-FIRST-FP-DB2-ISO-FMT   TO PV-START-DATE           02900003
029100     MOVE DPG56-LAST-FP-DB2-ISO-FMT    TO PV-END-DATE.            02910003
029200                                                                  02920003
029300     DISPLAY 'PV-START-DATE - ' PV-START-DATE                     02930003
029400     DISPLAY 'PV-END-DATE --- ' PV-END-DATE.                      02940003
029500                                                                  02950003
029600     EJECT                                                        02960003
029700******************************************************************02970003
029800*                                                                *02980003
029900*    OPEN THE DELIVERY CURSOR AND CHECK FOR ERRORS.              *02990003
030000*                                                                *03000003
030100******************************************************************03010003
030200                                                                  03020003
030300 1200-OPEN-DELIVERY-CURSOR.                                       03030003
030400                                                                  03040003
030500     EXEC SQL                                                     03050003
030600          OPEN DELIVERY-CURSOR                                    03060003
030700     END-EXEC.                                                    03070003
030800                                                                  03080003
030900     EVALUATE TRUE                                                03090003
031000         WHEN SQLCODE = ZERO                                      03100003
031100              CONTINUE                                            03110003
031200         WHEN SQLWARN0 NOT EQUAL SPACE                            03120003
031300         WHEN SQLCODE NOT EQUAL ZERO                              03130003
031400             MOVE '1200-OPEN-DELIVERY-CURSOR'                     03140003
031500                                 TO PV-PARAGRAPH-NAME             03150003
031600             MOVE 'ERROR ON OPEN OF DELIVERY-CURSOR'              03160003
031700                                 TO PV-OPERATION-MSG-1            03170003
031800             SET AC-CURSOR-OPEN  TO TRUE                          03180003
031900             PERFORM 9999-ABEND                                   03190003
032000     END-EVALUATE.                                                03200003
032100                                                                  03210003
032200     EJECT                                                        03220003
032300******************************************************************03230003
032400*                                                                *03240003
032500*    CHECK SEQUENCE, IF NON-MATCHING, WRITE THE EXTRACT          *03250003
032600*    RECORD AND INITIALIZE THE RECORD. MOVE THE AMOUNT TO        *03260003
032700*    EITHER THE CASH OR CHECK FIELD DEPENDING ON THE TYPE,       *03270003
032800*    PERFORM THE FET TO GET ANOTHER ROW FROM THE CURSOR.         *03280003
032900*                                                                *03290003
033000******************************************************************03300003
033100                                                                  03310003
033200 2000-PROCESS-TRANFILE.                                           03320003
033300                                                                  03330003
033400     MOVE SAADSU-STR-NBR         TO CSE-STORE.                    03340003
033500                                                                  03350003
033600     MOVE SAADSU-SLS-DTE         TO PV-DB2-ISO-DATE.              03360003
033700     MOVE PV-DB2-ISO-YY          TO PV-MDY-YY                     03370003
033800     MOVE PV-DB2-ISO-MM          TO PV-MDY-MM                     03380003
033900     MOVE PV-DB2-ISO-DD          TO PV-MDY-DD                     03390003
034000     MOVE PV-MDY-DATE            TO CSE-DATE                      03400003
034100                                                                  03410003
034200     MOVE SAADSU-ADJ-AMT         TO CSE-CURRENCY-DELIVERY         03420003
034300                                                                  03430003
034400     PERFORM 9000-WRITE-EXTRACT-RECORDS.                          03440003
034500                                                                  03450003
034600     PERFORM 2100-FETCH-DELIVERY-CURSOR.                          03460003
034700     EJECT                                                        03470003
034800******************************************************************03480003
034900*                                                                *03490003
035000*    FETCH THE DELIVERY CURSOR AND CHECK FOR ERRORS.             *03500003
035100*                                                                *03510003
035200******************************************************************03520003
035300                                                                  03530003
035400 2100-FETCH-DELIVERY-CURSOR.                                      03540003
035500                                                                  03550003
035600     EXEC SQL                                                     03560003
035700          FETCH DELIVERY-CURSOR                                   03570003
035800           INTO :SAADSU-SLS-DTE                                   03580003
035900               ,:SAADSU-STR-NBR                                   03590003
036000               ,:SAADSU-SUM-CTG-CDE                               03600003
036100               ,:SAADSU-ADJ-AMT                                   03610003
036200     END-EXEC.                                                    03620003
036300                                                                  03630003
036400     EVALUATE TRUE                                                03640003
036500         WHEN SQLCODE = ZERO                                      03650003
036600             ADD 1               TO PV-DELIVERY-CURSOR-COUNT      03660003
036700         WHEN SQLCODE = PC-ROW-NOT-FOUND                          03670003
036800             SET PS-END-OF-DELIVERY-CURSOR TO TRUE                03680003
036900         WHEN SQLWARN0 NOT EQUAL SPACE                            03690003
037000         WHEN SQLCODE NOT EQUAL ZERO                              03700003
037100             MOVE '2100-FETCH-DELIVERY-CURSOR'                    03710003
037200                                 TO PV-PARAGRAPH-NAME             03720003
037300             MOVE 'ERROR ON FETCH OF SETTLEMENT-CURSOR'           03730003
037400                                 TO PV-OPERATION-MSG-1            03740003
037500             SET AC-CURSOR-FETCH TO TRUE                          03750003
037600             PERFORM 9999-ABEND                                   03760003
037700     END-EVALUATE.                                                03770003
037800 EJECT                                                            03780003
037900 8000-END-OF-JOB.                                                 03790003
038000                                                                  03800003
038100     CLOSE FISCAL-MONTH-INPUT-FILE.                               03810003
038200     CLOSE CURRENCY-DELIVERY-FILE.                                03820003
038300                                                                  03830003
038400     PERFORM 8100-CLOSE-DELIVERY-CURSOR.                          03840003
038500                                                                  03850003
038600     DISPLAY '****************************************'           03860003
038700     DISPLAY '*************** SAKUT005 ***************'           03870003
038800     DISPLAY '****************************************'           03880003
038900     MOVE PV-DELIVERY-CURSOR-COUNT                                03890003
039000                                 TO PV-EDIT-MASK                  03900003
039100     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'          03910003
039200     DISPLAY 'DELIVERY ROWS FETCHED..........'                    03920003
039300         PV-EDIT-MASK                                             03930003
039400     MOVE PV-RECORDS-WRITTEN     TO PV-EDIT-MASK                  03940003
039500     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'          03950003
039600     DISPLAY 'EXTRACT RECORDS WRITTEN........'                    03960003
039700         PV-EDIT-MASK                                             03970003
039800     DISPLAY '****************************************'           03980003
039900     DISPLAY '****************************************'           03990003
040000     DISPLAY '****************************************'.          04000003
040100                                                                  04010003
040200     MOVE ZERO                     TO RETURN-CODE.                04020003
040300     EJECT                                                        04030003
040400******************************************************************04040003
040500*                                                                *04050003
040600*    CLOSE THE DELIVERY CURSOR AND CHECK FOR ERRORS.             *04060003
040700*                                                                *04070003
040800******************************************************************04080003
040900                                                                  04090003
041000 8100-CLOSE-DELIVERY-CURSOR.                                      04100003
041100                                                                  04110003
041200     EXEC SQL                                                     04120003
041300          CLOSE DELIVERY-CURSOR                                   04130003
041400     END-EXEC.                                                    04140003
041500                                                                  04150003
041600     EVALUATE TRUE                                                04160003
041700         WHEN SQLCODE = ZERO                                      04170003
041800              CONTINUE                                            04180003
041900         WHEN SQLWARN0 NOT EQUAL SPACE                            04190003
042000         WHEN SQLCODE NOT EQUAL ZERO                              04200003
042100             MOVE '8100-CLOSE-DELIVERY-CURSOR'                    04210003
042200                                 TO PV-PARAGRAPH-NAME             04220003
042300             MOVE 'ERROR ON CLOSE OF DELIVERY-CURSOR'             04230003
042400                                 TO PV-OPERATION-MSG-1            04240003
042500             SET AC-CURSOR-CLOSE TO TRUE                          04250003
042600             PERFORM 9999-ABEND                                   04260003
042700     END-EVALUATE.                                                04270003
042800 EJECT                                                            04280003
042900***************************************************************** 04290003
043000* THIS MODULE WRITES THE OUTPUT FILE RECORD.                      04300003
043100***************************************************************** 04310003
043200                                                                  04320003
043300 9000-WRITE-EXTRACT-RECORDS.                                      04330003
043400                                                                  04340003
043500     WRITE CURRENCY-DELIVERY-RECORD                               04350003
043600         FROM CSE-CURRENCY-DELIVERY-REC.                          04360003
043700                                                                  04370003
043800     ADD 1                       TO PV-RECORDS-WRITTEN.           04380003
043900                                                                  04390003
044000     EJECT                                                        04400003
044100******************************************************************04410003
044200* 9999-ABEND                                                      04420003
044300*     ABEND PROGRAM WHEN AN ERROR OCCURS.                         04430003
044400******************************************************************04440003
044500 9999-ABEND.                                                      04450003
044600     DISPLAY '** ABEND           **'.                             04460003
044700     DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  04470003
044800     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        04480003
044900     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       04490003
045000     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       04500003
045100     CALL 'ILBOABN0' USING ABEND-CODE.                            04510003
