000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    AHKUT653.                                         00020000
000300 AUTHOR.        BUDDY BARNES.                                     00030000
000400 INSTALLATION.  KOHLS.                                            00040000
000500 DATE-WRITTEN   JUN, 2011.                                        00050000
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800******************************************************************00080000
000900*  AHKUT653.   "ARCHIVE HISTORY" PROJECT. DATA OFFLOAD.          *00090000
001000*                                                                *00100000
001000*                                                                *00101000
001100*  PURPOSE:                                                      *00102000
001200*  THIS PROGRAM TAKES A DRIVER FILE OF ROWS EXTRACTED FROM       *00103000
001300*  TIMCNPO IN ORDER TO CREATE AN ARCHIVE FILE OF TIMBKPO         *00104000
001300*  WHICH WILL THEN BE USED TO DELETE ROWS FROM TIMBKPO           *00105000
001600*                                                                *00106000
001700*  PROCESSING OVERVIEW:                                          *00107000
001800*  THIS PROGRAM ACCESSES TIMBKPO AND USING A DRIVER FILE         *00108000
001900*  OF TIMCNPO ROWS CREATING AN OUTPUT FILE OF RECORDS CONTAINING:*00109000
002100*  1) THE FULL ROW OF DATA FROM TIMBKPO                          *00110000
002200*  THESE RECORDS ARE SORTED FOR EASE                             *00120000
002300*  AND EFFICIENCY OF SUBSEQUENT PROCESSING.                      *00130000
002400*                                                                *00140000
002500*  FOR EACH PO           RETURNED THE FULL ROW OF DATA IS WRITTEN*00150000
002600*  TO THE EXTRACT FILE TO BE USED FOR ARCHIVING AND DELETING.    *00160000
003000******************************************************************00170000
006020******************************************************************00180000
006030 ENVIRONMENT DIVISION.                                            00190000
006040 CONFIGURATION SECTION.                                           00200000
006050 SOURCE-COMPUTER.        IBM-3090.                                00210000
006060 OBJECT-COMPUTER.        IBM-3090.                                00220000
006070                                                                  00230000
006080 INPUT-OUTPUT SECTION.                                            00240000
006090 FILE-CONTROL.                                                    00250000
006100                                                                  00260000
006200     SELECT  IN-DRIVER-FILE               ASSIGN TO INP01.        00270000
006200     SELECT  OUT-ARCHIVE-FILE             ASSIGN TO OUT01.        00280000
006300                                                                  00290000
006400 DATA DIVISION.                                                   00300000
006500 FILE SECTION.                                                    00310000
006600                                                                  00320000
006700 FD  IN-DRIVER-FILE                                               00330000
006800     RECORDING MODE IS F                                          00340000
006900     LABEL RECORDS ARE STANDARD                                   00350000
007000     BLOCK CONTAINS 0 RECORDS.                                    00360000
007100 01  IN-DRIVER-RECORD                PIC  X(266).                 00370000
006600                                                                  00380000
006700 FD  OUT-ARCHIVE-FILE                                             00390000
006800     RECORDING MODE IS F                                          00391000
006900     LABEL RECORDS ARE STANDARD                                   00392000
007000     BLOCK CONTAINS 0 RECORDS.                                    00393000
007100 01  OUT-ARCHIVE-RECORD              PIC  X(460).                 00394002
007200                                                                  00395000
007300 WORKING-STORAGE SECTION.                                         00396000
007400                                                                  00397000
007500 01  PC-PROGRAM-CONSTANTS.                                        00398000
007600     05  PC-CURRENT-PROGRAM-NAME     PIC X(08) VALUE 'AHKUT653'.  00399000
007700     05  PC-PGM-PROGRESS-DESC.                                    00400000
007800         10  PC-BEGINNING            PIC X(09) VALUE 'BEGINNING'. 00410000
007800         10  PC-CONTINUING           PIC X(10) VALUE 'CONTINUING'.00420000
008500         10  PC-ENDING               PIC X(06) VALUE 'ENDING'.    00430000
008600         10  PC-ABENDING             PIC X(08) VALUE 'ABENDING'.  00440000
008700     05  PC-ABEND-INFO.                                           00450000
008800         10  PC-ABEND                PIC X(11) VALUE              00460000
008900                                               '** ABEND **'.     00470000
009000         10  PC-ABEND-MSG-PARA       PIC X(15) VALUE              00480000
009100                                               '- PARA       : '. 00490000
009200         10  PC-ABEND-MSG-DISPLAY-PARA                            00500000
009300                                     PIC X(15) VALUE              00510000
009400                                               '  CALLED PARA: '. 00520000
009500         10  PC-ABEND-MSG-NUMBER     PIC X(15) VALUE              00530000
009600                                               '  FOR ABEND# : '. 00540000
009700         10  PC-ABEND-MSG-DESC       PIC X(15) VALUE              00550000
009800                                               '- ERROR IS   : '. 00560000
009900         10  PC-ABEND-MSG-INDENT-15  PIC X(15) VALUE SPACES.      00570000
010000         10  PC-ABEND-MSG-ACTION     PIC X(15) VALUE              00580000
010100                                               '- ACTION     : '. 00590000
010200     05  PC-TEST-AND-SET-NULL-IND.                                00600000
010300         10  PC-NOT-NULL             PIC S9(4) COMP               00610000
010400                                               VALUE ZERO.        00620000
010500         10  PC-NULL                 PIC S9(4) COMP               00630000
010600                                               VALUE -1.          00640000
010700         10  PC-NULL-CONV-ERR        PIC S9(4) COMP               00650000
010800                                               VALUE -2.          00660000
010900         10  PC-NULLIF-QUESTION-MARK PIC X(01) VALUE '?'.         00670000
011000                                                                  00680000
011100     05  PC-HOW-OFTEN-TO-DISPLAY     PIC 9(9)  VALUE 010000.      00690000
011200                                                                  00700000
011300 01  PS-PROGRAM-SWITCHES.                                         00710000
011400     05  PS-TABLE-LOOP-DONE-SW       PIC X(01) VALUE 'N'.         00720000
011500         88  PS-TABLE-LOOP-DONE                VALUE 'Y'.         00730000
011600         88  PS-TABLE-LOOP-NOT-DONE            VALUE 'N'.         00740000
008900     05  PS-DRIVER-FILE-SW        PIC  X(01)    VALUE 'Y'.        00750000
009000         88  MORE-DRIVER                        VALUE 'Y'.        00760000
009100         88  END-OF-DRIVER                      VALUE 'N'.        00770000
012000                                                                  00780000
012100 01  PV-PROGRAM-VARIABLES.                                        00790000
012400     05  DISPLAY-PO-NBR              PIC  9(09) VALUE ZEROS.      00800002
012500     05  PV-PRG-TMST                 PIC X(26) VALUE SPACES.      00810000
012600     05  PV-PRG-TMST-DETAIL REDEFINES PV-PRG-TMST.                00820000
012700         10  PV-PRG-DATE             PIC X(10).                   00830000
012800         10  PV-PRG-TIME             PIC X(16).                   00840000
013000     05  PV-TABLE-ROW-FETCHED-CNT    PIC  9(9) VALUE 0.           00850000
013100     05  PV-ARCHIVE-WRITTEN-CNT       PIC  9(9) VALUE 0.          00860000
006800     05  PV-TIMCNPO-INPUT-COUNT   PIC 9(09)     VALUE ZERO        00870000
006900                                                COMP-3.           00871000
013800     05  PV-PARAGRAPH-NAME           PIC X(30) VALUE SPACES.      00872000
013900     05  PV-DB2-OPERATION-MSG-1      PIC X(79) VALUE SPACES.      00873000
014000     05  PV-DB2-TABLE-NAME-1         PIC X(18) VALUE SPACES.      00874000
014100     05  PV-DB2-TABLE-NAME-2         PIC X(18) VALUE SPACES.      00875000
014200     05  PV-DISPLAY-NTH-MULTIPLE     PIC 9(9)  VALUE 0.           00876000
014300     05  PV-DISPLAY-NTH-REMAINDER    PIC 9(9)  VALUE 0.           00877000
014400     05  PV-SQLCODE                  PIC +999  VALUE ZERO.        00878000
014500                                                                  00879000
014600     05  PV-TMST                     PIC X(26) VALUE SPACES.      00880000
014700     05  PV-TIMESTAMP-DETAIL                                      00890000
014800         REDEFINES                                                00900000
014900         PV-TMST.                                                 00910000
015000         10  PV-TIMESTAMP-19.                                     00920000
015100             15  PV-TMS-DATE.                                     00930000
015200                 20  PV-TMS-YEAR.                                 00940000
015300                     25  PV-TMS-CC   PIC X(02).                   00941000
015400                     25  PV-TMS-YY   PIC X(02).                   00942000
015500                 20  FILLER          PIC X(01).                   00943000
015600                 20  PV-TMS-MONTH    PIC X(02).                   00944000
015700                 20  FILLER          PIC X(01).                   00945000
015800                 20  PV-TMS-DAY      PIC X(02).                   00946000
015900             15  FILLER              PIC X(01).                   00947000
016000             15  PV-TMS-HOUR         PIC X(02).                   00948000
016100             15  FILLER              PIC X(01).                   00949000
016200             15  PV-TMS-MINUTE       PIC X(02).                   00949100
016300             15  FILLER              PIC X(01).                   00949200
016400             15  PV-TMS-SECOND       PIC X(02).                   00949300
016500         10  FILLER                  PIC X(01).                   00949400
016600         10  PV-TMS-MSECOND          PIC X(06).                   00949500
014500                                                                  00949600
018200*---------------------------------------------------------------* 00949700
018300*  RECORD LAYOUT FOR DRIVER FILE.                               * 00949800
018400*---------------------------------------------------------------* 00949900
018500     COPY AHRD008.                                                00950000
018700                                                                  00960000
018200*---------------------------------------------------------------* 00970000
018300*  RECORD LAYOUT FOR ARCHIVE FILE.                              * 00980000
018400*---------------------------------------------------------------* 00990000
018500     COPY AHRD018.                                                01000000
018700                                                                  01010000
018800 01  DM-DISPLAY-MESSAGE.                                          01020000
018900     05  DM-01-10.                                                01030000
019000         10  DM-PROGRAM              PIC X(08) VALUE SPACE.       01040000
019100         10  FILLER                  PIC X(02) VALUE ': '.        01050000
019200     05  DM-11-80.                                                01060000
019300         10  FILLER                  PIC X(27) VALUE              01070000
019400                                    'BEGIN DRIVER FILE CREATION.'.01080000
019500         10  FILLER                  PIC X(01) VALUE SPACE.       01090000
019600         10  FILLER                  PIC X(42) VALUE ALL '*'.     01100000
019700     05  DM-81-120.                                               01110000
019800         10  FILLER                  PIC X(40) VALUE ALL '*'.     01120000
019900                                                                  01130000
020000 01  DP-DISPLAY-PROGRESS-MSG.                                     01140000
020100     05  DP-PROGRAM                  PIC X(08) VALUE SPACE.       01150000
020200     05  FILLER                      PIC X(02) VALUE SPACE.       01160000
020300     05  DP-STATUS-DESCRIPTION       PIC X(13) VALUE SPACE.       01170000
020400     05  FILLER                      PIC X(04) VALUE ' AT '.      01180000
020500     05  DP-TIMESTAMP                PIC X(26) VALUE SPACE.       01190000
020600     05  FILLER                      PIC X(03) VALUE '.  '.       01200000
020700     05  FILLER                      PIC X(09) VALUE 'FETCHES: '. 01210000
020800     05  DP-TABLE-ROW-FETCHED-CNT    PIC ZZZ,ZZZ,ZZ9              01220000
020900                                               VALUE ZERO.        01230000
021000     05  FILLER                      PIC X(02) VALUE ', '.        01240000
021100     05  FILLER                      PIC X(09) VALUE 'WRITTEN: '. 01250000
021200     05  DP-DRIVER-WRITTEN-CNT       PIC ZZZ,ZZZ,ZZ9              01260000
021300                                               VALUE ZERO.        01270000
021400     05  FILLER                      PIC X(01) VALUE '.'.         01280000
021500                                                                  01290000
021600 01  ABEND-CODE                      PIC S9(04)                   01300000
021700                                               VALUE ZEROES       01310000
021800                                               COMP SYNC.         01320000
021900                                                                  01330000
022000*---------------------------------------------------------------* 01340000
022100*  DB2 FORMATTED MESSAGE AREA                                     01350000
022200*---------------------------------------------------------------* 01360000
022300     COPY DPWS004.                                                01370000
022400                                                                  01380000
022500*---------------------------------------------------------------* 01390000
022600*    DB2 AREA FOR TIMBKPO                                       * 01400000
022700*---------------------------------------------------------------* 01410000
022800     EXEC SQL                                                     01420000
022900          INCLUDE TIMBKPO                                         01430000
023000     END-EXEC.                                                    01440000
023100                                                                  01450000
023200*---------------------------------------------------------------* 01460000
023300*    DB2 AREA FOR SYSDUMMY                                      * 01470000
023400*---------------------------------------------------------------* 01480000
023500     EXEC SQL                                                     01490000
023600          INCLUDE SYSDUMMY                                        01500000
023700     END-EXEC.                                                    01510000
023800                                                                  01520000
023900*---------------------------------------------------------------* 01530000
024000*    DB2 AREA FOR COMMUNICATIONS                                * 01540000
024100*---------------------------------------------------------------* 01550000
024200     EXEC SQL                                                     01560000
024300          INCLUDE SQLCA                                           01570000
024400     END-EXEC.                                                    01580000
024500                                                                  01590000
024600*---------------------------------------------------------------* 01600000
024700*    DEFINE CURSOR FOR ACCESSING TIMBKPO                        * 01610000
024800*---------------------------------------------------------------* 01620000
024900     EXEC SQL                                                     01630000
025000         DECLARE TABLE-CURSOR CURSOR FOR                          01640000
025100           SELECT                                                 01650000
025200              PO_NBR                                              01660001
025300             ,PO_BKG_SEQ_NBR                                      01670001
025400             ,PO_BKG_DELY_TMST                                    01680001
025500             ,EXTL_REF_NBR                                        01690001
025600             ,ORGN_SHPD_FR_CDE                                    01700001
025700             ,CONSLR_SCAC_ID                                      01710001
025800             ,IMPRT_TRIP_ID                                       01720001
025800             ,DPRTR_TMST                                          01730001
025800             ,POE_DELY_TMST                                       01740001
025800             ,CARR_SCAC_ID                                        01750001
025800             ,FOB_CDE                                             01760001
025800             ,IMPRT_VEH_NM                                        01761001
025800             ,TRIP_TYP_CDE                                        01762001
025800             ,DEST_POE_CDE                                        01763001
025800             ,C_O_PROD_CDE                                        01764001
025800             ,PROD_FCTRY_NM                                       01765001
025800             ,PO_CART_CNT                                         01765101
025800             ,PO_CBMT_QTY                                         01765201
025800             ,PO_WT_KGRM_QTY                                      01765301
025800             ,PO_UNT_QTY                                          01765401
025800             ,PO_EXC_APVL_CDE                                     01765501
025800             ,PO_EXC_APVL_USR_ID                                  01765601
025800             ,PO_EXC_APVL_TMST                                    01765701
025800             ,PO_EXC_RSN_DESC                                     01765801
025800             ,EST_LBD_NM                                          01765901
025800             ,EST_LBD_TMST                                        01766001
025800             ,SHIPT_BKG_TMST                                      01766101
025800             ,VOY_CHG_RSN_DESC                                    01766201
025800             ,DAT_SRC_ENT_ID                                      01766301
025800             ,CRE_BY_USR_ID                                       01766401
025800             ,CRE_TMST                                            01766501
025800             ,LAST_UPD_BY_USR_ID                                  01766601
025800             ,LAST_UPD_TMST                                       01766701
027900             FROM TIMBKPO                                         01766801
028100            WHERE PO_NBR       = :AH008-PO-NBR                    01767000
028500         FOR FETCH ONLY                                           01769000
028600         WITH UR                                                  01770000
028700         OPTIMIZE FOR 1 ROW                                       01780000
028800     END-EXEC.                                                    01790000
029000                                                                  01800000
029100 PROCEDURE DIVISION.                                              01810000
029200                                                                  01820000
029300 0000-PROGRAM-MAINLINE.                                           01830000
029400                                                                  01840000
029500     PERFORM 1000-INITIALIZE.                                     01850000
029600                                                                  01860000
029700     PERFORM 1500-READ-DRIVER-RECORD                              01870000
029800         UNTIL END-OF-DRIVER.                                     01880000
029900                                                                  01890000
030000     PERFORM 6000-EOJ-ROUTINE.                                    01900000
030100     STOP RUN.                                                    01910000
030200                                                                  01920000
030400******************************************************************01930000
030500*  INITIALIZATIONS                                               *01940000
030600******************************************************************01950000
030700 1000-INITIALIZE.                                                 01960000
030800                                                                  01970000
030900     MOVE PC-CURRENT-PROGRAM-NAME TO DM-PROGRAM.                  01980000
031000     DISPLAY DM-DISPLAY-MESSAGE.                                  01990000
031400                                                                  02000000
031500     OPEN INPUT  IN-DRIVER-FILE.                                  02010000
031500     OPEN OUTPUT OUT-ARCHIVE-FILE.                                02020000
031200     MOVE PC-BEGINNING            TO DP-STATUS-DESCRIPTION.       02030000
032500     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           02040000
033100     INITIALIZE DCLTIMBKPO                                        02050000
033200                AH008-ARCHIVE-RECORD-LAYOUT.                      02060000
033800                                                                  02070000
031200 1500-READ-DRIVER-RECORD.                                         02080000
031400     READ IN-DRIVER-FILE INTO AH008-ARCHIVE-RECORD-LAYOUT         02090000
031600          AT END SET END-OF-DRIVER  TO TRUE.                      02100000
031700                                                                  02110000
031800     IF MORE-DRIVER                                               02120000
031900         ADD 1 TO PV-TIMCNPO-INPUT-COUNT                          02130000
029600                                                                  02140000
032600         SET PS-TABLE-LOOP-NOT-DONE TO TRUE                       02150000
032700         PERFORM 9100-OPEN-TABLE-CURSOR                           02160000
033000                                                                  02170000
029700         PERFORM 2000-GET-NEXT-FROM-CURSOR                        02180000
029800             UNTIL PS-TABLE-LOOP-DONE                             02190000
                                                                        02200000
032700         PERFORM 9130-CLOSE-TABLE-CURSOR                          02210000
032000     END-IF.                                                      02220000
                                                                        02230000
033900******************************************************************02240000
034000*  FETCH NEXT FROM CURSOR & WRITE OUTPUT DRIVER FILE RECORD.     *02250000
034100******************************************************************02260000
034200 2000-GET-NEXT-FROM-CURSOR.                                       02270000
034300                                                                  02280000
036900     PERFORM 9110-FETCH-TABLE-CURSOR.                             02290000
           IF SQLCODE = 0                                               02300000
034400         MOVE  IMBKPO-PO-NBR       TO DISPLAY-PO-NBR              02310000
034410*        DISPLAY 'FETCHED BOOKING PONBR = ' DISPLAY-PO-NBR        02320000
034610                                                                  02330000
036100         PERFORM 2010-POPULATE-ARCHIVE-RECORD                     02340000
036200         PERFORM 9650-WRITE-ARCHIVE-RECORD                        02350000
036300         PERFORM 2100-CHECK-PGM-PROGRESS                          02360000
036600     END-IF.                                                      02370000
037100******************************************************************02380000
037200*  MOVE COLUMNS FROM TABLES TO FIELDS IN ARCHIVE FILE RECORD.    *02390000
037300******************************************************************02400000
037400 2010-POPULATE-ARCHIVE-RECORD.                                    02410000
037500                                                                  02420000
           MOVE IMBKPO-PO-NBR             TO AH018-PO-NBR.              02430001
           MOVE IMBKPO-PO-BKG-SEQ-NBR     TO AH018-PO-BKG-SEQ-NBR.      02440001
           MOVE IMBKPO-PO-BKG-DELY-TMST   TO AH018-PO-BKG-DELY-TMST.    02450001
           MOVE IMBKPO-EXTL-REF-NBR       TO AH018-EXTL-REF-NBR.        02460001
           MOVE IMBKPO-ORGN-SHPD-FR-CDE   TO AH018-ORGN-SHPD-FR-CDE.    02470001
           MOVE IMBKPO-CONSLR-SCAC-ID     TO AH018-CONSLR-SCAC-ID.      02480001
           MOVE IMBKPO-IMPRT-TRIP-ID      TO AH018-IMPRT-TRIP-ID.       02490001
           MOVE IMBKPO-DPRTR-TMST         TO AH018-DPRTR-TMST.          02500001
           MOVE IMBKPO-POE-DELY-TMST      TO AH018-POE-DELY-TMST.       02510001
           MOVE IMBKPO-CARR-SCAC-ID       TO AH018-CARR-SCAC-ID.        02520001
           MOVE IMBKPO-FOB-CDE            TO AH018-FOB-CDE.             02530001
           MOVE IMBKPO-IMPRT-VEH-NM       TO AH018-IMPRT-VEH-NM.        02540001
           MOVE IMBKPO-TRIP-TYP-CDE       TO AH018-TRIP-TYP-CDE.        02550001
           MOVE IMBKPO-DEST-POE-CDE       TO AH018-DEST-POE-CDE.        02560001
           MOVE IMBKPO-C-O-PROD-CDE       TO AH018-C-O-PROD-CDE.        02561001
           MOVE IMBKPO-PROD-FCTRY-NM      TO AH018-PROD-FCTRY-NM.       02562001
           MOVE IMBKPO-PO-CART-CNT        TO AH018-PO-CART-CNT.         02562101
           MOVE IMBKPO-PO-CBMT-QTY        TO AH018-PO-CBMT-QTY.         02562201
           MOVE IMBKPO-PO-WT-KGRM-QTY     TO AH018-PO-WT-KGRM-QTY.      02562301
           MOVE IMBKPO-PO-UNT-QTY         TO AH018-PO-UNT-QTY.          02562401
           MOVE IMBKPO-PO-EXC-APVL-CDE    TO AH018-PO-EXC-APVL-CDE.     02562501
           MOVE IMBKPO-PO-EXC-APVL-USR-ID TO AH018-PO-EXC-APVL-USR-ID.  02562601
           MOVE IMBKPO-PO-EXC-APVL-TMST   TO AH018-PO-EXC-APVL-TMST.    02562701
           MOVE IMBKPO-PO-EXC-RSN-DESC    TO AH018-PO-EXC-RSN-DESC.     02562801
           MOVE IMBKPO-EST-LBD-NM         TO AH018-EST-LBD-NM.          02562901
           MOVE IMBKPO-EST-LBD-TMST       TO AH018-EST-LBD-TMST.        02563001
           MOVE IMBKPO-SHIPT-BKG-TMST     TO AH018-SHIPT-BKG-TMST.      02563101
           MOVE IMBKPO-VOY-CHG-RSN-DESC   TO AH018-VOY-CHG-RSN-DESC.    02563201
           MOVE IMBKPO-DAT-SRC-ENT-ID     TO AH018-DAT-SRC-ENT-ID.      02563301
           MOVE IMBKPO-CRE-BY-USR-ID      TO AH018-CRE-BY-USR-ID.       02563401
           MOVE IMBKPO-CRE-TMST           TO AH018-CRE-TMST.            02563501
           MOVE IMBKPO-LAST-UPD-BY-USR-ID TO AH018-LAST-UPD-BY-USR-ID.  02563601
           MOVE IMBKPO-LAST-UPD-TMST      TO AH018-LAST-UPD-TMST.       02563701
042200                                                                  02563801
040700******************************************************************02564000
040800*      EVERY NTH RECORD (IE: INITIAL SETTING 1000), REPORT       *02565000
040900*      RECORD COUNT AND CURRENT DATE/TIME.  THIS WILL ASSIST     *02566000
041000*      WITH RUN-TIME ESTIMATE OF TIME REMAINING TO COMPLETE.     *02567000
041100******************************************************************02568000
041200 2100-CHECK-PGM-PROGRESS.                                         02569000
041300     DIVIDE    PV-ARCHIVE-WRITTEN-CNT                             02570000
041400         BY        PC-HOW-OFTEN-TO-DISPLAY                        02580000
041500         GIVING    PV-DISPLAY-NTH-MULTIPLE                        02590000
041600         REMAINDER PV-DISPLAY-NTH-REMAINDER.                      02600000
041700                                                                  02610000
041800     IF PV-DISPLAY-NTH-REMAINDER = ZERO                           02620000
041900         MOVE PC-CONTINUING         TO DP-STATUS-DESCRIPTION      02630000
042000         PERFORM 6200-DISPLAY-PGM-PROGRESS                        02640000
042100     END-IF.                                                      02650000
042200                                                                  02660000
046400******************************************************************02670000
046500*  CLOSE CURSOR & OUTPUT FILE, DISPLAY END OF RUN MESSAGE.       *02680000
046600******************************************************************02690000
046700 6000-EOJ-ROUTINE.                                                02700000
046800                                                                  02710000
047100     CLOSE IN-DRIVER-FILE.                                        02720000
047100     CLOSE OUT-ARCHIVE-FILE.                                      02730000
047200                                                                  02740000
046900     MOVE PC-ENDING  TO  DP-STATUS-DESCRIPTION.                   02750000
047500     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           02760000
047600                                                                  02770000
047700     DISPLAY 'TOTAL PO TRACKING BOOKINGS      = '                 02780000
047700                                  PV-ARCHIVE-WRITTEN-CNT.         02790000
047900                                                                  02800000
048000******************************************************************02810000
048100*  DISPLAY PROGRAM PROGRESS.                                     *02820000
048200******************************************************************02830000
048300 6200-DISPLAY-PGM-PROGRESS.                                       02840000
048400                                                                  02850000
048500     EXEC SQL                                                     02860000
048600          SET :PV-TMST = CURRENT TIMESTAMP                        02870000
048700     END-EXEC.                                                    02880000
048800                                                                  02890000
048900     MOVE PC-CURRENT-PROGRAM-NAME   TO DP-PROGRAM.                02900000
049000     MOVE PV-TMST                   TO DP-TIMESTAMP.              02910000
049100     MOVE PV-TABLE-ROW-FETCHED-CNT  TO DP-TABLE-ROW-FETCHED-CNT.  02920000
049200     MOVE PV-ARCHIVE-WRITTEN-CNT     TO DP-DRIVER-WRITTEN-CNT.    02930000
049300                                                                  02940000
049400     DISPLAY DP-DISPLAY-PROGRESS-MSG.                             02950000
049600                                                                  02960000
049700******************************************************************02970000
049800*  OPEN   TABLE CURSOR                                           *02980000
049900******************************************************************02990000
050000 9100-OPEN-TABLE-CURSOR.                                          03000000
050100     EXEC SQL                                                     03010000
050200          OPEN TABLE-CURSOR                                       03020000
050300     END-EXEC.                                                    03030000
050400                                                                  03040000
050500     EVALUATE TRUE                                                03050000
050600         WHEN SQLCODE = ZERO                                      03060000
050700              CONTINUE                                            03070000
050800         WHEN SQLCODE = +100                                      03080000
050900              SET PS-TABLE-LOOP-DONE TO TRUE                      03090000
051000              MOVE '9100-OPEN-TABLE-CURSOR'                       03100000
051100                                 TO PV-PARAGRAPH-NAME             03110000
051200              MOVE 'OPEN TABLE CURSOR - NO ROWS SELECTED'         03120000
051300                                 TO PV-DB2-OPERATION-MSG-1        03130000
051400              MOVE 'TIMBKPO' TO PV-DB2-TABLE-NAME-1               03140000
051500              MOVE SPACES        TO PV-DB2-TABLE-NAME-2           03150000
051600              PERFORM 9999-DB2-ABEND                              03160000
051700         WHEN SQLWARN0 NOT EQUAL SPACE                            03170000
051800         WHEN SQLCODE  NOT EQUAL ZERO                             03180000
051900              MOVE '9100-OPEN-TABLE-CURSOR'                       03190000
052000                                 TO PV-PARAGRAPH-NAME             03200000
052100              MOVE 'OPEN TABLE CURSOR'                            03210000
052200                                 TO PV-DB2-OPERATION-MSG-1        03220000
052300              MOVE 'TIMBKPO' TO PV-DB2-TABLE-NAME-1               03230000
052400              MOVE SPACES        TO PV-DB2-TABLE-NAME-2           03240000
052500              PERFORM 9999-DB2-ABEND                              03250000
052600     END-EVALUATE.                                                03260000
052700                                                                  03270000
052900******************************************************************03280000
053000*  FETCH TABLE CURSOR                                            *03290000
053100******************************************************************03300000
053200 9110-FETCH-TABLE-CURSOR.                                         03310000
053300     EXEC SQL                                                     03320000
053400         FETCH TABLE-CURSOR                                       03330000
053500          INTO  :IMBKPO-PO-NBR                                    03340001
053600               ,:IMBKPO-PO-BKG-SEQ-NBR                            03350001
053700               ,:IMBKPO-PO-BKG-DELY-TMST                          03360001
053800               ,:IMBKPO-EXTL-REF-NBR                              03370001
053900               ,:IMBKPO-ORGN-SHPD-FR-CDE                          03380001
054000               ,:IMBKPO-CONSLR-SCAC-ID                            03390001
054100               ,:IMBKPO-IMPRT-TRIP-ID                             03400001
054100               ,:IMBKPO-DPRTR-TMST                                03410001
054100               ,:IMBKPO-POE-DELY-TMST                             03420001
054100               ,:IMBKPO-CARR-SCAC-ID                              03430001
054100               ,:IMBKPO-FOB-CDE                                   03440001
054100               ,:IMBKPO-IMPRT-VEH-NM                              03450001
054100               ,:IMBKPO-TRIP-TYP-CDE                              03460001
054100               ,:IMBKPO-DEST-POE-CDE                              03470001
054100               ,:IMBKPO-C-O-PROD-CDE                              03480001
054100               ,:IMBKPO-PROD-FCTRY-NM                             03490001
054100               ,:IMBKPO-PO-CART-CNT                               03491001
054100               ,:IMBKPO-PO-CBMT-QTY                               03492001
054100               ,:IMBKPO-PO-WT-KGRM-QTY                            03493001
054100               ,:IMBKPO-PO-UNT-QTY                                03494001
054100               ,:IMBKPO-PO-EXC-APVL-CDE                           03495001
054100               ,:IMBKPO-PO-EXC-APVL-USR-ID                        03496001
054100               ,:IMBKPO-PO-EXC-APVL-TMST                          03497001
054100               ,:IMBKPO-PO-EXC-RSN-DESC                           03498001
054100               ,:IMBKPO-EST-LBD-NM                                03499001
054100               ,:IMBKPO-EST-LBD-TMST                              03499101
054100               ,:IMBKPO-SHIPT-BKG-TMST                            03499201
054100               ,:IMBKPO-VOY-CHG-RSN-DESC                          03499301
054100               ,:IMBKPO-DAT-SRC-ENT-ID                            03499401
054100               ,:IMBKPO-CRE-BY-USR-ID                             03499501
054100               ,:IMBKPO-CRE-TMST                                  03499601
054100               ,:IMBKPO-LAST-UPD-BY-USR-ID                        03499701
054100               ,:IMBKPO-LAST-UPD-TMST                             03499801
056300     END-EXEC.                                                    03500000
056400                                                                  03510000
056500     EVALUATE TRUE                                                03520000
056600         WHEN SQLCODE = ZERO                                      03530000
056700              ADD +1                 TO PV-TABLE-ROW-FETCHED-CNT  03540000
056800         WHEN SQLCODE = +100                                      03550000
056900              SET PS-TABLE-LOOP-DONE TO TRUE                      03560000
057000         WHEN SQLWARN0 NOT EQUAL SPACE                            03570000
057100         WHEN SQLCODE NOT EQUAL ZERO                              03580000
057200              MOVE '9110-FETCH-TABLE-CURSOR'                      03590000
057300                                 TO PV-PARAGRAPH-NAME             03600000
057400              MOVE 'FETCH TABLE CURSOR'                           03610000
057500                                 TO PV-DB2-OPERATION-MSG-1        03620000
057600              MOVE 'TIMBKPO' TO PV-DB2-TABLE-NAME-1               03630000
057700              MOVE SPACES        TO PV-DB2-TABLE-NAME-2           03640000
057800              PERFORM 9999-DB2-ABEND                              03650000
057900     END-EVALUATE.                                                03660000
058100                                                                  03670000
058200******************************************************************03680000
058300*  CLOSE TABLE CURSOR                                            *03690000
058400******************************************************************03700000
058500 9130-CLOSE-TABLE-CURSOR.                                         03710000
058600     EXEC SQL                                                     03720000
058700          CLOSE TABLE-CURSOR                                      03730000
058800     END-EXEC.                                                    03740000
058900                                                                  03750000
059000     EVALUATE TRUE                                                03760000
059100         WHEN SQLCODE = ZERO                                      03770000
059200              CONTINUE                                            03780000
059300         WHEN SQLWARN0 NOT EQUAL SPACE                            03790000
059400         WHEN SQLCODE NOT EQUAL ZERO                              03800000
059500              MOVE '9130-CLOSE-TABLE-CURSOR'                      03810000
059600                                 TO PV-PARAGRAPH-NAME             03820000
059700              MOVE 'CLOSE TABLE CURSOR'                           03830000
059800                                 TO PV-DB2-OPERATION-MSG-1        03840000
059900              MOVE 'TIMBKPO' TO PV-DB2-TABLE-NAME-1               03850000
060000              MOVE SPACES        TO PV-DB2-TABLE-NAME-2           03860000
060100              PERFORM 9999-DB2-ABEND                              03870000
060200     END-EVALUATE.                                                03880000
060600                                                                  03890000
060700******************************************************************03900000
060800*  WRITE A RECORD TO THE ARCHIVE FILE                            *03910000
060900******************************************************************03920000
061000 9650-WRITE-ARCHIVE-RECORD.                                       03930000
061100     WRITE  OUT-ARCHIVE-RECORD  FROM  AH018-ARCHIVE-RECORD-LAYOUT.03940000
061200     ADD +1 TO PV-ARCHIVE-WRITTEN-CNT.                            03950000
061400                                                                  03960000
061700******************************************************************03970000
061800*  DISPLAY INFORMATION NEEDED FOR DEBUGGING/MAINTENANCE/SUPPORT  *03980000
061900*  AND CALL THE ABEND PROCESSOR IN THE EVENT THAT AN             *03990000
062000*  SQL ERROR OR WARNING CODE OCCURS.                             *04000000
062100******************************************************************04010000
062200 9999-DB2-ABEND.                                                  04020000
062300     DISPLAY PC-CURRENT-PROGRAM-NAME                              04030000
062400             ' 9999-DB2-ABEND'.                                   04040000
062500     DISPLAY PC-CURRENT-PROGRAM-NAME                              04050000
062600             ' ** ABEND           **'.                            04060000
062700     DISPLAY PC-CURRENT-PROGRAM-NAME                              04070000
062800             ' ** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.       04080000
062900     DISPLAY PC-CURRENT-PROGRAM-NAME                              04090000
063000             ' ** TABLES AFFECTED ** = ' PV-DB2-TABLE-NAME-1.     04100000
063100     DISPLAY PC-CURRENT-PROGRAM-NAME                              04110000
063200             ' **                 ** = ' PV-DB2-TABLE-NAME-2.     04120000
063300     DISPLAY PC-CURRENT-PROGRAM-NAME                              04130000
063400             ' ** OPERATION       ** = ' PV-DB2-OPERATION-MSG-1.  04140000
063500                                                                  04150000
063600     DISPLAY PC-CURRENT-PROGRAM-NAME                              04160000
063700             ' ** SQLCODE         ** = ' SQLCODE.                 04170000
063800     MOVE SQLCODE TO PV-SQLCODE.                                  04180000
063900     DISPLAY PC-CURRENT-PROGRAM-NAME                              04190000
064000             ' ** PV-SQLCODE      ** = ' PV-SQLCODE '.'.          04200000
064100                                                                  04210000
064200     DISPLAY PC-CURRENT-PROGRAM-NAME                              04220000
064300             ' ** SQLWARN0        ** = ' SQLWARN0 '.'.            04230000
064400                                                                  04240000
064600*----------------------------------------------------------------*04250000
064700* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *04260000
064800* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *04270000
064900* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *04280000
065000* FORMAT.                                                        *04290000
065100*----------------------------------------------------------------*04300000
065200     COPY DPPD004.                                                04310000
065300                                                                  04320000
065400     MOVE PC-ABENDING               TO DP-STATUS-DESCRIPTION.     04330000
065500     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           04340000
065700                                                                  04350000
065800*----------------------------------------------------------------*04360000
065900* CALL ABEND                                                     *04370000
066000*----------------------------------------------------------------*04380000
066100     MOVE +4013                  TO ABEND-CODE.                   04390000
066200     CALL 'ILBOABN0' USING ABEND-CODE.                            04400000
