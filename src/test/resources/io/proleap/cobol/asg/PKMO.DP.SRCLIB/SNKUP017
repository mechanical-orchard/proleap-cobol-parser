000100 ID DIVISION.                                                     00010000
000200                                                                  00020000
000300 PROGRAM-ID.    SNKUP017.                                         00030000
000400                                                                  00040000
000500 AUTHOR.        ANNE YEKO.                                        00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  NOVEMBER, 1992.                                   00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000******************************************************************00100000
001100*   THIS PROGRAM WILL READ AN INPUT FILE CREATED IN EITHER      **00110000
001200*   SNKUP007 OR SNKUP008.  THE KEY INFORMATION FROM THE INPUT   **00120000
001300*   FILE IS USED TO DELETE ROWS FROM THE ASNDTL TABLE.          **00130000
001400******************************************************************00140000
001500* CHANGED __/__/__ BY ____________                              **00150000
001600*   P_________  ________________________________________________**00160000
001700*               ________________________________________________**00170000
001800*                                                               **00180000
001900******************************************************************00190000
002000                                                                  00200000
002100     EJECT                                                        00210000
002200                                                                  00220000
002300 ENVIRONMENT DIVISION.                                            00230000
002400                                                                  00240000
002500 INPUT-OUTPUT SECTION.                                            00250000
002600                                                                  00260000
002700 FILE-CONTROL.                                                    00270000
002800                                                                  00280000
002900     SELECT ASNHDR-DELETE-FILE                                    00290000
003000            ASSIGN TO INP01.                                      00300000
003100                                                                  00310000
003200 DATA DIVISION.                                                   00320000
003300                                                                  00330000
003400 FILE SECTION.                                                    00340000
003500                                                                  00350000
003600 FD  ASNHDR-DELETE-FILE                                           00360000
003700     RECORDING MODE IS F                                          00370000
003800     LABEL RECORDS ARE STANDARD                                   00380000
003900     RECORD CONTAINS 05 CHARACTERS                                00390000
004000     BLOCK CONTAINS 0 RECORDS.                                    00400000
004100                                                                  00410000
004200 01  ASNHDR-DELETE-RECORD        PIC X(05).                       00420000
004300                                                                  00430000
004400     EJECT                                                        00440000
004500 WORKING-STORAGE SECTION.                                         00450000
004600                                                                  00460000
004700 01  FILLER.                                                      00470000
004800     05  FILLER                  PIC  X(36)  VALUE                00480000
004900         ' ***** WORKING STORAGE PGM=SNKUP017 '.                  00490000
005000     05  PGM-COMPILED            PIC  X(20)  VALUE SPACE.         00500000
005100     05  FILLER                  PIC  X(10)  VALUE                00510000
005200         ' LOCATION='.                                            00520000
005300     05  PGM-LOCATION            PIC  X(04)  VALUE SPACE.         00530000
005400     05  FILLER                  PIC  X(06)  VALUE                00540000
005500         ' *****'.                                                00550000
005600                                                                  00560000
005700 01  ABEND-CODE                  PIC S9(04)  VALUE ZERO           00570000
005800                                             COMP SYNC.           00580000
005900                                                                  00590000
006000 01  ABEND-PARAGRAPH             PIC  X(30)  VALUE SPACE.         00600000
006100                                                                  00610000
006200     EJECT                                                        00620000
006300 01  PC-PROGRAM-CONSTANTS.                                        00630000
006400     05  PC-Y                    PIC  X(01)  VALUE 'Y'.           00640000
006500     05  PC-N                    PIC  X(01)  VALUE 'N'.           00650000
006600                                                                  00660000
006700 01  PS-PROGRAM-SWITCHES.                                         00670000
006800     05  PS-END-OF-INPUT-SW      PIC  X(01)  VALUE 'N'.           00680000
006900         88 PS-END-OF-INPUT                  VALUE 'Y'.           00690000
007000                                                                  00700000
007100 01  PS-PROGRAM-VARIABLES.                                        00710000
007200     05  PV-RECS-READ            PIC  S9(7)  VALUE +0             00720000
007300                                             COMP-3.              00730000
007400     05  PV-RECS-DELETED         PIC  S9(7)  VALUE +0             00740000
007500                                             COMP-3.              00750000
007600     05  PV-DELETE-COUNTER       PIC  S9(3)  VALUE +0             00760000
007700                                             COMP-3.              00770000
007710     05  PV-COUNT-CHECK          PIC   9(2)  VALUE ZERO.          00771001
007720     05  PV-DISPLAY-ASNHDR-ID    PIC   9(18) VALUE ZERO.          00772007
007800                                                                  00780000
007900*    ASNHDR DELETE RECORD LAYOUT                                  00790000
008000                                                                  00800000
008100     COPY SNRD002I.                                               00810000
008200     EJECT                                                        00820000
008300******************************************************************00830000
008400*    DB2 DATABASE AREA                                            00840000
008500******************************************************************00850000
008600                                                                  00860000
008700*    ASN DETAIL                                                   00870000
008800                                                                  00880000
008900     EXEC SQL                                                     00890000
009000         INCLUDE TASNDTL                                          00900000
009100     END-EXEC.                                                    00910000
009200                                                                  00920000
009300     EJECT                                                        00930000
009400*    SQL COMMUNICATION AREA                                       00940000
009500                                                                  00950000
009600     EXEC SQL                                                     00960000
009700         INCLUDE SQLCA                                            00970000
009800     END-EXEC.                                                    00980000
009900     EJECT                                                        00990000
010000*    SQL COMMUNICATION AREA 2                                     01000000
010100                                                                  01010000
010200     COPY SQLCA2.                                                 01020000
010300     EJECT                                                        01030000
010400                                                                  01040000
010500***************************************************************** 01050000
010600 PROCEDURE DIVISION.                                              01060000
010700***************************************************************** 01070000
010800                                                                  01080000
010900 A000-MAIN-DRIVER.                                                01090000
011000                                                                  01100000
011100     MOVE 'A000'                 TO PGM-LOCATION.                 01110000
011200     MOVE WHEN-COMPILED          TO PGM-COMPILED.                 01120000
011300                                                                  01130000
011400     OPEN INPUT ASNHDR-DELETE-FILE.                               01140000
011410     ACCEPT PV-COUNT-CHECK FROM SYSIN.                            01141001
011500                                                                  01150000
011600     PERFORM B200-READ-INPUT-FILE.                                01160000
011700                                                                  01170000
011800     PERFORM B100-DELETE-ROWS                                     01180000
011900       UNTIL PS-END-OF-INPUT.                                     01190000
012000                                                                  01200000
012100     DISPLAY 'SNKUP017 RECORDS READ:    ' PV-RECS-READ.           01210000
012200     DISPLAY 'SNKUP017 RECORDS DELETED: ' PV-RECS-DELETED.        01220000
012300                                                                  01230000
012400     CLOSE ASNHDR-DELETE-FILE.                                    01240000
012500                                                                  01250000
012600     GOBACK.                                                      01260000
012700                                                                  01270000
012800     EJECT                                                        01280000
012900                                                                  01290000
013000***************************************************************** 01300000
013100*    THIS PARAGRAPH CONTROLS THE MAIN PROCESSING OF THE PROGRAM   01310000
013200***************************************************************** 01320000
013300 B100-DELETE-ROWS.                                                01330000
013400                                                                  01340000
013500     MOVE 'B100'                 TO PGM-LOCATION.                 01350000
013600     MOVE 'B100-DELETE-ROWS          '                            01360000
013700                                 TO ABEND-PARAGRAPH.              01370000
013800                                                                  01380000
013900     PERFORM B300-DELETE-ASNDTL.                                  01390000
014000*    IF PV-DELETE-COUNTER > PV-COUNT-CHECK                        01400008
014010     IF PV-DELETE-COUNTER > 2                                     01401008
014100         PERFORM B400-COMMIT                                      01410000
014200         MOVE ZERO               TO PV-DELETE-COUNTER             01420000
014300     END-IF.                                                      01430000
014400     PERFORM B200-READ-INPUT-FILE.                                01440000
014500                                                                  01450000
014600     EJECT                                                        01460000
014700                                                                  01470000
014800***************************************************************** 01480000
014900*    THIS PARAGRAPH WILL READ THE NEXT ASN TO BE DELETED.         01490000
015000***************************************************************** 01500000
015100 B200-READ-INPUT-FILE.                                            01510000
015200                                                                  01520000
015300     MOVE 'B200'                 TO PGM-LOCATION.                 01530000
015400     MOVE 'B200-READ-INPUT-FILE      '                            01540000
015500                                 TO ABEND-PARAGRAPH.              01550000
015600                                                                  01560000
015700     READ ASNHDR-DELETE-FILE                                      01570000
015800         INTO SN002I-ASN-DELETE-RECORD                            01580000
015900         AT END                                                   01590000
016000             SET PS-END-OF-INPUT TO TRUE.                         01600000
016100                                                                  01610000
016200     IF NOT PS-END-OF-INPUT                                       01620000
016300         ADD 1                   TO PV-RECS-READ                  01630000
016400     END-IF.                                                      01640000
016500                                                                  01650000
016600     EJECT                                                        01660000
016700                                                                  01670000
016800***************************************************************** 01680000
016900*    THIS PARAGRAPH DELETES ALL ASNDTL ROWS THAT ARE EQUAL TO     01690000
017000*    THE CURRENT INPUTED ASN.                                     01700000
017100***************************************************************** 01710000
017200 B300-DELETE-ASNDTL.                                              01720000
017300                                                                  01730000
017400     MOVE 'B300'                 TO PGM-LOCATION.                 01740000
017500     MOVE 'B300-DELETE-ASNDTL        '                            01750000
017600                                 TO ABEND-PARAGRAPH.              01760000
017710                                                                  01771004
017800     EXEC SQL                                                     01780005
017900         DELETE                                                   01790005
018000         FROM   TASNDTL                                           01800005
018100         WHERE  ASNHDR_ID   = :SN002I-ASNHDR-ID                   01810005
018200     END-EXEC.                                                    01820005
018300                                                                  01830005
018400     IF SQLCODE = ZERO                                            01840005
018500         ADD SQLERRD (3)         TO PV-RECS-DELETED               01850005
018600         ADD +1                  TO PV-DELETE-COUNTER             01860005
018700     ELSE                                                         01870005
018800         IF SQLCODE = +100                                        01880005
018900             CONTINUE                                             01890005
019000         ELSE                                                     01900005
019010             MOVE SN002I-ASNHDR-ID TO PV-DISPLAY-ASNHDR-ID        01901006
019020             DISPLAY 'ASNHDR-ID => ' PV-DISPLAY-ASNHDR-ID         01902006
019100             PERFORM Z998-SQL-ERROR                               01910005
019200         END-IF                                                   01920005
019300     END-IF.                                                      01930005
019400                                                                  01940000
019500     EJECT                                                        01950000
019600                                                                  01960000
019700***************************************************************** 01970000
019800*    THIS PARAGRAPH WILL COMMIT THE ROWS JUST DELETED             01980000
019900***************************************************************** 01990000
020000 B400-COMMIT.                                                     02000000
020100                                                                  02010000
020200     MOVE 'B400'                 TO PGM-LOCATION.                 02020000
020300     MOVE 'B400-COMMIT               '                            02030000
020400                                 TO ABEND-PARAGRAPH.              02040000
020500                                                                  02050000
020600     EXEC SQL                                                     02060005
020700         COMMIT                                                   02070005
020800     END-EXEC.                                                    02080005
020900                                                                  02090005
021000     IF SQLCODE = ZERO                                            02100005
021100         CONTINUE                                                 02110005
021200     ELSE                                                         02120005
021300         PERFORM Z998-SQL-ERROR                                   02130005
021400     END-IF.                                                      02140005
021500                                                                  02150000
021600     EJECT                                                        02160000
021700                                                                  02170000
021800***************************************************************** 02180000
021900*    THIS MODULE PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT  02190000
022000*    THAT AN SQL ERROR CODE OCCURS.                               02200000
022100***************************************************************** 02210000
022200 Z998-SQL-ERROR.                                                  02220000
022300                                                                  02230000
022400     MOVE SQLCODE                TO SQLCODE2.                     02240000
022500     MOVE SQLERRD(3)             TO SQLERRD3.                     02250000
022600     DISPLAY '** ABEND **         ** = SQLERROR'.                 02260000
022700     DISPLAY '** PROGRAM          ** = SNKUP017'.                 02270000
022800     DISPLAY '** PARAGRAPH        ** = ' ABEND-PARAGRAPH.         02280000
022900     DISPLAY '** SQLCODE          ** = ' SQLCODE2.                02290000
023000     DISPLAY '** ROWS PROCESSED   ** = ' SQLERRD3.                02300000
023100     DISPLAY '** SQLERRM          ** = ' SQLERRM.                 02310000
023200     DISPLAY '** SQLERRMC         ** = ' SQLERRMC.                02320000
023300     MOVE +4013                  TO ABEND-CODE.                   02330000
023400     CALL 'ILBOABN0'             USING ABEND-CODE.                02340000
