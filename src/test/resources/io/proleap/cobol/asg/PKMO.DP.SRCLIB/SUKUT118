000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400                                                                  00040000
000500 PROGRAM-ID.             SUKUT118.                                00050000
000600 AUTHOR.                 DENISE HAHN.                             00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN            MAY, 2006.                               00080000
000900 DATE-COMPILED.                                                   00090000
001000***************************************************************** 00100000
001100*  INPUT FILE CONTAINS TRIP AND TRIP OCCURANCE THAT ASSOCIATE   * 00110000
001200*  REQUESTS TRAILER SUMMARY REPORT.  REQUESTED FROM SUKCS545.   * 00120000
001300*  EXTRACT FILE WILL BE CREATED FOR INPUT INTO SUKRP046         * 00130000
001400***************************************************************** 00140000
001500 ENVIRONMENT DIVISION.                                            00150000
001600***************************************************************** 00160000
001700                                                                  00170000
001800 CONFIGURATION SECTION.                                           00180000
001900                                                                  00190000
002000 SOURCE-COMPUTER.        IBM-3090.                                00200000
002100 OBJECT-COMPUTER.        IBM-3090.                                00210000
002200                                                                  00220000
002300 INPUT-OUTPUT SECTION.                                            00230000
002400                                                                  00240000
002500 FILE-CONTROL.                                                    00250000
002600*                                                                 00260000
002700     SELECT CARDIN-TRIP-ID-FILE                                   00270000
002800         ASSIGN TO CARDIN.                                        00280000
002900                                                                  00290000
003000     SELECT SU-EXTRACT-FILE                                       00300000
003100         ASSIGN TO OUT01.                                         00310000
003200*                                                                 00320000
003300***************************************************************** 00330000
003400 DATA DIVISION.                                                   00340000
003500***************************************************************** 00350000
003600*                                                                 00360000
003700 FILE SECTION.                                                    00370000
003800*                                                                 00380000
003900 FD  CARDIN-TRIP-ID-FILE                                          00390000
004000     LABEL RECORDS ARE STANDARD                                   00400000
004100     RECORDING MODE IS F                                          00410000
004200     BLOCK CONTAINS 0 RECORDS                                     00420000
004300     RECORD CONTAINS 80 CHARACTERS.                               00430000
004400 01  CC-RECORD                       PIC X(80).                   00440000
004500                                                                  00450000
004600 FD  SU-EXTRACT-FILE                                              00460000
004700     RECORDING MODE IS F                                          00470000
004800     BLOCK CONTAINS 0  RECORDS.                                   00480000
004900 01  SU-EXTRACT-RECORD               PIC  X(100).                 00490000
005000*                                                                 00500000
005100                                                                  00510000
005200 WORKING-STORAGE SECTION.                                         00520000
005300*                                                                 00530000
005400 01  PROGRAM-SWITCHES.                                            00540000
005500     05  PS-END-OF-CARDIN-SW         PIC  X(01)    VALUE 'N'.     00550000
005600         88  PS-END-OF-CARDIN                      VALUE 'Y'.     00560000
005700                                                                  00570000
005800     05  PS-TRIOP-DATA-SW            PIC  X(01)    VALUE 'N'.     00580008
005900         88  PS-TRIP-DATA-YES                      VALUE 'Y'.     00590008
006000         88  PS-TRIP-DATA-NO                       VALUE 'N'.     00600008
006100                                                                  00610008
006200 01  PV-PROGRAM-VARIABLES.                                        00620008
006300     05  PV-ABEND-CODE               PIC S9(04)    VALUE ZERO     00630001
006400                                                   COMP SYNC.     00640001
006500     05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACES.  00650001
006600     05  PV-ABEND-OPERATION1         PIC  X(51)    VALUE SPACES.  00660001
006700     05  PV-SUMMARY-COUNT            PIC S9(09)    COMP.          00670013
006800                                                                  00680000
006900 01  DB2-KEYS.                                                    00690000
007000     05  DK-TRIP-OCRNC-ID            PIC S9(09) COMP.             00700000
007100     05  DK-OTBND-TRIP-ID            PIC S9(09) COMP.             00710000
007200                                                                  00720000
007300                                                                  00730000
007400 01  CC-CARDIN.                                                   00740000
007500     05  FILLER                      PIC  X(01).                  00750018
007600     05  CC-TRIP-OCRNC-ID            PIC  9(09).                  00760000
007700     05  FILLER                      PIC  X(01).                  00770000
007800     05  CC-OTBND-TRIP-ID            PIC  9(09).                  00780000
007900     05  FILLER                      PIC  X(01).                  00790000
008000     05  CC-USER-ID                  PIC  X(08).                  00800000
008100     05  FILLER                      PIC  X(01).                  00810000
008200     05  CC-REQUEST-TMST             PIC  X(26).                  00820000
008300     05  FILLER                      PIC  X(25).                  00830000
008400                                                                  00840000
008500     COPY SURD069.                                                00850000
008600                                                                  00860000
008700*                                                                 00870000
008800*  COPY BOOK FOR OUTBOUND TRIP STATUS                             00880000
008900*                                                                 00890000
009000     EXEC SQL                                                     00900000
009100          INCLUDE TSUOBTS                                         00910000
009200     END-EXEC.                                                    00920000
009300*                                                                 00930000
009400*  COPY BOOK FOR OUTBOUND TRIP                                    00940000
009500*                                                                 00950000
009600     EXEC SQL                                                     00960000
009700          INCLUDE TSUOBTR                                         00970000
009800     END-EXEC.                                                    00980000
009900*                                                                 00990000
010000*  COPY BOOK FOR TRAILER ID                                       01000000
010100*                                                                 01010000
010200     EXEC SQL                                                     01020000
010300          INCLUDE TCNTRID                                         01030000
010400     END-EXEC.                                                    01040000
010500*                                                                 01050000
010600*  COPY BOOK FOR TRIP SUMMARY TABLE                               01060000
010700*                                                                 01070000
010800     EXEC SQL                                                     01080000
010900          INCLUDE SUT00007                                        01090002
011000     END-EXEC.                                                    01100000
011100*                                                                 01110014
011200*  COPY BOOK FOR TRIP SUMMARY DETAIL TABLE                        01120014
011300*                                                                 01130014
011400     EXEC SQL                                                     01140014
011500          INCLUDE SUT00095                                        01150014
011600     END-EXEC.                                                    01160014
011700*                                                                 01170000
011800*  DB2 COMMUNICATION AREA                                         01180000
011900*                                                                 01190000
012000     EXEC SQL                                                     01200000
012100         INCLUDE SQLCA                                            01210000
012200     END-EXEC.                                                    01220000
012300*                                                                 01230000
012400*  DB2 COMMUNICATION AREA2                                        01240000
012500*                                                                 01250000
012600     COPY SQLCA2.                                                 01260000
012700*                                                                 01270000
012800 PROCEDURE DIVISION.                                              01280000
012900*                                                                 01290000
013000 0000-MAINLINE-PROCESSING.                                        01300000
013100******************************************************************01310000
013200**  THIS IS THE MAIN DRIVER FOR THE PROGRAM.                      01320000
013300******************************************************************01330000
013400     OPEN INPUT  CARDIN-TRIP-ID-FILE                              01340000
013500          OUTPUT SU-EXTRACT-FILE.                                 01350000
013600                                                                  01360000
013700     PERFORM 1000-INITIALIZATION.                                 01370000
013800                                                                  01380000
013900     PERFORM 2000-PROCESS-RECORD                                  01390005
014000       UNTIL PS-END-OF-CARDIN.                                    01400005
014100                                                                  01410000
014200     CLOSE CARDIN-TRIP-ID-FILE                                    01420000
014300           SU-EXTRACT-FILE.                                       01430000
014400                                                                  01440000
014500     GOBACK.                                                      01450000
014600                                                                  01460000
014700                                                                  01470000
014800 1000-INITIALIZATION.                                             01480000
014900******************************************************************01490000
015000**  PERFORM THE INITIAL PROCESSING FOR THE PROGRAM.               01500000
015100******************************************************************01510000
015200                                                                  01520000
015300     READ CARDIN-TRIP-ID-FILE INTO CC-CARDIN                      01530000
015400        AT END                                                    01540000
015500           SET PS-END-OF-CARDIN TO TRUE.                          01550000
015600                                                                  01560000
015700     IF PS-END-OF-CARDIN                                          01570000
015800         DISPLAY '** SUKUT118 ABEND **'                           01580000
015900         DISPLAY '** INPUT FILE IS EMPTY **'                      01590000
016000         MOVE +4019                  TO PV-ABEND-CODE             01600000
016100         CALL 'ILBOABN0' USING PV-ABEND-CODE                      01610000
016200     END-IF.                                                      01620000
016300                                                                  01630000
016400     DISPLAY 'OCCURANCE: ' CC-TRIP-OCRNC-ID.                      01640016
016500     DISPLAY 'TRIP ID:   ' CC-OTBND-TRIP-ID.                      01650016
016600     DISPLAY 'USER ID:   ' CC-USER-ID.                            01660000
016700     DISPLAY 'TIMESTAMP: ' CC-REQUEST-TMST.                       01670000
016800                                                                  01680000
016900     MOVE CC-TRIP-OCRNC-ID    TO DK-TRIP-OCRNC-ID.                01690001
017000     MOVE CC-OTBND-TRIP-ID    TO DK-OTBND-TRIP-ID.                01700001
017100                                                                  01710000
017200*                                                                 01720000
017300 2000-PROCESS-RECORD.                                             01730000
017400     MOVE '2000-PROCESS-RECORD        '                           01740000
017500                                 TO PV-ABEND-PARAGRAPH.           01750000
017600                                                                  01760000
017700     PERFORM 2010-GET-TRIP-INFORMATION.                           01770000
017800                                                                  01780000
017900     MOVE '2000-PROCESS-TRAILER       '                           01790000
018000                                 TO PV-ABEND-PARAGRAPH.           01800000
018100     MOVE  SPACES                TO PV-ABEND-OPERATION1.          01810002
018200                                                                  01820000
018300     IF  PS-TRIP-DATA-YES                                         01830007
018400         INITIALIZE  SU069-EXTRACT-RECORD                         01840007
018500                                                                  01850000
018600         MOVE SUOBTS-OTBND-TRIP-ID     TO SU069-OTBND-TRIP-ID     01860007
018700         MOVE SUOBTS-TRIP-STAT-CDE     TO SU069-TRIP-STAT-CDE     01870007
018800         MOVE SUOBTS-OTBND-STAT-TMST   TO SU069-OTBND-STAT-TMST   01880007
018900         MOVE SUOBTR-TRLR-SRL-NBR      TO SU069-OTBND-TRIP-SRL-NBR01890007
019000         MOVE SUOBTR-DEST-OPER-UNT-ID  TO SU069-LOC-NBR           01900007
019100         MOVE ZEROES                   TO SU069-BUS-AREA-ID       01910007
019200                                          SU069-UNT-QTY           01920007
019300                                          SU069-SKU-QTY           01930007
019400                                          SU069-CART-QTY          01940007
019500         MOVE SUT00007-TRIP-OCRNC-ID   TO SU069-TRIP-OCRNC-ID     01950007
019600                                                                  01960000
019700         PERFORM 8000-WRITE-EXTRACT-RECORD                        01970007
019800     ELSE                                                         01980007
019900         DISPLAY 'NO TRIP INFORMATION - CANT PRINT REPORT'        01990007
020000     END-IF.                                                      02000007
020100                                                                  02010000
020200     READ CARDIN-TRIP-ID-FILE INTO CC-CARDIN                      02020005
020300        AT END                                                    02030005
020400           SET PS-END-OF-CARDIN TO TRUE.                          02040005
020500                                                                  02050000
020600     IF  PS-END-OF-CARDIN                                         02060011
020700         CONTINUE                                                 02070010
020800     ELSE                                                         02080010
020900         DISPLAY '           '                                    02090010
021000         DISPLAY 'OCCURANCE: ' CC-TRIP-OCRNC-ID                   02100016
021100         DISPLAY 'TRIP ID:   ' CC-OTBND-TRIP-ID                   02110016
021200         DISPLAY 'USER ID:   ' CC-USER-ID                         02120010
021300         DISPLAY 'TIMESTAMP: ' CC-REQUEST-TMST                    02130010
021400                                                                  02140009
021500         MOVE CC-TRIP-OCRNC-ID    TO DK-TRIP-OCRNC-ID             02150010
021600         MOVE CC-OTBND-TRIP-ID    TO DK-OTBND-TRIP-ID             02160010
021700     END-IF.                                                      02170010
021800                                                                  02180009
021900                                                                  02190009
022000******************************************************************02200009
022100*                                                                *02210009
022200******************************************************************02220009
022300 2010-GET-TRIP-INFORMATION.                                       02230009
022400                                                                  02240009
022500     MOVE '2010-GET-TRIP-INFORMATION  '                           02250009
022600                                 TO PV-ABEND-PARAGRAPH.           02260009
022700                                                                  02270009
022800     MOVE 'GET INFORMATION FOR TRIP          '                    02280009
022900                             TO PV-ABEND-OPERATION1.              02290017
023000                                                                  02300009
023100     MOVE CC-TRIP-OCRNC-ID    TO DK-TRIP-OCRNC-ID.                02310017
023200                                                                  02320017
023300     EXEC SQL                                                     02330009
023400          SELECT A.OTBND_TRIP_ID                                  02340009
023500                ,A.TRIP_STAT_CDE                                  02350009
023600                ,A.OTBND_STAT_TMST                                02360009
023700                ,B.TRLR_SRL_NBR                                   02370009
023800                ,B.DEST_OPER_UNT_ID                               02380009
023900                ,D.TRIP_OCRNC_ID                                  02390009
024000                ,D.CART_QTY                                       02400012
024100            INTO :SUOBTS-OTBND-TRIP-ID                            02410012
024200                ,:SUOBTS-TRIP-STAT-CDE                            02420012
024300                ,:SUOBTS-OTBND-STAT-TMST                          02430012
024400                ,:SUOBTR-TRLR-SRL-NBR                             02440012
024500                ,:SUOBTR-DEST-OPER-UNT-ID                         02450012
024600                ,:SUT00007-TRIP-OCRNC-ID                          02460012
024700                ,:SUT00007-CART-QTY                               02470012
024800            FROM TSUOBTS A                                        02480012
024900                ,TSUOBTR B                                        02490012
025000                ,TCNTRID C                                        02500012
025100                ,SUT_TRIP_SUM D                                   02510012
025200          WHERE A.OTBND_TRIP_ID = B.OTBND_TRIP_ID                 02520012
025300            AND A.OTBND_STAT_TMST IN                              02530012
025400                (SELECT MAX(G.OTBND_STAT_TMST)                    02540012
025500                   FROM TSUOBTS G                                 02550012
025600                  WHERE A.OTBND_TRIP_ID = G.OTBND_TRIP_ID)        02560012
025700            AND B.OTBND_TRIP_ID = D.OTBND_TRIP_ID                 02570012
025800            AND B.TRLR_SRL_NBR = C.TRLR_SRL_NBR                   02580012
025900            AND D.CRE_TMST IN                                     02590012
026000                (SELECT MAX (F.CRE_TMST)                          02600012
026100                 FROM SUT_TRIP_SUM F                              02610012
026200                 WHERE D.OTBND_TRIP_ID = F.OTBND_TRIP_ID)         02620012
026300            AND D.TRIP_OCRNC_ID  =  :DK-TRIP-OCRNC-ID             02630012
026400     END-EXEC.                                                    02640012
026500                                                                  02650012
026600     EVALUATE TRUE                                                02660012
026700         WHEN SQLCODE = ZEROS                                     02670012
026800              IF  SUT00007-CART-QTY   >  ZERO                     02680012
026900                  SET  PS-TRIP-DATA-YES TO  TRUE                  02690012
027000              ELSE                                                02700012
027100                  PERFORM 2020-CHECK-FOR-SUM-DATA                 02710013
027200              END-IF                                              02720012
027300                                                                  02730012
027400         WHEN SQLCODE = +100                                      02740012
027500              SET  PS-TRIP-DATA-NO  TO  TRUE                      02750012
027600              DISPLAY CC-TRIP-OCRNC-ID                            02760016
027700                      ' +100 - 2010'                              02770017
027800         WHEN OTHER                                               02780012
027900              DISPLAY PV-ABEND-PARAGRAPH                          02790012
028000              PERFORM Z999-SQL-ERROR                              02800012
028100     END-EVALUATE.                                                02810012
028200                                                                  02820000
028300                                                                  02830000
028400******************************************************************02840013
028500*                                                                *02850013
028600******************************************************************02860013
028700 2020-CHECK-FOR-SUM-DATA.                                         02870013
028800     MOVE '2020-CHECK-FOR-SUM-DATA   '                            02880013
028900                                 TO PV-ABEND-PARAGRAPH.           02890013
029000                                                                  02900013
029100     MOVE 'CHECK IF THERE IS ANY SUMMARY DETAIL'                  02910013
029200                             TO PV-ABEND-OPERATION1.              02920017
029300                                                                  02930013
029400     MOVE CC-TRIP-OCRNC-ID    TO DK-TRIP-OCRNC-ID.                02940017
029500                                                                  02950017
029600     EXEC SQL                                                     02960013
029700          SELECT COUNT(*)                                         02970013
029800            INTO :PV-SUMMARY-COUNT                                02980013
029900            FROM SUT_TRIP_DTL_SUM                                 02990013
030000          WHERE TRIP_OCRNC_ID  =  :DK-TRIP-OCRNC-ID               03000013
030100     END-EXEC.                                                    03010013
030200                                                                  03020013
030300     EVALUATE TRUE                                                03030013
030400         WHEN SQLCODE = ZEROS                                     03040013
030500              IF  PV-SUMMARY-COUNT  >  ZERO                       03050013
030600                  SET  PS-TRIP-DATA-YES TO  TRUE                  03060013
030700              ELSE                                                03070013
030800                  SET  PS-TRIP-DATA-NO  TO  TRUE                  03080013
030900                  DISPLAY CC-TRIP-OCRNC-ID                        03090016
031000                         ' +0 - 2020'                             03100016
031100              END-IF                                              03110013
031200                                                                  03120013
031300         WHEN SQLCODE = +100                                      03130013
031400              SET  PS-TRIP-DATA-NO  TO  TRUE                      03140013
031500                  DISPLAY CC-TRIP-OCRNC-ID                        03150016
031600                         ' +100 - 2020'                           03160016
031700                                                                  03170013
031800         WHEN OTHER                                               03180013
031900              DISPLAY PV-ABEND-PARAGRAPH                          03190013
032000              PERFORM Z999-SQL-ERROR                              03200013
032100     END-EVALUATE.                                                03210013
032200                                                                  03220013
032300                                                                  03230013
032400******************************************************************03240000
032500*                                                                *03250000
032600******************************************************************03260000
032700 8000-WRITE-EXTRACT-RECORD.                                       03270000
032800     MOVE '8000-WRITE-EXTRACT-RECORD  '                           03280000
032900                                 TO PV-ABEND-PARAGRAPH.           03290000
033000                                                                  03300000
033100     MOVE  SPACES            TO PV-ABEND-OPERATION1.              03310000
033200                                                                  03320000
033300     WRITE SU-EXTRACT-RECORD                                      03330000
033400       FROM SU069-EXTRACT-RECORD.                                 03340000
033500                                                                  03350000
033600                                                                  03360000
033700******************************************************************03370000
033800*     SQL WARNING OR ERROR PROCESSING                            *03380000
033900******************************************************************03390000
034000 Z999-SQL-ERROR.                                                  03400000
034100                                                                  03410000
034200     DISPLAY PV-ABEND-PARAGRAPH.                                  03420000
034300     DISPLAY PV-ABEND-OPERATION1.                                 03430000
034400     MOVE SQLCODE    TO SQLCODE2.                                 03440000
034500     MOVE SQLERRD(3) TO SQLERRD3.                                 03450000
034600                                                                  03460000
034700     DISPLAY '** ABEND **       ** = SQLERROR'.                   03470000
034800     DISPLAY '** PROGRAM        ** = SUKUT118'.                   03480000
034900     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  03490000
035000     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  03500000
035100     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   03510000
035200     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  03520000
035300                                                                  03530000
035400     MOVE +4013 TO PV-ABEND-CODE.                                 03540000
035500     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         03550000
035600                                                                  03560000
