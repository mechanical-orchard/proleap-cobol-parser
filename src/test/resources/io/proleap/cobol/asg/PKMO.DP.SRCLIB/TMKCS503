000100*-----------------------*                                         00010002
000200 IDENTIFICATION DIVISION.                                         00020002
000300*-----------------------*                                         00030002
000400 PROGRAM-ID.    TMKCS503.                                         00040002
000500 AUTHOR.        DAN HINTZ.                                        00050002
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060002
000700 DATE-WRITTEN.  04-27-94.                                         00070002
000800 DATE-COMPILED.                                                   00080002
000900                                                                  00090002
001000*---------------------------------------------------------------* 00100002
001100*    E503 - NOTIFICATION/TROUBLE LIST - BY LINE PROGRAM         * 00110002
001200*                                                               * 00120002
001300*    THIS PROGRAM WILL PRODUCE A LIST OF NOTIFICATION AND       * 00130002
001400*    TROUBLE RECORDS FOR SINGLE PO AND ALL OF THE LINES ON THE  * 00140002
001500*    PO.                                                        * 00150002
001600*                                                               * 00160002
001700*    THE APPROPRIATE PROGRAM IS INVOKED WHEN THE OPERATOR       * 00170002
001800*    SELECTS ONE OR MORE ITEMS AND PRESSES A FUNCTION KEY.      * 00180002
001900*                                                               * 00190002
002000*    THE DP030-OVERRIDE-APPL-ERROR SWITCH IS SET TO TRUE WHEN   * 00200002
002100*    ENTERING THE PROGRAM IN ORDER TO GIVE CONTROL BACK TO THE  * 00210002
002200*    LIST WHEN A NEXT-ACT-APPL-ERROR IS SENT BACK FROM THE      * 00220002
002300*    UPDATE.  THE DP030-RC-APPL-ERROR IS CHECKED TO DETERMINE   * 00230002
002400*    IF A NEXT-ACT-APPL-ERROR IS BEING RETURNED TO THE LIST.    * 00240002
002500*                                                               * 00250002
002600*---------------------------------------------------------------* 00260002
002600* Change History                                                * 00260104
001300*    CHANGES                                                    * 00260204
001300*     MADE BY: PRITHIVIRAJ SUBRAMANIAN (COGNIZANT)              * 00260304
001300*     DATE:    10/06/2014                                       * 00260404
001300*                                                               * 00260504
001300*      CHANGES THRU OUT THE PROGRAM TO INCREASE THE SIZE OF PO# * 00260604
001300*      FROM 7 DIGITS TO 8 DIGITS. TAGGED WITH *PS 10/06/2014    * 00260706
002600*---------------------------------------------------------------* 00261004
263627* CHANGED 11/04/2021    BY JIM HUNTER      WR: CHG0263627         00263007
263627* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00264007
263627* MAKING THE CALL DYNAMIC VS STATIC.                              00265007
263627*----------------------------------------------------------------*00266007
CICS  * CHANGED 11/09/2022    BY JIM HUNTER      WR: CHG0278008         00267008
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00268008
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00269008
CICS  *-----------------------------------------------------------------00269108
002700 EJECT                                                            00270002
002800 ENVIRONMENT DIVISION.                                            00280002
002900                                                                  00290002
003000 DATA DIVISION.                                                   00300002
003100                                                                  00310002
003200 WORKING-STORAGE SECTION.                                         00320002
003300                                                                  00330002
003400 01  DK-DB2-KEYS.                                                 00340002
003500     05  DK-OPER-UNT-ID                 PIC S9(04)  COMP.         00350002
003600     05  DK-OPER-UNT-ID-LOW             PIC S9(04)  COMP.         00360002
003700     05  DK-OPER-UNT-ID-HIGH            PIC S9(04)  COMP.         00370002
003800     05  DK-FCLTY-ID                    PIC S9(04)  COMP.         00380002
003900     05  DK-FCLTY-ID-LOW                PIC S9(04)  COMP.         00390002
004000     05  DK-FCLTY-ID-HIGH               PIC S9(04)  COMP.         00400002
004100     05  DK-PO-NBR                      PIC S9(09)  COMP.         00410002
004200     05  DK-REC-SEQ-NBR                 PIC S9(09)  COMP.         00420002
004300     05  DK-PO-LNE-NBR                  PIC S9(09)  COMP.         00430002
004400     05  DK-PREPK-ID-KEY                PIC S9(04)  COMP.         00440002
004500     05  DK-ENT-ID                      PIC S9(09)  COMP.         00450002
004600     05  DK-TRBL-RSN-CDE-LOW            PIC S9(04)  COMP.         00460002
004700     05  DK-TRBL-RSN-CDE-HIGH           PIC S9(04)  COMP.         00470002
004710     05  DK-TRBL-RSN-CDE                PIC S9(04)  COMP.         00471002
004720     05  DK-NOTIF-DTE-LOW               PIC  X(26).               00472002
004730     05  DK-NOTIF-DTE-HIGH              PIC  X(26).               00473002
004740     05  DK-RSLVD-DTE-LOW               PIC  X(26).               00474002
004750     05  DK-RSLVD-DTE-HIGH              PIC  X(26).               00475002
004760     05  DK-NOTIF-TYPE-1                PIC  X(01).               00476002
004770     05  DK-NOTIF-TYPE-2                PIC  X(01).               00477002
004780     05  DK-NOTIF-STAT-1                PIC  X(01).               00478002
004790     05  DK-NOTIF-STAT-2                PIC  X(01).               00479002
004800     05  DK-NOTIF-STAT-3                PIC  X(01).               00480002
004900     05  DK-NOTIF-STAT-4                PIC  X(01).               00490002
005000                                                                  00500002
005100                                                                  00510002
005200 01  PC-PROGRAM-CONSTANTS.                                        00520002
005300     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00530002
005400                                                    'TM503A  '.   00540002
005500     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00550002
005600                                                    'TMKM503 '.   00560002
005700     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00570002
005800                                                    'TMKCS503'.   00580002
005900     05  PC-TMKCS520                    PIC  X(08)  VALUE         00590002
006000                                                    'TMKCS520'.   00600002
006100     05  PC-TMKCS550                    PIC  X(08)  VALUE         00610002
006200                                                    'TMKCS550'.   00620002
006300     05  PC-TMKUP501-RTN              PIC X(08)  VALUE            00630002
006400                                                       'TMKUP501'.00640002
006500     05  PC-TMKUP501-LENGTH           PIC S9(04) VALUE +800       00650002
006600                                                   COMP.          00660002
006700     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00670002
006800     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00680002
006900     05  PC-INTER-APPL-CODES.                                     00690002
007000         10 PC-INTER-APPL-CRIT-SPEC     PIC  X(01)  VALUE '1'.    00700002
007100         10 PC-INTER-APPL-LIST          PIC  X(01)  VALUE '2'.    00710002
007200         10 PC-INTER-APPL-RCPT-ITEM     PIC  X(01)  VALUE '3'.    00720002
007300         10 PC-INTER-APPL-VERIFY-RCVR   PIC  X(01)  VALUE '4'.    00730002
007400         10 PC-INTER-APPL-WO-RCVR       PIC  X(01)  VALUE '5'.    00740002
007500         10 PC-INTER-APPL-ITM-LST       PIC  X(01)  VALUE '6'.    00750002
007600         10 PC-INTER-APPL-PREPACK       PIC  X(01)  VALUE '7'.    00760002
007700         10 PC-INTER-APPL-ITM-ADD       PIC  X(01)  VALUE '8'.    00770002
007800         10 PC-INTER-APPL-REDIST        PIC  X(01)  VALUE '9'.    00780002
007900         10 PC-INTER-APPL-REC-PREPACK   PIC  X(01)  VALUE 'A'.    00790002
008000     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +12     00800002
008100                                                    COMP SYNC.    00810002
008200     05  PC-ITEMS-PER-PANEL-COMP3       PIC S9(04)  VALUE +12     00820002
008300                                                    COMP-3.       00830002
008400     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00840002
008500                                                    COMP SYNC.    00850002
008600     05  PC-MAX-TABLE-ENTRIES           PIC S9(04)  VALUE +20     00860002
008700                                                    COMP SYNC.    00870002
008800     05  PC-SHORT-WITHIN-LIMITS         PIC S9(04)  VALUE +510    00880002
008900                                                    COMP SYNC.    00890002
009000     05  PC-SHORT-OUTSIDE-LIMITS        PIC S9(04)  VALUE +511    00900002
009100                                                    COMP SYNC.    00910002
009200     05  PC-OVER-WITHIN-LIMITS          PIC S9(04)  VALUE +520    00920002
009300                                                    COMP SYNC.    00930002
009400     05  PC-OVER-OUTSIDE-LIMITS         PIC S9(04)  VALUE +521    00940002
009500                                                    COMP SYNC.    00950002
009600     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00960002
009700                                                    +1000000      00970002
009800                                                    COMP-3.       00980002
009900     05  PC-ZERO                        PIC S9(09)  VALUE +0      00990002
010000                                                    COMP SYNC.    01000002
010100     05  PC-ONE                         PIC S9(09)  VALUE +1      01010002
010200                                                    COMP SYNC.    01020002
010300     05  PC-NINE-NINES                  PIC S9(09)  VALUE         01030002
010400                                                    +999999999    01040002
010500                                                    COMP SYNC.    01050002
010600     05  PC-FOUR-NINES                  PIC S9(09)  VALUE +9999   01060002
010700                                                    COMP SYNC.    01070002
010800     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      01080002
010900                                                    COMP SYNC.    01090002
011000     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       01100002
011100                                                    COMP-3.       01110002
011200     05  PC-ACTIVE-STATUS               PIC  X(01)  VALUE 'A'.    01120002
011300     05  PC-NOTIF-TYPE-TROUBLE          PIC  X(01)  VALUE 'T'.    01130002
011400     05  PC-NOTIF-TYPE-NOTIFICATION     PIC  X(01)  VALUE 'N'.    01140002
011500     05  PC-NEW-TROUBLE                 PIC  X(01)  VALUE 'N'.    01150002
011600     05  PC-IN-PROCESS-TROUBLE          PIC  X(01)  VALUE 'I'.    01160002
011700     05  PC-PO-HEADER-TROUBLE           PIC  X(01)  VALUE 'P'.    01170002
011800     05  PC-RESOLVED-TROUBLE            PIC  X(01)  VALUE 'R'.    01180002
011900     05  PC-ACKNOWLEDGED-TROUBLE        PIC  X(01)  VALUE 'A'.    01190002
012000     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    01200002
012100     05  PC-COLON                       PIC  X(01)  VALUE ':'.    01210002
012200     05  PC-DASH                        PIC  X(01)  VALUE '-'.    01220002
012300     05  PC-SLASH                       PIC  X(01)  VALUE '/'.    01230002
012400     05  PC-A                           PIC  X(01)  VALUE 'A'.    01240002
012500     05  PC-Y                           PIC  X(01)  VALUE 'Y'.    01250002
012600     05  PC-M                           PIC  X(01)  VALUE 'M'.    01260002
012700     05  PC-N                           PIC  X(01)  VALUE 'N'.    01270002
012800     05  PC-P                           PIC  X(01)  VALUE 'P'.    01280002
012900     05  PC-SPACE                       PIC  X(01)  VALUE ' '.    01290002
013000     05  PC-TYPE-CODE-LONG-NAME         PIC  X(02)  VALUE '01'.   01300002
013100     05  PC-TYPE-CODE-SHORT-NAME        PIC  X(02)  VALUE '04'.   01310002
013200     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  01320002
013300     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  01330002
013400     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  01340002
013500     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  01350002
013600     05  PC-SHORT                       PIC  X(06) VALUE 'SHORT '.01360002
013700     05  PC-PSHORT                      PIC  X(06) VALUE 'PKSHR '.01370002
013800     05  PC-OVER                        PIC  X(05)  VALUE 'OVER '.01380002
013900     05  PC-POVER                       PIC  X(05)  VALUE 'PKOVR'.01390002
014000     05  PC-CORP-OFFICE                 PIC  9(04)  VALUE 0090.   01400002
014100     05  PC-DUMMY-DB2-COMPR-DATE-LOW    PIC  X(26)  VALUE         01410002
014200         '0001-01-01-00.00.00.000000'.                            01420002
014300     05  PC-DUMMY-DB2-COMPR-DATE-HIGH   PIC  X(26)  VALUE         01430002
014400         '9999-09-09-09.09.09.999998'.                            01440002
014500     05  PC-DUMMY-DB2-DATE              PIC  X(26)  VALUE         01450002
014600         '9999-09-09-09.09.09.999999'.                            01460002
014700     05  PC-DUMMY-AD-EVNT-DTE           PIC  X(10)  VALUE         01470002
014800                                              '0001-01-01'.       01480002
014900     05  PC-DUMMY-DB2-TIME-LOW          PIC  X(16)  VALUE         01490002
015000                                        '-00.00.00.000000'.       01500002
015100     05  PC-DUMMY-DB2-TIME-HIGH         PIC  X(16)  VALUE         01510002
015200                                        '-23.59.59.999999'.       01520002
015300*    05  PC-DUMMY-SKU                   PIC  X(10)  VALUE         01530002
015400*                                             '999-99-999'.       01540002
015500     05  PC-DUMMY-SKU                   PIC  X(11)  VALUE         01550002
015510                                             '99 99999999'.       01551002
015520                                                                  01552002
015530     05  PC-IN-PROCESS-MSG              PIC  X(32)  VALUE         01553002
015540         'IN THE PROCESS OF BEING RESOLVED'.                      01554002
015550     05  PC-DC-CHKD-MSG                 PIC  X(10)  VALUE         01555002
015560         'DC CHECKED'.                                            01556002
015570     05  PC-MUST-RESOLVE-MANUALLY-MSG   PIC  X(41)  VALUE         01557002
015580         'NNNNN-E-TROUBLE MUST BE RESOLVED MANUALLY'.             01558002
015590     05  PC-RESOLVE-NOT-REQUIRED-MSG    PIC  X(41)  VALUE         01559002
015600         'NNNNN-E-TROUBLE RESOLUTION NOT REQUIRED  '.             01560002
015700     05  PC-RECORD-IN-PROC-MSG          PIC  X(54)  VALUE         01570002
015800         'NNNNN-E-RECORD IS ALREADY IN PROCESS                  '.01580002
015900     05  PC-RECORD-RESOLVED-MSG         PIC  X(55)  VALUE         01590002
016000        'NNNNN-E-RECORD IS RESOLVED - IN-PROCESS REQUEST INVALID'.01600002
016100     05  PC-TROUBLE-STILL-EXISTS-MSG    PIC  X(44)  VALUE         01610002
016200        'NNNNN-I-SOME UNRESOLVED TROUBLE STILL EXISTS'.           01620002
016300     05  PC-RECORD-ACKNOWLEDGED-MSG     PIC  X(55)  VALUE         01630002
016400        'NNNNN-E-RECORD IS ACKNOWLEDGED - CANNOT RESOLVE        '.01640002
016500     05  PC-RESPOND-TRBL-REC-NOT-FOUND  PIC  X(55)  VALUE         01650002
016600        'NNNNN-E-RESPOND TROUBLE RECORD IS NOT FOUND            '.01660002
016700     05  PC-ACKNWLG-TRBL-REC-NOT-FOUND  PIC  X(55)  VALUE         01670002
016800        'NNNNN-E-TROUBLE RECORD TO ACKNOWLEDGE IS NOT FOUND     '.01680002
016900     05  PC-TBL-ENTRIES-EXCEEDED-MSG    PIC  X(55)  VALUE         01690002
017000        'NNNNN-E-MAX TABLE ENTRIES EXCEEDED -- CONTACT DP       '.01700002
017100*                                                                 01710002
017200     05  PC-TSYMSG-NUMBERS.                                       01720002
017300         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  01730002
017400         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  01740002
017500         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  01750002
017600         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  01760002
017700         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  01770002
017800         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  01780002
017900         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  01790002
018000         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  01800002
018100         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  01810002
018200         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  01820002
018300         10  PC-TSYMSG-00059            PIC  9(05)  VALUE 00059.  01830002
018400         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  01840002
018500         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  01850002
018600         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  01860002
018700         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01870002
018800         10  PC-TSYMSG-00461            PIC  9(05)  VALUE 00461.  01880002
018900         10  PC-TSYMSG-00737            PIC  9(05)  VALUE 00737.  01890002
019000         10  PC-TSYMSG-00815            PIC  9(05)  VALUE 00815.  01900002
019100         10  PC-TSYMSG-00938            PIC  9(05)  VALUE 00938.  01910002
019200         10  PC-TSYMSG-01037            PIC  9(05)  VALUE 01037.  01920002
019300** 1064 - DATA IS UNAVAILABLE; PLEASE CONTACT HELP DESK           01930002
019400         10  PC-TSYMSG-01064            PIC  9(05)  VALUE 01064.  01940002
019500                                                                  01950002
019600         10  PC-TSYMSG-01839            PIC  9(05)  VALUE 01839.  01960002
019700** NOTIFICATION/TROUBLE IS ACKNOWLEDGED - CAN NOT ACKNOWLEDGE     01970002
019800         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  01980002
019900                                                                  01990002
020000** INVALID FUNCTION FOR PACK TYPE "M" OR "I".                     02000002
020100         10  PC-TSYMSG-02184            PIC  9(05)  VALUE 02184.  02010002
020200** PACK TYPE MUST BE "M" OR "I" FOR THIS FUNCTION.                02020002
020300         10  PC-TSYMSG-02185            PIC  9(05)  VALUE 02185.  02030002
020400** PACK ID MUST BE > 0 FOR THIS FUNCTION.                         02040002
020500         10  PC-TSYMSG-02186            PIC  9(05)  VALUE 02186.  02050002
020600** LINE NBR MUST BE > 0 FOR THIS FUNCTION.                        02060002
020700         10  PC-TSYMSG-02187            PIC  9(05)  VALUE 02187.  02070002
020800** PO LINE INQ/UPD CANNOT BE ACCESSED SELECTING PACK TROUBLE      02080002
020810         10  PC-TSYMSG-03364      PIC  9(05)  VALUE  03364.       02081002
020820** TROUBLE WAS AUTO ACKNOWLEDGED AND RE-DISTRO WAS DONE           02082002
020830         10  PC-TSYMSG-03365      PIC  9(05)  VALUE  03365.       02083002
020840** TROUBLE WAS NOT AUTO ACKNOWLEDGED DUE other proration          02084002
020841** TROUBLE FOUND                                                  02084102
020842         10  PC-TSYMSG-03366      PIC  9(05)  VALUE  03366.       02084202
020843** TROUBLE WAS AUTOMATICALLY ACKNOWLEDGED BY SYSTEM               02084302
020844         10  PC-TSYMSG-03383            PIC  9(05)  VALUE 03383.  02084402
020845*  ACKNOWLEDGE WAS DONE MANUALLY, NO REDISTRO WAS PERFORMED       02084502
020846         10  PC-TSYMSG-03384            PIC  9(05)  VALUE 03384.  02084602
020847*  TROUBLE WASN'T AUTO RESOLVED, DISTRO'ED OR ACKNOWLEDGED DUE TO 02084702
020848*  TROUBLE                                                        02084802
020849         10  PC-TSYMSG-03385            PIC  9(05)  VALUE 03385.  02084902
020850*  AUTO ACKNOWLEDGE PENDING UNTIL NEXT BATCH JOB                  02085002
020860         10  PC-TSYMSG-03393            PIC  9(05)  VALUE 03393.  02086002
020870*  CONTACT COC TO RESOLVE AND ACKNOWLEDGE THE NO DISTRO           02087002
020880                                                                  02088002
020890     05  PC-RSN-CDE-LOW                 PIC S9(04) COMP           02089002
020900                                                    VALUE ZERO.   02090002
021000     05  PC-RSN-CDE-HIGH                PIC S9(04) COMP           02100002
021100                                                    VALUE +9999.  02110002
021200     05  PC-000                       PIC X(03) VALUE '000'.      02120002
021300     05  PC-999                       PIC X(03) VALUE '999'.      02130002
021400*                                                                 02140002
021500 01  PS-PROGRAM-SWITCHES.                                         02150002
021600     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    02160002
021700         88  PS-NO-ERROR                            VALUE 'Y'.    02170002
021800         88  PS-ERROR                               VALUE 'N'.    02180002
021900     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    02190002
022000         88  PS-COMMAREA-VALID                      VALUE 'Y'.    02200002
022100         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    02210002
022200     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    02220002
022300         88  PS-DONE                                VALUE 'Y'.    02230002
022400         88  PS-NOT-DONE                            VALUE 'N'.    02240002
022500     05  PS-AUTO-ACKNOW-SW              PIC  X(01)  VALUE 'N'.    02250002
022600         88  PS-AUTO-ACKNOW-YES                     VALUE 'Y'.    02260002
022610         88  PS-AUTO-ACKNOW-NO                      VALUE 'N'.    02261002
022620     05  PS-TRBL-RSN-LOADED-SW          PIC  X(01)  VALUE 'N'.    02262002
022630         88  PS-TRBL-RSN-LOADED                     VALUE 'Y'.    02263002
022640         88  PS-TRBL-RSN-NOT-LOADED                 VALUE 'N'.    02264002
022650     05  PS-DISPLAY-LINE-SW             PIC  X(01)  VALUE 'Y'.    02265002
022660         88  PS-DISPLAY-TROUBLE-LINE                VALUE 'Y'.    02266002
022670         88  PS-DO-NOT-DISPLAY-TROUBLE-LINE         VALUE 'N'.    02267002
022680     05  PS-RESOLVE-REQUEST-SW          PIC  X(01)  VALUE 'N'.    02268002
022690         88  PS-RESOLVE-REQUEST                     VALUE 'Y'.    02269002
022700         88  PS-NOT-A-RESOLVE-REQUEST               VALUE 'N'.    02270002
022800     05  PS-FIRST-TIME-SW               PIC  X(01)  VALUE 'Y'.    02280002
022900         88  PS-FIRST-TIME                          VALUE 'Y'.    02290002
023000         88  PS-NOT-FIRST-TIME                      VALUE 'N'.    02300002
023100     05  PS-ITEMS-LEFT-SW               PIC  X(01)  VALUE 'Y'.    02310002
023200         88  PS-TRBL-NOTIF-ITEMS-LEFT               VALUE 'Y'.    02320002
023300         88  PS-NO-TRBL-NOTIF-ITEMS-LEFT            VALUE 'N'.    02330002
023400     05  PS-TRBL-DTL-EXISTS-SW          PIC  X(01)  VALUE 'N'.    02340002
023500         88  PS-TRBL-DTL-EXISTS                     VALUE 'Y'.    02350002
023600         88  PS-NO-TRBL-DTL-EXISTS                  VALUE 'N'.    02360002
023700     05  PS-ALL-PREPACK-SW              PIC  X(01)  VALUE 'Y'.    02370002
023800         88  PS-ALL-PREPACK-YES                     VALUE 'Y'.    02380002
023900         88  PS-ALL-PREPACK-NO                      VALUE 'N'.    02390002
024000     05  PS-SEL-LINE-NBR-SW             PIC  X(01)  VALUE 'Y'.    02400002
024100         88  PS-SEL-LINE-NBR-YES                    VALUE 'Y'.    02410002
024200         88  PS-SEL-LINE-NBR-NO                     VALUE 'N'.    02420002
024300     05  PS-OVER-SHORT-SW               PIC S9(04)  VALUE 0.      02430002
024400         88  PS-SHORT-TROUBLES                      VALUE         02440002
024500             +450 +451 +452 +453 +454 +455 +456 +457 +458 +459    02450002
024600             +460 +461 +462 +463 +464 +465 +466 +467              02460002
024700             +468 +469 +470 +471 +472 +473                        02470002
024800                                                          +510    02480002
024900                                                          +511    02490002
025000                                                          +570    02500002
025100                                                          +571    02510002
025200                                                          +582    02520002
025300                                                          +583.   02530002
025400                                                                  02540002
025500         88  PS-LINE-SHORT-TROUBLES                 VALUE +510    02550002
025600                                                          +511    02560002
025700                  +470 +471 +473                                  02570002
025800                  +450 +451 +452 +453 +454 +455 +456 +457 +458.   02580002
025900                                                                  02590002
026000         88  PS-PACK-SHORT-TROUBLES                 VALUE         02600002
026100                  +459 +460 +461 +462 +463 +464 +465 +466 +467    02610002
026200                  +468 +469 +472                                  02620002
026300                                                          +570    02630002
026400                                                          +571    02640002
026500                                                          +582    02650002
026600                                                          +583.   02660002
026700                                                                  02670002
026800         88  PS-OVER-TROUBLES                       VALUE +520    02680002
026900                                                          +521    02690002
027000                                                          +579    02700002
027100                                                          +580    02710002
027200                                                          +591    02720002
027300                                                          +592    02730002
027400             +610 +611 +612 +613 +614 +615 +616 +617 +618 +619    02740002
027401             +620 +621 +622 +623 +624 +625 +626 +627 +628 +629    02740102
027402             +630 +631 +632 +633 +634 +635 +636 +637 +638 +639    02740202
027403             +640 +641 +642 +643 +644 +645 +646 +647 +648 +649    02740302
027404             +650 +651 +652 +653 +654 +655 +656 +657 +658 +659    02740402
027405             +660 +661 +662 +663 +664 +665 +666 +667 +668 +669    02740502
027406             +670 +671 +672 +673 +674 +675 +676 +677 +678 +679    02740602
027407             +680 +681 +682 +683 +684 +685 +686 +687 +688 +689.   02740702
027408                                                                  02740802
027409         88  PS-LINE-OVER-TROUBLES                  VALUE +520    02740902
027410                                                          +521    02741002
027420             +610 +611 +612 +613 +614 +615 +616 +617 +618 +619    02742002
027430             +620 +621 +622 +623 +624 +625 +626 +627 +628 +629    02743002
027440             +630 +631 +632 +633 +634 +635 +636 +637 +638 +639    02744002
027450             +640 +641 +642 +643 +644 +645 +646 +647 +648 +649.   02745002
027460         88  PS-PACK-OVER-TROUBLES                  VALUE +579    02746002
027470                                                          +580    02747002
027480                                                          +591    02748002
027490                                                          +592    02749002
027500             +650 +651 +652 +653 +654 +655 +656 +657 +658 +659    02750002
027600             +660 +661 +662 +663 +664 +665 +666 +667 +668 +669    02760002
027700             +670 +671 +672 +673 +674 +675 +676 +677 +678 +679    02770002
027800             +680 +681 +682 +683 +684 +685 +686 +687 +688 +689.   02780002
027900                                                                  02790002
028000     05  PS-CALL-API-SW               PIC  X    VALUE 'N'.        02800002
028010         88  PS-CALL-API-NO                     VALUE 'N'.        02801002
028020         88  PS-CALL-API-YES                    VALUE 'Y'.        02802002
028030*                                                                 02803002
028040 01  PV-PROGRAM-VARIABLES.                                        02804002
028050     05  PV-SUB                         PIC S9(04)  VALUE +0      02805002
028060                                                    COMP SYNC.    02806002
028070     05  PV-SUB-COMP3                   PIC S9(04)  VALUE +0      02807002
028080                                                    COMP-3.       02808002
028090     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      02809002
028100                                                    COMP SYNC.    02810002
028200     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      02820002
028300                                                    COMP-3.       02830002
028400     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      02840002
028500                                                    COMP-3.       02850002
028600     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      02860002
028700                                                    COMP-3.       02870002
028800     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      02880002
028900                                                    COMP-3.       02890002
029000     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      02900002
029100                                                    COMP-3.       02910002
029200     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      02920002
029300                                                    COMP-3.       02930002
029400     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      02940002
029500                                                    COMP-3.       02950002
029600     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      02960002
029700                                                    COMP SYNC.    02970002
029800     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      02980002
029900                                                    COMP SYNC.    02990002
030000     05  PV-COMMAREA-LENGTH             PIC S9(04)  VALUE +0      03000002
030100                                                    COMP SYNC.    03010002
030200     05  PV-ITEM                        PIC S9(04)  VALUE +0      03020002
030300                                                    COMP SYNC.    03030002
030400     05  PV-ITEM-COMP3                  PIC S9(04)  VALUE +0      03040002
030500                                                    COMP-3.       03050002
030600     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      03060002
030700                                                    COMP SYNC.    03070002
030800     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      03080002
030900                                                    COMP SYNC.    03090002
031000     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      03100002
031100                                                    COMP SYNC.    03110002
031200     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      03120002
031300                                                    COMP SYNC.    03130002
031400     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      03140002
031500                                                    COMP SYNC.    03150002
031600     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      03160002
031700                                                    COMP SYNC.    03170002
031800     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      03180002
031900                                                    COMP SYNC.    03190002
032000     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      03200002
032100                                                    COMP SYNC.    03210002
032200     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      03220002
032300                                                    COMP SYNC.    03230002
032400     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      03240002
032500                                                    COMP SYNC.    03250002
032600     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      03260002
032700                                                    COMP SYNC.    03270002
032800     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      03280002
032900                                                    COMP SYNC.    03290002
033000     05  PV-TRBL-RSN-SUB                PIC S9(04)  VALUE +0      03300002
033100                                                    COMP SYNC.    03310002
033200     05  PV-PREV-PO-NBR                 PIC S9(09)  VALUE +0      03320002
033300                                                    COMP SYNC.    03330002
033400     05  PV-TRBL-DTL-COUNT              PIC S9(09)  VALUE +0      03340002
033500                                                    COMP-3.       03350002
033600     05  PV-PREV-DEPT-NBR               PIC  X(03)  VALUE SPACES. 03360002
033700     05  PV-RESP-DATE                   PIC  X(26)  VALUE SPACES. 03370002
033800     05  PV-OVER-SHT-PCT                PIC  ZZ9    VALUE ZEROS.  03380002
033900*PS 10/06/2014 Change Starts                                      03390006
033900*    05  PV-ERROR-PO-NBR                PIC  9(07)  VALUE ZEROS.  03390104
033900     05  PV-ERROR-PO-NBR                PIC  9(08)  VALUE ZEROS.  03391004
033900*PS 10/06/2014 Change Ends                                        03392006
034000     05  PV-ERROR-REC-SEQ-NBR           PIC  9(04)  VALUE ZEROS.  03400002
034100     05  PV-ERROR-PO-LNE-NBR            PIC  9(04)  VALUE ZEROS.  03410002
034200     05  PV-ERROR-OPER-UNT-ID           PIC  9(04)  VALUE ZEROS.  03420002
034300     05  PV-ERROR-PREPK-ID              PIC  9(04)  VALUE ZEROS.  03430002
034400     05  PV-ERROR-NOTIF-NBR             PIC  9(09)  VALUE ZEROS.  03440002
034500     05  PV-TIMESTAMP                   PIC  X(26)  VALUE SPACES. 03450002
034600     05  PV-TIMESTAMP-R                 REDEFINES                 03460002
034700         PV-TIMESTAMP.                                            03470002
034800         10  PV-TIMESTAMP-YEAR          PIC  9(04).               03480002
034900         10  FILLER                     PIC  X(01).               03490002
035000         10  PV-TIMESTAMP-MONTH         PIC  9(02).               03500002
035100         10  FILLER                     PIC  X(01).               03510002
035200         10  PV-TIMESTAMP-DAY           PIC  9(02).               03520002
035300         10  FILLER                     PIC  X(01).               03530002
035400         10  PV-TIMESTAMP-HOUR          PIC  9(02).               03540002
035500         10  FILLER                     PIC  X(01).               03550002
035600         10  PV-TIMESTAMP-MINUTE        PIC  9(02).               03560002
035700         10  FILLER                     PIC  X(01).               03570002
035800         10  PV-TIMESTAMP-SECONDS       PIC  9(02).               03580002
035900         10  FILLER                     PIC  X(01).               03590002
036000         10  PV-TIMESTAMP-MILLISECONDS  PIC  9(06).               03600002
036100     05  PV-COMPARE-TIMESTAMP           PIC  X(26)  VALUE SPACES. 03610002
036200     05  PV-COMPARE-TIMESTAMP-R         REDEFINES                 03620002
036300         PV-COMPARE-TIMESTAMP.                                    03630002
036400         10  PV-COMPARE-TIMESTAMP-DATE  PIC  X(10).               03640002
036500         10  PV-COMPARE-TIMESTAMP-TIME  PIC  X(16).               03650002
036600     05  PV-TEMP-SEQ-NBR              PIC  9(08) VALUE ZEROES.    03660002
036700     05  PV-SKU-SEQ-NBR               PIC  X(08) VALUE SPACES.    03670002
036800     05  DK-SKU-SEQ                   PIC  X(03) VALUE SPACES.    03680002
036900     05  DK-ITM-NBR                   PIC  S9(15)V COMP-3         03690002
037000                                                 VALUE ZEROES.    03700002
037100     05  PV-DEPT-NBR                  PIC  X(03) VALUE SPACES.    03710002
037200*                                                                 03720002
037300 01  TR-TROUBLE-REASON-TABLE.                                     03730002
037400     05  TR-TROUBLE-REASON-ENTRY        OCCURS 20 TIMES           03740002
037500                                        INDEXED BY TR-TRBL-IDX.   03750002
037600         10  TR-TROUBLE-REASON          PIC  X(04)  VALUE SPACES. 03760002
037700         10  TR-TROUBLE-REASON-N        REDEFINES                 03770002
037800             TR-TROUBLE-REASON          PIC  9(04).               03780002
037900*                                                                 03790002
038000******************************************************************03800002
038100**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **03810002
038200**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **03820002
038300**  APPLICATION-SPECIFIC COMMAREA.                              **03830002
038400******************************************************************03840002
038500 01  LQW-LIST-QUEUE-WORK-AREA.                                    03850002
038600     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  03860002
038700     05  LQW-ITEM-ENTRIES               OCCURS 12 TIMES           03870002
038800                                        INDEXED BY LQW-IDX.       03880002
038900         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       03890002
039000         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               03900002
039100         10  LQW-SELECTED-SW            PIC  X(01).               03910002
039200             88  LQW-SELECT                         VALUE 'S'.    03920002
039300             88  LQW-DESELECT                       VALUE ' '.    03930002
039400         10  LQW-ACTION                 PIC  X(03).               03940002
039500             88  LQW-ERROR                          VALUE 'ERR'.  03950002
039600             88  LQW-INQUIRE                        VALUE 'INQ'.  03960002
039700             88  LQW-UPDATE                         VALUE 'UPD'.  03970002
039800         10  LQW-NOTIF-NBR              PIC S9(09)  COMP.         03980002
039900         10  LQW-PO-LNE-NBR             PIC  X(04).               03990002
040000         10  LQW-PO-LNE-NBR-N REDEFINES                           04000002
040100             LQW-PO-LNE-NBR             PIC  9(04).               04010002
040200         10  LQW-PREPK-ID               PIC  9(04).               04020002
040300         10  LQW-SKU                    PIC  X(11).               04030002
040400         10  LQW-AD-IND                 PIC  X(01).               04040002
040500         10  LQW-TROUBLE-REASON-CDE     PIC S9(04)  COMP.         04050002
040600         10  LQW-TROUBLE-REASON-DESC    PIC  X(10).               04060002
040700         10  LQW-TROUBLE-RESP-RES-IND   PIC  X(01).               04070002
040800             88  LQW-RESOLVE-NOT-REQUIRED           VALUE ' '.    04080002
040900             88  LQW-RESOLVE-TRBL-AUTO              VALUE 'A'.    04090002
041000             88  LQW-RESOLVE-TRBL-MANUAL            VALUE 'M'.    04100002
041100             88  LQW-RESOLVE-TRBL-BOTH-AUTO-MAN     VALUE 'B'.    04110002
041200         10  LQW-TROUBLE-REASON-LVL     PIC  X(01).               04120002
041300             88  LQW-TROUBLE-PO-LEVEL               VALUE 'P'.    04130002
041400             88  LQW-TROUBLE-PACK-LEVEL             VALUE 'M'.    04140002
041500             88  LQW-TROUBLE-LINE-LEVEL             VALUE ' '     04150002
041600                                                          'L'     04160002
041700                                                          'S'     04170002
041800                                                          'X'.    04180002
041900         10  LQW-NOTIFICATION-DATE-TIME PIC  X(11).               04190002
042000         10  LQW-RESPONSE-DATE-TIME     PIC  X(11).               04200002
042100         10  LQW-PROC-AREA              PIC  X(06).               04210002
042200         10  LQW-PROC-LINE              PIC  X(04).               04220002
042300         10  LQW-RECITM-PREPK-ID        PIC  9(04).               04230002
042400         10  LQW-TRBL-DTL-EXISTS-SW     PIC  X(01).               04240002
042500         10  LQW-TRBL-RESOLVED-SW       PIC  X(01).               04250002
042600             88  LQW-TRBL-RESOLVED                  VALUE 'Y'.    04260002
042700         10  LQW-TRBL-ACK-SW            PIC  X(01).               04270002
042800             88  LQW-TRBL-ACK                       VALUE 'Y'.    04280002
042900             88  LQW-TRBL-NOT-ACK                   VALUE 'N'.    04290002
043000                                                                  04300002
043100     EJECT                                                        04310002
043200*---------------------------------------------------------------* 04320002
043300*  RECORD LAYOUT FOR THE MESSAGE SELECTION TEMP STORAGE QUEUE.  * 04330002
043400*---------------------------------------------------------------* 04340002
043500                                                                  04350002
043600     COPY TMWS002.                                                04360002
043700                                                                  04370002
043800     EJECT                                                        04380002
043900*----------------------------------------------------------------*04390002
043910*    THE LAYOUT FOR THE COMMAREA USED TO PASS BETWEEN THIS       *04391002
043920*    PROGRAM AND TMKCS550 (AUTO ACKNOWLEDGE PROCESS).            *04392002
043930*----------------------------------------------------------------*04393002
043940     COPY TMRD007.                                                04394002
043950/                                                                 04395002
043960*---------------------------------------------------------------* 04396002
043970*  RECORD LAYOUT FOR THE PO INQUIRY AND UPDATE SELECTION TEMP   * 04397002
043980*  STORAGE QUEUE.                                               * 04398002
043990*---------------------------------------------------------------* 04399002
044000                                                                  04400002
044100     COPY POWS012.                                                04410002
044200                                                                  04420002
044300     EJECT                                                        04430002
044400*---------------------------------------------------------------* 04440002
044500*  RECORD LAYOUT FOR THE DC DISTRIBUTION SELECTION TEMP STORAGE * 04450002
044600*  QUEUE.                                                       * 04460002
044700*---------------------------------------------------------------* 04470002
044800                                                                  04480002
044900     COPY RCWS013.                                                04490002
045000                                                                  04500002
045100     COPY PCWS016.                                                04510002
045200                                                                  04520002
045300*---------------------------------------------------------------* 04530002
045400*  RECORD LAYOUT FOR THE PREPACK AND RECEIVING AREA             * 04540002
045500*  TEMP STORAGE QUEUE.                                          * 04550002
045600*---------------------------------------------------------------* 04560002
045700                                                                  04570002
045800     COPY RCWS801.                                                04580002
045900                                                                  04590002
046000*---------------------------------------------------------------* 04600002
046100*    MAP LAYOUT                                                 * 04610002
046200*---------------------------------------------------------------* 04620002
046300                                                                  04630002
046400     COPY TMKM503.                                                04640002
046500*                                                                 04650002
046600 01  MR-OCCURS-LAYOUT                   REDEFINES  TM503AO.       04660002
033900*PS 10/06/2014 Change starts                                      04661006
046700     05  FILLER                         PIC X(128).               04670005
033900*PS 10/06/2014 Change Ends                                        04671006
046800     05  MR-SCROLL-AREA                 OCCURS 12 TIMES.          04680002
046900         10  MR-SELECTL                 PIC S9(04) COMP.          04690002
047000         10  MR-SELECTA                 PIC  X(01).               04700002
047100         10  MR-SELECTC                 PIC  X(01).               04710002
047200         10  MR-SELECTH                 PIC  X(01).               04720002
047300         10  MR-SELECTI                 PIC  X(01).               04730002
047400                                                                  04740002
047500         10  MR-ACTIONL                 PIC S9(04) COMP.          04750002
047600         10  MR-ACTIONA                 PIC  X(01).               04760002
047700         10  MR-ACTIONC                 PIC  X(01).               04770002
047800         10  MR-ACTIONH                 PIC  X(01).               04780002
047900         10  MR-ACTION                  PIC  X(03).               04790002
048000                                                                  04800002
048100         10  MR-PO-LINEL                PIC S9(04) COMP.          04810002
048200         10  MR-PO-LINEA                PIC  X(01).               04820002
048300         10  MR-PO-LINEC                PIC  X(01).               04830002
048400         10  MR-PO-LINEH                PIC  X(01).               04840002
048500         10  MR-PO-LINE.                                          04850002
048600             15  MR-PO-LINE-N           PIC  9(04).               04860002
048700                                                                  04870002
048800         10  MR-PREPK-IDL               PIC S9(04) COMP.          04880002
048900         10  MR-PREPK-IDA               PIC  X(01).               04890002
049000         10  MR-PREPK-IDC               PIC  X(01).               04900002
049100         10  MR-PREPK-IDH               PIC  X(01).               04910002
049200         10  MR-PREPK-ID.                                         04920002
049300             15  MR-PREPK-ID-N          PIC  9(04).               04930002
049400                                                                  04940002
049500         10  MR-SKUL                    PIC S9(04) COMP.          04950002
049600         10  MR-SKUA                    PIC  X(01).               04960002
049700         10  MR-SKUC                    PIC  X(01).               04970002
049800         10  MR-SKUH                    PIC  X(01).               04980002
049900*        10  MR-SKU                     PIC  X(10).               04990002
050000         10  MR-SKU                     PIC  X(11).               05000002
050100                                                                  05010002
050200         10  MR-AD-INDL                 PIC S9(04) COMP.          05020002
050300         10  MR-AD-INDA                 PIC  X(01).               05030002
050400         10  MR-AD-INDC                 PIC  X(01).               05040002
050500         10  MR-AD-INDH                 PIC  X(01).               05050002
050600         10  MR-AD-IND                  PIC  X(01).               05060002
050700                                                                  05070002
050800         10  MR-TROUBLE-REASONL         PIC S9(04) COMP.          05080002
050900         10  MR-TROUBLE-REASONA         PIC  X(01).               05090002
051000         10  MR-TROUBLE-REASONC         PIC  X(01).               05100002
051100         10  MR-TROUBLE-REASONH         PIC  X(01).               05110002
051200         10  MR-TROUBLE-REASON          PIC  X(10).               05120002
051300                                                                  05130002
051400         10  MR-NOTIFICATION-DATE-TIMEL PIC S9(04) COMP.          05140002
051500         10  MR-NOTIFICATION-DATE-TIMEA PIC  X(01).               05150002
051600         10  MR-NOTIFICATION-DATE-TIMEC PIC  X(01).               05160002
051700         10  MR-NOTIFICATION-DATE-TIMEH PIC  X(01).               05170002
051800         10  MR-NOTIFICATION-DATE-TIME  PIC  X(11).               05180002
051900                                                                  05190002
052000         10  MR-RESPONSE-DATE-TIMEL     PIC S9(04) COMP.          05200002
052100         10  MR-RESPONSE-DATE-TIMEA     PIC  X(01).               05210002
052200         10  MR-RESPONSE-DATE-TIMEC     PIC  X(01).               05220002
052300         10  MR-RESPONSE-DATE-TIMEH     PIC  X(01).               05230002
052400         10  MR-RESPONSE-DATE-TIME      PIC  X(11).               05240002
052500                                                                  05250002
052600         10  MR-PROC-AREAL              PIC S9(04) COMP.          05260002
052700         10  MR-PROC-AREAA              PIC  X(01).               05270002
052800         10  MR-PROC-AREAC              PIC  X(01).               05280002
052900         10  MR-PROC-AREAH              PIC  X(01).               05290002
053000         10  MR-PROC-AREA               PIC  X(06).               05300002
053100                                                                  05310002
053200         10  MR-PROC-LINEL              PIC S9(04) COMP.          05320002
053300         10  MR-PROC-LINEA              PIC  X(01).               05330002
053400         10  MR-PROC-LINEC              PIC  X(01).               05340002
053500         10  MR-PROC-LINEH              PIC  X(01).               05350002
053600         10  MR-PROC-LINE               PIC  X(04).               05360002
053700                                                                  05370002
053800     EJECT                                                        05380002
053900*---------------------------------------------------------------* 05390002
054000*    ATTRIBUTE SETTINGS COPYBOOK.                               * 05400002
054100*---------------------------------------------------------------* 05410002
054200                                                                  05420002
054300     COPY DPWS015.                                                05430002
054400                                                                  05440002
054500*---------------------------------------------------------------* 05450002
054600*    FUNCTION KEYS COPYBOOK.                                    * 05460002
054700*---------------------------------------------------------------* 05470002
054800                                                                  05480002
054900     COPY DPWS016.                                                05490002
055000                                                                  05500002
055100*---------------------------------------------------------------* 05510002
055200*    NUMERIC EDIT LAYOUT.                                       * 05520002
055300*---------------------------------------------------------------* 05530002
055400                                                                  05540002
055500     COPY DPWS010I.                                               05550002
055600 EJECT                                                            05560002
055700*---------------------------------------------------------------* 05570002
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 05580008
055900*---------------------------------------------------------------* 05590002
056000                                                                  05600002
056100     COPY DPWS030.                                                05610002
CICS       COPY DPWS930.                                                05611008
056200 EJECT                                                            05620002
056300*---------------------------------------------------------------* 05630002
056400*    PARAMETERS FOR CALLING THE TROUBLE CENTRAL PROCESSING      * 05640002
056500*    MODULE (TMKCS520).                                         * 05650002
056600*---------------------------------------------------------------* 05660002
056700                                                                  05670002
056800     COPY TMWS500.                                                05680002
056900 EJECT                                                            05690002
057000*---------------------------------------------------------------* 05700002
057100*    STANDARD COMMAREA.                                         * 05710002
057200*---------------------------------------------------------------* 05720002
057300                                                                  05730002
057400     COPY DPWS020.                                                05740002
057500     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                05750002
057600                                                                  05760002
057700*---------------------------------------------------------------* 05770002
057800* INTER-APPLICATION COMMAREA.                                   * 05780002
057900*   TMWS001 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 05790002
058000*             SPEC SCREEN.                                      * 05800002
058100*---------------------------------------------------------------* 05810002
058200                                                                  05820002
058300         10  INTER-APPL-COMM-AREA       PIC X(200).               05830002
058400     COPY TMWS001.                                                05840002
058500     COPY POWS013.                                                05850002
058600     COPY RCWS015.                                                05860002
058700     COPY PCWS000.                                                05870002
058800     COPY RCWS800.                                                05880002
058900*---------------------------------------------------------------* 05890002
059000*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 05900002
059100*---------------------------------------------------------------* 05910002
059200         10  ASC-SPECIFIC-COMMAREA.                               05920002
059300             15  ASC-LOCAL-GO-DESTINATION            PIC X(01).   05930002
059400                 88  ASC-STAYING-WITHIN-TROUBLE      VALUE ' '.   05940002
059500                 88  ASC-GOING-TO-PO                 VALUE '1'.   05950002
059600                 88  ASC-RETURNING-FROM-PO           VALUE '1'.   05960002
059700                 88  ASC-GOING-TO-RCVG               VALUE '2'.   05970002
059800                 88  ASC-RETURNING-FROM-RCVG         VALUE '2'.   05980002
059900                 88  ASC-GOING-TO-PKITEM             VALUE '3'.   05990002
060000                 88  ASC-RETURNING-FROM-PKITEM       VALUE '3'.   06000002
060100             15  ASC-OPER-UNT-ID                     PIC 9(04).   06010002
060200             15  ASC-FCLTY-ID                        PIC 9(04).   06020002
060300             15  ASC-FCLTY-NAME                      PIC X(25).   06030002
060400*PS 10/06/2014 Change Starts                                      06040006
060400*            15  ASC-PO-NBR-N                        PIC 9(07).   06041004
060400             15  ASC-PO-NBR-N                        PIC 9(08).   06042004
060400*PS 10/06/2014 Change Ends                                        06043006
060500             15  ASC-PO-LINE-NBR                     PIC 9(04).   06050002
060600             15  ASC-RCVR-SEQ-NBR-N                  PIC 9(04).   06060002
060700             15  ASC-DEPT-NBR                        PIC X(03).   06070002
060800             15  ASC-DRV-LINE-NBR                    PIC 9(04).   06080002
060900             15  ASC-PREPK-ID-KEY                    PIC 9(04).   06090002
061000             15  ASC-ENT-ID                          PIC 9(09).   06100002
061100             15  ASC-VENDOR-NAME                     PIC X(25).   06110002
061200             15  ASC-NOTIF-FROM-DATE-ISO             PIC X(10).   06120002
061300             15  ASC-NOTIF-TO-DATE-ISO               PIC X(10).   06130002
061400             15  ASC-RSLVD-FROM-DATE-ISO             PIC X(10).   06140002
061500             15  ASC-RSLVD-TO-DATE-ISO               PIC X(10).   06150002
061600             15  ASC-TRBL-RSN-CDE.                                06160002
061700                 20  ASC-TRBL-RSN-CDE-N              PIC 9(03).   06170002
061800             15  ASC-NOTIF-TYPE                      PIC X(01).   06180002
061900                 88  ASC-ALL-NOTIF-TYPES             VALUE 'A'    06190002
062000                                                           SPACE. 06200002
062100                 88  ASC-NOTIF-TYPE-ONLY             VALUE 'I'.   06210002
062200                 88  ASC-TRBL-TYPE-ONLY              VALUE 'T'.   06220002
062300             15  ASC-NOTIF-STAT                      PIC X(01).   06230002
062400                 88  ASC-ALL-NOTIF-STATS             VALUE SPACE. 06240002
062500                 88  ASC-NEW-STAT-ONLY               VALUE 'N'.   06250002
062600                 88  ASC-IN-PRC-STAT-ONLY            VALUE 'I'.   06260002
062700                 88  ASC-UNRSLVD-STAT-ONLY           VALUE 'U'.   06270002
062800                 88  ASC-RSLVD-STAT-ONLY             VALUE 'R'.   06280002
062900                 88  ASC-ACKNW-STAT-ONLY             VALUE 'A'.   06290002
063000             15  ASC-DIRECT-STORE                    PIC X(01).   06300002
063100*                                                                 06310002
063200             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                06320002
063300                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  06330002
063400                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   06340002
063500                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   06350002
063600                                                                  06360002
063700                 20  ASC-ITEM-ARRAY.                              06370002
063800                     25  ASC-ITEM-ENTRIES OCCURS 12 TIMES.        06380002
063900                         30  ASC-LIST-ITEM-NUMBER                 06390002
064000                                                     PIC S9(09)   06400002
064100                                                     COMP-3.      06410002
064200                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  06420002
064300                             88  ASC-VALID-SELECT    VALUE ' '    06430002
064400                                                           'S'    06440002
064500                                                           'B'    06450002
064600                                                           'E'.   06460002
064700                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   06470002
064800                             88  ASC-TEMP-SELECT     VALUE 'S'.   06480002
064900                             88  ASC-TEMP-BEGIN      VALUE 'B'.   06490002
065000                             88  ASC-TEMP-END        VALUE 'E'.   06500002
065100                         30  ASC-SELECTED-SW         PIC  X(01).  06510002
065200                             88  ASC-NO-SELECT       VALUE ' '.   06520002
065300                             88  ASC-SELECT          VALUE 'S'.   06530002
065400                             88  ASC-BEGIN           VALUE 'B'.   06540002
065500                             88  ASC-END             VALUE 'E'.   06550002
065600                         30  ASC-ACTION              PIC  X(03).  06560002
065700                         30  ASC-NOTIF-NBR           PIC S9(09)   06570002
065800                                                          COMP.   06580002
065900                         30  ASC-PO-LNE-NBR          PIC  X(04).  06590002
066000                         30  ASC-PO-LNE-NBR-N REDEFINES           06600002
066100                             ASC-PO-LNE-NBR          PIC  9(04).  06610002
066200                         30  ASC-PREPK-ID            PIC  9(04).  06620002
066300                         30  ASC-SKU                 PIC  X(11).  06630002
066400                         30  ASC-AD-IND              PIC  X(01).  06640002
066500                         30  ASC-TROUBLE-REASON-CDE  PIC S9(04)   06650002
066600                                                          COMP.   06660002
066700                         30  ASC-TROUBLE-REASON-DESC PIC  X(10).  06670002
066800                         30  ASC-TROUBLE-RESP-RES-IND             06680002
066900                                                     PIC  X(01).  06690002
067000                         30  ASC-TROUBLE-REASON-LVL  PIC  X(01).  06700002
067100                         30  ASC-NOTIFICATION-DATE-TIME           06710002
067200                                                     PIC  X(11).  06720002
067300                         30  ASC-RESPONSE-DATE-TIME  PIC  X(11).  06730002
067400                         30  ASC-PROC-AREA           PIC  X(06).  06740002
067500                         30  ASC-PROC-LINE           PIC  X(04).  06750002
067600                         30  ASC-RECITM-PREPK-ID     PIC  9(04).  06760002
067700                         30  ASC-TRBL-DTL-EXISTS-SW  PIC  X(01).  06770002
067800                             88  ASC-TRBL-DTL-EXISTS VALUE 'Y'.   06780002
067900                             88  ASC-NO-TRBL-DTL-EXISTS           06790002
068000                                                     VALUE 'N'.   06800002
068100                         30  ASC-TRBL-RESOLVED-SW    PIC  X(01).  06810002
068200                             88  ASC-TRBL-RESOLVED   VALUE 'Y'.   06820002
068300                             88  ASC-TRBL-NOT-RESOLVED            06830002
068400                                                     VALUE 'N'.   06840002
068500                         30  ASC-TRBL-ACK-SW         PIC  X(01).  06850002
068600                             88  ASC-TRBL-ACK        VALUE 'Y'.   06860002
068700                             88  ASC-TRBL-NOT-ACK    VALUE 'N'.   06870002
068800                                                                  06880002
068900             15  ASC-BLK-SUB                         PIC S9(04)   06890002
069000                                                          COMP    06900002
069100                                                          SYNC.   06910002
069200             15  ASC-ITEM-SUB                        PIC S9(04)   06920002
069300                                                          COMP    06930002
069400                                                          SYNC.   06940002
069500             15  ASC-SEL-SUB                         PIC S9(04)   06950002
069600                                                          COMP.   06960002
069700             15  ASC-SEL-ITEM                        PIC S9(04)   06970002
069800                                                          COMP.   06980002
069900             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   06990002
070000                                                          COMP-3. 07000002
070100             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   07010002
070200                                                          COMP-3. 07020002
070300             15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(05)   07030002
070400                                                          COMP-3. 07040002
070500             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   07050002
070600                                                          COMP-3. 07060002
070700             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   07070002
070800                                                          COMP-3. 07080002
070900             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   07090002
071000                                                          COMP-3. 07100002
071100             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   07110002
071200                                                          COMP    07120002
071300                                                          SYNC.   07130002
071400             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   07140002
071500                                                          COMP-3. 07150002
071600             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   07160002
071700                                                          COMP-3. 07170002
071800             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  07180002
071900                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   07190002
072000                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   07200002
072100             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  07210002
072200                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   07220002
072300                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   07230002
072400             15  ASC-PO-INQ-UPD-PERFORMED-SW         PIC  X(01).  07240002
072500                 88  ASC-PO-INQ-UPD-PERFORMED        VALUE 'Y'.   07250002
072600                 88  ASC-PO-INQ-UPD-NOT-PERFORMED    VALUE ' '.   07260002
072700             15  ASC-LIST-QUEUE-NAME.                             07270002
072800                 20  ASC-LIST-TERM-ID                PIC  X(04).  07280002
072900                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   07290002
073000                                                          COMP-3. 07300002
073100                 20  ASC-LIST-SEQ                    PIC  9(01).  07310002
073200             15  ASC-SEL-QUEUE-NAME-IN               PIC X(08).   07320002
073300             15  ASC-SEL-QUEUE-NAME-OUT.                          07330002
073400                 20  ASC-SEL-TERM-ID                 PIC  X(04).  07340002
073500                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   07350002
073600                                                          COMP-3. 07360002
073700                 20  ASC-SEL-SEQ                     PIC  9(01).  07370002
073800                                                                  07380002
073900             15  ASC-CURSOR-SW                       PIC  X(01).  07390002
074000                 88  ASC-NO-CURSOR                   VALUE 'Z'.   07400002
074100                 88  ASC-SYSTEM-ID-CURSOR            VALUE 'S'.   07410002
074200                 88  ASC-MESSAGE-NUMBER-CURSOR       VALUE 'N'.   07420002
074300                 88  ASC-MESSAGE-TEXT-CURSOR         VALUE 'T'.   07430002
074400             15  ASC-START-ITEM-REQUEST.                          07440002
074500                 20  ASC-START-ITEM-REQUEST-N        PIC 9(07).   07450002
074600             15  ASC-USE-SELECTION-QUEUE-IND         PIC X(01).   07460002
074700                 88  ASC-USE-SELECTION-QUEUE         VALUE 'Y'.   07470002
074800             15  ASC-INT-APPL-FORMAT-IND             PIC X(01).   07480002
074900                 88 ASC-INTER-APPL-CRIT-SPEC         VALUE '1'.   07490002
075000                 88 ASC-INTER-APPL-LIST              VALUE '2'.   07500002
075100                 88 ASC-INTER-APPL-RCPT-ITEM         VALUE '3'.   07510002
075200                 88 ASC-INTER-APPL-VERIFY-RCVR       VALUE '4'.   07520002
075300                 88 ASC-INTER-APPL-WO-RCVR           VALUE '5'.   07530002
075400                 88 ASC-INTER-APPL-ITM-LST           VALUE '6'.   07540002
075500                 88 ASC-INTER-APPL-PREPACK           VALUE '7'.   07550002
075600                 88 ASC-INTER-APPL-ITM-ADD           VALUE '8'.   07560002
075700                 88 ASC-INTER-APPL-REDIST            VALUE '9'.   07570002
075800                 88 ASC-INTER-APPL-REC-PREPACK       VALUE 'A'.   07580002
075900     EJECT                                                        07590002
076000*---------------------------------------------------------------* 07600002
076100*    ABEND PROCESSING COPYBOOK.                                 * 07610002
076200*---------------------------------------------------------------* 07620002
076300                                                                  07630002
076400     COPY DPWS013.                                                07640002
076500                                                                  07650002
076600 EJECT                                                            07660002
076700*---------------------------------------------------------------* 07670002
076710*  RECORD LAYOUT FOR LOGISTICS DOMAIN ITEM ACCESS MODULE        * 07671002
076720*---------------------------------------------------------------* 07672002
076730     COPY XLWS001.                                                07673002
076740*---------------------------------------------------------------* 07674002
076750*  RECORD LAYOUT FOR LOGISTICS DOMAIN LOCATION ACCESS MODULE    * 07675002
076760*---------------------------------------------------------------* 07676002
076770     COPY XLWS071.                                                07677002
076780*---------------------------------------------------------------* 07678002
076790*    DB2 AREA FOR TTRBNTF - TROUBLE NOTIFICATION                * 07679002
076800*---------------------------------------------------------------* 07680002
076900     EXEC SQL                                                     07690002
077000          INCLUDE TTRBNTF                                         07700002
077100     END-EXEC.                                                    07710002
077200*---------------------------------------------------------------* 07720002
077300*    DB2 AREA FOR TTRBRSN - TROUBLE REASON                      * 07730002
077400*---------------------------------------------------------------* 07740002
077500     EXEC SQL                                                     07750002
077600          INCLUDE TTRBRSN                                         07760002
077700     END-EXEC.                                                    07770002
077800*---------------------------------------------------------------* 07780002
077900*    DB2 AREA FOR TTRBDTL - TROUBLE DETAIL                      * 07790002
078000*---------------------------------------------------------------* 07800002
078100     EXEC SQL                                                     07810002
078200          INCLUDE TTRBDTL                                         07820002
078300     END-EXEC.                                                    07830002
078400*---------------------------------------------------------------* 07840002
078500*    DB2 AREA FOR TRECEIV - RECEIVER                            * 07850002
078600*---------------------------------------------------------------* 07860002
078700     EXEC SQL                                                     07870002
078800          INCLUDE TRECEIV                                         07880002
078900     END-EXEC.                                                    07890002
079000*---------------------------------------------------------------* 07900002
079100*    DB2 AREA FOR TRECITM - RECEIVE ITEM                        * 07910002
079200*---------------------------------------------------------------* 07920002
079300     EXEC SQL                                                     07930002
079400          INCLUDE TRECITM                                         07940002
079500     END-EXEC.                                                    07950002
079600*---------------------------------------------------------------* 07960002
079700*    DB2 AREA FOR TENTNME - ENTITY NAME                         * 07970002
079800*---------------------------------------------------------------* 07980002
079900     EXEC SQL                                                     07990002
080000          INCLUDE TENTNME                                         08000002
080100     END-EXEC.                                                    08010002
080200*---------------------------------------------------------------* 08020002
080300*    DB2 AREA FOR TPURCHS - PURCHASE ORDER HEADER TABLE         * 08030002
080400*---------------------------------------------------------------* 08040002
080500     EXEC SQL                                                     08050002
080600          INCLUDE TPURCHS                                         08060002
080700     END-EXEC.                                                    08070002
080800*---------------------------------------------------------------* 08080002
080900*    DB2 AREA FOR TPURITM - PURCHASE ORDER ITEM TABLE           * 08090002
081000*---------------------------------------------------------------* 08100002
081100     EXEC SQL                                                     08110002
081200          INCLUDE TPURITM                                         08120002
081300     END-EXEC.                                                    08130002
081400*---------------------------------------------------------------* 08140002
081500*    DB2 AREA FOR COMMUNICATIONS                                * 08150002
081600*---------------------------------------------------------------* 08160002
081700     EXEC SQL                                                     08170002
081800          INCLUDE SQLCA                                           08180002
081900     END-EXEC.                                                    08190002
082000                                                                  08200002
082100*---------------------------------------------------------------* 08210002
082200*    TROUBLE NOTIFICATION BY PO LIST CURSOR                     * 08220002
082300*---------------------------------------------------------------* 08230002
082400                                                                  08240002
082500     EXEC SQL                                                     08250002
082600          DECLARE TRBL-NTF-BY-PO-CSR CURSOR                       08260002
082700          FOR SELECT                                              08270002
082800                A.NOTIF_NBR                                       08280002
082900              , A.OPER_UNT_ID                                     08290002
083000              , A.FCLTY_ID                                        08300002
083100              , A.DEPT_NBR                                        08310002
083200              , A.ENT_ID                                          08320002
083300              , A.PO_NBR                                          08330002
083400              , A.PO_LNE_NBR                                      08340002
083500              , A.REC_SEQ_NBR                                     08350002
083600              , A.TRBL_RSN_CDE                                    08360002
083700              , A.NOTIF_TMST                                      08370002
083800              , A.RESOLVED_IND                                    08380002
083900              , A.RESOLVED_TMST                                   08390002
084000              , A.ACKNOWLG_TMST                                   08400002
084100              , A.OVER_SHT_PCT                                    08410002
084200              , A.PREPK_ID                                        08420002
084300              , B.TRBL_SHT_DESC                                   08430002
084400              , B.RESP_RES_IND                                    08440002
084500              , B.TRBL_LVL_IND                                    08450002
084600*JPL          , C.PREPK_ID                                        08460002
084700           FROM                                                   08470002
084800                TTRBNTF A                                         08480002
084900              , TTRBRSN B                                         08490002
085000*JPL          , TRECITM C                                         08500002
085100          WHERE A.OPER_UNT_ID   BETWEEN :DK-OPER-UNT-ID-LOW       08510002
085200                                    AND :DK-OPER-UNT-ID-HIGH      08520002
085300            AND A.FCLTY_ID      BETWEEN :DK-FCLTY-ID-LOW          08530002
085400                                    AND :DK-FCLTY-ID-HIGH         08540002
085500            AND A.PO_NBR              = :DK-PO-NBR                08550002
085600            AND A.REC_SEQ_NBR         = :DK-REC-SEQ-NBR           08560002
085700            AND (A.PO_LNE_NBR         > :PC-ZERO                  08570002
085800             OR A.PREPK_ID            > :PC-ZERO)                 08580002
085900            AND A.TRBL_RSN_CDE  BETWEEN :DK-TRBL-RSN-CDE-LOW      08590002
086000                                    AND :DK-TRBL-RSN-CDE-HIGH     08600002
086100            AND A.NOTIF_TMST    BETWEEN :DK-NOTIF-DTE-LOW         08610002
086200                                    AND :DK-NOTIF-DTE-HIGH        08620002
086300            AND A.RESOLVED_IND      IN (:DK-NOTIF-STAT-1          08630002
086400                                      , :DK-NOTIF-STAT-2          08640002
086500                                      , :DK-NOTIF-STAT-3          08650002
086600                                      , :DK-NOTIF-STAT-4)         08660002
086700            AND A.RESOLVED_TMST BETWEEN :DK-RSLVD-DTE-LOW         08670002
086800                                    AND :DK-RSLVD-DTE-HIGH        08680002
086900                                                                  08690002
087000            AND B.NOTIF_IND         IN (:DK-NOTIF-TYPE-1          08700002
087100                                      , :DK-NOTIF-TYPE-2)         08710002
087200            AND A.TRBL_RSN_CDE        =  B.TRBL_RSN_CDE           08720002
087300                                                                  08730002
087400*JPL        AND C.ORD_NBR             =  A.PO_NBR                 08740002
087500*JPL        AND C.REC_SEQ_NBR         =  A.REC_SEQ_NBR            08750002
087600*JPL        AND C.OPER_UNT_ID         =  A.OPER_UNT_ID            08760002
087700*JPL        AND C.FCLTY_ID            =  A.FCLTY_ID               08770002
087800*JPL        AND ((C.ORD_LNE_NBR       =  A.PO_LNE_NBR)            08780002
087900*JPL         OR ((C.PREPK_ID          =  A.PREPK_ID)              08790002
088000*JPL         AND (C.PREPK_DRV_LNE_CDE = :PC-A)))                  08800002
088100                                                                  08810002
088200          ORDER BY                                                08820002
088300                A.PREPK_ID                                        08830002
088400              , A.PO_LNE_NBR                                      08840002
088500              , A.NOTIF_TMST                                      08850002
088600     END-EXEC.                                                    08860002
088700                                                                  08870002
088800*---------------------------------------------------------------* 08880002
088900*    TROUBLE NOTIFICATION BY PO LINE LIST CURSOR                * 08890002
089000*---------------------------------------------------------------* 08900002
089100                                                                  08910002
089200     EXEC SQL                                                     08920002
089300          DECLARE TRBL-NTF-PO-LN-CSR CURSOR                       08930002
089400          FOR SELECT                                              08940002
089500                A.NOTIF_NBR                                       08950002
089600              , A.OPER_UNT_ID                                     08960002
089700              , A.FCLTY_ID                                        08970002
089800              , A.DEPT_NBR                                        08980002
089900              , A.ENT_ID                                          08990002
090000              , A.PO_NBR                                          09000002
090100              , A.PO_LNE_NBR                                      09010002
090200              , A.REC_SEQ_NBR                                     09020002
090300              , A.TRBL_RSN_CDE                                    09030002
090400              , A.NOTIF_TMST                                      09040002
090500              , A.RESOLVED_IND                                    09050002
090600              , A.RESOLVED_TMST                                   09060002
090700              , A.ACKNOWLG_TMST                                   09070002
090800              , A.OVER_SHT_PCT                                    09080002
090900              , B.TRBL_SHT_DESC                                   09090002
091000              , B.RESP_RES_IND                                    09100002
091100              , B.TRBL_LVL_IND                                    09110002
091200              , A.PREPK_ID                                        09120002
091300           FROM                                                   09130002
091400                TTRBNTF A                                         09140002
091500              , TTRBRSN B                                         09150002
091600*JPL          , TRECITM C                                         09160002
091700          WHERE                                                   09170002
091800                A.OPER_UNT_ID         = :DK-OPER-UNT-ID-LOW       09180002
091900            AND A.FCLTY_ID            = :DK-FCLTY-ID-LOW          09190002
092000            AND A.PO_NBR              = :DK-PO-NBR                09200002
092100            AND A.REC_SEQ_NBR         = :DK-REC-SEQ-NBR           09210002
092200                                                                  09220002
092300*JPL        AND C.ORD_NBR             = :DK-PO-NBR                09230002
092400*JPL        AND C.REC_SEQ_NBR         = :DK-REC-SEQ-NBR           09240002
092500*JPL        AND C.ORD_LNE_NBR         = :DK-PO-LNE-NBR            09250002
092600                                                                  09260002
092700            AND (A.PO_LNE_NBR         > :PC-ZERO                  09270002
092800             OR A.PREPK_ID            > :PC-ZERO)                 09280002
092900            AND A.TRBL_RSN_CDE        =  B.TRBL_RSN_CDE           09290002
093000                                                                  09300002
093100            AND ((A.PO_LNE_NBR        = :DK-PO-LNE-NBR            09310002
093200            AND   B.TRBL_LVL_IND     <> :PC-M)                    09320002
093300             OR  (A.PREPK_ID          = :DK-PREPK-ID-KEY          09330002
093400            AND   B.TRBL_LVL_IND      = :PC-M))                   09340002
093500          ORDER BY                                                09350002
093600                A.PREPK_ID                                        09360002
093700              , A.PO_LNE_NBR                                      09370002
093800              , A.NOTIF_TMST                                      09380002
093900     END-EXEC.                                                    09390002
094000                                                                  09400002
094100*---------------------------------------------------------------* 09410002
094200*    TROUBLE NOTIFICATION BY PACK & ASSOC PO LINES CURSOR       * 09420002
094300*---------------------------------------------------------------* 09430002
094400     EXEC SQL                                                     09440002
094500          DECLARE TRBL-PK-AND-LN-CSR CURSOR                       09450002
094600          FOR SELECT DISTINCT                                     09460002
094700                A.NOTIF_NBR                                       09470002
094800              , A.OPER_UNT_ID                                     09480002
094900              , A.FCLTY_ID                                        09490002
095000              , A.DEPT_NBR                                        09500002
095100              , A.ENT_ID                                          09510002
095200              , A.PO_NBR                                          09520002
095300              , A.PO_LNE_NBR                                      09530002
095400              , A.REC_SEQ_NBR                                     09540002
095500              , A.TRBL_RSN_CDE                                    09550002
095600              , A.NOTIF_TMST                                      09560002
095700              , A.RESOLVED_IND                                    09570002
095800              , A.RESOLVED_TMST                                   09580002
095900              , A.ACKNOWLG_TMST                                   09590002
096000              , A.OVER_SHT_PCT                                    09600002
096100              , B.TRBL_SHT_DESC                                   09610002
096200              , B.RESP_RES_IND                                    09620002
096300              , B.TRBL_LVL_IND                                    09630002
096400              , A.PREPK_ID                                        09640002
096500                                                                  09650002
096600           FROM TTRBNTF A                                         09660002
096700              , TTRBRSN B                                         09670002
096800              , TRECITM C                                         09680002
096900                                                                  09690002
097000          WHERE A.PO_NBR              = :DK-PO-NBR                09700002
097100            AND A.REC_SEQ_NBR         = :DK-REC-SEQ-NBR           09710002
097200            AND A.OPER_UNT_ID         = :DK-OPER-UNT-ID-LOW       09720002
097300            AND A.FCLTY_ID            = :DK-FCLTY-ID-LOW          09730002
097400            AND C.PREPK_ID            = :DK-PREPK-ID-KEY          09740002
097500                                                                  09750002
097600            AND ((A.PO_LNE_NBR        = C.ORD_LNE_NBR             09760002
097700            AND   B.TRBL_LVL_IND     <> :PC-M)                    09770002
097800            OR   (A.PREPK_ID          = :DK-PREPK-ID-KEY          09780002
097900            AND   B.TRBL_LVL_IND      = :PC-M))                   09790002
098000                                                                  09800002
098100            AND C.ORD_NBR             = :DK-PO-NBR                09810002
098200            AND C.REC_SEQ_NBR         = :DK-REC-SEQ-NBR           09820002
098300            AND C.OPER_UNT_ID         = :DK-OPER-UNT-ID-LOW       09830002
098400            AND C.FCLTY_ID            = :DK-FCLTY-ID-LOW          09840002
098500                                                                  09850002
098600            AND A.TRBL_RSN_CDE        =  B.TRBL_RSN_CDE           09860002
098700                                                                  09870002
098800          ORDER BY                                                09880002
098900                A.PREPK_ID                                        09890002
099000              , A.PO_LNE_NBR                                      09900002
099100              , A.NOTIF_TMST                                      09910002
099200     END-EXEC.                                                    09920002
099300                                                                  09930002
099400 EJECT                                                            09940002
099500 LINKAGE SECTION.                                                 09950002
099600                                                                  09960002
099700 01  DFHCOMMAREA.                                                 09970002
099800     05  FILLER                         OCCURS  1 TO 4072 TIMES   09980002
099900                                        DEPENDING ON EIBCALEN.    09990002
100000         10  FILLER                     PIC X.                    10000002
100100                                                                  10010002
100200 EJECT                                                            10020002
100300 PROCEDURE DIVISION.                                              10030002
100400******************************************************************10040002
100500**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **10050002
100600**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **10060002
100700**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **10070002
100800******************************************************************10080002
100900 0000-MAIN-MODULE.                                                10090002
101000     INITIALIZE DP030-CICS-API-FIELDS.                            10100002
101100     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       10110002
101200     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          10120002
101300     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         10130002
101400     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       10140002
101500     MOVE LENGTH OF TM503AI        TO DP030-MAP-LENGTH (1).       10150002
101600     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     10160002
101700     SET DP030-OVERRIDE-APPL-ERROR TO TRUE.                       10170002
101800*                                                                 10180002
101900     PERFORM 0001-CALL-CICS-ARCH-API.                             10190002
102000     PERFORM 1000-CONTROL-PROCESSING                              10200002
102100*                                                                 10210002
102200     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     10220002
102300     PERFORM 0001-CALL-CICS-ARCH-API.                             10230002
102400                                                                  10240002
102500******************************************************************10250002
102600**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **10260002
102700**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **10270002
102800******************************************************************10280002
102900 0001-CALL-CICS-ARCH-API.                                         10290002
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      10300008
103100                                    DFHCOMMAREA                   10310008
103200                                    DP030-CICS-API-FIELDS         10320008
103300                                    DP020-STANDARD-COMMAREA       10330008
103400                                    TM503AI.                      10340008
103500*                                                                 10350002
103600     IF DP030-RC-CALL-SUCCESSFUL OR                               10360002
103700        DP030-RC-APPL-ERROR                                       10370002
103800         CONTINUE                                                 10380002
103900     ELSE                                                         10390002
104000         SET DP013-NO-ROLLBACK                                    10400002
104100             DP013-XCTL-DISPLAY-RESTART                           10410002
104200             DP013-CICS-ABEND      TO TRUE                        10420002
104300         MOVE '0001-CALL-CICS-ARCH-API'                           10430002
104400                                   TO DP013-PARAGRAPH             10440002
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O10441008
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      10442008
104700         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      10470002
104800         PERFORM DP013-0000-PROCESS-ABEND                         10480002
104900     END-IF.                                                      10490002
105000*----------------------------------------------------------------*10500002
105100* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *10510002
105200* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *10520002
105300*                                                                *10530002
105400* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *10540002
105500*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *10550002
105600*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *10560002
105700*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *10570002
105800*----------------------------------------------------------------*10580002
105900                                                                  10590002
106000 1000-CONTROL-PROCESSING.                                         10600002
106100                                                                  10610002
106200     EVALUATE TRUE                                                10620002
106300         WHEN DP030-RC-APPL-ERROR                                 10630002
106400             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         10640002
106500             MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                10650002
106600             IF ASC-RETURNING-FROM-PO                             10660002
106700                 PERFORM 2140-DESELECT-ALL-ITEMS                  10670002
106800             ELSE                                                 10680002
106900                 PERFORM 6000-REFRESH-PANEL-FROM-TEMP             10690002
107000             END-IF                                               10700002
107100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   10710002
107200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10720002
107300                                                                  10730002
107400         WHEN DP020-NEXT-ACT-INITIAL                              10740002
107500             INITIALIZE ASC-SPECIFIC-COMMAREA                     10750002
107600             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            10760002
107700                                      ASC-SEL-TERM-ID             10770002
107800             MOVE DP020-SRC-TASK-NUMBER                           10780002
107900                                   TO ASC-LIST-TASK-NUMBER        10790002
108000                                      ASC-SEL-TASK-NUMBER         10800002
108100             MOVE PC-LIST-QUEUE-SEQ                               10810002
108200                                   TO ASC-LIST-SEQ                10820002
108300             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 10830002
108400             PERFORM 1100-PROCESS-INTER-APPL-COMM                 10840002
108500                                                                  10850002
108600             IF  PS-COMMAREA-NOT-VALID                            10860002
108700                 SET DP020-NEXT-ACT-APPL-ERROR                    10870002
108800                                   TO TRUE                        10880002
108900             ELSE                                                 10890002
109000                 PERFORM 4000-BUILD-INITIAL-PANEL                 10900002
109100             END-IF                                               10910002
109200                                                                  10920002
109300         WHEN DP020-NEXT-ACT-READ-MAP                             10930002
109400             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        10940002
109500                                   TO PV-TOP-ITEM                 10950002
109600             PERFORM 2000-PROCESS-PANEL                           10960002
109700                                                                  10970002
109800         WHEN DP020-NEXT-ACT-RETURN                               10980002
109900             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        10990002
110000                                   TO PV-TOP-ITEM                 11000002
110100             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    11010002
110200             IF ASC-RETURNING-FROM-PO                             11020002
110300               OR ASC-RETURNING-FROM-RCVG                         11030002
110400**dmh 3/21/14  OR ASC-RETURNING-FROM-PKITEM                       11040003
110500                 PERFORM 2140-DESELECT-ALL-ITEMS                  11050002
110600                 PERFORM 6000-REFRESH-PANEL-FROM-TEMP             11060002
110700             ELSE                                                 11070002
110800                 PERFORM 6000-REFRESH-PANEL-FROM-TEMP             11080002
110900             END-IF                                               11090002
111000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   11100002
111100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11110002
111200                                                                  11120002
111300         WHEN OTHER                                               11130002
111400             SET DP013-LOGIC-ABEND TO TRUE                        11140002
111500             SET DP013-NO-ROLLBACK TO TRUE                        11150002
111600             MOVE '1000-CONTROL-PROCESSING'                       11160002
111700                                   TO DP013-PARAGRAPH             11170002
111800             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    11180002
111900                                   TO DP013-MESSAGE-TEXT(1)       11190002
112000             PERFORM DP013-0000-PROCESS-ABEND                     11200002
112100     END-EVALUATE.                                                11210002
112200                                                                  11220002
112300 EJECT                                                            11230002
112400*----------------------------------------------------------------*11240002
112500* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *11250002
112600* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *11260002
112700*----------------------------------------------------------------*11270002
112800                                                                  11280002
112900 1100-PROCESS-INTER-APPL-COMM.                                    11290002
113000                                                                  11300002
113100     SET PS-COMMAREA-VALID         TO TRUE.                       11310002
113200     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     11320002
113300                                                                  11330002
113400     MOVE DP020-INT-APPL-FORMAT-IND TO ASC-INT-APPL-FORMAT-IND.   11340002
113500     EVALUATE DP020-INT-APPL-FORMAT-IND                           11350002
113600                                                                  11360002
113700         WHEN PC-INTER-APPL-CRIT-SPEC                             11370002
113800                                                                  11380002
113900**           THIS PROGRAM ASSUMES THAT INTER-APPL FIELDS ARE      11390002
114000**           PROPERLY INITIALIZED...                              11400002
114100                                                                  11410002
114200             IF (TM001-PO-NBR = SPACES)  AND                      11420002
114300                (PS-NO-ERROR)                                     11430002
114400                 MOVE PC-TSYMSG-00461  TO DP020-MSG-NUMBER        11440002
114500                 SET PS-ERROR                                     11450002
114600                     PS-COMMAREA-NOT-VALID                        11460002
114700                     DP020-MSG-FATAL   TO TRUE                    11470002
114800             END-IF                                               11480002
114900                                                                  11490002
115000             IF (TM001-RCVR-SEQ-NBR = SPACES OR ZEROES)  AND      11500002
115100                (PS-NO-ERROR)                                     11510002
115200                 MOVE PC-TSYMSG-00737  TO DP020-MSG-NUMBER        11520002
115300                 SET PS-ERROR                                     11530002
115400                     PS-COMMAREA-NOT-VALID                        11540002
115500                     DP020-MSG-FATAL   TO TRUE                    11550002
115600             END-IF                                               11560002
115700                                                                  11570002
115800             IF  PS-NO-ERROR                                      11580002
115900                 MOVE TM001-OPER-UNT-ID         TO                11590002
116000                      ASC-OPER-UNT-ID                             11600002
116100                 MOVE TM001-FCLTY-ID            TO                11610002
116200                      ASC-FCLTY-ID                                11620002
116300                 MOVE TM001-PO-NBR-N            TO                11630002
116400                      ASC-PO-NBR-N                                11640002
116500                 MOVE TM001-RCVR-SEQ-NBR-N      TO                11650002
116600                      ASC-RCVR-SEQ-NBR-N                          11660002
116700                 MOVE TM001-NOTIF-FROM-DATE-ISO TO                11670002
116800                      ASC-NOTIF-FROM-DATE-ISO                     11680002
116900                 MOVE TM001-NOTIF-TO-DATE-ISO   TO                11690002
117000                      ASC-NOTIF-TO-DATE-ISO                       11700002
117100                 MOVE TM001-RSLVD-FROM-DATE-ISO TO                11710002
117200                      ASC-RSLVD-FROM-DATE-ISO                     11720002
117300                 MOVE TM001-RSLVD-TO-DATE-ISO   TO                11730002
117400                      ASC-RSLVD-TO-DATE-ISO                       11740002
117500                 MOVE TM001-TRBL-REASON         TO                11750002
117600                      ASC-TRBL-RSN-CDE                            11760002
117700                 MOVE TM001-NOTIF-TYPE          TO                11770002
117800                      ASC-NOTIF-TYPE                              11780002
117900                 MOVE TM001-NOTIF-STAT          TO                11790002
118000                      ASC-NOTIF-STAT                              11800002
118100                 MOVE TM001-DIRECT-STORE        TO                11810002
118200                      ASC-DIRECT-STORE                            11820002
118300             END-IF                                               11830002
118400                                                                  11840002
118500         WHEN PC-INTER-APPL-LIST                                  11850002
118600         WHEN PC-INTER-APPL-REC-PREPACK                           11860002
118700             SET ASC-USE-SELECTION-QUEUE TO TRUE                  11870002
118800             MOVE TM001-NUMBER-OF-SELECTED-ITEMS                  11880002
118900                                   TO ASC-NUMBER-OF-SELECTED-ITEMS11890002
119000             MOVE TM001-NUMBER-OF-TS-ITEMS                        11900002
119100                                   TO ASC-NUMBER-OF-TS-ITEMS      11910002
119200             MOVE TM001-SEL-QUEUE-NAME                            11920002
119300                                   TO ASC-SEL-QUEUE-NAME-IN       11930002
119400             PERFORM 1120-PREPARE-LIST-ENTRY                      11940002
119500                                                                  11950002
119600         WHEN PC-INTER-APPL-RCPT-ITEM                             11960002
119700             MOVE PC000-OPERATING-UNIT-ID                         11970002
119800                                      TO ASC-OPER-UNT-ID          11980002
119900             MOVE PC000-FACILITY-ID   TO ASC-FCLTY-ID             11990002
120000             MOVE PC000-PO-NBR-N      TO ASC-PO-NBR-N             12000002
120100             MOVE PC000-REC-SEQ-NBR-N TO ASC-RCVR-SEQ-NBR-N       12010002
120200             MOVE PC000-LINE-NBR-N    TO ASC-PO-LINE-NBR          12020002
120300                                                                  12030002
120400         WHEN PC-INTER-APPL-WO-RCVR                               12040002
120500         WHEN PC-INTER-APPL-ITM-LST                               12050002
120600         WHEN PC-INTER-APPL-PREPACK                               12060002
120700         WHEN PC-INTER-APPL-REDIST                                12070002
120800             IF PC000-NUMBER-OF-SELECTED-ITEMS > ZERO             12080002
120900                 SET ASC-USE-SELECTION-QUEUE TO TRUE              12090002
121000                 MOVE PC000-NUMBER-OF-SELECTED-ITEMS              12100002
121100                              TO ASC-NUMBER-OF-SELECTED-ITEMS     12110002
121200                 MOVE PC000-NUMBER-OF-TS-ITEMS                    12120002
121300                              TO ASC-NUMBER-OF-TS-ITEMS           12130002
121400                 MOVE PC000-SEL-QUEUE-NAME                        12140002
121500                              TO ASC-SEL-QUEUE-NAME-IN            12150002
121600                 PERFORM 1140-PREPARE-LIST-ENTRY                  12160002
121700                 PERFORM 1141-GET-RECITM-PACK-ID                  12170002
121800             ELSE                                                 12180002
121900                 SET DP030-OVERRIDE-GO                            12190002
122000                                   TO TRUE                        12200002
122100                 MOVE PC-TSYMSG-00057                             12210002
122200                                   TO DP020-MSG-NUMBER            12220002
122300                 SET DP020-MSG-WARNING                            12230002
122400                     DP020-NEXT-ACT-APPL-ERROR                    12240002
122500                     PS-COMMAREA-NOT-VALID                        12250002
122600                                 TO TRUE                          12260002
122700             END-IF                                               12270002
122800                                                                  12280002
122900         WHEN PC-INTER-APPL-ITM-ADD                               12290002
123000             MOVE PC000-PO-NBR-N                                  12300002
123100                             TO ASC-PO-NBR-N                      12310002
123200             MOVE PC000-REC-SEQ-NBR-N                             12320002
123300                             TO ASC-RCVR-SEQ-NBR-N                12330002
123400             MOVE PC000-OPERATING-UNIT-ID                         12340002
123500                             TO ASC-OPER-UNT-ID                   12350002
123600             MOVE PC000-FACILITY-ID                               12360002
123700                             TO ASC-FCLTY-ID                      12370002
123800             MOVE PC000-LINE-NBR-N                                12380002
123900                             TO ASC-PO-LINE-NBR                   12390002
124000                                                                  12400002
124100         WHEN PC-INTER-APPL-VERIFY-RCVR                           12410002
124200             IF RC015-NUMBER-OF-SELECTED-ITEMS > ZERO             12420002
124300                 SET ASC-USE-SELECTION-QUEUE TO TRUE              12430002
124400                 MOVE RC015-NUMBER-OF-SELECTED-ITEMS              12440002
124500                              TO ASC-NUMBER-OF-SELECTED-ITEMS     12450002
124600                 MOVE RC015-NUMBER-OF-TS-ITEMS                    12460002
124700                              TO ASC-NUMBER-OF-TS-ITEMS           12470002
124800                 MOVE RC015-SEL-QUEUE-NAME                        12480002
124900                              TO ASC-SEL-QUEUE-NAME-IN            12490002
125000                 PERFORM 1130-PREPARE-LIST-ENTRY                  12500002
125100                 MOVE RC015-OPER-UNT-ID                           12510002
125200                              TO ASC-OPER-UNT-ID                  12520002
125300                 MOVE RC015-FCLTY-ID                              12530002
125400                              TO ASC-FCLTY-ID                     12540002
125500                 MOVE RC015-PO-NBR                                12550002
125600                              TO ASC-PO-NBR-N                     12560002
125700                 MOVE RC015-REC-SEQ-NBR                           12570002
125800                              TO ASC-RCVR-SEQ-NBR-N               12580002
125900                 PERFORM 1141-GET-RECITM-PACK-ID                  12590002
126000             ELSE                                                 12600002
126100                 SET DP030-OVERRIDE-GO                            12610002
126200                                   TO TRUE                        12620002
126300                 MOVE PC-TSYMSG-00057                             12630002
126400                                   TO DP020-MSG-NUMBER            12640002
126500                 SET DP020-MSG-WARNING                            12650002
126600                     DP020-NEXT-ACT-APPL-ERROR                    12660002
126700                     PS-COMMAREA-NOT-VALID                        12670002
126800                                 TO TRUE                          12680002
126900             END-IF                                               12690002
127000     END-EVALUATE.                                                12700002
127100 EJECT                                                            12710002
127200*----------------------------------------------------------------*12720002
127300* ENTRY IS FROM A LIST.  GET THE MESSAGE NUMBER FROM THE TEMP    *12730002
127400* STORAGE QUEUE PASSED FROM THE LIST.                            *12740002
127500*----------------------------------------------------------------*12750002
127600 1120-PREPARE-LIST-ENTRY.                                         12760002
127700     MOVE TM002-MAX-ITEMS          TO ASC-SEL-SUB.                12770002
127800     MOVE ZERO                     TO ASC-SEL-ITEM.               12780002
127900     PERFORM 2300-GET-NEXT-RECORD.                                12790002
128000                                                                  12800002
128100 1130-PREPARE-LIST-ENTRY.                                         12810002
128200                                                                  12820002
128300     MOVE RC013-MAX-ITEMS      TO ASC-SEL-SUB.                    12830002
128400     MOVE ZERO                 TO PV-SEL-QUEUE-ITEM.              12840002
128500     MOVE ZERO                 TO ASC-SEL-ITEM.                   12850002
128600     PERFORM 2400-GET-NEXT-RECORD.                                12860002
128700                                                                  12870002
128800                                                                  12880002
128900 1140-PREPARE-LIST-ENTRY.                                         12890002
129000                                                                  12900002
129100     MOVE PC016-MAX-ITEMS      TO ASC-SEL-SUB.                    12910002
129200     MOVE ZERO                 TO PV-SEL-QUEUE-ITEM.              12920002
129300     MOVE ZERO                 TO ASC-SEL-ITEM.                   12930002
129400     PERFORM 2500-GET-NEXT-RECORD.                                12940002
129500                                                                  12950002
129600*----------------------------------------------------------------*12960002
129700*    IF 'DRIVER LINE', GET PACK ID.                              *12970002
129800*----------------------------------------------------------------*12980002
129900 1141-GET-RECITM-PACK-ID.                                         12990002
130000                                                                  13000002
130100     MOVE ASC-PO-NBR-N          TO DK-PO-NBR.                     13010002
130200     MOVE ASC-RCVR-SEQ-NBR-N    TO DK-REC-SEQ-NBR.                13020002
130300     MOVE ASC-OPER-UNT-ID       TO DK-OPER-UNT-ID.                13030002
130400     MOVE ASC-FCLTY-ID          TO DK-FCLTY-ID.                   13040002
130500     MOVE ASC-PO-LINE-NBR       TO DK-PO-LNE-NBR.                 13050002
130600                                                                  13060002
130700     EXEC SQL                                                     13070002
130800         SELECT DISTINCT                                          13080002
130900                PREPK_ID                                          13090002
131000           INTO :DK-PREPK-ID-KEY                                  13100002
131100           FROM TRECITM                                           13110002
131200          WHERE ORD_NBR            = :DK-PO-NBR                   13120002
131300            AND REC_SEQ_NBR        = :DK-REC-SEQ-NBR              13130002
131400            AND OPER_UNT_ID        = :DK-OPER-UNT-ID              13140002
131500            AND FCLTY_ID           = :DK-FCLTY-ID                 13150002
131600            AND ORD_LNE_NBR        = :DK-PO-LNE-NBR               13160002
131700     END-EXEC.                                                    13170002
131800                                                                  13180002
131900     EVALUATE TRUE                                                13190002
132000       WHEN SQLCODE = ZERO                                        13200002
132100           MOVE DK-PREPK-ID-KEY TO ASC-PREPK-ID-KEY               13210002
132200                                                                  13220002
132300       WHEN SQLCODE = +100                                        13230002
132400           MOVE ZEROES TO DK-PREPK-ID-KEY                         13240002
132500                                                                  13250002
132600       WHEN SQLWARN0 NOT = SPACE                                  13260002
132700       WHEN SQLCODE  NOT = ZERO                                   13270002
132800           MOVE '1141-GET-RECITM-PACK-ID' TO DP013-PARAGRAPH      13280002
132900           MOVE 'GET DRIVER PACK'  TO DP013-MESSAGE-TEXT (1)      13290002
133000           MOVE ASC-PO-NBR-N       TO PV-ERROR-PO-NBR             13300002
133100           MOVE ASC-RCVR-SEQ-NBR-N TO PV-ERROR-REC-SEQ-NBR        13310002
133200           MOVE ASC-OPER-UNT-ID    TO PV-ERROR-OPER-UNT-ID        13320002
133300           MOVE ASC-PO-LINE-NBR    TO PV-ERROR-PREPK-ID           13330002
133400           STRING ' RCVR: '             DELIMITED BY SIZE         13340002
133500                  PV-ERROR-PO-NBR       DELIMITED BY SIZE         13350002
133600                  '-'                   DELIMITED BY SIZE         13360002
133700                  PV-ERROR-REC-SEQ-NBR  DELIMITED BY SIZE         13370002
133800                  '  OPER-UNT-ID: '     DELIMITED BY SIZE         13380002
133900                  PV-ERROR-OPER-UNT-ID  DELIMITED BY SIZE         13390002
134000                  '  LINE NBR: '        DELIMITED BY SIZE         13400002
134100                  PV-ERROR-PREPK-ID     DELIMITED BY SIZE         13410002
134200             INTO DP013-MESSAGE-TEXT (2)                          13420002
134300           MOVE SQLCA      TO DP013-SQLCA                         13430002
134400           MOVE 'TRECITM ' TO DP013-DB2-TABLE-NAME (1)            13440002
134500           SET DP013-DB2-ABEND TO TRUE                            13450002
134600           PERFORM DP013-0000-PROCESS-ABEND                       13460002
134700     END-EVALUATE.                                                13470002
134800                                                                  13480002
134900                                                                  13490002
135000*----------------------------------------------------------------*13500002
135100* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *13510002
135200* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *13520002
135300* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *13530002
135400* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *13540002
135500* FUNCTION KEYS CAN GET THIS FAR.                                *13550002
135600*----------------------------------------------------------------*13560002
135700 2000-PROCESS-PANEL.                                              13570002
135800                                                                  13580002
135900     EVALUATE TRUE                                                13590002
136000         WHEN DP020-SRC-AID = DP016-CLEAR                         13600002
136100             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    13610002
136200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   13620002
136300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 13630002
136400                                                                  13640002
136500         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    13650002
136600             PERFORM 2050-DELETE-LIST-QUEUE                       13660002
136700             PERFORM 4000-BUILD-INITIAL-PANEL                     13670002
136800                                                                  13680002
136900         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    13690002
137000             PERFORM 2140-DESELECT-ALL-ITEMS                      13700002
137100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 13710002
137200                                                                  13720002
137300         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  13730002
137400             PERFORM 2150-SELECT-ALL-ITEMS                        13740002
137500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 13750002
137600                                                                  13760002
137700         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             13770002
137800             IF ASC-USE-SELECTION-QUEUE                           13780002
137900                 PERFORM 6200-DEL-LIST-QUEUE                      13790002
138000                 IF ASC-INTER-APPL-VERIFY-RCVR                    13800002
138100                     PERFORM 2400-GET-NEXT-RECORD                 13810002
138200                 ELSE                                             13820002
138300                     IF ASC-INTER-APPL-WO-RCVR OR                 13830002
138400                        ASC-INTER-APPL-ITM-LST OR                 13840002
138500                        ASC-INTER-APPL-PREPACK OR                 13850002
138600                        ASC-INTER-APPL-REC-PREPACK                13860002
138700                         PERFORM 2500-GET-NEXT-RECORD             13870002
138800                      ELSE                                        13880002
138900                         PERFORM 2300-GET-NEXT-RECORD             13890002
139000                     END-IF                                       13900002
139100                 END-IF                                           13910002
139200                 PERFORM 4000-BUILD-INITIAL-PANEL                 13920002
139300                 PERFORM 3200-RESET-ATTRIBUTES                    13930002
139400             ELSE                                                 13940002
139500*                --- BOTTOM OF LIST ---                           13950002
139600                 MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER         13960002
139700                 SET DP020-MSG-INFORMATIONAL TO TRUE              13970002
139800             END-IF                                               13980002
139900                                                                  13990002
140000         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             14000002
140100             IF ASC-USE-SELECTION-QUEUE                           14010002
140200                 PERFORM 6200-DEL-LIST-QUEUE                      14020002
140300                 IF ASC-INTER-APPL-VERIFY-RCVR                    14030002
140400                     PERFORM 2410-GET-PREV-RECORD                 14040002
140500                 ELSE                                             14050002
140600                     IF ASC-INTER-APPL-WO-RCVR OR                 14060002
140700                        ASC-INTER-APPL-ITM-LST OR                 14070002
140800                        ASC-INTER-APPL-PREPACK OR                 14080002
140900                        ASC-INTER-APPL-REC-PREPACK                14090002
141000                         PERFORM 2510-GET-PREV-RECORD             14100002
141100                     ELSE                                         14110002
141200                         PERFORM 2310-GET-PREV-RECORD             14120002
141300                     END-IF                                       14130002
141400                 END-IF                                           14140002
141500                 PERFORM 4000-BUILD-INITIAL-PANEL                 14150002
141600                 PERFORM 3200-RESET-ATTRIBUTES                    14160002
141700             ELSE                                                 14170002
141800*                --- TOP OF LIST ---                              14180002
141900                 MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER         14190002
142000                 SET DP020-MSG-INFORMATIONAL TO TRUE              14200002
142100             END-IF                                               14210002
142200                                                                  14220002
142300         WHEN OTHER                                               14230002
142400             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 14240002
142500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   14250002
142600             IF PS-NO-ERROR                                       14260002
142700                 SET DP030-CONTINUE-GO TO TRUE                    14270002
142800                 PERFORM 2100-CHECK-FUNCTION-KEY                  14280002
142900             ELSE                                                 14290002
143000                 SET DP030-OVERRIDE-GO TO TRUE                    14300002
143100             END-IF                                               14310002
143200     END-EVALUATE.                                                14320002
143300 EJECT                                                            14330002
143400*----------------------------------------------------------------*14340002
143500*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *14350002
143600*----------------------------------------------------------------*14360002
143700 2050-DELETE-LIST-QUEUE.                                          14370002
143800                                                                  14380002
143900     EXEC CICS                                                    14390002
144000         DELETEQ TS                                               14400002
144100             QUEUE (ASC-LIST-QUEUE-NAME)                          14410002
144200             RESP  (PV-CICS-RESP)                                 14420002
144300     END-EXEC.                                                    14430002
144400                                                                  14440002
144500     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       14450002
144600        (PV-CICS-RESP = DFHRESP(QIDERR))                          14460002
144700         CONTINUE                                                 14470002
144800     ELSE                                                         14480002
144900         SET DP013-CICS-ABEND      TO TRUE                        14490002
145000         SET DP013-NO-ROLLBACK     TO TRUE                        14500002
145100                                                                  14510002
145200         MOVE '2050-DELETE-LIST-QUEUE'                            14520002
145300                                   TO DP013-PARAGRAPH             14530002
145400         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    14540002
145500                                   TO DP013-MESSAGE-TEXT (1)      14550002
145600         PERFORM DP013-0000-PROCESS-ABEND                         14560002
145700     END-IF.                                                      14570002
145800                                                                  14580002
145900     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  14590002
146000 EJECT                                                            14600002
146100*----------------------------------------------------------------*14610002
146200* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*14620002
146300* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *14630002
146400* CICS ARCHITECTURE API.                                         *14640002
146500*----------------------------------------------------------------*14650002
146600 2100-CHECK-FUNCTION-KEY.                                         14660002
146700                                                                  14670002
146800     EVALUATE TRUE                                                14680002
146900       WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                    14690002
147000           EVALUATE TRUE                                          14700002
147100             WHEN DP020-SRC-AID = DP016-PF14                      14710002
147200                 IF ASC-NUMBER-OF-SELECTED-ITEMS NOT > ZERO       14720002
147300                     SET DP030-OVERRIDE-GO TO TRUE                14730002
147400                     SET DP020-MSG-FATAL   TO TRUE                14740002
147500                     MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER    14750002
147600                 ELSE                                             14760002
147700                     SET PS-SEL-LINE-NBR-YES TO TRUE              14770002
147800                     PERFORM 2180-CHECK-SELECTED-LINES            14780002
147900                     IF PS-SEL-LINE-NBR-NO                        14790002
148000                         SET DP030-OVERRIDE-GO                    14800002
148100                             DP020-MSG-FATAL  TO TRUE             14810002
148200                         MOVE PC-TSYMSG-02187 TO DP020-MSG-NUMBER 14820002
148300                     ELSE                                         14830002
148400                         INITIALIZE PO013-INTER-APPL-COMMAREA     14840002
148500                         MOVE ASC-NUMBER-OF-SELECTED-ITEMS        14850002
148600                           TO PO013-NUMBER-OF-SELECTED-ITEMS      14860002
148700                         PERFORM 5025-PREPARE-SEL-QUEUE-FOR-PO    14870002
148800                         IF PS-ERROR                              14880002
148900                             MOVE ASC-ITEM-AT-TOP-OF-PANEL        14890002
149000                                TO PV-TOP-ITEM                    14900002
149100                             MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL14910002
149200                             MOVE +1   TO ASC-BLK-SUB             14920002
149300                             PERFORM 4410-READ-TEMP-STORAGE       14930002
149400                             ADD +1    TO ASC-BLK-SUB             14940002
149500                                          PV-BLOCK-NUMBER         14950002
149600                             PERFORM 4410-READ-TEMP-STORAGE       14960002
149700                             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN 14970002
149800                             SET DP030-OVERRIDE-GO                14980002
149900                                 DP020-MSG-WARNING TO TRUE        14990002
150000                         END-IF                                   15000002
150100                     END-IF                                       15010002
150200                 END-IF                                           15020002
150300                                                                  15030002
150400             WHEN DP020-SRC-AID = DP016-PF22                      15040002
150500                 IF ASC-NUMBER-OF-SELECTED-ITEMS NOT > ZERO       15050002
150600                     SET DP030-OVERRIDE-GO TO TRUE                15060002
150700                     SET DP020-MSG-FATAL   TO TRUE                15070002
150800                     MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER    15080002
150900                 ELSE                                             15090002
151000                         INITIALIZE RC015-INTER-APPL-COMMAREA     15100002
151100                         MOVE ASC-NUMBER-OF-SELECTED-ITEMS        15110002
151200                           TO RC015-NUMBER-OF-SELECTED-ITEMS      15120002
151300                         PERFORM 5500-PREP-SEL-QUEUE-FOR-RCVG     15130002
151400                         IF PS-ERROR                              15140002
151500                             MOVE ASC-ITEM-AT-TOP-OF-PANEL        15150002
151600                                   TO PV-TOP-ITEM                 15160002
151700                             MOVE ZERO                            15170002
151800                                   TO ASC-ITEM-AT-TOP-OF-PANEL    15180002
151900                             MOVE +1 TO ASC-BLK-SUB               15190002
152000                             PERFORM 4410-READ-TEMP-STORAGE       15200002
152100                             ADD +1 TO ASC-BLK-SUB                15210002
152200                                       PV-BLOCK-NUMBER            15220002
152300                             PERFORM 4410-READ-TEMP-STORAGE       15230002
152400                             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN 15240002
152500                             SET DP030-OVERRIDE-GO                15250002
152600                                 DP020-MSG-WARNING TO TRUE        15260002
152700                         END-IF                                   15270002
152800                 END-IF                                           15280002
152900                                                                  15290002
153000             WHEN OTHER                                           15300002
153100                 IF ASC-NUMBER-OF-SELECTED-ITEMS > ZERO           15310002
153200                     INITIALIZE TM001-INTER-APPL-COMMAREA         15320002
153300                     MOVE ASC-NUMBER-OF-SELECTED-ITEMS            15330002
153400                       TO TM001-NUMBER-OF-SELECTED-ITEMS          15340002
153500                     PERFORM 5000-PREPARE-SEL-QUEUE               15350002
153600                 ELSE                                             15360002
153700                     SET DP030-OVERRIDE-GO TO TRUE                15370002
153800                     MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER    15380002
153900                     SET DP020-MSG-WARNING TO TRUE                15390002
154000                 END-IF                                           15400002
154100           END-EVALUATE                                           15410002
154200                                                                  15420002
154300       WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)                 15430002
154400*             --- ACKNOWLEDGE FUNCTION KEY ---                    15440002
154500             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              15450002
154600                 INITIALIZE TM500-FIELDS                          15460002
154700                 SET TM500-ACKNOWLEDGE                            15470002
154800                     TM500-NO-DETAILS                             15480002
154900                                   TO TRUE                        15490002
155000                 MOVE DP020-USERID TO TM500-ACKNOWLG-UID          15500002
155100                                                                  15510002
155200                 PERFORM 5050-PREPARE-TO-PROCESS-TRBL             15520002
155300                                                                  15530002
155400                 IF  NOT PS-ERROR                                 15540002
155500                     IF PS-AUTO-ACKNOW-YES                        15550002
155600                        IF TM500-DIDNT-ALLOC-DUE-TO-TRBL OR       15560002
155700                           TM500-PREPACK-ERROR OR                 15570002
155800                           TM500-DUPLICATE-TROUBLE                15580002
155900                           MOVE PC-TSYMSG-03384                   15590002
156000                                   TO  DP020-MSG-NUMBER           15600002
156100                        ELSE                                      15610002
156110                           MOVE PC-TSYMSG-03383                   15611002
156111                                   TO  DP020-MSG-NUMBER           15611102
156112                        END-IF                                    15611202
156113                     ELSE                                         15611302
156114                        MOVE PC-TSYMSG-00059                      15611402
156115                                   TO  DP020-MSG-NUMBER           15611502
156116                     END-IF                                       15611602
156117                     SET DP020-MSG-INFORMATIONAL                  15611702
156118                                   TO  TRUE                       15611802
156119                     MOVE ASC-ITEM-AT-TOP-OF-PANEL                15611902
156120                                   TO  PV-TOP-ITEM                15612002
156130                     MOVE ZERO     TO  ASC-ITEM-AT-TOP-OF-PANEL   15613002
156140                                                                  15614002
156150                     DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL     15615002
156160                         GIVING PV-BLOCK-NUMBER                   15616002
156170                         REMAINDER PV-REMAINDER                   15617002
156180                     IF  PV-REMAINDER > ZERO                      15618002
156190                         ADD +1 TO PV-BLOCK-NUMBER                15619002
156200                     END-IF                                       15620002
156300                                                                  15630002
156400                     MOVE +1    TO ASC-BLK-SUB                    15640002
156500                     PERFORM 4410-READ-TEMP-STORAGE               15650002
156600                     ADD +1     TO ASC-BLK-SUB                    15660002
156700                                   PV-BLOCK-NUMBER                15670002
156800                     PERFORM 4410-READ-TEMP-STORAGE               15680002
156900                 ELSE                                             15690002
157000                     MOVE ASC-ITEM-AT-TOP-OF-PANEL                15700002
157100                                   TO  PV-TOP-ITEM                15710002
157200                     MOVE ZERO     TO  ASC-ITEM-AT-TOP-OF-PANEL   15720002
157300                     MOVE +1       TO  ASC-BLK-SUB                15730002
157400                     PERFORM 4410-READ-TEMP-STORAGE               15740002
157500                     ADD +1        TO  ASC-BLK-SUB                15750002
157600                                       PV-BLOCK-NUMBER            15760002
157700                     PERFORM 4410-READ-TEMP-STORAGE               15770002
157800                 END-IF                                           15780002
157900                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             15790002
158000             ELSE                                                 15800002
158100                 SET DP030-OVERRIDE-GO                            15810002
158200                                   TO TRUE                        15820002
158300                 MOVE PC-TSYMSG-00057                             15830002
158400                                   TO DP020-MSG-NUMBER            15840002
158500                 SET DP020-MSG-WARNING                            15850002
158600                                   TO TRUE                        15860002
158700                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             15870002
158800             END-IF                                               15880002
158900                                                                  15890002
159000       WHEN DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)                 15900002
159100*             --- IN-PROCESS FUNCTION KEY ---                     15910002
159200           IF ASC-NUMBER-OF-SELECTED-ITEMS > ZERO                 15920002
159300               INITIALIZE TM500-FIELDS                            15930002
159400               SET TM500-IN-PROCESS                               15940002
159500                   TM500-ADD-DETAILS TO TRUE                      15950002
159600               MOVE DP020-USERID TO TM500-NOTIF-UID               15960002
159700                                    TM500-CRE-UID                 15970002
159800****  IF LOCATION IS CORPORATE THEN USE IN-PROCESS MSG            15980002
159900****  OTHERWISE USE PC-DC-CHKD-MSGS-MSG                           15990002
160000               IF DP020-LOCATION-NBR = PC-CORP-OFFICE             16000002
160100                   MOVE PC-IN-PROCESS-MSG TO TM500-FREEFORM-TEXT  16010002
160200               ELSE                                               16020002
160300                   MOVE PC-DC-CHKD-MSG    TO TM500-FREEFORM-TEXT  16030002
160400               END-IF                                             16040002
160500                                                                  16050002
160600               PERFORM 5050-PREPARE-TO-PROCESS-TRBL               16060002
160700                                                                  16070002
160800               IF NOT PS-ERROR                                    16080002
160900                   MOVE PC-TSYMSG-00059 TO DP020-MSG-NUMBER       16090002
161000                   SET DP020-MSG-INFORMATIONAL   TO TRUE          16100002
161100                   MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM   16110002
161200                   MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL          16120002
161300                                                                  16130002
161400                   DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL       16140002
161500                     GIVING    PV-BLOCK-NUMBER                    16150002
161600                     REMAINDER PV-REMAINDER                       16160002
161700                   IF PV-REMAINDER > ZERO                         16170002
161800                       ADD +1 TO PV-BLOCK-NUMBER                  16180002
161900                   END-IF                                         16190002
162000                                                                  16200002
162100                   MOVE +1    TO ASC-BLK-SUB                      16210002
162200                   PERFORM 4410-READ-TEMP-STORAGE                 16220002
162300                   ADD +1     TO ASC-BLK-SUB                      16230002
162400                                 PV-BLOCK-NUMBER                  16240002
162500                   PERFORM 4410-READ-TEMP-STORAGE                 16250002
162600               ELSE                                               16260002
162700                   MOVE ASC-ITEM-AT-TOP-OF-PANEL                  16270002
162800                                 TO  PV-TOP-ITEM                  16280002
162900                   MOVE ZERO     TO  ASC-ITEM-AT-TOP-OF-PANEL     16290002
163000                   MOVE +1       TO  ASC-BLK-SUB                  16300002
163100                   PERFORM 4410-READ-TEMP-STORAGE                 16310002
163200                   ADD +1        TO  ASC-BLK-SUB                  16320002
163300                                     PV-BLOCK-NUMBER              16330002
163400                   PERFORM 4410-READ-TEMP-STORAGE                 16340002
163500               END-IF                                             16350002
163600               PERFORM 4400-MOVE-COMMAREA-TO-SCREEN               16360002
163700           ELSE                                                   16370002
163800               SET DP030-OVERRIDE-GO TO TRUE                      16380002
163900               MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER          16390002
164000               SET DP020-MSG-WARNING TO TRUE                      16400002
164100               PERFORM 4400-MOVE-COMMAREA-TO-SCREEN               16410002
164200           END-IF                                                 16420002
164300                                                                  16430002
164400       WHEN DP020-FK-LOCAL-FUNC-03(DP020-SRC-AID)                 16440002
164500*             --- RESOLVE FUNCTION KEY ---                        16450002
164600           IF ASC-NUMBER-OF-SELECTED-ITEMS > ZERO                 16460002
164700               IF ASC-TRBL-RSN-CDE-N  > 0                         16470002
164800                  MOVE ASC-TRBL-RSN-CDE-N                         16480002
164900                                         TO DK-TRBL-RSN-CDE       16490002
165000               ELSE                                               16500002
165100                  MOVE TM500-TRBL-RSN-CDE                         16510002
165200                                         TO DK-TRBL-RSN-CDE       16520002
165300                                            ASC-TRBL-RSN-CDE-N    16530002
165400               END-IF                                             16540002
165500               PERFORM 5900-CHECK-AUTO-ACK-IND                    16550002
165600               IF TRBRSN-AUTOACKNL-IND = 'Y'                      16560002
165700                   PERFORM 5070-CHECK-AUTO-ACKNOW                 16570002
165800               ELSE                                               16580002
165900                  INITIALIZE TM500-FIELDS                         16590002
166000                  SET TM500-RESOLVE-AUTO                          16600002
166100                      TM500-NO-DETAILS                            16610002
166200                      PS-RESOLVE-REQUEST TO TRUE                  16620002
166300                  MOVE PC-CURRENT-PROGRAM-NAME TO TM500-NOTIF-UID 16630002
166400                  MOVE DP020-USERID TO TM500-RESOLVED-UID         16640002
166500                                                                  16650002
166600                  PERFORM 5050-PREPARE-TO-PROCESS-TRBL            16660002
166700                                                                  16670002
166800                  IF NOT PS-ERROR                                 16680002
166900                      IF TM500-DUPLICATE-TROUBLE                  16690002
167000                          CONTINUE                                16700002
167100                      ELSE                                        16710002
167200                          MOVE PC-TSYMSG-00059 TO DP020-MSG-NUMBER16720002
167300                      END-IF                                      16730002
167400                      SET DP020-MSG-INFORMATIONAL TO TRUE         16740002
167500                      MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM16750002
167600                      MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL       16760002
167700                                                                  16770002
167800                      DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL    16780002
167900                        GIVING PV-BLOCK-NUMBER                    16790002
168000                        REMAINDER PV-REMAINDER                    16800002
168100                      IF PV-REMAINDER > ZERO                      16810002
168200                          ADD +1 TO PV-BLOCK-NUMBER               16820002
168300                      END-IF                                      16830002
168400                                                                  16840002
168500                      MOVE +1 TO ASC-BLK-SUB                      16850002
168600                      PERFORM 4410-READ-TEMP-STORAGE              16860002
168700                      ADD +1  TO ASC-BLK-SUB                      16870002
168800                                    PV-BLOCK-NUMBER               16880002
168900                      PERFORM 4410-READ-TEMP-STORAGE              16890002
169000                  ELSE                                            16900002
169100                      MOVE ASC-ITEM-AT-TOP-OF-PANEL               16910002
169200                                    TO PV-TOP-ITEM                16920002
169300                      MOVE ZERO  TO  ASC-ITEM-AT-TOP-OF-PANEL     16930002
169400                      MOVE +1    TO  ASC-BLK-SUB                  16940002
169500                      PERFORM 4410-READ-TEMP-STORAGE              16950002
169600                      ADD +1     TO  ASC-BLK-SUB                  16960002
169700                                        PV-BLOCK-NUMBER           16970002
169800                      PERFORM 4410-READ-TEMP-STORAGE              16980002
169900                  END-IF                                          16990002
170000                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            17000002
170100              ELSE                                                17010002
170200                  SET DP030-OVERRIDE-GO TO TRUE                   17020002
170300                  MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER        17030002
170400                  SET DP020-MSG-WARNING TO TRUE                   17040002
170500                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            17050002
170600           END-IF                                                 17060002
170700                                                                  17070002
170800       WHEN DP020-FK-LOCAL-FUNC-04(DP020-SRC-AID)                 17080002
170900*          --- PF23 = PKITEM ---                                  17090002
171000           IF ASC-NUMBER-OF-SELECTED-ITEMS NOT > ZERO             17100002
171100               SET DP030-OVERRIDE-GO TO TRUE                      17110002
171200               SET DP020-MSG-FATAL   TO TRUE                      17120002
171300               MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER          17130002
171400           ELSE                                                   17140002
171500               PERFORM 2160-CHECK-TRECEIV-PKGNG-CDE               17150002
171600               IF NOT (RECEIV-PKGNG-CDE = 'M' OR 'I')             17160002
171700                   SET DP030-OVERRIDE-GO TO TRUE                  17170002
171800                   SET DP020-MSG-FATAL   TO TRUE                  17180002
171900                   MOVE PC-TSYMSG-02185  TO DP020-MSG-NUMBER      17190002
172000               ELSE                                               17200002
172100                   SET PS-ALL-PREPACK-YES TO TRUE                 17210002
172200                   PERFORM 2170-CHECK-SELECTED-LINES              17220002
172300                   IF PS-ALL-PREPACK-NO                           17230002
172400                       SET DP030-OVERRIDE-GO TO TRUE              17240002
172500                       SET DP020-MSG-FATAL   TO TRUE              17250002
172600                       MOVE PC-TSYMSG-02186  TO DP020-MSG-NUMBER  17260002
172700                   ELSE                                           17270002
172800                       INITIALIZE RC800-INTER-APPL-COMMAREA       17280002
172900                       MOVE ASC-NUMBER-OF-SELECTED-ITEMS          17290002
173000                         TO RC800-NUMBER-OF-SELECTED-ITEMS        17300002
173100                       MOVE ASC-PO-NBR-N TO RC800-REC-NBR-N       17310002
173200                       MOVE ASC-RCVR-SEQ-NBR-N                    17320002
173300                         TO RC800-REC-SEQ-NBR-N                   17330002
173400                       MOVE ASC-OPER-UNT-ID                       17340002
173500                         TO RC800-OPER-UNIT-ID                    17350002
173600                       MOVE ASC-FCLTY-ID TO RC800-FACILITY-ID     17360002
173700                       PERFORM 5800-PREP-SEL-QUEUE-PKITEM         17370002
173800                       IF PS-ERROR                                17380002
173900                           MOVE ASC-ITEM-AT-TOP-OF-PANEL          17390002
174000                             TO PV-TOP-ITEM                       17400002
174100                           MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL  17410002
174200                           MOVE +1 TO ASC-BLK-SUB                 17420002
174300                           PERFORM 4410-READ-TEMP-STORAGE         17430002
174400                           ADD +1 TO ASC-BLK-SUB                  17440002
174500                                     PV-BLOCK-NUMBER              17450002
174600                           PERFORM 4410-READ-TEMP-STORAGE         17460002
174700                           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN   17470002
174800                           SET DP030-OVERRIDE-GO                  17480002
174900                               DP020-MSG-WARNING TO TRUE          17490002
175000                       END-IF                                     17500002
175100                   END-IF                                         17510002
175200               END-IF                                             17520002
175300           END-IF                                                 17530002
175400                                                                  17540002
175500       WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                    17550002
175600           MOVE +1 TO PV-TOP-ITEM                                 17560002
175700           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                   17570002
175800           PERFORM 3200-RESET-ATTRIBUTES                          17580002
175900                                                                  17590002
176000       WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                     17600002
176100           PERFORM 2110-BROWSE-BACKWARD                           17610002
176200           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                   17620002
176300           PERFORM 3200-RESET-ATTRIBUTES                          17630002
176400                                                                  17640002
176500       WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                     17650002
176600           PERFORM 2120-BROWSE-FORWARD                            17660002
176700           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                   17670002
176800           PERFORM 3200-RESET-ATTRIBUTES                          17680002
176900                                                                  17690002
177000       WHEN DP020-SRC-AID = DP016-ENTER                           17700002
177100           PERFORM 2130-CHECK-FOR-JUMP-BROWSE                     17710002
177200           IF PS-ERROR                                            17720002
177300               CONTINUE                                           17730002
177400           ELSE                                                   17740002
177500               PERFORM 4400-MOVE-COMMAREA-TO-SCREEN               17750002
177600           END-IF                                                 17760002
177700                                                                  17770002
177800       WHEN OTHER                                                 17780002
177900           SET DP013-NO-ROLLBACK                                  17790002
178000               DP013-XCTL-DISPLAY-RESTART                         17800002
178100               DP013-CICS-ABEND  TO TRUE                          17810002
178200           MOVE '2100-CHECK-FUNCTION-KEY'                         17820002
178300                                   TO DP013-PARAGRAPH             17830002
178400           MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'        17840002
178500                                   TO DP013-MESSAGE-TEXT (1)      17850002
178600           PERFORM DP013-0000-PROCESS-ABEND                       17860002
178700     END-EVALUATE.                                                17870002
178800*                                                                 17880002
178900*----------------------------------------------------------------*17890002
179000*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *17900002
179100*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *17910002
179200*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *17920002
179300*    MESSAGE.                                                    *17930002
179400*----------------------------------------------------------------*17940002
179500                                                                  17950002
179600 2110-BROWSE-BACKWARD.                                            17960002
179700     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    17970002
179800         GIVING PV-TOP-ITEM.                                      17980002
179900*                                                                 17990002
180000     IF  ((PV-TOP-ITEM < +1)                                      18000002
180100       OR (PV-TOP-ITEM = +1))                                     18010002
180200         MOVE +1                   TO PV-TOP-ITEM                 18020002
180300*        -- TOP OF LIST --                                        18030002
180400         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            18040002
180500         SET DP020-MSG-INFORMATIONAL TO TRUE                      18050002
180600     END-IF.                                                      18060002
180700                                                                  18070002
180800 EJECT                                                            18080002
180900*----------------------------------------------------------------*18090002
181000*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *18100002
181100*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *18110002
181200*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *18120002
181300*----------------------------------------------------------------*18130002
181400                                                                  18140002
181500 2120-BROWSE-FORWARD.                                             18150002
181600                                                                  18160002
181700     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              18170002
181800         GIVING PV-TOP-ITEM.                                      18180002
181900     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   18190002
182000         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            18200002
182100                                   TO PV-TOP-ITEM                 18210002
182200*        -- BOTTOM OF LIST --                                     18220002
182300         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            18230002
182400         SET DP020-MSG-INFORMATIONAL                              18240002
182500                                   TO TRUE                        18250002
182600     ELSE                                                         18260002
182700         COMPUTE PV-BOTTOM-ITEM =                                 18270002
182800             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 18280002
182900         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            18290002
183000*            -- BOTTOM OF LIST --                                 18300002
183100             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            18310002
183200             SET DP020-MSG-INFORMATIONAL                          18320002
183300                                   TO TRUE                        18330002
183400         END-IF                                                   18340002
183500     END-IF.                                                      18350002
183600 EJECT                                                            18360002
183700*----------------------------------------------------------------*18370002
183800*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *18380002
183900*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *18390002
184000*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *18400002
184100*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *18410002
184200*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *18420002
184300*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *18430002
184400*----------------------------------------------------------------*18440002
184500                                                                  18450002
184600 2130-CHECK-FOR-JUMP-BROWSE.                                      18460002
184700     SET PS-NO-ERROR               TO TRUE.                       18470002
184800     IF (ASC-START-ITEM-REQUEST = SPACE)                          18480002
184900         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            18490002
185000                                   TO PV-TOP-ITEM                 18500002
185100     ELSE                                                         18510002
185200         MOVE ASC-START-ITEM-REQUEST                              18520002
185300                                   TO DP010I-UNEDITED-FIELD       18530002
185400         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       18540002
185500         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     18550002
185600         SET DP010I-NEGATIVE-NOT-ALLOWED                          18560002
185700                                   TO TRUE                        18570002
263627         CALL DP010I-NUMERIC-EDIT-ROUTINE                         18581007
263627              USING DP010I-NUMERIC-EDIT-AREA                      18582007
185900                                                                  18590002
186000         IF  NOT DP010I-ERROR-DETECTED                            18600002
186100             MOVE DP010I-NUMERIC-FIELD                            18610002
186200                                   TO  ASC-START-ITEM-REQUEST-N   18620002
186300             IF  ASC-START-ITEM-REQUEST-N > ZERO                  18630002
186400                 IF  ASC-START-ITEM-REQUEST-N >                   18640002
186500                                          ASC-NUMBER-OF-ITEMS-READ18650002
186600                     MOVE SPACE TO ASC-START-ITEM-REQUEST         18660002
186700                     COMPUTE PV-TOP-ITEM =                        18670002
186800                             ASC-NUMBER-OF-ITEMS-READ             18680002
186900                             - PC-ITEMS-PER-PANEL + 1             18690002
187000                     IF  PV-TOP-ITEM < +1                         18700002
187100                         MOVE +1   TO PV-TOP-ITEM                 18710002
187200                         MOVE PC-TSYMSG-00070                     18720002
187300                                   TO DP020-MSG-NUMBER            18730002
187400                         SET DP020-MSG-INFORMATIONAL              18740002
187500                                   TO TRUE                        18750002
187600                     END-IF                                       18760002
187700                 ELSE                                             18770002
187800                     MOVE ASC-START-ITEM-REQUEST-N                18780002
187900                                   TO PV-TOP-ITEM                 18790002
188000                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      18800002
188100                     COMPUTE PV-BOTTOM-ITEM =                     18810002
188200                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     18820002
188300                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ18830002
188400*                        -- BOTTOM OF LIST --                     18840002
188500                         MOVE PC-TSYMSG-00070                     18850002
188600                                   TO DP020-MSG-NUMBER            18860002
188700                         SET DP020-MSG-INFORMATIONAL              18870002
188800                                   TO TRUE                        18880002
188900                     END-IF                                       18890002
189000                 END-IF                                           18900002
189100             ELSE                                                 18910002
189200*                --- VALUE OUT OF RANGE ----                      18920002
189300                 MOVE PC-TSYMSG-00101                             18930002
189400                                   TO DP020-MSG-NUMBER            18940002
189500                 MOVE -1           TO ASTRTITL                    18950002
189600                 SET DP030-SET-CURSOR-APPL-1                      18960002
189700                                   TO TRUE                        18970002
189800                 MOVE DP015-REVERSE                               18980002
189900                                   TO ASTRTITH                    18990002
190000                 MOVE DP015-RED    TO ASTRTITC                    19000002
190100                 MOVE DP015-UNP-NUM-BRT-MDT                       19010002
190200                                   TO ASTRTITA                    19020002
190300                 SET DP020-MSG-FATAL                              19030002
190400                                   TO TRUE                        19040002
190500                 SET PS-ERROR      TO TRUE                        19050002
190600             END-IF                                               19060002
190700                                                                  19070002
190800         ELSE                                                     19080002
190900             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            19090002
191000             MOVE -1               TO ASTRTITL                    19100002
191100             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  19110002
191200             MOVE DP015-REVERSE    TO ASTRTITH                    19120002
191300             MOVE DP015-RED        TO ASTRTITC                    19130002
191400             MOVE DP015-UNP-NUM-BRT-MDT                           19140002
191500                                   TO ASTRTITA                    19150002
191600             SET DP020-MSG-FATAL   TO TRUE                        19160002
191700             SET PS-ERROR          TO TRUE                        19170002
191800         END-IF                                                   19180002
191900     END-IF.                                                      19190002
192000 EJECT                                                            19200002
192100*----------------------------------------------------------------*19210002
192200*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *19220002
192300*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *19230002
192400*----------------------------------------------------------------*19240002
192500 2140-DESELECT-ALL-ITEMS.                                         19250002
192600     MOVE +1                       TO ASC-BLK-SUB.                19260002
192700                                                                  19270002
192800     PERFORM 2141-CLEAR-SELECTED-INDS                             19280002
192900         VARYING ASC-ITEM-SUB                                     19290002
193000         FROM 1 BY 1                                              19300002
193100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 19310002
193200                                                                  19320002
193300     ADD +1                        TO ASC-BLK-SUB.                19330002
193400                                                                  19340002
193500     PERFORM 2141-CLEAR-SELECTED-INDS                             19350002
193600         VARYING ASC-ITEM-SUB                                     19360002
193700         FROM 1 BY 1                                              19370002
193800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 19380002
193900                                                                  19390002
194000     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               19400002
194100                                   TO PV-LIST-ITEM-NUMBER.        19410002
194200                                                                  19420002
194300     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            19430002
194400         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    19440002
194500                                                                  19450002
194600     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     19460002
194700        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      19470002
194800         MOVE +1                   TO ASC-BLK-SUB                 19480002
194900                                                                  19490002
195000         PERFORM 5100-WRITE-TEMP-STORAGE                          19500002
195100                                                                  19510002
195200         MOVE +1                   TO PV-BLOCK-NUMBER             19520002
195300                                                                  19530002
195400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         19540002
195500             PV-FIRST-BLOCK-IN-ARRAY - 1                          19550002
195600                                                                  19560002
195700         PERFORM                                                  19570002
195800             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       19580002
195900                                                                  19590002
196000             PERFORM 4410-READ-TEMP-STORAGE                       19600002
196100                                                                  19610002
196200             PERFORM 2141-CLEAR-SELECTED-INDS                     19620002
196300                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 19630002
196400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          19640002
196500                                                                  19650002
196600             PERFORM 5100-WRITE-TEMP-STORAGE                      19660002
196700                                                                  19670002
196800             ADD +1                TO PV-BLOCK-NUMBER             19680002
196900                                                                  19690002
197000         END-PERFORM                                              19700002
197100                                                                  19710002
197200         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         19720002
197300             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     19730002
197400                                                                  19740002
197500         PERFORM                                                  19750002
197600             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       19760002
197700                   ASC-HIGHEST-BLOCK-WRITTEN                      19770002
197800                                                                  19780002
197900             MOVE PV-NEXT-BLOCK-IN-ARRAY                          19790002
198000                                   TO PV-BLOCK-NUMBER             19800002
198100                                                                  19810002
198200             PERFORM 4410-READ-TEMP-STORAGE                       19820002
198300                                                                  19830002
198400             PERFORM 2141-CLEAR-SELECTED-INDS                     19840002
198500                 VARYING ASC-ITEM-SUB                             19850002
198600                 FROM 1 BY 1                                      19860002
198700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          19870002
198800                                                                  19880002
198900             PERFORM 5100-WRITE-TEMP-STORAGE                      19890002
199000                                                                  19900002
199100             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      19910002
199200                                                                  19920002
199300         END-PERFORM                                              19930002
199400                                                                  19940002
199500         MOVE PV-FIRST-BLOCK-IN-ARRAY                             19950002
199600                                   TO PV-BLOCK-NUMBER             19960002
199700                                                                  19970002
199800         PERFORM 4410-READ-TEMP-STORAGE                           19980002
199900     END-IF.                                                      19990002
200000                                                                  20000002
200100                                                                  20010002
200200*    MOVE +0 TO ASC-NUMBER-OF-SELECTED-ITEMS.                     20020002
200300     MOVE +0 TO ASC-START-OF-SELECTED-RANGE.                      20030002
200400     MOVE +0 TO ASC-END-OF-SELECTED-RANGE.                        20040002
200500                                                                  20050002
200600*    PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        20060002
200700                                                                  20070002
200800 EJECT                                                            20080002
200900*----------------------------------------------------------------*20090002
201000*    MARK EACH ITEM AS BEING NOT SELECTED.                       *20100002
201100*----------------------------------------------------------------*20110002
201200                                                                  20120002
201300 2141-CLEAR-SELECTED-INDS.                                        20130002
201400                                                                  20140002
201500     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           20150002
201600             NOT EQUAL ZERO                                       20160002
201700         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          20170002
201800             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          20180002
201900                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    20190002
202000                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  20200002
202100                                   TO TRUE                        20210002
202200         END-IF                                                   20220002
202300     END-IF.                                                      20230002
202400                                                                  20240002
202500 EJECT                                                            20250002
202600*----------------------------------------------------------------*20260002
202700*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *20270002
202800*  FOR ALL ITEMS.                                                *20280002
202900*----------------------------------------------------------------*20290002
203000                                                                  20300002
203100 2150-SELECT-ALL-ITEMS.                                           20310002
203200                                                                  20320002
203300     MOVE +1                       TO ASC-BLK-SUB.                20330002
203400                                                                  20340002
203500     PERFORM 2151-SET-SELECTED-INDS                               20350002
203600         VARYING ASC-ITEM-SUB                                     20360002
203700         FROM 1 BY 1                                              20370002
203800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 20380002
203900                                                                  20390002
204000     ADD +1                        TO ASC-BLK-SUB.                20400002
204100                                                                  20410002
204200     PERFORM 2151-SET-SELECTED-INDS                               20420002
204300         VARYING ASC-ITEM-SUB                                     20430002
204400         FROM 1 BY 1                                              20440002
204500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 20450002
204600                                                                  20460002
204700     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               20470002
204800                                   TO PV-LIST-ITEM-NUMBER.        20480002
204900                                                                  20490002
205000     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            20500002
205100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    20510002
205200                                                                  20520002
205300     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     20530002
205400        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    20540002
205500         MOVE +1                   TO ASC-BLK-SUB                 20550002
205600                                                                  20560002
205700         PERFORM 5100-WRITE-TEMP-STORAGE                          20570002
205800                                                                  20580002
205900         MOVE +1                   TO PV-BLOCK-NUMBER             20590002
206000                                                                  20600002
206100         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         20610002
206200             PV-FIRST-BLOCK-IN-ARRAY - 1                          20620002
206300                                                                  20630002
206400         PERFORM                                                  20640002
206500             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       20650002
206600                                                                  20660002
206700             PERFORM 4410-READ-TEMP-STORAGE                       20670002
206800                                                                  20680002
206900             PERFORM 2151-SET-SELECTED-INDS                       20690002
207000                 VARYING ASC-ITEM-SUB                             20700002
207100                 FROM 1 BY 1                                      20710002
207200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          20720002
207300                                                                  20730002
207400             PERFORM 5100-WRITE-TEMP-STORAGE                      20740002
207500                                                                  20750002
207600             ADD +1                TO PV-BLOCK-NUMBER             20760002
207700                                                                  20770002
207800         END-PERFORM                                              20780002
207900                                                                  20790002
208000         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         20800002
208100             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     20810002
208200                                                                  20820002
208300         PERFORM                                                  20830002
208400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       20840002
208500                   ASC-HIGHEST-BLOCK-WRITTEN                      20850002
208600                                                                  20860002
208700             MOVE PV-NEXT-BLOCK-IN-ARRAY                          20870002
208800                                   TO PV-BLOCK-NUMBER             20880002
208900                                                                  20890002
209000             PERFORM 4410-READ-TEMP-STORAGE                       20900002
209100                                                                  20910002
209200             PERFORM 2151-SET-SELECTED-INDS                       20920002
209300                 VARYING ASC-ITEM-SUB                             20930002
209400                 FROM 1 BY 1                                      20940002
209500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          20950002
209600                                                                  20960002
209700             PERFORM 5100-WRITE-TEMP-STORAGE                      20970002
209800                                                                  20980002
209900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      20990002
210000                                                                  21000002
210100         END-PERFORM                                              21010002
210200                                                                  21020002
210300         MOVE PV-FIRST-BLOCK-IN-ARRAY                             21030002
210400                                   TO PV-BLOCK-NUMBER             21040002
210500                                                                  21050002
210600         PERFORM 4410-READ-TEMP-STORAGE                           21060002
210700     END-IF.                                                      21070002
210800                                                                  21080002
210900                                                                  21090002
211000     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             21100002
211100                       ASC-NUMBER-OF-SELECTED-ITEMS.              21110002
211200                                                                  21120002
211300*    PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        21130002
211400                                                                  21140002
211500 EJECT                                                            21150002
211600*----------------------------------------------------------------*21160002
211700*    MARK EACH ITEM AS BEING SELECTED.                           *21170002
211800*----------------------------------------------------------------*21180002
211900                                                                  21190002
212000 2151-SET-SELECTED-INDS.                                          21200002
212100                                                                  21210002
212200     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           21220002
212300             NOT EQUAL ZERO                                       21230002
212400         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             21240002
212500             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             21250002
212600                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        21260002
212700                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  21270002
212800                               TO  TRUE                           21280002
212900         END-IF                                                   21290002
213000     END-IF.                                                      21300002
213100******************************************************************21310002
213200** ON PF22-HIT, VERIFY ORDER IS NOT A "PREPACK" (ERROR).        **21320002
213300******************************************************************21330002
213400 2160-CHECK-TRECEIV-PKGNG-CDE.                                    21340002
213500                                                                  21350002
213600     INITIALIZE DCLTRECEIV.                                       21360002
213700                                                                  21370002
213800     MOVE ASC-PO-NBR-N         TO DK-PO-NBR.                      21380002
213900     MOVE ASC-RCVR-SEQ-NBR-N   TO DK-REC-SEQ-NBR.                 21390002
214000                                                                  21400002
214100     EXEC SQL                                                     21410002
214200         SELECT PKGNG_CDE                                         21420002
214300           INTO :RECEIV-PKGNG-CDE                                 21430002
214400           FROM TRECEIV                                           21440002
214500          WHERE ORD_NBR        = :DK-PO-NBR                       21450002
214600            AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR                  21460002
214700     END-EXEC.                                                    21470002
214800                                                                  21480002
214900     EVALUATE TRUE                                                21490002
215000       WHEN SQLCODE = ZERO                                        21500002
215100           CONTINUE                                               21510002
215200                                                                  21520002
215300       WHEN SQLWARN0 NOT = SPACE                                  21530002
215400       WHEN SQLCODE  NOT = ZERO                                   21540002
215500           MOVE '2160-CHECK-TRECEIV-PKGNG-CDE' TO DP013-PARAGRAPH 21550002
215600           MOVE 'SELECT TRECEIV' TO DP013-MESSAGE-TEXT (1)        21560002
215700                                                                  21570002
215800           MOVE DK-PO-NBR        TO PV-ERROR-PO-NBR               21580002
215900           MOVE DK-REC-SEQ-NBR   TO PV-ERROR-REC-SEQ-NBR          21590002
216000           STRING ' RCVR: '            DELIMITED BY SIZE          21600002
216100                  PV-ERROR-PO-NBR      DELIMITED BY SIZE          21610002
216200                  '-'                  DELIMITED BY SIZE          21620002
216300                  PV-ERROR-REC-SEQ-NBR DELIMITED BY SIZE          21630002
216400                               INTO DP013-MESSAGE-TEXT (2)        21640002
216500           MOVE SQLCA            TO DP013-SQLCA                   21650002
216600           MOVE 'TRECEIV '       TO DP013-DB2-TABLE-NAME (1)      21660002
216700           SET DP013-DB2-ABEND   TO TRUE                          21670002
216800           PERFORM DP013-0000-PROCESS-ABEND                       21680002
216900     END-EVALUATE.                                                21690002
217000                                                                  21700002
217100******************************************************************21710002
217200** ON PF23-HIT, VERIFY LINES ARE ALL "PREPACK" (ELSE ERROR).    **21720002
217300******************************************************************21730002
217400 2170-CHECK-SELECTED-LINES.                                       21740002
217500                                                                  21750002
217600     MOVE ASC-ITEMS-DISPLAYED TO PV-SUB.                          21760002
217700     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       21770002
217800                              ASC-ITEMS-DISPLAYED - 1.            21780002
217900     PERFORM 3100-SET-SUBSCRIPTS.                                 21790002
218000                                                                  21800002
218100     PERFORM 2175-READ-SEL-QUEUE                                  21810002
218200       VARYING PV-SUB FROM PV-SUB BY -1                           21820002
218300         UNTIL PV-SUB < +1                                        21830002
218400            OR PS-ALL-PREPACK-NO.                                 21840002
218500                                                                  21850002
218600******************************************************************21860002
218700 2175-READ-SEL-QUEUE.                                             21870002
218800                                                                  21880002
218900* IF A SELECTED LINE HAS PACKID = ZERO & LINE# > ZERO, ERROR.     21890002
219000     IF ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                     21900002
219100         IF ASC-PO-LNE-NBR-N (ASC-BLK-SUB ASC-ITEM-SUB) > ZERO    21910002
219200           AND ASC-RECITM-PREPK-ID (ASC-BLK-SUB ASC-ITEM-SUB)     21920002
219300                                                        = ZERO    21930002
219400             SET PS-ALL-PREPACK-NO TO TRUE                        21940002
219500         END-IF                                                   21950002
219600     END-IF.                                                      21960002
219700                                                                  21970002
219800     SUBTRACT +1 FROM PV-ITEM-IN-USE.                             21980002
219900     SUBTRACT +1 FROM ASC-ITEM-SUB.                               21990002
220000     IF ASC-ITEM-SUB < 1                                          22000002
220100         SUBTRACT +1 FROM ASC-BLK-SUB                             22010002
220200         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  22020002
220300     END-IF.                                                      22030002
220400                                                                  22040002
220500******************************************************************22050002
220600** ON PF14-HIT OR PF15-HIT, VERIFY SELECTED LINES HAVE LINE #'S.**22060002
220700******************************************************************22070002
220800 2180-CHECK-SELECTED-LINES.                                       22080002
220900                                                                  22090002
221000     MOVE ASC-ITEMS-DISPLAYED TO PV-SUB.                          22100002
221100     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       22110002
221200                              ASC-ITEMS-DISPLAYED - 1.            22120002
221300     PERFORM 3100-SET-SUBSCRIPTS.                                 22130002
221400                                                                  22140002
221500     PERFORM 2185-READ-SEL-QUEUE                                  22150002
221600       VARYING PV-SUB FROM PV-SUB BY -1                           22160002
221700         UNTIL PV-SUB < +1                                        22170002
221800            OR PS-SEL-LINE-NBR-NO.                                22180002
221900                                                                  22190002
222000 2185-READ-SEL-QUEUE.                                             22200002
222100                                                                  22210002
222200* IF A SELECTED LINE HAS LINE# = ZERO, ERROR.                     22220002
222300     IF ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                     22230002
222400         IF ASC-PO-LNE-NBR-N (ASC-BLK-SUB ASC-ITEM-SUB) = ZERO    22240002
222500             SET PS-SEL-LINE-NBR-NO TO TRUE                       22250002
222600         END-IF                                                   22260002
222700     END-IF.                                                      22270002
222800                                                                  22280002
222900     SUBTRACT +1 FROM PV-ITEM-IN-USE.                             22290002
223000     SUBTRACT +1 FROM ASC-ITEM-SUB.                               22300002
223100     IF ASC-ITEM-SUB < 1                                          22310002
223200         SUBTRACT +1 FROM ASC-BLK-SUB                             22320002
223300         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  22330002
223400     END-IF.                                                      22340002
223500                                                                  22350002
223600******************************************************************22360002
223700** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **22370002
223800** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **22380002
223900******************************************************************22390002
224000 2200-MOVE-SCREEN-TO-COMMAREA.                                    22400002
224100                                                                  22410002
224200     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             22420002
224300     MOVE +1                       TO PV-SUB.                     22430002
224400*                                                                 22440002
224500     PERFORM 3100-SET-SUBSCRIPTS.                                 22450002
224600     IF  ASTRTITL > ZERO                                          22460002
224700         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          22470002
224800     ELSE                                                         22480002
224900         IF  ASTRTITF = DP015-ERASE-EOF                           22490002
225000             INITIALIZE ASC-START-ITEM-REQUEST                    22500002
225100         END-IF                                                   22510002
225200     END-IF.                                                      22520002
225300     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          22530002
225400         VARYING PV-SUB                                           22540002
225500         FROM 1 BY 1                                              22550002
225600         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      22560002
225700******************************************************************22570002
225800** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**22580002
225900******************************************************************22590002
226000 2210-MOVE-LINES-TO-COMMAREA.                                     22600002
226100     IF  MR-SELECTL (PV-SUB) > ZERO                               22610002
226200         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             22620002
226300         MOVE MR-SELECTI (PV-SUB)                                 22630002
226400                                   TO ASC-TEMP-SELECTED-SW        22640002
226500                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      22650002
226600     ELSE                                                         22660002
226700         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                22670002
226800                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     22680002
226900                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        22690002
227000                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      22700002
227100         END-IF                                                   22710002
227200     END-IF.                                                      22720002
227300     ADD +1                        TO ASC-ITEM-SUB.               22730002
227400     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        22740002
227500         ADD +1                    TO ASC-BLK-SUB                 22750002
227600         MOVE +1                   TO ASC-ITEM-SUB                22760002
227700     END-IF.                                                      22770002
227800******************************************************************22780002
227900* GET THE KEYS OF THE NEXT SELECTED OBJECT FROM THE              *22790002
228000* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *22800002
228100******************************************************************22810002
228200 2300-GET-NEXT-RECORD.                                            22820002
228300                                                                  22830002
228400     ADD +1                        TO ASC-SEL-SUB.                22840002
228500     IF ASC-SEL-SUB > TM002-MAX-ITEMS                             22850002
228600         ADD +1                    TO ASC-SEL-ITEM                22860002
228700         MOVE +1                   TO ASC-SEL-SUB                 22870002
228800     END-IF.                                                      22880002
228900     IF ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                 22890002
229000         PERFORM 9100-READ-SEL-QUEUE                              22900002
229100         IF TM002-ITEM (ASC-SEL-SUB) > ZERO                       22910002
229200**           INITIALIZE ASC-LIST-KEYS                             22920002
229300             MOVE TM002-PO-NBR (ASC-SEL-SUB)              TO      22930002
229400                  ASC-PO-NBR-N                                    22940002
229500             MOVE TM002-RCVR-SEQ (ASC-SEL-SUB)            TO      22950002
229600                  ASC-RCVR-SEQ-NBR-N                              22960002
229700             MOVE TM002-OPER-UNT-ID (ASC-SEL-SUB)         TO      22970002
229800                  ASC-OPER-UNT-ID                                 22980002
229900             MOVE TM002-FCLTY-ID (ASC-SEL-SUB)            TO      22990002
230000                  ASC-FCLTY-ID                                    23000002
230100             MOVE TM002-TRBL-RSN-CDE (ASC-SEL-SUB)        TO      23010002
230200                  ASC-TRBL-RSN-CDE-N                              23020002
230300             MOVE TM002-NOTIF-FROM-DATE-ISO (ASC-SEL-SUB) TO      23030002
230400                  ASC-NOTIF-FROM-DATE-ISO                         23040002
230500             MOVE TM002-NOTIF-TO-DATE-ISO (ASC-SEL-SUB)   TO      23050002
230600                  ASC-NOTIF-TO-DATE-ISO                           23060002
230700             MOVE TM002-RSLVD-FROM-DATE-ISO (ASC-SEL-SUB) TO      23070002
230800                  ASC-RSLVD-FROM-DATE-ISO                         23080002
230900             MOVE TM002-RSLVD-TO-DATE-ISO (ASC-SEL-SUB)   TO      23090002
231000                  ASC-RSLVD-TO-DATE-ISO                           23100002
231100             IF DP020-INT-APPL-FORMAT-IND                         23110002
231110                               = PC-INTER-APPL-REC-PREPACK        23111002
231120                 MOVE TM002-PREPK-ID (ASC-SEL-SUB) TO             23112002
231130                               DK-PREPK-ID-KEY                    23113002
231140                               ASC-PREPK-ID-KEY                   23114002
231150             END-IF                                               23115002
231160             SET TM002-INQ (ASC-SEL-SUB)                  TO TRUE 23116002
231170             PERFORM 9200-REWRITE-LIST-QUEUE                      23117002
231180         ELSE                                                     23118002
231190             SUBTRACT +1 FROM ASC-SEL-SUB                         23119002
231200*            --- BOTTOM OF LIST ---                               23120002
231300             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            23130002
231400             SET DP020-MSG-INFORMATIONAL                          23140002
231500                                   TO TRUE                        23150002
231600         END-IF                                                   23160002
231700     ELSE                                                         23170002
231800         SUBTRACT +1 FROM ASC-SEL-ITEM                            23180002
231900         MOVE TM002-MAX-ITEMS      TO ASC-SEL-SUB                 23190002
232000         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            23200002
232100         SET DP020-MSG-INFORMATIONAL                              23210002
232200                                   TO TRUE                        23220002
232300     END-IF.                                                      23230002
232400                                                                  23240002
232500/                                                                 23250002
232600******************************************************************23260002
232700* GET THE KEYS OF THE PREVIOUS SELECTED OBJECT FROM THE          *23270002
232800* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *23280002
232900******************************************************************23290002
233000 2310-GET-PREV-RECORD.                                            23300002
233100                                                                  23310002
233200     SUBTRACT +1 FROM ASC-SEL-SUB.                                23320002
233300     IF ASC-SEL-SUB < +1                                          23330002
233400         SUBTRACT +1 FROM ASC-SEL-ITEM                            23340002
233500         MOVE TM002-MAX-ITEMS      TO ASC-SEL-SUB                 23350002
233600     END-IF.                                                      23360002
233700                                                                  23370002
233800     IF ASC-SEL-ITEM > ZERO                                       23380002
233900         PERFORM 9100-READ-SEL-QUEUE                              23390002
234000**       INITIALIZE ASC-LIST-KEYS                                 23400002
234100         SET TM002-INQ (ASC-SEL-SUB) TO TRUE                      23410002
234200         MOVE TM002-PO-NBR (ASC-SEL-SUB)              TO          23420002
234300                  ASC-PO-NBR-N                                    23430002
234400         MOVE TM002-RCVR-SEQ (ASC-SEL-SUB)            TO          23440002
234500                  ASC-RCVR-SEQ-NBR-N                              23450002
234600         MOVE TM002-OPER-UNT-ID (ASC-SEL-SUB)         TO          23460002
234700                  ASC-OPER-UNT-ID                                 23470002
234800         MOVE TM002-FCLTY-ID (ASC-SEL-SUB)            TO          23480002
234900                  ASC-FCLTY-ID                                    23490002
235000         MOVE TM002-TRBL-RSN-CDE (ASC-SEL-SUB)        TO          23500002
235100                  ASC-TRBL-RSN-CDE-N                              23510002
235200         MOVE TM002-NOTIF-FROM-DATE-ISO (ASC-SEL-SUB) TO          23520002
235300                  ASC-NOTIF-FROM-DATE-ISO                         23530002
235400         MOVE TM002-NOTIF-TO-DATE-ISO (ASC-SEL-SUB)   TO          23540002
235500                  ASC-NOTIF-TO-DATE-ISO                           23550002
235600         MOVE TM002-RSLVD-FROM-DATE-ISO (ASC-SEL-SUB) TO          23560002
235700                  ASC-RSLVD-FROM-DATE-ISO                         23570002
235800         MOVE TM002-RSLVD-TO-DATE-ISO (ASC-SEL-SUB)   TO          23580002
235900                  ASC-RSLVD-TO-DATE-ISO                           23590002
236000     ELSE                                                         23600002
236100         MOVE +1                   TO ASC-SEL-ITEM                23610002
236200                                      ASC-SEL-SUB                 23620002
236300*        --- TOP OF LIST ---                                      23630002
236400         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            23640002
236500         SET DP020-MSG-INFORMATIONAL                              23650002
236600                                   TO TRUE                        23660002
236700     END-IF.                                                      23670002
236800                                                                  23680002
236900/                                                                 23690002
237000*----------------------------------------------------------------*23700002
237100*    GET THE RECEIVER NUMBER (KEY) OF THE NEXT SELECTED OBJECT   *23710002
237200*    FROM THE SELECTED-ITEMS TEMP. STORAGE QUEUE.                *23720002
237300*----------------------------------------------------------------*23730002
237400 2400-GET-NEXT-RECORD.                                            23740002
237500     ADD +1                     TO ASC-SEL-SUB                    23750002
237600     IF  ASC-SEL-SUB > RC013-MAX-ITEMS                            23760002
237700         ADD +1                    TO ASC-SEL-ITEM                23770002
237800         MOVE +1                   TO ASC-SEL-SUB                 23780002
237900     END-IF.                                                      23790002
238000     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                23800002
238100         PERFORM 9150-READ-SEL-QUEUE                              23810002
238200         IF  RC013-ITEM (ASC-SEL-SUB) > ZERO                      23820002
238300             MOVE RC013-PKSL-LNE-NBR-N (ASC-SEL-SUB)              23830002
238400                                         TO ASC-PO-LINE-NBR       23840002
238500             SET RC013-INQ (ASC-SEL-SUB) TO TRUE                  23850002
238600             PERFORM 9250-REWRITE-SEL-QUEUE                       23860002
238700         ELSE                                                     23870002
238800             SUBTRACT +1 FROM ASC-SEL-SUB                         23880002
238900*            --- BOTTOM OF LIST ---                               23890002
239000             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            23900002
239100             SET DP020-MSG-INFORMATIONAL                          23910002
239200                                   TO TRUE                        23920002
239300         END-IF                                                   23930002
239400     ELSE                                                         23940002
239500         SUBTRACT +1 FROM ASC-SEL-ITEM                            23950002
239600         MOVE RC013-MAX-ITEMS      TO ASC-SEL-SUB                 23960002
239700         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            23970002
239800         SET DP020-MSG-INFORMATIONAL                              23980002
239900                                   TO TRUE                        23990002
240000     END-IF.                                                      24000002
240100                                                                  24010002
240200/                                                                 24020002
240300******************************************************************24030002
240400* GET THE KEYS OF THE PREVIOUS SELECTED OBJECT FROM THE          *24040002
240500* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *24050002
240600******************************************************************24060002
240700 2410-GET-PREV-RECORD.                                            24070002
240800                                                                  24080002
240900     SUBTRACT +1 FROM ASC-SEL-SUB.                                24090002
241000     IF ASC-SEL-SUB < +1                                          24100002
241100         SUBTRACT +1 FROM ASC-SEL-ITEM                            24110002
241200         MOVE RC013-MAX-ITEMS      TO ASC-SEL-SUB                 24120002
241300     END-IF.                                                      24130002
241400                                                                  24140002
241500     IF ASC-SEL-ITEM > ZERO                                       24150002
241600         PERFORM 9150-READ-SEL-QUEUE                              24160002
241700**       INITIALIZE ASC-LIST-KEYS                                 24170002
241800         MOVE RC013-PKSL-LNE-NBR-N     (ASC-SEL-SUB)              24180002
241900                                   TO ASC-PO-LINE-NBR             24190002
242000         SET RC013-INQ (ASC-SEL-SUB) TO TRUE                      24200002
242100     ELSE                                                         24210002
242200         MOVE +1                   TO ASC-SEL-ITEM                24220002
242300                                      ASC-SEL-SUB                 24230002
242400*        --- TOP OF LIST ---                                      24240002
242500         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            24250002
242600         SET DP020-MSG-INFORMATIONAL                              24260002
242700                                   TO TRUE                        24270002
242800     END-IF.                                                      24280002
242900                                                                  24290002
243000/                                                                 24300002
243100*----------------------------------------------------------------*24310002
243200*    GET THE RECEIVER NUMBER (KEY) OF THE NEXT SELECTED OBJECT   *24320002
243300*    FROM THE SELECTED-ITEMS TEMP. STORAGE QUEUE.                *24330002
243400*----------------------------------------------------------------*24340002
243500 2500-GET-NEXT-RECORD.                                            24350002
243600     ADD +1                     TO ASC-SEL-SUB                    24360002
243700     IF  ASC-SEL-SUB > PC016-MAX-ITEMS                            24370002
243800         ADD +1                    TO ASC-SEL-ITEM                24380002
243900         MOVE +1                   TO ASC-SEL-SUB                 24390002
244000     END-IF.                                                      24400002
244100     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                24410002
244200         PERFORM 9170-READ-SEL-QUEUE                              24420002
244300         IF  PC016-ITEM (ASC-SEL-SUB) > ZERO                      24430002
244400             MOVE PC016-LINE-NBR-N         (ASC-SEL-SUB)          24440002
244500                                   TO ASC-PO-LINE-NBR             24450002
244600             MOVE PC016-OPER-UNT-ID        (ASC-SEL-SUB)          24460002
244700                              TO ASC-OPER-UNT-ID                  24470002
244800             MOVE PC016-FCLTY-ID           (ASC-SEL-SUB)          24480002
244900                              TO ASC-FCLTY-ID                     24490002
245000             MOVE PC016-PO-NBR-N           (ASC-SEL-SUB)          24500002
245100                              TO ASC-PO-NBR-N                     24510002
245200             MOVE PC016-REC-SEQ-NBR-N      (ASC-SEL-SUB)          24520002
245300                              TO ASC-RCVR-SEQ-NBR-N               24530002
245400             SET PC016-INQ (ASC-SEL-SUB) TO TRUE                  24540002
245500             PERFORM 1141-GET-RECITM-PACK-ID                      24550002
245600             PERFORM 9270-REWRITE-SEL-QUEUE                       24560002
245700         ELSE                                                     24570002
245800             SUBTRACT +1 FROM ASC-SEL-SUB                         24580002
245900*            --- BOTTOM OF LIST ---                               24590002
246000             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            24600002
246100             SET DP020-MSG-INFORMATIONAL                          24610002
246200                                   TO TRUE                        24620002
246300         END-IF                                                   24630002
246400     ELSE                                                         24640002
246500         SUBTRACT +1 FROM ASC-SEL-ITEM                            24650002
246600         MOVE PC016-MAX-ITEMS      TO ASC-SEL-SUB                 24660002
246700         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            24670002
246800         SET DP020-MSG-INFORMATIONAL                              24680002
246900                                   TO TRUE                        24690002
247000     END-IF.                                                      24700002
247100                                                                  24710002
247200/                                                                 24720002
247300******************************************************************24730002
247400* GET THE KEYS OF THE PREVIOUS SELECTED OBJECT FROM THE          *24740002
247500* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *24750002
247600******************************************************************24760002
247700 2510-GET-PREV-RECORD.                                            24770002
247800                                                                  24780002
247900     SUBTRACT +1 FROM ASC-SEL-SUB.                                24790002
248000     IF ASC-SEL-SUB < +1                                          24800002
248100         SUBTRACT +1 FROM ASC-SEL-ITEM                            24810002
248200         MOVE PC016-MAX-ITEMS      TO ASC-SEL-SUB                 24820002
248300     END-IF.                                                      24830002
248400                                                                  24840002
248500     IF ASC-SEL-ITEM > ZERO                                       24850002
248600         PERFORM 9170-READ-SEL-QUEUE                              24860002
248700**       INITIALIZE ASC-LIST-KEYS                                 24870002
248800         MOVE PC016-LINE-NBR-N         (ASC-SEL-SUB)              24880002
248900                               TO ASC-PO-LINE-NBR                 24890002
249000         MOVE PC016-OPER-UNT-ID        (ASC-SEL-SUB)              24900002
249100                          TO ASC-OPER-UNT-ID                      24910002
249200         MOVE PC016-FCLTY-ID           (ASC-SEL-SUB)              24920002
249300                          TO ASC-FCLTY-ID                         24930002
249400         MOVE PC016-PO-NBR-N           (ASC-SEL-SUB)              24940002
249500                          TO ASC-PO-NBR-N                         24950002
249600         MOVE PC016-REC-SEQ-NBR-N      (ASC-SEL-SUB)              24960002
249700                          TO ASC-RCVR-SEQ-NBR-N                   24970002
249800         SET PC016-INQ (ASC-SEL-SUB) TO TRUE                      24980002
249900         PERFORM 1141-GET-RECITM-PACK-ID                          24990002
250000     ELSE                                                         25000002
250100         MOVE +1                   TO ASC-SEL-ITEM                25010002
250200                                      ASC-SEL-SUB                 25020002
250300*        --- TOP OF LIST ---                                      25030002
250400         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            25040002
250500         SET DP020-MSG-INFORMATIONAL                              25050002
250600                                   TO TRUE                        25060002
250700     END-IF.                                                      25070002
250800                                                                  25080002
250900******************************************************************25090002
251000** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **25100002
251100** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **25110002
251200******************************************************************25120002
251300 3000-EDIT-DATA-IN-COMMAREA.                                      25130002
251400     SET PS-NO-ERROR               TO TRUE.                       25140002
251500     PERFORM 3200-RESET-ATTRIBUTES.                               25150002
251600     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     25160002
251700**                                                                25170002
251800* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              25180002
251900* EDITTING IS DONE FROM THE BOTTOM UP.                            25190002
252000**                                                                25200002
252100     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       25210002
252200         ASC-ITEMS-DISPLAYED - 1.                                 25220002
252300     PERFORM 3100-SET-SUBSCRIPTS.                                 25230002
252400     PERFORM 3300-EDIT-SELECTIONS                                 25240002
252500         VARYING PV-SUB                                           25250002
252600         FROM PV-SUB BY -1                                        25260002
252700         UNTIL PV-SUB < +1                                        25270002
252800*                                                                 25280002
252900     IF  PS-NO-ERROR                                              25290002
253000         PERFORM 3400-CHECK-RANGE-SEQUENCE                        25300002
253100     END-IF.                                                      25310002
253200*                                                                 25320002
253300     IF  ((PS-NO-ERROR)                                           25330002
253400       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   25340002
253500       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    25350002
253600             PERFORM 3500-MARK-RANGE-AS-SELECTED                  25360002
253700     END-IF.                                                      25370002
253800 EJECT                                                            25380002
253900*----------------------------------------------------------------*25390002
254000*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *25400002
254100*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*25410002
254200*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *25420002
254300*                                                                *25430002
254400*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *25440002
254500*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *25450002
254600*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *25460002
254700*    US IN THE 2ND BLOCK OF THE ARRAY.                           *25470002
254800*----------------------------------------------------------------*25480002
254900                                                                  25490002
255000 3100-SET-SUBSCRIPTS.                                             25500002
255100                                                                  25510002
255200     COMPUTE ASC-ITEM-SUB =                                       25520002
255300         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        25530002
255400                                                                  25540002
255500     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         25550002
255600         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            25560002
255700                                                                  25570002
255800         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               25580002
255900     ELSE                                                         25590002
256000         MOVE +1                     TO ASC-BLK-SUB               25600002
256100     END-IF.                                                      25610002
256200******************************************************************25620002
256300** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **25630002
256400******************************************************************25640002
256500                                                                  25650002
256600 3200-RESET-ATTRIBUTES.                                           25660002
256700     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   25670002
256800     MOVE DP015-GREEN              TO ASTRTITC.                   25680002
256900     MOVE DP015-UNDERLINE          TO ASTRTITH.                   25690002
257000                                                                  25700002
257100     IF DP020-NEXT-ACT-RETURN                                     25710002
257200     OR DP020-NEXT-ACT-READ-MAP                                   25720002
257300        PERFORM                                                   25730002
257400            VARYING PV-SUB                                        25740002
257500            FROM 1 BY 1                                           25750002
257600            UNTIL PV-SUB > ASC-ITEMS-DISPLAYED                    25760002
257700            MOVE DP015-UNP-ALP-NOR-OFF                            25770002
257800                                      TO MR-SELECTA (PV-SUB)      25780002
257900            MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)      25790002
258000            MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)      25800002
258100        END-PERFORM                                               25810002
258200     ELSE                                                         25820002
258300        PERFORM                                                   25830002
258400            VARYING PV-SUB                                        25840002
258500            FROM 1 BY 1                                           25850002
258600            UNTIL PV-SUB > PC-ITEMS-PER-PANEL                     25860002
258700            MOVE DP015-UNP-ALP-NOR-OFF                            25870002
258800                                      TO MR-SELECTA (PV-SUB)      25880002
258900            MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)      25890002
259000            MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)      25900002
259100        END-PERFORM                                               25910002
259200     END-IF.                                                      25920002
259300                                                                  25930002
259400******************************************************************25940002
259500** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **25950002
259600** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **25960002
259700** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **25970002
259800** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **25980002
259900******************************************************************25990002
260000 3300-EDIT-SELECTIONS.                                            26000002
260100     EVALUATE TRUE                                                26010002
260200         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     26020002
260300             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         26030002
260400                 CONTINUE                                         26040002
260500         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         26050002
260600             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        26060002
260700                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   26070002
260800                 MOVE ASC-TEMP-SELECTED-SW                        26080002
260900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  26090002
261000                                TO ASC-SELECTED-SW                26100002
261100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  26110002
261200             END-IF                                               26120002
261300         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     26130002
261400                 = SPACE                                          26140002
261500             EVALUATE TRUE                                        26150002
261600                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       26160002
261700                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS26170002
261800                     MOVE SPACE TO ASC-SELECTED-SW                26180002
261900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  26190002
262000                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        26200002
262100                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    26210002
262200                     MOVE SPACE TO ASC-SELECTED-SW                26220002
262300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  26230002
262400                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          26240002
262500                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      26250002
262600                     MOVE SPACE TO ASC-SELECTED-SW                26260002
262700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  26270002
262800             END-EVALUATE                                         26280002
262900         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           26290002
263000             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            26300002
263100                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    26310002
263200             END-IF                                               26320002
263300             PERFORM 3310-EDIT-RANGE                              26330002
263400         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             26340002
263500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            26350002
263600                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    26360002
263700             END-IF                                               26370002
263800             PERFORM 3310-EDIT-RANGE                              26380002
263900         WHEN OTHER                                               26390002
264000             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           26400002
264100             SET DP020-MSG-FATAL    TO TRUE                       26410002
264200             MOVE -1                TO MR-SELECTL (PV-SUB)        26420002
264300             SET DP030-SET-CURSOR-APPL-1                          26430002
264400                                    TO TRUE                       26440002
264500             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        26450002
264600             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        26460002
264700             SET PS-ERROR TO TRUE                                 26470002
264800             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            26480002
264900                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     26490002
265000                 MOVE SPACE         TO ASC-SELECTED-SW            26500002
265100                                        (ASC-BLK-SUB ASC-ITEM-SUB)26510002
265200             END-IF                                               26520002
265300     END-EVALUATE.                                                26530002
265400                                                                  26540002
265500     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 26550002
265600     SUBTRACT +1 FROM ASC-ITEM-SUB.                               26560002
265700     IF  ASC-ITEM-SUB < 1                                         26570002
265800         SUBTRACT +1 FROM ASC-BLK-SUB                             26580002
265900         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                26590002
266000     END-IF.                                                      26600002
266100******************************************************************26610002
266200** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **26620002
266300** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **26630002
266400** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**26640002
266500** THE ENDING.                                                  **26650002
266600******************************************************************26660002
266700 3310-EDIT-RANGE.                                                 26670002
266800     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                26680002
266900         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   26690002
267000             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)26700002
267100                                   TO ASC-SELECTED-SW             26710002
267200                                        (ASC-BLK-SUB ASC-ITEM-SUB)26720002
267300             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 26730002
267400         ELSE                                                     26740002
267500             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     26750002
267600                 CONTINUE                                         26760002
267700             ELSE                                                 26770002
267800*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        26780002
267900                 MOVE PC-TSYMSG-00054                             26790002
268000                                   TO DP020-MSG-NUMBER            26800002
268100                 SET DP020-MSG-FATAL                              26810002
268200                                   TO TRUE                        26820002
268300                 MOVE -1           TO MR-SELECTL (PV-SUB)         26830002
268400                 SET DP030-SET-CURSOR-APPL-1                      26840002
268500                                   TO TRUE                        26850002
268600                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         26860002
268700                 MOVE DP015-UNDERLINE                             26870002
268800                                   TO MR-SELECTH (PV-SUB)         26880002
268900                 SET PS-ERROR      TO TRUE                        26890002
269000             END-IF                                               26900002
269100         END-IF                                                   26910002
269200     ELSE                                                         26920002
269300         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     26930002
269400             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 26940002
269500                                   TO ASC-SELECTED-SW             26950002
269600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   26960002
269700             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   26970002
269800         ELSE                                                     26980002
269900             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       26990002
270000                 CONTINUE                                         27000002
270100             ELSE                                                 27010002
270200*                -- ONLY ONE END-OF-RANGE ALLOWED --              27020002
270300                 MOVE PC-TSYMSG-00055                             27030002
270400                                   TO DP020-MSG-NUMBER            27040002
270500                 SET DP020-MSG-FATAL                              27050002
270600                                   TO TRUE                        27060002
270700                 MOVE -1           TO MR-SELECTL (PV-SUB)         27070002
270800                 SET DP030-SET-CURSOR-APPL-1                      27080002
270900                                   TO TRUE                        27090002
271000                 SET PS-ERROR      TO TRUE                        27100002
271100             END-IF                                               27110002
271200         END-IF                                                   27120002
271300     END-IF.                                                      27130002
271400*                                                                 27140002
271500******************************************************************27150002
271600** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **27160002
271700** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **27170002
271800******************************************************************27180002
271900 3400-CHECK-RANGE-SEQUENCE.                                       27190002
272000     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       27200002
272100       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      27210002
272200       AND  ASC-START-OF-SELECTED-RANGE >                         27220002
272300                                         ASC-END-OF-SELECTED-RANGE27230002
272400*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                27240002
272500         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 27250002
272600         SET DP020-MSG-FATAL TO TRUE                              27260002
272700         SET PS-ERROR TO TRUE                                     27270002
272800         PERFORM 3410-POSITION-AT-ERROR                           27280002
272900     END-IF.                                                      27290002
273000******************************************************************27300002
273100** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **27310002
273200** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **27320002
273300** SHOULD BE POSITIONED ON A RANGE ERROR.                       **27330002
273400******************************************************************27340002
273500 3410-POSITION-AT-ERROR.                                          27350002
273600     SET DP030-SET-CURSOR-APPL-1                                  27360002
273700                                   TO TRUE.                       27370002
273800     COMPUTE PV-SUB-COMP3 = ASC-START-OF-SELECTED-RANGE           27380002
273900                    - PV-TOP-ITEM + 1.                            27390002
274000     MOVE PV-SUB-COMP3 TO PV-SUB.                                 27400002
274100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      27410002
274200         CONTINUE                                                 27420002
274300     ELSE                                                         27430002
274400         MOVE -1                   TO MR-SELECTL (PV-SUB)         27440002
274500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         27450002
274600         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         27460002
274700     END-IF.                                                      27470002
274800*                                                                 27480002
274900     COMPUTE PV-SUB-COMP3 = ASC-END-OF-SELECTED-RANGE             27490002
275000                    - PV-TOP-ITEM + 1.                            27500002
275100     MOVE PV-SUB-COMP3 TO PV-SUB.                                 27510002
275200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      27520002
275300         CONTINUE                                                 27530002
275400     ELSE                                                         27540002
275500         MOVE -1                   TO MR-SELECTL (PV-SUB)         27550002
275600         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         27560002
275700         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         27570002
275800     END-IF.                                                      27580002
275900 EJECT                                                            27590002
276000*----------------------------------------------------------------*27600002
276100*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *27610002
276200*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *27620002
276300*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *27630002
276400*----------------------------------------------------------------*27640002
276500                                                                  27650002
276600 3500-MARK-RANGE-AS-SELECTED.                                     27660002
276700     MOVE +1                       TO  ASC-BLK-SUB.               27670002
276800     PERFORM 3510-MARK-SELECTED-INDS                              27680002
276900         VARYING ASC-ITEM-SUB                                     27690002
277000         FROM 1 BY 1                                              27700002
277100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 27710002
277200                                                                  27720002
277300     ADD +1                        TO ASC-BLK-SUB.                27730002
277400     PERFORM 3510-MARK-SELECTED-INDS                              27740002
277500         VARYING ASC-ITEM-SUB                                     27750002
277600         FROM 1 BY 1                                              27760002
277700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 27770002
277800                                                                  27780002
277900     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               27790002
278000                                   TO  PV-LIST-ITEM-NUMBER.       27800002
278100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            27810002
278200         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         27820002
278300               PC-ITEMS-PER-PANEL).                               27830002
278400                                                                  27840002
278500     MOVE ASC-START-OF-SELECTED-RANGE                             27850002
278600                                   TO PV-START-OF-SELECTED-RANGE. 27860002
278700     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            27870002
278800         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  27880002
278900               PC-ITEMS-PER-PANEL).                               27890002
279000                                                                  27900002
279100     MOVE ASC-END-OF-SELECTED-RANGE                               27910002
279200                                   TO  PV-END-OF-SELECTED-RANGE.  27920002
279300     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             27930002
279400         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    27940002
279500               PC-ITEMS-PER-PANEL).                               27950002
279600     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             27960002
279700         PV-FIRST-BLOCK-IN-ARRAY + 1.                             27970002
279800                                                                  27980002
279900     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    27990002
280000        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        28000002
280100         MOVE +1                   TO ASC-BLK-SUB                 28010002
280200         PERFORM 5100-WRITE-TEMP-STORAGE                          28020002
280300         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         28030002
280400             PV-FIRST-BLOCK-IN-ARRAY - 1                          28040002
280500                                                                  28050002
280600         PERFORM                                                  28060002
280700             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      28070002
280800                   PV-PREV-BLOCK-IN-ARRAY                         28080002
280900             MOVE PV-FIRST-BLOCK-IN-RANGE                         28090002
281000                                   TO PV-BLOCK-NUMBER             28100002
281100             PERFORM 4410-READ-TEMP-STORAGE                       28110002
281200             PERFORM 3510-MARK-SELECTED-INDS                      28120002
281300                 VARYING ASC-ITEM-SUB                             28130002
281400                 FROM 1 BY 1                                      28140002
281500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          28150002
281600             PERFORM 5100-WRITE-TEMP-STORAGE                      28160002
281700             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     28170002
281800         END-PERFORM                                              28180002
281900                                                                  28190002
282000         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         28200002
282100             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     28210002
282200         PERFORM                                                  28220002
282300             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       28230002
282400                   PV-LAST-BLOCK-IN-RANGE                         28240002
282500             MOVE PV-NEXT-BLOCK-IN-ARRAY                          28250002
282600                                   TO PV-BLOCK-NUMBER             28260002
282700             PERFORM 4410-READ-TEMP-STORAGE                       28270002
282800             PERFORM 3510-MARK-SELECTED-INDS                      28280002
282900                 VARYING ASC-ITEM-SUB                             28290002
283000                 FROM 1 BY 1                                      28300002
283100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          28310002
283200             PERFORM 5100-WRITE-TEMP-STORAGE                      28320002
283300             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      28330002
283400         END-PERFORM                                              28340002
283500                                                                  28350002
283600         MOVE PV-FIRST-BLOCK-IN-ARRAY                             28360002
283700                                   TO PV-BLOCK-NUMBER             28370002
283800         PERFORM 4410-READ-TEMP-STORAGE                           28380002
283900     END-IF.                                                      28390002
284000                                                                  28400002
284100     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 28410002
284200                                      ASC-END-OF-SELECTED-RANGE.  28420002
284300                                                                  28430002
284400 EJECT                                                            28440002
284500*----------------------------------------------------------------*28450002
284600* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *28460002
284700*----------------------------------------------------------------*28470002
284800                                                                  28480002
284900 3510-MARK-SELECTED-INDS.                                         28490002
285000                                                                  28500002
285100     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         28510002
285200                                ASC-ITEM-SUB) >                   28520002
285300         ASC-START-OF-SELECTED-RANGE)                             28530002
285400     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         28540002
285500                                ASC-ITEM-SUB) =                   28550002
285600         ASC-START-OF-SELECTED-RANGE)                             28560002
285700                                                                  28570002
285800         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     28580002
285900                                    ASC-ITEM-SUB) <               28590002
286000             ASC-END-OF-SELECTED-RANGE)                           28600002
286100         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     28610002
286200                                    ASC-ITEM-SUB) =               28620002
286300             ASC-END-OF-SELECTED-RANGE)                           28630002
286400                                                                  28640002
286500             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          28650002
286600                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   28660002
286700                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   28670002
286800                               TO TRUE                            28680002
286900                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              28690002
287000                               TO TRUE                            28700002
287100                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    28710002
287200             END-IF                                               28720002
287300         END-IF                                                   28730002
287400     END-IF.                                                      28740002
287500                                                                  28750002
287600 EJECT                                                            28760002
287700*----------------------------------------------------------------*28770002
287800*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *28780002
287900*    INITIALIZE ALL COUNTERS AND FLAGS.                          *28790002
288000*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *28800002
288100*    DISPLAY THE PANEL TO USER.                                  *28810002
288200*----------------------------------------------------------------*28820002
288300                                                                  28830002
288400 4000-BUILD-INITIAL-PANEL.                                        28840002
288500                                                                  28850002
288600     INITIALIZE                 ASC-BLOCK-ENTRIES (1)             28860002
288700                                ASC-BLOCK-ENTRIES (2).            28870002
288800     MOVE +1                 TO ASC-BLK-SUB.                      28880002
288900     SET ASC-ITEMS-LEFT-ON-DB                                     28890002
289000                             TO TRUE.                             28900002
289100                                                                  28910002
289200     MOVE +0                 TO ASC-ITEM-SUB                      28920002
289300                                ASC-NUMBER-OF-ITEMS-READ          28930002
289400                                ASC-NUMBER-OF-SELECTED-ITEMS      28940002
289500                                ASC-HIGHEST-BLOCK-WRITTEN         28950002
289600                                ASC-START-OF-SELECTED-RANGE       28960002
289700                                ASC-END-OF-SELECTED-RANGE         28970002
289800                                ASC-ITEM-AT-TOP-OF-PANEL.         28980002
289900                                                                  28990002
290000     PERFORM 4100-PREPARE-CURSOR.                                 29000002
290100                                                                  29010002
290200     IF ASC-INTER-APPL-VERIFY-RCVR OR                             29020002
290300        ASC-INTER-APPL-RCPT-ITEM OR                               29030002
290400        ASC-INTER-APPL-WO-RCVR OR                                 29040002
290500        ASC-INTER-APPL-ITM-LST OR                                 29050002
290600        ASC-INTER-APPL-ITM-ADD OR                                 29060002
290700        ASC-INTER-APPL-REDIST                                     29070002
290800         PERFORM 4015-OPEN-TROUBLE-NOTIF-CSR                      29080002
290900     ELSE                                                         29090002
291000         IF ASC-INTER-APPL-PREPACK OR                             29100002
291100            ASC-INTER-APPL-REC-PREPACK                            29110002
291200             PERFORM 4005-OPEN-TROUBLE-NOTIF-CSR                  29120002
291300         ELSE                                                     29130002
291400             PERFORM 4010-OPEN-TROUBLE-NOTIF-CSR                  29140002
291500         END-IF                                                   29150002
291600     END-IF.                                                      29160002
291700                                                                  29170002
291800     PERFORM 4300-READ-TROUBLE-NOTIF-FOR-PO.                      29180002
291900                                                                  29190002
292000     IF ASC-INTER-APPL-VERIFY-RCVR OR                             29200002
292100        ASC-INTER-APPL-RCPT-ITEM OR                               29210002
292200        ASC-INTER-APPL-WO-RCVR OR                                 29220002
292300        ASC-INTER-APPL-ITM-LST OR                                 29230002
292400        ASC-INTER-APPL-ITM-ADD OR                                 29240002
292500        ASC-INTER-APPL-REDIST                                     29250002
292600         PERFORM 4025-CLOSE-TROUBLE-NOTIF-CSR                     29260002
292700     ELSE                                                         29270002
292800         IF ASC-INTER-APPL-PREPACK OR                             29280002
292900            ASC-INTER-APPL-REC-PREPACK                            29290002
293000             PERFORM 4030-CLOSE-TROUBLE-NOTIF-CSR                 29300002
293100         ELSE                                                     29310002
293200             PERFORM 4020-CLOSE-TROUBLE-NOTIF-CSR                 29320002
293300         END-IF                                                   29330002
293400     END-IF.                                                      29340002
293500                                                                  29350002
293600     MOVE +1                   TO  PV-TOP-ITEM.                   29360002
293700     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          29370002
293800         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    29380002
293900         SET DP020-MSG-FATAL   TO  TRUE                           29390002
294000         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               29400002
294100     ELSE                                                         29410002
294200         IF  PS-ERROR                                             29420002
294300             NEXT SENTENCE                                        29430002
294400         ELSE                                                     29440002
294500             MOVE -1           TO MR-SELECTL (1)                  29450002
294600             SET DP030-SET-CURSOR-APPL-1                          29460002
294700                               TO TRUE                            29470002
294800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 29480002
294900         END-IF                                                   29490002
295000     END-IF.                                                      29500002
295100 EJECT                                                            29510002
295200*----------------------------------------------------------------*29520002
295300* OPEN THE TROUBLE NOTIFICATION CURSOR                           *29530002
295400*----------------------------------------------------------------*29540002
295500                                                                  29550002
295600 4005-OPEN-TROUBLE-NOTIF-CSR.                                     29560002
295700                                                                  29570002
295800     EXEC SQL                                                     29580002
295900          OPEN TRBL-PK-AND-LN-CSR                                 29590002
296000     END-EXEC.                                                    29600002
296100                                                                  29610002
296200     EVALUATE TRUE                                                29620002
296300         WHEN SQLCODE = ZERO                                      29630002
296400             CONTINUE                                             29640002
296500         WHEN SQLWARN0 NOT = SPACES                               29650002
296600         WHEN SQLCODE < ZERO                                      29660002
296700         WHEN SQLCODE > ZERO                                      29670002
296800             MOVE '4005-OPEN-TROUBLE-NOTIF-CSR'                   29680002
296900                               TO DP013-PARAGRAPH                 29690002
297000             MOVE 'OPEN TROUBLE PACK & LINE CURSOR '              29700002
297100                               TO DP013-MESSAGE-TEXT (1)          29710002
297200             MOVE SQLCA        TO DP013-SQLCA                     29720002
297300             MOVE 'TTRBNTF '   TO DP013-DB2-TABLE-NAME (1)        29730002
297400             MOVE 'TTRBRSN '   TO DP013-DB2-TABLE-NAME (2)        29740002
297500             SET DP013-DB2-ABEND                                  29750002
297600                 DP013-XCTL-DISPLAY-RESTART TO TRUE               29760002
297700             PERFORM DP013-0000-PROCESS-ABEND                     29770002
297800     END-EVALUATE.                                                29780002
297900                                                                  29790002
298000*----------------------------------------------------------------*29800002
298100* OPEN THE TROUBLE NOTIFICATION CURSOR                           *29810002
298200*----------------------------------------------------------------*29820002
298300                                                                  29830002
298400 4010-OPEN-TROUBLE-NOTIF-CSR.                                     29840002
298500                                                                  29850002
298600     EXEC SQL                                                     29860002
298700          OPEN TRBL-NTF-BY-PO-CSR                                 29870002
298800     END-EXEC.                                                    29880002
298900                                                                  29890002
299000     EVALUATE TRUE                                                29900002
299100         WHEN SQLCODE = ZERO                                      29910002
299200             CONTINUE                                             29920002
299300         WHEN SQLWARN0 NOT = SPACES                               29930002
299400         WHEN SQLCODE < ZERO                                      29940002
299500         WHEN SQLCODE > ZERO                                      29950002
299600             MOVE '4010-OPEN-TROUBLE-NOTIF-CSR'                   29960002
299700                               TO DP013-PARAGRAPH                 29970002
299800             MOVE 'OPEN TROUBLE NOTIF BY PO CURSOR '              29980002
299900                               TO DP013-MESSAGE-TEXT (1)          29990002
300000             MOVE SQLCA        TO DP013-SQLCA                     30000002
300100             MOVE 'TTRBNTF '   TO DP013-DB2-TABLE-NAME (1)        30010002
300200             MOVE 'TTRBRSN '   TO DP013-DB2-TABLE-NAME (2)        30020002
300300             SET DP013-DB2-ABEND                                  30030002
300400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               30040002
300500             PERFORM DP013-0000-PROCESS-ABEND                     30050002
300600     END-EVALUATE.                                                30060002
300700                                                                  30070002
300800*----------------------------------------------------------------*30080002
300900* OPEN THE TROUBLE NOTIFICATION CURSOR                           *30090002
301000*----------------------------------------------------------------*30100002
301100                                                                  30110002
301200 4015-OPEN-TROUBLE-NOTIF-CSR.                                     30120002
301300                                                                  30130002
301400     EXEC SQL                                                     30140002
301500          OPEN TRBL-NTF-PO-LN-CSR                                 30150002
301600     END-EXEC.                                                    30160002
301700                                                                  30170002
301800     EVALUATE TRUE                                                30180002
301900         WHEN SQLCODE = ZERO                                      30190002
302000             CONTINUE                                             30200002
302100         WHEN SQLWARN0 NOT = SPACES                               30210002
302200         WHEN SQLCODE < ZERO                                      30220002
302300         WHEN SQLCODE > ZERO                                      30230002
302400             MOVE '4015-OPEN-TROUBLE-NOTIF-CSR'                   30240002
302500                               TO DP013-PARAGRAPH                 30250002
302600             MOVE 'OPEN TROUBLE NOTIF BY PO CURSOR '              30260002
302700                               TO DP013-MESSAGE-TEXT (1)          30270002
302800             MOVE SQLCA        TO DP013-SQLCA                     30280002
302900             MOVE 'TTRBNTF '   TO DP013-DB2-TABLE-NAME (1)        30290002
303000             MOVE 'TTRBRSN '   TO DP013-DB2-TABLE-NAME (2)        30300002
303100             SET DP013-DB2-ABEND                                  30310002
303200                 DP013-XCTL-DISPLAY-RESTART TO TRUE               30320002
303300             PERFORM DP013-0000-PROCESS-ABEND                     30330002
303400     END-EVALUATE.                                                30340002
303500*                                                                 30350002
303600                                                                  30360002
303700 EJECT                                                            30370002
303800*----------------------------------------------------------------*30380002
303900* CLOSE THE TROUBLE NOTIFICATION CURSOR                          *30390002
304000*----------------------------------------------------------------*30400002
304100                                                                  30410002
304200 4020-CLOSE-TROUBLE-NOTIF-CSR.                                    30420002
304300     EXEC SQL                                                     30430002
304400         CLOSE TRBL-NTF-BY-PO-CSR                                 30440002
304500     END-EXEC                                                     30450002
304600*                                                                 30460002
304700     EVALUATE TRUE                                                30470002
304800         WHEN SQLCODE = ZERO                                      30480002
304900             CONTINUE                                             30490002
305000         WHEN SQLWARN0 NOT = SPACES                               30500002
305100         WHEN SQLCODE < ZERO                                      30510002
305200         WHEN SQLCODE > ZERO                                      30520002
305300             MOVE '4020-CLOSE-TROUBLE-NOTIF-CSR'                  30530002
305400                               TO DP013-PARAGRAPH                 30540002
305500             MOVE 'CLOSE SYSTEM TROUBLE NOTIFICATION CURSOR'      30550002
305600                               TO DP013-MESSAGE-TEXT (1)          30560002
305700             MOVE SQLCA        TO DP013-SQLCA                     30570002
305800             MOVE 'TTRBNTF ' TO DP013-DB2-TABLE-NAME (1)          30580002
305900             MOVE 'TTRBRSN ' TO DP013-DB2-TABLE-NAME (2)          30590002
306000             SET DP013-DB2-ABEND                                  30600002
306100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               30610002
306200             PERFORM DP013-0000-PROCESS-ABEND                     30620002
306300         END-EVALUATE.                                            30630002
306400                                                                  30640002
306500*----------------------------------------------------------------*30650002
306600* CLOSE THE TROUBLE NOTIFICATION CURSOR                          *30660002
306700*----------------------------------------------------------------*30670002
306800                                                                  30680002
306900 4025-CLOSE-TROUBLE-NOTIF-CSR.                                    30690002
307000     EXEC SQL                                                     30700002
307100         CLOSE TRBL-NTF-PO-LN-CSR                                 30710002
307200     END-EXEC                                                     30720002
307300*                                                                 30730002
307400     EVALUATE TRUE                                                30740002
307500         WHEN SQLCODE = ZERO                                      30750002
307600             CONTINUE                                             30760002
307700         WHEN SQLWARN0 NOT = SPACES                               30770002
307800         WHEN SQLCODE < ZERO                                      30780002
307900         WHEN SQLCODE > ZERO                                      30790002
308000             MOVE '4025-CLOSE-TROUBLE-NOTIF-CSR'                  30800002
308100                               TO DP013-PARAGRAPH                 30810002
308200             MOVE 'CLOSE SYSTEM TROUBLE NOTIFICATION CURSOR'      30820002
308300                               TO DP013-MESSAGE-TEXT (1)          30830002
308400             MOVE SQLCA        TO DP013-SQLCA                     30840002
308500             MOVE 'TTRBNTF ' TO DP013-DB2-TABLE-NAME (1)          30850002
308600             MOVE 'TTRBRSN ' TO DP013-DB2-TABLE-NAME (2)          30860002
308700             SET DP013-DB2-ABEND                                  30870002
308800                 DP013-XCTL-DISPLAY-RESTART TO TRUE               30880002
308900             PERFORM DP013-0000-PROCESS-ABEND                     30890002
309000         END-EVALUATE.                                            30900002
309100                                                                  30910002
309200*----------------------------------------------------------------*30920002
309300* CLOSE THE TROUBLE NOTIFICATION CURSOR                          *30930002
309400*----------------------------------------------------------------*30940002
309500                                                                  30950002
309600 4030-CLOSE-TROUBLE-NOTIF-CSR.                                    30960002
309700     EXEC SQL                                                     30970002
309800         CLOSE TRBL-PK-AND-LN-CSR                                 30980002
309900     END-EXEC                                                     30990002
310000*                                                                 31000002
310100     EVALUATE TRUE                                                31010002
310200         WHEN SQLCODE = ZERO                                      31020002
310300             CONTINUE                                             31030002
310400         WHEN SQLWARN0 NOT = SPACES                               31040002
310500         WHEN SQLCODE < ZERO                                      31050002
310600         WHEN SQLCODE > ZERO                                      31060002
310700             MOVE '4030-CLOSE-TROUBLE-NOTIF-CSR'                  31070002
310800                               TO DP013-PARAGRAPH                 31080002
310900             MOVE 'CLOSE SYSTEM TROUBLE NOTIFICATION CURSOR'      31090002
311000                               TO DP013-MESSAGE-TEXT (1)          31100002
311100             MOVE SQLCA        TO DP013-SQLCA                     31110002
311200             MOVE 'TTRBNTF ' TO DP013-DB2-TABLE-NAME (1)          31120002
311300             MOVE 'TTRBRSN ' TO DP013-DB2-TABLE-NAME (2)          31130002
311400             SET DP013-DB2-ABEND                                  31140002
311500                 DP013-XCTL-DISPLAY-RESTART TO TRUE               31150002
311600             PERFORM DP013-0000-PROCESS-ABEND                     31160002
311700         END-EVALUATE.                                            31170002
311800                                                                  31180002
311900*----------------------------------------------------------------*31190002
312000*    SET UP THE HOST VARIABLES.                                  *31200002
312100*----------------------------------------------------------------*31210002
312200                                                                  31220002
312300 4100-PREPARE-CURSOR.                                             31230002
312400                                                                  31240002
312500     IF ASC-OPER-UNT-ID > ZERO                                    31250002
312600         MOVE ASC-OPER-UNT-ID                                     31260002
312700                            TO DK-OPER-UNT-ID-HIGH                31270002
312800                               DK-OPER-UNT-ID-LOW                 31280002
312900                               DK-OPER-UNT-ID                     31290002
313000     ELSE                                                         31300002
313100         MOVE ZERO          TO DK-OPER-UNT-ID-LOW                 31310002
313200         MOVE PC-FOUR-NINES TO DK-OPER-UNT-ID-HIGH                31320002
313300     END-IF.                                                      31330002
313400                                                                  31340002
313500     IF ASC-FCLTY-ID > ZERO                                       31350002
313600         MOVE ASC-FCLTY-ID  TO DK-FCLTY-ID-HIGH                   31360002
313700                               DK-FCLTY-ID-LOW                    31370002
313800                               DK-FCLTY-ID                        31380002
313900     ELSE                                                         31390002
314000         MOVE ZERO          TO DK-FCLTY-ID-LOW                    31400002
314100         MOVE PC-FOUR-NINES TO DK-FCLTY-ID-HIGH                   31410002
314200     END-IF.                                                      31420002
314300                                                                  31430002
314400     MOVE ASC-PO-NBR-N      TO DK-PO-NBR.                         31440002
314500                                                                  31450002
314600     MOVE ASC-RCVR-SEQ-NBR-N                                      31460002
314700                            TO DK-REC-SEQ-NBR.                    31470002
314800                                                                  31480002
314900     MOVE ASC-PO-LINE-NBR   TO DK-PO-LNE-NBR.                     31490002
315000     MOVE PC-DUMMY-DB2-COMPR-DATE-LOW                             31500002
315100                            TO DK-NOTIF-DTE-LOW                   31510002
315200                               DK-RSLVD-DTE-LOW.                  31520002
315300     MOVE PC-DUMMY-DB2-DATE TO DK-NOTIF-DTE-HIGH                  31530002
315400                               DK-RSLVD-DTE-HIGH.                 31540002
315500     MOVE PC-RSN-CDE-LOW    TO DK-TRBL-RSN-CDE-LOW.               31550002
315600     MOVE PC-RSN-CDE-HIGH   TO DK-TRBL-RSN-CDE-HIGH.              31560002
315700                                                                  31570002
315800     MOVE SPACES            TO DK-NOTIF-TYPE-1                    31580002
315900                               DK-NOTIF-TYPE-2                    31590002
316000                               DK-NOTIF-STAT-1                    31600002
316100                               DK-NOTIF-STAT-2                    31610002
316200                               DK-NOTIF-STAT-3                    31620002
316300                               DK-NOTIF-STAT-4.                   31630002
316400                                                                  31640002
316500     IF  ASC-TRBL-RSN-CDE-N > ZERO                                31650002
316600         MOVE ASC-TRBL-RSN-CDE-N                                  31660002
316700                            TO DK-TRBL-RSN-CDE-LOW                31670002
316800                               DK-TRBL-RSN-CDE-HIGH               31680002
316900     END-IF.                                                      31690002
317000                                                                  31700002
317100     IF  ASC-NOTIF-FROM-DATE-ISO > SPACES                         31710002
317200         MOVE ASC-NOTIF-FROM-DATE-ISO                             31720002
317300                            TO PV-COMPARE-TIMESTAMP-DATE          31730002
317400         MOVE PC-DUMMY-DB2-TIME-LOW                               31740002
317500                            TO PV-COMPARE-TIMESTAMP-TIME          31750002
317600         MOVE PV-COMPARE-TIMESTAMP                                31760002
317700                            TO DK-NOTIF-DTE-LOW                   31770002
317800         MOVE PC-DUMMY-DB2-COMPR-DATE-HIGH                        31780002
317900                            TO DK-NOTIF-DTE-HIGH                  31790002
318000     END-IF.                                                      31800002
318100                                                                  31810002
318200     IF  ASC-NOTIF-TO-DATE-ISO > SPACES                           31820002
318300         MOVE ASC-NOTIF-TO-DATE-ISO                               31830002
318400                            TO PV-COMPARE-TIMESTAMP-DATE          31840002
318500         MOVE PC-DUMMY-DB2-TIME-HIGH                              31850002
318600                            TO PV-COMPARE-TIMESTAMP-TIME          31860002
318700         MOVE PV-COMPARE-TIMESTAMP                                31870002
318800                            TO DK-NOTIF-DTE-HIGH                  31880002
318900     END-IF.                                                      31890002
319000                                                                  31900002
319100     IF  ASC-ALL-NOTIF-TYPES                                      31910002
319200         MOVE PC-NOTIF-TYPE-TROUBLE                               31920002
319300                            TO DK-NOTIF-TYPE-1                    31930002
319400         MOVE PC-NOTIF-TYPE-NOTIFICATION                          31940002
319500                            TO DK-NOTIF-TYPE-2                    31950002
319600     ELSE                                                         31960002
319700         MOVE ASC-NOTIF-TYPE                                      31970002
319800                            TO DK-NOTIF-TYPE-1                    31980002
319900     END-IF.                                                      31990002
320000                                                                  32000002
320100     IF  ASC-ALL-NOTIF-STATS                                      32010002
320200         MOVE PC-NEW-TROUBLE                                      32020002
320300                            TO DK-NOTIF-STAT-1                    32030002
320400         MOVE PC-IN-PROCESS-TROUBLE                               32040002
320500                            TO DK-NOTIF-STAT-2                    32050002
320600         MOVE PC-RESOLVED-TROUBLE                                 32060002
320700                            TO DK-NOTIF-STAT-3                    32070002
320800         MOVE PC-ACKNOWLEDGED-TROUBLE                             32080002
320900                            TO DK-NOTIF-STAT-4                    32090002
321000     ELSE                                                         32100002
321100         IF  ASC-UNRSLVD-STAT-ONLY                                32110002
321200             MOVE PC-NEW-TROUBLE                                  32120002
321300                            TO DK-NOTIF-STAT-1                    32130002
321400             MOVE PC-IN-PROCESS-TROUBLE                           32140002
321500                            TO DK-NOTIF-STAT-2                    32150002
321600         ELSE                                                     32160002
321700             MOVE ASC-NOTIF-STAT                                  32170002
321800                            TO DK-NOTIF-STAT-1                    32180002
321900         END-IF                                                   32190002
322000     END-IF.                                                      32200002
322100                                                                  32210002
322200     IF  ASC-RSLVD-FROM-DATE-ISO > SPACES                         32220002
322300         MOVE ASC-RSLVD-FROM-DATE-ISO                             32230002
322400                            TO PV-COMPARE-TIMESTAMP-DATE          32240002
322500         MOVE PC-DUMMY-DB2-TIME-LOW                               32250002
322600                            TO PV-COMPARE-TIMESTAMP-TIME          32260002
322700         MOVE PV-COMPARE-TIMESTAMP                                32270002
322800                            TO DK-RSLVD-DTE-LOW                   32280002
322900         MOVE PC-DUMMY-DB2-COMPR-DATE-HIGH                        32290002
323000                            TO DK-RSLVD-DTE-HIGH                  32300002
323100     END-IF.                                                      32310002
323200                                                                  32320002
323300     IF  ASC-RSLVD-TO-DATE-ISO > SPACES                           32330002
323400         MOVE ASC-RSLVD-TO-DATE-ISO                               32340002
323500                            TO PV-COMPARE-TIMESTAMP-DATE          32350002
323600         MOVE PC-DUMMY-DB2-TIME-HIGH                              32360002
323700                            TO PV-COMPARE-TIMESTAMP-TIME          32370002
323800         MOVE PV-COMPARE-TIMESTAMP                                32380002
323900                            TO DK-RSLVD-DTE-HIGH                  32390002
324000     END-IF.                                                      32400002
324100                                                                  32410002
324200     IF ASC-PREPK-ID-KEY > ZEROES                                 32420002
324300         MOVE ASC-PREPK-ID-KEY TO DK-PREPK-ID-KEY                 32430002
324400     END-IF.                                                      32440002
324500/                                                                 32450002
324600*----------------------------------------------------------------*32460002
324700*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *32470002
324800*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *32480002
324900*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *32490002
325000*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *32500002
325100*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *32510002
325200*                                                                *32520002
325300*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *32530002
325400*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *32540002
325500*    UPON INITIALIZATION.                                        *32550002
325600*----------------------------------------------------------------*32560002
325700                                                                  32570002
325800 4300-READ-TROUBLE-NOTIF-FOR-PO.                                  32580002
325900                                                                  32590002
326000     PERFORM                                                      32600002
326100         VARYING PV-READ-COUNT                                    32610002
326200         FROM 1 BY 1                                              32620002
326300         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    32630002
326400            OR (PS-NO-TRBL-NOTIF-ITEMS-LEFT)                      32640002
326500            OR (PS-ERROR))                                        32650002
326600                                                                  32660002
326700         IF ASC-INTER-APPL-VERIFY-RCVR OR                         32670002
326800            ASC-INTER-APPL-RCPT-ITEM OR                           32680002
326900            ASC-INTER-APPL-WO-RCVR OR                             32690002
327000            ASC-INTER-APPL-ITM-LST OR                             32700002
327100            ASC-INTER-APPL-ITM-ADD OR                             32710002
327200            ASC-INTER-APPL-REDIST                                 32720002
327300             PERFORM 4315-FETCH-TROUBLE-NOTIF-ITEM                32730002
327400         ELSE                                                     32740002
327500             IF ASC-INTER-APPL-PREPACK OR                         32750002
327600                ASC-INTER-APPL-REC-PREPACK                        32760002
327700                 PERFORM 4305-FETCH-TROUBLE-NOTIF-ITEM            32770002
327800             ELSE                                                 32780002
327900                 PERFORM 4310-FETCH-TROUBLE-NOTIF-ITEM            32790002
328000             END-IF                                               32800002
328100         END-IF                                                   32810002
328200                                                                  32820002
328300         IF PS-TRBL-NOTIF-ITEMS-LEFT                              32830002
328400             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                32840002
328500                 ADD +1            TO ASC-ITEM-SUB                32850002
328600             ELSE                                                 32860002
328700                 ADD +1            TO ASC-BLK-SUB                 32870002
328800                 MOVE +1           TO ASC-ITEM-SUB                32880002
328900                                                                  32890002
329000                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         32900002
329100                     MOVE +1       TO ASC-BLK-SUB                 32910002
329200                     SET ASC-BLOCK-MODIFIED (1)                   32920002
329300                                   TO TRUE                        32930002
329400                     PERFORM 5100-WRITE-TEMP-STORAGE              32940002
329500                     MOVE ASC-BLOCK-ENTRIES                       32950002
329600                               (PC-MAX-BLOCKS-IN-ARRAY)           32960002
329700                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 32970002
329800                     ADD +1        TO ASC-BLK-SUB                 32980002
329900                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   32990002
330000                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      33000002
330100                                   TO TRUE                        33010002
330200                 END-IF                                           33020002
330300             END-IF                                               33030002
330400             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    33040002
330500             MOVE ASC-NUMBER-OF-ITEMS-READ                        33050002
330600                                   TO ASC-LIST-ITEM-NUMBER        33060002
330700                                        (ASC-BLK-SUB ASC-ITEM-SUB)33070002
330800                                                                  33080002
330900             MOVE TRBNTF-ENT-ID    TO ASC-ENT-ID                  33090002
331000                                                                  33100002
331100             MOVE TRBNTF-NOTIF-NBR TO ASC-NOTIF-NBR               33110002
331200                                        (ASC-BLK-SUB ASC-ITEM-SUB)33120002
331300                                                                  33130002
331400             MOVE TRBNTF-PREPK-ID  TO ASC-PREPK-ID                33140002
331500                                        (ASC-BLK-SUB ASC-ITEM-SUB)33150002
331600                                                                  33160002
331700*JPL                                                              33170002
331800*JPL         IF ASC-INTER-APPL-PREPACK                            33180002
331900*JPL             MOVE RECITM-ORD-LNE-NBR TO ASC-PO-LNE-NBR-N      33190002
332000*JPL                                    (ASC-BLK-SUB ASC-ITEM-SUB)33200002
332100*JPL         ELSE                                                 33210002
332200                 MOVE TRBNTF-PO-LNE-NBR  TO ASC-PO-LNE-NBR-N      33220002
332300                                        (ASC-BLK-SUB ASC-ITEM-SUB)33230002
332400*JPL         END-IF                                               33240002
332500*JPL                                                              33250002
332600             PERFORM 4360-GET-RECITM-PREPK-ID                     33260002
332700                                                                  33270002
332800             MOVE RECITM-PREPK-ID  TO ASC-RECITM-PREPK-ID         33280002
332900                                        (ASC-BLK-SUB ASC-ITEM-SUB)33290002
333000                                                                  33300002
333100*IF 'PACK', DISPLAY SKU FROM PACK DRIVER LINE.                    33310002
333200             IF ASC-PREPK-ID (ASC-BLK-SUB ASC-ITEM-SUB) > ZEROES  33320002
333300                 PERFORM 4325-GET-RECITM-DRV-LNE                  33330002
333400                 PERFORM 4326-GET-PURITM-DRV-SKU                  33340002
333500             END-IF                                               33350002
333600                                                                  33360002
333700*----------------------------------------------------------------*33370002
333800* ADDED CODE TO CHECK FOR THE DUMMY SKU AND CALL TO XLKUT001     *33380002
333801* ADDED CODE TO INCLUDE PS-CALL-API-YES CHECK.                   *33380102
333802*----------------------------------------------------------------*33380202
333803                                                                  33380302
333804     PERFORM 4320-SELECT-TPURITM                                  33380402
333805                                                                  33380502
333806     IF (DK-SKU-SEQ = PC-000)                                     33380602
333807       MOVE '00000000'   TO PV-SKU-SEQ-NBR                        33380702
333808     ELSE                                                         33380802
333809       IF (DK-SKU-SEQ = PC-999)                                   33380902
333810         MOVE '99999999' TO PV-SKU-SEQ-NBR                        33381002
333820       END-IF                                                     33382002
333830     END-IF                                                       33383002
333840                                                                  33384002
333850     IF  PS-CALL-API-YES            AND                           33385002
333860         ((DK-SKU-SEQ NOT = PC-000) AND                           33386002
333870         (DK-SKU-SEQ NOT = PC-999))                               33387002
333880                                                                  33388002
333890         PERFORM 4322-CALL-XLKUT-DOMAIN-PGM                       33389002
333891     END-IF                                                       33389102
333892                                                                  33389202
333893     IF ASC-PREPK-ID (ASC-BLK-SUB ASC-ITEM-SUB) > ZEROES          33389302
333894         CONTINUE                                                 33389402
333895     ELSE                                                         33389502
333896             IF (XL001-SUB-CL-NBR-2CH = SPACES)                   33389602
333897                AND (PV-SKU-SEQ-NBR = SPACES)                     33389702
333898                MOVE PC-DUMMY-SKU                                 33389802
333899                  TO ASC-SKU (ASC-BLK-SUB ASC-ITEM-SUB)           33389902
333900                 ELSE                                             33390002
334000                     STRING XL001-SUB-CL-NBR-2CH DELIMITED BY SIZE33400002
334100                            PC-SPACE           DELIMITED BY SIZE  33410002
334200                            PV-SKU-SEQ-NBR     DELIMITED BY SIZE  33420002
334300                       INTO ASC-SKU (ASC-BLK-SUB ASC-ITEM-SUB)    33430002
334400                       MOVE PV-DEPT-NBR TO ASC-DEPT-NBR           33440002
334500                 END-IF                                           33450002
334600             END-IF                                               33460002
334700                                                                  33470002
334800             IF  PURITM-PIC-ITM-IND = PC-Y                        33480002
334900                 MOVE PC-P         TO ASC-AD-IND                  33490002
335000                                        (ASC-BLK-SUB ASC-ITEM-SUB)33500002
335100             ELSE                                                 33510002
335200                 IF  PURITM-AD-EVNT-DTE > PC-DUMMY-AD-EVNT-DTE    33520002
335300                     MOVE PC-Y     TO ASC-AD-IND                  33530002
335400                                        (ASC-BLK-SUB ASC-ITEM-SUB)33540002
335500                 ELSE                                             33550002
335600                     MOVE SPACES   TO ASC-AD-IND                  33560002
335700                                        (ASC-BLK-SUB ASC-ITEM-SUB)33570002
335800                 END-IF                                           33580002
335900             END-IF                                               33590002
336000                                                                  33600002
336100             MOVE SPACES           TO ASC-PROC-AREA               33610002
336200                                        (ASC-BLK-SUB ASC-ITEM-SUB)33620002
336300                                      ASC-PROC-LINE               33630002
336400                                        (ASC-BLK-SUB ASC-ITEM-SUB)33640002
336500                                                                  33650002
336600             MOVE TRBNTF-TRBL-RSN-CDE TO PS-OVER-SHORT-SW         33660002
336700             IF  PS-SHORT-TROUBLES                                33670002
336800                 IF  TRBNTF-OVER-SHT-PCT > 0                      33680002
336900                     MOVE TRBNTF-OVER-SHT-PCT                     33690002
337000                                         TO PV-OVER-SHT-PCT       33700002
337100                     IF  PS-LINE-SHORT-TROUBLES                   33710002
337200                     STRING PC-SHORT        DELIMITED BY SIZE     33720002
337300                            PV-OVER-SHT-PCT DELIMITED BY SIZE     33730002
337400                            PC-PERCENT      DELIMITED BY SIZE     33740002
337500                                     INTO ASC-TROUBLE-REASON-DESC 33750002
337600                                        (ASC-BLK-SUB ASC-ITEM-SUB)33760002
337700                     END-IF                                       33770002
337800                     IF  PS-PACK-SHORT-TROUBLES                   33780002
337900                     STRING PC-PSHORT       DELIMITED BY SIZE     33790002
338000                            PV-OVER-SHT-PCT DELIMITED BY SIZE     33800002
338100                            PC-PERCENT      DELIMITED BY SIZE     33810002
338200                                     INTO ASC-TROUBLE-REASON-DESC 33820002
338300                                        (ASC-BLK-SUB ASC-ITEM-SUB)33830002
338400                     END-IF                                       33840002
338500                 ELSE                                             33850002
338600                     MOVE TRBRSN-TRBL-SHT-DESC                    33860002
338700                                   TO ASC-TROUBLE-REASON-DESC     33870002
338800                                        (ASC-BLK-SUB ASC-ITEM-SUB)33880002
338900                 END-IF                                           33890002
339000             ELSE                                                 33900002
339100                 MOVE TRBNTF-TRBL-RSN-CDE TO PS-OVER-SHORT-SW     33910002
339200                 IF  PS-OVER-TROUBLES                             33920002
339300                     IF  TRBNTF-OVER-SHT-PCT > 0                  33930002
339400                         MOVE TRBNTF-OVER-SHT-PCT                 33940002
339500                                          TO PV-OVER-SHT-PCT      33950002
339600                         IF  PS-LINE-OVER-TROUBLES                33960002
339700                         STRING PC-OVER         DELIMITED BY SIZE 33970002
339800                                PV-OVER-SHT-PCT DELIMITED BY SIZE 33980002
339900                                PC-PERCENT      DELIMITED BY SIZE 33990002
340000                                      INTO ASC-TROUBLE-REASON-DESC34000002
340100                                        (ASC-BLK-SUB ASC-ITEM-SUB)34010002
340200                         END-IF                                   34020002
340300                         IF  PS-PACK-OVER-TROUBLES                34030002
340400                         STRING PC-POVER        DELIMITED BY SIZE 34040002
340500                                PV-OVER-SHT-PCT DELIMITED BY SIZE 34050002
340600                                PC-PERCENT      DELIMITED BY SIZE 34060002
340700                                      INTO ASC-TROUBLE-REASON-DESC34070002
340800                                        (ASC-BLK-SUB ASC-ITEM-SUB)34080002
340900                         END-IF                                   34090002
341000                     ELSE                                         34100002
341100                         MOVE TRBRSN-TRBL-SHT-DESC                34110002
341200                                   TO ASC-TROUBLE-REASON-DESC     34120002
341300                                        (ASC-BLK-SUB ASC-ITEM-SUB)34130002
341400                     END-IF                                       34140002
341500                 ELSE                                             34150002
341600                     MOVE TRBRSN-TRBL-SHT-DESC                    34160002
341700                                   TO ASC-TROUBLE-REASON-DESC     34170002
341800                                        (ASC-BLK-SUB ASC-ITEM-SUB)34180002
341900                 END-IF                                           34190002
342000             END-IF                                               34200002
342100                                                                  34210002
342200             MOVE TRBNTF-TRBL-RSN-CDE                             34220002
342300                                   TO ASC-TROUBLE-REASON-CDE      34230002
342400                                        (ASC-BLK-SUB ASC-ITEM-SUB)34240002
342500             MOVE TRBRSN-RESP-RES-IND                             34250002
342600                                   TO ASC-TROUBLE-RESP-RES-IND    34260002
342700                                        (ASC-BLK-SUB ASC-ITEM-SUB)34270002
342800             MOVE TRBRSN-TRBL-LVL-IND                             34280002
342900                                   TO ASC-TROUBLE-REASON-LVL      34290002
343000                                        (ASC-BLK-SUB ASC-ITEM-SUB)34300002
343100                                                                  34310002
343200             MOVE TRBNTF-NOTIF-TMST                               34320002
343300                                   TO PV-TIMESTAMP                34330002
343400             STRING PV-TIMESTAMP-MONTH  DELIMITED BY SIZE         34340002
343500                    PC-SLASH            DELIMITED BY SIZE         34350002
343600                    PV-TIMESTAMP-DAY    DELIMITED BY SIZE         34360002
343700                    PC-SPACE            DELIMITED BY SIZE         34370002
343800                    PV-TIMESTAMP-HOUR   DELIMITED BY SIZE         34380002
343900                    PC-COLON            DELIMITED BY SIZE         34390002
344000                    PV-TIMESTAMP-MINUTE DELIMITED BY SIZE         34400002
344100                                 INTO ASC-NOTIFICATION-DATE-TIME  34410002
344200                                        (ASC-BLK-SUB ASC-ITEM-SUB)34420002
344300                                                                  34430002
344400             PERFORM 4330-FETCH-MAX-DATE-TRBL-NOTIF               34440002
344500                                                                  34450002
344600             IF  PS-TRBL-DTL-EXISTS                               34460002
344700                 SET ASC-TRBL-DTL-EXISTS                          34470002
344800                        (ASC-BLK-SUB ASC-ITEM-SUB)                34480002
344900                                   TO TRUE                        34490002
345000             ELSE                                                 34500002
345100                 SET ASC-NO-TRBL-DTL-EXISTS                       34510002
345200                        (ASC-BLK-SUB ASC-ITEM-SUB)                34520002
345300                                   TO TRUE                        34530002
345400             END-IF                                               34540002
345500                                                                  34550002
345600             IF  TRBNTF-RESOLVED-IND = PC-NEW-TROUBLE OR          34560002
345700                                       PC-IN-PROCESS-TROUBLE      34570002
345800                 SET ASC-TRBL-NOT-RESOLVED                        34580002
345900                        (ASC-BLK-SUB ASC-ITEM-SUB)                34590002
346000                                   TO TRUE                        34600002
346100                 MOVE PV-RESP-DATE TO PV-TIMESTAMP                34610002
346200             ELSE                                                 34620002
346300                 MOVE TRBNTF-RESOLVED-TMST TO PV-TIMESTAMP        34630002
346400                 SET ASC-TRBL-RESOLVED                            34640002
346500                        (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE        34650002
346600                 IF TRBNTF-RESOLVED-IND =                         34660002
346700                                     PC-ACKNOWLEDGED-TROUBLE      34670002
346800                     SET ASC-TRBL-ACK (ASC-BLK-SUB ASC-ITEM-SUB)  34680002
346900                                                   TO TRUE        34690002
347000                 ELSE                                             34700002
347100                     SET ASC-TRBL-NOT-ACK                         34710002
347200                         (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE       34720002
347300                 END-IF                                           34730002
347400             END-IF                                               34740002
347500                                                                  34750002
347600             IF  PV-TIMESTAMP = PC-DUMMY-DB2-DATE                 34760002
347700                 MOVE SPACES       TO ASC-RESPONSE-DATE-TIME      34770002
347800                                        (ASC-BLK-SUB ASC-ITEM-SUB)34780002
347900             ELSE                                                 34790002
348000                 IF TRBNTF-RESOLVED-IND =                         34800002
348100****  IF THE TROUBLE IS ACKNOWLEDGED, DISPLAY THE ACKNOWLEDGED    34810002
348200****  DATE AND HOUR INSTEAD OF THE RESOLVED DATE/TIME             34820002
348300                                     PC-ACKNOWLEDGED-TROUBLE      34830002
348400                     MOVE TRBNTF-ACKNOWLG-TMST TO PV-TIMESTAMP    34840002
348500                 END-IF                                           34850002
348600                 STRING PV-TIMESTAMP-MONTH  DELIMITED BY SIZE     34860002
348700                        PC-SLASH            DELIMITED BY SIZE     34870002
348800                        PV-TIMESTAMP-DAY    DELIMITED BY SIZE     34880002
348900                        PC-SPACE            DELIMITED BY SIZE     34890002
349000                        PV-TIMESTAMP-HOUR   DELIMITED BY SIZE     34900002
349100                        PC-COLON            DELIMITED BY SIZE     34910002
349200                        PV-TIMESTAMP-MINUTE DELIMITED BY SIZE     34920002
349300                                 INTO ASC-RESPONSE-DATE-TIME      34930002
349400                                        (ASC-BLK-SUB ASC-ITEM-SUB)34940002
349500             END-IF                                               34950002
349600         END-IF                                                   34960002
349700     END-PERFORM.                                                 34970002
349800                                                                  34980002
349900     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          34990002
350000*-->     ** NO LIST ITEMS TO DISPLAY                              35000002
350100         CONTINUE                                                 35010002
350200     ELSE                                                         35020002
350300         IF DK-OPER-UNT-ID = ZERO                                 35030002
350400             MOVE TRBNTF-OPER-UNT-ID                              35040002
350500                                    TO DK-OPER-UNT-ID             35050002
350600             MOVE TRBNTF-FCLTY-ID  TO DK-FCLTY-ID                 35060002
350700         END-IF                                                   35070002
350800                                                                  35080002
350900         PERFORM 4340-FETCH-LOCATION-NAME                         35090002
351000         MOVE XL071-LOC-NM          TO ASC-FCLTY-NAME             35100002
351100                                                                  35110002
351200         PERFORM 4350-FETCH-VENDOR-NAME                           35120002
351300         MOVE ENTNME-ENT-NAME-DESC  TO ASC-VENDOR-NAME            35130002
351400     END-IF.                                                      35140002
351500                                                                  35150002
351600     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          35160002
351700         MOVE +1                   TO ASC-BLK-SUB                 35170002
351800         PERFORM 5100-WRITE-TEMP-STORAGE                          35180002
351900         ADD +1                    TO ASC-BLK-SUB                 35190002
352000         PERFORM 5100-WRITE-TEMP-STORAGE                          35200002
352100                                                                  35210002
352200         MOVE 1                    TO ASC-BLK-SUB                 35220002
352300                                      PV-BLOCK-NUMBER             35230002
352400         PERFORM 4410-READ-TEMP-STORAGE                           35240002
352500         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             35250002
352600             MOVE 2                TO ASC-BLK-SUB                 35260002
352700                                      PV-BLOCK-NUMBER             35270002
352800             PERFORM 4410-READ-TEMP-STORAGE                       35280002
352900         END-IF                                                   35290002
353000     END-IF.                                                      35300002
353100 EJECT                                                            35310002
353200*----------------------------------------------------------------*35320002
353300*    FETCH THE MESSAGE CURSOR.                                   *35330002
353400*----------------------------------------------------------------*35340002
353500                                                                  35350002
353600 4305-FETCH-TROUBLE-NOTIF-ITEM.                                   35360002
353700                                                                  35370002
353800     EXEC SQL                                                     35380002
353900          FETCH TRBL-PK-AND-LN-CSR                                35390002
354000          INTO  :TRBNTF-NOTIF-NBR                                 35400002
354100              , :TRBNTF-OPER-UNT-ID                               35410002
354200              , :TRBNTF-FCLTY-ID                                  35420002
354300              , :TRBNTF-DEPT-NBR                                  35430002
354400              , :TRBNTF-ENT-ID                                    35440002
354500              , :TRBNTF-PO-NBR                                    35450002
354600              , :TRBNTF-PO-LNE-NBR                                35460002
354700              , :TRBNTF-REC-SEQ-NBR                               35470002
354800              , :TRBNTF-TRBL-RSN-CDE                              35480002
354900              , :TRBNTF-NOTIF-TMST                                35490002
355000              , :TRBNTF-RESOLVED-IND                              35500002
355100              , :TRBNTF-RESOLVED-TMST                             35510002
355200              , :TRBNTF-ACKNOWLG-TMST                             35520002
355300              , :TRBNTF-OVER-SHT-PCT                              35530002
355400              , :TRBRSN-TRBL-SHT-DESC                             35540002
355500              , :TRBRSN-RESP-RES-IND                              35550002
355600              , :TRBRSN-TRBL-LVL-IND                              35560002
355700              , :TRBNTF-PREPK-ID                                  35570002
355800*JPL          , :RECITM-ORD-LNE-NBR                               35580002
355900*JPL          , :RECITM-PREPK-ID                                  35590002
356000     END-EXEC.                                                    35600002
356100                                                                  35610002
356200     EVALUATE TRUE                                                35620002
356300         WHEN SQLCODE = ZERO                                      35630002
356400              MOVE TRBNTF-DEPT-NBR                                35640002
356500                               TO PV-DEPT-NBR                     35650002
356600         WHEN SQLCODE = +100                                      35660002
356700              CONTINUE                                            35670002
356800         WHEN SQLWARN0 NOT = SPACE                                35680002
356900         WHEN SQLCODE NOT = ZERO                                  35690002
357000              MOVE '4305-FETCH-TROUBLE-NOTIF-ITEM'                35700002
357100                               TO DP013-PARAGRAPH                 35710002
357200              MOVE 'FETCH TROUBLE NOTIFICATION CURSOR'            35720002
357300                               TO DP013-MESSAGE-TEXT (1)          35730002
357400              MOVE SQLCA       TO DP013-SQLCA                     35740002
357500              MOVE 'TTRBNTF '  TO DP013-DB2-TABLE-NAME (1)        35750002
357600              MOVE 'TTRBRSN '  TO DP013-DB2-TABLE-NAME (2)        35760002
357700              SET DP013-DB2-ABEND                                 35770002
357800                               TO TRUE                            35780002
357900              PERFORM DP013-0000-PROCESS-ABEND                    35790002
358000     END-EVALUATE.                                                35800002
358100                                                                  35810002
358200     IF  SQLCODE EQUAL +100                                       35820002
358300         SET PS-NO-TRBL-NOTIF-ITEMS-LEFT                          35830002
358400                                   TO TRUE                        35840002
358500     END-IF.                                                      35850002
358600                                                                  35860002
358700*----------------------------------------------------------------*35870002
358800*    FETCH THE MESSAGE CURSOR.                                   *35880002
358900*----------------------------------------------------------------*35890002
359000                                                                  35900002
359100 4310-FETCH-TROUBLE-NOTIF-ITEM.                                   35910002
359200                                                                  35920002
359300     EXEC SQL                                                     35930002
359400          FETCH TRBL-NTF-BY-PO-CSR                                35940002
359500          INTO  :TRBNTF-NOTIF-NBR                                 35950002
359600              , :TRBNTF-OPER-UNT-ID                               35960002
359700              , :TRBNTF-FCLTY-ID                                  35970002
359800              , :TRBNTF-DEPT-NBR                                  35980002
359900              , :TRBNTF-ENT-ID                                    35990002
360000              , :TRBNTF-PO-NBR                                    36000002
360100              , :TRBNTF-PO-LNE-NBR                                36010002
360200              , :TRBNTF-REC-SEQ-NBR                               36020002
360300              , :TRBNTF-TRBL-RSN-CDE                              36030002
360400              , :TRBNTF-NOTIF-TMST                                36040002
360500              , :TRBNTF-RESOLVED-IND                              36050002
360600              , :TRBNTF-RESOLVED-TMST                             36060002
360700              , :TRBNTF-ACKNOWLG-TMST                             36070002
360800              , :TRBNTF-OVER-SHT-PCT                              36080002
360900              , :TRBNTF-PREPK-ID                                  36090002
361000              , :TRBRSN-TRBL-SHT-DESC                             36100002
361100              , :TRBRSN-RESP-RES-IND                              36110002
361200              , :TRBRSN-TRBL-LVL-IND                              36120002
361300*JPL          , :RECITM-PREPK-ID                                  36130002
361400     END-EXEC.                                                    36140002
361500                                                                  36150002
361600     EVALUATE TRUE                                                36160002
361700         WHEN SQLCODE = ZERO                                      36170002
361800              MOVE TRBNTF-DEPT-NBR                                36180002
361900                               TO PV-DEPT-NBR                     36190002
362000         WHEN SQLCODE = +100                                      36200002
362100              CONTINUE                                            36210002
362200         WHEN SQLWARN0 NOT = SPACE                                36220002
362300         WHEN SQLCODE NOT = ZERO                                  36230002
362400              MOVE '4310-FETCH-TROUBLE-NOTIF-ITEM'                36240002
362500                               TO DP013-PARAGRAPH                 36250002
362600              MOVE 'FETCH TROUBLE NOTIFICATION CURSOR'            36260002
362700                               TO DP013-MESSAGE-TEXT (1)          36270002
362800              MOVE SQLCA       TO DP013-SQLCA                     36280002
362900              MOVE 'TTRBNTF '  TO DP013-DB2-TABLE-NAME (1)        36290002
363000              MOVE 'TTRBRSN '  TO DP013-DB2-TABLE-NAME (2)        36300002
363100              SET DP013-DB2-ABEND                                 36310002
363200                               TO TRUE                            36320002
363300              PERFORM DP013-0000-PROCESS-ABEND                    36330002
363400     END-EVALUATE.                                                36340002
363500                                                                  36350002
363600     IF  SQLCODE EQUAL +100                                       36360002
363700         SET PS-NO-TRBL-NOTIF-ITEMS-LEFT                          36370002
363800                                   TO TRUE                        36380002
363900     END-IF.                                                      36390002
364000                                                                  36400002
364100*----------------------------------------------------------------*36410002
364200*    FETCH THE MESSAGE CURSOR.                                   *36420002
364300*----------------------------------------------------------------*36430002
364400                                                                  36440002
364500 4315-FETCH-TROUBLE-NOTIF-ITEM.                                   36450002
364600                                                                  36460002
364700     EXEC SQL                                                     36470002
364800          FETCH TRBL-NTF-PO-LN-CSR                                36480002
364900          INTO  :TRBNTF-NOTIF-NBR                                 36490002
365000              , :TRBNTF-OPER-UNT-ID                               36500002
365100              , :TRBNTF-FCLTY-ID                                  36510002
365200              , :TRBNTF-DEPT-NBR                                  36520002
365300              , :TRBNTF-ENT-ID                                    36530002
365400              , :TRBNTF-PO-NBR                                    36540002
365500              , :TRBNTF-PO-LNE-NBR                                36550002
365600              , :TRBNTF-REC-SEQ-NBR                               36560002
365700              , :TRBNTF-TRBL-RSN-CDE                              36570002
365800              , :TRBNTF-NOTIF-TMST                                36580002
365900              , :TRBNTF-RESOLVED-IND                              36590002
366000              , :TRBNTF-RESOLVED-TMST                             36600002
366100              , :TRBNTF-ACKNOWLG-TMST                             36610002
366200              , :TRBNTF-OVER-SHT-PCT                              36620002
366300              , :TRBRSN-TRBL-SHT-DESC                             36630002
366400              , :TRBRSN-RESP-RES-IND                              36640002
366500              , :TRBRSN-TRBL-LVL-IND                              36650002
366600              , :TRBNTF-PREPK-ID                                  36660002
366700*JPL          , :RECITM-PREPK-ID                                  36670002
366800     END-EXEC.                                                    36680002
366900                                                                  36690002
367000     EVALUATE TRUE                                                36700002
367100         WHEN SQLCODE = ZERO                                      36710002
367200              MOVE TRBNTF-DEPT-NBR                                36720002
367300                               TO PV-DEPT-NBR                     36730002
367400         WHEN SQLCODE = +100                                      36740002
367500              CONTINUE                                            36750002
367600         WHEN SQLWARN0 NOT = SPACE                                36760002
367700         WHEN SQLCODE NOT = ZERO                                  36770002
367800              MOVE '4315-FETCH-TROUBLE-NOTIF-ITEM'                36780002
367900                               TO DP013-PARAGRAPH                 36790002
368000              MOVE 'FETCH TROUBLE NOTIFICATION CURSOR'            36800002
368100                               TO DP013-MESSAGE-TEXT (1)          36810002
368200              MOVE SQLCA       TO DP013-SQLCA                     36820002
368300              MOVE 'TTRBNTF '  TO DP013-DB2-TABLE-NAME (1)        36830002
368400              MOVE 'TTRBRSN '  TO DP013-DB2-TABLE-NAME (2)        36840002
368500              SET DP013-DB2-ABEND                                 36850002
368600                               TO TRUE                            36860002
368700              PERFORM DP013-0000-PROCESS-ABEND                    36870002
368800     END-EVALUATE.                                                36880002
368900                                                                  36890002
369000     IF  SQLCODE EQUAL +100                                       36900002
369100         SET PS-NO-TRBL-NOTIF-ITEMS-LEFT                          36910002
369200                                   TO TRUE                        36920002
369300     END-IF.                                                      36930002
369400                                                                  36940002
369500*----------------------------------------------------------------*36950002
369600*    RETRIEVE THE SKU CLASS AND SKU SEQUENCE NUMBER FROM THE     *36960002
369700*    PURCHASE ORDER ITEM TABLE (TPURITM).                        *36970002
369800*----------------------------------------------------------------*36980002
369900                                                                  36990002
370000 4320-SELECT-TPURITM.                                             37000002
370100                                                                  37010002
370200     INITIALIZE DCLTPURITM.                                       37020002
370300                                                                  37030002
370400     EXEC SQL                                                     37040002
370500          SELECT PO_LNE_NBR                                       37050002
370600                , SKU_SEQ_NBR                                     37060002
370700                , AD_EVNT_DTE                                     37070002
370800                , PIC_ITM_IND                                     37080002
370900                , ITM_NBR                                         37090002
371000             INTO :PURITM-PO-LNE-NBR                              37100002
371100                , :PURITM-SKU-SEQ-NBR                             37110002
371200                , :PURITM-AD-EVNT-DTE                             37120002
371300                , :PURITM-PIC-ITM-IND                             37130002
371400                , :PURITM-ITM-NBR                                 37140002
371500            FROM TPURITM                                          37150002
371600            WHERE PO_NBR        = :TRBNTF-PO-NBR                  37160002
371700             AND APP_PO_LNE_NBR = :TRBNTF-PO-LNE-NBR              37170002
371800             AND VER_STATUS_CDE = :PC-ACTIVE-STATUS               37180002
371900     END-EXEC.                                                    37190002
372000*----------------------------------------------------------------*37200002
372100     MOVE SPACES TO DK-SKU-SEQ                                    37210002
372200     MOVE ZEROES TO DK-ITM-NBR                                    37220002
372300     SET PS-CALL-API-NO  TO TRUE                                  37230002
372310                                                                  37231002
372320     EVALUATE TRUE                                                37232002
372330         WHEN SQLCODE = +0                                        37233002
372340              SET PS-CALL-API-YES     TO TRUE                     37234002
372350              MOVE PURITM-SKU-SEQ-NBR TO DK-SKU-SEQ               37235002
372360              MOVE PURITM-ITM-NBR     TO DK-ITM-NBR               37236002
372370         WHEN SQLCODE = +100                                      37237002
372380              CONTINUE                                            37238002
372390*JPL         MOVE PC-TSYMSG-01064 TO DP020-MSG-NUMBER             37239002
372400*JPL         SET DP020-MSG-FATAL  TO TRUE                         37240002
372500*JPL         SET PS-ERROR         TO TRUE                         37250002
372600                                                                  37260002
372700         WHEN SQLWARN0 NOT = SPACE                                37270002
372800         WHEN SQLCODE NOT = ZERO                                  37280002
372900             MOVE '4320-SELECT-TPURITM'                           37290002
373000                               TO DP013-PARAGRAPH                 37300002
373100             MOVE 'FETCH SKU INFORMATION'                         37310002
373200                               TO DP013-MESSAGE-TEXT (1)          37320002
373300             MOVE TRBNTF-PO-NBR                                   37330002
373400                               TO PV-ERROR-PO-NBR                 37340002
373500             MOVE TRBNTF-REC-SEQ-NBR                              37350002
373600                               TO PV-ERROR-REC-SEQ-NBR            37360002
373700             MOVE TRBNTF-PO-LNE-NBR                               37370002
373800                               TO PV-ERROR-PO-LNE-NBR             37380002
373900             MOVE TRBNTF-NOTIF-NBR                                37390002
374000                               TO PV-ERROR-NOTIF-NBR              37400002
374100             STRING ' RCVR: '             DELIMITED BY SIZE       37410002
374200                     PV-ERROR-PO-NBR      DELIMITED BY SIZE       37420002
374300                     '-'                  DELIMITED BY SIZE       37430002
374400                     PV-ERROR-REC-SEQ-NBR DELIMITED BY SIZE       37440002
374500                     ' PO LINE NBR: '     DELIMITED BY SIZE       37450002
374600                     PV-ERROR-PO-LNE-NBR  DELIMITED BY SIZE       37460002
374700                     ' NOTIFICATION NBR: ' DELIMITED BY SIZE      37470002
374800                     PV-ERROR-NOTIF-NBR   DELIMITED BY SIZE       37480002
374900                             INTO DP013-MESSAGE-TEXT (2)          37490002
375000             MOVE SQLCA   TO DP013-SQLCA                          37500002
375100             MOVE 'TPURITM ' TO DP013-DB2-TABLE-NAME (1)          37510002
375200             SET DP013-DB2-ABEND                                  37520002
375300                               TO TRUE                            37530002
375400             PERFORM DP013-0000-PROCESS-ABEND                     37540002
375500     END-EVALUATE.                                                37550002
375600                                                                  37560002
375700 EJECT                                                            37570002
375800*----------------------------------------------------------------*37580002
375900* CODE FOR ACCESSING LOGISTICS DOMAIN ITEM ACCESS MODULE         *37590002
376000*----------------------------------------------------------------*37600002
376100 4322-CALL-XLKUT-DOMAIN-PGM.                                      37610002
376200                                                                  37620002
376210        INITIALIZE XL001-ITEM-COMMAREA.                           37621002
376220        MOVE DK-ITM-NBR             TO XL001-KEY-ITM-NBR.         37622002
376230                                                                  37623002
376240        SET  XL001-BY-ITEM                                        37624002
376250             XL001-SELECT-VND-STYL                                37625002
376260             XL001-SELECT-SKU       TO TRUE.                      37626002
376270                                                                  37627002
376280        CALL XL001-VSM-PGM USING  DFHEIBLK                        37628002
376290                                  XL001-COMMAREA                  37629002
376300                                  XL001-ITEM-COMMAREA.            37630002
376301        EVALUATE TRUE                                             37630102
376302                                                                  37630202
376303         WHEN XL001-SKU-SQLCODE = +0                              37630302
376304              MOVE XL001-SKU-NBR     TO  PV-TEMP-SEQ-NBR          37630402
376305              MOVE PV-TEMP-SEQ-NBR   TO  PV-SKU-SEQ-NBR           37630502
376306                                                                  37630602
376307         WHEN XL001-SKU-SQLCODE = +100                            37630702
376308              MOVE ZEROES            TO  PV-TEMP-SEQ-NBR          37630802
376309              MOVE SPACES            TO  PV-SKU-SEQ-NBR           37630902
376310                                                                  37631002
376311         WHEN XL001-SKU-CONTENTION                                37631102
376312              MOVE '7020-SELECT-SKU-BY-ITM'                       37631202
376313                                TO DP013-PARAGRAPH                37631302
376314              MOVE 'SKU CONTENTION'                               37631402
376315                                TO DP013-MESSAGE-TEXT (1)         37631502
376316              MOVE XL001-SQLCA  TO DP013-SQLCA                    37631602
376317              MOVE 'XLV-SKU ' TO DP013-DB2-TABLE-NAME (1)         37631702
376318              SET DP013-DB2-ABEND                                 37631802
376319                                TO TRUE                           37631902
376320              PERFORM DP013-0000-PROCESS-ABEND                    37632002
376330                                                                  37633002
376340         WHEN OTHER                                               37634002
376341              MOVE '7020-SELECT-SKU-BY-ITM'                       37634102
376342                                TO DP013-PARAGRAPH                37634202
376343              MOVE 'INVALID RETURN'                               37634302
376344                                TO DP013-MESSAGE-TEXT (1)         37634402
376345              MOVE XL001-SQLCA   TO DP013-SQLCA                   37634502
376346              MOVE 'XLV-SKU ' TO DP013-DB2-TABLE-NAME (1)         37634602
376347              SET DP013-DB2-ABEND                                 37634702
376348                                TO TRUE                           37634802
376349              PERFORM DP013-0000-PROCESS-ABEND                    37634902
376350        END-EVALUATE.                                             37635002
376360                                                                  37636002
376370*----------------------------------------------------------------*37637002
376380*    IF 'PACK', GET DRIVER LINE NUMBER.                          *37638002
376390*----------------------------------------------------------------*37639002
376400 4325-GET-RECITM-DRV-LNE.                                         37640002
376500                                                                  37650002
376600     EXEC SQL                                                     37660002
376700         SELECT DISTINCT                                          37670002
376800                ORD_LNE_NBR                                       37680002
376900           INTO :RECITM-ORD-LNE-NBR                               37690002
377000           FROM TRECITM                                           37700002
377100          WHERE ORD_NBR            = :TRBNTF-PO-NBR               37710002
377200            AND REC_SEQ_NBR        = :TRBNTF-REC-SEQ-NBR          37720002
377300            AND OPER_UNT_ID        = :TRBNTF-OPER-UNT-ID          37730002
377400            AND PREPK_ID           = :TRBNTF-PREPK-ID             37740002
377500            AND PREPK_DRV_LNE_CDE  = 'A'                          37750002
377600     END-EXEC.                                                    37760002
377700                                                                  37770002
377800     EVALUATE TRUE                                                37780002
377900       WHEN SQLCODE = ZERO                                        37790002
378000           CONTINUE                                               37800002
378100                                                                  37810002
378200       WHEN SQLCODE = +100                                        37820002
378300            PERFORM 4325-GET-PURITM-MIN-LNE                       37830002
378400                                                                  37840002
378500       WHEN SQLWARN0 NOT = SPACE                                  37850002
378600       WHEN SQLCODE  NOT = ZERO                                   37860002
378700           MOVE '4325-GET-RECITM-DRV-LNE' TO DP013-PARAGRAPH      37870002
378800           MOVE 'GET DRIVER LINE'  TO DP013-MESSAGE-TEXT (1)      37880002
378900           MOVE TRBNTF-PO-NBR      TO PV-ERROR-PO-NBR             37890002
379000           MOVE TRBNTF-REC-SEQ-NBR TO PV-ERROR-REC-SEQ-NBR        37900002
379100           MOVE TRBNTF-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID        37910002
379200           MOVE TRBNTF-PREPK-ID    TO PV-ERROR-PREPK-ID           37920002
379300           STRING ' RCVR: '             DELIMITED BY SIZE         37930002
379400                  PV-ERROR-PO-NBR       DELIMITED BY SIZE         37940002
379500                  '-'                   DELIMITED BY SIZE         37950002
379600                  PV-ERROR-REC-SEQ-NBR  DELIMITED BY SIZE         37960002
379700                  '  OPER-UNT-ID: '     DELIMITED BY SIZE         37970002
379800                  PV-ERROR-OPER-UNT-ID  DELIMITED BY SIZE         37980002
379900                  '  PREPK ID: '        DELIMITED BY SIZE         37990002
380000                  PV-ERROR-PREPK-ID     DELIMITED BY SIZE         38000002
380100             INTO DP013-MESSAGE-TEXT (2)                          38010002
380200           MOVE SQLCA      TO DP013-SQLCA                         38020002
380300           MOVE 'TRECITM ' TO DP013-DB2-TABLE-NAME (1)            38030002
380400           SET DP013-DB2-ABEND TO TRUE                            38040002
380500           PERFORM DP013-0000-PROCESS-ABEND                       38050002
380600     END-EVALUATE.                                                38060002
380700 EJECT                                                            38070002
380800*----------------------------------------------------------------*38080002
380900*    IF 'PACK', GET FIRST LINE IN PACK.                          *38090002
381000*    THE FOLLOWING CONDITION WOULD OCCUR IF THERE IS A RESOLVED  *38100002
381100*    PACK TROUBLE AND THE RECEIVER WAS INACTIVATED.              *38110002
381200*----------------------------------------------------------------*38120002
381300 4325-GET-PURITM-MIN-LNE.                                         38130002
381400                                                                  38140002
381500     EXEC SQL                                                     38150002
381600         SELECT DISTINCT                                          38160002
381700                MIN(PO_LNE_NBR)                                   38170002
381800           INTO :RECITM-ORD-LNE-NBR                               38180002
381900           FROM TPURITM                                           38190002
382000          WHERE PO_NBR             = :TRBNTF-PO-NBR               38200002
382100            AND PO_PREPK_ID        = :TRBNTF-PREPK-ID             38210002
382200            AND VER_STATUS_CDE     = 'A'                          38220002
382300     END-EXEC.                                                    38230002
382400                                                                  38240002
382500     EVALUATE TRUE                                                38250002
382600       WHEN SQLCODE = ZERO OR -811                                38260002
382700           CONTINUE                                               38270002
382800       WHEN SQLCODE = ZERO OR -305                                38280002
382900           MOVE +0    TO RECITM-ORD-LNE-NBR                       38290002
383000       WHEN SQLWARN0 NOT = SPACE                                  38300002
383100       WHEN SQLCODE  NOT = ZERO                                   38310002
383200           MOVE '4325-GET-PURITM-MIN-LNE' TO DP013-PARAGRAPH      38320002
383300           MOVE 'GET ANY LINE'     TO DP013-MESSAGE-TEXT (1)      38330002
383400           MOVE TRBNTF-PO-NBR      TO PV-ERROR-PO-NBR             38340002
383500           MOVE TRBNTF-REC-SEQ-NBR TO PV-ERROR-REC-SEQ-NBR        38350002
383600           MOVE TRBNTF-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID        38360002
383700           MOVE TRBNTF-PREPK-ID    TO PV-ERROR-PREPK-ID           38370002
383800           STRING ' RCVR: '             DELIMITED BY SIZE         38380002
383900                  PV-ERROR-PO-NBR       DELIMITED BY SIZE         38390002
384000                  '-'                   DELIMITED BY SIZE         38400002
384100                  PV-ERROR-REC-SEQ-NBR  DELIMITED BY SIZE         38410002
384200                  '  OPER-UNT-ID: '     DELIMITED BY SIZE         38420002
384300                  PV-ERROR-OPER-UNT-ID  DELIMITED BY SIZE         38430002
384400                  '  PREPK ID: '        DELIMITED BY SIZE         38440002
384500                  PV-ERROR-PREPK-ID     DELIMITED BY SIZE         38450002
384600             INTO DP013-MESSAGE-TEXT (2)                          38460002
384700           MOVE SQLCA      TO DP013-SQLCA                         38470002
384800           MOVE 'TPURITM ' TO DP013-DB2-TABLE-NAME (1)            38480002
384900           SET DP013-DB2-ABEND TO TRUE                            38490002
385000           PERFORM DP013-0000-PROCESS-ABEND                       38500002
385100     END-EVALUATE.                                                38510002
385200 EJECT                                                            38520002
385300*----------------------------------------------------------------*38530002
385400*    IF 'PACK', USE DRIVER LINE NUMBER TO GET SKU                *38540002
385500*----------------------------------------------------------------*38550002
385600 4326-GET-PURITM-DRV-SKU.                                         38560002
385700                                                                  38570002
385800     EXEC SQL                                                     38580002
385900         SELECT SKU_SEQ_NBR                                       38590002
386000              , ITM_NBR                                           38600002
386100           INTO :PURITM-SKU-SEQ-NBR                               38610002
386200              , :PURITM-ITM-NBR                                   38620002
386300           FROM TPURITM                                           38630002
386400          WHERE PO_NBR          = :TRBNTF-PO-NBR                  38640002
386500            AND APP_PO_LNE_NBR  = :RECITM-ORD-LNE-NBR             38650002
386600            AND VER_STATUS_CDE  = :PC-ACTIVE-STATUS               38660002
386700     END-EXEC.                                                    38670002
386800                                                                  38680002
386900                                                                  38690002
387000     EVALUATE TRUE                                                38700002
387100       WHEN SQLCODE = ZERO                                        38710002
387200           MOVE PURITM-ITM-NBR TO DK-ITM-NBR                      38720002
387300           PERFORM 4322-CALL-XLKUT-DOMAIN-PGM                     38730002
387400           STRING XL001-SUB-CL-NBR-2CH DELIMITED BY SIZE          38740002
387500                  PC-SPACE           DELIMITED BY SIZE            38750002
387600                  PV-SKU-SEQ-NBR     DELIMITED BY SIZE            38760002
387700             INTO ASC-SKU (ASC-BLK-SUB ASC-ITEM-SUB)              38770002
387800           MOVE PV-DEPT-NBR TO ASC-DEPT-NBR                       38780002
387900                                                                  38790002
388000       WHEN SQLCODE = +100                                        38800002
388100           MOVE PC-DUMMY-SKU TO ASC-SKU(ASC-BLK-SUB ASC-ITEM-SUB) 38810002
388200                                                                  38820002
388300       WHEN SQLWARN0 NOT = SPACE                                  38830002
388400       WHEN SQLCODE  NOT = ZERO                                   38840002
388500           MOVE '4326-GET-PURITM-DRV-SKU' TO DP013-PARAGRAPH      38850002
388600           MOVE 'GET DRV LNE SKU'  TO DP013-MESSAGE-TEXT (1)      38860002
388700           MOVE TRBNTF-PO-NBR      TO PV-ERROR-PO-NBR             38870002
388800           MOVE TRBNTF-REC-SEQ-NBR TO PV-ERROR-REC-SEQ-NBR        38880002
388900           MOVE RECITM-ORD-LNE-NBR TO PV-ERROR-PO-LNE-NBR         38890002
389000           MOVE TRBNTF-NOTIF-NBR   TO PV-ERROR-NOTIF-NBR          38900002
389100           STRING ' RCVR: '             DELIMITED BY SIZE         38910002
389200                  PV-ERROR-PO-NBR       DELIMITED BY SIZE         38920002
389300                  '-'                   DELIMITED BY SIZE         38930002
389400                  PV-ERROR-REC-SEQ-NBR  DELIMITED BY SIZE         38940002
389500                  ' PO LINE NBR: '      DELIMITED BY SIZE         38950002
389600                  PV-ERROR-PO-LNE-NBR   DELIMITED BY SIZE         38960002
389700                  ' NOTIFICATION NBR: ' DELIMITED BY SIZE         38970002
389800                  PV-ERROR-NOTIF-NBR    DELIMITED BY SIZE         38980002
389900             INTO DP013-MESSAGE-TEXT (2)                          38990002
390000           MOVE SQLCA      TO DP013-SQLCA                         39000002
390100           MOVE 'TPURITM ' TO DP013-DB2-TABLE-NAME (1)            39010002
390200           SET DP013-DB2-ABEND TO TRUE                            39020002
390300           PERFORM DP013-0000-PROCESS-ABEND                       39030002
390400     END-EVALUATE.                                                39040002
390500                                                                  39050002
390600*----------------------------------------------------------------*39060002
390700*    RETRIEVE THE MOST CURRENT TROUBLE DETAIL ROW FOR A SPECIFIC *39070002
390800*    TROUBLE NOTIFICATION RECORD.                                *39080002
390900*----------------------------------------------------------------*39090002
391000 4330-FETCH-MAX-DATE-TRBL-NOTIF.                                  39100002
391100                                                                  39110002
391200     INITIALIZE PV-RESP-DATE.                                     39120002
391300     SET PS-NO-TRBL-DTL-EXISTS TO TRUE.                           39130002
391400                                                                  39140002
391500     EXEC SQL                                                     39150002
391600          SELECT MAX(CRE_TMST)                                    39160002
391700            INTO :PV-RESP-DATE                                    39170002
391800            FROM TTRBDTL                                          39180002
391900           WHERE NOTIF_NBR = :TRBNTF-NOTIF-NBR                    39190002
392000     END-EXEC.                                                    39200002
392100                                                                  39210002
392200     EVALUATE TRUE                                                39220002
392300         WHEN SQLCODE = ZERO                                      39230002
392400              SET PS-TRBL-DTL-EXISTS                              39240002
392500                               TO TRUE                            39250002
392600         WHEN SQLCODE = +100                                      39260002
392700         WHEN SQLCODE = -305                                      39270002
392800              MOVE PC-DUMMY-DB2-DATE                              39280002
392900                               TO PV-RESP-DATE                    39290002
393000         WHEN SQLWARN0 NOT = SPACE                                39300002
393100         WHEN SQLCODE NOT = ZERO                                  39310002
393200              MOVE '4330-FETCH-MAX-DATE-TRBL-NOTIF'               39320002
393300                               TO DP013-PARAGRAPH                 39330002
393400              MOVE 'FETCH TROUBLE DETAIL INFORMATION'             39340002
393500                               TO DP013-MESSAGE-TEXT (1)          39350002
393600              MOVE TRBNTF-PO-NBR                                  39360002
393700                               TO PV-ERROR-PO-NBR                 39370002
393800              MOVE TRBNTF-REC-SEQ-NBR                             39380002
393900                               TO PV-ERROR-REC-SEQ-NBR            39390002
394000              MOVE TRBNTF-PO-LNE-NBR                              39400002
394100                               TO PV-ERROR-PO-LNE-NBR             39410002
394200              MOVE TRBNTF-NOTIF-NBR                               39420002
394300                               TO PV-ERROR-NOTIF-NBR              39430002
394400              STRING ' RCVR: '            DELIMITED BY SIZE       39440002
394500                     PV-ERROR-PO-NBR      DELIMITED BY SIZE       39450002
394600                     '-'                  DELIMITED BY SIZE       39460002
394700                     PV-ERROR-REC-SEQ-NBR DELIMITED BY SIZE       39470002
394800                     ' PO LINE NBR: '     DELIMITED BY SIZE       39480002
394900                     PV-ERROR-PO-LNE-NBR  DELIMITED BY SIZE       39490002
395000                     ' NOTIFICATION NBR: ' DELIMITED BY SIZE      39500002
395100                     PV-ERROR-NOTIF-NBR   DELIMITED BY SIZE       39510002
395200                             INTO DP013-MESSAGE-TEXT (2)          39520002
395300              MOVE SQLCA   TO DP013-SQLCA                         39530002
395400              MOVE 'TTRBDTL ' TO DP013-DB2-TABLE-NAME (1)         39540002
395500              SET DP013-DB2-ABEND                                 39550002
395600                               TO TRUE                            39560002
395700              PERFORM DP013-0000-PROCESS-ABEND                    39570002
395800     END-EVALUATE.                                                39580002
395900                                                                  39590002
396000*----------------------------------------------------------------*39600002
396100*    RETRIEVE THE LOCATION NAME FROM THE XLT_LOC BY CALLING      *39610002
396110*                LOGISTICS DOMAIN LOCATION MODULE                *39611002
396120*----------------------------------------------------------------*39612002
396130                                                                  39613002
396140 4340-FETCH-LOCATION-NAME.                                        39614002
396150**** TFACLTY TABLE REPLACED WITH CALL TO LOCATION DOMAIN          39615002
396160     INITIALIZE XL071-COMMAREA-REC.                               39616002
396170                                                                  39617002
396180     MOVE DK-OPER-UNT-ID      TO XL071-LOCATION-NUMBER.           39618002
396190                                                                  39619002
396200                                                                  39620002
396300     CALL XL071-LOCATION-MODULE USING DFHEIBLK                    39630002
396400                                      XL071-COMMAREA              39640002
396500                                      XL071-COMMAREA-REC.         39650002
396600                                                                  39660002
396700     EVALUATE TRUE                                                39670002
396800         WHEN XL071-NO-ERRORS                                     39680002
396900              CONTINUE                                            39690002
397000         WHEN XL071-LOC-NOT-FOUND                                 39700002
397100              MOVE SPACES  TO XL071-LOC-NM                        39710002
397200         WHEN XL071-BAD-DB2-RETURN                                39720002
397300              MOVE '4340-FETCH-LOCATION-NAME'                     39730002
397400                               TO DP013-PARAGRAPH                 39740002
397500              MOVE 'FETCH LOCATION NAME'                          39750002
397600                               TO DP013-MESSAGE-TEXT (1)          39760002
397700              MOVE TRBNTF-PO-NBR                                  39770002
397800                               TO PV-ERROR-PO-NBR                 39780002
397900              MOVE TRBNTF-REC-SEQ-NBR                             39790002
398000                               TO PV-ERROR-REC-SEQ-NBR            39800002
398100              MOVE TRBNTF-PO-LNE-NBR                              39810002
398200                               TO PV-ERROR-PO-LNE-NBR             39820002
398300              MOVE TRBNTF-NOTIF-NBR                               39830002
398400                               TO PV-ERROR-NOTIF-NBR              39840002
398500              STRING ' RCVR: '            DELIMITED BY SIZE       39850002
398600                     PV-ERROR-PO-NBR      DELIMITED BY SIZE       39860002
398700                     '-'                  DELIMITED BY SIZE       39870002
398800                     PV-ERROR-REC-SEQ-NBR DELIMITED BY SIZE       39880002
398900                     ' PO LINE NBR: '     DELIMITED BY SIZE       39890002
399000                     PV-ERROR-PO-LNE-NBR  DELIMITED BY SIZE       39900002
399100                     ' NOTIFICATION NBR: ' DELIMITED BY SIZE      39910002
399200                     PV-ERROR-NOTIF-NBR   DELIMITED BY SIZE       39920002
399300                             INTO DP013-MESSAGE-TEXT (2)          39930002
399400              MOVE XL071-SQLCA  TO DP013-SQLCA                    39940002
399500              MOVE 'XLT_LOC ' TO DP013-DB2-TABLE-NAME (1)         39950002
399600              SET DP013-DB2-ABEND                                 39960002
399700                               TO TRUE                            39970002
399800              PERFORM DP013-0000-PROCESS-ABEND                    39980002
399900     END-EVALUATE.                                                39990002
400000                                                                  40000002
400100*----------------------------------------------------------------*40010002
400200*    RETRIEVE VENDOR LONG NAME FROM THE ENTITY NAME TABLE        *40020002
400300*----------------------------------------------------------------*40030002
400400 4350-FETCH-VENDOR-NAME.                                          40040002
400500                                                                  40050002
400600     MOVE ASC-ENT-ID TO DK-ENT-ID.                                40060002
400700                                                                  40070002
400800     EXEC SQL                                                     40080002
400900          SELECT ENT_NAME_DESC                                    40090002
401000            INTO :ENTNME-ENT-NAME-DESC                            40100002
401100            FROM TENTNME                                          40110002
401200           WHERE ENT_ID  = :DK-ENT-ID                             40120002
401300             AND TYPE_CDE = :PC-TYPE-CODE-LONG-NAME               40130002
401400     END-EXEC.                                                    40140002
401500                                                                  40150002
401600     EVALUATE TRUE                                                40160002
401700         WHEN SQLCODE = ZERO                                      40170002
401800              CONTINUE                                            40180002
401900         WHEN SQLCODE = +100                                      40190002
402000              MOVE SPACES  TO ENTNME-ENT-NAME-DESC                40200002
402100         WHEN SQLWARN0 NOT = SPACE                                40210002
402200         WHEN SQLCODE NOT = ZERO                                  40220002
402300              MOVE '4350-FETCH-VENDOR-NAME'                       40230002
402400                               TO DP013-PARAGRAPH                 40240002
402500              MOVE 'FETCH VENDOR SHORT NAME INFORMATION'          40250002
402600                               TO DP013-MESSAGE-TEXT (1)          40260002
402700              MOVE TRBNTF-PO-NBR                                  40270002
402800                               TO PV-ERROR-PO-NBR                 40280002
402900              MOVE TRBNTF-REC-SEQ-NBR                             40290002
403000                               TO PV-ERROR-REC-SEQ-NBR            40300002
403100              MOVE TRBNTF-PO-LNE-NBR                              40310002
403200                               TO PV-ERROR-PO-LNE-NBR             40320002
403300              MOVE TRBNTF-NOTIF-NBR                               40330002
403400                               TO PV-ERROR-NOTIF-NBR              40340002
403500              STRING ' RCVR: '            DELIMITED BY SIZE       40350002
403600                     PV-ERROR-PO-NBR      DELIMITED BY SIZE       40360002
403700                     '-'                  DELIMITED BY SIZE       40370002
403800                     PV-ERROR-REC-SEQ-NBR DELIMITED BY SIZE       40380002
403900                     ' PO LINE NBR: '     DELIMITED BY SIZE       40390002
404000                     PV-ERROR-PO-LNE-NBR  DELIMITED BY SIZE       40400002
404100                     ' NOTIFICATION NBR: ' DELIMITED BY SIZE      40410002
404200                     PV-ERROR-NOTIF-NBR   DELIMITED BY SIZE       40420002
404300                             INTO DP013-MESSAGE-TEXT (2)          40430002
404400              MOVE SQLCA   TO DP013-SQLCA                         40440002
404500              MOVE 'TENTNME ' TO DP013-DB2-TABLE-NAME (1)         40450002
404600              SET DP013-DB2-ABEND                                 40460002
404700                               TO TRUE                            40470002
404800              PERFORM DP013-0000-PROCESS-ABEND                    40480002
404900     END-EVALUATE.                                                40490002
405000                                                                  40500002
405100*----------------------------------------------------------------*40510002
405200 4360-GET-RECITM-PREPK-ID.                                        40520002
405300                                                                  40530002
405400     EXEC SQL                                                     40540002
405500         SELECT DISTINCT                                          40550002
405600                A.PREPK_ID                                        40560002
405700           INTO :RECITM-PREPK-ID                                  40570002
405800           FROM TRECITM A                                         40580002
405900              , TRECEIV B                                         40590002
406000          WHERE A.ORD_NBR         = :TRBNTF-PO-NBR                40600002
406100            AND A.REC_SEQ_NBR     = :TRBNTF-REC-SEQ-NBR           40610002
406200            AND A.OPER_UNT_ID     = :TRBNTF-OPER-UNT-ID           40620002
406300            AND A.FCLTY_ID        = :TRBNTF-FCLTY-ID              40630002
406400            AND A.ORD_LNE_NBR     = :TRBNTF-PO-LNE-NBR            40640002
406500                                                                  40650002
406600            AND B.ORD_NBR         = A.ORD_NBR                     40660002
406700            AND B.REC_SEQ_NBR     = A.REC_SEQ_NBR                 40670002
406800            AND B.OPER_UNT_ID     = A.OPER_UNT_ID                 40680002
406900            AND B.FCLTY_ID        = A.FCLTY_ID                    40690002
407000            AND B.PKGNG_CDE      IN ('M', 'I')                    40700002
407100                                                                  40710002
407200            AND A.VER_STATUS_CDE  = 'A'                           40720002
407300            AND B.VER_STATUS_CDE  = 'A'                           40730002
407400     END-EXEC.                                                    40740002
407500                                                                  40750002
407600     EVALUATE TRUE                                                40760002
407700       WHEN SQLCODE = ZERO                                        40770002
407800           CONTINUE                                               40780002
407900                                                                  40790002
408000       WHEN SQLCODE = +100                                        40800002
408100           MOVE ZEROES TO RECITM-PREPK-ID                         40810002
408200                                                                  40820002
408300       WHEN SQLWARN0 NOT = SPACE                                  40830002
408400       WHEN SQLCODE  NOT = ZERO                                   40840002
408500           MOVE '4360-GET-RECITM-PREPK-ID' TO DP013-PARAGRAPH     40850002
408600           MOVE 'GET PREPK ID   '  TO DP013-MESSAGE-TEXT (1)      40860002
408700           MOVE TRBNTF-PO-NBR      TO PV-ERROR-PO-NBR             40870002
408800           MOVE TRBNTF-REC-SEQ-NBR TO PV-ERROR-REC-SEQ-NBR        40880002
408900           MOVE TRBNTF-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID        40890002
409000           STRING ' RCVR: '             DELIMITED BY SIZE         40900002
409100                  PV-ERROR-PO-NBR       DELIMITED BY SIZE         40910002
409200                  '-'                   DELIMITED BY SIZE         40920002
409300                  PV-ERROR-REC-SEQ-NBR  DELIMITED BY SIZE         40930002
409400                  '  OPER-UNT-ID: '     DELIMITED BY SIZE         40940002
409500                  PV-ERROR-OPER-UNT-ID  DELIMITED BY SIZE         40950002
409600             INTO DP013-MESSAGE-TEXT (2)                          40960002
409700           MOVE SQLCA      TO DP013-SQLCA                         40970002
409800           MOVE 'TRECITM ' TO DP013-DB2-TABLE-NAME (1)            40980002
409900           SET DP013-DB2-ABEND TO TRUE                            40990002
410000           PERFORM DP013-0000-PROCESS-ABEND                       41000002
410100     END-EVALUATE.                                                41010002
410200                                                                  41020002
410300*----------------------------------------------------------------*41030002
410400* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *41040002
410500*----------------------------------------------------------------*41050002
410600                                                                  41060002
410700 4400-MOVE-COMMAREA-TO-SCREEN.                                    41070002
410800     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             41080002
410900         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          41090002
411000         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          41100002
411100             MOVE +1    TO ASC-BLK-SUB                            41110002
411200             PERFORM 5100-WRITE-TEMP-STORAGE                      41120002
411300             ADD +1     TO ASC-BLK-SUB                            41130002
411400             PERFORM 5100-WRITE-TEMP-STORAGE                      41140002
411500             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             41150002
411600                 GIVING PV-BLOCK-NUMBER                           41160002
411700                 REMAINDER PV-REMAINDER                           41170002
411800             IF  PV-REMAINDER > ZERO                              41180002
411900                 ADD +1 TO PV-BLOCK-NUMBER                        41190002
412000             END-IF                                               41200002
412100             MOVE +1    TO ASC-BLK-SUB                            41210002
412200             PERFORM 4410-READ-TEMP-STORAGE                       41220002
412300             ADD +1     TO ASC-BLK-SUB                            41230002
412400                           PV-BLOCK-NUMBER                        41240002
412500             PERFORM 4410-READ-TEMP-STORAGE                       41250002
412600     END-IF.                                                      41260002
412700     MOVE +1            TO ASC-BLK-SUB.                           41270002
412800     COMPUTE ASC-ITEM-SUB =                                       41280002
412900         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              41290002
413000         + PC-ITEMS-PER-PANEL).                                   41300002
413100*                                                                 41310002
413200     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        41320002
413300         ADD +1         TO ASC-BLK-SUB                            41330002
413400         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            41340002
413500     END-IF.                                                      41350002
413600*                                                                 41360002
413700     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           41370002
413800         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                41380002
413900     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        41390002
414000     PERFORM 4420-FORMAT-LIST-LINES                               41400002
414100         VARYING PV-SUB                                           41410002
414200         FROM PC-ITEMS-PER-PANEL BY -1                            41420002
414300         UNTIL PV-SUB < +1.                                       41430002
414400*                                                                 41440002
414500     COMPUTE ASC-ITEMS-DISPLAYED =                                41450002
414600         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          41460002
414700                                                                  41470002
414800     MOVE ASC-FCLTY-NAME           TO AFCLYNMO.                   41480002
414900     MOVE ASC-VENDOR-NAME          TO AVNDNMEO.                   41490002
415000                                                                  41500002
415100     STRING ASC-PO-NBR-N               DELIMITED BY SIZE          41510002
415200            PC-DASH                    DELIMITED BY SIZE          41520002
415300            ASC-RCVR-SEQ-NBR-N         DELIMITED BY SIZE          41530002
415400                                 INTO APORCVRO.                   41540002
415500                                                                  41550002
415600     MOVE ASC-DEPT-NBR             TO ADEPTO.                     41560002
415700     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    41570002
415800                                      ASTRTITO.                   41580002
415900     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    41590002
416000     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    41600002
416100     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            41610002
416200                                   TO ASELITO.                    41620002
416300*                                                                 41630002
416400     IF  DP020-MSG-NUMBER-X = SPACE                               41640002
416500         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  41650002
416600*            --- MORE ITEMS TO DISPLAY ----                       41660002
416700             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            41670002
416800             SET DP020-MSG-INFORMATIONAL TO TRUE                  41680002
416900         END-IF                                                   41690002
417000     END-IF.                                                      41700002
417100*----------------------------------------------------------------*41710002
417200*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *41720002
417300*----------------------------------------------------------------*41730002
417400                                                                  41740002
417500 4410-READ-TEMP-STORAGE.                                          41750002
417600                                                                  41760002
417700     EXEC CICS                                                    41770002
417800         READQ TS                                                 41780002
417900             QUEUE (ASC-LIST-QUEUE-NAME)                          41790002
418000             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               41800002
418100             ITEM  (PV-BLOCK-NUMBER)                              41810002
418200             RESP  (PV-CICS-RESP)                                 41820002
418300     END-EXEC.                                                    41830002
418400                                                                  41840002
418500     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       41850002
418600       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     41860002
418700         CONTINUE                                                 41870002
418800     ELSE                                                         41880002
418900         SET DP013-CICS-ABEND     TO TRUE                         41890002
419000         SET DP013-NO-ROLLBACK    TO TRUE                         41900002
419100         MOVE '4410-READ-TEMP-STORAGE'                            41910002
419200                                  TO DP013-PARAGRAPH              41920002
419300         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      41930002
419400                                  TO DP013-MESSAGE-TEXT(1)        41940002
419500         PERFORM DP013-0000-PROCESS-ABEND                         41950002
419600     END-IF.                                                      41960002
419700                                                                  41970002
419800     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             41980002
419900*                                                                 41990002
420000     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         42000002
420100         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               42010002
420200     END-IF.                                                      42020002
420300 EJECT                                                            42030002
420400*----------------------------------------------------------------*42040002
420500*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *42050002
420600*----------------------------------------------------------------*42060002
420700                                                                  42070002
420800 4420-FORMAT-LIST-LINES.                                          42080002
420900     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      42090002
421000         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                42100002
421100         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           42110002
421200         MOVE SPACE              TO MR-SELECTI (PV-SUB)           42120002
421300                                    MR-ACTION (PV-SUB)            42130002
421400                                    MR-PO-LINE (PV-SUB)           42140002
421500                                    MR-PREPK-ID (PV-SUB)          42150002
421600                                    MR-SKU (PV-SUB)               42160002
421700                                    MR-AD-IND (PV-SUB)            42170002
421800                                    MR-TROUBLE-REASON (PV-SUB)    42180002
421900                                    MR-NOTIFICATION-DATE-TIME     42190002
422000                                                          (PV-SUB)42200002
422100                                    MR-RESPONSE-DATE-TIME (PV-SUB)42210002
422200                                    MR-PROC-AREA (PV-SUB)         42220002
422300                                    MR-PROC-LINE (PV-SUB)         42230002
422400     ELSE                                                         42240002
422500         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      42250002
422600                                                   > SPACE        42260002
422700             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 42270002
422800                                 TO MR-SELECTI (PV-SUB)           42280002
422900         ELSE                                                     42290002
423000             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      42300002
423100                                 TO MR-SELECTI (PV-SUB)           42310002
423200         END-IF                                                   42320002
423300*                                                                 42330002
423400         IF  DP030-SET-CURSOR-TRAILER                             42340002
423500             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)42350002
423600                 > SPACE)                                         42360002
423700               OR (PV-SUB = 1))                                   42370002
423800                SET DP030-SET-CURSOR-APPL-1 TO TRUE               42380002
423900                MOVE -1          TO MR-SELECTL (PV-SUB)           42390002
424000             END-IF                                               42400002
424100         END-IF                                                   42410002
424200*                                                                 42420002
424300         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           42430002
424400             MOVE ASC-ACTION            (ASC-BLK-SUB ASC-ITEM-SUB)42440002
424500                                 TO MR-ACTION (PV-SUB)            42450002
424600                                                                  42460002
424700             IF ASC-PREPK-ID (ASC-BLK-SUB ASC-ITEM-SUB) > ZEROES  42470002
424800                 IF ASC-INTER-APPL-PREPACK OR                     42480002
424900                    ASC-INTER-APPL-REC-PREPACK                    42490002
425000                     MOVE ASC-PO-LNE-NBR-N                        42500002
425100                                        (ASC-BLK-SUB ASC-ITEM-SUB)42510002
425200                                 TO MR-PO-LINE-N (PV-SUB)         42520002
425300                 ELSE                                             42530002
425400                     MOVE '0000' TO MR-PO-LINE   (PV-SUB)         42540002
425500                 END-IF                                           42550002
425600             ELSE                                                 42560002
425700                 MOVE ASC-PO-LNE-NBR-N  (ASC-BLK-SUB ASC-ITEM-SUB)42570002
425800                                 TO MR-PO-LINE-N (PV-SUB)         42580002
425900             END-IF                                               42590002
426000                                                                  42600002
426100             MOVE ASC-PREPK-ID          (ASC-BLK-SUB ASC-ITEM-SUB)42610002
426200                                 TO MR-PREPK-ID-N (PV-SUB)        42620002
426300             MOVE ASC-SKU               (ASC-BLK-SUB ASC-ITEM-SUB)42630002
426400                                 TO MR-SKU      (PV-SUB)          42640002
426500             MOVE ASC-AD-IND            (ASC-BLK-SUB ASC-ITEM-SUB)42650002
426600                                 TO MR-AD-IND (PV-SUB)            42660002
426700                                                                  42670002
426800             IF  ASC-AD-IND (ASC-BLK-SUB ASC-ITEM-SUB) = PC-P     42680002
426900                 MOVE DP015-YELLOW                                42690002
427000                                 TO MR-AD-INDC            (PV-SUB)42700002
427100             ELSE                                                 42710002
427200                 MOVE DP015-BLUE TO MR-AD-INDC            (PV-SUB)42720002
427300             END-IF                                               42730002
427400                                                                  42740002
427500             MOVE ASC-TROUBLE-REASON-DESC                         42750002
427600                                        (ASC-BLK-SUB ASC-ITEM-SUB)42760002
427700                                 TO MR-TROUBLE-REASON (PV-SUB)    42770002
427800                                                                  42780002
427900             IF  ASC-TRBL-DTL-EXISTS (ASC-BLK-SUB ASC-ITEM-SUB)   42790002
428000                 MOVE DP015-YELLOW                                42800002
428100                                 TO MR-TROUBLE-REASONC (PV-SUB)   42810002
428200             ELSE                                                 42820002
428300                 MOVE DP015-BLUE                                  42830002
428400                                 TO MR-TROUBLE-REASONC (PV-SUB)   42840002
428500             END-IF                                               42850002
428600                                                                  42860002
428700             MOVE ASC-NOTIFICATION-DATE-TIME                      42870002
428800                                        (ASC-BLK-SUB ASC-ITEM-SUB)42880002
428900                                 TO MR-NOTIFICATION-DATE-TIME     42890002
429000                                                          (PV-SUB)42900002
429100             MOVE ASC-RESPONSE-DATE-TIME                          42910002
429200                                        (ASC-BLK-SUB ASC-ITEM-SUB)42920002
429300                                 TO MR-RESPONSE-DATE-TIME (PV-SUB)42930002
429400                                                                  42940002
429500             IF  ASC-TRBL-RESOLVED (ASC-BLK-SUB ASC-ITEM-SUB)     42950002
429600                 MOVE DP015-YELLOW                                42960002
429700                              TO MR-RESPONSE-DATE-TIMEC (PV-SUB)  42970002
429800                 IF ASC-ALL-NOTIF-STATS AND                       42980002
429900                     ASC-TRBL-ACK (ASC-BLK-SUB ASC-ITEM-SUB)      42990002
430000                     MOVE DP015-YELLOW                            43000002
430100                            TO MR-PO-LINEC (PV-SUB)               43010002
430200                               MR-PREPK-IDC (PV-SUB)              43020002
430300                               MR-SKUC (PV-SUB)                   43030002
430400                               MR-AD-INDC (PV-SUB)                43040002
430500                               MR-TROUBLE-REASONC (PV-SUB)        43050002
430600                               MR-NOTIFICATION-DATE-TIMEC (PV-SUB)43060002
430700                               MR-RESPONSE-DATE-TIMEC (PV-SUB)    43070002
430800                 END-IF                                           43080002
430900             ELSE                                                 43090002
431000                 MOVE DP015-BLUE TO MR-RESPONSE-DATE-TIMEC        43100002
431100                                                          (PV-SUB)43110002
431200             END-IF                                               43120002
431300                                                                  43130002
431400                                                                  43140002
431500             MOVE ASC-PROC-AREA    (ASC-BLK-SUB ASC-ITEM-SUB)     43150002
431600                                 TO MR-PROC-AREA (PV-SUB)         43160002
431700             MOVE ASC-PROC-LINE    (ASC-BLK-SUB ASC-ITEM-SUB)     43170002
431800                                 TO MR-PROC-LINE (PV-SUB)         43180002
431900         END-IF                                                   43190002
432000     END-IF.                                                      43200002
432100                                                                  43210002
432200     SUBTRACT +1 FROM ASC-ITEM-SUB                                43220002
432300     IF  ASC-ITEM-SUB < + 1                                       43230002
432400         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  43240002
432500         MOVE +1                 TO ASC-BLK-SUB                   43250002
432600     END-IF.                                                      43260002
432700******************************************************************43270002
432800** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **43280002
432900** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **43290002
433000** ISSUE A WARNING.                                             **43300002
433100******************************************************************43310002
433200 4430-CHECK-FOR-BEGIN-AND-END.                                    43320002
433300     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       43330002
433400         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     43340002
433500*            -- NO END-OF-RANGE SPECFIED ---                      43350002
433600             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            43360002
433700             SET DP020-MSG-WARNING TO TRUE                        43370002
433800             PERFORM 4431-POSITION-AT-WARNING                     43380002
433900         END-IF                                                   43390002
434000     ELSE                                                         43400002
434100         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     43410002
434200*            -- NO BEGINNING-OF-RANGE SPECFIED ---                43420002
434300             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            43430002
434400             SET DP020-MSG-WARNING TO TRUE                        43440002
434500             PERFORM 4431-POSITION-AT-WARNING                     43450002
434600         END-IF                                                   43460002
434700     END-IF.                                                      43470002
434800******************************************************************43480002
434900** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **43490002
435000** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **43500002
435100** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **43510002
435200** POSITION THE CURSOR THERE.                                   **43520002
435300******************************************************************43530002
435400 4431-POSITION-AT-WARNING.                                        43540002
435500     COMPUTE PV-SUB-COMP3 = ASC-START-OF-SELECTED-RANGE           43550002
435600                    - PV-TOP-ITEM + 1.                            43560002
435700     MOVE PV-SUB-COMP3 TO PV-SUB.                                 43570002
435800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      43580002
435900         CONTINUE                                                 43590002
436000     ELSE                                                         43600002
436100         SET DP030-SET-CURSOR-APPL-1                              43610002
436200                                   TO TRUE                        43620002
436300         MOVE -1                   TO MR-SELECTL (PV-SUB)         43630002
436400         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         43640002
436500         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         43650002
436600     END-IF.                                                      43660002
436700*                                                                 43670002
436800     COMPUTE PV-SUB-COMP3 = ASC-END-OF-SELECTED-RANGE             43680002
436900                    - PV-TOP-ITEM + 1.                            43690002
437000     MOVE PV-SUB-COMP3 TO PV-SUB.                                 43700002
437100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      43710002
437200         CONTINUE                                                 43720002
437300     ELSE                                                         43730002
437400         SET DP030-SET-CURSOR-APPL-1                              43740002
437500                                   TO TRUE                        43750002
437600         MOVE -1                   TO MR-SELECTL (PV-SUB)         43760002
437700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         43770002
437800         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         43780002
437900     END-IF.                                                      43790002
438000 EJECT                                                            43800002
438100*----------------------------------------------------------------*43810002
438200* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *43820002
438300* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *43830002
438400* FOR THE SELECTED ITEMS QUEUE.                                  *43840002
438500*                                                                *43850002
438600* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *43860002
438700* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *43870002
438800* THE ARRAY IS FULL.                                             *43880002
438900*----------------------------------------------------------------*43890002
439000                                                                  43900002
439100 5000-PREPARE-SEL-QUEUE.                                          43910002
439200                                                                  43920002
439300     MOVE +1                   TO  ASC-BLK-SUB.                   43930002
439400     PERFORM 5100-WRITE-TEMP-STORAGE.                             43940002
439500     ADD +1                    TO  ASC-BLK-SUB.                   43950002
439600     PERFORM 5100-WRITE-TEMP-STORAGE.                             43960002
439700                                                                  43970002
439800     MOVE ASC-SEL-QUEUE-NAME-OUT TO  TM001-SEL-QUEUE-NAME.        43980002
439900     PERFORM 6010-DELETE-SEL-QUEUE.                               43990002
440000                                                                  44000002
440100     SET ASC-UPDATE-TSQ          TO  TRUE.                        44010002
440200                                                                  44020002
440300     SET TM002-IDX               TO  1.                           44030002
440400     MOVE ZERO                   TO TM001-NUMBER-OF-TS-ITEMS.     44040002
440500     INITIALIZE TM002-SELECTED-ITEM-ARRAY.                        44050002
440600                                                                  44060002
440700     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           44070002
440800             VARYING PV-ITEM                                      44080002
440900             FROM 1 BY 1                                          44090002
441000             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     44100002
441100                                                                  44110002
441200     IF  TM002-IDX > 1                                            44120002
441300         PERFORM 5205-WRITE-SEL-QUEUE                             44130002
441400         ADD +1                  TO TM001-NUMBER-OF-TS-ITEMS      44140002
441500     END-IF.                                                      44150002
441600 EJECT                                                            44160002
441700*----------------------------------------------------------------*44170002
441800* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *44180002
441900* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *44190002
442000* FOR THE SELECTED ITEMS QUEUE.                                  *44200002
442100*                                                                *44210002
442200* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *44220002
442300* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *44230002
442400* THE ARRAY IS FULL.                                             *44240002
442500*----------------------------------------------------------------*44250002
442600 5025-PREPARE-SEL-QUEUE-FOR-PO.                                   44260002
442700                                                                  44270002
442800     MOVE +1  TO  ASC-BLK-SUB.                                    44280002
442900     PERFORM 5100-WRITE-TEMP-STORAGE.                             44290002
443000     ADD +1   TO  ASC-BLK-SUB.                                    44300002
443100     PERFORM 5100-WRITE-TEMP-STORAGE.                             44310002
443200                                                                  44320002
443300     MOVE ASC-SEL-QUEUE-NAME-OUT TO PO013-SEL-QUEUE-NAME.         44330002
443400     PERFORM 6010-DELETE-SEL-QUEUE.                               44340002
443500                                                                  44350002
443600     SET ASC-UPDATE-TSQ TO TRUE.                                  44360002
443700                                                                  44370002
443800     SET PO012-IDX TO 1.                                          44380002
443900     MOVE ZEROES   TO PO013-NUMBER-OF-TS-ITEMS.                   44390002
444000     INITIALIZE PO012-SELECTED-ITEM-ARRAY.                        44400002
444100                                                                  44410002
444200     PERFORM 5250-FILL-SEL-QUEUE-REC-FOR-PO                       44420002
444300       VARYING PV-ITEM FROM 1 BY 1                                44430002
444400         UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.         44440002
444500                                                                  44450002
444600     IF PO012-IDX > 1                                             44460002
444700       AND PS-NO-ERROR                                            44470002
444800         PERFORM 5265-WRITE-PO-SEL-QUEUE                          44480002
444900         ADD +1 TO PO013-NUMBER-OF-TS-ITEMS                       44490002
445000     END-IF.                                                      44500002
445100                                                                  44510002
445200*----------------------------------------------------------------*44520002
445300* PREPARE THE COMMAREA FOR THE FOR THE TROUBLE CENTRAL           *44530002
445400* PROCESSING ROUTINE (TMKCS520). MOVE ALL SELECTED ITEMS FROM    *44540002
445500* THE LIST TEMP STORAGE QUEUE TO THE LAYOUT FOR THE COMMAREA     *44550002
445600* USED BY THE TROUBLE CENTRAL PROCESSING ROUTINE.                *44560002
445700*----------------------------------------------------------------*44570002
445800 5050-PREPARE-TO-PROCESS-TRBL.                                    44580002
445900                                                                  44590002
446000     MOVE +1                   TO  ASC-BLK-SUB.                   44600002
446100     PERFORM 5100-WRITE-TEMP-STORAGE.                             44610002
446200     ADD +1                    TO  ASC-BLK-SUB.                   44620002
446300     PERFORM 5100-WRITE-TEMP-STORAGE.                             44630002
446400                                                                  44640002
446500     PERFORM 5300-PROCESS-TROUBLE-UPDATE                          44650002
446600             VARYING PV-ITEM                                      44660002
446700             FROM 1 BY 1                                          44670002
446800             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN      44680002
446900             OR PS-ERROR.                                         44690002
447000/                                                                 44700002
447100*----------------------------------------------------------------*44710002
447200* CHECK TO SEE IF THE TROUBLE THAT WAS JUST RESOLVED IS           44720002
447300* TO BE AUTO ACKNOWLEDGED IF THE CONDITIONS THAT CAUSED THE       44730002
447400* TROUBLE IS TRULY STATISFIED.  THIS MAY INVOLVE ALSO             44740002
447500* AUTOMATICALLY RE-DISTRO'ING THE ENTIRE RECEIVER IF THE          44750002
447600* TROUBLE CALLS FOR THAT.                                         44760002
447700*                                                                 44770002
447710*   WILL CALL MODULE TMKCS550 (WHICH IS BOTH BATCH AND CICS       44771002
447720*   DEFINED.                                                      44772002
447730* AS OF 1/10/05, THIS WOULD BE TROUBLE 222 - NO DISTRO            44773002
447740*----------------------------------------------------------------*44774002
447750 5070-CHECK-AUTO-ACKNOW.                                          44775002
447760*    CHECK TO SEE IF THE TROUBLE IS ELIGIABLE FOR AUTO ACKNOWLEDGE44776002
447770*    PROCESS.                                                     44777002
447780                                                                  44778002
447790     MOVE ASC-PO-NBR-N                TO TM500-PO-NBR.            44779002
447791     MOVE ASC-RCVR-SEQ-NBR-N          TO TM500-REC-SEQ-NBR.       44779102
447792     MOVE ASC-OPER-UNT-ID             TO TM500-OPER-UNT-ID.       44779202
447793     MOVE DK-TRBL-RSN-CDE             TO TM500-TRBL-RSN-CDE.      44779302
447794     MOVE ASC-FCLTY-ID                TO TM500-FCLTY-ID.          44779402
447795     MOVE DP020-USERID                TO TM500-RESOLVED-UID.      44779502
447796                                                                  44779602
447797     PERFORM  5700-LINK-TO-AUTO-ACKN.                             44779702
447798                                                                  44779802
447799     EVALUATE TRUE                                                44779902
447800         WHEN TM500-CALL-SUCCESSFUL                               44780002
447810         WHEN TM500-DUPLICATE-TROUBLE                             44781002
447820         WHEN TM500-TTRBNTF-UPDATE-NOT-FND                        44782002
447830         WHEN TM500-TPURCHS-SELECT-NOT-FND                        44783002
447840         WHEN TM500-DIDNT-ALLOC-DUE-TO-TRBL                       44784002
447850              CONTINUE                                            44785002
447860         WHEN TM500-RECORD-IN-PROCESS                             44786002
447870              MOVE PC-RECORD-IN-PROC-MSG                          44787002
447880                                TO DP020-MSG-MESSAGE              44788002
447890              SET PS-ERROR      TO  TRUE                          44789002
447900         WHEN TM500-RECORD-RESOLVED                               44790002
448000              MOVE PC-RECORD-RESOLVED-MSG                         44800002
448001                                TO  DP020-MSG-MESSAGE             44800102
448002              SET PS-ERROR      TO  TRUE                          44800202
448003         WHEN TM500-RECORD-ACKNOWLEDGED                           44800302
448004************* MOVE PC-RECORD-ACKNOWLEDGED-MSG                     44800402
448005*************                   TO  DP020-MSG-MESSAGE             44800502
448006              MOVE PC-TSYMSG-01839 TO DP020-MSG-NUMBER            44800602
448007              SET PS-ERROR      TO  TRUE                          44800702
448008         WHEN TM500-RECORD-NOT-RESOLVED                           44800802
448009              MOVE PC-TSYMSG-01037                                44800902
448010                                TO  DP020-MSG-MESSAGE             44801002
448011              SET PS-ERROR      TO  TRUE                          44801102
448012         WHEN TM500-IN-PROC-UPDATE-NOT-FND                        44801202
448013              MOVE PC-TSYMSG-00938                                44801302
448014                                TO DP020-MSG-NUMBER               44801402
448015              SET PS-ERROR      TO  TRUE                          44801502
448016         WHEN TM500-RESPOND-UPDATE-NOT-FND                        44801602
448017              MOVE PC-RESPOND-TRBL-REC-NOT-FOUND                  44801702
448018                                TO  DP020-MSG-MESSAGE             44801802
448019              SET PS-ERROR      TO  TRUE                          44801902
448020         WHEN TM500-ACKNWLG-UPDATE-NOT-FND                        44802002
448021              MOVE PC-ACKNWLG-TRBL-REC-NOT-FOUND                  44802102
448022                                TO  DP020-MSG-MESSAGE             44802202
448023              SET PS-ERROR      TO  TRUE                          44802302
448024         WHEN OTHER                                               44802402
448025              PERFORM 5071-DETERMINE-AUTO-ACK-MSG                 44802502
448026     END-EVALUATE.                                                44802602
448027                                                                  44802702
448028*----------------------------------------------------------------*44802802
448029* DETERMINE WHAT MESSAGE TO DISPLAY TO THE USER ON-LINE           44802902
448030*----------------------------------------------------------------*44803002
448040 5071-DETERMINE-AUTO-ACK-MSG.                                     44804002
448050                                                                  44805002
448060      IF TM500-AUTO-ACKNOW-ALRDY-DONE  OR                         44806002
448070         TM500-IN-PROC-UPDATE-NOT-FND  OR                         44807002
448080         TM500-RESPOND-UPDATE-NOT-FND  OR                         44808002
448090         TM500-ACKNWLG-UPDATE-NOT-FND  OR                         44809002
448100         TM500-RESOLVE-UPDATE-NOT-FND                             44810002
448110*MESSAGE 00938 ALREADY RESOLVED                                   44811002
448120           MOVE PC-TSYMSG-00938    TO DP020-MSG-NUMBER            44812002
448121           SET PS-ERROR            TO TRUE                        44812102
448122      ELSE                                                        44812202
448123      IF TM500-AUTO-ACKNOW-DONE                                   44812302
448124* TROUBLE WAS AUTOMATICALLY ACKNOWLEDGED                          44812402
448125*         FUTURE USE BECAUSE THIS DOESN'T INCLUDE RE-DISTRO'ING   44812502
448126         MOVE PC-TSYMSG-03366      TO DP020-MSG-NUMBER            44812602
448127           SET PS-ERROR            TO TRUE                        44812702
448128      ELSE                                                        44812802
448129        IF TM500-ACK-REDISTRO-DONE                                44812902
448130*MESSAGE 3364 TROUBLE WAS AUTO ACKNOWLEDGED AND REDISTRO WAS      44813002
448140* DONE                                                            44814002
448141           MOVE PC-TSYMSG-03364    TO DP020-MSG-NUMBER            44814102
448142           SET PS-ERROR            TO TRUE                        44814202
448143        ELSE                                                      44814302
448144           IF TM500-AUTO-ACKNOW-FAILED OR                         44814402
448145              TM500-AUTO-REDISTRO-FAILED                          44814502
448146*TROUBLE NOT AUTO ACKNOWLEDGED DUE TO PRORATION TROUBLE FOUND     44814602
448147              MOVE PC-TSYMSG-03365 TO DP020-MSG-NUMBER            44814702
448148              SET PS-ERROR         TO TRUE                        44814802
448149           ELSE                                                   44814902
448150           IF TM500-AUTO-ACKNOW-NOT-FOUND                         44815002
448160*TROUBLE NOT AUTO ACKNOWLEDGED DUE TO NO ALLOCATION               44816002
448161              MOVE PC-TSYMSG-03385 TO DP020-MSG-NUMBER            44816102
448162              SET PS-ERROR         TO TRUE                        44816202
448163           ELSE                                                   44816302
448164*TROUBLE NOT AUTO ACKNOWLEDGED DUE TO CASEPACK SPLIT              44816402
448165*  OR SMOOTHING                                                   44816502
448166*             IF TM500-CASEPACK-SPLIT-FOUND                       44816602
448167*                 MOVE PC-TSYMSG-03393 TO DP020-MSG-NUMBER        44816702
448168*                 SET PS-ERROR         TO TRUE                    44816802
448169*             ELSE                                                44816902
448170*FORMAT ERROR                                                     44817002
448171              STRING 'NNNNN-E-'             DELIMITED BY SIZE     44817102
448172                     TM500-RETURN-MSG       DELIMITED BY SIZE     44817202
448173                     '-'                    DELIMITED BY SIZE     44817302
448174                     TM500-RETURN-CODE      DELIMITED BY SIZE     44817402
448175                     ' SQLCODE='            DELIMITED BY SIZE     44817502
448176                     TM500-SQLCODE          DELIMITED BY SIZE     44817602
448177                              INTO  DP020-MSG-MESSAGE             44817702
448178              SET PS-ERROR      TO  TRUE                          44817802
448179     END-IF.                                                      44817902
448180                                                                  44818002
448181/                                                                 44818102
448182*----------------------------------------------------------------*44818202
448183*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *44818302
448184*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *44818402
448185*----------------------------------------------------------------*44818502
448186                                                                  44818602
448187 5100-WRITE-TEMP-STORAGE.                                         44818702
448188     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     44818802
448189                                   TO PV-LIST-ITEM-NUMBER.        44818902
448190     COMPUTE PV-BLOCK-NUMBER =                                    44819002
448200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    44820002
448300                                                                  44830002
448400     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             44840002
448500     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             44850002
448600         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      44860002
448700             PERFORM 5105-REWRITE-ASC-LISTQ                       44870002
448800         END-IF                                                   44880002
448900     ELSE                                                         44890002
449000         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       44900002
449100         ASC-HIGHEST-BLOCK-WRITTEN + 1                            44910002
449200         PERFORM 5110-WRITE-ASC-LISTQ                             44920002
449300         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   44930002
449400     END-IF.                                                      44940002
449500                                                                  44950002
449600     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             44960002
449700******************************************************************44970002
449800** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **44980002
449900** SPECIFIC COMMAREA.                                           **44990002
450000******************************************************************45000002
450100 5105-REWRITE-ASC-LISTQ.                                          45010002
450200     EXEC CICS                                                    45020002
450300         WRITEQ TS                                                45030002
450400             QUEUE (ASC-LIST-QUEUE-NAME)                          45040002
450500             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               45050002
450600             ITEM  (PV-BLOCK-NUMBER)                              45060002
450700             REWRITE                                              45070002
450800             RESP  (PV-CICS-RESP)                                 45080002
450900     END-EXEC.                                                    45090002
451000                                                                  45100002
451100     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           45110002
451200         CONTINUE                                                 45120002
451300     ELSE                                                         45130002
451400         SET DP013-CICS-ABEND            TO TRUE                  45140002
451500         SET DP013-NO-ROLLBACK           TO TRUE                  45150002
451600         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       45160002
451700         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     45170002
451800                                         TO DP013-MESSAGE-TEXT(1) 45180002
451900         PERFORM DP013-0000-PROCESS-ABEND                         45190002
452000     END-IF.                                                      45200002
452100                                                                  45210002
452200******************************************************************45220002
452300** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **45230002
452400** SPECIFIC COMMAREA.                                           **45240002
452500******************************************************************45250002
452600 5110-WRITE-ASC-LISTQ.                                            45260002
452700     EXEC CICS                                                    45270002
452800         WRITEQ TS                                                45280002
452900             QUEUE (ASC-LIST-QUEUE-NAME)                          45290002
453000             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               45300002
453100             ITEM  (PV-BLOCK-NUMBER)                              45310002
453200             RESP  (PV-CICS-RESP)                                 45320002
453300     END-EXEC.                                                    45330002
453400     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      45340002
453500         SET DP013-CICS-ABEND      TO TRUE                        45350002
453600         SET DP013-NO-ROLLBACK     TO TRUE                        45360002
453700         MOVE '5110-WRITE-ASC-LISTQ'                              45370002
453800                                   TO DP013-PARAGRAPH             45380002
453900         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           45390002
454000                                   TO DP013-MESSAGE-TEXT(1)       45400002
454100         PERFORM DP013-0000-PROCESS-ABEND                         45410002
454200     END-IF.                                                      45420002
454300 EJECT                                                            45430002
454400*----------------------------------------------------------------*45440002
454500* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *45450002
454600* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *45460002
454700*----------------------------------------------------------------*45470002
454800                                                                  45480002
454900 5200-FILL-SEL-QUEUE-RECORD.                                      45490002
455000                                                                  45500002
455100     PERFORM 6112-READ-LIST-QUEUE.                                45510002
455200                                                                  45520002
455300     SET ASC-STAYING-WITHIN-TROUBLE TO TRUE.                      45530002
455400                                                                  45540002
455500     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        45550002
455600         PERFORM VARYING LQW-IDX FROM 1 BY 1                      45560002
455700           UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL          45570002
455800              OR LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO        45580002
455900                                                                  45590002
456000             IF LQW-SELECT (LQW-IDX)                              45600002
456100                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              45610002
456200                                   TO TM002-ITEM (TM002-IDX)      45620002
456300                 MOVE LQW-NOTIF-NBR (LQW-IDX)                     45630002
456400                                   TO TM002-NOTIF-NBR             45640002
456500                                        (TM002-IDX)               45650002
456600                 MOVE ASC-OPER-UNT-ID                             45660002
456700                                   TO  TM002-OPER-UNT-ID          45670002
456800                                        (TM002-IDX)               45680002
456900                 MOVE ASC-FCLTY-ID TO  TM002-FCLTY-ID             45690002
457000                                        (TM002-IDX)               45700002
457100                 MOVE ASC-PO-NBR-N TO  TM002-PO-NBR               45710002
457200                                        (TM002-IDX)               45720002
457300                 MOVE ASC-RCVR-SEQ-NBR-N                          45730002
457400                                   TO  TM002-RCVR-SEQ             45740002
457500                                        (TM002-IDX)               45750002
457600                 MOVE LQW-PO-LNE-NBR (LQW-IDX)                    45760002
457700                                   TO TM002-PO-LNE-NBR            45770002
457800                                        (TM002-IDX)               45780002
457900                 MOVE LQW-PREPK-ID (LQW-IDX)                      45790002
458000                                   TO TM002-PREPK-ID              45800002
458100                                        (TM002-IDX)               45810002
458200                 MOVE LQW-TROUBLE-REASON-CDE (LQW-IDX)            45820002
458300                                   TO  TM002-TRBL-RSN-CDE         45830002
458400                                        (TM002-IDX)               45840002
458500                 MOVE LQW-TROUBLE-REASON-LVL (LQW-IDX)            45850002
458600                                   TO  TM002-TRBL-LVL-IND         45860002
458700                                        (TM002-IDX)               45870002
458800                 MOVE SPACE        TO TM002-ACTION-SW (TM002-IDX) 45880002
458900                 SET TM002-IDX UP BY 1                            45890002
459000                 IF  TM002-IDX > TM002-MAX-ITEMS                  45900002
459100                     PERFORM 5205-WRITE-SEL-QUEUE                 45910002
459200                     ADD +1        TO TM001-NUMBER-OF-TS-ITEMS    45920002
459300                     INITIALIZE TM002-SELECTED-ITEM-ARRAY         45930002
459400                     SET TM002-IDX TO  1                          45940002
459500                 END-IF                                           45950002
459600             END-IF                                               45960002
459700         END-PERFORM                                              45970002
459800     END-IF.                                                      45980002
459900                                                                  45990002
460000*----------------------------------------------------------------*46000002
460100*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *46010002
460200*----------------------------------------------------------------*46020002
460300 5205-WRITE-SEL-QUEUE.                                            46030002
460400                                                                  46040002
460500     MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO TM002-SELECTED-ITEMS.   46050002
460600                                                                  46060002
460700     EXEC CICS                                                    46070002
460800          WRITEQ TS                                               46080002
460900              QUEUE (ASC-SEL-QUEUE-NAME-OUT)                      46090002
461000              FROM  (TM002-MESSAGE-SEL-REC)                       46100002
461100              ITEM  (PV-SEL-QUEUE-ITEM)                           46110002
461200              RESP  (PV-CICS-RESP)                                46120002
461300     END-EXEC.                                                    46130002
461400                                                                  46140002
461500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          46150002
461600         CONTINUE                                                 46160002
461700     ELSE                                                         46170002
461800         SET DP013-CICS-ABEND      TO TRUE                        46180002
461900         SET DP013-NO-ROLLBACK     TO TRUE                        46190002
462000         MOVE '5205-WRITE-SEL-QUEUE'                              46200002
462100                                   TO DP013-PARAGRAPH             46210002
462200         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          46220002
462300                                   TO DP013-MESSAGE-TEXT(1)       46230002
462400         PERFORM DP013-0000-PROCESS-ABEND                         46240002
462500     END-IF.                                                      46250002
462600 EJECT                                                            46260002
462700*----------------------------------------------------------------*46270002
462800* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *46280002
462900* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *46290002
463000*----------------------------------------------------------------*46300002
463100 5250-FILL-SEL-QUEUE-REC-FOR-PO.                                  46310002
463200                                                                  46320002
463300     PERFORM 6112-READ-LIST-QUEUE.                                46330002
463400                                                                  46340002
463500     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        46350002
463600                                                                  46360002
463700         PERFORM                                                  46370002
463800           VARYING LQW-IDX FROM 1 BY 1                            46380002
463900             UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL        46390002
464000                OR LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO      46400002
464100                OR PS-ERROR                                       46410002
464200                                                                  46420002
464300             IF PS-FIRST-TIME                                     46430002
464400                 SET PS-NOT-FIRST-TIME TO TRUE                    46440002
464500**               MOVE LQW-PO-NBR (LQW-IDX)                        46450002
464600**                              TO  PV-PREV-PO-NBR                46460002
464700**               MOVE LQW-DEPT   (LQW-IDX)                        46470002
464800**                              TO  PV-PREV-DEPT-NBR              46480002
464900             END-IF                                               46490002
465000                                                                  46500002
465100             IF LQW-SELECT (LQW-IDX)                              46510002
465200                 SET ASC-GOING-TO-PO TO TRUE                      46520002
465300                 PERFORM 5255-FETCH-TPURCHS-INFO                  46530002
465400                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              46540002
465500                                   TO  PO012-ITEM(PO012-IDX)      46550002
465600                 MOVE PURCHS-DEPT-NBR                             46560002
465700                                   TO  PO013-DEPT-NBR             46570002
465800                 MOVE PURCHS-STATUS-CDE                           46580002
465900                                   TO  PO012-STATUS (PO012-IDX)   46590002
466000                 MOVE PURCHS-PO-TYP-CDE                           46600002
466100                                   TO  PO012-PO-TYPE (PO012-IDX)  46610002
466200                 MOVE ASC-ENT-ID                                  46620002
466300                                   TO  PO013-ENT-ID               46630002
466400                 PERFORM 5260-FETCH-VENDOR-LONG-NAME              46640002
466500                 MOVE ENTNME-ENT-NAME-DESC                        46650002
466600                                   TO  PO012-VENDOR-NAME          46660002
466700                                                    (PO012-IDX)   46670002
466800                 MOVE ASC-PO-NBR-N TO  PO012-PO-NBR (PO012-IDX)   46680002
466900                                       PO013-PO-NBR               46690002
467000                                       DK-PO-NBR                  46700002
467100                 MOVE LQW-PO-LNE-NBR (LQW-IDX)                    46710002
467200                                   TO  DK-PO-LNE-NBR              46720002
467300                                                                  46730002
467400                 PERFORM 5270-FETCH-PO-LNE-NBR                    46740002
467500                                                                  46750002
467600                 MOVE PURITM-PO-LNE-NBR                           46760002
467700                             TO PO012-PO-LNE-NBR (PO012-IDX)      46770002
467800                                PO012-APP-PO-LNE-NBR (PO012-IDX)  46780002
467900                 MOVE SPACE        TO  PO012-ACTION-SW (PO012-IDX)46790002
468000                 SET PO012-IDX UP BY 1                            46800002
468100                 IF  PO012-IDX > PO012-MAX-ITEMS                  46810002
468200                     PERFORM 5265-WRITE-PO-SEL-QUEUE              46820002
468300                     ADD +1        TO PO013-NUMBER-OF-TS-ITEMS    46830002
468400                     INITIALIZE PO012-SELECTED-ITEM-ARRAY         46840002
468500                     SET PO012-IDX TO  1                          46850002
468600                 END-IF                                           46860002
468700             END-IF                                               46870002
468800         END-PERFORM                                              46880002
468900     END-IF.                                                      46890002
469000                                                                  46900002
469100*----------------------------------------------------------------*46910002
469200*    RETRIEVE THE PURCHASE ORDER HEADER INFORMATION FOR THE      *46920002
469300*    PO ASSOCIATED WITH THE TROUBLE NOTIFICATION RECORD.         *46930002
469400*----------------------------------------------------------------*46940002
469500                                                                  46950002
469600 5255-FETCH-TPURCHS-INFO.                                         46960002
469700                                                                  46970002
469800     MOVE ASC-PO-NBR-N          TO TRBNTF-PO-NBR.                 46980002
469900                                                                  46990002
470000                                                                  47000002
470100     EXEC SQL                                                     47010002
470200          SELECT PO_TYP_CDE                                       47020002
470300                 ,DIR_STR_IND                                     47030002
470400                 ,STATUS_CDE                                      47040002
470500                 ,DEPT_NBR                                        47050002
470600            INTO :PURCHS-PO-TYP-CDE                               47060002
470700                 ,:PURCHS-DIR-STR-IND                             47070002
470800                 ,:PURCHS-STATUS-CDE                              47080002
470900                 ,:PURCHS-DEPT-NBR                                47090002
471000            FROM TPURCHS                                          47100002
471100           WHERE PO_NBR       = :TRBNTF-PO-NBR                    47110002
471200             AND VER_STATUS_CDE = :PC-ACTIVE-STATUS               47120002
471300     END-EXEC.                                                    47130002
471400                                                                  47140002
471500     EVALUATE TRUE                                                47150002
471600         WHEN SQLCODE = ZERO                                      47160002
471700              CONTINUE                                            47170002
471800         WHEN SQLCODE = +100                                      47180002
471900              MOVE SPACES  TO PURCHS-PO-TYP-CDE                   47190002
472000                                  PURCHS-DIR-STR-IND              47200002
472100                                  PURCHS-STATUS-CDE               47210002
472200                                  PURCHS-DEPT-NBR                 47220002
472300         WHEN SQLWARN0 NOT = SPACE                                47230002
472400         WHEN SQLCODE NOT = ZERO                                  47240002
472500              MOVE '5255-FETCH-TPURCHS-INFO'                      47250002
472600                               TO DP013-PARAGRAPH                 47260002
472700              MOVE 'FETCH PURCHASE ORDER INFORMATION'             47270002
472800                               TO DP013-MESSAGE-TEXT (1)          47280002
472900              MOVE 'FOR THE FOLLOWING PO:           '             47290002
473000                               TO DP013-MESSAGE-TEXT (2)          47300002
473100              MOVE TRBNTF-PO-NBR                                  47310002
473200                               TO DP013-MESSAGE-TEXT (3)          47320002
473300              MOVE SQLCA   TO DP013-SQLCA                         47330002
473400              MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (1)         47340002
473500              SET DP013-DB2-ABEND                                 47350002
473600                               TO TRUE                            47360002
473700              PERFORM DP013-0000-PROCESS-ABEND                    47370002
473800     END-EVALUATE.                                                47380002
473900                                                                  47390002
474000 EJECT                                                            47400002
474100*----------------------------------------------------------------*47410002
474200*    RETRIEVE THE FULL VENDOR NAME THAT IS ASSOCIATED WITH THE   *47420002
474300*    TROUBLE NOTIFICATION RECORD.  THIS INFORMATION WILL BE USED *47430002
474400*    WHEN PERFORMING EITHER A PO INQUIRY LOOKUP OR PO UPDATE FOR *47440002
474500*    THIS SPECIFIC TROUBLE NOTIFICATION RECORD.                  *47450002
474600*----------------------------------------------------------------*47460002
474700                                                                  47470002
474800 5260-FETCH-VENDOR-LONG-NAME.                                     47480002
474900                                                                  47490002
475000     MOVE ASC-ENT-ID TO DK-ENT-ID                                 47500002
475100                                                                  47510002
475200     EXEC SQL                                                     47520002
475300          SELECT ENT_NAME_DESC                                    47530002
475400            INTO :ENTNME-ENT-NAME-DESC                            47540002
475500            FROM TENTNME                                          47550002
475600           WHERE ENT_ID       = :DK-ENT-ID                        47560002
475700             AND TYPE_CDE     = :PC-TYPE-CODE-LONG-NAME           47570002
475800     END-EXEC.                                                    47580002
475900                                                                  47590002
476000     EVALUATE TRUE                                                47600002
476100         WHEN SQLCODE = ZERO                                      47610002
476200              CONTINUE                                            47620002
476300         WHEN SQLCODE = +100                                      47630002
476400              MOVE SPACES  TO PURCHS-DIR-STR-IND                  47640002
476500                                  PURCHS-STATUS-CDE               47650002
476600         WHEN SQLWARN0 NOT = SPACE                                47660002
476700         WHEN SQLCODE NOT = ZERO                                  47670002
476800              MOVE '5260-FETCH-VENDOR-LONG-NAME'                  47680002
476900                               TO DP013-PARAGRAPH                 47690002
477000              MOVE 'FETCH VENDOR LONG NAME          '             47700002
477100                               TO DP013-MESSAGE-TEXT (1)          47710002
477200              MOVE 'FOR THE FOLLOWING PO:           '             47720002
477300                               TO DP013-MESSAGE-TEXT (2)          47730002
477400              MOVE TRBNTF-PO-NBR                                  47740002
477500                               TO DP013-MESSAGE-TEXT (3)          47750002
477600              MOVE SQLCA   TO DP013-SQLCA                         47760002
477700              MOVE 'TENTNME ' TO DP013-DB2-TABLE-NAME (1)         47770002
477800              SET DP013-DB2-ABEND                                 47780002
477900                               TO TRUE                            47790002
478000              PERFORM DP013-0000-PROCESS-ABEND                    47800002
478100     END-EVALUATE.                                                47810002
478200 EJECT                                                            47820002
478300*----------------------------------------------------------------*47830002
478400*    WRITE THE SELECTED PO ITEMS TEMP STORAGE QUEUE.             *47840002
478500*----------------------------------------------------------------*47850002
478600 5265-WRITE-PO-SEL-QUEUE.                                         47860002
478700                                                                  47870002
478800     MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO PO012-SELECTED-ITEMS.   47880002
478900                                                                  47890002
479000     EXEC CICS                                                    47900002
479100          WRITEQ TS                                               47910002
479200              QUEUE (ASC-SEL-QUEUE-NAME-OUT)                      47920002
479300              FROM  (PO012-PO-SELECT-RECORD)                      47930002
479400              ITEM  (PV-SEL-QUEUE-ITEM)                           47940002
479500              RESP  (PV-CICS-RESP)                                47950002
479600     END-EXEC.                                                    47960002
479700                                                                  47970002
479800     IF PV-CICS-RESP = DFHRESP (NORMAL)                           47980002
479900         CONTINUE                                                 47990002
480000     ELSE                                                         48000002
480100         SET DP013-CICS-ABEND        TO TRUE                      48010002
480200         SET DP013-NO-ROLLBACK       TO TRUE                      48020002
480300         MOVE '5205-WRITE-SEL-QUEUE' TO DP013-PARAGRAPH           48030002
480400         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          48040002
480500                                     TO DP013-MESSAGE-TEXT(1)     48050002
480600         PERFORM DP013-0000-PROCESS-ABEND                         48060002
480700     END-IF.                                                      48070002
480800 EJECT                                                            48080002
480900*----------------------------------------------------------------*48090002
481000*    RETRIEVE THE PO_LNE_NBR FROM THE PURCHASE ORDER ITEM TABLE  *48100002
481100*    (TPURITM).                                                  *48110002
481200*----------------------------------------------------------------*48120002
481300                                                                  48130002
481400 5270-FETCH-PO-LNE-NBR.                                           48140002
481500                                                                  48150002
481600     INITIALIZE DCLTPURITM.                                       48160002
481700                                                                  48170002
481800     EXEC SQL                                                     48180002
481900          SELECT PO_LNE_NBR                                       48190002
482000            INTO :PURITM-PO-LNE-NBR                               48200002
482100            FROM TPURITM                                          48210002
482200           WHERE PO_NBR      = :DK-PO-NBR                         48220002
482300             AND APP_PO_LNE_NBR = :DK-PO-LNE-NBR                  48230002
482400             AND VER_STATUS_CDE = :PC-ACTIVE-STATUS               48240002
482500     END-EXEC.                                                    48250002
482600                                                                  48260002
482700     EVALUATE TRUE                                                48270002
482800         WHEN SQLCODE = ZERO                                      48280002
482900         WHEN SQLCODE = +100                                      48290002
483000             CONTINUE                                             48300002
483100         WHEN SQLWARN0 NOT = SPACE                                48310002
483200         WHEN SQLCODE NOT = ZERO                                  48320002
483300              MOVE '5270-FETCH-PO-LNE-NBR'                        48330002
483400                               TO DP013-PARAGRAPH                 48340002
483500              MOVE 'FETCH PO LINE NUMBER '                        48350002
483600                               TO DP013-MESSAGE-TEXT (1)          48360002
483700              MOVE DK-PO-NBR                                      48370002
483800                               TO PV-ERROR-PO-NBR                 48380002
483900              MOVE DK-PO-LNE-NBR                                  48390002
484000                               TO PV-ERROR-PO-LNE-NBR             48400002
484100              STRING ' PO: '              DELIMITED BY SIZE       48410002
484200                     PV-ERROR-PO-NBR      DELIMITED BY SIZE       48420002
484300                     ' PO LINE NBR: '     DELIMITED BY SIZE       48430002
484400                     PV-ERROR-PO-LNE-NBR  DELIMITED BY SIZE       48440002
484500                             INTO DP013-MESSAGE-TEXT (2)          48450002
484600              MOVE SQLCA   TO DP013-SQLCA                         48460002
484700              MOVE 'TPURITM ' TO DP013-DB2-TABLE-NAME (1)         48470002
484800              SET DP013-DB2-ABEND                                 48480002
484900                               TO TRUE                            48490002
485000              PERFORM DP013-0000-PROCESS-ABEND                    48500002
485100     END-EVALUATE.                                                48510002
485200 EJECT                                                            48520002
485300*----------------------------------------------------------------*48530002
485400*    CALL THE TROUBLE CENTRAL PROCESSING ROUTINE (TMKCS520) TO   *48540002
485500*    PERFORM EITHER A RESPOND, RESOLVE, OR ACKNOWLEDGE FOR THE   *48550002
485600*    SELECTED NOTIFICATION RECORDS.                              *48560002
485700*----------------------------------------------------------------*48570002
485800                                                                  48580002
485900 5300-PROCESS-TROUBLE-UPDATE.                                     48590002
486000                                                                  48600002
486100     PERFORM 6112-READ-LIST-QUEUE.                                48610002
486200                                                                  48620002
486300     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       48630002
486400         PERFORM                                                  48640002
486500         VARYING LQW-IDX                                          48650002
486600         FROM 1 BY 1                                              48660002
486700         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            48670002
486800           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          48680002
486900           OR  PS-ERROR                                           48690002
487000                                                                  48700002
487100             IF  LQW-SELECT (LQW-IDX)                             48710002
487200                 MOVE ASC-OPER-UNT-ID                             48720002
487300                                TO  TM500-OPER-UNT-ID             48730002
487400                 MOVE ASC-FCLTY-ID                                48740002
487500                                TO  TM500-FCLTY-ID                48750002
487600                 MOVE ASC-PO-NBR-N                                48760002
487700                                TO  TM500-PO-NBR                  48770002
487800                 MOVE LQW-PO-LNE-NBR (LQW-IDX)                    48780002
487900                                TO  TM500-PO-LNE-NBR              48790002
488000                 MOVE LQW-PREPK-ID (LQW-IDX)                      48800002
488100                                TO  TM500-PREPK-ID                48810002
488200                 MOVE ASC-RCVR-SEQ-NBR-N                          48820002
488300                                TO  TM500-REC-SEQ-NBR             48830002
488400                 MOVE LQW-TROUBLE-REASON-CDE (LQW-IDX)            48840002
488500                                TO  TM500-TRBL-RSN-CDE            48850002
488600                                    ASC-TRBL-RSN-CDE              48860002
488700               IF ASC-TRBL-RSN-CDE-N  > 0                         48870002
488800                  MOVE ASC-TRBL-RSN-CDE-N                         48880002
488900                                         TO DK-TRBL-RSN-CDE       48890002
489000               ELSE                                               48900002
489100                  MOVE TM500-TRBL-RSN-CDE                         48910002
489110                                         TO DK-TRBL-RSN-CDE       48911002
489120                                            ASC-TRBL-RSN-CDE-N    48912002
489130               END-IF                                             48913002
489140               PERFORM 5900-CHECK-AUTO-ACK-IND                    48914002
489150               IF TRBRSN-AUTOACKNL-IND = 'Y'                      48915002
489160                  IF DP020-FK-LOCAL-FUNC-03(DP020-SRC-AID)        48916002
489170                     IF NOT TM500-ACKNOWLEDGE                     48917002
489180                         PERFORM 5070-CHECK-AUTO-ACKNOW           48918002
489190                     ELSE                                         48919002
489200* IF MANUALLY ACKNOWLEDGE, PUT OUT SET SWITCH TO PUT OUT          48920002
489201* APPROPRIATE MESSAGE TO USER AND COMPLETE THE AUTO ACKNOWLEDGE   48920102
489202* ROW SO IT DOESN'T TRY TO AUTO ACKNOWLEDGE ANYMORE.              48920202
489203                       IF TM500-ACKNOWLEDGE                       48920302
489204                          MOVE LQW-NOTIF-NBR (LQW-IDX)            48920402
489205                                         TO  TM500-NOTIF-NBR      48920502
489206                          SET PS-AUTO-ACKNOW-YES                  48920602
489207                                         TO TRUE                  48920702
489208                          PERFORM 5750-CMPLT-AUTO-ACK             48920802
489209                       END-IF                                     48920902
489210                     END-IF                                       48921002
489220                  END-IF                                          48922002
489230               ELSE                                               48923002
489240                  IF TM500-ACKNOWLEDGE                            48924002
489250                     MOVE LQW-NOTIF-NBR (LQW-IDX)                 48925002
489260                                         TO  TM500-NOTIF-NBR      48926002
489270                  END-IF                                          48927002
489280               END-IF                                             48928002
489290                                                                  48929002
489300               PERFORM 2160-CHECK-TRECEIV-PKGNG-CDE               48930002
489400                                                                  48940002
489500               MOVE RECEIV-PKGNG-CDE TO TM500-PKGNG-CDE           48950002
489600                                                                  48960002
489700               IF LQW-TROUBLE-PO-LEVEL (LQW-IDX)                  48970002
489800                  SET TM500-PO-LEVEL       TO TRUE                48980002
489900               ELSE                                               48990002
490000                  IF LQW-TROUBLE-PACK-LEVEL (LQW-IDX)             49000002
490100                     SET TM500-PACK-LEVEL TO TRUE                 49010002
490200                  ELSE                                            49020002
490300                     SET TM500-LINE-LEVEL TO TRUE                 49030002
490400                  END-IF                                          49040002
490500               END-IF                                             49050002
490600                                                                  49060002
490700               IF  PS-RESOLVE-REQUEST                             49070002
490800                   IF LQW-TRBL-RESOLVED (LQW-IDX)                 49080002
490900                      MOVE PC-TSYMSG-00938                        49090002
491000                                TO DP020-MSG-NUMBER               49100002
491100                      SET PS-ERROR                                49110002
491200                                TO  TRUE                          49120002
491300                   ELSE                                           49130002
491400                   IF (LQW-RESOLVE-TRBL-AUTO (LQW-IDX)) OR        49140002
491500                      (LQW-RESOLVE-TRBL-BOTH-AUTO-MAN (LQW-IDX))  49150002
491600                       CONTINUE                                   49160002
491700                   ELSE                                           49170002
491800                       IF  LQW-RESOLVE-TRBL-MANUAL (LQW-IDX)      49180002
491900                           MOVE PC-MUST-RESOLVE-MANUALLY-MSG      49190002
492000                                TO DP020-MSG-MESSAGE              49200002
492100                           SET PS-ERROR                           49210002
492200                                TO  TRUE                          49220002
492300                       ELSE                                       49230002
492400                           MOVE PC-RESOLVE-NOT-REQUIRED-MSG       49240002
492500                                TO DP020-MSG-MESSAGE              49250002
492600                           SET PS-ERROR                           49260002
492700                                TO  TRUE                          49270002
492800                       END-IF                                     49280002
492900                   END-IF                                         49290002
493000                   END-IF                                         49300002
493100               END-IF                                             49310002
493200                                                                  49320002
493300               IF  PS-NO-ERROR                                    49330002
493400                   PERFORM 5400-PROCESS-TRBL-REQUEST              49340002
493500               END-IF                                             49350002
493600                                                                  49360002
493700               IF TRBRSN-AUTOACKNL-IND = 'Y'                      49370002
493800                  CONTINUE                                        49380002
493900               ELSE                                               49390002
494000               IF  PS-NO-ERROR                                    49400002
494100                   IF  TM500-DUPLICATE-TROUBLE                    49410002
494200                       SET LQW-DESELECT (LQW-IDX)                 49420002
494300                             LQW-INQUIRE  (LQW-IDX)               49430002
494400                                TO  TRUE                          49440002
494500                       MOVE PC-TROUBLE-STILL-EXISTS-MSG           49450002
494600                                TO DP020-MSG-MESSAGE              49460002
494700                       MOVE SPACE                                 49470002
494800                                TO  LQW-TEMP-SELECTED-SW (LQW-IDX)49480002
494900                       SUBTRACT 1                                 49490002
495000                                FROM ASC-NUMBER-OF-SELECTED-ITEMS 49500002
495100                   ELSE                                           49510002
495200                       SET LQW-DESELECT (LQW-IDX)                 49520002
495300                             LQW-UPDATE   (LQW-IDX)               49530002
495400                                TO  TRUE                          49540002
495500                       MOVE SPACE                                 49550002
495600                                TO  LQW-TEMP-SELECTED-SW (LQW-IDX)49560002
495700                       SUBTRACT 1                                 49570002
495800                                FROM ASC-NUMBER-OF-SELECTED-ITEMS 49580002
495900                   END-IF                                         49590002
496000               ELSE                                               49600002
496100                   SET LQW-ERROR    (LQW-IDX)                     49610002
496200                                TO  TRUE                          49620002
496300                   EXEC CICS                                      49630002
496400                         SYNCPOINT ROLLBACK                       49640002
496500                   END-EXEC                                       49650002
496600               END-IF                                             49660002
496700           END-IF                                                 49670002
496800           END-IF                                                 49680002
496900         END-PERFORM                                              49690002
497000     END-IF.                                                      49700002
497100                                                                  49710002
497200     MOVE PV-ITEM                TO  PV-SAVE-ITEM.                49720002
497300     PERFORM 6111-WRITE-LIST-QUEUE.                               49730002
497400/                                                                 49740002
497500******************************************************************49750002
497600** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **49760002
497700** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **49770002
497800** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **49780002
497900** THE USER.                                                    **49790002
498000******************************************************************49800002
498100 5400-PROCESS-TRBL-REQUEST.                                       49810002
498200     MOVE LENGTH OF TM500-FIELDS      TO PV-COMMAREA-LENGTH       49820002
498300     SET TM500-FROM-LIST-SCREEN       TO TRUE.                    49830002
498400                                                                  49840002
498500     EXEC CICS                                                    49850002
498600          LINK PROGRAM  (PC-TMKCS520)                             49860002
498700               COMMAREA (TM500-FIELDS)                            49870002
498800               LENGTH   (PV-COMMAREA-LENGTH)                      49880002
498900               RESP     (PV-CICS-RESP)                            49890002
499000     END-EXEC.                                                    49900002
499100                                                                  49910002
499200     EVALUATE TRUE                                                49920002
499300         WHEN PV-CICS-RESP = DFHRESP (NORMAL)                     49930002
499400              CONTINUE                                            49940002
499500         WHEN OTHER                                               49950002
499600              MOVE '5400-PROCESS-TRBL-REQUEST'                    49960002
499700                                         TO DP013-PARAGRAPH       49970002
499800                                                                  49980002
499900              MOVE 'CANNOT LINK TO TMKCS520'                      49990002
500000                                         TO DP013-MESSAGE-TEXT (1)50000002
500100              SET DP013-CICS-ABEND       TO TRUE                  50010002
500200              SET DP013-NO-ROLLBACK      TO TRUE                  50020002
500300              SET PS-ERROR               TO TRUE                  50030002
500400              PERFORM DP013-0000-PROCESS-ABEND                    50040002
500500     END-EVALUATE.                                                50050002
500600                                                                  50060002
500700     EVALUATE TRUE                                                50070002
500800         WHEN TM500-CALL-SUCCESSFUL                               50080002
500900         WHEN TM500-DUPLICATE-TROUBLE                             50090002
501000         WHEN TM500-TTRBNTF-UPDATE-NOT-FND                        50100002
501100         WHEN TM500-TPURCHS-SELECT-NOT-FND                        50110002
501200         WHEN TM500-DIDNT-ALLOC-DUE-TO-TRBL                       50120002
501300              CONTINUE                                            50130002
501400         WHEN TM500-RECORD-IN-PROCESS                             50140002
501500              MOVE PC-RECORD-IN-PROC-MSG                          50150002
501600                                TO DP020-MSG-MESSAGE              50160002
501700              SET PS-ERROR      TO  TRUE                          50170002
501800         WHEN TM500-RECORD-RESOLVED                               50180002
501900              MOVE PC-RECORD-RESOLVED-MSG                         50190002
502000                                TO  DP020-MSG-MESSAGE             50200002
502100              SET PS-ERROR      TO  TRUE                          50210002
502200         WHEN TM500-RECORD-ACKNOWLEDGED                           50220002
502300************* MOVE PC-RECORD-ACKNOWLEDGED-MSG                     50230002
502400*************                   TO  DP020-MSG-MESSAGE             50240002
502500              MOVE PC-TSYMSG-01839 TO DP020-MSG-NUMBER            50250002
502600              SET PS-ERROR      TO  TRUE                          50260002
502700         WHEN TM500-RECORD-NOT-RESOLVED                           50270002
502800              MOVE PC-TSYMSG-01037                                50280002
502900                                TO  DP020-MSG-MESSAGE             50290002
503000              SET PS-ERROR      TO  TRUE                          50300002
503100         WHEN TM500-IN-PROC-UPDATE-NOT-FND                        50310002
503200              MOVE PC-TSYMSG-00938                                50320002
503300                                TO DP020-MSG-NUMBER               50330002
503400              SET PS-ERROR      TO  TRUE                          50340002
503500         WHEN TM500-RESPOND-UPDATE-NOT-FND                        50350002
503600              MOVE PC-RESPOND-TRBL-REC-NOT-FOUND                  50360002
503700                                TO  DP020-MSG-MESSAGE             50370002
503800              SET PS-ERROR      TO  TRUE                          50380002
503900         WHEN TM500-ACKNWLG-UPDATE-NOT-FND                        50390002
504000              MOVE PC-ACKNWLG-TRBL-REC-NOT-FOUND                  50400002
504100                                TO  DP020-MSG-MESSAGE             50410002
504200              SET PS-ERROR      TO  TRUE                          50420002
504300         WHEN OTHER                                               50430002
504400              STRING 'NNNNN-E-'             DELIMITED BY SIZE     50440002
504500                     TM500-RETURN-MSG       DELIMITED BY SIZE     50450002
504600                     '-'                    DELIMITED BY SIZE     50460002
504700                     TM500-RETURN-CODE      DELIMITED BY SIZE     50470002
504800                     ' SQLCODE='            DELIMITED BY SIZE     50480002
504900                     TM500-SQLCODE          DELIMITED BY SIZE     50490002
505000                              INTO  DP020-MSG-MESSAGE             50500002
505100              SET PS-ERROR      TO  TRUE                          50510002
505200     END-EVALUATE.                                                50520002
505300*                                                                 50530002
505400*----------------------------------------------------------------*50540002
505500* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *50550002
505600* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *50560002
505700* FOR THE SELECTED ITEMS QUEUE.                                  *50570002
505800*                                                                *50580002
505900* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *50590002
506000* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *50600002
506100* THE ARRAY IS FULL.                                             *50610002
506200*----------------------------------------------------------------*50620002
506300                                                                  50630002
506400 5500-PREP-SEL-QUEUE-FOR-RCVG.                                    50640002
506500                                                                  50650002
506600     MOVE +1                   TO  ASC-BLK-SUB.                   50660002
506700     PERFORM 5100-WRITE-TEMP-STORAGE.                             50670002
506800     ADD +1                    TO  ASC-BLK-SUB.                   50680002
506900     PERFORM 5100-WRITE-TEMP-STORAGE.                             50690002
507000                                                                  50700002
507100     MOVE ASC-SEL-QUEUE-NAME-OUT TO  RC015-SEL-QUEUE-NAME.        50710002
507200     PERFORM 6010-DELETE-SEL-QUEUE.                               50720002
507300                                                                  50730002
507400     SET ASC-UPDATE-TSQ          TO  TRUE.                        50740002
507500                                                                  50750002
507600     SET RC013-IDX               TO  1.                           50760002
507700     MOVE ZERO                   TO RC015-NUMBER-OF-TS-ITEMS.     50770002
507800     INITIALIZE RC013-SELECTED-ITEM-ARRAY.                        50780002
507900                                                                  50790002
508000     PERFORM 5600-FILL-SEL-QUEUE-REC-RCVG                         50800002
508100             VARYING PV-ITEM                                      50810002
508200             FROM 1 BY 1                                          50820002
508300             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     50830002
508400                                                                  50840002
508500     IF  RC013-IDX > 1 AND PS-NO-ERROR                            50850002
508600         PERFORM 5650-WRITE-RCVG-SEL-QUEUE                        50860002
508700         ADD +1                  TO RC015-NUMBER-OF-TS-ITEMS      50870002
508800     END-IF.                                                      50880002
508900                                                                  50890002
509000     IF  RC015-NUMBER-OF-TS-ITEMS = 0                             50900002
509100         SET DP030-OVERRIDE-GO TO TRUE                            50910002
509200         SET DP020-MSG-FATAL   TO TRUE                            50920002
509300         MOVE PC-TSYMSG-02184                                     50930002
509400                               TO DP020-MSG-NUMBER                50940002
509500     END-IF.                                                      50950002
509600                                                                  50960002
509700 EJECT                                                            50970002
509800*----------------------------------------------------------------*50980002
509900* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *50990002
510000* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *51000002
510100*----------------------------------------------------------------*51010002
510200 5600-FILL-SEL-QUEUE-REC-RCVG.                                    51020002
510300                                                                  51030002
510400     PERFORM 6112-READ-LIST-QUEUE.                                51040002
510500                                                                  51050002
510600     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       51060002
510700         PERFORM                                                  51070002
510800         VARYING LQW-IDX                                          51080002
510900         FROM 1 BY 1                                              51090002
511000         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            51100002
511100           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          51110002
511200           OR  PS-ERROR                                           51120002
511300                                                                  51130002
511400             IF  LQW-SELECT (LQW-IDX)                             51140002
511500              AND LQW-PO-LNE-NBR-N (LQW-IDX) > 0                  51150002
511600                 SET ASC-GOING-TO-RCVG TO TRUE                    51160002
511700                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              51170002
511800                                   TO  RC013-ITEM(RC013-IDX)      51180002
511900                 MOVE ASC-OPER-UNT-ID                             51190002
512000                                   TO  RC015-OPER-UNT-ID          51200002
512100                 MOVE ASC-FCLTY-ID TO  RC015-FCLTY-ID             51210002
512200                 MOVE ASC-PO-NBR-N TO  RC015-PO-NBR               51220002
512300                 MOVE ASC-RCVR-SEQ-NBR-N                          51230002
512400                                   TO  RC015-REC-SEQ-NBR          51240002
512500                 MOVE LQW-PO-LNE-NBR       (LQW-IDX)              51250002
512600                                   TO  DK-PO-LNE-NBR              51260002
512700                                       RC015-PKSL-LNE-NBR         51270002
512800                                       RC013-PKSL-LNE-NBR         51280002
512900                                                       (RC013-IDX)51290002
513000                 PERFORM 5610-FETCH-TRECITM-INFO                  51300002
513100                 MOVE RECITM-PKSL-NBR                             51310002
513200                                   TO  RC015-PKSL-NBR             51320002
513300                 MOVE SPACE        TO  RC013-ACTION-SW (PO012-IDX)51330002
513400                 SET RC013-IDX UP BY 1                            51340002
513500                 IF  RC013-IDX > RC013-MAX-ITEMS                  51350002
513600                     PERFORM 5650-WRITE-RCVG-SEL-QUEUE            51360002
513700                     ADD +1        TO RC015-NUMBER-OF-TS-ITEMS    51370002
513800                     INITIALIZE RC013-SELECTED-ITEM-ARRAY         51380002
513900                     SET RC013-IDX TO  1                          51390002
514000                 END-IF                                           51400002
514100             END-IF                                               51410002
514200         END-PERFORM                                              51420002
514300     END-IF.                                                      51430002
514400                                                                  51440002
514500*----------------------------------------------------------------*51450002
514600*    RETRIEVE THE PURCHASE ORDER HEADER INFORMATION FOR THE      *51460002
514700*    PO ASSOCIATED WITH THE TROUBLE NOTIFICATION RECORD.         *51470002
514800*----------------------------------------------------------------*51480002
514900                                                                  51490002
515000 5610-FETCH-TRECITM-INFO.                                         51500002
515100                                                                  51510002
515200     INITIALIZE DCLTRECITM.                                       51520002
515300     MOVE ASC-OPER-UNT-ID       TO DK-OPER-UNT-ID.                51530002
515400     MOVE ASC-FCLTY-ID          TO DK-FCLTY-ID.                   51540002
515500     MOVE ASC-PO-NBR-N          TO DK-PO-NBR.                     51550002
515600     MOVE ASC-RCVR-SEQ-NBR-N    TO DK-REC-SEQ-NBR.                51560002
515700                                                                  51570002
515800     EXEC SQL                                                     51580002
515900          SELECT PKSL_NBR                                         51590002
516000            INTO :RECITM-PKSL-NBR                                 51600002
516100            FROM TRECITM                                          51610002
516200           WHERE OPER_UNT_ID  = :DK-OPER-UNT-ID                   51620002
516300             AND FCLTY_ID     = :DK-FCLTY-ID                      51630002
516400             AND ORD_NBR      = :DK-PO-NBR                        51640002
516500             AND REC_SEQ_NBR  = :DK-REC-SEQ-NBR                   51650002
516600             AND ORD_LNE_NBR  = :DK-PO-LNE-NBR                    51660002
516700             AND VER_STATUS_CDE = :PC-ACTIVE-STATUS               51670002
516800     END-EXEC.                                                    51680002
516900                                                                  51690002
517000     EVALUATE TRUE                                                51700002
517100         WHEN SQLCODE = ZERO                                      51710002
517200              CONTINUE                                            51720002
517300         WHEN SQLCODE = +100                                      51730002
517400              MOVE SPACES  TO RECITM-PKSL-NBR                     51740002
517500         WHEN SQLWARN0 NOT = SPACE                                51750002
517600         WHEN SQLCODE NOT = ZERO                                  51760002
517700              MOVE '5610-FETCH-TRECITM-INFO'                      51770002
517800                               TO DP013-PARAGRAPH                 51780002
517900              MOVE 'FETCH RECEIPT ITEM INFORMATION'               51790002
518000                               TO DP013-MESSAGE-TEXT (1)          51800002
518100              MOVE DK-PO-NBR TO PV-ERROR-PO-NBR                   51810002
518200              MOVE DK-REC-SEQ-NBR                                 51820002
518300                               TO PV-ERROR-REC-SEQ-NBR            51830002
518400              MOVE DK-PO-LNE-NBR                                  51840002
518500                               TO PV-ERROR-PO-LNE-NBR             51850002
518600              STRING ' RCVR: '            DELIMITED BY SIZE       51860002
518700                     PV-ERROR-PO-NBR      DELIMITED BY SIZE       51870002
518800                     '-'                  DELIMITED BY SIZE       51880002
518900                     PV-ERROR-REC-SEQ-NBR DELIMITED BY SIZE       51890002
519000                     ' PO LINE NBR: '     DELIMITED BY SIZE       51900002
519100                     PV-ERROR-PO-LNE-NBR  DELIMITED BY SIZE       51910002
519200                             INTO DP013-MESSAGE-TEXT (2)          51920002
519300              MOVE SQLCA   TO DP013-SQLCA                         51930002
519400              MOVE 'TRECITM ' TO DP013-DB2-TABLE-NAME (1)         51940002
519500              SET DP013-DB2-ABEND                                 51950002
519600                               TO TRUE                            51960002
519700              PERFORM DP013-0000-PROCESS-ABEND                    51970002
519800     END-EVALUATE.                                                51980002
519900 EJECT                                                            51990002
520000*----------------------------------------------------------------*52000002
520100*    WRITE THE SELECTED PO ITEMS TEMP STORAGE QUEUE.             *52010002
520200*----------------------------------------------------------------*52020002
520300                                                                  52030002
520400 5650-WRITE-RCVG-SEL-QUEUE.                                       52040002
520500                                                                  52050002
520600     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            52060002
520700                                   TO RC013-SELECTED-ITEMS.       52070002
520800                                                                  52080002
520900     EXEC CICS                                                    52090002
521000          WRITEQ TS                                               52100002
521100              QUEUE (ASC-SEL-QUEUE-NAME-OUT)                      52110002
521200              FROM  (RC013-DC-SELECT-RECORD)                      52120002
521300              ITEM  (PV-SEL-QUEUE-ITEM)                           52130002
521400              RESP  (PV-CICS-RESP)                                52140002
521500     END-EXEC.                                                    52150002
521600                                                                  52160002
521700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          52170002
521800         CONTINUE                                                 52180002
521900     ELSE                                                         52190002
522000         SET DP013-CICS-ABEND      TO TRUE                        52200002
522100         SET DP013-NO-ROLLBACK     TO TRUE                        52210002
522200         MOVE '5650-WRITE-RCVG-SEL-QUEUE'                         52220002
522300                                   TO DP013-PARAGRAPH             52230002
522400         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          52240002
522500                                   TO DP013-MESSAGE-TEXT(1)       52250002
522600         PERFORM DP013-0000-PROCESS-ABEND                         52260002
522700     END-IF.                                                      52270002
522800                                                                  52280002
522810                                                                  52281002
522820*----------------------------------------------------------------*52282002
522830* LINK TO THE TROUBLE CENTRAL PROCESSING ROUTINE (TMKCS520) TO   *52283002
522840* RESPOND, RESOLVE, OR UPDATE THE SELECTED NOTIFICATION RECORDS. *52284002
522850*----------------------------------------------------------------*52285002
522860                                                                  52286002
522870 5700-LINK-TO-AUTO-ACKN.                                          52287002
522880                                                                  52288002
522890     SET TM500-FROM-MANUAL-SCREEN TO TRUE.                        52289002
522891                                                                  52289102
522892     EXEC CICS LINK                                               52289202
522893          PROGRAM (PC-TMKCS550)                                   52289302
522894          COMMAREA(TM500-FIELDS)                                  52289402
522895          RESP    (PV-CICS-RESP)                                  52289502
522896     END-EXEC.                                                    52289602
522897                                                                  52289702
522898     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       52289802
522899         CONTINUE                                                 52289902
522900     ELSE                                                         52290002
522901         SET DP013-LOGIC-ABEND                                    52290102
522902             DP013-NO-ROLLBACK     TO TRUE                        52290202
522903         MOVE '5700-LINK-TO-ACKN'                                 52290302
522904                                   TO DP013-PARAGRAPH             52290402
522905         MOVE 'ATTEMPTING TO LINK TO AUTO ACKNOWLEDGE'            52290502
522906                                   TO DP013-MESSAGE-TEXT (1)      52290602
522907         PERFORM DP013-0000-PROCESS-ABEND                         52290702
522908     END-IF.                                                      52290802
522909                                                                  52290902
522910*----------------------------------------------------------------*52291002
522911*    MANUAL ACKNOWLEDGE WAS DONE, SO WE WANT TO COMPLETE THE      52291102
522912*    ROW IN RCT_AUTOACKNL_TRBL FOR THE NOTIFICATION NUMBER        52291202
522913*    THAT WAS PUT IN THERE SO THAT IT DOESN'T GO THROUGH THE      52291302
522914*    BATCH PROCESS OF MANUALLY ACKNOWLEDGING AND RE-DISTRO'ING    52291402
522915*    WE HAVE TO ASSUME THAT THEY ARE GOING TO BE MANUALLY         52291502
522916*    RE-DISTRO'ING.                                               52291602
522917*----------------------------------------------------------------*52291702
522918 5750-CMPLT-AUTO-ACK.                                             52291802
522919                                                                  52291902
522920     MOVE DK-PO-NBR                  TO TM007-PO-NBR.             52292002
522921     MOVE DK-REC-SEQ-NBR             TO TM007-REC-SEQ-NBR.        52292102
522922     MOVE DK-OPER-UNT-ID             TO TM007-OPER-UNT-ID.        52292202
522923     MOVE DK-TRBL-RSN-CDE            TO TM007-TRBL-RSN-CDE.       52292302
522924     MOVE TM500-NOTIF-NBR            TO TM007-NOTIF-NBR.          52292402
522925                                                                  52292502
522926     SET TM007-UPDATE                                             52292602
522927         TM007-CMPLT-STATUS          TO TRUE.                     52292702
522928                                                                  52292802
522929     CALL PC-TMKUP501-RTN USING  DFHEIBLK                         52292902
522930                               TM007-COMMAREA                     52293002
522931                               TM007-COMMUNICATIONS-AREA          52293102
522932                                                                  52293202
522933     IF TM007-CALL-SUCCESSFUL OR                                  52293302
522934        TM007-SQLCODE = +100                                      52293402
522935        CONTINUE                                                  52293502
522936     ELSE                                                         52293602
522937        move TM007-SQLCODE          to tm500-sqlcode              52293702
522938        STRING 'NNNNN-E-'             DELIMITED BY SIZE           52293802
522939                TM007-RETURN-MSG       DELIMITED BY SIZE          52293902
522940                '-'                    DELIMITED BY SIZE          52294002
522941                TM007-RETURN-CODE      DELIMITED BY SIZE          52294102
522942                ' SQLCODE='            DELIMITED BY SIZE          52294202
522943                TM500-SQLCODE          DELIMITED BY SIZE          52294302
522944                                  INTO  DP020-MSG-MESSAGE         52294402
522945         SET PS-ERROR               TO  TRUE                      52294502
522946     END-IF.                                                      52294602
522947                                                                  52294702
522948                                                                  52294802
522949*----------------------------------------------------------------*52294902
522950*----------------------------------------------------------------*52295002
522960 5800-PREP-SEL-QUEUE-PKITEM.                                      52296002
522970                                                                  52297002
522980     MOVE +1                     TO ASC-BLK-SUB.                  52298002
522990     PERFORM 5100-WRITE-TEMP-STORAGE.                             52299002
523000     ADD +1                      TO ASC-BLK-SUB.                  52300002
523100     PERFORM 5100-WRITE-TEMP-STORAGE.                             52310002
523200                                                                  52320002
523300     MOVE ASC-SEL-QUEUE-NAME-OUT TO RC800-SEL-QUEUE-NAME.         52330002
523400     PERFORM 6010-DELETE-SEL-QUEUE.                               52340002
523500                                                                  52350002
523600     SET ASC-UPDATE-TSQ          TO TRUE.                         52360002
523700                                                                  52370002
523800     SET RC801-IDX               TO 1.                            52380002
523900     MOVE ZERO                   TO RC800-NUMBER-OF-TS-ITEMS.     52390002
524000     INITIALIZE RC801-SELECTED-ITEM-ARRAY.                        52400002
524100                                                                  52410002
524200     PERFORM 5810-FILL-SEL-QUEUE-PKITEM                           52420002
524300       VARYING PV-ITEM FROM 1 BY 1                                52430002
524400         UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.         52440002
524500                                                                  52450002
524600     IF RC801-IDX > 1                                             52460002
524700       AND PS-NO-ERROR                                            52470002
524800         PERFORM 5820-WRITE-SEL-QUEUE-PKITEM                      52480002
524900         ADD +1                  TO RC800-NUMBER-OF-TS-ITEMS      52490002
525000     END-IF.                                                      52500002
525100                                                                  52510002
525200 5810-FILL-SEL-QUEUE-PKITEM.                                      52520002
525300                                                                  52530002
525400     PERFORM 6112-READ-LIST-QUEUE.                                52540002
525500                                                                  52550002
525600     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        52560002
525700         PERFORM VARYING LQW-IDX FROM 1 BY 1                      52570002
525800           UNTIL LQW-IDX > PC-ITEMS-PER-PANEL                     52580002
525900              OR LQW-LIST-ITEM-NUMBER (LQW-IDX) = ZERO            52590002
526000              OR PS-ERROR                                         52600002
526100                                                                  52610002
526200           IF LQW-SELECT (LQW-IDX)                                52620002
526300               SET ASC-GOING-TO-PKITEM TO TRUE                    52630002
526400               MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)                52640002
526500                 TO RC801-ITEM(RC801-IDX)                         52650002
526600               MOVE LQW-PO-LNE-NBR-N (LQW-IDX)                    52660002
526700                 TO RC801-REC-LNE-NBR (RC801-IDX)                 52670002
526800                                                                  52680002
526900               MOVE LQW-NOTIF-NBR (LQW-IDX)                       52690002
527000                 TO RC801-TRBL-NOTIF-NBR (RC801-IDX)              52700002
527100               IF LQW-PO-LNE-NBR-N (LQW-IDX) = ZEROES             52710002
527200                   MOVE LQW-PREPK-ID (LQW-IDX)                    52720002
527300                     TO RC801-PACK-ID (RC801-IDX)                 52730002
527400               ELSE                                               52740002
527500                   MOVE LQW-RECITM-PREPK-ID (LQW-IDX)             52750002
527600                     TO RC801-PACK-ID (RC801-IDX)                 52760002
527700               END-IF                                             52770002
527800                                                                  52780002
527900               SET RC801-IDX UP BY 1                              52790002
528000               IF RC801-IDX > RC801-MAX-ITEMS                     52800002
528100                   PERFORM 5820-WRITE-SEL-QUEUE-PKITEM            52810002
528200                   ADD +1        TO RC800-NUMBER-OF-TS-ITEMS      52820002
528300                   INITIALIZE RC801-SELECTED-ITEM-ARRAY           52830002
528400                   SET RC801-IDX TO 1                             52840002
528500               END-IF                                             52850002
528600           END-IF                                                 52860002
528700                                                                  52870002
528800         END-PERFORM                                              52880002
528900     END-IF.                                                      52890002
529000                                                                  52900002
529100 5820-WRITE-SEL-QUEUE-PKITEM.                                     52910002
529200                                                                  52920002
529300     MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO RC801-SELECTED-ITEMS.   52930002
529400                                                                  52940002
529500     EXEC CICS                                                    52950002
529600         WRITEQ TS                                                52960002
529700             QUEUE (ASC-SEL-QUEUE-NAME-OUT)                       52970002
529800              FROM (RC801-PREPACK-SELECT-RECORD)                  52980002
529900              ITEM (PV-SEL-QUEUE-ITEM)                            52990002
530000              RESP (PV-CICS-RESP)                                 53000002
530100     END-EXEC.                                                    53010002
530200                                                                  53020002
530300     IF PV-CICS-RESP = DFHRESP (NORMAL)                           53030002
530400         CONTINUE                                                 53040002
530500     ELSE                                                         53050002
530600         SET DP013-CICS-ABEND  TO TRUE                            53060002
530700         SET DP013-NO-ROLLBACK TO TRUE                            53070002
530800         MOVE '5820-WRITE-SEL-QUEUE-PKITEM'                       53080002
530900                               TO DP013-PARAGRAPH                 53090002
531000         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          53100002
531100                               TO DP013-MESSAGE-TEXT(1)           53110002
531200         PERFORM DP013-0000-PROCESS-ABEND                         53120002
531300     END-IF.                                                      53130002
531400                                                                  53140002
531500******************************************************************53150002
531600** WHEN RESOLVING, CHECK THE AUTO ACKNOWLEDGE INDICATOR FIRST     53160002
531700******************************************************************53170002
531800 5900-CHECK-AUTO-ACK-IND.                                         53180002
531900                                                                  53190002
531910     EXEC SQL                                                     53191002
531920         SELECT AUTOACKNL_IND                                     53192002
531930         INTO   :TRBRSN-AUTOACKNL-IND                             53193002
531940         FROM    TTRBRSN                                          53194002
531950         WHERE   TRBL_RSN_CDE       =  :DK-TRBL-RSN-CDE           53195002
531960     END-EXEC.                                                    53196002
531970                                                                  53197002
531980     EVALUATE TRUE                                                53198002
531990         WHEN SQLCODE = ZERO                                      53199002
531991         WHEN SQLCODE = +100                                      53199102
531992              CONTINUE                                            53199202
531993         WHEN SQLWARN0 NOT = SPACES                               53199302
531994         WHEN SQLCODE NOT EQUAL ZERO                              53199402
531995              MOVE '5900-CHECK-AUTO-ACK-IND'                      53199502
531996                                   TO DP013-PARAGRAPH             53199602
531997              MOVE 'SELECT THE TROUBLE REASON AUTO ACK IND'       53199702
531998                                   TO DP013-MESSAGE-TEXT (1)      53199802
531999              MOVE SQLCA           TO DP013-SQLCA                 53199902
532000              MOVE 'TTRBRSN'       TO DP013-DB2-TABLE-NAME (1)    53200002
532010              SET DP013-DB2-ABEND                                 53201002
532011                 DP013-XCTL-DISPLAY-RESTART                       53201102
532012                                   TO TRUE                        53201202
532013              PERFORM DP013-0000-PROCESS-ABEND                    53201302
532014     END-EVALUATE.                                                53201402
532015                                                                  53201502
532016                                                                  53201602
532017******************************************************************53201702
532018** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **53201802
532019** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **53201902
532020** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **53202002
532030** THE USER.                                                    **53203002
532040******************************************************************53204002
532050 6000-REFRESH-PANEL-FROM-TEMP.                                    53205002
532060     IF  ASC-UPDATE-TSQ                                           53206002
532070         SET ASC-NO-TSQ-UPDATE TO TRUE                            53207002
532080         MOVE ZERO                 TO PV-SAVE-ITEM                53208002
532090                                      PV-SEL-QUEUE-ITEM           53209002
532100         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        53210002
532200                                   TO PV-HOLD-SELECTED-ITEMS      53220002
532300         MOVE +1                   TO PV-ITEMS-PROCESSED          53230002
532400         PERFORM 6100-UPDATE-TSQ                                  53240002
532500             UNTIL PV-ITEMS-PROCESSED >                           53250002
532600                                     PV-HOLD-SELECTED-ITEMS       53260002
532700         PERFORM 6010-DELETE-SEL-QUEUE                            53270002
532800         INITIALIZE ASC-BLOCK-ENTRIES (1)                         53280002
532900                    ASC-BLOCK-ENTRIES (2)                         53290002
533000                                                                  53300002
533100         DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                 53310002
533200                GIVING PV-BLOCK-NUMBER                            53320002
533300                REMAINDER PV-REMAINDER                            53330002
533400                                                                  53340002
533500         IF  PV-REMAINDER > ZERO                                  53350002
533600             ADD +1                TO PV-BLOCK-NUMBER             53360002
533700         END-IF                                                   53370002
533800                                                                  53380002
533900         MOVE +1                   TO ASC-BLK-SUB                 53390002
534000         PERFORM 4410-READ-TEMP-STORAGE                           53400002
534100         ADD +1                    TO ASC-BLK-SUB                 53410002
534200                                      PV-BLOCK-NUMBER             53420002
534300         PERFORM 4410-READ-TEMP-STORAGE                           53430002
534400     END-IF.                                                      53440002
534500                                                                  53450002
534600*----------------------------------------------------------------*53460002
534700*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *53470002
534800*----------------------------------------------------------------*53480002
534900 6010-DELETE-SEL-QUEUE.                                           53490002
535000                                                                  53500002
535100     EXEC CICS                                                    53510002
535200         DELETEQ TS                                               53520002
535300             QUEUE (ASC-SEL-QUEUE-NAME-OUT)                       53530002
535400             RESP  (PV-CICS-RESP)                                 53540002
535500     END-EXEC.                                                    53550002
535600*                                                                 53560002
535700     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      53570002
535800        (PV-CICS-RESP = DFHRESP(QIDERR)))                         53580002
535900         CONTINUE                                                 53590002
536000     ELSE                                                         53600002
536100         SET DP013-CICS-ABEND TO TRUE                             53610002
536200         SET DP013-NO-ROLLBACK TO TRUE                            53620002
536300         MOVE '6010-DELETE-SEL-QUEUE'                             53630002
536400                        TO DP013-PARAGRAPH                        53640002
536500         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         53650002
536600                        TO DP013-MESSAGE-TEXT (1)                 53660002
536700         PERFORM DP013-0000-PROCESS-ABEND                         53670002
536800     END-IF.                                                      53680002
536900                                                                  53690002
537000*----------------------------------------------------------------*53700002
537100*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *53710002
537200*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *53720002
537300*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *53730002
537400*    THE TEMP QUEUE.                                             *53740002
537500*----------------------------------------------------------------*53750002
537600 6100-UPDATE-TSQ.                                                 53760002
537700                                                                  53770002
537800     ADD 1 TO PV-SEL-QUEUE-ITEM.                                  53780002
537900                                                                  53790002
538000     PERFORM 6105-READ-SEL-QUEUE.                                 53800002
538100                                                                  53810002
538200     EVALUATE TRUE                                                53820002
538300       WHEN ASC-RETURNING-FROM-PO                                 53830002
538400         PERFORM                                                  53840002
538500           VARYING PO012-IDX FROM 1 BY 1                          53850002
538600             UNTIL ((PV-ITEMS-PROCESSED > PV-HOLD-SELECTED-ITEMS) 53860002
538700                OR (PO012-IDX GREATER THAN PO012-MAX-ITEMS))      53870002
538800             IF PO012-ACTION-SW (PO012-IDX) > SPACE               53880002
538900                 PERFORM 6110-PROCESS-ITEMS                       53890002
539000             END-IF                                               53900002
539100             ADD +1 TO PV-ITEMS-PROCESSED                         53910002
539200         END-PERFORM                                              53920002
539300                                                                  53930002
539400       WHEN ASC-RETURNING-FROM-RCVG                               53940002
539500         PERFORM                                                  53950002
539600           VARYING RC013-IDX FROM 1 BY 1                          53960002
539700             UNTIL ((PV-ITEMS-PROCESSED > PV-HOLD-SELECTED-ITEMS) 53970002
539800                OR (RC013-IDX GREATER THAN RC013-MAX-ITEMS))      53980002
539900             IF RC013-ACTION-SW (RC013-IDX) > SPACE               53990002
540000                 PERFORM 6110-PROCESS-ITEMS                       54000002
540100             END-IF                                               54010002
540200             ADD +1 TO PV-ITEMS-PROCESSED                         54020002
540300         END-PERFORM                                              54030002
540400                                                                  54040002
540500       WHEN ASC-RETURNING-FROM-PKITEM                             54050002
540600         PERFORM                                                  54060002
540700           VARYING RC801-IDX FROM 1 BY 1                          54070002
540800             UNTIL ((PV-ITEMS-PROCESSED > PV-HOLD-SELECTED-ITEMS) 54080002
540900                OR (RC801-IDX GREATER THAN RC801-MAX-ITEMS))      54090002
541000             IF RC801-ACTION-SW (RC801-IDX) > SPACE               54100002
541100                 PERFORM 6110-PROCESS-ITEMS                       54110002
541200             END-IF                                               54120002
541300             ADD +1 TO PV-ITEMS-PROCESSED                         54130002
541400         END-PERFORM                                              54140002
541500                                                                  54150002
541600       WHEN OTHER                                                 54160002
541700         PERFORM                                                  54170002
541800           VARYING TM002-IDX FROM 1 BY 1                          54180002
541900             UNTIL ((PV-ITEMS-PROCESSED > PV-HOLD-SELECTED-ITEMS) 54190002
542000                OR (TM002-IDX GREATER THAN TM002-MAX-ITEMS))      54200002
542100             IF TM002-ACTION-SW (TM002-IDX) > SPACE               54210002
542200                 PERFORM 6110-PROCESS-ITEMS                       54220002
542300             END-IF                                               54230002
542400             ADD +1 TO PV-ITEMS-PROCESSED                         54240002
542500         END-PERFORM                                              54250002
542600     END-EVALUATE.                                                54260002
542700                                                                  54270002
542800     PERFORM 6111-WRITE-LIST-QUEUE.                               54280002
542900                                                                  54290002
543000*----------------------------------------------------------------*54300002
543100*    READ THE LIST QUEUE RECORD.                                 *54310002
543200*----------------------------------------------------------------*54320002
543300                                                                  54330002
543400 6105-READ-SEL-QUEUE.                                             54340002
543500                                                                  54350002
543600     EVALUATE TRUE                                                54360002
543700       WHEN ASC-RETURNING-FROM-PO                                 54370002
543800           EXEC CICS                                              54380002
543900               READQ TS                                           54390002
544000                   QUEUE (ASC-SEL-QUEUE-NAME-OUT)                 54400002
544100                   INTO (PO012-PO-SELECT-RECORD)                  54410002
544200                   ITEM (PV-SEL-QUEUE-ITEM)                       54420002
544300                   RESP (PV-CICS-RESP)                            54430002
544400           END-EXEC                                               54440002
544500                                                                  54450002
544600       WHEN ASC-RETURNING-FROM-RCVG                               54460002
544700           EXEC CICS                                              54470002
544800               READQ TS                                           54480002
544900                   QUEUE (ASC-SEL-QUEUE-NAME-OUT)                 54490002
545000                   INTO (RC013-DC-SELECT-RECORD)                  54500002
545100                   ITEM (PV-SEL-QUEUE-ITEM)                       54510002
545200                   RESP (PV-CICS-RESP)                            54520002
545300           END-EXEC                                               54530002
545400                                                                  54540002
545500       WHEN ASC-RETURNING-FROM-PKITEM                             54550002
545600           EXEC CICS                                              54560002
545700               READQ TS                                           54570002
545800                   QUEUE (ASC-SEL-QUEUE-NAME-OUT)                 54580002
545900                   INTO (RC801-PREPACK-SELECT-RECORD)             54590002
546000                   ITEM (PV-SEL-QUEUE-ITEM)                       54600002
546100                   RESP (PV-CICS-RESP)                            54610002
546200           END-EXEC                                               54620002
546300                                                                  54630002
546400       WHEN OTHER                                                 54640002
546500           EXEC CICS                                              54650002
546600               READQ TS                                           54660002
546700                   QUEUE (ASC-SEL-QUEUE-NAME-OUT)                 54670002
546800                   INTO (TM002-MESSAGE-SEL-REC)                   54680002
546900                   ITEM (PV-SEL-QUEUE-ITEM)                       54690002
547000                   RESP (PV-CICS-RESP)                            54700002
547100           END-EXEC                                               54710002
547200     END-EVALUATE.                                                54720002
547300*                                                                 54730002
547400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          54740002
547500         CONTINUE                                                 54750002
547600     ELSE                                                         54760002
547700         SET DP013-CICS-ABEND      TO  TRUE                       54770002
547800         SET DP013-NO-ROLLBACK     TO  TRUE                       54780002
547900         MOVE '6105-READ-SEL-QUEUE'                               54790002
548000                                   TO  DP013-PARAGRAPH            54800002
548100         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           54810002
548200                                   TO  DP013-MESSAGE-TEXT(1)      54820002
548300         PERFORM DP013-0000-PROCESS-ABEND                         54830002
548400     END-IF.                                                      54840002
548500 EJECT                                                            54850002
548600*----------------------------------------------------------------*54860002
548700*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*54870002
548800*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*54880002
548900*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *54890002
549000*----------------------------------------------------------------*54900002
549100 6110-PROCESS-ITEMS.                                              54910002
549200                                                                  54920002
549300     EVALUATE TRUE                                                54930002
549400       WHEN ASC-RETURNING-FROM-PO                                 54940002
549500         COMPUTE PV-ITEM-COMP3 = 1 + ((PO012-ITEM (PO012-IDX) - 1)54950002
549600                         / PC-ITEMS-PER-PANEL-COMP3)              54960002
549700       WHEN ASC-RETURNING-FROM-RCVG                               54970002
549800         COMPUTE PV-ITEM-COMP3 = 1 + ((RC013-ITEM (RC013-IDX) - 1)54980002
549900                         / PC-ITEMS-PER-PANEL-COMP3)              54990002
550000       WHEN ASC-RETURNING-FROM-PKITEM                             55000002
550100         COMPUTE PV-ITEM-COMP3 = 1 + ((RC801-ITEM (RC801-IDX) - 1)55010002
550200                         / PC-ITEMS-PER-PANEL-COMP3)              55020002
550300       WHEN OTHER                                                 55030002
550400         COMPUTE PV-ITEM-COMP3 = 1 + ((TM002-ITEM (TM002-IDX) - 1)55040002
550500                         / PC-ITEMS-PER-PANEL-COMP3)              55050002
550600     END-EVALUATE.                                                55060002
550700                                                                  55070002
550800     MOVE PV-ITEM-COMP3 TO PV-ITEM.                               55080002
550900                                                                  55090002
551000     IF PV-ITEM NOT = PV-SAVE-ITEM                                55100002
551100         IF PV-SAVE-ITEM NOT = ZERO                               55110002
551200             PERFORM 6111-WRITE-LIST-QUEUE                        55120002
551300         END-IF                                                   55130002
551400         MOVE PV-ITEM TO PV-SAVE-ITEM                             55140002
551500         PERFORM 6112-READ-LIST-QUEUE                             55150002
551600         IF PV-CICS-RESP NOT = DFHRESP(NORMAL)                    55160002
551700             CONTINUE                                             55170002
551800         END-IF                                                   55180002
551900     END-IF.                                                      55190002
552000                                                                  55200002
552100     EVALUATE TRUE                                                55210002
552200       WHEN ASC-RETURNING-FROM-PO                                 55220002
552300         COMPUTE PV-SUB-COMP3 = (PO012-ITEM (PO012-IDX)           55230002
552400                        - LQW-LIST-ITEM-NUMBER (1)) + 1           55240002
552500       WHEN ASC-RETURNING-FROM-RCVG                               55250002
552600         COMPUTE PV-SUB-COMP3 = (RC013-ITEM (RC013-IDX)           55260002
552700                        - LQW-LIST-ITEM-NUMBER (1)) + 1           55270002
552800       WHEN ASC-RETURNING-FROM-PKITEM                             55280002
552900         COMPUTE PV-SUB-COMP3 = (RC801-ITEM (RC801-IDX)           55290002
553000                        - LQW-LIST-ITEM-NUMBER (1)) + 1           55300002
553100       WHEN OTHER                                                 55310002
553200         COMPUTE PV-SUB-COMP3 = (TM002-ITEM (TM002-IDX)           55320002
553300                        - LQW-LIST-ITEM-NUMBER (1)) + 1           55330002
553400     END-EVALUATE.                                                55340002
553500                                                                  55350002
553600     MOVE PV-SUB-COMP3 TO PV-SUB.                                 55360002
553700                                                                  55370002
553800     SET LQW-DESELECT (PV-SUB) TO TRUE.                           55380002
553900     MOVE LQW-SELECTED-SW (PV-SUB)                                55390002
554000          TO LQW-TEMP-SELECTED-SW (PV-SUB).                       55400002
554100                                                                  55410002
554200     EVALUATE TRUE                                                55420002
554300       WHEN ASC-RETURNING-FROM-PO                                 55430002
554400           EVALUATE TRUE                                          55440002
554500               WHEN PO012-INQ (PO012-IDX)                         55450002
554600                   MOVE PC-INQ  TO LQW-ACTION (PV-SUB)            55460002
554700               WHEN PO012-UPD (PO012-IDX)                         55470002
554800                   MOVE PC-UPD  TO LQW-ACTION (PV-SUB)            55480002
554900               WHEN PO012-DEL (PO012-IDX)                         55490002
555000                   MOVE PC-DEL  TO LQW-ACTION (PV-SUB)            55500002
555100               WHEN PO012-ERR (PO012-IDX)                         55510002
555200                   MOVE PC-ERR  TO LQW-ACTION (PV-SUB)            55520002
555300           END-EVALUATE                                           55530002
555400                                                                  55540002
555500       WHEN ASC-RETURNING-FROM-RCVG                               55550002
555600           EVALUATE TRUE                                          55560002
555700               WHEN RC013-INQ (RC013-IDX)                         55570002
555800                   MOVE PC-INQ  TO LQW-ACTION (PV-SUB)            55580002
555900               WHEN RC013-UPD (RC013-IDX)                         55590002
556000                   MOVE PC-UPD  TO LQW-ACTION (PV-SUB)            55600002
556100               WHEN RC013-DEL (RC013-IDX)                         55610002
556200                   MOVE PC-DEL  TO LQW-ACTION (PV-SUB)            55620002
556300               WHEN RC013-ERR (RC013-IDX)                         55630002
556400                   MOVE PC-ERR  TO LQW-ACTION (PV-SUB)            55640002
556500           END-EVALUATE                                           55650002
556600                                                                  55660002
556700       WHEN ASC-RETURNING-FROM-PKITEM                             55670002
556800           EVALUATE TRUE                                          55680002
556900               WHEN RC801-INQ (RC801-IDX)                         55690002
557000                   MOVE PC-INQ  TO LQW-ACTION (PV-SUB)            55700002
557100               WHEN RC801-UPD (RC801-IDX)                         55710002
557200                   MOVE PC-UPD  TO LQW-ACTION (PV-SUB)            55720002
557300               WHEN RC801-DEL (RC801-IDX)                         55730002
557400                   MOVE PC-DEL  TO LQW-ACTION (PV-SUB)            55740002
557500               WHEN RC801-ERR (RC801-IDX)                         55750002
557600                   MOVE PC-ERR  TO LQW-ACTION (PV-SUB)            55760002
557700           END-EVALUATE                                           55770002
557800                                                                  55780002
557900       WHEN OTHER                                                 55790002
558000           EVALUATE TRUE                                          55800002
558100               WHEN TM002-INQ (TM002-IDX)                         55810002
558200                   MOVE PC-INQ  TO LQW-ACTION (PV-SUB)            55820002
558300               WHEN TM002-UPD (TM002-IDX)                         55830002
558400                   MOVE PC-UPD  TO LQW-ACTION (PV-SUB)            55840002
558500               WHEN TM002-DEL (TM002-IDX)                         55850002
558600                   MOVE PC-DEL  TO LQW-ACTION (PV-SUB)            55860002
558700               WHEN TM002-ERR (TM002-IDX)                         55870002
558800                   MOVE PC-ERR  TO LQW-ACTION (PV-SUB)            55880002
558900           END-EVALUATE                                           55890002
559000     END-EVALUATE.                                                55900002
559100                                                                  55910002
559200     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                55920002
559300                                                                  55930002
559400*----------------------------------------------------------------*55940002
559500*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *55950002
559600*----------------------------------------------------------------*55960002
559700 6111-WRITE-LIST-QUEUE.                                           55970002
559800                                                                  55980002
559900     EXEC CICS                                                    55990002
560000         WRITEQ TS                                                56000002
560100             QUEUE (ASC-LIST-QUEUE-NAME)                          56010002
560200             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     56020002
560300             ITEM  (PV-SAVE-ITEM)                                 56030002
560400             REWRITE                                              56040002
560500             RESP  (PV-CICS-RESP)                                 56050002
560600     END-EXEC.                                                    56060002
560700*                                                                 56070002
560800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          56080002
560900         CONTINUE                                                 56090002
561000     ELSE                                                         56100002
561100         SET DP013-CICS-ABEND  TO  TRUE                           56110002
561200         SET DP013-NO-ROLLBACK TO  TRUE                           56120002
561300         MOVE '6111-WRITE-LIST-QUEUE'                             56130002
561400                               TO  DP013-PARAGRAPH                56140002
561500         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  56150002
561600                               TO  DP013-MESSAGE-TEXT(1)          56160002
561700         PERFORM DP013-0000-PROCESS-ABEND                         56170002
561800     END-IF.                                                      56180002
561900                                                                  56190002
562000 EJECT                                                            56200002
562100*----------------------------------------------------------------*56210002
562200*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*56220002
562300*----------------------------------------------------------------*56230002
562400                                                                  56240002
562500 6112-READ-LIST-QUEUE.                                            56250002
562600                                                                  56260002
562700     EXEC CICS                                                    56270002
562800         READQ TS                                                 56280002
562900             QUEUE (ASC-LIST-QUEUE-NAME)                          56290002
563000             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     56300002
563100             ITEM  (PV-ITEM)                                      56310002
563200             RESP  (PV-CICS-RESP)                                 56320002
563300     END-EXEC.                                                    56330002
563400*                                                                 56340002
563500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          56350002
563600         CONTINUE                                                 56360002
563700     ELSE                                                         56370002
563800         SET DP013-CICS-ABEND        TO TRUE                      56380002
563900         SET DP013-NO-ROLLBACK       TO TRUE                      56390002
564000         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           56400002
564100         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    56410002
564200                                     TO DP013-MESSAGE-TEXT(1)     56420002
564300         PERFORM DP013-0000-PROCESS-ABEND                         56430002
564400     END-IF.                                                      56440002
564500                                                                  56450002
564600 EJECT                                                            56460002
564700******************************************************************56470002
564800* DELETE THE LIST QUEUE WHEN PREV-SEL OR NEXT-SEL WAS ENTERED.   *56480002
564900******************************************************************56490002
565000 6200-DEL-LIST-QUEUE.                                             56500002
565100                                                                  56510002
565200     EXEC CICS                                                    56520002
565300         DELETEQ TS                                               56530002
565400             QUEUE (ASC-LIST-QUEUE-NAME)                          56540002
565500             RESP  (PV-CICS-RESP)                                 56550002
565600     END-EXEC.                                                    56560002
565700                                                                  56570002
565800     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      56580002
565900        (PV-CICS-RESP = DFHRESP(QIDERR)))                         56590002
566000         CONTINUE                                                 56600002
566100     ELSE                                                         56610002
566200        SET DP013-CICS-ABEND       TO TRUE                        56620002
566300        SET DP013-NO-ROLLBACK      TO TRUE                        56630002
566400        MOVE '6200-DEL-LIST-QUEUE' TO DP013-PARAGRAPH             56640002
566500        MOVE 'ERROR TRYING TO DELETE LIST TS QUEUE'               56650002
566600                                   TO DP013-MESSAGE-TEXT (1)      56660002
566700        PERFORM DP013-0000-PROCESS-ABEND                          56670002
566800     END-IF.                                                      56680002
566900                                                                  56690002
567000/                                                                 56700002
567100******************************************************************56710002
567200* READ AN ITEM FROM THE INPUT SELECTED ITEMS TEMP STORAGE QUEUE. *56720002
567300******************************************************************56730002
567400 9100-READ-SEL-QUEUE.                                             56740002
567500     EXEC CICS                                                    56750002
567600         READQ TS                                                 56760002
567700             QUEUE (ASC-SEL-QUEUE-NAME-IN)                        56770002
567800             INTO  (TM002-MESSAGE-SEL-REC)                        56780002
567900             ITEM  (ASC-SEL-ITEM)                                 56790002
568000             RESP  (PV-CICS-RESP)                                 56800002
568100     END-EXEC.                                                    56810002
568200                                                                  56820002
568300     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        56830002
568400         CONTINUE                                                 56840002
568500     ELSE                                                         56850002
568600         SET DP013-LOGIC-ABEND                                    56860002
568700             DP013-NO-ROLLBACK     TO TRUE                        56870002
568800         MOVE '9100-READ-SEL-QUEUE'                               56880002
568900                                   TO DP013-PARAGRAPH             56890002
569000         MOVE 'ATTEMPTING TO READ TO LIST SELECTIONS TS QUEUE'    56900002
569100                                   TO DP013-MESSAGE-TEXT (1)      56910002
569200         PERFORM DP013-0000-PROCESS-ABEND                         56920002
569300     END-IF.                                                      56930002
569400                                                                  56940002
569500                                                                  56950002
569600/                                                                 56960002
569700 9150-READ-SEL-QUEUE.                                             56970002
569800     EXEC CICS                                                    56980002
569900         READQ TS                                                 56990002
570000             QUEUE (ASC-SEL-QUEUE-NAME-IN)                        57000002
570100             INTO  (RC013-DC-SELECT-RECORD)                       57010002
570200             ITEM  (ASC-SEL-ITEM)                                 57020002
570300             RESP  (PV-CICS-RESP)                                 57030002
570400     END-EXEC.                                                    57040002
570500                                                                  57050002
570600     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       57060002
570700         CONTINUE                                                 57070002
570800     ELSE                                                         57080002
570900         SET DP013-LOGIC-ABEND                                    57090002
571000             DP013-NO-ROLLBACK     TO TRUE                        57100002
571100         MOVE '9150-READ-SEL-QUEUE'                               57110002
571200                                   TO DP013-PARAGRAPH             57120002
571300         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   57130002
571400                                   TO DP013-MESSAGE-TEXT (1)      57140002
571500         PERFORM DP013-0000-PROCESS-ABEND                         57150002
571600     END-IF.                                                      57160002
571700                                                                  57170002
571800/                                                                 57180002
571900 9170-READ-SEL-QUEUE.                                             57190002
572000     EXEC CICS                                                    57200002
572100         READQ TS                                                 57210002
572200             QUEUE (ASC-SEL-QUEUE-NAME-IN)                        57220002
572300             INTO  (PC016-TS-SEL-REC)                             57230002
572400             ITEM  (ASC-SEL-ITEM)                                 57240002
572500             RESP  (PV-CICS-RESP)                                 57250002
572600     END-EXEC.                                                    57260002
572700                                                                  57270002
572800     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       57280002
572900         CONTINUE                                                 57290002
573000     ELSE                                                         57300002
573100         SET DP013-LOGIC-ABEND                                    57310002
573200             DP013-NO-ROLLBACK     TO TRUE                        57320002
573300         MOVE '9170-READ-SEL-QUEUE'                               57330002
573400                                   TO DP013-PARAGRAPH             57340002
573500         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   57350002
573600                                   TO DP013-MESSAGE-TEXT (1)      57360002
573700         PERFORM DP013-0000-PROCESS-ABEND                         57370002
573800     END-IF.                                                      57380002
573900                                                                  57390002
574000/                                                                 57400002
574100******************************************************************57410002
574200* UPDATE AN ITEM IN THE INPUT SELECTED ITEMS TEMP STORAGE QUEUE. *57420002
574300******************************************************************57430002
574400 9200-REWRITE-LIST-QUEUE.                                         57440002
574500     EXEC CICS                                                    57450002
574600          WRITEQ TS                                               57460002
574700              QUEUE   (ASC-SEL-QUEUE-NAME-IN)                     57470002
574800              FROM    (TM002-MESSAGE-SEL-REC)                     57480002
574900              ITEM    (ASC-SEL-ITEM)                              57490002
575000              RESP    (PV-CICS-RESP)                              57500002
575100              REWRITE                                             57510002
575200     END-EXEC.                                                    57520002
575300                                                                  57530002
575400     IF PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                    57540002
575500         SET DP013-CICS-ABEND                                     57550002
575600             DP013-NO-ROLLBACK     TO TRUE                        57560002
575700         MOVE '9200-REWRITE-LIST-QUEUE'                           57570002
575800                                   TO DP013-PARAGRAPH             57580002
575900         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   57590002
576000                                   TO DP013-MESSAGE-TEXT (1)      57600002
576100         PERFORM DP013-0000-PROCESS-ABEND                         57610002
576200     END-IF.                                                      57620002
576300                                                                  57630002
576400/                                                                 57640002
576500*----------------------------------------------------------------*57650002
576600*    UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE     *57660002
576700*----------------------------------------------------------------*57670002
576800 9250-REWRITE-SEL-QUEUE.                                          57680002
576900     EXEC CICS                                                    57690002
577000          WRITEQ TS                                               57700002
577100              QUEUE  (ASC-SEL-QUEUE-NAME-IN)                      57710002
577200              FROM   (RC013-DC-SELECT-RECORD)                     57720002
577300              ITEM   (ASC-SEL-ITEM)                               57730002
577400              RESP   (PV-CICS-RESP)                               57740002
577500              REWRITE                                             57750002
577600     END-EXEC.                                                    57760002
577700                                                                  57770002
577800     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   57780002
577900         SET DP013-CICS-ABEND                                     57790002
578000             DP013-NO-ROLLBACK     TO TRUE                        57800002
578100         MOVE '9250-REWRITE-SEL-QUEUE'                            57810002
578200                                   TO DP013-PARAGRAPH             57820002
578300         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   57830002
578400                                   TO DP013-MESSAGE-TEXT (1)      57840002
578500         PERFORM DP013-0000-PROCESS-ABEND                         57850002
578600     END-IF.                                                      57860002
578700                                                                  57870002
578800                                                                  57880002
578900/                                                                 57890002
579000*----------------------------------------------------------------*57900002
579100*    UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE     *57910002
579200*----------------------------------------------------------------*57920002
579300 9270-REWRITE-SEL-QUEUE.                                          57930002
579400     EXEC CICS                                                    57940002
579500          WRITEQ TS                                               57950002
579600              QUEUE  (ASC-SEL-QUEUE-NAME-IN)                      57960002
579700              FROM   (PC016-TS-SEL-REC)                           57970002
579800              ITEM   (ASC-SEL-ITEM)                               57980002
579900              RESP   (PV-CICS-RESP)                               57990002
580000              REWRITE                                             58000002
580100     END-EXEC.                                                    58010002
580200                                                                  58020002
580300     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   58030002
580400         SET DP013-CICS-ABEND                                     58040002
580500             DP013-NO-ROLLBACK     TO TRUE                        58050002
580600         MOVE '9270-REWRITE-SEL-QUEUE'                            58060002
580700                                   TO DP013-PARAGRAPH             58070002
580800         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   58080002
580900                                   TO DP013-MESSAGE-TEXT (1)      58090002
581000         PERFORM DP013-0000-PROCESS-ABEND                         58100002
581100     END-IF.                                                      58110002
581200                                                                  58120002
581300                                                                  58130002
581400/                                                                 58140002
581500*----------------------------------------------------------------*58150002
581600*    ABEND PROCESSOR MODULE                                      *58160002
581700*----------------------------------------------------------------*58170002
581800                                                                  58180002
581900     COPY DPPD013.                                                58190002
