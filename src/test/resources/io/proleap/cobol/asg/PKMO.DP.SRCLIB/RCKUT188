000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.         RCKUT188.                                    00020051
000300 AUTHOR.             Denise Hahn.                                 00030000
000400 INSTALLATION.       KOHLS DEPARTMENT STORES.                     00040000
000500 DATE-WRITTEN.       November, 2021.                              00050000
000510******************************************************************00051000
000524******************************************************************00052400
000530* build Sephora ASN XML                                           00053000
000540* This program will take in file from RCKUT186 "Sephora SSCC's"   00054000
000550* to be converted to xml                                          00055000
000551*                                                                 00055100
000552*  RCRD113 - XML HEADER                                           00055200
000553*  RCRD114 - XML PO INFO                                          00055300
000554*  RCRD115 - XML CARTONS & CONTENTS                               00055400
000555*  RCRD117 - XML SKU information                                  00055564
000556*                                                                 00055664
000557* input file:  RCRD112                                            00055764
000558* XML file will be used to generate another XML that will be sent 00055864
000559* to 3rd party (GEODIS)                                           00055964
000560******************************************************************00056064
000561*                                                                *00056164
000562* 2021-11-17 - per balanced team - these tags are not needed if  *00056264
000563* there are NO SSCC's on the ASN.                                *00056364
000564*    <masterCartonInfo>                                          *00056464
000565*    <masterCartonId> </masterCartonId>                           00056564
000566*    <cartonInfo>                                                *00056664
000567*    <cartonId>0</cartonId>                                      *00056764
000568*    </cartonInfo>                                               *00056864
000569*    </masterCartonInfo>                                         *00056964
000570*                                                                *00057064
000571******************************************************************00057164
000572 ENVIRONMENT DIVISION.                                            00057264
000580 CONFIGURATION SECTION.                                           00058000
000590 SOURCE-COMPUTER.    IBM-3090.                                    00059000
000600 OBJECT-COMPUTER.    IBM-3090.                                    00060000
000700                                                                  00070000
000800 INPUT-OUTPUT SECTION.                                            00080000
000900 FILE-CONTROL.                                                    00090000
001000                                                                  00100000
001100     SELECT ASN-SEPHORA-SSCC-FILE                                 00110000
001200         ASSIGN TO INP01.                                         00120000
001300                                                                  00130000
001400     SELECT ASN-OUTPUT-FILE                                       00140003
001500         ASSIGN TO OUT01.                                         00150000
001600                                                                  00160000
001700******************************************************************00170000
001800 DATA DIVISION.                                                   00180000
001900 FILE SECTION.                                                    00190000
002000                                                                  00200000
002100 FD  ASN-SEPHORA-SSCC-FILE                                        00210000
002200     RECORDING MODE IS F                                          00220000
002300     LABEL RECORDS ARE STANDARD                                   00230000
002400     BLOCK CONTAINS 0 RECORDS.                                    00240000
002500                                                                  00250000
002600 01  ASN-SEPHORA-SSCC-RECORD            PIC  X(1100).             00260000
002700                                                                  00270000
002800 FD  ASN-OUTPUT-FILE                                              00280003
002900     RECORDING MODE IS V                                          00290000
003000     RECORD IS VARYING IN SIZE                                    00300000
003100     FROM 1 TO 32000 CHARACTERS                                   00310005
003110     DEPENDING ON PV-BYTE-COUNT                                   00311000
003120     LABEL RECORDS ARE STANDARD                                   00312000
003130     DATA RECORD IS ASN-OUTPUT-RECORD.                            00313003
003140                                                                  00314000
003141 01  ASN-OUTPUT-RECORD.                                           00314103
003142     05 VARIABLE-BYTE              PIC X(01)                      00314200
003143                                   OCCURS 1 TO 32000 TIMES        00314305
003144                                   DEPENDING ON PV-BYTE-COUNT.    00314400
003145                                                                  00314500
003146******************************************************************00314600
003147******************************************************************00314700
003148*                                                                 00314800
003149 WORKING-STORAGE SECTION.                                         00314900
003150 01  PV-XML                          PIC X(32000)  VALUE SPACES.  00315005
003160 01  PV-XML2 REDEFINES PV-XML.                                    00316000
003170     05 PV-XML2-CHAR OCCURS  32000 INDEXED BY X1 PIC X(01).       00317005
003180                                                                  00318000
003800                                                                  00380000
003900 01  PC-PROGRAM-CONSTANTS.                                        00390001
003910     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08) VALUE 'RCKUT188'. 00391051
003911     05  PC-END-TAG                  PIC X(01) VALUE '>'.         00391130
003912*    05  PC-XML-ZEROES               PIC X(20) VALUE              00391201
003913*                                    '00000000000000000000'.      00391301
003920                                                                  00392001
003921 01  PV-PROGRAM-VARIABLES.                                        00392101
003930     05  PV-PREV-ASN-HDR             PIC  X(30) VALUE SPACES.     00393001
003940     05  PV-PREV-OPER                PIC  9(04) VALUE ZEROS.      00394001
003950     05  PV-PREV-PO                  PIC  9(09) VALUE ZEROS.      00395001
003960     05  PV-PREV-SSCC                PIC  9(18) VALUE ZEROS.      00396001
003970                                                                  00397001
003980     05  PV-CURRENT-TMST             PIC X(26)  VALUE SPACES.     00398001
003990     05  PV-CURRENT-TMST-R REDEFINES PV-CURRENT-TMST.             00399001
004000         10  PV-CURR-DATE            PIC X(10).                   00400001
004100         10  FILLER                  PIC X.                       00410001
004200         10  PV-CURR-HR              PIC 99.                      00420001
004300         10  FILLER                  PIC X.                       00430001
004400         10  PV-CURR-MIN             PIC 99.                      00440001
004500         10  FILLER                  PIC X.                       00450001
004510         10  PV-CURR-SEC             PIC 99.                      00451001
004520         10  FILLER                  PIC X.                       00452001
004530         10  PV-CURR-MICRO           PIC 999999.                  00453001
004540                                                                  00454001
004541     05  PV-CURRENT-TMST-R2 REDEFINES PV-CURRENT-TMST.            00454122
004542         10  PV-CURR-YEAR            PIC 9(04).                   00454222
004543         10  FILLER                  PIC X.                       00454322
004544         10  PV-CURR-MONTH           PIC 99.                      00454422
004545         10  FILLER                  PIC X.                       00454522
004546         10  PV-CURR-DAY             PIC 99.                      00454622
004547         10  FILLER                  PIC X(16).                   00454722
004551                                                                  00455122
004552     05  PV-CRE-TMST-FORMAT          PIC X(26)  VALUE SPACES.     00455201
004560     05  PV-CRE-TMST-FORMAT-R REDEFINES PV-CRE-TMST-FORMAT.       00456001
004570         10  PV-CURR-REFMT-DATE      PIC X(10).                   00457001
004580         10  PV-CURR-REFMT-T         PIC X.                       00458001
004590         10  PV-CURR-REFMR-HR        PIC 99.                      00459001
004591         10  PV-CURR-REFMT-COLON-1   PIC X.                       00459101
004592         10  PV-CURR-REFMT-MIN       PIC 99.                      00459201
004593         10  PV-CURR-REFMT-COLON-2   PIC X.                       00459301
004594         10  PV-CURR-REFMT-SEC       PIC 99.                      00459401
004595         10  PV-CURR-REFMT-DOT       PIC X.                       00459501
004596         10  PV-CURR-REFMT-MICRO     PIC 999999.                  00459601
004597                                                                  00459720
004598     05  PV-CRE-TMST-HEADER          PIC 9(14)  VALUE ZEROES.     00459824
004599     05  PV-CRE-TMST-HEADER-R REDEFINES PV-CRE-TMST-HEADER.       00459920
004600         10  PV-CURR-HEADER-YEAR     PIC 9(04).                   00460022
004601         10  PV-CURR-HEADER-MONTH    PIC 99.                      00460122
004602         10  PV-CURR-HEADER-DAY      PIC 99.                      00460222
004603         10  PV-CURR-HEADER-HR       PIC 99.                      00460322
004604         10  PV-CURR-HEADER-MIN      PIC 99.                      00460422
004605         10  PV-CURR-HEADER-SEC      PIC 99.                      00460520
004608                                                                  00460801
004609                                                                  00460956
004610     05  PV-SHIP-WORK.                                            00461056
004611         10  PV-SHIP-WORK-MM         PIC X(02).                   00461158
004612         10  PV-SHIP-WORK-DD         PIC X(02).                   00461258
004613         10  PV-SHIP-WORK-CCYY       PIC X(04).                   00461360
004615                                                                  00461556
004616     05  PV-SHIP-DATE.                                            00461656
004617         10  PV-SHIP-CCYY            PIC X(04).                   00461756
004618         10  PV-SHIP-DASH1           PIC X(01).                   00461856
004619         10  PV-SHIP-MM              PIC X(02).                   00461956
004620         10  PV-SHIP-DASH2           PIC X(01).                   00462056
004621         10  PV-SHIP-DD              PIC X(02).                   00462156
004624                                                                  00462456
004625     05  PV-DISP-COUNT               PIC  ZZZ,ZZZ,ZZ9.            00462501
004626     05  PV-DISP-SQL                 PIC -999.                    00462601
004627                                                                  00462701
004628     05  PV-READ-COUNT               PIC  9(09) VALUE ZEROES.     00462801
004629     05  PV-OUT01-COUNT              PIC  9(09) VALUE ZEROES.     00462901
004630     05  PV-ASN-CNT                  PIC  9(09) VALUE ZEROES.     00463001
004631     05  PV-PO-CNT                   PIC  9(09) VALUE ZEROES.     00463101
004632     05  PV-SSCC-CNT                 PIC  9(09) VALUE ZEROES.     00463201
004633     05  PV-SSCC-DTL-CNT             PIC  9(09) VALUE ZEROES.     00463301
004634     05  PV-TRLR-CNT                 PIC  9(09) VALUE ZEROES.     00463401
004635                                                                  00463501
004636     05  PV-TOT-ASN-CNT              PIC  9(09) VALUE ZEROES.     00463601
004637     05  PV-TOT-PO-CNT               PIC  9(09) VALUE ZEROES.     00463701
004638     05  PV-TOT-SSCC-CNT             PIC  9(09) VALUE ZEROES.     00463801
004639     05  PV-TOT-SSCC-DTL-CNT         PIC  9(09) VALUE ZEROES.     00463901
004640     05  PV-TOT-TRLR-CNT             PIC  9(09) VALUE ZEROES.     00464001
004641                                                                  00464101
004642     05  PV-RECORD-IN-FILE           PIC  9(09) VALUE ZEROES.     00464201
004643     05  PV-VENDOR-PO-NBR            PIC  9(09) VALUE ZEROES.     00464301
004644     05  PV-ZIP-CODE-WORK.                                        00464443
004645         10  PV-ZIP-CODE-1-5         PIC  X(05) VALUE SPACES.     00464544
004646         10  PV-ZIP-CODE-6-10        PIC  X(05) VALUE SPACES.     00464644
004647                                                                  00464743
004648     05  PV-BYTE-COUNT               PIC 9(05) VALUE ZERO.        00464843
004649     05  XML-LENGTH                  PIC 9(7)   COMP VALUE 0.     00464943
004650     05  PV-XML-OUT                  PIC S9(07) COMP VALUE +0.    00465043
004651     05  PV-XML-LENGTH-X             PIC 9(9)    COMP.            00465143
004652     05  PV-XML-LENGTH               PIC 9(9)    COMP.            00465243
004653     05  PV-XML-LENGTH-NEW           PIC 9(9)    COMP.            00465343
004654     05  PV-XML-LENGTH-BEG           PIC 9(9)    COMP.            00465443
004655     05  PV-XML-LENGTH-END           PIC 9(9)    COMP.            00465543
004656     05  PV-LAST-50-BYTES            PIC x(99).                   00465643
004657     05  PV-CHAR-COUNT               PIC S9(04)  VALUE ZEROS.     00465743
004658     05  PV-MSG-LENGTH-DISPLAY       PIC S9(9).                   00465843
004659     05  PV-MSG-LENGTH               PIC S9(9) BINARY.            00465943
004660     05  PV-MSGBUFFER-1.                                          00466043
004661         10  PV-MSGBUFFER-BANNER     PIC X(38) VALUE SPACES.      00466143
004662         10  PV-MSGBUFFER-SHIP-NOTC  PIC X(25) VALUE SPACES.      00466243
004663         10  PV-MSGBUFFER-data-1     PIC X(99999) VALUE SPACES.   00466343
004664     05  PV-MSGBUFFER.                                            00466443
004665         10  PV-MSGBUFFER-DATA       PIC X(999999) VALUE SPACES.  00466543
004666                                                                  00466643
004667     05  pV-VARIABLE-OUTPUT-FIELD.                                00466743
004668         10  PV-BIT-VARIABLE        PIC  X(01)                    00466843
004669                                    VALUE SPACES                  00466943
004670                                    OCCURS 32000 TIMES            00467043
004671                                    INDEXED BY                    00467143
004672                                        PV-BIT-IDX                00467243
004673                                        PV-STR-IDX                00467343
004674                                        PV-EOF-IDX.               00467443
004680                                                                  00468003
010200                                                                  01020000
010300* NOTE;                                                           01030000
010400*      IF YOU CHANGE PV-XML-BANNER LENGTH YOU MUST CHANGE         01040008
010500*      THE INDEX VALUE (X1) IN PARA 2400-.  COBOL DOES NOT        01050000
010600*      ALLOW USING "LENGTH OF" FOR AN INDEX OR SUBSCRIPT.         01060000
010700*                                                                 01070000
010800     05  PV-XML-BANNER               PIC X(38) VALUE              01080008
010900         '<?xml version="1.0" encoding="UTF-8"?>'.                01090000
010930     05  PV-XML-SHIP-NOTC            PIC X(25) VALUE              01093013
010940         '<advancedShipmentNotices>'.                             01094011
010950     05  PV-XML-SHIP-NOTC-END        PIC X(26) VALUE              01095013
010960         '</advancedShipmentNotices>'.                            01096011
010970     05  PV-HEADER-SOURCE            PIC X(18) VALUE              01097020
010980         'MAINFRAME'.                                             01098020
010990     05  PV-HEADER-DEST              PIC X(06) VALUE              01099020
010991         'RDCASN'.                                                01099120
010992     05  PV-XML-ASN                  PIC X(05) VALUE              01099226
010993         '<asn>'.                                                 01099326
010994     05  PV-XML-ASN-END              PIC X(06) VALUE              01099426
010995         '</asn>'.                                                01099526
010996     05  PV-XML-CARTON               PIC X(12) VALUE              01099654
010997         '<cartonInfo>'.                                          01099754
010998     05  PV-XML-CARTON-END           PIC X(13) VALUE              01099854
010999         '</cartonInfo>'.                                         01099954
011000     05  PV-XML-MASTER               PIC X(18) VALUE              01100054
011001         '<masterCartonInfo>'.                                    01100154
011002     05  PV-XML-MASTER-END           PIC X(19) VALUE              01100254
011003         '</masterCartonInfo>'.                                   01100354
011004     05  PV-XML-MASTER-ID            PIC X(16) VALUE              01100454
011005         '<masterCartonId>'.                                      01100554
011006     05  PV-XML-MASTER-ID-END        PIC X(17) VALUE              01100654
011007         '</masterCartonId>'.                                     01100754
011008     05  PV-XML-DC-LOC-END           PIC X(19) VALUE              01100838
011009         '</dcLocationDetail>'.                                   01100938
011010     05  PV-XML-DC-DTL-END           PIC X(11) VALUE              01101038
011011         '</dcDetail>'.                                           01101138
011012     05  PV-XML-PO-INFO-END          PIC X(09) VALUE              01101238
011013         '</poInfo>'.                                             01101338
011014     05  PV-XML-ASN-DTL-END          PIC X(12) VALUE              01101438
011015         '</asnDetail>'.                                          01101538
011016     05  PV-XML-HDR-DTL-END          PIC X(26) VALUE              01101638
011017         '</advancedShipmentNotices>'.                            01101738
011018                                                                  01101800
011019     05 Header.                                                   01101920
011020       10 HEADER_SOURCE                        PIC X(09).         01102020
011030       10 HEADER_DESTINATION                   PIC X(06).         01103020
011040       10 HEADER_CREATIONTIME                  PIC X(14).         01104020
011050                                                                  01105020
011100 01  PS-PROGRAM-SWITCHES.                                         01110001
011200     05  PS-END-OF-FILE-SW           PIC X(01) VALUE 'N'.         01120001
011300         88  PS-END-OF-FILE                    VALUE 'Y'.         01130001
011400         88  PS-END-OF-FILE-NO                 VALUE 'N'.         01140001
011410     05  PS-FIRST-RECORD-SW          PIC X(01) VALUE 'N'.         01141001
011420         88  PS-FIRST-RECORD                   VALUE 'Y'.         01142001
011430         88  PS-FIRST-RECORD-NO                VALUE 'N'.         01143001
011500*    05  PS-TBL-IN-SW                PIC X(01) VALUE 'N'.         01150000
011600*        88  PS-TBL-IN-EOF                     VALUE 'Y'.         01160000
011700*        88  PS-TBL-IN-NOT-EOF                 VALUE 'N'.         01170000
012100*                                                                 01210000
012200 01  PV-ABEND-FIELDS.                                             01220001
012300     05  PV-ABEND-CODE                 PIC S9(4) VALUE +0         01230001
012400                                                       COMP SYNC. 01240001
012410     05  PV-DB2-OPERATION-ATTEMPTED    PIC X(79) VALUE SPACES.    01241001
012420     05  PV-PARAGRAPH-NAME             PIC X(25) VALUE SPACES.    01242001
012430                                                                  01243001
012500*    05  PV-ABEND-PROGRAM              PIC X(08) VALUE 'RCKUT188'.01250051
012600*    05  PV-ABEND-PARAGRAPH            PIC X(25) VALUE SPACES.    01260000
012700*    05  PV-ABEND-OPERATION            PIC X(20) VALUE SPACES.    01270000
012800*    05  PV-ABEND-STRUCTURE-1          PIC X(50) VALUE SPACES.    01280000
012900*    05  PV-ABEND-STRUCTURE-2          PIC X(50) VALUE SPACES.    01290000
013000*    05  PV-ABEND-STATUS               PIC XX    VALUE SPACES.    01300000
013100*    05  PV-DB2-OPERATION-MESSAGE-1    PIC X(79) VALUE SPACES.    01310000
013400*    05  PV-RETRY-COUNTER              PIC S9(04) VALUE +0        01340000
013500*                                                     COMP SYNC.  01350000
013600*    05  PV-HOLD-COMPLETION-CODE       PIC S9(9) BINARY.          01360000
013700*    05  PV-HOLD-REASON                PIC S9(9) BINARY.          01370000
013800*    05  PV-MSG-AREA                   PIC X(100) VALUE SPACE.    01380000
013900                                                                  01390000
014000****************************************************************  01400000
014100*    INPUT RECORD                                                 01410000
014200****************************************************************  01420000
014300     COPY RCRD112.                                                01430000
014400                                                                  01440000
014500************************************************************      01450000
014600*    XML - HEADER              (for XML conversion)               01460000
014700************************************************************      01470000
014800     COPY RCRD113.                                                01480000
014900                                                                  01490000
015000************************************************************      01500000
015100*    XML - PO                  (for XML conversion)               01510000
015200************************************************************      01520000
015300     COPY RCRD114.                                                01530000
015400                                                                  01540000
015500************************************************************      01550000
015600*    XML - SSCC HEADER         (for XML conversion)               01560003
015700************************************************************      01570000
015800     COPY RCRD115.                                                01580000
015900                                                                  01590000
015910************************************************************      01591003
015920*    XML - SSCC CONTENTS       (for XML conversion)               01592003
015930************************************************************      01593003
015940     COPY RCRD117.                                                01594003
015950                                                                  01595003
016000***************************************************************** 01600000
016100*    DB2 FORMATTED MESSAGE AREA                                   01610000
016200***************************************************************** 01620000
016300     COPY DPWS004.                                                01630000
016301                                                                  01630101
016310***************************************************************** 01631001
016320*    COPYBOOKS FOR XML PARSER                                     01632001
016330***************************************************************** 01633001
016400     COPY ISWS007.                                                01640000
016500     COPY ISWS008.                                                01650000
016600     COPY ISWS009.                                                01660000
016700     COPY ISWS012.                                                01670000
016800                                                                  01680000
016900******************************************************************01690000
017000*  DB2 TABLE DECLARATION - XLT_LOC                                01700000
017100******************************************************************01710000
017200     EXEC SQL                                                     01720000
017300         INCLUDE XLT00010                                         01730000
017400     END-EXEC.                                                    01740000
017500                                                                  01750000
017510******************************************************************01751039
017520*  DB2 TABLE DECLARATION - PO                                     01752064
017530******************************************************************01753039
017540     EXEC SQL                                                     01754039
017550         INCLUDE TPURCHS                                          01755064
017560     END-EXEC.                                                    01756039
017570                                                                  01757039
017571******************************************************************01757164
017572*  DB2 TABLE DECLARATION - PO INSTRUCTIONS                        01757264
017573******************************************************************01757364
017574     EXEC SQL                                                     01757464
017575         INCLUDE TPOINST                                          01757564
017576     END-EXEC.                                                    01757664
017577                                                                  01757764
017580******************************************************************01758039
017590*  DB2 TABLE DECLARATION - PO INSTRUCTION CODE                    01759039
017591******************************************************************01759139
017592     EXEC SQL                                                     01759239
017593         INCLUDE TINSTCD                                          01759339
017594     END-EXEC.                                                    01759439
017595                                                                  01759539
018700***************************************************************** 01870000
018800*    DB2 AREA FOR COMMUNICATIONS                                  01880000
018900***************************************************************** 01890000
019000     EXEC SQL                                                     01900000
019100          INCLUDE SQLCA                                           01910000
019200     END-EXEC.                                                    01920000
019300                                                                  01930000
019400****************************************************************  01940000
019500*    LINKAGE SECTION                                              01950000
019600****************************************************************  01960000
019700 LINKAGE SECTION.                                                 01970000
019800                                                                  01980000
019900****************************************************************  01990000
020000*    PROCEDURE DIVISION                                           02000000
020100****************************************************************  02010000
020200 PROCEDURE DIVISION.                                              02020000
020300                                                                  02030000
020400 0000-PROGRAM-MAINLINE.                                           02040000
020500                                                                  02050000
020600     DISPLAY ' RCKUT188 - START'.                                 02060051
020610     DISPLAY ' '.                                                 02061003
020700                                                                  02070000
020720     OPEN INPUT  ASN-SEPHORA-SSCC-FILE                            02072001
020730          OUTPUT ASN-OUTPUT-FILE.                                 02073001
020740                                                                  02074001
020800     PERFORM 0100-INITIALIZE.                                     02080000
020900                                                                  02090000
021000     IF  PS-END-OF-FILE                                           02100001
021100         CONTINUE                                                 02110000
021200     ELSE                                                         02120000
021300         PERFORM 1100-PROCESS-INPUT                               02130000
021400            UNTIL PS-END-OF-FILE                                  02140001
021500     END-IF.                                                      02150000
021600                                                                  02160000
021610****************************************                          02161036
021620*** </cartonInfo>                                                 02162036
021630****************************************                          02163036
021631     IF  PV-READ-COUNT  >  0                                      02163154
021632         IF  PV-PREV-SSCC   >  0                                  02163254
021640             MOVE  13  TO   PV-MSG-LENGTH                         02164054
021650             MOVE PV-XML-CARTON-END TO PV-MSGBUFFER               02165054
021660             PERFORM 6000-WRITE-VARIABLE-REC                      02166054
021661                                                                  02166138
021670****************************************                          02167038
021680*** </masterCartonInfo>                                           02168038
021690****************************************                          02169038
021696             MOVE  20  TO   PV-MSG-LENGTH                         02169667
021697             MOVE PV-XML-MASTER-END TO PV-MSGBUFFER               02169767
021698             PERFORM 6000-WRITE-VARIABLE-REC                      02169867
021699         END-IF                                                   02169967
021700****************************************                          02170067
021701*** </dcLocationDetail>                                           02170167
021702****************************************                          02170267
021703         MOVE  20  TO   PV-MSG-LENGTH                             02170367
021704         MOVE PV-XML-DC-LOC-END TO PV-MSGBUFFER                   02170467
021710         PERFORM 6000-WRITE-VARIABLE-REC                          02171038
021800                                                                  02180038
021900****************************************                          02190038
022000*** </dcDetail>                                                   02200038
022100****************************************                          02210038
022200         MOVE  20  TO   PV-MSG-LENGTH                             02220038
022300         MOVE PV-XML-DC-DTL-END TO PV-MSGBUFFER                   02230038
022400         PERFORM 6000-WRITE-VARIABLE-REC                          02240038
022500                                                                  02250038
022510****************************************                          02251038
022520*** </poInfo>                                                     02252038
022530****************************************                          02253038
022540         MOVE   9  TO   PV-MSG-LENGTH                             02254038
022550         MOVE PV-XML-PO-INFO-END TO PV-MSGBUFFER                  02255038
022560         PERFORM 6000-WRITE-VARIABLE-REC                          02256038
022570                                                                  02257038
022580****************************************                          02258038
022590*** </asnDetail>                                                  02259038
022591****************************************                          02259138
022592         MOVE  12  TO   PV-MSG-LENGTH                             02259238
022593         MOVE PV-XML-ASN-DTL-END TO PV-MSGBUFFER                  02259338
022594         PERFORM 6000-WRITE-VARIABLE-REC                          02259438
022595                                                                  02259538
022596****************************************                          02259638
022597*** </asn>                                                        02259738
022598****************************************                          02259838
022599         MOVE   6  TO   PV-MSG-LENGTH                             02259938
022600         MOVE PV-XML-ASN-END  TO PV-MSGBUFFER                     02260038
022601         PERFORM 6000-WRITE-VARIABLE-REC                          02260138
022602                                                                  02260238
022603****************************************                          02260338
022604*** </advancedShipmentNotices>                                    02260438
022605****************************************                          02260538
022606         MOVE  26  TO   PV-MSG-LENGTH                             02260638
022607         MOVE PV-XML-HDR-DTL-END to PV-MSGBUFFER                  02260738
022608         PERFORM 6000-WRITE-VARIABLE-REC                          02260838
022609     end-if.                                                      02260938
022610                                                                  02261001
022700     CLOSE ASN-SEPHORA-SSCC-FILE                                  02270001
022710           ASN-OUTPUT-FILE.                                       02271001
022720                                                                  02272001
022730     DISPLAY ' '                                                  02273001
022740     MOVE PV-READ-COUNT                  TO  PV-DISP-COUNT        02274001
022750     DISPLAY ' RECORDS READ:           '     PV-DISP-COUNT        02275001
022760     DISPLAY ' '                                                  02276001
022770                                                                  02277001
022780     MOVE PV-TOT-ASN-CNT                 TO  PV-DISP-COUNT        02278001
022790     DISPLAY ' ASN HEADERS    - AH:    '     PV-DISP-COUNT        02279001
022791                                                                  02279101
022792     MOVE PV-TOT-PO-CNT                  TO  PV-DISP-COUNT        02279201
022793     DISPLAY ' PO DETAILS     - PD:    '     PV-DISP-COUNT        02279301
022794                                                                  02279401
022795     MOVE PV-TOT-SSCC-CNT                TO  PV-DISP-COUNT        02279501
022796     DISPLAY ' CARTON HEADERS - CH:    '     PV-DISP-COUNT        02279601
022797                                                                  02279701
022798     MOVE PV-TOT-SSCC-DTL-CNT            TO  PV-DISP-COUNT        02279801
022799     DISPLAY ' CARTON DETAIL  - CD:    '     PV-DISP-COUNT        02279901
022800     DISPLAY ' '.                                                 02280001
022801                                                                  02280101
022806     MOVE PV-OUT01-COUNT                 TO  PV-DISP-COUNT        02280601
022807     DISPLAY ' OUTPUT COUNT:           '     PV-DISP-COUNT        02280701
022808                                                                  02280801
022809     DISPLAY ' '                                                  02280901
022810                                                                  02281001
022811     DISPLAY ' RCKUT188 - END'.                                   02281151
022812     DISPLAY ' '.                                                 02281201
022813                                                                  02281301
022814     STOP RUN.                                                    02281401
022815                                                                  02281501
022816                                                                  02281601
022900****************************************************************  02290000
023000*   INITIALIZATIONS                                            *  02300000
023100****************************************************************  02310000
023200 0100-INITIALIZE.                                                 02320000
023300                                                                  02330000
023400     MOVE  0                 TO  PV-DISP-SQL.                     02340003
023410     PERFORM 4000-GET-CURRENT-TMST.                               02341001
023500                                                                  02350000
023600     PERFORM 8000-READ-INPUT.                                     02360001
023700                                                                  02370000
023800     IF  PS-END-OF-FILE                                           02380001
023900         DISPLAY 'NO ASN TO PROCESS - INPUT FILE EMPTY'           02390000
024000     ELSE                                                         02400000
024010         SET  PS-FIRST-RECORD    TO  TRUE                         02401001
024011         PERFORM 3800-CREATE-HDR-MESSAGE                          02401121
024013                                                                  02401320
024020         PERFORM 2100-BUILD-ASN-HDR                               02402001
024021         PERFORM 3100-GENERATE-XML-ASN-HDR                        02402101
024030         PERFORM 8110-WRITE-OUTPUT                                02403032
024040         MOVE RC112-ASNHDR-NBR     TO  PV-PREV-ASN-HDR            02404001
024050         MOVE RC112-DIST-CNTR      TO  PV-PREV-OPER               02405001
024060         SET  PS-FIRST-RECORD-NO   TO  TRUE                       02406001
024070                                                                  02407001
024080         PERFORM 2200-BUILD-PO-DTL                                02408001
024090         PERFORM 3200-GENERATE-XML-PO-DTL                         02409001
024091         PERFORM 8110-WRITE-OUTPUT                                02409126
024092         MOVE RC112-PO-NBR         TO  PV-PREV-PO                 02409201
024093                                                                  02409301
024094         IF  RC112-CARTON-NBR  >  0                               02409461
024095             PERFORM 2300-BUILD-SSCC-HDR                          02409561
024096             PERFORM 3300-GENERATE-XML-SSCC-HDR                   02409661
024097             PERFORM 8110-WRITE-OUTPUT                            02409761
024098         END-IF                                                   02409861
024099         MOVE RC112-CARTON-NBR     TO  PV-PREV-SSCC               02409901
025400     END-IF.                                                      02540000
025500                                                                  02550000
025600****************************************************************  02560000
025700*   PROCESS THE INPUT FILE                                        02570000
025800****************************************************************  02580000
025900 1100-PROCESS-INPUT.                                              02590000
026000                                                                  02600000
026100* SAME ASN HEADER                                                 02610000
026200     IF  RC112-ASNHDR-NBR  =  PV-PREV-ASN-HDR                     02620003
026300         CONTINUE                                                 02630000
026400     ELSE                                                         02640000
026401                                                                  02640136
026410****************************************                          02641036
026420*** </cartonInfo>                                                 02642036
026430****************************************                          02643036
026440         IF  PV-PREV-SSCC   >  0                                  02644054
026450             MOVE  13  TO   PV-MSG-LENGTH                         02645054
026460             MOVE PV-XML-CARTON-END TO PV-MSGBUFFER               02646054
026480             PERFORM 6000-WRITE-VARIABLE-REC                      02648054
026490                                                                  02649036
026500****************************************                          02650038
026600*** </masterCartonInfo>                                           02660038
026700****************************************                          02670038
026800             MOVE  20  TO   PV-MSG-LENGTH                         02680054
026810             MOVE PV-XML-MASTER-END TO PV-MSGBUFFER               02681054
026820             PERFORM 6000-WRITE-VARIABLE-REC                      02682054
026821         END-IF                                                   02682155
026830                                                                  02683038
026840****************************************                          02684038
026850*** </dcLocationDetail>                                           02685038
026860****************************************                          02686038
026870         MOVE  20  TO   PV-MSG-LENGTH                             02687038
026880         MOVE PV-XML-DC-LOC-END TO PV-MSGBUFFER                   02688038
026890         PERFORM 6000-WRITE-VARIABLE-REC                          02689038
026891                                                                  02689138
026892****************************************                          02689238
026893*** </dcDetail>                                                   02689338
026894****************************************                          02689438
026895         MOVE  11  TO   PV-MSG-LENGTH                             02689538
026896         MOVE PV-XML-DC-DTL-END TO PV-MSGBUFFER                   02689638
026897         PERFORM 6000-WRITE-VARIABLE-REC                          02689738
026898                                                                  02689838
026899****************************************                          02689938
026900*** </poInfo>                                                     02690038
026901****************************************                          02690138
026902         MOVE   9  TO   PV-MSG-LENGTH                             02690238
026903         MOVE PV-XML-PO-INFO-END TO PV-MSGBUFFER                  02690338
026904         PERFORM 6000-WRITE-VARIABLE-REC                          02690438
026905                                                                  02690538
026906****************************************                          02690638
026907*** </asnDetail>                                                  02690738
026908****************************************                          02690838
026909         MOVE  12  TO   PV-MSG-LENGTH                             02690938
026910         MOVE PV-XML-ASN-DTL-END TO PV-MSGBUFFER                  02691038
026911         PERFORM 6000-WRITE-VARIABLE-REC                          02691138
026912                                                                  02691238
026913****************************************                          02691338
026914*** </asn>                                                        02691438
026915****************************************                          02691538
026916         MOVE   6  TO   PV-MSG-LENGTH                             02691638
026917         MOVE PV-XML-ASN-END  TO PV-MSGBUFFER                     02691738
026918         PERFORM 6000-WRITE-VARIABLE-REC                          02691838
026920                                                                  02692048
026921****************************************                          02692148
026922*** <asn>        for the next asn                                 02692248
026923****************************************                          02692348
026925         MOVE   5  TO   PV-MSG-LENGTH                             02692548
026926         MOVE PV-XML-ASN        TO PV-MSGBUFFER                   02692648
026927                                                                  02692748
026928         PERFORM 6000-WRITE-VARIABLE-REC                          02692848
026929                                                                  02692948
026930         PERFORM 2100-BUILD-ASN-HDR                               02693000
027000         PERFORM 3100-GENERATE-XML-ASN-HDR                        02700000
027001         PERFORM 8110-WRITE-OUTPUT                                02700126
027010         MOVE RC112-ASNHDR-NBR     TO  PV-PREV-ASN-HDR            02701001
027100                                                                  02710000
027200         PERFORM 2200-BUILD-PO-DTL                                02720000
027300         PERFORM 3200-GENERATE-XML-PO-DTL                         02730000
027301         PERFORM 8110-WRITE-OUTPUT                                02730126
027310         MOVE RC112-PO-NBR         TO  PV-PREV-PO                 02731001
027400                                                                  02740000
027410         IF  RC112-CARTON-NBR  >  0                               02741061
027500             PERFORM 2300-BUILD-SSCC-HDR                          02750061
027510             PERFORM 3300-GENERATE-XML-SSCC-HDR                   02751061
027520             PERFORM 8110-WRITE-OUTPUT                            02752061
027530         END-IF                                                   02753061
027610         MOVE RC112-CARTON-NBR     TO  PV-PREV-SSCC               02761001
027700     END-IF.                                                      02770000
027800                                                                  02780000
027900* SAME PO                                                         02790000
028000     IF  RC112-PO-NBR  =  PV-PREV-PO                              02800000
028100         CONTINUE                                                 02810000
028200     ELSE                                                         02820000
028210****************************************                          02821036
028220*** </cartonInfo>                                                 02822036
028230****************************************                          02823036
028231         IF  PV-PREV-SSCC   >  0                                  02823155
028240             MOVE  13  TO   PV-MSG-LENGTH                         02824055
028250             MOVE PV-XML-CARTON-END TO PV-MSGBUFFER               02825055
028260             PERFORM 6000-WRITE-VARIABLE-REC                      02826055
028261                                                                  02826138
028262****************************************                          02826238
028263*** </masterCartonInfo>                                           02826338
028264****************************************                          02826438
028270             MOVE  20  TO   PV-MSG-LENGTH                         02827055
028271             MOVE PV-XML-MASTER-END TO PV-MSGBUFFER               02827155
028272             PERFORM 6000-WRITE-VARIABLE-REC                      02827255
028273         END-IF                                                   02827355
028274                                                                  02827436
028280****************************************                          02828038
028290*** </dcLocationDetail>                                           02829038
028300****************************************                          02830038
028400         MOVE  20  TO   PV-MSG-LENGTH                             02840038
028410         MOVE PV-XML-DC-LOC-END TO PV-MSGBUFFER                   02841038
028420         PERFORM 6000-WRITE-VARIABLE-REC                          02842038
028430                                                                  02843038
028440****************************************                          02844038
028450*** </dcDetail>                                                   02845038
028460****************************************                          02846038
028470         MOVE  11  TO   PV-MSG-LENGTH                             02847038
028480         MOVE PV-XML-DC-DTL-END TO PV-MSGBUFFER                   02848038
028490         PERFORM 6000-WRITE-VARIABLE-REC                          02849038
028491                                                                  02849138
028492****************************************                          02849238
028493*** </poInfo>                                                     02849338
028494****************************************                          02849438
028495         MOVE   9  TO   PV-MSG-LENGTH                             02849538
028496         MOVE PV-XML-PO-INFO-END TO PV-MSGBUFFER                  02849638
028497         PERFORM 6000-WRITE-VARIABLE-REC                          02849738
028498                                                                  02849838
028499****************************************                          02849949
028500*** </asnDetail>                                                  02850049
028501****************************************                          02850149
028502         MOVE  12  TO   PV-MSG-LENGTH                             02850249
028503         MOVE PV-XML-ASN-DTL-END TO PV-MSGBUFFER                  02850349
028504         PERFORM 6000-WRITE-VARIABLE-REC                          02850449
028505                                                                  02850549
028510         PERFORM 2200-BUILD-PO-DTL                                02851000
028600         PERFORM 3200-GENERATE-XML-PO-DTL                         02860000
028610         PERFORM 8110-WRITE-OUTPUT                                02861026
028620         MOVE RC112-PO-NBR         TO  PV-PREV-PO                 02862001
028700                                                                  02870000
028710         IF  RC112-CARTON-NBR  >  0                               02871061
028800             PERFORM 2300-BUILD-SSCC-HDR                          02880061
028900             PERFORM 3300-GENERATE-XML-SSCC-HDR                   02890061
028910             PERFORM 8110-WRITE-OUTPUT                            02891061
028920         END-IF                                                   02892061
029100         MOVE RC112-CARTON-NBR     TO  PV-PREV-SSCC               02910000
029200     END-IF.                                                      02920000
029300                                                                  02930000
029400* SAME SSCC                                                       02940000
029500     IF  RC112-CARTON-NBR  =  PV-PREV-SSCC                        02950000
029600         PERFORM 2400-BUILD-SSCC-UPC                              02960000
029601         PERFORM 3400-GENERATE-XML-SSCC-DTL                       02960101
029610         PERFORM 8110-WRITE-OUTPUT                                02961026
029800     ELSE                                                         02980000
029810****************************************                          02981036
029820*** </cartonInfo>                                                 02982036
029830****************************************                          02983036
029831         IF  PV-PREV-SSCC  > 0                                    02983155
029840             MOVE  13  TO   PV-MSG-LENGTH                         02984055
029850             MOVE PV-XML-CARTON-END TO PV-MSGBUFFER               02985055
029860             PERFORM 6000-WRITE-VARIABLE-REC                      02986055
029861         END-IF                                                   02986155
029870                                                                  02987036
029880         IF  RC112-CARTON-NBR > 0                                 02988055
029920             PERFORM 2300-BUILD-SSCC-HDR                          02992055
029930             PERFORM 3300-GENERATE-XML-SSCC-HDR                   02993055
029940             PERFORM 8110-WRITE-OUTPUT                            02994055
029950         END-IF                                                   02995055
029951         MOVE RC112-CARTON-NBR     TO  PV-PREV-SSCC               02995155
029952                                                                  02995255
029960         PERFORM 2400-BUILD-SSCC-UPC                              02996001
029970         PERFORM 3400-GENERATE-XML-SSCC-DTL                       02997001
029980         PERFORM 8110-WRITE-OUTPUT                                02998026
030300     END-IF.                                                      03030000
030400                                                                  03040000
030410     PERFORM 8000-READ-INPUT.                                     03041012
030420                                                                  03042012
030500                                                                  03050000
030600****************************************************************  03060000
030700*   BUILD ASN HEADER XML INFO - RCRD113                           03070000
030800****************************************************************  03080000
030900 2100-BUILD-ASN-HDR.                                              03090000
031000                                                                  03100000
031100     IF RC112-ASNHDR-NBR           NOT = PV-PREV-ASN-HDR          03110000
031200        ADD 1                         TO PV-ASN-CNT               03120000
031210                                         PV-TOT-ASN-CNT           03121052
031300     END-IF.                                                      03130000
031310                                                                  03131001
031370     MOVE 1                      TO version.                      03137001
031380     MOVE 'SEPHORA'              TO sender.                       03138001
031390     MOVE 'KOHLS'                TO receiver.                     03139001
031391     MOVE 03                     TO opCompany.                    03139101
031392     MOVE RC112-EDI-VEND-ID      TO vendorId.                     03139201
031393     MOVE RC112-ASNHDR-NBR       TO shipmentIdentificationNumber. 03139301
031394                                                                  03139456
031395     MOVE RC112-DATE-SHIPPED     TO PV-SHIP-WORK.                 03139556
031396     MOVE PV-SHIP-WORK-CCYY      TO PV-SHIP-CCYY.                 03139656
031397     MOVE PV-SHIP-WORK-MM        TO PV-SHIP-MM.                   03139756
031398     MOVE PV-SHIP-WORK-DD        TO PV-SHIP-DD.                   03139856
031399     MOVE '-'                    TO PV-SHIP-DASH1                 03139956
031400                                    PV-SHIP-DASH2.                03140056
031401     MOVE PV-SHIP-DATE           TO dateShipped.                  03140156
031402                                                                  03140256
031403     MOVE 'RC'                   TO asnType.                      03140356
031404     MOVE SPACES                 TO tpLoadNbr.                    03140456
031405     MOVE 'NOREPLY@KOHLS.COM'    TO informationContact.           03140556
031406     MOVE RC112-CARRIER-SCAC-CODE                                 03140656
031407                                 TO scac.                         03140756
031408     MOVE RC112-BILL-OF-LADING-NBR                                03140856
031409                                 TO bolNbr.                       03140956
031410     MOVE RC112-PRO-NBR          TO proNbr.                       03141056
031411     MOVE RC112-CARTON-CNT-SHPMT TO totalCartonQty.               03141156
031412     MOVE RC112-SHIPMENT-WEIGHT  TO totalCartonWeight.            03141256
031413     MOVE RC112-DIST-CNTR        TO dc.                           03141356
031414     MOVE PV-CRE-TMST-FORMAT     TO creationTime.                 03141456
031415                                                                  03141556
031416     PERFORM 4100-GET-LOC-ADDRESS.                                03141656
031417                                                                  03141756
031418     MOVE XLT00010-LNE-1-ADDR    TO addressLine.                  03141856
031419     MOVE XLT00010-CTY-NM        TO city.                         03141956
031420     MOVE XLT00010-ST-CDE        TO state.                        03142056
031421     MOVE XLT00010-ZIP-10-CDE    TO PV-ZIP-CODE-WORK.             03142156
031430     MOVE PV-ZIP-CODE-1-5        TO zip.                          03143056
033700                                                                  03370000
033800                                                                  03380000
033900****************************************************************  03390000
034000*   BUILD PO XML INFO         - RCRD114                           03400000
034100****************************************************************  03410000
034200 2200-BUILD-PO-DTL.                                               03420000
034201                                                                  03420101
034400     IF RC112-PO-NBR               NOT = PV-PREV-PO               03440000
034500        ADD 1                         TO PV-PO-CNT                03450000
034510                                         PV-TOT-PO-CNT            03451001
034600     END-IF.                                                      03460000
034700                                                                  03470000
034800     MOVE RC112-PO-NBR          TO poNumber.                      03480000
034900     MOVE RC112-CARTON-CNT-PO   TO poCtnQty.                      03490000
034910                                                                  03491039
034920     PERFORM 4200-GET-VENDOR-PO.                                  03492039
034921     PERFORM 4210-GET-SEASONAL-SET.                               03492164
034930                                                                  03493039
035000     MOVE INSTCD-INSTR-DESC(1:10) TO vendorPoNbr.                 03500039
035010     MOVE PURCHS-SEASET-YR        TO setYear.                     03501064
035020     MOVE PURCHS-SEASET-SHRT-NM   TO setShortName.                03502064
035100     MOVE RC112-DIST-CNTR         TO dcNumber.                    03510039
035200     MOVE SPACES                  TO masterCartonId.              03520046
035300                                                                  03530000
035400                                                                  03540000
035500****************************************************************  03550000
035600*   BUILD SSCC HEADER INFO    - RCRD115                           03560000
035700****************************************************************  03570000
035800 2300-BUILD-SSCC-HDR.                                             03580000
035900                                                                  03590000
036000     IF RC112-CARTON-NBR           NOT = PV-PREV-SSCC             03600000
036100        ADD 1                         TO PV-SSCC-CNT              03610000
036110                                         PV-TOT-SSCC-CNT          03611001
036200     END-IF.                                                      03620000
036300                                                                  03630000
036310     string '00'  RC112-CARTON-NBR-CHAR delimited by size         03631065
036400                                   INTO cartonId.                 03640065
036500                                                                  03650000
036600                                                                  03660000
036700****************************************************************  03670000
036800*   BUILD SSCC UPC INFO       - RCRD117                           03680001
036900****************************************************************  03690000
037000 2400-BUILD-SSCC-UPC.                                             03700000
037100                                                                  03710000
037210     ADD  1  TO  PV-SSCC-DTL-CNT                                  03721001
037220                 PV-TOT-SSCC-DTL-CNT.                             03722001
037230                                                                  03723001
037400     MOVE RC112-PO-LINE-NBR      TO lineNumber.                   03740057
037410     MOVE RC112-SKU-NBR          TO skuNumber.                    03741057
037500     MOVE RC112-UPC-NBR          TO upcNumber.                    03750062
037510     IF  RC112-CARTON-NBR  >  0                                   03751062
037600         MOVE RC112-CARTON-QTY    TO unitQuantity                 03760062
037610     ELSE                                                         03761062
037620         MOVE RC112-DIST-PACK-QTY TO unitQuantity                 03762062
037630     END-IF.                                                      03763062
037700                                                                  03770000
037800                                                                  03780000
037900****************************************************************  03790000
038000*   CREATE XML BANNER                                             03800000
038100****************************************************************  03810000
038200 2500-CREATE-XML-BANNER.                                          03820001
038300                                                                  03830001
038400     SET X1 TO XML-LENGTH.                                        03840001
038500     PERFORM UNTIL X1 = 0                                         03850001
038600       MOVE PV-XML2-CHAR (X1) TO PV-XML2-CHAR (X1 + 38)           03860001
038700       MOVE SPACE TO PV-XML2-CHAR (X1)                            03870001
038800       SET X1 DOWN BY 1                                           03880001
038900     END-PERFORM.                                                 03890001
039000                                                                  03900001
039100     MOVE PV-XML-BANNER TO                                        03910008
039200          PV-XML (1:LENGTH OF PV-XML-BANNER).                     03920009
039300                                                                  03930001
039400     ADD LENGTH OF PV-XML-BANNER TO XML-LENGTH.                   03940008
039500                                                                  03950000
039600                                                                  03960000
039700****************************************************************  03970000
039800*   generate xml for the header - rcrd113                         03980001
039900****************************************************************  03990000
040000 3100-GENERATE-XML-ASN-HDR.                                       04000000
040100                                                                  04010000
040200     MOVE SPACES TO PV-XML.                                       04020000
040300                                                                  04030000
040400     XML GENERATE PV-XML                                          04040000
040500         FROM asnHeader                                           04050032
040600         COUNT IN XML-LENGTH                                      04060000
040700         ON EXCEPTION                                             04070000
040710             DISPLAY ' '                                          04071046
040711             DISPLAY '3100-GENERATE-XML-ASN-HDR'                  04071146
040720             DISPLAY 'ASN: ' RC112-ASNHDR-NBR                     04072045
040730             DISPLAY 'DC:  ' RC112-DIST-CNTR                      04073045
040740             DISPLAY 'PO:  ' RC112-PO-NBR                         04074045
040750             DISPLAY ' '                                          04075046
040800             PERFORM 8500-XML-ERROR                               04080000
040900         NOT ON EXCEPTION                                         04090000
041000             ADD +1 TO PV-XML-OUT                                 04100000
041100*            PERFORM 8600-REPLACE-XML                             04110041
041200             PERFORM 8700-XML-SUCCESS                             04120000
041300     END-XML.                                                     04130000
041400                                                                  04140042
041410***  INSPECT PV-xml REPLACING ALL                                 04141043
041420***          '<tpLoadNbr> </tpLoadNbr>'          BY               04142043
041430***          '<tpLoadNbr></tpLoadNbr> '                           04143043
041440***  subtract 1 from  PV-XML-LENGTH-X.                            04144043
041450                                                                  04145042
041500                                                                  04150000
041540     MOVE PV-XML(1:XML-LENGTH)       TO pv-msgbuffer-data-1.      04154008
041561                                                                  04156108
041570     display 'XML-LENGTH'  XML-LENGTH                             04157008
041580     COMPUTE PV-MSG-LENGTH = XML-LENGTH                           04158008
041592     DISPLAY ' PV-MSG-LENGTH = ' PV-MSG-LENGTH                    04159208
041593     MOVE PV-MSG-LENGTH TO PV-MSG-LENGTH-DISPLAY.                 04159308
041600                                                                  04160000
041610                                                                  04161001
041700****************************************************************  04170000
041800*   generate xml for po       - RCRD114                           04180001
041900****************************************************************  04190000
042000 3200-GENERATE-XML-PO-DTL.                                        04200000
042100                                                                  04210000
042200     MOVE SPACES TO PV-XML.                                       04220000
042300                                                                  04230000
042400     XML GENERATE PV-XML                                          04240000
042500         FROM asnDetail                                           04250031
042600         COUNT IN XML-LENGTH                                      04260000
042700         ON EXCEPTION                                             04270000
042701             display ' '                                          04270146
042710             DISPLAY '3200-GENERATE-XML-PO-DTL'                   04271045
042720             DISPLAY 'ASN: ' RC112-ASNHDR-NBR                     04272045
042730             DISPLAY 'DC:  ' RC112-DIST-CNTR                      04273045
042740             DISPLAY 'PO:  ' RC112-PO-NBR                         04274045
042750             DISPLAY ' '                                          04275046
042800             PERFORM 8500-XML-ERROR                               04280000
042900         NOT ON EXCEPTION                                         04290000
043000             ADD +1 TO PV-XML-OUT                                 04300000
043100*            PERFORM 8600-REPLACE-XML                             04310041
043200             PERFORM 8700-XML-SUCCESS                             04320000
043300     END-XML.                                                     04330000
043400                                                                  04340000
043401        INSPECT PV-xml REPLACING ALL                              04340133
043402        '</masterCartonInfo>'               BY                    04340233
043403        '                   '                                     04340333
043404        move 19  to PV-XML-LENGTH-X                               04340433
043410                                                                  04341033
043411        INSPECT PV-xml REPLACING ALL                              04341133
043412        '</dcLocationDetail>'               BY                    04341233
043413        '                   '                                     04341333
043414        add  19  to PV-XML-LENGTH-X                               04341433
043415                                                                  04341533
043416        INSPECT PV-xml REPLACING ALL                              04341633
043417        '</dcDetail>'                       BY                    04341733
043418        '           '                                             04341833
043419        add  11  to PV-XML-LENGTH-X                               04341933
043420                                                                  04342033
043421        INSPECT PV-xml REPLACING ALL                              04342133
043422        '</poInfo>'                         BY                    04342233
043423        '         '                                               04342333
043424        add   9  to PV-XML-LENGTH-X                               04342433
043425                                                                  04342533
043426        INSPECT PV-xml REPLACING ALL                              04342633
043427        '</asnDetail>'                      BY                    04342733
043428        '            '                                            04342833
043429        add  12  to PV-XML-LENGTH-X                               04342933
043430                                                                  04343042
043431***  if not sscc data - do not send these tags                    04343159
043432        IF  RC112-CARTON-NBR   >  0                               04343259
043433            CONTINUE                                              04343359
043434        ELSE                                                      04343459
043435                                                                  04343559
043436            INSPECT PV-xml REPLACING ALL                          04343659
043437            '<masterCartonInfo>'            BY                    04343759
043438            '                  '                                  04343859
043444            move 18  to PV-XML-LENGTH-X                           04344459
043445                                                                  04344559
043446            INSPECT PV-xml REPLACING ALL                          04344659
043447            '<masterCartonId>'              BY                    04344759
043448            '                '                                    04344859
043454            move 16  to PV-XML-LENGTH-X                           04345459
043455                                                                  04345563
043456            INSPECT PV-xml REPLACING ALL                          04345663
043457            '</masterCartonId>'             BY                    04345763
043458            '                 '                                   04345863
043464            move 17  to PV-XML-LENGTH-X                           04346463
043465        END-IF                                                    04346559
043466***                                                               04346659
043467                                                                  04346759
043468        Compute PV-XML-LENGTH-NEW = PV-XML-LENGTH-NEW             04346831
043469                                   - PV-XML-LENGTH-X              04346931
043470     MOVE PV-XML(1:XML-LENGTH)       TO pv-msgbuffer-data-1.      04347011
043471                                                                  04347111
043472     display 'XML-LENGTH'  XML-LENGTH                             04347211
043473     COMPUTE PV-MSG-LENGTH = XML-LENGTH                           04347311
043474     DISPLAY ' PV-MSG-LENGTH = ' PV-MSG-LENGTH                    04347411
043475     MOVE PV-MSG-LENGTH TO PV-MSG-LENGTH-DISPLAY.                 04347511
043480                                                                  04348001
043500                                                                  04350000
043600****************************************************************  04360000
043700*   generate xml for sscc header - rcrd115                        04370001
043800****************************************************************  04380000
043900 3300-GENERATE-XML-SSCC-HDR.                                      04390003
044000                                                                  04400000
044100     MOVE SPACES TO PV-XML.                                       04410000
044200                                                                  04420000
044300     XML GENERATE PV-XML                                          04430000
044400         FROM cartonInfo                                          04440034
044500         COUNT IN XML-LENGTH                                      04450000
044600         ON EXCEPTION                                             04460000
044610             DISPLAY ' '                                          04461046
044611             DISPLAY '3300-GENERATE-XML-SSCC-HDR'                 04461146
044620             DISPLAY 'ASN: ' RC112-ASNHDR-NBR                     04462045
044630             DISPLAY 'DC:  ' RC112-DIST-CNTR                      04463045
044640             DISPLAY 'PO:  ' RC112-PO-NBR                         04464045
044650             DISPLAY 'SSCC:' RC112-CARTON-NBR                     04465045
044700             display ' '                                          04470046
044710             PERFORM 8500-XML-ERROR                               04471046
044800         NOT ON EXCEPTION                                         04480000
044900             ADD +1 TO PV-XML-OUT                                 04490000
045000*            PERFORM 8600-REPLACE-XML                             04500041
045100             PERFORM 8700-XML-SUCCESS                             04510000
045200     END-XML.                                                     04520000
045400                                                                  04540000
045500        INSPECT PV-xml REPLACING ALL                              04550034
045510        '</cartonInfo>'               BY                          04551034
045511        '             '                                           04551134
045512        move 13  to PV-XML-LENGTH-X                               04551234
045520     MOVE PV-XML(1:XML-LENGTH)       TO pv-msgbuffer-data-1.      04552011
045530                                                                  04553011
045570     display 'XML-LENGTH'  XML-LENGTH                             04557011
045580     COMPUTE PV-MSG-LENGTH = XML-LENGTH                           04558011
045592     DISPLAY ' PV-MSG-LENGTH = ' PV-MSG-LENGTH                    04559211
045593     MOVE PV-MSG-LENGTH TO PV-MSG-LENGTH-DISPLAY.                 04559311
045600                                                                  04560000
046300                                                                  04630000
046310****************************************************************  04631001
046320*   generate xml for sscc detail - rcrd117                        04632001
046330****************************************************************  04633001
046340 3400-GENERATE-XML-SSCC-DTL.                                      04634001
046350                                                                  04635001
046360     MOVE SPACES TO PV-XML.                                       04636001
046370                                                                  04637001
046380     XML GENERATE PV-XML                                          04638001
046390         FROM skuInfo                                             04639034
046391         COUNT IN XML-LENGTH                                      04639101
046392         ON EXCEPTION                                             04639201
046393             DISPLAY ' '                                          04639346
046394             DISPLAY '3400-GENERATE-XML-SSCC-DTL'                 04639446
046395             DISPLAY 'ASN: ' RC112-ASNHDR-NBR                     04639546
046396             DISPLAY 'DC:  ' RC112-DIST-CNTR                      04639646
046397             DISPLAY 'PO:  ' RC112-PO-NBR                         04639746
046398             DISPLAY 'SSCC:' RC112-CARTON-NBR                     04639846
046399             DISPLAY 'LINE:' RC112-PO-LINE-NBR                    04639957
046400             DISPLAY ' '                                          04640057
046401             PERFORM 8500-XML-ERROR                               04640157
046402         NOT ON EXCEPTION                                         04640257
046403             ADD +1 TO PV-XML-OUT                                 04640357
046404*            PERFORM 8600-REPLACE-XML                             04640457
046405             PERFORM 8700-XML-SUCCESS                             04640557
046406     END-XML.                                                     04640657
046407                                                                  04640757
046408     MOVE PV-XML(1:XML-LENGTH)       TO pv-msgbuffer-data-1.      04640857
046409                                                                  04640957
046410     display 'XML-LENGTH'  XML-LENGTH                             04641057
046411     COMPUTE PV-MSG-LENGTH = XML-LENGTH                           04641157
046412                           + LENGTH OF PV-XML-BANNER              04641257
046413                           + LENGTH OF PV-XML-SHIP-NOTC           04641357
046414     DISPLAY ' PV-MSG-LENGTH = ' PV-MSG-LENGTH                    04641457
046415     MOVE PV-MSG-LENGTH TO PV-MSG-LENGTH-DISPLAY.                 04641557
046416                                                                  04641657
046417                                                                  04641757
046418******************************************************************04641857
046419*                                                                *04641957
046420******************************************************************04642057
046430 3800-CREATE-HDR-MESSAGE.                                         04643020
046440                                                                  04644020
046441     PERFORM 3810-BUILD-XML-HEADER.                               04644120
046442                                                                  04644220
046443     MOVE SPACES TO PV-XML.                                       04644320
046444                                                                  04644420
046445     XML GENERATE PV-XML                                          04644520
046446         FROM Header                                              04644620
046447         COUNT IN XML-LENGTH                                      04644720
046448         WITH ATTRIBUTES                                          04644820
046449         ON EXCEPTION                                             04644920
046450             DISPLAY ' '                                          04645046
046451             DISPLAY Header ' PV=' PV-XML                         04645120
046452             DISPLAY ' '                                          04645246
046453             DISPLAY '3800-CREATE-HDR-MESSAGE'                    04645346
046454             DISPLAY 'ASN: ' RC112-ASNHDR-NBR                     04645446
046455             DISPLAY 'DC:  ' RC112-DIST-CNTR                      04645546
046456             DISPLAY 'PO:  ' RC112-PO-NBR                         04645646
046457             DISPLAY ' '                                          04645746
046458             PERFORM 8500-XML-ERROR                               04645846
046459         NOT ON EXCEPTION                                         04645946
046460             CONTINUE                                             04646046
046461     END-XML.                                                     04646146
046462                                                                  04646246
046463     MOVE PV-XML-BANNER              TO PV-MSGBUFFER-banner.      04646346
046464     MOVE PV-XML-SHIP-NOTC           TO PV-MSGBUFFER-ship-NOTC.   04646446
046465     MOVE PV-XML(1:XML-LENGTH)       TO pv-msgbuffer-data-1.      04646546
046466**   display pv-msgbuffer-banner.                                 04646646
046467***  display pv-msgbuffer-data-1                                  04646746
046468     display 'XML-LENGTH'  XML-LENGTH                             04646846
046469     COMPUTE PV-MSG-LENGTH = XML-LENGTH                           04646946
046470                           + LENGTH OF PV-XML-BANNER              04647046
046471                           + LENGTH OF PV-XML-SHIP-NOTC           04647146
046472     DISPLAY ' PV-MSG-LENGTH = ' PV-MSG-LENGTH                    04647246
046473     MOVE PV-MSG-LENGTH TO PV-MSG-LENGTH-DISPLAY.                 04647346
046474                                                                  04647446
046475     PERFORM 8100-WRITE-OUTPUT.                                   04647546
046476                                                                  04647646
046477****************************************                          04647746
046478*** <asn>                                                         04647846
046479****************************************                          04647946
046480                                                                  04648028
046481     MOVE   5  TO   PV-MSG-LENGTH                                 04648128
046482     MOVE PV-XML-ASN        TO PV-MSGBUFFER                       04648228
046483                                                                  04648328
046484     PERFORM 6000-WRITE-VARIABLE-REC.                             04648429
046485                                                                  04648528
046486                                                                  04648620
046507                                                                  04650727
046508                                                                  04650827
046509******************************************************************04650920
046510*  BUILD AND WRITE XML Header                                     04651020
046511*   <?xml version="1.0" encoding="UTF-8"?>                        04651120
046512*   <Shipment>                                                    04651220
046513*   <Header>                                                      04651320
046514*       <HEADER_SOURCE>MAINFRAME</HEADER_SOURCE>                  04651420
046515*       <HEADER_DESTINATION>RDCWMS</HEADER_DESTINATION>           04651520
046516*       <HEADER_CREATIONTIME>yyyymmddhhmmss</HEADER_CREATIONTIME> 04651620
046517*   </Header>                                                     04651720
046518******************************************************************04651820
046519 3810-BUILD-XML-HEADER.                                           04651920
046520                                                                  04652020
046521     MOVE PV-HEADER-SOURCE        TO HEADER_SOURCE.               04652120
046522     MOVE PV-HEADER-DEST          TO HEADER_DESTINATION.          04652220
046523     MOVE PV-CRE-TMST-HEADER      TO HEADER_CREATIONTIME.         04652320
046524                                                                  04652420
046525                                                                  04652520
046526******************************************************************04652620
046527*                                                                *04652720
046528******************************************************************04652820
046529 4000-GET-CURRENT-TMST.                                           04652920
046530                                                                  04653020
046531     EXEC SQL                                                     04653120
046532          SELECT CURRENT TIMESTAMP                                04653220
046533            INTO :PV-CURRENT-TMST                                 04653320
046534            FROM SYSIBM.SYSDUMMY1                                 04653420
046540     END-EXEC.                                                    04654001
046600                                                                  04660001
046700     MOVE PV-CURR-DATE       TO   PV-CURR-REFMT-DATE.             04670001
046800     MOVE PV-CURR-HR         TO   PV-CURR-REFMR-HR.               04680001
046900     MOVE PV-CURR-MIN        TO   PV-CURR-REFMT-MIN.              04690001
047000     MOVE PV-CURR-SEC        TO   PV-CURR-REFMT-SEC.              04700001
047100     MOVE PV-CURR-MICRO      TO   PV-CURR-REFMT-MICRO.            04710001
047200                                                                  04720001
047300     MOVE ':'                TO  PV-CURR-REFMT-COLON-1            04730001
047400                                 PV-CURR-REFMT-COLON-2.           04740001
047500     MOVE 'T'                TO  PV-CURR-REFMT-T.                 04750001
047600     MOVE '.'                TO  PV-CURR-REFMT-DOT.               04760001
047700                                                                  04770001
047711     MOVE PV-CURR-YEAR       TO  PV-CURR-HEADER-YEAR              04771122
047713     MOVE PV-CURR-MONTH      TO  PV-CURR-HEADER-MONTH             04771322
047715     MOVE PV-CURR-DAY        TO  PV-CURR-HEADER-DAY               04771522
047720     MOVE PV-CURR-HR         TO  PV-CURR-HEADER-HR.               04772020
047730     MOVE PV-CURR-MIN        TO  PV-CURR-HEADER-MIN.              04773020
047740     MOVE PV-CURR-SEC        TO  PV-CURR-HEADER-SEC.              04774020
047750                                                                  04775020
047800     DISPLAY 'CURRENT TIMESTAMP:  '  PV-CURRENT-TMST.             04780001
047900     DISPLAY 'REFORMAT TMST:      '  PV-CRE-TMST-FORMAT.          04790001
047910     DISPLAY 'HEADER DATE:        '  PV-CRE-TMST-HEADER.          04791020
048000                                                                  04800001
048100                                                                  04810001
048200******************************************************************04820001
048300*                                                                *04830001
048400******************************************************************04840001
048600 4100-GET-LOC-ADDRESS.                                            04860001
048700     MOVE RC112-DIST-CNTR       TO  XLT00010-LOC-NBR              04870001
048800                                                                  04880001
048900     EXEC SQL                                                     04890001
049000          SELECT LNE_1_ADDR                                       04900001
049100               , CTY_NM                                           04910001
049200               , ST_CDE                                           04920001
049300               , ZIP_10_CDE                                       04930001
049400            INTO :XLT00010-LNE-1-ADDR                             04940001
049500               , :XLT00010-CTY-NM                                 04950001
049600               , :XLT00010-ST-CDE                                 04960001
049700               , :XLT00010-ZIP-10-CDE                             04970001
049800            FROM  XLT_LOC                                         04980001
049900          WHERE  LOC_NBR         = :XLT00010-LOC-NBR              04990001
050000           WITH UR                                                05000001
050100     END-EXEC.                                                    05010001
050200                                                                  05020001
050300     EVALUATE TRUE                                                05030001
050400         WHEN SQLCODE = ZERO                                      05040001
050500              CONTINUE                                            05050001
050600         WHEN SQLWARN0 NOT = SPACES                               05060001
050700         WHEN SQLCODE < +0                                        05070001
050800         WHEN SQLCODE > +0                                        05080001
050900             MOVE SQLCODE          TO  PV-DISP-SQL                05090001
051000             DISPLAY ' '                                          05100001
051100             DISPLAY 'SQL ERROR:    '                             05110001
051200             DISPLAY 'ASNHDR:       ' RC112-ASNHDR-NBR            05120001
051300             DISPLAY 'DC NBR:       ' RC112-DIST-CNTR             05130001
051400             DISPLAY ' '                                          05140001
051500                                                                  05150001
051600             DISPLAY '******************************************' 05160001
051700             DISPLAY '*ABEND                                   *' 05170001
051800             DISPLAY '*PROGRAM   = RCKUT188                    *' 05180051
051900             DISPLAY '*DB2 OPER  = SELECT ON XLT_LOC           *' 05190001
052000             DISPLAY '*PARAGRAPH = 4100-GET-LOC-ADDRESS        *' 05200001
052100             DISPLAY '*SQLCODE = ' PV-DISP-SQL                    05210001
052200             DISPLAY '******************************************' 05220001
052300             PERFORM 9100-SQL-ABEND                               05230001
052400     END-EVALUATE.                                                05240001
052500                                                                  05250001
052600                                                                  05260001
052610******************************************************************05261039
052620*                                                                *05262039
052630******************************************************************05263039
052640 4200-GET-VENDOR-PO.                                              05264039
052641                                                                  05264139
052650     MOVE RC112-PO-NBR          TO  POINST-PO-NBR.                05265039
052660                                                                  05266039
052670     EXEC SQL                                                     05267039
052680          SELECT RTRIM(SUBSTR(INSTR_DESC,13,10))                  05268039
052690            INTO :INSTCD-INSTR-DESC                               05269039
052700            FROM TINSTCD A                                        05270039
052701               , TPOINST B                                        05270139
052702           WHERE UPPER(A.INSTR_DESC) LIKE 'SEPHORA PO #%'         05270239
052703             AND B.INSTR_NBR = A.INSTR_NBR                        05270339
052704             AND B.RECIP_CDE = 'VN'                               05270439
052705             AND B.PO_NBR = :POINST-PO-NBR                        05270539
052706            WITH UR                                               05270639
052707     END-EXEC.                                                    05270739
052708                                                                  05270839
052709     EVALUATE TRUE                                                05270939
052710         WHEN SQLCODE = ZERO                                      05271039
052711              CONTINUE                                            05271139
052712         WHEN SQLCODE = +100                                      05271239
052713         WHEN SQLCODE = -305                                      05271339
052714              MOVE SPACES  TO  INSTCD-INSTR-DESC                  05271439
052715         WHEN SQLWARN0 NOT = SPACES                               05271539
052716         WHEN SQLCODE < +0                                        05271639
052717         WHEN SQLCODE > +0                                        05271739
052718             MOVE SQLCODE          TO  PV-DISP-SQL                05271839
052719             DISPLAY ' '                                          05271939
052720             DISPLAY 'SQL ERROR:    '                             05272039
052721             DISPLAY 'ASNHDR:       ' RC112-ASNHDR-NBR            05272139
052722             DISPLAY 'DC NBR:       ' RC112-DIST-CNTR             05272239
052723             DISPLAY 'po NBR:       ' RC112-PO-NBR                05272339
052724             DISPLAY ' '                                          05272439
052725                                                                  05272539
052726             DISPLAY '******************************************' 05272639
052727             DISPLAY '*ABEND                                   *' 05272739
052728             DISPLAY '*PROGRAM   = RCKUT188                    *' 05272851
052729             DISPLAY '*DB2 OPER  = SELECT ON TINSTCD & TPOINST *' 05272964
052730             DISPLAY '*PARAGRAPH = 4200-GET-VENDOR-PO          *' 05273039
052731             DISPLAY '*SQLCODE = ' PV-DISP-SQL                    05273139
052732             DISPLAY '******************************************' 05273239
052733             PERFORM 9100-SQL-ABEND                               05273339
052734     END-EVALUATE.                                                05273439
052735                                                                  05273539
052736                                                                  05273639
052737******************************************************************05273764
052738*                                                                *05273864
052739******************************************************************05273964
052740 4210-GET-SEASONAL-SET.                                           05274064
052741                                                                  05274164
052742     MOVE RC112-PO-NBR          TO  PURCHS-PO-NBR.                05274264
052743                                                                  05274364
052744     EXEC SQL                                                     05274464
052745          SELECT SEASET_YR                                        05274564
052746               , SEASET_SHRT_NM                                   05274664
052747            INTO :PURCHS-SEASET-YR                                05274764
052748               , :PURCHS-SEASET-SHRT-NM                           05274864
052749            FROM TPURCHS                                          05274964
052754           WHERE PO_NBR         = :PURCHS-PO-NBR                  05275464
052755             AND VER_STATUS_CDE = 'A'                             05275564
052756            WITH UR                                               05275664
052757     END-EXEC.                                                    05275764
052758                                                                  05275864
052759     EVALUATE TRUE                                                05275964
052760         WHEN SQLCODE = ZERO                                      05276064
052761              CONTINUE                                            05276164
052762         WHEN SQLCODE = +100                                      05276264
052763         WHEN SQLCODE = -305                                      05276364
052764              MOVE SPACES  TO  PURCHS-SEASET-YR                   05276464
052765                               PURCHS-SEASET-SHRT-NM              05276564
052766         WHEN SQLWARN0 NOT = SPACES                               05276664
052767         WHEN SQLCODE < +0                                        05276764
052768         WHEN SQLCODE > +0                                        05276864
052769             MOVE SQLCODE          TO  PV-DISP-SQL                05276964
052770             DISPLAY ' '                                          05277064
052771             DISPLAY 'SQL ERROR:    '                             05277164
052772             DISPLAY 'ASNHDR:       ' RC112-ASNHDR-NBR            05277264
052773             DISPLAY 'DC NBR:       ' RC112-DIST-CNTR             05277364
052774             DISPLAY 'PO NBR:       ' RC112-PO-NBR                05277464
052775             DISPLAY ' '                                          05277564
052776                                                                  05277664
052777             DISPLAY '******************************************' 05277764
052778             DISPLAY '*ABEND                                   *' 05277864
052779             DISPLAY '*PROGRAM   = RCKUT188                    *' 05277964
052780             DISPLAY '*DB2 OPER  = SELECT ON TPURCHS           *' 05278064
052781             DISPLAY '*PARAGRAPH = 4210-GET-SEASONAL-SET       *' 05278164
052782             DISPLAY '*SQLCODE = ' PV-DISP-SQL                    05278264
052783             DISPLAY '******************************************' 05278364
052784             PERFORM 9100-SQL-ABEND                               05278464
052785     END-EVALUATE.                                                05278564
052786                                                                  05278664
052787                                                                  05278764
052788***************************************************************   05278864
052789*  File length max set to 32000. If record is longer , the write  05278964
052790*  needs to be split to 2 rows. Also, cannot be split in the      05279064
052791*  middle of a tag or value.  Inspect for PC-END-TAG '>' in the   05279164
052792*  last 50 bytes and then calculate the first and second write    05279264
052793***************************************************************   05279364
052794 6000-WRITE-VARIABLE-REC.                                         05279464
052795     MOVE SPACES           TO ASN-OUTPUT-RECORD.                  05279564
052796                                                                  05279664
052797     IF XML-LENGTH    >  32000                                    05279764
052798        DISPLAY 'Record XML EXCEEDS 32000'                        05279864
052799        MOVE XML-LENGTH  TO PV-XML-LENGTH-NEW                     05279964
052800                                                                  05280064
052801        MOVE +0 TO  PV-CHAR-COUNT                                 05280164
052802                                                                  05280264
052803        MOVE PV-MSGBUFFER(31950:32000) to PV-LAST-50-BYTES        05280364
052804                                                                  05280464
052805        INSPECT PV-LAST-50-BYTES TALLYING PV-CHAR-COUNT FOR       05280564
052806                 CHARACTERS BEFORE PC-END-TAG                     05280664
052807        COMPUTE PV-XML-LENGTH-X = 31950 + PV-CHAR-COUNT           05280764
052808                                                                  05280864
052809        MOVE PV-XML-LENGTH-X  TO PV-BYTE-COUNT                    05280964
052810        MOVE PV-MSGBUFFER(1:PV-XML-LENGTH-X)    TO                05281064
052811                                 PV-VARIABLE-OUTPUT-FIELD         05281164
052812                                                                  05281264
052813***     INSPECT PV-VARIABLE-OUTPUT-FIELD REPLACING ALL            05281364
052814***     '<UPCData UPCNumber="X"></UPCData>' BY                    05281464
052815***     '                                 '                       05281564
052816***     Compute PV-XML-LENGTH-NEW = PV-XML-LENGTH-NEW             05281664
052817***                                - PV-XML-LENGTH-X              05281764
052818                                                                  05281864
052819        MOVE PV-VARIABLE-OUTPUT-FIELD   TO ASN-OUTPUT-RECORD      05281964
052820        WRITE ASN-OUTPUT-RECORD                                   05282064
052821                                                                  05282164
052822        IF PV-XML-LENGTH-NEW   >  32000                           05282264
052823           PERFORM 6005-FORMAT-VARIABLE-REC                       05282364
052824        ELSE                                                      05282464
052825          MOVE SPACES           TO ASN-OUTPUT-RECORD              05282564
052826                                   PV-VARIABLE-OUTPUT-FIELD       05282664
052827          MOVE PV-XML-LENGTH-NEW    TO PV-BYTE-COUNT              05282764
052828          Add +1                    to PV-XML-LENGTH-X            05282864
052829          MOVE PV-MSGBUFFER(PV-XML-LENGTH-X:XML-LENGTH) TO        05282964
052830                                   PV-VARIABLE-OUTPUT-FIELD       05283064
052831                                                                  05283164
052832***       INSPECT PV-VARIABLE-OUTPUT-FIELD REPLACING ALL          05283264
052833***       '<UPCData UPCNumber="X"></UPCData>' BY                  05283364
052834***       '                                 '                     05283464
052835                                                                  05283564
052836          MOVE PV-VARIABLE-OUTPUT-FIELD   TO ASN-OUTPUT-RECORD    05283664
052837          WRITE ASN-OUTPUT-RECORD                                 05283764
052838        MOVE +0                      TO PV-XML-LENGTH             05283864
052839                                        PV-XML-LENGTH-X           05283964
052840                                        XML-LENGTH                05284064
052841        END-IF                                                    05284164
052842     ELSE                                                         05284264
052843        MOVE PV-MSG-LENGTH    TO PV-BYTE-COUNT                    05284364
052844        MOVE PV-MSGBUFFER     TO PV-VARIABLE-OUTPUT-FIELD         05284464
052845                                                                  05284564
052846***     INSPECT PV-VARIABLE-OUTPUT-FIELD REPLACING ALL            05284664
052847***     '<UPCData UPCNumber="X"></UPCData>' BY                    05284764
052848***     '                                 '                       05284864
052849        MOVE PV-VARIABLE-OUTPUT-FIELD   TO ASN-OUTPUT-RECORD      05284964
052850        WRITE ASN-OUTPUT-RECORD                                   05285064
052851        MOVE +0                      TO PV-XML-LENGTH             05285164
052852                                        PV-XML-LENGTH-X           05285264
052853                                        XML-LENGTH                05285364
052854     END-IF.                                                      05285464
052855                                                                  05285564
052856***************************************************************   05285664
052857*  PV-XML-LENGTH-NEW   =  orignal xml length less the             05285764
052858*   record already written                                        05285864
052859*  Paragraph only performed if record >  64000                    05285964
052860***************************************************************   05286064
052861 6005-FORMAT-VARIABLE-REC.                                        05286164
052862        DISPLAY 'Record XML EXCEEDS 64000'                        05286264
052863        MOVE SPACES TO PV-VARIABLE-OUTPUT-FIELD                   05286364
052864                       ASN-OUTPUT-RECORD                          05286464
052865        MOVE +0 TO  PV-CHAR-COUNT                                 05286564
052866                                                                  05286664
052867        COMPUTE PV-XML-LENGTH  = PV-XML-LENGTH-NEW -              05286764
052868                                      PV-XML-LENGTH-X             05286864
052869        ADD +1  TO PV-XML-LENGTH-X                                05286964
052870        COMPUTE PV-XML-LENGTH-BEG = PV-XML-LENGTH-X + 31950       05287064
052871        COMPUTE PV-XML-LENGTH-END = PV-XML-LENGTH-X + 32000       05287164
052872                                                                  05287264
052873        MOVE PV-MSGBUFFER(PV-XML-LENGTH-BEG:PV-XML-LENGTH-END)    05287364
052874                                     to PV-LAST-50-BYTES          05287464
052875        INSPECT PV-LAST-50-BYTES TALLYING PV-CHAR-COUNT FOR       05287564
052876                 CHARACTERS BEFORE PC-END-TAG                     05287664
052877        COMPUTE PV-XML-LENGTH-END = PV-XML-LENGTH-BEG             05287764
052878                                        + PV-CHAR-COUNT           05287864
052879        COMPUTE PV-BYTE-COUNT = PV-XML-LENGTH-END  -              05287964
052880                                PV-XML-LENGTH-X                   05288064
052881        Add +1 to PV-BYTE-COUNT                                   05288164
052882        MOVE PV-MSGBUFFER(PV-XML-LENGTH-X:PV-XML-LENGTH-END)      05288264
052883                            TO   PV-VARIABLE-OUTPUT-FIELD         05288364
052884        INSPECT PV-VARIABLE-OUTPUT-FIELD REPLACING ALL            05288464
052885        '<UPCData UPCNumber="X"></UPCData>' BY                    05288564
052886        '                                 '                       05288664
052887      MOVE PV-VARIABLE-OUTPUT-FIELD   TO ASN-OUTPUT-RECORD        05288764
052888      WRITE ASN-OUTPUT-RECORD                                     05288864
052889                                                                  05288964
052890      MOVE SPACES           TO ASN-OUTPUT-RECORD                  05289064
052891                               PV-VARIABLE-OUTPUT-FIELD           05289164
052892      COMPUTE PV-XML-LENGTH-BEG = PV-XML-LENGTH-END + 1           05289264
052893      COMPUTE PV-XML-LENGTH-END = PV-XML-LENGTH-BEG +             05289364
052894                                  PV-XML-LENGTH                   05289464
052895      MOVE PV-XML-LENGTH  to PV-BYTE-COUNT                        05289564
052896      MOVE PV-MSGBUFFER(PV-XML-LENGTH-BEG:PV-XML-LENGTH-END)      05289664
052897                                TO  PV-VARIABLE-OUTPUT-FIELD      05289764
052898                                                                  05289864
052899***   INSPECT PV-VARIABLE-OUTPUT-FIELD REPLACING ALL              05289964
052900***   '<UPCData UPCNumber="X"></UPCData>' BY                      05290064
052901***   '                                 '                         05290164
052902                                                                  05290264
052903      MOVE PV-VARIABLE-OUTPUT-FIELD   TO ASN-OUTPUT-RECORD        05290364
052904      WRITE ASN-OUTPUT-RECORD                                     05290464
052905      MOVE +0                      TO PV-XML-LENGTH               05290564
052906                                      PV-XML-LENGTH-X             05290664
052907                                      XML-LENGTH.                 05290764
052908                                                                  05290864
052909******************************************************************05290964
052910****************************************************************  05291064
052911*   RETREIVE XML LENGTHS                                          05291164
052920****************************************************************  05292064
053000*7700-RETEIVE-XML-LENGTHS.                                        05300000
053100*                                                                 05310000
053200*                                                                 05320000
053300* BRINGS BACK THE LENGTHS NEEDED TO BUILD ASN XML                 05330000
053400*                                                                 05340000
053500*    EXEC SQL                                                     05350000
053600*       SELECT A.INTGRTN_TYP_CDE, A.INTGRTN_TYP_DESC              05360000
053700*             ,B.ATTR_DEFN_SEQ_NBR, B.ATTR_DEFN_DESC              05370000
053800*             ,DIGITS(INT(C.ATTR_ELEM_NBR))  AS MAX_XML_LENGTH    05380000
053900*             ,DIGITS(INT(D.ATTR_ELEM_NBR))  AS CASE_HDR_LENGTH   05390000
054000*             ,DIGITS(INT(E.ATTR_ELEM_NBR))  AS CASE_DTL_LENGTH   05400000
054100*             ,DIGITS(INT(F.ATTR_ELEM_NBR))  AS ASN_DTL_LENGTH    05410000
054200*             ,DIGITS(INT(G.ATTR_ELEM_NBR))  AS ASN_HDR_LENGTH    05420000
054300*             ,DIGITS(INT(H.ATTR_ELEM_NBR))  AS APPT_LENGTH       05430000
054400*       INTO   :WST00008-INTGRTN-TYP-CDE                          05440000
054500*             ,:WST00008-INTGRTN-TYP-DESC                         05450000
054600*             ,:WST00009-ATTR-DEFN-SEQ-NBR                        05460000
054700*             ,:WST00009-ATTR-DEFN-DESC                           05470000
054800*             ,:WMLENGTH-MAX-XML-LENGTH                           05480000
054900*             ,:WMLENGTH-CASE-HDR-LENGTH                          05490000
055000*             ,:WMLENGTH-CASE-DTL-LENGTH                          05500000
055100*             ,:WMLENGTH-ASN-DTL-LENGTH                           05510000
055200*             ,:WMLENGTH-ASN-HEADER-LENGTH                        05520000
055300*             ,:WMLENGTH-APPT-LENGTH                              05530000
055400*       FROM    WST_INTGRTN_TYP A                                 05540000
055500*              ,WST_ATTR_DEFN   B                                 05550000
055600*              ,WST_ATTR_ELEM   C                                 05560000
055700*              ,WST_ATTR_ELEM   D                                 05570000
055800*              ,WST_ATTR_ELEM   E                                 05580000
055900*              ,WST_ATTR_ELEM   F                                 05590000
056000*              ,WST_ATTR_ELEM   G                                 05600000
056100*              ,WST_ATTR_ELEM   H                                 05610000
056200*      WHERE A.INTGRTN_TYP_CDE    =  'XMLLENGTH'                  05620000
056300*        AND A.INTGRTN_TYP_CDE    =  B.INTGRTN_TYP_CDE            05630000
056400*        AND A.INTGRTN_TYP_CDE    =  C.INTGRTN_TYP_CDE            05640000
056500*        AND A.INTGRTN_TYP_CDE    =  D.INTGRTN_TYP_CDE            05650000
056600*        AND A.INTGRTN_TYP_CDE    =  E.INTGRTN_TYP_CDE            05660000
056700*        AND A.INTGRTN_TYP_CDE    =  F.INTGRTN_TYP_CDE            05670000
056800*        AND A.INTGRTN_TYP_CDE    =  G.INTGRTN_TYP_CDE            05680000
056900*        AND A.INTGRTN_TYP_CDE    =  H.INTGRTN_TYP_CDE            05690000
057000*        AND B.ATTR_DEFN_SEQ_NBR  =  1                            05700000
057100*        AND C.ATTR_DEFN_SEQ_NBR  =  1                            05710000
057200*        AND D.ATTR_DEFN_SEQ_NBR  =  2                            05720000
057300*        AND E.ATTR_DEFN_SEQ_NBR  =  3                            05730000
057400*        AND F.ATTR_DEFN_SEQ_NBR  =  4                            05740000
057500*        AND G.ATTR_DEFN_SEQ_NBR  =  5                            05750000
057600*        AND H.ATTR_DEFN_SEQ_NBR  =  6                            05760000
057700*        AND C.ATTR_ELEM_SEQ_NBR  =  D.ATTR_ELEM_SEQ_NBR          05770000
057800*        AND C.ATTR_ELEM_SEQ_NBR  =  E.ATTR_ELEM_SEQ_NBR          05780000
057900*        AND C.ATTR_ELEM_SEQ_NBR  =  F.ATTR_ELEM_SEQ_NBR          05790000
058000*        AND C.ATTR_ELEM_SEQ_NBR  =  G.ATTR_ELEM_SEQ_NBR          05800000
058100*        AND C.ATTR_ELEM_SEQ_NBR  =  H.ATTR_ELEM_SEQ_NBR          05810000
058200*    END-EXEC.                                                    05820000
058300*                                                                 05830000
058400*    EVALUATE TRUE                                                05840000
058500*      WHEN SQLCODE = ZERO                                        05850000
058600*           CONTINUE                                              05860000
058700*      WHEN SQLCODE NOT EQUAL ZERO                                05870000
058800*           MOVE '7700-RETEIVE-XML-LENGTHS'                       05880000
058900*                                      TO WS006-SQL-ERROR-PARA    05890000
059000*           MOVE '2'                   TO WS006-SUCCESS-IND       05900000
059100*           MOVE SQLCODE               TO WS006-SQLCODE           05910000
059200*              INITIALIZE PV-MSG-AREA                             05920000
059300*              MOVE SQLCODE         TO PV-DISP-SQL                05930003
059400*              STRING   ' ' WS006-SRC-TASK-NUMBER                 05940000
059500*                       ' RCKUT188-7700:'                         05950051
059600*                       ' ' WS006-OPER-UNT-ID                     05960000
059700*                       ' ' WS006-EXT-SHP-ID (1:15)               05970000
059800*                       ' ' WS006-USERID                          05980000
059900*                       ' SQLCODE=' PV-DISP-SQL                   05990003
060000*                       DELIMITED BY SIZE                         06000000
060100*                       INTO PV-MSG-AREA                          06010000
060200*             PERFORM 9900-GENERATE-XML-TO-LOG                    06020000
060300*          PERFORM 8995-RETURN                                    06030000
060400*    END-EVALUATE.                                                06040000
060500*                                                                 06050000
060600*                                                                 06060000
060700******************************************************************06070001
060800* READ INPUT ASN FILE                                            *06080001
060900******************************************************************06090001
061000 8000-READ-INPUT.                                                 06100001
061100                                                                  06110001
061200     READ  ASN-SEPHORA-SSCC-FILE                                  06120001
061300           INTO  RC112-ASN-TRANSCRIPTION-RECORD                   06130001
061400           AT END                                                 06140001
061500                 SET PS-END-OF-FILE  TO  TRUE                     06150001
061600           NOT AT END                                             06160001
061700                 ADD 1  TO  PV-READ-COUNT                         06170001
061800     END-READ.                                                    06180001
061900                                                                  06190001
062000                                                                  06200001
062100****************************************************************  06210001
062200*   WRITE header                                                  06220026
062300****************************************************************  06230001
062400 8100-WRITE-OUTPUT.                                               06240001
062500                                                                  06250001
062510     MOVE SPACES                   TO ASN-OUTPUT-RECORD           06251006
062520                                                                  06252006
062530     MOVE PV-MSG-LENGTH            TO PV-BYTE-COUNT               06253006
062540     MOVE PV-MSGBUFFER-1           TO PV-VARIABLE-OUTPUT-FIELD    06254006
062550                                                                  06255006
062560     MOVE PV-VARIABLE-OUTPUT-FIELD TO ASN-OUTPUT-RECORD           06256006
062570                                                                  06257006
062600     WRITE ASN-OUTPUT-RECORD.                                     06260006
062800                                                                  06280001
062900     ADD  1  TO  PV-OUT01-COUNT.                                  06290001
063000                                                                  06300001
063100****************************************************************  06310026
063200*   WRITE asn                                                     06320026
063300****************************************************************  06330026
063400 8110-WRITE-OUTPUT.                                               06340026
063500                                                                  06350026
063600     MOVE SPACES                   TO ASN-OUTPUT-RECORD           06360026
063700                                                                  06370026
063800     MOVE PV-MSG-LENGTH            TO PV-BYTE-COUNT               06380026
063900     MOVE PV-MSGBUFFER-data-1      TO PV-VARIABLE-OUTPUT-FIELD    06390026
064000                                                                  06400026
064100     MOVE PV-VARIABLE-OUTPUT-FIELD TO ASN-OUTPUT-RECORD           06410026
064200                                                                  06420026
064300     WRITE ASN-OUTPUT-RECORD.                                     06430026
064400                                                                  06440026
064500     ADD  1  TO  PV-OUT01-COUNT.                                  06450026
064600                                                                  06460026
080400****************************************************************  08040000
080500*   XML ERROR                                                  *  08050000
080600****************************************************************  08060000
080700 8500-XML-ERROR.                                                  08070003
080800                                                                  08080003
080900     DISPLAY '8500-XML-ERROR'                                     08090003
081000     DISPLAY 'XML-CODE' XML-CODE                                  08100003
081100     PERFORM 9000-EXPLAIN-XML-RESPONSE                            08110003
081200     PERFORM  VARYING XML-LINE-IDX FROM 1 BY 1                    08120003
081300                UNTIL XML-LINE-IDX > XML-RESPONSE-LINES           08130003
081400     END-PERFORM.                                                 08140003
081500     MOVE +4018         TO PV-ABEND-CODE.                         08150003
081600     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         08160003
081700                                                                  08170003
084400                                                                  08440003
084500****************************************************************  08450000
084600*   REPLACE XML CHARACTERS                                     *  08460000
084700****************************************************************  08470000
084800*8600-REPLACE-XML.                                                08480041
086300*                                                                 08630041
086400*  INSPECT ... REPLACING command to change the tag.               08640000
086410*                                                                 08641041
086700*    INSPECT PV-XML REPLACING ALL 'as2'      BY 'asn'.            08670041
086710*    INSPECT PV-XML REPLACING ALL 'as3'      BY 'asn'.            08671041
086720*    INSPECT PV-XML REPLACING ALL 'as4'      BY 'asn'.            08672041
086730*                                                                 08673041
086800*    INSPECT PV-XML REPLACING ALL 'asnHdrNb2' BY 'asnHdrNbr'.     08680041
086810*    INSPECT PV-XML REPLACING ALL 'asnHdrNb3' BY 'asnHdrNbr'.     08681041
086820*    INSPECT PV-XML REPLACING ALL 'asnHdrNb4' BY 'asnHdrNbr'.     08682041
086900*                                                                 08690041
087000*    INSPECT PV-XML REPLACING ALL 'asnCreTms2' BY 'asnCreTmst'.   08700041
087010*    INSPECT PV-XML REPLACING ALL 'asnCreTms3' BY 'asnCreTmst'.   08701041
087020*    INSPECT PV-XML REPLACING ALL 'asnCreTms4' BY 'asnCreTmst'.   08702041
087021*                                                                 08702141
087022*    INSPECT PV-XML REPLACING ALL 'asnHdrSe2' BY 'asnHdrSeq'.     08702241
087023*    INSPECT PV-XML REPLACING ALL 'asnHdrSe3' BY 'asnHdrSeq'.     08702341
087024*    INSPECT PV-XML REPLACING ALL 'asnHdrSe4' BY 'asnHdrSeq'.     08702441
087025*                                                                 08702541
087026*    INSPECT PV-XML REPLACING ALL 'poNumbe2' BY 'poNumber'.       08702641
087027*    INSPECT PV-XML REPLACING ALL 'poNumbe3' BY 'poNumber'.       08702741
087028*    INSPECT PV-XML REPLACING ALL 'poNumbe4' BY 'poNumber'.       08702841
087029*                                                                 08702941
087030*    INSPECT PV-XML REPLACING ALL 'cartonInf2' BY 'cartonInfo'.   08703041
087031*    INSPECT PV-XML REPLACING ALL 'cartonInf3' BY 'cartonInfo'.   08703141
087032*    INSPECT PV-XML REPLACING ALL 'cartonInf4' BY 'cartonInfo'.   08703241
087033*                                                                 08703341
087034*    INSPECT PV-XML REPLACING ALL 'cartonI2' BY 'cartonId'.       08703441
087035*    INSPECT PV-XML REPLACING ALL 'cartonI3' BY 'cartonId'.       08703541
087036*    INSPECT PV-XML REPLACING ALL 'cartonI4' BY 'cartonId'.       08703641
087040                                                                  08704001
092900                                                                  09290001
093000****************************************************************  09300000
093100*   XML SUCCESS                                                *  09310000
093200****************************************************************  09320000
093300 8700-XML-SUCCESS.                                                09330001
093400     CONTINUE.                                                    09340001
093500                                                                  09350001
094900*                                                                 09490000
095000* This code makes the CR-MI field optional.                       09500000
095100* The XML Generator will create a tag even if the field is blank. 09510000
095200* This will strip it out.                                         09520000
095300*    UNSTRING PV-XML(1:XML-LENGTH)                                09530001
095400*      DELIMITED BY '<CR-MI> </CR-MI>'                            09540001
095500*              INTO PV-BEFORE COUNT PV-BEFORE-CNT                 09550001
095600*                   PV-AFTER  COUNT PV-AFTER-CNT.                 09560001
095700*    STRING PV-BEFORE(1:PV-BEFORE-CNT) PV-AFTER                   09570001
095800*      DELIMITED BY SIZE INTO PV-XML.                             09580001
095900*    COMPUTE XML-LENGTH = PV-BEFORE-CNT + PV-AFTER-CNT.           09590001
096000*                                                                 09600001
096100     DISPLAY 'XML document was successfully generated'.           09610001
096200     DISPLAY ' '.                                                 09620001
096300     DISPLAY 'The generated XML is ' XML-LENGTH                   09630001
096400             ' characters long.'.                                 09640001
096500     DISPLAY ' '.                                                 09650001
096600     DISPLAY PV-XML(1:XML-LENGTH).                                09660001
096700                                                                  09670001
096800***  DISPLAY ' '.                                                 09680015
096900***  DISPLAY 'FORMATTED:'.                                        09690015
097000***  MOVE PV-XML(1:XML-LENGTH) TO XML-UNFORMATTED-MSG             09700015
097100                                                                  09710001
097200***  PERFORM 9554-DISPLAY-FORMATTED-XML.                          09720015
097300                                                                  09730001
097400                                                                  09740001
097500*-----------------------------------------------------------------09750003
097600*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    09760003
097700*  ERROR OR WARNING CODE OCCURS.                                  09770003
097800*-----------------------------------------------------------------09780003
097900 9100-SQL-ABEND.                                                  09790003
098000                                                                  09800003
098100     DISPLAY '9100-SQL-ABEND'.                                    09810003
098200     DISPLAY '** ABEND     **'.                                   09820003
098300     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        09830003
098400     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              09840003
098500     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     09850003
098600                                                                  09860003
098700******************************************************************09870003
098800* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    09880003
098900* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         09890003
099000* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     09900003
099100* FORMAT.                                                         09910003
099200******************************************************************09920003
099300     COPY DPPD004.                                                09930003
099400                                                                  09940003
099500     MOVE +4013                  TO PV-ABEND-CODE.                09950003
099600     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         09960003
099700                                                                  09970003
102200****************************************************************  10220000
102300*    ADDITIONAL PARAGRAPHS for XML Parser                      *  10230001
102400****************************************************************  10240000
102500                                                                  10250001
102600     COPY ISPD009.                                                10260001
102800     COPY ISPD007.                                                10280001
102900     COPY ISPD008.                                                10290001
103000     COPY ISPD012.                                                10300001
103100                                                                  10310001
105300******************************************************************10530000
105400******************************************************************10540000
