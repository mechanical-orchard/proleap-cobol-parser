000100*-----------------------*                                         00010004
000200 IDENTIFICATION DIVISION.                                         00020004
000300*-----------------------*                                         00030004
000400 PROGRAM-ID.    ETKCS345.                                         00040004
000500 AUTHOR.        TESS BESTE.                                       00050004
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060004
000700 DATE-WRITTEN.  04-19-95.                                         00070004
000800 DATE-COMPILED.                                                   00080004
000900                                                                  00090004
001000*-----------------------------------------------------------------00100004
001100*             E345 - DOCUMENTS ON HOLD INQUIRY                    00110004
001200*                                                                 00120004
001300* THIS PROGRAM READS THE SELECTED ITEMS QUEUE FROM THE EDI PO LIST00130004
001400* PROGRAM.  FOR EACH SELECTED P.O., IT RETRIEVES THE DATA RELATED 00140004
001500* RELATED TO THE DOCUMENT CONTAINING THAT P.O., EXAMINES IT FOR   00150004
001600* ERRORS, AND DISPLAYS THE RESULTS.                               00160004
001700*                                                                 00170004
001800* THE SCREEN CONTAINS A HEADER SECTION AND A DETAIL SECTION.  THE 00180004
001900* HEADER SECTION CONTAINS DOCUMENT HEADER INFO.  THIS INFO VARIES 00190004
002000* DEPENDING UPON WHAT TYPE OF DOCUMENT IT IS (INVOICE OR POA).    00200004
002100* THE DETAIL SECTION CONTAINS ONE LINE FOR EACH ERROR DETECTED    00210004
002200* WITHIN THE DOCUMENT.  EACH LINE CONTAINS THE UPC CODE AND AN    00220004
002300* ERROR MESSAGE.  THESE LINES ARE DISPLAYED IN A LIST FORMAT, AND 00230004
002400* MAY THEN BE SELECTED FOR FURTHER INQUIRY BY THE EDI UPC DETAIL  00240004
002500* INQUIRY PROGRAM.                                                00250004
002600******************************************************************00260004
002700*  DATE  07/18/2003                                               00270004
002800*  CHANGE MADE:                                                   00280004
002900*   MADE CHANGES TO SUPPORT THE PROCESSING OF COMPOUND PACK. AP   00290004
003000*   NO LONGER REQUIRES THE ET ONHOLD PROCESS TO PERFORM           00300004
003100*   VERIFICATION ON THE UPC NUMBER FOR INVOICES. THIS LOGIC WAS   00310004
003200*   COMMENTED OUT AS A RESULT.                                    00320004
003300*  MADE BY: JON FIEDLER             WR# : 24764                   00330004
003400******************************************************************00340004
003500*  CHANGED 11/04/2014    BY COGNIZANT       WR: CHG0101274        00350004
003600*                                                                 00360004
003700* EXTENDED PO# FROM 7 TO 8 DIGITS WHERE NEEDED.                   00370004
003800* RECOMPILED FOR APRD050 8 DIGITS PO# EXPANDED.                   00380004
003900*-----------------------------------------------------------------00390004
003910* 10/11/2021 GERMAN BANDA                    WR/IR #: CHG0262418* 00391006
003920*            - CHANGE CALL OF DPKUT100 TO                       * 00392006
003930*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00393006
003940*              MAKING THE CALL DYNAMIC VS STATIC                * 00394006
003950*                                                               * 00395006
003960*---------------------------------------------------------------* 00396006
CICS  *  CHANGED 10/28/2022    BY BARB SCHULTZ    WR: CHG0277210      * 00397007
CICS  *                                                               * 00398007
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL   * 00399007
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.    * 00399107
CICS  *---------------------------------------------------------------* 00399307
004000                                                                  00400004
004100                                                                  00410004
004200                                                                  00420004
004300 ENVIRONMENT DIVISION.                                            00430004
004400                                                                  00440004
004500 DATA DIVISION.                                                   00450004
004600                                                                  00460004
004700 WORKING-STORAGE SECTION.                                         00470004
004800                                                                  00480004
004900 01  PC-PROGRAM-CONSTANTS.                                        00490004
005000     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00500004
005100                                                    'ET345A  '.   00510004
005200     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00520004
005300                                                    'ETKM345 '.   00530004
005400     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00540004
005500                                                    'ETKCS345'.   00550004
005600     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00560004
005700     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00570004
005800     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +7      00580004
005900                                                    COMP SYNC.    00590004
006000     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00600004
006100                                                    COMP SYNC.    00610004
006200     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00620004
006300                                                    +1000000      00630004
006400                                                    COMP-3.       00640004
006500     05  PC-ITEM-NUMBER-LENGTH          PIC S9(04)  VALUE +5      00650004
006600                                                    COMP SYNC.    00660004
006700     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00670004
006800     05  PC-TRN-SET-CDES.                                         00680004
006900         10  PC-TRN-SET-CDE-INV         PIC  X(03)  VALUE '810'.  00690004
007000         10  PC-TRN-SET-CDE-POA         PIC  X(03)  VALUE '855'.  00700004
007100     05  PC-ERROR-MSGS.                                           00710004
007200         10  PC-MSG-UPC-SKU-NOT-FND     PIC  X(20)  VALUE         00720004
007300                                           'UPC/SKU NOT FOUND   '.00730004
007400         10  PC-MSG-WRONG-DEPT          PIC  X(20)  VALUE         00740004
007500                                           'WRONG DEPARTMENT    '.00750004
007600         10  PC-MSG-UPC-NOT-ON-PO       PIC  X(20)  VALUE         00760004
007700                                           'UPC NOT ON  P.O.    '.00770004
007800     05  PC-STATUS-MSGS.                                          00780004
007900         10  PC-STATUS-NEW-PO           PIC  X(15)  VALUE         00790004
008000                                                'NEW P.O.       '.00800004
008100         10  PC-STATUS-DUP              PIC  X(15)  VALUE         00810004
008200                                                'DUPLICATE      '.00820004
008300         10  PC-STATUS-MULT-DEPT        PIC  X(15)  VALUE         00830004
008400                                                'MULTIPLE DEPTS '.00840004
008500         10  PC-STATUS-NO-DEPT          PIC  X(15)  VALUE         00850004
008600                                                'NO DEPT        '.00860004
008700         10  PC-STATUS-NOT-FOUND        PIC  X(15)  VALUE         00870004
008800                                                'NOT FOUND      '.00880004
008900         10  PC-STATUS-ON-HOLD          PIC  X(15)  VALUE         00890004
009000                                                'ON HOLD        '.00900004
009100         10  PC-STATUS-NEW-INVOICE      PIC  X(15)  VALUE         00910004
009200                                                'NEW INVOICE    '.00920004
009300     05  PC-HEADER-LINE-LABELS.                                   00930004
009400         10  PC-DEPT-LINE-LABEL         PIC  X(22)  VALUE         00940004
009500                                         'DEPARTMENT...........:'.00950004
009600         10  PC-ASSIGNED-DEPT-LINE-LABEL                          00960004
009700                                        PIC  X(22)  VALUE         00970004
009800                                         'ASSIGNED DEPARTMENT..:'.00980004
009900         10  PC-VENDOR-LINE-LABEL       PIC  X(22)  VALUE         00990004
010000                                         'VENDOR...............:'.01000004
010100         10  PC-INV-LINE-LABEL          PIC  X(22)  VALUE         01010004
010200                                         'INVOICE NUMBER.......:'.01020004
010300                                                                  01030004
010400     05  PC-TSYMSG-NUMBERS.                                       01040004
010500         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  01050004
010600         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  01060004
010700         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  01070004
010800         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  01080004
010900         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  01090004
011000         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  01100004
011100         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  01110004
011200         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  01120004
011300         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  01130004
011400         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  01140004
011500         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  01150004
011600         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01160004
011700         10  PC-TSYMSG-00551            PIC  9(05)  VALUE 00551.  01170004
011800                                                                  01180004
011900 01  PS-PROGRAM-SWITCHES.                                         01190004
012000     05  PS-ERROR-SW                    PIC  X      VALUE 'Y'.    01200004
012100         88  PS-NO-ERROR                            VALUE 'Y'.    01210004
012200         88  PS-ERROR                               VALUE 'N'.    01220004
012300     05  PS-POA-ERROR-SW                PIC  X.                   01230004
012400         88  PS-POA-NO-ERRORS                       VALUE SPACE.  01240004
012500         88  PS-POA-SKU-ERR                         VALUE 'S'.    01250004
012600         88  PS-POA-DEPT-ERR                        VALUE 'D'.    01260004
012700     05  PS-INV-ERROR-SW                PIC  X.                   01270004
012800         88  PS-INV-NO-ERRORS                       VALUE SPACE.  01280004
012900         88  PS-INV-SKU-ERR                         VALUE 'S'.    01290004
013000         88  PS-INV-UPC-ERR                         VALUE 'U'.    01300004
013100     05  PS-CHECK-FOR-LINE-MATCH-SW     PIC  X.                   01310004
013200         88  PS-DONT-CHECK-FOR-LINE-MATCH           VALUE 'N'.    01320004
013300         88  PS-CHECK-FOR-LINE-MATCH                VALUE 'Y'.    01330004
013400     05  PS-DATA-AVAILABLE-SW           PIC  X.                   01340004
013500         88  PS-DATA-AVAILABLE                      VALUE 'Y'.    01350004
013600         88  PS-DATA-NOT-AVAILABLE                  VALUE 'N'.    01360004
013700     05  PS-START-ITEM-ERROR-SW         PIC  X      VALUE 'Y'.    01370004
013800         88  PS-NO-START-ITEM-ERROR                 VALUE 'Y'.    01380004
013900         88  PS-START-ITEM-ERROR                    VALUE 'N'.    01390004
014000     05  PS-LIST-END-SW                 PIC X       VALUE 'N'.    01400004
014100         88  PS-LIST-END                            VALUE 'Y'.    01410004
014200         88  PS-NO-LIST-END                         VALUE 'N'.    01420004
014300                                                                  01430004
014400 01  PV-PROGRAM-VARIABLES.                                        01440004
014500     05  PV-SUB                         PIC S9(04)  VALUE +0      01450004
014600                                                    COMP SYNC.    01460004
014700     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01470004
014800                                                    COMP SYNC.    01480004
014900     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01490004
015000                                                    COMP-3.       01500004
015100     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01510004
015200                                                    COMP-3.       01520004
015300     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01530004
015400                                                    COMP-3.       01540004
015500     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01550004
015600                                                    COMP-3.       01560004
015700     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01570004
015800                                                    COMP-3.       01580004
015900     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01590004
016000                                                    COMP-3.       01600004
016100     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01610004
016200                                                    COMP-3.       01620004
016300     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01630004
016400                                                    COMP SYNC.    01640004
016500     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01650004
016600                                                    COMP SYNC.    01660004
016700     05  PV-ITEM                        PIC S9(04)  VALUE +0      01670004
016800                                                    COMP SYNC.    01680004
016900     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01690004
017000                                                    COMP SYNC.    01700004
017100     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01710004
017200                                                    COMP SYNC.    01720004
017300     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01730004
017400                                                    COMP SYNC.    01740004
017500     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01750004
017600                                                    COMP SYNC.    01760004
017700     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01770004
017800                                                    COMP SYNC.    01780004
017900     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01790004
018000                                                    COMP SYNC.    01800004
018100     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01810004
018200                                                    COMP SYNC.    01820004
018300     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01830004
018400                                                    COMP SYNC.    01840004
018500     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01850004
018600                                                    COMP SYNC.    01860004
018700     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01870004
018800                                                    COMP SYNC.    01880004
018900     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01890004
019000                                                    COMP SYNC.    01900004
019100     05  PV-FORMAT-UPC-NBR.                                       01910004
019200         10  FILLER                     PIC  X(02).               01920004
019300         10  FILLER                     PIC  X      VALUE '-'.    01930004
019400         10  FILLER                     PIC  X(05).               01940004
019500         10  FILLER                     PIC  X      VALUE '-'.    01950004
019600         10  FILLER                     PIC  X(05).               01960004
019700         10  FILLER                     PIC  X      VALUE '-'.    01970004
019800         10  FILLER                     PIC  X.                   01980004
019900                                                                  01990004
020000     05  PV-PO002-I-SKU                 PIC 9(08)   VALUE ZERO.   02000004
020100     05  PV-SKXREF-SKU                  PIC S9(08)  COMP-3.       02010004
020200                                                                  02020004
020300     05  PV-SKXREF-DEPT                 PIC X(03)   VALUE SPACES  02030004
020400                                                  JUSTIFIED RIGHT.02040004
020500                                                                  02050004
020600                                                                  02060004
020700*-----------------------------------------------------------------02070004
020800* THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE. THIS  02080004
020900* QUEUE MUST HAVE THE SAME LAYOUT AS 1 OCCURRENCE OF              02090004
021000* ASC-BLOCK-ENTRIES.                                              02100004
021100*-----------------------------------------------------------------02110004
021200                                                                  02120004
021300 01  LQW-LIST-QUEUE-WORK-AREA.                                    02130004
021400     05  LQW-BLOCK-MODIFIED             PIC  X      VALUE SPACE.  02140004
021500     05  LQW-ITEM-ENTRIES               OCCURS 7  TIMES           02150004
021600                                        INDEXED BY LQW-IDX.       02160004
021700         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       02170004
021800         10  LQW-TEMP-SELECTED-SW       PIC  X.                   02180004
021900         10  LQW-SELECTED-SW            PIC  X.                   02190004
022000             88  LQW-SELECT                         VALUE 'S'.    02200004
022100             88  LQW-DESELECT                       VALUE ' '.    02210004
022200         10  LQW-ACTION                 PIC  X(03).               02220004
022300         10  LQW-UPC-NBR                PIC  X(15).               02230004
022400         10  LQW-ERROR-MSG              PIC  X(20).               02240004
022500                                                                  02250004
022600                                                                  02260004
022700*-----------------------------------------------------------------02270004
022800* RECORD LAYOUT FOR THE EDI DOCUMENTS ON HOLD SELECTED ITEMS TEMP 02280004
022900* STORAGE QUEUE.                                                  02290004
023000*-----------------------------------------------------------------02300004
023100                                                                  02310004
023200     COPY ETWS346.                                                02320004
023300                                                                  02330004
023400                                                                  02340004
023500*-----------------------------------------------------------------02350004
023600* MAP LAYOUT                                                      02360004
023700*-----------------------------------------------------------------02370004
023800                                                                  02380004
023900     COPY ETKM345.                                                02390004
024000*                                                                 02400004
024100 01  MR-OCCURS-LAYOUT                   REDEFINES  ET345AO.       02410004
024200     05  FILLER                         PIC X(367).               02420004
024300     05  MR-SCROLL-AREA                 OCCURS 7  TIMES.          02430004
024400         10  MR-SELECTL                 PIC S9(04) COMP.          02440004
024500         10  MR-SELECTA                 PIC  X(01).               02450004
024600         10  MR-SELECTC                 PIC  X(01).               02460004
024700         10  MR-SELECTH                 PIC  X(01).               02470004
024800         10  MR-SELECT                  PIC  X(01).               02480004
024900                                                                  02490004
025000         10  MR-ACTIONL                 PIC S9(04) COMP.          02500004
025100         10  MR-ACTIONA                 PIC  X(01).               02510004
025200         10  MR-ACTIONC                 PIC  X(01).               02520004
025300         10  MR-ACTIONH                 PIC  X(01).               02530004
025400         10  MR-ACTION                  PIC  X(03).               02540004
025500                                                                  02550004
025600         10  MR-UPC-NBRL                PIC S9(04) COMP.          02560004
025700         10  MR-UPC-NBRA                PIC  X(01).               02570004
025800         10  MR-UPC-NBRC                PIC  X(01).               02580004
025900         10  MR-UPC-NBRH                PIC  X(01).               02590004
026000         10  MR-UPC-NBR                 PIC  X(16).               02600004
026100                                                                  02610004
026200         10  MR-ERROR-MSGL              PIC S9(04) COMP.          02620004
026300         10  MR-ERROR-MSGA              PIC  X(01).               02630004
026400         10  MR-ERROR-MSGC              PIC  X(01).               02640004
026500         10  MR-ERROR-MSGH              PIC  X(01).               02650004
026600         10  MR-ERROR-MSG               PIC  X(20).               02660004
026700                                                                  02670004
026800*-----------------------------------------------------------------02680004
026900* EDI PURCHASE ORDER ACKNOWLEDGMENT RECORD LAYOUT                 02690004
027000*-----------------------------------------------------------------02700004
027100                                                                  02710004
027200     COPY PORD002.                                                02720004
027300                                                                  02730004
027400*-----------------------------------------------------------------02740004
027500* EDI INVOICE RECORD LAYOUT                                       02750004
027600*-----------------------------------------------------------------02760004
027700                                                                  02770004
027800 01  AP050-EDI-IN-FILE.                                           02780004
027900     COPY APRD050.                                                02790004
028000                                                                  02800004
028100*-----------------------------------------------------------------02810004
028200* ATTRIBUTE SETTINGS COPYBOOK                                     02820004
028300*-----------------------------------------------------------------02830004
028400                                                                  02840004
028500     COPY DPWS015.                                                02850004
028600                                                                  02860004
028700*-----------------------------------------------------------------02870004
028800* FUNCTION KEYS COPYBOOK                                          02880004
028900*-----------------------------------------------------------------02890004
029000                                                                  02900004
029100     COPY DPWS016.                                                02910004
029200                                                                  02920004
029300*-----------------------------------------------------------------02930004
029400* NUMERIC EDIT LAYOUT                                             02940004
029500*-----------------------------------------------------------------02950004
029600                                                                  02960004
029700     COPY DPWS010I.                                               02970004
029800                                                                  02980004
029900*-----------------------------------------------------------------02990004
CICS  * PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.               03000007
030100*-----------------------------------------------------------------03010004
030200                                                                  03020004
030300     COPY DPWS030.                                                03030004
CICS       COPY DPWS930.                                                03031007
030400                                                                  03040004
030500*-----------------------------------------------------------------03050004
030600* STANDARD COMMAREA                                               03060004
030700*-----------------------------------------------------------------03070004
030800                                                                  03080004
030900     COPY DPWS020.                                                03090004
031000     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03100004
031100                                                                  03110004
031200*-----------------------------------------------------------------03120004
031300* THIS IS THE INTER-APPLICATION COMMAREA FOR THE EDI DOCUMENTS    03130004
031400* ON HOLD SCREENS.                                                03140004
031500*-----------------------------------------------------------------03150004
031600                                                                  03160004
031700         10  INTER-APPL-COMM-AREA       PIC X(200).               03170004
031800     COPY ETWS345.                                                03180004
031900*-----------------------------------------------------------------03190004
032000* THIS IS THE APPLICATION-SPECIFIC COMMAREA.                      03200004
032100*-----------------------------------------------------------------03210004
032200         10  ASC-SPECIFIC-COMMAREA.                               03220004
032300             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03230004
032400                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03240004
032500                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03250004
032600                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03260004
032700                                                                  03270004
032800                 20  ASC-ITEM-ARRAY.                              03280004
032900                     25  ASC-ITEM-ENTRIES OCCURS 7  TIMES.        03290004
033000                         30  ASC-LIST-ITEM-NUMBER                 03300004
033100                                                     PIC S9(09)   03310004
033200                                                     COMP-3.      03320004
033300                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03330004
033400                             88  ASC-VALID-SELECT    VALUE ' '    03340004
033500                                                           'S'    03350004
033600                                                           'B'    03360004
033700                                                           'E'.   03370004
033800                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03380004
033900                             88  ASC-TEMP-SELECT     VALUE 'S'.   03390004
034000                             88  ASC-TEMP-BEGIN      VALUE 'B'.   03400004
034100                             88  ASC-TEMP-END        VALUE 'E'.   03410004
034200                         30  ASC-SELECTED-SW         PIC  X(01).  03420004
034300                             88  ASC-NO-SELECT       VALUE ' '.   03430004
034400                             88  ASC-SELECT          VALUE 'S'.   03440004
034500                             88  ASC-BEGIN           VALUE 'B'.   03450004
034600                             88  ASC-END             VALUE 'E'.   03460004
034700                         30  ASC-ACTION              PIC  X(03).  03470004
034800                         30  ASC-UPC-NBR             PIC  X(15).  03480004
034900                         30  ASC-ERROR-MSG           PIC  X(20).  03490004
035000                                                                  03500004
035100*            *----------------------------------------------------03510004
035200*            * THE FOLLOWING FIELDS ARE PASSED TO THIS PROGRAM IN 03520004
035300*            * THE SELECTION QUEUE. SOME OF THEM APPEAR IN THE    03530004
035400*            * HEADER SECTION OF THE SCREEN.                      03540004
035500*            *----------------------------------------------------03550004
035600             15  ASC-SEL-QUEUE-FIELDS.                            03560004
035700                 20  ASC-TP-DKEY                     PIC S9(09)   03570004
035800                                                         COMP.    03580004
035900                 20  ASC-TP-DKEY-TMST                PIC  X(26).  03590004
036000                 20  ASC-TRN-SET-CDE                 PIC  X(03).  03600004
036100                 20  ASC-VENDOR-NAME                 PIC  X(10).  03610004
036200                 20  ASC-PO-NBR                      PIC  X(22).  03620004
036300                 20  ASC-ASSIGNED-DEPT-NBR           PIC  X(03).  03630004
036400*            *----------------------------------------------------03640004
036500*            * THE FOLLOWING ARE HEADER SECTION FIELDS THAT ARE   03650004
036600*            * FILLED IN BY THIS PROGRAM.                         03660004
036700*            *----------------------------------------------------03670004
036800             15  ASC-HEADER-INFO.                                 03680004
036900                 20  ASC-PO-STATUS                   PIC  X(17).  03690004
037000                 20  ASC-DEPT-NBR                    PIC  X(03).  03700004
037100                 20  ASC-DEPT-STATUS                 PIC  X(15).  03710004
037200                 20  ASC-INVOICE-NBR                 PIC  X(22).  03720004
037300                 20  ASC-INV-STATUS                  PIC  X(15).  03730004
037400                                                                  03740004
037500             15  ASC-BLK-SUB                         PIC S9(04)   03750004
037600                                                          COMP    03760004
037700                                                          SYNC.   03770004
037800             15  ASC-ITEM-SUB                        PIC S9(04)   03780004
037900                                                          COMP    03790004
038000                                                          SYNC.   03800004
038100             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   03810004
038200                                                          COMP-3. 03820004
038300             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   03830004
038400                                                          COMP-3. 03840004
038500             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03850004
038600                                                          COMP-3. 03860004
038700             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   03870004
038800                                                          COMP-3. 03880004
038900             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03890004
039000                                                          COMP-3. 03900004
039100             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   03910004
039200                                                          COMP    03920004
039300                                                          SYNC.   03930004
039400             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03940004
039500                                                          COMP-3. 03950004
039600             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03960004
039700                                                          COMP-3. 03970004
039800             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03980004
039900                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   03990004
040000                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   04000004
040100             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  04010004
040200                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   04020004
040300                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   04030004
040400             15  ASC-LIST-QUEUE-NAME.                             04040004
040500                 20  ASC-LIST-TERM-ID                PIC  X(04).  04050004
040600                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   04060004
040700                                                          COMP-3. 04070004
040800                 20  ASC-LIST-SEQ                    PIC  9(01).  04080004
040900             15  ASC-INPUT-SEL-QUEUE-NAME            PIC  X(08).  04090004
041000             15  ASC-OUTPUT-SEL-QUEUE-NAME.                       04100004
041100                 20  ASC-SEL-TERM-ID                 PIC  X(04).  04110004
041200                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   04120004
041300                                                          COMP-3. 04130004
041400                 20  ASC-SEL-SEQ                     PIC  9(01).  04140004
041500             15  ASC-SEL-SUB                         PIC S9(04)   04150004
041600                                                     COMP.        04160004
041700             15  ASC-SEL-ITEM                        PIC S9(04)   04170004
041800                                                     COMP.        04180004
041900             15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(05)   04190004
042000                                                     COMP-3.      04200004
042100             15  ASC-USE-SELECTION-QUEUE-IND         PIC  X.      04210004
042200                 88  ASC-USE-SELECTION-QUEUE         VALUE 'Y'.   04220004
042300             15  ASC-START-ITEM-REQUEST.                          04230004
042400                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  04240004
042500         10  FILLER                     PIC  X(2015).             04250004
042600                                                                  04260004
042700                                                                  04270004
042800*-----------------------------------------------------------------04280004
042900* ABEND PROCESSING COPYBOOK.                                      04290004
043000*-----------------------------------------------------------------04300004
043100                                                                  04310004
043200     COPY DPWS013.                                                04320004
043300                                                                  04330004
043400                                                                  04340004
043500*-----------------------------------------------------------------04350004
043600* DB2 AREA FOR FG/TSET HELD DATA TABLE                            04360004
043700*-----------------------------------------------------------------04370004
043800     EXEC SQL                                                     04380004
043900          INCLUDE TFGTRDT                                         04390004
044000     END-EXEC.                                                    04400004
044100                                                                  04410004
044200*-----------------------------------------------------------------04420004
044300* DB2 AREA FOR STATUS CODE TABLE                                  04430004
044400*-----------------------------------------------------------------04440004
044500     EXEC SQL                                                     04450004
044600          INCLUDE TSTATCD                                         04460004
044700     END-EXEC.                                                    04470004
044800                                                                  04480004
044900*-----------------------------------------------------------------04490004
045000* DB2 AREA FOR SKU CROSS REFERENCE TABLE                          04500004
045100*-----------------------------------------------------------------04510004
045200     EXEC SQL                                                     04520004
045300          INCLUDE TSKXREF                                         04530004
045400     END-EXEC.                                                    04540004
045500                                                                  04550004
045600*-----------------------------------------------------------------04560004
045700* DB2 AREA FOR COMMUNICATIONS                                     04570004
045800*-----------------------------------------------------------------04580004
045900     EXEC SQL                                                     04590004
046000          INCLUDE SQLCA                                           04600004
046100     END-EXEC.                                                    04610004
046200                                                                  04620004
046300*-----------------------------------------------------------------04630004
046400* CURSOR USED TO READ THE ACTUAL DATA RELATED TO A P.O. ON HOLD.  04640004
046500*-----------------------------------------------------------------04650004
046600                                                                  04660004
046700     EXEC SQL                                                     04670004
046800         DECLARE   TFGTRDT-CSR CURSOR FOR                         04680004
046900         SELECT    TRN_SET_SEQ_NBR                                04690004
047000                 , TRN_SET_DATA                                   04700004
047100         FROM      TFGTRDT                                        04710004
047200         WHERE     TP_DKEY      = :ASC-TP-DKEY                    04720004
047300           AND     TP_DKEY_TMST = :ASC-TP-DKEY-TMST               04730004
047400         ORDER BY  TRN_SET_SEQ_NBR                                04740004
047500     END-EXEC.                                                    04750004
047600                                                                  04760004
047700                                                                  04770004
047800 LINKAGE SECTION.                                                 04780004
047900                                                                  04790004
048000 01  DFHCOMMAREA.                                                 04800004
048100     05  FILLER                         OCCURS  1 TO 4072 TIMES   04810004
048200                                        DEPENDING ON EIBCALEN.    04820004
048300         10  FILLER                     PIC X.                    04830004
048400                                                                  04840004
048500                                                                  04850004
048600 PROCEDURE DIVISION.                                              04860004
048700*-----------------------------------------------------------------04870004
048800* THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM.     04880004
048900* FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM      04890004
049000* PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT.     04900004
049100*-----------------------------------------------------------------04910004
049200                                                                  04920004
049300 0000-MAIN-MODULE.                                                04930004
049400                                                                  04940004
049500     INITIALIZE DP030-CICS-API-FIELDS.                            04950004
049600     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04960004
049700     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04970004
049800     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04980004
049900     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04990004
050000     MOVE LENGTH OF ET345AI        TO DP030-MAP-LENGTH (1).       05000004
050100     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05010004
050200     PERFORM 0001-CALL-CICS-ARCH-API.                             05020004
050300*                                                                 05030004
050400     PERFORM 1000-CONTROL-PROCESSING                              05040004
050500*                                                                 05050004
050600     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05060004
050700     PERFORM 0001-CALL-CICS-ARCH-API.                             05070004
050800                                                                  05080004
050900                                                                  05090004
051000*-----------------------------------------------------------------05100004
051100* THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE       05110004
051200* AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.             05120004
051300*-----------------------------------------------------------------05130004
051400                                                                  05140004
051500 0001-CALL-CICS-ARCH-API.                                         05150004
051600                                                                  05160004
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      05170007
051800                                    DFHCOMMAREA                   05180008
051900                                    DP030-CICS-API-FIELDS         05190008
052000                                    DP020-STANDARD-COMMAREA       05200008
052100                                    ET345AI.                      05210008
052200                                                                  05220004
052300     IF  DP030-RC-CALL-SUCCESSFUL                                 05230004
052400         CONTINUE                                                 05240004
052500     ELSE                                                         05250004
052600         SET DP013-NO-ROLLBACK                                    05260004
052700             DP013-XCTL-DISPLAY-RESTART                           05270004
052800             DP013-CICS-ABEND      TO TRUE                        05280004
052900         MOVE '0001-CALL-CICS-ARCH-API'                           05290004
053000                                   TO DP013-PARAGRAPH             05300004
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O05310008
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05320008
053300         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05330004
053400         PERFORM DP013-0000-PROCESS-ABEND                         05340004
053500     END-IF.                                                      05350004
053600                                                                  05360004
053700                                                                  05370004
053800*-----------------------------------------------------------------05380004
053900* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT       05390004
054000* COURSE OF ACTION IS FOR THIS TRANSACTION.                       05400004
054100*                                                                 05410004
054200* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE   05420004
054300*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS     05430004
054400*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS    05440004
054500*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS.  05450004
054600*-----------------------------------------------------------------05460004
054700                                                                  05470004
054800 1000-CONTROL-PROCESSING.                                         05480004
054900                                                                  05490004
055000     EVALUATE TRUE                                                05500004
055100         WHEN DP020-NEXT-ACT-INITIAL                              05510004
055200             INITIALIZE ASC-SPECIFIC-COMMAREA                     05520004
055300             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            05530004
055400                                      ASC-SEL-TERM-ID             05540004
055500             MOVE DP020-SRC-TASK-NUMBER                           05550004
055600                                   TO ASC-LIST-TASK-NUMBER        05560004
055700                                      ASC-SEL-TASK-NUMBER         05570004
055800             MOVE PC-LIST-QUEUE-SEQ                               05580004
055900                                   TO ASC-LIST-SEQ                05590004
056000             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 05600004
056100             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05610004
056200             PERFORM 4000-BUILD-INITIAL-PANEL                     05620004
056300                                                                  05630004
056400         WHEN DP020-NEXT-ACT-READ-MAP                             05640004
056500             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05650004
056600                                   TO PV-TOP-ITEM                 05660004
056700             PERFORM 2000-PROCESS-PANEL                           05670004
056800                                                                  05680004
056900         WHEN DP020-NEXT-ACT-RETURN                               05690004
057000             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05700004
057100                                   TO PV-TOP-ITEM                 05710004
057200             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05720004
057300             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 05730004
057400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05740004
057500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05750004
057600                                                                  05760004
057700         WHEN OTHER                                               05770004
057800             SET DP013-LOGIC-ABEND TO TRUE                        05780004
057900             SET DP013-NO-ROLLBACK TO TRUE                        05790004
058000             MOVE '1000-CONTROL-PROCESSING'                       05800004
058100                                   TO DP013-PARAGRAPH             05810004
058200             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05820004
058300                                   TO DP013-MESSAGE-TEXT(1)       05830004
058400             PERFORM DP013-0000-PROCESS-ABEND                     05840004
058500     END-EVALUATE.                                                05850004
058600                                                                  05860004
058700                                                                  05870004
058800*-----------------------------------------------------------------05880004
058900* SAVE FIELDS FROM INTER-APPL COMMAREA.                           05890004
059000*-----------------------------------------------------------------05900004
059100                                                                  05910004
059200 1100-PROCESS-INTER-APPL-COMM.                                    05920004
059300                                                                  05930004
059400     MOVE SPACE                     TO ASC-START-ITEM-REQUEST.    05940004
059500     SET ASC-USE-SELECTION-QUEUE    TO TRUE.                      05950004
059600     MOVE ET345-NUMBER-OF-TS-ITEMS  TO ASC-NUMBER-OF-TS-ITEMS.    05960004
059700     MOVE ET345-SEL-QUEUE-NAME      TO ASC-INPUT-SEL-QUEUE-NAME.  05970004
059800     PERFORM 1120-PREPARE-LIST-ENTRY.                             05980004
059900                                                                  05990004
060000                                                                  06000004
060100*-----------------------------------------------------------------06010004
060200*    GET READY TO START AT THE FIRST ITEM ON THE LIST.            06020004
060300*-----------------------------------------------------------------06030004
060400                                                                  06040004
060500 1120-PREPARE-LIST-ENTRY.                                         06050004
060600                                                                  06060004
060700     MOVE ET346-MAX-ITEMS TO ASC-SEL-SUB.                         06070004
060800     MOVE ZERO            TO ASC-SEL-ITEM.                        06080004
060900     PERFORM 2133-GET-NEXT-SEL-QUEUE-ITEM.                        06090004
061000                                                                  06100004
061100                                                                  06110004
061200*-----------------------------------------------------------------06120004
061300* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA    06130004
061400* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT    06140004
061500* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST   06150004
061600* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID       06160004
061700* FUNCTION KEYS CAN GET THIS FAR.                                 06170004
061800*-----------------------------------------------------------------06180004
061900                                                                  06190004
062000 2000-PROCESS-PANEL.                                              06200004
062100                                                                  06210004
062200     EVALUATE TRUE                                                06220004
062300         WHEN DP020-SRC-AID = DP016-CLEAR                         06230004
062400             MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                06240004
062500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06250004
062600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06260004
062700             IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                  06270004
062800                 MOVE -1                    TO ASTRTITL           06280004
062900                 SET DP030-SET-CURSOR-APPL-1                      06290004
063000                                            TO TRUE               06300004
063100             END-IF                                               06310004
063200                                                                  06320004
063300         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    06330004
063400             PERFORM 2050-DELETE-LIST-QUEUE                       06340004
063500             PERFORM 4000-BUILD-INITIAL-PANEL                     06350004
063600                                                                  06360004
063700         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    06370004
063800             PERFORM 2140-DESELECT-ALL-ITEMS                      06380004
063900             PERFORM 3200-RESET-ATTRIBUTES                        06390004
064000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06400004
064100             IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                  06410004
064200                 MOVE -1                    TO ASTRTITL           06420004
064300                 SET DP030-SET-CURSOR-APPL-1                      06430004
064400                                            TO TRUE               06440004
064500             END-IF                                               06450004
064600                                                                  06460004
064700         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             06470004
064800             PERFORM 2133-GET-NEXT-SEL-QUEUE-ITEM                 06480004
064900             IF PS-LIST-END                                       06490004
065000                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06500004
065100                 SET PS-NO-LIST-END TO TRUE                       06510004
065200             ELSE                                                 06520004
065300                 PERFORM 2050-DELETE-LIST-QUEUE                   06530004
065400                 PERFORM 3200-RESET-ATTRIBUTES                    06540004
065500                 PERFORM 4000-BUILD-INITIAL-PANEL                 06550004
065600             END-IF                                               06560004
065700                                                                  06570004
065800         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             06580004
065900             PERFORM 2137-GET-PREV-SEL-QUEUE-ITEM                 06590004
066000             IF PS-LIST-END                                       06600004
066100                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06610004
066200                 SET PS-NO-LIST-END TO TRUE                       06620004
066300             ELSE                                                 06630004
066400                 PERFORM 2050-DELETE-LIST-QUEUE                   06640004
066500                 PERFORM 3200-RESET-ATTRIBUTES                    06650004
066600                 PERFORM 4000-BUILD-INITIAL-PANEL                 06660004
066700             END-IF                                               06670004
066800                                                                  06680004
066900         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  06690004
067000             PERFORM 2150-SELECT-ALL-ITEMS                        06700004
067100             PERFORM 3200-RESET-ATTRIBUTES                        06710004
067200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06720004
067300             IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                  06730004
067400                 MOVE -1                    TO ASTRTITL           06740004
067500                 SET DP030-SET-CURSOR-APPL-1                      06750004
067600                                            TO TRUE               06760004
067700             END-IF                                               06770004
067800                                                                  06780004
067900         WHEN OTHER                                               06790004
068000             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 06800004
068100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06810004
068200             IF  PS-NO-ERROR                                      06820004
068300                 SET DP030-CONTINUE-GO TO TRUE                    06830004
068400                 PERFORM 2100-CHECK-FUNCTION-KEY                  06840004
068500             ELSE                                                 06850004
068600                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06860004
068700                 SET DP030-OVERRIDE-GO TO TRUE                    06870004
068800             END-IF                                               06880004
068900     END-EVALUATE.                                                06890004
069000                                                                  06900004
069100                                                                  06910004
069200*-----------------------------------------------------------------06920004
069300*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                      06930004
069400*-----------------------------------------------------------------06940004
069500                                                                  06950004
069600 2050-DELETE-LIST-QUEUE.                                          06960004
069700                                                                  06970004
069800     EXEC CICS                                                    06980004
069900         DELETEQ TS                                               06990004
070000             QUEUE (ASC-LIST-QUEUE-NAME)                          07000004
070100             RESP  (PV-CICS-RESP)                                 07010004
070200     END-EXEC.                                                    07020004
070300                                                                  07030004
070400     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       07040004
070500        (PV-CICS-RESP = DFHRESP(QIDERR))                          07050004
070600         CONTINUE                                                 07060004
070700     ELSE                                                         07070004
070800         SET DP013-CICS-ABEND      TO TRUE                        07080004
070900         SET DP013-NO-ROLLBACK     TO TRUE                        07090004
071000                                                                  07100004
071100         MOVE '2050-DELETE-LIST-QUEUE'                            07110004
071200                                   TO DP013-PARAGRAPH             07120004
071300         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    07130004
071400                                   TO DP013-MESSAGE-TEXT (1)      07140004
071500         PERFORM DP013-0000-PROCESS-ABEND                         07150004
071600     END-IF.                                                      07160004
071700                                                                  07170004
071800     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  07180004
071900                                                                  07190004
072000                                                                  07200004
072100*-----------------------------------------------------------------07210004
072200* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST. 07220004
072300* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE   07230004
072400* CICS ARCHITECTURE API.                                          07240004
072500*-----------------------------------------------------------------07250004
072600                                                                  07260004
072700 2100-CHECK-FUNCTION-KEY.                                         07270004
072800                                                                  07280004
072900     EVALUATE TRUE                                                07290004
073000         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  07300004
073100             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              07310004
073200                 INITIALIZE ET345-NUMBER-OF-TS-ITEMS              07320004
073300                            ET345-SEL-QUEUE-NAME                  07330004
073400                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                07340004
073500                                TO ET345-NUMBER-OF-SELECTED-ITEMS 07350004
073600                 PERFORM 5000-PREPARE-SEL-QUEUE                   07360004
073700             ELSE                                                 07370004
073800                 SET DP030-OVERRIDE-GO                            07380004
073900                                   TO TRUE                        07390004
074000*                ---- A LIST ITEM MUST BE SELECTED ----           07400004
074100                 MOVE PC-TSYMSG-00057                             07410004
074200                                   TO DP020-MSG-NUMBER            07420004
074300                 SET DP020-MSG-WARNING                            07430004
074400                                   TO TRUE                        07440004
074500                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07450004
074600             END-IF                                               07460004
074700                                                                  07470004
074800         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  07480004
074900             MOVE +1               TO PV-TOP-ITEM                 07490004
075000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07500004
075100                                                                  07510004
075200         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   07520004
075300             PERFORM 2110-BROWSE-BACKWARD                         07530004
075400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07540004
075500                                                                  07550004
075600         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   07560004
075700             PERFORM 2120-BROWSE-FORWARD                          07570004
075800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07580004
075900                                                                  07590004
076000         WHEN DP020-SRC-AID = DP016-ENTER                         07600004
076100             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   07610004
076200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07620004
076300                                                                  07630004
076400         WHEN OTHER                                               07640004
076500             SET DP013-NO-ROLLBACK                                07650004
076600                 DP013-XCTL-DISPLAY-RESTART                       07660004
076700                 DP013-CICS-ABEND  TO TRUE                        07670004
076800             MOVE '2100-CHECK-FUNCTION-KEY'                       07680004
076900                                   TO DP013-PARAGRAPH             07690004
077000             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      07700004
077100                                   TO DP013-MESSAGE-TEXT (1)      07710004
077200             PERFORM DP013-0000-PROCESS-ABEND                     07720004
077300     END-EVALUATE.                                                07730004
077400                                                                  07740004
077500                                                                  07750004
077600*-----------------------------------------------------------------07760004
077700*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP      07770004
077800*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,       07780004
077900*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST    07790004
078000*    MESSAGE.                                                     07800004
078100*-----------------------------------------------------------------07810004
078200                                                                  07820004
078300 2110-BROWSE-BACKWARD.                                            07830004
078400                                                                  07840004
078500     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    07850004
078600         GIVING PV-TOP-ITEM.                                      07860004
078700                                                                  07870004
078800     IF  ((PV-TOP-ITEM < +1)                                      07880004
078900       OR (PV-TOP-ITEM = +1))                                     07890004
079000         MOVE +1                   TO PV-TOP-ITEM                 07900004
079100*        -- TOP OF LIST --                                        07910004
079200         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            07920004
079300         SET DP020-MSG-INFORMATIONAL TO TRUE                      07930004
079400     END-IF.                                                      07940004
079500                                                                  07950004
079600                                                                  07960004
079700*-----------------------------------------------------------------07970004
079800*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP       07980004
079900*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO    07990004
080000*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.              08000004
080100*-----------------------------------------------------------------08010004
080200                                                                  08020004
080300 2120-BROWSE-FORWARD.                                             08030004
080400                                                                  08040004
080500     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              08050004
080600         GIVING PV-TOP-ITEM.                                      08060004
080700     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   08070004
080800         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08080004
080900                                   TO PV-TOP-ITEM                 08090004
081000*        -- BOTTOM OF LIST --                                     08100004
081100         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            08110004
081200         SET DP020-MSG-INFORMATIONAL                              08120004
081300                                   TO TRUE                        08130004
081400     ELSE                                                         08140004
081500         COMPUTE PV-BOTTOM-ITEM =                                 08150004
081600             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 08160004
081700         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            08170004
081800*            -- BOTTOM OF LIST --                                 08180004
081900             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            08190004
082000             SET DP020-MSG-INFORMATIONAL                          08200004
082100                                   TO TRUE                        08210004
082200         END-IF                                                   08220004
082300     END-IF.                                                      08230004
082400                                                                  08240004
082500                                                                  08250004
082600*-----------------------------------------------------------------08260004
082700*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO     08270004
082800*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.    08280004
082900*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST   08290004
083000*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.          08300004
083100*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT      08310004
083200*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.           08320004
083300*-----------------------------------------------------------------08330004
083400                                                                  08340004
083500 2130-CHECK-FOR-JUMP-BROWSE.                                      08350004
083600                                                                  08360004
083700     IF (ASC-START-ITEM-REQUEST = SPACE)                          08370004
083800         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08380004
083900                                   TO PV-TOP-ITEM                 08390004
084000     ELSE                                                         08400004
084100         MOVE ASC-START-ITEM-REQUEST  TO DP010I-UNEDITED-FIELD    08410004
084200         MOVE PC-ITEM-NUMBER-LENGTH   TO DP010I-MAXIMUM-DIGITS    08420004
084300         MOVE +0                      TO DP010I-MAXIMUM-DECIMALS  08430004
084400         SET DP010I-NEGATIVE-NOT-ALLOWED                          08440004
084500                                   TO TRUE                        08450004
084610         CALL DP010I-NUMERIC-EDIT-ROUTINE                         08461005
084620                         USING DP010I-NUMERIC-EDIT-AREA           08462005
084700                                                                  08470004
084800         IF  NOT DP010I-ERROR-DETECTED                            08480004
084900             MOVE DP010I-NUMERIC-FIELD                            08490004
085000                                   TO  ASC-START-ITEM-REQUEST-N   08500004
085100             IF  ASC-START-ITEM-REQUEST-N > ZERO                  08510004
085200                 IF  ASC-START-ITEM-REQUEST-N >                   08520004
085300                                          ASC-NUMBER-OF-ITEMS-READ08530004
085400                     MOVE SPACE TO ASC-START-ITEM-REQUEST         08540004
085500                     COMPUTE PV-TOP-ITEM =                        08550004
085600                             ASC-NUMBER-OF-ITEMS-READ             08560004
085700                             - PC-ITEMS-PER-PANEL + 1             08570004
085800                     IF  PV-TOP-ITEM < +1                         08580004
085900                         MOVE +1   TO PV-TOP-ITEM                 08590004
086000*                        ---- BOTTOM OF LIST ----                 08600004
086100                         MOVE PC-TSYMSG-00070                     08610004
086200                                   TO DP020-MSG-NUMBER            08620004
086300                         SET DP020-MSG-INFORMATIONAL              08630004
086400                                   TO TRUE                        08640004
086500                     END-IF                                       08650004
086600                 ELSE                                             08660004
086700                     MOVE ASC-START-ITEM-REQUEST-N                08670004
086800                                   TO PV-TOP-ITEM                 08680004
086900                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      08690004
087000                     COMPUTE PV-BOTTOM-ITEM =                     08700004
087100                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     08710004
087200                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ08720004
087300*                        -- BOTTOM OF LIST --                     08730004
087400                         MOVE PC-TSYMSG-00070                     08740004
087500                                   TO DP020-MSG-NUMBER            08750004
087600                         SET DP020-MSG-INFORMATIONAL              08760004
087700                                   TO TRUE                        08770004
087800                     END-IF                                       08780004
087900                 END-IF                                           08790004
088000             ELSE                                                 08800004
088100*                --- VALUE OUT OF RANGE ----                      08810004
088200                 MOVE PC-TSYMSG-00101     TO DP020-MSG-NUMBER     08820004
088300                 MOVE -1                  TO ASTRTITL             08830004
088400                 SET DP030-SET-CURSOR-APPL-1                      08840004
088500                                          TO TRUE                 08850004
088600                 MOVE DP015-REVERSE       TO ASTRTITH             08860004
088700                 MOVE DP015-RED           TO ASTRTITC             08870004
088800                 MOVE DP015-UNP-NUM-BRT-OFF                       08880004
088900                                          TO ASTRTITA             08890004
089000                 SET DP020-MSG-FATAL      TO TRUE                 08900004
089100                 SET PS-START-ITEM-ERROR TO TRUE                  08910004
089200             END-IF                                               08920004
089300                                                                  08930004
089400         ELSE                                                     08940004
089500*            ---- MUST BE NUMERIC ----                            08950004
089600             MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER      08960004
089700             MOVE -1                     TO ASTRTITL              08970004
089800             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08980004
089900             MOVE DP015-REVERSE          TO ASTRTITH              08990004
090000             MOVE DP015-RED              TO ASTRTITC              09000004
090100             MOVE DP015-UNP-NUM-BRT-OFF  TO ASTRTITA              09010004
090200             SET DP020-MSG-FATAL         TO TRUE                  09020004
090300             SET PS-START-ITEM-ERROR     TO TRUE                  09030004
090400         END-IF                                                   09040004
090500     END-IF.                                                      09050004
090600                                                                  09060004
090700                                                                  09070004
090800*----------------------------------------------------------------*09080004
090900* GET THE NEXT DOCUMENT IF A LIST OF DOCMENTS IS BEING PROCESSED. 09090004
091000*----------------------------------------------------------------*09100004
091100                                                                  09110004
091200 2133-GET-NEXT-SEL-QUEUE-ITEM.                                    09120004
091300                                                                  09130004
091400     ADD +1                       TO ASC-SEL-SUB.                 09140004
091500     IF  ASC-SEL-SUB > ET346-MAX-ITEMS                            09150004
091600         ADD +1                   TO ASC-SEL-ITEM                 09160004
091700         MOVE +1                  TO ASC-SEL-SUB                  09170004
091800     END-IF.                                                      09180004
091900     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                09190004
092000         PERFORM 9100-READ-SEL-QUEUE                              09200004
092100         IF  ET346-ITEM (ASC-SEL-SUB) > ZERO                      09210004
092200             MOVE ET346-TP-DKEY      (ASC-SEL-SUB)                09220004
092300                                     TO ASC-TP-DKEY               09230004
092400             MOVE ET346-TP-DKEY-TMST (ASC-SEL-SUB)                09240004
092500                                     TO ASC-TP-DKEY-TMST          09250004
092600             MOVE ET346-TRN-SET-CDE  (ASC-SEL-SUB)                09260004
092700                                     TO ASC-TRN-SET-CDE           09270004
092800             MOVE ET346-VENDOR-NAME  (ASC-SEL-SUB)                09280004
092900                                     TO ASC-VENDOR-NAME           09290004
093000             MOVE ET346-PO-NBR       (ASC-SEL-SUB)                09300004
093100                                     TO ASC-PO-NBR                09310004
093200             MOVE ET346-DEPT-NBR     (ASC-SEL-SUB)                09320004
093300                                     TO ASC-ASSIGNED-DEPT-NBR     09330004
093400             IF ET346-ACTION-SW (ASC-SEL-SUB) = SPACE             09340004
093500                 SET ET346-INQ  (ASC-SEL-SUB) TO TRUE             09350004
093600                 PERFORM 9200-REWRITE-SEL-QUEUE                   09360004
093700             END-IF                                               09370004
093800         ELSE                                                     09380004
093900             SUBTRACT +1 FROM ASC-SEL-SUB                         09390004
094000*            ---- BOTTOM OF LIST ----                             09400004
094100             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             09410004
094200             SET DP020-MSG-INFORMATIONAL TO TRUE                  09420004
094300             SET PS-LIST-END             TO TRUE                  09430004
094400         END-IF                                                   09440004
094500     ELSE                                                         09450004
094600         SUBTRACT +1 FROM ASC-SEL-ITEM                            09460004
094700         MOVE ET346-MAX-ITEMS     TO ASC-SEL-SUB                  09470004
094800*        ---- BOTTOM OF LIST ----                                 09480004
094900         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             09490004
095000         SET DP020-MSG-INFORMATIONAL TO TRUE                      09500004
095100         SET PS-LIST-END             TO TRUE                      09510004
095200     END-IF.                                                      09520004
095300                                                                  09530004
095400                                                                  09540004
095500*-----------------------------------------------------------------09550004
095600* GET THE PREVIOUS DOCUMENT IF A LIST OF DOCUMENTS IS BEING       09560004
095700* PROCESSED.                                                      09570004
095800*-----------------------------------------------------------------09580004
095900                                                                  09590004
096000 2137-GET-PREV-SEL-QUEUE-ITEM.                                    09600004
096100                                                                  09610004
096200     SUBTRACT +1 FROM ASC-SEL-SUB.                                09620004
096300     IF  ASC-SEL-SUB < +1                                         09630004
096400         SUBTRACT +1 FROM ASC-SEL-ITEM                            09640004
096500         MOVE ET346-MAX-ITEMS     TO ASC-SEL-SUB                  09650004
096600     END-IF.                                                      09660004
096700                                                                  09670004
096800     IF  ASC-SEL-ITEM > ZERO                                      09680004
096900*        *--------------------------------------------------------09690004
097000*        * MOVE DATA FROM THE SELECTION QUEUE INTO THE            09700004
097100*        * DCLGENS. (THE SELECTION QUEUE IS NOT USED WHEN THE     09710004
097200*        * PROGRAM IS ENTERED FROM THE EDI MENU OR THE            09720004
097300*        * CRITERIA SPEC. IN THOSE CASES, THIS DATA IS FETCHED    09730004
097400*        * FROM THE DB2 TABLES INTO THE DCLGENS.)                 09740004
097500*        *--------------------------------------------------------09750004
097600         PERFORM 9100-READ-SEL-QUEUE                              09760004
097700         MOVE ET346-TP-DKEY      (ASC-SEL-SUB)                    09770004
097800                                     TO ASC-TP-DKEY               09780004
097900         MOVE ET346-TP-DKEY-TMST (ASC-SEL-SUB)                    09790004
098000                                     TO ASC-TP-DKEY-TMST          09800004
098100         MOVE ET346-TRN-SET-CDE  (ASC-SEL-SUB)                    09810004
098200                                     TO ASC-TRN-SET-CDE           09820004
098300         MOVE ET346-VENDOR-NAME  (ASC-SEL-SUB)                    09830004
098400                                     TO ASC-VENDOR-NAME           09840004
098500         MOVE ET346-PO-NBR       (ASC-SEL-SUB)                    09850004
098600                                     TO ASC-PO-NBR                09860004
098700         MOVE ET346-DEPT-NBR     (ASC-SEL-SUB)                    09870004
098800                                     TO ASC-ASSIGNED-DEPT-NBR     09880004
098900     ELSE                                                         09890004
099000         MOVE +1                  TO ASC-SEL-ITEM                 09900004
099100                                     ASC-SEL-SUB                  09910004
099200*        ---- TOP OF LIST ----                                    09920004
099300         MOVE PC-TSYMSG-00069     TO DP020-MSG-NUMBER             09930004
099400         SET DP020-MSG-INFORMATIONAL TO TRUE                      09940004
099500         SET PS-LIST-END             TO TRUE                      09950004
099600     END-IF.                                                      09960004
099700                                                                  09970004
099800                                                                  09980004
099900*-----------------------------------------------------------------09990004
100000*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION       10000004
100100*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.          10010004
100200*-----------------------------------------------------------------10020004
100300                                                                  10030004
100400 2140-DESELECT-ALL-ITEMS.                                         10040004
100500                                                                  10050004
100600     MOVE +1                       TO ASC-BLK-SUB.                10060004
100700                                                                  10070004
100800     PERFORM 2141-CLEAR-SELECTED-INDS                             10080004
100900         VARYING ASC-ITEM-SUB                                     10090004
101000         FROM 1 BY 1                                              10100004
101100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10110004
101200                                                                  10120004
101300     ADD +1                        TO ASC-BLK-SUB.                10130004
101400                                                                  10140004
101500     PERFORM 2141-CLEAR-SELECTED-INDS                             10150004
101600         VARYING ASC-ITEM-SUB                                     10160004
101700         FROM 1 BY 1                                              10170004
101800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10180004
101900                                                                  10190004
102000     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               10200004
102100                                   TO PV-LIST-ITEM-NUMBER.        10210004
102200                                                                  10220004
102300     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            10230004
102400         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    10240004
102500                                                                  10250004
102600     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     10260004
102700        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      10270004
102800         MOVE +1                   TO ASC-BLK-SUB                 10280004
102900                                                                  10290004
103000         PERFORM 5100-WRITE-TEMP-STORAGE                          10300004
103100                                                                  10310004
103200         MOVE +1                   TO PV-BLOCK-NUMBER             10320004
103300                                                                  10330004
103400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         10340004
103500             PV-FIRST-BLOCK-IN-ARRAY - 1                          10350004
103600                                                                  10360004
103700         PERFORM                                                  10370004
103800             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       10380004
103900                                                                  10390004
104000             PERFORM 4410-READ-TEMP-STORAGE                       10400004
104100                                                                  10410004
104200             PERFORM 2141-CLEAR-SELECTED-INDS                     10420004
104300                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 10430004
104400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10440004
104500                                                                  10450004
104600             PERFORM 5100-WRITE-TEMP-STORAGE                      10460004
104700                                                                  10470004
104800             ADD +1                TO PV-BLOCK-NUMBER             10480004
104900                                                                  10490004
105000         END-PERFORM                                              10500004
105100                                                                  10510004
105200         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         10520004
105300             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     10530004
105400                                                                  10540004
105500         PERFORM                                                  10550004
105600             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       10560004
105700                   ASC-HIGHEST-BLOCK-WRITTEN                      10570004
105800                                                                  10580004
105900             MOVE PV-NEXT-BLOCK-IN-ARRAY                          10590004
106000                                   TO PV-BLOCK-NUMBER             10600004
106100                                                                  10610004
106200             PERFORM 4410-READ-TEMP-STORAGE                       10620004
106300                                                                  10630004
106400             PERFORM 2141-CLEAR-SELECTED-INDS                     10640004
106500                 VARYING ASC-ITEM-SUB                             10650004
106600                 FROM 1 BY 1                                      10660004
106700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10670004
106800                                                                  10680004
106900             PERFORM 5100-WRITE-TEMP-STORAGE                      10690004
107000                                                                  10700004
107100             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      10710004
107200                                                                  10720004
107300         END-PERFORM                                              10730004
107400                                                                  10740004
107500         MOVE PV-FIRST-BLOCK-IN-ARRAY                             10750004
107600                                   TO PV-BLOCK-NUMBER             10760004
107700                                                                  10770004
107800         PERFORM 4410-READ-TEMP-STORAGE                           10780004
107900     END-IF.                                                      10790004
108000                                                                  10800004
108100                                                                  10810004
108200     MOVE +0        TO ASC-NUMBER-OF-SELECTED-ITEMS               10820004
108300                       ASC-START-OF-SELECTED-RANGE                10830004
108400                       ASC-END-OF-SELECTED-RANGE.                 10840004
108500                                                                  10850004
108600     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        10860004
108700                                                                  10870004
108800                                                                  10880004
108900*-----------------------------------------------------------------10890004
109000*    MARK EACH ITEM AS BEING NOT SELECTED.                        10900004
109100*-----------------------------------------------------------------10910004
109200                                                                  10920004
109300 2141-CLEAR-SELECTED-INDS.                                        10930004
109400                                                                  10940004
109500     IF ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)            10950004
109600             NOT EQUAL ZERO                                       10960004
109700         SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)              10970004
109800             ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        10980004
109900             ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      10990004
110000                               TO TRUE                            11000004
110100     END-IF.                                                      11010004
110200                                                                  11020004
110300                                                                  11030004
110400*-----------------------------------------------------------------11040004
110500*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH   11050004
110600*  FOR ALL ITEMS.                                                 11060004
110700*-----------------------------------------------------------------11070004
110800                                                                  11080004
110900 2150-SELECT-ALL-ITEMS.                                           11090004
111000                                                                  11100004
111100     MOVE ZERO  TO  ASC-NUMBER-OF-SELECTED-ITEMS.                 11110004
111200     MOVE +1    TO  ASC-BLK-SUB.                                  11120004
111300                                                                  11130004
111400     PERFORM 2151-SET-SELECTED-INDS                               11140004
111500         VARYING ASC-ITEM-SUB                                     11150004
111600         FROM 1 BY 1                                              11160004
111700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11170004
111800                                                                  11180004
111900     ADD +1                        TO ASC-BLK-SUB.                11190004
112000                                                                  11200004
112100     PERFORM 2151-SET-SELECTED-INDS                               11210004
112200         VARYING ASC-ITEM-SUB                                     11220004
112300         FROM 1 BY 1                                              11230004
112400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11240004
112500                                                                  11250004
112600     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               11260004
112700                                   TO PV-LIST-ITEM-NUMBER.        11270004
112800                                                                  11280004
112900     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            11290004
113000         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    11300004
113100                                                                  11310004
113200     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     11320004
113300        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    11330004
113400         MOVE +1                   TO ASC-BLK-SUB                 11340004
113500                                                                  11350004
113600         PERFORM 5100-WRITE-TEMP-STORAGE                          11360004
113700                                                                  11370004
113800         MOVE +1                   TO PV-BLOCK-NUMBER             11380004
113900                                                                  11390004
114000         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         11400004
114100             PV-FIRST-BLOCK-IN-ARRAY - 1                          11410004
114200                                                                  11420004
114300         PERFORM                                                  11430004
114400             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       11440004
114500                                                                  11450004
114600             PERFORM 4410-READ-TEMP-STORAGE                       11460004
114700                                                                  11470004
114800             PERFORM 2151-SET-SELECTED-INDS                       11480004
114900                 VARYING ASC-ITEM-SUB                             11490004
115000                 FROM 1 BY 1                                      11500004
115100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11510004
115200                                                                  11520004
115300             PERFORM 5100-WRITE-TEMP-STORAGE                      11530004
115400                                                                  11540004
115500             ADD +1                TO PV-BLOCK-NUMBER             11550004
115600                                                                  11560004
115700         END-PERFORM                                              11570004
115800                                                                  11580004
115900         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         11590004
116000             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     11600004
116100                                                                  11610004
116200         PERFORM                                                  11620004
116300             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       11630004
116400                   ASC-HIGHEST-BLOCK-WRITTEN                      11640004
116500                                                                  11650004
116600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          11660004
116700                                   TO PV-BLOCK-NUMBER             11670004
116800                                                                  11680004
116900             PERFORM 4410-READ-TEMP-STORAGE                       11690004
117000                                                                  11700004
117100             PERFORM 2151-SET-SELECTED-INDS                       11710004
117200                 VARYING ASC-ITEM-SUB                             11720004
117300                 FROM 1 BY 1                                      11730004
117400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11740004
117500                                                                  11750004
117600             PERFORM 5100-WRITE-TEMP-STORAGE                      11760004
117700                                                                  11770004
117800             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      11780004
117900                                                                  11790004
118000         END-PERFORM                                              11800004
118100                                                                  11810004
118200         MOVE PV-FIRST-BLOCK-IN-ARRAY                             11820004
118300                                   TO PV-BLOCK-NUMBER             11830004
118400                                                                  11840004
118500         PERFORM 4410-READ-TEMP-STORAGE                           11850004
118600     END-IF.                                                      11860004
118700                                                                  11870004
118800     MOVE +0        TO ASC-START-OF-SELECTED-RANGE                11880004
118900                       ASC-END-OF-SELECTED-RANGE.                 11890004
119000                                                                  11900004
119100     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        11910004
119200                                                                  11920004
119300                                                                  11930004
119400*-----------------------------------------------------------------11940004
119500*    MARK EACH ITEM AS BEING SELECTED.                            11950004
119600*-----------------------------------------------------------------11960004
119700                                                                  11970004
119800 2151-SET-SELECTED-INDS.                                          11980004
119900                                                                  11990004
120000     IF ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) NOT = ZERO 12000004
120100         ADD +1  TO  ASC-NUMBER-OF-SELECTED-ITEMS                 12010004
120200         SET ASC-SELECT         (ASC-BLK-SUB ASC-ITEM-SUB)        12020004
120300             ASC-TEMP-SELECT    (ASC-BLK-SUB ASC-ITEM-SUB)        12030004
120400             ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     12040004
120500                                   TO  TRUE                       12050004
120600     END-IF.                                                      12060004
120700                                                                  12070004
120800                                                                  12080004
120900*-----------------------------------------------------------------12090004
121000* MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE       12100004
121100* SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.    12110004
121200*-----------------------------------------------------------------12120004
121300                                                                  12130004
121400 2200-MOVE-SCREEN-TO-COMMAREA.                                    12140004
121500                                                                  12150004
121600     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             12160004
121700     MOVE +1                       TO PV-SUB.                     12170004
121800                                                                  12180004
121900     PERFORM 3100-SET-SUBSCRIPTS.                                 12190004
122000     IF  ASTRTITL > ZERO                                          12200004
122100         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          12210004
122200     ELSE                                                         12220004
122300         IF ASTRTITF = DP015-ERASE-EOF                            12230004
122400             MOVE SPACE TO ASC-START-ITEM-REQUEST                 12240004
122500         END-IF.                                                  12250004
122600                                                                  12260004
122700     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          12270004
122800         VARYING PV-SUB                                           12280004
122900         FROM 1 BY 1                                              12290004
123000         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      12300004
123100                                                                  12310004
123200                                                                  12320004
123300*-----------------------------------------------------------------12330004
123400* MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA.  12340004
123500*-----------------------------------------------------------------12350004
123600                                                                  12360004
123700 2210-MOVE-LINES-TO-COMMAREA.                                     12370004
123800                                                                  12380004
123900     IF  MR-SELECTL (PV-SUB) > ZERO                               12390004
124000         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             12400004
124100         MOVE MR-SELECT (PV-SUB)                                  12410004
124200                                   TO ASC-TEMP-SELECTED-SW        12420004
124300                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12430004
124400     ELSE                                                         12440004
124500         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                12450004
124600                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     12460004
124700                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        12470004
124800                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12480004
124900         END-IF                                                   12490004
125000     END-IF.                                                      12500004
125100     ADD +1                        TO ASC-ITEM-SUB.               12510004
125200     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        12520004
125300         ADD +1                    TO ASC-BLK-SUB                 12530004
125400         MOVE +1                   TO ASC-ITEM-SUB                12540004
125500     END-IF.                                                      12550004
125600                                                                  12560004
125700                                                                  12570004
125800*-----------------------------------------------------------------12580004
125900* EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE         12590004
126000* COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).    12600004
126100*-----------------------------------------------------------------12610004
126200                                                                  12620004
126300 3000-EDIT-DATA-IN-COMMAREA.                                      12630004
126400                                                                  12640004
126500     SET PS-NO-ERROR               TO TRUE.                       12650004
126600     PERFORM 3200-RESET-ATTRIBUTES.                               12660004
126700     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     12670004
126800                                                                  12680004
126900* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              12690004
127000* EDITTING IS DONE FROM THE BOTTOM UP.                            12700004
127100*                                                                 12710004
127200     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       12720004
127300         ASC-ITEMS-DISPLAYED - 1.                                 12730004
127400     PERFORM 3100-SET-SUBSCRIPTS.                                 12740004
127500     PERFORM 3300-EDIT-SELECTIONS                                 12750004
127600         VARYING PV-SUB                                           12760004
127700         FROM PV-SUB BY -1                                        12770004
127800         UNTIL PV-SUB < +1                                        12780004
127900                                                                  12790004
128000     IF  PS-NO-ERROR                                              12800004
128100         PERFORM 3400-CHECK-RANGE-SEQUENCE                        12810004
128200     END-IF.                                                      12820004
128300                                                                  12830004
128400     IF  ((PS-NO-ERROR)                                           12840004
128500       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   12850004
128600       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    12860004
128700             PERFORM 3500-MARK-RANGE-AS-SELECTED                  12870004
128800     END-IF.                                                      12880004
128900                                                                  12890004
129000                                                                  12900004
129100*-----------------------------------------------------------------12910004
129200*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM  12920004
129300*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL 12930004
129400*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                   12940004
129500*                                                                 12950004
129600*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS    12960004
129700*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT     12970004
129800*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION   12980004
129900*    US IN THE 2ND BLOCK OF THE ARRAY.                            12990004
130000*-----------------------------------------------------------------13000004
130100                                                                  13010004
130200 3100-SET-SUBSCRIPTS.                                             13020004
130300                                                                  13030004
130400     COMPUTE ASC-ITEM-SUB =                                       13040004
130500         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        13050004
130600                                                                  13060004
130700     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         13070004
130800         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            13080004
130900                                                                  13090004
131000         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               13100004
131100     ELSE                                                         13110004
131200         MOVE +1                     TO ASC-BLK-SUB               13120004
131300     END-IF.                                                      13130004
131400                                                                  13140004
131500                                                                  13150004
131600*-----------------------------------------------------------------13160004
131700* RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.        13170004
131800*-----------------------------------------------------------------13180004
131900                                                                  13190004
132000 3200-RESET-ATTRIBUTES.                                           13200004
132100                                                                  13210004
132200     MOVE DP015-UNP-NUM-NOR-OFF    TO ASTRTITA.                   13220004
132300     MOVE DP015-GREEN              TO ASTRTITC.                   13230004
132400     MOVE DP015-UNDERLINE          TO ASTRTITH.                   13240004
132500                                                                  13250004
132600     PERFORM                                                      13260004
132700         VARYING PV-SUB                                           13270004
132800         FROM 1 BY 1                                              13280004
132900         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        13290004
133000         MOVE DP015-UNP-ALP-NOR-OFF                               13300004
133100                                   TO MR-SELECTA (PV-SUB)         13310004
133200         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         13320004
133300         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         13330004
133400     END-PERFORM.                                                 13340004
133500                                                                  13350004
133600                                                                  13360004
133700*-----------------------------------------------------------------13370004
133800* EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS       13380004
133900* WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'      13390004
134000* IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR       13400004
134100* WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.                13410004
134200*-----------------------------------------------------------------13420004
134300                                                                  13430004
134400 3300-EDIT-SELECTIONS.                                            13440004
134500                                                                  13450004
134600     EVALUATE TRUE                                                13460004
134700         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13470004
134800             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         13480004
134900                 CONTINUE                                         13490004
135000         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         13500004
135100             IF NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)         13510004
135200                 ADD +1 TO ASC-NUMBER-OF-SELECTED-ITEMS           13520004
135300                 IF ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)          13530004
135400                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    13540004
135500                 ELSE                                             13550004
135600                     IF ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)        13560004
135700                         MOVE ZERO                                13570004
135800                              TO ASC-END-OF-SELECTED-RANGE        13580004
135900                     END-IF                                       13590004
136000                 END-IF                                           13600004
136100                 MOVE ASC-TEMP-SELECTED-SW                        13610004
136200                                    (ASC-BLK-SUB ASC-ITEM-SUB)    13620004
136300                     TO ASC-SELECTED-SW                           13630004
136400                                    (ASC-BLK-SUB ASC-ITEM-SUB)    13640004
136500             END-IF                                               13650004
136600         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13660004
136700                 = SPACE                                          13670004
136800             EVALUATE TRUE                                        13680004
136900                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       13690004
137000                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS13700004
137100                     MOVE SPACE TO ASC-SELECTED-SW                13710004
137200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13720004
137300                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        13730004
137400                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    13740004
137500                     MOVE SPACE TO ASC-SELECTED-SW                13750004
137600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13760004
137700                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          13770004
137800                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      13780004
137900                     MOVE SPACE TO ASC-SELECTED-SW                13790004
138000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13800004
138100             END-EVALUATE                                         13810004
138200         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           13820004
138300             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13830004
138400                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    13840004
138500             END-IF                                               13850004
138600             PERFORM 3310-EDIT-RANGE                              13860004
138700         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             13870004
138800             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13880004
138900                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    13890004
139000             END-IF                                               13900004
139100             PERFORM 3310-EDIT-RANGE                              13910004
139200         WHEN OTHER                                               13920004
139300*            ---- INVALID VALUE ----                              13930004
139400             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           13940004
139500             SET DP020-MSG-FATAL    TO TRUE                       13950004
139600             MOVE -1                TO MR-SELECTL (PV-SUB)        13960004
139700             SET DP030-SET-CURSOR-APPL-1                          13970004
139800                                    TO TRUE                       13980004
139900             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        13990004
140000             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        14000004
140100             SET PS-ERROR TO TRUE                                 14010004
140200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14020004
140300                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     14030004
140400                 MOVE SPACE         TO ASC-SELECTED-SW            14040004
140500                                        (ASC-BLK-SUB ASC-ITEM-SUB)14050004
140600             END-IF                                               14060004
140700     END-EVALUATE.                                                14070004
140800                                                                  14080004
140900     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 14090004
141000     SUBTRACT +1 FROM ASC-ITEM-SUB.                               14100004
141100     IF  ASC-ITEM-SUB < 1                                         14110004
141200         SUBTRACT +1 FROM ASC-BLK-SUB                             14120004
141300         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                14130004
141400     END-IF.                                                      14140004
141500                                                                  14150004
141600                                                                  14160004
141700*-----------------------------------------------------------------14170004
141800* IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A         14180004
141900* RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1       14190004
142000* ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)   14200004
142100* THE ENDING.                                                     14210004
142200*-----------------------------------------------------------------14220004
142300                                                                  14230004
142400 3310-EDIT-RANGE.                                                 14240004
142500                                                                  14250004
142600     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                14260004
142700         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   14270004
142800             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)14280004
142900                                   TO ASC-SELECTED-SW             14290004
143000                                        (ASC-BLK-SUB ASC-ITEM-SUB)14300004
143100             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 14310004
143200         ELSE                                                     14320004
143300             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     14330004
143400                 CONTINUE                                         14340004
143500             ELSE                                                 14350004
143600*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        14360004
143700                 MOVE PC-TSYMSG-00054                             14370004
143800                                   TO DP020-MSG-NUMBER            14380004
143900                 SET DP020-MSG-FATAL                              14390004
144000                                   TO TRUE                        14400004
144100                 MOVE -1           TO MR-SELECTL (PV-SUB)         14410004
144200                 SET DP030-SET-CURSOR-APPL-1                      14420004
144300                                   TO TRUE                        14430004
144400                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         14440004
144500                 MOVE DP015-UNDERLINE                             14450004
144600                                   TO MR-SELECTH (PV-SUB)         14460004
144700                 SET PS-ERROR      TO TRUE                        14470004
144800             END-IF                                               14480004
144900         END-IF                                                   14490004
145000     ELSE                                                         14500004
145100         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     14510004
145200             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 14520004
145300                                   TO ASC-SELECTED-SW             14530004
145400                                     (ASC-BLK-SUB ASC-ITEM-SUB)   14540004
145500             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   14550004
145600         ELSE                                                     14560004
145700             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       14570004
145800                 CONTINUE                                         14580004
145900             ELSE                                                 14590004
146000*                -- ONLY ONE END-OF-RANGE ALLOWED --              14600004
146100                 MOVE PC-TSYMSG-00055                             14610004
146200                                   TO DP020-MSG-NUMBER            14620004
146300                 SET DP020-MSG-FATAL                              14630004
146400                                   TO TRUE                        14640004
146500                 MOVE -1           TO MR-SELECTL (PV-SUB)         14650004
146600                 SET DP030-SET-CURSOR-APPL-1                      14660004
146700                                   TO TRUE                        14670004
146800                 SET PS-ERROR      TO TRUE                        14680004
146900             END-IF                                               14690004
147000         END-IF                                                   14700004
147100     END-IF.                                                      14710004
147200                                                                  14720004
147300                                                                  14730004
147400*-----------------------------------------------------------------14740004
147500* IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,       14750004
147600* MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.     14760004
147700*-----------------------------------------------------------------14770004
147800                                                                  14780004
147900 3400-CHECK-RANGE-SEQUENCE.                                       14790004
148000                                                                  14800004
148100     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       14810004
148200       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      14820004
148300       AND  ASC-START-OF-SELECTED-RANGE >                         14830004
148400                                         ASC-END-OF-SELECTED-RANGE14840004
148500*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                14850004
148600         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 14860004
148700         SET DP020-MSG-FATAL TO TRUE                              14870004
148800         SET PS-ERROR TO TRUE                                     14880004
148900         PERFORM 3410-POSITION-AT-ERROR                           14890004
149000     ELSE                                                         14900004
149100         MOVE -1 TO MR-SELECTL (1)                                14910004
149200     END-IF.                                                      14920004
149300     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       14930004
149400                                                                  14940004
149500                                                                  14950004
149600*-----------------------------------------------------------------14960004
149700* BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE       14970004
149800* PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR    14980004
149900* SHOULD BE POSITIONED ON A RANGE ERROR.                          14990004
150000*-----------------------------------------------------------------15000004
150100                                                                  15010004
150200 3410-POSITION-AT-ERROR.                                          15020004
150300                                                                  15030004
150400     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 15040004
150500                    - PV-TOP-ITEM + 1.                            15050004
150600     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      15060004
150700         CONTINUE                                                 15070004
150800     ELSE                                                         15080004
150900         MOVE -1                   TO MR-SELECTL (PV-SUB)         15090004
151000         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         15100004
151100         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         15110004
151200     END-IF.                                                      15120004
151300*                                                                 15130004
151400     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   15140004
151500                    - PV-TOP-ITEM + 1.                            15150004
151600     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      15160004
151700         CONTINUE                                                 15170004
151800     ELSE                                                         15180004
151900         MOVE -1                   TO MR-SELECTL (PV-SUB)         15190004
152000         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         15200004
152100         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         15210004
152200     END-IF.                                                      15220004
152300                                                                  15230004
152400                                                                  15240004
152500*-----------------------------------------------------------------15250004
152600*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE     15260004
152700*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS     15270004
152800*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.              15280004
152900*-----------------------------------------------------------------15290004
153000                                                                  15300004
153100 3500-MARK-RANGE-AS-SELECTED.                                     15310004
153200                                                                  15320004
153300     MOVE +1                       TO  ASC-BLK-SUB.               15330004
153400     PERFORM 3510-MARK-SELECTED-INDS                              15340004
153500         VARYING ASC-ITEM-SUB                                     15350004
153600         FROM 1 BY 1                                              15360004
153700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15370004
153800                                                                  15380004
153900     ADD +1                        TO ASC-BLK-SUB.                15390004
154000     PERFORM 3510-MARK-SELECTED-INDS                              15400004
154100         VARYING ASC-ITEM-SUB                                     15410004
154200         FROM 1 BY 1                                              15420004
154300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15430004
154400                                                                  15440004
154500     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               15450004
154600                                   TO  PV-LIST-ITEM-NUMBER.       15460004
154700     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            15470004
154800         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         15480004
154900               PC-ITEMS-PER-PANEL).                               15490004
155000                                                                  15500004
155100     MOVE ASC-START-OF-SELECTED-RANGE                             15510004
155200                                   TO PV-START-OF-SELECTED-RANGE. 15520004
155300     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            15530004
155400         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  15540004
155500               PC-ITEMS-PER-PANEL).                               15550004
155600                                                                  15560004
155700     MOVE ASC-END-OF-SELECTED-RANGE                               15570004
155800                                   TO  PV-END-OF-SELECTED-RANGE.  15580004
155900     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             15590004
156000         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    15600004
156100               PC-ITEMS-PER-PANEL).                               15610004
156200     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             15620004
156300         PV-FIRST-BLOCK-IN-ARRAY + 1.                             15630004
156400                                                                  15640004
156500     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    15650004
156600        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        15660004
156700         MOVE +1                   TO ASC-BLK-SUB                 15670004
156800         PERFORM 5100-WRITE-TEMP-STORAGE                          15680004
156900         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         15690004
157000             PV-FIRST-BLOCK-IN-ARRAY - 1                          15700004
157100                                                                  15710004
157200         PERFORM                                                  15720004
157300             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      15730004
157400                   PV-PREV-BLOCK-IN-ARRAY                         15740004
157500             MOVE PV-FIRST-BLOCK-IN-RANGE                         15750004
157600                                   TO PV-BLOCK-NUMBER             15760004
157700             PERFORM 4410-READ-TEMP-STORAGE                       15770004
157800             PERFORM 3510-MARK-SELECTED-INDS                      15780004
157900                 VARYING ASC-ITEM-SUB                             15790004
158000                 FROM 1 BY 1                                      15800004
158100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15810004
158200             PERFORM 5100-WRITE-TEMP-STORAGE                      15820004
158300             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     15830004
158400         END-PERFORM                                              15840004
158500                                                                  15850004
158600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         15860004
158700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     15870004
158800         PERFORM                                                  15880004
158900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       15890004
159000                   PV-LAST-BLOCK-IN-RANGE                         15900004
159100             MOVE PV-NEXT-BLOCK-IN-ARRAY                          15910004
159200                                   TO PV-BLOCK-NUMBER             15920004
159300             PERFORM 4410-READ-TEMP-STORAGE                       15930004
159400             PERFORM 3510-MARK-SELECTED-INDS                      15940004
159500                 VARYING ASC-ITEM-SUB                             15950004
159600                 FROM 1 BY 1                                      15960004
159700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15970004
159800             PERFORM 5100-WRITE-TEMP-STORAGE                      15980004
159900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      15990004
160000         END-PERFORM                                              16000004
160100                                                                  16010004
160200         MOVE PV-FIRST-BLOCK-IN-ARRAY                             16020004
160300                                   TO PV-BLOCK-NUMBER             16030004
160400         PERFORM 4410-READ-TEMP-STORAGE                           16040004
160500     END-IF.                                                      16050004
160600                                                                  16060004
160700     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 16070004
160800                                      ASC-END-OF-SELECTED-RANGE.  16080004
160900                                                                  16090004
161000                                                                  16100004
161100*-----------------------------------------------------------------16110004
161200* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.            16120004
161300*-----------------------------------------------------------------16130004
161400                                                                  16140004
161500 3510-MARK-SELECTED-INDS.                                         16150004
161600                                                                  16160004
161700     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         16170004
161800                                ASC-ITEM-SUB) >                   16180004
161900         ASC-START-OF-SELECTED-RANGE)                             16190004
162000     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         16200004
162100                                ASC-ITEM-SUB) =                   16210004
162200         ASC-START-OF-SELECTED-RANGE)                             16220004
162300                                                                  16230004
162400         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     16240004
162500                                    ASC-ITEM-SUB) <               16250004
162600             ASC-END-OF-SELECTED-RANGE)                           16260004
162700         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     16270004
162800                                    ASC-ITEM-SUB) =               16280004
162900             ASC-END-OF-SELECTED-RANGE)                           16290004
163000                                                                  16300004
163100             IF NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)         16310004
163200                 SET ASC-SELECT    (ASC-BLK-SUB  ASC-ITEM-SUB)    16320004
163300                 ASC-TEMP-SELECT   (ASC-BLK-SUB  ASC-ITEM-SUB)    16330004
163400                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  16340004
163500                           TO TRUE                                16350004
163600                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    16360004
163700             END-IF                                               16370004
163800         END-IF                                                   16380004
163900     END-IF.                                                      16390004
164000                                                                  16400004
164100                                                                  16410004
164200*-----------------------------------------------------------------16420004
164300*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                         16430004
164400*    INITIALIZE ALL COUNTERS AND FLAGS.                           16440004
164500*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.   16450004
164600*    DISPLAY THE PANEL TO USER.                                   16460004
164700*-----------------------------------------------------------------16470004
164800                                                                  16480004
164900 4000-BUILD-INITIAL-PANEL.                                        16490004
165000                                                                  16500004
165100     INITIALIZE                   ASC-BLOCK-ENTRIES (1)           16510004
165200                                  ASC-BLOCK-ENTRIES (2)           16520004
165300                                  ASC-HEADER-INFO.                16530004
165400                                                                  16540004
165500     MOVE +1                   TO ASC-BLK-SUB.                    16550004
165600     SET ASC-ITEMS-LEFT-ON-DB  TO TRUE.                           16560004
165700     SET PS-DATA-AVAILABLE     TO TRUE.                           16570004
165800                                                                  16580004
165900     MOVE +0                   TO ASC-ITEM-SUB                    16590004
166000                                  ASC-NUMBER-OF-ITEMS-READ        16600004
166100                                  ASC-NUMBER-OF-SELECTED-ITEMS    16610004
166200                                  ASC-HIGHEST-BLOCK-WRITTEN       16620004
166300                                  ASC-START-OF-SELECTED-RANGE     16630004
166400                                  ASC-END-OF-SELECTED-RANGE       16640004
166500                                  ASC-ITEM-AT-TOP-OF-PANEL.       16650004
166600                                                                  16660004
166700                                                                  16670004
166800     PERFORM Z800-OPEN-CURSOR.                                    16680004
166900                                                                  16690004
167000     IF PS-DATA-NOT-AVAILABLE                                     16700004
167100         CONTINUE                                                 16710004
167200     ELSE                                                         16720004
167300         EVALUATE TRUE                                            16730004
167400             WHEN ASC-TRN-SET-CDE = PC-TRN-SET-CDE-POA            16740004
167500                 PERFORM 4310-POA-READ-ITEMS-FROM-DB              16750004
167600             WHEN ASC-TRN-SET-CDE = PC-TRN-SET-CDE-INV            16760004
167700                 PERFORM 4320-INV-READ-ITEMS-FROM-DB              16770004
167800             WHEN OTHER                                           16780004
167900                 CONTINUE                                         16790004
168000         END-EVALUATE                                             16800004
168100     END-IF.                                                      16810004
168200                                                                  16820004
168300     IF PS-DATA-NOT-AVAILABLE                                     16830004
168400         SET DP020-MSG-WARNING  TO TRUE                           16840004
168500*        ---- WAIT 15 SECONDS, THEN RETRY ----                    16850004
168600         MOVE PC-TSYMSG-00551   TO  DP020-MSG-NUMBER              16860004
168700         IF DP020-FK-REFRESH        (DP020-SRC-AID)               16870004
168800         OR DP020-FK-PREV-SELECTION (DP020-SRC-AID)               16880004
168900         OR DP020-FK-NEXT-SELECTION (DP020-SRC-AID)               16890004
169000             CONTINUE                                             16900004
169100         ELSE                                                     16910004
169200             SET  DP020-NEXT-ACT-APPL-ERROR TO TRUE               16920004
169300         END-IF                                                   16930004
169400     ELSE                                                         16940004
169500         PERFORM Z820-CLOSE-CURSOR                                16950004
169600                                                                  16960004
169700         MOVE +1 TO  PV-TOP-ITEM                                  16970004
169800         IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                      16980004
169900             MOVE -1                     TO ASTRTITL              16990004
170000             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  17000004
170100         ELSE                                                     17010004
170200             MOVE -1                     TO MR-SELECTL (1)        17020004
170300             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  17030004
170400         END-IF                                                   17040004
170500         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     17050004
170600     END-IF.                                                      17060004
170700                                                                  17070004
170800                                                                  17080004
170900 4310-POA-READ-ITEMS-FROM-DB.                                     17090004
171000                                                                  17100004
171100     PERFORM                                                      17110004
171200         VARYING PV-READ-COUNT                                    17120004
171300         FROM 1 BY 1                                              17130004
171400         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    17140004
171500            OR (ASC-NO-ITEMS-LEFT-ON-DB)                          17150004
171600            OR (PS-DATA-NOT-AVAILABLE))                           17160004
171700                                                                  17170004
171800         PERFORM Z810-FETCH-CURSOR                                17180004
171900                                                                  17190004
172000         IF   PS-DATA-AVAILABLE                                   17200004
172100         AND  ASC-ITEMS-LEFT-ON-DB                                17210004
172200             MOVE FGTRDT-TRN-SET-DATA-TEXT TO PO002-EDI855-RECORD 17220004
172300             EVALUATE TRUE                                        17230004
172400                 WHEN PO002-HEADER-RECORD                         17240004
172500                     PERFORM 4313-POA-PROCESS-HEADER-RECORD       17250004
172600                 WHEN PO002-ITEM-RECORD                           17260004
172700                     PERFORM 4315-POA-CHECK-FOR-ERRORS            17270004
172800                     IF PS-POA-NO-ERRORS                          17280004
172900                         CONTINUE                                 17290004
173000                     ELSE                                         17300004
173100                         PERFORM 4317-POA-PROCESS-ITEM-RECORD     17310004
173200                     END-IF                                       17320004
173300                 WHEN OTHER                                       17330004
173400                     CONTINUE                                     17340004
173500             END-EVALUATE                                         17350004
173600         END-IF                                                   17360004
173700     END-PERFORM.                                                 17370004
173800                                                                  17380004
173900     IF PS-DATA-NOT-AVAILABLE                                     17390004
174000         CONTINUE                                                 17400004
174100     ELSE                                                         17410004
174200         IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                      17420004
174300             MOVE +1               TO ASC-BLK-SUB                 17430004
174400             PERFORM 5100-WRITE-TEMP-STORAGE                      17440004
174500             ADD +1                TO ASC-BLK-SUB                 17450004
174600             PERFORM 5100-WRITE-TEMP-STORAGE                      17460004
174700                                                                  17470004
174800             MOVE 1                TO ASC-BLK-SUB                 17480004
174900                                      PV-BLOCK-NUMBER             17490004
175000             PERFORM 4410-READ-TEMP-STORAGE                       17500004
175100             IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1         17510004
175200                 MOVE 2            TO ASC-BLK-SUB                 17520004
175300                                      PV-BLOCK-NUMBER             17530004
175400                 PERFORM 4410-READ-TEMP-STORAGE                   17540004
175500             END-IF                                               17550004
175600         END-IF                                                   17560004
175700     END-IF.                                                      17570004
175800                                                                  17580004
175900                                                                  17590004
176000 4313-POA-PROCESS-HEADER-RECORD.                                  17600004
176100                                                                  17610004
176200     IF PO002-NEW-PO-BAD                                          17620004
176300         MOVE PC-STATUS-NEW-PO        TO ASC-PO-STATUS            17630004
176400     ELSE                                                         17640004
176500         MOVE PC-STATUS-DUP           TO ASC-PO-STATUS            17650004
176600     END-IF.                                                      17660004
176700                                                                  17670004
176800     MOVE PO002-H-DEPT-NBR            TO ASC-DEPT-NBR.            17680004
176900                                                                  17690004
177000     IF PO002-ONE-DEPT                                            17700004
177100         CONTINUE                                                 17710004
177200     ELSE                                                         17720004
177300        IF PO002-MULTIPLE-DEPTS                                   17730004
177400            MOVE PC-STATUS-MULT-DEPT  TO ASC-DEPT-STATUS          17740004
177500        ELSE                                                      17750004
177600            MOVE PC-STATUS-NO-DEPT    TO ASC-DEPT-STATUS          17760004
177700        END-IF                                                    17770004
177800     END-IF.                                                      17780004
177900                                                                  17790004
178000                                                                  17800004
178100 4315-POA-CHECK-FOR-ERRORS.                                       17810004
178200                                                                  17820004
178300     IF PO002-I-SKU IS NUMERIC                                    17830004
178400        MOVE PO002-I-SKU TO PV-PO002-I-SKU                        17840004
178500        MOVE PV-PO002-I-SKU TO PV-SKXREF-SKU                      17850004
178600        PERFORM Z840-GET-DEPARTMENT.                              17860004
178700                                                                  17870004
178800     SET PS-POA-NO-ERRORS TO TRUE.                                17880004
178900                                                                  17890004
179000     IF PO002-I-SKU (1:5) = 'NOSKU' OR SQLCODE NOT = ZERO         17900004
179100         SET PS-POA-SKU-ERR TO TRUE                               17910004
179200     ELSE                                                         17920004
179300         IF ASC-ASSIGNED-DEPT-NBR = SPACE                         17930004
179400             CONTINUE                                             17940004
179500         ELSE                                                     17950004
179600             IF PV-SKXREF-DEPT NOT = ASC-ASSIGNED-DEPT-NBR        17960004
179700                 SET PS-POA-DEPT-ERR TO TRUE                      17970004
179800             END-IF                                               17980004
179900         END-IF                                                   17990004
180000     END-IF.                                                      18000004
180100                                                                  18010004
180200                                                                  18020004
180300*-----------------------------------------------------------------18030004
180400*  MOVE THE ITEMS FROM THE DATA BASE INTO THE BLOCKS IN THE ARRAY.18040004
180500*  WHENEVER BOTH BLOCKS BECOME FULL, WRITE OUT THE 1ST BLOCK TO   18050004
180600*  TEMPORARY STORAGE, MOVE THE 2ND BLOCK IN THE ARRAY TO THE 1ST  18060004
180700*  BLOCK, AND INITIALIZE THE 2ND BLOCK MAKING IT AVAILABLE TO BE  18070004
180800*  USED.                                                          18080004
180900*-----------------------------------------------------------------18090004
181000                                                                  18100004
181100 4317-POA-PROCESS-ITEM-RECORD.                                    18110004
181200                                                                  18120004
181300     IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                        18130004
181400         ADD +1            TO ASC-ITEM-SUB                        18140004
181500     ELSE                                                         18150004
181600         ADD +1            TO ASC-BLK-SUB                         18160004
181700         MOVE +1           TO ASC-ITEM-SUB                        18170004
181800                                                                  18180004
181900         IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY                 18190004
182000             MOVE +1       TO ASC-BLK-SUB                         18200004
182100             SET ASC-BLOCK-MODIFIED (1) TO TRUE                   18210004
182200             PERFORM 5100-WRITE-TEMP-STORAGE                      18220004
182300             MOVE ASC-BLOCK-ENTRIES                               18230004
182400                                  (PC-MAX-BLOCKS-IN-ARRAY)        18240004
182500                         TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB)        18250004
182600             ADD +1        TO ASC-BLK-SUB                         18260004
182700             INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)           18270004
182800             SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)              18280004
182900                                                   TO TRUE        18290004
183000         END-IF                                                   18300004
183100     END-IF.                                                      18310004
183200                                                                  18320004
183300     ADD +1                TO ASC-NUMBER-OF-ITEMS-READ.           18330004
183400                                                                  18340004
183500     MOVE ASC-NUMBER-OF-ITEMS-READ   TO ASC-LIST-ITEM-NUMBER      18350004
183600                                       (ASC-BLK-SUB ASC-ITEM-SUB).18360004
183700                                                                  18370004
183800     EVALUATE TRUE                                                18380004
183900         WHEN PS-POA-SKU-ERR                                      18390004
184000             MOVE PC-MSG-UPC-SKU-NOT-FND TO ASC-ERROR-MSG         18400004
184100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18410004
184200         WHEN PS-POA-DEPT-ERR                                     18420004
184300             MOVE PC-MSG-WRONG-DEPT      TO ASC-ERROR-MSG         18430004
184400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18440004
184500         WHEN OTHER                                               18450004
184600             CONTINUE                                             18460004
184700     END-EVALUATE.                                                18470004
184800                                                                  18480004
184900     MOVE PO002-I-UPC                TO ASC-UPC-NBR               18490004
185000                                       (ASC-BLK-SUB ASC-ITEM-SUB).18500004
185100                                                                  18510004
185200                                                                  18520004
185300 4320-INV-READ-ITEMS-FROM-DB.                                     18530004
185400                                                                  18540004
185500     PERFORM                                                      18550004
185600         VARYING PV-READ-COUNT                                    18560004
185700         FROM 1 BY 1                                              18570004
185800         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    18580004
185900            OR (ASC-NO-ITEMS-LEFT-ON-DB)                          18590004
186000            OR (PS-DATA-NOT-AVAILABLE))                           18600004
186100                                                                  18610004
186200         PERFORM Z810-FETCH-CURSOR                                18620004
186300                                                                  18630004
186400         IF   PS-DATA-AVAILABLE                                   18640004
186500         AND  ASC-ITEMS-LEFT-ON-DB                                18650004
186600             MOVE FGTRDT-TRN-SET-DATA-TEXT TO AP050-EDI-IN-FILE   18660004
186700             EVALUATE TRUE                                        18670004
186800                 WHEN AP050-INV-INTRCHG                           18680004
186900                     PERFORM 4323-INV-PROCESS-HEADER-RECORD       18690004
187000*                WHEN AP050-INV-DETAILS                           18700004
187100*                    PERFORM 4325-INV-CHECK-FOR-ERRORS            18710004
187200*                    IF PS-INV-NO-ERRORS                          18720004
187300*                        CONTINUE                                 18730004
187400*                    ELSE                                         18740004
187500*                        PERFORM 4327-INV-PROCESS-ITEM-RECORD     18750004
187600*                    END-IF                                       18760004
187700                 WHEN OTHER                                       18770004
187800                     CONTINUE                                     18780004
187900         END-IF                                                   18790004
188000     END-PERFORM.                                                 18800004
188100                                                                  18810004
188200     IF PS-DATA-NOT-AVAILABLE                                     18820004
188300         CONTINUE                                                 18830004
188400     ELSE                                                         18840004
188500         IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                      18850004
188600             MOVE +1               TO ASC-BLK-SUB                 18860004
188700             PERFORM 5100-WRITE-TEMP-STORAGE                      18870004
188800             ADD +1                TO ASC-BLK-SUB                 18880004
188900             PERFORM 5100-WRITE-TEMP-STORAGE                      18890004
189000                                                                  18900004
189100             MOVE 1                TO ASC-BLK-SUB                 18910004
189200                                      PV-BLOCK-NUMBER             18920004
189300             PERFORM 4410-READ-TEMP-STORAGE                       18930004
189400             IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1         18940004
189500                 MOVE 2            TO ASC-BLK-SUB                 18950004
189600                                      PV-BLOCK-NUMBER             18960004
189700                 PERFORM 4410-READ-TEMP-STORAGE                   18970004
189800             END-IF                                               18980004
189900         END-IF                                                   18990004
190000     END-IF.                                                      19000004
190100                                                                  19010004
190200                                                                  19020004
190300 4323-INV-PROCESS-HEADER-RECORD.                                  19030004
190400                                                                  19040004
190500     IF AP050-PO-NOT-FOUND                                        19050004
190600     OR AP050-PO-ON-HOLD                                          19060004
190700         SET PS-DONT-CHECK-FOR-LINE-MATCH TO TRUE                 19070004
190800     ELSE                                                         19080004
190900         SET PS-CHECK-FOR-LINE-MATCH      TO TRUE                 19090004
191000     END-IF.                                                      19100004
191100                                                                  19110004
191200     IF AP050-PO-NOT-FOUND                                        19120004
191300         MOVE PC-STATUS-NOT-FOUND         TO ASC-PO-STATUS        19130004
191400     ELSE                                                         19140004
191500         IF AP050-PO-ON-HOLD                                      19150004
191600             MOVE PC-STATUS-ON-HOLD       TO ASC-PO-STATUS        19160004
191700         ELSE                                                     19170004
191800             PERFORM Z830-GET-STATUS                              19180004
191900             EVALUATE TRUE                                        19190004
192000                 WHEN SQLCODE = ZERO                              19200004
192100                     MOVE STATCD-STATUS-DESC TO ASC-PO-STATUS     19210004
192200                 WHEN OTHER                                       19220004
192300                     CONTINUE                                     19230004
192400             END-EVALUATE                                         19240004
192500         END-IF                                                   19250004
192600     END-IF.                                                      19260004
192700                                                                  19270004
192800     MOVE AP050-VENDOR-INVOICE-NBR    TO ASC-INVOICE-NBR.         19280004
192900     MOVE PC-STATUS-NEW-INVOICE       TO ASC-INV-STATUS.          19290004
193000     MOVE AP050-DEPT-NBR-ON-PO        TO ASC-DEPT-NBR.            19300004
193100                                                                  19310004
193200                                                                  19320004
193300*4325-INV-CHECK-FOR-ERRORS.                                       19330004
193400*                                                                 19340004
193500*    SET PS-INV-NO-ERRORS TO TRUE.                                19350004
193600*                                                                 19360004
193700*    IF AP050-KOHLS-SKU = SPACE                                   19370004
193800*        SET PS-INV-SKU-ERR TO TRUE                               19380004
193900*    ELSE                                                         19390004
194000*        IF   PS-CHECK-FOR-LINE-MATCH                             19400004
194100*        AND  AP050-NO-LINE-MATCH                                 19410004
194200*            SET PS-INV-UPC-ERR TO TRUE                           19420004
194300*        END-IF                                                   19430004
194400*    END-IF.                                                      19440004
194500*                                                                 19450004
194600*                                                                 19460004
194700*-----------------------------------------------------------------19470004
194800*  MOVE THE ITEMS FROM THE DATA BASE INTO THE BLOCKS IN THE ARRAY.19480004
194900*  WHENEVER BOTH BLOCKS BECOME FULL, WRITE OUT THE 1ST BLOCK TO   19490004
195000*  TEMPORARY STORAGE, MOVE THE 2ND BLOCK IN THE ARRAY TO THE 1ST  19500004
195100*  BLOCK, AND INITIALIZE THE 2ND BLOCK MAKING IT AVAILABLE TO BE  19510004
195200*  USED.                                                          19520004
195300*-----------------------------------------------------------------19530004
195400*                                                                 19540004
195500*4327-INV-PROCESS-ITEM-RECORD.                                    19550004
195600*                                                                 19560004
195700*    IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                        19570004
195800*        ADD +1            TO ASC-ITEM-SUB                        19580004
195900*    ELSE                                                         19590004
196000*        ADD +1            TO ASC-BLK-SUB                         19600004
196100*        MOVE +1           TO ASC-ITEM-SUB                        19610004
196200*                                                                 19620004
196300*        IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY                 19630004
196400*            MOVE +1       TO ASC-BLK-SUB                         19640004
196500*            SET ASC-BLOCK-MODIFIED (1) TO TRUE                   19650004
196600*            PERFORM 5100-WRITE-TEMP-STORAGE                      19660004
196700*            MOVE ASC-BLOCK-ENTRIES                               19670004
196800*                                 (PC-MAX-BLOCKS-IN-ARRAY)        19680004
196900*                        TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB)        19690004
197000*            ADD +1        TO ASC-BLK-SUB                         19700004
197100*            INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)           19710004
197200*            SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)              19720004
197300*                                                  TO TRUE        19730004
197400*        END-IF                                                   19740004
197500*    END-IF.                                                      19750004
197600*                                                                 19760004
197700*    ADD +1                TO ASC-NUMBER-OF-ITEMS-READ.           19770004
197800*                                                                 19780004
197900*    MOVE ASC-NUMBER-OF-ITEMS-READ   TO ASC-LIST-ITEM-NUMBER      19790004
198000*                                      (ASC-BLK-SUB ASC-ITEM-SUB).19800004
198100*                                                                 19810004
198200*    EVALUATE TRUE                                                19820004
198300*        WHEN PS-INV-SKU-ERR                                      19830004
198400*            MOVE PC-MSG-UPC-SKU-NOT-FND TO ASC-ERROR-MSG         19840004
198500*                                      (ASC-BLK-SUB ASC-ITEM-SUB) 19850004
198600*        WHEN PS-INV-UPC-ERR                                      19860004
198700*            MOVE PC-MSG-UPC-NOT-ON-PO   TO ASC-ERROR-MSG         19870004
198800*                                      (ASC-BLK-SUB ASC-ITEM-SUB) 19880004
198900*        WHEN OTHER                                               19890004
199000*            CONTINUE                                             19900004
199100*    END-EVALUATE.                                                19910004
199200*                                                                 19920004
199300*    IF AP050-EAN                                                 19930004
199400*        MOVE AP050-EAN-UPC          TO ASC-UPC-NBR               19940004
199500*                                      (ASC-BLK-SUB ASC-ITEM-SUB) 19950004
199600*                                      (3:13)                     19960004
199700*    ELSE                                                         19970004
199800*        MOVE '0'                    TO ASC-UPC-NBR               19980004
199900*                                      (ASC-BLK-SUB ASC-ITEM-SUB) 19990004
200000*                                      (3:1)                      20000004
200100*        MOVE AP050-UPC-CODE         TO ASC-UPC-NBR               20010004
200200*                                      (ASC-BLK-SUB ASC-ITEM-SUB) 20020004
200300*                                      (4:12)                     20030004
200400*    END-IF.                                                      20040004
200500*                                                                 20050004
200600*                                                                 20060004
200700*-----------------------------------------------------------------20070004
200800* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.      20080004
200900*-----------------------------------------------------------------20090004
201000                                                                  20100004
201100 4400-MOVE-COMMAREA-TO-SCREEN.                                    20110004
201200                                                                  20120004
201300     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             20130004
201400         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          20140004
201500         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          20150004
201600             MOVE +1    TO ASC-BLK-SUB                            20160004
201700             PERFORM 5100-WRITE-TEMP-STORAGE                      20170004
201800             ADD +1     TO ASC-BLK-SUB                            20180004
201900             PERFORM 5100-WRITE-TEMP-STORAGE                      20190004
202000             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             20200004
202100                 GIVING PV-BLOCK-NUMBER                           20210004
202200                 REMAINDER PV-REMAINDER                           20220004
202300             IF  PV-REMAINDER > ZERO                              20230004
202400                 ADD +1 TO PV-BLOCK-NUMBER                        20240004
202500             END-IF                                               20250004
202600             MOVE +1    TO ASC-BLK-SUB                            20260004
202700             PERFORM 4410-READ-TEMP-STORAGE                       20270004
202800             ADD +1     TO ASC-BLK-SUB                            20280004
202900                           PV-BLOCK-NUMBER                        20290004
203000             PERFORM 4410-READ-TEMP-STORAGE                       20300004
203100     END-IF.                                                      20310004
203200     MOVE +1            TO ASC-BLK-SUB.                           20320004
203300     COMPUTE ASC-ITEM-SUB =                                       20330004
203400         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              20340004
203500         + PC-ITEMS-PER-PANEL).                                   20350004
203600                                                                  20360004
203700     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        20370004
203800         ADD +1         TO ASC-BLK-SUB                            20380004
203900         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            20390004
204000     END-IF.                                                      20400004
204100                                                                  20410004
204200     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           20420004
204300         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                20430004
204400     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        20440004
204500     PERFORM 4420-FORMAT-LIST-LINES                               20450004
204600         VARYING PV-SUB                                           20460004
204700         FROM PC-ITEMS-PER-PANEL BY -1                            20470004
204800         UNTIL PV-SUB < +1.                                       20480004
204900                                                                  20490004
205000     COMPUTE ASC-ITEMS-DISPLAYED =                                20500004
205100         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          20510004
205200     IF PS-NO-START-ITEM-ERROR                                    20520004
205300         MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL20530004
205400                                          ASTRTITO                20540004
205500         MOVE SPACE                    TO ASC-START-ITEM-REQUEST  20550004
205600     ELSE                                                         20560004
205700         MOVE ASC-START-ITEM-REQUEST   TO ASTRTITO                20570004
205800     END-IF.                                                      20580004
205900     MOVE ASC-ITEM-AT-BOT-OF-PANEL     TO AENDITO.                20590004
206000     MOVE ASC-NUMBER-OF-ITEMS-READ     TO ATOTITO.                20600004
206100     MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO ASELITO.                20610004
206200                                                                  20620004
206300*    *------------------------------------------------------------20630004
206400*    * FILL IN THE FIELDS IN THE HEADER PORTION OF THE SCREEN.    20640004
206500*    *------------------------------------------------------------20650004
206600                                                                  20660004
206700     MOVE ASC-PO-NBR                          TO APONBRO.         20670004
206800     MOVE ASC-PO-STATUS                       TO APOSTATO.        20680004
206900                                                                  20690004
207000     EVALUATE TRUE                                                20700004
207100         WHEN ASC-TRN-SET-CDE = PC-TRN-SET-CDE-POA                20710004
207200             MOVE PC-DEPT-LINE-LABEL          TO AH2DESCO         20720004
207300             MOVE ASC-DEPT-NBR                TO AH2DATAO         20730004
207400             MOVE ASC-DEPT-STATUS             TO AH2STATO         20740004
207500             MOVE PC-ASSIGNED-DEPT-LINE-LABEL TO AH3DESCO         20750004
207600             MOVE ASC-ASSIGNED-DEPT-NBR       TO AH3DATAO         20760004
207700             MOVE PC-VENDOR-LINE-LABEL        TO AH4DESCO         20770004
207800             MOVE ASC-VENDOR-NAME             TO AH4DATAO         20780004
207900             MOVE SPACE                       TO AH5DESCO         20790004
208000                                                 AH5DATAO         20800004
208100         WHEN ASC-TRN-SET-CDE = PC-TRN-SET-CDE-INV                20810004
208200             MOVE PC-INV-LINE-LABEL           TO AH2DESCO         20820004
208300             MOVE ASC-INVOICE-NBR             TO AH2DATAO         20830004
208400             MOVE ASC-INV-STATUS              TO AH2STATO         20840004
208500             MOVE PC-DEPT-LINE-LABEL          TO AH3DESCO         20850004
208600             MOVE ASC-DEPT-NBR                TO AH3DATAO         20860004
208700             MOVE PC-ASSIGNED-DEPT-LINE-LABEL TO AH4DESCO         20870004
208800             MOVE ASC-ASSIGNED-DEPT-NBR       TO AH4DATAO         20880004
208900             MOVE PC-VENDOR-LINE-LABEL        TO AH5DESCO         20890004
209000             MOVE ASC-VENDOR-NAME             TO AH5DATAO         20900004
209100         WHEN OTHER                                               20910004
209200             MOVE SPACE TO                       AH2DESCO         20920004
209300                                                 AH2DATAO         20930004
209400                                                 AH2STATO         20940004
209500                                                 AH3DESCO         20950004
209600                                                 AH3DATAO         20960004
209700                                                 AH4DESCO         20970004
209800                                                 AH4DATAO         20980004
209900                                                 AH5DESCO         20990004
210000                                                 AH5DATAO         21000004
210100     END-EVALUATE.                                                21010004
210200                                                                  21020004
210300     IF  DP020-MSG-NUMBER-X = SPACE                               21030004
210400         IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                      21040004
210500             MOVE -1                    TO ASTRTITL               21050004
210600             SET DP030-SET-CURSOR-APPL-1                          21060004
210700                                        TO TRUE                   21070004
210800         ELSE                                                     21080004
210900             IF  ASC-ITEM-AT-BOT-OF-PANEL <                       21090004
211000                 ASC-NUMBER-OF-ITEMS-READ                         21100004
211100*                --- MORE ITEMS TO DISPLAY ----                   21110004
211200                 MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER        21120004
211300                 SET DP020-MSG-INFORMATIONAL TO TRUE              21130004
211400             END-IF                                               21140004
211500         END-IF                                                   21150004
211600     END-IF.                                                      21160004
211700                                                                  21170004
211800                                                                  21180004
211900*-----------------------------------------------------------------21190004
212000*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.          21200004
212100*-----------------------------------------------------------------21210004
212200                                                                  21220004
212300 4410-READ-TEMP-STORAGE.                                          21230004
212400                                                                  21240004
212500     EXEC CICS                                                    21250004
212600         READQ TS                                                 21260004
212700             QUEUE (ASC-LIST-QUEUE-NAME)                          21270004
212800             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               21280004
212900             ITEM  (PV-BLOCK-NUMBER)                              21290004
213000             RESP  (PV-CICS-RESP)                                 21300004
213100     END-EXEC.                                                    21310004
213200                                                                  21320004
213300     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       21330004
213400       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     21340004
213500         CONTINUE                                                 21350004
213600     ELSE                                                         21360004
213700         SET DP013-CICS-ABEND     TO TRUE                         21370004
213800         SET DP013-NO-ROLLBACK    TO TRUE                         21380004
213900         MOVE '4410-READ-TEMP-STORAGE'                            21390004
214000                                  TO DP013-PARAGRAPH              21400004
214100         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      21410004
214200                                  TO DP013-MESSAGE-TEXT(1)        21420004
214300         PERFORM DP013-0000-PROCESS-ABEND                         21430004
214400     END-IF.                                                      21440004
214500                                                                  21450004
214600     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             21460004
214700                                                                  21470004
214800     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         21480004
214900         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               21490004
215000     END-IF.                                                      21500004
215100                                                                  21510004
215200                                                                  21520004
215300*-----------------------------------------------------------------21530004
215400*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.     21540004
215500*-----------------------------------------------------------------21550004
215600                                                                  21560004
215700 4420-FORMAT-LIST-LINES.                                          21570004
215800                                                                  21580004
215900     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      21590004
216000         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                21600004
216100         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA      (PV-SUB)      21610004
216200         MOVE DP015-HL-OFF       TO MR-SELECTH      (PV-SUB)      21620004
216300         MOVE SPACE              TO MR-SELECT       (PV-SUB)      21630004
216400                                    MR-ACTION       (PV-SUB)      21640004
216500                                    MR-UPC-NBR      (PV-SUB)      21650004
216600                                    MR-ERROR-MSG    (PV-SUB)      21660004
216700     ELSE                                                         21670004
216800         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      21680004
216900                                                   > SPACE        21690004
217000             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 21700004
217100                                 TO MR-SELECT (PV-SUB)            21710004
217200         ELSE                                                     21720004
217300             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      21730004
217400                                 TO MR-SELECT (PV-SUB)            21740004
217500         END-IF                                                   21750004
217600                                                                  21760004
217700         IF  DP030-SET-CURSOR-TRAILER                             21770004
217800             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)21780004
217900                 > SPACE)                                         21790004
218000               OR (PV-SUB = 1))                                   21800004
218100                SET DP030-SET-CURSOR-APPL-1 TO TRUE               21810004
218200                MOVE -1          TO MR-SELECTL (PV-SUB)           21820004
218300             END-IF                                               21830004
218400         END-IF                                                   21840004
218500                                                                  21850004
218600         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           21860004
218700             MOVE ASC-ACTION         (ASC-BLK-SUB ASC-ITEM-SUB)   21870004
218800                  TO MR-ACTION       (PV-SUB)                     21880004
218900             MOVE ASC-UPC-NBR    (ASC-BLK-SUB ASC-ITEM-SUB) (3:2) 21890004
219000                  TO PV-FORMAT-UPC-NBR (1:2)                      21900004
219100             MOVE ASC-UPC-NBR    (ASC-BLK-SUB ASC-ITEM-SUB) (5:5) 21910004
219200                  TO PV-FORMAT-UPC-NBR (4:5)                      21920004
219300             MOVE ASC-UPC-NBR    (ASC-BLK-SUB ASC-ITEM-SUB) (10:5)21930004
219400                  TO PV-FORMAT-UPC-NBR (10:5)                     21940004
219500             MOVE ASC-UPC-NBR    (ASC-BLK-SUB ASC-ITEM-SUB) (15:1)21950004
219600                  TO PV-FORMAT-UPC-NBR (16:1)                     21960004
219700             MOVE PV-FORMAT-UPC-NBR                               21970004
219800                  TO MR-UPC-NBR      (PV-SUB)                     21980004
219900             MOVE ASC-ERROR-MSG      (ASC-BLK-SUB ASC-ITEM-SUB)   21990004
220000                  TO MR-ERROR-MSG    (PV-SUB)                     22000004
220100         END-IF                                                   22010004
220200     END-IF.                                                      22020004
220300     SUBTRACT +1 FROM ASC-ITEM-SUB                                22030004
220400     IF  ASC-ITEM-SUB < + 1                                       22040004
220500         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  22050004
220600         MOVE +1                 TO ASC-BLK-SUB                   22060004
220700     END-IF.                                                      22070004
220800                                                                  22080004
220900                                                                  22090004
221000*-----------------------------------------------------------------22100004
221100* IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF      22110004
221200* RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,         22120004
221300* ISSUE A WARNING.                                                22130004
221400*-----------------------------------------------------------------22140004
221500                                                                  22150004
221600 4430-CHECK-FOR-BEGIN-AND-END.                                    22160004
221700                                                                  22170004
221800     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       22180004
221900         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     22190004
222000*            -- NO END-OF-RANGE SPECFIED ---                      22200004
222100             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            22210004
222200             SET DP020-MSG-WARNING TO TRUE                        22220004
222300             PERFORM 4431-POSITION-AT-WARNING                     22230004
222400         END-IF                                                   22240004
222500     ELSE                                                         22250004
222600         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     22260004
222700*            -- NO BEGINNING-OF-RANGE SPECFIED ---                22270004
222800             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            22280004
222900             SET DP020-MSG-WARNING TO TRUE                        22290004
223000             PERFORM 4431-POSITION-AT-WARNING                     22300004
223100         END-IF                                                   22310004
223200     END-IF.                                                      22320004
223300                                                                  22330004
223400                                                                  22340004
223500*-----------------------------------------------------------------22350004
223600* ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,     22360004
223700* DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE      22370004
223800* IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND           22380004
223900* POSITION THE CURSOR THERE.                                      22390004
224000*-----------------------------------------------------------------22400004
224100                                                                  22410004
224200 4431-POSITION-AT-WARNING.                                        22420004
224300                                                                  22430004
224400     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 22440004
224500                    - PV-TOP-ITEM + 1.                            22450004
224600     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      22460004
224700         CONTINUE                                                 22470004
224800     ELSE                                                         22480004
224900         SET DP030-SET-CURSOR-APPL-1                              22490004
225000                                   TO TRUE                        22500004
225100         MOVE -1                   TO MR-SELECTL (PV-SUB)         22510004
225200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         22520004
225300         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         22530004
225400     END-IF.                                                      22540004
225500                                                                  22550004
225600     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   22560004
225700                    - PV-TOP-ITEM + 1.                            22570004
225800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      22580004
225900         CONTINUE                                                 22590004
226000     ELSE                                                         22600004
226100         SET DP030-SET-CURSOR-APPL-1                              22610004
226200                                   TO TRUE                        22620004
226300         MOVE -1                   TO MR-SELECTL (PV-SUB)         22630004
226400         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         22640004
226500         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         22650004
226600     END-IF.                                                      22660004
226700                                                                  22670004
226800                                                                  22680004
226900*-----------------------------------------------------------------22690004
227000* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-   22700004
227100* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT      22710004
227200* FOR THE SELECTED ITEMS QUEUE.                                   22720004
227300*                                                                 22730004
227400* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION      22740004
227500* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN     22750004
227600* THE ARRAY IS FULL.                                              22760004
227700*-----------------------------------------------------------------22770004
227800                                                                  22780004
227900 5000-PREPARE-SEL-QUEUE.                                          22790004
228000                                                                  22800004
228100     MOVE +1                   TO  ASC-BLK-SUB.                   22810004
228200     PERFORM 5100-WRITE-TEMP-STORAGE.                             22820004
228300     ADD +1                    TO  ASC-BLK-SUB.                   22830004
228400     PERFORM 5100-WRITE-TEMP-STORAGE.                             22840004
228500                                                                  22850004
228600     MOVE ASC-OUTPUT-SEL-QUEUE-NAME  TO  ET345-SEL-QUEUE-NAME.    22860004
228700     PERFORM 6010-DELETE-SEL-QUEUE.                               22870004
228800                                                                  22880004
228900     SET ASC-UPDATE-TSQ        TO  TRUE.                          22890004
229000                                                                  22900004
229100     SET ET346-IDX             TO  1.                             22910004
229200     MOVE ZERO                 TO ET345-NUMBER-OF-TS-ITEMS.       22920004
229300     INITIALIZE ET346-SELECTED-ITEM-ARRAY.                        22930004
229400                                                                  22940004
229500     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           22950004
229600             VARYING PV-ITEM                                      22960004
229700             FROM 1 BY 1                                          22970004
229800             UNTIL PV-ITEM > ASC-HIGHEST-BLOCK-WRITTEN.           22980004
229900                                                                  22990004
230000     IF  ET346-IDX > 1                                            23000004
230100         PERFORM 5205-WRITE-SEL-QUEUE                             23010004
230200         ADD +1                TO ET345-NUMBER-OF-TS-ITEMS        23020004
230300     END-IF.                                                      23030004
230400                                                                  23040004
230500                                                                  23050004
230600*-----------------------------------------------------------------23060004
230700*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.       23070004
230800*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.     23080004
230900*-----------------------------------------------------------------23090004
231000                                                                  23100004
231100 5100-WRITE-TEMP-STORAGE.                                         23110004
231200                                                                  23120004
231300     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     23130004
231400                                   TO PV-LIST-ITEM-NUMBER.        23140004
231500     COMPUTE PV-BLOCK-NUMBER =                                    23150004
231600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    23160004
231700                                                                  23170004
231800     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             23180004
231900     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             23190004
232000         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      23200004
232100             PERFORM 5105-REWRITE-ASC-LISTQ                       23210004
232200         END-IF                                                   23220004
232300     ELSE                                                         23230004
232400         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       23240004
232500         ASC-HIGHEST-BLOCK-WRITTEN + 1                            23250004
232600         PERFORM 5110-WRITE-ASC-LISTQ                             23260004
232700         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   23270004
232800     END-IF.                                                      23280004
232900                                                                  23290004
233000     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             23300004
233100                                                                  23310004
233200                                                                  23320004
233300*-----------------------------------------------------------------23330004
233400* REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       23340004
233500* SPECIFIC COMMAREA.                                              23350004
233600*-----------------------------------------------------------------23360004
233700                                                                  23370004
233800 5105-REWRITE-ASC-LISTQ.                                          23380004
233900                                                                  23390004
234000     EXEC CICS                                                    23400004
234100         WRITEQ TS                                                23410004
234200             QUEUE (ASC-LIST-QUEUE-NAME)                          23420004
234300             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               23430004
234400             ITEM  (PV-BLOCK-NUMBER)                              23440004
234500             REWRITE                                              23450004
234600             RESP  (PV-CICS-RESP)                                 23460004
234700     END-EXEC.                                                    23470004
234800                                                                  23480004
234900     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           23490004
235000         CONTINUE                                                 23500004
235100     ELSE                                                         23510004
235200         SET DP013-CICS-ABEND            TO TRUE                  23520004
235300         SET DP013-NO-ROLLBACK           TO TRUE                  23530004
235400         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       23540004
235500         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     23550004
235600                                         TO DP013-MESSAGE-TEXT(1) 23560004
235700         PERFORM DP013-0000-PROCESS-ABEND                         23570004
235800     END-IF.                                                      23580004
235900                                                                  23590004
236000                                                                  23600004
236100*-----------------------------------------------------------------23610004
236200* WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-         23620004
236300* SPECIFIC COMMAREA.                                              23630004
236400*-----------------------------------------------------------------23640004
236500                                                                  23650004
236600 5110-WRITE-ASC-LISTQ.                                            23660004
236700                                                                  23670004
236800     EXEC CICS                                                    23680004
236900         WRITEQ TS                                                23690004
237000             QUEUE (ASC-LIST-QUEUE-NAME)                          23700004
237100             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               23710004
237200             ITEM  (PV-BLOCK-NUMBER)                              23720004
237300             RESP  (PV-CICS-RESP)                                 23730004
237400     END-EXEC.                                                    23740004
237500     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      23750004
237600         SET DP013-CICS-ABEND      TO TRUE                        23760004
237700         SET DP013-NO-ROLLBACK     TO TRUE                        23770004
237800         MOVE '5110-WRITE-ASC-LISTQ'                              23780004
237900                                   TO DP013-PARAGRAPH             23790004
238000         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           23800004
238100                                   TO DP013-MESSAGE-TEXT(1)       23810004
238200         PERFORM DP013-0000-PROCESS-ABEND                         23820004
238300     END-IF.                                                      23830004
238400                                                                  23840004
238500                                                                  23850004
238600*-----------------------------------------------------------------23860004
238700* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS  23870004
238800* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.                23880004
238900*-----------------------------------------------------------------23890004
239000                                                                  23900004
239100 5200-FILL-SEL-QUEUE-RECORD.                                      23910004
239200                                                                  23920004
239300     PERFORM 6112-READ-LIST-QUEUE.                                23930004
239400                                                                  23940004
239500     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       23950004
239600         PERFORM                                                  23960004
239700         VARYING LQW-IDX                                          23970004
239800         FROM 1 BY 1                                              23980004
239900         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            23990004
240000           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          24000004
240100                                                                  24010004
240200             IF  LQW-SELECT (LQW-IDX)                             24020004
240300                 MOVE LQW-LIST-ITEM-NUMBER  (LQW-IDX)             24030004
240400                      TO ET346-ITEM         (ET346-IDX)           24040004
240500                 MOVE SPACE                                       24050004
240600                      TO ET346-ACTION-SW    (ET346-IDX)           24060004
240700                 MOVE LQW-UPC-NBR           (LQW-IDX)             24070004
240800                      TO ET346-UPC-NBR      (ET346-IDX)           24080004
240900                 MOVE ASC-VENDOR-NAME                             24090004
241000                      TO ET346-VENDOR-NAME  (ET346-IDX)           24100004
241100                 SET ET346-IDX UP BY 1                            24110004
241200                 IF  ET346-IDX > ET346-MAX-ITEMS                  24120004
241300                     PERFORM 5205-WRITE-SEL-QUEUE                 24130004
241400                     ADD +1        TO ET345-NUMBER-OF-TS-ITEMS    24140004
241500                     INITIALIZE ET346-SELECTED-ITEM-ARRAY         24150004
241600                     SET ET346-IDX TO  1                          24160004
241700                 END-IF                                           24170004
241800             END-IF                                               24180004
241900         END-PERFORM                                              24190004
242000     END-IF.                                                      24200004
242100                                                                  24210004
242200                                                                  24220004
242300*-----------------------------------------------------------------24230004
242400*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                 24240004
242500*-----------------------------------------------------------------24250004
242600                                                                  24260004
242700 5205-WRITE-SEL-QUEUE.                                            24270004
242800                                                                  24280004
242900     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            24290004
243000                                   TO ET346-SELECTED-ITEMS.       24300004
243100                                                                  24310004
243200     EXEC CICS                                                    24320004
243300          WRITEQ TS                                               24330004
243400              QUEUE (ASC-OUTPUT-SEL-QUEUE-NAME)                   24340004
243500              FROM  (ET346-SELECTED-ITEMS-AREA)                   24350004
243600              ITEM  (PV-SEL-QUEUE-ITEM)                           24360004
243700              RESP  (PV-CICS-RESP)                                24370004
243800     END-EXEC.                                                    24380004
243900                                                                  24390004
244000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          24400004
244100         CONTINUE                                                 24410004
244200     ELSE                                                         24420004
244300         SET DP013-CICS-ABEND      TO TRUE                        24430004
244400         SET DP013-NO-ROLLBACK     TO TRUE                        24440004
244500         MOVE '5205-WRITE-SEL-QUEUE'                              24450004
244600                                   TO DP013-PARAGRAPH             24460004
244700         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          24470004
244800                                   TO DP013-MESSAGE-TEXT(1)       24480004
244900         PERFORM DP013-0000-PROCESS-ABEND                         24490004
245000     END-IF.                                                      24500004
245100                                                                  24510004
245200                                                                  24520004
245300*-----------------------------------------------------------------24530004
245400* WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,    24540004
245500* SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT    24550004
245600* THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO       24560004
245700* THE USER.                                                       24570004
245800*-----------------------------------------------------------------24580004
245900                                                                  24590004
246000 6000-REFRESH-PANEL-FROM-TEMP.                                    24600004
246100                                                                  24610004
246200     IF  ASC-UPDATE-TSQ                                           24620004
246300         SET ASC-NO-TSQ-UPDATE TO TRUE                            24630004
246400         MOVE ZERO                 TO PV-SAVE-ITEM                24640004
246500                                      PV-SEL-QUEUE-ITEM           24650004
246600         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        24660004
246700                                   TO PV-HOLD-SELECTED-ITEMS      24670004
246800         PERFORM 6100-UPDATE-TSQ                                  24680004
246900             UNTIL PV-ITEMS-PROCESSED >                           24690004
247000                                     ASC-NUMBER-OF-SELECTED-ITEMS 24700004
247100         PERFORM 6010-DELETE-SEL-QUEUE                            24710004
247200         INITIALIZE ASC-BLOCK-ENTRIES (1)                         24720004
247300                    ASC-BLOCK-ENTRIES (2)                         24730004
247400                                                                  24740004
247500         DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                 24750004
247600                GIVING PV-BLOCK-NUMBER                            24760004
247700                REMAINDER PV-REMAINDER                            24770004
247800         IF  PV-REMAINDER > ZERO                                  24780004
247900             ADD +1     TO PV-BLOCK-NUMBER                        24790004
248000         END-IF                                                   24800004
248100         MOVE +1        TO ASC-BLK-SUB                            24810004
248200         PERFORM 4410-READ-TEMP-STORAGE                           24820004
248300         ADD +1         TO ASC-BLK-SUB                            24830004
248400                           PV-BLOCK-NUMBER                        24840004
248500         PERFORM 4410-READ-TEMP-STORAGE                           24850004
248600                                                                  24860004
248700     END-IF.                                                      24870004
248800                                                                  24880004
248900                                                                  24890004
249000*-----------------------------------------------------------------24900004
249100*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.                24910004
249200*-----------------------------------------------------------------24920004
249300                                                                  24930004
249400 6010-DELETE-SEL-QUEUE.                                           24940004
249500                                                                  24950004
249600     EXEC CICS                                                    24960004
249700         DELETEQ TS                                               24970004
249800             QUEUE (ASC-OUTPUT-SEL-QUEUE-NAME)                    24980004
249900             RESP  (PV-CICS-RESP)                                 24990004
250000     END-EXEC.                                                    25000004
250100                                                                  25010004
250200     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      25020004
250300        (PV-CICS-RESP = DFHRESP(QIDERR)))                         25030004
250400         CONTINUE                                                 25040004
250500     ELSE                                                         25050004
250600         SET DP013-CICS-ABEND TO TRUE                             25060004
250700         SET DP013-NO-ROLLBACK TO TRUE                            25070004
250800         MOVE '6010-DELETE-SEL-QUEUE'                             25080004
250900                        TO DP013-PARAGRAPH                        25090004
251000         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         25100004
251100                        TO DP013-MESSAGE-TEXT (1)                 25110004
251200         PERFORM DP013-0000-PROCESS-ABEND                         25120004
251300     END-IF.                                                      25130004
251400                                                                  25140004
251500*-----------------------------------------------------------------25150004
251600* INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.          25160004
251700* LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER      25170004
251800* TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN        25180004
251900* THE TEMP QUEUE.                                                 25190004
252000*-----------------------------------------------------------------25200004
252100                                                                  25210004
252200 6100-UPDATE-TSQ.                                                 25220004
252300                                                                  25230004
252400     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             25240004
252500     PERFORM 6105-READ-SEL-QUEUE.                                 25250004
252600     PERFORM                                                      25260004
252700         VARYING ET346-IDX                                        25270004
252800         FROM 1 BY 1                                              25280004
252900         UNTIL ((PV-ITEMS-PROCESSED >                             25290004
253000                              PV-HOLD-SELECTED-ITEMS)             25300004
253100         OR (ET346-IDX GREATER THAN ET346-MAX-ITEMS))             25310004
253200         IF  ET346-ACTION-SW (ET346-IDX) > SPACE                  25320004
253300             PERFORM 6110-PROCESS-ITEMS                           25330004
253400         END-IF                                                   25340004
253500         ADD +1                TO PV-ITEMS-PROCESSED              25350004
253600     END-PERFORM.                                                 25360004
253700     PERFORM 6111-WRITE-LIST-QUEUE.                               25370004
253800                                                                  25380004
253900                                                                  25390004
254000*-----------------------------------------------------------------25400004
254100*    READ THE LIST QUEUE RECORD.                                  25410004
254200*-----------------------------------------------------------------25420004
254300                                                                  25430004
254400 6105-READ-SEL-QUEUE.                                             25440004
254500                                                                  25450004
254600     EXEC CICS                                                    25460004
254700          READQ TS                                                25470004
254800              QUEUE (ASC-OUTPUT-SEL-QUEUE-NAME)                   25480004
254900              INTO  (ET346-SELECTED-ITEMS-AREA)                   25490004
255000              ITEM  (PV-SEL-QUEUE-ITEM)                           25500004
255100              RESP  (PV-CICS-RESP)                                25510004
255200     END-EXEC.                                                    25520004
255300                                                                  25530004
255400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          25540004
255500         CONTINUE                                                 25550004
255600     ELSE                                                         25560004
255700         SET DP013-CICS-ABEND      TO  TRUE                       25570004
255800         SET DP013-NO-ROLLBACK     TO  TRUE                       25580004
255900         MOVE '6105-READ-SEL-QUEUE'                               25590004
256000                                   TO  DP013-PARAGRAPH            25600004
256100         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           25610004
256200                                   TO  DP013-MESSAGE-TEXT(1)      25620004
256300         PERFORM DP013-0000-PROCESS-ABEND                         25630004
256400     END-IF.                                                      25640004
256500                                                                  25650004
256600                                                                  25660004
256700*-----------------------------------------------------------------25670004
256800* CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.    25680004
256900* REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE    25690004
257000* THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.               25700004
257100*-----------------------------------------------------------------25710004
257200                                                                  25720004
257300 6110-PROCESS-ITEMS.                                              25730004
257400                                                                  25740004
257500     COMPUTE PV-ITEM = 1 + ((ET346-ITEM (ET346-IDX) - 1)          25750004
257600                     / PC-ITEMS-PER-PANEL).                       25760004
257700                                                                  25770004
257800     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           25780004
257900         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          25790004
258000             PERFORM 6111-WRITE-LIST-QUEUE                        25800004
258100         END-IF                                                   25810004
258200         MOVE PV-ITEM          TO PV-SAVE-ITEM                    25820004
258300                                                                  25830004
258400         PERFORM 6112-READ-LIST-QUEUE                             25840004
258500         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               25850004
258600             CONTINUE                                             25860004
258700         END-IF                                                   25870004
258800     END-IF.                                                      25880004
258900                                                                  25890004
259000     COMPUTE PV-SUB = (ET346-ITEM (ET346-IDX)                     25900004
259100                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              25910004
259200     SET LQW-DESELECT (PV-SUB) TO    TRUE                         25920004
259300     MOVE LQW-SELECTED-SW (PV-SUB)                                25930004
259400                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  25940004
259500     EVALUATE TRUE                                                25950004
259600         WHEN ET346-INQ (ET346-IDX)                               25960004
259700              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             25970004
259800     END-EVALUATE.                                                25980004
259900                                                                  25990004
260000     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                26000004
260100                                                                  26010004
260200                                                                  26020004
260300*-----------------------------------------------------------------26030004
260400* WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.                 26040004
260500*-----------------------------------------------------------------26050004
260600                                                                  26060004
260700 6111-WRITE-LIST-QUEUE.                                           26070004
260800                                                                  26080004
260900     EXEC CICS                                                    26090004
261000         WRITEQ TS                                                26100004
261100             QUEUE (ASC-LIST-QUEUE-NAME)                          26110004
261200             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     26120004
261300             ITEM  (PV-SAVE-ITEM)                                 26130004
261400             REWRITE                                              26140004
261500             RESP  (PV-CICS-RESP)                                 26150004
261600     END-EXEC.                                                    26160004
261700*                                                                 26170004
261800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          26180004
261900         CONTINUE                                                 26190004
262000     ELSE                                                         26200004
262100         SET DP013-CICS-ABEND  TO  TRUE                           26210004
262200         SET DP013-NO-ROLLBACK TO  TRUE                           26220004
262300         MOVE '6111-WRITE-LIST-QUEUE'                             26230004
262400                               TO  DP013-PARAGRAPH                26240004
262500         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  26250004
262600                               TO  DP013-MESSAGE-TEXT(1)          26260004
262700         PERFORM DP013-0000-PROCESS-ABEND                         26270004
262800     END-IF.                                                      26280004
262900                                                                  26290004
263000                                                                  26300004
263100*-----------------------------------------------------------------26310004
263200* READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.    26320004
263300*-----------------------------------------------------------------26330004
263400                                                                  26340004
263500 6112-READ-LIST-QUEUE.                                            26350004
263600                                                                  26360004
263700     EXEC CICS                                                    26370004
263800         READQ TS                                                 26380004
263900             QUEUE (ASC-LIST-QUEUE-NAME)                          26390004
264000             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     26400004
264100             ITEM  (PV-ITEM)                                      26410004
264200             RESP  (PV-CICS-RESP)                                 26420004
264300     END-EXEC.                                                    26430004
264400*                                                                 26440004
264500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          26450004
264600         CONTINUE                                                 26460004
264700     ELSE                                                         26470004
264800         SET DP013-CICS-ABEND        TO TRUE                      26480004
264900         SET DP013-NO-ROLLBACK       TO TRUE                      26490004
265000         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           26500004
265100         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    26510004
265200                                     TO DP013-MESSAGE-TEXT(1)     26520004
265300         PERFORM DP013-0000-PROCESS-ABEND                         26530004
265400     END-IF.                                                      26540004
265500                                                                  26550004
265600                                                                  26560004
265700*-----------------------------------------------------------------26570004
265800* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.        26580004
265900*-----------------------------------------------------------------26590004
266000                                                                  26600004
266100 9100-READ-SEL-QUEUE.                                             26610004
266200                                                                  26620004
266300     EXEC CICS                                                    26630004
266400         READQ TS                                                 26640004
266500             QUEUE (ASC-INPUT-SEL-QUEUE-NAME)                     26650004
266600             INTO  (ET346-SELECTED-ITEMS-AREA)                    26660004
266700             ITEM  (ASC-SEL-ITEM)                                 26670004
266800             RESP  (PV-CICS-RESP)                                 26680004
266900     END-EXEC.                                                    26690004
267000                                                                  26700004
267100     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       26710004
267200         CONTINUE                                                 26720004
267300     ELSE                                                         26730004
267400         SET DP013-LOGIC-ABEND                                    26740004
267500             DP013-NO-ROLLBACK     TO TRUE                        26750004
267600         MOVE '9100-READ-SEL-QUEUE'                               26760004
267700                                   TO DP013-PARAGRAPH             26770004
267800         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   26780004
267900                                   TO DP013-MESSAGE-TEXT (1)      26790004
268000         PERFORM DP013-0000-PROCESS-ABEND                         26800004
268100     END-IF.                                                      26810004
268200                                                                  26820004
268300                                                                  26830004
268400*-----------------------------------------------------------------26840004
268500* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.        26850004
268600*-----------------------------------------------------------------26860004
268700                                                                  26870004
268800 9200-REWRITE-SEL-QUEUE.                                          26880004
268900                                                                  26890004
269000     EXEC CICS                                                    26900004
269100          WRITEQ TS                                               26910004
269200              QUEUE  (ASC-INPUT-SEL-QUEUE-NAME)                   26920004
269300              FROM   (ET346-SELECTED-ITEMS-AREA)                  26930004
269400              ITEM   (ASC-SEL-ITEM)                               26940004
269500              RESP   (PV-CICS-RESP)                               26950004
269600              REWRITE                                             26960004
269700     END-EXEC.                                                    26970004
269800                                                                  26980004
269900     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   26990004
270000         SET DP013-CICS-ABEND                                     27000004
270100             DP013-NO-ROLLBACK     TO TRUE                        27010004
270200         MOVE '9200-REWRITE-SEL-QUEUE'                            27020004
270300                                   TO DP013-PARAGRAPH             27030004
270400         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   27040004
270500                                   TO DP013-MESSAGE-TEXT (1)      27050004
270600         PERFORM DP013-0000-PROCESS-ABEND                         27060004
270700     END-IF.                                                      27070004
270800                                                                  27080004
270900                                                                  27090004
271000 Z800-OPEN-CURSOR.                                                27100004
271100                                                                  27110004
271200     EXEC SQL                                                     27120004
271300          OPEN TFGTRDT-CSR                                        27130004
271400     END-EXEC.                                                    27140004
271500                                                                  27150004
271600     EVALUATE TRUE                                                27160004
271700         WHEN SQLCODE = ZERO                                      27170004
271800             CONTINUE                                             27180004
271900         WHEN SQLCODE = -904                                      27190004
272000         WHEN SQLCODE = -913                                      27200004
272100             SET PS-DATA-NOT-AVAILABLE TO TRUE                    27210004
272200         WHEN SQLWARN0 NOT = SPACES                               27220004
272300         WHEN SQLCODE  NOT = ZERO                                 27230004
272400             MOVE 'Z800-OPEN-CURSOR' TO DP013-PARAGRAPH           27240004
272500             MOVE SQLCA              TO DP013-SQLCA               27250004
272600             MOVE 'TFGTRDT'          TO DP013-DB2-TABLE-NAME (1)  27260004
272700             SET DP013-DB2-ABEND                                  27270004
272800                 DP013-XCTL-DISPLAY-RESTART TO TRUE               27280004
272900             PERFORM DP013-0000-PROCESS-ABEND                     27290004
273000     END-EVALUATE.                                                27300004
273100                                                                  27310004
273200                                                                  27320004
273300 Z810-FETCH-CURSOR.                                               27330004
273400                                                                  27340004
273500     EXEC SQL                                                     27350004
273600          FETCH  TFGTRDT-CSR                                      27360004
273700          INTO  :FGTRDT-TRN-SET-SEQ-NBR                           27370004
273800              , :FGTRDT-TRN-SET-DATA                              27380004
273900     END-EXEC.                                                    27390004
274000                                                                  27400004
274100     EVALUATE TRUE                                                27410004
274200         WHEN SQLCODE = ZERO                                      27420004
274300             CONTINUE                                             27430004
274400         WHEN SQLCODE = +100                                      27440004
274500             SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                  27450004
274600         WHEN SQLCODE = -904                                      27460004
274700         WHEN SQLCODE = -913                                      27470004
274800             SET PS-DATA-NOT-AVAILABLE TO TRUE                    27480004
274900         WHEN SQLWARN0 NOT = SPACE                                27490004
275000         WHEN SQLCODE  NOT = ZERO                                 27500004
275100             MOVE 'Z810-FETCH-CURSOR' TO DP013-PARAGRAPH          27510004
275200             MOVE 'FETCH CURSOR'      TO DP013-MESSAGE-TEXT (1)   27520004
275300             MOVE SQLCA               TO DP013-SQLCA              27530004
275400             MOVE 'TFGTRDT'           TO DP013-DB2-TABLE-NAME (1) 27540004
275500             SET DP013-DB2-ABEND                                  27550004
275600                 DP013-XCTL-DISPLAY-RESTART TO TRUE               27560004
275700             PERFORM DP013-0000-PROCESS-ABEND                     27570004
275800     END-EVALUATE.                                                27580004
275900                                                                  27590004
276000                                                                  27600004
276100 Z820-CLOSE-CURSOR.                                               27610004
276200                                                                  27620004
276300     EXEC SQL                                                     27630004
276400          CLOSE TFGTRDT-CSR                                       27640004
276500     END-EXEC.                                                    27650004
276600                                                                  27660004
276700     EVALUATE TRUE                                                27670004
276800         WHEN SQLCODE = ZERO                                      27680004
276900         WHEN SQLCODE = -904                                      27690004
277000         WHEN SQLCODE = -913                                      27700004
277100             CONTINUE                                             27710004
277200         WHEN SQLWARN0 NOT = SPACES                               27720004
277300         WHEN SQLCODE  NOT = ZERO                                 27730004
277400             MOVE 'Z820-CLOSE-CURSOR' TO DP013-PARAGRAPH          27740004
277500             MOVE 'CLOSE CURSOR'      TO DP013-MESSAGE-TEXT (1)   27750004
277600             MOVE SQLCA               TO DP013-SQLCA              27760004
277700             MOVE 'TFGTRDT'           TO DP013-DB2-TABLE-NAME (1) 27770004
277800             SET DP013-DB2-ABEND                                  27780004
277900                 DP013-XCTL-DISPLAY-RESTART TO TRUE               27790004
278000             PERFORM DP013-0000-PROCESS-ABEND                     27800004
278100     END-EVALUATE.                                                27810004
278200                                                                  27820004
278300                                                                  27830004
278400 Z830-GET-STATUS.                                                 27840004
278500                                                                  27850004
278600     EXEC SQL                                                     27860004
278700          SELECT  STATUS_DESC                                     27870004
278800          INTO   :STATCD-STATUS-DESC                              27880004
278900          FROM    TSTATCD                                         27890004
279000          WHERE   STATUS_CDE     = :AP050-PO-STATUS               27900004
279100            AND   STATUS_TYP_CDE = 'P'                            27910004
279200     END-EXEC.                                                    27920004
279300                                                                  27930004
279400     EVALUATE TRUE                                                27940004
279500         WHEN SQLCODE = ZERO                                      27950004
279600         WHEN SQLCODE = +100                                      27960004
279700             CONTINUE                                             27970004
279800         WHEN SQLCODE = -904                                      27980004
279900         WHEN SQLCODE = -913                                      27990004
280000             SET PS-DATA-NOT-AVAILABLE TO TRUE                    28000004
280100         WHEN SQLWARN0 NOT = SPACES                               28010004
280200         WHEN SQLCODE  NOT = ZERO                                 28020004
280300             MOVE 'Z830-GET-STATUS'  TO DP013-PARAGRAPH           28030004
280400             MOVE SQLCA              TO DP013-SQLCA               28040004
280500             MOVE 'TSTATCD'          TO DP013-DB2-TABLE-NAME (1)  28050004
280600             SET DP013-DB2-ABEND                                  28060004
280700                 DP013-XCTL-DISPLAY-RESTART TO TRUE               28070004
280800             PERFORM DP013-0000-PROCESS-ABEND                     28080004
280900     END-EVALUATE.                                                28090004
281000                                                                  28100004
281100                                                                  28110004
281200 Z840-GET-DEPARTMENT.                                             28120004
281300                                                                  28130004
281400     EXEC SQL                                                     28140004
281500          SELECT  DEPT                                            28150004
281600          INTO   :SKXREF-DEPT                                     28160004
281700          FROM    TSKXREF                                         28170004
281800          WHERE   SKU = :PV-SKXREF-SKU                            28180004
281900     END-EXEC.                                                    28190004
282000                                                                  28200004
282100     EVALUATE TRUE                                                28210004
282200         WHEN SQLCODE = ZERO                                      28220004
282300         WHEN SQLCODE = +100                                      28230004
282400             MOVE SKXREF-DEPT TO PV-SKXREF-DEPT                   28240004
282500         WHEN SQLCODE = -904                                      28250004
282600         WHEN SQLCODE = -913                                      28260004
282700             SET PS-DATA-NOT-AVAILABLE TO TRUE                    28270004
282800         WHEN SQLWARN0 NOT = SPACES                               28280004
282900         WHEN SQLCODE  NOT = ZERO                                 28290004
283000             MOVE 'Z840-GET-DEPARTMENT' TO DP013-PARAGRAPH        28300004
283100             MOVE SQLCA                 TO DP013-SQLCA            28310004
283200             MOVE 'TSKXREF'             TO DP013-DB2-TABLE-NAME(1)28320004
283300             SET DP013-DB2-ABEND                                  28330004
283400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               28340004
283500             PERFORM DP013-0000-PROCESS-ABEND                     28350004
283600     END-EVALUATE.                                                28360004
283700                                                                  28370004
283800                                                                  28380004
283900*-----------------------------------------------------------------28390004
284000*    ABEND PROCESSOR MODULE                                       28400004
284100*-----------------------------------------------------------------28410004
284200                                                                  28420004
284300     COPY DPPD013.                                                28430004
