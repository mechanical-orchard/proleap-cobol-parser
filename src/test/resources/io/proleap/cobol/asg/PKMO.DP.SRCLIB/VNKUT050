000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.     VNKUT050.                                        00020001
000300 AUTHOR.         MIKE BESKE.                                      00030000
000400 DATE-WRITTEN.   JUNE 2004.                                       00040001
000500*************************************************************     00050001
000600*    COBOL 2 WITH DB2 SQL                                   *     00060000
000700*                                                           *     00070000
000800*   VENDOR LEGACY PARENT FACTORY DATA EXTRACT               *     00080008
000900*                                                           *     00090000
001000*   PROGRAM OVERVIEW: THIS PROGRAM EXTRACTS VENDOR LEGACY   *     00100008
001100*   PARENT FACTORY DATA.  THIS DATA WILL BE USED FOR A TEXT *     00110008
001200*   FILE FOR EXCEL AND A REPORT.                            *     00120008
001300*                                                           *     00130008
001400*                                                           *     00140000
001500*   DB2 TABLES:                                             *     00150000
001600*  1. EXTERNAL ENTERPRISE TABLE                 (TEXTENT)   *     00160006
001700*  2. EXTERNAL ENTERPRISE NAME TABLE            (TENTNME)   *     00170006
001700*  3. VENDOR RELATIONSHIP TABLE         (VNT_VND_RLTNSHP)   *     00170134
001800*                                                           *     00180000
001900*   OUTPUT:                                                 *     00190000
002000*  1. PARENT-FACTORY-FILE                       (VNRD050)   *     00200017
002100*                                                           *     00210000
002200*************************************************************     00220000
002300*   CHANGES:                                                *     00230000
002400*                                                           *     00240000
002500* 00/00/0000  XXXXXXXXXXX                    WR# 00000      *     00250008
002600*             XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX      *     00260008
002700*             XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX      *     00270008
002800*                                                           *     00280000
002800* 03/02/2009  SUE BARTELT                    WR# 32219      *     00281034
                    CHANGES FOR MULTIPLE CARTON LABELER.          *     00282034
                    REMOVED REFERENCES TO GVRNG_ENT_ID AND        *     00283034
                    CART_LBL_IND.  ADDED S200-GET-RELATED-ENT-ID  *     00284034
                    PARAGRAPH TO GET RELATED ENT ID FROM          *     00285034
                    VNT_VND_RLTNSHP TABLE FOR FACTORIES, USING    *     00286034
                    IN PLACE OF GVRNG_ENT_ID.                     *     00287034
                    CHANGES MADE TO VNRD050 TO REFLECT REMOVAL    *     00288034
                    OF GVRNG_ENT_ID/CART_LBL_IND.                       00289034
002900*************************************************************     00290000
003000/                                                                 00300000
003100 ENVIRONMENT DIVISION.                                            00310000
003200 CONFIGURATION SECTION.                                           00320000
003300 INPUT-OUTPUT SECTION.                                            00330000
003400 FILE-CONTROL.                                                    00340000
003500                                                                  00350000
003600     SELECT PARENT-FACTORY-FILE    ASSIGN TO UT-S-OUT01.          00360001
003700                                                                  00370000
003800 DATA DIVISION.                                                   00380000
003900 FILE SECTION.                                                    00390000
004000 FD  PARENT-FACTORY-FILE                                          00400001
004100     RECORDING MODE IS F                                          00410000
004200     LABEL RECORDS ARE STANDARD                                   00420000
004300     BLOCK CONTAINS 0 RECORDS                                     00430000
004400     DATA RECORD IS PARENT-FACTORY-RECORD.                        00440001
004500 01  PARENT-FACTORY-RECORD       PIC X(150).                      00450011
004600                                                                  00460000
004700 WORKING-STORAGE SECTION.                                         00470000
004800                                                                  00480000
004900 01  PROGRAM-WORKAREA.                                            00490000
005000     05  FILLER                  PIC  X(30)           VALUE       00500000
005100         '** BEGINING OF VNKUT050 W/S **'.                        00510001
005200                                                                  00520000
005300     05  PV-CURRENT-PARAGRAPH    PIC  X(30)           VALUE SPACE.00530000
005400     05  PV-PROGRAM-NAME         PIC  X(08)           VALUE       00540000
005500         'VNKUT050'.                                              00550001
005600     05  PV-MAX-RETRIES          PIC S9(04)    COMP   VALUE +3.   00560000
005700     05  PV-RETRY-COUNTER        PIC S9(04)    COMP   VALUE +0.   00570000
005800     05  INPUT-COUNT             PIC 9(09)            VALUE  0.   00580000
005900     05  OUTPUT-COUNT            PIC 9(09)            VALUE  0.   00590000
006000                                                                  00600000
006100     05  PV-ENT-ID-UNPK          PIC S9(9)            VALUE ZEROS.00610001
006200     05  PV-ENT-ID-9X            PIC  X(9)            VALUE SPACE.00620001
           05  PV-RLTD-ENT-ID          PIC S9(9)      COMP  VALUE +0.   00621021
006300     05  PV-LAST-UPD-DATE        PIC  X(10)           VALUE SPACE.00630002
006400     05  PV-CRE-DATE             PIC  X(10)           VALUE SPACE.00640002
006500                                                                  00650000
006600     05  PV-CURRENT-TIME.                                         00660000
006700         10  PV-CURRENT-HOUR     PIC  9(02)           VALUE 0.    00670000
006800         10  PV-CURRENT-MINUTE   PIC  9(02)           VALUE 0.    00680000
006900         10  FILLER              PIC  9(02)           VALUE 0.    00690000
007000                                                                  00700000
007100 01  PROGRAM-SWITCHES-SUBS.                                       00710000
007200     05  PV-MORE-DATA-SW         PIC  X(01)           VALUE 'N'.  00720001
007300         88  NO-MORE-DATA        VALUE 'Y'.                       00730001
007400         88  MORE-DATA           VALUE 'N'.                       00740001
007500                                                                  00750000
007600*  OUTPUT RECORD AREA                                             00760000
007700                                                                  00770000
007800     COPY VNRD050.                                                00780001
007900                                                                  00790000
008000*----------------------------------------------------------------*00800000
008100*  EXTERNAL ENTERPRISE TABLE                                     *00810001
008200*----------------------------------------------------------------*00820000
008300     EXEC SQL                                                     00830000
008400          INCLUDE TEXTENT                                         00840001
008500     END-EXEC.                                                    00850000
008600                                                                  00860000
008700*----------------------------------------------------------------*00870000
008800*  EXTERNAL ENTERPRISE NAME TABLE                                *00880001
008900*----------------------------------------------------------------*00890000
009000     EXEC SQL                                                     00900000
009100          INCLUDE TENTNME                                         00910001
009200     END-EXEC.                                                    00920000
009300                                                                  00930000
017900*---------------------------------------------------------------  00939018
018000*     VENDOR RELATIONSHIP TABLE                                   00939118
018100*---------------------------------------------------------------  00939218
018200     EXEC SQL                                                     00939318
018210         INCLUDE VNT00000                                         00939418
018220     END-EXEC.                                                    00939518
018230     EJECT                                                        00939618
018231*---------------------------------------------------------------* 00939718
009400*----------------------------------------------------------------*00940001
009500*    SQL COMMUNICATIONS AREA DCLGEN                               00950000
009600*----------------------------------------------------------------*00960001
009700     EXEC SQL                                                     00970000
009800         INCLUDE SQLCA                                            00980000
009900     END-EXEC.                                                    00990000
010000                                                                  01000000
010100*----------------------------------------------------------------*01010000
010200* PARENT_FACTORY_CSR WILL FETCH ALL OF THE IMPORT PARENT COS AND *01020001
010300* FACTORIES ON THE VENDOR LEGACY DATABASE.                       *01030001
010400*----------------------------------------------------------------*01040000
010500     EXEC SQL                                                     01050001
010600       DECLARE PARENT_FACTORY_CSR CURSOR FOR                      01060003
010700         SELECT A.ENT_NAME_DESC                                   01070001
010800               ,A.ENT_ID                                          01080001
010900               ,B.PRTNR_TYP_CDE                                   01090001
011200               ,B.STATUS_CDE                                      01120001
011300               ,DATE(B.LAST_UPD_TMST)                             01130001
011400               ,DATE(B.CRE_TMST)                                  01140001
011700           FROM TENTNME A                                         01170001
011800              , TEXTENT B                                         01180001
011900          WHERE A.ENT_ID         = B.ENT_ID                       01190001
012000            AND A.TYPE_CDE       = '01'                           01200001
012100            AND B.PRTNR_TYP_CDE IN ('FA','S2')                    01210001
012200         ORDER BY B.PRTNR_TYP_CDE DESC                            01220001
012400                , A.ENT_NAME_DESC                                 01240001
012500     END-EXEC.                                                    01250001
012600                                                                  01260001
012700*----------------------------------------------------------------*01270001
012800*  ABEND DATA AREAS                                              *01280001
012900*----------------------------------------------------------------*01290001
013000 01  ABEND-CODE                  PIC S9(04)  VALUE ZEROS          01300001
013100                                             COMP SYNC.           01310001
013200     88  AC-BAD-DATA                         VALUE +4003.         01320001
013300     88  AC-DB2-ERROR                        VALUE +4013.         01330001
013400     88  AC-DATE-ERROR                       VALUE +4019.         01340001
013500                                                                  01350001
013600                                                                  01360001
013700 01  ABEND-AREAS.                                                 01370001
013800     05  AA-ABEND-LIT            PIC  X(40)  VALUE                01380001
013900             '*****       ABEND'.                                 01390001
014000     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                01400001
014100             '*****   PROGRAM: VNKUT050'.                         01410001
014200     05  AA-PARAGRAPH-LIT.                                        01420001
014300         10  FILLER              PIC  X(17)  VALUE                01430001
014400             '***** PARAGRAPH: '.                                 01440001
014500         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        01450001
014600     05  AA-MESSAGE-LINE.                                         01460001
014700         10  FILLER              PIC  X(06)  VALUE '*****'.       01470001
014800         10  AA-MESSAGE          PIC  X(127) VALUE SPACES.        01480001
014900     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                01490001
015000             '*****    DB2 ERROR'.                                01500001
015100     05  AA-DB2-OPERATION-LIT.                                    01510001
015200         10  FILLER              PIC  X(17)  VALUE                01520001
015300             '***** OPERATION: '.                                 01530001
015400         10  AA-DB2-OPERATION.                                    01540001
015500             15  AA-DB2-OP-1     PIC  X(50)  VALUE SPACES.        01550001
015600             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        01560001
015700     05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        01570001
015800     05  AA-DB2-TABLE-2          PIC  X(08)  VALUE SPACES.        01580001
015900     05  AA-DB2-TABLE-3          PIC  X(08)  VALUE SPACES.        01590001
016000                                                                  01600001
016100     COPY DPWS004.                                                01610001
016200                                                                  01620001
016300 01  FILLER                      PIC  X(25)  VALUE                01630001
016400     '** END OF VNKUT050 W/S **'.                                 01640001
016500                                                                  01650001
016600 PROCEDURE DIVISION.                                              01660001
016700                                                                  01670001
016800***************************************************************** 01680001
016900*  MAIN DRIVER PARAGRAPH                                          01690001
017000***************************************************************** 01700001
017100 A100-MAIN.                                                       01710001
017200                                                                  01720001
017300     MOVE 'A100-MAIN'            TO   PV-CURRENT-PARAGRAPH.       01730001
017400                                                                  01740001
017500     PERFORM B100-BEGIN-PROGRAM.                                  01750001
017600                                                                  01760001
017700     PERFORM B200-PROCESS-PARENT-FACTORY UNTIL NO-MORE-DATA.      01770001
017800                                                                  01780001
017900     PERFORM B300-END-PROGRAM.                                    01790001
018000                                                                  01800001
018100     GOBACK.                                                      01810001
018200                                                                  01820001
018300***************************************************************** 01830001
018400*  PROGRAM INITIALIZATION                                         01840001
018500***************************************************************** 01850001
018600 B100-BEGIN-PROGRAM.                                              01860001
018700                                                                  01870001
018800     MOVE 'B100-BEGIN-PROGRAM'   TO   PV-CURRENT-PARAGRAPH.       01880001
018900                                                                  01890001
019000     DISPLAY '**********************************************'.    01900001
019100     DISPLAY '**        VNKUT050 STARTING NOW!!!!         **'.    01910001
019200     DISPLAY '**********************************************'.    01920001
019300                                                                  01930001
019400     OPEN OUTPUT PARENT-FACTORY-FILE.                             01940001
019500                                                                  01950001
019600     INITIALIZE DCLTEXTENT                                        01960001
019700                DCLTENTNME                                        01970001
019800                VN050-PARENT-FACTORY-REC.                         01980001
019900                                                                  01990001
020000     PERFORM Y100-OPEN-PARENT-FACTORY-CSR.                        02000001
020100     PERFORM R100-FETCH-PARENT-FACTORY.                           02010001
020200                                                                  02020001
020300***************************************************************** 02030001
020400*  PROCESS ALL OF THE RETURNED ROWS UNTIL THERE IS NO MORE DATA   02040001
020500***************************************************************** 02050001
020600 B200-PROCESS-PARENT-FACTORY.                                     02060001
020700                                                                  02070001
020800     MOVE 'B200-PROCESS-PARENT-FACTORY' TO   PV-CURRENT-PARAGRAPH.02080001
020900                                                                  02090001
021000     PERFORM M100-MOVE-PARENT-FACTORY-DATA.                       02100001
021100     PERFORM R100-FETCH-PARENT-FACTORY.                           02110004
021200                                                                  02120001
021300***************************************************************** 02130001
021400*  END OF PROCESSING.  CLOSE FILE.  DISPLAY COUNTS.               02140001
021500***************************************************************** 02150001
021600 B300-END-PROGRAM.                                                02160001
021700                                                                  02170001
021800     MOVE 'B300-END-PROGRAM'     TO   PV-CURRENT-PARAGRAPH.       02180001
021900                                                                  02190001
022000     PERFORM Y200-CLOSE-PARENT-FACTORY-CSR.                       02200001
022100     CLOSE  PARENT-FACTORY-FILE.                                  02210001
022200                                                                  02220001
022300     DISPLAY '***** VNKUT050 COUNTS *****'.                       02230001
022400     DISPLAY 'RECORDS FETCHED = ' INPUT-COUNT.                    02240001
022500     DISPLAY 'RECORDS WRITTEN = ' OUTPUT-COUNT.                   02250001
022600     DISPLAY '***************************'.                       02260001
022700                                                                  02270001
022800***************************************************************** 02280001
022900*  MOVE THE PARENT FACTORY DATA TO THE OUTPUT RECORD.  WRITE OUT  02290001
023000*  THE OUTPUT RECORD.                                             02300001
023100***************************************************************** 02310001
023200 M100-MOVE-PARENT-FACTORY-DATA.                                   02320001
023300                                                                  02330001
023400     MOVE 'M100-MOVE-PARENT-FACTORY-DATA' TO PV-CURRENT-PARAGRAPH.02340001
023500                                                                  02350001
023600     MOVE ENTNME-ENT-NAME-DESC TO VN050-ENT-NAME-DESC.            02360001
023700     MOVE ENTNME-ENT-ID        TO VN050-ENT-ID.                   02370001
023800     MOVE EXTENT-PRTNR-TYP-CDE TO VN050-PRTNR-TYP-CDE.            02380001
024100     MOVE EXTENT-STATUS-CDE    TO VN050-STATUS-CDE.               02410001
024500     IF PV-LAST-UPD-DATE = '0001-01-01'                           02450010
024600        MOVE '9999-09-09'      TO VN050-LAST-UPD-DATE             02460010
024700     ELSE                                                         02470010
024800        MOVE PV-LAST-UPD-DATE  TO VN050-LAST-UPD-DATE             02480010
024900     END-IF.                                                      02490010
025000     MOVE PV-CRE-DATE          TO VN050-CRE-DATE.                 02500001
025100     IF VN050-PRTNR-TYP-CDE = 'S2'                                02510001
025200*       IF VN050-GVRNG-ENT-ID = ZERO                              02520018
025300            MOVE VN050-ENT-ID         TO VN050-SORT-ENT-ID        02530011
025400            MOVE ENTNME-ENT-NAME-DESC TO VN050-SORT-ENT-NAME-DESC 02540011
025500*       ELSE                                                      02550018
025600*           MOVE VN050-GVRNG-ENT-ID   TO VN050-SORT-ENT-ID        02560018
025700*           PERFORM S100-SELECT-SORT-NAME                         02570018
025800*       END-IF                                                    02580022
025900     END-IF.                                                      02590001
026000     IF VN050-PRTNR-TYP-CDE = 'FA'                                02600001
              PERFORM S200-SELECT-RELATED-ENT-ID                        02601018
026100        IF PV-RLTD-ENT-ID = ZERO                                  02601128
026200            MOVE 999999999          TO VN050-SORT-ENT-ID          02601219
026300            MOVE '999999999999999999999999999999'                 02601319
026400                                    TO VN050-SORT-ENT-NAME-DESC   02601419
026500        ELSE                                                      02601519
                  MOVE PV-RLTD-ENT-ID TO VN050-SORT-ENT-ID              02601627
026700            PERFORM S100-SELECT-SORT-NAME                         02601819
026800        END-IF                                                    02601919
026900     END-IF.                                                      02690011
027000                                                                  02700011
027100     WRITE PARENT-FACTORY-RECORD FROM VN050-PARENT-FACTORY-REC.   02710011
027200     ADD 1 TO OUTPUT-COUNT.                                       02720011
027300     INITIALIZE VN050-PARENT-FACTORY-REC.                         02730011
027400                                                                  02740011
027500******************************************************************02750011
027600*  RETRIEVES THE PARENT FACTORY DATA FROM VENDOR LEGACY SYSTEM.   02760011
027700******************************************************************02770011
027800 R100-FETCH-PARENT-FACTORY.                                       02780011
027900                                                                  02790011
028000     MOVE 'R100-FETCH-PARENT-FACTORY' TO PV-CURRENT-PARAGRAPH.    02800011
028100                                                                  02810011
028200     EXEC SQL                                                     02820011
028300         FETCH PARENT_FACTORY_CSR                                 02830011
028400         INTO :ENTNME-ENT-NAME-DESC                               02840011
028500             ,:ENTNME-ENT-ID                                      02850011
028600             ,:EXTENT-PRTNR-TYP-CDE                               02860011
028900             ,:EXTENT-STATUS-CDE                                  02890011
029000             ,:PV-LAST-UPD-DATE                                   02900011
029100             ,:PV-CRE-DATE                                        02910011
029400     END-EXEC.                                                    02940011
029500                                                                  02950011
029600     EVALUATE TRUE                                                02960011
029700         WHEN SQLCODE = ZERO                                      02970011
029800              ADD 1 TO INPUT-COUNT                                02980011
029900                                                                  02990011
030000         WHEN SQLCODE = +100                                      03000011
030100              SET NO-MORE-DATA TO TRUE                            03010011
030200                                                                  03020011
030300         WHEN SQLWARN0 NOT = SPACES                               03030011
030400         WHEN SQLCODE  NOT = ZERO                                 03040011
030500             MOVE 'R100-FETCH-PARENT-FACTORY'                     03050011
030600                                           TO AA-PARAGRAPH-NAME   03060011
030700             MOVE 'UNSUCCESSFUL FETCH WITH PARENT_FACTORY_CSR'    03070011
030800                                           TO AA-DB2-OPERATION    03080011
030900             MOVE 'TEXTENT'                TO AA-DB2-TABLE-1      03090011
031000             MOVE 'TENTNME'                TO AA-DB2-TABLE-2      03100011
031100             MOVE '       '                TO AA-DB2-TABLE-3      03110011
031200             PERFORM Z998-DB2-ABEND                               03120011
031300     END-EVALUATE.                                                03130011
031400                                                                  03140011
031500******************************************************************03150011
031600*  SELECTS THE VENDOR NAME OF THE PARENT FOR THE FACTORY BEING    03160011
031700*  PROCESSED.                                                     03170011
031800******************************************************************03180011
031900 S100-SELECT-SORT-NAME.                                           03190011
032000                                                                  03200011
032100     MOVE 'S100-SELECT-SORT-NAME    ' TO PV-CURRENT-PARAGRAPH.    03210011
032200                                                                  03220011
032300     EXEC SQL                                                     03230011
032400         SELECT A.ENT_NAME_DESC                                   03240011
032500           INTO :VN050-SORT-ENT-NAME-DESC                         03250011
032600           FROM TENTNME A                                         03260011
032700              , TEXTENT B                                         03270011
032800          WHERE A.ENT_ID         = B.ENT_ID                       03280011
032900            AND A.ENT_ID         = :VN050-SORT-ENT-ID             03290011
033000            AND A.TYPE_CDE       = '01'                           03300011
033100*           AND B.PRTNR_TYP_CDE IN ('S2')                         03310012
033200     END-EXEC.                                                    03320011
033300                                                                  03330011
033400     EVALUATE TRUE                                                03340011
033500         WHEN SQLCODE = ZERO                                      03350011
033600              CONTINUE                                            03360011
033700                                                                  03370011
033800         WHEN SQLCODE = +100                                      03380011
033900         WHEN SQLWARN0 NOT = SPACES                               03390011
034000         WHEN SQLCODE  NOT = ZERO                                 03400011
034100             MOVE VN050-SORT-ENT-ID TO PV-ENT-ID-UNPK             03410011
034200             MOVE PV-ENT-ID-UNPK    TO PV-ENT-ID-9X               03420011
034300             DISPLAY 'VN050-SORT-ENT-ID = ' PV-ENT-ID-9X          03430011
034400             MOVE 'S100-SELECT-SORT-NAME    '                     03440011
034500                                           TO AA-PARAGRAPH-NAME   03450011
034600             MOVE 'UNSUCCESSFUL SELECT OF THE VENDOR NAME    '    03460011
034700                                           TO AA-DB2-OPERATION    03470011
034800             MOVE 'TEXTENT'                TO AA-DB2-TABLE-1      03480011
034900             MOVE 'TENTNME'                TO AA-DB2-TABLE-2      03490011
035000             MOVE '       '                TO AA-DB2-TABLE-3      03500011
035100             PERFORM Z998-DB2-ABEND                               03510011
035200     END-EVALUATE.                                                03520011
035300                                                                  03530011
031500******************************************************************03531018
031600*  SELECTS THE RELATED ENT ID FOR THE FACTORY BEING               03532018
031700*  PROCESSED.                                                     03533018
031800******************************************************************03534018
031900 S200-SELECT-RELATED-ENT-ID.                                      03535018
032000                                                                  03536018
032100     MOVE 'S200-SELECT-RELATED-ENT-ID  ' TO PV-CURRENT-PARAGRAPH. 03537033
032200                                                                  03538018
032300     EXEC SQL                                                     03539018
032400         SELECT A.RLTD_ENT_ID                                     03539118
032500           INTO :PV-RLTD-ENT-ID                                   03539220
032600           FROM VNT_VND_RLTNSHP A                                 03539318
032800          WHERE A.ENT_ID         = :VN050-ENT-ID                  03539518
032900            AND A.VND_RLTNSHP_CDE = 'FA'                          03539618
                  AND A.EFF_END_DTE >= CURRENT DATE                     03539735
                  ORDER BY A.EFF_BEG_DTE ASC,                           03539838
                           A.RLTD_ENT_ID ASC                            03539938
033200     END-EXEC.                                                    03540018
033300                                                                  03540118
033400     EVALUATE TRUE                                                03540218
033500         WHEN SQLCODE = ZERO                                      03540318
033600              CONTINUE                                            03540418
033700                                                                  03540518
033500         WHEN SQLCODE = -811                                      03540631
                    CONTINUE                                            03540731
033700                                                                  03540831
033800         WHEN SQLCODE = +100                                      03540918
                    MOVE 0 TO PV-RLTD-ENT-ID                            03541028
033900         WHEN SQLWARN0 NOT = SPACES                               03541118
034000         WHEN SQLCODE  NOT = ZERO                                 03541218
034100             MOVE VN050-ENT-ID TO PV-ENT-ID-UNPK                  03541318
034200             MOVE PV-ENT-ID-UNPK    TO PV-ENT-ID-9X               03541418
034300             DISPLAY 'VN050-ENT-ID = ' PV-ENT-ID-9X               03541518
034400             MOVE 'S200-SELECT-RELATED-ENT-ID '                   03541618
034500                                           TO AA-PARAGRAPH-NAME   03541718
034600             MOVE 'UNSUCCESSFUL SELECT OF THE RLTD ENT ID    '    03541818
034700                                           TO AA-DB2-OPERATION    03541918
034800             MOVE 'VNT_VND_RLTNSHP'        TO AA-DB2-TABLE-1      03542018
035000             MOVE '       '                TO AA-DB2-TABLE-2      03542118
035000             MOVE '       '                TO AA-DB2-TABLE-3      03542218
035100             PERFORM Z998-DB2-ABEND                               03542318
035200     END-EVALUATE.                                                03542418
035400***************************************************************** 03543011
035500*  OPENS THE PARENT FACTORY CURSOR.                               03550011
035600***************************************************************** 03560011
035700 Y100-OPEN-PARENT-FACTORY-CSR.                                    03570011
035800                                                                  03580011
035900     MOVE 'Y100-OPEN-PARENT-FACTORY-CSR' TO PV-CURRENT-PARAGRAPH. 03590011
036000                                                                  03600011
036100     EXEC SQL                                                     03610011
036200         OPEN PARENT_FACTORY_CSR                                  03620011
036300     END-EXEC.                                                    03630011
036400                                                                  03640011
036500     EVALUATE TRUE                                                03650011
036600         WHEN SQLCODE = ZERO                                      03660011
036700              CONTINUE                                            03670011
036800                                                                  03680011
036900         WHEN SQLWARN0 NOT = SPACES                               03690011
037000         WHEN SQLCODE  NOT = ZERO                                 03700011
037100             MOVE 'Y100-OPEN-PARENT-FACTORY-CSR'                  03710011
037200                                           TO AA-PARAGRAPH-NAME   03720011
037300             MOVE 'UNSUCCESSFUL OPEN ON PARENT_FACTORY_CSR'       03730011
037400                                           TO AA-DB2-OPERATION    03740011
037500             MOVE 'TEXTENT'                TO AA-DB2-TABLE-1      03750011
037600             MOVE 'TENTNME'                TO AA-DB2-TABLE-2      03760011
037700             MOVE '       '                TO AA-DB2-TABLE-3      03770011
037800             PERFORM Z998-DB2-ABEND                               03780011
037900     END-EVALUATE.                                                03790011
038000                                                                  03800011
038100******************************************************************03810011
038200*  CLOSES THE PARENT FACTORY CURSOR.                              03820011
038300******************************************************************03830011
038400 Y200-CLOSE-PARENT-FACTORY-CSR.                                   03840011
038500                                                                  03850011
038600     MOVE 'Y200-CLOSE-PARENT-FACTORY-CSR' TO PV-CURRENT-PARAGRAPH.03860011
038700                                                                  03870011
038800       EXEC SQL                                                   03880011
038900           CLOSE PARENT_FACTORY_CSR                               03890011
039000       END-EXEC.                                                  03900011
039100                                                                  03910011
039200       EVALUATE TRUE                                              03920011
039300           WHEN SQLCODE = ZERO                                    03930011
039400                CONTINUE                                          03940011
039500                                                                  03950011
039600           WHEN SQLWARN0 NOT = SPACES                             03960011
039700           WHEN SQLCODE  NOT = ZERO                               03970011
039800               MOVE 'Y200-CLOSE-PARENT-FACTORY-CSR'               03980011
039900                                         TO AA-PARAGRAPH-NAME     03990011
040000               MOVE 'UNSUCCESSFUL CLOSE ON PARENT_FACTORY_CSR'    04000011
040100                                         TO AA-DB2-OPERATION      04010011
040200               MOVE 'TEXTENT'            TO AA-DB2-TABLE-1        04020011
040300               MOVE 'TENTNME'            TO AA-DB2-TABLE-2        04030011
040400               MOVE '       '            TO AA-DB2-TABLE-3        04040011
040500               PERFORM Z998-DB2-ABEND                             04050011
040600       END-EVALUATE.                                              04060011
040700                                                                  04070011
040800***************************************************************** 04080011
040900*  ABEND ROUTINE FOR DB2 ERRORS                                   04090011
041000***************************************************************** 04100011
041100 Z998-DB2-ABEND.                                                  04110011
041200                                                                  04120011
041300     CLOSE  PARENT-FACTORY-FILE.                                  04130011
041400                                                                  04140011
041500     DISPLAY AA-ABEND-LIT.                                        04150011
041600     DISPLAY AA-DB2-ERROR-LIT.                                    04160011
041700     DISPLAY AA-PROGRAM-LIT.                                      04170011
041800     DISPLAY AA-PARAGRAPH-LIT.                                    04180011
041900     DISPLAY AA-DB2-OPERATION-LIT.                                04190011
042000     DISPLAY AA-DB2-TABLE-1.                                      04200011
042100     DISPLAY AA-DB2-TABLE-2.                                      04210011
042200     DISPLAY AA-DB2-TABLE-3.                                      04220011
042300     SET AC-DB2-ERROR TO TRUE.                                    04230011
042400                                                                  04240011
042500     COPY DPPD004.                                                04250011
042600                                                                  04260011
042700     CALL 'ILBOABN0' USING ABEND-CODE.                            04270011
