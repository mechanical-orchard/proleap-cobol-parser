000100*----------------------------------------------------------       00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*----------------------------------------------------------       00030000
000400 PROGRAM-ID.    EPKUT160.                                         00040000
000500 AUTHOR.        SANDY POTTER.                                     00050000
000600 DATE-WRITTEN.  AUGUST 22, 2005.                                  00060000
000700                                                                  00070000
000800*----------------------------------------------------------       00080000
000900*       PLU STORE PRICE CHANGE EXTRACT TIMESTAMP RANGE POPULATOR  00090001
001000*----------------------------------------------------------       00100000
001100* THIS PROGRAM UPDATES CONTROL CARDS EPCC176 - 179.               00110002
001101* FIRST, IT GETS THE PLU EXTRACT TIMESTAMPS FROM A CONTROL CARD.  00110101
001102* NEXT, IT GETS THE TIMESTAMP WHEN THE MOST RECENT PRICE CHANGE   00110301
001103* DATA STARTED TO BE SENT TO THE XS DOMAIN VIA MESSAGES (TIMESTAMP00110401
001130* IS APPROXIMATE AND DOES NOT INCLUDE MICRO-SECONDS).             00110502
001130* USING THESE VALUES, IT DETERMINES 4 TIMESTAMP RANGES AND WRITES 00110601
001130* THEM TO THE 4 CONTROL CARDS, EPCC176 THROUGH EPCC179.  THESE    00110701
001130* WILL BE USED BY LATER PROCESSES TO DRIVE THE EXTRACTION OF STORE00110801
001130* SPECIFIC PRICE CHANGE UPDATES.                                  00110901
001130*                                                                 00111001
001110*----------------------------------------------------------       00111101
001120* HISTORY LOG:                                                    00111201
001130*                                                                 00111301
001131*----------------------------------------------------------       00111401
001132* DATE:                                                           00111501
001133* WR/IR#:                                                         00111601
001134* PROGRAMMER:                                                     00111701
001135* DESCRIPTION:                                                    00112000
001136*                                                                 00113000
001137*----------------------------------------------------------       00113100
001138 ENVIRONMENT DIVISION.                                            00113200
001139*----------------------------------------------------------       00113300
001140 CONFIGURATION SECTION.                                           00113400
001150 SOURCE-COMPUTER. IBM-3090.                                       00113500
001160 OBJECT-COMPUTER. IBM-3090.                                       00113600
001170                                                                  00113700
001180 INPUT-OUTPUT SECTION.                                            00113800
001190                                                                  00113900
001200 FILE-CONTROL.                                                    00114000
001300                                                                  00115000
001340     SELECT CC-PLU-TMST-FILE                                      00116001
001350       ASSIGN TO INP01.                                           00117001
001360                                                                  00118000
001340     SELECT CC-UPDATE-START-FILE                                  00118101
001350       ASSIGN TO INP02.                                           00118201
001360                                                                  00118301
001340     SELECT CC-TMST-RANGE1-FILE                                   00118401
001350       ASSIGN TO OUT01.                                           00118501
001360                                                                  00118601
001340     SELECT CC-TMST-RANGE2-FILE                                   00118701
001350       ASSIGN TO OUT02.                                           00118801
001360                                                                  00118901
001340     SELECT CC-TMST-RANGE3-FILE                                   00119001
001350       ASSIGN TO OUT03.                                           00119101
001360                                                                  00119201
001340     SELECT CC-TMST-RANGE4-FILE                                   00119301
001350       ASSIGN TO OUT04.                                           00119401
001360                                                                  00119501
001370*----------------------------------------------------------       00119601
001380 DATA DIVISION.                                                   00120000
001390*----------------------------------------------------------       00130000
001400 FILE SECTION.                                                    00140000
001500                                                                  00150000
001510 FD  CC-PLU-TMST-FILE                                             00151001
001520     RECORDING MODE IS F                                          00152000
001530     LABEL RECORDS ARE STANDARD                                   00153000
001540     RECORD CONTAINS 80 CHARACTERS                                00154000
001550     DATA RECORD IS CC-PLU-TMST-RECORD.                           00155001
001560                                                                  00156000
001570 01  CC-PLU-TMST-RECORD           PIC X(80).                      00157001
001500                                                                  00157101
001510 FD  CC-UPDATE-START-FILE                                         00157201
001520     RECORDING MODE IS F                                          00157301
001530     LABEL RECORDS ARE STANDARD                                   00157401
001540     RECORD CONTAINS 80 CHARACTERS                                00157501
001550     DATA RECORD IS CC-UPDATE-START-RECORD.                       00157601
001560                                                                  00157701
001570 01  CC-UPDATE-START-RECORD       PIC X(80).                      00157801
001500                                                                  00157901
001510 FD  CC-TMST-RANGE1-FILE                                          00158001
001520     RECORDING MODE IS F                                          00158101
001530     LABEL RECORDS ARE STANDARD                                   00158201
001540     RECORD CONTAINS 80 CHARACTERS                                00158301
001550     DATA RECORD IS CC-TMST-RANGE1-RECORD.                        00158401
001560                                                                  00158501
001570 01  CC-TMST-RANGE1-RECORD        PIC X(80).                      00158601
001500                                                                  00158701
001510 FD  CC-TMST-RANGE2-FILE                                          00158801
001520     RECORDING MODE IS F                                          00158901
001530     LABEL RECORDS ARE STANDARD                                   00159001
001540     RECORD CONTAINS 80 CHARACTERS                                00159101
001550     DATA RECORD IS CC-TMST-RANGE2-RECORD.                        00159201
001560                                                                  00159301
001570 01  CC-TMST-RANGE2-RECORD        PIC X(80).                      00159401
001500                                                                  00159501
001510 FD  CC-TMST-RANGE3-FILE                                          00159601
001520     RECORDING MODE IS F                                          00159701
001530     LABEL RECORDS ARE STANDARD                                   00159801
001540     RECORD CONTAINS 80 CHARACTERS                                00159901
001550     DATA RECORD IS CC-TMST-RANGE3-RECORD.                        00160001
001560                                                                  00160101
001570 01  CC-TMST-RANGE3-RECORD        PIC X(80).                      00160201
001500                                                                  00160301
001510 FD  CC-TMST-RANGE4-FILE                                          00160401
001520     RECORDING MODE IS F                                          00160501
001530     LABEL RECORDS ARE STANDARD                                   00160601
001540     RECORD CONTAINS 80 CHARACTERS                                00160701
001550     DATA RECORD IS CC-TMST-RANGE4-RECORD.                        00160801
001560                                                                  00160901
001570 01  CC-TMST-RANGE4-RECORD        PIC X(80).                      00161001
001580                                                                  00161101
001590*---------------------------------------------------------        00161201
001600                                                                  00162001
001700 WORKING-STORAGE SECTION.                                         00170000
001800                                                                  00180000
001900 01  AC-ABEND-CODE                     PIC S9(04) VALUE ZERO      00190000
001910                                                  COMP SYNC.      00191000
001920     88  AC-CONTROL-CARD-ERROR                    VALUE +4003.    00192000
001930     88  AC-DB2-ERROR                             VALUE +4013.    00193000
001940     88  AC-CALENDAR-ROUTINE-ERROR                VALUE +4019.    00194000
016700     88  AC-FORCED-ABEND                          VALUE +4444.    00194605
001950                                                                  00195000
001960*---------------------------------------------------------        00196000
001970* PC- PROGRAM CONSTANTS                                           00197000
001980*----------------------------------------------------------       00198000
001990 01  PC-PROGRAM-CONSTANTS.                                        00199000
002000     05  PC-PROGRAM-NAME              PIC X(08)  VALUE 'EPKUT160'.00200005
003903     05  PC-TMST-REST                 PIC X(07)  VALUE '.000000'. 00211005
002100     05  PC-CNVRT-MM-TO-SS            PIC S9(02) VALUE +60.       00212022
002100     05  PC-CNVRT-HH-TO-SS            PIC S9(04) VALUE +3600.     00213022
002100     05  PC-CNVRT-DD-TO-SS            PIC S9(05) VALUE +86400.    00214022
002400                                                                  00220000
002500*----------------------------------------------------------       00230000
002600* PS- PROGRAM SWITCHES                                            00240000
002700*----------------------------------------------------------       00250000
002800 01  PS-PROGRAM-SWITCHES.                                         00260000
002900     05  PS-END-OF-FILE-SW            PIC X(01)  VALUE 'N'.       00270000
003000         88  PS-END-OF-FILE                      VALUE 'Y'.       00280000
003100         88  PS-MORE-RECORDS                     VALUE 'N'.       00290001
003200                                                                  00300000
003300*----------------------------------------------------------       00310000
003400* PV- PROGRAM VARIABLES                                           00320000
003500*----------------------------------------------------------       00330000
003600 01 PV-PROGRAM-VARIABLES.                                         00340000
003700    05  PV-PARAGRAPH-NAME             PIC X(30) VALUE SPACES.     00350000
003800    05  PV-OPERATION-MSG-1            PIC X(40) VALUE SPACES.     00360000
003900    05  PV-OPERATION-MSG-2            PIC X(40) VALUE SPACES.     00370000
003901    05  PV-DB2-OPERATION              PIC X(30) VALUE SPACE.      00380000
003902    05  PV-SQL-SUB                    PIC S9(4) VALUE +0 COMP.    00390000
003902    05  PV-OVERALL-RANGE              PIC S9(14)V9(6) COMP-3.     00390121
003902    05  PV-OVERALL-RANGE-NUM          PIC S9(14)V9(6).            00390221
003902    05  PV-OVERALL-RANGE-STRUC REDEFINES PV-OVERALL-RANGE-NUM.    00390321
003903        10  PV-OVERALL-RANGE-CCYY     PIC 9(04).                  00390428
003903        10  PV-OVERALL-RANGE-MO       PIC 9(02).                  00390528
003903        10  PV-OVERALL-RANGE-DD       PIC 9(02).                  00390628
003903        10  PV-OVERALL-RANGE-HH       PIC 9(02).                  00390728
003903        10  PV-OVERALL-RANGE-MM       PIC 9(02).                  00390828
003903        10  PV-OVERALL-RANGE-SS       PIC 9(02).                  00390928
003903        10  PV-OVERALL-RANGE-REST     PIC 9(06).                  00391028
003903    05  PV-RANGE-START-TMST           PIC X(26) VALUE SPACES.     00391226
003903    05  PV-RANGE-END-TMST             PIC X(26) VALUE SPACES.     00391326
003903    05  PV-RANGE-TOTAL-SS             PIC 9(09) VALUE ZEROS.      00391426
003903    05  PV-RANGE-EACH-SS              PIC S9(09) COMP VALUE ZEROS.00391526
003903    05  PV-PRICE-TMST                 PIC X(26) VALUE SPACES.     00391621
003903    05  PV-PRICE-TMST-STRUC   REDEFINES PV-PRICE-TMST.            00391721
003903        10  PV-PRICE-TMST-TRUNC       PIC X(19).                  00391821
003903        10  PV-PRICE-TMST-REST        PIC X(07).                  00391921
003905                                                                  00392021
003906*----------------------------------------------------------       00392121
003907* CONTROL CARD EPCC105 LAYOUT                                     00392221
003908*----------------------------------------------------------       00392321
003909     COPY EPWS105.                                                00392421
003905                                                                  00392521
003906*----------------------------------------------------------       00392621
003907* CONTROL CARD EPCC187 LAYOUT                                     00392721
003908*----------------------------------------------------------       00392821
003909     COPY EPWS187.                                                00392921
003905                                                                  00393021
003906*----------------------------------------------------------       00393121
003907* CONTROL CARD EPCC176 - EPCC179 LAYOUT                           00393221
003908*----------------------------------------------------------       00393321
003909     COPY EPWS160.                                                00393421
013200                                                                  00393521
013300*--------------------------------------------------------------*  00393621
013400* DATE ROUTINE COPY MEMBERS                                       00393721
013500*--------------------------------------------------------------*  00393821
013600     COPY DPWS500.                                                00393921
003910                                                                  00394021
003920*-----------------------------------------------------------      00394121
003930* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         00394221
003940*-----------------------------------------------------------      00394321
003950     COPY DPWS004.                                                00394421
003960                                                                  00394521
003970*-----------------------------------------------------------      00395000
003980* DB2 ABEND COPYBOOK                                              00396000
003990*-----------------------------------------------------------      00397000
004000     COPY DPWS900.                                                00398000
004100                                                                  00399000
004200*-----------------------------------------------------------      00400000
004300* DB2 MESSAGE AREA                                                00410000
004400*-----------------------------------------------------------      00420000
004500     COPY SQLCA2.                                                 00430000
004600                                                                  00440000
004700*-----------------------------------------------------------      00450000
004800* DB2 COMMUNICATIONS AREA                                         00460000
004900*-----------------------------------------------------------      00470000
005000     EXEC SQL                                                     00480000
005100          INCLUDE SQLCA                                           00490000
005200     END-EXEC.                                                    00500000
005300                                                                  00510000
005400*----------------------------------------------------------       00520000
005500 PROCEDURE DIVISION.                                              00530000
005600*----------------------------------------------------------       00540000
005700 0000-MAINLINE.                                                   00550000
005800                                                                  00560000
005900     PERFORM 1000-INITIALIZATION.                                 00570000
006000                                                                  00580000
006100     PERFORM 2000-PROCESS-CNTL-CARDS.                             00590000
006200                                                                  00600000
006300     PERFORM 9999-WRAPUP.                                         00610000
006400                                                                  00620000
006500     GOBACK.                                                      00630000
006600                                                                  00640000
006700*0000-EXIT.                                                       00650000
006900                                                                  00670000
007000*----------------------------------------------------------       00680000
007100* 1000-INITIALIZATION.                                            00690000
007200*     INTIALIZES VARIABLES.  OPENS, READS AND CLOSES INPUT ONLY   00700001
007200*     CONTROL CARDS.                                              00701008
007500*----------------------------------------------------------       00730000
007600 1000-INITIALIZATION.                                             00740000
007700                                                                  00750000
           DISPLAY '*** --- DISPLAYS FOR PROGRAM ' PC-PROGRAM-NAME      00751031
                   ' --- ***'.                                          00752031
           DISPLAY ' '.                                                 00753031
                                                                        00754031
007800     INITIALIZE CC-EPCC105-CONTROL-CARD.                          00760000
007800     INITIALIZE CC-EPCC187-CONTROL-CARD.                          00762003
007900                                                                  00770000
008000     OPEN INPUT CC-PLU-TMST-FILE.                                 00780007
001340     OPEN INPUT CC-UPDATE-START-FILE.                             00781007
009600                                                                  00782010
           SET PS-MORE-RECORDS TO TRUE.                                 00783010
008100                                                                  00790000
008200     PERFORM 1100-READ-PLU-TMST-CARD.                             00800001
008200     PERFORM 1200-READ-UPD-START-CARD.                            00801002
                                                                        00802003
           MOVE CC-EPCC187-TIMESTAMP TO PV-PRICE-TMST-TRUNC.            00803003
           MOVE PC-TMST-REST         TO PV-PRICE-TMST-REST.             00804003
008500                                                                  00830000
008600     CLOSE CC-PLU-TMST-FILE                                       00840001
001340           CC-UPDATE-START-FILE.                                  00841001
007900                                                                  00842001
008800*1000-EXIT.                                                       00860000
009000                                                                  00880000
009100*----------------------------------------------------------       00890000
009200* 1100-READ-PLU-TMST-CARD.                                        00900001
009300*     READS IN THE PREV & CURRENT TIMESTAMP(EPCC105) CONTROL CARD.00910001
009400*----------------------------------------------------------       00920000
009500 1100-READ-PLU-TMST-CARD.                                         00930001
                                                                        00942010
009700     READ CC-PLU-TMST-FILE                                        00950001
009800         INTO CC-EPCC105-CONTROL-CARD                             00960000
028109         AT END                                                   00970110
028110            SET PS-END-OF-FILE TO TRUE.                           00970210
                                                                        00971001
062500     IF PS-END-OF-FILE                                            00972001
063000        MOVE '1100-READ-PLU-TMST-CARD' TO PV-PARAGRAPH-NAME       00973001
053800        MOVE 'EMPTY EPCC105 CONTROL'   TO PV-OPERATION-MSG-1      00974001
063100        SET AC-CONTROL-CARD-ERROR      TO TRUE                    00975005
063200        PERFORM 9700-ABEND                                        00976001
           ELSE                                                         00976101
              DISPLAY 'PLU TIMESTAMP CONTROL CARD, EPCC105: '           00976201
              DISPLAY CC-EPCC105-CONTROL-CARD-DISPLY                    00976301
063300     END-IF.                                                      00977001
                                                                        00978001
010100*1100-EXIT.                                                       00990000
009000                                                                  00990101
009100*----------------------------------------------------------       00990201
009200* 1200-READ-UPD-START-CARD.                                       00990302
009300*     READS IN THE PRICE CHANGE UPDATE START TMST CONTROL CARD.   00990402
009400*----------------------------------------------------------       00990501
009500 1200-READ-UPD-START-CARD.                                        00990602
009600                                                                  00990701
009700     READ CC-UPDATE-START-FILE                                    00990801
009800         INTO CC-EPCC187-CONTROL-CARD                             00990901
028109         AT END                                                   00991010
028110            SET PS-END-OF-FILE TO TRUE.                           00991110
                                                                        00991301
062500     IF PS-END-OF-FILE                                            00991401
063000        MOVE '1200-READ-UPDATE-START-CARD' TO PV-PARAGRAPH-NAME   00991501
053800        MOVE 'EMPTY EPCC187 CONTROL'       TO PV-OPERATION-MSG-1  00991601
063100        SET AC-CONTROL-CARD-ERROR          TO TRUE                00991705
063200        PERFORM 9700-ABEND                                        00991801
           ELSE                                                         00991901
              DISPLAY 'PRICE CHGE UPDATE START CONTROL CARD, EPCC187: ' 00992001
              DISPLAY CC-EPCC187-CONTROL-CARD-DISPLY                    00992101
063300     END-IF.                                                      00992201
                                                                        00992301
010100*1200-EXIT.                                                       00992401
010300                                                                  01010000
010301*----------------------------------------------------------       01020000
010302* 2000-PROCESS-CNTL-CARDS.                                        01030000
010303*     UPDATES EPCC105 CONTROL CARDS FOR PROCESSING.               01030100
010304*----------------------------------------------------------       01030200
010305 2000-PROCESS-CNTL-CARDS.                                         01030300
                                                                        01030403
           PERFORM 2100-SELECT-TMST-RANGE.                              01030522
010306                                                                  01030600
      *    * CALCULATES THE OVERALL RANGE OF TIMESTAMPS TO COVER        01030730
      *    * USING THE DIFFERENCE IN DAYS, HOURS, MINUTES AND SECONDS.  01030830
      *    * DIFFERENCES IN YEARS, MONTHS AND MICROSECONDS SHOULD NOT   01030930
      *    * BE RELEVANT.                                               01031030
010306     COMPUTE PV-RANGE-TOTAL-SS =                                  01031127
                   PV-OVERALL-RANGE-SS +                                01031227
                  (PV-OVERALL-RANGE-MM * PC-CNVRT-MM-TO-SS) +           01031327
                  (PV-OVERALL-RANGE-HH * PC-CNVRT-HH-TO-SS) +           01031427
                  (PV-OVERALL-RANGE-DD * PC-CNVRT-DD-TO-SS).            01031527
           DISPLAY '    RANGE TOTAL SECONDS: ' PV-RANGE-TOTAL-SS.       01031622
010306                                                                  01031722
           IF PV-RANGE-TOTAL-SS <= 4                                    01031822
      *       * IF THE RANGE IS LESS THEN 4 SECONDS, DEFAULT TO 4       01031930
      *       * (ONE EACH WHEN DIVIDED INTO 4) TO CREATE DISTINCT       01032030
      *       * RANGES.                                                 01032130
              MOVE 1 TO PV-RANGE-EACH-SS                                01032222
           ELSE                                                         01032322
      *       * DIVIDE THE TOTAL RANGE, IN SECONDS, BY 4 SO THAT        01032430
      *       * 4 RANGES, ONE FOR EACH OF THE OUTPUT CONTROL CARDS,     01032530
      *       * CAN BE DETERMINED.                                      01032630
010306        COMPUTE PV-RANGE-EACH-SS = PV-RANGE-TOTAL-SS / 4          01032727
           END-IF.                                                      01032827
           DISPLAY '     RANGE EACH SECONDS: ' PV-RANGE-EACH-SS.        01032922
008700                                                                  01033022
007800     INITIALIZE CC-EPWS160-CONTROL-CARD.                          01033122
           SET CC-EPWS160-VALID-TEXT1     TO TRUE                       01033222
           SET CC-EPWS160-VALID-TEXT2     TO TRUE                       01033322
           SET CC-EPWS160-VALID-TEXT3     TO TRUE                       01033422
                                                                        01033522
008000     OPEN OUTPUT CC-TMST-RANGE1-FILE.                             01033622
000700     MOVE 1                            TO CC-EPWS160-THREAD-NBR.  01033730
           IF PV-PRICE-TMST < CC-EPCC105-PREV-TIMESTAMP                 01033830
      *       * THIS WOULD BE ODD, THE START OF PRICING UPDATES BEING   01033930
      *       * EARLIER THAN THE START OF THE PREVIOUS EXTRACT, BUT     01034030
      *       * THE PROGRAM ALLOWS FOR IT TO ENSURE VALID RANGES.       01034130
008400        MOVE PV-PRICE-TMST             TO CC-EPWS160-START-TMST   01034230
           ELSE                                                         01034330
008400        MOVE CC-EPCC105-PREV-TIMESTAMP TO CC-EPWS160-START-TMST   01034430
           END-IF.                                                      01034530
           MOVE PV-PRICE-TMST                TO PV-RANGE-START-TMST.    01034630
                                                                        01034730
010330     PERFORM 2200-SELECT-END-TMST.                                01034830
                                                                        01034922
008400     MOVE PV-RANGE-END-TMST         TO CC-EPWS160-END-TMST.       01035022
                                                                        01035122
           PERFORM 8000-WRITE-RANGE1-CARD.                              01035222
008000     CLOSE CC-TMST-RANGE1-FILE.                                   01035322
                                                                        01035422
001340     OPEN OUTPUT CC-TMST-RANGE2-FILE.                             01035522
000700     MOVE 2                         TO CC-EPWS160-THREAD-NBR.     01035622
008400     MOVE PV-RANGE-END-TMST         TO PV-RANGE-START-TMST.       01035722
008400     MOVE PV-RANGE-END-TMST         TO CC-EPWS160-START-TMST.     01035822
                                                                        01035922
010330     PERFORM 2200-SELECT-END-TMST.                                01036022
                                                                        01036122
008400     MOVE PV-RANGE-END-TMST         TO CC-EPWS160-END-TMST.       01036222
                                                                        01036322
           PERFORM 8100-WRITE-RANGE2-CARD.                              01036422
001340     CLOSE CC-TMST-RANGE2-FILE.                                   01036522
                                                                        01036622
001340     OPEN OUTPUT CC-TMST-RANGE3-FILE.                             01036722
000700     MOVE 3                         TO CC-EPWS160-THREAD-NBR.     01036822
008400     MOVE PV-RANGE-END-TMST         TO PV-RANGE-START-TMST.       01036922
008400     MOVE PV-RANGE-END-TMST         TO CC-EPWS160-START-TMST.     01037022
                                                                        01037122
010330     PERFORM 2200-SELECT-END-TMST.                                01037222
                                                                        01037322
008400     MOVE PV-RANGE-END-TMST         TO CC-EPWS160-END-TMST.       01037422
                                                                        01037522
           PERFORM 8200-WRITE-RANGE3-CARD.                              01037622
                                                                        01037722
001340     CLOSE CC-TMST-RANGE3-FILE.                                   01037822
                                                                        01037922
001340     OPEN OUTPUT CC-TMST-RANGE4-FILE.                             01038022
000700     MOVE 4                         TO CC-EPWS160-THREAD-NBR.     01038122
008400     MOVE PV-RANGE-END-TMST         TO PV-RANGE-START-TMST.       01038229
008400     MOVE PV-RANGE-END-TMST         TO CC-EPWS160-START-TMST.     01038322
                                                                        01038429
010330     PERFORM 2200-SELECT-END-TMST.                                01038529
                                                                        01038629
      *       * THIS WOULD BE ODD, THE CALCULATED END TIMESTAMP BEING   01038730
      *       * LATER THAN THE CAPTURED CURRENT TIMESTAMP, BUT          01038830
      *       * THE PROGRAM ALLOWS FOR IT TO ENSURE VALID RANGES.       01038930
           IF PV-RANGE-END-TMST > CC-EPCC105-CRNT-TIMESTAMP             01039029
008400        MOVE PV-RANGE-END-TMST         TO CC-EPWS160-END-TMST     01039129
           ELSE                                                         01039229
008400        MOVE CC-EPCC105-CRNT-TIMESTAMP TO CC-EPWS160-END-TMST     01039329
           END-IF.                                                      01039429
                                                                        01039522
           PERFORM 8300-WRITE-RANGE4-CARD.                              01039622
                                                                        01039722
001340     CLOSE CC-TMST-RANGE4-FILE.                                   01039822
010360                                                                  01039922
010370*2000-EXIT.                                                       01040022
010390                                                                  01211003
010400*----------------------------------------------------------       01212003
010500* 2100-SELECT-TMST-RANGE.                                         01213022
010600*     RETRIEVE OVERALL TIMESTAMP RANGE FROM DB2.                  01214022
010700*----------------------------------------------------------       01215003
010800 2100-SELECT-TMST-RANGE.                                          01216022
010900                                                                  01217003
           DISPLAY ' '.                                                 01217131
           DISPLAY '-- DB2 RANGE CALCULATION --'.                       01217203
           DISPLAY 'FROM TIMESTAMP VALUE: ' CC-EPCC105-CRNT-TIMESTAMP.  01217303
           DISPLAY 'TO   TIMESTAMP VALUE: ' PV-PRICE-TMST.              01217403
010900                                                                  01217503
011000     EXEC SQL                                                     01218003
011100          SELECT ((TIMESTAMP(:CC-EPCC105-CRNT-TIMESTAMP)) -       01219420
                        (TIMESTAMP(:PV-PRICE-TMST)))                    01219520
011200          INTO  :PV-OVERALL-RANGE                                 01219620
011300          FROM   SYSIBM.SYSDUMMY1                                 01219820
011400     END-EXEC.                                                    01219919
011500                                                                  01220019
011600     IF SQLCODE EQUAL ZERO                                        01220119
              DISPLAY 'CALC TIMESTAMP RANGE: ' PV-OVERALL-RANGE         01220220
              MOVE PV-OVERALL-RANGE TO PV-OVERALL-RANGE-NUM             01220321
              DISPLAY ' RANGE NUM:  ' PV-OVERALL-RANGE-NUM              01220421
              DISPLAY ' RANGE CCYY: ' PV-OVERALL-RANGE-CCYY             01220521
              DISPLAY ' RANGE MO  : ' PV-OVERALL-RANGE-MO               01220621
              DISPLAY ' RANGE DD  : ' PV-OVERALL-RANGE-DD               01220721
              DISPLAY ' RANGE HH  : ' PV-OVERALL-RANGE-HH               01220821
              DISPLAY ' RANGE MM  : ' PV-OVERALL-RANGE-MM               01220921
              DISPLAY ' RANGE SS  : ' PV-OVERALL-RANGE-SS               01221021
011600     ELSE                                                         01221121
011700        MOVE '2100-SELECT-TMST-RANGE' TO PV-PARAGRAPH-NAME        01221222
011800        MOVE 'CANNOT GET TIMESTAMP RANGE'                         01221321
011900                                     TO PV-DB2-OPERATION          01221421
012000        PERFORM 9100-SQL-ABEND                                    01221521
012100     END-IF.                                                      01221621
012200                                                                  01221721
012300*2100-EXIT.                                                       01222022
010390                                                                  01223022
010400*----------------------------------------------------------       01224022
010500* 2200-SELECT-END-TMST.                                           01225022
010600*     RETRIEVE TIMESTAMP FROM DB2.                                01226022
010700*----------------------------------------------------------       01227022
010800 2200-SELECT-END-TMST.                                            01228022
010900                                                                  01228122
           DISPLAY ' '.                                                 01228231
           DISPLAY '-- DB2 END TIMESTAMP CALCULATION --'.               01228322
           DISPLAY 'START TIMESTAMP VALUE: ' PV-RANGE-START-TMST.       01228422
           DISPLAY '    ADD SECONDS VALUE: ' PV-RANGE-EACH-SS.          01228522
010900                                                                  01229022
011000     EXEC SQL                                                     01229622
011200          SET   :PV-RANGE-END-TMST =                              01229722
011100                (TIMESTAMP(:PV-RANGE-START-TMST) +                01229825
                      :PV-RANGE-EACH-SS SECONDS)                        01229925
011400     END-EXEC.                                                    01230522
011500                                                                  01230622
011600     IF SQLCODE EQUAL ZERO                                        01230722
              DISPLAY 'END   TIMESTAMP VALUE: ' PV-RANGE-END-TMST       01230822
011600     ELSE                                                         01231022
011700        MOVE '2200-SELECT-END-TMST' TO PV-PARAGRAPH-NAME          01231122
011800        MOVE 'CANNOT GET END TMST FOR RANGE'                      01231222
011900                                    TO PV-DB2-OPERATION           01231322
012000        PERFORM 9100-SQL-ABEND                                    01231422
012100     END-IF.                                                      01232022
012200                                                                  01233022
012300*2200-EXIT.                                                       01234022
012400                                                                  01240003
014200*----------------------------------------------------------       01400000
014210* 8000-WRITE-RANGE1-CARD.                                         01410001
014220*     WRITES TIMESTAMP RANGE 1 CONTROL CARD.                      01420001
014240*----------------------------------------------------------       01422000
014250 8000-WRITE-RANGE1-CARD.                                          01423001
                                                                        01423131
           DISPLAY 'TMST RANGE 1 CONTROL CARD (EPCC176) AS WRITTEN: '.  01423231
           DISPLAY CC-EPWS160-CONTROL-CARD-DISPLY.                      01423331
014260                                                                  01424000
014270     WRITE CC-TMST-RANGE1-RECORD                                  01425001
014280         FROM CC-EPWS160-CONTROL-CARD.                            01426001
014290                                                                  01427000
014300*8000-EXIT.                                                       01428000
014500                                                                  01430000
014200*----------------------------------------------------------       01432001
014210* 8100-WRITE-RANGE2-CARD.                                         01433001
014220*     WRITES TIMESTAMP RANGE 2 CONTROL CARD.                      01434001
014240*----------------------------------------------------------       01435001
014250 8100-WRITE-RANGE2-CARD.                                          01436001
                                                                        01436131
           DISPLAY 'TMST RANGE 2 CONTROL CARD (EPCC177) AS WRITTEN: '.  01436231
           DISPLAY CC-EPWS160-CONTROL-CARD-DISPLY.                      01436331
014260                                                                  01437001
014270     WRITE CC-TMST-RANGE2-RECORD                                  01438001
014280         FROM CC-EPWS160-CONTROL-CARD.                            01439001
014290                                                                  01439401
014300*8100-EXIT.                                                       01439501
014500                                                                  01439601
014200*----------------------------------------------------------       01439701
014210* 8200-WRITE-RANGE3-CARD.                                         01439801
014220*     WRITES TIMESTAMP RANGE 3 CONTROL CARD.                      01439901
014240*----------------------------------------------------------       01440001
014250 8200-WRITE-RANGE3-CARD.                                          01440101
                                                                        01440231
           DISPLAY 'TMST RANGE 3 CONTROL CARD (EPCC178) AS WRITTEN: '.  01440331
           DISPLAY CC-EPWS160-CONTROL-CARD-DISPLY.                      01440431
014260                                                                  01440501
014270     WRITE CC-TMST-RANGE3-RECORD                                  01440601
014280         FROM CC-EPWS160-CONTROL-CARD.                            01440701
014290                                                                  01440901
014300*8200-EXIT.                                                       01441001
014500                                                                  01441101
014200*----------------------------------------------------------       01441201
014210* 8300-WRITE-RANGE4-CARD.                                         01441301
014220*     WRITES TIMESTAMP RANGE 4 CONTROL CARD.                      01441401
014240*----------------------------------------------------------       01441501
014250 8300-WRITE-RANGE4-CARD.                                          01441601
                                                                        01441731
           DISPLAY 'TMST RANGE 4 CONTROL CARD (EPCC179) AS WRITTEN: '.  01441831
           DISPLAY CC-EPWS160-CONTROL-CARD-DISPLY.                      01441931
014260                                                                  01442001
014270     WRITE CC-TMST-RANGE4-RECORD                                  01442101
014280         FROM CC-EPWS160-CONTROL-CARD.                            01442201
014290                                                                  01442301
014300*8300-EXIT.                                                       01442401
014500                                                                  01442501
016200*---------------------------------------------------------        01443001
016300* 9100-SQL-ABEND.                                                 01450000
016400*     ABEND PROGRAM WHEN AN SQL ERROR CODE OR WARNING CODE OCCURS.01460000
016500*---------------------------------------------------------        01470000
016600 9100-SQL-ABEND.                                                  01480000
016700                                                                  01490000
016800     SET AC-DB2-ERROR TO TRUE.                                    01500000
016900                                                                  01510000
017000     DISPLAY '** ABEND     **'.                                   01520000
017100     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                01530000
017200     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              01540000
017300     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               01550000
017400                                                                  01560000
017500     COPY DPPD004.                                                01570000
017600     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         01580000
017700                                                                  01590000
017800*9100-EXIT.                                                       01600000
                                                                        01610005
054800*----------------------------------------------------------       01611005
054900* 9700-ABEND.                                                     01612005
055000*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                  01613005
055100*----------------------------------------------------------       01614005
055200 9700-ABEND.                                                      01615005
055300                                                                  01616005
055400     DISPLAY '** ABEND           **'.                             01617005
055500     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          01618005
055600     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        01619005
055700     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       01619105
055800     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       01619205
055900     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         01619305
056000                                                                  01619405
056100*9700-EXIT.                                                       01619505
018000                                                                  01620000
018100*----------------------------------------------------------       01630000
018200* 9999-WRAPUP.                                                    01640000
018300*     NOTHING CURRENTLY NEEDED HERE, BUT KEPT IN CASE.            01650031
018400*----------------------------------------------------------       01660000
018500 9999-WRAPUP.                                                     01670000
018600                                                                  01680000
019100                                                                  01710000
019200*9999-EXIT.                                                       01720000
