000100******************************************************************00010035
000200*                                                                *00020035
000300*  MODULE TO DETERMINE IF A SYSTEM PROMPTED AUDIT PASS/FAIL      *00030035
000400*                                                                *00040035
000500******************************************************************00050035
000600 IDENTIFICATION DIVISION.                                         00060035
000700******************************************************************00070035
000800                                                                  00080035
000900 PROGRAM-ID.             SUKCS763.                                00090035
001000 AUTHOR.                 DENISE HAHN.                             00100035
001100 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00110035
001200 DATE-WRITTEN.           MARCH, 2004.                             00120035
001300 DATE-COMPILED.                                                   00130035
001400                                                                  00140035
000500******************************************************************00150042
      * 11/05/13 DW BEG                                                 00160042
      * 11/05/2013 DAVE WELLER CHG0068598 TKID: TKMA602                 00170042
      *            HANDLE 'RF' PACKAGING TYPE LIKE 'PS' TYPE.           00180042
      * 11/05/13 DW END                                                 00190042
001500******************************************************************00200035
001600 ENVIRONMENT DIVISION.                                            00210035
001700******************************************************************00220035
001800                                                                  00230035
001900******************************************************************00240035
002000 DATA DIVISION.                                                   00250035
002100******************************************************************00260035
002200                                                                  00270035
002300******************************************************************00280035
002400 WORKING-STORAGE SECTION.                                         00290035
002500******************************************************************00300035
002600                                                                  00310035
002700*---------------------------------------------------------------* 00320035
002800*  RECORD LAYOUTS FOR THE TROUBLE CREATION ROUTINE                00330035
002900*---------------------------------------------------------------* 00340035
003000     COPY TMWS500.                                                00350035
003100                                                                  00360035
003101*----------------------------------------------------------------*00370035
003102* COMMAREA USED WHEN LINKING FROM A CALLING PROGRAM               00380035
003103*----------------------------------------------------------------*00390035
003120     COPY SUWS047.                                                00400035
003130                                                                  00410035
003140*----------------------------------------------------------------*00420035
003150* COMMAREA USED WHEN CALLING AUTOVE MODULE (RCKUT127)             00430035
003160*----------------------------------------------------------------*00440035
003170     COPY RCWS040.                                                00450035
003180                                                                  00460035
003200*----------------------------------------------------------------*00470035
003300*  DB2 KEYS                                                      *00480035
003400*----------------------------------------------------------------*00490035
003500 01  DK-DB2-KEYS.                                                 00500035
003600     05  DK-OPER-UNT-ID                  PIC  S9(4) COMP.         00510035
003700     05  DK-AUDIT-CNTL-NBR               PIC S9(09) COMP.         00520035
003800     05  DK-PO-NBR                       PIC S9(09) COMP.         00530035
003900     05  DK-PO-LINE-NBR                  PIC S9(09) COMP.         00540035
004000     05  DK-PREPK-ID                     PIC S9(04) COMP.         00550035
004100     05  DK-SHIP-UNIT-NBR                PIC S9(18) COMP-3.       00560035
004200                                                                  00570035
004300                                                                  00580035
004400*----------------------------------------------------------------*00590035
004500*  PROGRAM CONSTANTS                                             *00600035
004600*----------------------------------------------------------------*00610035
004700 01  PC-PROGRAM-CONSTANTS.                                        00620035
004800     05  PC-D                       PIC  X(01) VALUE 'D'.         00630035
004900     05  PC-F                       PIC  X(01) VALUE 'F'.         00640035
005000     05  PC-I                       PIC  X(01) VALUE 'I'.         00650035
005100     05  PC-N                       PIC  X(01) VALUE 'N'.         00660035
005200     05  PC-P                       PIC  X(01) VALUE 'P'.         00670035
005300     05  PC-CURRENT-PROGRAM-NAME    PIC  X(08) VALUE 'SUKCS763'.  00680035
005400     05  PC-DEFAULT-TIMESTAMP       PIC  X(26) VALUE              00690035
005500               '9999-09-09-09.09.09.999999'.                      00700035
005700     05  PC-STOP-VER-PO-TRB-373     PIC S9(04) COMP VALUE 373.    00710035
005701     05  PC-STOP-VER-LNE-TRB-383    PIC S9(04) COMP VALUE 383.    00720035
005702     05  PC-STOP-VER-PREPK-TRB-384  PIC S9(04) COMP VALUE 384.    00730035
005710     05  PC-TROUBLE-LENGTH          PIC S9(04) COMP VALUE +600.   00740035
005720     05  PC-TROUBLE-WTR             PIC  X(08) VALUE 'TMKCS521'.  00750035
005800                                                                  00760035
005900                                                                  00770035
006000*----------------------------------------------------------------*00780035
006100* PROGRAM SWITCHES                                               *00790035
006200*----------------------------------------------------------------*00800035
006300 01  PS-PROGRAM-SWITCHES.                                         00810035
006400     05  PS-ERROR-SW                     PIC  X(01)  VALUE 'N'.   00820035
006500         88  PS-ERROR                                VALUE 'Y'.   00830035
006600         88  PS-NO-ERROR                             VALUE 'N'.   00840035
006610     05  PS-PBS-OVERRIDE-SW              PIC  X(01)  VALUE 'N'.   00850035
006620         88  PS-PBS-OVERRIDE                         VALUE 'Y'.   00860035
006630         88  PS-NO-PBS-OVERRIDE                      VALUE 'N'.   00870035
006700     05  PS-AUDIT-IS-COMPLETE-SW         PIC  X(01)  VALUE 'N'.   00880035
006800         88  PS-AUDIT-NOT-COMPLETE                   VALUE 'N'.   00890035
006900         88  PS-AUDIT-IS-COMPLETE                    VALUE 'Y'.   00900035
007000     05  PS-FAILED-AUDITS-FOUND-SW       PIC  X(01)  VALUE 'N'.   00910035
007100         88  PS-FAILED-AUDITS-FOUND                  VALUE 'Y'.   00920035
007200         88  PS-NO-FAILED-AUDITS-FOUND               VALUE 'N'.   00930035
007300     05  PS-AUDIT-SW                     PIC  X(01)  VALUE ' '.   00940035
007400         88  PS-VALID-AUDIT-NBR                      VALUE 'Y'.   00950035
007500         88  PS-INVALID-AUDIT-NBR                    VALUE 'N'.   00960035
007600     05  PS-EOC-IN-PROCESS-SW            PIC  X(01)  VALUE ' '.   00970035
007700         88  PS-EOC-IN-PROCESS                       VALUE 'Y'.   00980035
007800         88  PS-NOT-EOC-IN-PROCESS                   VALUE 'N'.   00990035
007900     05  PS-EOC-DC-PROCESS-SW            PIC  X(01)  VALUE ' '.   01000035
008000         88  PS-EOC-DC-PROCESS                       VALUE 'Y'.   01010035
008100         88  PS-NOT-EOC-DC-PROCESS                   VALUE 'N'.   01020035
008110     05  PS-AUTO-VE-SW                   PIC X(01).               01030035
008120         88  PS-AUTO-VE-YES                          VALUE 'Y'.   01040035
008130         88  PS-AUTO-VE-NO                           VALUE 'N'.   01050035
008200                                                                  01060035
008300                                                                  01070035
008400*----------------------------------------------------------------*01080035
008500* PROGRAM VARIABLES                                              *01090035
008600*----------------------------------------------------------------*01100035
008700 01  PV-PROGRAM-VARIABLES.                                        01110035
008800     05  PV-LIMIT-DAYS                   PIC S9(09) COMP.         01120035
008900     05  PV-PASSED-COUNT                 PIC S9(04) COMP.         01130035
009000     05  PV-PBS-AUDIT-IND                PIC  X(25).              01140035
009010     05  PV-AUDIT-ERR-PCT-X.                                      01150035
009020         10  PV-AUDIT-ERR-PCT            PIC ZZ9.                 01160035
009030     05  PV-AUDIT-ERR-PCT-TOT            PIC 999999.              01170035
009040                                                                  01180035
009100     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     01190035
009200                                                     COMP SYNC.   01200035
009300     05  PV-CICS-RESPONSE                PIC S9(09)  VALUE ZEROS  01210035
009400                                                     COMP SYNC.   01220035
009500     05  PV-DISP-OPER                    PIC  9(04).              01230035
009510     05  PV-DISP-PO-NBR                  PIC  9(09).              01240035
009600     05  PV-DISP-RCVR-SEQ-NBR            PIC  9(04).              01250035
009700     05  PV-DISP-PREPK-ID                PIC  9(04).              01260035
009800     05  PV-DISP-PO-LINE-NBR             PIC  9(04).              01270035
009900     05  PV-DISP-AUDIT-CNTL-NBR          PIC  9(09).              01280035
010000     05  PV-DISP-SQLCODE                 PIC -9(05) VALUE ZEROES. 01290035
010010     05  PV-CICS-MSG-AREA                PIC  X(100) VALUE SPACE. 01300035
010100                                                                  01310035
010200                                                                  01320035
010300*---------------------------------------------------------------* 01330035
010400*    DB2 AREA FOR THE PO AUDIT REQUEST TABLE (SUT_PO_AUD_REQ)   * 01340035
010500*---------------------------------------------------------------* 01350035
010600     EXEC SQL                                                     01360035
010700         INCLUDE SUT00015                                         01370035
010800     END-EXEC.                                                    01380035
010900                                                                  01390035
011000*---------------------------------------------------------------* 01400035
011100*    DB2 AREA FOR THE PO AUDIT PARM TABLE (SUT_PO_AUD_PARM)     * 01410035
011200*---------------------------------------------------------------* 01420035
011300     EXEC SQL                                                     01430035
011400         INCLUDE SUT00017                                         01440035
011500     END-EXEC.                                                    01450035
011600                                                                  01460035
011700*---------------------------------------------------------------* 01470035
011800*    DB2 AREA FOR THE RECEIVING SYSTEM PARM TABLE               * 01480035
011900*---------------------------------------------------------------* 01490035
012000     EXEC SQL                                                     01500035
012100         INCLUDE TKRPRPM                                          01510035
012200     END-EXEC.                                                    01520035
012300                                                                  01530035
012400*---------------------------------------------------------------* 01540035
012500*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      01550035
012600*  AUDIT TABLE (TSUNAUD)                                          01560035
012700*---------------------------------------------------------------* 01570035
012800     EXEC SQL                                                     01580035
012900         INCLUDE TSUNAUD                                          01590035
013000     END-EXEC.                                                    01600035
013100                                                                  01610035
013200*---------------------------------------------------------------* 01620035
013300*  COMMUNICATIONS AREA FOR DB2                                    01630035
013400*---------------------------------------------------------------* 01640035
013500     EXEC SQL                                                     01650035
013600         INCLUDE SQLCA                                            01660035
013700     END-EXEC.                                                    01670035
013800                                                                  01680035
013900*---------------------------------------------------------------* 01690035
014000*                                                                 01700035
014100*---------------------------------------------------------------* 01710035
014200     EXEC SQL                                                     01720035
014300         DECLARE IN_PROCESS_CURSOR CURSOR FOR                     01730035
014400          SELECT AUD_CNTL_NBR                                     01740035
014500          FROM   SUT_PO_AUD_REQ                                   01750035
014600          WHERE  PO_NBR         = :DK-PO-NBR                      01760035
014700            AND  PO_LNE_NBR     = :DK-PO-LINE-NBR                 01770035
014800            AND  PO_PREPK_ID    = :DK-PREPK-ID                    01780035
014900            AND  AUD_STAT_CDE   = :PC-I                           01790035
015000            AND  DAYS(CRE_TMST) > :PV-LIMIT-DAYS                  01800035
015100     END-EXEC.                                                    01810035
015200                                                                  01820035
015300*---------------------------------------------------------------* 01830035
015400*                                                                 01840035
015500*---------------------------------------------------------------* 01850035
015600     EXEC SQL                                                     01860035
015700         DECLARE IN_PROCESS_DC_CSR CURSOR FOR                     01870035
015800          SELECT AUD_CNTL_NBR                                     01880035
015900          FROM   SUT_PO_AUD_REQ                                   01890035
016000          WHERE  PO_NBR         = :DK-PO-NBR                      01900035
016100            AND  PO_LNE_NBR     = :DK-PO-LINE-NBR                 01910035
016200            AND  PO_PREPK_ID    = :DK-PREPK-ID                    01920035
016300            AND  OPER_UNT_ID    = :DK-OPER-UNT-ID                 01930035
016400            AND  AUD_STAT_CDE   = :PC-I                           01940035
016500            AND  DAYS(CRE_TMST) > :PV-LIMIT-DAYS                  01950035
016600     END-EXEC.                                                    01960035
016700                                                                  01970035
016800                                                                  01980035
016900***************************************************************** 01990035
017220 LINKAGE SECTION.                                                 02000035
017230******************************************************************02010035
017240 01  DFHCOMMAREA.                                                 02020035
017250     05  FILLER                         OCCURS  1 TO 4072 TIMES   02030035
017260                                      DEPENDING ON EIBCALEN.      02040035
017270         10  FILLER                   PIC X.                      02050035
017280                                                                  02060035
017300                                                                  02070035
017400                                                                  02080035
017500******************************************************************02090035
017600 PROCEDURE DIVISION.                                              02100035
017700                                                                  02110035
017800     SET  SU047-SUCCESSFUL  TO  TRUE.                             02120035
018210                                                                  02130035
018220     MOVE DFHCOMMAREA              TO  SU047-COMMAREA-REC.        02140035
018230                                                                  02150035
018240     MOVE SU047-OPER-UNT-ID        TO  DK-OPER-UNT-ID.            02160035
018250                                                                  02170035
018260     PERFORM 9300-CHECK-LOGGING.                                  02180035
018270                                                                  02190035
018280     IF KRPRPM-FUNC-TXT = 'Y'                                     02200035
018290         MOVE SU047-PO-NBR    TO     PV-DISP-PO-NBR               02210035
018291         MOVE SU047-REC-SEQ-NBR   TO PV-DISP-RCVR-SEQ-NBR         02220035
018292         STRING   ' SUKCS763-START'                               02230035
018293                  ' CALLED BY-'                                   02240035
018294                  SU047-CALLING-PROGRAM                           02250035
018295                  ' PO='                                          02260035
018296                  PV-DISP-PO-NBR                                  02270035
018297                  ' RCVR='                                        02280035
018298                  PV-DISP-RCVR-SEQ-NBR                            02290035
018299                  DELIMITED BY SIZE                               02300035
018300                              INTO PV-CICS-MSG-AREA               02310035
018301         PERFORM 9200-WRITE-TO-CICS-LOG                           02320035
018302     END-IF.                                                      02330035
018303                                                                  02340035
018304                                                                  02350035
018310     PERFORM 0000-PROGRAM-MAINLINE.                               02360035
018320                                                                  02370035
018400*---------------------------------------------------------------* 02380035
018500*                                                                 02390035
018600*---------------------------------------------------------------* 02400035
018700 0000-PROGRAM-MAINLINE.                                           02410035
018800                                                                  02420035
018900     INITIALIZE  PV-PROGRAM-VARIABLES.                            02430035
019000     PERFORM 1900-CHECK-AUTOVE-DC                                 02440035
019001     PERFORM 2000-CHECK-FOR-COMPLETION                            02450035
019002                                                                  02460035
019003     IF  PS-NO-ERROR                                              02470035
019004         IF SU047-PACK-ERRORS > 0 OR                              02480035
019005            SU047-PO-STR-ERRORS = 'Y'                             02490035
019006             MOVE 100                 TO PV-AUDIT-ERR-PCT         02500035
019007         ELSE                                                     02510035
019008             IF SU047-TOT-TCKT-ERROR-PCT > SU047-PICK-ERROR-PCT   02520035
019009                 COMPUTE PV-AUDIT-ERR-PCT-TOT =                   02530035
019010                      SU047-TOT-TCKT-ERROR-PCT * 100              02540035
019011             ELSE                                                 02550035
019012                 COMPUTE PV-AUDIT-ERR-PCT-TOT =                   02560035
019013                      SU047-PICK-ERROR-PCT * 100                  02570035
019014             END-IF                                               02580035
019015             IF PV-AUDIT-ERR-PCT-TOT > 100                        02590035
019016                 MOVE 100             TO PV-AUDIT-ERR-PCT         02600035
019017             ELSE                                                 02610035
019018                 MOVE PV-AUDIT-ERR-PCT-TOT                        02620035
019019                                      TO PV-AUDIT-ERR-PCT         02630035
019020             END-IF                                               02640035
019021         END-IF                                                   02650035
019022     END-IF.                                                      02660035
019023                                                                  02670035
019024     IF  PS-NO-ERROR                                              02680035
019025         IF SU047-PACK-ERRORS > 0                                 02690035
019026             MOVE 1.00                TO SU047-AUDIT-ERROR-PCT    02700035
019030         ELSE                                                     02710035
019040             IF SU047-TCKT-ERROR-PCT > SU047-PICK-ERROR-PCT       02720035
019050                 MOVE SU047-TCKT-ERROR-PCT                        02730035
019060                                      TO SU047-AUDIT-ERROR-PCT    02740035
019070             ELSE                                                 02750035
019080                 MOVE SU047-PICK-ERROR-PCT                        02760035
019090                                      TO SU047-AUDIT-ERROR-PCT    02770035
019091             END-IF                                               02780035
019092         END-IF                                                   02790035
019093     END-IF.                                                      02800035
019094                                                                  02810035
019110     PERFORM 9998-RETURN.                                         02820035
019200                                                                  02830035
019300                                                                  02840035
019701*----------------------------------------------------------------*02850035
019702*    CALL (AUTOVE) AUTOVERIFICATION MODULE (RCKUT127)             02860035
019703*    TO SEE IF THIS IS AN AUTOVE PO                               02870035
019704*----------------------------------------------------------------*02880035
019705 1900-CHECK-AUTOVE-DC.                                            02890035
019707                                                                  02900035
019708     INITIALIZE RC040-FIELDS.                                     02910035
019709     MOVE SU047-OPER-UNT-ID   TO RC040-SIGNON-LOCATION.           02920035
019710     MOVE SU047-PO-NBR        TO RC040-PO-NBR.                    02930035
019711     MOVE SU047-REC-SEQ-NBR   TO RC040-PO-RCVR.                   02940035
019712     SET  RC040-RCVR-EXISTS   TO TRUE.                            02950035
019714     MOVE SU047-USER-ID       TO RC040-USER-ID.                   02960035
019715     MOVE 'SUKCS763'          TO RC040-CALLING-PROGRAM.           02970035
019716                                                                  02980035
019717     CALL RC040-AUTOVE-CHECK-PGM USING  DFHEIBLK                  02990035
019718                                        RC040-COMMAREA            03000035
019719                                        RC040-FIELDS.             03010035
019720     EVALUATE TRUE                                                03020035
019721         WHEN RC040-SUCCESSFUL                                    03030035
019722              MOVE RC040-AUTO-VE-SW     TO PS-AUTO-VE-SW          03040035
019723         WHEN RC040-DATABASE-BUSY OR                              03050035
019724              RC040-INVALID-SQL                                   03060035
019725             MOVE RC040-SUCCESS-IND    TO SU047-SUCCESS-IND       03070035
019726             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          03080035
019727             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    03090035
019728             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     03100035
019729             MOVE DK-AUDIT-CNTL-NBR    TO PV-DISP-AUDIT-CNTL-NBR  03110035
019730             MOVE SQLCODE              TO PV-DISP-SQLCODE         03120035
019731             STRING   ' SUKCS763-1900-'                           03130035
019732                      ' CALLED BY-'                               03140035
019733                      SU047-CALLING-PROGRAM                       03150035
019734                      ' PO='                                      03160035
019735                      PV-DISP-PO-NBR '-'                          03170035
019736                      PV-DISP-RCVR-SEQ-NBR '-'                    03180035
019737                      PV-DISP-PO-LINE-NBR                         03190035
019738                      ' AUDIT='                                   03200035
019739                      PV-DISP-AUDIT-CNTL-NBR                      03210035
019740                      ' SQLCODE='                                 03220035
019741                      PV-DISP-SQLCODE                             03230035
019742                      DELIMITED BY SIZE                           03240035
019743                                      INTO SU047-CRA-RET-MSG      03250035
019744             MOVE SQLCODE               TO SU047-SQLCODE          03260035
019745             MOVE '1900-'               TO SU047-CRA-REQ-ID       03270035
019746             PERFORM 9998-RETURN                                  03280035
019747                                                                  03290035
019757         WHEN OTHER                                               03300035
019758             SET  SU047-INVALID-SQL    TO TRUE                    03310035
019759             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          03320035
019760             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    03330035
019761             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     03340035
019762             MOVE DK-AUDIT-CNTL-NBR    TO PV-DISP-AUDIT-CNTL-NBR  03350035
019763             MOVE SQLCODE              TO PV-DISP-SQLCODE         03360035
019764             STRING   ' SUKCS763-1900-'                           03370035
019765                      ' CALLED BY-'                               03380035
019766                      SU047-CALLING-PROGRAM                       03390035
019767                      ' PO='                                      03400035
019768                      PV-DISP-PO-NBR '-'                          03410035
019769                      PV-DISP-RCVR-SEQ-NBR '-'                    03420035
019770                      PV-DISP-PO-LINE-NBR                         03430035
019771                      ' AUDIT='                                   03440035
019772                      PV-DISP-AUDIT-CNTL-NBR                      03450035
019773                      ' SQLCODE='                                 03460035
019774                      PV-DISP-SQLCODE                             03470035
019775                      DELIMITED BY SIZE                           03480035
019776                                      INTO SU047-CRA-RET-MSG      03490035
019777             MOVE SQLCODE               TO SU047-SQLCODE          03500035
019778             MOVE '1900-'               TO SU047-CRA-REQ-ID       03510035
019779             PERFORM 9998-RETURN                                  03520035
019780                                                                  03530035
019781     END-EVALUATE.                                                03540035
019782                                                                  03550035
019790 2000-CHECK-FOR-COMPLETION.                                       03560035
019800                                                                  03570035
019900     PERFORM 2400-SELECT-AUDIT-NBR.                               03580035
020000     PERFORM 8450-SELECT-PBS-IND.                                 03590035
020010     IF  PS-NO-ERROR                                              03600035
020100         IF SUT00015-AUD-STAT-CDE = 'I'                           03610035
020200             PERFORM 2050-CHECK-AUDIT                             03620035
      *11/05/13 DW BEG                                                  03630035
020300*            IF SUT00015-PKGNG-TYP-CDE = 'PS' AND                 03640035
020300             IF SUT00015-PKGNG-TYP-CDE = ('PS' OR 'RF') AND       03650035
      *11/05/13 DW END                                                  03660035
020400                SUT00015-CART-PRMPT-CDE NOT = 'D' AND             03670035
020500                PV-PBS-AUDIT-IND = 'Y'                            03680035
020600                 SET PS-PBS-OVERRIDE TO TRUE                      03690035
020700             ELSE                                                 03700035
020800                 SET PS-NO-PBS-OVERRIDE TO TRUE                   03710035
020900             END-IF                                               03720035
021000             PERFORM 2070-COMPARE-PERCENT                         03730035
021100         END-IF                                                   03740035
021110     END-IF.                                                      03750035
021200                                                                  03760035
021300                                                                  03770035
021400*---------------------------------------------------------------* 03780035
021500*                                                                 03790035
021600*---------------------------------------------------------------* 03800035
021700 2050-CHECK-AUDIT.                                                03810035
021800     SET PS-AUDIT-NOT-COMPLETE TO TRUE.                           03820035
021900     IF SU047-TOTAL-UNITS > 0                                     03830035
022000         IF SU047-TOTAL-UNITS > SU047-AUDITED-UNITS               03840035
022100             CONTINUE                                             03850035
022200         ELSE                                                     03860035
022300             SET PS-AUDIT-IS-COMPLETE TO TRUE                     03870035
022400         END-IF                                                   03880035
022500     END-IF.                                                      03890035
022600     IF SU047-TOTAL-CARTONS > SU047-AUDITED-CARTONS               03900035
022700         CONTINUE                                                 03910035
022800     ELSE                                                         03920035
022900         SET PS-AUDIT-IS-COMPLETE TO TRUE                         03930035
023000     END-IF.                                                      03940035
023100     IF SU047-PACK-ERRORS > 0 OR                                  03950035
023200        SU047-PO-STR-ERRORS = 'Y'                                 03960035
023300         SET PS-AUDIT-IS-COMPLETE TO TRUE                         03970035
023400     END-IF.                                                      03980035
023500                                                                  03990035
023600                                                                  04000035
023700*---------------------------------------------------------------* 04010035
023800*                                                                 04020035
023900*---------------------------------------------------------------* 04030035
024000 2070-COMPARE-PERCENT.                                            04040035
024100     PERFORM 8400-SELECT-TKRPRPM.                                 04050035
024200     IF PS-AUDIT-IS-COMPLETE                                      04060035
024300         MOVE SU047-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR           04070035
024400         PERFORM 2100-CLOSE-AUDIT                                 04080035
024500         IF SU047-AUDIT-ERROR-PCT > KRPRPM-FUNC-PCT OR            04090035
024600            SU047-AUDIT-ERROR-PCT = KRPRPM-FUNC-PCT OR            04100035
024700            SU047-PACK-ERRORS     > 0 OR                          04110035
024800            SU047-PO-STR-ERRORS   = 'Y' OR                        04120036
      * 11/05/13 DW BEG                                                 04130036
      * RFID AUDITS FAIL WITH ANY ERRORS                                04140036
                  (SUT00015-PKGNG-TYP-CDE = 'RF' AND                    04150036
                   SU047-TICKET-ERRORS > 0)                             04160039
      * 11/05/13 DW END                                                 04170036
024900             MOVE PC-F           TO SUT00015-AUD-STAT-CDE         04180035
025000             MOVE PC-F           TO SUT00015-CART-PRMPT-CDE       04190035
025100             SET  SU047-PO-AUD-REQ-FAIL  TO  TRUE                 04200035
025200             MOVE SU047-AUDIT-ERROR-PCT                           04210035
025300                                 TO SUT00015-AUD-ERR-PCT          04220035
025400             PERFORM 2200-UPDATE-SUT-PO-AUD-REQ                   04230035
025410             IF PS-AUTO-VE-YES                                    04240035
025500                PERFORM 4000-CREATE-TROUBLE                       04250035
025510             END-IF                                               04260035
025600         ELSE                                                     04270035
025700             MOVE PC-P           TO SUT00015-AUD-STAT-CDE         04280035
025800             MOVE PC-D           TO SUT00015-CART-PRMPT-CDE       04290035
025900             SET  SU047-PO-AUD-REQ-PASS  TO  TRUE                 04300035
026000             MOVE SU047-AUDIT-ERROR-PCT                           04310035
026100                                 TO SUT00015-AUD-ERR-PCT          04320035
026200             PERFORM 2200-UPDATE-SUT-PO-AUD-REQ                   04330035
026300             PERFORM 2300-UPDATE-OTHER-AUDITS                     04340035
026400         END-IF                                                   04350035
026500     ELSE                                                         04360035
026600         IF (SU047-AUDIT-ERROR-PCT > KRPRPM-FUNC-PCT AND          04370035
026700            PS-NO-PBS-OVERRIDE) OR                                04380035
026800            (SU047-AUDIT-ERROR-PCT = KRPRPM-FUNC-PCT AND          04390035
026900            PS-NO-PBS-OVERRIDE) OR                                04400035
027000            SU047-PACK-ERRORS > 0 OR                              04410035
027100            SU047-PO-STR-ERRORS = 'Y' OR                          04420040
      * 11/05/13 DW BEG                                                 04430040
      * RFID AUDITS FAIL WITH ANY ERRORS                                04440040
                  (SUT00015-PKGNG-TYP-CDE = 'RF' AND                    04450040
                   SU047-TICKET-ERRORS > 0)                             04460040
      * 11/05/13 DW END                                                 04470040
027200             MOVE SU047-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR       04480035
027300             PERFORM 2100-CLOSE-AUDIT                             04490035
027400             MOVE PC-F           TO SUT00015-AUD-STAT-CDE         04500035
027500             MOVE PC-F           TO SUT00015-CART-PRMPT-CDE       04510035
027600             SET  SU047-PO-AUD-REQ-FAIL  TO  TRUE                 04520035
027700             MOVE SU047-AUDIT-ERROR-PCT                           04530035
027800                                 TO SUT00015-AUD-ERR-PCT          04540035
027900             MOVE SU047-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR       04550035
028000             PERFORM 2200-UPDATE-SUT-PO-AUD-REQ                   04560035
028010             IF PS-AUTO-VE-YES                                    04570035
028100                PERFORM 4000-CREATE-TROUBLE                       04580035
028110             END-IF                                               04590035
028200         END-IF                                                   04600035
028300     END-IF.                                                      04610035
028400                                                                  04620035
028500                                                                  04630035
028600*---------------------------------------------------------------* 04640035
028700*  2100-CLOSE-SHIP-UNIT                                         * 04650035
028800*           1) UPDATE THE STOP DATE/TIME TO CURRENT VALUES      * 04660035
028900*           2) UPDATE THE STATUS TO COMPLETE                    * 04670035
029000*---------------------------------------------------------------* 04680035
029100 2100-CLOSE-AUDIT.                                                04690035
029200                                                                  04700035
029300*    UPDATE APPROPRIATE HOST VARIABLES                            04710035
029400                                                                  04720035
029500     MOVE 'CM'                       TO SUNAUD-AUD-STAT-CDE       04730035
029510                                        SU047-AUDIT-STATUS.       04740035
029600     SET SU047-AUDIT-COMPLETE TO TRUE.                            04750035
029700                                                                  04760035
029800     EXEC SQL                                                     04770035
029900         UPDATE TSUNAUD                                           04780035
030000            SET  AUD_STP_TMST    = CURRENT TIMESTAMP              04790035
030100               , AUD_STAT_CDE    = :SUNAUD-AUD-STAT-CDE           04800035
030200         WHERE                                                    04810035
030300                AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             04820035
030400     END-EXEC.                                                    04830035
030500                                                                  04840035
030600     EVALUATE TRUE                                                04850035
030700         WHEN SQLCODE = ZERO                                      04860035
030800             CONTINUE                                             04870035
030900                                                                  04880035
031000         WHEN SQLCODE = -904                                      04890035
031100         WHEN SQLCODE = -911                                      04900035
031200             SET  SU047-DATABASE-BUSY  TO TRUE                    04910035
031210             SET  PS-ERROR             TO TRUE                    04920035
031300             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          04930035
031400             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    04940035
031500             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     04950035
031600             MOVE DK-AUDIT-CNTL-NBR    TO PV-DISP-AUDIT-CNTL-NBR  04960035
031700             MOVE SQLCODE              TO PV-DISP-SQLCODE         04970035
031800             STRING   ' SUKCS763-2100-'                           04980035
031900                      ' CALLED BY-'                               04990035
032000                      SU047-CALLING-PROGRAM                       05000035
032100                      ' PO='                                      05010035
032200                      PV-DISP-PO-NBR '-'                          05020035
032300                      PV-DISP-RCVR-SEQ-NBR '-'                    05030035
032400                      PV-DISP-PO-LINE-NBR                         05040035
032500                      ' AUDIT='                                   05050035
032600                      PV-DISP-AUDIT-CNTL-NBR                      05060035
032700                      ' SQLCODE='                                 05070035
032800                      PV-DISP-SQLCODE                             05080035
032900                      DELIMITED BY SIZE                           05090035
033000                                      INTO SU047-CRA-RET-MSG      05100035
033100             MOVE SQLCODE               TO SU047-SQLCODE          05110035
033200             MOVE '2100-'               TO SU047-CRA-REQ-ID       05120035
033300             PERFORM 9998-RETURN                                  05130035
033400                                                                  05140035
033500         WHEN SQLWARN0 NOT = SPACES                               05150035
033600         WHEN SQLCODE < ZERO                                      05160035
033700         WHEN SQLCODE > ZERO                                      05170035
033800             SET  SU047-INVALID-SQL    TO TRUE                    05180035
033900             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          05190035
034000             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    05200035
034100             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     05210035
034200             MOVE DK-AUDIT-CNTL-NBR    TO PV-DISP-AUDIT-CNTL-NBR  05220035
034300             MOVE SQLCODE              TO PV-DISP-SQLCODE         05230035
034400             STRING   ' SUKCS763-2100-'                           05240035
034500                      ' CALLED BY-'                               05250035
034600                      SU047-CALLING-PROGRAM                       05260035
034700                      ' PO='                                      05270035
034800                      PV-DISP-PO-NBR '-'                          05280035
034900                      PV-DISP-RCVR-SEQ-NBR '-'                    05290035
035000                      PV-DISP-PO-LINE-NBR                         05300035
035100                      ' AUDIT='                                   05310035
035200                      PV-DISP-AUDIT-CNTL-NBR                      05320035
035300                      ' SQLCODE='                                 05330035
035400                      PV-DISP-SQLCODE                             05340035
035500                      DELIMITED BY SIZE                           05350035
035600                                      INTO SU047-CRA-RET-MSG      05360035
035700             MOVE SQLCODE               TO SU047-SQLCODE          05370035
035800             MOVE '2100-'               TO SU047-CRA-REQ-ID       05380035
035900             PERFORM 9998-RETURN                                  05390035
036000                                                                  05400035
036100     END-EVALUATE.                                                05410035
036200                                                                  05420035
036300*---------------------------------------------------------------* 05430035
036400*  2150-CLOSE-SHIP-UNIT                                         * 05440035
036500*           1) UPDATE THE STOP DATE/TIME TO CURRENT VALUES      * 05450035
036600*           2) UPDATE THE START DATE/TIME TO CURRENT VALUES     * 05460035
036700*           3) UPDATE THE STATUS TO COMPLETE                    * 05470035
036800*---------------------------------------------------------------* 05480035
036900 2150-CLOSE-AUDIT.                                                05490035
037000                                                                  05500035
037100*    UPDATE APPROPRIATE HOST VARIABLES                            05510035
037200     MOVE 'CM'                       TO SUNAUD-AUD-STAT-CDE       05520035
037210                                        SU047-AUDIT-STATUS.       05530035
037300     SET SU047-AUDIT-COMPLETE TO TRUE.                            05540035
037400                                                                  05550035
037500     EXEC SQL                                                     05560035
037600         UPDATE TSUNAUD                                           05570035
037700            SET  AUD_STRT_TMST   = CURRENT TIMESTAMP              05580035
037800               , AUD_STP_TMST    = CURRENT TIMESTAMP              05590035
037900               , AUD_STAT_CDE    = :SUNAUD-AUD-STAT-CDE           05600035
038000         WHERE                                                    05610035
038100                AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             05620035
038200     END-EXEC.                                                    05630035
038300                                                                  05640035
038400     EVALUATE TRUE                                                05650035
038500         WHEN SQLCODE = ZERO                                      05660035
038600             CONTINUE                                             05670035
038700                                                                  05680035
038800         WHEN SQLCODE = -904                                      05690035
038900         WHEN SQLCODE = -911                                      05700035
039000             SET  SU047-DATABASE-BUSY  TO TRUE                    05710035
039010             SET  PS-ERROR             TO TRUE                    05720035
039100             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          05730035
039200             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    05740035
039300             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     05750035
039400             MOVE DK-AUDIT-CNTL-NBR    TO PV-DISP-AUDIT-CNTL-NBR  05760035
039500             MOVE SQLCODE              TO PV-DISP-SQLCODE         05770035
039600             STRING   ' SUKCS763-2150-'                           05780035
039700                      ' CALLED BY-'                               05790035
039800                      SU047-CALLING-PROGRAM                       05800035
039900                      ' PO='                                      05810035
040000                      PV-DISP-PO-NBR '-'                          05820035
040100                      PV-DISP-RCVR-SEQ-NBR '-'                    05830035
040200                      PV-DISP-PO-LINE-NBR                         05840035
040300                      ' AUDIT='                                   05850035
040400                      PV-DISP-AUDIT-CNTL-NBR                      05860035
040500                      ' SQLCODE='                                 05870035
040600                      PV-DISP-SQLCODE                             05880035
040700                      DELIMITED BY SIZE                           05890035
040800                                      INTO SU047-CRA-RET-MSG      05900035
040900             MOVE SQLCODE               TO SU047-SQLCODE          05910035
041000             MOVE '2150-'               TO SU047-CRA-REQ-ID       05920035
041100             PERFORM 9998-RETURN                                  05930035
041200                                                                  05940035
041300         WHEN SQLWARN0 NOT = SPACES                               05950035
041400         WHEN SQLCODE < ZERO                                      05960035
041500         WHEN SQLCODE > ZERO                                      05970035
041600             SET  SU047-INVALID-SQL    TO TRUE                    05980035
041700             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          05990035
041800             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    06000035
041900             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     06010035
042000             MOVE DK-AUDIT-CNTL-NBR    TO PV-DISP-AUDIT-CNTL-NBR  06020035
042100             MOVE SQLCODE              TO PV-DISP-SQLCODE         06030035
042200             STRING   ' SUKCS763-2150-'                           06040035
042300                      ' CALLED BY-'                               06050035
042400                      SU047-CALLING-PROGRAM                       06060035
042500                      ' PO='                                      06070035
042600                      PV-DISP-PO-NBR '-'                          06080035
042700                      PV-DISP-RCVR-SEQ-NBR '-'                    06090035
042800                      PV-DISP-PO-LINE-NBR                         06100035
042900                      ' AUDIT='                                   06110035
043000                      PV-DISP-AUDIT-CNTL-NBR                      06120035
043100                      ' SQLCODE='                                 06130035
043200                      PV-DISP-SQLCODE                             06140035
043300                      DELIMITED BY SIZE                           06150035
043400                                      INTO SU047-CRA-RET-MSG      06160035
043500             MOVE SQLCODE               TO SU047-SQLCODE          06170035
043600             MOVE '2150-'               TO SU047-CRA-REQ-ID       06180035
043700             PERFORM 9998-RETURN                                  06190035
043800                                                                  06200035
043900     END-EVALUATE.                                                06210035
044000                                                                  06220035
044100                                                                  06230035
044200*---------------------------------------------------------------* 06240035
044300*                                                               * 06250035
044400*---------------------------------------------------------------* 06260035
044500 2200-UPDATE-SUT-PO-AUD-REQ.                                      06270035
044600                                                                  06280035
044700     EXEC SQL                                                     06290035
044800          UPDATE SUT_PO_AUD_REQ                                   06300035
044900          SET    CART_PRMPT_CDE = :SUT00015-CART-PRMPT-CDE        06310035
045000            ,    AUD_STAT_CDE   = :SUT00015-AUD-STAT-CDE          06320035
045100            ,    AUD_ERR_PCT    = :SUT00015-AUD-ERR-PCT           06330035
045200          WHERE  AUD_CNTL_NBR   = :DK-AUDIT-CNTL-NBR              06340035
045300     END-EXEC.                                                    06350035
045400                                                                  06360035
045500     EVALUATE TRUE                                                06370035
045600         WHEN SQLCODE = ZERO                                      06380035
045700             CONTINUE                                             06390035
045800                                                                  06400035
045900         WHEN SQLCODE = -904                                      06410035
046000         WHEN SQLCODE = -911                                      06420035
046100             SET  SU047-DATABASE-BUSY  TO TRUE                    06430035
046110             SET  PS-ERROR             TO TRUE                    06440035
046200             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          06450035
046300             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    06460035
046400             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     06470035
046500             MOVE DK-AUDIT-CNTL-NBR    TO PV-DISP-AUDIT-CNTL-NBR  06480035
046600             MOVE SQLCODE              TO PV-DISP-SQLCODE         06490035
046700             STRING   ' SUKCS763-2200-'                           06500035
046800                      ' CALLED BY-'                               06510035
046900                      SU047-CALLING-PROGRAM                       06520035
047000                      ' PO='                                      06530035
047100                      PV-DISP-PO-NBR '-'                          06540035
047200                      PV-DISP-RCVR-SEQ-NBR '-'                    06550035
047300                      PV-DISP-PO-LINE-NBR                         06560035
047400                      ' AUDIT='                                   06570035
047500                      PV-DISP-AUDIT-CNTL-NBR                      06580035
047600                      ' SQLCODE='                                 06590035
047700                      PV-DISP-SQLCODE                             06600035
047800                      DELIMITED BY SIZE                           06610035
047900                                      INTO SU047-CRA-RET-MSG      06620035
048000             MOVE SQLCODE               TO SU047-SQLCODE          06630035
048100             MOVE '2200-'               TO SU047-CRA-REQ-ID       06640035
048200             PERFORM 9998-RETURN                                  06650035
048300                                                                  06660035
048400         WHEN SQLWARN0 NOT = SPACES                               06670035
048500         WHEN SQLCODE < ZERO                                      06680035
048600         WHEN SQLCODE > ZERO                                      06690035
048700             SET  SU047-INVALID-SQL    TO TRUE                    06700035
048710             SET  PS-ERROR             TO TRUE                    06710035
048800             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          06720035
048900             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    06730035
049000             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     06740035
049100             MOVE DK-AUDIT-CNTL-NBR    TO PV-DISP-AUDIT-CNTL-NBR  06750035
049200             MOVE SQLCODE              TO PV-DISP-SQLCODE         06760035
049300             STRING   ' SUKCS763-2200-'                           06770035
049400                      ' CALLED BY-'                               06780035
049500                      SU047-CALLING-PROGRAM                       06790035
049600                      ' PO='                                      06800035
049700                      PV-DISP-PO-NBR '-'                          06810035
049800                      PV-DISP-RCVR-SEQ-NBR '-'                    06820035
049900                      PV-DISP-PO-LINE-NBR                         06830035
050000                      ' AUDIT='                                   06840035
050100                      PV-DISP-AUDIT-CNTL-NBR                      06850035
050200                      ' SQLCODE='                                 06860035
050300                      PV-DISP-SQLCODE                             06870035
050400                      DELIMITED BY SIZE                           06880035
050500                                      INTO SU047-CRA-RET-MSG      06890035
050600             MOVE SQLCODE               TO SU047-SQLCODE          06900035
050700             MOVE '2200-'               TO SU047-CRA-REQ-ID       06910035
050800             PERFORM 9998-RETURN                                  06920035
050900                                                                  06930035
051000     END-EVALUATE.                                                06940035
051100                                                                  06950035
051200                                                                  06960035
051300*---------------------------------------------------------------* 06970035
051400*                                                               * 06980035
051500*---------------------------------------------------------------* 06990035
051600 2300-UPDATE-OTHER-AUDITS.                                        07000035
051700     PERFORM 2400-SELECT-AUDIT-NBR.                               07010035
051800     MOVE SUT00015-PO-NBR         TO DK-PO-NBR.                   07020035
051900     MOVE SUT00015-PO-LNE-NBR     TO DK-PO-LINE-NBR.              07030035
052000     MOVE SUT00015-PO-PREPK-ID    TO DK-PREPK-ID.                 07040035
052100     PERFORM 2450-SELECT-FAILED.                                  07050035
052200     IF PS-FAILED-AUDITS-FOUND                                    07060035
052300         CONTINUE                                                 07070035
052400     ELSE                                                         07080035
052500         PERFORM 2500-SELECT-PASSED                               07090035
052600         IF SUT00017-CKD-DC-QTY > PV-PASSED-COUNT                 07100035
052700             MOVE SUT00015-OPER-UNT-ID TO DK-OPER-UNT-ID          07110035
052800             SET PS-NOT-EOC-DC-PROCESS TO TRUE                    07120035
052900             PERFORM 3600-OPEN-IN-PROCESS-CURSOR                  07130035
053000             PERFORM 3700-FETCH-IN-PROCESS-CURSOR                 07140035
053100                 UNTIL PS-EOC-DC-PROCESS                          07150035
053200             PERFORM 3800-CLOSE-IN-PROCESS-CURSOR                 07160035
053300         ELSE                                                     07170035
053400             SET PS-NOT-EOC-IN-PROCESS TO TRUE                    07180035
053500             PERFORM 2600-OPEN-IN-PROCESS-CURSOR                  07190035
053600             PERFORM 2700-FETCH-IN-PROCESS-CURSOR                 07200035
053700                 UNTIL PS-EOC-IN-PROCESS                          07210035
053800             PERFORM 2800-CLOSE-IN-PROCESS-CURSOR                 07220035
053900         END-IF                                                   07230035
054000     END-IF.                                                      07240035
054100                                                                  07250035
054200                                                                  07260035
054300*---------------------------------------------------------------* 07270035
054400*                                                               * 07280035
054500*---------------------------------------------------------------* 07290035
054600 2400-SELECT-AUDIT-NBR.                                           07300035
054700                                                                  07310035
054800     MOVE SU047-AUDIT-CNTL-NBR    TO DK-AUDIT-CNTL-NBR.           07320035
054900                                                                  07330035
055000     EXEC SQL                                                     07340035
055100       SELECT PO_NBR                                              07350035
055200           ,  PO_LNE_NBR                                          07360035
055300           ,  PO_PREPK_ID                                         07370035
055400           ,  OPER_UNT_ID                                         07380035
055500           ,  CART_QTY                                            07390035
055600           ,  UNT_QTY                                             07400035
055700           ,  AUD_CART_QTY                                        07410035
055800           ,  AUD_UNT_QTY                                         07420035
055900           ,  AUD_STAT_CDE                                        07430035
056000           ,  CART_PRMPT_CDE                                      07440035
056100           ,  A.PKGNG_TYP_CDE                                     07450035
056200           ,  DAYS(CRE_TMST) - (B.CK_AFT_DAY_QTY + 1)             07460035
056300           ,  B.CKD_DC_QTY                                        07470035
056400       INTO   :SUT00015-PO-NBR                                    07480035
056500           ,  :SUT00015-PO-LNE-NBR                                07490035
056600           ,  :SUT00015-PO-PREPK-ID                               07500035
056700           ,  :SUT00015-OPER-UNT-ID                               07510035
056800           ,  :SUT00015-CART-QTY                                  07520035
056900           ,  :SUT00015-UNT-QTY                                   07530035
057000           ,  :SUT00015-AUD-CART-QTY                              07540035
057100           ,  :SUT00015-AUD-UNT-QTY                               07550035
057200           ,  :SUT00015-AUD-STAT-CDE                              07560035
057300           ,  :SUT00015-CART-PRMPT-CDE                            07570035
057400           ,  :SUT00015-PKGNG-TYP-CDE                             07580035
057500           ,  :PV-LIMIT-DAYS                                      07590035
057600           ,  :SUT00017-CKD-DC-QTY                                07600035
057700       FROM   SUT_PO_AUD_REQ  A                                   07610035
057800           ,  SUT_PO_AUD_PARM B                                   07620035
057900       WHERE  A.AUD_CNTL_NBR  = :DK-AUDIT-CNTL-NBR                07630035
058000         AND  A.VND_RNKG_CDE  = B.VND_RNKG_CDE                    07640035
058100         AND  A.PKGNG_TYP_CDE = B.PKGNG_TYP_CDE                   07650035
058200         AND  A.EFF_BEG_TMST  = B.EFF_BEG_TMST                    07660035
058300     END-EXEC.                                                    07670035
058400                                                                  07680035
058500     EVALUATE TRUE                                                07690035
058600         WHEN SQLCODE = ZERO                                      07700035
058700             SET PS-VALID-AUDIT-NBR TO TRUE                       07710035
058800                                                                  07720035
058900         WHEN SQLCODE = +100                                      07730035
059000             SET PS-INVALID-AUDIT-NBR TO TRUE                     07740035
059100                                                                  07750035
059200         WHEN SQLCODE = -904                                      07760035
059300         WHEN SQLCODE = -911                                      07770035
059400             SET  SU047-DATABASE-BUSY  TO TRUE                    07780035
059410             SET  PS-ERROR             TO TRUE                    07790035
059500             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          07800035
059600             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    07810035
059700             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     07820035
059800             MOVE DK-AUDIT-CNTL-NBR    TO PV-DISP-AUDIT-CNTL-NBR  07830035
059900             MOVE SQLCODE              TO PV-DISP-SQLCODE         07840035
060000             STRING   ' SUKCS763-2400-'                           07850035
060100                      ' CALLED BY-'                               07860035
060200                      SU047-CALLING-PROGRAM                       07870035
060300                      ' PO='                                      07880035
060400                      PV-DISP-PO-NBR '-'                          07890035
060500                      PV-DISP-RCVR-SEQ-NBR '-'                    07900035
060600                      PV-DISP-PO-LINE-NBR                         07910035
060700                      ' AUDIT='                                   07920035
060800                      PV-DISP-AUDIT-CNTL-NBR                      07930035
060900                      ' SQLCODE='                                 07940035
061000                      PV-DISP-SQLCODE                             07950035
061100                      DELIMITED BY SIZE                           07960035
061200                                      INTO SU047-CRA-RET-MSG      07970035
061300             MOVE SQLCODE               TO SU047-SQLCODE          07980035
061400             MOVE '2400-'               TO SU047-CRA-REQ-ID       07990035
061500             PERFORM 9998-RETURN                                  08000035
061600                                                                  08010035
061700         WHEN SQLWARN0 NOT = SPACES                               08020035
061800             SET  SU047-INVALID-SQL    TO TRUE                    08030035
061900             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          08040035
062000             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    08050035
062100             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     08060035
062200             MOVE DK-AUDIT-CNTL-NBR    TO PV-DISP-AUDIT-CNTL-NBR  08070035
062300             MOVE SQLCODE              TO PV-DISP-SQLCODE         08080035
062400             STRING   ' SUKCS763-2400-'                           08090035
062500                      ' CALLED BY-'                               08100035
062600                      SU047-CALLING-PROGRAM                       08110035
062700                      ' PO='                                      08120035
062800                      PV-DISP-PO-NBR '-'                          08130035
062900                      PV-DISP-RCVR-SEQ-NBR '-'                    08140035
063000                      PV-DISP-PO-LINE-NBR                         08150035
063100                      ' AUDIT='                                   08160035
063200                      PV-DISP-AUDIT-CNTL-NBR                      08170035
063300                      ' SQLCODE='                                 08180035
063400                      PV-DISP-SQLCODE                             08190035
063500                      DELIMITED BY SIZE                           08200035
063600                                      INTO SU047-CRA-RET-MSG      08210035
063700             MOVE SQLCODE               TO SU047-SQLCODE          08220035
063800             MOVE '2400-'               TO SU047-CRA-REQ-ID       08230035
063900             PERFORM 9998-RETURN                                  08240035
064000                                                                  08250035
064100     END-EVALUATE.                                                08260035
064200                                                                  08270035
064300                                                                  08280035
064400*---------------------------------------------------------------* 08290035
064500*                                                               * 08300035
064600*---------------------------------------------------------------* 08310035
064700 2450-SELECT-FAILED.                                              08320035
064800                                                                  08330035
064900     EXEC SQL                                                     08340035
065000          SELECT AUD_CNTL_NBR                                     08350035
065100              ,  UNT_QTY                                          08360035
065200          INTO   :SUT00015-AUD-CNTL-NBR                           08370035
065300              ,  :SUT00015-UNT-QTY                                08380035
065400          FROM   SUT_PO_AUD_REQ                                   08390035
065500          WHERE  PO_NBR         = :DK-PO-NBR                      08400035
065600            AND  PO_LNE_NBR     = :DK-PO-LINE-NBR                 08410035
065700            AND  PO_PREPK_ID    = :DK-PREPK-ID                    08420035
065800            AND  AUD_STAT_CDE   = :PC-F                           08430035
065900            AND  DAYS(CRE_TMST) > :PV-LIMIT-DAYS                  08440035
066000     END-EXEC.                                                    08450035
066100                                                                  08460035
066200     EVALUATE TRUE                                                08470035
066300         WHEN SQLCODE = ZERO                                      08480035
066400         WHEN SQLCODE = -811                                      08490035
066500             SET PS-FAILED-AUDITS-FOUND TO TRUE                   08500035
066600                                                                  08510035
066700         WHEN SQLCODE = +100                                      08520035
066800             SET PS-NO-FAILED-AUDITS-FOUND TO TRUE                08530035
066900                                                                  08540035
067000         WHEN SQLCODE = -904                                      08550035
067100         WHEN SQLCODE = -911                                      08560035
067200             SET  SU047-DATABASE-BUSY  TO TRUE                    08570035
067210             SET  PS-ERROR             TO TRUE                    08580035
067300             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          08590035
067400             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    08600035
067500             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     08610035
067600             MOVE DK-AUDIT-CNTL-NBR    TO PV-DISP-AUDIT-CNTL-NBR  08620035
067700             MOVE SQLCODE              TO PV-DISP-SQLCODE         08630035
067800             STRING   ' SUKCS763-2450-'                           08640035
067900                      ' CALLED BY-'                               08650035
068000                      SU047-CALLING-PROGRAM                       08660035
068100                      ' PO='                                      08670035
068200                      PV-DISP-PO-NBR '-'                          08680035
068300                      PV-DISP-RCVR-SEQ-NBR '-'                    08690035
068400                      PV-DISP-PO-LINE-NBR                         08700035
068500                      ' AUDIT='                                   08710035
068600                      PV-DISP-AUDIT-CNTL-NBR                      08720035
068700                      ' SQLCODE='                                 08730035
068800                      PV-DISP-SQLCODE                             08740035
068900                      DELIMITED BY SIZE                           08750035
069000                                      INTO SU047-CRA-RET-MSG      08760035
069100             MOVE SQLCODE               TO SU047-SQLCODE          08770035
069200             MOVE '2450-'               TO SU047-CRA-REQ-ID       08780035
069300             PERFORM 9998-RETURN                                  08790035
069400                                                                  08800035
069500         WHEN SQLWARN0 NOT = SPACES                               08810035
069600         WHEN SQLCODE NOT EQUAL ZERO                              08820035
069700             SET  SU047-INVALID-SQL    TO TRUE                    08830035
069800             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          08840035
069900             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    08850035
070000             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     08860035
070100             MOVE DK-AUDIT-CNTL-NBR    TO PV-DISP-AUDIT-CNTL-NBR  08870035
070200             MOVE SQLCODE              TO PV-DISP-SQLCODE         08880035
070300             STRING   ' SUKCS763-2450-'                           08890035
070400                      ' CALLED BY-'                               08900035
070500                      SU047-CALLING-PROGRAM                       08910035
070600                      ' PO='                                      08920035
070700                      PV-DISP-PO-NBR '-'                          08930035
070800                      PV-DISP-RCVR-SEQ-NBR '-'                    08940035
070900                      PV-DISP-PO-LINE-NBR                         08950035
071000                      ' AUDIT='                                   08960035
071100                      PV-DISP-AUDIT-CNTL-NBR                      08970035
071200                      ' SQLCODE='                                 08980035
071300                      PV-DISP-SQLCODE                             08990035
071400                      DELIMITED BY SIZE                           09000035
071500                                      INTO SU047-CRA-RET-MSG      09010035
071600             MOVE SQLCODE               TO SU047-SQLCODE          09020035
071700             MOVE '2450-'               TO SU047-CRA-REQ-ID       09030035
071800             PERFORM 9998-RETURN                                  09040035
071900                                                                  09050035
072000     END-EVALUATE.                                                09060035
072100                                                                  09070035
072200                                                                  09080035
072300*---------------------------------------------------------------* 09090035
072400*                                                               * 09100035
072500*---------------------------------------------------------------* 09110035
072600 2500-SELECT-PASSED.                                              09120035
072700                                                                  09130035
072800     MOVE 0         TO PV-PASSED-COUNT.                           09140035
072900     EXEC SQL                                                     09150035
073000          SELECT COUNT(DISTINCT OPER_UNT_ID)                      09160035
073100          INTO   :PV-PASSED-COUNT                                 09170035
073200          FROM   SUT_PO_AUD_REQ                                   09180035
073300          WHERE  PO_NBR         = :DK-PO-NBR                      09190035
073400            AND  PO_LNE_NBR     = :DK-PO-LINE-NBR                 09200035
073500            AND  PO_PREPK_ID    = :DK-PREPK-ID                    09210035
073600            AND  AUD_STAT_CDE   = :PC-P                           09220035
073700            AND  DAYS(CRE_TMST) > :PV-LIMIT-DAYS                  09230035
073800     END-EXEC.                                                    09240035
073900                                                                  09250035
074000     EVALUATE TRUE                                                09260035
074100         WHEN SQLCODE = ZERO                                      09270035
074200             CONTINUE                                             09280035
074300                                                                  09290035
074400         WHEN SQLCODE = -904                                      09300035
074500         WHEN SQLCODE = -911                                      09310035
074600             SET  SU047-DATABASE-BUSY  TO TRUE                    09320035
074610             SET  PS-ERROR             TO TRUE                    09330035
074700             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          09340035
074800             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    09350035
074900             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     09360035
075000             MOVE DK-AUDIT-CNTL-NBR    TO PV-DISP-AUDIT-CNTL-NBR  09370035
075100             MOVE SQLCODE              TO PV-DISP-SQLCODE         09380035
075200             STRING   ' SUKCS763-2500-'                           09390035
075300                      ' CALLED BY-'                               09400035
075400                      SU047-CALLING-PROGRAM                       09410035
075500                      ' PO='                                      09420035
075600                      PV-DISP-PO-NBR '-'                          09430035
075700                      PV-DISP-RCVR-SEQ-NBR '-'                    09440035
075800                      PV-DISP-PO-LINE-NBR                         09450035
075900                      ' AUDIT='                                   09460035
076000                      PV-DISP-AUDIT-CNTL-NBR                      09470035
076100                      ' SQLCODE='                                 09480035
076200                      PV-DISP-SQLCODE                             09490035
076300                      DELIMITED BY SIZE                           09500035
076400                                      INTO SU047-CRA-RET-MSG      09510035
076500             MOVE SQLCODE               TO SU047-SQLCODE          09520035
076600             MOVE '2500-'               TO SU047-CRA-REQ-ID       09530035
076700             PERFORM 9998-RETURN                                  09540035
076800                                                                  09550035
076900         WHEN SQLWARN0 NOT = SPACES                               09560035
077000         WHEN SQLCODE NOT EQUAL ZERO                              09570035
077100             SET  SU047-INVALID-SQL    TO TRUE                    09580035
077200             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          09590035
077300             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    09600035
077400             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     09610035
077500             MOVE DK-AUDIT-CNTL-NBR    TO PV-DISP-AUDIT-CNTL-NBR  09620035
077600             MOVE SQLCODE              TO PV-DISP-SQLCODE         09630035
077700             STRING   ' SUKCS763-2500-'                           09640035
077800                      ' CALLED BY-'                               09650035
077900                      SU047-CALLING-PROGRAM                       09660035
078000                      ' PO='                                      09670035
078100                      PV-DISP-PO-NBR '-'                          09680035
078200                      PV-DISP-RCVR-SEQ-NBR '-'                    09690035
078300                      PV-DISP-PO-LINE-NBR                         09700035
078400                      ' AUDIT='                                   09710035
078500                      PV-DISP-AUDIT-CNTL-NBR                      09720035
078600                      ' SQLCODE='                                 09730035
078700                      PV-DISP-SQLCODE                             09740035
078800                      DELIMITED BY SIZE                           09750035
078900                                      INTO SU047-CRA-RET-MSG      09760035
079000             MOVE SQLCODE               TO SU047-SQLCODE          09770035
079100             MOVE '2500-'               TO SU047-CRA-REQ-ID       09780035
079200             PERFORM 9998-RETURN                                  09790035
079300                                                                  09800035
079400     END-EVALUATE.                                                09810035
079500                                                                  09820035
079600                                                                  09830035
079700*---------------------------------------------------------------* 09840035
079800*                                                               * 09850035
079900*---------------------------------------------------------------* 09860035
080000 2600-OPEN-IN-PROCESS-CURSOR.                                     09870035
080100                                                                  09880035
080200     EXEC SQL                                                     09890035
080300         OPEN IN_PROCESS_CURSOR                                   09900035
080400     END-EXEC.                                                    09910035
080500                                                                  09920035
080600     EVALUATE TRUE                                                09930035
080700         WHEN SQLCODE = ZERO                                      09940035
080800             SET PS-NOT-EOC-IN-PROCESS  TO TRUE                   09950035
080900                                                                  09960035
081000         WHEN SQLCODE = -904                                      09970035
081100         WHEN SQLCODE = -911                                      09980035
081200             SET  SU047-DATABASE-BUSY  TO TRUE                    09990035
081210             SET  PS-ERROR             TO TRUE                    10000035
081300             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          10010035
081400             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    10020035
081500             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     10030035
081600             MOVE DK-AUDIT-CNTL-NBR    TO PV-DISP-AUDIT-CNTL-NBR  10040035
081700             MOVE SQLCODE              TO PV-DISP-SQLCODE         10050035
081800             STRING   ' SUKCS763-2600-'                           10060035
081900                      ' CALLED BY-'                               10070035
082000                      SU047-CALLING-PROGRAM                       10080035
082100                      ' PO='                                      10090035
082200                      PV-DISP-PO-NBR '-'                          10100035
082300                      PV-DISP-RCVR-SEQ-NBR '-'                    10110035
082400                      PV-DISP-PO-LINE-NBR                         10120035
082500                      ' AUDIT='                                   10130035
082600                      PV-DISP-AUDIT-CNTL-NBR                      10140035
082700                      ' SQLCODE='                                 10150035
082800                      PV-DISP-SQLCODE                             10160035
082900                      DELIMITED BY SIZE                           10170035
083000                                      INTO SU047-CRA-RET-MSG      10180035
083100             MOVE SQLCODE               TO SU047-SQLCODE          10190035
083200             MOVE '2600-'               TO SU047-CRA-REQ-ID       10200035
083300             PERFORM 9998-RETURN                                  10210035
083400                                                                  10220035
083500         WHEN SQLWARN0 NOT = SPACES                               10230035
083600         WHEN SQLCODE < ZERO                                      10240035
083700         WHEN SQLCODE > ZERO                                      10250035
083800             SET  SU047-INVALID-SQL    TO TRUE                    10260035
083810             SET  PS-ERROR             TO TRUE                    10270035
083900             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          10280035
084000             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    10290035
084100             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     10300035
084200             MOVE DK-AUDIT-CNTL-NBR    TO PV-DISP-AUDIT-CNTL-NBR  10310035
084300             MOVE SQLCODE              TO PV-DISP-SQLCODE         10320035
084400             STRING   ' SUKCS763-2600-'                           10330035
084500                      ' CALLED BY-'                               10340035
084600                      SU047-CALLING-PROGRAM                       10350035
084700                      ' PO='                                      10360035
084800                      PV-DISP-PO-NBR '-'                          10370035
084900                      PV-DISP-RCVR-SEQ-NBR '-'                    10380035
085000                      PV-DISP-PO-LINE-NBR                         10390035
085100                      ' AUDIT='                                   10400035
085200                      PV-DISP-AUDIT-CNTL-NBR                      10410035
085300                      ' SQLCODE='                                 10420035
085400                      PV-DISP-SQLCODE                             10430035
085500                      DELIMITED BY SIZE                           10440035
085600                                      INTO SU047-CRA-RET-MSG      10450035
085700             MOVE SQLCODE               TO SU047-SQLCODE          10460035
085800             MOVE '2600-'               TO SU047-CRA-REQ-ID       10470035
085900             PERFORM 9998-RETURN                                  10480035
086000                                                                  10490035
086100     END-EVALUATE.                                                10500035
086200                                                                  10510035
086300                                                                  10520035
086400*---------------------------------------------------------------* 10530035
086500*                                                               * 10540035
086600*---------------------------------------------------------------* 10550035
086700 2700-FETCH-IN-PROCESS-CURSOR.                                    10560035
086800                                                                  10570035
086900     EXEC SQL                                                     10580035
087000         FETCH IN_PROCESS_CURSOR                                  10590035
087100         INTO  :SUT00015-AUD-CNTL-NBR                             10600035
087200     END-EXEC.                                                    10610035
087300                                                                  10620035
087400     EVALUATE TRUE                                                10630035
087500         WHEN SQLCODE = ZERO                                      10640035
087600             MOVE PC-N           TO SUT00015-AUD-STAT-CDE         10650035
087700             MOVE PC-D           TO SUT00015-CART-PRMPT-CDE       10660035
087800             MOVE SUT00015-AUD-CNTL-NBR  TO DK-AUDIT-CNTL-NBR     10670035
087900             MOVE +0             TO SUT00015-AUD-ERR-PCT          10680035
088000             PERFORM 2200-UPDATE-SUT-PO-AUD-REQ                   10690035
088100             PERFORM 2900-SELECT-TSUNAUD                          10700035
088200             IF SUNAUD-AUD-STRT-TMST                              10710035
088300                       NOT EQUAL PC-DEFAULT-TIMESTAMP             10720035
088400                 PERFORM 2100-CLOSE-AUDIT                         10730035
088500             ELSE                                                 10740035
088600                 PERFORM 2150-CLOSE-AUDIT                         10750035
088700             END-IF                                               10760035
088800                                                                  10770035
088900         WHEN SQLCODE = +100                                      10780035
089000             SET PS-EOC-IN-PROCESS   TO TRUE                      10790035
089100                                                                  10800035
089200         WHEN SQLCODE = -904                                      10810035
089300         WHEN SQLCODE = -911                                      10820035
089400             SET  SU047-DATABASE-BUSY  TO TRUE                    10830035
089410             SET  PS-ERROR             TO TRUE                    10840035
089500             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          10850035
089600             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    10860035
089700             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     10870035
089800             MOVE DK-AUDIT-CNTL-NBR    TO PV-DISP-AUDIT-CNTL-NBR  10880035
089900             MOVE SQLCODE              TO PV-DISP-SQLCODE         10890035
090000             STRING   ' SUKCS763-2700-'                           10900035
090100                      ' CALLED BY-'                               10910035
090200                      SU047-CALLING-PROGRAM                       10920035
090300                      ' PO='                                      10930035
090400                      PV-DISP-PO-NBR '-'                          10940035
090500                      PV-DISP-RCVR-SEQ-NBR '-'                    10950035
090600                      PV-DISP-PO-LINE-NBR                         10960035
090700                      ' AUDIT='                                   10970035
090800                      PV-DISP-AUDIT-CNTL-NBR                      10980035
090900                      ' SQLCODE='                                 10990035
091000                      PV-DISP-SQLCODE                             11000035
091100                      DELIMITED BY SIZE                           11010035
091200                                      INTO SU047-CRA-RET-MSG      11020035
091300             MOVE SQLCODE               TO SU047-SQLCODE          11030035
091400             MOVE '2700-'               TO SU047-CRA-REQ-ID       11040035
091500             PERFORM 9998-RETURN                                  11050035
091600                                                                  11060035
091700         WHEN SQLWARN0 NOT = SPACES                               11070035
091800         WHEN SQLCODE < ZERO                                      11080035
091900         WHEN SQLCODE > ZERO                                      11090035
092000             SET  SU047-INVALID-SQL    TO TRUE                    11100035
092010             SET  PS-ERROR             TO TRUE                    11110035
092100             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          11120035
092200             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    11130035
092300             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     11140035
092400             MOVE DK-AUDIT-CNTL-NBR    TO PV-DISP-AUDIT-CNTL-NBR  11150035
092500             MOVE SQLCODE              TO PV-DISP-SQLCODE         11160035
092600             STRING   ' SUKCS763-2700-'                           11170035
092700                      ' CALLED BY-'                               11180035
092800                      SU047-CALLING-PROGRAM                       11190035
092900                      ' PO='                                      11200035
093000                      PV-DISP-PO-NBR '-'                          11210035
093100                      PV-DISP-RCVR-SEQ-NBR '-'                    11220035
093200                      PV-DISP-PO-LINE-NBR                         11230035
093300                      ' AUDIT='                                   11240035
093400                      PV-DISP-AUDIT-CNTL-NBR                      11250035
093500                      ' SQLCODE='                                 11260035
093600                      PV-DISP-SQLCODE                             11270035
093700                      DELIMITED BY SIZE                           11280035
093800                                      INTO SU047-CRA-RET-MSG      11290035
093900             MOVE SQLCODE               TO SU047-SQLCODE          11300035
094000             MOVE '2700-'               TO SU047-CRA-REQ-ID       11310035
094100             PERFORM 9998-RETURN                                  11320035
094200                                                                  11330035
094300     END-EVALUATE.                                                11340035
094400                                                                  11350035
094500                                                                  11360035
094600*---------------------------------------------------------------* 11370035
094700*                                                               * 11380035
094800*---------------------------------------------------------------* 11390035
094900 2800-CLOSE-IN-PROCESS-CURSOR.                                    11400035
095000                                                                  11410035
095100     EXEC SQL                                                     11420035
095200         CLOSE IN_PROCESS_CURSOR                                  11430035
095300     END-EXEC.                                                    11440035
095400                                                                  11450035
095500     EVALUATE TRUE                                                11460035
095600         WHEN SQLCODE = ZERO                                      11470035
095700             CONTINUE                                             11480035
095800                                                                  11490035
095900         WHEN SQLCODE = -904                                      11500035
096000         WHEN SQLCODE = -911                                      11510035
096100             SET  SU047-DATABASE-BUSY  TO TRUE                    11520035
096110             SET  PS-ERROR             TO TRUE                    11530035
096200             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          11540035
096300             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    11550035
096400             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     11560035
096500             MOVE DK-AUDIT-CNTL-NBR    TO PV-DISP-AUDIT-CNTL-NBR  11570035
096600             MOVE SQLCODE              TO PV-DISP-SQLCODE         11580035
096700             STRING   ' SUKCS763-2800-'                           11590035
096800                      ' CALLED BY-'                               11600035
096900                      SU047-CALLING-PROGRAM                       11610035
097000                      ' PO='                                      11620035
097100                      PV-DISP-PO-NBR '-'                          11630035
097200                      PV-DISP-RCVR-SEQ-NBR '-'                    11640035
097300                      PV-DISP-PO-LINE-NBR                         11650035
097400                      ' AUDIT='                                   11660035
097500                      PV-DISP-AUDIT-CNTL-NBR                      11670035
097600                      ' SQLCODE='                                 11680035
097700                      PV-DISP-SQLCODE                             11690035
097800                      DELIMITED BY SIZE                           11700035
097900                                      INTO SU047-CRA-RET-MSG      11710035
098000             MOVE SQLCODE               TO SU047-SQLCODE          11720035
098100             MOVE '2800-'               TO SU047-CRA-REQ-ID       11730035
098200             PERFORM 9998-RETURN                                  11740035
098300                                                                  11750035
098400         WHEN SQLWARN0 NOT = SPACES                               11760035
098500         WHEN SQLCODE < ZERO                                      11770035
098600         WHEN SQLCODE > ZERO                                      11780035
098700             SET  SU047-INVALID-SQL    TO TRUE                    11790035
098710             SET  PS-ERROR             TO TRUE                    11800035
098800             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          11810035
098900             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    11820035
099000             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     11830035
099100             MOVE DK-AUDIT-CNTL-NBR    TO PV-DISP-AUDIT-CNTL-NBR  11840035
099200             MOVE SQLCODE              TO PV-DISP-SQLCODE         11850035
099300             STRING   ' SUKCS763-2800-'                           11860035
099400                      ' CALLED BY-'                               11870035
099500                      SU047-CALLING-PROGRAM                       11880035
099600                      ' PO='                                      11890035
099700                      PV-DISP-PO-NBR '-'                          11900035
099800                      PV-DISP-RCVR-SEQ-NBR '-'                    11910035
099900                      PV-DISP-PO-LINE-NBR                         11920035
100000                      ' AUDIT='                                   11930035
100100                      PV-DISP-AUDIT-CNTL-NBR                      11940035
100200                      ' SQLCODE='                                 11950035
100300                      PV-DISP-SQLCODE                             11960035
100400                      DELIMITED BY SIZE                           11970035
100500                                      INTO SU047-CRA-RET-MSG      11980035
100600             MOVE SQLCODE               TO SU047-SQLCODE          11990035
100700             MOVE '2800-'               TO SU047-CRA-REQ-ID       12000035
100800             PERFORM 9998-RETURN                                  12010035
100900                                                                  12020035
101000     END-EVALUATE.                                                12030035
101100                                                                  12040035
101200                                                                  12050035
101300*---------------------------------------------------------------* 12060035
101400*                                                               * 12070035
101500*---------------------------------------------------------------* 12080035
101600 2900-SELECT-TSUNAUD.                                             12090035
101700     EXEC SQL                                                     12100035
101800         SELECT AUD_STRT_TMST                                     12110035
101900         INTO   :SUNAUD-AUD-STRT-TMST                             12120035
102000         FROM   TSUNAUD                                           12130035
102100         WHERE  AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             12140035
102200     END-EXEC.                                                    12150035
102300                                                                  12160035
102400     EVALUATE TRUE                                                12170035
102500         WHEN SQLCODE = ZERO                                      12180035
102600             CONTINUE                                             12190035
102700                                                                  12200035
102800         WHEN SQLCODE = -904                                      12210035
102900         WHEN SQLCODE = -911                                      12220035
103000             SET  SU047-DATABASE-BUSY  TO TRUE                    12230035
103010             SET  PS-ERROR             TO TRUE                    12240035
103100             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          12250035
103200             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    12260035
103300             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     12270035
103400             MOVE DK-AUDIT-CNTL-NBR    TO PV-DISP-AUDIT-CNTL-NBR  12280035
103500             MOVE SQLCODE              TO PV-DISP-SQLCODE         12290035
103600             STRING   ' SUKCS763-2900-'                           12300035
103700                      ' CALLED BY-'                               12310035
103800                      SU047-CALLING-PROGRAM                       12320035
103900                      ' PO='                                      12330035
104000                      PV-DISP-PO-NBR '-'                          12340035
104100                      PV-DISP-RCVR-SEQ-NBR '-'                    12350035
104200                      PV-DISP-PO-LINE-NBR                         12360035
104300                      ' AUDIT='                                   12370035
104400                      PV-DISP-AUDIT-CNTL-NBR                      12380035
104500                      ' SQLCODE='                                 12390035
104600                      PV-DISP-SQLCODE                             12400035
104700                      DELIMITED BY SIZE                           12410035
104800                                      INTO SU047-CRA-RET-MSG      12420035
104900             MOVE SQLCODE               TO SU047-SQLCODE          12430035
105000             MOVE '2900-'               TO SU047-CRA-REQ-ID       12440035
105100             PERFORM 9998-RETURN                                  12450035
105200                                                                  12460035
105300         WHEN SQLWARN0 NOT = SPACES                               12470035
105400         WHEN SQLCODE < ZERO                                      12480035
105500         WHEN SQLCODE > ZERO                                      12490035
105600             SET  SU047-INVALID-SQL    TO TRUE                    12500035
105610             SET  PS-ERROR             TO TRUE                    12510035
105700             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          12520035
105800             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    12530035
105900             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     12540035
106000             MOVE DK-AUDIT-CNTL-NBR    TO PV-DISP-AUDIT-CNTL-NBR  12550035
106100             MOVE SQLCODE              TO PV-DISP-SQLCODE         12560035
106200             STRING   ' SUKCS763-2900-'                           12570035
106300                      ' CALLED BY-'                               12580035
106400                      SU047-CALLING-PROGRAM                       12590035
106500                      ' PO='                                      12600035
106600                      PV-DISP-PO-NBR '-'                          12610035
106700                      PV-DISP-RCVR-SEQ-NBR '-'                    12620035
106800                      PV-DISP-PO-LINE-NBR                         12630035
106900                      ' AUDIT='                                   12640035
107000                      PV-DISP-AUDIT-CNTL-NBR                      12650035
107100                      ' SQLCODE='                                 12660035
107200                      PV-DISP-SQLCODE                             12670035
107300                      DELIMITED BY SIZE                           12680035
107400                                      INTO SU047-CRA-RET-MSG      12690035
107500             MOVE SQLCODE               TO SU047-SQLCODE          12700035
107600             MOVE '2900-'               TO SU047-CRA-REQ-ID       12710035
107700             PERFORM 9998-RETURN                                  12720035
107800                                                                  12730035
107900     END-EVALUATE.                                                12740035
108000                                                                  12750035
108100                                                                  12760035
108200*---------------------------------------------------------------* 12770035
108300*                                                               * 12780035
108400*---------------------------------------------------------------* 12790035
108500 3600-OPEN-IN-PROCESS-CURSOR.                                     12800035
108600                                                                  12810035
108700     EXEC SQL                                                     12820035
108800         OPEN IN_PROCESS_DC_CSR                                   12830035
108900     END-EXEC.                                                    12840035
109000                                                                  12850035
109100     EVALUATE TRUE                                                12860035
109200         WHEN SQLCODE = ZERO                                      12870035
109300             SET PS-NOT-EOC-DC-PROCESS  TO TRUE                   12880035
109400                                                                  12890035
109500         WHEN SQLCODE = -904                                      12900035
109600         WHEN SQLCODE = -911                                      12910035
109700             SET  SU047-DATABASE-BUSY  TO TRUE                    12920035
109710             SET  PS-ERROR             TO TRUE                    12930035
109800             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          12940035
109900             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    12950035
110000             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     12960035
110100             MOVE DK-AUDIT-CNTL-NBR    TO PV-DISP-AUDIT-CNTL-NBR  12970035
110200             MOVE SQLCODE              TO PV-DISP-SQLCODE         12980035
110300             STRING   ' SUKCS763-3600-'                           12990035
110400                      ' CALLED BY-'                               13000035
110500                      SU047-CALLING-PROGRAM                       13010035
110600                      ' PO='                                      13020035
110700                      PV-DISP-PO-NBR '-'                          13030035
110800                      PV-DISP-RCVR-SEQ-NBR '-'                    13040035
110900                      PV-DISP-PO-LINE-NBR                         13050035
111000                      ' AUDIT='                                   13060035
111100                      PV-DISP-AUDIT-CNTL-NBR                      13070035
111200                      ' SQLCODE='                                 13080035
111300                      PV-DISP-SQLCODE                             13090035
111400                      DELIMITED BY SIZE                           13100035
111500                                      INTO SU047-CRA-RET-MSG      13110035
111600             MOVE SQLCODE               TO SU047-SQLCODE          13120035
111700             MOVE '3600-'               TO SU047-CRA-REQ-ID       13130035
111800             PERFORM 9998-RETURN                                  13140035
111900                                                                  13150035
112000         WHEN SQLWARN0 NOT = SPACES                               13160035
112100         WHEN SQLCODE < ZERO                                      13170035
112200         WHEN SQLCODE > ZERO                                      13180035
112300             SET  SU047-INVALID-SQL    TO TRUE                    13190035
112310             SET  PS-ERROR             TO TRUE                    13200035
112400             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          13210035
112500             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    13220035
112600             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     13230035
112700             MOVE DK-AUDIT-CNTL-NBR    TO PV-DISP-AUDIT-CNTL-NBR  13240035
112800             MOVE SQLCODE              TO PV-DISP-SQLCODE         13250035
112900             STRING   ' SUKCS763-3600-'                           13260035
113000                      ' CALLED BY-'                               13270035
113100                      SU047-CALLING-PROGRAM                       13280035
113200                      ' PO='                                      13290035
113300                      PV-DISP-PO-NBR '-'                          13300035
113400                      PV-DISP-RCVR-SEQ-NBR '-'                    13310035
113500                      PV-DISP-PO-LINE-NBR                         13320035
113600                      ' AUDIT='                                   13330035
113700                      PV-DISP-AUDIT-CNTL-NBR                      13340035
113800                      ' SQLCODE='                                 13350035
113900                      PV-DISP-SQLCODE                             13360035
114000                      DELIMITED BY SIZE                           13370035
114100                                      INTO SU047-CRA-RET-MSG      13380035
114200             MOVE SQLCODE               TO SU047-SQLCODE          13390035
114300             MOVE '3600-'               TO SU047-CRA-REQ-ID       13400035
114400             PERFORM 9998-RETURN                                  13410035
114500                                                                  13420035
114600     END-EVALUATE.                                                13430035
114700                                                                  13440035
114800                                                                  13450035
114900*---------------------------------------------------------------* 13460035
115000*                                                               * 13470035
115100*---------------------------------------------------------------* 13480035
115200 3700-FETCH-IN-PROCESS-CURSOR.                                    13490035
115300                                                                  13500035
115400     EXEC SQL                                                     13510035
115500         FETCH IN_PROCESS_DC_CSR                                  13520035
115600         INTO  :SUT00015-AUD-CNTL-NBR                             13530035
115700     END-EXEC.                                                    13540035
115800                                                                  13550035
115900     EVALUATE TRUE                                                13560035
116000         WHEN SQLCODE = ZERO                                      13570035
116100             MOVE PC-N           TO SUT00015-AUD-STAT-CDE         13580035
116200             MOVE PC-D           TO SUT00015-CART-PRMPT-CDE       13590035
116300             MOVE SUT00015-AUD-CNTL-NBR  TO DK-AUDIT-CNTL-NBR     13600035
116400             MOVE +0             TO SUT00015-AUD-ERR-PCT          13610035
116500             PERFORM 2200-UPDATE-SUT-PO-AUD-REQ                   13620035
116600             PERFORM 2900-SELECT-TSUNAUD                          13630035
116700             IF SUNAUD-AUD-STRT-TMST                              13640035
116800                       NOT EQUAL PC-DEFAULT-TIMESTAMP             13650035
116900                 PERFORM 2100-CLOSE-AUDIT                         13660035
117000             ELSE                                                 13670035
117100                 PERFORM 2150-CLOSE-AUDIT                         13680035
117200             END-IF                                               13690035
117300                                                                  13700035
117400         WHEN SQLCODE = +100                                      13710035
117500             SET PS-EOC-DC-PROCESS   TO TRUE                      13720035
117600                                                                  13730035
117700         WHEN SQLCODE = -904                                      13740035
117800         WHEN SQLCODE = -911                                      13750035
117900             SET  SU047-DATABASE-BUSY  TO TRUE                    13760035
117910             SET  PS-ERROR             TO TRUE                    13770035
118000             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          13780035
118100             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    13790035
118200             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     13800035
118300             MOVE DK-AUDIT-CNTL-NBR    TO PV-DISP-AUDIT-CNTL-NBR  13810035
118400             MOVE SQLCODE              TO PV-DISP-SQLCODE         13820035
118500             STRING   ' SUKCS763-3700-'                           13830035
118600                      ' CALLED BY-'                               13840035
118700                      SU047-CALLING-PROGRAM                       13850035
118800                      ' PO='                                      13860035
118900                      PV-DISP-PO-NBR '-'                          13870035
119000                      PV-DISP-RCVR-SEQ-NBR '-'                    13880035
119100                      PV-DISP-PO-LINE-NBR                         13890035
119200                      ' AUDIT='                                   13900035
119300                      PV-DISP-AUDIT-CNTL-NBR                      13910035
119400                      ' SQLCODE='                                 13920035
119500                      PV-DISP-SQLCODE                             13930035
119600                      DELIMITED BY SIZE                           13940035
119700                                      INTO SU047-CRA-RET-MSG      13950035
119800             MOVE SQLCODE               TO SU047-SQLCODE          13960035
119900             MOVE '3700-'               TO SU047-CRA-REQ-ID       13970035
120000             PERFORM 9998-RETURN                                  13980035
120100                                                                  13990035
120200         WHEN SQLWARN0 NOT = SPACES                               14000035
120300         WHEN SQLCODE < ZERO                                      14010035
120400         WHEN SQLCODE > ZERO                                      14020035
120500             SET  SU047-INVALID-SQL    TO TRUE                    14030035
120510             SET  PS-ERROR             TO TRUE                    14040035
120600             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          14050035
120700             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    14060035
120800             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     14070035
120900             MOVE DK-AUDIT-CNTL-NBR    TO PV-DISP-AUDIT-CNTL-NBR  14080035
121000             MOVE SQLCODE              TO PV-DISP-SQLCODE         14090035
121100             STRING   ' SUKCS763-3700-'                           14100035
121200                      ' CALLED BY-'                               14110035
121300                      SU047-CALLING-PROGRAM                       14120035
121400                      ' PO='                                      14130035
121500                      PV-DISP-PO-NBR '-'                          14140035
121600                      PV-DISP-RCVR-SEQ-NBR '-'                    14150035
121700                      PV-DISP-PO-LINE-NBR                         14160035
121800                      ' AUDIT='                                   14170035
121900                      PV-DISP-AUDIT-CNTL-NBR                      14180035
122000                      ' SQLCODE='                                 14190035
122100                      PV-DISP-SQLCODE                             14200035
122200                      DELIMITED BY SIZE                           14210035
122300                                      INTO SU047-CRA-RET-MSG      14220035
122400             MOVE SQLCODE               TO SU047-SQLCODE          14230035
122500             MOVE '3700-'               TO SU047-CRA-REQ-ID       14240035
122600             PERFORM 9998-RETURN                                  14250035
122700                                                                  14260035
122800     END-EVALUATE.                                                14270035
122900                                                                  14280035
123000                                                                  14290035
123100*---------------------------------------------------------------* 14300035
123200*                                                               * 14310035
123300*---------------------------------------------------------------* 14320035
123400 3800-CLOSE-IN-PROCESS-CURSOR.                                    14330035
123500                                                                  14340035
123600     EXEC SQL                                                     14350035
123700         CLOSE IN_PROCESS_DC_CSR                                  14360035
123800     END-EXEC.                                                    14370035
123900                                                                  14380035
124000     EVALUATE TRUE                                                14390035
124100         WHEN SQLCODE = ZERO                                      14400035
124200             CONTINUE                                             14410035
124300                                                                  14420035
124400         WHEN SQLCODE = -904                                      14430035
124500         WHEN SQLCODE = -911                                      14440035
124600             SET  SU047-DATABASE-BUSY  TO TRUE                    14450035
124610             SET  PS-ERROR             TO TRUE                    14460035
124700             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          14470035
124800             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    14480035
124900             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     14490035
125000             MOVE DK-AUDIT-CNTL-NBR    TO PV-DISP-AUDIT-CNTL-NBR  14500035
125100             MOVE SQLCODE              TO PV-DISP-SQLCODE         14510035
125200             STRING   ' SUKCS763-3800-'                           14520035
125300                      ' CALLED BY-'                               14530035
125400                      SU047-CALLING-PROGRAM                       14540035
125500                      ' PO='                                      14550035
125600                      PV-DISP-PO-NBR '-'                          14560035
125700                      PV-DISP-RCVR-SEQ-NBR '-'                    14570035
125800                      PV-DISP-PO-LINE-NBR                         14580035
125900                      ' AUDIT='                                   14590035
126000                      PV-DISP-AUDIT-CNTL-NBR                      14600035
126100                      ' SQLCODE='                                 14610035
126200                      PV-DISP-SQLCODE                             14620035
126300                      DELIMITED BY SIZE                           14630035
126400                                      INTO SU047-CRA-RET-MSG      14640035
126500             MOVE SQLCODE               TO SU047-SQLCODE          14650035
126600             MOVE '3800-'               TO SU047-CRA-REQ-ID       14660035
126700             PERFORM 9998-RETURN                                  14670035
126800                                                                  14680035
126900         WHEN SQLWARN0 NOT = SPACES                               14690035
127000         WHEN SQLCODE < ZERO                                      14700035
127100         WHEN SQLCODE > ZERO                                      14710035
127200             SET  SU047-INVALID-SQL    TO TRUE                    14720035
127210             SET  PS-ERROR             TO TRUE                    14730035
127300             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          14740035
127400             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    14750035
127500             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     14760035
127600             MOVE DK-AUDIT-CNTL-NBR    TO PV-DISP-AUDIT-CNTL-NBR  14770035
127700             MOVE SQLCODE              TO PV-DISP-SQLCODE         14780035
127800             STRING   ' SUKCS763-3800-'                           14790035
127900                      ' CALLED BY-'                               14800035
128000                      SU047-CALLING-PROGRAM                       14810035
128100                      ' PO='                                      14820035
128200                      PV-DISP-PO-NBR '-'                          14830035
128300                      PV-DISP-RCVR-SEQ-NBR '-'                    14840035
128400                      PV-DISP-PO-LINE-NBR                         14850035
128500                      ' AUDIT='                                   14860035
128600                      PV-DISP-AUDIT-CNTL-NBR                      14870035
128700                      ' SQLCODE='                                 14880035
128800                      PV-DISP-SQLCODE                             14890035
128900                      DELIMITED BY SIZE                           14900035
129000                                      INTO SU047-CRA-RET-MSG      14910035
129100             MOVE SQLCODE               TO SU047-SQLCODE          14920035
129200             MOVE '3800-'               TO SU047-CRA-REQ-ID       14930035
129300             PERFORM 9998-RETURN                                  14940035
129400                                                                  14950035
129500     END-EVALUATE.                                                14960035
129600                                                                  14970035
129700                                                                  14980035
129800*---------------------------------------------------------------* 14990035
129900* IF AUDIT FAILS - CREATE TROUBLE TO PREVENT VERIFICATION       * 15000035
130000*---------------------------------------------------------------* 15010035
130100 4000-CREATE-TROUBLE.                                             15020035
130200                                                                  15030035
130300     SET  TM500-ADD-DETAILS                                       15040035
130400          TM500-CREATE-AUTO        TO TRUE.                       15050035
130500                                                                  15060035
130800                                                                  15070035
130900     MOVE SU047-PO-NBR             TO TM500-PO-NBR.               15080035
131000     MOVE SU047-OPER-UNT-ID        TO TM500-OPER-UNT-ID.          15090035
131100     MOVE SU047-FCLTY-ID           TO TM500-FCLTY-ID.             15100035
131200     MOVE SU047-REC-SEQ-NBR        TO TM500-REC-SEQ-NBR.          15110035
131300     MOVE SU047-USER-ID            TO TM500-NOTIF-UID.            15120035
131340                                                                  15130035
131400                                                                  15140035
131410     IF  SUT00015-PKGNG-TYP-CDE  =  'PP'                          15150035
131411         MOVE PC-STOP-VER-PREPK-TRB-384 TO TM500-TRBL-RSN-CDE     15160035
131420         SET   TM500-PACK-LEVEL      TO  TRUE                     15170035
131430         MOVE  SUT00015-PO-PREPK-ID  TO  TM500-PREPK-ID           15180035
131440     ELSE                                                         15190035
131450     IF  SUT00015-PKGNG-TYP-CDE  =  'BC'                          15200035
131451         MOVE PC-STOP-VER-LNE-TRB-383   TO TM500-TRBL-RSN-CDE     15210035
131460         SET   TM500-LINE-LEVEL     TO  TRUE                      15220035
131470         MOVE  SUT00015-PO-LNE-NBR  TO  TM500-PO-LNE-NBR          15230035
131480     ELSE                                                         15240035
131481         MOVE PC-STOP-VER-PO-TRB-373   TO TM500-TRBL-RSN-CDE      15250035
131490         SET   TM500-PO-LEVEL       TO  TRUE                      15260035
131492     END-IF                                                       15270035
131493     END-IF.                                                      15280035
131500                                                                  15290035
131600     EXEC CICS                                                    15300035
131700         LINK PROGRAM  (PC-TROUBLE-WTR)                           15310035
131800              COMMAREA (TM500-FIELDS)                             15320035
131900              LENGTH   (PC-TROUBLE-LENGTH)                        15330035
132000     END-EXEC.                                                    15340035
132100                                                                  15350035
132200                                                                  15360035
132300     EVALUATE TRUE                                                15370035
132400         WHEN TM500-CALL-SUCCESSFUL                               15380035
132500         WHEN TM500-DUPLICATE-TROUBLE                             15390035
132600              CONTINUE                                            15400035
132700                                                                  15410035
132800         WHEN OTHER                                               15420035
132900             SET  SU047-INVALID-SQL    TO TRUE                    15430035
132910             SET  PS-ERROR             TO TRUE                    15440035
133000             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          15450035
133100             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    15460035
133200             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     15470035
133300             MOVE DK-AUDIT-CNTL-NBR    TO PV-DISP-AUDIT-CNTL-NBR  15480035
133400             MOVE TM500-SQLCODE        TO PV-DISP-SQLCODE         15490035
133410             STRING   ' SUKCS763-4000-'                           15500035
133420                      ' CALLED BY-'                               15510035
133430                      SU047-CALLING-PROGRAM                       15520035
133440                      ' RETURN CDE = '                            15530035
133450                      TM500-RETURN-CODE                           15540035
133460                      ' MSG ='                                    15550035
133470                      TM500-RETURN-MSG                            15560035
133471                      ' SQLCODE ='                                15570035
133472                      PV-DISP-SQLCODE                             15580035
133480                      DELIMITED BY SIZE                           15590035
133490                                  INTO PV-CICS-MSG-AREA           15600035
133491             PERFORM 9200-WRITE-TO-CICS-LOG                       15610035
133492             MOVE SQLCODE              TO PV-DISP-SQLCODE         15620035
133500             STRING   ' SUKCS763-4000-'                           15630035
133600                      ' CALLED BY-'                               15640035
133700                      SU047-CALLING-PROGRAM                       15650035
133800                      ' PO='                                      15660035
133900                      PV-DISP-PO-NBR '-'                          15670035
134000                      PV-DISP-RCVR-SEQ-NBR '-'                    15680035
134100                      PV-DISP-PO-LINE-NBR                         15690035
134200                      ' AUDIT='                                   15700035
134300                      PV-DISP-AUDIT-CNTL-NBR                      15710035
134400                      ' SQLCODE='                                 15720035
134500                      PV-DISP-SQLCODE                             15730035
134600                      DELIMITED BY SIZE                           15740035
134700                                      INTO SU047-CRA-RET-MSG      15750035
134800             MOVE SQLCODE               TO SU047-SQLCODE          15760035
134900             MOVE '4000-'               TO SU047-CRA-REQ-ID       15770035
135000             PERFORM 9998-RETURN                                  15780035
135100         END-EVALUATE.                                            15790035
135200                                                                  15800035
135300                                                                  15810035
135400*---------------------------------------------------------------* 15820035
135500*                                                               * 15830035
135600*---------------------------------------------------------------* 15840035
135700 8400-SELECT-TKRPRPM.                                             15850035
135800                                                                  15860035
135900     EXEC SQL                                                     15870035
136000          SELECT FUNC_PCT                                         15880035
136100            INTO :KRPRPM-FUNC-PCT                                 15890035
136200            FROM TKRPRPM                                          15900035
136300           WHERE LOC_ID            = 90                           15910035
136400             AND INTFC_SYS_CDE     = 'AUD'                        15920035
136500             AND SYS_PRC_FUNC_CDE  = 'ERRMAX'                     15930035
136600             AND FUNC_PRC_STAT_CDE = 'AC'                         15940035
136700     END-EXEC.                                                    15950035
136800                                                                  15960035
136900     EVALUATE TRUE                                                15970035
137000         WHEN SQLCODE = ZERO                                      15980035
137100             CONTINUE                                             15990035
137200                                                                  16000035
137300         WHEN SQLCODE = -904                                      16010035
137400         WHEN SQLCODE = -911                                      16020035
137500             SET  SU047-DATABASE-BUSY  TO TRUE                    16030035
137510             SET  PS-ERROR             TO TRUE                    16040035
137600             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          16050035
137700             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    16060035
137800             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     16070035
137900             MOVE DK-AUDIT-CNTL-NBR    TO PV-DISP-AUDIT-CNTL-NBR  16080035
138000             MOVE SQLCODE              TO PV-DISP-SQLCODE         16090035
138100             STRING   ' SUKCS763-8400-'                           16100035
138200                      ' CALLED BY-'                               16110035
138300                      SU047-CALLING-PROGRAM                       16120035
138400                      ' PO='                                      16130035
138500                      PV-DISP-PO-NBR '-'                          16140035
138600                      PV-DISP-RCVR-SEQ-NBR '-'                    16150035
138700                      PV-DISP-PO-LINE-NBR                         16160035
138800                      ' AUDIT='                                   16170035
138900                      PV-DISP-AUDIT-CNTL-NBR                      16180035
139000                      ' SQLCODE='                                 16190035
139100                      PV-DISP-SQLCODE                             16200035
139200                      DELIMITED BY SIZE                           16210035
139300                                      INTO SU047-CRA-RET-MSG      16220035
139400             MOVE SQLCODE               TO SU047-SQLCODE          16230035
139500             MOVE '8400-'               TO SU047-CRA-REQ-ID       16240035
139600             PERFORM 9998-RETURN                                  16250035
139700                                                                  16260035
139800         WHEN SQLWARN0 NOT = SPACES                               16270035
139900         WHEN SQLCODE NOT EQUAL ZERO                              16280035
140000             SET  SU047-INVALID-SQL    TO TRUE                    16290035
140010             SET  PS-ERROR             TO TRUE                    16300035
140100             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          16310035
140200             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    16320035
140300             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     16330035
140400             MOVE DK-AUDIT-CNTL-NBR    TO PV-DISP-AUDIT-CNTL-NBR  16340035
140500             MOVE SQLCODE              TO PV-DISP-SQLCODE         16350035
140600             STRING   ' SUKCS763-8400-'                           16360035
140700                      ' CALLED BY-'                               16370035
140800                      SU047-CALLING-PROGRAM                       16380035
140900                      ' PO='                                      16390035
141000                      PV-DISP-PO-NBR '-'                          16400035
141100                      PV-DISP-RCVR-SEQ-NBR '-'                    16410035
141200                      PV-DISP-PO-LINE-NBR                         16420035
141300                      ' AUDIT='                                   16430035
141400                      PV-DISP-AUDIT-CNTL-NBR                      16440035
141500                      ' SQLCODE='                                 16450035
141600                      PV-DISP-SQLCODE                             16460035
141700                      DELIMITED BY SIZE                           16470035
141800                                      INTO SU047-CRA-RET-MSG      16480035
141900             MOVE SQLCODE               TO SU047-SQLCODE          16490035
142000             MOVE '8400-'               TO SU047-CRA-REQ-ID       16500035
142100             PERFORM 9998-RETURN                                  16510035
142200                                                                  16520035
142300     END-EVALUATE.                                                16530035
142400                                                                  16540035
142500                                                                  16550035
142600*---------------------------------------------------------------* 16560035
142700*                                                               * 16570035
142800*---------------------------------------------------------------* 16580035
142900 8450-SELECT-PBS-IND.                                             16590035
143000                                                                  16600035
143100     MOVE SUT00015-OPER-UNT-ID TO DK-OPER-UNT-ID.                 16610035
143200                                                                  16620035
143300     EXEC SQL                                                     16630035
143400          SELECT FUNC_TXT                                         16640035
143500            INTO :PV-PBS-AUDIT-IND                                16650035
143600            FROM TKRPRPM                                          16660035
143700           WHERE LOC_ID            = :DK-OPER-UNT-ID              16670035
143800             AND INTFC_SYS_CDE     = 'KHL'                        16680035
143900             AND SYS_PRC_FUNC_CDE  = 'PBSAUD'                     16690035
144000             AND FUNC_PRC_STAT_CDE = 'AC'                         16700035
144100     END-EXEC.                                                    16710035
144200                                                                  16720035
144300     EVALUATE TRUE                                                16730035
144400         WHEN SQLCODE = ZERO                                      16740035
144500             CONTINUE                                             16750035
144600                                                                  16760035
144700         WHEN SQLCODE = -904                                      16770035
144800         WHEN SQLCODE = -911                                      16780035
144900             SET  SU047-DATABASE-BUSY  TO TRUE                    16790035
144901             SET  PS-ERROR             TO TRUE                    16800035
144910             MOVE DK-OPER-UNT-ID       TO PV-DISP-OPER            16810035
145000             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          16820035
145100             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    16830035
145200             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     16840035
145300             MOVE DK-AUDIT-CNTL-NBR    TO PV-DISP-AUDIT-CNTL-NBR  16850035
145400             MOVE SQLCODE              TO PV-DISP-SQLCODE         16860035
145500             STRING   ' SUKCS763-8450-'                           16870035
145600                      ' CALLED BY-'                               16880035
145700                      SU047-CALLING-PROGRAM                       16890035
145800                      ' PO='                                      16900035
145900                      PV-DISP-OPER   '-'                          16910035
145910                      PV-DISP-PO-NBR '-'                          16920035
146000                      PV-DISP-RCVR-SEQ-NBR '-'                    16930035
146100                      PV-DISP-PO-LINE-NBR                         16940035
146200                      ' AUDIT='                                   16950035
146300                      PV-DISP-AUDIT-CNTL-NBR                      16960035
146400                      ' SQLCODE='                                 16970035
146500                      PV-DISP-SQLCODE                             16980035
146600                      DELIMITED BY SIZE                           16990035
146700                                      INTO SU047-CRA-RET-MSG      17000035
146800             MOVE SQLCODE               TO SU047-SQLCODE          17010035
146900             MOVE '8450-'               TO SU047-CRA-REQ-ID       17020035
146901                                                                  17030035
146902             MOVE SU047-CRA-RET-MSG  TO  PV-CICS-MSG-AREA         17040035
146910             PERFORM 9200-WRITE-TO-CICS-LOG                       17050035
147000             PERFORM 9998-RETURN                                  17060035
147100                                                                  17070035
147200         WHEN SQLWARN0 NOT = SPACES                               17080035
147300         WHEN SQLCODE NOT EQUAL ZERO                              17090035
147400             SET  SU047-INVALID-SQL    TO TRUE                    17100035
147401             SET  PS-ERROR             TO TRUE                    17110035
147410             MOVE DK-OPER-UNT-ID       TO PV-DISP-OPER            17120035
147500             MOVE SU047-PO-NBR         TO PV-DISP-PO-NBR          17130035
147600             MOVE SU047-REC-SEQ-NBR    TO PV-DISP-RCVR-SEQ-NBR    17140035
147700             MOVE SU047-PO-LNE-NBR     TO PV-DISP-PO-LINE-NBR     17150035
147800             MOVE DK-AUDIT-CNTL-NBR    TO PV-DISP-AUDIT-CNTL-NBR  17160035
147900             MOVE SQLCODE              TO PV-DISP-SQLCODE         17170035
148000             STRING   ' SUKCS763-8450-'                           17180035
148100                      ' CALLED BY-'                               17190035
148200                      SU047-CALLING-PROGRAM                       17200035
148300                      ' PO='                                      17210035
148400                      PV-DISP-OPER   '-'                          17220035
148410                      PV-DISP-PO-NBR '-'                          17230035
148500                      PV-DISP-RCVR-SEQ-NBR '-'                    17240035
148600                      PV-DISP-PO-LINE-NBR                         17250035
148700                      ' AUDIT='                                   17260035
148800                      PV-DISP-AUDIT-CNTL-NBR                      17270035
148900                      ' SQLCODE='                                 17280035
149000                      PV-DISP-SQLCODE                             17290035
149100                      DELIMITED BY SIZE                           17300035
149200                                      INTO SU047-CRA-RET-MSG      17310035
149300             MOVE SQLCODE               TO SU047-SQLCODE          17320035
149400             MOVE '8450-'               TO SU047-CRA-REQ-ID       17330035
149410                                                                  17340035
149420             MOVE SU047-CRA-RET-MSG  TO  PV-CICS-MSG-AREA         17350035
149500             PERFORM 9200-WRITE-TO-CICS-LOG                       17360035
149510             PERFORM 9998-RETURN                                  17370035
149600                                                                  17380035
149700     END-EVALUATE.                                                17390035
149800                                                                  17400035
149900                                                                  17410035
149910*-----------------------------------------------------------------17420035
149920*  WRITE TO CICS LOG CSSL                                         17430035
149930*-----------------------------------------------------------------17440035
149940 9200-WRITE-TO-CICS-LOG.                                          17450035
149950                                                                  17460035
149951     MOVE LENGTH OF PV-CICS-MSG-AREA TO PV-COMMAREA-LENGTH.       17470035
149952                                                                  17480035
149960     EXEC CICS                                                    17490035
149970          WRITEQ TD                                               17500035
149980          QUEUE  ('CSSL')                                         17510035
149990          FROM  (PV-CICS-MSG-AREA)                                17520035
149991          LENGTH  (PV-COMMAREA-LENGTH)                            17530035
149992          RESP  (PV-CICS-RESPONSE)                                17540035
149993     END-EXEC.                                                    17550035
149994                                                                  17560035
149995     MOVE SPACES TO PV-CICS-MSG-AREA.                             17570035
149996                                                                  17580035
149997                                                                  17590035
149998 9300-CHECK-LOGGING.                                              17600035
149999     EXEC SQL                                                     17610035
150000         SELECT FUNC_TXT                                          17620035
150001           INTO :KRPRPM-FUNC-TXT                                  17630035
150002           FROM TKRPRPM                                           17640035
150003          WHERE SYS_PRC_FUNC_CDE  = 'SU763D'                      17650035
150004            AND LOC_ID            = :DK-OPER-UNT-ID               17660035
150005            AND INTFC_SYS_CDE     = 'KHL'                         17670035
150006            AND FUNC_PRC_STAT_CDE = 'AC'                          17680035
150007     END-EXEC.                                                    17690035
150008                                                                  17700035
150009     EVALUATE TRUE                                                17710035
150010         WHEN SQLCODE = ZERO                                      17720035
150011         WHEN SQLCODE = +100                                      17730035
150012              CONTINUE                                            17740035
150013         WHEN SQLWARN0 NOT = SPACE                                17750035
150014         WHEN SQLCODE NOT = ZERO                                  17760035
150015             SET PS-ERROR                                         17770035
150016                 SU047-INVALID-SQL    TO TRUE                     17780035
150017             MOVE SQLCODE             TO PV-DISP-SQLCODE          17790035
150018             MOVE DK-OPER-UNT-ID      TO PV-DISP-OPER             17800035
150019             STRING   ' SUKCS763-9300-'                           17810035
150020                      ' CALLED BY-'                               17820035
150021                      SU047-CALLING-PROGRAM                       17830035
150022                      '  SQLCODE='                                17840035
150023                      PV-DISP-SQLCODE                             17850035
150024                      ' OPER = '                                  17860035
150025                      PV-DISP-OPER                                17870035
150026                      DELIMITED BY SIZE                           17880035
150027                                        INTO PV-CICS-MSG-AREA     17890035
150028             PERFORM 9200-WRITE-TO-CICS-LOG                       17900035
150029     END-EVALUATE.                                                17910035
150030                                                                  17920035
150031                                                                  17930035
150040*-----------------------------------------------------------------17940035
150100*  RETURN TO CALLING PROGRAM                                      17950035
150200*-----------------------------------------------------------------17960035
150300 9998-RETURN.                                                     17970035
150400                                                                  17980035
150410     MOVE SU047-COMMAREA-REC           TO DFHCOMMAREA.            17990035
150500     MOVE SQLCA                         TO SU047-SQLCA.           18000035
150600     GOBACK.                                                      18010035
150700                                                                  18020035
