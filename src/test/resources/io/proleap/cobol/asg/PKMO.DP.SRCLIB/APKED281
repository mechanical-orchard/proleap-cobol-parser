000100 IDENTIFICATION DIVISION.                                         00010016
000200 PROGRAM-ID.     APKED281.                                        00020016
000300 AUTHOR.         M WILKINSON.                                     00030016
000400*DATE-WRITTEN.   JULY 31, 1996.                                   00040016
000500*DATE-COMPILED.                                                   00050016
000600****************************************************************  00060027
000700* COBOL 2                                                      *  00070027
000800*--------------------------------------------------------------*  00080027
000900* PRODUCTION EDI LOAD FILE BULK/STORE/DC EDIT                  *  00090027
001000*--------------------------------------------------------------*  00100027
001200* INPUT:                                                       *  00120027
001300*  1. EDI LOAD FILE                               (APRD052)    *  00130027
001400*                                                              *  00140027
001500* OUTPUT:                                                      *  00150027
001600*  1. EDI EDITED LOAD FILE                        (APRD052)    *  00160027
001700*  2. EDI COMBINATION FILE                        (APRD056)    *  00170027
001800*  3. EDI MISSED DISCOUNT FILE                    (APRD052)    *  00180027
001900*--------------------------------------------------------------*  00190027
002000* CHANGE LOG:                                                  *  00200033
002100*                                                              *  00210033
002200* 07/31/96    INITIAL VERSION.                                 *  00220033
002300* 06/08/98    CAROLYN GIFFORD                    WR #6041      *  00230033
002400*             Y2K CHANGES. ADDED CENTURY TO JULIAN DATE,       *  00240033
002500*             REDEFINED TO PIC 9(07). USE NEW JULIAN DATE      *  00250033
002600*             IN PROGRAM LOGIC. CHANGED CHECK DATE ROUTINE     *  00260033
002700*             TO USE WINDOW LOGIC FOR CALCULATING CENTURY.     *  00270033
002800*                                                              *  00280033
002900* 02/02/2000 JILL JUEL                      WR#: 20626         *  00290033
003000*            - RECOMPILED PROGRAM. CHANGES WERE MADE TO        *  00300033
003100*              APRD050, APRD051, APRD052, AND APRD056 BY       *  00310033
003200*              THE EDI TEAM.                                   *  00320033
003300*                                                              *  00330033
003400* 11/10/2000 JILL JUEL                      WR#: 20224         *  00340033
003500*            - REMOVED ALL LOGIC AND OUTPUT FILE DEALING       *  00350033
003600*              WITH MISSED DISCOUNTS.                          *  00360033
003700*                                                              *  00370033
003800* 06/28/2001                                                   *  00380033
003900*      ADDED LOGIC TO LOOK AT THE NEW AP052-ALLW-SOURCE        *  00390033
004000*      FIELD ON THE 05 TO DETERMINE WHETHER THE ALLOWANCE      *  00400033
004100*      SEGMENT WAS ADDED BY PROGRAM APKED201 BECAUSE THE       *  00410033
004200*      DISCOUNT WAS FOUND ON THE PO, BUT NOT SENT.  IF SO,     *  00420033
004300*      THE 05 RECORD WILL NOT BE WRITTEN TO THE COMBO FILE.    *  00430033
004400*      THIS FIX WILL PREVENT THE INVOICE FROM REJECTING        *  00440033
004500*      WITH AN OUT OF BALANCE ERROR WHEN IT RECYCLES BACK      *  00450033
004600*      THROUGH APKED201.                                       *  00460033
004700* NANCY EILBES                              WR#: 20704         *  00470033
004800*                                                              *  00480033
004900* DATE  05/15/2003                                             *  00490033
005000*     CHANGE MADE: NI-SKU PROJECT.                             *  00500033
005100*     RECOMPILED TO PICK UP CHANGED COPYBOOK(S).               *  00510033
005200*     MADE BY: MIKE BESKE              WR/IR #: WR22557        *  00520033
005300*                                                              *  00530033
005400* DATE  07/22/2003                                             *  00540033
005500*     CHANGE MADE: COMPOUND PREPACK EDI PROJECT                *  00550033
005600*     RECOMPILED TO PICK UP CHANGED COPYBOOK(S).               *  00560033
005700*     MADE BY: MIKE BESKE              WR/IR #: WR24685        *  00570033
005800*                                                              *  00580033
005900* DATE  03/29/2004                                             *  00590033
006000*     CHANGE MADE: INCREASED THE SIZE OF WS-SAVE-FIRST-STORE   *  00600033
006100*     FROM 3 TO 5.  INCREASED THE VALUES OF 88 LEVELS FOR      *  00610033
006200*     THE WS-SAVE-FIRST-STORE FIELD.                           *  00620033
006300*     MADE BY: MIKE BESKE              WR/IR #: WR25805        *  00630033
006400*                                                              *  00640033
006410* DATE  03/11/2007                                             *  00641034
006420*     CHANGE MADE: MATCH BY DC -- DELETED THE FIELD            *  00642033
006430*     WS-SAVE-FIRST-STORE FROM THE WS-WORK-AREA AND REPLACED   *  00643033
006440*     IT WITH WS-SAVE-FIRST-MTCH-LVL.  CHANGED ALL             *  00644033
006441*     REFERENCES OF AP052-SORT-STORE TO BE                     *  00644133
006442*     AP052-SORT-MTCH-LVL AND WS-SAVE-FIRST-STORE TO BE        *  00644233
006443*     WS-SAVE-FIRST-MTCH-LVL.  IN PARAGRAPH B100-PROCESSING,   *  00644333
006444*     REPLACED THE BULK AND BY-STORE LOGIC WITH MATCH LEVEL    *  00644433
006445*     LOGIC.  ALSO CHANGED THE SORT MEMBER APSR231 TO          *  00644533
006446*     USE THE SORT MATCH LEVEL RATHER THAN THE SORT STORE      *  00644633
006447*     NUMBER.                                                  *  00644733
006450*     MADE BY: KRYSTEN LEARY           WR/IR #: WR21578        *  00645033
006460*                                                              *  00646035
006470* DATE  11/04/2014                                             *  00647035
006480*     CHANGE MADE: PO EXTENDED DIGIT CHANGES.                  *  00648035
006490*     EXTENDED PO# FROM 7 TO 9.                                *  00649035
006491*     MADE BY: COGNIZANT               WR/IR #: CHG0094517     *  00649135
030001*                                                               * 00649237
029700*   DATE  03/16/2023                                            * 00649338
029800*   CHANGE MADE: RECOMPILE FOR UPDATED COPYBOOK APRD052         * 00649437
030000*      MADE BY: JEAN KURK               WR/IR #: CHG0285404     * 00649538
006500****************************************************************  00650033
006600                                                                  00660023
006700 ENVIRONMENT DIVISION.                                            00670023
006900 INPUT-OUTPUT SECTION.                                            00690023
007000                                                                  00700023
007100 FILE-CONTROL.                                                    00710023
007200                                                                  00720023
007300     SELECT EDIIN-FILE                                            00730023
007400         ASSIGN         TO UT-S-INP01.                            00740023
007500     SELECT EDIOUT-FILE                                           00750023
007600         ASSIGN         TO UT-S-OUT01.                            00760023
007700     SELECT COMOUT-FILE                                           00770023
007800         ASSIGN         TO UT-S-OUT02.                            00780023
007900     SELECT MISOUT-FILE                                           00790023
008000         ASSIGN         TO UT-S-OUT03.                            00800023
008100                                                                  00810023
008200 DATA DIVISION.                                                   00820023
008400 FILE SECTION.                                                    00840023
008500                                                                  00850023
008600 FD  EDIIN-FILE                                                   00860023
008700         LABEL RECORDS  ARE STANDARD                              00870023
008800         RECORDING MODE IS  F                                     00880023
008900         DATA RECORD    IS  EDIIN-RECORD.                         00890023
009100 01  EDIIN-RECORD                  PIC X(350).                    00910023
009200                                                                  00920023
009300 FD  EDIOUT-FILE                                                  00930023
009400         LABEL RECORDS  ARE STANDARD                              00940023
009500         RECORDING MODE IS  F                                     00950023
009600         DATA RECORD    IS  EDIOUT-RECORD.                        00960023
009800 01  EDIOUT-RECORD                 PIC X(350).                    00980023
009900                                                                  00990023
010000 FD  COMOUT-FILE                                                  01000023
010100         LABEL RECORDS  ARE STANDARD                              01010023
010200         RECORDING MODE IS  F                                     01020023
010300         DATA RECORD    IS  COMBIN-RECORD.                        01030023
010500 01  COMBIN-RECORD                 PIC X(370).                    01050023
010600                                                                  01060023
010700 FD  MISOUT-FILE                                                  01070023
010800         LABEL RECORDS  ARE STANDARD                              01080023
010900         RECORDING MODE IS  F                                     01090023
011000         DATA RECORD    IS  MISC-RECORD.                          01100023
011200 01  MISC-RECORD                   PIC X(350).                    01120023
011300                                                                  01130023
011500 WORKING-STORAGE SECTION.                                         01150023
011600                                                                  01160023
011700 01  FILLER                        PIC X(25) VALUE                01170023
011800                             'WS FOR APKED281 BEGINS==>'.         01180023
011900 01  WS-DISPLAY-COUNTER            PIC 9(07) VALUE ZEROS.         01190023
012000                                                                  01200023
012100 01  WS-WORK-AREA.                                                01210023
012200     05  WS-SAVE-PO-NBR          PIC 9(09)  VALUE ZEROS.          01220035
012510     05  WS-SAVE-FIRST-MTCH-LVL  PIC X(01)  VALUE SPACES.         01251025
012600                                                                  01260023
012700 01  WS-PROGRAM-COUNTERS.                                         01270023
012800     05  WS-EDIIN-REC-CNT        PIC 9(9)  VALUE ZEROS.           01280023
012900     05  WS-EDIOUT-REC-CNT       PIC 9(9)  VALUE ZEROS.           01290023
013000     05  WS-COMBIN-REC-CNT       PIC 9(9)  VALUE ZEROS.           01300023
013100     05  WS-MISSED-REC-CNT       PIC 9(9)  VALUE ZEROS.           01310023
013200                                                                  01320023
013300 01  WS-SWITCHES.                                                 01330023
013400     05  END-OF-EDIIN-SW         PIC X(01) VALUE 'N'.             01340023
013500         88  END-OF-EDIIN                  VALUE 'Y'.             01350023
013600                                                                  01360023
013700 01  RUN-TIME.                                                    01370023
013800     05  R-HR                    PIC 99.                          01380023
013900     05  R-MIN                   PIC 99.                          01390023
014000     05  R-SEC                   PIC 99.                          01400023
014100     05  R-TH                    PIC 99.                          01410023
014300 01  DATE-IN.                                                     01430023
014400     05 DATE-IN-YY               PIC XX.                          01440023
014500     05 DATE-IN-MM               PIC XX.                          01450023
014600     05 DATE-IN-DD               PIC XX.                          01460023
014700                                                                  01470023
014800 01  WS-JULIAN-DATE.                                              01480023
014900     05 WS-JULIAN-CC             PIC 9(02).                       01490023
015000     05 WS-JULIAN-YY             PIC 9(02).                       01500023
015100     05 WS-JULIAN-DDD            PIC 9(03).                       01510023
015200 01  WS-JULIAN-CCYYDDD   REDEFINES WS-JULIAN-DATE   PIC 9(07).    01520023
015300                                                                  01530024
015400*--------------------------------------------------------------*  01540025
015410* EDITED AND VALIDATED EDI INPUT FILE                          *  01541025
015420*--------------------------------------------------------------*  01542025
015500 01  FILLER                      PIC X(35)  VALUE                 01550023
015600     'BEGINNING OF AP052 INPUT FILE    **'.                       01560023
015700 01  AP052-EDI-IN-FILE.                                           01570023
015800     COPY APRD052.                                                01580023
015900                                                                  01590024
016000*--------------------------------------------------------------*  01600025
016010* EDITED AND VALIDATED RECYCLED EDI OUTPUT FILE                *  01601025
016020*--------------------------------------------------------------*  01602025
016100 01  FILLER                      PIC X(35)  VALUE                 01610023
016200     'BEGINNING OF AP056 OUTPUT FILE   **'.                       01620023
016300 01  AP056-COM-OUT-FILE.                                          01630023
016400     COPY APRD056.                                                01640023
016500                                                                  01650023
016700 01  FILLER                        PIC X(25) VALUE                01670023
016800          '<====WS FOR APKED281 ENDS'.                            01680023
017400                                                                  01740024
017410*-----------------------------*                                   01741024
017500 PROCEDURE DIVISION.                                              01750023
017600*-----------------------------*                                   01760024
017700 A100-MAINLINE.                                                   01770023
017800                                                                  01780023
017900     PERFORM H100-HOUSEKEEPING.                                   01790023
018000     PERFORM R100-READ-AP052.                                     01800023
018100     IF   END-OF-EDIIN                                            01810023
018200          DISPLAY '**********************************'            01820023
018300          DISPLAY '*   EMPTY EDI INVOICE LOAD FILE  *'            01830023
018400          DISPLAY '*   PROGRAM ** = APKED281        *'            01840023
018500          DISPLAY '**********************************'            01850023
018600     ELSE                                                         01860023
018700        MOVE AP052-KOHLS-PO-NBR       TO WS-SAVE-PO-NBR           01870023
018800        MOVE AP052-SORT-MTCH-LVL      TO WS-SAVE-FIRST-MTCH-LVL   01880025
018900        PERFORM B100-PROCESSING                                   01890023
019000          UNTIL END-OF-EDIIN                                      01900025
019100                                                                  01910023
019200     PERFORM Z900-END-OF-JOB.                                     01920023
019400     GOBACK.                                                      01940023
019600                                                                  01960023
019900*--------------------------------------------------------------*  01990025
020000* PROCESS EDI VALID TRANSMISSIONS AND DETERMINE IF THEY ARE TO *  02000025
020100* WRITTEN TO THE LOAD OUTPUT FILE OR THE COMBINATION FILE.     *  02010025
020200*                                                              *  02020025
020210* IF THE MATCH LEVEL FOR A PO IS THE SAME FOR ALL INVOICES,    *  02021031
020220* THEN ALL INVOICES FOR THAT PO ARE LOADED.                    *  02022031
020230* IF THE MATCH LEVEL FOR A PO IS A COMBINATION OF BY-DC,       *  02023031
020240* BY-STORE, AND BULK, THEN THE MATCH LEVEL LOADED FIRST IS THE *  02024031
020250* TYPE THAT WILL BE PROCESSED.                                 *  02025031
020260* CURRENTLY, THE INPUT IS SORTED WITH THE MATCH LEVEL IN       *  02026031
020270* ASCENDING SEQUENCE SO THAT THE BY-DC INVOICES WILL BE LOADED *  02027031
020280* IN THE EVENT OF A COMBINATION.  THE BY-STORE AND BULK WILL BE*  02028031
020290* RECYCLED TO THE COMBINATION FILE.                            *  02029031
021200*--------------------------------------------------------------*  02120025
021210 B100-PROCESSING.                                                 02121025
021220                                                                  02122025
021400     IF  AP052-KOHLS-PO-NBR = WS-SAVE-PO-NBR                      02140023
021500         CONTINUE                                                 02150023
021600     ELSE                                                         02160023
021700         MOVE AP052-KOHLS-PO-NBR       TO WS-SAVE-PO-NBR          02170023
021800         MOVE AP052-SORT-MTCH-LVL      TO WS-SAVE-FIRST-MTCH-LVL  02180025
021900     END-IF.                                                      02190023
022000                                                                  02200023
022100     IF  WS-SAVE-FIRST-MTCH-LVL = AP052-SORT-MTCH-LVL             02210029
022300         IF  AP052-RECORD-TYPE-IND = '04'                         02230023
022400         AND AP052-TERMS-DSCRPNCY-SW = 'Y'                        02240023
022500             PERFORM W300-WRITE-MISC-RECORD                       02250023
022600         END-IF                                                   02260023
022700         PERFORM W100-WRITE-EDITED-LOAD                           02270023
022800     ELSE                                                         02280023
022900         IF  AP052-RECORD-TYPE-IND  = '05'                        02290023
023000         AND AP052-KOHLS-PO-ADD                                   02300023
023100             CONTINUE                                             02310023
023200         ELSE                                                     02320023
023300             PERFORM W200-WRITE-COM-FILE                          02330023
023400         END-IF                                                   02340023
023500     END-IF.                                                      02350023
023600                                                                  02360023
023700     PERFORM R100-READ-AP052.                                     02370023
023800                                                                  02380023
023810*--------------------------------------------------------------*  02381025
023820* GET THE DATE AND TIME, OPEN FILES, SET UP CONTROLS, ETC.     *  02382025
023830*--------------------------------------------------------------*  02383025
023900 H100-HOUSEKEEPING.                                               02390023
024000                                                                  02400025
024500     ACCEPT RUN-TIME FROM TIME.                                   02450023
024600     ACCEPT DATE-IN  FROM DATE.                                   02460023
024700     ACCEPT WS-JULIAN-DATE FROM DAY.                              02470023
024800                                                                  02480023
024900     IF WS-JULIAN-YY > 80                                         02490023
025000        MOVE 19 TO WS-JULIAN-CC                                   02500023
025100     ELSE                                                         02510023
025200        MOVE 20 TO WS-JULIAN-CC                                   02520025
025210     END-IF.                                                      02521025
025300                                                                  02530023
025400     DISPLAY ' RUN-DATE = ' DATE-IN '   RUN-TIME = ' RUN-TIME.    02540023
025500                                                                  02550023
025600     OPEN INPUT  EDIIN-FILE                                       02560025
025700          OUTPUT EDIOUT-FILE                                      02570025
025800                 COMOUT-FILE                                      02580025
025900                 MISOUT-FILE.                                     02590025
026000                                                                  02600023
026010*--------------------------------------------------------------*  02601025
026020* READ THE EDI INPUT FILE INTO WORKING STORAGE COPYBOOK        *  02602025
026030*--------------------------------------------------------------*  02603025
026100 R100-READ-AP052.                                                 02610023
026400                                                                  02640025
026700     READ EDIIN-FILE INTO AP052-EDI-IN-FILE                       02670023
026800       AT END                                                     02680025
026810          SET END-OF-EDIIN       TO TRUE                          02681025
026900       NOT AT END                                                 02690025
027100          ADD 1                  TO WS-EDIIN-REC-CNT              02710025
027200     END-READ.                                                    02720025
027201                                                                  02720125
027210*--------------------------------------------------------------*  02721025
027220* WRITE OUT THE RECORDS TO PRODUCE A EDITED LOAD TO DB2 FILE   *  02722025
027230*--------------------------------------------------------------*  02723025
027300 W100-WRITE-EDITED-LOAD.                                          02730023
027800                                                                  02780025
027900     WRITE EDIOUT-RECORD FROM AP052-EDI-IN-FILE.                  02790023
028000     ADD 1               TO WS-EDIOUT-REC-CNT.                    02800025
028100                                                                  02810023
028110*--------------------------------------------------------------*  02811025
028120* WRITE OUT THE RECORDS TO PRODUCE A COMBINATION FILE          *  02812025
028130*--------------------------------------------------------------*  02813025
028200 W200-WRITE-COM-FILE.                                             02820023
028800                                                                  02880023
028900     INITIALIZE AP056-RECYCLE-KEY.                                02890023
029000     MOVE WS-JULIAN-CCYYDDD    TO AP056-CR-DATE.                  02900025
029100                                                                  02910023
029200     MOVE AP052-KEY            TO AP056-KEY.                      02920025
029300     MOVE AP052-DATA-AREA      TO AP056-DATA-AREA.                02930025
029400                                                                  02940023
029500     WRITE COMBIN-RECORD FROM AP056-COM-OUT-FILE.                 02950023
029600     ADD 1               TO WS-COMBIN-REC-CNT.                    02960025
029700                                                                  02970023
029710*--------------------------------------------------------------*  02971025
029720* WRITE OUT THE RECORDS TO PRODUCE A MISSED DISCOUNT FILE      *  02972025
029730*--------------------------------------------------------------*  02973025
029800 W300-WRITE-MISC-RECORD.                                          02980023
029900                                                                  02990023
030400     WRITE MISC-RECORD FROM AP052-EDI-IN-FILE.                    03040023
030500     ADD 1             TO WS-MISSED-REC-CNT.                      03050025
030600                                                                  03060023
030610*--------------------------------------------------------------*  03061025
030620* FINISH THE ERROR PROCESS, REPORT ON NECESSARY TOTALS, AND    *  03062025
030621* CLOSE ALL FILES.                                             *  03062125
030630*--------------------------------------------------------------*  03063025
030700 Z900-END-OF-JOB.                                                 03070023
031300                                                                  03130025
031400     CLOSE EDIIN-FILE                                             03140023
031500           EDIOUT-FILE                                            03150023
031600           COMOUT-FILE                                            03160023
031700           MISOUT-FILE.                                           03170023
031800                                                                  03180023
031900     DISPLAY '************************************************'.  03190023
032000     DISPLAY 'TOTAL EDI LOAD RECORDS READ    = '                  03200023
032100              WS-EDIIN-REC-CNT                                    03210023
032200     DISPLAY 'TOTAL EDI LOAD RECORDS WRITTEN = '                  03220023
032300              WS-EDIOUT-REC-CNT.                                  03230023
032400     DISPLAY 'TOTAL COMBIN   RECORDS WRITTEN = '                  03240023
032500              WS-COMBIN-REC-CNT.                                  03250023
032600     DISPLAY 'TOTAL MIS DISC RECORDS WRITTEN = '                  03260023
032700              WS-MISSED-REC-CNT.                                  03270023
032800     DISPLAY '************************************************'.  03280023
032900                                                                  03290023
033000     IF END-OF-EDIIN                                              03300025
033100        DISPLAY ' PROGRAM APKED281 ENDS NORMALLY '                03310025
033200     ELSE                                                         03320023
033300        DISPLAY ' PROGRAM APKED281 ENDS ABNORMALLY '              03330025
033400     END-IF.                                                      03340023
033500                                                                  03350023
033600     ACCEPT RUN-TIME FROM TIME.                                   03360023
033700     ACCEPT DATE-IN  FROM DATE.                                   03370023
033800                                                                  03380023
033900     DISPLAY ' RUN-DATE = ' DATE-IN '   RUN-TIME = ' RUN-TIME.    03390023
034000     DISPLAY '************************************************'.  03400023
034100                                                                  03410023
