000100 IDENTIFICATION DIVISION.                                         00010017
000200 PROGRAM-ID.      XSKUT096.                                       00020018
000300 AUTHOR.          VAMSI PASUPULETI.                               00030070
000400 DATE-WRITTEN.    JUNE 2017.                                      00040070
000500*--------------------------------------------------------------*  00050018
000600* DESCRIPTION:                                                 *  00060018
000700*      THIS PROGRAM WILL EXTRACT THE ROWS FROM THE PERM PRICE  *  00070020
000800*      CHANGE OPERATIONAL TABLE TO MOVE TO THE HISTORY TABLES. *  00080020
000900*      THERE ARE TWO MAIN CURSORS IN THE PROGRAM               *  00090059
001000*      1) THE FIRST CURSOR GETS ALL THE ROWS FROM XST_PRCHG    *  00100020
001100*         AND XST_STR_GP_PRCHG TABLE FOR WHICH THE             *  00110020
001200*         PRCHG_EFF_DTE <= ONE MONTH OLD DATE                  *  00120073
001200*           IN XST_STR_GP_PRCHG TABLE AND                      *  00120173
001200*         PRCHG_TYP_CDE IN ('CLR','RCP','MK1')    AND          *  00121073
001200*         EVNT_CTG_CDE = 'CLR'                                 *  00122073
001200*           IN XST_PRCHG TABLE                                 *  00123073
001300*                                                              *  00130018
001301*      2) THE SECOND CURSOR GETS ALL THE ROWS FROM THE         *  00130149
001310*         XST_PRCHG_MDSE FOR THE CORRESPONDING                 *  00131070
001320*         PRCHG_ID EXTRACTED IN STEP 1                         *  00132070
001330*                                                              *  00133049
001400*  INPUTS:                                                     *  00140018
001500*      XSCC240   30 DAYS OLD DATE                              *  00150059
001700*                                                              *  00170018
001800* OUTPUTS:                                                     *  00180018
001900*      HISTORY TABLE EXTRACT                                   *  00190018
002000*--------------------------------------------------------------*  00200018
002000*--------------------------------------------------------------*  00201073
002100* HISTORY LOG:                                                 *  00202073
002200*--------------------------------------------------------------*  00203073
002300* DATE:        21/06/2017                                      *  00204073
002400* WR/IR#:                                                      *  00205073
002500* PROGRAMMER:  VAMSI PASUPULETI                                *  00206073
002600* DESCRIPTION: HISTORY TABLE EXTRACT PGM INTIAL IMPLEMENTATION *  00207073
002600*              AFTER MAKING CHANGES TO PREVIOUS EXTRACT PROCESS*  00208073
004720*--------------------------------------------------------------*  00209173
004721* DATE:                                                        *  00209273
004730* WR/IR#:                                                      *  00209373
004740* PROGRAMMER:                                                  *  00209473
004750* DESCRIPTION:                                                 *  00209573
004760*--------------------------------------------------------------*  00209673
002100 ENVIRONMENT DIVISION.                                            00210018
002200 CONFIGURATION SECTION.                                           00220018
002300 SOURCE-COMPUTER.        IBM-3090.                                00230018
002400 OBJECT-COMPUTER.        IBM-3090.                                00240018
002500                                                                  00250018
002600 INPUT-OUTPUT SECTION.                                            00260018
002700 FILE-CONTROL.                                                    00270018
002800                                                                  00280018
002900     SELECT CONTROL-CARD-FILE                                     00290058
003000            ASSIGN TO INP01.                                      00300018
003400                                                                  00340018
003500     SELECT HISTORY-EXTRACT                                       00350018
003600            ASSIGN TO OUT01.                                      00360018
003730                                                                  00373018
003800 DATA DIVISION.                                                   00380018
003900 FILE SECTION.                                                    00390018
004000                                                                  00400018
004100 FD  CONTROL-CARD-FILE                                            00410061
004200     RECORDING MODE F                                             00420018
004300     BLOCK CONTAINS 0 RECORDS                                     00430018
004400     LABEL RECORDS ARE OMITTED                                    00440018
004500     DATA RECORD IS CONTROL-FILE-RECORD.                          00450061
004600 01  CONTROL-FILE-RECORD                PIC X(080).               00460061
005400                                                                  00540018
005500 FD  HISTORY-EXTRACT                                              00550018
005600     RECORDING MODE F                                             00560018
005700     BLOCK CONTAINS 0 RECORDS                                     00570018
005800     LABEL RECORDS ARE OMITTED                                    00580018
005900     DATA RECORD IS HISTORY-EXTRACT-RECORD.                       00590025
006000 01  HISTORY-EXTRACT-RECORD          PIC X(169).                  00600046
006100                                                                  00610018
006200*--------------------------------------------------------------*  00620018
006300 WORKING-STORAGE SECTION.                                         00630018
006400*--------------------------------------------------------------*  00640018
006500 01  PS-PROGRAM-SWITCHES.                                         00650018
006600     05  PS-END-OF-CNTL-CRD-SW        PIC  X(001).                00660018
006700         88  PS-END-OF-CNTL-CRD-FILE              VALUE 'Y'.      00670018
006800         88  PS-NOT-END-OF-CNTL-CRD-FILE          VALUE 'N'.      00680018
006900     05  PS-DELETE-DATE-CSR-SW        PIC  X(001).                00690056
007000         88  MORE-DELETE-DATES                    VALUE 'Y'.      00700056
007100         88  NO-MORE-DELETE-DATES                 VALUE 'N'.      00710056
007200     05  PS-DELETE-MDSE-CSR-SW        PIC  X(001).                00720018
007300         88  MORE-DELETE-MDSE                     VALUE 'Y'.      00730018
007400         88  NO-MORE-DELETE-MDSE                  VALUE 'N'.      00740018
007800                                                                  00780018
007900*--------------------------------------------------------------*  00790018
008000* PROGRAM CONSTANTS                                               00800018
008100*--------------------------------------------------------------*  00810018
008200 01  PC-PROGRAM-CONSTANTS.                                        00820018
008300     05  PC-PROGRAM-NAME          PIC X(08) VALUE 'XSKUT096'.     00830018
008400     05  PC-MAX-RETRIES           PIC 9(9)  VALUE 5.              00840018
008401     05  PC-MDSE-ID-PRCHG         PIC 9(9)  VALUE 1.              00840146
008402     05  PC-MDSE-ID-STRGP         PIC 9(9)  VALUE 2.              00840246
008410     05  PC-NULL-VALUE            PIC X(1)  VALUE '~'.            00841036
008500                                                                  00850018
008600*--------------------------------------------------------------*  00860018
008700* PV- PROGRAM VARIABLES                                           00870018
008800*--------------------------------------------------------------*  00880018
008900 01  PV-PROGRAM-VARIABLES.                                        00890025
009000     05  PV-PARAGRAPH-NAME        PIC X(40)   VALUE SPACES.       00900018
009100     05  PD-DB2-OPERATION         PIC X(15)   VALUE SPACES.       00910018
009200                                                                  00920018
009300     05  PV-SQL-SUB               PIC S9(09)  VALUE 0  COMP.      00930018
009400     05  PV-RETRY                 PIC 9999    VALUE 0  COMP.      00940018
009500     05  PV-ABEND-CODE            PIC 9999    VALUE 0  COMP.      00950018
009800     05  PV-ONE-MONTH-OLD-DATE    PIC  X(10)  VALUE SPACES.       00980023
009910     05  PV-PREVIOUS-PRCHG-ID     PIC  9(09)  VALUE ZERO.         00991028
010000                                                                  01000018
008900 01  CC-CONTROL-CARD-DATE.                                        01000158
000720      05 CC-PURGE-DATE.                                           01000258
000700         10  CC-XSCC240-TODAY-CC             PIC X(02).           01000471
000700         10  CC-XSCC240-TODAY-YY             PIC X(02).           01000571
000700         10  FILLER                          PIC X(01).           01000658
000700         10  CC-XSCC240-TODAY-MM             PIC X(02).           01000771
000700         10  FILLER                          PIC X(01).           01000858
000700         10  CC-XSCC240-TODAY-DD             PIC X(02).           01000971
000800   05 FILLER                                 PIC X(70)            01001058
000900                                              VALUE SPACES.       01001158
010001*--------------------------------------------------------------*  01001226
010002* PV- DB2 VARIABLES                                               01001326
010003*--------------------------------------------------------------*  01001426
010010 01  PV-DB2-VARIABLES.                                            01002026
010080     05  PV-NULL-PRCHG-DEPT       PIC S9(04) VALUE +0 COMP SYNC.  01008026
010081     05  PV-NULL-PRCHG-DESC       PIC S9(04) VALUE +0 COMP SYNC.  01008126
010082     05  PV-NULL-ALL-RMNG-STR     PIC S9(04) VALUE +0 COMP SYNC.  01008226
010083     05  PV-NULL-APP-TMST         PIC S9(04) VALUE +0 COMP SYNC.  01008326
010084     05  PV-NULL-DEPT             PIC S9(04) VALUE +0 COMP SYNC.  01008426
010090     05  PV-NULL-MAJ-CL           PIC S9(04) VALUE +0 COMP SYNC.  01009026
010091     05  PV-NULL-SUB-CL           PIC S9(04) VALUE +0 COMP SYNC.  01009126
010092     05  PV-NULL-STYLE            PIC S9(04) VALUE +0 COMP SYNC.  01009226
010093     05  PV-NULL-SKU              PIC S9(04) VALUE +0 COMP SYNC.  01009326
010094     05  PV-NULL-UNIT-RTL         PIC S9(04) VALUE +0 COMP SYNC.  01009426
010095     05  PV-NULL-NCLR-RTL-AMT     PIC S9(04) VALUE +0 COMP SYNC.  01009526
010096     05  PV-NULL-CLR-TYP-CDE      PIC S9(04) VALUE +0 COMP SYNC.  01009626
010097     05  PV-NULL-GP-PRIC-ID       PIC S9(04) VALUE +0 COMP SYNC.  01009726
010098     05  PV-NULL-GP-RTL-QTY       PIC S9(04) VALUE +0 COMP SYNC.  01009826
010099     05  PV-NULL-GP-RTL-AMT       PIC S9(04) VALUE +0 COMP SYNC.  01009926
010500                                                                  01050018
010510*--------------------------------------------------------------*  01051022
010520* XSRD147 OUTPUT FILE LAYOUT FOR THE LOAD EXTRACT FILE            01052022
010530*--------------------------------------------------------------*  01053022
010540     COPY XSRD147.                                                01054022
010550                                                                  01055022
011600*--------------------------------------------------------------*  01160018
011700* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         01170018
011800*--------------------------------------------------------------*  01180018
011900     COPY DPWS004.                                                01190018
012000                                                                  01200018
012600*--------------------------------------------------------------*  01260018
012700* DB2 ABEND COPYBOOK                                              01270018
012800*--------------------------------------------------------------*  01280018
012900     COPY DPWS900.                                                01290018
013000                                                                  01300018
013100*--------------------------------------------------------------*  01310018
013200* DB2 MESSAGE AREA                                                01320018
013300*--------------------------------------------------------------*  01330018
013400     COPY SQLCA2.                                                 01340018
013500                                                                  01350018
013600*--------------------------------------------------------------*  01360018
013700* PROGRAM COUNTERS                                                01370018
013800*--------------------------------------------------------------*  01380018
013900 01  PV-PROGRAM-COUNTERS         COMP-3.                          01390018
014000     05  PV-NUMBER-OF-RETRIES     PIC 9(9) VALUE 0.               01400018
014110     05  PV-PRCHG-WRITE-CNT       PIC 9(9) VALUE 0.               01411024
014120     05  PV-STRGP-WRITE-CNT       PIC 9(9) VALUE 0.               01412024
014130     05  PV-MDSEP-WRITE-CNT       PIC 9(9) VALUE 0.               01413024
014200                                                                  01420018
014300*--------------------------------------------------------------*  01430018
014400* ERROR HANDLING                                                  01440018
014500*--------------------------------------------------------------*  01450018
014600 01  PV-MISC-ABEND-FIELDS.                                        01460018
014700     05  PV-OPERATION-MSG-1      PIC X(40) VALUE SPACES.          01470018
014800     05  PV-OPERATION-MSG-2      PIC X(40) VALUE SPACES.          01480018
014900     05  PV-DB2-OPERATION        PIC X(30) VALUE SPACES.          01490018
015000                                                                  01500018
015100 01  ABEND-CODE                  PIC S9(4) VALUE 0  COMP SYNC.    01510018
015200     88  ABEND-4003-CTRL-CARD-ERROR        VALUE +4003.           01520018
015300     88  ABEND-4013-DB2-ERROR              VALUE +4013.           01530018
015400     88  ABEND-4019-CAL-SUB-ERROR          VALUE +4019.           01540018
015500     88  ABEND-4020-MQ-ERROR               VALUE +4020.           01550018
015600     88  ABEND-4444-FORCED-ABEND           VALUE +4444.           01560018
015700     88  ABEND-4008                        VALUE +4008.           01570018
015800     88  ABEND-4005                        VALUE +4005.           01580018
015900                                                                  01590018
016000*--------------------------------------------------------------*  01600018
016100* DB2 COMMUNICATIONS AREA                                         01610018
016200*--------------------------------------------------------------*  01620018
016300     EXEC SQL                                                     01630018
016400       INCLUDE SQLCA                                              01640018
016500     END-EXEC.                                                    01650018
016600                                                                  01660018
016700*--------------------------------------------------------------*  01670018
016800* DB2 TABLE XST00063 (XST_PRCHG) PRICE CHANGE TABLE               01680018
016900*--------------------------------------------------------------*  01690018
017000     EXEC SQL                                                     01700018
017100       INCLUDE XST00063                                           01710018
017200     END-EXEC.                                                    01720018
017300                                                                  01730018
017400*--------------------------------------------------------------*  01740018
017500* DB2 TABLE XST00064 (XST_STR_GP_PRCHG) STORE GROUP PRICE CHANGE  01750018
017600*--------------------------------------------------------------*  01760018
017700     EXEC SQL                                                     01770018
017800       INCLUDE XST00064                                           01780018
017900     END-EXEC.                                                    01790018
018000                                                                  01800018
018100*--------------------------------------------------------------*  01810018
018200* DB2 TABLE XST00065 (XST_PRCHG_MDSE) PRICE CHANGE MERCHANDISE    01820018
018300*--------------------------------------------------------------*  01830018
018400     EXEC SQL                                                     01840018
018500       INCLUDE XST00065                                           01850018
018600     END-EXEC.                                                    01860018
018700                                                                  01870018
018800******************************************************************01880018
018900* STR-GP-PRCHG-CSR CURSOR FINDS ALL ROWS WITH AN EFFECTIVE        01890018
019000* DATE BEFORE THE CALCULATED HISTORY MOVE DATE SO THAT THEY CAN BE01900020
019010* EXTRACTED TO MOVE TO HISTORY TABLES.                            01901020
019100******************************************************************01910018
019200                                                                  01920018
019300     EXEC SQL                                                     01930018
019400       DECLARE STR-GP-PRCHG-CSR CURSOR FOR                        01940018
019500         SELECT B.PRCHG_ID                                        01950018
019600              , B.STR_GP_TYP_CDE                                  01960018
019700              , B.STR_GP_ID                                       01970018
019710              , B.PRCHG_EFF_DTE                                   01971020
019720              , B.OH_AUTO_CNT_IND                                 01972020
019730              , B.SOR_LAST_UPD_TMST                               01973020
019740              , B.LAST_UPD_TMST                                   01974020
019750              , B.LAST_ACTN_CDE                                   01975020
019760              , A.PRCHG_DESC                                      01976020
019770              , A.DEPT_NBR                                        01977020
019780              , A.EVNT_CTG_CDE                                    01978020
019790              , A.PRCHG_TYP_CDE                                   01979020
019791              , A.PRCHG_ST_CDE                                    01979120
019792              , A.ALL_RMNG_STR_IND                                01979220
019793              , A.APP_TMST                                        01979320
019794              , A.SOR_LAST_UPD_TMST                               01979420
019795              , A.LAST_UPD_TMST                                   01979525
019796              ,A.LAST_ACTN_CDE                                    01979620
019800           FROM XST_PRCHG         A                               01980070
019900              , XST_STR_GP_PRCHG         B                        01990070
020000          WHERE A.PRCHG_ID = B.PRCHG_ID                           02000018
020100            AND A.PRCHG_TYP_CDE IN ('CLR','RCP','MK1')            02010062
020100            AND A.EVNT_CTG_CDE = 'CLR'                            02011062
020100            AND B.PRCHG_EFF_DTE <= :PV-ONE-MONTH-OLD-DATE         02020070
021300           ORDER BY B.PRCHG_ID                                    02130018
021400                   ,B.STR_GP_TYP_CDE                              02140018
021500                   ,B.STR_GP_ID                                   02150018
021600     END-EXEC.                                                    02160018
021700                                                                  02170018
021800******************************************************************02180018
021900* PRCHG-MDSE-CSR CURSOR FINDS ALL ROWS ASSOCIATED WITH            02190018
022000* SPECIFIED STORE GROUP TYPE, STORE GROUP ID AND PRICE CHANGE ID  02200018
022100* SO THEY CAN BE DELETED.                                         02210018
022200******************************************************************02220018
022300     EXEC SQL                                                     02230018
022400       DECLARE PRCHG-MDSE-CSR CURSOR FOR                          02240018
022500            SELECT A.PRCHG_ID                                     02250065
022500                 , A.STR_GP_TYP_CDE                               02250165
022500                 , A.STR_GP_ID                                    02250265
022500                 , PRCHG_MDSE_ID                                  02250365
022510                 , MDSE_HIER_CDE                                  02251021
022520                 , DEPT_NBR                                       02252021
022530                 , MAJ_CL_NBR                                     02253021
022540                 , SUB_CL_NBR                                     02254021
022550                 , STYL_ID                                        02255021
022560                 , SKU_NBR                                        02256021
022570                 , UNT_RTL_AMT                                    02257021
022580                 , GP_PRIC_ID                                     02258021
022590                 , GP_RTL_QTY                                     02259021
022591                 , GP_RTL_AMT                                     02259121
022592                 , CLR_TYP_CDE                                    02259221
022593                 , SOR_LAST_UPD_TMST                              02259321
022594                 , LAST_UPD_TMST                                  02259421
022595                 , LAST_ACTN_CDE                                  02259521
022600              FROM XST_PRCHG_MDSE          A                      02260070
022700             WHERE A.PRCHG_ID      = :XST00064-PRCHG-ID           02270074
023000             ORDER BY A.PRCHG_ID                                  02300018
023100                     ,A.STR_GP_TYP_CDE                            02310018
023200                     ,A.STR_GP_ID                                 02320018
023300                     ,A.PRCHG_MDSE_ID                             02330018
023400     END-EXEC.                                                    02340018
023500                                                                  02350018
025000                                                                  02500018
025100 LINKAGE SECTION.                                                 02510018
025200*--------------------------------------------------------------*  02520018
025300 PROCEDURE DIVISION.                                              02530018
025400*--------------------------------------------------------------*  02540018
025500 0000-MAINLINE.                                                   02550018
025600                                                                  02560018
025700     PERFORM 1000-INITIALIZATION.                                 02570018
025800                                                                  02580018
025900     PERFORM 2000-PROCESS-EFF-DATE.                               02590018
026000                                                                  02600018
026300     PERFORM 9999-WRAPUP.                                         02630018
026400                                                                  02640018
026500     GOBACK.                                                      02650018
026600                                                                  02660018
026700*--------------------------------------------------------------*  02670018
026800* 1000-INITIALIZATION.                                            02680018
026900*     INITIALIZATION AREA - INITIALIZES ALL VARIABLES, OPENS      02690018
027000*     FILES, READS CONTROL CARDS, AND PROCESSES ANY INPUT FILE    02700018
027100*     PARAMETERS IT MAY NEED.                                     02710018
027200*--------------------------------------------------------------*  02720018
027300 1000-INITIALIZATION.                                             02730018
027301                                                                  02730123
027310     INITIALIZE PV-PROGRAM-VARIABLES.                             02731023
027311     INITIALIZE PV-PROGRAM-COUNTERS.                              02731124
027320                                                                  02732023
027400     DISPLAY '*********************************************'.     02740018
027500     DISPLAY '   START OF PROGRAM NAME: ' PC-PROGRAM-NAME.        02750018
027600     DISPLAY '*********************************************'.     02760018
027700                                                                  02770018
027800     OPEN INPUT  CONTROL-CARD-FILE.                               02780058
027910                                                                  02791045
028000     OPEN OUTPUT HISTORY-EXTRACT.                                 02800055
028100                                                                  02810018
028200     PERFORM 1030-READ-CONTROL-DATE.                              02820018
028400                                                                  02840018
030300     CLOSE  CONTROL-CARD-FILE.                                    03030060
030500                                                                  03050018
030600*--------------------------------------------------------------*  03060018
030700* 1030-READ-CONTROL-DATE.                                         03070018
030800*     READ CONTROL CARD XSCC240. THIS CONTROL CARD CONTAINS       03080071
030900*     PURGE DATE IN DB2 DATE FORMAT.                              03090053
031000*--------------------------------------------------------------*  03100018
031100 1030-READ-CONTROL-DATE.                                          03110018
031200                                                                  03120018
031300     READ CONTROL-CARD-FILE INTO CC-CONTROL-CARD-DATE             03130058
031400       AT END                                                     03140018
031500          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    03150018
031600                                                                  03160018
031700     IF PS-END-OF-CNTL-CRD-FILE                                   03170018
031800       DISPLAY ' '                                                03180018
031900       DISPLAY '** ABEND     **'                                  03190018
032000       DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME              03200018
032100       DISPLAY '** PARAGRAPH **  = 1030-READ-CONTROL-DATE'        03210018
032200       DISPLAY '** XSCC240 CONTROL FILE IS EMPTY  '               03220071
032300       DISPLAY ' '                                                03230018
032400       MOVE +4002 TO ABEND-CODE                                   03240018
032500       CALL 'ILBOABN0' USING ABEND-CODE                           03250018
032600     ELSE                                                         03260018
032700       DISPLAY ' '                                                03270018
032800       DISPLAY '** PURGE DATE CONTROL CARD, XSCC240: **'          03280071
032800                              CC-PURGE-DATE                       03290060
032900       MOVE CC-PURGE-DATE TO PV-ONE-MONTH-OLD-DATE                03291058
033000     END-IF.                                                      03300018
033100                                                                  03310018
039900*--------------------------------------------------------------*  03990018
040000* 2000-PROCESS-EFF-DATE                                        *  04000018
040100*  DELETE PRICE CHANGE DATA BASED UPON EFFECTIVE DATES.        *  04010018
040200*--------------------------------------------------------------*  04020018
040300 2000-PROCESS-EFF-DATE.                                           04030018
040400                                                                  04040018
040500     SET MORE-DELETE-DATES TO TRUE.                               04050018
040600     PERFORM 3600-OPEN-STR-GP-PRCHG-CSR.                          04060018
040700     PERFORM 3650-FETCH-STR-GP-PRCHG-CSR.                         04070018
040800     IF NO-MORE-DELETE-DATES                                      04080018
040900        DISPLAY '* NO ROWS EXTRACTED FOR EFFECTIVE DATE *'        04090018
041000     ELSE                                                         04100018
041100        PERFORM 2600-PROCESS-DELETE-DATES                         04110018
041200          UNTIL NO-MORE-DELETE-DATES                              04120018
041300     END-IF.                                                      04130018
041400                                                                  04140018
041500     PERFORM 3690-CLOSE-STR-GP-PRCHG-CSR.                         04150018
041600                                                                  04160018
041700*--------------------------------------------------------------*  04170018
041800* FIND RECORDS THAT WILL BE DELETED FROM XST_PRCHG_MDSE           04180018
041900*--------------------------------------------------------------*  04190018
042000 2600-PROCESS-DELETE-DATES.                                       04200018
042100                                                                  04210018
042310**---                                                             04231023
042320** WRITE THE COMPLETE ROW TO BE LOADED TO HISTORY TABLE           04232048
042330**---                                                             04233048
042340     IF XST00064-PRCHG-ID = PV-PREVIOUS-PRCHG-ID                  04234024
042341        INITIALIZE XS147-PERM-EXTRACT                             04234144
042342        PERFORM 4400-WRITE-PRCHG-STRGP-RECORD                     04234223
042343     ELSE                                                         04234323
042344        INITIALIZE XS147-PERM-EXTRACT                             04234444
042350        PERFORM 4300-WRITE-PRCHG-RECORD                           04235023
042351        MOVE XST00064-PRCHG-ID TO PV-PREVIOUS-PRCHG-ID            04235124
042352        INITIALIZE XS147-PERM-EXTRACT                             04235244
042360        PERFORM 4400-WRITE-PRCHG-STRGP-RECORD                     04236023
042360                                                                  04236163
042500        SET MORE-DELETE-MDSE TO TRUE                              04236263
042600        PERFORM 3500-OPEN-PRCHG-MDSE-CSR                          04236363
042700        PERFORM 3550-FETCH-PRCHG-MDSE-CSR                         04236463
042800        IF MORE-DELETE-MDSE                                       04236563
042900            PERFORM                                               04236663
043000              UNTIL NO-MORE-DELETE-MDSE                           04236763
043211              INITIALIZE XS147-PERM-EXTRACT                       04236963
043220              PERFORM 4500-WRITE-PRCHG-MDSE-RECORD                04237063
043300              PERFORM 3550-FETCH-PRCHG-MDSE-CSR                   04237263
043400            END-PERFORM                                           04237363
043500        END-IF                                                    04237463
043600                                                                  04237563
043700     PERFORM 3590-CLOSE-PRCHG-MDSE-CSR                            04237663
042370     END-IF.                                                      04238023
042400                                                                  04240018
043900     PERFORM 3650-FETCH-STR-GP-PRCHG-CSR.                         04390018
047092                                                                  04709233
047100******************************************************************04710018
047200* 3500-OPEN-PRCHG-MDSE-CSR.                                       04720018
047300******************************************************************04730018
047400 3500-OPEN-PRCHG-MDSE-CSR.                                        04740018
047500                                                                  04750018
047600     EXEC SQL                                                     04760018
047700          OPEN PRCHG-MDSE-CSR                                     04770018
047800     END-EXEC.                                                    04780018
047900                                                                  04790018
048000     EVALUATE TRUE                                                04800018
048100         WHEN SQLCODE = ZERO                                      04810018
048200             CONTINUE                                             04820018
048300         WHEN OTHER                                               04830018
048400             MOVE '3500-OPEN-PRCHG-MDSE-CSR'                      04840018
048500                  TO PV-PARAGRAPH-NAME                            04850018
048600             MOVE 'ERROR ON OPEN OF PRCHG-MDSE-CSR'               04860018
048700                  TO PV-DB2-OPERATION                             04870018
048800             PERFORM 9900-SQL-ABEND                               04880018
048900     END-EVALUATE.                                                04890018
049000                                                                  04900018
049100******************************************************************04910018
049200* 3550-FETCH-PRCHG-MDSE-CSR.                                      04920018
049300******************************************************************04930018
049400 3550-FETCH-PRCHG-MDSE-CSR.                                       04940018
049500                                                                  04950018
049600     PERFORM                                                      04960018
049700        WITH TEST AFTER                                           04970018
049800        VARYING PV-RETRY  FROM 1 BY 1                             04980018
049900          UNTIL (PV-RETRY > PC-MAX-RETRIES                        04990018
050000             OR (SQLCODE = +100 OR +0))                           05000018
050100     EXEC SQL                                                     05010018
050200          FETCH PRCHG-MDSE-CSR                                    05020018
050300           INTO :XST00065-PRCHG-ID                                05030065
050300               ,:XST00065-STR-GP-TYP-CDE                          05030165
050300               ,:XST00065-STR-GP-ID                               05030265
050300               ,:XST00065-PRCHG-MDSE-ID                           05030365
050310               ,:XST00065-MDSE-HIER-CDE                           05031023
050320               ,:XST00065-DEPT-NBR                                05032023
050321                :PV-NULL-DEPT                                     05032126
050330               ,:XST00065-MAJ-CL-NBR                              05033023
050331                :PV-NULL-MAJ-CL                                   05033126
050340               ,:XST00065-SUB-CL-NBR                              05034023
050341                :PV-NULL-SUB-CL                                   05034126
050350               ,:XST00065-STYL-ID                                 05035025
050351                :PV-NULL-STYLE                                    05035126
050360               ,:XST00065-SKU-NBR                                 05036023
050361                :PV-NULL-SKU                                      05036126
050370               ,:XST00065-UNT-RTL-AMT                             05037023
050371                :PV-NULL-UNIT-RTL                                 05037126
050380               ,:XST00065-GP-PRIC-ID                              05038023
050381                :PV-NULL-GP-PRIC-ID                               05038126
050390               ,:XST00065-GP-RTL-QTY                              05039023
050391                :PV-NULL-GP-RTL-QTY                               05039126
050392               ,:XST00065-GP-RTL-AMT                              05039223
050393                :PV-NULL-GP-RTL-AMT                               05039326
050394               ,:XST00065-CLR-TYP-CDE                             05039423
050395                :PV-NULL-CLR-TYP-CDE                              05039526
050396               ,:XST00065-SOR-LAST-UPD-TMST                       05039626
050397               ,:XST00065-LAST-UPD-TMST                           05039726
050398               ,:XST00065-LAST-ACTN-CDE                           05039826
050400     END-EXEC                                                     05040018
050500                                                                  05050018
050600     MOVE SQLCODE TO PV-SQL-SUB                                   05060018
050700     EVALUATE TRUE                                                05070018
050800         WHEN SQLCODE = ZERO                                      05080018
050900             CONTINUE                                             05090018
051000         WHEN SQLCODE = -904                                      05100018
051100         WHEN SQLCODE = -911                                      05110018
051200         WHEN SQLCODE = -913                                      05120018
051300             CONTINUE                                             05130018
051400         WHEN SQLCODE = +100                                      05140018
051500             SET NO-MORE-DELETE-MDSE TO TRUE                      05150018
051600         WHEN OTHER                                               05160018
051700             DISPLAY '*3550 BLOWING UP ON BAD SQL-'               05170018
051800                 '* FETCH KEY-', XST00065-PRCHG-MDSE-ID, '*'      05180018
051900                 ' SQL CODE -', PV-SQL-SUB                        05190018
052000                 ' FOR STR GP-', XST00064-STR-GP-TYP-CDE,         05200018
052100                  '-', XST00064-STR-GP-ID,                        05210018
052200                  ' ON ', XST00064-PRCHG-ID, '**'                 05220018
052300             MOVE '3550-PRCHG-MDSE-CSR '                          05230018
052400                  TO PV-PARAGRAPH-NAME                            05240018
052500             MOVE 'ERROR ON FETCH OF PRCHG MDSE CSR'              05250018
052600                  TO PV-DB2-OPERATION                             05260018
052700             PERFORM 9900-SQL-ABEND                               05270018
052800         END-EVALUATE                                             05280018
052900     END-PERFORM.                                                 05290018
053000                                                                  05300018
053100     IF PV-RETRY GREATER PC-MAX-RETRIES                           05310018
053200       DISPLAY '*3550 BLOWING UP ON RETRIES-'                     05320018
053300               PV-RETRY '**'                                      05330018
053400               '* FETCH KEY-', XST00065-PRCHG-MDSE-ID, '*'        05340018
053500               ' SQL CODE -', PV-SQL-SUB                          05350018
053600               ' FOR STR GP-', XST00064-STR-GP-TYP-CDE,           05360018
053700               '-', XST00064-STR-GP-ID,                           05370018
053800               ' ON ', XST00064-PRCHG-ID, '**'                    05380018
053900        MOVE '3550-FETCH-PRCHG-MDSE-CSR'                          05390018
054000          TO PV-PARAGRAPH-NAME                                    05400018
054100        MOVE 'ERROR ON FETCH OF PRCHG MDSE CSR'                   05410018
054200                 TO PV-DB2-OPERATION                              05420018
054300        PERFORM 9900-SQL-ABEND                                    05430018
054400     END-IF.                                                      05440018
054500                                                                  05450018
054600******************************************************************05460018
054700* 3590-CLOSE-PRCHG-MDSE-CSR.                                      05470018
054800******************************************************************05480018
054900 3590-CLOSE-PRCHG-MDSE-CSR.                                       05490018
055000                                                                  05500018
055100     EXEC SQL                                                     05510018
055200          CLOSE PRCHG-MDSE-CSR                                    05520018
055300     END-EXEC.                                                    05530018
055400                                                                  05540018
055500     EVALUATE TRUE                                                05550018
055600         WHEN SQLCODE = ZERO                                      05560018
055700             CONTINUE                                             05570018
055800         WHEN OTHER                                               05580018
055900             MOVE '3590-CLOSE-PRCHG-MDSE-CSR'                     05590018
056000                  TO PV-PARAGRAPH-NAME                            05600018
056100             MOVE 'ERROR ON CLOSE OF PRCHG MDSE CSR'              05610018
056200                  TO PV-DB2-OPERATION                             05620018
056300             PERFORM 9900-SQL-ABEND                               05630018
056400     END-EVALUATE.                                                05640018
056500                                                                  05650018
056600******************************************************************05660018
056700* 3600-OPEN-STR-GP-PRCHG-CSR.                                     05670018
056800******************************************************************05680018
056900 3600-OPEN-STR-GP-PRCHG-CSR.                                      05690018
057000                                                                  05700018
057100     MOVE PV-ONE-MONTH-OLD-DATE TO XST00064-PRCHG-EFF-DTE.        05710023
057200                                                                  05720018
057300     EXEC SQL                                                     05730018
057400          OPEN STR-GP-PRCHG-CSR                                   05740018
057500     END-EXEC.                                                    05750018
057600                                                                  05760018
057700     EVALUATE TRUE                                                05770018
057800         WHEN SQLCODE = ZERO                                      05780018
057900             CONTINUE                                             05790018
058000         WHEN OTHER                                               05800018
058100             MOVE '3600-OPEN-STR-GP-PRCHG-CSR'                    05810018
058200                  TO PV-PARAGRAPH-NAME                            05820018
058300             MOVE 'ERROR ON OPEN OF STR-GP-PRCHG-CSR'             05830018
058400                  TO PV-DB2-OPERATION                             05840018
058500             PERFORM 9900-SQL-ABEND                               05850018
058600     END-EVALUATE.                                                05860018
058700                                                                  05870018
058800******************************************************************05880018
058900* 3650-FETCH-STR-GP-PRCHG-CSR.                                    05890018
059000******************************************************************05900018
059100 3650-FETCH-STR-GP-PRCHG-CSR.                                     05910018
059200                                                                  05920018
059300     PERFORM                                                      05930018
059400        WITH TEST AFTER                                           05940018
059500        VARYING PV-RETRY  FROM 1 BY 1                             05950018
059600          UNTIL (PV-RETRY > PC-MAX-RETRIES                        05960018
059700             OR (SQLCODE NOT = -904 AND -911 AND -913)            05970018
059800             OR (SQLCODE = +100 OR +0))                           05980018
059900     EXEC SQL                                                     05990018
060000          FETCH STR-GP-PRCHG-CSR                                  06000018
060100           INTO :XST00064-PRCHG-ID                                06010018
060200               ,:XST00064-STR-GP-TYP-CDE                          06020018
060300               ,:XST00064-STR-GP-ID                               06030018
060310               ,:XST00064-PRCHG-EFF-DTE                           06031023
060320               ,:XST00064-OH-AUTO-CNT-IND                         06032023
060330               ,:XST00064-SOR-LAST-UPD-TMST                       06033023
060340               ,:XST00064-LAST-UPD-TMST                           06034023
060350               ,:XST00064-LAST-ACTN-CDE                           06035023
060360               ,:XST00063-PRCHG-DESC                              06036023
060361                :PV-NULL-PRCHG-DESC                               06036136
060370               ,:XST00063-DEPT-NBR                                06037023
060371                :PV-NULL-PRCHG-DEPT                               06037136
060380               ,:XST00063-EVNT-CTG-CDE                            06038023
060390               ,:XST00063-PRCHG-TYP-CDE                           06039023
060391               ,:XST00063-PRCHG-ST-CDE                            06039123
060392               ,:XST00063-ALL-RMNG-STR-IND                        06039223
060393                :PV-NULL-ALL-RMNG-STR                             06039336
060394               ,:XST00063-APP-TMST                                06039423
060395                :PV-NULL-APP-TMST                                 06039536
060396               ,:XST00063-SOR-LAST-UPD-TMST                       06039623
060397               ,:XST00063-LAST-UPD-TMST                           06039723
060398               ,:XST00063-LAST-ACTN-CDE                           06039823
060400     END-EXEC                                                     06040018
060500                                                                  06050018
060600     EVALUATE TRUE                                                06060018
060700         WHEN SQLCODE = ZERO                                      06070018
060800             CONTINUE                                             06080018
060900         WHEN SQLCODE = +100                                      06090018
061000             SET NO-MORE-DELETE-DATES  TO TRUE                    06100018
061100         WHEN OTHER                                               06110018
061200             MOVE '3650-FETCH-STR-GP-PRCHG-CSR'                   06120018
061300                  TO PV-PARAGRAPH-NAME                            06130018
061400             MOVE 'ERROR ON FETCH OF STR-GP-PRCHG-CSR'            06140018
061500                  TO PV-DB2-OPERATION                             06150018
061600             PERFORM 9900-SQL-ABEND                               06160018
061700     END-EVALUATE                                                 06170018
061800     END-PERFORM.                                                 06180018
061900                                                                  06190018
062000     IF PV-RETRY GREATER PC-MAX-RETRIES                           06200018
062100         DISPLAY '*3650 BLOWING UP ON RETRIES-'                   06210018
062200             PV-RETRY '**'                                        06220018
062300            '* FETCH MDSE KEY-', XST00065-PRCHG-MDSE-ID, '*'      06230018
062400            '* STR GROUP-', XST00064-STR-GP-TYP-CDE,              06240018
062500               '-', XST00064-STR-GP-ID,                           06250018
062600            '-- ON PRCHG-', XST00064-PRCHG-ID, '**',              06260018
062700               ' SQL CODE -', PV-SQL-SUB                          06270018
062800               ' FOR STR GP-', XST00064-STR-GP-TYP-CDE,           06280018
062900               '-', XST00064-STR-GP-ID,                           06290018
063000               ' ON ', XST00064-PRCHG-ID, '**'                    06300018
063100        MOVE '3650-FETCH-STR-GP-PRCHG-CSR'                        06310018
063200          TO PV-PARAGRAPH-NAME                                    06320018
063300        MOVE 'ERROR ON FETCH OF STR-GP-PRCHG-CSR'                 06330018
063400                 TO PV-DB2-OPERATION                              06340018
063500        PERFORM 9900-SQL-ABEND                                    06350018
063600     END-IF.                                                      06360018
063700                                                                  06370018
063800******************************************************************06380018
063900* 3690-CLOSE-STR-GP-PRCHG-CSR.                                    06390018
064000******************************************************************06400018
064100 3690-CLOSE-STR-GP-PRCHG-CSR.                                     06410018
064200                                                                  06420018
064300     EXEC SQL                                                     06430018
064400          CLOSE STR-GP-PRCHG-CSR                                  06440018
064500     END-EXEC.                                                    06450018
064600                                                                  06460018
064700     EVALUATE TRUE                                                06470018
064800         WHEN SQLCODE = ZERO                                      06480018
064900             CONTINUE                                             06490018
065000         WHEN OTHER                                               06500018
065100             MOVE '3690-CLOSE--STR-GP-PRCHG-CSR'                  06510018
065200                  TO PV-PARAGRAPH-NAME                            06520018
065300             MOVE 'ERROR ON CLOSE OF STR-GP-PRCHG-CSR'            06530018
065400                  TO PV-DB2-OPERATION                             06540018
065500             PERFORM 9900-SQL-ABEND                               06550018
065600     END-EVALUATE.                                                06560018
065700                                                                  06570018
075000                                                                  07500018
078810******************************************************************07881023
078820*THIS PARAGRAPH WILL POPULATE THE PRCHG DETAIL SECTION BEFORE     07882025
078821*WRITING IT OUT TO THE OUTPUT FILE.                               07882125
078830******************************************************************07883023
078831 4300-WRITE-PRCHG-RECORD.                                         07883123
078832                                                                  07883223
078833     SET XS147-PRCHGH-TABLE TO TRUE.                              07883323
078834                                                                  07883423
078835     MOVE XST00064-PRCHG-ID           TO XS147-PRCHG-ID-KEY.      07883531
078836     MOVE XST00064-STR-GP-TYP-CDE     TO XS147-STR-GP-TYP-CDE-K.  07883641
078837     MOVE XST00064-STR-GP-ID          TO XS147-STR-GP-ID-K.       07883741
078838     MOVE XST00063-EVNT-CTG-CDE       TO XS147-EVNT-CTG-CDE-KEY.  07883841
078839     MOVE XST00063-PRCHG-TYP-CDE      TO XS147-PRCHG-TYP-CDE-KEY. 07883941
078840     MOVE PC-MDSE-ID-PRCHG            TO XS147-PRCHG-MDSE-ID-K.   07884046
078841                                                                  07884146
078842     MOVE XST00064-PRCHG-ID           TO XS147-PRCHG-ID.          07884246
078843                                                                  07884346
078844     IF PV-NULL-PRCHG-DESC = -1                                   07884446
078845        MOVE PC-NULL-VALUE TO XS147-PRCHG-DESC                    07884546
078846     ELSE                                                         07884646
078847        MOVE XST00063-PRCHG-DESC         TO XS147-PRCHG-DESC      07884746
078848     END-IF.                                                      07884846
078849                                                                  07884946
078850     IF PV-NULL-PRCHG-DEPT = -1                                   07885046
078851        MOVE  PC-NULL-VALUE TO XS147-DEPT-NBR-PRCHG               07885146
078852     ELSE                                                         07885246
078853        MOVE XST00063-DEPT-NBR           TO XS147-DEPT-NBR-PRCHG  07885346
078854     END-IF.                                                      07885446
078855                                                                  07885546
078856     MOVE XST00063-EVNT-CTG-CDE       TO XS147-EVNT-CTG-CDE.      07885648
078857     MOVE XST00063-PRCHG-TYP-CDE      TO XS147-PRCHG-TYP-CDE.     07885748
078858     MOVE XST00063-PRCHG-ST-CDE       TO XS147-PRCHG-ST-CDE.      07885848
078859                                                                  07885946
078860     IF PV-NULL-ALL-RMNG-STR = -1                                 07886046
078861        MOVE PC-NULL-VALUE            TO XS147-ALL-RMNG-STR-IND   07886146
078862     ELSE                                                         07886246
078863        MOVE XST00063-ALL-RMNG-STR-IND   TO XS147-ALL-RMNG-STR-IND07886346
078864     END-IF.                                                      07886446
078865                                                                  07886546
078866     IF PV-NULL-APP-TMST = -1                                     07886646
078867        MOVE PC-NULL-VALUE            TO XS147-APP-TMST           07886746
078868     ELSE                                                         07886846
078869        MOVE XST00063-APP-TMST           TO XS147-APP-TMST        07886946
078870     END-IF.                                                      07887046
078871                                                                  07887146
078872     MOVE XST00063-SOR-LAST-UPD-TMST  TO XS147-SOR-LAST-UPD-TMST1.07887246
078873     MOVE XST00063-LAST-UPD-TMST      TO XS147-LAST-UPD-TMST1.    07887346
078874     MOVE XST00063-LAST-ACTN-CDE      TO XS147-LAST-ACTN-CDE1.    07887446
078875                                                                  07887546
078876     WRITE HISTORY-EXTRACT-RECORD FROM XS147-PERM-EXTRACT.        07887646
078877                                                                  07887746
078878     ADD 1 TO PV-PRCHG-WRITE-CNT.                                 07887846
078879                                                                  07887948
078880******************************************************************07888046
078881*THE PURPOSE OF THIS PARAGRAPH IS TO TO WRITE STR_GP_PRCHG ROWS   07888146
078882* IN THE LOAD EXTRACT FILE USING COPYBOOK XSRD147                 07888246
078883******************************************************************07888346
078884                                                                  07888446
078885 4400-WRITE-PRCHG-STRGP-RECORD.                                   07888546
078886                                                                  07888646
078887     SET XS147-STRGP-PRCHG-TABLE      TO TRUE.                    07888746
078889     MOVE XST00064-PRCHG-ID           TO XS147-PRCHG-ID-KEY.      07888941
078890     MOVE XST00064-STR-GP-TYP-CDE     TO XS147-STR-GP-TYP-CDE-K.  07889041
078891     MOVE XST00064-STR-GP-ID          TO XS147-STR-GP-ID-K.       07889141
078892     MOVE XST00063-EVNT-CTG-CDE       TO XS147-EVNT-CTG-CDE-KEY.  07889241
078893     MOVE XST00063-PRCHG-TYP-CDE      TO XS147-PRCHG-TYP-CDE-KEY. 07889341
078894     MOVE PC-MDSE-ID-STRGP            TO XS147-PRCHG-MDSE-ID-K.   07889447
078895                                                                  07889546
078896     MOVE XST00064-STR-GP-TYP-CDE     TO XS147-STR-GP-TYP-CDE.    07889646
078897     MOVE XST00064-STR-GP-ID          TO XS147-STR-GP-ID.         07889746
078898     MOVE XST00064-PRCHG-EFF-DTE      TO XS147-PRCHG-EFF-DTE.     07889846
078899     MOVE XST00064-OH-AUTO-CNT-IND    TO XS147-OH-AUTO-CNT-IND    07889946
078900     MOVE XST00064-SOR-LAST-UPD-TMST  TO XS147-SOR-LAST-UPD-TMST2.07890046
078901     MOVE XST00064-LAST-UPD-TMST      TO XS147-LAST-UPD-TMST2.    07890146
078902     MOVE XST00064-LAST-ACTN-CDE      TO XS147-LAST-ACTN-CDE2.    07890246
078903                                                                  07890346
078904     WRITE HISTORY-EXTRACT-RECORD FROM XS147-PERM-EXTRACT.        07890446
078905                                                                  07890546
078906     ADD 1 TO PV-STRGP-WRITE-CNT.                                 07890646
078907                                                                  07890746
078908******************************************************************07890846
078909*THE PURPOSE OF THIS PARAGRAPH IS TO TO WRITE STR_GP_PRCHG ROWS   07890946
078910* IN THE LOAD EXTRACT FILE USING COPYBOOK XSRD147                 07891046
078911******************************************************************07891146
078912                                                                  07891246
078913 4500-WRITE-PRCHG-MDSE-RECORD.                                    07891346
078914                                                                  07891446
078915     SET XS147-MDSE-PRCHG-TABLE TO TRUE.                          07891546
078916     MOVE XST00065-PRCHG-ID           TO XS147-PRCHG-ID-KEY.      07891664
078917     MOVE XST00065-STR-GP-TYP-CDE     TO XS147-STR-GP-TYP-CDE-K.  07891764
078918     MOVE XST00065-STR-GP-ID          TO XS147-STR-GP-ID-K.       07891864
078919     MOVE XST00063-EVNT-CTG-CDE       TO XS147-EVNT-CTG-CDE-KEY.  07891941
078920     MOVE XST00063-PRCHG-TYP-CDE      TO XS147-PRCHG-TYP-CDE-KEY. 07892041
078921     MOVE XST00065-PRCHG-MDSE-ID      TO XS147-PRCHG-MDSE-ID-K.   07892146
078922                                                                  07892241
078924     MOVE XST00065-PRCHG-MDSE-ID     TO XS147-PRCHG-MDSE-ID.      07892446
078925     MOVE XST00065-MDSE-HIER-CDE     TO XS147-MDSE-HIER-CDE.      07892546
078926                                                                  07892646
078927     IF PV-NULL-DEPT  = -1                                        07892746
078928        MOVE PC-NULL-VALUE           TO XS147-DEPT-NBR-NUL        07892846
078929     ELSE                                                         07892946
078930        MOVE XST00065-DEPT-NBR          TO XS147-DEPT-NBR         07893046
078931     END-IF.                                                      07893146
078932                                                                  07893246
078933     IF PV-NULL-MAJ-CL = -1                                       07893346
078934        MOVE PC-NULL-VALUE           TO XS147-MAJ-CL-NBR-NUL      07893446
078935     ELSE                                                         07893546
078936        MOVE XST00065-MAJ-CL-NBR        TO XS147-MAJ-CL-NBR       07893646
078937     END-IF.                                                      07893746
078938                                                                  07893846
078939     IF PV-NULL-SUB-CL = -1                                       07893946
078940        MOVE PC-NULL-VALUE           TO XS147-SUB-CL-NBR-NUL      07894046
078941     ELSE                                                         07894146
078942        MOVE XST00065-SUB-CL-NBR        TO XS147-SUB-CL-NBR       07894246
078943     END-IF.                                                      07894346
078944                                                                  07894446
078945     IF PV-NULL-STYLE  = -1                                       07894546
078946        MOVE PC-NULL-VALUE           TO XS147-STYL-ID-NUL         07894646
078947     ELSE                                                         07894746
078948        MOVE XST00065-STYL-ID           TO XS147-STYL-ID          07894846
078949     END-IF.                                                      07894946
078950                                                                  07895046
078951     IF PV-NULL-SKU = -1                                          07895146
078952        MOVE PC-NULL-VALUE           TO XS147-SKU-NBR-NUL         07895246
078953     ELSE                                                         07895346
078954        MOVE XST00065-SKU-NBR           TO XS147-SKU-NBR          07895446
078955     END-IF.                                                      07895546
078956                                                                  07895646
078957     IF PV-NULL-UNIT-RTL = -1                                     07895746
078958        MOVE PC-NULL-VALUE           TO XS147-UNT-RTL-AMT-NUL     07895846
078959     ELSE                                                         07895946
078960        MOVE XST00065-UNT-RTL-AMT       TO XS147-UNT-RTL-AMT      07896046
078961     END-IF.                                                      07896146
078962                                                                  07896246
078963     IF PV-NULL-GP-PRIC-ID = -1                                   07896346
078964        MOVE PC-NULL-VALUE           TO XS147-GP-PRIC-ID-NUL      07896446
078965     ELSE                                                         07896546
078966        MOVE XST00065-GP-PRIC-ID        TO XS147-GP-PRIC-ID       07896646
078967     END-IF.                                                      07896746
078968                                                                  07896846
078969     IF PV-NULL-GP-RTL-QTY = -1                                   07896946
078970        MOVE PC-NULL-VALUE           TO XS147-GP-RTL-QTY-NUL      07897046
078971     ELSE                                                         07897146
078972        MOVE XST00065-GP-RTL-QTY        TO XS147-GP-RTL-QTY       07897246
078973     END-IF.                                                      07897346
078974                                                                  07897446
078975     IF PV-NULL-GP-RTL-AMT = -1                                   07897546
078976        MOVE PC-NULL-VALUE           TO XS147-GP-RTL-AMT-NUL      07897646
078977     ELSE                                                         07897746
078978        MOVE XST00065-GP-RTL-AMT     TO XS147-GP-RTL-AMT          07897846
078979     END-IF.                                                      07897946
078980                                                                  07898046
078981     IF PV-NULL-CLR-TYP-CDE = -1                                  07898146
078982        MOVE PC-NULL-VALUE           TO XS147-CLR-TYP-CDE         07898246
078983     ELSE                                                         07898346
078984        MOVE XST00065-CLR-TYP-CDE       TO XS147-CLR-TYP-CDE      07898446
078985     END-IF.                                                      07898546
078986                                                                  07898646
078987     MOVE XST00065-SOR-LAST-UPD-TMST TO XS147-SOR-LAST-UPD-TMST3. 07898746
078988     MOVE XST00065-LAST-UPD-TMST     TO XS147-LAST-UPD-TMST3.     07898846
078989     MOVE XST00065-LAST-ACTN-CDE     TO XS147-LAST-ACTN-CDE3.     07898946
078990                                                                  07899046
078991     WRITE HISTORY-EXTRACT-RECORD FROM XS147-PERM-EXTRACT.        07899146
078992                                                                  07899246
078993     ADD 1 TO PV-MDSEP-WRITE-CNT.                                 07899346
078994                                                                  07899446
078995*--------------------------------------------------------------*  07899546
079000* 9900-SQL-ABEND.                                                 07900018
079100*     SQL ABEND ROUTINE.                                          07910018
079200*--------------------------------------------------------------*  07920018
079300 9900-SQL-ABEND.                                                  07930018
079400                                                                  07940018
079500     DISPLAY '** ABEND     **'.                                   07950018
079600     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                07960018
079700     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              07970018
079800     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               07980018
079900                                                                  07990018
080000     COPY DPPD004.                                                08000018
080100     SET ABEND-4013-DB2-ERROR TO TRUE.                            08010018
080200     CALL 'ILBOABN0' USING ABEND-CODE.                            08020018
080300                                                                  08030018
080400*--------------------------------------------------------------*  08040018
080500* 9999-WRAPUP.                                                    08050018
080600*     END OF PROGRAM ROUTINE.  CLOSE OUTPUT FILES AND DISPLAYS    08060018
080700*     DATA COUNTS FROM THE PROGRAM.                               08070018
080800*--------------------------------------------------------------*  08080018
080900 9999-WRAPUP.                                                     08090018
081000                                                                  08100018
081100     CLOSE  HISTORY-EXTRACT.                                      08110056
081200                                                                  08120018
081300     DISPLAY '*********************************************'.     08130018
081400     DISPLAY '**SUMMARY OF XSKUT096 - PRICE CHANGE EXTRACT *'.    08140018
081400     DISPLAY '**TO BE LOADED INTO PRICE CHANGE HISTORY TBLS*'.    08141072
081500     DISPLAY '*********************************************'.     08150018
081610     DISPLAY ' '                                                  08161037
081620     DISPLAY 'TOTAL # OF PRCHG ROWS WRITEN:    '                  08162037
081630                                           PV-PRCHG-WRITE-CNT.    08163037
081640     DISPLAY 'TOTAL # OF STR_GP_PRCHG ROWS WRITEN: '              08164037
081650                                           PV-STRGP-WRITE-CNT.    08165037
081660     DISPLAY 'TOTAL # OF MDSE_PRCHG ROWS WRITEN: '                08166037
081670                                           PV-MDSEP-WRITE-CNT.    08167037
081700                                                                  08170018
081800     DISPLAY '*********************************************'.     08180037
